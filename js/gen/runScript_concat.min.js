!function(){var n={};return n.def=function(t,e,i){var s=n.getModuleInfo(n.curName);s.type=i,n.setReqs(s,t),s.func=function(){return e.apply(this,n.getObjs(t))},n.loadIfAvailable(s)},define=function(t,e){n.def(t,e,"define")},require=requirejs=function(t,e){n.def(t,e,"require")},n.setReqs=function(t,e){e.forEach(function(e){var i=n.getModuleInfo(e);i.loaded||(t.reqs[e]=i,i.revReqs[t.name]=t)})},n.getModuleInfo=function(t){var e=n.modules;return e[t]||(e[t]={name:t,reqs:{},revReqs:{}}),e[t]},n.doLoad=function(t){var e=n.getModuleInfo(t);if(e.loaded)return e.obj;e.loaded=!0;var i=null;if(e.func)i=e.func();else{var s=t.split(/\./);i=function(){return this}(),s.forEach(function(n){i&&(i=i[n])}),null==i&&console.log("Warning: No obj for "+t)}if("define"==e.type&&null==i)throw"No obj for "+t;e.obj=i;for(var r in e.revReqs)n.notifyLoaded(e.revReqs[r],e.name);return i},n.notifyLoaded=function(t,e){delete t.reqs[e],n.loadIfAvailable(t)},n.loadIfAvailable=function(t){for(var e in t.reqs)return;n.doLoad(t.name)},n.getObjs=function(t){var e=[];return t.forEach(function(t){var i=n.doLoad(t);e.push(i)}),e},n.modules={},n.setName=function(t){n.curName&&(n.getModuleInfo(n.curName).func||n.doLoad(n.curName)),t&&(n.curName=t)},requireSimulator=n,n}(),requireSimulator.setName("WebSite"),define([],function(){var n=document.location.href,t=!!n.match(/html\/dev\//)&&!!n.match(/localhost:3/);return window.WebSite=n.match(/jsrun\.it/)?{urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/j/D/9/q/jD9qQ.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:t,pluginTop:"http://tonyuedit.appspot.com/js/plugins"}:n.match(/tonyuexe\.appspot\.com/)||n.match(/localhost:8887/)||(n.match(/^file:/)||n.match(/localhost/)||n.match(/tonyuedit\.appspot\.com/))&&n.match(/\/html\/((dev)|(build))\//)?{urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:t}:{urlAliases:{},top:"../..",devMode:t},window.WebSite.pluginTop||(window.WebSite.pluginTop=window.WebSite.top+"/js/plugins"),window.WebSite.disableROM={},n.match(/tonyuedit\.appspot\.com/)||n.match(/localhost:8888/),(n.match(/\.appspot\.com/)||n.match(/localhost:888[87]/))&&(window.WebSite.serverType="GAE"),n.match(/localhost:3000/)&&(window.WebSite.serverType="Node"),window.WebSite.serverTop=n.match(/tonyuexe\.appspot\.com/)||n.match(/localhost:8887/)?window.WebSite.top+"/exe":window.WebSite.top+"/edit",window.WebSite.sampleImg=window.WebSite.top+"/images",window.WebSite.blobPath=window.WebSite.serverTop+"/serveBlob",window.WebSite.isNW="object"==typeof process&&process.__node_webkit,window.WebSite.tonyuHome="/Tonyu/",window.WebSite.isNW&&(window.WebSite.tonyuHome=process.env.TONYU_HOME?process.env.TONYU_HOME.replace(/\\/g,"/"):process.cwd().replace(/\\/g,"/").replace(/\/$/,"")+"/fs/Tonyu/"),window.WebSite}),requireSimulator.setName("FS"),define(["WebSite"],function(n){function t(n,t){if(t)for(var e in t)n[e]=t[e]}function e(n,t){return n.substring(n.length-t.length)===t}function i(n,t){return n.substring(0,t.length)===t}function s(){return(new Date).getTime()}function r(n){var t=n.split(w);return""==t[t.length-1]&&(t[t.length-2]+=w,t.pop()),t}function a(n){for(var t in L){var e=n.substring(0,t.length),i=n.substring(t.length);if(e==t)return{rom:L[t],rel:i}}return null}function o(n){return c(n)?P:localStorage}function u(n,t){var e=o(n),i=a(n);if(2!=arguments.length)return i?i.rom[i.rel]:e[n];if(i)throw new Error(n+" is Read only.");return null!=t?e[n]=t:void delete e[n]}function _(n){var t=o(n),e=a(n);return e?e.rel in e.rom:n in t}function h(n,t,e,i){if(null==n)throw new Error("putDir: Null path");if(!d(n))throw new Error("Not a directory : "+n);i==O?P[n]=t:u(n,JSON.stringify(t));var s=y(n);if(null!=s){var r=l(s,i);f(r,s,m(n),e,i)}}function c(n){return"ALL"==A?!0:"object"==typeof A&&A?n in A:!1}function l(n,i){if(null==n)throw new Error("getDir: Null path");e(n,w)||(n+=w);var s={},r={};if(i&O&&(r=P[n]||{}),i&g)try{var a=u(n);a&&(s=JSON.parse(a))}catch(o){console.log("dinfo err : "+n+" - "+s)}t(s,r),t(s,x[n]);for(var _ in s)"number"==typeof s[_]&&(s[_]={lastUpdate:s[_]});return s}function f(n,t,e,i,r){n[e]||(n[e]={},i&&(n[e].trashed=!0)),i||delete n[e].trashed,n[e].lastUpdate=s(),h(t,n,i,r)}function S(n,t,e,i){n[e]&&(n[e]={lastUpdate:s(),trashed:!0},h(t,n,!0,i))}function T(n,t,e,i){n[e]&&(delete n[e],h(t,n,!0,i))}function y(n){if(n==w)return null;var t=r(n);return t[t.length-1]="",t.join(w)}function p(n){return i(n,w)}function d(n){return e(n,w)}function m(n){var t=r(n);return t[t.length-1]}if(n.isNW){var $=require("SFileNW");return"object"==typeof window&&(window.FS=$),$}var O=1,g=2,v=3,P={},A=null;("undefined"==typeof localStorage||null==localStorage)&&(console.log("FS: Using RAMDisk"),A="ALL");var b={};"object"==typeof window&&(window.FS=b),b.ramDisk=P,b.ramDiskUsage=A;var L={},x={},w="/";b.roms=L,b.romParents=x,b.endsWith=e,b.splitPath=r,b.orderByNewest=function(n,t){if(!(n&&t&&n.lastUpdate&&t.lastUpdate))return 0;var e=n.lastUpdate(),i=t.lastUpdate();return i>e?1:e>i?-1:0},b.orderByName=function(n,t){return n.name&&t.name&&(n=n.name(),t=t.name()),n>t?1:t>n?-1:0},b.orderByNumberedName=function(n,t){function e(n){for(var t=[],e=/^[0-9]*/,i=/^[^0-9]*/;n&&(n.match(i),t.push(RegExp.lastMatch),n=n.replace(i,""));){n.match(e);var s=parseInt(RegExp.lastMatch);t.push(s),n=n.replace(e,"")}return t}n.name&&t.name&&(n=n.name(),t=t.name());var i,s=e(n),r=e(t);for(i=0;i<s.length;i++){if(i>=r.length)return 1;if(s[i]>r[i])return 1;if(s[i]<r[i])return-1}return i<r.length?-1:0},b.importDir=function(n){var t=b.get(n.base);n.confirm||t.mkdir();var e=n.data,i=[];for(var s in e){var r=t.path()+s,a=b.get(r);if(i.push("["+(a.isReadOnly()?"ro":a.exists()?"exists":"new")+"]"+r),!a.isReadOnly()&&!n.confirm)if(a.isDir()){var o=l(r,g),_=JSON.parse(e[s]);for(var c in _)o[c]=_[c];h(r,o,!1,g)}else u(r,e[s])}return i},b.mountROM=function(n){console.log("ROM mouted on ",n.base),L[n.base]=n.data;var t=r(n.base),e=t.pop(),i=t.join(w)+w;x[i]||(x[i]={}),x[i][e]={lastUpdate:(new Date).getTime()}};var j="DONOTEXPORT";return b.exportDir=function(n,t){function e(i){var r=i.relPath(n);if(s[r]=i.text(),t.keepCR||(s[r]=s[r].replace(/\r/g,"")),i.isDir()){if(i.rel(j).exists())return;i.each(e)}}t||(t={}),"string"==typeof n&&(n=b.get(n));var i={base:n.path()},s=i.data={};return e(n),i},b.resolve=function(n,t){return b.get(t?b.get(t).rel(n):n)},b.get=function(n,t){if(t||(t={}),null==n)throw new Error("FS.get: Null path");if(n.isDir)return n;if(t.topDir&&!i(n,t.topDir))throw new Error(n+" is out of securtyDomain");if(!p(n))throw new Error(n+": Path must starts with '/'");var s,o=y(n),$=m(n);if(d(n)){var L=s={};L.files=function(n,t){var e=[];return L.each(function(n){e.add(n)},t),e},L.each=function(n,t){L.ls(t).forEach(function(t){var e=L.rel(t);n(e)})},L.recursive=function(n,t){L.each(function(t){t.isDir()?t.recursive(n):n(t)},t)},L.listFiles=function(t){var e;"function"==typeof t&&(e=t),t=L.convertOptions(t),e||(e=t.order);var i=l(n,v),s=[];for(var r in i)(t.includeTrashed||!i[r].trashed)&&(t.excludes[n+r]||s.push(L.rel(r)));return"function"==typeof e&&s.sort&&s.sort(e),s},L.ls=function(n){var t=L.listFiles(n),e=[];return t.forEach(function(n){e.push(n.name())}),e},L.convertOptions=function(t){if(t||(t={}),t.excludes||(t.excludes={}),t.excludes instanceof Array){var e={};t.excludes.forEach(function(t){i(t,"/")?e[t]=1:e[n+t]=1}),t.excludes=e}return t},L.isDir=function(){return!0},L.rel=function(n){var e=r(n),i=L.path();return i=i.replace(/\/$/,""),e.forEach(function(n){".."==n||"../"==n?i=y(i):(i=i.replace(/\/$/,""),i+=w+("."==n||"./"==n?"":n))}),b.get(i,t)},L.rm=function(){if(!L.exists())throw new Error(n+": No such dir.");var t=L.ls();if(t.length>0)throw new Error(n+": Directory not empty");if(null!=o){var e=L.mediaType(),i=l(o,e);S(i,o,$,e)}},L.removeWithoutTrash=function(){var t=L.mediaType();if(L.each(function(n){n.removeWithoutTrash()},{includeTrashed:!0}),u(n,null),null!=o){var e=l(o,t);T(e,o,$,t)}},L.mkdir=function(){L.touch()},L.text=function(){return u(n)},L.obj=function(){return JSON.parse(L.text())},L.exists=function(){if("/"==n)return!0;var t=l(o,v);return t&&t[$]&&!t[$].trashed},L.mediaType=function(){return P[n]&&!localStorage[n]?O:g}}else{var x=s={};x.isDir=function(){return!1},x.rm=function(){if(!x.exists())throw new Error(n+": No such file.");if(u(n,null),null!=o){var t=x.mediaType(),e=l(o,t);S(e,o,$,t)}},x.removeWithoutTrash=function(){if(!x.exists()&&!x.isTrashed())throw new Error(n+": No such file.");if(u(n,null),null!=o){var t=x.mediaType(),e=l(o,t);T(e,o,$,t)}},x.text=function(){return 0==arguments.length?u(n):(u(n,arguments[0]),void x.touch())},x.lines=function(){return x.text().split("\n")},x.obj=function(){if(0==arguments.length){var n=x.text();return n?JSON.parse(n):null}x.text(JSON.stringify(arguments[0]))},x.copyFrom=function(n,t){x.text(n.text()),t.a&&x.metaInfo(n.metaInfo())},x.exists=function(){return _(n)},x.useRAMDisk=function(){return"ALL"==A?x:(A=A||{},A[n]=!0,x)},x.mediaType=function(){return c(n)?O:g}}return s.relPath=function(t){var e=t.path?t.path():t;if(e.substring(e.length-1)!=w)throw new Error(e+" is not a directory.");return n.substring(0,e.length)!=e?"../"+s.relPath(t.up()):n.substring(e.length)},s.isTrashed=function(){var n=s.metaInfo();return n?n.trashed:!1},s.metaInfo=function(){if(null!=o){var n;if(0==arguments.length)return n=l(o,v),n[$];var t=s.mediaType();n=l(o,t),n[$]=arguments[0],h(o,n,n[$].trashed,t)}return{}},s.lastUpdate=function(){return s.metaInfo().lastUpdate},s.up=function(){return null==o?null:b.get(o,t)},s.path=function(){return n},s.name=function(){return $},s.truncExt=function(n){return $.substring(0,$.length-n.length)},s.touch=function(){if(null!=o){var n=s.mediaType(),t=l(o,n);f(t,o,$,!1,n)}},s.isReadOnly=function(){var t=a(n);return!!t},s.startsWith=function(n){return i($,n)},s.endsWith=function(n){return e($,n)},s.equals=function(t){return t&&"function"==typeof t.path&&t.path()==n},s.toString=function(){return n},s},b.scan=function(){for(var n in localStorage)if(p(n)){var t=y(n);if(null!=t){var e=l(t,g),i=m(n);f(e,t,i,e[i]&&e[i].trashed,g)}}},b.dump=function(){for(var n in localStorage)console.log(n)},b.ls=function(n){return b.get(n).ls()},b}),requireSimulator.setName("fs/ROMk"),function(){var n={base:"/Tonyu/Kernel/",data:{"":'{".desktop":{"lastUpdate":1424849946377},"Actor.tonyu":{"lastUpdate":1425004177938},"BaseActor.tonyu":{"lastUpdate":1427705344084},"BodyActor.tonyu":{"lastUpdate":1425555929415},"Boot.tonyu":{"lastUpdate":1425019818961},"DxChar.tonyu":{"lastUpdate":1421384204610},"EventMod.tonyu":{"lastUpdate":1425010352383},"InputDevice.tonyu":{"lastUpdate":1416890086000},"js/":{"concat.js":{"lastUpdate":1428228330024}},"Keys.tonyu":{"lastUpdate":1412697666000},"Map.tonyu":{"lastUpdate":1421122943495},"MapEditor.tonyu":{"lastUpdate":1421122943503},"MathMod.tonyu":{"lastUpdate":1424849946395},"MediaPlayer.tonyu":{"lastUpdate":1421384204625},"MML.tonyu":{"lastUpdate":1424849946399},"NoviceActor.tonyu":{"lastUpdate":1412697666000},"options.json":{"lastUpdate":1428228309742},"Pad.tonyu":{"lastUpdate":1421122943510},"Panel.tonyu":{"lastUpdate":1427702417187},"PlainChar.tonyu":{"lastUpdate":1427964942819},"PlayMod.tonyu":{"lastUpdate":1425018365373},"ScaledCanvas.tonyu":{"lastUpdate":1421122943524},"SecretChar.tonyu":{"lastUpdate":1421384204695},"SpriteChar.tonyu":{"lastUpdate":1421384204710},"Sprites.tonyu":{"lastUpdate":1421122943538},"T1Line.tonyu":{"lastUpdate":1427965036844},"T1Map.tonyu":{"lastUpdate":1421384204728},"T1Page.tonyu":{"lastUpdate":1421384204737},"T1Text.tonyu":{"lastUpdate":1427965019581},"T2Body.tonyu":{"lastUpdate":1425264703379},"T2Mod.tonyu":{"lastUpdate":1425020004839},"T2World.tonyu":{"lastUpdate":1427976124069},"TextChar.tonyu":{"lastUpdate":1421384204762},"TextRectMod.tonyu":{"lastUpdate":1427702468448},"TObject.tonyu":{"lastUpdate":1421122943543},"TQuery.tonyu":{"lastUpdate":1412697666000},"WaveTable.tonyu":{"lastUpdate":1412697666000}}',".desktop":'{"runMenuOrd":["Main0121","Main1023","TouchedTestMain","Main2","MapLoad","Main","AcTestM","NObjTest","NObjTest2","AcTest","AltBoot","Ball","Bar","Bounce","MapTest","MapTest2nd","SetBGCTest","Label","PanelTest","BaseActor","Panel","MathMod"]}',"Actor.tonyu":'extends BaseActor;\nincludes PlayMod;\nnative Sprites;\nnative Tonyu;\n\n\\new(x,y,p) {\n    super(x,y,p);\n    if (Tonyu.runMode) initSprite();\n}\n\\initSprite() {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    onAppear();\n}\n\\onAppear() {\n}\n',"BaseActor.tonyu":'extends null;\nincludes MathMod,EventMod,TextRectMod;\nnative Tonyu;\nnative Key;\nnative console;\nnative Math;\nnative FS;\nnative Array;\n\n\\new(x,y,p) {\n    if (Tonyu.runMode) {\n        var thg=currentThreadGroup();\n        if (thg) _th=thg.addObj(this);\n    }\n    if (typeof x=="object") Tonyu.extend(this,x); \n    else if (typeof x=="number") {\n        this.x=x;\n        this.y=y;\n        this.p=p;\n    }\n    if (scaleX==null) scaleX=1;\n    if (rotation==null) rotation=0;\n    if (rotate==null) rotate=0;\n    if (alpha==null) alpha=255;\n    if (zOrder==null) zOrder=0;\n    if (age==null) age=0;\n    if (anim!=null && typeof anim=="object"){\n        animMode=true;\n        animFrame=0;\n    }else{\n        animMode=false;\n    }\n    if (animFps==null) animFps=1;\n}\nnowait \\extend(obj) {\n    return Tonyu.extend(this,obj);\n}\n\nnowait \\print(pt) {\n    console.log.apply(console,arguments);\n    if($consolePanel){\n        $consolePanel.scroll(0,20);\n        $consolePanel.setFillStyle("white");\n        $consolePanel.fillText(pt,0,$consolePrintY,20,"left");\n    }\n}\n\nnowait \\setAnimFps(f){\n    this.animFps=f;\n    this.animFrame=0;\n    this.animMode=true;\n}\nnowait \\startAnim(){\n    this.animMode=true;\n}\nnowait \\stopAnim(){\n    this.animMode=false;\n}\n\\update() {\n    onUpdate();\n    if(_thread) {\n        _thread.suspend();\n    }\n}\nnowait \\onUpdate() {\n    \n}\n\\updateEx(updateT){\n    for(var updateCount=0;updateCount<updateT;updateCount++){\n        update();\n    }\n}\nnowait \\getkey(k) {\n    return $Keys.getkey(k);\n}\nnowait \\hitTo(t) {\n    return crashTo(t);\n}\nnowait \\all(c) {\n    var res=new TQuery;\n    $Sprites.sprites.forEach \\(s) {\n        if (s===this) return;\n        if (!c || s instanceof c) {\n            res.push(s);\n        }\n    };\n    return res;// new TQuery{objects:res};\n}\nnowait \\allCrash(t) {\n    var res=new TQuery;\n    var sp=this; //_sprite || this;\n    var t1=getCrashRect();\n    if (!t1) return res;\n    $Sprites.sprites.forEach(\\(s) {\n        var t2;\n        if (s!==this && \n        !s.excludeFromAll &&\n        s instanceof t && \n        (t2=s.getCrashRect()) &&\n        Math.abs(t1.x-t2.x)*2<t1.width+t2.width &&\n        Math.abs(t1.y-t2.y)*2<t1.height+t2.height) {\n            res.push(s);    \n        }\n    });\n    return res;\n}\nnowait \\crashTo(t) {\n    if (!t) return false;\n    if (typeof t=="function") {\n        return allCrash(t)[0];\n    }\n    return crashTo1(t);\n}\nnowait \\crashTo1(t) {\n    if (!t || t._isDead) return false;\n    /*if (_sprite && t._sprite) {\n        return _sprite.crashTo(t._sprite);\n    }*/\n    var t1=getCrashRect();\n    var t2=t.getCrashRect();\n    return \n    //    t1.x!=null && t1.y!=null && t1.width && t1.height &&\n    //    t2.x!=null && t2.y!=null && t2.width && t2.height &&\n    t1 && t2 &&\n    Math.abs(t1.x-t2.x)*2<t1.width+t2.width &&\n    Math.abs(t1.y-t2.y)*2<t1.height+t2.height;\n}\nnowait \\getCrashRect() {\n    var actWidth=width*scaleX, actHeight;\n    if(typeof scaleY==="undefined"){\n        actHeight=height*scaleX;\n    }else{\n        actHeight=height*scaleY;\n    }\n    return typeof x=="number" &&\n    typeof y=="number" &&\n    typeof width=="number" &&\n    typeof height=="number" && \n    {x,y,width:actWidth,height:actHeight};\n}\nnowait \\within(t,distance){\n    if(!t || t._isDead) return false;\n    if(Math.sqrt(Math.abs(x-t.x)*Math.abs(x-t.x)+ Math.abs(y-t.y)*Math.abs(y-t.y))<distance){\n        return true;\n    }\n    return false;\n}\nnowait \\watchHit(typeA,typeB,onHit) {\n    $Sprites.watchHit(typeA , typeB, \\(a,b) {\n        onHit.apply(this,[a,b]);\n    });\n}\nnowait \\currentThreadGroup() {\n    return $currentThreadGroup; \n}\nnowait \\die() {\n    if (_th) {\n        _th.kill();\n    }\n    hide();\n    fireEvent("die");\n    _isDead=true;\n}\nnowait \\hide() {\n    /*if (_sprite) {\n        $Sprites.remove(_sprite);\n        _sprite=null;\n    } else {*/\n        //$Sprites.remove(this);\n    //}\n    if(layer && typeof layer.remove=="function"){\n        layer.remove(this);\n    }else{\n        $Sprites.remove(this);\n    }\n}\nnowait \\show(x,y,p) {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    if (x!=null) this.x=x;\n    if (y!=null) this.y=y;\n    if (p!=null) this.p=p;\n}\n\nnowait \\detectShape() {\n    if (typeof p!="number") {\n        if (text!=null) return;\n        p=0;\n    }\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) return;\n    width=pImg.width;\n    height=pImg.height;\n}\n\\waitFor(f) {\n    ifwait {\n        _thread.waitFor(f);\n    }\n    update();\n}\nnowait \\isDead() {\n    return _isDead;\n}\n\nnowait \\animation(){\n    age++;\n    if(animMode && age%animFps==0){\n        p=anim[animFrame%anim.length];\n        animFrame++;\n    }\n}\nnowait \\draw(ctx) {\n    if (x==null || y==null || _isInvisible) return;\n    detectShape();\n    if (pImg) {\n        ctx.save();\n        ctx.translate(x,y);\n        //if (typeof rotate=="number" ) rotation=rotate;// 削除予定\n        //ctx.rotate(this.rotation/180*Math.PI);\n        animation();\n        if(this.rotation!=0){\n            ctx.rotate(this.rotation/180*Math.PI);\n        }else{\n            ctx.rotate(this.rotate/180*Math.PI);\n        }\n        if(typeof this.scaleY==="undefined") {\n            ctx.scale(this.scaleX,this.scaleX);\n        }else{\n            ctx.scale(this.scaleX,this.scaleY);\n        }\n        ctx.globalAlpha=this.alpha/255;\n        ctx.drawImage(\n        pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n        -width/2, -height/2, width, height);\n        ctx.restore();\n    } else if (text!==null && text!==undefined) {\n        if (!size) size=15;\n        if (!align) align="center";\n        if (!fillStyle) fillStyle="white";\n        ctx.fillStyle=fillStyle;\n        ctx.globalAlpha=this.alpha/255;\n        var rect=drawTextRect(ctx, text, x, y, size, align , "fill");\n        width=rect.w;\n        height=rect.h;\n    }\n    if (_fukidashi) {\n        if (_fukidashi.c>0) {\n            _fukidashi.c--;\n            ctx.fillStyle="white";\n            ctx.strokeStyle="black";\n            fukidashi ( ctx , _fukidashi.text, \n            x, y-height/2-10, _fukidashi.size);\n        }\n    }\n}\nnowait \\asyncResult() {\n    return Tonyu.asyncResult();\n}\n\n\\screenOut(a) {\n    //オブジェクトが画面外に出たかどうかを判定します。\n    if (!a) a=0;\n    var r=0;\n    var viewX=0,viewY=0;\n    if (x<viewX+a)               r+=viewX+a-x;\n    if (y<viewY+a)               r+=viewY+a-y;\n    if (x>$screenWidth +viewX-a) r+=x-($screenWidth +viewX-a);\n    if (y>$screenHeight+viewY-a) r+=y-($screenHeight+viewY-a);\n    return r;\n}\n\\file(path) {\n    var d=Tonyu.currentProject.getDir();\n    var files=d.rel("files/");\n    return FS.get(files.rel(path)) {topDir:d};\n}\n\\waitInputDevice(fl) {\n    if (fl!==false) {\n        if (!origTG) {\n            ifwait {\n                origTG=_thread.group;\n                _thread.setGroup(null);\n            }\n        }\n        a=asyncResult();\n        $InputDevice.addOnetimeListener(a.receiver);\n        waitFor(a);\n    } else {\n        if (origTG) {\n            ifwait {\n                _thread.setGroup(origTG);\n                origTG=null;\n            }\n        }\n    }\n}\n\\redrawScreen() {\n    $Sprites.draw($Screen.buf[0]);\n    $Screen.draw();\n}\n\n// from PlainChar\n\\color(r,g,b) {\n    return "rgb("+[r,g,b].join(",")+")";\n}\n\\drawText(x,y,text,col,size) {\n    if ($debug) return;\n    if (!size) size=15;\n    if (!col) col="cyan";\n    var tp=all(T1Text).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,text,fillStyle:col, size,hidden:false};\n    }else {\n        new T1Text{x,y,text,fillStyle:col, size};  \n    }\n}\n\\drawLine(x,y,tx,ty,col) {\n    if (!col) col="white";\n    var tp=all(T1Line).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,tx,ty,col, hidden:false};\n    }else {\n        new T1Line{x,y,tx,ty,col};  \n    }\n}\n\\loadPage(page,arg){\n    all().die();\n    new page(arg);\n    die();\n}\n\n\\setVisible(v) {\n    _isInvisible=!v;\n}',"BodyActor.tonyu":'extends Actor;\nincludes T2Mod;\nnative Box2D;\n\n\\getWorld() {\n    if ($t2World) return $t2World;\n    $t2World=new T2World;\n    return $t2World;\n}\n\\onAppear() {\n    world=getWorld().world;\n    scale=getWorld().scale;\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var b2BodyDef = Box2D.Dynamics.b2BodyDef;\n    var b2Body = Box2D.Dynamics.b2Body;\n    var b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n    var b2Fixture = Box2D.Dynamics.b2Fixture;\n    var b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n    var b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n    \n    var fixDef = new b2FixtureDef;\n    fixDef.density = density || 1.0;\n    fixDef.friction = friction || 0.5;\n    fixDef.restitution = restitution || 0.2;\n    \n    var bodyDef = new b2BodyDef;\n    bodyDef.type = isStatic ? b2Body.b2_staticBody :\n    b2Body.b2_dynamicBody;\n    \n    bodyDef.position.x = x /scale;\n    bodyDef.position.y = y /scale;\n    shape=shape || (radius ? "circle" : "box");\n    var w=width,h=height;\n    if (!w) {\n        detectShape();\n        w=width*(scaleX||1);\n        h=height*(scaleY||scaleX||1);\n    }\n    if (shape=="box") {\n        if (!h) h=w;\n        fixDef.shape = new b2PolygonShape;\n        fixDef.shape.SetAsOrientedBox(w/2/scale, h/2/scale,\n        new b2Vec2(0,0),0);\n    } else {\n        radius=radius || w/2 || 16;\n        fixDef.shape = new b2CircleShape(\n        radius/scale\n        );\n        width=height=radius*2;\n    } \n    body=world.CreateBody(bodyDef);\n    body.CreateFixture(fixDef);\n    body.SetUserData(this);\n    body.SetAngle(rad(rotation));\n}\n\\allContact(klass) {\n    var res=[];\n    for (var c=world.GetContactList();c;c=c.GetNext()) {\n        if (c.IsTouching()) {\n            var a=c.GetFixtureA().GetBody().GetUserData();\n            var b=c.GetFixtureB().GetBody().GetUserData();\n            if (a===this) {\n                if (!klass || b===klass || b instanceof klass) {\n                    res.push(b);\n                }\n            } else if (b===this) {\n                if (!klass || a===klass || a instanceof klass) {\n                    res.push(a);\n                }\n            }\n        }\n    }\n    return res;\n}\n\\applyForce(fx,fy,px,py) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var scale=getWorld().scale;\n    var fps=60;\n    body.ApplyForce(new b2Vec2(fx ,fy),body.GetPosition());\n}\n\\applyImpulse(fx,fy,px,py) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var scale=getWorld().scale;\n    var fps=60;\n    body.ApplyImpulse(new b2Vec2(fx ,fy),body.GetPosition());\n}\n\n\\applyTorque(a) {\n    body.ApplyTorque(a);\n}\n\\moveBy(dx,dy) {\n    var pos=body.GetPosition();\n    pos.x+=dx/scale;\n    pos.y+=dy/scale;\n    body.SetPosition(pos);\n}\n\\contactTo(t) {\n    return allContact(t)[0];\n}\n\\die() {\n    super.die();\n    world.DestroyBody(body);\n}\n\\updatePos() {\n    if (!body) return;\n    var scale=getWorld().scale;\n    var pos=body.GetPosition();\n    x=pos.x*scale;\n    y=pos.y*scale;\n    rotation=deg(body.GetAngle());\n}\n\n',"Boot.tonyu":'extends Actor;\nnative $;\nnative TError;\nnative $LASTPOS;\nnative Key;\nnative Date;\nnative ImageList;\nnative Tonyu;\nnative SplashScreen;\nnative Math;\n\n\\initSprites() {\n    $Sprites=new Sprites();\n    $FrontSprites=new Sprites();\n    print ("Loading plugins..");\n    var a=asyncResult();\n    $currentProject.loadPlugins(a.receiver);\n    waitFor(a);\n    print ("Loading pats..");\n    var rs=$currentProject.getResource();\n    a=asyncResult();\n    ImageList.load( rs.images, a.receiver)\n    {baseDir:$currentProject.getDir()};\n    waitFor(a);\n    var r=a[0];\n    $Sprites.setImageList(r);\n    for (var name,val in r.names) {\n        Tonyu.setGlobal(name, val);\n    }\n    print ("Loading pats done.");\n    cvj=$("canvas");\n    if (Tonyu.noviceMode) {\n        $Screen=new ScaledCanvas{canvas:cvj, width:600, height:300};\n    } else {\n        $Screen=new ScaledCanvas{canvas:cvj, width:465, height:465};\n    }\n}\n\n\n\\initThread() {\n    $mainThreadGroup=thg=Tonyu.threadGroup();\n    var o=Tonyu.currentProject.getOptions();\n    var mainClassName=o.run.mainClass;\n    print("MainClass= "+mainClassName);\n    mainClass=Tonyu.getClass(mainClassName);\n    if (!mainClass) {\n        TError( mainClassName+" というクラスはありません", \n        "不明" ,0).raise();\n    }\n    Tonyu.runMode=true;\n    $currentThreadGroup=thg;\n    new mainClass();\n}\n\\stop() {\n    fireEvent("stop");\n}\ninitSprites();\n$InputDevice=new InputDevice;\n$InputDevice.initCanvasEvents(cvj);\ninitThread();\n\n$pat_fruits=30;\n$Keys=new Keys;\n$Math=Math;\n$consolePanel=new Panel{align:"center",x:465/2,y:465/2,width:465,height:465,zOrder:-10,layer:$FrontSprites};\n$consolePrintY=465-15;\n$panel=new Panel{align:"center",x:$screenWidth/2,y:$screenHeight/2,width:$screenWidth,height:$screenHeight,zOrder:-1,layer:$FrontSprites};\nif (typeof SplashScreen!="undefined") SplashScreen.hide();\ninitFPSParams();\n\nwhile (true) {\n    thg.steps();\n    $Keys.update();\n    $InputDevice.update();\n    $screenWidth=$Screen.width;\n    $screenHeight=$Screen.height;\n    \n    doDraw=now()<deadLine;\n    if (!doDraw && frameSkipped>=maxFrameSkip) {\n        doDraw=true;\n        resetDeadLine();\n    }\n    if (doDraw) { // フレームスキップの時は描画しない\n        $Screen.fillCanvas($Screen.buf[0]);\n        $Sprites.draw($Screen.buf[0]);\n        $FrontSprites.draw($Screen.buf[0]);\n        $Screen.draw();\n        fps_fpsCnt ++;\n        frameSkipped=0;\n    } else {\n        frameSkipped++;\n    }\n    $Sprites.checkHit();\n    fps_rpsCnt ++;\n    measureFps();\n    waitFrame(); // FPS制御\n    while(paused) {\n        waitFor(Tonyu.timeout(1)); \n        if (!paused) resetDeadLine();\n    }\n}\n\nnowait \\initFPSParams() {\n    // フレームレートの設定\n    _fps = 30;\n    maxframeSkip = 5;\n    // フレームレート制御でつかう変数 //\n    frameCnt = 0;\n    resetDeadLine();\n    $Boot = this;\n    lastMeasured=now();\n    fps_fps=fps_rps=fps_fpsCnt=fps_rpsCnt=0;\n}\nnowait \\now() {\n    return new Date().getTime();\n}\nnowait \\resetDeadLine() {\n    deadLine=now()+1000/_fps;\n    frameSkipped = 0;\n}\n\n\\waitFrame() {\n    var wt=deadLine-now();\n    if (wt<1) {\n        if (wt<-1000) resetDeadLine();\n        wt=1;\n    }\n    wt=floor(wt);\n    waitFor(Tonyu.timeout(wt));\n    deadLine+=1000/_fps;\n}\n\nnowait \\getFrameRate() {\n    return _fps;\n}\n\n// Tonyu1の$System.setFrameRate() //\nnowait \\setFrameRate(fps, maxFrameSkip) {\n    _fps = fps;\n    if (typeof maxFrameSkip!="number") maxFrameSkip=5;\n    this.maxFrameSkip = maxFrameSkip;\n    resetDeadLine();\n}\n\n// FPS（計測したフレームレート）を返す //\nnowait \\getMeasuredFps() {\n    return fps_fps;\n}\n\n// RPS（計測した実行レート）を返す //\nnowait \\getMeasuredRps() {\n    return fps_rps;\n}\n\nnowait \\measureFps() {\n    if (now()>lastMeasured+1000) {\n        fps_fps=fps_fpsCnt;\n        fps_rps=fps_rpsCnt;\n        fps_fpsCnt=0;\n        fps_rpsCnt=0;\n        lastMeasured=now();\n    }\n}\n\n',"DxChar.tonyu":"extends SpriteChar;\n\n\\new (xx,yy,pp,ff,sz,rt,al){\n    super(xx,yy,pp,ff);\n    scaleX=1;\n    if (sz) scaleX=sz;\n    angle=0;\n    if (rt) angle=rt;\n    alpha=255;\n    if (al) alpha=al;\n}\n\\draw(c) {\n    rotation=angle;\n    super.draw(c);\n}\n","EventMod.tonyu":"extends null;\n\n\\getEventHandlers(type) {\n    if (!_handlers) _handlers={};\n    if (!_handlers[type]) _handlers[type]=[];\n    return _handlers[type];\n}\n\\on(type, handler) {\n    getEventHandlers(type).push(handler);\n}\n\n\\fireEvent(type,args) {\n    if (!args) args=[];\n    for (var h in getEventHandlers(type)) {\n        h.apply(this,args);\n    }\n}\n","InputDevice.tonyu":'extends null;\nnative $;\nnative window;\nnative Tonyu;\n\\new() {\n    listeners=[];\n    touchEmu=true;\n}\n\\handleListeners() {\n    var l=listeners;\n    listeners=[];\n    while (l.length>0) { (l.shift())(); }\n}\n\\addOnetimeListener(l){\n    listeners.push(l);\n}\n\\initCanvasEvents(cvj) {\n    var cv=cvj[0];\n    $handleMouse=\\(e) {\n        var p=cvj.offset();\n        var mp={x:e.clientX-p.left, y:e.clientY-p.top};\n        mp=$Screen.canvas2buf(mp);\n        $mouseX=mp.x;\n        $mouseY=mp.y;\n        if (touchEmu) {\n            $touches[0].x=mp.x;\n            $touches[0].y=mp.y;\n        }\n        handleListeners();\n    };\n    $touches=[{},{},{},{},{}];\n    $touches.findById=\\(id) {\n        for (var j=0 ; j<$touches.length ; j++) {\n            if ($touches[j].identifier==id) {\n                return $touches[j];\n            }\n        }\n    };\n    $handleTouch=\\(e) {\n        touchEmu=false;\n        var p=cvj.offset();\n        e.preventDefault();\n        var ts=e.originalEvent.changedTouches;\n        for (var i =0 ; i<ts.length ; i++) {\n            var src=ts[i];\n            var dst=$touches.findById(src.identifier);\n            if (!dst) {\n                for (var j=0 ; j<$touches.length ; j++) {\n                    if (!$touches[j].touched) {\n                        dst=$touches[j];\n                        dst.identifier=src.identifier;\n                        break;\n                    }\n                }\n            }\n            if (dst) {\n                mp={x:src.pageX-p.left, y:src.pageY-p.top};\n                mp=$Screen.canvas2buf(mp);\n                dst.x=mp.x;\n                dst.y=mp.y;\n                if(!dst.touched) dst.touched=1;\n            }\n        }\n        $mouseX=$touches[0].x;\n        $mouseY=$touches[0].y;\n        handleListeners();\n    };\n    $handleTouchEnd=\\(e) {\n        var ts=e.originalEvent.changedTouches;\n        for (var i =0 ; i<ts.length ; i++) {\n            var src=ts[i];\n            var dst=$touches.findById(src.identifier);\n            if (dst) {\n                dst.touched=0;\n                dst.identifier=-1;\n            }\n        }\n        handleListeners();\n    };\n    var handleMouse=\\(e){$handleMouse(e);};\n    var handleTouch=\\(e){$handleTouch(e);};\n    var handleTouchEnd=\\(e){$handleTouchEnd(e);};\n    var d=$.data(cv,"events");\n    if (!d) {\n        $.data(cv,"events","true");\n        cvj.mousedown(handleMouse);\n        cvj.mousemove(handleMouse);\n        cvj.on("touchstart",handleTouch);\n        cvj.on("touchmove",handleTouch);\n        cvj.on("touchend",handleTouchEnd);\n    }\n}\n\n\\update() {\n    for (var i in $touches) {\n        if (i.touched>0) {i.touched++;}\n        if (i.touched==-1) i.touched=1;\n    }\n}',"Keys.tonyu":'extends TObject;\nnative String;\nnative $;\nnative document;\n//\\new () {this.main();}\nstats={};\ncodes={\n    left: 37 , up:38 , right: 39, down:40, space:32, enter:13,\n    shift:16, ctrl:17, alt:18, mouseleft: 1\n};\nfor (var i=65 ; i<65+26; i++) {\n    codes[String.fromCharCode(i).toLowerCase()]=i;\n}\nfor (var i=48 ; i<58; i++) {\n    codes[String.fromCharCode(i)]=i;\n}\nif (!$.data(document,"key_event")) {\n    $.data(document,"key_event",true);\n    $(document).keydown \\(e) {$Keys.keydown(e);};\n    $(document).keyup \\(e) {$Keys.keyup(e);};\n    $(document).mousedown \\(e) {\n        if ($InputDevice.touchEmu) {\n            $touches[0].touched=1;\n        }\n        $Keys.keydown{keyCode:1};\n    };\n    $(document).mouseup \\(e) {\n        if ($InputDevice.touchEmu) {\n            $touches[0].touched=0;\n        }\n        $Keys.keyup{keyCode:1};\n    };\n}\nfunction getkey(code) {\n    if (typeof code=="string") {\n        code=codes[code.toLowerCase()];\n    }\n    if (!code) return 0;\n    if (stats[code]==-1) return 0;\n    if (!stats[code]) stats[code]=0;\n    return stats[code];\n}\nfunction update() {\n    for (var i in stats) {\n        if (stats[i]>0) {stats[i]++;}\n        if (stats[i]==-1) stats[i]=1;\n    }\n}\n\\keydown(e) {\n    var s=stats[e.keyCode];\n    if (!s) {\n        stats[e.keyCode]=1;\n    }\n    $InputDevice.handleListeners();\n}\n\\keyup(e) {\n    stats[e.keyCode]=0;\n    $InputDevice.handleListeners();\n}',"MML.tonyu":'extends TObject;\nincludes MathMod;\nnative T;\n\nmmlBuf=[];\n\\play(mmls) {\n    mmlBuf.push(mmls);\n    if (!isPlaying()) {\n        playNext();\n    }\n}\n\\playNext() {\n    //print("play!", id(), bufferCount());\n    if (cTimeBase==null) cTimeBase=0;\n    if (m) {\n        cTimeBase+=m.currentTime;\n        //print(m.currentTime);\n    }\n    var mml=mmlBuf.shift();\n    if (!mml) {\n        m=null;\n        cTimeBase=0;\n        return;\n    }\n    mwav=$WaveTable.get(0,0).play();\n    m=T("mml", {mml}, mwav);\n    m.on("ended", playNext);\n    m.start();\n    $MMLS[id()]=this;\n}\n\\id() {\n    if (!_id) _id=rnd()+"";\n    return _id;\n}\n\\bufferCount() {\n    return mmlBuf.length;\n}\n\\isPlaying() {\n    return m;\n}\n\\currentTime() {\n    if (m) return m.currentTime+cTimeBase;\n    return -1;\n}\n\\stop() {\n    if (m) {\n        if (mwav) {\n            mwav.pause();\n            mwav.stop();\n        }\n        m.pause();\n        m.stop();\n        m=null;\n        mmlBuf=[];\n        //print("stop!", id(), bufferCount());\n        delete $MMLS[id()];\n    }\n}\n',"Map.tonyu":'extends Actor;\nnative Math;\nnative $;\n\\new (param){\n    sx=0;\n    sy=0;\n    super(param);\n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    mapObj=true;\n    mapTable = [];\n    mapOnTable = [];\n    for(var j=0;j<row;j++){\n        rows = [];\n        for(var i=0;i<col;i++){\n            rows.push(-1);\n        }\n        mapTable.push(rows);\n    }\n    for(var j=0;j<row;j++){\n        rows = [];\n        for(var i=0;i<col;i++){\n            rows.push(-1);\n        }\n        mapOnTable.push(rows);\n    }\n    /*for(var i=0;i<col;i++){\n        mapTable[i]=[];\n    }*/\n    initMap();\n}\n\\initMap(){\n    if(!mapData) return;\n    for(var i=0;i<row;i++){\n        for(var j=0;j<col;j++){\n            set(j,i,mapData[i][j]);\n        }\n    }\n    if(!mapOnData) return;\n    for(var i=0;i<row;i++){\n        for(var j=0;j<col;j++){\n            setOn(j,i,mapOnData[i][j]);\n        }\n    }\n}\n\\load(dataFile){\n    baseData=file("../maps/").rel(dataFile).obj();\n    if(!baseData) baseData=file(dataFile).obj();\n    mapTable=baseData[0];\n    mapData=mapTable;\n    row=mapTable.length;\n    col=mapTable[0].length;\n    mapOnTable=baseData[1];\n    mapOnData=mapOnTable;\n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    initMap();\n}\n\\set(setCol,setRow,p){\n    if(setCol>=col || setRow>=row || setCol<0 || setRow<0) return;\n    mapTable[setRow][setCol]=p;\n    //mapOnTable[setRow][setCol]=-1;\n    ctx=buf[0].getContext("2d");\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) {\n        ctx.clearRect(setCol*chipWidth,setRow*chipHeight,chipWidth,chipHeight);\n        return;\n    }\n    ctx.clearRect(setCol*chipWidth,setRow*chipHeight,chipWidth,chipHeight);\n    ctx.save();\n    ctx.drawImage(\n    pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n    setCol*chipWidth, setRow*chipHeight, chipWidth, chipHeight);\n    ctx.restore();\n}\n\\setOn(setCol,setRow,p){\n    if(setCol>=col || setRow>=row || setCol<0 || setRow<0) return;\n    set(setCol,setRow,mapTable[setRow][setCol]);\n    mapOnTable[setRow][setCol]=p;\n    ctx=buf[0].getContext("2d");\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) return;\n    ctx.save();\n    ctx.drawImage(\n    pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n    setCol*chipWidth, setRow*chipHeight, chipWidth, chipHeight);\n    ctx.restore();\n}\n\\setOnAt(setX,setY,p){\n    setOn(Math.floor(setX/chipWidth),Math.floor(setY/chipHeight),p);\n}\n\\setAt(setX,setY,p){\n    set(Math.floor(setX/chipWidth),Math.floor(setY/chipHeight),p);\n}\n\\get(getCol,getRow){\n    if(getCol<col && getRow<row && getCol>=0 && getRow>=0) return mapTable[getRow][getCol];\n    return -1;\n}\n\\getAt(getX,getY){\n    return get(Math.floor(getX/chipWidth),Math.floor(getY/chipHeight));\n}\n\\getOn(getCol,getRow){\n    if(getCol<col && getRow<row && getCol>=0 && getRow>=0) return mapOnTable[getRow][getCol];\n    return -1;\n}\n\\getOnAt(getX,getY){\n    return getOn(Math.floor(getX/chipWidth),Math.floor(getY/chipHeight));\n}\n\\scrollTo(scrollX,scrollY){\n    sx=-scrollX;\n    sy=-scrollY;\n}\n\\draw(ctx) {\n    pImg=buf[0];\n    ctx.save();\n    ctx.drawImage(\n    pImg, 0, 0,col*chipWidth, row*chipHeight,\n    sx, sy, col*chipWidth, row*chipHeight);\n    ctx.restore();\n}\n',"MapEditor.tonyu":'extends Actor;\nnative prompt;\nloadMode=false;\nprint("Load Data?: Y or N");\nwhile(true){\n    if(getkey("y")>0){\n        loadMode=true;\n        break;\n    }\n    if(getkey("n")>0){\n        loadMode=false;\n        break;\n    }\n    update();\n}\nif(loadMode){\n    fileName=prompt("Input json file (*.json)","map.json");\n    if(fileName){\n        mapDataFile=file("../maps/").rel(fileName);\n    }\n    if(mapDataFile.obj()){\n        baseData=mapDataFile.obj();\n    }else{\n        mapDataFile=file(fileName);\n        if(mapDataFile.obj()){\n            baseData=mapDataFile.obj();\n        }\n    }\n    if(baseData==undefined){\n        print("Load failed");\n        loadMode=false;\n    }else if(baseData[0] && baseData[1]){\n        mapData=baseData[0];\n        mapOnData=baseData[1];\n    }\n}\nupdate();\n//if(mapData){\n    /*\n    print("Load Data?: Y or N");\n    while(true){\n        if(getkey("y")==1){\n            loadMode=true;\n            break;\n        }\n        if(getkey("n")==1){\n            loadMode=false;\n            break;\n        }\n    }*/\n//}\nif(!loadMode){\n    row=prompt("input row");\n    update();\n    col=prompt("input col");\n    panel=new Panel{width:col*32,height:row*32};\n    panel.x=panel.width/2+10;\n    panel.y=panel.height/2;\n    panel.setFillStyle("cyan");\n    panel.fillRect(0,0,panel.width,panel.height);\n    $map=new Map{row,col,chipWidth:32,chipHeight:32};\n}else{\n    if(!mapOnData){\n        $map=new Map{row:mapData.length,col:mapData[0].length,chipWidth:32,chipHeight:32,mapData};\n    }else{\n        $map=new Map{row:mapData.length,col:mapData[0].length,chipWidth:32,chipHeight:32,mapData,mapOnData};\n    }\n    panel=new Panel{width:$map.col*32,height:$map.row*32,zOrder:100};\n    panel.x=panel.width/2;\n    panel.y=panel.height/2;\n    panel.setFillStyle("cyan");\n    panel.fillRect(0,0,panel.width,panel.height);\n}\n$mp=new Map{row:16,col:8,chipWidth:32,chipHeight:32};\ncounter=0;\nfor(var i=0;i<16;i++){\n    for(var j=0;j<8;j++){\n        $mp.set(j,i,$pat_mapchip+counter);\n        counter++;\n    }\n}\nmode="get";\nprevMode="set";\nmapp=0;\nmx=0;\nmy=0;\nchipX=0;\nchipY=0;\nx=$screenWidth-16;\ny=$screenHeight-16;\nwhile(true){\n    p=mapp;\n    if(getkey("e")==1){\n        $mp.scrollTo(1000,1000);\n        mode="erase";\n        print(mode+" mode");\n    }\n    if(getkey("s")==1){\n        $mp.scrollTo(1000,1000);\n        if(mode=="set"){\n            mode="setOn";\n        }else{\n            mode="set";\n        }\n        print(mode+" mode");\n    }\n    if(getkey("o")==1){\n        $mp.scrollTo(1000,1000);\n        mode="setOn";\n    }\n    if(getkey("g")==1){\n        if(mode!="get"){\n            prevMode=mode;\n            $mp.scrollTo(0,0);\n            mode="get";\n            chipX=0;\n            chipY=0;\n        }else{\n            $mp.scrollTo(1000,1000);\n            mode=prevMode;\n        }\n        print(mode+" mode");\n    }\n    if(getkey("p")==1){\n        //add\n        saveFileName=prompt("input json file(*.json)","map.json");\n        /*print("mapTable=[");\n        data="[";\n        for(var i=0;i<$map.row-1;i++){\n            var tmp=[];\n            tmp=$map.mapTable[i].concat(tmp);\n            print("["+tmp+"],");\n            data+="["+tmp+"],";\n        }\n        var tmp=[];\n        tmp=$map.mapTable[i].concat(tmp);\n        print("["+tmp+"]");\n        data+="["+tmp+"]";\n        print("];");\n        data+="]";*/\n        //add\n        saveDataFile=file("../maps/").rel(saveFileName);\n        data=[$map.mapTable,$map.mapOnTable];\n        //comment\n        //mapDataFile.obj(data);\n        //add\n        saveDataFile.obj(data);\n        print(saveFileName+" Saved");\n        //mapDataFile.obj.push($map.mapOnTable);\n    }\n    if(getkey("c")==1){\n        $mp.scrollTo(1000,1000);\n        mode="spuit";\n        print(mode+" mode");\n    }\n    if(mode!="get"){\n        if(getkey("left")>0) mx=mx+8;\n        if(getkey("right")>0) mx=mx-8;\n        if(getkey("up")>0) my=my+8;\n        if(getkey("down")>0) my=my-8;\n        $map.scrollTo(mx,my);\n    }else{\n        if(getkey("left")>0) chipX=chipX+8;\n        if(getkey("right")>0) chipX=chipX-8;\n        if(getkey("up")>0) chipY=chipY+8;\n        if(getkey("down")>0) chipY=chipY-8;\n        $mp.scrollTo(chipX,chipY);\n    }\n    panel.x=panel.width/2-mx;\n    panel.y=panel.height/2-my;\n    if(mode=="set" && getkey(1)>0){\n        $map.setAt($mouseX+mx,$mouseY+my,mapp);\n        $map.setOnAt($mouseX+mx,$mouseY+my,-1);\n    }else if(mode=="erase" && getkey(1)>0){\n        $map.setAt($mouseX+mx,$mouseY+my,-1);\n    }else if(mode=="get" && getkey(1)>0){\n        mapp=$mp.getAt($mouseX+chipX,$mouseY+chipY);\n        mode=prevMode;\n        $mp.scrollTo(1000,1000);\n        print(mode+" mode");\n        updateEx(10);\n    }else if(mode=="setOn" && getkey(1)>0){\n        $map.setOnAt($mouseX+mx,$mouseY+my,mapp);\n    }else if(mode=="spuit" && getkey(1)>0){\n        mapp=$map.getAt($mouseX+mx,$mouseY+my);\n        mode="set";\n        print(mode+" mode");\n        updateEx(10);\n    }\n    update();\n}',"MathMod.tonyu":'extends null;\nnative Math;\n\nnowait \\sin(d) {\n    return Math.sin(rad(d));\n}\nnowait \\cos(d) {\n    return Math.cos(rad(d));\n}\nnowait \\rad(d) {\n    return d/180*Math.PI;\n}\nnowait \\deg(d) {\n    return d/Math.PI*180;\n}\n\nnowait \\abs(v) {\n    return Math.abs(v);\n}\nnowait \\atan2(x,y) {\n    return deg(Math.atan2(x,y));\n}\nnowait \\floor(x) {\n    return Math.floor(x);\n}\nnowait \\angleDiff(a,b) {\n    var c;\n    a=floor(a);\n    b=floor(b);\n    if (a>=b) {\n        c=(a-b) % 360;\n        if (c>=180) c-=360;\n    } else {\n        c=-((b-a) % 360);\n        if (c<-180) c+=360;\n    }\n    return c;\n}\nnowait \\sqrt(t) {\n    return Math.sqrt(t);\n}\nnowait \\dist(dx,dy) {\n    if (typeof dx=="object") {\n        var t=dx;\n        dx=t.x-x;dy=t.y-y;\n    }\n    return sqrt(dx*dx+dy*dy);\n}\nnowait \\trunc(f) {\n    if(f>=0) return Math.floor(f);\n    else return Math.ceil(f);\n}\nnowait \\ceil(f){\n    return Math.ceil(f);\n}\n\nnowait \\rnd(r) {\n    if (typeof r=="number") {\n        return Math.floor(Math.random()*r);\n    }\n    return Math.random();\n}',"MediaPlayer.tonyu":"\n\\play() {\n    \n}\n\\stop() {\n    \n}\n\\playSE() {\n    \n}\n\\setDelay(){\n    \n}\n\\setVolume(){\n    \n}","NoviceActor.tonyu":"extends BaseActor;\nnative Tonyu;\n\n\\sleep(n) {\n    if(!n) n=1;\n    for(n;n>0;n--) update();\n}\n\\initSprite() {\n    if (!_sprite) {\n        _sprite=new BaseActor{owner:this};// Sprites.add{owner:this};\n        $Sprites.add(this);\n    }\n}\n\\say(text,size) {\n    if (!size) size=15;\n    initSprite();\n    _sprite._fukidashi={text:text, size:size, c:30};\n}\n\\sprite(x,y,p) {\n    go(x,y,p);\n}\n\\show(x,y,p) {\n    go(x,y,p);\n}\nnowait \\draw(ctx) {\n    _sprite.draw(ctx);\n}\n\\getCrashRect() {\n    return _sprite.getCrashRect();\n}\n\\go(x,y,p) {\n    initSprite();\n    _sprite.x=x;\n    _sprite.y=y;\n    if (p!=null) _sprite.p=p;\n    //update();\n}\n\\change(p) {\n    initSprite();\n    _sprite.p=p;\n}","Pad.tonyu":"extends Actor;\n\\new(opt) {\n    super(opt);\n    padImageP = $pat_inputPad;\n    jujiKey = new Actor{x:96+1, y:$screenHeight-96-1, p:padImageP+0,zOrder:-9,layer:$FrontSprites};\n    no1Key = new Actor{x:$screenWidth-96, y:$screenHeight-96, p:padImageP+1,zOrder:-9,layer:$FrontSprites};\n    jujiKey.show();\n    no1Key.show();\n    \n    jujiKeyPushU = new Actor{x:jujiKey.x, y:jujiKey.y-60, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushL = new Actor{x:jujiKey.x-60, y:jujiKey.y, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushR = new Actor{x:jujiKey.x+60, y:jujiKey.y, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushD = new Actor{x:jujiKey.x, y:jujiKey.y+60, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPush1 = new Actor{x:no1Key.x, y:no1Key.y, p:padImageP+2, scaleX:2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushU.hide();\n    jujiKeyPushL.hide();\n    jujiKeyPushR.hide();\n    jujiKeyPushD.hide();\n    jujiKeyPush1.hide();\n}\n\\die(){\n    jujiKey.die();\n    no1Key.die();\n    jujiKeyPushU.die();\n    jujiKeyPushL.die();\n    jujiKeyPushR.die();\n    jujiKeyPushD.die();\n    jujiKeyPush1.die();\n    super.die();\n}\nAPAD_DIAG_SIZE = 96;\n\\padUpdate() {\n    // 操作 //\n    keyPushL = 0;\n    keyPushR = 0;\n    keyPushU = 0;\n    keyPushD = 0;\n    keyPush1 = 0;\n    \n    padKeyNotapCnt ++;\n    for (var i=0; i<5; i++) { // タップ判定・マウス判定 //\n        var t = $touches[i];\n        if (t.touched) {\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-APAD_DIAG_SIZE/2, jujiKey.y-32-64, 64+APAD_DIAG_SIZE, 64)) keyPushU = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-APAD_DIAG_SIZE/2, jujiKey.y-32+64, 64+APAD_DIAG_SIZE, 64)) keyPushD = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-64, jujiKey.y-32-APAD_DIAG_SIZE/2, 64, 64+APAD_DIAG_SIZE)) keyPushL = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32+64, jujiKey.y-32-APAD_DIAG_SIZE/2, 64, 64+APAD_DIAG_SIZE)) keyPushR = 1;\n            if (isOnRectWH(t.x, t.y, no1Key.x-64, no1Key.y-64, 128, 128)) keyPush1 = 1;\n            padKeySW = 1;\n            padKeyNotapCnt = 0;\n        }\n    }\n    \n    // カウントアップ\n    if (keyPushL) keyCntL ++; else keyCntL = 0;\n    if (keyPushR) keyCntR ++; else keyCntR = 0;\n    if (keyPushU) keyCntU ++; else keyCntU = 0;\n    if (keyPushD) keyCntD ++; else keyCntD = 0;\n    if (keyPush1) keyCnt1 ++; else keyCnt1 = 0;\n    \n    // 表示\n    if (keyPushL) jujiKeyPushL.show(); else jujiKeyPushL.hide();\n    if (keyPushR) jujiKeyPushR.show(); else jujiKeyPushR.hide();\n    if (keyPushU) jujiKeyPushU.show(); else jujiKeyPushU.hide();\n    if (keyPushD) jujiKeyPushD.show(); else jujiKeyPushD.hide();\n    if (keyPush1) jujiKeyPush1.show(); else jujiKeyPush1.hide();\n    \n}\n\n\\getPadUp()    { return keyCntU; }\n\\getPadDown()  { return keyCntD; }\n\\getPadLeft()  { return keyCntL; }\n\\getPadRight() { return keyCntR; }\n\\getPadButton(i) {\n    var value;\n    if (i == 0) value = keyCnt1;\n    return value;\n}\n\n\\getUp()    { return keyCntU; }\n\\getDown()  { return keyCntD; }\n\\getLeft()  { return keyCntL; }\n\\getRight() { return keyCntR; }\n\\getButton(i) {\n    var value;\n    if (i == 0) value = keyCnt1;\n    return value;\n}\n\n// 範囲 //\n\\isOnRect(mx, my, rx, ry, rx2, ry2) {\n    return (rx <= mx && mx < rx2 && ry <= my && my < ry2);\n}\n\n// 範囲 //\n\\isOnRectWH(mx, my, rx, ry, rw, rh) {\n    return (rx <= mx && mx < rx+rw && ry <= my && my < ry+rh);\n}\n\nwhile(true) {\n    padUpdate();\n    update();\n}","Panel.tonyu":'extends Actor;\nnative $;\nnative Math;\nnative isNaN;\n\\new(opt){\n    super(opt);\n    this.width=width;\n    this.height=height;\n    if(align==null) align="center";\n    if(alpha==null) alpha=255;\n    if(_drawn==null) _drawn=false;\n    buf=$("<canvas>").attr{width,height};\n}\n\\setPanel(width,height){\n    this.width=width;\n    this.height=height;\n    buf=$("<canvas>").attr{width,height};\n}\n\\resize(width,height){\n    setPanel(width,height);\n}\n\\getContext(){\n    _drawn=true;\n    return buf[0].getContext("2d");\n}\n\\setFillStyle(color){\n    this.fillStyle=color;\n}\n\\fillRect(x,y,rectWidth,rectHeight){\n    ctx=getContext();\n    ctx.save();\n    //ctx.clearRect(0,0,this.width,this.height);\n    ctx.fillStyle=fillStyle;\n    ctx.fillRect(x,y,rectWidth,rectHeight);\n    ctx.restore();\n}\n\\fillText(text,x,y,size,align){\n    ctx=getContext();\n    ctx.save();\n    //ctx.clearRect(0,0,this.width,this.height);\n    ctx.textAlign = align;\n    ctx.fillStyle=fillStyle;\n    ctx.font=size+"px \'Courier New\'";\n    ctx.fillText(text,x,y);\n    ctx.restore();\n}\n\\clearRect(clearX,clearY,clearW,clearH){\n    ctx=getContext();\n    ctx.save();\n    ctx.clearRect(clearX,clearY,clearW,clearH);\n    ctx.restore();\n}\n\\getPixel(getX,getY){\n    if(typeof getX=="number" && !isNaN(getX) && \n    typeof getY=="number" && !isNaN(getY)){\n        ctx=getContext();\n        imagedata=ctx.getImageData(getX,getY,1,1);\n        colordata=[imagedata.data[0],imagedata.data[1],imagedata.data[2],imagedata.data[3]];\n        //print(imagedata.data);\n    }else{\n        colordata=[0,0,0,0];\n    }\n    return(colordata);\n}\n\\scroll(scrollX,scrollY){\n    ctx=getContext();\n    ctx.save();\n    imagedata=ctx.getImageData(0,0,this.width,this.height);\n    clearRect(0,0,width,height);\n    ctx.putImageData(imagedata,-scrollX,-scrollY);\n    ctx.restore();\n}\n\\draw(ctx){\n    if(_drawn){\n        pImg=buf[0];\n        ctx.save();\n        if(align=="left"){\n            ctx.translate(x+width/2,y+height/2);\n        }else if(align=="center"){\n            ctx.translate(x,y);\n        }else if(align=="right"){\n            ctx.translate(x-width/2,y-height/2);\n        }\n        if(this.rotation!=0){\n            ctx.rotate(this.rotation/180*Math.PI);\n        }else{\n            ctx.rotate(this.rotate/180*Math.PI);\n        }\n        ctx.globalAlpha=this.alpha/255;\n        ctx.drawImage(\n        pImg, 0, 0,width,height,\n        -width/2, -height/2, width ,height);\n        ctx.restore();\n    }\n}',"PlainChar.tonyu":'extends Actor;\n\nnative Tonyu;\nnative Math;\n\\new(x,y,p) {\n    if (Tonyu.runMode) {\n        var thg=currentThreadGroup();\n        if (thg) _th=thg.addObj(this,"tMain");\n        initSprite();\n    }\n    if (typeof x=="object") Tonyu.extend(this,x); \n    else if (typeof x=="number") {\n        this.x=x;\n        this.y=y;\n        this.p=p;\n    }\n}\n\\draw(c) {\n    onDraw();\n    if (_isInvisible) return;\n    super.draw(c);\n}\n\\setVisible(v) {\n    _isInvisible=!v;\n}\n\\onDraw() {\n    \n}\n\\update() {\n    onUpdate();\n    super.update();\n}\n\\onUpdate() {\n    \n}\n\\initSprite() {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    onAppear();\n}\n\\tMain() {\n    main();\n    die();\n}\n\\color(r,g,b) {\n    return "rgb("+[r,g,b].join(",")+")";\n}\n\\drawText(x,y,text,col,size) {\n    if ($debug) return;\n    if (!size) size=15;\n    if (!col) col="cyan";\n    var tp=all(T1Text).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,text,fillStyle:col, size,hidden:false};\n    }else {\n        new T1Text{x,y,text,fillStyle:col, size};  \n    }\n}\n\\drawLine(x,y,tx,ty,col) {\n    if (!col) col="white";\n    var tp=all(T1Line).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,tx,ty,col};\n    }else {\n        new T1Line{x,y,tx,ty,col};  \n    }\n}\n\\appear(t) {\n    return t;\n}\n\\trunc(f) {\n    return Math.trunc(f);\n}\n\\loadPage(page,arg){\n    all().die();\n    new page(arg);\n    die();\n}',"PlayMod.tonyu":'extends BaseActor;\nnowait \\initMML() {\n    if (mmlInited) return;\n    mmlInited=true;\n    $currentProject.requestPlugin("timbre");\n    if (!$MMLS) {\n       $MMLS={};\n       $WaveTable=new WaveTable;\n       $Boot.on("stop", releaseMML);\n    }\n    on("die") \\() { play().stop(); };\n}\nnowait \\releaseMML() {\n    if ($MMLS) {\n       for (var k,v in $MMLS) {\n          v.stop();\n       }\n       $MMLS=null;\n    } \n    if ($WaveTable) {\n       $WaveTable.stop();\n       $WaveTable=null;\n    }\n}\n\\play() {\n    initMML();\n    if (!_mml) _mml=new MML;\n    if (isDead() || arguments.length==0) return _mml;\n    var mmls=[];\n    for (var i=0; i<arguments.length; i++) {\n        mmls.push(arguments[i]);\n    }\n    _mml.play(mmls);\n    while (_mml.bufferCount()>2) {\n        update();\n    }\n    return _mml;\n}\nnowait \\playSE() {\n    initMML();\n    var mml=new MML;\n    var mmls=[];\n    for (var i=0; i<arguments.length; i++) {\n        mmls.push(arguments[i]);\n    }\n    mml.play(mmls);\n    return mml;\n}\n',"ScaledCanvas.tonyu":'extends Actor;\nnative $;\nnative Math;\n\n// canvas:phisical  buf: logical\n\\new (opt) {\n    extend(opt);\n    // canvas/ width,height\n    resize(width, height);\n    cw=canvas.width();\n    ch=canvas.height();\n    cctx=canvas[0].getContext("2d");\n    this.color="rgb(20,80,180)";\n    sx=0;\n    sy=0;\n    isDrawGrid=$Sprites.isDrawGrid;\n}\n\\resize(width,height) {\n    this.width=width;\n    this.height=height;\n    buf=$("<canvas>").attr{width,height};\n    ctx=buf[0].getContext("2d");  \n    $screenWidth=width;\n    $screenHeight=height;\n    if($panel){\n        $panel.setPanel($screenWidth,$screenHeight);\n    }\n}\n\\shouldDraw1x1(srcw,srch,dstw,dsth) {\n    // srcw=465 -> dstw=460...665\n    var larger=200;\n    var smaller=5;\n    return srcw-smaller<=dstw && dstw<=srcw+larger &&\n    srch-smaller<=dsth && dsth<=srch+larger;\n}\n\\draw() {\n    cw=canvas.width();\n    ch=canvas.height();\n    var calcw=ch/height*width; // calch=ch\n    var calch=cw/width*height; // calcw=cw\n    if (calch>ch) calch=ch;\n    if (calcw>cw) calcw=cw;\n    cctx.clearRect(0,0,cw,ch);\n    if (shouldDraw1x1(width,height,calcw,calch)) {\n        calcw=width;calch=height;\n    }\n    var marginw=Math.floor((cw-calcw)/2);\n    var marginh=Math.floor((ch-calch)/2);\n    cctx.drawImage(buf[0],\n    0,0,width, height, \n    marginw,marginh,calcw, calch );\n}\n\\canvas2buf(point) {\n    var calcw=ch/height*width; // calch=ch\n    var calch=cw/width*height; // calcw=cw\n    if (calch>ch) calch=ch;\n    if (calcw>cw) calcw=cw;\n    if (shouldDraw1x1(width,height,calcw,calch)) {\n        calcw=width;calch=height;\n    }\n    var marginw=Math.floor((cw-calcw)/2);\n    var marginh=Math.floor((ch-calch)/2);\n    \n    return {x: (point.x-marginw)/calcw*width, \n    y: (point.y-marginh)/calch*height};\n}\n\\setBGColor(color){\n    this.color=color;\n}\n\\fillCanvas(cv){\n    var ctx=cv.getContext("2d");\n    ctx.save();\n    ctx.fillStyle=$Screen.color;\n    ctx.fillStyle=color;\n    ctx.fillRect(0,0,cv.width,cv.height);\n    if (isDrawGrid) drawGrid(cv);\n    ctx.restore();\n}\n\\scrollTo(scrollX,scrollY){\n    /*for(o in all()){\n        //print(o.mapObj);\n        if(o.mapObj){\n            o.scrollTo(o.sx+scrollX,o.sy+scrollY);\n        }else if(o.x!=undefined && o.y!=undefined){\n            o.x+=scrollX;\n            o.y+=scrollY;\n        }\n    }*/\n    //sx=scrollX;\n    //sy=scrollY;\n    $Sprites.scrollTo(scrollX,scrollY);\n}',"SecretChar.tonyu":"extends PlainChar;\n\n\\draw(c) {\n    \n}","SpriteChar.tonyu":"extends PlainChar;\n\n\\new(x,y,p,f) {\n    super(x,y,p);\n    this.f=f;\n    if (!this.x) this.x=0;\n    if (!this.y) this.y=0;\n    if (!this.p) this.p=0;\n}\n\\draw(c) {\n    if (f) {\n        if (!scaleY) scaleY=scaleX;\n        scaleX*=-1;\n    }\n    super.draw(c);\n    if (f) scaleX*=-1;\n}","Sprites.tonyu":'extends Actor;\nnative Tonyu;\n\\new() {\n    sprites=[];\n    imageList=[];\n    hitWatchers=[];\n    isDrawGrid=Tonyu.noviceMode;\n    sx=0;\n    sy=0;\n    objId=0;\n}\nfunction add(s) {\n    if (s.__addedToSprites) return;\n    sprites.push(s);\n    if(s.__genId==null){\n        s.__genId=objId;\n        objId++;\n    }\n    s.__addedToSprites=this;\n    return s;\n}\nfunction remove(s) {\n    var idx=sprites.indexOf(s);\n    if (idx<0) return;\n    sprites.splice(idx,1);\n    delete s.__addedToSprites;\n}\nfunction clear() {sprites.splice(0,sprites.length);}\nfunction compOrder(obj1, obj2){\n    var val1=obj1.zOrder;\n    var val2=obj2.zOrder;\n    if(val1>val2){\n        return -1;\n    }else if(val1<val2){\n        return 1;\n    }else if(val1==val2){\n        if(obj1.__genId>obj2.__genId){\n            return 1;\n        }else{\n            return -1;\n        }\n        return 0;\n    }\n}\nfunction draw(cv) {\n    var ctx=cv.getContext("2d");\n    ctx.save();\n    /*\n    ctx.fillStyle=$Screen.color;\n    ctx.fillRect(0,0,cv.width,cv.height);\n    if (isDrawGrid) drawGrid(cv);\n    */\n    var orderArray=[];\n    orderArray=orderArray.concat(sprites);\n    orderArray.sort(compOrder);\n    ctx.translate(-sx,-sy);\n    orderArray.forEach(\\(s){\n        s.draw(ctx);\n    });\n    ctx.restore();\n}\nfunction checkHit() {\n    hitWatchers.forEach(function (w) {\n        sprites.forEach(function (a) {\n            //console.log("a:",  a.owner);\n            var a_owner=a;//a.owner|| a;\n            if (! (a_owner instanceof w.A)) return;\n            sprites.forEach(function (b) {\n                var b_owner=b;//b.owner|| b;\n                if (a===b) return;\n                if (! (b_owner instanceof w.B)) return;\n                //console.log("b:",  b.owner);\n                if (a.crashTo1(b)) {\n                    //console.log("hit", a.owner, b.owner);\n                    w.h(a_owner,b_owner);\n                }\n            });\n        });\n    });\n}\nfunction watchHit(typeA, typeB, onHit) {\n    var p={A: typeA, B:typeB, h:onHit};\n    //console.log(p);\n    hitWatchers.push(p);\n}\nfunction drawGrid(c) {\n    var ctx=c.getContext("2d");\n    ctx.textBaseline="top";\n    ctx.save();\n    ctx.strokeStyle="rgb(40,100,200)";\n    for (var i=0 ; i<c.width ; i+=10) {\n        ctx.beginPath();\n        ctx.lineWidth=(i % 100 ==0 ? 4 : 1);\n        ctx.moveTo(i,0);\n        ctx.lineTo(i,c.height);\n        ctx.closePath();\n        ctx.stroke();\n    }\n    \n    for (var i=0 ; i<c.height ; i+=10) {\n        ctx.beginPath();\n        ctx.lineWidth=(i % 100 ==0 ? 4 : 1);\n        ctx.moveTo(0,i);\n        ctx.lineTo(c.width,i);\n        ctx.closePath();\n        ctx.stroke();\n    }\n    ctx.fillStyle="white";\n    ctx.font="15px monospaced";\n    for (var i=100 ; i<c.width ; i+=100) {\n        ctx.fillText(i, i,0);\n    }\n    for (var i=100 ; i<c.height ; i+=100) {\n        ctx.fillText(i, 0,i);\n    }\n    ctx.restore();\n}\nfunction setImageList(il) {\n    imageList=il;\n}\nfunction getImageList() {\n    return imageList;\n}\nfunction scrollTo(scrollX,scrollY){\n    sx=scrollX;\n    sy=scrollY;\n}',"T1Line.tonyu":"extends Actor;\n\\draw(ctx) {\n    if (hidden) return;\n    \n    ctx.strokeStyle=col;\n    ctx.beginPath();\n    ctx.moveTo(x,y);\n    ctx.lineTo(tx,ty);\n    ctx.stroke();\n    hidden=true;\n}\n","T1Map.tonyu":'extends Map;\nnative Tonyu;\nnative $;\n\n\\setBGColor(c) {\n    $Screen.setBGColor(c);\n}\n\\load(fileName) {\n    /*\n    o={\n        "chipWidth":"32","chipHeight":"32",\n        "pTable":[{name:"$pat_aaa", p:10}, {name:"$pat_bbb","p":25} ],\n        "baseData":[\n        [//map\n        [0,6],[0,5],[1,3],\n        [1,3],[1,2],[0,5]\n        ],\n        [//mapOn\n        [-1,-1],[1,4],[0,2],\n        [-1,-1],[-1,-1],[1,8]\n        ]\n        ]\n    }\n    */\n    var f=file("../maps/").rel(fileName);\n    var o=f.obj();\n    chipWidth=o.chipWidth;\n    chipHeight=o.chipHeight;\n    baseData=o.baseData;\n    mapTable=conv(baseData[0],o.pTable);\n    mapData=mapTable;\n    row=mapTable.length;\n    col=mapTable[0].length;\n    mapOnTable=conv(baseData[1],o.pTable);\n    mapOnData=mapOnTable;\n    \n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    initMap();   \n}\n\\conv(mat, tbl) {\n    var res=[];\n    mat.forEach \\(row) {\n        var rrow=[];\n        res.push(rrow);\n        row.forEach \\(dat) {// dat:[0,20]\n            var t=tbl[dat[0]];\n            if (t) rrow.push(Tonyu.globals[t.name]+dat[1]);\n            else rrow.push(dat[1]);\n        };\n    };\n    return res;\n}',"T1Page.tonyu":"extends PlainChar;\n\n\\initGlobals() {\n    $chars=$Sprites.sprites;\n    $Boot.setFrameRate(60);\n    $clBlack=color(0,0,0);\n    $clRed=color(255,0,0);\n    $clGreen=color(0,255,0);\n    $clYellow=color(255,255,0);\n    $clBlue=color(0,0,255);\n    $clPink=color(255,0,255);\n    $clAqua=color(0,255,255);\n    $clWhite=color(255,255,255);\n    $mplayer=new MediaPlayer;\n}","T1Text.tonyu":"extends Actor;\n\\draw(c) {\n    if (hidden) return;\n    c.font=size+\"px 'ＭＳ Ｐゴシック'\";\n    \n    super.draw(c);\n    hidden=true;\n}\n","T2Body.tonyu":"extends BodyActor;\n","T2Mod.tonyu":"native Box2D;\n\n\\bvec(tx,ty) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    return new b2Vec2(tx/scale,ty/scale);  \n}","T2World.tonyu":'extends Actor;\n\nincludes T2Mod;\n\nnative Box2D;\nnative Tonyu;\n\\onAppear() {\n    $currentProject.requestPlugin("box2d");  \n    initWorld();\n}\nloop();\n\n\n\\initWorld() {\n    gravity=gravity || 9.8;\n    gravityX=gravityX || 0;\n    var b2World = Box2D.Dynamics.b2World;\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    scale=scale || 32;\n    world = new b2World(\n    new b2Vec2(gravityX, gravity)    //gravity\n    ,  true                 //allow sleep\n    );\n    $t2World=this;\n    $Boot.on("stop",releaseWorld);\n    on("die",releaseWorld);\n}\n\\releaseWorld() {\n    if ($t2World===this) $t2World=null;\n}\n\n\\loop() {\n    while(true) {\n        world.Step(\n        1 / $Boot.getFrameRate()  //frame-rate\n        ,  10       //velocity iterations\n        ,  10       //position iterations\n        );\n        world.DrawDebugData();\n        world.ClearForces();\n        updatePos();\n        update();\n    }\n}\n\\updatePos() {\n    for (var b=world.GetBodyList();b;b=b.GetNext()) {\n        var d=b.GetUserData();\n        if(d) d.updatePos();\n    }\n}\n',"TObject.tonyu":'extends null;\nnative Tonyu;\n\\new (options) {\n    if (typeof options=="object") extend(options);\n    this.main();\n}\nnowait \\extend(obj) {\n    return Tonyu.extend(this,obj);\n}',"TQuery.tonyu":'extends TObject;\nincludes MathMod;\n\\new () {\n    length=0;\n}\n\\tonyuIterator(arity) {\n    var res={};\n    res.i=0;\n    if (arity==1) {\n        res.next=function () {\n            if (res.i>=this.length) return false;\n            res[0]=this[res.i];\n            res.i++;\n            return true;\n        };\n    } else {\n        res.next=function () {\n            if (res.i>=this.length) return false;\n            res[0]=res.i;\n            res[1]=this[res.i];\n            res.i++;\n            return true;\n        };\n    }\n    return res;\n}\n\\attr() {\n    var values;\n    if (length==0) return;\n    if (arguments.length==1 && typeof arguments[0]=="string") {\n        return this[0][arguments[0]];\n    }\n    if (arguments.length>=2) {\n        values={};\n        for (var i=0 ; i<arguments.length-1 ;i+=2) {\n            values[arguments[i]]=arguments[i+1];\n        }\n    } else {\n        values=arguments[0];\n    }\n    if (values) {\n        for (var e in this) {\n            e.extend( values);\n        }\n    }\n}\n\\genKeyfunc(key) {\n    if (typeof key!="function") {\n        return \\(o) {return o[key];};\n    } else {\n        return key;\n    }\n}\n\\maxs(key) {\n    var f=genKeyfunc(key);\n    var res,reso=new TQuery;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v>=res) {\n            if (v>res) reso=new TQuery;\n            reso.push(o);\n            res=v;\n        }\n    }\n    return reso;\n}\n\\mins(key) {\n    var f=genKeyfunc(key);\n    var res,reso=new TQuery;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v<=res) {\n            if (v<res) reso=new TQuery;\n            reso.push(o);\n            res=v;\n        }\n    }\n    return reso;\n}\n\\minObj(key) {\n    return mins(key)[0];\n}\n\\maxObj(key) {\n    return maxs(key)[0];\n}\n\\nearests(x,y) {\n    if (typeof x=="object") {y=x.y;x=x.x;}\n    return mins \\(o) {\n        return dist(o.x-x,o.y-y);\n    };\n}\n\\nearest(x,y) {\n    return nearests(x,y)[0];\n}\n\\withins(xo,yd,d) {\n    var x,y;\n    if (typeof xo=="object") {\n        x=xo.x;y=xo.y;d=yd;\n    } else {\n        x=xo;y=yd;\n    }\n    return find \\(o) {\n        return dist(o.x-x,o.y-y)<=d;\n    };\n}\n\\within(xo,yd,d) {\n    return withins(xo,yd,d).nearest();\n}\n\n\\max(key) {\n    var f=genKeyfunc(key);\n    var res;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v>res) res=v;\n    }\n    return res;\n}\n\\min(key) {\n    var f=genKeyfunc(key);\n    var res;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v<res) res=v;\n    }\n    return res;\n}\n\\push(e) {\n    this[length]=e;\n    length++;\n}\n\\size() {return length;}\n\\find(f) {\n    var no=new TQuery;\n    for (var o in this) {\n        if (f(o)) no.push(o);\n    }\n    return no;\n} \n\\apply(name, args) {\n    var res;\n    if (!args) args=[];\n    for (var o in this) {\n        var f=o[name];\n        if (typeof f=="function") {\n            res=f.apply(o, args);\n        }\n    }\n    return res;\n}\n// \\alive => find \\(o) => !o.isDead()  //  (in future)\n\\alive() {\n    return find \\(o) {\n        return !o.isDead();\n    };\n}\n\\die() {\n    var a=alive();\n    if (a.length==0) return false;\n    a.apply("die");\n    return true;\n}\n\n\\klass(k) {\n    return find \\(o) { return o instanceof k; };\n}',"TextChar.tonyu":'extends PlainChar;\nnative TextRect;\n\n\\new (xx,yy,t,c,s){\n    super(xx,yy);\n    text="";\n    col=$clWhite;\n    size=20;\n    if (!this.x) this.x=0;\n    if (!this.y) this.y=0;\n    if (t) text=t;\n    if (c) fillStyle=c;\n    if (s) size=s;\n}\n\\draw(ctx) {\n    if (!size) size=15;\n    if (!align) align="left";\n    if (!fillStyle) fillStyle="white";\n    ctx.fillStyle=fillStyle;\n    ctx.globalAlpha=this.alpha/255;\n    ctx.font=size+"px \'ＭＳ Ｐゴシック\'";\n    var rect=TextRect.draw(ctx, text, x, y, size, align , "fill");\n    width=rect.w;\n    height=rect.h;\n    \n    //    fillStyle=col;\n    //super.draw(ctx);\n}',"TextRectMod.tonyu":'extends null;\n\nnowait function drawTextRect(ctx, text, x, topY, h, align , type) {\n    if (!align) align="center";\n    ctx.textBaseline="top";\n    setFontSize(ctx, h);\n    var met=ctx.measureText(text);\n    var res={y:topY, w: met.width, h:h};\n    var t=align.substring(0,1).toLowerCase();\n    if (t=="l") res.x=x;\n    else if (t=="r") res.x=x-met.width;\n    else if (t=="c") res.x=x-met.width/2;\n    if (type=="fill") ctx.fillText(text, res.x,topY);\n    if (type=="stroke") ctx.strokeText(text, res.x,topY);\n    return res;\n}\nnowait function setFontSize(ctx,sz) {\n    var post=ctx.font.replace(/^[0-9\\.]+/,"");\n    ctx.font=sz+post;\n}\n\nnowait function fukidashi(ctx, text, x, y, sz) {\n    var align="c";\n    var theight=20;\n    var margin=5;\n    var r=drawTextRect(ctx, text, x,y-theight-margin-sz, sz, align);\n    ctx.beginPath();\n    ctx.moveTo(x , y);\n    ctx.lineTo(x+margin , y-theight);\n    ctx.lineTo(x+r.w/2+margin , y-theight);\n    ctx.lineTo(x+r.w/2+margin , y-theight-r.h-margin*2);\n    ctx.lineTo(x-r.w/2-margin , y-theight-r.h-margin*2);\n    ctx.lineTo(x-r.w/2-margin , y-theight);\n    ctx.lineTo(x-margin , y-theight);\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke();\n    \n    var fs=ctx.fillStyle;\n    ctx.fillStyle=ctx.strokeStyle;\n    drawTextRect(ctx, text, x, y-theight-margin-sz, sz, align, "fill");\n    ctx.fillStyle=fs;\n}\n\n',"WaveTable.tonyu":'extends TObject;\nnative T;\n\nwav={};\nenv={};\n\\setWav(num, synth) {\n    wav[num]=synth;\n}\n\\setEnv(num, synth) {\n    env[num]=synth;\n}\n\\get(w,e) {\n    var synth=T("OscGen") {osc:wav[w], env:env[e], mul:0.25};\n    return synth;\n}\n\\stop() {\n    /*for (var k,v in tbl) {\n        v.pause();\n        v.stop();\n    }*/\n}\n\nif (typeof T!=="undefined") {\n    //env=T("adsr", {a:0,d:200,s:0.5,r:10});\n    env = T("env",{table:[1, [0.6, 50], [0, 100]], releaseNode:2});\n    setEnv(0, env);\n    setWav(0, T("pulse"));\n    //    synth=T("OscGen") {wave:"pulse", env, mul:0.25};\n    //set(0,synth);    \n}\n',"js/":'{"concat.js":{"lastUpdate":1428228330024}}',"js/concat.js":'Tonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.EventMod=Tonyu.klass([],{\n  main :function _trc_func_1000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_1000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getEventHandlers :function _trc_func_1000017_2(type) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=1000048;\n    if (! _this._handlers) {\n      //$LASTPOS=1000064;\n      _this._handlers={};\n    }\n    //$LASTPOS=1000083;\n    if (! _this._handlers[type]) {\n      //$LASTPOS=1000105;\n      _this._handlers[type]=[];\n    }\n    return _this._handlers[type];\n  },\n  fiber$getEventHandlers :function _trc_func_1000017_3(_thread,type) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=1000048;\n    if (! _this._handlers) {\n      //$LASTPOS=1000064;\n      _this._handlers={};\n    }\n    //$LASTPOS=1000083;\n    if (! _this._handlers[type]) {\n      //$LASTPOS=1000105;\n      _this._handlers[type]=[];\n    }\n    _thread.retVal=_this._handlers[type];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  on :function _trc_func_1000158_4(type,handler) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=1000184;\n    _this.getEventHandlers(type).push(handler);\n  },\n  fiber$on :function _trc_func_1000158_5(_thread,type,handler) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=1000184;\n    _this.getEventHandlers(type).push(handler);\n    \n    _thread.retVal=_this;return;\n  },\n  fireEvent :function _trc_func_1000228_6(type,args) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var h;\n    var _it_1;\n    \n    //$LASTPOS=1000257;\n    if (! args) {\n      //$LASTPOS=1000268;\n      args=[];\n    }\n    //$LASTPOS=1000282;\n    _it_1=Tonyu.iterator(_this.getEventHandlers(type),1);\n    while(_it_1.next()) {\n      h=_it_1[0];\n      \n      //$LASTPOS=1000331;\n      h.apply(_this,args);\n      \n    }\n  },\n  fiber$fireEvent :function _trc_func_1000228_7(_thread,type,args) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var h;\n    var _it_1;\n    \n    //$LASTPOS=1000257;\n    if (! args) {\n      //$LASTPOS=1000268;\n      args=[];\n    }\n    //$LASTPOS=1000282;\n    _it_1=Tonyu.iterator(_this.getEventHandlers(type),1);\n    while(_it_1.next()) {\n      h=_it_1[0];\n      \n      //$LASTPOS=1000331;\n      h.apply(_this,args);\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.EventMod,{"fullName":"kernel.EventMod","namespace":"kernel","shortName":"EventMod","decls":{"methods":{"main":{"nowait":false},"getEventHandlers":{"nowait":false},"on":{"nowait":false},"fireEvent":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.InputDevice=Tonyu.klass([],{\n  main :function _trc_func_2000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_2000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_2000057_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=2000071;\n    _this.listeners=[];\n    //$LASTPOS=2000090;\n    _this.touchEmu=true;\n  },\n  handleListeners :function _trc_func_2000109_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var l;\n    \n    //$LASTPOS=2000135;\n    l = _this.listeners;\n    //$LASTPOS=2000157;\n    _this.listeners=[];\n    //$LASTPOS=2000176;\n    while (l.length>0) {\n      //$LASTPOS=2000197;\n      (l.shift())();\n      \n    }\n  },\n  fiber$handleListeners :function _trc_func_2000109_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var l;\n    \n    //$LASTPOS=2000135;\n    l = _this.listeners;\n    //$LASTPOS=2000157;\n    _this.listeners=[];\n    //$LASTPOS=2000176;\n    while (l.length>0) {\n      //$LASTPOS=2000197;\n      (l.shift())();\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  addOnetimeListener :function _trc_func_2000218_5(l) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=2000247;\n    _this.listeners.push(l);\n  },\n  fiber$addOnetimeListener :function _trc_func_2000218_6(_thread,l) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=2000247;\n    _this.listeners.push(l);\n    \n    _thread.retVal=_this;return;\n  },\n  initCanvasEvents :function _trc_func_2000270_7(cvj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var cv;\n    var handleMouse;\n    var handleTouch;\n    var handleTouchEnd;\n    var d;\n    \n    //$LASTPOS=2000300;\n    cv = cvj[0];\n    //$LASTPOS=2000320;\n    Tonyu.globals.$handleMouse=function (e) {\n      var p;\n      var mp;\n      \n      //$LASTPOS=2000349;\n      p = cvj.offset();\n      //$LASTPOS=2000378;\n      mp = {x: e.clientX-p.left,y: e.clientY-p.top};\n      //$LASTPOS=2000435;\n      mp=Tonyu.globals.$Screen.canvas2buf(mp);\n      //$LASTPOS=2000471;\n      Tonyu.globals.$mouseX=mp.x;\n      //$LASTPOS=2000494;\n      Tonyu.globals.$mouseY=mp.y;\n      //$LASTPOS=2000517;\n      if (_this.touchEmu) {\n        //$LASTPOS=2000546;\n        Tonyu.globals.$touches[0].x=mp.x;\n        //$LASTPOS=2000579;\n        Tonyu.globals.$touches[0].y=mp.y;\n        \n      }\n      //$LASTPOS=2000619;\n      _this.handleListeners();\n    };\n    //$LASTPOS=2000651;\n    Tonyu.globals.$touches=[{},{},{},{},{}];\n    //$LASTPOS=2000683;\n    Tonyu.globals.$touches.findById=function (id) {\n      var j;\n      \n      //$LASTPOS=2000718;\n      //$LASTPOS=2000723;\n      j = 0;\n      while(j<Tonyu.globals.$touches.length) {\n        {\n          //$LASTPOS=2000773;\n          if (Tonyu.globals.$touches[j].identifier==id) {\n            return Tonyu.globals.$touches[j];\n            \n          }\n        }\n        j++;\n      }\n    };\n    //$LASTPOS=2000883;\n    Tonyu.globals.$handleTouch=function (e) {\n      var p;\n      var ts;\n      var i;\n      var src;\n      var dst;\n      var j;\n      \n      //$LASTPOS=2000912;\n      _this.touchEmu=false;\n      //$LASTPOS=2000937;\n      p = cvj.offset();\n      //$LASTPOS=2000966;\n      e.preventDefault();\n      //$LASTPOS=2000995;\n      ts = e.originalEvent.changedTouches;\n      //$LASTPOS=2001043;\n      //$LASTPOS=2001048;\n      i = 0;\n      while(i<ts.length) {\n        {\n          //$LASTPOS=2001093;\n          src = ts[i];\n          //$LASTPOS=2001121;\n          dst = Tonyu.globals.$touches.findById(src.identifier);\n          //$LASTPOS=2001177;\n          if (! dst) {\n            //$LASTPOS=2001206;\n            //$LASTPOS=2001211;\n            j = 0;\n            while(j<Tonyu.globals.$touches.length) {\n              {\n                //$LASTPOS=2001269;\n                if (! Tonyu.globals.$touches[j].touched) {\n                  //$LASTPOS=2001322;\n                  dst=Tonyu.globals.$touches[j];\n                  //$LASTPOS=2001364;\n                  dst.identifier=src.identifier;\n                  break;\n                  \n                  \n                }\n              }\n              j++;\n            }\n            \n          }\n          //$LASTPOS=2001497;\n          if (dst) {\n            //$LASTPOS=2001525;\n            _this.mp={x: src.pageX-p.left,y: src.pageY-p.top};\n            //$LASTPOS=2001586;\n            _this.mp=Tonyu.globals.$Screen.canvas2buf(_this.mp);\n            //$LASTPOS=2001630;\n            dst.x=_this.mp.x;\n            //$LASTPOS=2001659;\n            dst.y=_this.mp.y;\n            //$LASTPOS=2001688;\n            if (! dst.touched) {\n              //$LASTPOS=2001705;\n              dst.touched=1;\n            }\n            \n          }\n        }\n        i++;\n      }\n      //$LASTPOS=2001755;\n      Tonyu.globals.$mouseX=Tonyu.globals.$touches[0].x;\n      //$LASTPOS=2001787;\n      Tonyu.globals.$mouseY=Tonyu.globals.$touches[0].y;\n      //$LASTPOS=2001819;\n      _this.handleListeners();\n    };\n    //$LASTPOS=2001851;\n    Tonyu.globals.$handleTouchEnd=function (e) {\n      var ts;\n      var i;\n      var src;\n      var dst;\n      \n      //$LASTPOS=2001883;\n      ts = e.originalEvent.changedTouches;\n      //$LASTPOS=2001931;\n      //$LASTPOS=2001936;\n      i = 0;\n      while(i<ts.length) {\n        {\n          //$LASTPOS=2001981;\n          src = ts[i];\n          //$LASTPOS=2002009;\n          dst = Tonyu.globals.$touches.findById(src.identifier);\n          //$LASTPOS=2002065;\n          if (dst) {\n            //$LASTPOS=2002093;\n            dst.touched=0;\n            //$LASTPOS=2002125;\n            dst.identifier=- 1;\n            \n          }\n        }\n        i++;\n      }\n      //$LASTPOS=2002179;\n      _this.handleListeners();\n    };\n    //$LASTPOS=2002211;\n    handleMouse = function (e) {\n      \n      //$LASTPOS=2002232;\n      Tonyu.globals.$handleMouse(e);\n    };\n    //$LASTPOS=2002256;\n    handleTouch = function (e) {\n      \n      //$LASTPOS=2002277;\n      Tonyu.globals.$handleTouch(e);\n    };\n    //$LASTPOS=2002301;\n    handleTouchEnd = function (e) {\n      \n      //$LASTPOS=2002325;\n      Tonyu.globals.$handleTouchEnd(e);\n    };\n    //$LASTPOS=2002352;\n    d = $.data(cv,"events");\n    //$LASTPOS=2002384;\n    if (! d) {\n      //$LASTPOS=2002403;\n      $.data(cv,"events","true");\n      //$LASTPOS=2002440;\n      cvj.mousedown(handleMouse);\n      //$LASTPOS=2002477;\n      cvj.mousemove(handleMouse);\n      //$LASTPOS=2002514;\n      cvj.on("touchstart",handleTouch);\n      //$LASTPOS=2002557;\n      cvj.on("touchmove",handleTouch);\n      //$LASTPOS=2002599;\n      cvj.on("touchend",handleTouchEnd);\n      \n    }\n  },\n  fiber$initCanvasEvents :function _trc_func_2000270_8(_thread,cvj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var cv;\n    var handleMouse;\n    var handleTouch;\n    var handleTouchEnd;\n    var d;\n    \n    //$LASTPOS=2000300;\n    cv = cvj[0];\n    \n    _thread.enter(function _trc_func_2000270_9(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=2000320;\n          Tonyu.globals.$handleMouse=function (e) {\n            var p;\n            var mp;\n            \n            //$LASTPOS=2000349;\n            p = cvj.offset();\n            //$LASTPOS=2000378;\n            mp = {x: e.clientX-p.left,y: e.clientY-p.top};\n            //$LASTPOS=2000435;\n            mp=Tonyu.globals.$Screen.canvas2buf(mp);\n            //$LASTPOS=2000471;\n            Tonyu.globals.$mouseX=mp.x;\n            //$LASTPOS=2000494;\n            Tonyu.globals.$mouseY=mp.y;\n            //$LASTPOS=2000517;\n            if (_this.touchEmu) {\n              //$LASTPOS=2000546;\n              Tonyu.globals.$touches[0].x=mp.x;\n              //$LASTPOS=2000579;\n              Tonyu.globals.$touches[0].y=mp.y;\n              \n            }\n            //$LASTPOS=2000619;\n            _this.handleListeners();\n          };\n          //$LASTPOS=2000651;\n          Tonyu.globals.$touches=[{},{},{},{},{}];\n          //$LASTPOS=2000683;\n          Tonyu.globals.$touches.findById=function (id) {\n            var j;\n            \n            //$LASTPOS=2000718;\n            //$LASTPOS=2000723;\n            j = 0;\n            while(j<Tonyu.globals.$touches.length) {\n              {\n                //$LASTPOS=2000773;\n                if (Tonyu.globals.$touches[j].identifier==id) {\n                  return Tonyu.globals.$touches[j];\n                  \n                }\n              }\n              j++;\n            }\n          };\n          //$LASTPOS=2000883;\n          Tonyu.globals.$handleTouch=function (e) {\n            var p;\n            var ts;\n            var i;\n            var src;\n            var dst;\n            var j;\n            \n            //$LASTPOS=2000912;\n            _this.touchEmu=false;\n            //$LASTPOS=2000937;\n            p = cvj.offset();\n            //$LASTPOS=2000966;\n            e.preventDefault();\n            //$LASTPOS=2000995;\n            ts = e.originalEvent.changedTouches;\n            //$LASTPOS=2001043;\n            //$LASTPOS=2001048;\n            i = 0;\n            while(i<ts.length) {\n              {\n                //$LASTPOS=2001093;\n                src = ts[i];\n                //$LASTPOS=2001121;\n                dst = Tonyu.globals.$touches.findById(src.identifier);\n                //$LASTPOS=2001177;\n                if (! dst) {\n                  //$LASTPOS=2001206;\n                  //$LASTPOS=2001211;\n                  j = 0;\n                  while(j<Tonyu.globals.$touches.length) {\n                    {\n                      //$LASTPOS=2001269;\n                      if (! Tonyu.globals.$touches[j].touched) {\n                        //$LASTPOS=2001322;\n                        dst=Tonyu.globals.$touches[j];\n                        //$LASTPOS=2001364;\n                        dst.identifier=src.identifier;\n                        break;\n                        \n                        \n                      }\n                    }\n                    j++;\n                  }\n                  \n                }\n                //$LASTPOS=2001497;\n                if (dst) {\n                  //$LASTPOS=2001525;\n                  _this.mp={x: src.pageX-p.left,y: src.pageY-p.top};\n                  //$LASTPOS=2001586;\n                  _this.mp=Tonyu.globals.$Screen.canvas2buf(_this.mp);\n                  //$LASTPOS=2001630;\n                  dst.x=_this.mp.x;\n                  //$LASTPOS=2001659;\n                  dst.y=_this.mp.y;\n                  //$LASTPOS=2001688;\n                  if (! dst.touched) {\n                    //$LASTPOS=2001705;\n                    dst.touched=1;\n                  }\n                  \n                }\n              }\n              i++;\n            }\n            //$LASTPOS=2001755;\n            Tonyu.globals.$mouseX=Tonyu.globals.$touches[0].x;\n            //$LASTPOS=2001787;\n            Tonyu.globals.$mouseY=Tonyu.globals.$touches[0].y;\n            //$LASTPOS=2001819;\n            _this.handleListeners();\n          };\n          //$LASTPOS=2001851;\n          Tonyu.globals.$handleTouchEnd=function (e) {\n            var ts;\n            var i;\n            var src;\n            var dst;\n            \n            //$LASTPOS=2001883;\n            ts = e.originalEvent.changedTouches;\n            //$LASTPOS=2001931;\n            //$LASTPOS=2001936;\n            i = 0;\n            while(i<ts.length) {\n              {\n                //$LASTPOS=2001981;\n                src = ts[i];\n                //$LASTPOS=2002009;\n                dst = Tonyu.globals.$touches.findById(src.identifier);\n                //$LASTPOS=2002065;\n                if (dst) {\n                  //$LASTPOS=2002093;\n                  dst.touched=0;\n                  //$LASTPOS=2002125;\n                  dst.identifier=- 1;\n                  \n                }\n              }\n              i++;\n            }\n            //$LASTPOS=2002179;\n            _this.handleListeners();\n          };\n          //$LASTPOS=2002211;\n          handleMouse = function (e) {\n            \n            //$LASTPOS=2002232;\n            Tonyu.globals.$handleMouse(e);\n          };\n          //$LASTPOS=2002256;\n          handleTouch = function (e) {\n            \n            //$LASTPOS=2002277;\n            Tonyu.globals.$handleTouch(e);\n          };\n          //$LASTPOS=2002301;\n          handleTouchEnd = function (e) {\n            \n            //$LASTPOS=2002325;\n            Tonyu.globals.$handleTouchEnd(e);\n          };\n          //$LASTPOS=2002352;\n          d = $.data(cv,"events");\n          //$LASTPOS=2002384;\n          if (! d) {\n            //$LASTPOS=2002403;\n            $.data(cv,"events","true");\n            //$LASTPOS=2002440;\n            cvj.mousedown(handleMouse);\n            //$LASTPOS=2002477;\n            cvj.mousemove(handleMouse);\n            //$LASTPOS=2002514;\n            cvj.on("touchstart",handleTouch);\n            //$LASTPOS=2002557;\n            cvj.on("touchmove",handleTouch);\n            //$LASTPOS=2002599;\n            cvj.on("touchend",handleTouchEnd);\n            \n          }\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  update :function _trc_func_2002647_10() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    var _it_30;\n    \n    //$LASTPOS=2002664;\n    _it_30=Tonyu.iterator(Tonyu.globals.$touches,1);\n    while(_it_30.next()) {\n      i=_it_30[0];\n      \n      //$LASTPOS=2002699;\n      if (i.touched>0) {\n        //$LASTPOS=2002717;\n        i.touched++;\n        \n      }\n      //$LASTPOS=2002740;\n      if (i.touched==- 1) {\n        //$LASTPOS=2002759;\n        i.touched=1;\n      }\n      \n    }\n  },\n  fiber$update :function _trc_func_2002647_11(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    var _it_30;\n    \n    //$LASTPOS=2002664;\n    _it_30=Tonyu.iterator(Tonyu.globals.$touches,1);\n    while(_it_30.next()) {\n      i=_it_30[0];\n      \n      //$LASTPOS=2002699;\n      if (i.touched>0) {\n        //$LASTPOS=2002717;\n        i.touched++;\n        \n      }\n      //$LASTPOS=2002740;\n      if (i.touched==- 1) {\n        //$LASTPOS=2002759;\n        i.touched=1;\n      }\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.InputDevice,{"fullName":"kernel.InputDevice","namespace":"kernel","shortName":"InputDevice","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"handleListeners":{"nowait":false},"addOnetimeListener":{"nowait":false},"initCanvasEvents":{"nowait":false},"update":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.MathMod=Tonyu.klass([],{\n  main :function _trc_func_3000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_3000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  sin :function _trc_func_3000031_2(d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.sin(_this.rad(d));\n  },\n  cos :function _trc_func_3000082_3(d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.cos(_this.rad(d));\n  },\n  rad :function _trc_func_3000133_4(d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return d/180*Math.PI;\n  },\n  deg :function _trc_func_3000181_5(d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return d/Math.PI*180;\n  },\n  abs :function _trc_func_3000231_6(v) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.abs(v);\n  },\n  atan2 :function _trc_func_3000277_7(x,y) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.deg(Math.atan2(x,y));\n  },\n  floor :function _trc_func_3000336_8(x) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.floor(x);\n  },\n  angleDiff :function _trc_func_3000386_9(a,b) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var c;\n    \n    //$LASTPOS=3000416;\n    c;\n    //$LASTPOS=3000428;\n    a=_this.floor(a);\n    //$LASTPOS=3000445;\n    b=_this.floor(b);\n    //$LASTPOS=3000462;\n    if (a>=b) {\n      //$LASTPOS=3000483;\n      c=(a-b)%360;\n      //$LASTPOS=3000507;\n      if (c>=180) {\n        //$LASTPOS=3000519;\n        c-=360;\n      }\n      \n    } else {\n      //$LASTPOS=3000550;\n      c=- ((b-a)%360);\n      //$LASTPOS=3000577;\n      if (c<- 180) {\n        //$LASTPOS=3000589;\n        c+=360;\n      }\n      \n    }\n    return c;\n  },\n  sqrt :function _trc_func_3000623_10(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.sqrt(t);\n  },\n  dist :function _trc_func_3000671_11(dx,dy) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var t;\n    \n    //$LASTPOS=3000698;\n    if (typeof  dx=="object") {\n      //$LASTPOS=3000734;\n      t = dx;\n      //$LASTPOS=3000753;\n      dx=t.x-_this.x;\n      //$LASTPOS=3000762;\n      dy=t.y-_this.y;\n      \n    }\n    return _this.sqrt(dx*dx+dy*dy);\n  },\n  trunc :function _trc_func_3000814_12(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=3000838;\n    if (f>=0) {\n      return Math.floor(f);\n    } else {\n      return Math.ceil(f);\n    }\n  },\n  ceil :function _trc_func_3000904_13(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.ceil(f);\n  },\n  rnd :function _trc_func_3000953_14(r) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=3000975;\n    if (typeof  r=="number") {\n      return Math.floor(Math.random()*r);\n      \n    }\n    return Math.random();\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.MathMod,{"fullName":"kernel.MathMod","namespace":"kernel","shortName":"MathMod","decls":{"methods":{"main":{"nowait":false},"sin":{"nowait":true},"cos":{"nowait":true},"rad":{"nowait":true},"deg":{"nowait":true},"abs":{"nowait":true},"atan2":{"nowait":true},"floor":{"nowait":true},"angleDiff":{"nowait":true},"sqrt":{"nowait":true},"dist":{"nowait":true},"trunc":{"nowait":true},"ceil":{"nowait":true},"rnd":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.MediaPlayer=Tonyu.klass([],{\n  main :function _trc_func_4000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_4000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  play :function _trc_func_4000002_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$play :function _trc_func_4000002_3(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  stop :function _trc_func_4000022_4() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$stop :function _trc_func_4000022_5(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  playSE :function _trc_func_4000042_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$playSE :function _trc_func_4000042_7(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setDelay :function _trc_func_4000064_8() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$setDelay :function _trc_func_4000064_9(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setVolume :function _trc_func_4000087_10() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$setVolume :function _trc_func_4000087_11(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.MediaPlayer,{"fullName":"kernel.MediaPlayer","namespace":"kernel","shortName":"MediaPlayer","decls":{"methods":{"main":{"nowait":false},"play":{"nowait":false},"stop":{"nowait":false},"playSE":{"nowait":false},"setDelay":{"nowait":false},"setVolume":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T2Mod=Tonyu.klass([],{\n  main :function _trc_func_5000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_5000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  bvec :function _trc_func_5000015_2(tx,ty) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b2Vec2;\n    \n    //$LASTPOS=5000034;\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    return new b2Vec2(tx/_this.scale,ty/_this.scale);\n  },\n  fiber$bvec :function _trc_func_5000015_3(_thread,tx,ty) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b2Vec2;\n    \n    //$LASTPOS=5000034;\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    _thread.retVal=new b2Vec2(tx/_this.scale,ty/_this.scale);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T2Mod,{"fullName":"kernel.T2Mod","namespace":"kernel","shortName":"T2Mod","decls":{"methods":{"main":{"nowait":false},"bvec":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.TextRectMod=Tonyu.klass([],{\n  main :function _trc_func_6000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_6000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  drawTextRect :function _trc_func_6000017_2(ctx,text,x,topY,h,align,type) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var met;\n    var res;\n    var t;\n    \n    //$LASTPOS=6000090;\n    if (! align) {\n      //$LASTPOS=6000102;\n      align="center";\n    }\n    //$LASTPOS=6000123;\n    ctx.textBaseline="top";\n    //$LASTPOS=6000152;\n    _this.setFontSize(ctx,h);\n    //$LASTPOS=6000178;\n    met = ctx.measureText(text);\n    //$LASTPOS=6000214;\n    res = {y: topY,w: met.width,h: h};\n    //$LASTPOS=6000256;\n    t = align.substring(0,1).toLowerCase();\n    //$LASTPOS=6000303;\n    if (t=="l") {\n      //$LASTPOS=6000315;\n      res.x=x;\n    } else {\n      //$LASTPOS=6000334;\n      if (t=="r") {\n        //$LASTPOS=6000346;\n        res.x=x-met.width;\n      } else {\n        //$LASTPOS=6000375;\n        if (t=="c") {\n          //$LASTPOS=6000387;\n          res.x=x-met.width/2;\n        }\n      }\n    }\n    //$LASTPOS=6000413;\n    if (type=="fill") {\n      //$LASTPOS=6000431;\n      ctx.fillText(text,res.x,topY);\n    }\n    //$LASTPOS=6000468;\n    if (type=="stroke") {\n      //$LASTPOS=6000488;\n      ctx.strokeText(text,res.x,topY);\n    }\n    return res;\n  },\n  setFontSize :function _trc_func_6000543_3(ctx,sz) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var post;\n    \n    //$LASTPOS=6000586;\n    post = ctx.font.replace(/^[0-9\\.]+/,"");\n    //$LASTPOS=6000634;\n    ctx.font=sz+post;\n  },\n  fukidashi :function _trc_func_6000658_4(ctx,text,x,y,sz) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var align;\n    var theight;\n    var margin;\n    var r;\n    var fs;\n    \n    //$LASTPOS=6000712;\n    align = "c";\n    //$LASTPOS=6000732;\n    theight = 20;\n    //$LASTPOS=6000753;\n    margin = 5;\n    //$LASTPOS=6000772;\n    r = _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align);\n    //$LASTPOS=6000842;\n    ctx.beginPath();\n    //$LASTPOS=6000864;\n    ctx.moveTo(x,y);\n    //$LASTPOS=6000888;\n    ctx.lineTo(x+margin,y-theight);\n    //$LASTPOS=6000927;\n    ctx.lineTo(x+r.w/2+margin,y-theight);\n    //$LASTPOS=6000972;\n    ctx.lineTo(x+r.w/2+margin,y-theight-r.h-margin*2);\n    //$LASTPOS=6001030;\n    ctx.lineTo(x-r.w/2-margin,y-theight-r.h-margin*2);\n    //$LASTPOS=6001088;\n    ctx.lineTo(x-r.w/2-margin,y-theight);\n    //$LASTPOS=6001133;\n    ctx.lineTo(x-margin,y-theight);\n    //$LASTPOS=6001172;\n    ctx.closePath();\n    //$LASTPOS=6001194;\n    ctx.fill();\n    //$LASTPOS=6001211;\n    ctx.stroke();\n    //$LASTPOS=6001236;\n    fs = ctx.fillStyle;\n    //$LASTPOS=6001263;\n    ctx.fillStyle=ctx.strokeStyle;\n    //$LASTPOS=6001299;\n    _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align,"fill");\n    //$LASTPOS=6001372;\n    ctx.fillStyle=fs;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.TextRectMod,{"fullName":"kernel.TextRectMod","namespace":"kernel","shortName":"TextRectMod","decls":{"methods":{"main":{"nowait":false},"drawTextRect":{"nowait":true},"setFontSize":{"nowait":true},"fukidashi":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.TObject=Tonyu.klass([],{\n  main :function _trc_func_7000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_7000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_7000030_2(options) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=7000052;\n    if (typeof  options=="object") {\n      //$LASTPOS=7000082;\n      _this.extend(options);\n    }\n    //$LASTPOS=7000104;\n    _this.main();\n  },\n  extend :function _trc_func_7000121_3(obj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Tonyu.extend(_this,obj);\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.TObject,{"fullName":"kernel.TObject","namespace":"kernel","shortName":"TObject","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"extend":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.TQuery=Tonyu.klass(Tonyu.classes.kernel.TObject,[Tonyu.classes.kernel.MathMod],{\n  main :function _trc_func_8000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_8000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_8000035_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=8000049;\n    _this.length=0;\n  },\n  tonyuIterator :function _trc_func_8000061_3(arity) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    \n    //$LASTPOS=8000089;\n    res = {};\n    //$LASTPOS=8000105;\n    res.i=0;\n    //$LASTPOS=8000118;\n    if (arity==1) {\n      //$LASTPOS=8000142;\n      res.next=function () {\n        \n        //$LASTPOS=8000177;\n        if (res.i>=_this.length) {\n          return false;\n        }\n        //$LASTPOS=8000227;\n        res[0]=_this[res.i];\n        //$LASTPOS=8000259;\n        res.i++;\n        return true;\n      };\n      \n    } else {\n      //$LASTPOS=8000325;\n      res.next=function () {\n        \n        //$LASTPOS=8000360;\n        if (res.i>=_this.length) {\n          return false;\n        }\n        //$LASTPOS=8000410;\n        res[0]=res.i;\n        //$LASTPOS=8000436;\n        res[1]=_this[res.i];\n        //$LASTPOS=8000468;\n        res.i++;\n        return true;\n      };\n      \n    }\n    return res;\n  },\n  fiber$tonyuIterator :function _trc_func_8000061_4(_thread,arity) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var res;\n    \n    //$LASTPOS=8000089;\n    res = {};\n    //$LASTPOS=8000105;\n    res.i=0;\n    //$LASTPOS=8000118;\n    if (arity==1) {\n      //$LASTPOS=8000142;\n      res.next=function () {\n        \n        //$LASTPOS=8000177;\n        if (res.i>=_this.length) {\n          return false;\n        }\n        //$LASTPOS=8000227;\n        res[0]=_this[res.i];\n        //$LASTPOS=8000259;\n        res.i++;\n        return true;\n      };\n      \n    } else {\n      //$LASTPOS=8000325;\n      res.next=function () {\n        \n        //$LASTPOS=8000360;\n        if (res.i>=_this.length) {\n          return false;\n        }\n        //$LASTPOS=8000410;\n        res[0]=res.i;\n        //$LASTPOS=8000436;\n        res[1]=_this[res.i];\n        //$LASTPOS=8000468;\n        res.i++;\n        return true;\n      };\n      \n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  attr :function _trc_func_8000537_5() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var values;\n    var i;\n    var e;\n    var _it_46;\n    \n    //$LASTPOS=8000551;\n    values;\n    //$LASTPOS=8000567;\n    if (_this.length==0) {\n      return _this;\n    }\n    //$LASTPOS=8000594;\n    if (arguments.length==1&&typeof  arguments[0]=="string") {\n      return _this[0][arguments[0]];\n      \n    }\n    //$LASTPOS=8000702;\n    if (arguments.length>=2) {\n      //$LASTPOS=8000737;\n      values={};\n      //$LASTPOS=8000756;\n      //$LASTPOS=8000761;\n      i = 0;\n      while(i<arguments.length-1) {\n        {\n          //$LASTPOS=8000813;\n          values[arguments[i]]=arguments[i+1];\n        }\n        i+=2;\n      }\n      \n    } else {\n      //$LASTPOS=8000881;\n      values=arguments[0];\n      \n    }\n    //$LASTPOS=8000912;\n    if (values) {\n      //$LASTPOS=8000934;\n      _it_46=Tonyu.iterator(_this,1);\n      while(_it_46.next()) {\n        e=_it_46[0];\n        \n        //$LASTPOS=8000968;\n        e.extend(values);\n        \n      }\n      \n    }\n  },\n  fiber$attr :function _trc_func_8000537_6(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var values;\n    var i;\n    var e;\n    var _it_46;\n    \n    //$LASTPOS=8000551;\n    values;\n    //$LASTPOS=8000567;\n    if (_this.length==0) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=8000594;\n    if (_arguments.length==1&&typeof  _arguments[0]=="string") {\n      _thread.retVal=_this[0][_arguments[0]];return;\n      \n      \n    }\n    //$LASTPOS=8000702;\n    if (_arguments.length>=2) {\n      //$LASTPOS=8000737;\n      values={};\n      //$LASTPOS=8000756;\n      //$LASTPOS=8000761;\n      i = 0;\n      while(i<_arguments.length-1) {\n        {\n          //$LASTPOS=8000813;\n          values[_arguments[i]]=_arguments[i+1];\n        }\n        i+=2;\n      }\n      \n    } else {\n      //$LASTPOS=8000881;\n      values=_arguments[0];\n      \n    }\n    //$LASTPOS=8000912;\n    if (values) {\n      //$LASTPOS=8000934;\n      _it_46=Tonyu.iterator(_this,1);\n      while(_it_46.next()) {\n        e=_it_46[0];\n        \n        //$LASTPOS=8000968;\n        e.extend(values);\n        \n      }\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  genKeyfunc :function _trc_func_8001005_7(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=8001028;\n    if (typeof  key!="function") {\n      return function (o) {\n        \n        return o[key];\n      };\n      \n    } else {\n      return key;\n      \n    }\n  },\n  fiber$genKeyfunc :function _trc_func_8001005_8(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=8001028;\n    if (typeof  key!="function") {\n      _thread.retVal=function (o) {\n        \n        return o[key];\n      };return;\n      \n      \n    } else {\n      _thread.retVal=key;return;\n      \n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  maxs :function _trc_func_8001137_9(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var f;\n    var res;\n    var reso;\n    var o;\n    var _it_52;\n    var v;\n    \n    //$LASTPOS=8001154;\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=8001181;\n    res;reso = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=8001210;\n    _it_52=Tonyu.iterator(_this,1);\n    while(_it_52.next()) {\n      o=_it_52[0];\n      \n      //$LASTPOS=8001240;\n      v = f(o);\n      //$LASTPOS=8001260;\n      if (res==null||v>=res) {\n        //$LASTPOS=8001299;\n        if (v>res) {\n          //$LASTPOS=8001310;\n          reso=new Tonyu.classes.kernel.TQuery;\n        }\n        //$LASTPOS=8001339;\n        reso.push(o);\n        //$LASTPOS=8001365;\n        res=v;\n        \n      }\n      \n    }\n    return reso;\n  },\n  fiber$maxs :function _trc_func_8001137_10(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var f;\n    var res;\n    var reso;\n    var o;\n    var _it_52;\n    var v;\n    \n    //$LASTPOS=8001154;\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=8001181;\n    res;reso = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=8001210;\n    _it_52=Tonyu.iterator(_this,1);\n    while(_it_52.next()) {\n      o=_it_52[0];\n      \n      //$LASTPOS=8001240;\n      v = f(o);\n      //$LASTPOS=8001260;\n      if (res==null||v>=res) {\n        //$LASTPOS=8001299;\n        if (v>res) {\n          //$LASTPOS=8001310;\n          reso=new Tonyu.classes.kernel.TQuery;\n        }\n        //$LASTPOS=8001339;\n        reso.push(o);\n        //$LASTPOS=8001365;\n        res=v;\n        \n      }\n      \n    }\n    _thread.retVal=reso;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  mins :function _trc_func_8001407_11(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var f;\n    var res;\n    var reso;\n    var o;\n    var _it_59;\n    var v;\n    \n    //$LASTPOS=8001424;\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=8001451;\n    res;reso = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=8001480;\n    _it_59=Tonyu.iterator(_this,1);\n    while(_it_59.next()) {\n      o=_it_59[0];\n      \n      //$LASTPOS=8001510;\n      v = f(o);\n      //$LASTPOS=8001530;\n      if (res==null||v<=res) {\n        //$LASTPOS=8001569;\n        if (v<res) {\n          //$LASTPOS=8001580;\n          reso=new Tonyu.classes.kernel.TQuery;\n        }\n        //$LASTPOS=8001609;\n        reso.push(o);\n        //$LASTPOS=8001635;\n        res=v;\n        \n      }\n      \n    }\n    return reso;\n  },\n  fiber$mins :function _trc_func_8001407_12(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var f;\n    var res;\n    var reso;\n    var o;\n    var _it_59;\n    var v;\n    \n    //$LASTPOS=8001424;\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=8001451;\n    res;reso = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=8001480;\n    _it_59=Tonyu.iterator(_this,1);\n    while(_it_59.next()) {\n      o=_it_59[0];\n      \n      //$LASTPOS=8001510;\n      v = f(o);\n      //$LASTPOS=8001530;\n      if (res==null||v<=res) {\n        //$LASTPOS=8001569;\n        if (v<res) {\n          //$LASTPOS=8001580;\n          reso=new Tonyu.classes.kernel.TQuery;\n        }\n        //$LASTPOS=8001609;\n        reso.push(o);\n        //$LASTPOS=8001635;\n        res=v;\n        \n      }\n      \n    }\n    _thread.retVal=reso;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  minObj :function _trc_func_8001677_13(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.mins(key)[0];\n  },\n  fiber$minObj :function _trc_func_8001677_14(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.mins(key)[0];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  maxObj :function _trc_func_8001719_15(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.maxs(key)[0];\n  },\n  fiber$maxObj :function _trc_func_8001719_16(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.maxs(key)[0];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  nearests :function _trc_func_8001761_17(x,y) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=8001782;\n    if (typeof  x=="object") {\n      //$LASTPOS=8001807;\n      y=x.y;\n      //$LASTPOS=8001813;\n      x=x.x;\n      \n    }\n    return _this.mins(function (o) {\n      \n      return _this.dist(o.x-x,o.y-y);\n    });\n  },\n  fiber$nearests :function _trc_func_8001761_18(_thread,x,y) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=8001782;\n    if (typeof  x=="object") {\n      //$LASTPOS=8001807;\n      y=x.y;\n      //$LASTPOS=8001813;\n      x=x.x;\n      \n    }\n    _thread.retVal=_this.mins(function (o) {\n      \n      return _this.dist(o.x-x,o.y-y);\n    });return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  nearest :function _trc_func_8001887_19(x,y) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.nearests(x,y)[0];\n  },\n  fiber$nearest :function _trc_func_8001887_20(_thread,x,y) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.nearests(x,y)[0];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  withins :function _trc_func_8001934_21(xo,yd,d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var x;\n    var y;\n    \n    //$LASTPOS=8001958;\n    x;y;\n    //$LASTPOS=8001971;\n    if (typeof  xo=="object") {\n      //$LASTPOS=8002006;\n      x=xo.x;\n      //$LASTPOS=8002013;\n      y=xo.y;\n      //$LASTPOS=8002020;\n      d=yd;\n      \n    } else {\n      //$LASTPOS=8002047;\n      x=xo;\n      //$LASTPOS=8002052;\n      y=yd;\n      \n    }\n    return _this.find(function (o) {\n      \n      return _this.dist(o.x-x,o.y-y)<=d;\n    });\n  },\n  fiber$withins :function _trc_func_8001934_22(_thread,xo,yd,d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var x;\n    var y;\n    \n    //$LASTPOS=8001958;\n    x;y;\n    //$LASTPOS=8001971;\n    if (typeof  xo=="object") {\n      //$LASTPOS=8002006;\n      x=xo.x;\n      //$LASTPOS=8002013;\n      y=xo.y;\n      //$LASTPOS=8002020;\n      d=yd;\n      \n    } else {\n      //$LASTPOS=8002047;\n      x=xo;\n      //$LASTPOS=8002052;\n      y=yd;\n      \n    }\n    _thread.retVal=_this.find(function (o) {\n      \n      return _this.dist(o.x-x,o.y-y)<=d;\n    });return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  within :function _trc_func_8002133_23(xo,yd,d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.withins(xo,yd,d).nearest();\n  },\n  fiber$within :function _trc_func_8002133_24(_thread,xo,yd,d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.withins(xo,yd,d).nearest();return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  max :function _trc_func_8002194_25(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var f;\n    var res;\n    var o;\n    var _it_70;\n    var v;\n    \n    //$LASTPOS=8002210;\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=8002237;\n    res;\n    //$LASTPOS=8002250;\n    _it_70=Tonyu.iterator(_this,1);\n    while(_it_70.next()) {\n      o=_it_70[0];\n      \n      //$LASTPOS=8002280;\n      v = f(o);\n      //$LASTPOS=8002300;\n      if (res==null||v>res) {\n        //$LASTPOS=8002324;\n        res=v;\n      }\n      \n    }\n    return res;\n  },\n  fiber$max :function _trc_func_8002194_26(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var f;\n    var res;\n    var o;\n    var _it_70;\n    var v;\n    \n    //$LASTPOS=8002210;\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=8002237;\n    res;\n    //$LASTPOS=8002250;\n    _it_70=Tonyu.iterator(_this,1);\n    while(_it_70.next()) {\n      o=_it_70[0];\n      \n      //$LASTPOS=8002280;\n      v = f(o);\n      //$LASTPOS=8002300;\n      if (res==null||v>res) {\n        //$LASTPOS=8002324;\n        res=v;\n      }\n      \n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  min :function _trc_func_8002355_27(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var f;\n    var res;\n    var o;\n    var _it_76;\n    var v;\n    \n    //$LASTPOS=8002371;\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=8002398;\n    res;\n    //$LASTPOS=8002411;\n    _it_76=Tonyu.iterator(_this,1);\n    while(_it_76.next()) {\n      o=_it_76[0];\n      \n      //$LASTPOS=8002441;\n      v = f(o);\n      //$LASTPOS=8002461;\n      if (res==null||v<res) {\n        //$LASTPOS=8002485;\n        res=v;\n      }\n      \n    }\n    return res;\n  },\n  fiber$min :function _trc_func_8002355_28(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var f;\n    var res;\n    var o;\n    var _it_76;\n    var v;\n    \n    //$LASTPOS=8002371;\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=8002398;\n    res;\n    //$LASTPOS=8002411;\n    _it_76=Tonyu.iterator(_this,1);\n    while(_it_76.next()) {\n      o=_it_76[0];\n      \n      //$LASTPOS=8002441;\n      v = f(o);\n      //$LASTPOS=8002461;\n      if (res==null||v<res) {\n        //$LASTPOS=8002485;\n        res=v;\n      }\n      \n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  push :function _trc_func_8002516_29(e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=8002531;\n    _this[_this.length]=e;\n    //$LASTPOS=8002551;\n    _this.length++;\n  },\n  fiber$push :function _trc_func_8002516_30(_thread,e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=8002531;\n    _this[_this.length]=e;\n    //$LASTPOS=8002551;\n    _this.length++;\n    \n    _thread.retVal=_this;return;\n  },\n  size :function _trc_func_8002563_31() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.length;\n  },\n  fiber$size :function _trc_func_8002563_32(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.length;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  find :function _trc_func_8002588_33(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var no;\n    var o;\n    var _it_82;\n    \n    //$LASTPOS=8002603;\n    no = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=8002626;\n    _it_82=Tonyu.iterator(_this,1);\n    while(_it_82.next()) {\n      o=_it_82[0];\n      \n      //$LASTPOS=8002656;\n      if (f(o)) {\n        //$LASTPOS=8002666;\n        no.push(o);\n      }\n      \n    }\n    return no;\n  },\n  fiber$find :function _trc_func_8002588_34(_thread,f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var no;\n    var o;\n    var _it_82;\n    \n    //$LASTPOS=8002603;\n    no = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=8002626;\n    _it_82=Tonyu.iterator(_this,1);\n    while(_it_82.next()) {\n      o=_it_82[0];\n      \n      //$LASTPOS=8002656;\n      if (f(o)) {\n        //$LASTPOS=8002666;\n        no.push(o);\n      }\n      \n    }\n    _thread.retVal=no;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  apply :function _trc_func_8002702_35(name,args) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    var o;\n    var _it_86;\n    var f;\n    \n    //$LASTPOS=8002727;\n    res;\n    //$LASTPOS=8002740;\n    if (! args) {\n      //$LASTPOS=8002751;\n      args=[];\n    }\n    //$LASTPOS=8002764;\n    _it_86=Tonyu.iterator(_this,1);\n    while(_it_86.next()) {\n      o=_it_86[0];\n      \n      //$LASTPOS=8002794;\n      f = o[name];\n      //$LASTPOS=8002817;\n      if (typeof  f=="function") {\n        //$LASTPOS=8002857;\n        res=f.apply(o,args);\n        \n      }\n      \n    }\n    return res;\n  },\n  fiber$apply :function _trc_func_8002702_36(_thread,name,args) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var res;\n    var o;\n    var _it_86;\n    var f;\n    \n    //$LASTPOS=8002727;\n    res;\n    //$LASTPOS=8002740;\n    if (! args) {\n      //$LASTPOS=8002751;\n      args=[];\n    }\n    //$LASTPOS=8002764;\n    _it_86=Tonyu.iterator(_this,1);\n    while(_it_86.next()) {\n      o=_it_86[0];\n      \n      //$LASTPOS=8002794;\n      f = o[name];\n      //$LASTPOS=8002817;\n      if (typeof  f=="function") {\n        //$LASTPOS=8002857;\n        res=f.apply(o,args);\n        \n      }\n      \n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  alive :function _trc_func_8002968_37() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.find(function (o) {\n      \n      return ! o.isDead();\n    });\n  },\n  fiber$alive :function _trc_func_8002968_38(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.find(function (o) {\n      \n      return ! o.isDead();\n    });return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  die :function _trc_func_8003039_39() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var a;\n    \n    //$LASTPOS=8003052;\n    a = _this.alive();\n    //$LASTPOS=8003071;\n    if (a.length==0) {\n      return false;\n    }\n    //$LASTPOS=8003106;\n    a.apply("die");\n    return true;\n  },\n  fiber$die :function _trc_func_8003039_40(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var a;\n    \n    //$LASTPOS=8003052;\n    a = _this.alive();\n    //$LASTPOS=8003071;\n    if (a.length==0) {\n      _thread.retVal=false;return;\n      \n    }\n    //$LASTPOS=8003106;\n    a.apply("die");\n    _thread.retVal=true;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  klass :function _trc_func_8003142_41(k) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.find(function (o) {\n      \n      return o instanceof k;\n    });\n  },\n  fiber$klass :function _trc_func_8003142_42(_thread,k) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.find(function (o) {\n      \n      return o instanceof k;\n    });return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.TQuery,{"fullName":"kernel.TQuery","namespace":"kernel","shortName":"TQuery","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"tonyuIterator":{"nowait":false},"attr":{"nowait":false},"genKeyfunc":{"nowait":false},"maxs":{"nowait":false},"mins":{"nowait":false},"minObj":{"nowait":false},"maxObj":{"nowait":false},"nearests":{"nowait":false},"nearest":{"nowait":false},"withins":{"nowait":false},"within":{"nowait":false},"max":{"nowait":false},"min":{"nowait":false},"push":{"nowait":false},"size":{"nowait":false},"find":{"nowait":false},"apply":{"nowait":false},"alive":{"nowait":false},"die":{"nowait":false},"klass":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.WaveTable=Tonyu.klass(Tonyu.classes.kernel.TObject,[],{\n  main :function _trc_func_9000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=9000028;\n    _this.wav={};\n    //$LASTPOS=9000036;\n    _this.env={};\n    //$LASTPOS=9000313;\n    if (typeof  T!=="undefined") {\n      //$LASTPOS=9000392;\n      _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});\n      //$LASTPOS=9000460;\n      _this.setEnv(0,_this.env);\n      //$LASTPOS=9000480;\n      _this.setWav(0,T("pulse"));\n      \n    }\n  },\n  fiber$main :function _trc_func_9000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=9000028;\n    _this.wav={};\n    //$LASTPOS=9000036;\n    _this.env={};\n    \n    _thread.enter(function _trc_func_9000000_2(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=9000313;\n          if (!(typeof  T!=="undefined")) { __pc=3; break; }\n          //$LASTPOS=9000392;\n          _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});\n          //$LASTPOS=9000460;\n          _this.fiber$setEnv(_thread, 0, _this.env);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=9000480;\n          _this.fiber$setWav(_thread, 0, T("pulse"));\n          __pc=2;return;\n        case 2:\n          \n        case 3:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  setWav :function _trc_func_9000044_3(num,synth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=9000070;\n    _this.wav[num]=synth;\n  },\n  fiber$setWav :function _trc_func_9000044_4(_thread,num,synth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=9000070;\n    _this.wav[num]=synth;\n    \n    _thread.retVal=_this;return;\n  },\n  setEnv :function _trc_func_9000088_5(num,synth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=9000114;\n    _this.env[num]=synth;\n  },\n  fiber$setEnv :function _trc_func_9000088_6(_thread,num,synth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=9000114;\n    _this.env[num]=synth;\n    \n    _thread.retVal=_this;return;\n  },\n  get :function _trc_func_9000132_7(w,e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var synth;\n    \n    //$LASTPOS=9000148;\n    synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});\n    return synth;\n  },\n  fiber$get :function _trc_func_9000132_8(_thread,w,e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var synth;\n    \n    //$LASTPOS=9000148;\n    synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});\n    _thread.retVal=synth;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  stop :function _trc_func_9000226_9() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$stop :function _trc_func_9000226_10(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.WaveTable,{"fullName":"kernel.WaveTable","namespace":"kernel","shortName":"WaveTable","decls":{"methods":{"main":{"nowait":false},"setWav":{"nowait":false},"setEnv":{"nowait":false},"get":{"nowait":false},"stop":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.BaseActor=Tonyu.klass([Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.TextRectMod],{\n  main :function _trc_func_10000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_10000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_10000143_2(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var thg;\n    \n    //$LASTPOS=10000162;\n    if (Tonyu.runMode) {\n      //$LASTPOS=10000192;\n      thg = _this.currentThreadGroup();\n      //$LASTPOS=10000231;\n      if (thg) {\n        //$LASTPOS=10000240;\n        _this._th=thg.addObj(_this);\n      }\n      \n    }\n    //$LASTPOS=10000274;\n    if (typeof  x=="object") {\n      //$LASTPOS=10000298;\n      Tonyu.extend(_this,x);\n    } else {\n      //$LASTPOS=10000331;\n      if (typeof  x=="number") {\n        //$LASTPOS=10000366;\n        _this.x=x;\n        //$LASTPOS=10000385;\n        _this.y=y;\n        //$LASTPOS=10000404;\n        _this.p=p;\n        \n      }\n    }\n    //$LASTPOS=10000426;\n    if (_this.scaleX==null) {\n      //$LASTPOS=10000444;\n      _this.scaleX=1;\n    }\n    //$LASTPOS=10000459;\n    if (_this.rotation==null) {\n      //$LASTPOS=10000479;\n      _this.rotation=0;\n    }\n    //$LASTPOS=10000496;\n    if (_this.rotate==null) {\n      //$LASTPOS=10000514;\n      _this.rotate=0;\n    }\n    //$LASTPOS=10000529;\n    if (_this.alpha==null) {\n      //$LASTPOS=10000546;\n      _this.alpha=255;\n    }\n    //$LASTPOS=10000562;\n    if (_this.zOrder==null) {\n      //$LASTPOS=10000580;\n      _this.zOrder=0;\n    }\n    //$LASTPOS=10000595;\n    if (_this.age==null) {\n      //$LASTPOS=10000610;\n      _this.age=0;\n    }\n    //$LASTPOS=10000622;\n    if (_this.anim!=null&&typeof  _this.anim=="object") {\n      //$LASTPOS=10000673;\n      _this.animMode=true;\n      //$LASTPOS=10000697;\n      _this.animFrame=0;\n      \n    } else {\n      //$LASTPOS=10000731;\n      _this.animMode=false;\n      \n    }\n    //$LASTPOS=10000759;\n    if (_this.animFps==null) {\n      //$LASTPOS=10000778;\n      _this.animFps=1;\n    }\n  },\n  extend :function _trc_func_10000793_3(obj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Tonyu.extend(_this,obj);\n  },\n  print :function _trc_func_10000857_4(pt) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10000882;\n    console.log.apply(console,arguments);\n    //$LASTPOS=10000925;\n    if (Tonyu.globals.$consolePanel) {\n      //$LASTPOS=10000953;\n      Tonyu.globals.$consolePanel.scroll(0,20);\n      //$LASTPOS=10000990;\n      Tonyu.globals.$consolePanel.setFillStyle("white");\n      //$LASTPOS=10001036;\n      Tonyu.globals.$consolePanel.fillText(pt,0,Tonyu.globals.$consolePrintY,20,"left");\n      \n    }\n  },\n  setAnimFps :function _trc_func_10001104_5(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10001132;\n    _this.animFps=f;\n    //$LASTPOS=10001153;\n    _this.animFrame=0;\n    //$LASTPOS=10001176;\n    _this.animMode=true;\n  },\n  startAnim :function _trc_func_10001200_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10001226;\n    _this.animMode=true;\n  },\n  stopAnim :function _trc_func_10001250_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10001275;\n    _this.animMode=false;\n  },\n  update :function _trc_func_10001300_8() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10001317;\n    _this.onUpdate();\n    //$LASTPOS=10001334;\n    if (null) {\n      //$LASTPOS=10001357;\n      null.suspend();\n      \n    }\n  },\n  fiber$update :function _trc_func_10001300_9(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=10001317;\n    _this.onUpdate();\n    //$LASTPOS=10001334;\n    if (_thread) {\n      //$LASTPOS=10001357;\n      _thread.suspend();\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  onUpdate :function _trc_func_10001387_10() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  updateEx :function _trc_func_10001418_11(updateT) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var updateCount;\n    \n    //$LASTPOS=10001443;\n    //$LASTPOS=10001447;\n    updateCount = 0;\n    while(updateCount<updateT) {\n      {\n        //$LASTPOS=10001510;\n        _this.update();\n      }\n      updateCount++;\n    }\n  },\n  fiber$updateEx :function _trc_func_10001418_12(_thread,updateT) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var updateCount;\n    \n    \n    _thread.enter(function _trc_func_10001418_13(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=10001443;\n          //$LASTPOS=10001447;\n          updateCount = 0;;\n        case 1:\n          if (!(updateCount<updateT)) { __pc=3; break; }\n          //$LASTPOS=10001510;\n          _this.fiber$update(_thread);\n          __pc=2;return;\n        case 2:\n          \n          updateCount++;\n          __pc=1;break;\n        case 3:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  getkey :function _trc_func_10001531_14(k) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Tonyu.globals.$Keys.getkey(k);\n  },\n  hitTo :function _trc_func_10001584_15(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.crashTo(t);\n  },\n  all :function _trc_func_10001631_16(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    \n    //$LASTPOS=10001653;\n    res = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=10001678;\n    Tonyu.globals.$Sprites.sprites.forEach(function (s) {\n      \n      //$LASTPOS=10001719;\n      if (s===_this) {\n        return _this;\n      }\n      //$LASTPOS=10001750;\n      if (! c||s instanceof c) {\n        //$LASTPOS=10001791;\n        res.push(s);\n        \n      }\n    });\n    return res;\n  },\n  allCrash :function _trc_func_10001871_17(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    var sp;\n    var t1;\n    \n    //$LASTPOS=10001898;\n    res = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=10001923;\n    sp = _this;\n    //$LASTPOS=10001960;\n    t1 = _this.getCrashRect();\n    //$LASTPOS=10001988;\n    if (! t1) {\n      return res;\n    }\n    //$LASTPOS=10002014;\n    Tonyu.globals.$Sprites.sprites.forEach(function (s) {\n      var t2;\n      \n      //$LASTPOS=10002055;\n      t2;\n      //$LASTPOS=10002072;\n      if (s!==_this&&! s.excludeFromAll&&s instanceof t&&(t2=s.getCrashRect())&&Math.abs(t1.x-t2.x)*2<t1.width+t2.width&&Math.abs(t1.y-t2.y)*2<t1.height+t2.height) {\n        //$LASTPOS=10002300;\n        res.push(s);\n        \n      }\n    });\n    return res;\n  },\n  crashTo :function _trc_func_10002358_18(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10002384;\n    if (! t) {\n      return false;\n    }\n    //$LASTPOS=10002411;\n    if (typeof  t=="function") {\n      return _this.allCrash(t)[0];\n      \n    }\n    return _this.crashTo1(t);\n  },\n  crashTo1 :function _trc_func_10002507_19(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var t1;\n    var t2;\n    \n    //$LASTPOS=10002534;\n    if (! t||t._isDead) {\n      return false;\n    }\n    //$LASTPOS=10002662;\n    t1 = _this.getCrashRect();\n    //$LASTPOS=10002690;\n    t2 = t.getCrashRect();\n    return t1&&t2&&Math.abs(t1.x-t2.x)*2<t1.width+t2.width&&Math.abs(t1.y-t2.y)*2<t1.height+t2.height;\n  },\n  getCrashRect :function _trc_func_10002973_20() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var actWidth;\n    var actHeight;\n    \n    //$LASTPOS=10003003;\n    actWidth = _this.width*_this.scaleX;actHeight;\n    //$LASTPOS=10003046;\n    if (typeof  _this.scaleY==="undefined") {\n      //$LASTPOS=10003088;\n      actHeight=_this.height*_this.scaleX;\n      \n    } else {\n      //$LASTPOS=10003134;\n      actHeight=_this.height*_this.scaleY;\n      \n    }\n    return typeof  _this.x=="number"&&typeof  _this.y=="number"&&typeof  _this.width=="number"&&typeof  _this.height=="number"&&{x: _this.x,y: _this.y,width: actWidth,height: actHeight};\n  },\n  within :function _trc_func_10003339_21(t,distance) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10003372;\n    if (! t||t._isDead) {\n      return false;\n    }\n    //$LASTPOS=10003411;\n    if (Math.sqrt(Math.abs(_this.x-t.x)*Math.abs(_this.x-t.x)+Math.abs(_this.y-t.y)*Math.abs(_this.y-t.y))<distance) {\n      return true;\n      \n    }\n    return false;\n  },\n  watchHit :function _trc_func_10003553_22(typeA,typeB,onHit) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10003596;\n    Tonyu.globals.$Sprites.watchHit(typeA,typeB,function (a,b) {\n      \n      //$LASTPOS=10003647;\n      onHit.apply(_this,[a,b]);\n    });\n  },\n  currentThreadGroup :function _trc_func_10003685_23() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Tonyu.globals.$currentThreadGroup;\n  },\n  die :function _trc_func_10003754_24() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10003775;\n    if (_this._th) {\n      //$LASTPOS=10003795;\n      _this._th.kill();\n      \n    }\n    //$LASTPOS=10003819;\n    _this.hide();\n    //$LASTPOS=10003832;\n    _this.fireEvent("die");\n    //$LASTPOS=10003855;\n    _this._isDead=true;\n  },\n  hide :function _trc_func_10003873_25() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10004034;\n    if (_this.layer&&typeof  _this.layer.remove=="function") {\n      //$LASTPOS=10004089;\n      _this.layer.remove(_this);\n      \n    } else {\n      //$LASTPOS=10004130;\n      Tonyu.globals.$Sprites.remove(_this);\n      \n    }\n  },\n  show :function _trc_func_10004164_26(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10004191;\n    if (_this.layer&&typeof  _this.layer.add=="function") {\n      //$LASTPOS=10004243;\n      _this.layer.add(_this);\n      \n    } else {\n      //$LASTPOS=10004281;\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    //$LASTPOS=10004313;\n    if (x!=null) {\n      //$LASTPOS=10004326;\n      _this.x=x;\n    }\n    //$LASTPOS=10004341;\n    if (y!=null) {\n      //$LASTPOS=10004354;\n      _this.y=y;\n    }\n    //$LASTPOS=10004369;\n    if (p!=null) {\n      //$LASTPOS=10004382;\n      _this.p=p;\n    }\n  },\n  detectShape :function _trc_func_10004398_27() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10004427;\n    if (typeof  _this.p!="number") {\n      //$LASTPOS=10004462;\n      if (_this.text!=null) {\n        return _this;\n      }\n      //$LASTPOS=10004495;\n      _this.p=0;\n      \n    }\n    //$LASTPOS=10004512;\n    _this.p=Math.floor(_this.p);\n    //$LASTPOS=10004534;\n    _this.pImg=Tonyu.globals.$Sprites.getImageList()[_this.p];\n    //$LASTPOS=10004572;\n    if (! _this.pImg) {\n      return _this;\n    }\n    //$LASTPOS=10004596;\n    _this.width=_this.pImg.width;\n    //$LASTPOS=10004619;\n    _this.height=_this.pImg.height;\n  },\n  waitFor :function _trc_func_10004643_28(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    \n    //$LASTPOS=10004712;\n    _this.update();\n  },\n  fiber$waitFor :function _trc_func_10004643_29(_thread,f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_10004643_30(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          {\n            //$LASTPOS=10004680;\n            _thread.waitFor(f);\n          }\n          //$LASTPOS=10004712;\n          _this.fiber$update(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  isDead :function _trc_func_10004726_31() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this._isDead;\n  },\n  animation :function _trc_func_10004772_32() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10004798;\n    _this.age++;\n    //$LASTPOS=10004810;\n    if (_this.animMode&&_this.age%_this.animFps==0) {\n      //$LASTPOS=10004851;\n      _this.p=_this.anim[_this.animFrame%_this.anim.length];\n      //$LASTPOS=10004891;\n      _this.animFrame++;\n      \n    }\n  },\n  draw :function _trc_func_10004915_33(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var rect;\n    \n    //$LASTPOS=10004940;\n    if (_this.x==null||_this.y==null||_this._isInvisible) {\n      return _this;\n    }\n    //$LASTPOS=10004993;\n    _this.detectShape();\n    //$LASTPOS=10005013;\n    if (_this.pImg) {\n      //$LASTPOS=10005034;\n      ctx.save();\n      //$LASTPOS=10005055;\n      ctx.translate(_this.x,_this.y);\n      //$LASTPOS=10005199;\n      _this.animation();\n      //$LASTPOS=10005221;\n      if (_this.rotation!=0) {\n        //$LASTPOS=10005256;\n        ctx.rotate(_this.rotation/180*Math.PI);\n        \n      } else {\n        //$LASTPOS=10005324;\n        ctx.rotate(_this.rotate/180*Math.PI);\n        \n      }\n      //$LASTPOS=10005381;\n      if (typeof  _this.scaleY==="undefined") {\n        //$LASTPOS=10005433;\n        ctx.scale(_this.scaleX,_this.scaleX);\n        \n      } else {\n        //$LASTPOS=10005498;\n        ctx.scale(_this.scaleX,_this.scaleY);\n        \n      }\n      //$LASTPOS=10005554;\n      ctx.globalAlpha=_this.alpha/255;\n      //$LASTPOS=10005595;\n      ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.width/2,- _this.height/2,_this.width,_this.height);\n      //$LASTPOS=10005727;\n      ctx.restore();\n      \n    } else {\n      //$LASTPOS=10005754;\n      if (_this.text!==null&&_this.text!==undefined) {\n        //$LASTPOS=10005802;\n        if (! _this.size) {\n          //$LASTPOS=10005813;\n          _this.size=15;\n        }\n        //$LASTPOS=10005831;\n        if (! _this.align) {\n          //$LASTPOS=10005843;\n          _this.align="center";\n        }\n        //$LASTPOS=10005868;\n        if (! _this.fillStyle) {\n          //$LASTPOS=10005884;\n          _this.fillStyle="white";\n        }\n        //$LASTPOS=10005912;\n        ctx.fillStyle=_this.fillStyle;\n        //$LASTPOS=10005946;\n        ctx.globalAlpha=_this.alpha/255;\n        //$LASTPOS=10005987;\n        rect = _this.drawTextRect(ctx,_this.text,_this.x,_this.y,_this.size,_this.align,"fill");\n        //$LASTPOS=10006058;\n        _this.width=rect.w;\n        //$LASTPOS=10006081;\n        _this.height=rect.h;\n        \n      }\n    }\n    //$LASTPOS=10006108;\n    if (_this._fukidashi) {\n      //$LASTPOS=10006135;\n      if (_this._fukidashi.c>0) {\n        //$LASTPOS=10006170;\n        _this._fukidashi.c--;\n        //$LASTPOS=10006199;\n        ctx.fillStyle="white";\n        //$LASTPOS=10006235;\n        ctx.strokeStyle="black";\n        //$LASTPOS=10006273;\n        _this.fukidashi(ctx,_this._fukidashi.text,_this.x,_this.y-_this.height/2-10,_this._fukidashi.size);\n        \n      }\n      \n    }\n  },\n  asyncResult :function _trc_func_10006380_34() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Tonyu.asyncResult();\n  },\n  screenOut :function _trc_func_10006443_35(a) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var r;\n    var viewX;\n    var viewY;\n    \n    //$LASTPOS=10006496;\n    if (! a) {\n      //$LASTPOS=10006504;\n      a=0;\n    }\n    //$LASTPOS=10006514;\n    r = 0;\n    //$LASTPOS=10006528;\n    viewX = 0;viewY = 0;\n    //$LASTPOS=10006554;\n    if (_this.x<viewX+a) {\n      //$LASTPOS=10006583;\n      r+=viewX+a-_this.x;\n    }\n    //$LASTPOS=10006602;\n    if (_this.y<viewY+a) {\n      //$LASTPOS=10006631;\n      r+=viewY+a-_this.y;\n    }\n    //$LASTPOS=10006650;\n    if (_this.x>Tonyu.globals.$screenWidth+viewX-a) {\n      //$LASTPOS=10006679;\n      r+=_this.x-(Tonyu.globals.$screenWidth+viewX-a);\n    }\n    //$LASTPOS=10006714;\n    if (_this.y>Tonyu.globals.$screenHeight+viewY-a) {\n      //$LASTPOS=10006743;\n      r+=_this.y-(Tonyu.globals.$screenHeight+viewY-a);\n    }\n    return r;\n  },\n  fiber$screenOut :function _trc_func_10006443_36(_thread,a) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var r;\n    var viewX;\n    var viewY;\n    \n    //$LASTPOS=10006496;\n    if (! a) {\n      //$LASTPOS=10006504;\n      a=0;\n    }\n    //$LASTPOS=10006514;\n    r = 0;\n    //$LASTPOS=10006528;\n    viewX = 0;viewY = 0;\n    //$LASTPOS=10006554;\n    if (_this.x<viewX+a) {\n      //$LASTPOS=10006583;\n      r+=viewX+a-_this.x;\n    }\n    //$LASTPOS=10006602;\n    if (_this.y<viewY+a) {\n      //$LASTPOS=10006631;\n      r+=viewY+a-_this.y;\n    }\n    //$LASTPOS=10006650;\n    if (_this.x>Tonyu.globals.$screenWidth+viewX-a) {\n      //$LASTPOS=10006679;\n      r+=_this.x-(Tonyu.globals.$screenWidth+viewX-a);\n    }\n    //$LASTPOS=10006714;\n    if (_this.y>Tonyu.globals.$screenHeight+viewY-a) {\n      //$LASTPOS=10006743;\n      r+=_this.y-(Tonyu.globals.$screenHeight+viewY-a);\n    }\n    _thread.retVal=r;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  file :function _trc_func_10006792_37(path) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var d;\n    var files;\n    \n    //$LASTPOS=10006811;\n    d = Tonyu.currentProject.getDir();\n    //$LASTPOS=10006853;\n    files = d.rel("files/");\n    return FS.get(files.rel(path),{topDir: d});\n  },\n  fiber$file :function _trc_func_10006792_38(_thread,path) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var d;\n    var files;\n    \n    //$LASTPOS=10006811;\n    d = Tonyu.currentProject.getDir();\n    //$LASTPOS=10006853;\n    files = d.rel("files/");\n    _thread.retVal=FS.get(files.rel(path),{topDir: d});return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  waitInputDevice :function _trc_func_10006932_39(fl) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10006960;\n    if (fl!==false) {\n      //$LASTPOS=10006987;\n      if (! _this.origTG) {\n        \n        \n      }\n      //$LASTPOS=10007139;\n      _this.a=_this.asyncResult();\n      //$LASTPOS=10007165;\n      Tonyu.globals.$InputDevice.addOnetimeListener(_this.a.receiver);\n      //$LASTPOS=10007219;\n      _this.waitFor(_this.a);\n      \n    } else {\n      //$LASTPOS=10007254;\n      if (_this.origTG) {\n        \n        \n      }\n      \n    }\n  },\n  fiber$waitInputDevice :function _trc_func_10006932_40(_thread,fl) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_10006932_41(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=10006960;\n          if (!(fl!==false)) { __pc=3; break; }\n          //$LASTPOS=10006987;\n          if (!(! _this.origTG)) { __pc=1; break; }\n          {\n            //$LASTPOS=10007041;\n            _this.origTG=_thread.group;\n            //$LASTPOS=10007080;\n            _thread.setGroup(null);\n          }\n        case 1:\n          \n          //$LASTPOS=10007139;\n          _this.a=_this.asyncResult();\n          //$LASTPOS=10007165;\n          Tonyu.globals.$InputDevice.addOnetimeListener(_this.a.receiver);\n          //$LASTPOS=10007219;\n          _this.fiber$waitFor(_thread, _this.a);\n          __pc=2;return;\n        case 2:\n          \n          __pc=5;break;\n        case 3:\n          //$LASTPOS=10007254;\n          if (!(_this.origTG)) { __pc=4; break; }\n          {\n            //$LASTPOS=10007307;\n            _thread.setGroup(_this.origTG);\n            //$LASTPOS=10007350;\n            _this.origTG=null;\n          }\n        case 4:\n          \n        case 5:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  redrawScreen :function _trc_func_10007400_42() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10007423;\n    Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n    //$LASTPOS=10007459;\n    Tonyu.globals.$Screen.draw();\n  },\n  fiber$redrawScreen :function _trc_func_10007400_43(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=10007423;\n    Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n    //$LASTPOS=10007459;\n    Tonyu.globals.$Screen.draw();\n    \n    _thread.retVal=_this;return;\n  },\n  color :function _trc_func_10007500_44(r,g,b) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return "rgb("+[r,g,b].join(",")+")";\n  },\n  fiber$color :function _trc_func_10007500_45(_thread,r,g,b) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal="rgb("+[r,g,b].join(",")+")";return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  drawText :function _trc_func_10007562_46(x,y,text,col,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var tp;\n    \n    //$LASTPOS=10007598;\n    if (Tonyu.globals.$debug) {\n      return _this;\n    }\n    //$LASTPOS=10007623;\n    if (! size) {\n      //$LASTPOS=10007634;\n      size=15;\n    }\n    //$LASTPOS=10007648;\n    if (! col) {\n      //$LASTPOS=10007658;\n      col="cyan";\n    }\n    //$LASTPOS=10007675;\n    tp = _this.all(Tonyu.classes.kernel.T1Text).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=10007729;\n    if (tp.length>0) {\n      //$LASTPOS=10007757;\n      tp[0].extend({x: x,y: y,text: text,fillStyle: col,size: size,hidden: false});\n      \n    } else {\n      //$LASTPOS=10007836;\n      new Tonyu.classes.kernel.T1Text({x: x,y: y,text: text,fillStyle: col,size: size});\n      \n    }\n  },\n  fiber$drawText :function _trc_func_10007562_47(_thread,x,y,text,col,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var tp;\n    \n    //$LASTPOS=10007598;\n    if (Tonyu.globals.$debug) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=10007623;\n    if (! size) {\n      //$LASTPOS=10007634;\n      size=15;\n    }\n    //$LASTPOS=10007648;\n    if (! col) {\n      //$LASTPOS=10007658;\n      col="cyan";\n    }\n    //$LASTPOS=10007675;\n    tp = _this.all(Tonyu.classes.kernel.T1Text).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=10007729;\n    if (tp.length>0) {\n      //$LASTPOS=10007757;\n      tp[0].extend({x: x,y: y,text: text,fillStyle: col,size: size,hidden: false});\n      \n    } else {\n      //$LASTPOS=10007836;\n      new Tonyu.classes.kernel.T1Text({x: x,y: y,text: text,fillStyle: col,size: size});\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  drawLine :function _trc_func_10007891_48(x,y,tx,ty,col) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var tp;\n    \n    //$LASTPOS=10007923;\n    if (! col) {\n      //$LASTPOS=10007933;\n      col="white";\n    }\n    //$LASTPOS=10007951;\n    tp = _this.all(Tonyu.classes.kernel.T1Line).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=10008005;\n    if (tp.length>0) {\n      //$LASTPOS=10008033;\n      tp[0].extend({x: x,y: y,tx: tx,ty: ty,col: col,hidden: false});\n      \n    } else {\n      //$LASTPOS=10008098;\n      new Tonyu.classes.kernel.T1Line({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    }\n  },\n  fiber$drawLine :function _trc_func_10007891_49(_thread,x,y,tx,ty,col) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var tp;\n    \n    //$LASTPOS=10007923;\n    if (! col) {\n      //$LASTPOS=10007933;\n      col="white";\n    }\n    //$LASTPOS=10007951;\n    tp = _this.all(Tonyu.classes.kernel.T1Line).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=10008005;\n    if (tp.length>0) {\n      //$LASTPOS=10008033;\n      tp[0].extend({x: x,y: y,tx: tx,ty: ty,col: col,hidden: false});\n      \n    } else {\n      //$LASTPOS=10008098;\n      new Tonyu.classes.kernel.T1Line({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  loadPage :function _trc_func_10008138_50(page,arg) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10008164;\n    _this.all().die();\n    //$LASTPOS=10008182;\n    new page(arg);\n    //$LASTPOS=10008202;\n    _this.die();\n  },\n  fiber$loadPage :function _trc_func_10008138_51(_thread,page,arg) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=10008164;\n    _this.all().die();\n    //$LASTPOS=10008182;\n    new page(arg);\n    //$LASTPOS=10008202;\n    _this.die();\n    \n    _thread.retVal=_this;return;\n  },\n  setVisible :function _trc_func_10008215_52(v) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10008237;\n    _this._isInvisible=! v;\n  },\n  fiber$setVisible :function _trc_func_10008215_53(_thread,v) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=10008237;\n    _this._isInvisible=! v;\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.BaseActor,{"fullName":"kernel.BaseActor","namespace":"kernel","shortName":"BaseActor","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"extend":{"nowait":true},"print":{"nowait":true},"setAnimFps":{"nowait":true},"startAnim":{"nowait":true},"stopAnim":{"nowait":true},"update":{"nowait":false},"onUpdate":{"nowait":true},"updateEx":{"nowait":false},"getkey":{"nowait":true},"hitTo":{"nowait":true},"all":{"nowait":true},"allCrash":{"nowait":true},"crashTo":{"nowait":true},"crashTo1":{"nowait":true},"getCrashRect":{"nowait":true},"within":{"nowait":true},"watchHit":{"nowait":true},"currentThreadGroup":{"nowait":true},"die":{"nowait":true},"hide":{"nowait":true},"show":{"nowait":true},"detectShape":{"nowait":true},"waitFor":{"nowait":false},"isDead":{"nowait":true},"animation":{"nowait":true},"draw":{"nowait":true},"asyncResult":{"nowait":true},"screenOut":{"nowait":false},"file":{"nowait":false},"waitInputDevice":{"nowait":false},"redrawScreen":{"nowait":false},"color":{"nowait":false},"drawText":{"nowait":false},"drawLine":{"nowait":false},"loadPage":{"nowait":false},"setVisible":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Keys=Tonyu.klass(Tonyu.classes.kernel.TObject,[],{\n  main :function _trc_func_11000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    \n    //$LASTPOS=11000084;\n    _this.stats={};\n    //$LASTPOS=11000094;\n    _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,mouseleft: 1};\n    //$LASTPOS=11000212;\n    //$LASTPOS=11000217;\n    i = 65;\n    while(i<65+26) {\n      {\n        //$LASTPOS=11000248;\n        _this.codes[String.fromCharCode(i).toLowerCase()]=i;\n      }\n      i++;\n    }\n    //$LASTPOS=11000297;\n    //$LASTPOS=11000302;\n    i = 48;\n    while(i<58) {\n      {\n        //$LASTPOS=11000330;\n        _this.codes[String.fromCharCode(i)]=i;\n      }\n      i++;\n    }\n    //$LASTPOS=11000365;\n    if (! $.data(document,"key_event")) {\n      //$LASTPOS=11000406;\n      $.data(document,"key_event",true);\n      //$LASTPOS=11000445;\n      $(document).keydown(function (e) {\n        \n        //$LASTPOS=11000471;\n        Tonyu.globals.$Keys.keydown(e);\n      });\n      //$LASTPOS=11000495;\n      $(document).keyup(function (e) {\n        \n        //$LASTPOS=11000519;\n        Tonyu.globals.$Keys.keyup(e);\n      });\n      //$LASTPOS=11000541;\n      $(document).mousedown(function (e) {\n        \n        //$LASTPOS=11000578;\n        if (Tonyu.globals.$InputDevice.touchEmu) {\n          //$LASTPOS=11000619;\n          Tonyu.globals.$touches[0].touched=1;\n          \n        }\n        //$LASTPOS=11000660;\n        Tonyu.globals.$Keys.keydown({keyCode: 1});\n      });\n      //$LASTPOS=11000697;\n      $(document).mouseup(function (e) {\n        \n        //$LASTPOS=11000732;\n        if (Tonyu.globals.$InputDevice.touchEmu) {\n          //$LASTPOS=11000773;\n          Tonyu.globals.$touches[0].touched=0;\n          \n        }\n        //$LASTPOS=11000814;\n        Tonyu.globals.$Keys.keyup({keyCode: 1});\n      });\n      \n    }\n  },\n  fiber$main :function _trc_func_11000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    \n    //$LASTPOS=11000084;\n    _this.stats={};\n    //$LASTPOS=11000094;\n    _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,mouseleft: 1};\n    //$LASTPOS=11000212;\n    //$LASTPOS=11000217;\n    i = 65;\n    while(i<65+26) {\n      {\n        //$LASTPOS=11000248;\n        _this.codes[String.fromCharCode(i).toLowerCase()]=i;\n      }\n      i++;\n    }\n    //$LASTPOS=11000297;\n    //$LASTPOS=11000302;\n    i = 48;\n    while(i<58) {\n      {\n        //$LASTPOS=11000330;\n        _this.codes[String.fromCharCode(i)]=i;\n      }\n      i++;\n    }\n    //$LASTPOS=11000365;\n    if (! $.data(document,"key_event")) {\n      //$LASTPOS=11000406;\n      $.data(document,"key_event",true);\n      //$LASTPOS=11000445;\n      $(document).keydown(function (e) {\n        \n        //$LASTPOS=11000471;\n        Tonyu.globals.$Keys.keydown(e);\n      });\n      //$LASTPOS=11000495;\n      $(document).keyup(function (e) {\n        \n        //$LASTPOS=11000519;\n        Tonyu.globals.$Keys.keyup(e);\n      });\n      //$LASTPOS=11000541;\n      $(document).mousedown(function (e) {\n        \n        //$LASTPOS=11000578;\n        if (Tonyu.globals.$InputDevice.touchEmu) {\n          //$LASTPOS=11000619;\n          Tonyu.globals.$touches[0].touched=1;\n          \n        }\n        //$LASTPOS=11000660;\n        Tonyu.globals.$Keys.keydown({keyCode: 1});\n      });\n      //$LASTPOS=11000697;\n      $(document).mouseup(function (e) {\n        \n        //$LASTPOS=11000732;\n        if (Tonyu.globals.$InputDevice.touchEmu) {\n          //$LASTPOS=11000773;\n          Tonyu.globals.$touches[0].touched=0;\n          \n        }\n        //$LASTPOS=11000814;\n        Tonyu.globals.$Keys.keyup({keyCode: 1});\n      });\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  getkey :function _trc_func_11000847_2(code) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11000875;\n    if (typeof  code=="string") {\n      //$LASTPOS=11000912;\n      code=_this.codes[code.toLowerCase()];\n      \n    }\n    //$LASTPOS=11000954;\n    if (! code) {\n      return 0;\n    }\n    //$LASTPOS=11000979;\n    if (_this.stats[code]==- 1) {\n      return 0;\n    }\n    //$LASTPOS=11001014;\n    if (! _this.stats[code]) {\n      //$LASTPOS=11001032;\n      _this.stats[code]=0;\n    }\n    return _this.stats[code];\n  },\n  fiber$getkey :function _trc_func_11000847_3(_thread,code) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=11000875;\n    if (typeof  code=="string") {\n      //$LASTPOS=11000912;\n      code=_this.codes[code.toLowerCase()];\n      \n    }\n    //$LASTPOS=11000954;\n    if (! code) {\n      _thread.retVal=0;return;\n      \n    }\n    //$LASTPOS=11000979;\n    if (_this.stats[code]==- 1) {\n      _thread.retVal=0;return;\n      \n    }\n    //$LASTPOS=11001014;\n    if (! _this.stats[code]) {\n      //$LASTPOS=11001032;\n      _this.stats[code]=0;\n    }\n    _thread.retVal=_this.stats[code];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  update :function _trc_func_11001073_4() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    var _it_128;\n    \n    //$LASTPOS=11001097;\n    _it_128=Tonyu.iterator(_this.stats,1);\n    while(_it_128.next()) {\n      i=_it_128[0];\n      \n      //$LASTPOS=11001128;\n      if (_this.stats[i]>0) {\n        //$LASTPOS=11001145;\n        _this.stats[i]++;\n        \n      }\n      //$LASTPOS=11001166;\n      if (_this.stats[i]==- 1) {\n        //$LASTPOS=11001184;\n        _this.stats[i]=1;\n      }\n      \n    }\n  },\n  fiber$update :function _trc_func_11001073_5(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    var _it_128;\n    \n    //$LASTPOS=11001097;\n    _it_128=Tonyu.iterator(_this.stats,1);\n    while(_it_128.next()) {\n      i=_it_128[0];\n      \n      //$LASTPOS=11001128;\n      if (_this.stats[i]>0) {\n        //$LASTPOS=11001145;\n        _this.stats[i]++;\n        \n      }\n      //$LASTPOS=11001166;\n      if (_this.stats[i]==- 1) {\n        //$LASTPOS=11001184;\n        _this.stats[i]=1;\n      }\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  keydown :function _trc_func_11001204_6(e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var s;\n    \n    //$LASTPOS=11001222;\n    s = _this.stats[e.keyCode];\n    //$LASTPOS=11001250;\n    if (! s) {\n      //$LASTPOS=11001268;\n      _this.stats[e.keyCode]=1;\n      \n    }\n    //$LASTPOS=11001298;\n    Tonyu.globals.$InputDevice.handleListeners();\n  },\n  fiber$keydown :function _trc_func_11001204_7(_thread,e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var s;\n    \n    //$LASTPOS=11001222;\n    s = _this.stats[e.keyCode];\n    //$LASTPOS=11001250;\n    if (! s) {\n      //$LASTPOS=11001268;\n      _this.stats[e.keyCode]=1;\n      \n    }\n    //$LASTPOS=11001298;\n    Tonyu.globals.$InputDevice.handleListeners();\n    \n    _thread.retVal=_this;return;\n  },\n  keyup :function _trc_func_11001332_8(e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11001348;\n    _this.stats[e.keyCode]=0;\n    //$LASTPOS=11001372;\n    Tonyu.globals.$InputDevice.handleListeners();\n  },\n  fiber$keyup :function _trc_func_11001332_9(_thread,e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=11001348;\n    _this.stats[e.keyCode]=0;\n    //$LASTPOS=11001372;\n    Tonyu.globals.$InputDevice.handleListeners();\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Keys,{"fullName":"kernel.Keys","namespace":"kernel","shortName":"Keys","decls":{"methods":{"main":{"nowait":false},"getkey":{"nowait":false},"update":{"nowait":false},"keydown":{"nowait":false},"keyup":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.MML=Tonyu.klass(Tonyu.classes.kernel.TObject,[Tonyu.classes.kernel.MathMod],{\n  main :function _trc_func_12000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=12000050;\n    _this.mmlBuf=[];\n  },\n  fiber$main :function _trc_func_12000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=12000050;\n    _this.mmlBuf=[];\n    \n    _thread.retVal=_this;return;\n  },\n  play :function _trc_func_12000062_2(mmls) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=12000081;\n    _this.mmlBuf.push(mmls);\n    //$LASTPOS=12000105;\n    if (! _this.isPlaying()) {\n      //$LASTPOS=12000134;\n      _this.playNext();\n      \n    }\n  },\n  fiber$play :function _trc_func_12000062_3(_thread,mmls) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=12000081;\n    _this.mmlBuf.push(mmls);\n    \n    _thread.enter(function _trc_func_12000062_4(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=12000105;\n          if (!(! _this.isPlaying())) { __pc=2; break; }\n          //$LASTPOS=12000134;\n          _this.fiber$playNext(_thread);\n          __pc=1;return;\n        case 1:\n          \n        case 2:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  playNext :function _trc_func_12000157_5() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var mml;\n    \n    //$LASTPOS=12000220;\n    if (_this.cTimeBase==null) {\n      //$LASTPOS=12000241;\n      _this.cTimeBase=0;\n    }\n    //$LASTPOS=12000259;\n    if (_this.m) {\n      //$LASTPOS=12000277;\n      _this.cTimeBase+=_this.m.currentTime;\n      \n    }\n    //$LASTPOS=12000348;\n    mml = _this.mmlBuf.shift();\n    //$LASTPOS=12000377;\n    if (! mml) {\n      //$LASTPOS=12000398;\n      _this.m=null;\n      //$LASTPOS=12000415;\n      _this.cTimeBase=0;\n      return _this;\n      \n    }\n    //$LASTPOS=12000457;\n    _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();\n    //$LASTPOS=12000495;\n    _this.m=T("mml",{mml: mml},_this.mwav);\n    //$LASTPOS=12000525;\n    _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));\n    //$LASTPOS=12000555;\n    _this.m.start();\n    //$LASTPOS=12000571;\n    Tonyu.globals.$MMLS[_this.id()]=_this;\n  },\n  fiber$playNext :function _trc_func_12000157_6(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var mml;\n    \n    //$LASTPOS=12000220;\n    if (_this.cTimeBase==null) {\n      //$LASTPOS=12000241;\n      _this.cTimeBase=0;\n    }\n    //$LASTPOS=12000259;\n    if (_this.m) {\n      //$LASTPOS=12000277;\n      _this.cTimeBase+=_this.m.currentTime;\n      \n    }\n    //$LASTPOS=12000348;\n    mml = _this.mmlBuf.shift();\n    //$LASTPOS=12000377;\n    if (! mml) {\n      //$LASTPOS=12000398;\n      _this.m=null;\n      //$LASTPOS=12000415;\n      _this.cTimeBase=0;\n      _thread.retVal=_this;return;\n      \n      \n    }\n    //$LASTPOS=12000457;\n    _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();\n    //$LASTPOS=12000495;\n    _this.m=T("mml",{mml: mml},_this.mwav);\n    //$LASTPOS=12000525;\n    _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));\n    //$LASTPOS=12000555;\n    _this.m.start();\n    //$LASTPOS=12000571;\n    Tonyu.globals.$MMLS[_this.id()]=_this;\n    \n    _thread.retVal=_this;return;\n  },\n  id :function _trc_func_12000593_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=12000606;\n    if (! _this._id) {\n      //$LASTPOS=12000616;\n      _this._id=_this.rnd()+"";\n    }\n    return _this._id;\n  },\n  fiber$id :function _trc_func_12000593_8(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=12000606;\n    if (! _this._id) {\n      //$LASTPOS=12000616;\n      _this._id=_this.rnd()+"";\n    }\n    _thread.retVal=_this._id;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  bufferCount :function _trc_func_12000651_9() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.mmlBuf.length;\n  },\n  fiber$bufferCount :function _trc_func_12000651_10(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.mmlBuf.length;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  isPlaying :function _trc_func_12000699_11() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.m;\n  },\n  fiber$isPlaying :function _trc_func_12000699_12(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.m;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  currentTime :function _trc_func_12000733_13() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=12000755;\n    if (_this.m) {\n      return _this.m.currentTime+_this.cTimeBase;\n    }\n    return - 1;\n  },\n  fiber$currentTime :function _trc_func_12000733_14(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=12000755;\n    if (_this.m) {\n      _thread.retVal=_this.m.currentTime+_this.cTimeBase;return;\n      \n    }\n    _thread.retVal=- 1;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  stop :function _trc_func_12000814_15() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=12000829;\n    if (_this.m) {\n      //$LASTPOS=12000847;\n      if (_this.mwav) {\n        //$LASTPOS=12000872;\n        _this.mwav.pause();\n        //$LASTPOS=12000899;\n        _this.mwav.stop();\n        \n      }\n      //$LASTPOS=12000932;\n      _this.m.pause();\n      //$LASTPOS=12000952;\n      _this.m.stop();\n      //$LASTPOS=12000971;\n      _this.m=null;\n      //$LASTPOS=12000988;\n      _this.mmlBuf=[];\n      //$LASTPOS=12001056;\n      delete Tonyu.globals.$MMLS[_this.id()];\n      \n    }\n  },\n  fiber$stop :function _trc_func_12000814_16(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=12000829;\n    if (_this.m) {\n      //$LASTPOS=12000847;\n      if (_this.mwav) {\n        //$LASTPOS=12000872;\n        _this.mwav.pause();\n        //$LASTPOS=12000899;\n        _this.mwav.stop();\n        \n      }\n      //$LASTPOS=12000932;\n      _this.m.pause();\n      //$LASTPOS=12000952;\n      _this.m.stop();\n      //$LASTPOS=12000971;\n      _this.m=null;\n      //$LASTPOS=12000988;\n      _this.mmlBuf=[];\n      //$LASTPOS=12001056;\n      delete Tonyu.globals.$MMLS[_this.id()];\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.MML,{"fullName":"kernel.MML","namespace":"kernel","shortName":"MML","decls":{"methods":{"main":{"nowait":false},"play":{"nowait":false},"playNext":{"nowait":false},"id":{"nowait":false},"bufferCount":{"nowait":false},"isPlaying":{"nowait":false},"currentTime":{"nowait":false},"stop":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.NoviceActor=Tonyu.klass(Tonyu.classes.kernel.BaseActor,[],{\n  main :function _trc_func_13000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_13000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  sleep :function _trc_func_13000034_2(n) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=13000050;\n    if (! n) {\n      //$LASTPOS=13000057;\n      n=1;\n    }\n    //$LASTPOS=13000066;\n    //$LASTPOS=13000070;\n    n;\n    while(n>0) {\n      //$LASTPOS=13000081;\n      _this.update();\n      n--;\n    }\n  },\n  fiber$sleep :function _trc_func_13000034_3(_thread,n) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=13000050;\n    if (! n) {\n      //$LASTPOS=13000057;\n      n=1;\n    }\n    \n    _thread.enter(function _trc_func_13000034_4(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=13000066;\n          //$LASTPOS=13000070;\n          n;;\n        case 1:\n          if (!(n>0)) { __pc=3; break; }\n          //$LASTPOS=13000081;\n          _this.fiber$update(_thread);\n          __pc=2;return;\n        case 2:\n          \n          n--;\n          __pc=1;break;\n        case 3:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initSprite :function _trc_func_13000093_5() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=13000113;\n    if (! _this._sprite) {\n      //$LASTPOS=13000137;\n      _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});\n      //$LASTPOS=13000207;\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n  },\n  fiber$initSprite :function _trc_func_13000093_6(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=13000113;\n    if (! _this._sprite) {\n      //$LASTPOS=13000137;\n      _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});\n      //$LASTPOS=13000207;\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  say :function _trc_func_13000235_7(text,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=13000257;\n    if (! size) {\n      //$LASTPOS=13000268;\n      size=15;\n    }\n    //$LASTPOS=13000281;\n    _this.initSprite();\n    //$LASTPOS=13000299;\n    _this._sprite._fukidashi={text: text,size: size,c: 30};\n  },\n  fiber$say :function _trc_func_13000235_8(_thread,text,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=13000257;\n    if (! size) {\n      //$LASTPOS=13000268;\n      size=15;\n    }\n    \n    _thread.enter(function _trc_func_13000235_9(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=13000281;\n          _this.fiber$initSprite(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=13000299;\n          _this._sprite._fukidashi={text: text,size: size,c: 30};\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  sprite :function _trc_func_13000350_10(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=13000371;\n    _this.go(x,y,p);\n  },\n  fiber$sprite :function _trc_func_13000350_11(_thread,x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_13000350_12(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=13000371;\n          _this.fiber$go(_thread, x, y, p);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  show :function _trc_func_13000384_13(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=13000403;\n    _this.go(x,y,p);\n  },\n  draw :function _trc_func_13000416_14(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=13000440;\n    _this._sprite.draw(ctx);\n  },\n  getCrashRect :function _trc_func_13000461_15() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this._sprite.getCrashRect();\n  },\n  go :function _trc_func_13000516_16(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=13000533;\n    _this.initSprite();\n    //$LASTPOS=13000551;\n    _this._sprite.x=x;\n    //$LASTPOS=13000568;\n    _this._sprite.y=y;\n    //$LASTPOS=13000585;\n    if (p!=null) {\n      //$LASTPOS=13000598;\n      _this._sprite.p=p;\n    }\n  },\n  fiber$go :function _trc_func_13000516_17(_thread,x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_13000516_18(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=13000533;\n          _this.fiber$initSprite(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=13000551;\n          _this._sprite.x=x;\n          //$LASTPOS=13000568;\n          _this._sprite.y=y;\n          //$LASTPOS=13000585;\n          if (p!=null) {\n            //$LASTPOS=13000598;\n            _this._sprite.p=p;\n          }\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  change :function _trc_func_13000629_19(p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=13000646;\n    _this.initSprite();\n    //$LASTPOS=13000664;\n    _this._sprite.p=p;\n  },\n  fiber$change :function _trc_func_13000629_20(_thread,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_13000629_21(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=13000646;\n          _this.fiber$initSprite(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=13000664;\n          _this._sprite.p=p;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.NoviceActor,{"fullName":"kernel.NoviceActor","namespace":"kernel","shortName":"NoviceActor","decls":{"methods":{"main":{"nowait":false},"sleep":{"nowait":false},"initSprite":{"nowait":false},"say":{"nowait":false},"sprite":{"nowait":false},"show":{"nowait":true},"draw":{"nowait":true},"getCrashRect":{"nowait":true},"go":{"nowait":false},"change":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.PlayMod=Tonyu.klass(Tonyu.classes.kernel.BaseActor,[],{\n  main :function _trc_func_14000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_14000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initMML :function _trc_func_14000020_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=14000045;\n    if (_this.mmlInited) {\n      return _this;\n    }\n    //$LASTPOS=14000073;\n    _this.mmlInited=true;\n    //$LASTPOS=14000094;\n    Tonyu.globals.$currentProject.requestPlugin("timbre");\n    //$LASTPOS=14000140;\n    if (! Tonyu.globals.$MMLS) {\n      //$LASTPOS=14000162;\n      Tonyu.globals.$MMLS={};\n      //$LASTPOS=14000180;\n      Tonyu.globals.$WaveTable=new Tonyu.classes.kernel.WaveTable;\n      //$LASTPOS=14000214;\n      Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseMML));\n      \n    }\n    //$LASTPOS=14000256;\n    _this.on("die",function () {\n      \n      //$LASTPOS=14000272;\n      _this.play().stop();\n    });\n  },\n  releaseMML :function _trc_func_14000294_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var k;\n    var v;\n    var _it_133;\n    \n    //$LASTPOS=14000322;\n    if (Tonyu.globals.$MMLS) {\n      //$LASTPOS=14000343;\n      _it_133=Tonyu.iterator(Tonyu.globals.$MMLS,2);\n      while(_it_133.next()) {\n        k=_it_133[0];\n        v=_it_133[1];\n        \n        //$LASTPOS=14000379;\n        v.stop();\n        \n      }\n      //$LASTPOS=14000407;\n      Tonyu.globals.$MMLS=null;\n      \n    }\n    //$LASTPOS=14000432;\n    if (Tonyu.globals.$WaveTable) {\n      //$LASTPOS=14000458;\n      Tonyu.globals.$WaveTable.stop();\n      //$LASTPOS=14000485;\n      Tonyu.globals.$WaveTable=null;\n      \n    }\n  },\n  play :function _trc_func_14000513_4() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var mmls;\n    var i;\n    \n    //$LASTPOS=14000528;\n    _this.initMML();\n    //$LASTPOS=14000544;\n    if (! _this._mml) {\n      //$LASTPOS=14000555;\n      _this._mml=new Tonyu.classes.kernel.MML;\n    }\n    //$LASTPOS=14000574;\n    if (_this.isDead()||arguments.length==0) {\n      return _this._mml;\n    }\n    //$LASTPOS=14000629;\n    mmls = [];\n    //$LASTPOS=14000647;\n    //$LASTPOS=14000652;\n    i = 0;\n    while(i<arguments.length) {\n      {\n        //$LASTPOS=14000697;\n        mmls.push(arguments[i]);\n      }\n      i++;\n    }\n    //$LASTPOS=14000734;\n    _this._mml.play(mmls);\n    //$LASTPOS=14000756;\n    while (_this._mml.bufferCount()>2) {\n      //$LASTPOS=14000796;\n      _this.update();\n      \n    }\n    return _this._mml;\n  },\n  fiber$play :function _trc_func_14000513_5(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var mmls;\n    var i;\n    \n    //$LASTPOS=14000528;\n    _this.initMML();\n    //$LASTPOS=14000544;\n    if (! _this._mml) {\n      //$LASTPOS=14000555;\n      _this._mml=new Tonyu.classes.kernel.MML;\n    }\n    //$LASTPOS=14000574;\n    if (_this.isDead()||_arguments.length==0) {\n      _thread.retVal=_this._mml;return;\n      \n    }\n    //$LASTPOS=14000629;\n    mmls = [];\n    //$LASTPOS=14000647;\n    //$LASTPOS=14000652;\n    i = 0;\n    while(i<_arguments.length) {\n      {\n        //$LASTPOS=14000697;\n        mmls.push(_arguments[i]);\n      }\n      i++;\n    }\n    //$LASTPOS=14000734;\n    _this._mml.play(mmls);\n    \n    _thread.enter(function _trc_func_14000513_6(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=14000756;\n        case 1:\n          if (!(_this._mml.bufferCount()>2)) { __pc=3; break; }\n          //$LASTPOS=14000796;\n          _this.fiber$update(_thread);\n          __pc=2;return;\n        case 2:\n          \n          __pc=1;break;\n        case 3:\n          \n          _thread.exit(_this._mml);return;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  playSE :function _trc_func_14000835_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var mml;\n    var mmls;\n    var i;\n    \n    //$LASTPOS=14000859;\n    _this.initMML();\n    //$LASTPOS=14000875;\n    mml = new Tonyu.classes.kernel.MML;\n    //$LASTPOS=14000897;\n    mmls = [];\n    //$LASTPOS=14000915;\n    //$LASTPOS=14000920;\n    i = 0;\n    while(i<arguments.length) {\n      {\n        //$LASTPOS=14000965;\n        mmls.push(arguments[i]);\n      }\n      i++;\n    }\n    //$LASTPOS=14001002;\n    mml.play(mmls);\n    return mml;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.PlayMod,{"fullName":"kernel.PlayMod","namespace":"kernel","shortName":"PlayMod","decls":{"methods":{"main":{"nowait":false},"initMML":{"nowait":true},"releaseMML":{"nowait":true},"play":{"nowait":false},"playSE":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Actor=Tonyu.klass(Tonyu.classes.kernel.BaseActor,[Tonyu.classes.kernel.PlayMod],{\n  main :function _trc_func_15000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_15000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_15000073_2(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=15000092;\n    Tonyu.classes.kernel.BaseActor.apply( _this, [x,y,p]);\n    //$LASTPOS=15000111;\n    if (Tonyu.runMode) {\n      //$LASTPOS=15000130;\n      _this.initSprite();\n    }\n  },\n  initSprite :function _trc_func_15000148_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=15000169;\n    if (_this.layer&&typeof  _this.layer.add=="function") {\n      //$LASTPOS=15000221;\n      _this.layer.add(_this);\n      \n    } else {\n      //$LASTPOS=15000259;\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    //$LASTPOS=15000291;\n    _this.onAppear();\n  },\n  fiber$initSprite :function _trc_func_15000148_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=15000169;\n    if (_this.layer&&typeof  _this.layer.add=="function") {\n      //$LASTPOS=15000221;\n      _this.layer.add(_this);\n      \n    } else {\n      //$LASTPOS=15000259;\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    \n    _thread.enter(function _trc_func_15000148_5(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=15000291;\n          _this.fiber$onAppear(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  onAppear :function _trc_func_15000307_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$onAppear :function _trc_func_15000307_7(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Actor,{"fullName":"kernel.Actor","namespace":"kernel","shortName":"Actor","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"initSprite":{"nowait":false},"onAppear":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.BodyActor=Tonyu.klass(Tonyu.classes.kernel.Actor,[Tonyu.classes.kernel.T2Mod],{\n  main :function _trc_func_16000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_16000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getWorld :function _trc_func_16000046_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=16000064;\n    if (Tonyu.globals.$t2World) {\n      return Tonyu.globals.$t2World;\n    }\n    //$LASTPOS=16000099;\n    Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;\n    return Tonyu.globals.$t2World;\n  },\n  fiber$getWorld :function _trc_func_16000046_3(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=16000064;\n    if (Tonyu.globals.$t2World) {\n      _thread.retVal=Tonyu.globals.$t2World;return;\n      \n    }\n    //$LASTPOS=16000099;\n    Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;\n    _thread.retVal=Tonyu.globals.$t2World;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  onAppear :function _trc_func_16000144_4() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b2Vec2;\n    var b2BodyDef;\n    var b2Body;\n    var b2FixtureDef;\n    var b2Fixture;\n    var b2PolygonShape;\n    var b2CircleShape;\n    var fixDef;\n    var bodyDef;\n    var w;\n    var h;\n    \n    //$LASTPOS=16000162;\n    _this.world=_this.getWorld().world;\n    //$LASTPOS=16000190;\n    _this.scale=_this.getWorld().scale;\n    //$LASTPOS=16000218;\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=16000261;\n    b2BodyDef = Box2D.Dynamics.b2BodyDef;\n    //$LASTPOS=16000307;\n    b2Body = Box2D.Dynamics.b2Body;\n    //$LASTPOS=16000347;\n    b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n    //$LASTPOS=16000399;\n    b2Fixture = Box2D.Dynamics.b2Fixture;\n    //$LASTPOS=16000445;\n    b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n    //$LASTPOS=16000509;\n    b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n    //$LASTPOS=16000576;\n    fixDef = new b2FixtureDef;\n    //$LASTPOS=16000611;\n    fixDef.density=_this.density||1;\n    //$LASTPOS=16000648;\n    fixDef.friction=_this.friction||0.5;\n    //$LASTPOS=16000687;\n    fixDef.restitution=_this.restitution||0.2;\n    //$LASTPOS=16000737;\n    bodyDef = new b2BodyDef;\n    //$LASTPOS=16000770;\n    bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;\n    //$LASTPOS=16000855;\n    bodyDef.position.x=_this.x/_this.scale;\n    //$LASTPOS=16000890;\n    bodyDef.position.y=_this.y/_this.scale;\n    //$LASTPOS=16000925;\n    _this.shape=_this.shape||(_this.radius?"circle":"box");\n    //$LASTPOS=16000973;\n    w = _this.width;h = _this.height;\n    //$LASTPOS=16000999;\n    if (! w) {\n      //$LASTPOS=16001017;\n      _this.detectShape();\n      //$LASTPOS=16001040;\n      w=_this.width*(_this.scaleX||1);\n      //$LASTPOS=16001069;\n      h=_this.height*(_this.scaleY||_this.scaleX||1);\n      \n    }\n    //$LASTPOS=16001109;\n    if (_this.shape=="box") {\n      //$LASTPOS=16001137;\n      if (! h) {\n        //$LASTPOS=16001145;\n        h=w;\n      }\n      //$LASTPOS=16001158;\n      fixDef.shape=new b2PolygonShape;\n      //$LASTPOS=16001201;\n      fixDef.shape.SetAsOrientedBox(w/2/_this.scale,h/2/_this.scale,new b2Vec2(0,0),0);\n      \n    } else {\n      //$LASTPOS=16001302;\n      _this.radius=_this.radius||w/2||16;\n      //$LASTPOS=16001338;\n      fixDef.shape=new b2CircleShape(_this.radius/_this.scale);\n      //$LASTPOS=16001412;\n      _this.width=_this.height=_this.radius*2;\n      \n    }\n    //$LASTPOS=16001446;\n    _this.body=_this.world.CreateBody(bodyDef);\n    //$LASTPOS=16001482;\n    _this.body.CreateFixture(fixDef);\n    //$LASTPOS=16001514;\n    _this.body.SetUserData(_this);\n    //$LASTPOS=16001542;\n    _this.body.SetAngle(_this.rad(_this.rotation));\n  },\n  fiber$onAppear :function _trc_func_16000144_5(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b2Vec2;\n    var b2BodyDef;\n    var b2Body;\n    var b2FixtureDef;\n    var b2Fixture;\n    var b2PolygonShape;\n    var b2CircleShape;\n    var fixDef;\n    var bodyDef;\n    var w;\n    var h;\n    \n    //$LASTPOS=16000162;\n    _this.world=_this.getWorld().world;\n    //$LASTPOS=16000190;\n    _this.scale=_this.getWorld().scale;\n    //$LASTPOS=16000218;\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=16000261;\n    b2BodyDef = Box2D.Dynamics.b2BodyDef;\n    //$LASTPOS=16000307;\n    b2Body = Box2D.Dynamics.b2Body;\n    //$LASTPOS=16000347;\n    b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n    //$LASTPOS=16000399;\n    b2Fixture = Box2D.Dynamics.b2Fixture;\n    //$LASTPOS=16000445;\n    b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n    //$LASTPOS=16000509;\n    b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n    //$LASTPOS=16000576;\n    fixDef = new b2FixtureDef;\n    //$LASTPOS=16000611;\n    fixDef.density=_this.density||1;\n    //$LASTPOS=16000648;\n    fixDef.friction=_this.friction||0.5;\n    //$LASTPOS=16000687;\n    fixDef.restitution=_this.restitution||0.2;\n    //$LASTPOS=16000737;\n    bodyDef = new b2BodyDef;\n    //$LASTPOS=16000770;\n    bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;\n    //$LASTPOS=16000855;\n    bodyDef.position.x=_this.x/_this.scale;\n    //$LASTPOS=16000890;\n    bodyDef.position.y=_this.y/_this.scale;\n    //$LASTPOS=16000925;\n    _this.shape=_this.shape||(_this.radius?"circle":"box");\n    //$LASTPOS=16000973;\n    w = _this.width;h = _this.height;\n    //$LASTPOS=16000999;\n    if (! w) {\n      //$LASTPOS=16001017;\n      _this.detectShape();\n      //$LASTPOS=16001040;\n      w=_this.width*(_this.scaleX||1);\n      //$LASTPOS=16001069;\n      h=_this.height*(_this.scaleY||_this.scaleX||1);\n      \n    }\n    //$LASTPOS=16001109;\n    if (_this.shape=="box") {\n      //$LASTPOS=16001137;\n      if (! h) {\n        //$LASTPOS=16001145;\n        h=w;\n      }\n      //$LASTPOS=16001158;\n      fixDef.shape=new b2PolygonShape;\n      //$LASTPOS=16001201;\n      fixDef.shape.SetAsOrientedBox(w/2/_this.scale,h/2/_this.scale,new b2Vec2(0,0),0);\n      \n    } else {\n      //$LASTPOS=16001302;\n      _this.radius=_this.radius||w/2||16;\n      //$LASTPOS=16001338;\n      fixDef.shape=new b2CircleShape(_this.radius/_this.scale);\n      //$LASTPOS=16001412;\n      _this.width=_this.height=_this.radius*2;\n      \n    }\n    //$LASTPOS=16001446;\n    _this.body=_this.world.CreateBody(bodyDef);\n    //$LASTPOS=16001482;\n    _this.body.CreateFixture(fixDef);\n    //$LASTPOS=16001514;\n    _this.body.SetUserData(_this);\n    //$LASTPOS=16001542;\n    _this.body.SetAngle(_this.rad(_this.rotation));\n    \n    _thread.retVal=_this;return;\n  },\n  allContact :function _trc_func_16001574_6(klass) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    var c;\n    var a;\n    var b;\n    \n    //$LASTPOS=16001599;\n    res = [];\n    //$LASTPOS=16001615;\n    //$LASTPOS=16001620;\n    c = _this.world.GetContactList();\n    while(c) {\n      {\n        //$LASTPOS=16001676;\n        if (c.IsTouching()) {\n          //$LASTPOS=16001710;\n          a = c.GetFixtureA().GetBody().GetUserData();\n          //$LASTPOS=16001769;\n          b = c.GetFixtureB().GetBody().GetUserData();\n          //$LASTPOS=16001828;\n          if (a===_this) {\n            //$LASTPOS=16001860;\n            if (! klass||b===klass||b instanceof klass) {\n              //$LASTPOS=16001929;\n              res.push(b);\n              \n            }\n            \n          } else {\n            //$LASTPOS=16001979;\n            if (b===_this) {\n              //$LASTPOS=16002011;\n              if (! klass||a===klass||a instanceof klass) {\n                //$LASTPOS=16002080;\n                res.push(a);\n                \n              }\n              \n            }\n          }\n          \n        }\n      }\n      c=c.GetNext();\n    }\n    return res;\n  },\n  fiber$allContact :function _trc_func_16001574_7(_thread,klass) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var res;\n    var c;\n    var a;\n    var b;\n    \n    //$LASTPOS=16001599;\n    res = [];\n    //$LASTPOS=16001615;\n    //$LASTPOS=16001620;\n    c = _this.world.GetContactList();\n    while(c) {\n      {\n        //$LASTPOS=16001676;\n        if (c.IsTouching()) {\n          //$LASTPOS=16001710;\n          a = c.GetFixtureA().GetBody().GetUserData();\n          //$LASTPOS=16001769;\n          b = c.GetFixtureB().GetBody().GetUserData();\n          //$LASTPOS=16001828;\n          if (a===_this) {\n            //$LASTPOS=16001860;\n            if (! klass||b===klass||b instanceof klass) {\n              //$LASTPOS=16001929;\n              res.push(b);\n              \n            }\n            \n          } else {\n            //$LASTPOS=16001979;\n            if (b===_this) {\n              //$LASTPOS=16002011;\n              if (! klass||a===klass||a instanceof klass) {\n                //$LASTPOS=16002080;\n                res.push(a);\n                \n              }\n              \n            }\n          }\n          \n        }\n      }\n      c=c.GetNext();\n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  applyForce :function _trc_func_16002159_8(fx,fy,px,py) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b2Vec2;\n    var scale;\n    var fps;\n    \n    //$LASTPOS=16002190;\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=16002233;\n    scale = _this.getWorld().scale;\n    //$LASTPOS=16002265;\n    fps = 60;\n    //$LASTPOS=16002281;\n    _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());\n  },\n  fiber$applyForce :function _trc_func_16002159_9(_thread,fx,fy,px,py) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b2Vec2;\n    var scale;\n    var fps;\n    \n    //$LASTPOS=16002190;\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=16002233;\n    scale = _this.getWorld().scale;\n    //$LASTPOS=16002265;\n    fps = 60;\n    //$LASTPOS=16002281;\n    _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());\n    \n    _thread.retVal=_this;return;\n  },\n  applyImpulse :function _trc_func_16002339_10(fx,fy,px,py) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b2Vec2;\n    var scale;\n    var fps;\n    \n    //$LASTPOS=16002372;\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=16002415;\n    scale = _this.getWorld().scale;\n    //$LASTPOS=16002447;\n    fps = 60;\n    //$LASTPOS=16002463;\n    _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());\n  },\n  fiber$applyImpulse :function _trc_func_16002339_11(_thread,fx,fy,px,py) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b2Vec2;\n    var scale;\n    var fps;\n    \n    //$LASTPOS=16002372;\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=16002415;\n    scale = _this.getWorld().scale;\n    //$LASTPOS=16002447;\n    fps = 60;\n    //$LASTPOS=16002463;\n    _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());\n    \n    _thread.retVal=_this;return;\n  },\n  applyTorque :function _trc_func_16002524_12(a) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=16002546;\n    _this.body.ApplyTorque(a);\n  },\n  fiber$applyTorque :function _trc_func_16002524_13(_thread,a) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=16002546;\n    _this.body.ApplyTorque(a);\n    \n    _thread.retVal=_this;return;\n  },\n  moveBy :function _trc_func_16002569_14(dx,dy) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var pos;\n    \n    //$LASTPOS=16002590;\n    pos = _this.body.GetPosition();\n    //$LASTPOS=16002622;\n    pos.x+=dx/_this.scale;\n    //$LASTPOS=16002643;\n    pos.y+=dy/_this.scale;\n    //$LASTPOS=16002664;\n    _this.body.SetPosition(pos);\n  },\n  fiber$moveBy :function _trc_func_16002569_15(_thread,dx,dy) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var pos;\n    \n    //$LASTPOS=16002590;\n    pos = _this.body.GetPosition();\n    //$LASTPOS=16002622;\n    pos.x+=dx/_this.scale;\n    //$LASTPOS=16002643;\n    pos.y+=dy/_this.scale;\n    //$LASTPOS=16002664;\n    _this.body.SetPosition(pos);\n    \n    _thread.retVal=_this;return;\n  },\n  contactTo :function _trc_func_16002689_16(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.allContact(t)[0];\n  },\n  fiber$contactTo :function _trc_func_16002689_17(_thread,t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.allContact(t)[0];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  die :function _trc_func_16002736_18() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=16002749;\n    Tonyu.classes.kernel.Actor.prototype.die.apply( _this, []);\n    //$LASTPOS=16002766;\n    _this.world.DestroyBody(_this.body);\n  },\n  updatePos :function _trc_func_16002793_19() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var scale;\n    var pos;\n    \n    //$LASTPOS=16002812;\n    if (! _this.body) {\n      return _this;\n    }\n    //$LASTPOS=16002835;\n    scale = _this.getWorld().scale;\n    //$LASTPOS=16002867;\n    pos = _this.body.GetPosition();\n    //$LASTPOS=16002899;\n    _this.x=pos.x*scale;\n    //$LASTPOS=16002918;\n    _this.y=pos.y*scale;\n    //$LASTPOS=16002937;\n    _this.rotation=_this.deg(_this.body.GetAngle());\n  },\n  fiber$updatePos :function _trc_func_16002793_20(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var scale;\n    var pos;\n    \n    //$LASTPOS=16002812;\n    if (! _this.body) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=16002835;\n    scale = _this.getWorld().scale;\n    //$LASTPOS=16002867;\n    pos = _this.body.GetPosition();\n    //$LASTPOS=16002899;\n    _this.x=pos.x*scale;\n    //$LASTPOS=16002918;\n    _this.y=pos.y*scale;\n    //$LASTPOS=16002937;\n    _this.rotation=_this.deg(_this.body.GetAngle());\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.BodyActor,{"fullName":"kernel.BodyActor","namespace":"kernel","shortName":"BodyActor","decls":{"methods":{"main":{"nowait":false},"getWorld":{"nowait":false},"onAppear":{"nowait":false},"allContact":{"nowait":false},"applyForce":{"nowait":false},"applyImpulse":{"nowait":false},"applyTorque":{"nowait":false},"moveBy":{"nowait":false},"contactTo":{"nowait":false},"die":{"nowait":true},"updatePos":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Boot=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_17000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=17001406;\n    _this.initSprites();\n    //$LASTPOS=17001422;\n    Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;\n    //$LASTPOS=17001453;\n    Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);\n    //$LASTPOS=17001490;\n    _this.initThread();\n    //$LASTPOS=17001507;\n    Tonyu.globals.$pat_fruits=30;\n    //$LASTPOS=17001524;\n    Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;\n    //$LASTPOS=17001541;\n    Tonyu.globals.$Math=Math;\n    //$LASTPOS=17001554;\n    Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.Panel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=17001664;\n    Tonyu.globals.$consolePrintY=465-15;\n    //$LASTPOS=17001688;\n    Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=17001828;\n    if (typeof  SplashScreen!="undefined") {\n      //$LASTPOS=17001866;\n      SplashScreen.hide();\n    }\n    //$LASTPOS=17001888;\n    _this.initFPSParams();\n    //$LASTPOS=17001908;\n    while (true) {\n      //$LASTPOS=17001928;\n      _this.thg.steps();\n      //$LASTPOS=17001946;\n      Tonyu.globals.$Keys.update();\n      //$LASTPOS=17001967;\n      Tonyu.globals.$InputDevice.update();\n      //$LASTPOS=17001995;\n      Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;\n      //$LASTPOS=17002028;\n      Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;\n      //$LASTPOS=17002069;\n      _this.doDraw=_this.now()<_this.deadLine;\n      //$LASTPOS=17002097;\n      if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {\n        //$LASTPOS=17002151;\n        _this.doDraw=true;\n        //$LASTPOS=17002173;\n        _this.resetDeadLine();\n        \n      }\n      //$LASTPOS=17002202;\n      if (_this.doDraw) {\n        //$LASTPOS=17002245;\n        Tonyu.globals.$Screen.fillCanvas(Tonyu.globals.$Screen.buf[0]);\n        //$LASTPOS=17002290;\n        Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n        //$LASTPOS=17002330;\n        Tonyu.globals.$FrontSprites.draw(Tonyu.globals.$Screen.buf[0]);\n        //$LASTPOS=17002375;\n        Tonyu.globals.$Screen.draw();\n        //$LASTPOS=17002400;\n        _this.fps_fpsCnt++;\n        //$LASTPOS=17002424;\n        _this.frameSkipped=0;\n        \n      } else {\n        //$LASTPOS=17002463;\n        _this.frameSkipped++;\n        \n      }\n      //$LASTPOS=17002491;\n      Tonyu.globals.$Sprites.checkHit();\n      //$LASTPOS=17002517;\n      _this.fps_rpsCnt++;\n      //$LASTPOS=17002537;\n      _this.measureFps();\n      //$LASTPOS=17002556;\n      _this.waitFrame();\n      //$LASTPOS=17002583;\n      while (_this.paused) {\n        //$LASTPOS=17002608;\n        _this.waitFor(Tonyu.timeout(1));\n        //$LASTPOS=17002645;\n        if (! _this.paused) {\n          //$LASTPOS=17002658;\n          _this.resetDeadLine();\n        }\n        \n      }\n      \n    }\n  },\n  fiber$main :function _trc_func_17000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_17000000_2(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=17001406;\n          _this.fiber$initSprites(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=17001422;\n          Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;\n          //$LASTPOS=17001453;\n          Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);\n          //$LASTPOS=17001490;\n          _this.fiber$initThread(_thread);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=17001507;\n          Tonyu.globals.$pat_fruits=30;\n          //$LASTPOS=17001524;\n          Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;\n          //$LASTPOS=17001541;\n          Tonyu.globals.$Math=Math;\n          //$LASTPOS=17001554;\n          Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.Panel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n          //$LASTPOS=17001664;\n          Tonyu.globals.$consolePrintY=465-15;\n          //$LASTPOS=17001688;\n          Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});\n          //$LASTPOS=17001828;\n          if (typeof  SplashScreen!="undefined") {\n            //$LASTPOS=17001866;\n            SplashScreen.hide();\n          }\n          //$LASTPOS=17001888;\n          _this.initFPSParams();\n          //$LASTPOS=17001908;\n        case 3:\n          //$LASTPOS=17001928;\n          _this.thg.steps();\n          //$LASTPOS=17001946;\n          Tonyu.globals.$Keys.update();\n          //$LASTPOS=17001967;\n          Tonyu.globals.$InputDevice.update();\n          //$LASTPOS=17001995;\n          Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;\n          //$LASTPOS=17002028;\n          Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;\n          //$LASTPOS=17002069;\n          _this.doDraw=_this.now()<_this.deadLine;\n          //$LASTPOS=17002097;\n          if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {\n            //$LASTPOS=17002151;\n            _this.doDraw=true;\n            //$LASTPOS=17002173;\n            _this.resetDeadLine();\n            \n          }\n          //$LASTPOS=17002202;\n          if (_this.doDraw) {\n            //$LASTPOS=17002245;\n            Tonyu.globals.$Screen.fillCanvas(Tonyu.globals.$Screen.buf[0]);\n            //$LASTPOS=17002290;\n            Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n            //$LASTPOS=17002330;\n            Tonyu.globals.$FrontSprites.draw(Tonyu.globals.$Screen.buf[0]);\n            //$LASTPOS=17002375;\n            Tonyu.globals.$Screen.draw();\n            //$LASTPOS=17002400;\n            _this.fps_fpsCnt++;\n            //$LASTPOS=17002424;\n            _this.frameSkipped=0;\n            \n          } else {\n            //$LASTPOS=17002463;\n            _this.frameSkipped++;\n            \n          }\n          //$LASTPOS=17002491;\n          Tonyu.globals.$Sprites.checkHit();\n          //$LASTPOS=17002517;\n          _this.fps_rpsCnt++;\n          //$LASTPOS=17002537;\n          _this.measureFps();\n          //$LASTPOS=17002556;\n          _this.fiber$waitFrame(_thread);\n          __pc=4;return;\n        case 4:\n          \n          //$LASTPOS=17002583;\n        case 5:\n          if (!(_this.paused)) { __pc=7; break; }\n          //$LASTPOS=17002608;\n          _this.fiber$waitFor(_thread, Tonyu.timeout(1));\n          __pc=6;return;\n        case 6:\n          \n          //$LASTPOS=17002645;\n          if (! _this.paused) {\n            //$LASTPOS=17002658;\n            _this.resetDeadLine();\n          }\n          __pc=5;break;\n        case 7:\n          \n          __pc=3;break;\n        case 8:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initSprites :function _trc_func_17000160_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var a;\n    var rs;\n    var r;\n    var name;\n    var val;\n    var _it_166;\n    \n    //$LASTPOS=17000182;\n    Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites();\n    //$LASTPOS=17000211;\n    Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites();\n    //$LASTPOS=17000245;\n    _this.print("Loading plugins..");\n    //$LASTPOS=17000279;\n    a = _this.asyncResult();\n    //$LASTPOS=17000305;\n    Tonyu.globals.$currentProject.loadPlugins(a.receiver);\n    //$LASTPOS=17000351;\n    _this.waitFor(a);\n    //$LASTPOS=17000368;\n    _this.print("Loading pats..");\n    //$LASTPOS=17000399;\n    rs = Tonyu.globals.$currentProject.getResource();\n    //$LASTPOS=17000442;\n    a=_this.asyncResult();\n    //$LASTPOS=17000464;\n    ImageList.load(rs.images,a.receiver,{baseDir: Tonyu.globals.$currentProject.getDir()});\n    //$LASTPOS=17000549;\n    _this.waitFor(a);\n    //$LASTPOS=17000566;\n    r = a[0];\n    //$LASTPOS=17000583;\n    Tonyu.globals.$Sprites.setImageList(r);\n    //$LASTPOS=17000614;\n    _it_166=Tonyu.iterator(r.names,2);\n    while(_it_166.next()) {\n      name=_it_166[0];\n      val=_it_166[1];\n      \n      //$LASTPOS=17000655;\n      Tonyu.setGlobal(name,val);\n      \n    }\n    //$LASTPOS=17000695;\n    _this.print("Loading pats done.");\n    //$LASTPOS=17000730;\n    _this.cvj=$("canvas");\n    //$LASTPOS=17000752;\n    if (Tonyu.noviceMode) {\n      //$LASTPOS=17000785;\n      Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 600,height: 300});\n      \n    } else {\n      //$LASTPOS=17000869;\n      Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 465,height: 465});\n      \n    }\n  },\n  fiber$initSprites :function _trc_func_17000160_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var a;\n    var rs;\n    var r;\n    var name;\n    var val;\n    var _it_166;\n    \n    //$LASTPOS=17000182;\n    Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites();\n    //$LASTPOS=17000211;\n    Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites();\n    //$LASTPOS=17000245;\n    _this.print("Loading plugins..");\n    //$LASTPOS=17000279;\n    a = _this.asyncResult();\n    //$LASTPOS=17000305;\n    Tonyu.globals.$currentProject.loadPlugins(a.receiver);\n    \n    _thread.enter(function _trc_func_17000160_5(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=17000351;\n          _this.fiber$waitFor(_thread, a);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=17000368;\n          _this.print("Loading pats..");\n          //$LASTPOS=17000399;\n          rs = Tonyu.globals.$currentProject.getResource();\n          //$LASTPOS=17000442;\n          a=_this.asyncResult();\n          //$LASTPOS=17000464;\n          ImageList.load(rs.images,a.receiver,{baseDir: Tonyu.globals.$currentProject.getDir()});\n          //$LASTPOS=17000549;\n          _this.fiber$waitFor(_thread, a);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=17000566;\n          r = a[0];\n          //$LASTPOS=17000583;\n          Tonyu.globals.$Sprites.setImageList(r);\n          //$LASTPOS=17000614;\n          _it_166=Tonyu.iterator(r.names,2);\n          while(_it_166.next()) {\n            name=_it_166[0];\n            val=_it_166[1];\n            \n            //$LASTPOS=17000655;\n            Tonyu.setGlobal(name,val);\n            \n          }\n          //$LASTPOS=17000695;\n          _this.print("Loading pats done.");\n          //$LASTPOS=17000730;\n          _this.cvj=$("canvas");\n          //$LASTPOS=17000752;\n          if (Tonyu.noviceMode) {\n            //$LASTPOS=17000785;\n            Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 600,height: 300});\n            \n          } else {\n            //$LASTPOS=17000869;\n            Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 465,height: 465});\n            \n          }\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initThread :function _trc_func_17000945_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var o;\n    var mainClassName;\n    \n    //$LASTPOS=17000966;\n    Tonyu.globals.$mainThreadGroup=_this.thg=Tonyu.threadGroup();\n    //$LASTPOS=17001013;\n    o = Tonyu.currentProject.getOptions();\n    //$LASTPOS=17001059;\n    mainClassName = o.run.mainClass;\n    //$LASTPOS=17001099;\n    _this.print("MainClass= "+mainClassName);\n    //$LASTPOS=17001140;\n    _this.mainClass=Tonyu.getClass(mainClassName);\n    //$LASTPOS=17001186;\n    if (! _this.mainClass) {\n      //$LASTPOS=17001213;\n      TError(mainClassName+" というクラスはありません","不明",0).raise();\n      \n    }\n    //$LASTPOS=17001292;\n    Tonyu.runMode=true;\n    //$LASTPOS=17001317;\n    Tonyu.globals.$currentThreadGroup=_this.thg;\n    //$LASTPOS=17001347;\n    new _this.mainClass();\n  },\n  fiber$initThread :function _trc_func_17000945_7(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var o;\n    var mainClassName;\n    \n    //$LASTPOS=17000966;\n    Tonyu.globals.$mainThreadGroup=_this.thg=Tonyu.threadGroup();\n    //$LASTPOS=17001013;\n    o = Tonyu.currentProject.getOptions();\n    //$LASTPOS=17001059;\n    mainClassName = o.run.mainClass;\n    //$LASTPOS=17001099;\n    _this.print("MainClass= "+mainClassName);\n    //$LASTPOS=17001140;\n    _this.mainClass=Tonyu.getClass(mainClassName);\n    //$LASTPOS=17001186;\n    if (! _this.mainClass) {\n      //$LASTPOS=17001213;\n      TError(mainClassName+" というクラスはありません","不明",0).raise();\n      \n    }\n    //$LASTPOS=17001292;\n    Tonyu.runMode=true;\n    //$LASTPOS=17001317;\n    Tonyu.globals.$currentThreadGroup=_this.thg;\n    //$LASTPOS=17001347;\n    new _this.mainClass();\n    \n    _thread.retVal=_this;return;\n  },\n  stop :function _trc_func_17001368_8() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=17001383;\n    _this.fireEvent("stop");\n  },\n  fiber$stop :function _trc_func_17001368_9(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_17001368_10(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=17001383;\n          _this.fiber$fireEvent(_thread, "stop");\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initFPSParams :function _trc_func_17002688_11() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=17002738;\n    _this._fps=30;\n    //$LASTPOS=17002754;\n    _this.maxframeSkip=5;\n    //$LASTPOS=17002804;\n    _this.frameCnt=0;\n    //$LASTPOS=17002823;\n    _this.resetDeadLine();\n    //$LASTPOS=17002845;\n    Tonyu.globals.$Boot=_this;\n    //$LASTPOS=17002864;\n    _this.lastMeasured=_this.now();\n    //$LASTPOS=17002889;\n    _this.fps_fps=_this.fps_rps=_this.fps_fpsCnt=_this.fps_rpsCnt=0;\n  },\n  now :function _trc_func_17002934_12() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return new Date().getTime();\n  },\n  resetDeadLine :function _trc_func_17002988_13() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=17003019;\n    _this.deadLine=_this.now()+1000/_this._fps;\n    //$LASTPOS=17003050;\n    _this.frameSkipped=0;\n  },\n  waitFrame :function _trc_func_17003074_14() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var wt;\n    \n    //$LASTPOS=17003094;\n    wt = _this.deadLine-_this.now();\n    //$LASTPOS=17003122;\n    if (wt<1) {\n      //$LASTPOS=17003143;\n      if (wt<- 1000) {\n        //$LASTPOS=17003157;\n        _this.resetDeadLine();\n      }\n      //$LASTPOS=17003183;\n      wt=1;\n      \n    }\n    //$LASTPOS=17003201;\n    wt=_this.floor(wt);\n    //$LASTPOS=17003220;\n    _this.waitFor(Tonyu.timeout(wt));\n    //$LASTPOS=17003253;\n    _this.deadLine+=1000/_this._fps;\n  },\n  fiber$waitFrame :function _trc_func_17003074_15(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var wt;\n    \n    //$LASTPOS=17003094;\n    wt = _this.deadLine-_this.now();\n    //$LASTPOS=17003122;\n    if (wt<1) {\n      //$LASTPOS=17003143;\n      if (wt<- 1000) {\n        //$LASTPOS=17003157;\n        _this.resetDeadLine();\n      }\n      //$LASTPOS=17003183;\n      wt=1;\n      \n    }\n    //$LASTPOS=17003201;\n    wt=_this.floor(wt);\n    \n    _thread.enter(function _trc_func_17003074_16(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=17003220;\n          _this.fiber$waitFor(_thread, Tonyu.timeout(wt));\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=17003253;\n          _this.deadLine+=1000/_this._fps;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  getFrameRate :function _trc_func_17003280_17() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this._fps;\n  },\n  setFrameRate :function _trc_func_17003366_18(fps,maxFrameSkip) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=17003413;\n    _this._fps=fps;\n    //$LASTPOS=17003430;\n    if (typeof  maxFrameSkip!="number") {\n      //$LASTPOS=17003465;\n      maxFrameSkip=5;\n    }\n    //$LASTPOS=17003486;\n    _this.maxFrameSkip=maxFrameSkip;\n    //$LASTPOS=17003525;\n    _this.resetDeadLine();\n  },\n  getMeasuredFps :function _trc_func_17003575_19() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.fps_fps;\n  },\n  getMeasuredRps :function _trc_func_17003654_20() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.fps_rps;\n  },\n  measureFps :function _trc_func_17003708_21() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=17003736;\n    if (_this.now()>_this.lastMeasured+1000) {\n      //$LASTPOS=17003776;\n      _this.fps_fps=_this.fps_fpsCnt;\n      //$LASTPOS=17003805;\n      _this.fps_rps=_this.fps_rpsCnt;\n      //$LASTPOS=17003834;\n      _this.fps_fpsCnt=0;\n      //$LASTPOS=17003857;\n      _this.fps_rpsCnt=0;\n      //$LASTPOS=17003880;\n      _this.lastMeasured=_this.now();\n      \n    }\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Boot,{"fullName":"kernel.Boot","namespace":"kernel","shortName":"Boot","decls":{"methods":{"main":{"nowait":false},"initSprites":{"nowait":false},"initThread":{"nowait":false},"stop":{"nowait":false},"initFPSParams":{"nowait":true},"now":{"nowait":true},"resetDeadLine":{"nowait":true},"waitFrame":{"nowait":false},"getFrameRate":{"nowait":true},"setFrameRate":{"nowait":true},"getMeasuredFps":{"nowait":true},"getMeasuredRps":{"nowait":true},"measureFps":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Map=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_18000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_18000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_18000041_2(param) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var j;\n    var i;\n    \n    //$LASTPOS=18000060;\n    _this.sx=0;\n    //$LASTPOS=18000071;\n    _this.sy=0;\n    //$LASTPOS=18000082;\n    Tonyu.classes.kernel.Actor.apply( _this, [param]);\n    //$LASTPOS=18000101;\n    _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n    //$LASTPOS=18000173;\n    _this.mapObj=true;\n    //$LASTPOS=18000191;\n    _this.mapTable=[];\n    //$LASTPOS=18000211;\n    _this.mapOnTable=[];\n    //$LASTPOS=18000233;\n    //$LASTPOS=18000237;\n    j = 0;\n    while(j<_this.row) {\n      {\n        //$LASTPOS=18000266;\n        _this.rows=[];\n        //$LASTPOS=18000286;\n        //$LASTPOS=18000290;\n        i = 0;\n        while(i<_this.col) {\n          {\n            //$LASTPOS=18000323;\n            _this.rows.push(- 1);\n          }\n          i++;\n        }\n        //$LASTPOS=18000358;\n        _this.mapTable.push(_this.rows);\n      }\n      j++;\n    }\n    //$LASTPOS=18000391;\n    //$LASTPOS=18000395;\n    j = 0;\n    while(j<_this.row) {\n      {\n        //$LASTPOS=18000424;\n        _this.rows=[];\n        //$LASTPOS=18000444;\n        //$LASTPOS=18000448;\n        i = 0;\n        while(i<_this.col) {\n          {\n            //$LASTPOS=18000481;\n            _this.rows.push(- 1);\n          }\n          i++;\n        }\n        //$LASTPOS=18000516;\n        _this.mapOnTable.push(_this.rows);\n      }\n      j++;\n    }\n    //$LASTPOS=18000616;\n    _this.initMap();\n  },\n  initMap :function _trc_func_18000631_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    var j;\n    \n    //$LASTPOS=18000648;\n    if (! _this.mapData) {\n      return _this;\n    }\n    //$LASTPOS=18000674;\n    //$LASTPOS=18000678;\n    i = 0;\n    while(i<_this.row) {\n      {\n        //$LASTPOS=18000707;\n        //$LASTPOS=18000711;\n        j = 0;\n        while(j<_this.col) {\n          {\n            //$LASTPOS=18000744;\n            _this.set(j,i,_this.mapData[i][j]);\n          }\n          j++;\n        }\n      }\n      i++;\n    }\n    //$LASTPOS=18000791;\n    if (! _this.mapOnData) {\n      return _this;\n    }\n    //$LASTPOS=18000819;\n    //$LASTPOS=18000823;\n    i = 0;\n    while(i<_this.row) {\n      {\n        //$LASTPOS=18000852;\n        //$LASTPOS=18000856;\n        j = 0;\n        while(j<_this.col) {\n          {\n            //$LASTPOS=18000889;\n            _this.setOn(j,i,_this.mapOnData[i][j]);\n          }\n          j++;\n        }\n      }\n      i++;\n    }\n  },\n  fiber$initMap :function _trc_func_18000631_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    var j;\n    \n    //$LASTPOS=18000648;\n    if (! _this.mapData) {\n      _thread.retVal=_this;return;\n      \n    }\n    \n    _thread.enter(function _trc_func_18000631_5(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=18000674;\n          //$LASTPOS=18000678;\n          i = 0;;\n        case 1:\n          if (!(i<_this.row)) { __pc=5; break; }\n          //$LASTPOS=18000707;\n          //$LASTPOS=18000711;\n          j = 0;;\n        case 2:\n          if (!(j<_this.col)) { __pc=4; break; }\n          //$LASTPOS=18000744;\n          _this.fiber$set(_thread, j, i, _this.mapData[i][j]);\n          __pc=3;return;\n        case 3:\n          \n          j++;\n          __pc=2;break;\n        case 4:\n          \n          i++;\n          __pc=1;break;\n        case 5:\n          \n          //$LASTPOS=18000791;\n          if (!(! _this.mapOnData)) { __pc=6; break; }\n          _thread.exit(_this);return;\n        case 6:\n          \n          //$LASTPOS=18000819;\n          //$LASTPOS=18000823;\n          i = 0;;\n        case 7:\n          if (!(i<_this.row)) { __pc=11; break; }\n          //$LASTPOS=18000852;\n          //$LASTPOS=18000856;\n          j = 0;;\n        case 8:\n          if (!(j<_this.col)) { __pc=10; break; }\n          //$LASTPOS=18000889;\n          _this.fiber$setOn(_thread, j, i, _this.mapOnData[i][j]);\n          __pc=9;return;\n        case 9:\n          \n          j++;\n          __pc=8;break;\n        case 10:\n          \n          i++;\n          __pc=7;break;\n        case 11:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  load :function _trc_func_18000939_6(dataFile) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18000961;\n    _this.baseData=_this.file("../maps/").rel(dataFile).obj();\n    //$LASTPOS=18001013;\n    if (! _this.baseData) {\n      //$LASTPOS=18001027;\n      _this.baseData=_this.file(dataFile).obj();\n    }\n    //$LASTPOS=18001063;\n    _this.mapTable=_this.baseData[0];\n    //$LASTPOS=18001090;\n    _this.mapData=_this.mapTable;\n    //$LASTPOS=18001113;\n    _this.row=_this.mapTable.length;\n    //$LASTPOS=18001139;\n    _this.col=_this.mapTable[0].length;\n    //$LASTPOS=18001168;\n    _this.mapOnTable=_this.baseData[1];\n    //$LASTPOS=18001197;\n    _this.mapOnData=_this.mapOnTable;\n    //$LASTPOS=18001224;\n    _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n    //$LASTPOS=18001296;\n    _this.initMap();\n  },\n  fiber$load :function _trc_func_18000939_7(_thread,dataFile) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=18000961;\n    _this.baseData=_this.file("../maps/").rel(dataFile).obj();\n    //$LASTPOS=18001013;\n    if (! _this.baseData) {\n      //$LASTPOS=18001027;\n      _this.baseData=_this.file(dataFile).obj();\n    }\n    //$LASTPOS=18001063;\n    _this.mapTable=_this.baseData[0];\n    //$LASTPOS=18001090;\n    _this.mapData=_this.mapTable;\n    //$LASTPOS=18001113;\n    _this.row=_this.mapTable.length;\n    //$LASTPOS=18001139;\n    _this.col=_this.mapTable[0].length;\n    //$LASTPOS=18001168;\n    _this.mapOnTable=_this.baseData[1];\n    //$LASTPOS=18001197;\n    _this.mapOnData=_this.mapOnTable;\n    //$LASTPOS=18001224;\n    _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n    \n    _thread.enter(function _trc_func_18000939_8(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=18001296;\n          _this.fiber$initMap(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  set :function _trc_func_18001311_9(setCol,setRow,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18001339;\n    if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n      return _this;\n    }\n    //$LASTPOS=18001407;\n    _this.mapTable[setRow][setCol]=p;\n    //$LASTPOS=18001478;\n    _this.ctx=_this.buf[0].getContext("2d");\n    //$LASTPOS=18001512;\n    p=Math.floor(p);\n    //$LASTPOS=18001534;\n    _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n    //$LASTPOS=18001572;\n    if (! _this.pImg) {\n      //$LASTPOS=18001594;\n      _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      return _this;\n      \n    }\n    //$LASTPOS=18001695;\n    _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n    //$LASTPOS=18001772;\n    _this.ctx.save();\n    //$LASTPOS=18001789;\n    _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n    //$LASTPOS=18001933;\n    _this.ctx.restore();\n  },\n  fiber$set :function _trc_func_18001311_10(_thread,setCol,setRow,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=18001339;\n    if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=18001407;\n    _this.mapTable[setRow][setCol]=p;\n    //$LASTPOS=18001478;\n    _this.ctx=_this.buf[0].getContext("2d");\n    //$LASTPOS=18001512;\n    p=Math.floor(p);\n    //$LASTPOS=18001534;\n    _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n    //$LASTPOS=18001572;\n    if (! _this.pImg) {\n      //$LASTPOS=18001594;\n      _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      _thread.retVal=_this;return;\n      \n      \n    }\n    //$LASTPOS=18001695;\n    _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n    //$LASTPOS=18001772;\n    _this.ctx.save();\n    //$LASTPOS=18001789;\n    _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n    //$LASTPOS=18001933;\n    _this.ctx.restore();\n    \n    _thread.retVal=_this;return;\n  },\n  setOn :function _trc_func_18001952_11(setCol,setRow,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18001982;\n    if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n      return _this;\n    }\n    //$LASTPOS=18002050;\n    _this.set(setCol,setRow,_this.mapTable[setRow][setCol]);\n    //$LASTPOS=18002100;\n    _this.mapOnTable[setRow][setCol]=p;\n    //$LASTPOS=18002135;\n    _this.ctx=_this.buf[0].getContext("2d");\n    //$LASTPOS=18002169;\n    p=Math.floor(p);\n    //$LASTPOS=18002191;\n    _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n    //$LASTPOS=18002229;\n    if (! _this.pImg) {\n      return _this;\n    }\n    //$LASTPOS=18002253;\n    _this.ctx.save();\n    //$LASTPOS=18002270;\n    _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n    //$LASTPOS=18002414;\n    _this.ctx.restore();\n  },\n  fiber$setOn :function _trc_func_18001952_12(_thread,setCol,setRow,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=18001982;\n    if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n      _thread.retVal=_this;return;\n      \n    }\n    \n    _thread.enter(function _trc_func_18001952_13(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=18002050;\n          _this.fiber$set(_thread, setCol, setRow, _this.mapTable[setRow][setCol]);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=18002100;\n          _this.mapOnTable[setRow][setCol]=p;\n          //$LASTPOS=18002135;\n          _this.ctx=_this.buf[0].getContext("2d");\n          //$LASTPOS=18002169;\n          p=Math.floor(p);\n          //$LASTPOS=18002191;\n          _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n          //$LASTPOS=18002229;\n          if (!(! _this.pImg)) { __pc=2; break; }\n          _thread.exit(_this);return;\n        case 2:\n          \n          //$LASTPOS=18002253;\n          _this.ctx.save();\n          //$LASTPOS=18002270;\n          _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n          //$LASTPOS=18002414;\n          _this.ctx.restore();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  setOnAt :function _trc_func_18002433_14(setX,setY,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18002461;\n    _this.setOn(Math.floor(setX/_this.chipWidth),Math.floor(setY/_this.chipHeight),p);\n  },\n  fiber$setOnAt :function _trc_func_18002433_15(_thread,setX,setY,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_18002433_16(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=18002461;\n          _this.fiber$setOn(_thread, Math.floor(setX/_this.chipWidth), Math.floor(setY/_this.chipHeight), p);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  setAt :function _trc_func_18002530_17(setX,setY,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18002556;\n    _this.set(Math.floor(setX/_this.chipWidth),Math.floor(setY/_this.chipHeight),p);\n  },\n  fiber$setAt :function _trc_func_18002530_18(_thread,setX,setY,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_18002530_19(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=18002556;\n          _this.fiber$set(_thread, Math.floor(setX/_this.chipWidth), Math.floor(setY/_this.chipHeight), p);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  get :function _trc_func_18002623_20(getCol,getRow) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18002649;\n    if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n      return _this.mapTable[getRow][getCol];\n    }\n    return - 1;\n  },\n  fiber$get :function _trc_func_18002623_21(_thread,getCol,getRow) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=18002649;\n    if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n      _thread.retVal=_this.mapTable[getRow][getCol];return;\n      \n    }\n    _thread.retVal=- 1;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getAt :function _trc_func_18002757_22(getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.get(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));\n  },\n  fiber$getAt :function _trc_func_18002757_23(_thread,getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.get(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getOn :function _trc_func_18002853_24(getCol,getRow) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18002881;\n    if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n      return _this.mapOnTable[getRow][getCol];\n    }\n    return - 1;\n  },\n  fiber$getOn :function _trc_func_18002853_25(_thread,getCol,getRow) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=18002881;\n    if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n      _thread.retVal=_this.mapOnTable[getRow][getCol];return;\n      \n    }\n    _thread.retVal=- 1;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getOnAt :function _trc_func_18002991_26(getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.getOn(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));\n  },\n  fiber$getOnAt :function _trc_func_18002991_27(_thread,getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.getOn(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  scrollTo :function _trc_func_18003091_28(scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18003124;\n    _this.sx=- scrollX;\n    //$LASTPOS=18003142;\n    _this.sy=- scrollY;\n  },\n  fiber$scrollTo :function _trc_func_18003091_29(_thread,scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=18003124;\n    _this.sx=- scrollX;\n    //$LASTPOS=18003142;\n    _this.sy=- scrollY;\n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_18003159_30(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18003177;\n    _this.pImg=_this.buf[0];\n    //$LASTPOS=18003195;\n    ctx.save();\n    //$LASTPOS=18003212;\n    ctx.drawImage(_this.pImg,0,0,_this.col*_this.chipWidth,_this.row*_this.chipHeight,_this.sx,_this.sy,_this.col*_this.chipWidth,_this.row*_this.chipHeight);\n    //$LASTPOS=18003324;\n    ctx.restore();\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Map,{"fullName":"kernel.Map","namespace":"kernel","shortName":"Map","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"initMap":{"nowait":false},"load":{"nowait":false},"set":{"nowait":false},"setOn":{"nowait":false},"setOnAt":{"nowait":false},"setAt":{"nowait":false},"get":{"nowait":false},"getAt":{"nowait":false},"getOn":{"nowait":false},"getOnAt":{"nowait":false},"scrollTo":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.MapEditor=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_19000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    var j;\n    \n    //$LASTPOS=19000032;\n    _this.loadMode=false;\n    //$LASTPOS=19000049;\n    _this.print("Load Data?: Y or N");\n    //$LASTPOS=19000079;\n    while (true) {\n      //$LASTPOS=19000097;\n      if (_this.getkey("y")>0) {\n        //$LASTPOS=19000125;\n        _this.loadMode=true;\n        break;\n        \n        \n      }\n      //$LASTPOS=19000168;\n      if (_this.getkey("n")>0) {\n        //$LASTPOS=19000196;\n        _this.loadMode=false;\n        break;\n        \n        \n      }\n      //$LASTPOS=19000240;\n      _this.update();\n      \n    }\n    //$LASTPOS=19000254;\n    if (_this.loadMode) {\n      //$LASTPOS=19000273;\n      _this.fileName=prompt("Input json file (*.json)","map.json");\n      //$LASTPOS=19000334;\n      if (_this.fileName) {\n        //$LASTPOS=19000357;\n        _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);\n        \n      }\n      //$LASTPOS=19000413;\n      if (_this.mapDataFile.obj()) {\n        //$LASTPOS=19000445;\n        _this.baseData=_this.mapDataFile.obj();\n        \n      } else {\n        //$LASTPOS=19000494;\n        _this.mapDataFile=_this.file(_this.fileName);\n        //$LASTPOS=19000531;\n        if (_this.mapDataFile.obj()) {\n          //$LASTPOS=19000567;\n          _this.baseData=_this.mapDataFile.obj();\n          \n        }\n        \n      }\n      //$LASTPOS=19000618;\n      if (_this.baseData==undefined) {\n        //$LASTPOS=19000652;\n        _this.print("Load failed");\n        //$LASTPOS=19000683;\n        _this.loadMode=false;\n        \n      } else {\n        //$LASTPOS=19000710;\n        if (_this.baseData[0]&&_this.baseData[1]) {\n          //$LASTPOS=19000751;\n          _this.mapData=_this.baseData[0];\n          //$LASTPOS=19000781;\n          _this.mapOnData=_this.baseData[1];\n          \n        }\n      }\n      \n    }\n    //$LASTPOS=19000815;\n    _this.update();\n    //$LASTPOS=19001093;\n    if (! _this.loadMode) {\n      //$LASTPOS=19001113;\n      _this.row=prompt("input row");\n      //$LASTPOS=19001143;\n      _this.update();\n      //$LASTPOS=19001158;\n      _this.col=prompt("input col");\n      //$LASTPOS=19001188;\n      _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});\n      //$LASTPOS=19001238;\n      _this.panel.x=_this.panel.width/2+10;\n      //$LASTPOS=19001269;\n      _this.panel.y=_this.panel.height/2;\n      //$LASTPOS=19001298;\n      _this.panel.setFillStyle("cyan");\n      //$LASTPOS=19001331;\n      _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n      //$LASTPOS=19001382;\n      Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});\n      \n    } else {\n      //$LASTPOS=19001445;\n      if (! _this.mapOnData) {\n        //$LASTPOS=19001470;\n        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});\n        \n      } else {\n        //$LASTPOS=19001582;\n        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});\n        \n      }\n      //$LASTPOS=19001695;\n      _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});\n      //$LASTPOS=19001766;\n      _this.panel.x=_this.panel.width/2;\n      //$LASTPOS=19001794;\n      _this.panel.y=_this.panel.height/2;\n      //$LASTPOS=19001823;\n      _this.panel.setFillStyle("cyan");\n      //$LASTPOS=19001856;\n      _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n      \n    }\n    //$LASTPOS=19001906;\n    Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});\n    //$LASTPOS=19001961;\n    _this.counter=0;\n    //$LASTPOS=19001973;\n    //$LASTPOS=19001977;\n    i = 0;\n    while(i<16) {\n      {\n        //$LASTPOS=19002001;\n        //$LASTPOS=19002005;\n        j = 0;\n        while(j<8) {\n          {\n            //$LASTPOS=19002032;\n            Tonyu.globals.$mp.set(j,i,Tonyu.globals.$pat_mapchip+_this.counter);\n            //$LASTPOS=19002076;\n            _this.counter++;\n          }\n          j++;\n        }\n      }\n      i++;\n    }\n    //$LASTPOS=19002098;\n    _this.mode="get";\n    //$LASTPOS=19002111;\n    _this.prevMode="set";\n    //$LASTPOS=19002128;\n    _this.mapp=0;\n    //$LASTPOS=19002137;\n    _this.mx=0;\n    //$LASTPOS=19002144;\n    _this.my=0;\n    //$LASTPOS=19002151;\n    _this.chipX=0;\n    //$LASTPOS=19002161;\n    _this.chipY=0;\n    //$LASTPOS=19002171;\n    _this.x=Tonyu.globals.$screenWidth-16;\n    //$LASTPOS=19002191;\n    _this.y=Tonyu.globals.$screenHeight-16;\n    //$LASTPOS=19002212;\n    while (true) {\n      //$LASTPOS=19002230;\n      _this.p=_this.mapp;\n      //$LASTPOS=19002243;\n      if (_this.getkey("e")==1) {\n        //$LASTPOS=19002272;\n        Tonyu.globals.$mp.scrollTo(1000,1000);\n        //$LASTPOS=19002306;\n        _this.mode="erase";\n        //$LASTPOS=19002329;\n        _this.print(_this.mode+" mode");\n        \n      }\n      //$LASTPOS=19002362;\n      if (_this.getkey("s")==1) {\n        //$LASTPOS=19002391;\n        Tonyu.globals.$mp.scrollTo(1000,1000);\n        //$LASTPOS=19002425;\n        if (_this.mode=="set") {\n          //$LASTPOS=19002455;\n          _this.mode="setOn";\n          \n        } else {\n          //$LASTPOS=19002498;\n          _this.mode="set";\n          \n        }\n        //$LASTPOS=19002530;\n        _this.print(_this.mode+" mode");\n        \n      }\n      //$LASTPOS=19002563;\n      if (_this.getkey("o")==1) {\n        //$LASTPOS=19002592;\n        Tonyu.globals.$mp.scrollTo(1000,1000);\n        //$LASTPOS=19002626;\n        _this.mode="setOn";\n        \n      }\n      //$LASTPOS=19002652;\n      if (_this.getkey("g")==1) {\n        //$LASTPOS=19002681;\n        if (_this.mode!="get") {\n          //$LASTPOS=19002711;\n          _this.prevMode=_this.mode;\n          //$LASTPOS=19002739;\n          Tonyu.globals.$mp.scrollTo(0,0);\n          //$LASTPOS=19002771;\n          _this.mode="get";\n          //$LASTPOS=19002796;\n          _this.chipX=0;\n          //$LASTPOS=19002818;\n          _this.chipY=0;\n          \n        } else {\n          //$LASTPOS=19002856;\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=19002894;\n          _this.mode=_this.prevMode;\n          \n        }\n        //$LASTPOS=19002929;\n        _this.print(_this.mode+" mode");\n        \n      }\n      //$LASTPOS=19002962;\n      if (_this.getkey("p")==1) {\n        //$LASTPOS=19003006;\n        _this.saveFileName=prompt("input json file(*.json)","map.json");\n        //$LASTPOS=19003495;\n        _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);\n        //$LASTPOS=19003553;\n        _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];\n        //$LASTPOS=19003668;\n        _this.saveDataFile.obj(_this.data);\n        //$LASTPOS=19003701;\n        _this.print(_this.saveFileName+" Saved");\n        \n      }\n      //$LASTPOS=19003793;\n      if (_this.getkey("c")==1) {\n        //$LASTPOS=19003822;\n        Tonyu.globals.$mp.scrollTo(1000,1000);\n        //$LASTPOS=19003856;\n        _this.mode="spuit";\n        //$LASTPOS=19003879;\n        _this.print(_this.mode+" mode");\n        \n      }\n      //$LASTPOS=19003912;\n      if (_this.mode!="get") {\n        //$LASTPOS=19003938;\n        if (_this.getkey("left")>0) {\n          //$LASTPOS=19003959;\n          _this.mx=_this.mx+8;\n        }\n        //$LASTPOS=19003977;\n        if (_this.getkey("right")>0) {\n          //$LASTPOS=19003999;\n          _this.mx=_this.mx-8;\n        }\n        //$LASTPOS=19004017;\n        if (_this.getkey("up")>0) {\n          //$LASTPOS=19004036;\n          _this.my=_this.my+8;\n        }\n        //$LASTPOS=19004054;\n        if (_this.getkey("down")>0) {\n          //$LASTPOS=19004075;\n          _this.my=_this.my-8;\n        }\n        //$LASTPOS=19004093;\n        Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n        \n      } else {\n        //$LASTPOS=19004136;\n        if (_this.getkey("left")>0) {\n          //$LASTPOS=19004157;\n          _this.chipX=_this.chipX+8;\n        }\n        //$LASTPOS=19004181;\n        if (_this.getkey("right")>0) {\n          //$LASTPOS=19004203;\n          _this.chipX=_this.chipX-8;\n        }\n        //$LASTPOS=19004227;\n        if (_this.getkey("up")>0) {\n          //$LASTPOS=19004246;\n          _this.chipY=_this.chipY+8;\n        }\n        //$LASTPOS=19004270;\n        if (_this.getkey("down")>0) {\n          //$LASTPOS=19004291;\n          _this.chipY=_this.chipY-8;\n        }\n        //$LASTPOS=19004315;\n        Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);\n        \n      }\n      //$LASTPOS=19004354;\n      _this.panel.x=_this.panel.width/2-_this.mx;\n      //$LASTPOS=19004385;\n      _this.panel.y=_this.panel.height/2-_this.my;\n      //$LASTPOS=19004417;\n      if (_this.mode=="set"&&_this.getkey(1)>0) {\n        //$LASTPOS=19004458;\n        Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n        //$LASTPOS=19004507;\n        Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n        \n      } else {\n        //$LASTPOS=19004558;\n        if (_this.mode=="erase"&&_this.getkey(1)>0) {\n          //$LASTPOS=19004601;\n          Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n          \n        } else {\n          //$LASTPOS=19004650;\n          if (_this.mode=="get"&&_this.getkey(1)>0) {\n            //$LASTPOS=19004691;\n            _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);\n            //$LASTPOS=19004745;\n            _this.mode=_this.prevMode;\n            //$LASTPOS=19004769;\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=19004803;\n            _this.print(_this.mode+" mode");\n            //$LASTPOS=19004833;\n            _this.updateEx(10);\n            \n          } else {\n            //$LASTPOS=19004858;\n            if (_this.mode=="setOn"&&_this.getkey(1)>0) {\n              //$LASTPOS=19004901;\n              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n              \n            } else {\n              //$LASTPOS=19004954;\n              if (_this.mode=="spuit"&&_this.getkey(1)>0) {\n                //$LASTPOS=19004997;\n                _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);\n                //$LASTPOS=19005046;\n                _this.mode="set";\n                //$LASTPOS=19005067;\n                _this.print(_this.mode+" mode");\n                //$LASTPOS=19005097;\n                _this.updateEx(10);\n                \n              }\n            }\n          }\n        }\n      }\n      //$LASTPOS=19005123;\n      _this.update();\n      \n    }\n  },\n  fiber$main :function _trc_func_19000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    var j;\n    \n    //$LASTPOS=19000032;\n    _this.loadMode=false;\n    //$LASTPOS=19000049;\n    _this.print("Load Data?: Y or N");\n    \n    _thread.enter(function _trc_func_19000000_2(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=19000079;\n        case 1:\n          //$LASTPOS=19000097;\n          if (!(_this.getkey("y")>0)) { __pc=2; break; }\n          //$LASTPOS=19000125;\n          _this.loadMode=true;\n          __pc=5; break;\n          \n        case 2:\n          \n          //$LASTPOS=19000168;\n          if (!(_this.getkey("n")>0)) { __pc=3; break; }\n          //$LASTPOS=19000196;\n          _this.loadMode=false;\n          __pc=5; break;\n          \n        case 3:\n          \n          //$LASTPOS=19000240;\n          _this.fiber$update(_thread);\n          __pc=4;return;\n        case 4:\n          \n          __pc=1;break;\n        case 5:\n          \n          //$LASTPOS=19000254;\n          if (!(_this.loadMode)) { __pc=9; break; }\n          //$LASTPOS=19000273;\n          _this.fileName=prompt("Input json file (*.json)","map.json");\n          //$LASTPOS=19000334;\n          if (_this.fileName) {\n            //$LASTPOS=19000357;\n            _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);\n            \n          }\n          //$LASTPOS=19000413;\n          if (!(_this.mapDataFile.obj())) { __pc=6; break; }\n          {\n            //$LASTPOS=19000445;\n            _this.baseData=_this.mapDataFile.obj();\n          }\n          __pc=8;break;\n        case 6:\n          //$LASTPOS=19000494;\n          _this.fiber$file(_thread, _this.fileName);\n          __pc=7;return;\n        case 7:\n          _this.mapDataFile=_thread.retVal;\n          \n          //$LASTPOS=19000531;\n          if (_this.mapDataFile.obj()) {\n            //$LASTPOS=19000567;\n            _this.baseData=_this.mapDataFile.obj();\n            \n          }\n        case 8:\n          \n          //$LASTPOS=19000618;\n          if (_this.baseData==undefined) {\n            //$LASTPOS=19000652;\n            _this.print("Load failed");\n            //$LASTPOS=19000683;\n            _this.loadMode=false;\n            \n          } else {\n            //$LASTPOS=19000710;\n            if (_this.baseData[0]&&_this.baseData[1]) {\n              //$LASTPOS=19000751;\n              _this.mapData=_this.baseData[0];\n              //$LASTPOS=19000781;\n              _this.mapOnData=_this.baseData[1];\n              \n            }\n          }\n        case 9:\n          \n          //$LASTPOS=19000815;\n          _this.fiber$update(_thread);\n          __pc=10;return;\n        case 10:\n          \n          //$LASTPOS=19001093;\n          if (!(! _this.loadMode)) { __pc=12; break; }\n          //$LASTPOS=19001113;\n          _this.row=prompt("input row");\n          //$LASTPOS=19001143;\n          _this.fiber$update(_thread);\n          __pc=11;return;\n        case 11:\n          \n          //$LASTPOS=19001158;\n          _this.col=prompt("input col");\n          //$LASTPOS=19001188;\n          _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});\n          //$LASTPOS=19001238;\n          _this.panel.x=_this.panel.width/2+10;\n          //$LASTPOS=19001269;\n          _this.panel.y=_this.panel.height/2;\n          //$LASTPOS=19001298;\n          _this.panel.setFillStyle("cyan");\n          //$LASTPOS=19001331;\n          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n          //$LASTPOS=19001382;\n          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});\n          __pc=13;break;\n        case 12:\n          {\n            //$LASTPOS=19001445;\n            if (! _this.mapOnData) {\n              //$LASTPOS=19001470;\n              Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});\n              \n            } else {\n              //$LASTPOS=19001582;\n              Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});\n              \n            }\n            //$LASTPOS=19001695;\n            _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});\n            //$LASTPOS=19001766;\n            _this.panel.x=_this.panel.width/2;\n            //$LASTPOS=19001794;\n            _this.panel.y=_this.panel.height/2;\n            //$LASTPOS=19001823;\n            _this.panel.setFillStyle("cyan");\n            //$LASTPOS=19001856;\n            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n          }\n        case 13:\n          \n          //$LASTPOS=19001906;\n          Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});\n          //$LASTPOS=19001961;\n          _this.counter=0;\n          //$LASTPOS=19001973;\n          //$LASTPOS=19001977;\n          i = 0;\n          while(i<16) {\n            {\n              //$LASTPOS=19002001;\n              //$LASTPOS=19002005;\n              j = 0;\n              while(j<8) {\n                {\n                  //$LASTPOS=19002032;\n                  Tonyu.globals.$mp.set(j,i,Tonyu.globals.$pat_mapchip+_this.counter);\n                  //$LASTPOS=19002076;\n                  _this.counter++;\n                }\n                j++;\n              }\n            }\n            i++;\n          }\n          //$LASTPOS=19002098;\n          _this.mode="get";\n          //$LASTPOS=19002111;\n          _this.prevMode="set";\n          //$LASTPOS=19002128;\n          _this.mapp=0;\n          //$LASTPOS=19002137;\n          _this.mx=0;\n          //$LASTPOS=19002144;\n          _this.my=0;\n          //$LASTPOS=19002151;\n          _this.chipX=0;\n          //$LASTPOS=19002161;\n          _this.chipY=0;\n          //$LASTPOS=19002171;\n          _this.x=Tonyu.globals.$screenWidth-16;\n          //$LASTPOS=19002191;\n          _this.y=Tonyu.globals.$screenHeight-16;\n          //$LASTPOS=19002212;\n        case 14:\n          //$LASTPOS=19002230;\n          _this.p=_this.mapp;\n          //$LASTPOS=19002243;\n          if (_this.getkey("e")==1) {\n            //$LASTPOS=19002272;\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=19002306;\n            _this.mode="erase";\n            //$LASTPOS=19002329;\n            _this.print(_this.mode+" mode");\n            \n          }\n          //$LASTPOS=19002362;\n          if (_this.getkey("s")==1) {\n            //$LASTPOS=19002391;\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=19002425;\n            if (_this.mode=="set") {\n              //$LASTPOS=19002455;\n              _this.mode="setOn";\n              \n            } else {\n              //$LASTPOS=19002498;\n              _this.mode="set";\n              \n            }\n            //$LASTPOS=19002530;\n            _this.print(_this.mode+" mode");\n            \n          }\n          //$LASTPOS=19002563;\n          if (_this.getkey("o")==1) {\n            //$LASTPOS=19002592;\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=19002626;\n            _this.mode="setOn";\n            \n          }\n          //$LASTPOS=19002652;\n          if (_this.getkey("g")==1) {\n            //$LASTPOS=19002681;\n            if (_this.mode!="get") {\n              //$LASTPOS=19002711;\n              _this.prevMode=_this.mode;\n              //$LASTPOS=19002739;\n              Tonyu.globals.$mp.scrollTo(0,0);\n              //$LASTPOS=19002771;\n              _this.mode="get";\n              //$LASTPOS=19002796;\n              _this.chipX=0;\n              //$LASTPOS=19002818;\n              _this.chipY=0;\n              \n            } else {\n              //$LASTPOS=19002856;\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=19002894;\n              _this.mode=_this.prevMode;\n              \n            }\n            //$LASTPOS=19002929;\n            _this.print(_this.mode+" mode");\n            \n          }\n          //$LASTPOS=19002962;\n          if (_this.getkey("p")==1) {\n            //$LASTPOS=19003006;\n            _this.saveFileName=prompt("input json file(*.json)","map.json");\n            //$LASTPOS=19003495;\n            _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);\n            //$LASTPOS=19003553;\n            _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];\n            //$LASTPOS=19003668;\n            _this.saveDataFile.obj(_this.data);\n            //$LASTPOS=19003701;\n            _this.print(_this.saveFileName+" Saved");\n            \n          }\n          //$LASTPOS=19003793;\n          if (_this.getkey("c")==1) {\n            //$LASTPOS=19003822;\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=19003856;\n            _this.mode="spuit";\n            //$LASTPOS=19003879;\n            _this.print(_this.mode+" mode");\n            \n          }\n          //$LASTPOS=19003912;\n          if (_this.mode!="get") {\n            //$LASTPOS=19003938;\n            if (_this.getkey("left")>0) {\n              //$LASTPOS=19003959;\n              _this.mx=_this.mx+8;\n            }\n            //$LASTPOS=19003977;\n            if (_this.getkey("right")>0) {\n              //$LASTPOS=19003999;\n              _this.mx=_this.mx-8;\n            }\n            //$LASTPOS=19004017;\n            if (_this.getkey("up")>0) {\n              //$LASTPOS=19004036;\n              _this.my=_this.my+8;\n            }\n            //$LASTPOS=19004054;\n            if (_this.getkey("down")>0) {\n              //$LASTPOS=19004075;\n              _this.my=_this.my-8;\n            }\n            //$LASTPOS=19004093;\n            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n            \n          } else {\n            //$LASTPOS=19004136;\n            if (_this.getkey("left")>0) {\n              //$LASTPOS=19004157;\n              _this.chipX=_this.chipX+8;\n            }\n            //$LASTPOS=19004181;\n            if (_this.getkey("right")>0) {\n              //$LASTPOS=19004203;\n              _this.chipX=_this.chipX-8;\n            }\n            //$LASTPOS=19004227;\n            if (_this.getkey("up")>0) {\n              //$LASTPOS=19004246;\n              _this.chipY=_this.chipY+8;\n            }\n            //$LASTPOS=19004270;\n            if (_this.getkey("down")>0) {\n              //$LASTPOS=19004291;\n              _this.chipY=_this.chipY-8;\n            }\n            //$LASTPOS=19004315;\n            Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);\n            \n          }\n          //$LASTPOS=19004354;\n          _this.panel.x=_this.panel.width/2-_this.mx;\n          //$LASTPOS=19004385;\n          _this.panel.y=_this.panel.height/2-_this.my;\n          //$LASTPOS=19004417;\n          if (!(_this.mode=="set"&&_this.getkey(1)>0)) { __pc=15; break; }\n          {\n            //$LASTPOS=19004458;\n            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n            //$LASTPOS=19004507;\n            Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n          }\n          __pc=25;break;\n        case 15:\n          //$LASTPOS=19004558;\n          if (!(_this.mode=="erase"&&_this.getkey(1)>0)) { __pc=16; break; }\n          {\n            //$LASTPOS=19004601;\n            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n          }\n          __pc=24;break;\n        case 16:\n          //$LASTPOS=19004650;\n          if (!(_this.mode=="get"&&_this.getkey(1)>0)) { __pc=18; break; }\n          //$LASTPOS=19004691;\n          _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);\n          //$LASTPOS=19004745;\n          _this.mode=_this.prevMode;\n          //$LASTPOS=19004769;\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=19004803;\n          _this.print(_this.mode+" mode");\n          //$LASTPOS=19004833;\n          _this.fiber$updateEx(_thread, 10);\n          __pc=17;return;\n        case 17:\n          \n          __pc=23;break;\n        case 18:\n          //$LASTPOS=19004858;\n          if (!(_this.mode=="setOn"&&_this.getkey(1)>0)) { __pc=19; break; }\n          {\n            //$LASTPOS=19004901;\n            Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n          }\n          __pc=22;break;\n        case 19:\n          //$LASTPOS=19004954;\n          if (!(_this.mode=="spuit"&&_this.getkey(1)>0)) { __pc=21; break; }\n          //$LASTPOS=19004997;\n          _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);\n          //$LASTPOS=19005046;\n          _this.mode="set";\n          //$LASTPOS=19005067;\n          _this.print(_this.mode+" mode");\n          //$LASTPOS=19005097;\n          _this.fiber$updateEx(_thread, 10);\n          __pc=20;return;\n        case 20:\n          \n        case 21:\n          \n        case 22:\n          \n        case 23:\n          \n        case 24:\n          \n        case 25:\n          \n          //$LASTPOS=19005123;\n          _this.fiber$update(_thread);\n          __pc=26;return;\n        case 26:\n          \n          __pc=14;break;\n        case 27:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.MapEditor,{"fullName":"kernel.MapEditor","namespace":"kernel","shortName":"MapEditor","decls":{"methods":{"main":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Pad=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_20000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20001202;\n    _this.APAD_DIAG_SIZE=96;\n    //$LASTPOS=20003465;\n    while (true) {\n      //$LASTPOS=20003484;\n      _this.padUpdate();\n      //$LASTPOS=20003502;\n      _this.update();\n      \n    }\n  },\n  fiber$main :function _trc_func_20000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=20001202;\n    _this.APAD_DIAG_SIZE=96;\n    \n    _thread.enter(function _trc_func_20000000_2(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=20003465;\n        case 1:\n          //$LASTPOS=20003484;\n          _this.fiber$padUpdate(_thread);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=20003502;\n          _this.fiber$update(_thread);\n          __pc=3;return;\n        case 3:\n          \n          __pc=1;break;\n        case 4:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initialize :function _trc_func_20000016_3(opt) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20000033;\n    Tonyu.classes.kernel.Actor.apply( _this, [opt]);\n    //$LASTPOS=20000050;\n    _this.padImageP=Tonyu.globals.$pat_inputPad;\n    //$LASTPOS=20000082;\n    _this.jujiKey=new Tonyu.classes.kernel.Actor({x: 96+1,y: Tonyu.globals.$screenHeight-96-1,p: _this.padImageP+0,zOrder: - 9,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=20000183;\n    _this.no1Key=new Tonyu.classes.kernel.Actor({x: Tonyu.globals.$screenWidth-96,y: Tonyu.globals.$screenHeight-96,p: _this.padImageP+1,zOrder: - 9,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=20000292;\n    _this.jujiKey.show();\n    //$LASTPOS=20000313;\n    _this.no1Key.show();\n    //$LASTPOS=20000339;\n    _this.jujiKeyPushU=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y-60,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=20000446;\n    _this.jujiKeyPushL=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x-60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=20000553;\n    _this.jujiKeyPushR=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x+60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=20000660;\n    _this.jujiKeyPushD=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y+60,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=20000767;\n    _this.jujiKeyPush1=new Tonyu.classes.kernel.Actor({x: _this.no1Key.x,y: _this.no1Key.y,p: _this.padImageP+2,scaleX: 2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=20000879;\n    _this.jujiKeyPushU.hide();\n    //$LASTPOS=20000905;\n    _this.jujiKeyPushL.hide();\n    //$LASTPOS=20000931;\n    _this.jujiKeyPushR.hide();\n    //$LASTPOS=20000957;\n    _this.jujiKeyPushD.hide();\n    //$LASTPOS=20000983;\n    _this.jujiKeyPush1.hide();\n  },\n  die :function _trc_func_20001008_4() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20001021;\n    _this.jujiKey.die();\n    //$LASTPOS=20001041;\n    _this.no1Key.die();\n    //$LASTPOS=20001060;\n    _this.jujiKeyPushU.die();\n    //$LASTPOS=20001085;\n    _this.jujiKeyPushL.die();\n    //$LASTPOS=20001110;\n    _this.jujiKeyPushR.die();\n    //$LASTPOS=20001135;\n    _this.jujiKeyPushD.die();\n    //$LASTPOS=20001160;\n    _this.jujiKeyPush1.die();\n    //$LASTPOS=20001185;\n    Tonyu.classes.kernel.Actor.prototype.die.apply( _this, []);\n  },\n  padUpdate :function _trc_func_20001224_5() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    var t;\n    \n    //$LASTPOS=20001258;\n    _this.keyPushL=0;\n    //$LASTPOS=20001277;\n    _this.keyPushR=0;\n    //$LASTPOS=20001296;\n    _this.keyPushU=0;\n    //$LASTPOS=20001315;\n    _this.keyPushD=0;\n    //$LASTPOS=20001334;\n    _this.keyPush1=0;\n    //$LASTPOS=20001359;\n    _this.padKeyNotapCnt++;\n    //$LASTPOS=20001383;\n    //$LASTPOS=20001388;\n    i = 0;\n    while(i<5) {\n      {\n        //$LASTPOS=20001436;\n        t = Tonyu.globals.$touches[i];\n        //$LASTPOS=20001466;\n        if (t.touched) {\n          //$LASTPOS=20001496;\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {\n            //$LASTPOS=20001593;\n            _this.keyPushU=1;\n          }\n          //$LASTPOS=20001620;\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {\n            //$LASTPOS=20001717;\n            _this.keyPushD=1;\n          }\n          //$LASTPOS=20001744;\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n            //$LASTPOS=20001841;\n            _this.keyPushL=1;\n          }\n          //$LASTPOS=20001868;\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n            //$LASTPOS=20001965;\n            _this.keyPushR=1;\n          }\n          //$LASTPOS=20001992;\n          if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {\n            //$LASTPOS=20002054;\n            _this.keyPush1=1;\n          }\n          //$LASTPOS=20002081;\n          _this.padKeySW=1;\n          //$LASTPOS=20002108;\n          _this.padKeyNotapCnt=0;\n          \n        }\n      }\n      i++;\n    }\n    //$LASTPOS=20002173;\n    if (_this.keyPushL) {\n      //$LASTPOS=20002187;\n      _this.keyCntL++;\n    } else {\n      //$LASTPOS=20002204;\n      _this.keyCntL=0;\n    }\n    //$LASTPOS=20002222;\n    if (_this.keyPushR) {\n      //$LASTPOS=20002236;\n      _this.keyCntR++;\n    } else {\n      //$LASTPOS=20002253;\n      _this.keyCntR=0;\n    }\n    //$LASTPOS=20002271;\n    if (_this.keyPushU) {\n      //$LASTPOS=20002285;\n      _this.keyCntU++;\n    } else {\n      //$LASTPOS=20002302;\n      _this.keyCntU=0;\n    }\n    //$LASTPOS=20002320;\n    if (_this.keyPushD) {\n      //$LASTPOS=20002334;\n      _this.keyCntD++;\n    } else {\n      //$LASTPOS=20002351;\n      _this.keyCntD=0;\n    }\n    //$LASTPOS=20002369;\n    if (_this.keyPush1) {\n      //$LASTPOS=20002383;\n      _this.keyCnt1++;\n    } else {\n      //$LASTPOS=20002400;\n      _this.keyCnt1=0;\n    }\n    //$LASTPOS=20002435;\n    if (_this.keyPushL) {\n      //$LASTPOS=20002449;\n      _this.jujiKeyPushL.show();\n    } else {\n      //$LASTPOS=20002475;\n      _this.jujiKeyPushL.hide();\n    }\n    //$LASTPOS=20002501;\n    if (_this.keyPushR) {\n      //$LASTPOS=20002515;\n      _this.jujiKeyPushR.show();\n    } else {\n      //$LASTPOS=20002541;\n      _this.jujiKeyPushR.hide();\n    }\n    //$LASTPOS=20002567;\n    if (_this.keyPushU) {\n      //$LASTPOS=20002581;\n      _this.jujiKeyPushU.show();\n    } else {\n      //$LASTPOS=20002607;\n      _this.jujiKeyPushU.hide();\n    }\n    //$LASTPOS=20002633;\n    if (_this.keyPushD) {\n      //$LASTPOS=20002647;\n      _this.jujiKeyPushD.show();\n    } else {\n      //$LASTPOS=20002673;\n      _this.jujiKeyPushD.hide();\n    }\n    //$LASTPOS=20002699;\n    if (_this.keyPush1) {\n      //$LASTPOS=20002713;\n      _this.jujiKeyPush1.show();\n    } else {\n      //$LASTPOS=20002739;\n      _this.jujiKeyPush1.hide();\n    }\n  },\n  fiber$padUpdate :function _trc_func_20001224_6(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    var t;\n    \n    //$LASTPOS=20001258;\n    _this.keyPushL=0;\n    //$LASTPOS=20001277;\n    _this.keyPushR=0;\n    //$LASTPOS=20001296;\n    _this.keyPushU=0;\n    //$LASTPOS=20001315;\n    _this.keyPushD=0;\n    //$LASTPOS=20001334;\n    _this.keyPush1=0;\n    //$LASTPOS=20001359;\n    _this.padKeyNotapCnt++;\n    //$LASTPOS=20001383;\n    //$LASTPOS=20001388;\n    i = 0;\n    while(i<5) {\n      {\n        //$LASTPOS=20001436;\n        t = Tonyu.globals.$touches[i];\n        //$LASTPOS=20001466;\n        if (t.touched) {\n          //$LASTPOS=20001496;\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {\n            //$LASTPOS=20001593;\n            _this.keyPushU=1;\n          }\n          //$LASTPOS=20001620;\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {\n            //$LASTPOS=20001717;\n            _this.keyPushD=1;\n          }\n          //$LASTPOS=20001744;\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n            //$LASTPOS=20001841;\n            _this.keyPushL=1;\n          }\n          //$LASTPOS=20001868;\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n            //$LASTPOS=20001965;\n            _this.keyPushR=1;\n          }\n          //$LASTPOS=20001992;\n          if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {\n            //$LASTPOS=20002054;\n            _this.keyPush1=1;\n          }\n          //$LASTPOS=20002081;\n          _this.padKeySW=1;\n          //$LASTPOS=20002108;\n          _this.padKeyNotapCnt=0;\n          \n        }\n      }\n      i++;\n    }\n    //$LASTPOS=20002173;\n    if (_this.keyPushL) {\n      //$LASTPOS=20002187;\n      _this.keyCntL++;\n    } else {\n      //$LASTPOS=20002204;\n      _this.keyCntL=0;\n    }\n    //$LASTPOS=20002222;\n    if (_this.keyPushR) {\n      //$LASTPOS=20002236;\n      _this.keyCntR++;\n    } else {\n      //$LASTPOS=20002253;\n      _this.keyCntR=0;\n    }\n    //$LASTPOS=20002271;\n    if (_this.keyPushU) {\n      //$LASTPOS=20002285;\n      _this.keyCntU++;\n    } else {\n      //$LASTPOS=20002302;\n      _this.keyCntU=0;\n    }\n    //$LASTPOS=20002320;\n    if (_this.keyPushD) {\n      //$LASTPOS=20002334;\n      _this.keyCntD++;\n    } else {\n      //$LASTPOS=20002351;\n      _this.keyCntD=0;\n    }\n    //$LASTPOS=20002369;\n    if (_this.keyPush1) {\n      //$LASTPOS=20002383;\n      _this.keyCnt1++;\n    } else {\n      //$LASTPOS=20002400;\n      _this.keyCnt1=0;\n    }\n    //$LASTPOS=20002435;\n    if (_this.keyPushL) {\n      //$LASTPOS=20002449;\n      _this.jujiKeyPushL.show();\n    } else {\n      //$LASTPOS=20002475;\n      _this.jujiKeyPushL.hide();\n    }\n    //$LASTPOS=20002501;\n    if (_this.keyPushR) {\n      //$LASTPOS=20002515;\n      _this.jujiKeyPushR.show();\n    } else {\n      //$LASTPOS=20002541;\n      _this.jujiKeyPushR.hide();\n    }\n    //$LASTPOS=20002567;\n    if (_this.keyPushU) {\n      //$LASTPOS=20002581;\n      _this.jujiKeyPushU.show();\n    } else {\n      //$LASTPOS=20002607;\n      _this.jujiKeyPushU.hide();\n    }\n    //$LASTPOS=20002633;\n    if (_this.keyPushD) {\n      //$LASTPOS=20002647;\n      _this.jujiKeyPushD.show();\n    } else {\n      //$LASTPOS=20002673;\n      _this.jujiKeyPushD.hide();\n    }\n    //$LASTPOS=20002699;\n    if (_this.keyPush1) {\n      //$LASTPOS=20002713;\n      _this.jujiKeyPush1.show();\n    } else {\n      //$LASTPOS=20002739;\n      _this.jujiKeyPush1.hide();\n    }\n    \n    _thread.retVal=_this;return;\n  },\n  getPadUp :function _trc_func_20002772_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntU;\n  },\n  fiber$getPadUp :function _trc_func_20002772_8(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntU;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getPadDown :function _trc_func_20002808_9() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntD;\n  },\n  fiber$getPadDown :function _trc_func_20002808_10(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntD;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getPadLeft :function _trc_func_20002844_11() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntL;\n  },\n  fiber$getPadLeft :function _trc_func_20002844_12(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntL;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getPadRight :function _trc_func_20002880_13() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntR;\n  },\n  fiber$getPadRight :function _trc_func_20002880_14(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntR;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getPadButton :function _trc_func_20002916_15(i) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var value;\n    \n    //$LASTPOS=20002940;\n    value;\n    //$LASTPOS=20002956;\n    if (i==0) {\n      //$LASTPOS=20002968;\n      value=_this.keyCnt1;\n    }\n    return value;\n  },\n  fiber$getPadButton :function _trc_func_20002916_16(_thread,i) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var value;\n    \n    //$LASTPOS=20002940;\n    value;\n    //$LASTPOS=20002956;\n    if (i==0) {\n      //$LASTPOS=20002968;\n      value=_this.keyCnt1;\n    }\n    _thread.retVal=value;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getUp :function _trc_func_20003010_17() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntU;\n  },\n  fiber$getUp :function _trc_func_20003010_18(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntU;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getDown :function _trc_func_20003043_19() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntD;\n  },\n  fiber$getDown :function _trc_func_20003043_20(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntD;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getLeft :function _trc_func_20003076_21() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntL;\n  },\n  fiber$getLeft :function _trc_func_20003076_22(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntL;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getRight :function _trc_func_20003109_23() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntR;\n  },\n  fiber$getRight :function _trc_func_20003109_24(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntR;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getButton :function _trc_func_20003142_25(i) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var value;\n    \n    //$LASTPOS=20003163;\n    value;\n    //$LASTPOS=20003179;\n    if (i==0) {\n      //$LASTPOS=20003191;\n      value=_this.keyCnt1;\n    }\n    return value;\n  },\n  fiber$getButton :function _trc_func_20003142_26(_thread,i) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var value;\n    \n    //$LASTPOS=20003163;\n    value;\n    //$LASTPOS=20003179;\n    if (i==0) {\n      //$LASTPOS=20003191;\n      value=_this.keyCnt1;\n    }\n    _thread.retVal=value;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  isOnRect :function _trc_func_20003243_27(mx,my,rx,ry,rx2,ry2) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return (rx<=mx&&mx<rx2&&ry<=my&&my<ry2);\n  },\n  fiber$isOnRect :function _trc_func_20003243_28(_thread,mx,my,rx,ry,rx2,ry2) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=(rx<=mx&&mx<rx2&&ry<=my&&my<ry2);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  isOnRectWH :function _trc_func_20003357_29(mx,my,rx,ry,rw,rh) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return (rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);\n  },\n  fiber$isOnRectWH :function _trc_func_20003357_30(_thread,mx,my,rx,ry,rw,rh) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=(rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Pad,{"fullName":"kernel.Pad","namespace":"kernel","shortName":"Pad","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"die":{"nowait":true},"padUpdate":{"nowait":false},"getPadUp":{"nowait":false},"getPadDown":{"nowait":false},"getPadLeft":{"nowait":false},"getPadRight":{"nowait":false},"getPadButton":{"nowait":false},"getUp":{"nowait":false},"getDown":{"nowait":false},"getLeft":{"nowait":false},"getRight":{"nowait":false},"getButton":{"nowait":false},"isOnRect":{"nowait":false},"isOnRectWH":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Panel=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_21000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_21000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_21000056_2(opt) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21000072;\n    Tonyu.classes.kernel.Actor.apply( _this, [opt]);\n    //$LASTPOS=21000089;\n    _this.width=_this.width;\n    //$LASTPOS=21000112;\n    _this.height=_this.height;\n    //$LASTPOS=21000137;\n    if (_this.align==null) {\n      //$LASTPOS=21000153;\n      _this.align="center";\n    }\n    //$LASTPOS=21000174;\n    if (_this.alpha==null) {\n      //$LASTPOS=21000190;\n      _this.alpha=255;\n    }\n    //$LASTPOS=21000206;\n    if (_this._drawn==null) {\n      //$LASTPOS=21000223;\n      _this._drawn=false;\n    }\n    //$LASTPOS=21000242;\n    _this.buf=$("<canvas>").attr({width: _this.width,height: _this.height});\n  },\n  setPanel :function _trc_func_21000284_3(width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21000314;\n    _this.width=width;\n    //$LASTPOS=21000337;\n    _this.height=height;\n    //$LASTPOS=21000362;\n    _this.buf=$("<canvas>").attr({width: width,height: height});\n  },\n  fiber$setPanel :function _trc_func_21000284_4(_thread,width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=21000314;\n    _this.width=width;\n    //$LASTPOS=21000337;\n    _this.height=height;\n    //$LASTPOS=21000362;\n    _this.buf=$("<canvas>").attr({width: width,height: height});\n    \n    _thread.retVal=_this;return;\n  },\n  resize :function _trc_func_21000404_5(width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21000432;\n    _this.setPanel(width,height);\n  },\n  fiber$resize :function _trc_func_21000404_6(_thread,width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_21000404_7(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=21000432;\n          _this.fiber$setPanel(_thread, width, height);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  getContext :function _trc_func_21000460_8() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21000480;\n    _this._drawn=true;\n    return _this.buf[0].getContext("2d");\n  },\n  fiber$getContext :function _trc_func_21000460_9(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=21000480;\n    _this._drawn=true;\n    _thread.retVal=_this.buf[0].getContext("2d");return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setFillStyle :function _trc_func_21000534_10(color) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21000561;\n    _this.fillStyle=color;\n  },\n  fiber$setFillStyle :function _trc_func_21000534_11(_thread,color) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=21000561;\n    _this.fillStyle=color;\n    \n    _thread.retVal=_this;return;\n  },\n  fillRect :function _trc_func_21000587_12(x,y,rectWidth,rectHeight) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21000629;\n    _this.ctx=_this.getContext();\n    //$LASTPOS=21000652;\n    _this.ctx.save();\n    //$LASTPOS=21000719;\n    _this.ctx.fillStyle=_this.fillStyle;\n    //$LASTPOS=21000749;\n    _this.ctx.fillRect(x,y,rectWidth,rectHeight);\n    //$LASTPOS=21000794;\n    _this.ctx.restore();\n  },\n  fiber$fillRect :function _trc_func_21000587_13(_thread,x,y,rectWidth,rectHeight) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_21000587_14(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=21000629;\n          _this.fiber$getContext(_thread);\n          __pc=1;return;\n        case 1:\n          _this.ctx=_thread.retVal;\n          \n          //$LASTPOS=21000652;\n          _this.ctx.save();\n          //$LASTPOS=21000719;\n          _this.ctx.fillStyle=_this.fillStyle;\n          //$LASTPOS=21000749;\n          _this.ctx.fillRect(x,y,rectWidth,rectHeight);\n          //$LASTPOS=21000794;\n          _this.ctx.restore();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  fillText :function _trc_func_21000813_15(text,x,y,size,align) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21000850;\n    _this.ctx=_this.getContext();\n    //$LASTPOS=21000873;\n    _this.ctx.save();\n    //$LASTPOS=21000940;\n    _this.ctx.textAlign=align;\n    //$LASTPOS=21000968;\n    _this.ctx.fillStyle=_this.fillStyle;\n    //$LASTPOS=21000998;\n    _this.ctx.font=size+"px \'Courier New\'";\n    //$LASTPOS=21001037;\n    _this.ctx.fillText(text,x,y);\n    //$LASTPOS=21001066;\n    _this.ctx.restore();\n  },\n  fiber$fillText :function _trc_func_21000813_16(_thread,text,x,y,size,align) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_21000813_17(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=21000850;\n          _this.fiber$getContext(_thread);\n          __pc=1;return;\n        case 1:\n          _this.ctx=_thread.retVal;\n          \n          //$LASTPOS=21000873;\n          _this.ctx.save();\n          //$LASTPOS=21000940;\n          _this.ctx.textAlign=align;\n          //$LASTPOS=21000968;\n          _this.ctx.fillStyle=_this.fillStyle;\n          //$LASTPOS=21000998;\n          _this.ctx.font=size+"px \'Courier New\'";\n          //$LASTPOS=21001037;\n          _this.ctx.fillText(text,x,y);\n          //$LASTPOS=21001066;\n          _this.ctx.restore();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  clearRect :function _trc_func_21001085_18(clearX,clearY,clearW,clearH) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21001131;\n    _this.ctx=_this.getContext();\n    //$LASTPOS=21001154;\n    _this.ctx.save();\n    //$LASTPOS=21001171;\n    _this.ctx.clearRect(clearX,clearY,clearW,clearH);\n    //$LASTPOS=21001220;\n    _this.ctx.restore();\n  },\n  fiber$clearRect :function _trc_func_21001085_19(_thread,clearX,clearY,clearW,clearH) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_21001085_20(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=21001131;\n          _this.fiber$getContext(_thread);\n          __pc=1;return;\n        case 1:\n          _this.ctx=_thread.retVal;\n          \n          //$LASTPOS=21001154;\n          _this.ctx.save();\n          //$LASTPOS=21001171;\n          _this.ctx.clearRect(clearX,clearY,clearW,clearH);\n          //$LASTPOS=21001220;\n          _this.ctx.restore();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  getPixel :function _trc_func_21001239_21(getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21001266;\n    if (typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY)) {\n      //$LASTPOS=21001365;\n      _this.ctx=_this.getContext();\n      //$LASTPOS=21001392;\n      _this.imagedata=_this.ctx.getImageData(getX,getY,1,1);\n      //$LASTPOS=21001444;\n      _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];\n      \n    } else {\n      //$LASTPOS=21001584;\n      _this.colordata=[0,0,0,0];\n      \n    }\n    return (_this.colordata);\n  },\n  fiber$getPixel :function _trc_func_21001239_22(_thread,getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_21001239_23(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=21001266;\n          if (!(typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY))) { __pc=2; break; }\n          //$LASTPOS=21001365;\n          _this.fiber$getContext(_thread);\n          __pc=1;return;\n        case 1:\n          _this.ctx=_thread.retVal;\n          \n          //$LASTPOS=21001392;\n          _this.imagedata=_this.ctx.getImageData(getX,getY,1,1);\n          //$LASTPOS=21001444;\n          _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];\n          __pc=3;break;\n        case 2:\n          {\n            //$LASTPOS=21001584;\n            _this.colordata=[0,0,0,0];\n          }\n        case 3:\n          \n          _thread.exit((_this.colordata));return;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  scroll :function _trc_func_21001640_24(scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21001671;\n    _this.ctx=_this.getContext();\n    //$LASTPOS=21001694;\n    _this.ctx.save();\n    //$LASTPOS=21001711;\n    _this.imagedata=_this.ctx.getImageData(0,0,_this.width,_this.height);\n    //$LASTPOS=21001772;\n    _this.clearRect(0,0,_this.width,_this.height);\n    //$LASTPOS=21001806;\n    _this.ctx.putImageData(_this.imagedata,- scrollX,- scrollY);\n    //$LASTPOS=21001858;\n    _this.ctx.restore();\n  },\n  fiber$scroll :function _trc_func_21001640_25(_thread,scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_21001640_26(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=21001671;\n          _this.fiber$getContext(_thread);\n          __pc=1;return;\n        case 1:\n          _this.ctx=_thread.retVal;\n          \n          //$LASTPOS=21001694;\n          _this.ctx.save();\n          //$LASTPOS=21001711;\n          _this.imagedata=_this.ctx.getImageData(0,0,_this.width,_this.height);\n          //$LASTPOS=21001772;\n          _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=21001806;\n          _this.ctx.putImageData(_this.imagedata,- scrollX,- scrollY);\n          //$LASTPOS=21001858;\n          _this.ctx.restore();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  draw :function _trc_func_21001877_27(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=21001894;\n    if (_this._drawn) {\n      //$LASTPOS=21001915;\n      _this.pImg=_this.buf[0];\n      //$LASTPOS=21001937;\n      ctx.save();\n      //$LASTPOS=21001958;\n      if (_this.align=="left") {\n        //$LASTPOS=21001990;\n        ctx.translate(_this.x+_this.width/2,_this.y+_this.height/2);\n        \n      } else {\n        //$LASTPOS=21002042;\n        if (_this.align=="center") {\n          //$LASTPOS=21002076;\n          ctx.translate(_this.x,_this.y);\n          \n        } else {\n          //$LASTPOS=21002111;\n          if (_this.align=="right") {\n            //$LASTPOS=21002144;\n            ctx.translate(_this.x-_this.width/2,_this.y-_this.height/2);\n            \n          }\n        }\n      }\n      //$LASTPOS=21002201;\n      if (_this.rotation!=0) {\n        //$LASTPOS=21002236;\n        ctx.rotate(_this.rotation/180*Math.PI);\n        \n      } else {\n        //$LASTPOS=21002304;\n        ctx.rotate(_this.rotate/180*Math.PI);\n        \n      }\n      //$LASTPOS=21002361;\n      ctx.globalAlpha=_this.alpha/255;\n      //$LASTPOS=21002402;\n      ctx.drawImage(_this.pImg,0,0,_this.width,_this.height,- _this.width/2,- _this.height/2,_this.width,_this.height);\n      //$LASTPOS=21002506;\n      ctx.restore();\n      \n    }\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Panel,{"fullName":"kernel.Panel","namespace":"kernel","shortName":"Panel","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"setPanel":{"nowait":false},"resize":{"nowait":false},"getContext":{"nowait":false},"setFillStyle":{"nowait":false},"fillRect":{"nowait":false},"fillText":{"nowait":false},"clearRect":{"nowait":false},"getPixel":{"nowait":false},"scroll":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.PlainChar=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_22000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_22000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_22000047_2(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var thg;\n    \n    //$LASTPOS=22000066;\n    if (Tonyu.runMode) {\n      //$LASTPOS=22000096;\n      thg = _this.currentThreadGroup();\n      //$LASTPOS=22000135;\n      if (thg) {\n        //$LASTPOS=22000144;\n        _this._th=thg.addObj(_this,"tMain");\n      }\n      //$LASTPOS=22000183;\n      _this.initSprite();\n      \n    }\n    //$LASTPOS=22000209;\n    if (typeof  x=="object") {\n      //$LASTPOS=22000233;\n      Tonyu.extend(_this,x);\n    } else {\n      //$LASTPOS=22000266;\n      if (typeof  x=="number") {\n        //$LASTPOS=22000301;\n        _this.x=x;\n        //$LASTPOS=22000320;\n        _this.y=y;\n        //$LASTPOS=22000339;\n        _this.p=p;\n        \n      }\n    }\n  },\n  draw :function _trc_func_22000360_3(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=22000376;\n    _this.onDraw();\n    //$LASTPOS=22000391;\n    if (_this._isInvisible) {\n      return _this;\n    }\n    //$LASTPOS=22000422;\n    Tonyu.classes.kernel.Actor.prototype.draw.apply( _this, [c]);\n  },\n  setVisible :function _trc_func_22000441_4(v) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=22000463;\n    _this._isInvisible=! v;\n  },\n  fiber$setVisible :function _trc_func_22000441_5(_thread,v) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=22000463;\n    _this._isInvisible=! v;\n    \n    _thread.retVal=_this;return;\n  },\n  onDraw :function _trc_func_22000484_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$onDraw :function _trc_func_22000484_7(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  update :function _trc_func_22000506_8() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=22000523;\n    _this.onUpdate();\n    //$LASTPOS=22000540;\n    Tonyu.classes.kernel.Actor.prototype.update.apply( _this, []);\n  },\n  fiber$update :function _trc_func_22000506_9(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=22000523;\n    _this.onUpdate();\n    \n    _thread.enter(function _trc_func_22000506_10(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=22000540;\n          Tonyu.classes.kernel.Actor.prototype.fiber$update.apply( _this, [_thread]);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  onUpdate :function _trc_func_22000560_11() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  initSprite :function _trc_func_22000584_12() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=22000605;\n    if (_this.layer&&typeof  _this.layer.add=="function") {\n      //$LASTPOS=22000657;\n      _this.layer.add(_this);\n      \n    } else {\n      //$LASTPOS=22000695;\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    //$LASTPOS=22000727;\n    _this.onAppear();\n  },\n  fiber$initSprite :function _trc_func_22000584_13(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=22000605;\n    if (_this.layer&&typeof  _this.layer.add=="function") {\n      //$LASTPOS=22000657;\n      _this.layer.add(_this);\n      \n    } else {\n      //$LASTPOS=22000695;\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    \n    _thread.enter(function _trc_func_22000584_14(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=22000727;\n          _this.fiber$onAppear(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  tMain :function _trc_func_22000743_15() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=22000759;\n    _this.main();\n    //$LASTPOS=22000772;\n    _this.die();\n  },\n  fiber$tMain :function _trc_func_22000743_16(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_22000743_17(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=22000759;\n          _this.fiber$main(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=22000772;\n          _this.die();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  color :function _trc_func_22000783_18(r,g,b) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return "rgb("+[r,g,b].join(",")+")";\n  },\n  fiber$color :function _trc_func_22000783_19(_thread,r,g,b) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal="rgb("+[r,g,b].join(",")+")";return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  drawText :function _trc_func_22000845_20(x,y,text,col,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var tp;\n    \n    //$LASTPOS=22000881;\n    if (Tonyu.globals.$debug) {\n      return _this;\n    }\n    //$LASTPOS=22000906;\n    if (! size) {\n      //$LASTPOS=22000917;\n      size=15;\n    }\n    //$LASTPOS=22000931;\n    if (! col) {\n      //$LASTPOS=22000941;\n      col="cyan";\n    }\n    //$LASTPOS=22000958;\n    tp = _this.all(Tonyu.classes.kernel.T1Text).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=22001012;\n    if (tp.length>0) {\n      //$LASTPOS=22001040;\n      tp[0].extend({x: x,y: y,text: text,fillStyle: col,size: size,hidden: false});\n      \n    } else {\n      //$LASTPOS=22001119;\n      new Tonyu.classes.kernel.T1Text({x: x,y: y,text: text,fillStyle: col,size: size});\n      \n    }\n  },\n  fiber$drawText :function _trc_func_22000845_21(_thread,x,y,text,col,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var tp;\n    \n    //$LASTPOS=22000881;\n    if (Tonyu.globals.$debug) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=22000906;\n    if (! size) {\n      //$LASTPOS=22000917;\n      size=15;\n    }\n    //$LASTPOS=22000931;\n    if (! col) {\n      //$LASTPOS=22000941;\n      col="cyan";\n    }\n    //$LASTPOS=22000958;\n    tp = _this.all(Tonyu.classes.kernel.T1Text).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=22001012;\n    if (tp.length>0) {\n      //$LASTPOS=22001040;\n      tp[0].extend({x: x,y: y,text: text,fillStyle: col,size: size,hidden: false});\n      \n    } else {\n      //$LASTPOS=22001119;\n      new Tonyu.classes.kernel.T1Text({x: x,y: y,text: text,fillStyle: col,size: size});\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  drawLine :function _trc_func_22001174_22(x,y,tx,ty,col) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var tp;\n    \n    //$LASTPOS=22001206;\n    if (! col) {\n      //$LASTPOS=22001216;\n      col="white";\n    }\n    //$LASTPOS=22001234;\n    tp = _this.all(Tonyu.classes.kernel.T1Line).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=22001288;\n    if (tp.length>0) {\n      //$LASTPOS=22001316;\n      tp[0].extend({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    } else {\n      //$LASTPOS=22001367;\n      new Tonyu.classes.kernel.T1Line({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    }\n  },\n  fiber$drawLine :function _trc_func_22001174_23(_thread,x,y,tx,ty,col) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var tp;\n    \n    //$LASTPOS=22001206;\n    if (! col) {\n      //$LASTPOS=22001216;\n      col="white";\n    }\n    //$LASTPOS=22001234;\n    tp = _this.all(Tonyu.classes.kernel.T1Line).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=22001288;\n    if (tp.length>0) {\n      //$LASTPOS=22001316;\n      tp[0].extend({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    } else {\n      //$LASTPOS=22001367;\n      new Tonyu.classes.kernel.T1Line({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  appear :function _trc_func_22001407_24(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return t;\n  },\n  fiber$appear :function _trc_func_22001407_25(_thread,t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=t;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  trunc :function _trc_func_22001439_26(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.trunc(f);\n  },\n  loadPage :function _trc_func_22001482_27(page,arg) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=22001508;\n    _this.all().die();\n    //$LASTPOS=22001526;\n    new page(arg);\n    //$LASTPOS=22001546;\n    _this.die();\n  },\n  fiber$loadPage :function _trc_func_22001482_28(_thread,page,arg) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=22001508;\n    _this.all().die();\n    //$LASTPOS=22001526;\n    new page(arg);\n    //$LASTPOS=22001546;\n    _this.die();\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.PlainChar,{"fullName":"kernel.PlainChar","namespace":"kernel","shortName":"PlainChar","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true},"setVisible":{"nowait":false},"onDraw":{"nowait":false},"update":{"nowait":false},"onUpdate":{"nowait":true},"initSprite":{"nowait":false},"tMain":{"nowait":false},"color":{"nowait":false},"drawText":{"nowait":false},"drawLine":{"nowait":false},"appear":{"nowait":false},"trunc":{"nowait":true},"loadPage":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.ScaledCanvas=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_23000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_23000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_23000077_2(opt) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23000095;\n    _this.extend(opt);\n    //$LASTPOS=23000142;\n    _this.resize(_this.width,_this.height);\n    //$LASTPOS=23000170;\n    _this.cw=_this.canvas.width();\n    //$LASTPOS=23000194;\n    _this.ch=_this.canvas.height();\n    //$LASTPOS=23000219;\n    _this.cctx=_this.canvas[0].getContext("2d");\n    //$LASTPOS=23000257;\n    _this.color="rgb(20,80,180)";\n    //$LASTPOS=23000291;\n    _this.sx=0;\n    //$LASTPOS=23000302;\n    _this.sy=0;\n    //$LASTPOS=23000313;\n    _this.isDrawGrid=Tonyu.globals.$Sprites.isDrawGrid;\n  },\n  resize :function _trc_func_23000349_3(width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23000378;\n    _this.width=width;\n    //$LASTPOS=23000401;\n    _this.height=height;\n    //$LASTPOS=23000426;\n    _this.buf=$("<canvas>").attr({width: width,height: height});\n    //$LASTPOS=23000469;\n    _this.ctx=_this.buf[0].getContext("2d");\n    //$LASTPOS=23000505;\n    Tonyu.globals.$screenWidth=width;\n    //$LASTPOS=23000530;\n    Tonyu.globals.$screenHeight=height;\n    //$LASTPOS=23000557;\n    if (Tonyu.globals.$panel) {\n      //$LASTPOS=23000578;\n      Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);\n      \n    }\n  },\n  fiber$resize :function _trc_func_23000349_4(_thread,width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=23000378;\n    _this.width=width;\n    //$LASTPOS=23000401;\n    _this.height=height;\n    //$LASTPOS=23000426;\n    _this.buf=$("<canvas>").attr({width: width,height: height});\n    //$LASTPOS=23000469;\n    _this.ctx=_this.buf[0].getContext("2d");\n    //$LASTPOS=23000505;\n    Tonyu.globals.$screenWidth=width;\n    //$LASTPOS=23000530;\n    Tonyu.globals.$screenHeight=height;\n    //$LASTPOS=23000557;\n    if (Tonyu.globals.$panel) {\n      //$LASTPOS=23000578;\n      Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  shouldDraw1x1 :function _trc_func_23000634_5(srcw,srch,dstw,dsth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var larger;\n    var smaller;\n    \n    //$LASTPOS=23000712;\n    larger = 200;\n    //$LASTPOS=23000733;\n    smaller = 5;\n    return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;\n  },\n  fiber$shouldDraw1x1 :function _trc_func_23000634_6(_thread,srcw,srch,dstw,dsth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var larger;\n    var smaller;\n    \n    //$LASTPOS=23000712;\n    larger = 200;\n    //$LASTPOS=23000733;\n    smaller = 5;\n    _thread.retVal=srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_23000853_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var calcw;\n    var calch;\n    var marginw;\n    var marginh;\n    \n    //$LASTPOS=23000868;\n    _this.cw=_this.canvas.width();\n    //$LASTPOS=23000892;\n    _this.ch=_this.canvas.height();\n    //$LASTPOS=23000917;\n    calcw = _this.ch/_this.height*_this.width;\n    //$LASTPOS=23000961;\n    calch = _this.cw/_this.width*_this.height;\n    //$LASTPOS=23001005;\n    if (calch>_this.ch) {\n      //$LASTPOS=23001019;\n      calch=_this.ch;\n    }\n    //$LASTPOS=23001034;\n    if (calcw>_this.cw) {\n      //$LASTPOS=23001048;\n      calcw=_this.cw;\n    }\n    //$LASTPOS=23001063;\n    _this.cctx.clearRect(0,0,_this.cw,_this.ch);\n    //$LASTPOS=23001095;\n    if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n      //$LASTPOS=23001151;\n      calcw=_this.width;\n      //$LASTPOS=23001163;\n      calch=_this.height;\n      \n    }\n    //$LASTPOS=23001189;\n    marginw = Math.floor((_this.cw-calcw)/2);\n    //$LASTPOS=23001232;\n    marginh = Math.floor((_this.ch-calch)/2);\n    //$LASTPOS=23001275;\n    _this.cctx.drawImage(_this.buf[0],0,0,_this.width,_this.height,marginw,marginh,calcw,calch);\n  },\n  canvas2buf :function _trc_func_23001364_8(point) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var calcw;\n    var calch;\n    var marginw;\n    var marginh;\n    \n    //$LASTPOS=23001390;\n    calcw = _this.ch/_this.height*_this.width;\n    //$LASTPOS=23001434;\n    calch = _this.cw/_this.width*_this.height;\n    //$LASTPOS=23001478;\n    if (calch>_this.ch) {\n      //$LASTPOS=23001492;\n      calch=_this.ch;\n    }\n    //$LASTPOS=23001507;\n    if (calcw>_this.cw) {\n      //$LASTPOS=23001521;\n      calcw=_this.cw;\n    }\n    //$LASTPOS=23001536;\n    if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n      //$LASTPOS=23001592;\n      calcw=_this.width;\n      //$LASTPOS=23001604;\n      calch=_this.height;\n      \n    }\n    //$LASTPOS=23001630;\n    marginw = Math.floor((_this.cw-calcw)/2);\n    //$LASTPOS=23001673;\n    marginh = Math.floor((_this.ch-calch)/2);\n    return {x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};\n  },\n  fiber$canvas2buf :function _trc_func_23001364_9(_thread,point) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var calcw;\n    var calch;\n    var marginw;\n    var marginh;\n    \n    //$LASTPOS=23001390;\n    calcw = _this.ch/_this.height*_this.width;\n    //$LASTPOS=23001434;\n    calch = _this.cw/_this.width*_this.height;\n    //$LASTPOS=23001478;\n    if (calch>_this.ch) {\n      //$LASTPOS=23001492;\n      calch=_this.ch;\n    }\n    //$LASTPOS=23001507;\n    if (calcw>_this.cw) {\n      //$LASTPOS=23001521;\n      calcw=_this.cw;\n    }\n    //$LASTPOS=23001536;\n    if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n      //$LASTPOS=23001592;\n      calcw=_this.width;\n      //$LASTPOS=23001604;\n      calch=_this.height;\n      \n    }\n    //$LASTPOS=23001630;\n    marginw = Math.floor((_this.cw-calcw)/2);\n    //$LASTPOS=23001673;\n    marginh = Math.floor((_this.ch-calch)/2);\n    _thread.retVal={x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setBGColor :function _trc_func_23001810_10(color) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23001835;\n    _this.color=color;\n  },\n  fiber$setBGColor :function _trc_func_23001810_11(_thread,color) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=23001835;\n    _this.color=color;\n    \n    _thread.retVal=_this;return;\n  },\n  fillCanvas :function _trc_func_23001857_12(cv) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var ctx;\n    \n    //$LASTPOS=23001879;\n    ctx = cv.getContext("2d");\n    //$LASTPOS=23001913;\n    ctx.save();\n    //$LASTPOS=23001930;\n    ctx.fillStyle=Tonyu.globals.$Screen.color;\n    //$LASTPOS=23001964;\n    ctx.fillStyle=Tonyu.bindFunc(_this,_this.color);\n    //$LASTPOS=23001990;\n    ctx.fillRect(0,0,cv.width,cv.height);\n    //$LASTPOS=23002033;\n    if (_this.isDrawGrid) {\n      //$LASTPOS=23002049;\n      _this.drawGrid(cv);\n    }\n    //$LASTPOS=23002068;\n    ctx.restore();\n  },\n  fiber$fillCanvas :function _trc_func_23001857_13(_thread,cv) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var ctx;\n    \n    //$LASTPOS=23001879;\n    ctx = cv.getContext("2d");\n    //$LASTPOS=23001913;\n    ctx.save();\n    //$LASTPOS=23001930;\n    ctx.fillStyle=Tonyu.globals.$Screen.color;\n    //$LASTPOS=23001964;\n    ctx.fillStyle=Tonyu.bindFunc(_this,_this.color);\n    //$LASTPOS=23001990;\n    ctx.fillRect(0,0,cv.width,cv.height);\n    //$LASTPOS=23002033;\n    if (_this.isDrawGrid) {\n      //$LASTPOS=23002049;\n      _this.drawGrid(cv);\n    }\n    //$LASTPOS=23002068;\n    ctx.restore();\n    \n    _thread.retVal=_this;return;\n  },\n  scrollTo :function _trc_func_23002087_14(scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23002412;\n    Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);\n  },\n  fiber$scrollTo :function _trc_func_23002087_15(_thread,scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=23002412;\n    Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.ScaledCanvas,{"fullName":"kernel.ScaledCanvas","namespace":"kernel","shortName":"ScaledCanvas","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"resize":{"nowait":false},"shouldDraw1x1":{"nowait":false},"draw":{"nowait":true},"canvas2buf":{"nowait":false},"setBGColor":{"nowait":false},"fillCanvas":{"nowait":false},"scrollTo":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.SecretChar=Tonyu.klass(Tonyu.classes.kernel.PlainChar,[],{\n  main :function _trc_func_24000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_24000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_24000022_2(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.SecretChar,{"fullName":"kernel.SecretChar","namespace":"kernel","shortName":"SecretChar","decls":{"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.SpriteChar=Tonyu.klass(Tonyu.classes.kernel.PlainChar,[],{\n  main :function _trc_func_25000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_25000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_25000022_2(x,y,p,f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=25000043;\n    Tonyu.classes.kernel.PlainChar.apply( _this, [x,y,p]);\n    //$LASTPOS=25000062;\n    _this.f=f;\n    //$LASTPOS=25000077;\n    if (! _this.x) {\n      //$LASTPOS=25000090;\n      _this.x=0;\n    }\n    //$LASTPOS=25000105;\n    if (! _this.y) {\n      //$LASTPOS=25000118;\n      _this.y=0;\n    }\n    //$LASTPOS=25000133;\n    if (! _this.p) {\n      //$LASTPOS=25000146;\n      _this.p=0;\n    }\n  },\n  draw :function _trc_func_25000160_3(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=25000176;\n    if (_this.f) {\n      //$LASTPOS=25000194;\n      if (! _this.scaleY) {\n        //$LASTPOS=25000207;\n        _this.scaleY=_this.scaleX;\n      }\n      //$LASTPOS=25000231;\n      _this.scaleX*=- 1;\n      \n    }\n    //$LASTPOS=25000255;\n    Tonyu.classes.kernel.PlainChar.prototype.draw.apply( _this, [c]);\n    //$LASTPOS=25000275;\n    if (_this.f) {\n      //$LASTPOS=25000282;\n      _this.scaleX*=- 1;\n    }\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.SpriteChar,{"fullName":"kernel.SpriteChar","namespace":"kernel","shortName":"SpriteChar","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Sprites=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_26000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_26000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_26000031_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=26000045;\n    _this.sprites=[];\n    //$LASTPOS=26000062;\n    _this.imageList=[];\n    //$LASTPOS=26000081;\n    _this.hitWatchers=[];\n    //$LASTPOS=26000102;\n    _this.isDrawGrid=Tonyu.noviceMode;\n    //$LASTPOS=26000136;\n    _this.sx=0;\n    //$LASTPOS=26000147;\n    _this.sy=0;\n    //$LASTPOS=26000158;\n    _this.objId=0;\n  },\n  add :function _trc_func_26000171_3(s) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=26000194;\n    if (s.__addedToSprites) {\n      return _this;\n    }\n    //$LASTPOS=26000231;\n    _this.sprites.push(s);\n    //$LASTPOS=26000253;\n    if (s.__genId==null) {\n      //$LASTPOS=26000283;\n      s.__genId=_this.objId;\n      //$LASTPOS=26000309;\n      _this.objId++;\n      \n    }\n    //$LASTPOS=26000330;\n    s.__addedToSprites=_this;\n    return s;\n  },\n  fiber$add :function _trc_func_26000171_4(_thread,s) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=26000194;\n    if (s.__addedToSprites) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=26000231;\n    _this.sprites.push(s);\n    //$LASTPOS=26000253;\n    if (s.__genId==null) {\n      //$LASTPOS=26000283;\n      s.__genId=_this.objId;\n      //$LASTPOS=26000309;\n      _this.objId++;\n      \n    }\n    //$LASTPOS=26000330;\n    s.__addedToSprites=_this;\n    _thread.retVal=s;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  remove :function _trc_func_26000374_5(s) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var idx;\n    \n    //$LASTPOS=26000400;\n    idx = _this.sprites.indexOf(s);\n    //$LASTPOS=26000433;\n    if (idx<0) {\n      return _this;\n    }\n    //$LASTPOS=26000457;\n    _this.sprites.splice(idx,1);\n    //$LASTPOS=26000485;\n    delete s.__addedToSprites;\n  },\n  fiber$remove :function _trc_func_26000374_6(_thread,s) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var idx;\n    \n    //$LASTPOS=26000400;\n    idx = _this.sprites.indexOf(s);\n    //$LASTPOS=26000433;\n    if (idx<0) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=26000457;\n    _this.sprites.splice(idx,1);\n    //$LASTPOS=26000485;\n    delete s.__addedToSprites;\n    \n    _thread.retVal=_this;return;\n  },\n  clear :function _trc_func_26000516_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=26000534;\n    _this.sprites.splice(0,_this.sprites.length);\n  },\n  fiber$clear :function _trc_func_26000516_8(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=26000534;\n    _this.sprites.splice(0,_this.sprites.length);\n    \n    _thread.retVal=_this;return;\n  },\n  compOrder :function _trc_func_26000570_9(obj1,obj2) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var val1;\n    var val2;\n    \n    //$LASTPOS=26000607;\n    val1 = obj1.zOrder;\n    //$LASTPOS=26000634;\n    val2 = obj2.zOrder;\n    //$LASTPOS=26000661;\n    if (val1>val2) {\n      return - 1;\n      \n    } else {\n      //$LASTPOS=26000707;\n      if (val1<val2) {\n        return 1;\n        \n      } else {\n        //$LASTPOS=26000752;\n        if (val1==val2) {\n          //$LASTPOS=26000777;\n          if (obj1.__genId>obj2.__genId) {\n            return 1;\n            \n          } else {\n            return - 1;\n            \n          }\n          return 0;\n          \n        }\n      }\n    }\n  },\n  fiber$compOrder :function _trc_func_26000570_10(_thread,obj1,obj2) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var val1;\n    var val2;\n    \n    //$LASTPOS=26000607;\n    val1 = obj1.zOrder;\n    //$LASTPOS=26000634;\n    val2 = obj2.zOrder;\n    //$LASTPOS=26000661;\n    if (val1>val2) {\n      _thread.retVal=- 1;return;\n      \n      \n    } else {\n      //$LASTPOS=26000707;\n      if (val1<val2) {\n        _thread.retVal=1;return;\n        \n        \n      } else {\n        //$LASTPOS=26000752;\n        if (val1==val2) {\n          //$LASTPOS=26000777;\n          if (obj1.__genId>obj2.__genId) {\n            _thread.retVal=1;return;\n            \n            \n          } else {\n            _thread.retVal=- 1;return;\n            \n            \n          }\n          _thread.retVal=0;return;\n          \n          \n        }\n      }\n    }\n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_26000912_11(cv) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var ctx;\n    var orderArray;\n    \n    //$LASTPOS=26000937;\n    ctx = cv.getContext("2d");\n    //$LASTPOS=26000971;\n    ctx.save();\n    //$LASTPOS=26001116;\n    orderArray = [];\n    //$LASTPOS=26001140;\n    orderArray=orderArray.concat(_this.sprites);\n    //$LASTPOS=26001184;\n    orderArray.sort(Tonyu.bindFunc(_this,_this.compOrder));\n    //$LASTPOS=26001217;\n    ctx.translate(- _this.sx,- _this.sy);\n    //$LASTPOS=26001246;\n    orderArray.forEach(function (s) {\n      \n      //$LASTPOS=26001280;\n      s.draw(ctx);\n    });\n    //$LASTPOS=26001307;\n    ctx.restore();\n  },\n  checkHit :function _trc_func_26001326_12() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=26001353;\n    _this.hitWatchers.forEach(function (w) {\n      \n      //$LASTPOS=26001397;\n      _this.sprites.forEach(function (a) {\n        var a_owner;\n        \n        //$LASTPOS=26001485;\n        a_owner = a;\n        //$LASTPOS=26001527;\n        if (! (a_owner instanceof w.A)) {\n          return _this;\n        }\n        //$LASTPOS=26001580;\n        _this.sprites.forEach(function (b) {\n          var b_owner;\n          \n          //$LASTPOS=26001628;\n          b_owner = b;\n          //$LASTPOS=26001674;\n          if (a===b) {\n            return _this;\n          }\n          //$LASTPOS=26001710;\n          if (! (b_owner instanceof w.B)) {\n            return _this;\n          }\n          //$LASTPOS=26001815;\n          if (a.crashTo1(b)) {\n            //$LASTPOS=26001918;\n            w.h(a_owner,b_owner);\n            \n          }\n        });\n      });\n    });\n  },\n  fiber$checkHit :function _trc_func_26001326_13(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=26001353;\n    _this.hitWatchers.forEach(function (w) {\n      \n      //$LASTPOS=26001397;\n      _this.sprites.forEach(function (a) {\n        var a_owner;\n        \n        //$LASTPOS=26001485;\n        a_owner = a;\n        //$LASTPOS=26001527;\n        if (! (a_owner instanceof w.A)) {\n          return _this;\n        }\n        //$LASTPOS=26001580;\n        _this.sprites.forEach(function (b) {\n          var b_owner;\n          \n          //$LASTPOS=26001628;\n          b_owner = b;\n          //$LASTPOS=26001674;\n          if (a===b) {\n            return _this;\n          }\n          //$LASTPOS=26001710;\n          if (! (b_owner instanceof w.B)) {\n            return _this;\n          }\n          //$LASTPOS=26001815;\n          if (a.crashTo1(b)) {\n            //$LASTPOS=26001918;\n            w.h(a_owner,b_owner);\n            \n          }\n        });\n      });\n    });\n    \n    _thread.retVal=_this;return;\n  },\n  watchHit :function _trc_func_26002002_14(typeA,typeB,onHit) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var p;\n    \n    //$LASTPOS=26002048;\n    p = {A: typeA,B: typeB,h: onHit};\n    //$LASTPOS=26002112;\n    _this.hitWatchers.push(p);\n  },\n  drawGrid :function _trc_func_26002137_15(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var ctx;\n    var i;\n    \n    //$LASTPOS=26002165;\n    ctx = c.getContext("2d");\n    //$LASTPOS=26002198;\n    ctx.textBaseline="top";\n    //$LASTPOS=26002227;\n    ctx.save();\n    //$LASTPOS=26002244;\n    ctx.strokeStyle="rgb(40,100,200)";\n    //$LASTPOS=26002284;\n    //$LASTPOS=26002289;\n    i = 0;\n    while(i<c.width) {\n      {\n        //$LASTPOS=26002329;\n        ctx.beginPath();\n        //$LASTPOS=26002355;\n        ctx.lineWidth=(i%100==0?4:1);\n        //$LASTPOS=26002401;\n        ctx.moveTo(i,0);\n        //$LASTPOS=26002427;\n        ctx.lineTo(i,c.height);\n        //$LASTPOS=26002460;\n        ctx.closePath();\n        //$LASTPOS=26002486;\n        ctx.stroke();\n      }\n      i+=10;\n    }\n    //$LASTPOS=26002518;\n    //$LASTPOS=26002523;\n    i = 0;\n    while(i<c.height) {\n      {\n        //$LASTPOS=26002564;\n        ctx.beginPath();\n        //$LASTPOS=26002590;\n        ctx.lineWidth=(i%100==0?4:1);\n        //$LASTPOS=26002636;\n        ctx.moveTo(0,i);\n        //$LASTPOS=26002662;\n        ctx.lineTo(c.width,i);\n        //$LASTPOS=26002694;\n        ctx.closePath();\n        //$LASTPOS=26002720;\n        ctx.stroke();\n      }\n      i+=10;\n    }\n    //$LASTPOS=26002746;\n    ctx.fillStyle="white";\n    //$LASTPOS=26002774;\n    ctx.font="15px monospaced";\n    //$LASTPOS=26002807;\n    //$LASTPOS=26002812;\n    i = 100;\n    while(i<c.width) {\n      {\n        //$LASTPOS=26002855;\n        ctx.fillText(i,i,0);\n      }\n      i+=100;\n    }\n    //$LASTPOS=26002889;\n    //$LASTPOS=26002894;\n    i = 100;\n    while(i<c.height) {\n      {\n        //$LASTPOS=26002938;\n        ctx.fillText(i,0,i);\n      }\n      i+=100;\n    }\n    //$LASTPOS=26002972;\n    ctx.restore();\n  },\n  fiber$drawGrid :function _trc_func_26002137_16(_thread,c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var ctx;\n    var i;\n    \n    //$LASTPOS=26002165;\n    ctx = c.getContext("2d");\n    //$LASTPOS=26002198;\n    ctx.textBaseline="top";\n    //$LASTPOS=26002227;\n    ctx.save();\n    //$LASTPOS=26002244;\n    ctx.strokeStyle="rgb(40,100,200)";\n    //$LASTPOS=26002284;\n    //$LASTPOS=26002289;\n    i = 0;\n    while(i<c.width) {\n      {\n        //$LASTPOS=26002329;\n        ctx.beginPath();\n        //$LASTPOS=26002355;\n        ctx.lineWidth=(i%100==0?4:1);\n        //$LASTPOS=26002401;\n        ctx.moveTo(i,0);\n        //$LASTPOS=26002427;\n        ctx.lineTo(i,c.height);\n        //$LASTPOS=26002460;\n        ctx.closePath();\n        //$LASTPOS=26002486;\n        ctx.stroke();\n      }\n      i+=10;\n    }\n    //$LASTPOS=26002518;\n    //$LASTPOS=26002523;\n    i = 0;\n    while(i<c.height) {\n      {\n        //$LASTPOS=26002564;\n        ctx.beginPath();\n        //$LASTPOS=26002590;\n        ctx.lineWidth=(i%100==0?4:1);\n        //$LASTPOS=26002636;\n        ctx.moveTo(0,i);\n        //$LASTPOS=26002662;\n        ctx.lineTo(c.width,i);\n        //$LASTPOS=26002694;\n        ctx.closePath();\n        //$LASTPOS=26002720;\n        ctx.stroke();\n      }\n      i+=10;\n    }\n    //$LASTPOS=26002746;\n    ctx.fillStyle="white";\n    //$LASTPOS=26002774;\n    ctx.font="15px monospaced";\n    //$LASTPOS=26002807;\n    //$LASTPOS=26002812;\n    i = 100;\n    while(i<c.width) {\n      {\n        //$LASTPOS=26002855;\n        ctx.fillText(i,i,0);\n      }\n      i+=100;\n    }\n    //$LASTPOS=26002889;\n    //$LASTPOS=26002894;\n    i = 100;\n    while(i<c.height) {\n      {\n        //$LASTPOS=26002938;\n        ctx.fillText(i,0,i);\n      }\n      i+=100;\n    }\n    //$LASTPOS=26002972;\n    ctx.restore();\n    \n    _thread.retVal=_this;return;\n  },\n  setImageList :function _trc_func_26002991_17(il) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=26003024;\n    _this.imageList=il;\n  },\n  fiber$setImageList :function _trc_func_26002991_18(_thread,il) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=26003024;\n    _this.imageList=il;\n    \n    _thread.retVal=_this;return;\n  },\n  getImageList :function _trc_func_26003042_19() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.imageList;\n  },\n  fiber$getImageList :function _trc_func_26003042_20(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.imageList;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  scrollTo :function _trc_func_26003095_21(scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=26003136;\n    _this.sx=scrollX;\n    //$LASTPOS=26003153;\n    _this.sy=scrollY;\n  },\n  fiber$scrollTo :function _trc_func_26003095_22(_thread,scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=26003136;\n    _this.sx=scrollX;\n    //$LASTPOS=26003153;\n    _this.sy=scrollY;\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Sprites,{"fullName":"kernel.Sprites","namespace":"kernel","shortName":"Sprites","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"add":{"nowait":false},"remove":{"nowait":false},"clear":{"nowait":false},"compOrder":{"nowait":false},"draw":{"nowait":true},"checkHit":{"nowait":false},"watchHit":{"nowait":true},"drawGrid":{"nowait":false},"setImageList":{"nowait":false},"getImageList":{"nowait":false},"scrollTo":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T1Line=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_27000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_27000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_27000016_2(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=27000034;\n    if (_this.hidden) {\n      return _this;\n    }\n    //$LASTPOS=27000065;\n    ctx.strokeStyle=_this.col;\n    //$LASTPOS=27000091;\n    ctx.beginPath();\n    //$LASTPOS=27000113;\n    ctx.moveTo(_this.x,_this.y);\n    //$LASTPOS=27000135;\n    ctx.lineTo(_this.tx,_this.ty);\n    //$LASTPOS=27000159;\n    ctx.stroke();\n    //$LASTPOS=27000178;\n    _this.hidden=true;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T1Line,{"fullName":"kernel.T1Line","namespace":"kernel","shortName":"T1Line","decls":{"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T1Map=Tonyu.klass(Tonyu.classes.kernel.Map,[],{\n  main :function _trc_func_28000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_28000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setBGColor :function _trc_func_28000042_2(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=28000064;\n    Tonyu.globals.$Screen.setBGColor(c);\n  },\n  fiber$setBGColor :function _trc_func_28000042_3(_thread,c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=28000064;\n    Tonyu.globals.$Screen.setBGColor(c);\n    \n    _thread.retVal=_this;return;\n  },\n  load :function _trc_func_28000091_4(fileName) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var f;\n    var o;\n    \n    //$LASTPOS=28000469;\n    f = _this.file("../maps/").rel(fileName);\n    //$LASTPOS=28000512;\n    o = f.obj();\n    //$LASTPOS=28000532;\n    _this.chipWidth=o.chipWidth;\n    //$LASTPOS=28000560;\n    _this.chipHeight=o.chipHeight;\n    //$LASTPOS=28000590;\n    _this.baseData=o.baseData;\n    //$LASTPOS=28000616;\n    _this.mapTable=_this.conv(_this.baseData[0],o.pTable);\n    //$LASTPOS=28000658;\n    _this.mapData=_this.mapTable;\n    //$LASTPOS=28000681;\n    _this.row=_this.mapTable.length;\n    //$LASTPOS=28000707;\n    _this.col=_this.mapTable[0].length;\n    //$LASTPOS=28000736;\n    _this.mapOnTable=_this.conv(_this.baseData[1],o.pTable);\n    //$LASTPOS=28000780;\n    _this.mapOnData=_this.mapOnTable;\n    //$LASTPOS=28000813;\n    _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n    //$LASTPOS=28000885;\n    _this.initMap();\n  },\n  fiber$load :function _trc_func_28000091_5(_thread,fileName) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var f;\n    var o;\n    \n    //$LASTPOS=28000469;\n    f = _this.file("../maps/").rel(fileName);\n    //$LASTPOS=28000512;\n    o = f.obj();\n    //$LASTPOS=28000532;\n    _this.chipWidth=o.chipWidth;\n    //$LASTPOS=28000560;\n    _this.chipHeight=o.chipHeight;\n    //$LASTPOS=28000590;\n    _this.baseData=o.baseData;\n    \n    _thread.enter(function _trc_func_28000091_6(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=28000616;\n          _this.fiber$conv(_thread, _this.baseData[0], o.pTable);\n          __pc=1;return;\n        case 1:\n          _this.mapTable=_thread.retVal;\n          \n          //$LASTPOS=28000658;\n          _this.mapData=_this.mapTable;\n          //$LASTPOS=28000681;\n          _this.row=_this.mapTable.length;\n          //$LASTPOS=28000707;\n          _this.col=_this.mapTable[0].length;\n          //$LASTPOS=28000736;\n          _this.fiber$conv(_thread, _this.baseData[1], o.pTable);\n          __pc=2;return;\n        case 2:\n          _this.mapOnTable=_thread.retVal;\n          \n          //$LASTPOS=28000780;\n          _this.mapOnData=_this.mapOnTable;\n          //$LASTPOS=28000813;\n          _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n          //$LASTPOS=28000885;\n          _this.fiber$initMap(_thread);\n          __pc=3;return;\n        case 3:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  conv :function _trc_func_28000903_7(mat,tbl) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    \n    //$LASTPOS=28000926;\n    res = [];\n    //$LASTPOS=28000943;\n    mat.forEach(function (row) {\n      var rrow;\n      \n      //$LASTPOS=28000973;\n      rrow = [];\n      //$LASTPOS=28000995;\n      res.push(rrow);\n      //$LASTPOS=28001020;\n      row.forEach(function (dat) {\n        var t;\n        \n        //$LASTPOS=28001067;\n        t = tbl[dat[0]];\n        //$LASTPOS=28001099;\n        if (t) {\n          //$LASTPOS=28001106;\n          rrow.push(Tonyu.globals[t.name]+dat[1]);\n        } else {\n          //$LASTPOS=28001165;\n          rrow.push(dat[1]);\n        }\n      });\n    });\n    return res;\n  },\n  fiber$conv :function _trc_func_28000903_8(_thread,mat,tbl) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var res;\n    \n    //$LASTPOS=28000926;\n    res = [];\n    //$LASTPOS=28000943;\n    mat.forEach(function (row) {\n      var rrow;\n      \n      //$LASTPOS=28000973;\n      rrow = [];\n      //$LASTPOS=28000995;\n      res.push(rrow);\n      //$LASTPOS=28001020;\n      row.forEach(function (dat) {\n        var t;\n        \n        //$LASTPOS=28001067;\n        t = tbl[dat[0]];\n        //$LASTPOS=28001099;\n        if (t) {\n          //$LASTPOS=28001106;\n          rrow.push(Tonyu.globals[t.name]+dat[1]);\n        } else {\n          //$LASTPOS=28001165;\n          rrow.push(dat[1]);\n        }\n      });\n    });\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T1Map,{"fullName":"kernel.T1Map","namespace":"kernel","shortName":"T1Map","decls":{"methods":{"main":{"nowait":false},"setBGColor":{"nowait":false},"load":{"nowait":false},"conv":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T1Page=Tonyu.klass(Tonyu.classes.kernel.PlainChar,[],{\n  main :function _trc_func_29000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_29000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initGlobals :function _trc_func_29000022_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=29000044;\n    Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;\n    //$LASTPOS=29000074;\n    Tonyu.globals.$Boot.setFrameRate(60);\n    //$LASTPOS=29000103;\n    Tonyu.globals.$clBlack=_this.color(0,0,0);\n    //$LASTPOS=29000131;\n    Tonyu.globals.$clRed=_this.color(255,0,0);\n    //$LASTPOS=29000159;\n    Tonyu.globals.$clGreen=_this.color(0,255,0);\n    //$LASTPOS=29000189;\n    Tonyu.globals.$clYellow=_this.color(255,255,0);\n    //$LASTPOS=29000222;\n    Tonyu.globals.$clBlue=_this.color(0,0,255);\n    //$LASTPOS=29000251;\n    Tonyu.globals.$clPink=_this.color(255,0,255);\n    //$LASTPOS=29000282;\n    Tonyu.globals.$clAqua=_this.color(0,255,255);\n    //$LASTPOS=29000313;\n    Tonyu.globals.$clWhite=_this.color(255,255,255);\n    //$LASTPOS=29000347;\n    Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;\n  },\n  fiber$initGlobals :function _trc_func_29000022_3(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=29000044;\n    Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;\n    //$LASTPOS=29000074;\n    Tonyu.globals.$Boot.setFrameRate(60);\n    \n    _thread.enter(function _trc_func_29000022_4(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=29000103;\n          _this.fiber$color(_thread, 0, 0, 0);\n          __pc=1;return;\n        case 1:\n          Tonyu.globals.$clBlack=_thread.retVal;\n          \n          //$LASTPOS=29000131;\n          _this.fiber$color(_thread, 255, 0, 0);\n          __pc=2;return;\n        case 2:\n          Tonyu.globals.$clRed=_thread.retVal;\n          \n          //$LASTPOS=29000159;\n          _this.fiber$color(_thread, 0, 255, 0);\n          __pc=3;return;\n        case 3:\n          Tonyu.globals.$clGreen=_thread.retVal;\n          \n          //$LASTPOS=29000189;\n          _this.fiber$color(_thread, 255, 255, 0);\n          __pc=4;return;\n        case 4:\n          Tonyu.globals.$clYellow=_thread.retVal;\n          \n          //$LASTPOS=29000222;\n          _this.fiber$color(_thread, 0, 0, 255);\n          __pc=5;return;\n        case 5:\n          Tonyu.globals.$clBlue=_thread.retVal;\n          \n          //$LASTPOS=29000251;\n          _this.fiber$color(_thread, 255, 0, 255);\n          __pc=6;return;\n        case 6:\n          Tonyu.globals.$clPink=_thread.retVal;\n          \n          //$LASTPOS=29000282;\n          _this.fiber$color(_thread, 0, 255, 255);\n          __pc=7;return;\n        case 7:\n          Tonyu.globals.$clAqua=_thread.retVal;\n          \n          //$LASTPOS=29000313;\n          _this.fiber$color(_thread, 255, 255, 255);\n          __pc=8;return;\n        case 8:\n          Tonyu.globals.$clWhite=_thread.retVal;\n          \n          //$LASTPOS=29000347;\n          Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T1Page,{"fullName":"kernel.T1Page","namespace":"kernel","shortName":"T1Page","decls":{"methods":{"main":{"nowait":false},"initGlobals":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T1Text=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_30000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_30000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_30000016_2(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=30000032;\n    if (_this.hidden) {\n      return _this;\n    }\n    //$LASTPOS=30000057;\n    c.font=_this.size+"px \'ＭＳ Ｐゴシック\'";\n    //$LASTPOS=30000097;\n    Tonyu.classes.kernel.Actor.prototype.draw.apply( _this, [c]);\n    //$LASTPOS=30000117;\n    _this.hidden=true;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T1Text,{"fullName":"kernel.T1Text","namespace":"kernel","shortName":"T1Text","decls":{"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T2Body=Tonyu.klass(Tonyu.classes.kernel.BodyActor,[],{\n  main :function _trc_func_31000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_31000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T2Body,{"fullName":"kernel.T2Body","namespace":"kernel","shortName":"T2Body","decls":{"methods":{"main":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T2World=Tonyu.klass(Tonyu.classes.kernel.Actor,[Tonyu.classes.kernel.T2Mod],{\n  main :function _trc_func_32000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=32000150;\n    _this.loop();\n  },\n  fiber$main :function _trc_func_32000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_32000000_2(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=32000150;\n          _this.fiber$loop(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  onAppear :function _trc_func_32000067_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=32000086;\n    Tonyu.globals.$currentProject.requestPlugin("box2d");\n    //$LASTPOS=32000133;\n    _this.initWorld();\n  },\n  fiber$onAppear :function _trc_func_32000067_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=32000086;\n    Tonyu.globals.$currentProject.requestPlugin("box2d");\n    \n    _thread.enter(function _trc_func_32000067_5(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=32000133;\n          _this.fiber$initWorld(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initWorld :function _trc_func_32000163_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b2World;\n    var b2Vec2;\n    \n    //$LASTPOS=32000183;\n    _this.gravity=_this.gravity||9.8;\n    //$LASTPOS=32000212;\n    _this.gravityX=_this.gravityX||0;\n    //$LASTPOS=32000241;\n    b2World = Box2D.Dynamics.b2World;\n    //$LASTPOS=32000284;\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=32000328;\n    _this.scale=_this.scale||32;\n    //$LASTPOS=32000352;\n    _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);\n    //$LASTPOS=32000477;\n    Tonyu.globals.$t2World=_this;\n    //$LASTPOS=32000497;\n    Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));\n    //$LASTPOS=32000533;\n    _this.on("die",Tonyu.bindFunc(_this,_this.releaseWorld));\n  },\n  fiber$initWorld :function _trc_func_32000163_7(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b2World;\n    var b2Vec2;\n    \n    //$LASTPOS=32000183;\n    _this.gravity=_this.gravity||9.8;\n    //$LASTPOS=32000212;\n    _this.gravityX=_this.gravityX||0;\n    //$LASTPOS=32000241;\n    b2World = Box2D.Dynamics.b2World;\n    //$LASTPOS=32000284;\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=32000328;\n    _this.scale=_this.scale||32;\n    //$LASTPOS=32000352;\n    _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);\n    //$LASTPOS=32000477;\n    Tonyu.globals.$t2World=_this;\n    //$LASTPOS=32000497;\n    Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));\n    \n    _thread.enter(function _trc_func_32000163_8(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=32000533;\n          _this.fiber$on(_thread, "die", Tonyu.bindFunc(_this,_this.releaseWorld));\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  releaseWorld :function _trc_func_32000561_9() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=32000584;\n    if (Tonyu.globals.$t2World===_this) {\n      //$LASTPOS=32000605;\n      Tonyu.globals.$t2World=null;\n    }\n  },\n  fiber$releaseWorld :function _trc_func_32000561_10(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=32000584;\n    if (Tonyu.globals.$t2World===_this) {\n      //$LASTPOS=32000605;\n      Tonyu.globals.$t2World=null;\n    }\n    \n    _thread.retVal=_this;return;\n  },\n  loop :function _trc_func_32000626_11() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=32000641;\n    while (true) {\n      //$LASTPOS=32000664;\n      _this.world.Step(1/Tonyu.globals.$Boot.getFrameRate(),10,10);\n      //$LASTPOS=32000831;\n      _this.world.DrawDebugData();\n      //$LASTPOS=32000863;\n      _this.world.ClearForces();\n      //$LASTPOS=32000893;\n      _this.updatePos();\n      //$LASTPOS=32000915;\n      _this.update();\n      \n    }\n  },\n  fiber$loop :function _trc_func_32000626_12(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_32000626_13(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=32000641;\n        case 1:\n          //$LASTPOS=32000664;\n          _this.world.Step(1/Tonyu.globals.$Boot.getFrameRate(),10,10);\n          //$LASTPOS=32000831;\n          _this.world.DrawDebugData();\n          //$LASTPOS=32000863;\n          _this.world.ClearForces();\n          //$LASTPOS=32000893;\n          _this.fiber$updatePos(_thread);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=32000915;\n          _this.fiber$update(_thread);\n          __pc=3;return;\n        case 3:\n          \n          __pc=1;break;\n        case 4:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  updatePos :function _trc_func_32000936_14() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b;\n    var d;\n    \n    //$LASTPOS=32000956;\n    //$LASTPOS=32000961;\n    b = _this.world.GetBodyList();\n    while(b) {\n      {\n        //$LASTPOS=32001015;\n        d = b.GetUserData();\n        //$LASTPOS=32001047;\n        if (d) {\n          //$LASTPOS=32001053;\n          d.updatePos();\n        }\n      }\n      b=b.GetNext();\n    }\n  },\n  fiber$updatePos :function _trc_func_32000936_15(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b;\n    var d;\n    \n    //$LASTPOS=32000956;\n    //$LASTPOS=32000961;\n    b = _this.world.GetBodyList();\n    while(b) {\n      {\n        //$LASTPOS=32001015;\n        d = b.GetUserData();\n        //$LASTPOS=32001047;\n        if (d) {\n          //$LASTPOS=32001053;\n          d.updatePos();\n        }\n      }\n      b=b.GetNext();\n    }\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T2World,{"fullName":"kernel.T2World","namespace":"kernel","shortName":"T2World","decls":{"methods":{"main":{"nowait":false},"onAppear":{"nowait":false},"initWorld":{"nowait":false},"releaseWorld":{"nowait":false},"loop":{"nowait":false},"updatePos":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.TextChar=Tonyu.klass(Tonyu.classes.kernel.PlainChar,[],{\n  main :function _trc_func_33000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_33000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_33000040_2(xx,yy,t,c,s) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=33000065;\n    Tonyu.classes.kernel.PlainChar.apply( _this, [xx,yy]);\n    //$LASTPOS=33000084;\n    _this.text="";\n    //$LASTPOS=33000098;\n    _this.col=Tonyu.globals.$clWhite;\n    //$LASTPOS=33000117;\n    _this.size=20;\n    //$LASTPOS=33000131;\n    if (! _this.x) {\n      //$LASTPOS=33000144;\n      _this.x=0;\n    }\n    //$LASTPOS=33000159;\n    if (! _this.y) {\n      //$LASTPOS=33000172;\n      _this.y=0;\n    }\n    //$LASTPOS=33000187;\n    if (t) {\n      //$LASTPOS=33000194;\n      _this.text=t;\n    }\n    //$LASTPOS=33000207;\n    if (c) {\n      //$LASTPOS=33000214;\n      _this.fillStyle=c;\n    }\n    //$LASTPOS=33000232;\n    if (s) {\n      //$LASTPOS=33000239;\n      _this.size=s;\n    }\n  },\n  draw :function _trc_func_33000251_3(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var rect;\n    \n    //$LASTPOS=33000269;\n    if (! _this.size) {\n      //$LASTPOS=33000280;\n      _this.size=15;\n    }\n    //$LASTPOS=33000294;\n    if (! _this.align) {\n      //$LASTPOS=33000306;\n      _this.align="left";\n    }\n    //$LASTPOS=33000325;\n    if (! _this.fillStyle) {\n      //$LASTPOS=33000341;\n      _this.fillStyle="white";\n    }\n    //$LASTPOS=33000365;\n    ctx.fillStyle=_this.fillStyle;\n    //$LASTPOS=33000395;\n    ctx.globalAlpha=_this.alpha/255;\n    //$LASTPOS=33000432;\n    ctx.font=_this.size+"px \'ＭＳ Ｐゴシック\'";\n    //$LASTPOS=33000468;\n    rect = TextRect.draw(ctx,_this.text,_this.x,_this.y,_this.size,_this.align,"fill");\n    //$LASTPOS=33000536;\n    _this.width=rect.w;\n    //$LASTPOS=33000555;\n    _this.height=rect.h;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.TextChar,{"fullName":"kernel.TextChar","namespace":"kernel","shortName":"TextChar","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.DxChar=Tonyu.klass(Tonyu.classes.kernel.SpriteChar,[],{\n  main :function _trc_func_34000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_34000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_34000023_2(xx,yy,pp,ff,sz,rt,al) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34000057;\n    Tonyu.classes.kernel.SpriteChar.apply( _this, [xx,yy,pp,ff]);\n    //$LASTPOS=34000082;\n    _this.scaleX=1;\n    //$LASTPOS=34000097;\n    if (sz) {\n      //$LASTPOS=34000105;\n      _this.scaleX=sz;\n    }\n    //$LASTPOS=34000121;\n    _this.angle=0;\n    //$LASTPOS=34000135;\n    if (rt) {\n      //$LASTPOS=34000143;\n      _this.angle=rt;\n    }\n    //$LASTPOS=34000158;\n    _this.alpha=255;\n    //$LASTPOS=34000174;\n    if (al) {\n      //$LASTPOS=34000182;\n      _this.alpha=al;\n    }\n  },\n  draw :function _trc_func_34000196_3(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34000212;\n    _this.rotation=_this.angle;\n    //$LASTPOS=34000233;\n    Tonyu.classes.kernel.SpriteChar.prototype.draw.apply( _this, [c]);\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.DxChar,{"fullName":"kernel.DxChar","namespace":"kernel","shortName":"DxChar","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}});\n\n',"options.json":'{\n    "compiler":{\n        "namespace": "kernel",\n        "commentLastPos": true,\n        "outputFile": "js/concat.js"\n    }\n}\n'}};
WebSite.devMode||WebSite.disableROM["ROM_k.js"]||WebSite.isNW?n.base="/ROM"+n.base:FS.mountROM(n)}(),requireSimulator.setName("Tonyu"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return Tonyu=function(){function n(){function n(){return null!=p&&d}function t(){return O}function e(){m=0}function i(n){p={prev:p,func:n}}function r(n,t,e){e||(e=[]),e=[y].concat(e);var s=0;i(function(){switch(s){case 0:n["fiber$"+t].apply(n,e),s=1;break;case 1:_(),s=2}})}function a(){if(p)try{p.func(y)}catch(n){o(n)}}function o(n){if(0==y.tryStack.length)throw n;y.lastEx=n;for(var t=y.tryStack.pop();p;){if(t.frame===p){y.catchPC=t.catchPC;break}p=p.prev}}function u(){var n=y.lastEx;return y.lastEx=null,n}function _(n){p=p.prev,y.retVal=n}function h(n){y.tryStack.push({frame:p,catchPC:n})}function c(){y.tryStack.pop()}function l(t){O=!0,t&&t.addTerminatedListener&&t.addTerminatedListener(function(){if(O=!1,y.group)y.group.notifyResume();else if(n())try{y.steps()}catch(t){s(t)}})}function f(n){y.group=n,n&&n.add(y)}function S(){var n=Tonyu.currentThread;for(Tonyu.currentThread=y,m=$;m-->0;)a();Tonyu.currentThread=n}function T(){d=!1}var y={enter:i,apply:r,exit:_,steps:S,step:a,isAlive:n,isWaiting:t,suspend:e,retVal:0,tryStack:[],kill:T,waitFor:l,setGroup:f,enterTry:h,exitTry:c,startCatch:u},p=null,d=!0,m=0,O=!1;return y}function t(n){var t={},e=[];return t.addTerminatedListener=function(n){e.push(n)},setTimeout(function(){e.forEach(function(n){n()})},n),t}function e(){var n=[],t=[],e=!1;return n.addTerminatedListener=function(n){e?setTimeout(n,0):t.push(n)},n.receiver=function(){e=!0;for(var t=0;t<arguments.length;t++)n[t]=arguments[t];n.notify()},n.notify=function(){t.forEach(function(n){n()})},n}function i(){function t(n){n.group=u,l?l.push(n):_.push(n)}function e(e,i,s){i||(i="main");var r=n();return r.apply(e,i,s),t(r),r}function i(){try{r()}catch(n){s(n)}}function r(){function n(n){n.isWaiting()||(c=!1,n.steps())}for(var t=_.length-1;t>=0;t--){var e=_[t];e.isAlive()&&e.group===u||_.splice(t,1)}for(c=!0,l=[],_.forEach(n);l.length>0;)w=l,l=[],w.forEach(function(t){_.push(t),n(t)});l=null}function a(){h=!1}function o(){}var u,_=[],h=!0,c=!1,l=null;return u={add:t,addObj:e,steps:i,kill:a,notifyResume:o,threads:_}}function s(n){if(!Tonyu.onRuntimeError)throw alert("エラー! at "+$LASTPOS+" メッセージ  : "+n),n;Tonyu.onRuntimeError(n)}function r(n){if(n===Function)return null;if("function"==typeof n)n.constructor=null;else if("object"==typeof n)for(var t in n)n[t]=r(n[t]);return n}function a(){var n,t,e=[];if(1==arguments.length)t=arguments[0];else if(2==arguments.length&&"function"==typeof arguments[0])n=arguments[0],t=arguments[1];else if(2==arguments.length&&arguments[0]instanceof Array)e=arguments[0],t=arguments[1];else{if(3!=arguments.length)throw console.log(arguments),"Invalid argument spec";if(n=arguments[0],!n)throw"No parent class";e=arguments[1],t=arguments[2]}t=r(t);var i=t.initialize?t.initialize:n?function(){n.apply(this,arguments)}:function(){};return delete t.initialize,e.forEach(function(n){if(!n.methods)throw n+" Does not have methods";for(var e in n.methods)e in t||(t[e]=n.methods[e])}),i.methods=t,i.prototype=u(n,t),i.prototype.isTonyuObject=!0,o(i,{superClass:n?n.meta:null,includes:e.map(function(n){return n.meta})}),i}function o(n,t){n.meta=n.meta||{},_(n.meta,t)}function u(n,t){return n?_(new n,t):t}function _(n,t){if(t&&"object"==typeof t)for(var e in t)n[e]=t[e];return n}function h(n,t){O[n]=t}function c(n){return O[n]}function l(n){var t=n.split("."),e=g;if(t.forEach(function(n){e&&(e=e[n])}),!e&&1==t.length){var i;for(var s in g){var r=g[s][n];if(r){if(e)throw new Error("曖昧なクラス名： "+s+"."+n+", "+i);e=r,i=s+"."+n}}}return e}function f(n,t){return function(){return t.apply(n,arguments)}}function S(n,t,e,i){if(!n)throw new Error(i+"(="+n+")のメソッド "+t+"を呼び出せません");var s=n[t];if("function"!=typeof s)throw new Error(("this"==i?"":i+".")+t+"(="+s+")はメソッドではありません");return s.apply(n,e)}function T(n,t,e){if("function"!=typeof n)throw new Error(e+"は関数ではありません");return n.apply({},t)}function y(n,t){if(n!=n||null==n)throw new Error(t+"(="+n+")は初期化されていません");return n}function p(n){for(var t=[],e=1;e<n.length;e++)t[e-1]=n[e];return t}function d(n){throw console.log("Not a tonyu object: ",n),n+" is not a tonyu object"}function m(n,t){return n in t}var $=60;a.addMeta=o,a.getMeta=function(n){return n.meta},a.ensureNamespace=function(n,t){var e,i=t.split("."),s=n;for(e=0;e<i.length;e++){var r=i[e];s[r]||(s[r]={}),s=s[r]}};var O={},g={};return Tonyu={thread:n,threadGroup:i,klass:a,bless:u,extend:_,globals:O,classes:g,setGlobal:h,getGlobal:c,getClass:l,timeout:t,asyncResult:e,bindFunc:f,not_a_tonyu_object:d,hasKey:m,invokeMethod:S,callFunc:T,checkNonNull:y,A:p}}()}),requireSimulator.setName("Tonyu.Iterator"),define(["Tonyu"],function(){function n(n,t){var e={};if(n.tonyuIterator)return n.tonyuIterator(t);if(n instanceof Array)e.i=0,e.next=1==t?function(){return e.i>=n.length?!1:(this[0]=n[e.i],e.i++,!0)}:function(){return e.i>=n.length?!1:(this[0]=e.i,this[1]=n[e.i],e.i++,!0)};else{if(!(n instanceof Object))throw console.log(n),"Cannot iterable";e.i=0;var i=[];if(1==t){for(var s in n)i.push(s);e.next=function(){return e.i>=i.length?!1:(this[0]=i[e.i],e.i++,!0)}}else{for(var s in n)i.push([s,n[s]]);e.next=function(){return e.i>=i.length?!1:(this[0]=i[e.i][0],this[1]=i[e.i][1],e.i++,!0)}}}return e}return Tonyu.iterator=n,n}),requireSimulator.setName("IndentBuffer"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return IndentBuffer=function(){var n=function(){function t(){s++;var n=e[s];if(null==n)throw console.log(e),new Error(s+"th null param: fmt="+i);return n}for(var e=arguments,i=e[0],s=0;;){var r=i.indexOf("%");if(0>r){n.buf+=i;break}n.buf+=i.substring(0,r),r++;var a=i.charAt(r);if("s"==a){var o=t();"string"==typeof o||"number"==typeof o||(null==o?o="null":o.text&&(o=o.text)),n.buf+=o,r++}else if("d"==a){var u=t();if("number"!=typeof u)throw new Error(u+" is not a number: fmt="+i);n.buf+=u,r++}else if("n"==a)n.ln(),r++;else if("{"==a)n.indent(),r++;else if("}"==a)n.dedent(),r++;else if("%"==a)n.buf+="%";else if("f"==a)t()(n),r++;else if("l"==a){var _=t();n.buf+=n.toLiteral(_),r++}else if("v"==a){var h=t();if(!h)throw new Error("Null %v");if("object"!=typeof h)throw new Error("nonobject %v:"+h);n.visitor.visit(h),r++}else if("z"==a){var c=t();if("val"in c)return void(n.buf+=c.val);c.gen||n.lazy(c),n.buf+=c.gen,r++}else if("j"==a){var l=t(),f=l[0],S=l[1],T=!1;if(!S||!S.forEach)throw console.log(S),new Error(S+" is not array. cannot join fmt:"+i);S.forEach(function(t){T&&n.printf(f),T=!0,n.visitor.visit(t)}),r++}else"D"==a?(t(),r++):r+=2;i=i.substring(r)}};return n.print=function(t){n.buf+=t},n.printf=n,n.buf="",n.lazy=function(t){return t||(t={}),t.gen=("GENERETID"+Math.random()+"DITERENEG").replace(/\W/g,""),t.reg=new RegExp(t.gen,"g"),t.put=function(t){return this.val=t,n.buf=n.buf.replace(this.reg,t),t},t},n.ln=function(){n.buf+="\n"+n.indentBuf},n.indent=function(){n.indentBuf+=n.indentStr,n.buf+="\n"+n.indentBuf},n.dedent=function(){var t=n.indentStr.length;if(!n.buf.substring(n.buf.length-t).match(/^\s*$/))throw console.log(n.buf),new Error("Non-space truncated ");n.buf=n.buf.substring(0,n.buf.length-t),n.indentBuf=n.indentBuf.substring(0,n.indentBuf.length-t)},n.toLiteral=function(n,t){return t||(t="'"),n=n.replace(/\\/g,"\\\\"),n=n.replace(/\r/g,"\\r"),n=n.replace(/\n/g,"\\n"),n="'"==t?n.replace(/'/g,"\\'"):n.replace(/"/g,'\\"'),t+n+t},n.indentBuf="",n.indentStr="  ",n}}),requireSimulator.setName("disp"),"function"!=typeof define&&(define=require("requirejs").define),define(["IndentBuffer"],function(n){return disp=function(t){function e(n){if(null==n)return i("null%n");if("string"==typeof n)return i("'%s'%n",n);if("number"==typeof n)return i("%s%n",n);if("function"==typeof n)return i("func%n");i(n instanceof Array?"[%{":"{%{");var t="";for(var s in n)i(t+s+":"),e(n[s]);i(n instanceof Array?"%}]%n":"%}}%n")}var i=n();return e(t),i.buf}}),requireSimulator.setName("Parser"),"function"!=typeof define&&(define=require("requirejs").define),define(["disp"],function(){return Parser=function(){function n(n,t){var e;for(e in t)n[e]=t[e];return n}function t(n){this.parse=s.options.traceTap?function(t){console.log("tap: name="+this.name+"  pos="+(t?t.pos:"?"));var e=n.apply(this,[t]),i="NOIMG";return e.src&&e.src.str&&(i=e.src.str.substring(e.pos-3,e.pos)+"^"+e.src.str.substring(e.pos,e.pos+3)),e.src&&e.src.tokens&&(i=e.src.tokens[e.pos-1]+"["+e.src.tokens[e.pos]+"]"+e.src.tokens[e.pos+1]),console.log("/tap: name="+this.name+" pos="+(t?t.pos:"?")+"->"+(e?e.pos:"?")+" "+i+" res="+(e?e.success:"?")),e}:n}function e(n,t){if(null==n)throw t+" is null!";return n}function i(n,t){null!=n&&(this.src={maxPos:0,global:t},"string"==typeof n&&(this.src.str=n),n instanceof Array&&(this.src.tokens=n),this.pos=0,this.result=[],this.success=!0)}var s={consoleBuffer:"",options:{traceTap:!1,optimizeFirst:!0,profile:!1,verboseFirst:!1,traceFirstTbl:!1},Parser:t,StringParser:r,nc:e};s.dispTbl=function(n){var t="",e={};if(!n)return t;for(var i in n){var s=n[i].name;e[s]||(e[s]=""),e[s]+=i}for(var s in e)t+=e[s]+"->"+s+",";return t},t.create=function(n){return new t(n)},s.create=t.create,n(t.prototype,{except:function(n){var e=this;return this.ret(t.create(function(t){return n.apply({},t.result)&&(t.success=!1),t}).setName("(except "+e.name+")"))},noFollow:function(n){var i=this;return e(n,"p"),this.ret(t.create(function(t){var e=n.parse(t);return t.success=!e.success,t}).setName("("+i.name+" noFollow "+n.name+")"))},andNoUnify:function(n){e(n,"next");var i=this,s=t.create(function(t){var e=i.parse(t);if(!e.success)return e;var s=n.parse(e);return s.success&&(s.result=e.result.concat(s.result)),s});return s.setName("("+this.name+" "+n.name+")")},and:function(n){var e=this.andNoUnify(n);if(!this._first)return e;var i=this._first.tbl,r={};for(var a in i)r[a]=i[a].andNoUnify(n);return e=t.fromFirst(this._first.space,r),e.setName("("+this.name+" >> "+n.name+")"),s.options.verboseFirst&&console.log("Created aunify name="+e.name+" tbl="+s.dispTbl(r)),e},retNoUnify:function(n){var e,i=this;e="function"==typeof n?t.create(function(t){var e=t.clone();return e.result=[n.apply({},t.result)],e}).setName("retfunc"):n;var s=t.create(function(n){var t=i.parse(n);return t.success?e.parse(t):t}).setName("("+this.name+" >= "+e.name+")");return s},ret:function(n){if(!this._first)return this.retNoUnify(n);var e=this._first.tbl,i={};for(var r in e)i[r]=e[r].retNoUnify(n);return res=t.fromFirst(this._first.space,i),res.setName("("+this.name+" >>= "+n.name+")"),s.options.verboseFirst&&console.log("Created runify name="+res.name+" tbl="+s.dispTbl(i)),res},first:function(n,e){if(!s.options.optimizeFirst)return this;if(null==n)throw"Space is null2!";if("string"==typeof e){for(var i={},r=0;r<e.length;r++)i[e.substring(r,r+1)]=this;return t.fromFirst(n,i).setName("(fst "+this.name+")")}if(null==e)return t.fromFirst(n,{ALL:this}).setName("(fst "+this.name+")");if("object"==typeof e)throw"this._first={space: space, tbl:ct}";return this},firstTokens:function(n){if(!s.options.optimizeFirst)return this;"string"==typeof n&&(n=[n]);var e={};if(n){var i=this;n.forEach(function(n){e[n]=i})}else e.ALL=this;return t.fromFirstTokens(e).setName("(fstT "+this.name+")")},unifyFirst:function(e){function i(n,t){return n?t?n.orNoUnify(t).checkTbl():n:t}function r(){var n=e._first.tbl,t={};for(var s in a)t[s]=1;for(var s in n)t[s]=1;delete t.ALL,(a.ALL||n.ALL)&&(a.ALL=i(a.ALL,n.ALL));for(var s in t)a[s]&&n[s]?a[s]=i(a[s],n[s]):a[s]&&!n[s]?a[s]=i(a[s],n.ALL):!a[s]&&n[s]&&(a[s]=i(a.ALL,n[s]))}var a={};this.checkTbl(),e.checkTbl(),n(a,this._first.tbl),r();var o=t.fromFirst(this._first.space,a).setName("("+this.name+")U("+e.name+")");return s.options.verboseFirst&&console.log("Created unify name="+o.name+" tbl="+s.dispTbl(a)),o},or:function(n){return e(n,"other"),this._first&&n._first&&this._first.space&&this._first.space===n._first.space?this.unifyFirst(n):(s.options.verboseFirst&&console.log("Cannot unify"+this.name+" || "+n.name+" "+this._first+" - "+n._first),this.orNoUnify(n))},orNoUnify:function(n){var e=this,i=t.create(function(t){var i=e.parse(t);if(i.success)return i;var s=n.parse(t);return s});return i.name="("+this.name+")|("+n.name+")",i},setName:function(n){return this.name=n,this._first,this},profile:function(n){return s.options.profile&&(this.parse=this.parse.profile(n||this.name)),this},repN:function(n){var e=this;n||(n=0);var i=t.create(function(t){for(var i=t,s=[];;){var r=e.parse(i);if(!r.success){var a;return s.length>=n?(a=i.clone(),a.result=[s],a.success=!0,a):(a=t.clone(),a.success=!1,a)}s.push(r.result[0]),i=r}});return i.setName("("+e.name+" * "+n+")")},rep0:function(){return this.repN(0)},rep1:function(){return this.repN(1)},opt:function(){var n=this;return t.create(function(t){var e=n.parse(t);return e.success?e:(t=t.clone(),t.success=!0,t.result=[null],t)}).setName("("+n.name+")?")},sep1:function(n,t){var i=this;e(i,"value"),e(n,"sep");var s=n.and(i).ret(function(n,e){return t?e:{sep:n,value:e}});return i.and(s.rep0()).ret(function(n,e){var i;if(t){var s=[n];for(i in e)s.push(e[i]);return s}return{head:n,tails:e}}).setName("(sep1 "+i.name+"~~"+n.name+")")},sep0:function(n){return this.sep1(n,!0).opt().ret(function(n){return n?n:[]})},tap:function(n){return this},retN:function(n){return this.ret(function(){return arguments[n]})},parseStr:function(n,t){var e=new i(n,t);return this.parse(e)},checkTbl:function(){if(!this._first)return this;var n=this._first.tbl;for(var t in n)if(!n[t].parse)throw this.name+": tbl."+t+" is not a parser :"+n[t];return this}}),n(i.prototype,{clone:function(){var n=new i;return n.src=this.src,n.pos=this.pos,n.result=this.result.slice(),n.success=this.success,n},updateMaxPos:function(n){n>this.src.maxPos&&(this.src.maxPos=n)},isSuccess:function(){return this.success},getGlobal:function(){return this.src.global||(this.src.global={}),this.src.global}}),t.fromFirst=function(n,e){if("TOKEN"==n)return t.fromFirstTokens(e);var i=t.create(function(t){var i=n.parse(t),r=i.src.str.substring(i.pos,i.pos+1);return s.options.traceFirstTbl&&console.log(this.name+": first="+r+" tbl="+(e[r]?e[r].name:"-")),e[r]?e[r].parse(i):e.ALL?e.ALL.parse(i):(i.success=!1,i)});return i._first={space:n,tbl:e},i.checkTbl(),i},t.fromFirstTokens=function(n){var e=t.create(function(t){var e=t.src.tokens[t.pos],i=e?e.type:null;return s.options.traceFirstTbl&&console.log(this.name+": firstT="+i+" tbl="+(n[i]?n[i].name:"-")),null!=i&&n[i]?n[i].parse(t):n.ALL?n.ALL.parse(t):(t.success=!1,t)});return e._first={space:"TOKEN",tbl:n},e.checkTbl(),e};var r={empty:t.create(function(n){var t=n.clone();return t.success=!0,t.result=[null],t}).setName("E"),fail:t.create(function(n){return n.success=!1,n}).setName("F"),str:function(n){return this.strLike(function(t,e){return t.substring(e,e+n.length)===n?{len:n.length}:null}).setName(n)},reg:function(n){return(n+"").match(/^\/\^/)||console.log("Waring regex should have ^ at the head:"+(n+"")),this.strLike(function(t,e){var i=n.exec(t.substring(e));return i?(i.len=i[0].length,i):null}).setName(n+"")},strLike:function(e){return t.create(function(t){var i=t.src.str;if(null==i)throw"strLike: str is null!";var r=t.pos,a=e(i,r,t);if(s.options.traceToken&&console.log("pos="+r+" r="+a),a){s.options.traceToken&&console.log("str:succ"),a.pos=r,a.src=t.src;var o=t.clone();return n(o,{pos:r+a.len,success:!0,result:[a]}),t.updateMaxPos(o.pos),o}return s.options.traceToken&&console.log("str:fail"),t.success=!1,t}).setName("STRLIKE")},parse:function(n,t,e){var s=new i(t,e);return n.parse(s)}};r.eof=r.strLike(function(n,t){return t==n.length?{len:0}:null}).setName("EOF"),s.StringParser=r;var a={token:function(n){return t.create(function(t){var e=t.src.tokens[t.pos];return t.success=!1,e?(e.type==n&&(t=t.clone(),t.updateMaxPos(t.pos),t.pos++,t.success=!0,t.result=[e]),t):t}).setName(n).firstTokens(n)},parse:function(n,t,e){var s=new i(t,e);return n.parse(s)},eof:t.create(function(n){var t=n.pos>=n.src.tokens.length;return n.success=t,t&&(n=n.clone(),n.result=[{type:"EOF"}]),n}).setName("EOT")};return s.TokensParser=a,s.lazy=function(n){var e=null;return t.create(function(t){if(e||(e=n()),!e)throw n+" returned null!";return this.name=n.name,e.parse(t)}).setName("LZ")},s.addRange=function(n,t){if(null==t)return n;if("number"!=typeof n.pos)return n.pos=t.pos,n.len=t.len,n;var e=t.pos+t.len,i=n.pos+n.len;return t.pos<n.pos&&(n.pos=t.pos),e>i&&(n.len=e-n.pos),n},s.setRange=function(n){if(null!=n&&"string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n){var t=s.getRange(n);if(null!=t)return n;for(var e in n)if(n.hasOwnProperty(e)){var i=s.setRange(n[e]);s.addRange(n,i)}return n}},s.getRange=function(n){return null==n?null:"number"!=typeof n.pos?null:"number"==typeof n.len?n:null},s}()}),requireSimulator.setName("Grammar"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(n){return Grammar=function(){function t(n){return"string"==typeof n?i.get(n):n}var e=n,i=null;return i=function(e){var s={};return s.ands=function(){for(var s=t(arguments[0]),r=1;r<arguments.length;r++)s=s.and(t(arguments[r]));s=s.tap(e),i.defs[e]=s;var a={};return a.autoNode=function(){var t=s.ret(function(){for(var t={type:e},i=0;i<arguments.length;i++){var s=arguments[i],r=n.setRange(s);n.addRange(t,r),t["-element"+i]=s}t.toString=function(){return"("+this.type+")"}}).setName(e);return i.defs[e]=t},a.ret=function(t){if(0==arguments.length)return s;if("function"==typeof t)return i.defs[e]=s.ret(t);for(var r=[],a=function(n){return n},o=0;o<arguments.length;o++){if("function"==typeof arguments[o]){a=arguments[o];break}r[o]=arguments[o]}var u=s.ret(function(){var t={type:e};t[Grammar.SUBELEMENTS]=[];for(var i=0;i<arguments.length;i++){var s=arguments[i],o=n.setRange(s);n.addRange(t,o),r[i]&&(t[r[i]]=s),t[Grammar.SUBELEMENTS].push(s)}return t.toString=function(){return"("+this.type+")"},a(t)}).setName(e);return i.defs[e]=u},a},s.ors=function(){for(var n=t(arguments[0]),s=1;s<arguments.length;s++)n=n.or(t(arguments[s]));return i.defs[e]=n.setName(e)},s},i.defs={},i.get=function(n){return i.defs[n]?i.defs[n]:e.lazy(function(){var t=i.defs[n];if(!t)throw"grammar named '"+n+"' is undefined";return t}).setName("(Lazy of "+n+")")},i},Grammar.SUBELEMENTS="[SUBELEMENTS]",Grammar}),requireSimulator.setName("XMLBuffer"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(n){return XMLBuffer=function(t){var e;return e=function(i,s){if(null!=i&&"string"!=typeof i&&"number"!=typeof i){var r=n.getRange(i);if(r)for(;e.srcLen<r.pos;)e.src(t.substring(e.srcLen,r.pos));if(null!=i){if(s&&e.tag("<attr_"+s+">"),i.type&&e.tag("<"+i.type+">"),i.text)e.src(r.text);else{var a=e.orderByPos(i);a.forEach(function(n){n.name&&n.name.match(/^-/)?e(n.value):e(n.value,n.name)})}if(r)for(;e.srcLen<r.pos+r.len;)e.src(t.substring(e.srcLen,r.pos+r.len));i.type&&e.tag("</"+i.type+">"),s&&e.tag("</attr_"+s+">")}}},e.orderByPos=XMLBuffer.orderByPos,e.src=function(n){e.buf+=n.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"),e.srcLen+=n.length},e.tag=function(n){e.buf+=n},e.buf="",e.srcLen=0,e},XMLBuffer.orderByPos=function(n){var t=[];if(n[XMLBuffer.SUBELEMENTS])n[XMLBuffer.SUBELEMENTS].forEach(function(n){t.push(n)});else for(var e in n)n.hasOwnProperty(e)&&null!=n[e]&&"string"!=typeof n[e]&&"number"!=typeof n[e]&&"number"==typeof n[e].pos&&t.push(isNaN(parseInt(e))&&!(e+"").match(/-/)?{name:e,value:n[e]}:{value:n[e]});return t=t.sort(function(n,t){return n.value.pos-t.value.pos})},XMLBuffer.SUBELEMENTS="[SUBELEMENTS]",XMLBuffer}),requireSimulator.setName("TError"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return TError=function(n,t,e){if("string"==typeof t)return{isTError:!0,mesg:n,src:{name:function(){return t},text:function(){return t}},pos:e,toString:function(){return this.mesg+" at "+t+":"+this.pos},raise:function(){throw this}};var i=null;if(t&&t.src&&(i=t,t=i.src.tonyu),"function"!=typeof t.name)throw"src="+t+" should be file object";var s;if("function"==typeof t.text){var r=t.text();"string"==typeof r&&(s=TError.calcRowCol(r,e))}return{isTError:!0,mesg:n,src:t,pos:e,row:s.row,col:s.col,klass:i,toString:function(){return this.mesg+" at "+this.src.name()+":"+this.row+":"+this.col},raise:function(){throw this}}},TError.calcRowCol=function(n,t){var e,i,s=n.split("\n"),r=0;for(e=0;e<s.length;e++)if(r+=s[e].length+1,r>t){i=t-(r-s[e].length);break}return{row:e,col:i}},TError}),requireSimulator.setName("TT"),"function"!=typeof define&&(define=require("requirejs").define),define(["Grammar","XMLBuffer","IndentBuffer","disp","Parser","TError"],function(n,t,e,i,s){return TT=function(){function n(n,t){var e,s;"string"==typeof n?(e=o.str(n),n.length>0&&(s=n.substring(0,1)),t||(t=n)):(e=o.reg(n),t||(t=n+""));var r=c.and(e).ret(function(n,e){var s={};if(s.pos=e.pos,"number"!=typeof s.pos)throw"no pos for "+t+" "+i(e);if(s.len=e.len,s.text=e.src.str.substring(s.pos,s.pos+s.len),"string"!=typeof s.text)throw"no text("+s.text+") for "+t+" "+i(e);return s.toString=function(){return this.text},s});return s&&(r=r.first(c,s)),r.setName(t)}function t(t,e,i){"string"==typeof i&&(i=n(i)),l[t]=r(l[t],i.ret(function(n){return n.type=e,n}).setName(e))}function e(n,e,i,s){e==u&&(e=i);for(var r=1;n>=r;r*=2)0!=(n&r)&&t(n&r,e,i,s);f[e]=s}function r(n,t){return n?n.or(t):t}function a(n){var t=((new Date).getTime(),s.StringParser.parse(S,n));return t.success||console.log("Stopped at "+n.substring(t.src.maxPos-5,t.src.maxPos+5)),"object"==typeof WebSite&&WebSite.devMode&&(window.tokenStat=window.tokenStat||{},t.result[0].forEach(function(n){window.tokenStat[n.text]=window.tokenStat[n.text]||0,window.tokenStat[n.text]++})),t}var o=s.StringParser,u="SAMENAME",_=1,h=2,c=o.reg(/^(\s*(\/\*([^\/]|[^*]\/|\r|\n)*\*\/)*(\/\/.*\r?\n)*)*/).setName("space"),l={},f={},S=s.create(function(n){for(var t=h,e=[];;){if(n=l[t].parse(n),!n.success)break;var i=n.result[0];t=f[i.type],e.push(i)}return n=c.parse(n),n.success=n.src.maxPos==n.src.str.length,n.result[0]=e,n}),T={"function":!0,"var":!0,"return":!0,"typeof":!0,"if":!0,"for":!0,"else":!0,"super":!0,"while":!0,"break":!0,"do":!0,"switch":!0,"try":!0,"catch":!0,"finally":!0,"throw":!0,"in":!0,fiber:!0,"native":!0,"instanceof":!0,"new":!0,is:!0,"true":!0,"false":!0,"null":!0,"this":!0,undefined:!0,usethread:!0,constructor:!0,ifwait:!0,nowait:!0,_thread:!0,arguments:!0,"delete":!0,"extends":!0,includes:!0},y=n(/^[0-9\.]+/).ret(function(n){return n.type="number",n.value=parseInt(n.text),n}).first(c,"0123456789"),p=n({exec:function(n){var t=n.substring(0,1);if('"'!==t&&"'"!==t)return!1;for(var e=1;e<n.length;e++){var i=n.substring(e,e+1);if(i===t)return[n.substring(0,e+1)];"\\"===i&&e++}return!1},toString:function(){return"literal"}}).first(c,"\"'"),d=n({exec:function(n){if("/"!==n.substring(0,1))return!1;for(var t=1;t<n.length;t++){var e=n.substring(t,t+1);if("/"===e){var i=/^[ig]*/.exec(n.substring(t+1));return[n.substring(0,t+1+i[0].length)]}if("\n"==e)return!1;"\\"===e&&t++}return!1},toString:function(){return"regex"}}).first(c,"/");e(h|_,"number",y,_),e(h,"regex",d,_),e(h|_,"literal",p,_),e(h|_,u,"++",_),e(h|_,u,"--",_),e(h|_,u,"!==",h),e(h|_,u,"===",h),e(h|_,u,"+=",h),e(h|_,u,"-=",h),e(h|_,u,"*=",h),e(h|_,u,"/=",h),e(h|_,u,"%=",h),e(h|_,u,">=",h),e(h|_,u,"<=",h),e(h|_,u,"!=",h),e(h|_,u,"==",h),e(h|_,u,">>",h),e(h|_,u,"<<",h),e(h|_,u,"&&",h),e(h|_,u,"||",h),e(h|_,u,"(",h),e(h|_,u,")",_),e(h|_,u,"[",h),e(h|_,u,"]",_),e(h|_,u,"{",h),e(h|_,u,"}",_),e(h|_,u,">",h),e(h|_,u,"<",h),e(h|_,u,"+",h),e(h|_,u,"-",h),e(h|_,u,".",h),e(h|_,u,"?",h),e(h|_,u,"=",h),e(h|_,u,"*",h),e(h|_,u,"%",h),e(_,u,"/",h),e(_|h,u,"^",h),e(_|h,u,"~",h),e(_|h,u,"\\",h),e(_|h,u,":",h),e(_|h,u,";",h),e(_|h,u,",",h),e(h|_,u,"!",h),e(h|_,u,"&",h),e(h|_,u,"|",h);var m=n(/^[a-zA-Z_$][a-zA-Z0-9_$]*/,"symresv_reg").ret(function(n){return n.type="constructor"==n.text?"tk_constructor":T.hasOwnProperty(n.text)?n.text:"symbol",n}).first(c);for(var $ in T)f[$]=h;return f.tk_constructor=h,f.symbol=_,l[h]=r(l[h],m),l[_]=r(l[_],m),{parse:a,extension:"js"}}()}),requireSimulator.setName("ExpressionParser"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(n){return ExpressionParser=function(){function t(n,t){var e={};return e.eq=function(e){return n==e.type()&&t==e.prio()},e.type=function(t){return t?t==n:n},e.prio=function(){return t},e.toString=function(){return"["+n+":"+t+"]"},e}function e(n){var t={},e=n;return t.add=function(n){e=e?e.or(n):n},t.get=function(){return e},t}function i(){var i=e(),s={};return s.reg=function(e,s,r){var a=t(e,s);i.add(r.ret(n.create(function(n){return n.opType=a,n})).setName("(opType "+a+" "+r.name+")"))},s.get=function(){return i.get()},s.parse=function(n){return s.get().parse(n)},s}function s(n,t){return}function r(n,t){var e,i=t;if(s(t," start minprio= "+n),t=o.parse(t),s(t," prefixorelem "+n),!t.isSuccess())return t;if(e=t.opType,e.type("prefix")){if(pre=t.result[0],t=r(e.prio(),t),!t.isSuccess())return t;var _=a.mkPrefix.def(pre,t.result[0]);if(i=t.clone(),i.result=[_],!t.nextPostfixOrInfix)return i;t=t.nextPostfixOrInfix}else if(i=t.clone(),t=u.parse(t),!t.isSuccess())return i;for(;;){if(s(t,"st:pi"),s(i,"res:ex"),e=t.opType,e.prio()<n)return i.nextPostfixOrInfix=t,i;if(e.type("postfix")){var _=a.mkPostfix.def(i.result[0],t.result[0]);if(i=t.clone(),i.result=[_],s(t,"185"),t=u.parse(t),!t.isSuccess())return i}else if(e.type("infixl")){var c=t.result[0];if(t=r(e.prio()+1,t),!t.isSuccess())return i;var _=a.mkInfixl.def(i.result[0],c,t.result[0]);if(i=t.clone(),i.result=[_],!t.nextPostfixOrInfix)return i;t=t.nextPostfixOrInfix}else if(e.type("infixr")){var c=t.result[0];if(t=r(e.prio(),t),!t.isSuccess())return i;var _=a.mkInfixr.def(i.result[0],c,t.result[0]);if(i=t.clone(),i.result=[_],!t.nextPostfixOrInfix)return i;t=t.nextPostfixOrInfix}else if(e.type("trifixr")){var l=i.result[0],f=t.result[0];if(t=r(e.prio()+1,t),!t.isSuccess())return i;var S=t.result[0],t=h[e.prio()].parse(t);if(!t.isSuccess())return i;var T=t.result[0];if(t=r(e.prio(),t),!t.isSuccess())return i;var y=t.result[0],_=a.mkTrifixr.def(l,f,S,T,y);if(i=t.clone(),i.result=[_],!t.nextPostfixOrInfix)return i;t=t.nextPostfixOrInfix}else{var c=t.result[0];if(t=r(e.prio()+1,t),!t.isSuccess())return i;var _=a.mkInfix.def(i.result[0],c,t.result[0]);if(i=t.clone(),i.result=[_],!t.nextPostfixOrInfix)return i;if(t=t.nextPostfixOrInfix,e.prio()==t.opType.prio())return i.success=!1,i}}}var a={},o=i(),u=i(),_=e(),h=[];return a.element=function(n){o.reg("element",-1,n),_.add(n)},a.getElement=function(){return _.get()},a.prefix=function(n,t){o.reg("prefix",n,t)},a.postfix=function(n,t){u.reg("postfix",n,t)},a.infixl=function(n,t){u.reg("infixl",n,t)},a.infixr=function(n,t){u.reg("infixr",n,t)},a.infix=function(n,t){u.reg("infix",n,t)},a.trifixr=function(n,t,e){u.reg("trifixr",n,t),h[n]=e},a.custom=function(){},a.mkInfix=function(n){a.mkInfix.def=n},a.mkInfix.def=function(t,e,i){return n.setRange({type:"infix",op:e,left:t,right:i})},a.mkInfixl=function(n){a.mkInfixl.def=n},a.mkInfixl.def=function(t,e,i){return n.setRange({type:"infixl",op:e,left:t,right:i})},a.mkInfixr=function(n){a.mkInfixr.def=n},a.mkInfixr.def=function(t,e,i){return n.setRange({type:"infixr",op:e,left:t,right:i})},a.mkPrefix=function(n){a.mkPrefix.def=n},a.mkPrefix.def=function(t,e){return n.setRange({type:"prefix",op:t,right:e})},a.mkPostfix=function(n){a.mkPostfix.def=n},a.mkPostfix.def=function(t,e){return n.setRange({type:"postfix",left:t,op:e})},a.mkTrifixr=function(n){a.mkTrifixr.def=n},a.mkTrifixr.def=function(t,e,i,s,r){return n.setRange({type:"trifixr",left:t,op1:e,mid:i,op2:s,right:r})},a.build=function(){return a.built=n.create(function(n){return r(0,n)}).setName("ExpBuilt"),a.built},a.lazy=function(){return n.create(function(n){return a.built.parse(n)})},a}}),requireSimulator.setName("TonyuLang"),"function"!=typeof define&&(define=require("requirejs").define),define(["Grammar","XMLBuffer","IndentBuffer","TT","disp","Parser","ExpressionParser","TError"],function(n,t,e,i,s,r,a,o){return TonyuLang=function(){function e(n){return function(){return arguments[n]}}function u(n,t){var e=[];if(n&&!n.args)throw s(n);if(n){var i=r.getRange(n);r.addRange(e,i),n.args.forEach(function(n){e.push(n)})}return t.forEach(function(n){var t=r.getRange(n);r.addRange(e,t),e.push(n.obj)}),e}function _(n,t,e){var i={type:"infix",left:n,op:t,right:e};return r.setRange(i),i.toString=function(){return"("+n+t+e+")"},i}var h=r,c={},l=n(),f=l.get,S=(h.StringParser,h.TokensParser.token),T=S("number").ret(function(n){if(n.type="number","string"!=typeof n.text)throw"No text for "+s(n);if(n.value=parseFloat(n.text),isNaN(n.value))throw"No value for "+s(n);return n}),y=S("symbol"),p=S("==="),d=S("!=="),m=S("=="),$=S("!="),O=S(">="),g=S("<="),v=S(">"),P=S("<"),A=S("&&"),b=S("||"),L=S("-"),x=S("+"),w=S("*"),j=S("/"),k=S("%"),D=S("="),C=S("literal"),M=S("regex"),E=a(),N=l("arrayElem").ands(S("["),E.lazy(),S("]")).ret(null,"subscript"),I=l("argList").ands(S("("),E.lazy().sep0(S(","),!0),S(")")).ret(null,"args"),R=l("member").ands(S("."),y).ret(null,"name"),W=l("parenExpr").ands(S("("),E.lazy(),S(")")).ret(null,"expr"),V=l("varAccess").ands(y).ret("name"),F=f("funcExpr").firstTokens(["function","\\"]),B=l("funcExprArg").ands(F).ret("obj"),X=f("objlit").firstTokens("{"),K=l("objlitArg").ands(X).ret("obj"),z=K.or(B),H=I.and(z.rep0()).ret(function(n,t){return u(n,t)}).or(z.rep1().ret(function(n){return u(null,n)})),U=(I.or(K),l("call").ands(H).ret("args")),Y=l("scall").ands(H).ret("args"),G=l("newExpr").ands(S("new"),V,U.opt()).ret(null,"klass","params"),q=l("superExpr").ands(S("super"),S(".").and(y).ret(e(1)).opt(),Y).ret(null,"name","params"),Z=S("true").or(S("false")).or(S("null")).or(S("undefined")).or(S("_thread")).or(S("this")).or(S("arguments")).ret(function(n){return n.type="reservedConst",n});E.element(T),E.element(Z),E.element(M),E.element(C),E.element(W),E.element(G),E.element(q),E.element(F),E.element(X),E.element(f("arylit").firstTokens("[")),E.element(V);var J=0;E.infixr(J,D),E.infixr(J,S("+=")),E.infixr(J,S("-=")),E.infixr(J,S("*=")),E.infixr(J,S("/=")),E.infixr(J,S("%=")),E.infixr(J,S("|=")),E.infixr(J,S("&=")),J++,E.trifixr(J,S("?"),S(":")),J++,E.infixl(J,b),J++,E.infixl(J,A),J++,E.infix(J,S("instanceof")),E.infix(J,S("is")),E.infix(J,p),E.infix(J,d),E.infix(J,m),E.infix(J,$),E.infix(J,O),E.infix(J,g),E.infix(J,v),E.infix(J,P),J++,E.postfix(J+3,S("++")),E.postfix(J+3,S("--")),E.infixl(J,L),E.infixl(J,x),J++,E.infixl(J,w),E.infixl(J,j),E.infixl(J,k),J++,E.prefix(J,S("typeof")),E.prefix(J,S("delete")),E.prefix(J,S("++")),E.prefix(J,S("--")),E.prefix(J,S("+")),E.prefix(J,S("-")),E.prefix(J,S("!")),J++,J++,E.postfix(J,U),E.postfix(J,R),E.postfix(J,N),E.mkInfixl(_),E.mkInfixr(_);{var Q=E.build().setName("expr").profile(),e=function(n){return function(){return arguments[n]}},nt=f("stmt").firstTokens();l("exprstmt").ands(Q,S(";")).ret("expr")}l("compound").ands(S("{"),nt.rep0(),S("}")).ret(null,"stmts");{var tt=S("else").and(nt).ret(e(1)),et=(l("return").ands(S("return"),Q.opt(),S(";")).ret(null,"value"),l("if").ands(S("if"),S("("),Q,S(")"),nt,tt.opt()).ret(null,null,"cond",null,"then","_else"),l("forin").ands(S("var").opt(),y.sep1(S(","),!0),S("in"),Q).ret("isVar","vars",null,"set")),it=l("normalFor").ands(nt,Q.opt(),S(";"),Q.opt()).ret("init","cond",null,"next"),st=it.or(et),rt=(l("for").ands(S("for"),S("("),st,S(")"),"stmt").ret(null,null,"inFor",null,"loop"),l("while").ands(S("while"),S("("),Q,S(")"),"stmt").ret(null,null,"cond",null,"loop"),l("break").ands(S("break"),S(";")).ret("brk"),l("finally").ands(S("finally"),"stmt").ret(null,"stmt"),l("catch").ands(S("catch"),S("("),y,S(")"),"stmt").ret(null,null,"name",null,"stmt"),l("catches").ors("catch","finally")),at=(l("try").ands(S("try"),"stmt",rt.rep1()).ret(null,"stmt","catches"),l("throw").ands(S("throw"),Q,S(";")).ret(null,"ex"),l("varDecl").ands(y,S("=").and(Q).ret(e(1)).opt()).ret("name","value"));
l("varsDecl").ands(S("var"),at.sep1(S(","),!0),S(";")).ret(null,"decls")}l("funcDeclHead").ands(S("nowait").opt(),S("function").or(S("fiber")).or(S("tk_constructor")).or(S("\\")).opt(),y.or(S("new")),"paramDecls").ret("nowait","ftype","name","params");l("funcDecl").ands("funcDeclHead","compound").ret("head","body"),l("nativeDecl").ands(S("native"),y,S(";")).ret(null,"name"),l("ifWait").ands(S("ifwait"),"stmt",tt.opt()).ret(null,"then","_else");nt=l("stmt").ors("return","if","for","while","break","ifWait","try","throw","nativeDecl","funcDecl","compound","exprstmt","varsDecl");var ot=l("paramDecl").ands(y).ret("name"),ut=l("paramDecls").ands(S("("),ot.sep0(S(","),!0),S(")")).ret(null,"params");l("funcExprHead").ands(S("function").or(S("\\")),y.opt(),ut.opt()).ret(null,"name","params");var _t=(l("funcExpr").ands("funcExprHead","compound").ret("head","body"),l("jsonElem").ands(y.or(C),S(":").and(Q).ret(function(n,t){return t}).opt()).ret("key","value")),ht=(l("objlit").ands(S("{"),_t.sep0(S(","),!0),S("}")).ret(null,"elems"),l("arylit").ands(S("["),Q.sep0(S(","),!0),S("]")).ret(null,"elems"),l("extends").ands(S("extends"),y.or(S("null")),S(";")).ret(null,"superClassName")),ct=l("includes").ands(S("includes"),y.sep1(S(","),!0),S(";")).ret(null,"includeClassNames"),lt=l("program").ands(ht.opt(),ct.opt(),nt.rep0(),r.TokensParser.eof).ret("ext","incl","stmts");for(var ft in l.defs)l.defs[ft].profile();return c.parse=function(n){str="string"==typeof n?n:n.text(),str+="\n";var t=i.parse(str);if(!t.isSuccess())throw o("文法エラー(Token)",n,t.src.maxPos);var e=t.result[0],s=h.TokensParser.parse(lt,e);if(s.isSuccess()){var r=s.result[0];return r}var a=e[s.src.maxPos],u=a?a.pos+a.len:str.length;throw o("文法エラー",n,u)},c.genXML=function(n,e){var i=t(n);return i(e),i.buf},c.extension="tonyu",c}()}),requireSimulator.setName("ObjectMatcher"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return ObjectMatcher=function(){function n(n,t){var e={};return e[s]=n,t&&(e[r]=t),e}function t(n){return n&&n[s]}function e(n,t,i){if(n===t)return!0;if(null==n)return!1;if("string"==typeof n&&t instanceof RegExp)return n.match(t);if("function"==typeof t)return t(n,i);if("object"==typeof t){for(var a in t)if(a!=s){var o=a==r?n:n[a],u=t[a];if(!e(o,u,i))return!1}return t[s]&&(i[t[s]]=n),!0}return!1}var i={},s="$var",r="$this";i.v=n,i.isVar=t;for(var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=0;o<a.length;o++){var u=a.substring(o,o+1);i[u]=n(u)}return i.match=function(n,t){var i={};return e(n,t,i)?i:null},i}()}),requireSimulator.setName("context"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return context=function(){function n(n,e){var i={};for(var s in n)s.match(/^\$/)?(s=RegExp.rightContext,i[s]=t[s],t[s]=t.ovrFunc(t[s],n[s])):(i[s]=t[s],t[s]=n[s]);e(t);for(var s in i)t[s]=i[s]}var t={};return t.ovrFunc=function(n,t){return t.parent=n,t},t.enter=n,t}}),requireSimulator.setName("Visitor"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return Visitor=function(n){var t={funcs:n,path:[]};return t.visit=function(e){try{t.path.push(e),t.debug&&console.log("visit ",e.type,e.pos);var i=e?n[e.type]:null;if(i)return i.call(t,e);if(t.def)return t.def.call(t,e)}finally{t.path.pop()}},t.replace=function(n){return t.def||(t.def=function(n){if("object"==typeof n)for(var e in n)n[e]&&"object"==typeof n[e]&&(n[e]=t.visit(n[e]));return n}),t.visit(n)},t}}),requireSimulator.setName("Tonyu.Compiler"),define(["Tonyu","ObjectMatcher","TError"],function(n){function t(n,t){var e={type:n};if(t)for(var i in t)e[i]=t[i];return e.name||(e.name=r("_"+n+"_")),e}function e(n){return n?n.type:null}function i(n){var t=function(){};return t.prototype=n,new t}function s(n,t){if(!n)throw t+" is null";return n}function r(n){return n+(f++ +"").replace(/\./g,"")}function a(n,t,e){t._id||(n._idseq||(n._idseq=0),t._id=++n._idseq);var i=n[t._id];if(i||(i=n[t._id]={node:t}),e)for(var s in e)i[s]=e[s];return i}function o(n){return srcCont.substring(n.pos,n.pos+n.len)}function u(n,t){var e=null;return _(n).forEach(function(n){e||(e=n.decls.methods[t])}),e}function _(n){for(var t={},e=[],i=[],s=n;s;s=s.superClass)e=e.concat(s.includes),t[s.fullName]=!0,i.push(s);for(;e.length>0;){var s=e.shift();t[s.fullName]||(t[s.fullName]=!0,i.push(s),e=e.concat(s.includes))}return i}function h(n){if(!n.head)return[];var t=n.head.params.params;if(!t.forEach)throw n+" is not array ";return t}var c={};n.Compiler=c;var l={FIELD:"field",METHOD:"method",NATIVE:"native",LOCAL:"local",THVAR:"threadvar",PARAM:"param",GLOBAL:"global",CLASS:"class"};c.ScopeTypes=l;var f=1;return c.newScopeType=t,c.getScopeType=e,c.newScope=i,c.nullCheck=s,c.genSym=r,c.annotation=a,c.getSource=o,c.getMethod=u,c.getDependingClasses=_,c.getParams=h,c}),requireSimulator.setName("Tonyu.Compiler.JSGenerator"),"function"!=typeof define&&(define=require("requirejs").define),define(["Tonyu","Tonyu.Iterator","TonyuLang","ObjectMatcher","TError","IndentBuffer","context","Visitor","Tonyu.Compiler"],function(n,t,e,i,s,r,a,o,u){return u.JSGenerator=function(){function n(n,u){function x(t,e){return b(n.annotation,t,e)}function w(n){return"string"==typeof n?m+(u.aliases[n]||n):n.builtin?n.fullName:m+n.fullName}function j(n){var t=[];return n.forEach(function(n){t.push(w(n))}),t}function k(n,t){return function(){Y.enter(n,function(){v.visit(t)})}}function D(n,i,s){var r=A(i);if(r==nt.THVAR)H.printf("%s",t);else if(r==nt.FIELD)H.printf("%s.%s",e,n);else if(r==nt.METHOD)s&&s.noBind?H.printf("%s.%s",e,n):H.printf("%s(%s,%s.%s)",T,e,e,n);else if(r==nt.CLASS)H.printf("%s",w(n));else if(r==nt.GLOBAL)H.printf("%s%s",$,n);else{if(r!=nt.PARAM&&r!=nt.LOCAL&&r!=nt.NATIVE)throw console.log("Unknown scope type: ",r),new Error("Unknown scope type: "+r);H.printf("%s",n)}return i}function C(n){return function(){M.apply(this,[n])}}function M(n){"compound"==n.type?Y.enter({noWait:!0},function(){H.printf("%j%n",["%n",n.stmts])}):v.visit(n)}function E(t){return function(){H.printf("%s%s=%s;%n",u.options.compiler.commentLastPos?"//":"",l,Z.add(n,t.pos))}}function N(){Y.enter({},function(){m+n.namespace;U("Tonyu.klass.ensureNamespace(%s,%l);%n",m.replace(/\.$/,""),n.namespace),n.superClass?U("%s=Tonyu.klass(%s,[%s],{%{",w(n),w(n.superClass),j(n.includes).join(",")):U("%s=Tonyu.klass([%s],{%{",w(n),j(n.includes).join(","));for(var t in Q){G&&console.log("method1",t);var e=Q[t];Y.enter({noWait:!0,threadAvail:!1},function(){W(e)}),G&&console.log("method2",t),e.nowait||Y.enter({noWait:!1,threadAvail:!0},function(){R(e)}),G&&console.log("method3",t)}U("__dummy: false%n"),U("%}});%n")}),U("Tonyu.klass.addMeta(%s,%s);%n",w(n),JSON.stringify(I(n)))}function I(n){var t={fullName:n.fullName,namespace:n.namespace,shortName:n.shortName,decls:{methods:{}}};for(var e in n.decls.methods)t.decls.methods[e]={nowait:!!n.decls.methods[e].nowait};return t}function R(n){function i(){Y.enter({method:n,noWait:!0,threadAvail:!0},function(){a.forEach(function(n){U("%v%n",n)})})}function s(){Y.enter({method:n,finfo:n,pc:1},function(){o.forEach(function(n){U("%v%n",n)})})}if(!K(n)){var r=n.stmts,a=[],o=[],u=a,l=!0;l?r.forEach(function(n){x(n).fiberCallRequired&&(u=o),u.push(n)}):o=r,U("%s%s :function %s(%j) {%{var %s=%s;%n%svar %s=%s;%nvar %s=0;%n%f%n%f%n",h,n.name,F(n.pos),[",",[it].concat(n.params)],e,O,n.useArgs?"":"//",_,"Tonyu.A(arguments)",c,X(n),i),o.length>0?U("%s.enter(function %s(%s) {%{if (%s.lastEx) %s=%s.catchPC;%nfor(var %s=%d ; %s--;) {%{switch (%s) {%{%}case 0:%{%f%s.exit(%s);return;%n%}}%n%}}%n%}});%n",t,F(n.pos),t,t,c,t,f,S,f,c,s,t,e):U("%s.retVal=%s;return;%n",t,e),U("%}},%n")}}function W(n){function t(){Y.enter({method:n,finfo:n},function(){n.stmts.forEach(function(n){U("%v%n",n)})})}var i=K(n)?"initialize":n.name;U("%s :function %s(%j) {%{var %s=%s;%n%f%n%f%}},%n",i,F(n.pos),[",",n.params],e,O,X(n),t)}function V(n){function t(){Y.enter({noWait:!0,threadAvail:!1,finfo:e},function(){n.body.stmts.forEach(function(n){U("%v%n",n)})})}var e=x(n);H.printf("function (%j) {%{%f%n%f%}}",[",",e.params],X(e),t)}function F(t){return"_trc_func_"+Z.add(n,t)+"_"+tt++}function B(n){function t(){Y.enter({noWait:!0,threadAvail:!1,finfo:e},function(){n.body.stmts.forEach(function(n){U("%v%n",n)})})}var e=x(n);H.printf("function %s(%j) {%{%f%n%f%}}",e.name,[",",e.params],X(e),t)}function X(n){function t(){Y.enter({},function(){for(var t in n.locals.varDecls)H.printf("var %s;%n",t);for(var t in n.locals.subFuncDecls)B(n.locals.subFuncDecls[t])})}return t}function K(n){return q.match(n,{ftype:"constructor"})||q.match(n,{name:"new"})}var z=n.src.tonyu,H=r(),U=H.printf,Y=a(),G=!1,q=i,Z=u.traceTbl,J=n.decls,Q=(J.fields,J.methods),nt=(J.natives,P),tt=0,et=u.options.compiler.diagnose,it={type:"THNode"};v=H.visitor=o({THNode:function(){H.printf(t)},dummy:function(n){H.printf("",n)},literal:function(n){H.printf("%s",n.text)},paramDecl:function(n){H.printf("%v",n.name)},paramDecls:function(n){H.printf("(%j)",[", ",n.params])},funcDeclHead:function(n){H.printf("function %v %v",n.name,n.params)},funcDecl:function(){},"return":function(n){if(Y.inTry)throw s("現実装では、tryの中にreturnは書けません",z,n.pos);Y.noWait?Y.threadAvail?n.value?H.printf("%s.retVal=%v;return;%n",t,n.value):H.printf("%s.retVal=%s;return;%n",t,e):n.value?H.printf("return %v;",n.value):H.printf("return %s;",e):n.value?H.printf("%s.exit(%v);return;",t,n.value):H.printf("%s.exit(%s);return;",t,e)},program:function(n){genClass(n.stmts)},number:function(n){H.printf("%s",n.value)},reservedConst:function(n){"this"==n.text?H.printf("%s",e):"arguments"==n.text&&Y.threadAvail?H.printf("%s",_):n.text==t?H.printf("%s",Y.threadAvail?t:"null"):H.printf("%s",n.text)},varDecl:function(n){n.value?H.printf("%v = %v",n.name,n.value):H.printf("%v",n.name)},varsDecl:function(n){E(n)(),H.printf("%j;",[";",n.decls])},jsonElem:function(n){n.value?H.printf("%v: %v",n.key,n.value):H.printf("%v: %f",n.key,function(){D(n.key.text,x(n).scopeInfo,x(n))})},objlit:function(n){H.printf("{%j}",[",",n.elems])},arylit:function(n){H.printf("[%j]",[",",n.elems])},funcExpr:function(n){V(n)},parenExpr:function(n){H.printf("(%v)",n.expr)},varAccess:function(n){{var t=n.name.text;D(t,x(n).scopeInfo,x(n))}},exprstmt:function(i){var s={};if(E(i)(),Y.noWait||(s=x(i).fiberCall||{}),"noRet"==s.type)H.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{",e,h,s.N,[", ",[it].concat(s.A)],c,Y.pc,Y.pc++);else if("ret"==s.type)H.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{%v%v%s.retVal;%n",e,h,s.N,[", ",[it].concat(s.A)],c,Y.pc,Y.pc++,s.L,s.O,t);else if("noRetSuper"==s.type){var r=w(n.superClass);H.printf("%s.prototype.%s%s.apply( %s, [%j]);%n%s=%s;return;%n%}case %d:%{",r,h,s.S.name.text,e,[", ",[it].concat(s.A)],c,Y.pc,Y.pc++)}else"retSuper"==s.type?H.printf("%s.prototype.%s%s.apply( %s, [%j]);%n%s=%s;return;%n%}case %d:%{%v%v%s.retVal;%n",r,h,s.S.name.text,e,[", ",[it].concat(s.A)],c,Y.pc,Y.pc++,s.L,s.O,t):H.printf("%v;",i.expr)},infix:function(n){var t=n.op.text;if(et){if("+"==t||"-"==t||"*"==t||"/"==t||"%"==t)return void H.printf("%s(%v,%l)%v%s(%v,%l)",d,n.left,L(n.left),n.op,d,n.right,L(n.right));if("+="==t||"-="==t||"*="==t||"/="==t||"%="==t)return void H.printf("%v%v%s(%v,%l)",n.left,n.op,d,n.right,L(n.right))}H.printf("%v%v%v",n.left,n.op,n.right)},trifixr:function(n){H.printf("%v%v%v%v%v",n.left,n.op1,n.mid,n.op2,n.right)},prefix:function(n){H.printf("%v %v",n.op,n.right)},postfix:function(n){var t=x(n);if(et){if(t.myMethodCall){var i=t.myMethodCall,s=i.scopeInfo,r=A(s);return void(r==nt.FIELD||r==nt.METHOD?H.printf("%s(%s, %l, [%j], %l )",y,e,i.name,[",",i.args],"this"):H.printf("%s(%v, [%j], %l)",p,n.left,[",",i.args],L(n.left)))}if(t.othersMethodCall){var a=t.othersMethodCall;return void H.printf("%s(%v, %l, [%j], %l )",y,a.target,a.name,[",",a.args],L(a.target))}if(t.memberAccess){var o=t.memberAccess;return void H.printf("%s(%v,%l).%s",d,o.target,L(o.target),o.name)}}else if(t.myMethodCall){var i=t.myMethodCall,s=i.scopeInfo,r=A(s);if(r==nt.METHOD)return void H.printf("%s.%s(%j)",e,i.name,[",",i.args])}H.printf("%v%v",n.left,n.op)},"break":function(n){if(Y.noWait)H.printf("break;%n");else{if(Y.inTry&&Y.exitTryOnJump)throw s("現実装では、tryの中にbreak;は書けません",z,n.pos);if(!Y.closestBrk)throw s("break； は繰り返しの中で使います",z,n.pos);H.printf("%s=%z; break;%n",c,Y.closestBrk)}},"try":function(n){var e=x(n);if(!Y.noWait&&(e.fiberCallRequired||e.hasJump||e.hasReturn)){if(1!=n.catches.length||"catch"!=n.catches[0].type)throw s("現実装では、catch節1個のみをサポートしています",z,n.pos);var i=n.catches[0],r={},a={};H.printf("%s.enterTry(%z);%n",t,r),H.printf("%f",k({inTry:!0,exitTryOnJump:!0},n.stmt)),H.printf("%s.exitTry();%n",t),H.printf("%s=%z;break;%n",c,a),H.printf("%}case %f:%{",function(){H.print(r.put(Y.pc++))}),H.printf("%s=%s.startCatch();%n",i.name.text,t),H.printf("%s.exitTry();%n",t),H.printf("%v%n",i.stmt),H.printf("%}case %f:%{",function(){H.print(a.put(Y.pc++))})}else Y.enter({noWait:!0},function(){H.printf("try {%{%f%n%}} ",C(n.stmt)),n.catches.forEach(v.visit)})},"catch":function(n){H.printf("catch (%s) {%{%f%n%}}",n.name.text,C(n.stmt))},"throw":function(n){H.printf("throw %v;%n",n.ex)},"while":function(n){E(n)();var t=x(n);if(Y.noWait||!t.fiberCallRequired&&!t.hasReturn)Y.enter({noWait:!0},function(){H.printf("while (%v) {%{%f%n%}}",n.cond,C(n.loop))});else{var e=H.lazy(),i=Y.pc++,s="reservedConst"==n.cond.type&&"true"==n.cond.text;H.printf("%}case %d:%{"+(s?"%D%D%D":"if (!(%v)) { %s=%z; break; }%n")+"%f%n%s=%s;break;%n%}case %f:%{",i,n.cond,c,e,k({closestBrk:e,exitTryOnJump:!1},n.loop),c,i,function(){H.print(e.put(Y.pc++))})}},"for":function(n){function t(n,t,e){return function(){e.forEach(function(t,e){H.printf("%s=%s[%s];%n",t.text,n,e)})}}E(n)();var e=x(n);if("forin"==n.inFor.type){var i=x(n.inFor).iterName;if(Y.noWait||!e.fiberCallRequired&&!e.hasReturn)Y.enter({noWait:!0},function(){H.printf("%s=%s(%v,%s);%nwhile(%s.next()) {%{%f%n%f%n%}}",i,g,n.inFor.set,n.inFor.vars.length,i,t(i,n.inFor.isVar,n.inFor.vars),C(n.loop))});else{var s=H.lazy(),r=Y.pc++;H.printf("%s=%s(%v,%s);%n%}case %d:%{if (!(%s.next())) { %s=%z; break; }%n%f%n%f%n%s=%s;break;%n%}case %f:%{",i,g,n.inFor.set,n.inFor.vars.length,r,i,c,s,t(i,n.inFor.isVar,n.inFor.vars),k({closestBrk:s,exitTryOnJump:!1},n.loop),c,r,function(n){n.print(s.put(Y.pc++))})}}else if(Y.noWait||!e.fiberCallRequired&&!e.hasReturn)Y.enter({noWait:!0},function(){H.printf("%v%nwhile(%v) {%{%v%n%v;%n%}}",n.inFor.init,n.inFor.cond,n.loop,n.inFor.next)});else{var s=H.lazy(),r=Y.pc++;H.printf("%v;%n%}case %d:%{if (!(%v)) { %s=%z; break; }%n%f%n%v;%n%s=%s;break;%n%}case %f:%{",n.inFor.init,r,n.inFor.cond,c,s,k({closestBrk:s,exitTryOnJump:!1},n.loop),n.inFor.next,c,r,function(n){n.print(s.put(Y.pc++))})}},"if":function(n){E(n)();var t=x(n);if(!Y.noWait&&(t.fiberCallRequired||t.hasJump||t.hasReturn)){var e={},i={};n._else?H.printf("if (!(%v)) { %s=%z; break; }%n%v%n%s=%z;break;%n%}case %f:%{%v%n%}case %f:%{",n.cond,c,i,n.then,c,e,function(){H.print(i.put(Y.pc++))},n._else,function(){H.print(e.put(Y.pc++))}):H.printf("if (!(%v)) { %s=%z; break; }%n%v%n%}case %f:%{",n.cond,c,e,n.then,function(){H.print(e.put(Y.pc++))})}else Y.enter({noWait:!0},function(){n._else?H.printf("if (%v) {%{%f%n%}} else {%{%f%n%}}",n.cond,C(n.then),C(n._else)):H.printf("if (%v) {%{%f%n%}}",n.cond,C(n.then))})},ifWait:function(n){Y.noWait?n._else&&H.printf("%v",n._else):H.printf("%v",n.then)},call:function(n){H.printf("(%j)",[",",n.args])},objlitArg:function(n){H.printf("%v",n.obj)},argList:function(n){H.printf("%j",[",",n.args])},newExpr:function(n){var t=n.params;t?H.printf("new %v%v",n.klass,t):H.printf("new %v",n.klass)},scall:function(n){H.printf("[%j]",[",",n.args])},superExpr:function(t){var i;if(!n.superClass)throw new Error(n.fullName+"には親クラスがありません");t.name?(i=t.name.text,H.printf("%s.prototype.%s.apply( %s, %v)",w(n.superClass),i,e,t.params)):H.printf("%s.apply( %s, %v)",w(n.superClass),e,t.params)},arrayElem:function(n){H.printf("[%v]",n.subscript)},member:function(n){H.printf(".%v",n.name)},symbol:function(n){H.print(n.text)},normalFor:function(n){H.printf("%v; %v; %v",n.init,n.cond,n.next)},compound:function(n){var t=x(n);!Y.noWait&&(t.fiberCallRequired||t.hasJump||t.hasReturn)?H.printf("%j",["%n",n.stmts]):Y.enter({noWait:!0},function(){H.printf("{%{%j%n%}}",["%n",n.stmts])})},"typeof":function(){H.printf("typeof ")},"instanceof":function(){H.printf(" instanceof ")},is:function(){H.printf(" instanceof ")},regex:function(n){H.printf("%s",n.text)}});var st=["++","--","!==","===","+=","-=","*=","/=","%=",">=","<=","!=","==",">>","<<","&&","||",">","<","+","?","=","*","%","/","^","~","\\",":",";",",","!","&","|","-","delete"];return st.forEach(function(n){v.funcs[n]=function(){H.printf("%s",n)}}),v.def=function(n){throw console.log("Err node="),console.log(n),n.type+" is not defined in visitor:compiler2"},v.cnt=0,N(),n.src.js=H.buf,G&&console.log("method4",H.buf),H.buf}{var t="_thread",e="_this",_="_arguments",h="fiber$",c="__pc",l="$LASTPOS",f="__cnt",S=100,T="Tonyu.bindFunc",y="Tonyu.invokeMethod",p="Tonyu.callFunc",d="Tonyu.checkNonNull",m="Tonyu.classes.",$="Tonyu.globals.",O="this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this)",g="Tonyu.iterator",P=u.ScopeTypes,A=u.getScopeType,b=u.annotation,L=u.getSource;u.getMethod,u.getDependingClasses,u.getParams}return{genJS:n}}()}),requireSimulator.setName("Tonyu.Compiler.Semantics"),"function"!=typeof define&&(define=require("requirejs").define),define(["Tonyu","Tonyu.Iterator","TonyuLang","ObjectMatcher","TError","IndentBuffer","context","Visitor","Tonyu.Compiler"],function(n,t,e,i,s,r,a,o,u){return u.Semantics=function(){function n(n,t){function r(e){var i,r=t.options.compiler.defaultSuperClass,o=0;if((i=l.match(e,{ext:{superClassName:{text:l.N,pos:l.P}}}))&&(r=i.N,o=i.P,"null"==r&&(r=null)),n.includes=[],(i=l.match(e,{incl:{includeClassNames:l.C}}))&&i.C.forEach(function(e){var i=e.text,r=e.pos,o=t.classes[t.aliases[i]||i];if(!o)throw s("クラス "+i+"は定義されていません",a,r);n.includes.push(o)}),"Array"==r)n.superClass={name:"Array",fullName:"Array",builtin:!0};else if(r){var _=t.classes[t.aliases[r]||r];if(!_)throw s("親クラス "+r+"は定義されていません",a,o);n.superClass=_}e.stmts.forEach(function(n){if("funcDecl"==n.type){var t=n.head,e="function";t.ftype&&(e=t.ftype.text),h[t.name.text]={nowait:!!t.nowait,ftype:e,name:t.name.text,head:t,pos:t.pos,stmts:n.body.stmts}}else"nativeDecl"==n.type?c[n.name.text]=n:u.stmts.push(n)})}var a=n.src.tonyu,o=e.parse(a),u={name:"main",stmts:[],pos:0},_={},h={main:u},c={};n.decls={fields:_,methods:h,natives:c},n.node=o;var l=i;r(o)}function t(n,t){function e(t,e){return f(n.annotation,t,e)}function u(n){if(!n.builtin){var t=V,e=n.decls;for(var i in e.fields)t[i]=_(W.FIELD,{klass:n.name,name:i});for(var i in e.methods)t[i]=_(W.METHOD,{klass:n.name,name:i})}}function m(){var e=V;y(n).forEach(u);var i=n.decls;for(var s in i.natives)e[s]=_(W.NATIVE,{name:"native::"+s});for(var s in d)e[s]=_(W.NATIVE,{name:"native::"+s});for(var s in t.aliases)e[s]=_(W.CLASS,{name:s})}function $(){var t=y(n);for(var e in n.decls.methods){var i=n.decls.methods[e];t.forEach(function(n){var t=n.decls.methods[e];t&&t.nowait&&(i.nowait=!0)})}}function O(t){return T(n,t)}function g(n){if("varAccess"==n.type||"postfix"==n.type&&("member"==n.op.type||"arrayElem"==n.op.type))return"varAccess"==n.type&&e(n,{noBind:!0}),!0;throw console.log("LVal",n),s("'"+S(n)+"'は左辺には書けません．",E,n.pos)}function v(t){var e=F.scope[t],i=h(e);if(!i){var s=t.match(/^\$/);i=s?W.GLOBAL:W.FIELD;var r={name:t};s||(r.klass=n.name),e=V[t]=_(i,r)}return e}function P(n){var t=this;if(n&&"object"==typeof n){var e;if(e=n instanceof Array?n:n[Grammar.SUBELEMENTS],!e){e=[];for(var i in n)e.push(n[i])}e.forEach(function(n){t.visit(n)})}}function A(n){var t={varDecls:{},subFuncDecls:{}};return F.enter({locals:t},function(){q.visit(n)}),t}function b(n,t){n.forEach(function(n){e(n,t)})}function L(n){F.method&&(F.method.fiberCallRequired=!0),b(n,{fiberCallRequired:!0})}function x(n,t){F.enter({scope:t},function(){Z.visit(n)})}function w(n,t){for(var e in n.varDecls)t[e]=_(W.LOCAL);for(var e in n.subFuncDecls)t[e]=_(W.LOCAL)}function j(n){n.locals=A(n.stmts),n.params=p(n)}function k(t){var e=c(F.scope);return t.params.forEach(function(i,s){e[i.name.text]=_(W.PARAM,{klass:n.name,name:t.name,no:s})}),w(t.locals,e),F.enter({method:t,finfo:t,noWait:!1},function(){x(t.stmts,e)}),t.scope=e,M(t.locals,e),e}function D(){F.enter({scope:V},function(){for(var n in R){B&&console.log("anon method1",n);var t=R[n];j(t),k(t)}})}function C(n){var t,i,s=n.body,r=n.head.name?n.head.name.text:"anonymous";i=(t=N.match(n,{head:{params:{params:N.P}}}))?t.P:[];var a=c(F.scope);i.forEach(function(n){a[n.name.text]=_(W.PARAM)});var o=A(s,a);w(o,a);var u=e(n);F.enter({finfo:u},function(){x(s,a)});var h={scope:a,locals:o,name:r,params:i};return e(n,h),e(n,u),M(o,a),h}function M(n,t){F.enter({scope:t},function(){for(var t in n.subFuncDecls)C(n.subFuncDecls[t])})}var E=n.src.tonyu,N=(E.text(),i),I=(t.traceTbl,n.decls),R=(I.fields,I.methods),W=(I.natives,r),V={},F=a(),B=!1,X={type:"postfix",left:{type:"postfix",left:N.T,op:{type:"member",name:{text:N.N}}},op:{type:"call",args:N.A}},K={type:"postfix",left:N.T,op:{type:"member",name:{text:N.N}}},z=fiberCallTmpl={type:"postfix",left:{type:"varAccess",name:{text:N.N}},op:{type:"call",args:N.A}},H={expr:fiberCallTmpl},U={expr:{type:"infix",op:N.O,left:N.L,right:fiberCallTmpl}},Y={expr:{type:"superExpr",params:{args:N.A},$var:"S"}},G={expr:{type:"infix",op:N.O,left:N.L,right:{type:"superExpr",params:{args:N.A},$var:"S"}}};n.annotation={};var q=o({varDecl:function(n){F.locals.varDecls[n.name.text]=n},funcDecl:function(n){F.locals.subFuncDecls[n.head.name.text]=n},funcExpr:function(){},"catch":function(n){F.locals.varDecls[n.name.text]=n},exprstmt:function(){},forin:function(n){n.isVar;n.vars.forEach(function(t){F.locals.varDecls[t.text]=n});var t=l("_it_");e(n,{iterName:t}),F.locals.varDecls[t]=n}});q.def=P;var Z=o({varAccess:function(n){var t=v(n.name.text);e(n,{scopeInfo:t})},funcDecl:function(){},funcExpr:function(n){C(n)},jsonElem:function(n){if(n.value)this.visit(n.value);else{var t=v(n.key.text);e(n,{scopeInfo:t})}},"do":function(n){var t=this;F.enter({jumpable:!0},function(){t.def(n)})},"switch":function(n){var t=this;F.enter({jumpable:!0},function(){t.def(n)})},"while":function(n){var t=this;F.enter({jumpable:!0},function(){t.def(n)})},"for":function(n){var t=this;F.enter({jumpable:!0},function(){t.def(n)})},forin:function(n){n.vars.forEach(function(n){var t=v(n.text);e(n,{scopeInfo:t})}),this.visit(n.set)},ifWait:function(n){var t="_thread",e=this,i=c(F.scope);i[t]=_(W.THVAR),F.enter({scope:i},function(){e.visit(n.then)}),n._else&&e.visit(n._else),L(this.path)},"try":function(n){F.finfo.useTry=!0,this.def(n)},"return":function(n){F.noWait||b(this.path,{hasReturn:!0}),this.visit(n.value)},"break":function(n){if(!F.jumpable)throw s("break； は繰り返しの中で使います.",E,n.pos);F.noWait||b(this.path,{hasJump:!0})},"continue":function(n){if(!F.jumpable)throw s("continue； は繰り返しの中で使います.",E,n.pos);F.noWait||b(this.path,{hasJump:!0})},reservedConst:function(n){"arguments"==n.text&&(F.finfo.useArgs=!0)},postfix:function(n){var t;if(this.visit(n.left),this.visit(n.op),t=N.match(n,z)){var i=e(n.left).scopeInfo;e(n,{myMethodCall:{name:t.N,args:t.A,scopeInfo:i}})}else(t=N.match(n,X))?e(n,{othersMethodCall:{target:t.T,name:t.N,args:t.A}}):(t=N.match(n,K))&&e(n,{memberAccess:{target:t.T,name:t.N}})},infix:function(n){var t=n.op.text;("="==t||"+="==t||"-="==t||"*="==t||"/="==t||"%="==t)&&g(n.left),this.def(n)},exprstmt:function(t){var i,s;if(F.noWait||!(i=N.match(t,H))||h(F.scope[i.N])!=W.METHOD||O(i.N).nowait)if(F.noWait||!(i=N.match(t,U))||h(F.scope[i.N])!=W.METHOD||O(i.N).nowait){if(!F.noWait&&(i=N.match(t,Y))&&i.S.name){if(s=O(i.S.name.text),!s)throw new Error("メソッド"+i.S.name.text+" はありません。");s.nowait||(i.type="noRetSuper",i.superClass=n.superClass,e(t,{fiberCall:i}),L(this.path))}else if(!F.noWait&&(i=N.match(t,G))&&i.S.name){if(s=O(i.S.name.text),!s)throw new Error("メソッド"+i.S.name.text+" はありません。");s.nowait||(i.type="retSuper",i.superClass=n.superClass,e(t,{fiberCall:i}),L(this.path))}}else i.type="ret",e(t,{fiberCall:i}),L(this.path);else i.type="noRet",e(t,{fiberCall:i}),L(this.path);this.visit(t.expr)}});Z.def=P,m(),$(),D()}var r=u.ScopeTypes,_=u.newScopeType,h=u.getScopeType,c=u.newScope,l=u.genSym,f=u.annotation,S=u.getSource,T=u.getMethod,y=u.getDependingClasses,p=u.getParams,d={Array:1,String:1,Boolean:1,Number:1,Void:1,Object:1,RegExp:1,Error:1};return{initClassDecls:n,annotate:t}}()}),requireSimulator.setName("Tonyu.TraceTbl"),define(["Tonyu","FS","TError"],function(n,t,e){return n.TraceTbl=function(){var n={},i=1e6,s=1,r=1e4,a={},o=[],u={};return n.add=function(n,t){var e=n.src.tonyu,_=e.path(),h=a[_];void 0==h&&(h=s++,s>r&&(s=0),a[_]=h,o[h]=_),u[_]=n,t>=i&&(t=i-1);var c=h*i+t;return c},n.decode=function(n){var s=n%i,r=(n-s)/i,a=o[r];if(a){var _=t.get(a),h=u[a];return e("Trace info",h||_,s)}return null},n}}),requireSimulator.setName("ProjectCompiler"),define(["Tonyu","Tonyu.Compiler.JSGenerator","Tonyu.Compiler.Semantics","Tonyu.TraceTbl","FS"],function(n,t,e,i,s){var r=function(i){function a(n){var t=_.env;return n||(n={}),n.visited||(n={visited:{},classes:t.classes=t.classes||{},options:n}),n}function o(n){var t={},e=[],i=0;for(var s in n)t[s]=!1,i++;for(;e.length<i;){var r=e.length;for(var s in n)if(!t[s]){var a=n[s],o=a.superClass,u=[o],_=!0;a.includes&&(u=u.concat(a.includes)),u.forEach(function(e){_=_&&(!e||!n[e.fullName]||e.builtin||t[e.fullName])}),_&&(e.push(a),t[s]=!0)}if(e.length==r)throw TError("クラスの循環参照があります","不明",0)}return e}function u(n){return console.log("loading: "+n.path()),new Function(n.text())()}if(!i.rel)throw new Error("projectCompiler: "+i+" is not dir obj");var _={env:{}},h=n.TraceTbl();return _.env.traceTbl=h,_.EXT=".tonyu",_.getOptionsFile=function(){var n=i.rel("options.json");return n},_.getOptions=function(){var n=_.env;n.options={};var t=_.getOptionsFile();return t.exists()&&(n.options=t.obj()),_.fixOptions(n.options),n.options},_.fixOptions=function(n){n.compiler||(n.compiler={})},_.resolve=function(n){if(n instanceof Array){var t=[];return n.forEach(function(n){t.push(_.resolve(n))}),t}if("string"==typeof n)return s.resolve(n,i.path());if(!n||!n.isDir)throw new Error("Cannot TPR.resolve: "+n);return n},_.shouldCompile=function(){var n=_.getOutputFile();if(!n.exists())return!0;if(n.isReadOnly())return!1;var t=n.lastUpdate(),e=_.sourceFiles();for(var i in e){var s=e[i],r=s.lastUpdate();if(r>t)return console.log("Should compile: ",s.name()+" last="+new Date(r)),!0}var a=_.getOptionsFile();return a.exists()&&a.lastUpdate()>t?(console.log("Should compile: ",a.name()+" last="+new Date(a.lastUpdate())),!0):!1},_.getNamespace=function(){var n=_.getOptions();return n.compiler.namespace},_.getOutputFile=function(){var n=_.getOptions();console.log("Loaded option: ",i,n);var t=_.resolve(n.compiler.outputFile);if(t.isDir())throw new Error("out: directory style not supported");return t},_.loadClasses=function(t){n.runMode=!1,console.log("LoadClasses: "+i.path()),t=a(t);var e=t.visited||{},s=t.classes||{};if(!e[_.path()]){e[_.path()]=!0;var r=_.getNamespace();if(_.getDependingProjects().forEach(function(n){n.getNamespace()!=r&&n.loadClasses(t)}),_.shouldCompile())_.compile(t);else{var o=_.getOutputFile("js");u(o);var h=_.getNamespace(),c=n.classes;h.split(".").forEach(function(n){if(c=c[n],!c)throw new Error("namespace Not found :"+h)});for(var l in c){var f=c[l],S=n.klass.getMeta(f);s[S.fullName]=S}}}},_.compile=function(t){n.runMode=!1,console.log("Compile: "+i.path()),t=a(t);var e=_.getDependingProjects(),s=_.getNamespace();e.forEach(function(n){var e=n.getNamespace();e!=s&&n.loadClasses(t)});var r=_.sourceDirs();_.compileDir(s,r,t)},_.compileDir=function(n,t,i){{var s=i.classes;i.options}t=_.resolve(t);var r=_.env;r.aliases={},r.classes=s;for(var a in s){var u=s[a];r.aliases[u.shortName]=u.fullName}var h={},c=_.sourceFiles(n,t);for(var l in c){var f=c[l],S=n+"."+l;h[S]=s[S]={fullName:S,shortName:l,namespace:n,src:{tonyu:f}},r.aliases[l]=S}for(var a in h)console.log("initClassDecl: "+a),e.initClassDecls(h[a],r);var T=o(h);T.forEach(function(n){console.log("annotate :"+n.fullName),e.annotate(n,r)}),_.concatJS(T)},_.concatJS=function(n){var e=_.env,i="";n.forEach(function(n){console.log("concatJS :"+n.fullName),t.genJS(n,e),i+=n.src.js+"\n"});var s=_.getOutputFile();s.text(i),u(s)},_.getDependingProjects=function(){var n=_.getOptions(),t=n.compiler.dependingProjects||[];return t.map(function(n){var t=_.resolve(n);return r(t)})},_.dir=i,_.path=function(){return i.path()},_.sourceFiles=function(n,t){function e(n){if(n.endsWith(_.EXT)){var t=n.truncExt(_.EXT);i[t]=n}}n=n||_.getNamespace(),t=t||_.sourceDirs();for(var i={},s=t.length-1;s>=0;s--)t[s].recursive(e);return i},_.sourceDirs=function(){var n=_.getDependingProjects(),t=_.getNamespace(),e=[i];return n.forEach(function(n){var i=n.getNamespace();i==t&&e.push(n.dir)}),e},_};return r}),requireSimulator.setName("PatternParser"),define(["Tonyu"],function(n){return n.klass({initialize:function(n,t){this.options=t||{},this.img=n,this.height=n.height,this.width=n.width;var e=this.newImage(n.width,n.height),i=e.getContext("2d");i.drawImage(n,0,0),this.ctx=i,this.pixels=this.ctx.getImageData(0,0,n.width,n.height).data,this.base=this.getPixel(0,0)},newImage:function(n,t){var e=document.createElement("canvas");return e.width=n,e.height=t,e},getPixel:function(n,t){var e=this.pixels,i=4*(n+t*this.width),s=e[0+i],r=e[1+i],a=e[2+i],o=e[3+i];return 256*(256*(256*o+a)+r)+s},setPixel:function(n,t,e){var i=4*(n+t*this.width);this.pixels[0+i]=255&e,e=(e-(255&e))/256,this.pixels[1+i]=255&e,e=(e-(255&e))/256,this.pixels[2+i]=255&e,e=(e-(255&e))/256,this.pixels[3+i]=255&e},parse:function(){try{for(var n=[],t=0;t<this.height;t++)for(var e=0;e<this.width;e++){var i=this.getPixel(e,t);i!=this.base&&n.push(this.parse1Pattern(e,t))}return n}catch(s){if(s.isParseError)return console.log("parse error! "+s),{image:this.img,x:0,y:0,width:this.width,height:this.height};throw s}},parse1Pattern:function(n,t){function e(n){return n}function i(n,t,e){return{toString:function(){return"at ("+n+","+t+") :"+e},isParseError:!0}}for(var s=this.getPixel(n,t),r=n,a=t,o=this.base,u=this.width,_=this.height;u>r;){var h=this.getPixel(r,a);if(h!=s)break;r++}if(r>=u||this.getPixel(r,a)!=o)throw i(r,a,e(this.getPixel(r,a))+"!="+e(o));for(r--;_>a&&this.getPixel(r,a)==s;)a++;if(a>=_||this.getPixel(r,a)!=o)throw i(r,a,e(this.getPixel(r,a))+"!="+e(o));a--;var c=n+1,l=t+1,f=r-c,S=a-l;if(console.log("PP",c,l,f,S,r,a),f*S==0)throw i(r,a,"w*h==0");for(var T=this.newImage(f,S),y=T.getContext("2d"),p=y.getImageData(0,0,f,S),d=p.data,m=0,$=l;a>$;$++)for(var O=c;r>O;O++){var g=this.getPixel(O,$);g==s?(d[m++]=0,d[m++]=0,d[m++]=0,d[m++]=0):(d[m++]=255&g,g=(g-(255&g))/256,d[m++]=255&g,g=(g-(255&g))/256,d[m++]=255&g,g=(g-(255&g))/256,d[m++]=255&g)}y.putImageData(p,0,0);for(var v=l-1;a>=v;v++)for(var P=c-1;r>=P;P++)this.setPixel(P,v,o);return this.options.boundsInSrc?{x:c,y:l,width:f,height:S}:{image:T,x:0,y:0,width:f,height:S}}})}),requireSimulator.setName("Util"),Util=function(){function n(n,e){null==e&&(e=""),n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),s=i.exec(window.location.href);return null==s?e:t(s[1])}function t(n){return decodeURIComponent(n.replace(/\+/g,"%20"))}function e(n,t){return n.substring(n.length-t.length)===t}function i(n,t){return n.substring(0,t.length)===t}return{getQueryString:n,endsWith:e,startsWith:i}}(),requireSimulator.setName("ImageList"),define(["PatternParser","Util","WebSite"],function(n,t,e){function i(n){var t=[];return n.forEach(function(n){n&&""!=n.url&&t.push(n)}),t}var s,r={};return s=function(t,e,a){a||(a={}),t=i(t);var o=[],u=t.length;t.forEach(function(t,i){function _(){var s,r;if((s=t.pwidth)&&(r=t.pheight)){for(var a=0,_=0,h=this.width,c=this.height,l=[];;){var f=s,S=r;if(a+s>h&&(f=h-a),_+r>c&&(S=c-_),l.push({image:this,x:a,y:_,width:f,height:S}),a+=s,a+s>h&&(a=0,_+=r,_+r>c))break
}o[i]=l}else{var T=new n(this);o[i]=T.parse()}if(o[i].name=t.name,u--,0==u){var y=[],p={};o.forEach(function(n){p[n.name]=y.length,y=y.concat(n)}),y.names=p,e(y)}}console.log("loading",t,i);var h=t.url,c=h;if(r[c])return void _.apply(r[c],[]);h=s.convURL(h,a.baseDir);var l=$("<img>");l.load(function(){r[c]=this,_.apply(this,[])}),l.attr("src",h)})},s.load=s,s.parse1=function(t,e,i){var s,r,a;if((s=t.pwidth)&&(r=t.pheight)){for(var o=0,u=0,_=e.width,h=e.height,c=[];;)if(c.push({image:this,x:o,y:u,width:s,height:r}),o+=s,o+s>_&&(o=0,u+=r,u+r>h))break;a=c}else{var l=new n(e,i);a=l.parse()}return a.name=t.name,a},s.convURL=function(n,i){if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(n,t){return e[t]}),e.urlAliases[n]&&(n=e.urlAliases[n]),t.startsWith(n,"ls:")){var s=n.substring("ls:".length);if(!i)throw new Error("Basedir not specified");var r=i.rel(s);if(!r.exists())throw"ImageList file not found: "+r;n=r.text()}return n},window.ImageList=s,s}),requireSimulator.setName("StackTrace"),define([],function(){var trc={},pat=/_trc_func_([0-9]+)_.*[^0-9]([0-9]+):([0-9]+)[\s\)]*\r?$/;return trc.isAvailable=function(){var scr="({\n    main :function _trc_func_17000000_0() {\n      var a=(this.t.x);\n    }\n}).main();\n",s;try{eval(scr)}catch(e){if(s=e.stack,"string"!=typeof s)return!1;for(var lines=s.split(/\n/),i=0;i<lines.length;i++){var p=pat.exec(lines[i]);if(p)return!0}}return!1},trc.get=function(n,t){var e=n.stack;if("string"!=typeof e)return!1;for(var i=e.split(/\n/),s=[],r=0;r<i.length;r++){var a=pat.exec(i[r]);if(a){var o=a[1],u=a[2],_=(a[3],t.decode(o));if(_&&_.klass){for(var h=_.klass.src.js,c=h.split(/\n/),l=null,f=0;f<c.length&&u>f+1;f++){var S=/\$LASTPOS=([0-9]+)/.exec(c[f]);S&&(l=parseInt(S[1]))}if(l){var T=t.decode(l);T&&s.push(T)}}}}return s},trc}),requireSimulator.setName("typeCheck"),"function"!=typeof define&&(define=require("requirejs").define),define(["Visitor"],function(){return TypeCheck=function(){}}),requireSimulator.setName("Auth"),define(["WebSite"],function(n){var t={};return t.currentUser=function(t){$.ajax({type:"get",url:n.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(n){console.log("auth.currentUser",n),n=JSON.parse(n);var e=n.user;"null"==e&&(e=null),console.log("user",e,"csrfToken",n.csrfToken),t(e,n.csrfToken)}})},t.assertLogin=function(e){t.currentUser(function(t,i){return t?e.success(t,i):(window.onLoggedIn=e.success,void e.showLoginLink(n.serverTop+"/login"))})},window.Auth=t,t}),requireSimulator.setName("Blob"),define(["Auth","WebSite","Util"],function(n,t,e){var i={},s="${blobPath}";return i.BLOB_PATH_EXPR=s,i.upload=function(n,e,i,s){var r=new FormData(document.getElementById("fileinfo"));s.error&&(s.error=function(n){alert(n)}),r.append("theFile",i),r.append("user",n),r.append("project",e),r.append("fileName",i.name),$.ajax({type:"get",url:t.serverTop+"/blobURL",success:function(n){$.ajax({url:n,type:"POST",data:r,processData:!1,contentType:!1,success:function(n){console.log("Res = "+n),s.success.apply({},arguments)},error:s.error})}})},i.isBlobURL=function(n){if(e.startsWith(n,s)){var t=n.split("/");return{user:t[1],project:t[2],fileName:t[3]}}},i.url=function(n,e,i){return t.blobPath+n+"/"+e+"/"+i},i.uploadToExe=function(n,e){var i=n.getBlobInfos(),s=i.length;return console.log("uploadBlobToExe cnt=",s),0==s?e.success():(e.progress||(e.progress=function(n){console.log("uploadBlobToExe cnt=",n)}),void i.forEach(function(n){var i={csrfToken:e.csrfToken};for(var r in n)i[r]=n[r];$.ajax({type:"get",url:t.serverTop+"/uploadBlobToExe",data:i,success:function(){return s--,0==s?e.success():void e.progress(s)},error:e.error})}))},i}),requireSimulator.setName("ImageRect"),define([],function(){function n(t,e){if("string"==typeof t){var i=new Image,s=null,r=null,a=function(n){n&&(r=n),r&&s&&r(s)};return i.onload=function(){s=n(i,e),a()},i.src=t,a}var o=e.width,u=e.height,_=e.getContext("2d"),h=t.width,c=t.height,l=u/c*h,f=o/h*c;f>u&&(f=u),l>o&&(l=o),_.clearRect(0,0,o,u);var S=Math.floor((o-l)/2),T=Math.floor((u-f)/2);return _.drawImage(t,0,0,h,c,S,T,l,f),{left:S,top:T,width:l,height:f,src:t}}return n}),requireSimulator.setName("thumbnail"),define(["ImageRect"],function(n){function t(t){try{var s=Tonyu.globals.$Screen.buf[0],r=$("<canvas>").attr({width:100,height:100});n(s,r[0]);var a=r[0].toDataURL(),o=t.getResource(),u=t.getDir(),_=e.file(t);_.text(a);for(var h={name:i,pwidth:100,pheight:100,url:"ls:"+_.relPath(u)},c=o.images,l=!1,f=0;f<c.length;f++)c[f].name==i&&(c[f]=h,l=!0);l||c.push(h),t.setResource(o),console.log("setRSRC",o)}catch(S){console.log("Create thumbnail failed",S)}}var e={},i="$icon_thumbnail";return e.set=function(n,e){setTimeout(function(){t(n)},e)},e.get=function(n){var t=e.file(n);return t.exists()?t.text():null},e.file=function(n){var t=n.getDir(),e=t.rel("images/").rel("icon_thumbnail.png");return e},e}),requireSimulator.setName("plugins"),define(["WebSite"],function(n){function t(n){return"function"==typeof n&&(n={onload:n}),n||(n={}),n.onload||(n.onload=function(){}),n}var e={},i={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/T2Body/,symbol:"Box2D"},timbre:{src:"timbre.js",detection:/\bplay(SE)?\b/,symbol:"T"}};return e.detectNeeded=function(n,t){for(var e in i){var s=i[e].detection.exec(n);s&&(t[e]=1)}return t},e.loaded=function(n){var t=i[n];if(!t)throw new Error("plugin not found: "+n);return window[t.symbol]},e.loadAll=function(n,s){function r(){u>=a.length?s.onload():e.load(a[u++],r)}s=t(s);var a=[];for(var o in n)i[o]&&!e.loaded(o)&&a.push(o);var u=0;console.log("loading plugins",a),r()},e.load=function(e,s){var r=i[e];if(!r)throw new Error("plugin not found: "+e);s=t(s);var a=n.pluginTop+"/"+r.src;$.getScript(a,s.onload)},e.request=function(n){if(!e.loaded(n)){var t=new Error("Plugin "+n+" required");t.pluginName=n}},e}),requireSimulator.setName("Tonyu.Project"),define(["Tonyu","ProjectCompiler","TError","FS","Tonyu.TraceTbl","ImageList","StackTrace","typeCheck","Blob","thumbnail","WebSite","plugins","Tonyu.Compiler.Semantics","Tonyu.Compiler.JSGenerator"],function(n,t,e,i,s,r,a,o,u,_,h,c){return n.Project=function(s,o){var l=t(s),f=t(o),S=(n.extend({},l),i.get(h.tonyuHome));o||(o=S.rel("Kernel/"));var T=n.TraceTbl(),y={classes:{},traceTbl:T,options:{compiler:{}}};return l.EXT=".tonyu",l.NSP_KER="kernel",l.NSP_USR="user",l.env=y,l.dumpJS=function(n){function t(n){console.log("Class "+n+":\n"+y.classes[n].src.js)}if(n)t(n);else for(var n in y.classes)t(n)},l.stop=function(){var n=l.runningThread;n&&n.kill();var t=l.runningObj;t&&t.stop&&t.stop()},l.rawRun=function(n){l.loadClasses(),l.runScriptMode||_.set(l,2e3),l.rawBoot(n)},l.getResource=function(){var t=s.rel("res.json");return t.exists()?t.obj():n.defaultResource},l.setResource=function(n){var t=s.rel("res.json");t.obj(n)},l.getThumbnail=function(){return _.get(l)},l.convertBlobInfos=function(n){function t(e){if("object"==typeof e)for(var s in e)if(e.hasOwnProperty(s)){var r=e[s];if("url"==s){var a;(a=u.isBlobURL(r))&&(e[s]=[u.BLOB_PATH_EXPR,n,i,a.fileName].join("/"))}t(r)}}var e=l.getResource(),i=l.getName();t(e),l.setResource(e)},l.getBlobInfos=function(){function n(t){if("object"==typeof t)for(var i in t)if(t.hasOwnProperty(i)){var s=t[i];if("url"==i){var r;(r=u.isBlobURL(s))&&e.push(r)}n(s)}}var t=l.getResource(),e=[];return n(t),e},l.loadResource=function(t){var e=l.getResource();r(e.images,function(e){var i=n.getGlobal("$Sprites");i&&i.setImageList(e);for(var s in e.names)n.setGlobal(s,e.names[s]);t&&t()})},l.getOptions=function(){y.options=null;var t=s.rel("options.json");return t.exists()&&(y.options=t.obj()),y.options&&!y.options.run&&(y.options=null),y.options||(y.options=n.defaultOptions),l.fixOptions(y.options),y.options},l.fixOptions=function(n){n.compiler||(n.compiler={}),n.compiler.commentLastPos=l.runScriptMode||a.isAvailable(),n.run.mainClass=l.fixClassName(n.run.mainClass),n.run.bootClass=l.fixClassName(n.run.bootClass),n.plugins||(n.plugins={},s.each(function(t){t.endsWith(l.EXT)&&c.detectNeeded(t.text(),n.plugins)}))},l.requestPlugin=function(n){if(!c.loaded(n)){var t=l.getOptions();t.plugins[n]=1,l.setOptions(t);var e=new Error("必要なプラグイン"+n+"を追加しました。もう一度実行してください");throw e.pluginName=n,e}},l.loadPlugins=function(n){var t=l.getOptions();c.loadAll(t.plugins,n)},l.fixClassName=function(n){if(l.classExists(n))return n;var t,e=n.split("."),i=e.pop();return t=l.NSP_USR+"."+i,l.classExists(t)?t:(t=l.NSP_KER+"."+i,l.classExists(t)?t:n)},l.classExists=function(n){var t=n.split(".");if(1==t.length)return!1;var e=t[0],i=t[1];if(l.isKernelEditable()){if(e==l.NSP_KER){if(s.rel(i+l.EXT).exists())return!0;if(o.rel(i+l.EXT).exists())return!0}}else{if(e==l.NSP_KER&&o.rel(i+l.EXT).exists())return!0;if(e==l.NSP_USR&&s.rel(i+l.EXT).exists())return!0}return!1},l.getNamespace=function(){var n=l.getOptions();return n.compiler&&n.compiler.namespace?n.compiler.namespace:l.isKernelEditable()?l.NSP_KER:l.NSP_USR},l.getDependingProjects=function(){return[f]},l.getOutputFile=function(){var n=l.getOptions();return n.compiler.outputFile?i.resolve(n.compiler.outputFile):s.rel("js/concat.js")},l.setOptions=function(n){n&&(y.options=n);var t=s.rel("options.json"),e=t.text(),i=JSON.stringify(y.options);e!=i&&(console.log("update option",e,i),t.text(i))},l.rawBoot=function(t){var i=n.getClass(t);if(!i)throw e(t+" というクラスはありません","不明",0);var s=new i,r=n.thread();r.apply(s,"main"),l.runningThread=r,l.runningObj=s,$LASTPOS=0,r.steps()},l.isKernel=function(n){var t=o.rel(n+l.EXT);return t.exists()?t:null},l.isKernelEditable=function(){return y.options.kernelEditable},l.getDir=function(){return s},l.getName=function(){return s.name().replace(/\/$/,"")},l.renameClassName=function(n,t){l.compile();var e=l.env.classes;for(var i in e){var s=e[i],r=s.src.tonyu,a=s.annotation,o=[];if(a&&r){for(var u in a)try{var _=a[u],h=_.scopeInfo;if(h&&"class"==h.type&&h.name==n){var c=_.node.pos,f=_.node.len,S=r.text().substring(c,c+f);S==n&&(o.push({pos:c,len:f}),console.log(r.path(),c,f,r.text().substring(c-5,c+f+5),"->",t))}}catch(T){console.log(T)}o=o.sort(function(n,t){return t.pos-n.pos}),console.log(r.path(),o);var y=r.text(),p=y;o.forEach(function(n){y=y.substring(0,n.pos)+t+y.substring(n.pos+n.len)}),p==y||r.isReadOnly()||(console.log("Refact:",r.path(),y),r.text(y))}}},l}}),requireSimulator.setName("Shell"),define(["FS","Util","WebSite"],function(n,t,e){function i(n,t){var e=s(n);if(t&&!e.exists())throw e+": no such file or directory";return e}function s(e){if("string"!=typeof e)return e;if(t.startsWith(e,"/"))return n.get(e);var i=r.cwd;return i.rel(e)}var r={cwd:n.get("/")};return r.cd=function(n){return r.cwd=i(n,!0),r.pwd()},r.resolve=i,r.pwd=function(){return r.cwd+""},r.ls=function(n){return n=n?i(n,!0):r.cwd,n.ls()},r.cp=function(n,t,e){e||(e={}),e.v&&r.echo("cp",n,t);var s=i(n,!0),a=i(t);if(s.isDir()&&a.isDir()){var o=0;return s.recursive(function(n){var t=n.relPath(s),i=a.rel(t);(e.test||e.v)&&r.echo((i.exists()?"[ovr]":"[new]")+i+"<-"+n),e.test||i.copyFrom(n,e),o++}),o}if(s.isDir()||a.isDir()){if(!s.isDir()&&a.isDir())return a.rel(s.name()).text(s.text()),1;throw"Cannot copy directory "+s+" to file "+a}return a.text(s.text()),1},r.rm=function(n,t){if(t||(t={}),t.notrash)return n=i(n,!1),n.removeWithoutTrash(),1;if(n=i(n,!0),n.isDir()&&t.r){var e=n,s=0;return e.each(function(n){n.exists()&&(s+=r.rm(n,t))}),e.rm(),s+1}return n.rm(),1},r.cat=function(n){n=i(n,!0),r.echo(n.text())},r.resolve=function(n){return n||(n="."),n=i(n)},r.grep=function(n,t,e){function s(n,t,i){e.res&&e.res.push({file:n,lineNo:t,line:i}),r.echo(n+"("+t+"): "+i)}return t=i(t,!0),e||(e={}),e.res||(e.res=[]),t.isDir()?t.each(function(t){r.grep(n,t,e)}):"string"==typeof n&&t.lines().forEach(function(e,i){e.indexOf(n)>=0&&s(t,i+1,e)}),e.res},r.touch=function(n){return n=i(n),n.text(n.exists()?n.text():""),1},r.setout=function(n){r.outUI=n},r.echo=function(){console.log.apply(console,arguments),r.outUI&&r.outUI.log&&r.outUI.log.apply(r.outUI,arguments)},r.err=function(){console.log.apply(console,arguments),r.outUI&&r.outUI.err&&r.outUI.err.apply(r.outUI,arguments)},r.prompt=function(){},r.ASYNC={r:"SH_ASYNC"},r.help=function(){for(var n in r){var t=r[n];"function"==typeof t&&r.echo(n+(t.description?" - "+t.description:""))}},sh=r,e.isNW&&(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()}),r}),requireSimulator.setName("KeyEventChecker"),define([],function(){var n={};return n.down=function(t,e,i){t instanceof $||(t=$(t)),t.bind("keydown",function(s){return n.is(s,e)?i.call(t[0],s):void 0})},n.is=function(n,t){t=t.toLowerCase(),n=n.originalEvent||n;var e="";return n.altKey&&(e+="alt+"),n.ctrlKey&&(e+="ctrl+"),n.shiftKey&&(e+="shift+"),e+=n.keyCode>=112&&n.keyCode<=123?"f"+(n.keyCode-111):String.fromCharCode(n.keyCode),e=e.toLowerCase(),t==e},n}),requireSimulator.setName("ScriptTagFS"),define([],function(){var n={};return n.toObj=function(){function n(n,t){var e=n.split("\n"),i="";return e.forEach(function(n){i+=n.length>t?n.substring(0,t):n+"\n"}),i}var t=$("script"),e={};return t.each(function(){var t=this;if("text/tonyu"==t.type){var i=$(t).data("filename");if(i){var s=parseInt($(t).data("lastupdate")),r=$(t).data("wrap");r?(r=parseInt(r),e[i]={lastUpdate:s,text:n(t.innerHTML,r)}):e[i]={lastUpdate:s,text:t.innerHTML}}}}),e},n}),requireSimulator.setName("runtime"),requirejs(["ImageList"],function(){}),requireSimulator.setName("runScript"),requirejs(["FS","Tonyu.Project","Shell","KeyEventChecker","ScriptTagFS","runtime","WebSite"],function(n,t,e,i,s,r,a){$(function(){function i(){o=$(window).width(),u=$(window).height(),_.attr({width:o,height:u})}var r=n.get(a.tonyuHome);Tonyu.defaultResource={images:[{name:"$pat_base",url:"images/base.png",pwidth:32,pheight:32},{name:"$pat_sample",url:"images/Sample.png"},{name:"$pat_neko",url:"images/neko.png",pwidth:32,pheight:32}],sounds:[]},SplashScreen={hide:function(){$("#splash").hide()},show:function(){}};var o=$(window).width(),u=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var _=$("<canvas>").attr({width:o,height:u}).appendTo("body");$(window).resize(i);var h=location.href.replace(/\?.*/,"").split(/\//),c=h.pop();c.length<0&&(h="runscript");var l=r.rel(c+"/"),f=s.toObj();for(var S in f){var T=l.rel(S);if(!T.isDir()){T.useRAMDisk();var y=f[S];T.text(y.text),delete y.text,y.lastUpdate&&T.metaInfo(y)}}e.cd(l);var p="Main",d=$("script");d.each(function(){var n=this;if("text/tonyu"==n.type){var t=$(n).data("filename");if(t){var e=l.rel(t);$(n).data("main")&&(p=e.truncExt(".tonyu"))}}}),Tonyu.defaultOptions={compiler:{defaultSuperClass:"Actor"},run:{mainClass:p,bootClass:"Boot"},kernelEditable:!1};var m=r.rel("Kernel/"),O=t(l,m);Tonyu.currentProject=Tonyu.globals.$currentProject=O;var g=O.getOptions();g.compiler&&g.compiler.diagnose&&(g.compiler.diagnose=!1,O.setOptions(g)),O.runScriptMode=!0,O.rawRun(g.run.bootClass)})}),requireSimulator.setName();