!function(){var n={};return n.def=function(e,t,r){var i=n.getModuleInfo(n.curName);i.type=r,n.setReqs(i,e),i.func=function(){return t.apply(this,n.getObjs(e))},n.loadIfAvailable(i)},define=function(e,t){n.def(e,t,"define")},require=requirejs=function(e,t){n.def(e,t,"require")},n.setReqs=function(e,t){t.forEach(function(t){var r=n.getModuleInfo(t);r.loaded||(e.reqs[t]=r,r.revReqs[e.name]=e)})},n.getModuleInfo=function(e){var t=n.modules;return t[e]||(t[e]={name:e,reqs:{},revReqs:{}}),t[e]},n.doLoad=function(e){var t=n.getModuleInfo(e);if(t.loaded)return t.obj;t.loaded=!0;var r=null;if(t.func)r=t.func();else{var i=e.split(/\./);r=function(){return this}(),i.forEach(function(n){r&&(r=r[n])}),null==r&&console.log("Warning: No obj for "+e)}if("define"==t.type&&null==r)throw"No obj for "+e;t.obj=r;for(var a in t.revReqs)n.notifyLoaded(t.revReqs[a],t.name);return r},n.notifyLoaded=function(e,t){delete e.reqs[t],n.loadIfAvailable(e)},n.loadIfAvailable=function(e){for(var t in e.reqs)return;n.doLoad(e.name)},n.getObjs=function(e){var t=[];return e.forEach(function(e){var r=n.doLoad(e);t.push(r)}),t},n.modules={},n.setName=function(e){n.curName&&(n.getModuleInfo(n.curName).func||n.doLoad(n.curName)),e&&(n.curName=e)},requireSimulator=n,n}(),requireSimulator.setName("WebSite"),define([],function(){var n=document.location.href,e=!!n.match(/html\/dev\//)&&!!n.match(/localhost:3/);window.WebSite=n.match(/jsrun\.it/)?{urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:e,pluginTop:"http://tonyuedit.appspot.com/js/plugins",removeJSOutput:!0}:n.match(/tonyuexe\.appspot\.com/)||n.match(/localhost:8887/)||n.match(/\/html\/((dev)|(build))\//)?{urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:e}:{urlAliases:{},top:"../..",devMode:e};var t=window.navigator.userAgent.toLowerCase();return window.WebSite.tablet=-1!=t.indexOf("windows")&&-1!=t.indexOf("touch")||-1!=t.indexOf("ipad")||-1!=t.indexOf("android")&&-1==t.indexOf("mobile")||-1!=t.indexOf("firefox")&&-1!=t.indexOf("tablet")||-1!=t.indexOf("kindle")||-1!=t.indexOf("silk")||-1!=t.indexOf("playbook"),window.WebSite.mobile=-1!=t.indexOf("windows")&&-1!=t.indexOf("phone")||-1!=t.indexOf("iphone")||-1!=t.indexOf("ipod")||-1!=t.indexOf("android")&&-1!=t.indexOf("mobile")||-1!=t.indexOf("firefox")&&-1!=t.indexOf("mobile")||-1!=t.indexOf("blackberry"),window.WebSite.pluginTop||(window.WebSite.pluginTop=window.WebSite.top+"/js/plugins"),window.WebSite.disableROM={},n.match(/tonyuedit\.appspot\.com/)||n.match(/localhost:8888/),(n.match(/\.appspot\.com/)||n.match(/localhost:888[87]/))&&(window.WebSite.serverType="GAE"),n.match(/localhost:3000/)&&(window.WebSite.serverType="Node"),window.WebSite.serverTop=n.match(/tonyuexe\.appspot\.com/)||n.match(/localhost:8887/)?window.WebSite.top+"/exe":window.WebSite.top+"/edit",window.WebSite.sampleImg=window.WebSite.top+"/images",window.WebSite.blobPath=window.WebSite.serverTop+"/serveBlob",window.WebSite.isNW="object"==typeof process&&process.__node_webkit,window.WebSite.tonyuHome="/Tonyu/",window.WebSite.url={getDirInfo:WebSite.serverTop+"/getDirInfo",getFiles:WebSite.serverTop+"/File2LSSync",putFiles:WebSite.serverTop+"/LS2FileSync"},window.WebSite.isNW&&(window.WebSite.tonyuHome=process.env.TONYU_HOME?process.env.TONYU_HOME.replace(/\\/g,"/"):process.cwd().replace(/\\/g,"/").replace(/\/$/,"")+"/fs/Tonyu/",window.WebSite.logdir="/var/log/Tonyu/"),window.WebSite}),requireSimulator.setName("assert"),define([],function(){function n(e){if(e instanceof Array){var t=[];return e.forEach(function(e){t=t.concat(n(e))}),t}return[e]}var e=function(e){this.failMesg=n(e||"Assertion failed: ")};e.prototype={fail:function(){var e=$a(arguments);throw e=n(e),e=this.failMesg.concat(e),console.log.apply(console,e),new Error(e.join(" "))},subAssertion:function(){var t=$a(arguments);return t=n(t),new e(this.failMesg.concat(t))},assert:function(n,e){return n||this.fail(e),n},eq:function(n,e){return n!==e&&this.fail(n,"!==",e),n},is:function(n,e){var t=e,r=n;if(null==t)return t;if(t._assert_func)return t._assert_func.apply(this,[r]),n;if(this.assert(null!=n,[n,"should be ",t]),t instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&t instanceof global.Array){n&&"number"==typeof n.length||this.fail(n,"should be array:");for(var i=this,a=0;a<t.length;a++){var s=i.subAssertion("failed at ",n,"[",a,"]: ");s.is(r[a],t[a])}return n}if(t===String||"string"==t)return this.assert("string"==typeof r,[r,"should be a string "]),n;if(t===Number||"number"==t)return this.assert("number"==typeof r,[r,"should be a number"]),n;if(t instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&t instanceof global.RegExp)return this.is(r,String),this.assert(t.exec(r),[r,"does not match to",t]),n;if("function"==typeof t)return this.assert(r instanceof t,[r,"should be ",t]),n;if(t&&"object"==typeof t){for(var o in t){var s=this.subAssertion("failed at ",n,".",o,":");s.is(n[o],t[o])}return n}this.fail("Invaild type: ",t)},ensureError:function(n,e){try{n()}catch(t){return"string"==typeof e&&r(t+""===e,n+" thrown an error "+t+" but expected:"+e),void console.log("Error thrown successfully: ",t.message)}this.fail(n,"should throw an error",e)}},$a=function(n){for(var e=[],t=0;t<n.length;t++)e.push(n[t]);return e};var t=new e,r=function(){try{return t.assert.apply(t,arguments)}catch(n){throw new Error(n.message)}};return r.is=function(){try{return t.is.apply(t,arguments)}catch(n){throw new Error(n.message)}},r.eq=function(){try{return t.eq.apply(t,arguments)}catch(n){throw new Error(n.message)}},r.ensureError=function(){try{return t.ensureError.apply(t,arguments)}catch(n){throw new Error(n.message)}},r.fail=t.fail.bind(t),r.f=function(n){return{_assert_func:n}},r.and=function(){var n=$a(arguments);return r(n instanceof Array),r.f(function(e){for(var t=this,r=0;r<n.length;r++)t.is(e,n[r])})},r}),requireSimulator.setName("PathUtil"),define(["assert"],function(n){function e(e,t){return n.is(arguments,[String,String]),e.substring(e.length-t.length)===t}function t(n,e){return n.substring(0,e.length)===e}var r,i=/^([a-zA-Z]):/,a=n.f(function(n){this.is(n,String),this.assert(r.isPath(n),[n," is not a path"])}),s=n.f(function(n){this.is(n,String),this.assert(r.isAbsolutePath(n),[n," is not a absolute path"])}),o=n.f(function(n){this.is(n,String),this.assert(!r.isAbsolutePath(n),[n," is not a relative path"])}),l=n.and(h,s),h=n.f(function(n){this.is(n,a),this.assert(r.isDir(n),[n," is not a directory path"])}),u=n.f(function(n){this.is(n,a),this.assert(!r.isDir(n),[n," is not a file path"])}),c="/";return r={Path:a,Absolute:s,Relative:o,Dir:h,File:u,AbsDir:l,SEP:c,endsWith:e,startsWith:t,hasDriveLetter:function(n){return i.exec(n)},isPath:function(e){return n.is(arguments,[String]),!e.match(/\/\//)},isRelativePath:function(e){return n.is(arguments,[String]),r.isPath(e)&&!r.isAbsolutePath(e)},isAbsolutePath:function(e){return n.is(arguments,[String]),r.isPath(e)&&(r.startsWith(e,c)||r.hasDriveLetter(e))},isDir:function(t){return n.is(arguments,[a]),e(t,c)},splitPath:function(e){n.is(arguments,[a]);var t=e.split(c);return""==t[t.length-1]&&(t[t.length-2]+=c,t.pop()),t},name:function(e){return n.is(arguments,[String]),r.splitPath(e).pop()},ext:function(e){n.is(arguments,[String]);var t=r.name(e),i=/\.[a-zA-Z0-9]+$/.exec(t);return i?i[0]:null},truncExt:function(e,t){n.is(e,String);var i=r.name(e);return t=t||r.ext(e),n.is(t,String),i.substring(0,i.length-t.length)},truncSEP:function(e){return n.is(arguments,[a]),r.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(t,i){return n.is(arguments,[String,String]),e(r.name(t),i)},parent:function(e){return n.is(arguments,[String]),r.up(e)},rel:function(e,t){n.is(arguments,[l,o]);var i=r.splitPath(t),a=e;a=a.replace(/\/$/,"");var s=r;return i.forEach(function(n){".."==n||"../"==n?a=s.up(a):(a=a.replace(/\/$/,""),a+=c+("."==n||"./"==n?"":n))}),a},relPath:function(e,t){return n.is(arguments,[l,l]),e.substring(0,t.length)!=t?"../"+r.relPath(e,this.up(t)):e.substring(t.length)},up:function(e){if(n.is(arguments,[a]),e==c)return null;var t=r.splitPath(e);return t.pop(),t.join(c)+c}}}),requireSimulator.setName("Env"),define(["assert","PathUtil"],function(n,e){var t=function(n){this.value=n};return t.prototype={expand:function(e){n.is(e,String);var t=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(n,e){return t.get(e)})},expandPath:function(t){return n.is(t,String),t=this.expand(t),t=t.replace(/\/+/g,"/"),n.is(t,e.Path)},get:function(n){return this.value[n]},set:function(n,e){this.value[n]=e}},t}),requireSimulator.setName("SFileNW"),define(["WebSite","Env"],function(n,e){function t(n){this._path=l(n)}function r(n,e){for(var t in e)n[t]=e[t]}function i(n,e){return n.substring(n.length-e.length)===e}function a(n,e){return n.substring(0,e.length)===e}function s(n){return!S&&a(n,_)||S&&n.match(T)}function o(n){return i(n,_)?n.substring(0,n.length-1):n}function l(n,e){if(e=e||process.cwd(),e=e.replace(/\\/g,_),n=n.replace(/\\/g,_),S&&a(n,_)){var t=e,r=T.exec(t);if(!r)throw new Error(e+" : should have drive letter");n=r[0]+n}else s(n)||(n=o(e)+_+n);var l=n.split(_),h=[];l.forEach(function(n){return""!=n&&"."!=n?".."==n?void h.pop():void h.push(n):void 0});var u=h.join(_);if(S||(u=_+u),!s(u))throw new Error(u+": is not absolute. hasDriverLetter="+S);return u=o(u),i(n,_)&&(u+=_),u}var h={};if(!n.isNW)return{};var u=require("fs"),c=new e(n),_="/",d=JSON,T=/^([a-zA-Z]):/,S=T.exec(process.cwd()),p={".png":"image/png",".jpg":"image/jpg",".gif":"image/gif",".jpeg":"image/jpg",".mp3":"audio/mp3",".ogg":"audio/ogg"};h.resolve=function(n,e){return n=c.expandPath(n),h.get(l(n,e))},h.expandPath=function(){return c.expandPath.apply(c,arguments)},r(t.prototype,{isSFile:function(){return!0},text:function(){if(0==arguments.length)return this.isDir()?d.stringify(this.metaInfo()):this.isBinary()?this.readDataURLFromBin():u.readFileSync(this.path(),{encoding:"utf8"});var n=this.up();n&&n.mkdir(),this.isBinary()?this.writeBinFromDataURL(arguments[0]):u.writeFileSync(this.path(),arguments[0])},lines:function(){return this.text().split("\n")},readDataURLFromBin:function(){var n=this.dataHeader();if(b=u.readFileSync(this.path()),b[0]==n.charCodeAt(0)&&b[1]==n.charCodeAt(1)&&b[2]==n.charCodeAt(2)&&b[3]==n.charCodeAt(3)&&b[4]==n.charCodeAt(4))return b.toString("utf8");var e=b.toString("base64");return n+e},writeBinFromDataURL:function(n){var e=this.dataHeader(),t=n.substring(e.length),r=new Buffer(t,"base64"),i=u.createWriteStream(this.path());i.write(r),i.end()},isBinary:function(){return p[this.ext()]},dataHeader:function(){var n=this.isBinary();return"data:"+n+";base64,"},obj:function(){return 0==arguments.length?d.parse(this.text()):void this.text(d.stringify(arguments[0]))},isReadOnly:function(){return!1},rm:function(){return this.isDir()?u.rmdirSync(this.path()):u.unlinkSync(this.path())},path:function(){return this._path},pathTS:function(){return o(this.path())},name:function(){var n=this.pathTS(),e="";return i(this.path(),_)&&(e=_),n.split(_).pop()+e},ext:function(){var n=this.name(),e=/\.[a-zA-Z0-9]+$/.exec(n);return e?e[0]:null},truncExt:function(n){var e=this.name();return e.substring(0,e.length-n.length)},endsWith:function(n){return i(this.name(),n)},exists:function(){return u.existsSync(this.path())},each:function(n,e){if(e||(e={}),!this.isDir())throw new Error(this+" cannot each. not a dir.");if(this.exists()){var t=this.pathTS(),r=u.readdirSync(this.path()),i=this;r.forEach(function(r){if(".dirinfo"!=r||e.includeDirInfo){var a=u.statSync(t+_+r),s=a.isDirectory()?_:"",o=i.rel(r+s);n(o)}})}},ls:function(){var n=[];return this.each(function(e){n.push(e.name())}),n},parent:function(){return this.up()},recursive:function(n){this.each(function(e){e.isDir()?e.recursive(n):n(e)})},toString:function(){return this.path()},rel:function(n){return new t(this.pathTS()+_+n)},mkdir:function(){if(this.exists()){if(this.isDir())return;throw new Error(this+" is a file. not a dir.")}var n=this.up();n&&n.mkdir(),u.mkdirSync(this.path())},relPath:function(n){var e=n.path?n.path():n;if(e.substring(e.length-1)!=_)throw new Error(e+" is not a directory.");return this.path().substring(0,e.length)!=e?"../"+this.relPath(n.up()):this.path().substring(e.length)},equals:function(n){return n instanceof t&&n.path()==this.path()},lastModified:function(){return this.stat().mtime.getTime()},lastUpdate:function(){return this.lastModified()},up:function(){var n=this.pathTS(),e=n.split(_);return e.pop(),n=e.join(_),""==n?null:new t(n+_)},copyFrom:function(n,e){this.isDir()||(this.text(n.text()),e.a&&file.metaInfo(n.metaInfo()))},isDir:function(){return this.exists()?this.stat().isDirectory():i(this.path(),_)},stat:function(){return u.statSync(this.path())},metaInfo:function(){if(this.isDir()){var n={};return this.each(function(e){n[e.name()]=e.metaInfo()}),n}return{lastUpdate:this.lastUpdate()}}}),h.get=function(n){if(null==n)throw new Error("FS.get: null path");return n instanceof t?n:new t(n)};var f="DONOTEXPORT";return h.exportDir=function(n,e){function t(r){var a=r.relPath(n);if(i[a]=r.text(),e.keepCR||(i[a]=i[a].replace(/\r/g,"")),r.isDir()){if(r.rel(f).exists())return;r.each(t)}}e||(e={}),"string"==typeof n&&(n=h.get(n));var r={base:n.path()},i=r.data={};return t(n),r},h}),requireSimulator.setName("extend"),define([],function(){return function(n,e){for(var t in e)n[t]=e[t]}}),requireSimulator.setName("DataURL"),define(["extend","assert"],function(n,e){function t(n){return n instanceof ArrayBuffer||"undefined"!=typeof Buffer&&n instanceof Buffer}function r(n){function e(e){throw console.log(e),console.log(n,u),new Error(e)}n=n.replace(/[\n=]/g,"");var t=new Object;t[65]=0,t[66]=1,t[67]=2,t[68]=3,t[69]=4,t[70]=5,t[71]=6,t[72]=7,t[73]=8,t[74]=9,t[75]=10,t[76]=11,t[77]=12,t[78]=13,t[79]=14,t[80]=15,t[81]=16,t[82]=17,t[83]=18,t[84]=19,t[85]=20,t[86]=21,t[87]=22,t[88]=23,t[89]=24,t[90]=25,t[97]=26,t[98]=27,t[99]=28,t[100]=29,t[101]=30,t[102]=31,t[103]=32,t[104]=33,t[105]=34,t[106]=35,t[107]=36,t[108]=37,t[109]=38,t[110]=39,t[111]=40,t[112]=41,t[113]=42,t[114]=43,t[115]=44,t[116]=45,t[117]=46,t[118]=47,t[119]=48,t[120]=49,t[121]=50,t[122]=51,t[48]=52,t[49]=53,t[50]=54,t[51]=55,t[52]=56,t[53]=57,t[54]=58,t[55]=59,t[56]=60,t[57]=61,t[43]=62,t[47]=63;var r,i=n.length,s=0,o=0;if(!i)return new a(0);r=Math.floor(i/4*3),"="==n.charAt(i-1)&&(r-=1),"="==n.charAt(i-2)&&(r-=1);for(var l=new a(r),h="undefined"!=typeof Buffer?l:new Uint8Array(l),u=0,c=0;r>c&&(o=t[n.charCodeAt(u)],void 0===o&&e("Invalid letter: "+n.charCodeAt(u)),s=o<<2,u++,o=t[n.charCodeAt(u)],void 0===o&&e("Invalid letter: "+n.charCodeAt(u)),h[c]=s|o>>4&3,s=(15&o)<<4,u++,c++,!(c>=r))&&(o=t[n.charCodeAt(u)],void 0===o&&e("Invalid letter: "+n.charCodeAt(u)),h[c]=s|o>>2&15,s=(3&o)<<6,u++,c++,!(c>=r));)o=t[n.charCodeAt(u)],void 0===o&&e("Invalid letter: "+n.charCodeAt(u)),h[c]=s|o,u++,c++;return l}function i(n){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],t="",r=new Uint8Array(n),i=r.length,a=0,s=0,o=0;i>o&&(s=r[o],t+=e[s>>2],a=(3&s)<<4,o++,!(o>=i))&&(s=r[o],t+=e[a|s>>4],a=(15&s)<<2,o++,!(o>=i));)s=r[o],t+=e[a|s>>6],t+=e[63&s],o++;var l=i%3;return l&&(t+=e[a]),1==l?t+="==":2==l&&(t+="="),t}var a="undefined"!=typeof Buffer?Buffer:ArrayBuffer,s=function(n,r){"string"==typeof n?(this.url=n,this.dataURL2bin(n)):n&&t(n.buffer)?(this.buffer=n.buffer,e.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):t(n)?(this.buffer=n,e.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):e.fail("Invalid args: ",arguments)};return n(s.prototype,{bin2dataURL:function(n,r){e(t(n)),e.is(r,String);var a=this.dataHeader(r),s=i(n);return e.is(s,String),this.url=a+s},dataURL2bin:function(n){e.is(arguments,[String]);var t=/data:([^;]+);base64,(.*)$/i,i=t.exec(n);return e(i,["malformed dataURL:",n]),this.contentType=i[1],this.buffer=r(i[2]),e.is(this.buffer,a)},dataHeader:function(n){return e.is(arguments,[String]),"data:"+n+";base64,"},toString:function(){return e.is(this.url,String)}}),s}),requireSimulator.setName("Contents"),define(["DataURL"],function(n){var e={convert:function(e,t){var r;if("string"==typeof e&&(r=String),e instanceof n&&(r=n),e instanceof ArrayBuffer&&(r=ArrayBuffer),r==t)return e;throw new Error("Cannot convert from "+r+" to "+t)}};return e}),requireSimulator.setName("SFile"),define(["Contents","extend","assert","PathUtil"],function(n,e,t,r){var i=function(n,e){t.is(e,r.Absolute),t(n&&n.getReturnTypes),this._path=e,this.fs=n,this.isDir()&&!r.isDir(e)&&(this._path+=r.SEP)};return i.is=function(n){return n&&"function"==typeof n.isSFile&&n.isSFile()},i.prototype={isSFile:function(){return!0},_clone:function(){return this.fs.getRootFS().get(this.path())},_resolve:function(n){var e;return i.is(n)?e=n:(t.is(n,r.Absolute),e=this.fs.getRootFS().get(n)),this.wrapper?this.wrapper.wrap(e):e},contains:function(n){return t(i.is(n),n+" shoud be a SFile object."),this.isDir()?r.startsWith(n.path(),this.path()):!1},path:function(){return this._path},name:function(){return r.name(this.path())},truncExt:function(n){return r.truncExt(this.path(),n)},ext:function(){return r.ext(this.path())},relPath:function(n){var e=n.path?n.path():n;return r.relPath(this.path(),t.is(e,r.Absolute))},up:function(){var n=this.path(),e=r.up(n);return null==e?null:this._resolve(e)},rel:function(n){t.is(n,r.Relative),this.assertDir();var e=this.path();return this._resolve(r.rel(e,n))},startsWith:function(n){return r.startsWith(this.name(),n)},endsWith:function(n){return r.endsWith(this.name(),n)},equals:function(n){return n&&"function"==typeof n.path&&n.path()==this.path()},toString:function(){return this.path()},touch:function(){this.fs.touch(this.path())},isReadOnly:function(){this.fs.isReadOnly(this.path())},isTrashed:function(){var n=this.metaInfo();return n?n.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(n){return this.fs.getMetaInfo(this.path(),n)},setMetaInfo:function(n,e){return this.fs.setMetaInfo(this.path(),n,e)},lastUpdate:function(){return t(this.exists()),this.metaInfo().lastUpdate},exists:function(n){n=n||{};var e=this.fs.exists(this.path(),n);return e||n.noFollowLink?e:this.resolveLink().exists({noFollowLink:!0})},rm:function(n){if(n=n||{},!this.exists({noFollowLink:!0})){var e=this.resolveLink();if(!this.equals(e))return e.rm(n)}this.isDir()&&(n.recursive||n.r)&&this.each(function(e){e.rm(n)});var t=this.path();this.fs.rm(t,n)},removeWithoutTrash:function(n){n=n||{},n.noTrash=!0,this.rm(n)},isDir:function(){return this.fs.isDir(this.path())},text:function(){var n=this.resolveLink();return this.equals(n)?arguments.length>0?void this.setText(arguments[0]):this.getText():n.text.apply(n,arguments)},setText:function(n){t.is(n,String),this.fs.setContent(this.path(),n)},getText:function(){return this.fs.getContent(this.path(),{type:String})},lines:function(){return this.text().split("\n")},obj:function(){var n=this;if(0==arguments.length){var e=n.text();return e?JSON.parse(e):null}n.text(JSON.stringify(t.is(arguments[0],Object)))},copyFrom:function(n,e){var r=this,e=e||{},i=n.isDir(),a=r.isDir();if(!i&&a&&(r=r.rel(n.name()),assert(!r.isDir(),r+" exists as an directory."),a=!1),i&&!a)this.err("Cannot move dir to file");else{if(!i&&!a){var s=n.getText(),o=r.setText(s);return e.a&&r.setMetaInfo(n.getMetaInfo()),o}t(i&&a);n.each(function(n){r.rel(n.name()).copyFrom(n,e)})}},moveFrom:function(n,e){var t=this.copyFrom(n,e);return n.rm({recursive:!0}),t},assertDir:function(){return t.is(this.path(),r.Dir),this},each:function(n,e){var t=this.assertDir();t.listFiles(e).forEach(n)},recursive:function(n,e){var t=this.assertDir();t.each(function(e){e.isDir()?e.recursive(n):n(e)},e)},listFiles:function(n){t(null==n||"object"==typeof n);var e=this.assertDir(),r=this.resolveLink();if(!this.equals(r))return r.listFiles.apply(r,arguments);var i,a=this.path();"function"==typeof n&&(i=n),n=e.convertOptions(n),i||(i=n.order);for(var s=this.fs.opendir(a,n),o=[],l=0;l<s.length;l++){var h=s[l];n.excludes[a+h]||o.push(e.rel(h))}return"function"==typeof i&&o.sort&&o.sort(i),o},ls:function(n){t(null==n||"object"==typeof n);var e=this.assertDir(),r=e.listFiles(n);return r.map(function(n){return n.name()})},convertOptions:function(n){var e=(this.assertDir(),this.path());if(n||(n={}),n.excludes||(n.excludes={}),n.excludes instanceof Array){var i={};n.excludes.forEach(function(n){r.startsWith(n,"/")?i[n]=1:i[e+n]=1}),n.excludes=i}return t.is(n,{excludes:{}})},mkdir:function(){this.touch()},link:function(n,e){n=this._resolve(t(n)),this.fs.link(this.path(),n.path(),e)},resolveLink:function(){var n=this.fs.resolveLink(this.path());return t.is(n,r.Absolute),this._resolve(n)},isLink:function(){return this.fs.isLink(this.path())}},i}),requireSimulator.setName("FS"),define(["WebSite","SFileNW","Env","PathUtil","assert","SFile"],function(n,e,t,r,i,a){function s(n,e){if(e)for(var t in e)n[t]=e[t]}function o(n,e){return n.substring(n.length-e.length)===e}function l(n,e){return n.substring(0,e.length)===e}function h(){return(new Date).getTime()}function u(n){var e=n.split(E);return""==e[e.length-1]&&(e[e.length-2]+=E,e.pop()),e}function c(n){for(var e in j){var t=n.substring(0,e.length),r=n.substring(e.length);if(t==e)return{rom:j[e],rel:r}}return null}function _(n){return p(n)?w:localStorage}function d(n,e){var t=_(n),r=c(n);if(2!=arguments.length)return r?r.rom[r.rel]:t[n];if(r)throw new Error(n+" is Read only.");return null!=e?t[n]=e:void delete t[n]}function T(n){var e=_(n),t=c(n);return t?t.rel in t.rom:n in e}function S(n,e,t,r){if(null==n)throw new Error("putDir: Null path");if(!v(n))throw new Error("Not a directory : "+n);r==b?w[n]=e:d(n,JSON.stringify(e));var i=$(n);if(null!=i){var a=f(i,r);y(a,i,P(n),t,r)}}function p(n){return"ALL"==M?!0:"object"==typeof M&&M?n in M:!1}function f(n,e){if(null==n)throw new Error("getDir: Null path");o(n,E)||(n+=E);var t={},r={};if(e&b&&(r=w[n]||{}),e&k)try{var i=d(n);i&&(t=JSON.parse(i))}catch(a){console.log("dinfo err : "+n+" - "+t)}s(t,r),s(t,B[n]);for(var l in t)"number"==typeof t[l]&&(t[l]={lastUpdate:t[l]});return t}function y(n,e,t,r,i){n[t]||(n[t]={},r&&(n[t].trashed=!0)),r||delete n[t].trashed,n[t].lastUpdate=h(),S(e,n,r,i)}function m(n,e,t,r){n[t]&&(n[t]={lastUpdate:h(),trashed:!0},S(e,n,!0,r))}function A(n,e,t,r){n[t]&&(delete n[t],S(e,n,!0,r))}function $(n){if(n==E)return null;var e=u(n);return e[e.length-1]="",e.join(E)}function g(n){return l(n,E)}function v(n){return o(n,E)}function P(n){var e=u(n);return e[e.length-1]}if(e&&e.get)return"object"==typeof window&&(window.FS=e),e;var O=new t(n),b=1,k=2,L=3,w={},M=null;("undefined"==typeof localStorage||null==localStorage)&&(console.log("FS: Using RAMDisk"),M="ALL");var x={};"object"==typeof window&&(window.FS=x),x.ramDisk=w,x.ramDiskUsage=M;var j={},B={},E="/";x.roms=j,x.romParents=B,x.endsWith=o,x.splitPath=u,x.orderByNewest=function(n,e){if(!(n&&e&&n.lastUpdate&&e.lastUpdate))return 0;var t=n.lastUpdate(),r=e.lastUpdate();return r>t?1:t>r?-1:0},x.orderByName=function(n,e){return n.name&&e.name&&(n=n.name(),e=e.name()),n>e?1:e>n?-1:0},x.orderByNumberedName=function(n,e){function t(n){for(var e=[],t=/^[0-9]*/,r=/^[^0-9]*/;n&&(n.match(r),e.push(RegExp.lastMatch),n=n.replace(r,""));){n.match(t);var i=parseInt(RegExp.lastMatch);e.push(i),n=n.replace(t,"")}return e}n.name&&e.name&&(n=n.name(),e=e.name());var r,i=t(n),a=t(e);for(r=0;r<i.length;r++){if(r>=a.length)return 1;if(i[r]>a[r])return 1;if(i[r]<a[r])return-1}return r<a.length?-1:0},x.importDir=function(n){var e=x.get(n.base);n.confirm||e.mkdir();var t=n.data,r=[];for(var i in t){var a=e.path()+i,s=x.get(a);if(r.push("["+(s.isReadOnly()?"ro":s.exists()?"exists":"new")+"]"+a),!s.isReadOnly()&&!n.confirm)if(s.isDir()){var o=f(a,k),l=JSON.parse(t[i]);for(var h in l)o[h]=l[h];S(a,o,!1,k)}else d(a,t[i])}return r},x.mountROM=function(n){console.log("ROM mouted on ",n.base),j[n.base]=n.data;var e=u(n.base),t=e.pop(),r=e.join(E)+E;B[r]||(B[r]={}),B[r][t]={lastUpdate:(new Date).getTime()}};var D="DONOTEXPORT";return x.exportDir=function(n,e){function t(r){var a=r.relPath(n);if(i[a]=r.text(),e.keepCR||(i[a]=i[a].replace(/\r/g,"")),r.isDir()){if(r.rel(D).exists())return;r.each(t)}}e||(e={}),"string"==typeof n&&(n=x.get(n));var r={base:n.path()},i=r.data={};return t(n),r},x.expandPath=function(){return O.expandPath.apply(O,arguments)},x.resolve=function(n,e){return a.is(n)?n:(n=O.expandPath(n),e&&!r.isAbsolutePath(n)?(e=O.expandPath(e),x.get(e).rel(n)):x.get(n))},x.get=function(n,e){if(e||(e={}),null==n)throw new Error("FS.get: Null path");if(n.isDir)return n;if(e.topDir&&!l(n,e.topDir))throw new Error(n+" is out of securtyDomain");if(!g(n))throw new Error(n+": Path must starts with '/'");var t,r=$(n),i=P(n);if(v(n)){var a=t={};a.files=function(n,e){var t=[];return a.each(function(n){t.add(n)},e),t},a.each=function(n,e){a.ls(e).forEach(function(e){var t=a.rel(e);n(t)})},a.recursive=function(n,e){a.each(function(e){e.isDir()?e.recursive(n):n(e)},e)},a.listFiles=function(e){var t;"function"==typeof e&&(t=e),e=a.convertOptions(e),t||(t=e.order);var r=f(n,L),i=[];for(var s in r)(e.includeTrashed||!r[s].trashed)&&(e.excludes[n+s]||i.push(a.rel(s)));return"function"==typeof t&&i.sort&&i.sort(t),i},a.ls=function(n){var e=a.listFiles(n),t=[];return e.forEach(function(n){t.push(n.name())}),t},a.convertOptions=function(e){if(e||(e={}),e.excludes||(e.excludes={}),e.excludes instanceof Array){var t={};e.excludes.forEach(function(e){l(e,"/")?t[e]=1:t[n+e]=1}),e.excludes=t}return e},a.isDir=function(){return!0},a.rel=function(n){var t=u(n),r=a.path();return r=r.replace(/\/$/,""),t.forEach(function(n){".."==n||"../"==n?r=$(r):(r=r.replace(/\/$/,""),r+=E+("."==n||"./"==n?"":n))}),x.get(r,e)},a.rm=function(){if(!a.exists())throw new Error(n+": No such dir.");var e=a.ls();if(e.length>0)throw new Error(n+": Directory not empty");if(null!=r){var t=a.mediaType(),s=f(r,t);m(s,r,i,t)}},a.removeWithoutTrash=function(){var e=a.mediaType();if(a.each(function(n){n.removeWithoutTrash()},{includeTrashed:!0}),d(n,null),null!=r){var t=f(r,e);A(t,r,i,e)}},a.mkdir=function(){a.touch()},a.text=function(){return d(n)},a.obj=function(){return JSON.parse(a.text())},a.exists=function(){if("/"==n)return!0;var e=f(r,L);return e&&e[i]&&!e[i].trashed},a.mediaType=function(){return w[n]&&!localStorage[n]?b:k}}else{var s=t={};s.isDir=function(){return!1},s.rm=function(){if(!s.exists())throw new Error(n+": No such file.");if(d(n,null),null!=r){var e=s.mediaType(),t=f(r,e);m(t,r,i,e)}},s.removeWithoutTrash=function(){if(!s.exists()&&!s.isTrashed())throw new Error(n+": No such file.");if(d(n,null),null!=r){var e=s.mediaType(),t=f(r,e);A(t,r,i,e)}},s.text=function(){return 0==arguments.length?d(n):(d(n,arguments[0]),void s.touch())},s.lines=function(){return s.text().split("\n")},s.obj=function(){if(0==arguments.length){var n=s.text();return n?JSON.parse(n):null}s.text(JSON.stringify(arguments[0]))},s.copyFrom=function(n,e){s.text(n.text()),e.a&&s.metaInfo(n.metaInfo())},s.exists=function(){return T(n)},s.useRAMDisk=function(){return"ALL"==M?s:(M=M||{},M[n]=!0,s)},s.mediaType=function(){return p(n)?b:k}}return t.relPath=function(e){var r=e.path?e.path():e;if(r.substring(r.length-1)!=E)throw new Error(r+" is not a directory.");return n.substring(0,r.length)!=r?"../"+t.relPath(e.up()):n.substring(r.length)},t.isTrashed=function(){var n=t.metaInfo();return n?n.trashed:!1},t.metaInfo=function(){if(null!=r){var n;if(0==arguments.length)return n=f(r,L),n[i];var e=t.mediaType();n=f(r,e),n[i]=arguments[0],S(r,n,n[i].trashed,e)}return{}},t.lastUpdate=function(){return t.metaInfo().lastUpdate},t.up=function(){return null==r?null:x.get(r,e)},t.path=function(){return n},t.name=function(){return i},t.truncExt=function(n){return i.substring(0,i.length-n.length)},t.touch=function(){if(null!=r){var n=t.mediaType(),e=f(r,n);y(e,r,i,!1,n)}},t.isReadOnly=function(){var e=c(n);return!!e},t.startsWith=function(n){return l(i,n)},t.endsWith=function(n){return o(i,n)},t.equals=function(e){return e&&"function"==typeof e.path&&e.path()==n},t.toString=function(){return n},t.isSFile=function(){return!0},t},x.scan=function(){for(var n in localStorage)if(g(n)){var e=$(n);if(null!=e){var t=f(e,k),r=P(n);y(t,e,r,t[r]&&t[r].trashed,k)}}},x.dump=function(){for(var n in localStorage)console.log(n)},x.ls=function(n){return x.get(n).ls()},x}),requireSimulator.setName("fs/ROMk"),function(){var n={base:"/Tonyu/Kernel/",data:{"":'{".desktop":{"lastUpdate":1424849946377},"Actor.tonyu":{"lastUpdate":1434071249242},"BaseActor.tonyu":{"lastUpdate":1438472078845},"Boot.tonyu":{"lastUpdate":1433999039438},"event/":{"CrashToHandler.tonyu":{"lastUpdate":1434522849000},"EventHandler.tonyu":{"lastUpdate":1435635604374},"EventHandlerCaller.tonyu":{"lastUpdate":1437027652881},"EventMod.tonyu":{"lastUpdate":1433997727418},"ScreenOutHandler.tonyu":{"lastUpdate":1433996873036},"WithinHandler.tonyu":{"lastUpdate":1434522887000}},"graphics/":{"GameScreen.tonyu":{"lastUpdate":1430361716021},"Map.tonyu":{"lastUpdate":1421122943495},"OneframeSpriteMod.tonyu":{"lastUpdate":1430110560296},"Panel.tonyu":{"lastUpdate":1433924256000},"ScaledCanvas.tonyu":{"lastUpdate":1438753481229},"Sprites.tonyu":{"lastUpdate":1444289413715},"TextRectMod.tonyu":{"lastUpdate":1427702468448}},"js/":{"concat.js":{"lastUpdate":1444289618548},"index.html":{"lastUpdate":1430107873565}},"MathMod.tonyu":{"lastUpdate":1424849946395},"NoviceActor.tonyu":{"lastUpdate":1412697666000},"options.json":{"lastUpdate":1428228309742},"physics/":{"BodyActor.tonyu":{"lastUpdate":1437628346060},"T2Body.tonyu":{"lastUpdate":1425264703379},"T2Mod.tonyu":{"lastUpdate":1431610155789},"T2World.tonyu":{"lastUpdate":1431611371521}},"sound/":{"MediaPlayer.tonyu":{"lastUpdate":1421384204625},"MML.tonyu":{"lastUpdate":1424849946399},"PlayMod.tonyu":{"lastUpdate":1425018365373},"T2MediaPlayer.tonyu":{"lastUpdate":1432611755126},"WaveTable.tonyu":{"lastUpdate":1412697666000}},"t1/":{"DxChar.tonyu":{"lastUpdate":1421384204610},"PlainChar.tonyu":{"lastUpdate":1429593897129},"SecretChar.tonyu":{"lastUpdate":1421384204695},"SpriteChar.tonyu":{"lastUpdate":1444289413782},"T1Line.tonyu":{"lastUpdate":1427965036844},"T1Map.tonyu":{"lastUpdate":1421384204728},"T1Page.tonyu":{"lastUpdate":1421384204737},"T1Text.tonyu":{"lastUpdate":1427965019581},"TextChar.tonyu":{"lastUpdate":1429503038967}},"thread/":{"ParallelMod.tonyu":{"lastUpdate":1435654079714},"Scheduler.tonyu":{"lastUpdate":1434441149517},"ThreadGroupMod.tonyu":{"lastUpdate":1430106770277}},"TObject.tonyu":{"lastUpdate":1433999102451},"TQuery.tonyu":{"lastUpdate":1438409693675},"ui/":{"GameConsole.tonyu":{"lastUpdate":1430361767671},"InputDevice.tonyu":{"lastUpdate":1437999921036},"Keys.tonyu":{"lastUpdate":1412697666000},"MapEditor.tonyu":{"lastUpdate":1437453536000},"MapEditorOLD.tonyu":{"lastUpdate":1421122943503},"Pad.tonyu":{"lastUpdate":1421122943510}}}',".desktop":'{"runMenuOrd":["Main0121","Main1023","TouchedTestMain","Main2","MapLoad","Main","AcTestM","NObjTest","NObjTest2","AcTest","AltBoot","Ball","Bar","Bounce","MapTest","MapTest2nd","SetBGCTest","Label","PanelTest","BaseActor","Panel","MathMod"]}',"Actor.tonyu":'extends BaseActor;\nincludes PlayMod, ParallelMod;\nnative Sprites;\nnative Tonyu;\n\n\\new(x,y,p) {\n    super(x,y,p);\n    /*if (Tonyu.runMode)*/ initSprite();\n}\n\\initSprite() {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    onAppear();\n}\n\\onAppear() {\n}\n',"BaseActor.tonyu":'extends null;\nincludes MathMod,EventMod,TextRectMod,OneframeSpriteMod,\nThreadGroupMod,EventHandlerCaller;\nnative Tonyu;\nnative Key;\nnative console;\nnative Math;\nnative FS;\nnative Array;\n\n\\new(x,y,p) {\n    //if (Tonyu.runMode) {\n        _th=$Boot.schedule(this,"main",[]);\n        registerEventHandler("screenOut",new ScreenOutHandler);\n        registerEventHandler("crashTo",new CrashToHandler);\n        registerEventHandler("within",new WithinHandler);\n    //}\n    if (typeof x=="object") Tonyu.extend(this,x);\n    else if (typeof x=="number") {\n        this.x=x;\n        this.y=y;\n        this.p=p;\n    }\n    if (scaleX==null) scaleX=1;\n    if (rotation==null) rotation=0;\n    if (rotate==null) rotate=0;\n    if (alpha==null) alpha=255;\n    if (zOrder==null) zOrder=0;\n    if (age==null) age=0;\n    if (anim!=null && typeof anim=="object"){\n        animMode=true;\n        animFrame=0;\n    }else{\n        animMode=false;\n    }\n    if (animFps==null) animFps=1;\n}\nnowait \\extend(obj) {\n    return Tonyu.extend(this,obj);\n}\n\nnowait \\print(pt) {\n    console.log.apply(console,arguments);\n    var mergedArg="";\n    if($consolePanel){\n        for(var argCount=0;argCount<arguments.length;argCount++){\n            mergedArg=mergedArg+arguments[argCount]+" ";\n        }\n        splits=mergedArg.split("\\n");\n        for(var printCount=0;printCount<splits.length;printCount++){\n            $consolePanel.scroll(0,20);\n            $consolePanel.setFillStyle("white");\n            $consolePanel.fillText(splits[printCount],0,$consolePrintY,20,"left");\n        }\n    }\n}\n\nnowait \\setAnimFps(f){\n    this.animFps=f;\n    this.animFrame=0;\n    this.animMode=true;\n}\nnowait \\startAnim(){\n    this.animMode=true;\n}\nnowait \\stopAnim(){\n    this.animMode=false;\n}\n\\update() {\n    onUpdate();\n    if(_thread) {\n        _thread.suspend();\n        if ($Scheduler) $Scheduler.addToNext(_thread);\n    }\n}\nnowait \\onUpdate() {\n\n}\n\\updateEx(updateT){\n    for(var updateCount=0;updateCount<updateT;updateCount++){\n        update();\n    }\n}\nnowait \\getkey(k) {\n    return $Keys.getkey(k);\n}\nnowait \\hitTo(t) {\n    return crashTo(t);\n}\nnowait \\all(c) {\n    var res=new TQuery;\n    if (arguments.length>0 && typeof c!="function") {\n        return res;\n    }\n    $Sprites.sprites.forEach \\(s) {\n        if (s===this) return;\n        if (!c || s instanceof c) {\n            res.push(s);\n        }\n    };\n    return res;// new TQuery{objects:res};\n}\nnowait \\allCrash(t) {\n    var res=new TQuery;\n    var sp=this; //_sprite || this;\n    var t1=getCrashRect();\n    if (!t1) return res;\n    $Sprites.sprites.forEach(\\(s) {\n        var t2;\n        if (s!==this &&\n        !s.excludeFromAll &&\n        s instanceof t &&\n        (t2=s.getCrashRect()) &&\n        Math.abs(t1.x-t2.x)*2<t1.width+t2.width &&\n        Math.abs(t1.y-t2.y)*2<t1.height+t2.height) {\n            res.push(s);\n        }\n    });\n    return res;\n}\nnowait \\crashTo(t) {\n    if (!t) return false;\n    if (typeof t=="function") {\n        return allCrash(t)[0];\n    }\n    return crashTo1(t);\n}\nnowait \\crashTo1(t) {\n    if (!t || t._isDead) return false;\n    /*if (_sprite && t._sprite) {\n        return _sprite.crashTo(t._sprite);\n    }*/\n    var t1=getCrashRect();\n    var t2=t.getCrashRect();\n    return\n    //    t1.x!=null && t1.y!=null && t1.width && t1.height &&\n    //    t2.x!=null && t2.y!=null && t2.width && t2.height &&\n    t1 && t2 &&\n    Math.abs(t1.x-t2.x)*2<t1.width+t2.width &&\n    Math.abs(t1.y-t2.y)*2<t1.height+t2.height;\n}\n\\crashToChecker(d,f){\n    while(true){\n        if(typeof d=="function"){\n            for(obj in allCrash(d)){\n                callEventHandler(f,[obj]);\n            }\n        }else if(crashTo(d)){\n            callEventHandler(f,[d]);\n        }\n        update();\n    }\n}\nnowait \\getCrashRect() {\n    var actWidth=width*scaleX, actHeight;\n    if(typeof scaleY==="undefined"){\n        actHeight=height*scaleX;\n    }else{\n        actHeight=height*scaleY;\n    }\n    return typeof x=="number" &&\n    typeof y=="number" &&\n    typeof width=="number" &&\n    typeof height=="number" &&\n    {x,y,width:Math.abs(actWidth),height:Math.abs(actHeight)};\n}\nnowait \\allWithin(t,distance) {\n    var res=new TQuery;\n    var sp=this; //_sprite || this;\n    var t1=getCrashRect();\n    if (!t1) return res;\n    $Sprites.sprites.forEach(\\(s) {\n        var t2;\n        if (s!==this && \n        !s.excludeFromAll &&\n        s instanceof t && \n        Math.sqrt(Math.abs(x-s.x)*Math.abs(x-s.x)+ Math.abs(y-s.y)*Math.abs(y-s.y))<distance) {\n            res.push(s);    \n        }\n    });\n    return res;\n}\nnowait \\within(t,distance){\n    if(!t) return false;\n    if(typeof t=="function"){\n        return allWithin(t,distance)[0];\n    }\n    return within1(t,distance);\n}\nnowait \\within1(t,distance){\n    if(!t || t._isDead) return false;\n    if(Math.sqrt(Math.abs(x-t.x)*Math.abs(x-t.x)+ Math.abs(y-t.y)*Math.abs(y-t.y))<distance){\n        return true;\n    }\n    return false;\n}\n\\withinChecker(d,r,f){\n    while(true){\n        if(typeof d=="function"){\n            for(obj in allWithin(d,r)){\n                print(r);\n                f(obj);\n            }\n        }else if(within(d,r)){\n            f(d);\n        }\n        update();\n    }\n}\nnowait \\watchHit(typeA,typeB,onHit) {\n    $Sprites.watchHit(typeA , typeB, \\(a,b) {\n        onHit.apply(this,[a,b]);\n    });\n}\nnowait \\currentThreadGroup() {//@deprecated\n    return $Scheduler; //$currentThreadGroup;\n}\nnowait \\die() {\n    killThreadGroup();\n    /*if (_th) {\n        _th.kill();\n    }*/\n    hide();\n    fireEvent("die");\n    _isDead=true;\n}\nnowait \\hide() {\n    /*if (_sprite) {\n        $Sprites.remove(_sprite);\n        _sprite=null;\n    } else {*/\n        //$Sprites.remove(this);\n    //}\n    if(layer && typeof layer.remove=="function"){\n        layer.remove(this);\n    }else{\n        $Sprites.remove(this);\n    }\n}\nnowait \\show(x,y,p) {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    if (x!=null) this.x=x;\n    if (y!=null) this.y=y;\n    if (p!=null) this.p=p;\n}\n\nnowait \\detectShape() {\n    if (typeof p!="number") {\n        if (text!=null) return;\n        p=0;\n    }\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) return;\n    width=pImg.width;\n    height=pImg.height;\n}\n\\waitFor(f) {\n    if (_thread) {\n        _thread.waitFor(f);\n    }\n    //update();\n}\nnowait \\isDead() {\n    return _isDead;\n}\n\nnowait \\animation(){\n    age++;\n    if(animMode && age%animFps==0){\n        p=anim[animFrame%anim.length];\n        animFrame++;\n    }\n}\nnowait \\draw(ctx) {\n    if (x==null || y==null || _isInvisible) return;\n    detectShape();\n    if (pImg) {\n        ctx.save();\n        ctx.translate(x,y);\n        //if (typeof rotate=="number" ) rotation=rotate;// 削除予定\n        //ctx.rotate(this.rotation/180*Math.PI);\n        animation();\n        if(this.rotation!=0){\n            ctx.rotate(this.rotation/180*Math.PI);\n        }else{\n            ctx.rotate(this.rotate/180*Math.PI);\n        }\n        if(typeof this.scaleY==="undefined") {\n            ctx.scale(this.scaleX,this.scaleX);\n        }else{\n            ctx.scale(this.scaleX,this.scaleY);\n        }\n        ctx.globalAlpha=this.alpha/255;\n        ctx.drawImage(\n        pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n        -width/2, -height/2, width, height);\n        ctx.restore();\n    } else if (text!==null && text!==undefined) {\n        var splitsText=(text+"").split("\\n");\n        drawY=y;\n        if (!size) size=15;\n        if (!align) align="center";\n        if (!fillStyle) fillStyle="white";\n        ctx.fillStyle=fillStyle;\n        ctx.globalAlpha=this.alpha/255;\n        height=0;width=0;\n        for(var textCount=0;textCount<splitsText.length;textCount++){\n            var rect=drawTextRect(ctx, splitsText[textCount], x, drawY, size, align , "fill");\n            if(width<rect.w) width=rect.w;\n            height+=rect.h;\n            drawY+=size;\n        }\n    }\n    if (_fukidashi) {\n        if (_fukidashi.c>0) {\n            _fukidashi.c--;\n            ctx.fillStyle="white";\n            ctx.strokeStyle="black";\n            fukidashi ( ctx , _fukidashi.text,\n            x, y-height/2-10, _fukidashi.size);\n        }\n    }\n}\nnowait \\asyncResult() {//@deperecated\n    return Tonyu.asyncResult();\n}\n\n\\runAsync(f) {\n    if (!_thread) throw new Error("runAsync should run in wait mode");\n    _thread.runAsync(f);\n}\n\n\n\\screenOut(a) {\n    //オブジェクトが画面外に出たかどうかを判定します。\n    if (!a) a=0;\n    var r=0;\n    var viewX=$Sprites.sx,viewY=$Sprites.sy;\n    if (x<viewX+a)               r+=viewX+a-x;\n    if (y<viewY+a)               r+=viewY+a-y;\n    if (x>$screenWidth +viewX-a) r+=x-($screenWidth +viewX-a);\n    if (y>$screenHeight+viewY-a) r+=y-($screenHeight+viewY-a);\n    return r;\n}\n\\screenOutChecker(d,f){\n    //print("yobareta!", getClassInfo().fullName);\n    while(true){\n        while(true){\n            if(screenOut()>d){\n                f();\n                break;\n            }\n            update();\n        }\n        while(true){\n            if(screenOut()<=d){\n                break;\n            }\n            update();\n        }\n        update();\n    }\n}\n\\file(path) {\n    var d=Tonyu.currentProject.getDir();\n    var files=d.rel("files/");\n    return FS.get(files.rel(path)) {topDir:d};\n}\n\\waitInputDevice(fl) {\n    if (fl!==false) {\n        if (!origTG) {\n            ifwait {\n                origTG=_thread.group;\n                _thread.setGroup(null);\n            }\n        }\n        a=asyncResult();\n        $InputDevice.addOnetimeListener(a.receiver);\n        waitFor(a);\n    } else {\n        if (origTG) {\n            ifwait {\n                _thread.setGroup(origTG);\n                origTG=null;\n            }\n        }\n    }\n}\n\\redrawScreen() {\n    $Sprites.draw($Screen.buf[0]);\n    $Screen.draw();\n}\n\n// from PlainChar\n\\color(r,g,b) {\n    return "rgb("+[r,g,b].join(",")+")";\n}\n/*\n\\drawText(x,y,text,col,size) {\n    if ($debug) return;\n    if (!size) size=15;\n    if (!col) col="cyan";\n    var tp=all(T1Text).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,text,fillStyle:col, size,hidden:false};\n    }else {\n        new T1Text{x,y,text,fillStyle:col, size};\n    }\n}\n\\drawLine(x,y,tx,ty,col) {\n    if (!col) col="white";\n    var tp=all(T1Line).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,tx,ty,col, hidden:false};\n    }else {\n        new T1Line{x,y,tx,ty,col};\n    }\n}\n*/\n\\loadPage(page,arg){\n    all().die();\n    new page(arg);\n    die();\n}\n\n\\setVisible(v) {\n    _isInvisible=!v;\n}\n\\appear(o) {\n    return o;\n}\n',"Boot.tonyu":'extends Actor;\nincludes T2MediaPlayer;\n\nnative $;\nnative TError;\nnative $LASTPOS;\nnative Key;\nnative Date;\nnative ImageList;\nnative Tonyu;\nnative SplashScreen;\nnative Math;\n\n\\new(param) {\n    extend(param);\n}\n\\update() {\n    waitFor(Tonyu.timeout(50)); // waitFor calls update...\n}\n\\initSprites() {\n    $Sprites=new Sprites();\n    $FrontSprites=new Sprites();\n    print ("Loading plugins..");\n    var a=asyncResult();\n    $currentProject.loadPlugins(a.receiver);\n    waitFor(a);\n    print ("Loading pats..");\n    var rs=$currentProject.getResource();\n    a=asyncResult();\n    ImageList.load( rs.images, a.receiver)\n    {baseDir:$currentProject.getDir()};\n    waitFor(a);\n    var r=a[0];\n    $Sprites.setImageList(r);\n    for (var name,val in r.names) {\n        Tonyu.setGlobal(name, val);\n    }\n    print ("Loading pats done.");\n    cvj=$("canvas");\n    if (Tonyu.noviceMode) {\n        $Screen=new ScaledCanvas{canvas:cvj, width:600, height:300};\n    } else {\n        $Screen=new ScaledCanvas{canvas:cvj, width:465, height:465};\n    }\n}\n\\initSounds() {\n    print ("Loading sounds...");\n    initT2MediaPlayer();\n    loadFromProject($currentProject);\n    print ("Loading sounds done.");\n    on("stop")\\{\n        clearSEData();\n    };\n    $sound=this;\n}\n\\hide() {\n}\n\n\\initThread() {\n    //$mainThreadGroup=thg=Tonyu.threadGroup();\n    var o=Tonyu.currentProject.getOptions();\n    var mainClassName=o.run.mainClass;\n    print("MainClass= "+mainClassName);\n    mainClass=Tonyu.getClass(mainClassName);\n    if (!mainClass) {\n        TError( mainClassName+" というクラスはありません",\n        "不明" ,0).raise();\n    }\n    //Tonyu.runMode=true;\n    //$currentThreadGroup=thg;\n    scheduler=$Scheduler=new Scheduler;\n    new mainClass();\n}\n\\stop() {\n    fireEvent("stop");\n    die();\n}\n\\schedule(obj,method,args) {\n    method=method||"main";\n    args=args||[];\n    var th=scheduler.newThread(obj, method, args);\n    addThreadGroup(obj);\n    obj.addThread(th);\n    return th;\n}\n$Boot=this;\ninitSounds();\ninitSprites();\n$InputDevice=new InputDevice;\n$InputDevice.initCanvasEvents(cvj);\ninitThread();\n\n$pat_fruits=30;\n$Keys=new Keys;\n$Math=Math;\n$consolePanel=new Panel{align:"center",x:465/2,y:465/2,width:465,height:465,zOrder:-10,layer:$FrontSprites};\n$consolePrintY=465-15;\n$panel=new Panel{align:"center",x:$screenWidth/2,y:$screenHeight/2,width:$screenWidth,height:$screenHeight,zOrder:-1,layer:$FrontSprites};\nif (typeof SplashScreen!="undefined") SplashScreen.hide();\ninitFPSParams();\n\n$mouseX=$mouseX||0;\n$mouseY=$mouseY||0;\nwhile (true) {\n    //thg.steps();\n    scheduler.stepsAll();\n    $Keys.update();\n    $InputDevice.update();\n    $screenWidth=$Screen.width;\n    $screenHeight=$Screen.height;\n    doDraw=now()<deadLine;\n    if (!doDraw && frameSkipped>=maxFrameSkip) {\n        doDraw=true;\n        resetDeadLine();\n    }\n    if (doDraw) { // フレームスキップの時は描画しない\n        $Screen.fillCanvas($Screen.buf[0]);\n        $Sprites.draw($Screen.buf[0]);\n        $FrontSprites.draw($Screen.buf[0]);\n        $Screen.draw();\n        fps_fpsCnt ++;\n        frameSkipped=0;\n    } else {\n        frameSkipped++;\n    }\n    $Sprites.checkHit();\n    $Sprites.removeOneframes();\n    fps_rpsCnt ++;\n    measureFps();\n    waitFrame(); // FPS制御\n    while(paused) {\n        waitFor(Tonyu.timeout(1));\n        if (!paused) resetDeadLine();\n    }\n}\n\nnowait \\initFPSParams() {\n    // フレームレートの設定\n    _fps = 30;\n    maxframeSkip = 5;\n    // フレームレート制御でつかう変数 //\n    frameCnt = 0;\n    resetDeadLine();\n    lastMeasured=now();\n    fps_fps=fps_rps=fps_fpsCnt=fps_rpsCnt=0;\n}\nnowait \\now() {\n    return new Date().getTime();\n}\nnowait \\resetDeadLine() {\n    deadLine=now()+1000/_fps;\n    frameSkipped = 0;\n}\n\n\\waitFrame() {\n    var wt=deadLine-now();\n    if (wt<1) {\n        if (wt<-1000) resetDeadLine();\n        wt=1;\n    }\n    wt=floor(wt);\n    waitFor(Tonyu.timeout(wt));\n    deadLine+=1000/_fps;\n}\n\nnowait \\getFrameRate() {\n    return _fps;\n}\n\n// Tonyu1の$System.setFrameRate() //\nnowait \\setFrameRate(fps, maxFrameSkip) {\n    _fps = fps;\n    if (typeof maxFrameSkip!="number") maxFrameSkip=5;\n    this.maxFrameSkip = maxFrameSkip;\n    resetDeadLine();\n}\n\n// FPS（計測したフレームレート）を返す //\nnowait \\getMeasuredFps() {\n    return fps_fps;\n}\n\n// RPS（計測した実行レート）を返す //\nnowait \\getMeasuredRps() {\n    return fps_rps;\n}\n\nnowait \\measureFps() {\n    if (now()>lastMeasured+1000) {\n        fps_fps=fps_fpsCnt;\n        fps_rps=fps_rpsCnt;\n        fps_fpsCnt=0;\n        fps_rpsCnt=0;\n        lastMeasured=now();\n    }\n}\n\n',"MathMod.tonyu":'extends null;\nnative Math;\n\nnowait \\sin(d) {\n    return Math.sin(rad(d));\n}\nnowait \\cos(d) {\n    return Math.cos(rad(d));\n}\nnowait \\rad(d) {\n    return d/180*Math.PI;\n}\nnowait \\deg(d) {\n    return d/Math.PI*180;\n}\n\nnowait \\abs(v) {\n    return Math.abs(v);\n}\nnowait \\atan2(x,y) {\n    return deg(Math.atan2(x,y));\n}\nnowait \\floor(x) {\n    return Math.floor(x);\n}\nnowait \\angleDiff(a,b) {\n    var c;\n    a=floor(a);\n    b=floor(b);\n    if (a>=b) {\n        c=(a-b) % 360;\n        if (c>=180) c-=360;\n    } else {\n        c=-((b-a) % 360);\n        if (c<-180) c+=360;\n    }\n    return c;\n}\nnowait \\sqrt(t) {\n    return Math.sqrt(t);\n}\nnowait \\dist(dx,dy) {\n    if (typeof dx=="object") {\n        var t=dx;\n        dx=t.x-x;dy=t.y-y;\n    }\n    return sqrt(dx*dx+dy*dy);\n}\nnowait \\trunc(f) {\n    if(f>=0) return Math.floor(f);\n    else return Math.ceil(f);\n}\nnowait \\ceil(f){\n    return Math.ceil(f);\n}\n\nnowait \\rnd(r) {\n    if (typeof r=="number") {\n        return Math.floor(Math.random()*r);\n    }\n    return Math.random();\n}',"NoviceActor.tonyu":"extends BaseActor;\nnative Tonyu;\n\n\\sleep(n) {\n    if(!n) n=1;\n    for(n;n>0;n--) update();\n}\n\\initSprite() {\n    if (!_sprite) {\n        _sprite=new BaseActor{owner:this};// Sprites.add{owner:this};\n        $Sprites.add(this);\n    }\n}\n\\say(text,size) {\n    if (!size) size=15;\n    initSprite();\n    _sprite._fukidashi={text:text, size:size, c:30};\n}\n\\sprite(x,y,p) {\n    go(x,y,p);\n}\n\\show(x,y,p) {\n    go(x,y,p);\n}\nnowait \\draw(ctx) {\n    _sprite.draw(ctx);\n}\n\\getCrashRect() {\n    return _sprite.getCrashRect();\n}\n\\go(x,y,p) {\n    initSprite();\n    _sprite.x=x;\n    _sprite.y=y;\n    if (p!=null) _sprite.p=p;\n    //update();\n}\n\\change(p) {\n    initSprite();\n    _sprite.p=p;\n}","TObject.tonyu":'extends null;\nnative Tonyu;\n\\new (options) {\n    if (typeof options=="object") extend(options);\n    if (Tonyu.runMode) this.main();\n}\nnowait \\extend(obj) {\n    return Tonyu.extend(this,obj);\n}',"TQuery.tonyu":'extends TObject;\nincludes MathMod;\n\\new () {\n    length=0;\n}\n\\tonyuIterator(arity) {\n    var res={};\n    res.i=0;\n    if (arity==1) {\n        res.next=function () {\n            if (res.i>=this.length) return false;\n            res[0]=this[res.i];\n            res.i++;\n            return true;\n        };\n    } else {\n        res.next=function () {\n            if (res.i>=this.length) return false;\n            res[0]=res.i;\n            res[1]=this[res.i];\n            res.i++;\n            return true;\n        };\n    }\n    return res;\n}\n\\attr() {\n    var values;\n    if (length==0) return;\n    if (arguments.length==1 && typeof arguments[0]=="string") {\n        return this[0][arguments[0]];\n    }\n    if (arguments.length>=2) {\n        values={};\n        for (var i=0 ; i<arguments.length-1 ;i+=2) {\n            values[arguments[i]]=arguments[i+1];\n        }\n    } else {\n        values=arguments[0];\n    }\n    if (values) {\n        for (var e in this) {\n            e.extend( values);\n        }\n    }\n}\n\\genKeyfunc(key) {\n    if (typeof key!="function") {\n        return \\(o) {return o[key];};\n    } else {\n        return key;\n    }\n}\n\\maxs(key) {\n    var f=genKeyfunc(key);\n    var res,reso=new TQuery;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v>=res) {\n            if (v>res) reso=new TQuery;\n            reso.push(o);\n            res=v;\n        }\n    }\n    return reso;\n}\n\\mins(key) {\n    var f=genKeyfunc(key);\n    var res,reso=new TQuery;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v<=res) {\n            if (v<res) reso=new TQuery;\n            reso.push(o);\n            res=v;\n        }\n    }\n    return reso;\n}\n\\minObj(key) {\n    return mins(key)[0];\n}\n\\maxObj(key) {\n    return maxs(key)[0];\n}\n\\nearests(x,y) {\n    if (typeof x=="object") {y=x.y;x=x.x;}\n    return mins \\(o) {\n        return dist(o.x-x,o.y-y);\n    };\n}\n\\nearest(x,y) {\n    return nearests(x,y)[0];\n}\n\\withins(xo,yd,d) {\n    var x,y;\n    if (typeof xo=="object") {\n        x=xo.x;y=xo.y;d=yd;\n    } else {\n        x=xo;y=yd;\n    }\n    return find \\(o) {\n        return dist(o.x-x,o.y-y)<=d;\n    };\n}\n\\within(xo,yd,d) {\n    return withins(xo,yd,d).nearest();\n}\n\n\\max(key) {\n    var f=genKeyfunc(key);\n    var res;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v>res) res=v;\n    }\n    return res;\n}\n\\min(key) {\n    var f=genKeyfunc(key);\n    var res;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v<res) res=v;\n    }\n    return res;\n}\n\\push(e) {\n    this[length]=e;\n    length++;\n}\n\\size() {return length;}\n\\find(f) {\n    var no=new TQuery;\n    for (var o in this) {\n        if (f(o)) no.push(o);\n    }\n    return no;\n}\n\\find1(f) {\n    return find(f)[0];\n} \n\\apply(name, args) {\n    var res;\n    if (!args) args=[];\n    for (var o in this) {\n        var f=o[name];\n        if (typeof f=="function") {\n            res=f.apply(o, args);\n        }\n    }\n    return res;\n}\n// \\alive => find \\(o) => !o.isDead()  //  (in future)\n\\alive() {\n    return find \\(o) {\n        return !o.isDead();\n    };\n}\n\\die() {\n    var a=alive();\n    if (a.length==0) return false;\n    a.apply("die");\n    return true;\n}\n\n\\klass(k) {\n    return find \\(o) { return o instanceof k; };\n}',"event/":'{"CrashToHandler.tonyu":{"lastUpdate":1434522849000},"EventHandler.tonyu":{"lastUpdate":1435635604374},"EventHandlerCaller.tonyu":{"lastUpdate":1437027652881},"EventMod.tonyu":{"lastUpdate":1433997727418},"ScreenOutHandler.tonyu":{"lastUpdate":1433996873036},"WithinHandler.tonyu":{"lastUpdate":1434522887000}}',"event/CrashToHandler.tonyu":'extends EventHandler;\n\\addListener(d, f) {\n    var retThread=target.parallel("crashToChecker",d,f);\n    return {\n        remove: \\{\n            retThread.kill();\n        }\n    };\n}\n\\new(param) {\n    super(param);\n    id=($idseq=($idseq||0)+1);\n}\n',"event/EventHandler.tonyu":'extends TObject;\nincludes EventHandlerCaller;\nnative Tonyu;\n\n\nif (Tonyu.runMode) listeners=[];\n\n\\addListener(f) {\n    if (target && (typeof f)=="string") {\n        f=target[f];\n    }\n    if (typeof f!="function") throw new Error("Not a event listener: "+target+" / "+f);\n    listeners.push(f);\n    return {\n        remove: \\{\n           removeListener(f);\n        }\n    };\n}\n\\removeListener(f) {\n    var i=listeners.indexOf(f);\n    listeners.splice(i,1);\n}\n\\fire(args) {\n    if (released) return;\n    var t;\n    for (var h in listeners) {\n        /*if (h["fiber"]) {\n            t=Tonyu.thread();\n            h["fiber"].apply(target, [t].concat(args) );\n            t.steps();\n        } else {\n            h.apply(target,args);\n        }*/\n        callEventHandler(h, args);\n    }\n}\n\\release() {\n    released=true;\n}\n',"event/EventHandlerCaller.tonyu":'extends null;\nnative Tonyu;\n\\callEventHandler(h, args) {\n    var t;\n    if (h["fiber"]) {\n        t=Tonyu.thread();\n        h["fiber"].apply(target, [t].concat(args) );\n        t.steps();\n    } else {\n        h.apply(target,args);\n    }\n}\n',"event/EventMod.tonyu":'extends null;\nnative console;\n\nnowait \\initEventMod() {\n   if (_eventHandlers) return;\n   //console.log("initEventMod" , getClassInfo().fullName);\n   _eventHandlers={};\n   on ("die",releaseEventMod);\n}\nnowait \\releaseEventMod() {\n   for (var k,v in _eventHandlers) {\n       v.release();\n   }\n}\nnowait \\parseArgs(a) {\n   var res={type:a[0], args:[]};\n   for (var i=1 ; i<a.length ; i++) {\n       res.args.push(a[i]);\n   }\n   return res;\n}\n\nnowait \\registerEventHandler(type, obj) {\n   // obj:{ attach, fire }\n   initEventMod();\n   if (typeof type=="function") {\n       obj=obj||new type{target:this};\n       type=obj.getClassInfo().fullName;\n   }  else {\n       obj=obj || new EventHandler{target:this};\n       obj.target=this;\n       //print("regEvt", type, getClassInfo().fullName, obj.id);\n   }\n   return _eventHandlers[type]=obj;\n}\n\nnowait \\getEventHandler(type) {\n   initEventMod();\n   if (typeof type=="function") {\n       type=type.meta.fullName;\n   }\n   var res=_eventHandlers[type];\n   return res;\n}\nnowait \\getOrRegisterEventHandler(type) {\n   var res=getEventHandler(type) || registerEventHandler(type);\n   return res;\n}\n\nnowait \\on() {\n    var a=parseArgs(arguments);\n    var h=getOrRegisterEventHandler(a.type);\n    //print("on", a.type, getClassInfo().fullName, h.id);\n    return h.addListener.apply(h,a.args);\n}\n\nnowait \\fireEvent(type, arg) {\n    var h=getEventHandler(type);\n    if (h) h.fire([arg]);\n}\nnowait \\sendEvent(type, arg) {\n    fireEvent(type,arg);\n}\n\n\\waitEvent() {\n    if (_thread) {\n        var args=[];\n        for (var i=0;i<arguments.length;i++) {\n            if (arguments[i]===undefined) break;\n            args.push(arguments[i]);\n        }\n        _thread.waitEvent(this, args);\n    }\n}\n/*\n\\waitEvent(type, a1,a2,a3,a4,a5) {\n    if (_thread) {\n        waitEventRaw(type,a1,a2,a3,a4,a5); // TODO: cannot apply with thread.enter\n        return _thread.lastEvent[0];\n    }\n}*/\n/*\n\\waitEvent2() {\n    if (_thread) {\n        t=obj.pararell.apply(obj, ["waitEventRaw"].concat(arguments) );\n        t.on("terminate") \\{ _thread.steps(); }\n\n    }\n}\n*/',"event/ScreenOutHandler.tonyu":'extends EventHandler;\n\\addListener(d, f) {\n    var retThread=target.parallel("screenOutChecker",d,f);\n    return {\n        remove: \\{\n            retThread.kill();\n        }\n    };\n}\n\\new(param) {\n   super(param);\n   id=($idseq=($idseq||0)+1);\n}\n',"event/WithinHandler.tonyu":'extends EventHandler;\n\\addListener(d, r, f) {\n    var retThread=target.parallel("withinChecker",d,r,f);\n    return {\n        remove: \\{\n            retThread.kill();\n        }\n    };\n}\n\\new(param) {\n    super(param);\n    id=($idseq=($idseq||0)+1);\n}\n',"graphics/":'{"GameScreen.tonyu":{"lastUpdate":1430361716021},"Map.tonyu":{"lastUpdate":1421122943495},"OneframeSpriteMod.tonyu":{"lastUpdate":1430110560296},"Panel.tonyu":{"lastUpdate":1433924256000},"ScaledCanvas.tonyu":{"lastUpdate":1438753481229},"Sprites.tonyu":{"lastUpdate":1444289413715},"TextRectMod.tonyu":{"lastUpdate":1427702468448}}',"graphics/GameScreen.tonyu":'extends Actor;\nnative $;\nnative Math;\n\n// buf: logical\n\\new (opt) {\n    // opt:{width,height,sprites}\n    extend(opt);\n    resize(width, height);\n    this.bgColor="rgb(20,80,180)";\n    isDrawGrid=$Sprites.isDrawGrid;\n}\n\\resize(width,height) {\n    this.width=width;\n    this.height=height;\n    buf=$("<canvas>").attr{width,height};\n    ctx=buf[0].getContext("2d");  \n    fireEvent("resize", width, height);\n    /*$screenWidth=width;\n    $screenHeight=height;\n    if($panel){\n        $panel.setPanel($screenWidth,$screenHeight);\n    }*/\n}\n\\setBounds(b) { //left,top,width,height in game console\n    bounds=b;\n}\n\\draw(cctx) {\n    var b=bounds;\n    fillCanvas();\n    sprites.draw(buf[0]);\n    cctx.drawImage(buf[0],\n    0,0,width, height, \n    b.left, b.top, b.width, b.height);\n}\n\\canvas2buf(point) {// canvas=gameConsole\n    var b=bounds;\n    if (!b) return point;\n    return {x: (point.x-b.left)/b.width*width, \n    y: (point.y-b.top)/b.height*height};\n}\n\\setBGColor(c){\n    this.bgColor=c;\n}\n\\fillCanvas(){\n    var ctx=buf[0].getContext("2d");\n    ctx.save();\n    ctx.fillStyle=bgColor;\n    ctx.fillRect(0,0,width,height);\n    //if (isDrawGrid) drawGrid(cv);\n    ctx.restore();\n}\n\\scrollTo(scrollX,scrollY){\n    sprites.scrollTo(scrollX,scrollY);\n}\n\n',"graphics/Map.tonyu":'extends Actor;\nnative Math;\nnative $;\n\\new (param){\n    sx=0;\n    sy=0;\n    super(param);\n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    mapObj=true;\n    mapTable = [];\n    mapOnTable = [];\n    for(var j=0;j<row;j++){\n        rows = [];\n        for(var i=0;i<col;i++){\n            rows.push(-1);\n        }\n        mapTable.push(rows);\n    }\n    for(var j=0;j<row;j++){\n        rows = [];\n        for(var i=0;i<col;i++){\n            rows.push(-1);\n        }\n        mapOnTable.push(rows);\n    }\n    /*for(var i=0;i<col;i++){\n        mapTable[i]=[];\n    }*/\n    initMap();\n}\n\\initMap(){\n    if(!mapData) return;\n    for(var i=0;i<row;i++){\n        for(var j=0;j<col;j++){\n            set(j,i,mapData[i][j]);\n        }\n    }\n    if(!mapOnData) return;\n    for(var i=0;i<row;i++){\n        for(var j=0;j<col;j++){\n            setOn(j,i,mapOnData[i][j]);\n        }\n    }\n}\n\\load(dataFile){\n    baseData=file("../maps/").rel(dataFile).obj();\n    if(!baseData) baseData=file(dataFile).obj();\n    mapTable=baseData[0];\n    mapData=mapTable;\n    row=mapTable.length;\n    col=mapTable[0].length;\n    mapOnTable=baseData[1];\n    mapOnData=mapOnTable;\n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    initMap();\n}\n\\set(setCol,setRow,p){\n    if(setCol>=col || setRow>=row || setCol<0 || setRow<0) return;\n    mapTable[setRow][setCol]=p;\n    //mapOnTable[setRow][setCol]=-1;\n    ctx=buf[0].getContext("2d");\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) {\n        ctx.clearRect(setCol*chipWidth,setRow*chipHeight,chipWidth,chipHeight);\n        return;\n    }\n    ctx.clearRect(setCol*chipWidth,setRow*chipHeight,chipWidth,chipHeight);\n    ctx.save();\n    ctx.drawImage(\n    pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n    setCol*chipWidth, setRow*chipHeight, chipWidth, chipHeight);\n    ctx.restore();\n}\n\\setOn(setCol,setRow,p){\n    if(setCol>=col || setRow>=row || setCol<0 || setRow<0) return;\n    set(setCol,setRow,mapTable[setRow][setCol]);\n    mapOnTable[setRow][setCol]=p;\n    ctx=buf[0].getContext("2d");\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) return;\n    ctx.save();\n    ctx.drawImage(\n    pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n    setCol*chipWidth, setRow*chipHeight, chipWidth, chipHeight);\n    ctx.restore();\n}\n\\setOnAt(setX,setY,p){\n    setOn(Math.floor(setX/chipWidth),Math.floor(setY/chipHeight),p);\n}\n\\setAt(setX,setY,p){\n    set(Math.floor(setX/chipWidth),Math.floor(setY/chipHeight),p);\n}\n\\get(getCol,getRow){\n    if(getCol<col && getRow<row && getCol>=0 && getRow>=0) return mapTable[getRow][getCol];\n    return -1;\n}\n\\getAt(getX,getY){\n    return get(Math.floor(getX/chipWidth),Math.floor(getY/chipHeight));\n}\n\\getOn(getCol,getRow){\n    if(getCol<col && getRow<row && getCol>=0 && getRow>=0) return mapOnTable[getRow][getCol];\n    return -1;\n}\n\\getOnAt(getX,getY){\n    return getOn(Math.floor(getX/chipWidth),Math.floor(getY/chipHeight));\n}\n\\scrollTo(scrollX,scrollY){\n    sx=-scrollX;\n    sy=-scrollY;\n}\n\\draw(ctx) {\n    pImg=buf[0];\n    ctx.save();\n    ctx.drawImage(\n    pImg, 0, 0,col*chipWidth, row*chipHeight,\n    sx, sy, col*chipWidth, row*chipHeight);\n    ctx.restore();\n}\n',"graphics/OneframeSpriteMod.tonyu":'extends null;\n\nnowait \\drawText(x,y,text,col,size) {\n    if (!size) size=15;\n    if (!col) col="cyan";\n    new T1Text{x,y,text,fillStyle:col, size,oneframeSprite:true};\n}\nnowait \\drawLine(x,y,tx,ty,col) {\n    if (!col) col="white";\n    new T1Line{x,y,tx,ty,col,oneframeSprite:true};\n}\n\n',"graphics/Panel.tonyu":'extends Actor;\nnative $;\nnative Math;\nnative isNaN;\n\\new(opt){\n    super(opt);\n    this.width=width;\n    this.height=height;\n    if(align==null) align="center";\n    if(alpha==null) alpha=255;\n    if(_drawn==null) _drawn=false;\n    buf=$("<canvas>").attr{width,height};\n}\n\\setPanel(width,height){\n    this.width=width;\n    this.height=height;\n    buf=$("<canvas>").attr{width,height};\n}\n\\resize(width,height){\n    setPanel(width,height);\n}\n\\getContext(){\n    _drawn=true;\n    return buf[0].getContext("2d");\n}\n\\setFillStyle(color){\n    this.fillStyle=color;\n}\n\\fillRect(x,y,rectWidth,rectHeight){\n    ctx=getContext();\n    ctx.save();\n    //ctx.clearRect(0,0,this.width,this.height);\n    ctx.fillStyle=fillStyle;\n    ctx.fillRect(x,y,rectWidth,rectHeight);\n    ctx.restore();\n}\n\\fillText(text,x,y,size,align){\n    ctx=getContext();\n    ctx.save();\n    text=text+"";\n    var splits = text.split("\\n");\n    //ctx.clearRect(0,0,this.width,this.height);\n    ctx.textAlign = align;\n    ctx.fillStyle=fillStyle;\n    ctx.font=size+"px \'Courier New\'";\n    for(var colCount=0;colCount<splits.length;colCount++){\n        ctx.fillText(splits[colCount],x,y);\n        y+=size;\n    }\n    ctx.restore();\n}\n\\clearRect(clearX,clearY,clearW,clearH){\n    ctx=getContext();\n    ctx.save();\n    ctx.clearRect(clearX,clearY,clearW,clearH);\n    ctx.restore();\n}\n\\getPixel(getX,getY){\n    if(typeof getX=="number" && !isNaN(getX) && \n    typeof getY=="number" && !isNaN(getY)){\n        ctx=getContext();\n        imagedata=ctx.getImageData(getX,getY,1,1);\n        colordata=[imagedata.data[0],imagedata.data[1],imagedata.data[2],imagedata.data[3]];\n        //print(imagedata.data);\n    }else{\n        colordata=[0,0,0,0];\n    }\n    return(colordata);\n}\n\\scroll(scrollX,scrollY){\n    ctx=getContext();\n    ctx.save();\n    imagedata=ctx.getImageData(0,0,this.width,this.height);\n    clearRect(0,0,width,height);\n    ctx.putImageData(imagedata,-scrollX,-scrollY);\n    ctx.restore();\n}\n\\draw(ctx){\n    if(_drawn){\n        pImg=buf[0];\n        ctx.save();\n        if(align=="left"){\n            ctx.translate(x+width/2,y+height/2);\n        }else if(align=="center"){\n            ctx.translate(x,y);\n        }else if(align=="right"){\n            ctx.translate(x-width/2,y-height/2);\n        }\n        if(this.rotation!=0){\n            ctx.rotate(this.rotation/180*Math.PI);\n        }else{\n            ctx.rotate(this.rotate/180*Math.PI);\n        }\n        ctx.globalAlpha=this.alpha/255;\n        ctx.drawImage(\n        pImg, 0, 0,width,height,\n        -width/2, -height/2, width ,height);\n        ctx.restore();\n    }\n}',"graphics/ScaledCanvas.tonyu":'extends Actor;\nnative $;\nnative Math;\n\n// canvas:phisical  buf: logical\n\\new (opt) {\n    extend(opt);\n    // canvas/ width,height\n    resize(width, height);\n    cw=canvas.width();\n    ch=canvas.height();\n    cctx=canvas[0].getContext("2d");\n    this.color="rgb(20,80,180)";\n    sx=0;\n    sy=0;\n    isDrawGrid=$Sprites.isDrawGrid;\n}\n\\resize(width,height) {\n    this.width=width;\n    this.height=height;\n    buf=$("<canvas>").attr{width,height};\n    ctx=buf[0].getContext("2d");  \n    $screenWidth=width;\n    $screenHeight=height;\n    if($panel){\n        $panel.setPanel($screenWidth,$screenHeight);\n        $panel.x=$screenWidth/2;\n        $panel.y=$screenHeight/2;\n    }\n    if($consolePanel){\n        $consolePanel.setPanel($screenWidth,$screenHeight);\n        $consolePanel.x=$screenWidth/2;\n        $consolePanel.y=$screenHeight/2;\n        $consolePrintY=$screenHeight-15;\n    }\n}\n\\shouldDraw1x1(srcw,srch,dstw,dsth) {\n    // srcw=465 -> dstw=460...665\n    var larger=200;\n    var smaller=5;\n    return srcw-smaller<=dstw && dstw<=srcw+larger &&\n    srch-smaller<=dsth && dsth<=srch+larger;\n}\n\\draw() {\n    cw=canvas.width();\n    ch=canvas.height();\n    var calcw=ch/height*width; // calch=ch\n    var calch=cw/width*height; // calcw=cw\n    if (calch>ch) calch=ch;\n    if (calcw>cw) calcw=cw;\n    cctx.clearRect(0,0,cw,ch);\n    if (shouldDraw1x1(width,height,calcw,calch)) {\n        calcw=width;calch=height;\n    }\n    var marginw=Math.floor((cw-calcw)/2);\n    var marginh=Math.floor((ch-calch)/2);\n    cctx.drawImage(buf[0],\n    0,0,width, height, \n    marginw,marginh,calcw, calch );\n}\n\\canvas2buf(point) {\n    var calcw=ch/height*width; // calch=ch\n    var calch=cw/width*height; // calcw=cw\n    if (calch>ch) calch=ch;\n    if (calcw>cw) calcw=cw;\n    if (shouldDraw1x1(width,height,calcw,calch)) {\n        calcw=width;calch=height;\n    }\n    var marginw=Math.floor((cw-calcw)/2);\n    var marginh=Math.floor((ch-calch)/2);\n    //For mysterious bug of Chrome on Android 5....\n    _ret="("+point.x+"-"+marginw+")/"+calcw+"*"+width+",";\n    return {x: (point.x-marginw)/calcw*width, \n    y: (point.y-marginh)/calch*height};\n}\n\\setBGColor(color){\n    this.color=color;\n}\n\\fillCanvas(cv){\n    var ctx=cv.getContext("2d");\n    ctx.save();\n    ctx.fillStyle=$Screen.color;\n    ctx.fillStyle=color;\n    ctx.fillRect(0,0,cv.width,cv.height);\n    if (isDrawGrid) drawGrid(cv);\n    ctx.restore();\n}\n\\scrollTo(scrollX,scrollY){\n    /*for(o in all()){\n        //print(o.mapObj);\n        if(o.mapObj){\n            o.scrollTo(o.sx+scrollX,o.sy+scrollY);\n        }else if(o.x!=undefined && o.y!=undefined){\n            o.x+=scrollX;\n            o.y+=scrollY;\n        }\n    }*/\n    //sx=scrollX;\n    //sy=scrollY;\n    $Sprites.scrollTo(scrollX,scrollY);\n}',"graphics/Sprites.tonyu":'extends Actor;\nnative Tonyu;\n\\new() {\n    sprites=[];\n    imageList=[];\n    hitWatchers=[];\n    isDrawGrid=Tonyu.noviceMode;\n    sx=0;\n    sy=0;\n    objId=0;\n}\nfunction add(s) {\n    if (s.__addedToSprites) return;\n    sprites.push(s);\n    if(s.__genId==null){\n        s.__genId=objId;\n        objId++;\n    }\n    s.__addedToSprites=this;\n    return s;\n}\nfunction remove(s) {\n    var idx=sprites.indexOf(s);\n    if (idx<0) return;\n    sprites.splice(idx,1);\n    delete s.__addedToSprites;\n}\n\\removeOneframes() {\n    for (var i=sprites.length-1 ; i>=0 ; i--) {\n        if (sprites[i].oneframeSprite) {\n            sprites.splice(i,1);\n        }\n    }\n}\nfunction clear() {sprites.splice(0,sprites.length);}\nfunction compOrder(obj1, obj2){\n    var val1=obj1.zOrder||0;\n    var val2=obj2.zOrder||0;\n    if(val1>val2){\n        return -1;\n    }else if(val1<val2){\n        return 1;\n    }else if(val1==val2){\n        if(obj1.__genId>obj2.__genId){\n            return 1;\n        }else{\n            return -1;\n        }\n        return 0;\n    }\n}\nfunction draw(cv) {\n    var ctx=cv.getContext("2d");\n    ctx.save();\n    /*\n    ctx.fillStyle=$Screen.color;\n    ctx.fillRect(0,0,cv.width,cv.height);\n    if (isDrawGrid) drawGrid(cv);\n    */\n    var orderArray=[];\n    orderArray=orderArray.concat(sprites);\n    orderArray.sort(compOrder);\n    ctx.translate(-sx,-sy);\n    orderArray.forEach(\\(s){\n        s.draw(ctx);\n    });\n    ctx.restore();\n}\nfunction checkHit() {\n    hitWatchers.forEach(function (w) {\n        sprites.forEach(function (a) {\n            //console.log("a:",  a.owner);\n            var a_owner=a;//a.owner|| a;\n            if (! (a_owner instanceof w.A)) return;\n            sprites.forEach(function (b) {\n                var b_owner=b;//b.owner|| b;\n                if (a===b) return;\n                if (! (b_owner instanceof w.B)) return;\n                //console.log("b:",  b.owner);\n                if (a.crashTo1(b)) {\n                    //console.log("hit", a.owner, b.owner);\n                    w.h(a_owner,b_owner);\n                }\n            });\n        });\n    });\n}\nfunction watchHit(typeA, typeB, onHit) {\n    var p={A: typeA, B:typeB, h:onHit};\n    //console.log(p);\n    hitWatchers.push(p);\n}\nfunction drawGrid(c) {\n    var ctx=c.getContext("2d");\n    ctx.textBaseline="top";\n    ctx.save();\n    ctx.strokeStyle="rgb(40,100,200)";\n    for (var i=0 ; i<c.width ; i+=10) {\n        ctx.beginPath();\n        ctx.lineWidth=(i % 100 ==0 ? 4 : 1);\n        ctx.moveTo(i,0);\n        ctx.lineTo(i,c.height);\n        ctx.closePath();\n        ctx.stroke();\n    }\n    \n    for (var i=0 ; i<c.height ; i+=10) {\n        ctx.beginPath();\n        ctx.lineWidth=(i % 100 ==0 ? 4 : 1);\n        ctx.moveTo(0,i);\n        ctx.lineTo(c.width,i);\n        ctx.closePath();\n        ctx.stroke();\n    }\n    ctx.fillStyle="white";\n    ctx.font="15px monospaced";\n    for (var i=100 ; i<c.width ; i+=100) {\n        ctx.fillText(i, i,0);\n    }\n    for (var i=100 ; i<c.height ; i+=100) {\n        ctx.fillText(i, 0,i);\n    }\n    ctx.restore();\n}\nfunction setImageList(il) {\n    imageList=il;\n}\nfunction getImageList() {\n    return imageList;\n}\nfunction scrollTo(scrollX,scrollY){\n    sx=scrollX;\n    sy=scrollY;\n}',"graphics/TextRectMod.tonyu":'extends null;\n\nnowait function drawTextRect(ctx, text, x, topY, h, align , type) {\n    if (!align) align="center";\n    ctx.textBaseline="top";\n    setFontSize(ctx, h);\n    var met=ctx.measureText(text);\n    var res={y:topY, w: met.width, h:h};\n    var t=align.substring(0,1).toLowerCase();\n    if (t=="l") res.x=x;\n    else if (t=="r") res.x=x-met.width;\n    else if (t=="c") res.x=x-met.width/2;\n    if (type=="fill") ctx.fillText(text, res.x,topY);\n    if (type=="stroke") ctx.strokeText(text, res.x,topY);\n    return res;\n}\nnowait function setFontSize(ctx,sz) {\n    var post=ctx.font.replace(/^[0-9\\.]+/,"");\n    ctx.font=sz+post;\n}\n\nnowait function fukidashi(ctx, text, x, y, sz) {\n    var align="c";\n    var theight=20;\n    var margin=5;\n    var r=drawTextRect(ctx, text, x,y-theight-margin-sz, sz, align);\n    ctx.beginPath();\n    ctx.moveTo(x , y);\n    ctx.lineTo(x+margin , y-theight);\n    ctx.lineTo(x+r.w/2+margin , y-theight);\n    ctx.lineTo(x+r.w/2+margin , y-theight-r.h-margin*2);\n    ctx.lineTo(x-r.w/2-margin , y-theight-r.h-margin*2);\n    ctx.lineTo(x-r.w/2-margin , y-theight);\n    ctx.lineTo(x-margin , y-theight);\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke();\n    \n    var fs=ctx.fillStyle;\n    ctx.fillStyle=ctx.strokeStyle;\n    drawTextRect(ctx, text, x, y-theight-margin-sz, sz, align, "fill");\n    ctx.fillStyle=fs;\n}\n\n',"js/":'{"concat.js":{"lastUpdate":1444289618548},"index.html":{"lastUpdate":1430107873565}}',"js/concat.js":'Tonyu.klass.define({\n  fullName: \'kernel.EventHandlerCaller\',\n  shortName: \'EventHandlerCaller\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_EventHandlerCaller_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_EventHandlerCaller_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    callEventHandler :function _trc_EventHandlerCaller_callEventHandler(h,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var t;\n      \n      //$LASTPOS=1000064;//kernel.EventHandlerCaller:64\n      t;\n      //$LASTPOS=1000076;//kernel.EventHandlerCaller:76\n      if (h["fiber"]) {\n        //$LASTPOS=1000103;//kernel.EventHandlerCaller:103\n        t=Tonyu.thread();\n        //$LASTPOS=1000130;//kernel.EventHandlerCaller:130\n        h["fiber"].apply(_this.target,[t].concat(args));\n        //$LASTPOS=1000184;//kernel.EventHandlerCaller:184\n        t.steps();\n        \n      } else {\n        //$LASTPOS=1000218;//kernel.EventHandlerCaller:218\n        h.apply(_this.target,args);\n        \n      }\n    },\n    fiber$callEventHandler :function _trc_EventHandlerCaller_f_callEventHandler(_thread,h,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var t;\n      \n      //$LASTPOS=1000064;//kernel.EventHandlerCaller:64\n      t;\n      //$LASTPOS=1000076;//kernel.EventHandlerCaller:76\n      if (h["fiber"]) {\n        //$LASTPOS=1000103;//kernel.EventHandlerCaller:103\n        t=Tonyu.thread();\n        //$LASTPOS=1000130;//kernel.EventHandlerCaller:130\n        h["fiber"].apply(_this.target,[t].concat(args));\n        //$LASTPOS=1000184;//kernel.EventHandlerCaller:184\n        t.steps();\n        \n      } else {\n        //$LASTPOS=1000218;//kernel.EventHandlerCaller:218\n        h.apply(_this.target,args);\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"callEventHandler":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.EventMod\',\n  shortName: \'EventMod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_EventMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_EventMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initEventMod :function _trc_EventMod_initEventMod() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=2000063;//kernel.EventMod:63\n      if (_this._eventHandlers) {\n        return _this;\n      }\n      //$LASTPOS=2000156;//kernel.EventMod:156\n      _this._eventHandlers={};\n      //$LASTPOS=2000179;//kernel.EventMod:179\n      _this.on("die",Tonyu.bindFunc(_this,_this.releaseEventMod));\n    },\n    releaseEventMod :function _trc_EventMod_releaseEventMod() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var k;\n      var v;\n      var _it_2;\n      \n      //$LASTPOS=2000243;//kernel.EventMod:243\n      _it_2=Tonyu.iterator(_this._eventHandlers,2);\n      while(_it_2.next()) {\n        k=_it_2[0];\n        v=_it_2[1];\n        \n        //$LASTPOS=2000285;//kernel.EventMod:285\n        v.release();\n        \n      }\n    },\n    parseArgs :function _trc_EventMod_parseArgs(a) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      var i;\n      \n      //$LASTPOS=2000335;//kernel.EventMod:335\n      res = {type: a[0],args: []};\n      //$LASTPOS=2000369;//kernel.EventMod:369\n      //$LASTPOS=2000374;//kernel.EventMod:374\n      i = 1;\n      while(i<a.length) {\n        {\n          //$LASTPOS=2000412;//kernel.EventMod:412\n          res.args.push(a[i]);\n        }\n        i++;\n      }\n      return res;\n    },\n    registerEventHandler :function _trc_EventMod_registerEventHandler(type,obj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=2000535;//kernel.EventMod:535\n      _this.initEventMod();\n      //$LASTPOS=2000555;//kernel.EventMod:555\n      if (typeof  type=="function") {\n        //$LASTPOS=2000594;//kernel.EventMod:594\n        obj=obj||new type({target: _this});\n        //$LASTPOS=2000634;//kernel.EventMod:634\n        type=obj.getClassInfo().fullName;\n        \n      } else {\n        //$LASTPOS=2000690;//kernel.EventMod:690\n        obj=obj||new Tonyu.classes.kernel.EventHandler({target: _this});\n        //$LASTPOS=2000740;//kernel.EventMod:740\n        obj.target=_this;\n        \n      }\n      return _this._eventHandlers[type]=obj;\n    },\n    getEventHandler :function _trc_EventMod_getEventHandler(type) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      \n      //$LASTPOS=2000908;//kernel.EventMod:908\n      _this.initEventMod();\n      //$LASTPOS=2000928;//kernel.EventMod:928\n      if (typeof  type=="function") {\n        //$LASTPOS=2000967;//kernel.EventMod:967\n        type=type.meta.fullName;\n        \n      }\n      //$LASTPOS=2001002;//kernel.EventMod:1002\n      res = _this._eventHandlers[type];\n      return res;\n    },\n    getOrRegisterEventHandler :function _trc_EventMod_getOrRegisterEventHandler(type) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      \n      //$LASTPOS=2001098;//kernel.EventMod:1098\n      res = _this.getEventHandler(type)||_this.registerEventHandler(type);\n      return res;\n    },\n    on :function _trc_EventMod_on() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var a;\n      var h;\n      \n      //$LASTPOS=2001201;//kernel.EventMod:1201\n      a = _this.parseArgs(arguments);\n      //$LASTPOS=2001234;//kernel.EventMod:1234\n      h = _this.getOrRegisterEventHandler(a.type);\n      return h.addListener.apply(h,a.args);\n    },\n    fireEvent :function _trc_EventMod_fireEvent(type,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var h;\n      \n      //$LASTPOS=2001419;//kernel.EventMod:1419\n      h = _this.getEventHandler(type);\n      //$LASTPOS=2001453;//kernel.EventMod:1453\n      if (h) {\n        //$LASTPOS=2001460;//kernel.EventMod:1460\n        h.fire([arg]);\n      }\n    },\n    sendEvent :function _trc_EventMod_sendEvent(type,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=2001515;//kernel.EventMod:1515\n      _this.fireEvent(type,arg);\n    },\n    waitEvent :function _trc_EventMod_waitEvent() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var args;\n      var i;\n      \n      //$LASTPOS=2001562;//kernel.EventMod:1562\n      if (null) {\n        //$LASTPOS=2001586;//kernel.EventMod:1586\n        args = [];\n        //$LASTPOS=2001608;//kernel.EventMod:1608\n        //$LASTPOS=2001613;//kernel.EventMod:1613\n        i = 0;\n        while(i<arguments.length) {\n          {\n            //$LASTPOS=2001660;//kernel.EventMod:1660\n            if (arguments[i]===undefined) {\n              break;\n              \n            }\n            //$LASTPOS=2001710;//kernel.EventMod:1710\n            args.push(arguments[i]);\n          }\n          i++;\n        }\n        //$LASTPOS=2001755;//kernel.EventMod:1755\n        null.waitEvent(_this,args);\n        \n      }\n    },\n    fiber$waitEvent :function _trc_EventMod_f_waitEvent(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var args;\n      var i;\n      \n      //$LASTPOS=2001562;//kernel.EventMod:1562\n      if (_thread) {\n        //$LASTPOS=2001586;//kernel.EventMod:1586\n        args = [];\n        //$LASTPOS=2001608;//kernel.EventMod:1608\n        //$LASTPOS=2001613;//kernel.EventMod:1613\n        i = 0;\n        while(i<_arguments.length) {\n          {\n            //$LASTPOS=2001660;//kernel.EventMod:1660\n            if (_arguments[i]===undefined) {\n              break;\n              \n            }\n            //$LASTPOS=2001710;//kernel.EventMod:1710\n            args.push(_arguments[i]);\n          }\n          i++;\n        }\n        //$LASTPOS=2001755;//kernel.EventMod:1755\n        _thread.waitEvent(_this,args);\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"initEventMod":{"nowait":true},"releaseEventMod":{"nowait":true},"parseArgs":{"nowait":true},"registerEventHandler":{"nowait":true},"getEventHandler":{"nowait":true},"getOrRegisterEventHandler":{"nowait":true},"on":{"nowait":true},"fireEvent":{"nowait":true},"sendEvent":{"nowait":true},"waitEvent":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.OneframeSpriteMod\',\n  shortName: \'OneframeSpriteMod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_OneframeSpriteMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_OneframeSpriteMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    drawText :function _trc_OneframeSpriteMod_drawText(x,y,text,col,size) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=3000060;//kernel.OneframeSpriteMod:60\n      if (! size) {\n        //$LASTPOS=3000071;//kernel.OneframeSpriteMod:71\n        size=15;\n      }\n      //$LASTPOS=3000085;//kernel.OneframeSpriteMod:85\n      if (! col) {\n        //$LASTPOS=3000095;//kernel.OneframeSpriteMod:95\n        col="cyan";\n      }\n      //$LASTPOS=3000112;//kernel.OneframeSpriteMod:112\n      new Tonyu.classes.kernel.T1Text({x: x,y: y,text: text,fillStyle: col,size: size,oneframeSprite: true});\n    },\n    drawLine :function _trc_OneframeSpriteMod_drawLine(x,y,tx,ty,col) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=3000217;//kernel.OneframeSpriteMod:217\n      if (! col) {\n        //$LASTPOS=3000227;//kernel.OneframeSpriteMod:227\n        col="white";\n      }\n      //$LASTPOS=3000245;//kernel.OneframeSpriteMod:245\n      new Tonyu.classes.kernel.T1Line({x: x,y: y,tx: tx,ty: ty,col: col,oneframeSprite: true});\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"drawText":{"nowait":true},"drawLine":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.TextRectMod\',\n  shortName: \'TextRectMod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_TextRectMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_TextRectMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    drawTextRect :function _trc_TextRectMod_drawTextRect(ctx,text,x,topY,h,align,type) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var met;\n      var res;\n      var t;\n      \n      //$LASTPOS=4000090;//kernel.TextRectMod:90\n      if (! align) {\n        //$LASTPOS=4000102;//kernel.TextRectMod:102\n        align="center";\n      }\n      //$LASTPOS=4000123;//kernel.TextRectMod:123\n      ctx.textBaseline="top";\n      //$LASTPOS=4000152;//kernel.TextRectMod:152\n      _this.setFontSize(ctx,h);\n      //$LASTPOS=4000178;//kernel.TextRectMod:178\n      met = ctx.measureText(text);\n      //$LASTPOS=4000214;//kernel.TextRectMod:214\n      res = {y: topY,w: met.width,h: h};\n      //$LASTPOS=4000256;//kernel.TextRectMod:256\n      t = align.substring(0,1).toLowerCase();\n      //$LASTPOS=4000303;//kernel.TextRectMod:303\n      if (t=="l") {\n        //$LASTPOS=4000315;//kernel.TextRectMod:315\n        res.x=x;\n      } else {\n        //$LASTPOS=4000334;//kernel.TextRectMod:334\n        if (t=="r") {\n          //$LASTPOS=4000346;//kernel.TextRectMod:346\n          res.x=x-met.width;\n        } else {\n          //$LASTPOS=4000375;//kernel.TextRectMod:375\n          if (t=="c") {\n            //$LASTPOS=4000387;//kernel.TextRectMod:387\n            res.x=x-met.width/2;\n          }\n        }\n      }\n      //$LASTPOS=4000413;//kernel.TextRectMod:413\n      if (type=="fill") {\n        //$LASTPOS=4000431;//kernel.TextRectMod:431\n        ctx.fillText(text,res.x,topY);\n      }\n      //$LASTPOS=4000468;//kernel.TextRectMod:468\n      if (type=="stroke") {\n        //$LASTPOS=4000488;//kernel.TextRectMod:488\n        ctx.strokeText(text,res.x,topY);\n      }\n      return res;\n    },\n    setFontSize :function _trc_TextRectMod_setFontSize(ctx,sz) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var post;\n      \n      //$LASTPOS=4000586;//kernel.TextRectMod:586\n      post = ctx.font.replace(/^[0-9\\.]+/,"");\n      //$LASTPOS=4000634;//kernel.TextRectMod:634\n      ctx.font=sz+post;\n    },\n    fukidashi :function _trc_TextRectMod_fukidashi(ctx,text,x,y,sz) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var align;\n      var theight;\n      var margin;\n      var r;\n      var fs;\n      \n      //$LASTPOS=4000712;//kernel.TextRectMod:712\n      align = "c";\n      //$LASTPOS=4000732;//kernel.TextRectMod:732\n      theight = 20;\n      //$LASTPOS=4000753;//kernel.TextRectMod:753\n      margin = 5;\n      //$LASTPOS=4000772;//kernel.TextRectMod:772\n      r = _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align);\n      //$LASTPOS=4000842;//kernel.TextRectMod:842\n      ctx.beginPath();\n      //$LASTPOS=4000864;//kernel.TextRectMod:864\n      ctx.moveTo(x,y);\n      //$LASTPOS=4000888;//kernel.TextRectMod:888\n      ctx.lineTo(x+margin,y-theight);\n      //$LASTPOS=4000927;//kernel.TextRectMod:927\n      ctx.lineTo(x+r.w/2+margin,y-theight);\n      //$LASTPOS=4000972;//kernel.TextRectMod:972\n      ctx.lineTo(x+r.w/2+margin,y-theight-r.h-margin*2);\n      //$LASTPOS=4001030;//kernel.TextRectMod:1030\n      ctx.lineTo(x-r.w/2-margin,y-theight-r.h-margin*2);\n      //$LASTPOS=4001088;//kernel.TextRectMod:1088\n      ctx.lineTo(x-r.w/2-margin,y-theight);\n      //$LASTPOS=4001133;//kernel.TextRectMod:1133\n      ctx.lineTo(x-margin,y-theight);\n      //$LASTPOS=4001172;//kernel.TextRectMod:1172\n      ctx.closePath();\n      //$LASTPOS=4001194;//kernel.TextRectMod:1194\n      ctx.fill();\n      //$LASTPOS=4001211;//kernel.TextRectMod:1211\n      ctx.stroke();\n      //$LASTPOS=4001236;//kernel.TextRectMod:1236\n      fs = ctx.fillStyle;\n      //$LASTPOS=4001263;//kernel.TextRectMod:1263\n      ctx.fillStyle=ctx.strokeStyle;\n      //$LASTPOS=4001299;//kernel.TextRectMod:1299\n      _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align,"fill");\n      //$LASTPOS=4001372;//kernel.TextRectMod:1372\n      ctx.fillStyle=fs;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"drawTextRect":{"nowait":true},"setFontSize":{"nowait":true},"fukidashi":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.MathMod\',\n  shortName: \'MathMod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_MathMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_MathMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    sin :function _trc_MathMod_sin(d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.sin(_this.rad(d));\n    },\n    cos :function _trc_MathMod_cos(d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.cos(_this.rad(d));\n    },\n    rad :function _trc_MathMod_rad(d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return d/180*Math.PI;\n    },\n    deg :function _trc_MathMod_deg(d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return d/Math.PI*180;\n    },\n    abs :function _trc_MathMod_abs(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.abs(v);\n    },\n    atan2 :function _trc_MathMod_atan2(x,y) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.deg(Math.atan2(x,y));\n    },\n    floor :function _trc_MathMod_floor(x) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.floor(x);\n    },\n    angleDiff :function _trc_MathMod_angleDiff(a,b) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var c;\n      \n      //$LASTPOS=5000416;//kernel.MathMod:416\n      c;\n      //$LASTPOS=5000428;//kernel.MathMod:428\n      a=_this.floor(a);\n      //$LASTPOS=5000445;//kernel.MathMod:445\n      b=_this.floor(b);\n      //$LASTPOS=5000462;//kernel.MathMod:462\n      if (a>=b) {\n        //$LASTPOS=5000483;//kernel.MathMod:483\n        c=(a-b)%360;\n        //$LASTPOS=5000507;//kernel.MathMod:507\n        if (c>=180) {\n          //$LASTPOS=5000519;//kernel.MathMod:519\n          c-=360;\n        }\n        \n      } else {\n        //$LASTPOS=5000550;//kernel.MathMod:550\n        c=- ((b-a)%360);\n        //$LASTPOS=5000577;//kernel.MathMod:577\n        if (c<- 180) {\n          //$LASTPOS=5000589;//kernel.MathMod:589\n          c+=360;\n        }\n        \n      }\n      return c;\n    },\n    sqrt :function _trc_MathMod_sqrt(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.sqrt(t);\n    },\n    dist :function _trc_MathMod_dist(dx,dy) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var t;\n      \n      //$LASTPOS=5000698;//kernel.MathMod:698\n      if (typeof  dx=="object") {\n        //$LASTPOS=5000734;//kernel.MathMod:734\n        t = dx;\n        //$LASTPOS=5000753;//kernel.MathMod:753\n        dx=t.x-_this.x;\n        //$LASTPOS=5000762;//kernel.MathMod:762\n        dy=t.y-_this.y;\n        \n      }\n      return _this.sqrt(dx*dx+dy*dy);\n    },\n    trunc :function _trc_MathMod_trunc(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=5000838;//kernel.MathMod:838\n      if (f>=0) {\n        return Math.floor(f);\n      } else {\n        return Math.ceil(f);\n      }\n    },\n    ceil :function _trc_MathMod_ceil(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.ceil(f);\n    },\n    rnd :function _trc_MathMod_rnd(r) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=5000975;//kernel.MathMod:975\n      if (typeof  r=="number") {\n        return Math.floor(Math.random()*r);\n        \n      }\n      return Math.random();\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"sin":{"nowait":true},"cos":{"nowait":true},"rad":{"nowait":true},"deg":{"nowait":true},"abs":{"nowait":true},"atan2":{"nowait":true},"floor":{"nowait":true},"angleDiff":{"nowait":true},"sqrt":{"nowait":true},"dist":{"nowait":true},"trunc":{"nowait":true},"ceil":{"nowait":true},"rnd":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T2Mod\',\n  shortName: \'T2Mod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_T2Mod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T2Mod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    bvec :function _trc_T2Mod_bvec(tx,ty) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b2Vec2;\n      \n      //$LASTPOS=6000034;//kernel.T2Mod:34\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      return new b2Vec2(tx/_this.scale,ty/_this.scale);\n    },\n    fiber$bvec :function _trc_T2Mod_f_bvec(_thread,tx,ty) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b2Vec2;\n      \n      //$LASTPOS=6000034;//kernel.T2Mod:34\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      _thread.retVal=new b2Vec2(tx/_this.scale,ty/_this.scale);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    defv :function _trc_T2Mod_defv(t,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return (t===t&&(typeof  t)==="number")?t:d;\n    },\n    fiber$defv :function _trc_T2Mod_f_defv(_thread,t,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=(t===t&&(typeof  t)==="number")?t:d;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"bvec":{"nowait":false},"defv":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.MediaPlayer\',\n  shortName: \'MediaPlayer\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_MediaPlayer_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_MediaPlayer_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    play :function _trc_MediaPlayer_play() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$play :function _trc_MediaPlayer_f_play(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stop :function _trc_MediaPlayer_stop() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$stop :function _trc_MediaPlayer_f_stop(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    playSE :function _trc_MediaPlayer_playSE() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$playSE :function _trc_MediaPlayer_f_playSE(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setDelay :function _trc_MediaPlayer_setDelay() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$setDelay :function _trc_MediaPlayer_f_setDelay(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setVolume :function _trc_MediaPlayer_setVolume() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$setVolume :function _trc_MediaPlayer_f_setVolume(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"play":{"nowait":false},"stop":{"nowait":false},"playSE":{"nowait":false},"setDelay":{"nowait":false},"setVolume":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.ThreadGroupMod\',\n  shortName: \'ThreadGroupMod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_ThreadGroupMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_ThreadGroupMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    addThread :function _trc_ThreadGroupMod_addThread(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=7000038;//kernel.ThreadGroupMod:38\n      _this.threads=_this.threads||[];\n      //$LASTPOS=7000064;//kernel.ThreadGroupMod:64\n      _this.threads.push(t);\n    },\n    fiber$addThread :function _trc_ThreadGroupMod_f_addThread(_thread,t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=7000038;//kernel.ThreadGroupMod:38\n      _this.threads=_this.threads||[];\n      //$LASTPOS=7000064;//kernel.ThreadGroupMod:64\n      _this.threads.push(t);\n      \n      _thread.retVal=_this;return;\n    },\n    addThreadGroup :function _trc_ThreadGroupMod_addThreadGroup(tg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=7000112;//kernel.ThreadGroupMod:112\n      _this.threadGroups=_this.threadGroups||[];\n      //$LASTPOS=7000148;//kernel.ThreadGroupMod:148\n      _this.threadGroups.push(tg);\n    },\n    fiber$addThreadGroup :function _trc_ThreadGroupMod_f_addThreadGroup(_thread,tg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=7000112;//kernel.ThreadGroupMod:112\n      _this.threadGroups=_this.threadGroups||[];\n      //$LASTPOS=7000148;//kernel.ThreadGroupMod:148\n      _this.threadGroups.push(tg);\n      \n      _thread.retVal=_this;return;\n    },\n    killThreadGroup :function _trc_ThreadGroupMod_killThreadGroup() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var thread;\n      var _it_27;\n      var threadGroup;\n      var _it_28;\n      \n      //$LASTPOS=7000201;//kernel.ThreadGroupMod:201\n      if (_this.threads) {\n        //$LASTPOS=7000225;//kernel.ThreadGroupMod:225\n        _it_27=Tonyu.iterator(_this.threads,1);\n        while(_it_27.next()) {\n          thread=_it_27[0];\n          \n          //$LASTPOS=7000268;//kernel.ThreadGroupMod:268\n          thread.kill();\n          \n        }\n        \n      }\n      //$LASTPOS=7000306;//kernel.ThreadGroupMod:306\n      if (_this.threadGroups) {\n        //$LASTPOS=7000335;//kernel.ThreadGroupMod:335\n        _it_28=Tonyu.iterator(_this.threadGroups,1);\n        while(_it_28.next()) {\n          threadGroup=_it_28[0];\n          \n          //$LASTPOS=7000388;//kernel.ThreadGroupMod:388\n          threadGroup.killThreadGroup();\n          \n        }\n        \n      }\n    },\n    fiber$killThreadGroup :function _trc_ThreadGroupMod_f_killThreadGroup(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var thread;\n      var _it_27;\n      var threadGroup;\n      var _it_28;\n      \n      //$LASTPOS=7000201;//kernel.ThreadGroupMod:201\n      if (_this.threads) {\n        //$LASTPOS=7000225;//kernel.ThreadGroupMod:225\n        _it_27=Tonyu.iterator(_this.threads,1);\n        while(_it_27.next()) {\n          thread=_it_27[0];\n          \n          //$LASTPOS=7000268;//kernel.ThreadGroupMod:268\n          thread.kill();\n          \n        }\n        \n      }\n      //$LASTPOS=7000306;//kernel.ThreadGroupMod:306\n      if (_this.threadGroups) {\n        //$LASTPOS=7000335;//kernel.ThreadGroupMod:335\n        _it_28=Tonyu.iterator(_this.threadGroups,1);\n        while(_it_28.next()) {\n          threadGroup=_it_28[0];\n          \n          //$LASTPOS=7000388;//kernel.ThreadGroupMod:388\n          threadGroup.killThreadGroup();\n          \n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"addThread":{"nowait":false},"addThreadGroup":{"nowait":false},"killThreadGroup":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.TObject\',\n  shortName: \'TObject\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_TObject_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_TObject_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_TObject_initialize(options) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=8000052;//kernel.TObject:52\n      if (typeof  options=="object") {\n        //$LASTPOS=8000082;//kernel.TObject:82\n        _this.extend(options);\n      }\n      //$LASTPOS=8000104;//kernel.TObject:104\n      if (Tonyu.runMode) {\n        //$LASTPOS=8000123;//kernel.TObject:123\n        _this.main();\n      }\n    },\n    extend :function _trc_TObject_extend(obj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.extend(_this,obj);\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"extend":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.TQuery\',\n  shortName: \'TQuery\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [Tonyu.classes.kernel.MathMod],\n  methods: {\n    main :function _trc_TQuery_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_TQuery_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_TQuery_initialize() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=9000049;//kernel.TQuery:49\n      _this.length=0;\n    },\n    tonyuIterator :function _trc_TQuery_tonyuIterator(arity) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      \n      //$LASTPOS=9000089;//kernel.TQuery:89\n      res = {};\n      //$LASTPOS=9000105;//kernel.TQuery:105\n      res.i=0;\n      //$LASTPOS=9000118;//kernel.TQuery:118\n      if (arity==1) {\n        //$LASTPOS=9000142;//kernel.TQuery:142\n        res.next=(function anonymous_151() {\n          \n          //$LASTPOS=9000177;//kernel.TQuery:177\n          if (res.i>=_this.length) {\n            return false;\n          }\n          //$LASTPOS=9000227;//kernel.TQuery:227\n          res[0]=_this[res.i];\n          //$LASTPOS=9000259;//kernel.TQuery:259\n          res.i++;\n          return true;\n        });\n        \n      } else {\n        //$LASTPOS=9000325;//kernel.TQuery:325\n        res.next=(function anonymous_334() {\n          \n          //$LASTPOS=9000360;//kernel.TQuery:360\n          if (res.i>=_this.length) {\n            return false;\n          }\n          //$LASTPOS=9000410;//kernel.TQuery:410\n          res[0]=res.i;\n          //$LASTPOS=9000436;//kernel.TQuery:436\n          res[1]=_this[res.i];\n          //$LASTPOS=9000468;//kernel.TQuery:468\n          res.i++;\n          return true;\n        });\n        \n      }\n      return res;\n    },\n    fiber$tonyuIterator :function _trc_TQuery_f_tonyuIterator(_thread,arity) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var res;\n      \n      //$LASTPOS=9000089;//kernel.TQuery:89\n      res = {};\n      //$LASTPOS=9000105;//kernel.TQuery:105\n      res.i=0;\n      //$LASTPOS=9000118;//kernel.TQuery:118\n      if (arity==1) {\n        //$LASTPOS=9000142;//kernel.TQuery:142\n        res.next=(function anonymous_151() {\n          \n          //$LASTPOS=9000177;//kernel.TQuery:177\n          if (res.i>=_this.length) {\n            return false;\n          }\n          //$LASTPOS=9000227;//kernel.TQuery:227\n          res[0]=_this[res.i];\n          //$LASTPOS=9000259;//kernel.TQuery:259\n          res.i++;\n          return true;\n        });\n        \n      } else {\n        //$LASTPOS=9000325;//kernel.TQuery:325\n        res.next=(function anonymous_334() {\n          \n          //$LASTPOS=9000360;//kernel.TQuery:360\n          if (res.i>=_this.length) {\n            return false;\n          }\n          //$LASTPOS=9000410;//kernel.TQuery:410\n          res[0]=res.i;\n          //$LASTPOS=9000436;//kernel.TQuery:436\n          res[1]=_this[res.i];\n          //$LASTPOS=9000468;//kernel.TQuery:468\n          res.i++;\n          return true;\n        });\n        \n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    attr :function _trc_TQuery_attr() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var values;\n      var i;\n      var e;\n      var _it_34;\n      \n      //$LASTPOS=9000551;//kernel.TQuery:551\n      values;\n      //$LASTPOS=9000567;//kernel.TQuery:567\n      if (_this.length==0) {\n        return _this;\n      }\n      //$LASTPOS=9000594;//kernel.TQuery:594\n      if (arguments.length==1&&typeof  arguments[0]=="string") {\n        return _this[0][arguments[0]];\n        \n      }\n      //$LASTPOS=9000702;//kernel.TQuery:702\n      if (arguments.length>=2) {\n        //$LASTPOS=9000737;//kernel.TQuery:737\n        values={};\n        //$LASTPOS=9000756;//kernel.TQuery:756\n        //$LASTPOS=9000761;//kernel.TQuery:761\n        i = 0;\n        while(i<arguments.length-1) {\n          {\n            //$LASTPOS=9000813;//kernel.TQuery:813\n            values[arguments[i]]=arguments[i+1];\n          }\n          i+=2;\n        }\n        \n      } else {\n        //$LASTPOS=9000881;//kernel.TQuery:881\n        values=arguments[0];\n        \n      }\n      //$LASTPOS=9000912;//kernel.TQuery:912\n      if (values) {\n        //$LASTPOS=9000934;//kernel.TQuery:934\n        _it_34=Tonyu.iterator(_this,1);\n        while(_it_34.next()) {\n          e=_it_34[0];\n          \n          //$LASTPOS=9000968;//kernel.TQuery:968\n          e.extend(values);\n          \n        }\n        \n      }\n    },\n    fiber$attr :function _trc_TQuery_f_attr(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var values;\n      var i;\n      var e;\n      var _it_34;\n      \n      //$LASTPOS=9000551;//kernel.TQuery:551\n      values;\n      //$LASTPOS=9000567;//kernel.TQuery:567\n      if (_this.length==0) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=9000594;//kernel.TQuery:594\n      if (_arguments.length==1&&typeof  _arguments[0]=="string") {\n        _thread.retVal=_this[0][_arguments[0]];return;\n        \n        \n      }\n      //$LASTPOS=9000702;//kernel.TQuery:702\n      if (_arguments.length>=2) {\n        //$LASTPOS=9000737;//kernel.TQuery:737\n        values={};\n        //$LASTPOS=9000756;//kernel.TQuery:756\n        //$LASTPOS=9000761;//kernel.TQuery:761\n        i = 0;\n        while(i<_arguments.length-1) {\n          {\n            //$LASTPOS=9000813;//kernel.TQuery:813\n            values[_arguments[i]]=_arguments[i+1];\n          }\n          i+=2;\n        }\n        \n      } else {\n        //$LASTPOS=9000881;//kernel.TQuery:881\n        values=_arguments[0];\n        \n      }\n      //$LASTPOS=9000912;//kernel.TQuery:912\n      if (values) {\n        //$LASTPOS=9000934;//kernel.TQuery:934\n        _it_34=Tonyu.iterator(_this,1);\n        while(_it_34.next()) {\n          e=_it_34[0];\n          \n          //$LASTPOS=9000968;//kernel.TQuery:968\n          e.extend(values);\n          \n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    genKeyfunc :function _trc_TQuery_genKeyfunc(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=9001028;//kernel.TQuery:1028\n      if (typeof  key!="function") {\n        return (function anonymous_1073(o) {\n          \n          return o[key];\n        });\n        \n      } else {\n        return key;\n        \n      }\n    },\n    fiber$genKeyfunc :function _trc_TQuery_f_genKeyfunc(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=9001028;//kernel.TQuery:1028\n      if (typeof  key!="function") {\n        _thread.retVal=(function anonymous_1073(o) {\n          \n          return o[key];\n        });return;\n        \n        \n      } else {\n        _thread.retVal=key;return;\n        \n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    maxs :function _trc_TQuery_maxs(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var f;\n      var res;\n      var reso;\n      var o;\n      var _it_40;\n      var v;\n      \n      //$LASTPOS=9001154;//kernel.TQuery:1154\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=9001181;//kernel.TQuery:1181\n      res;reso = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=9001210;//kernel.TQuery:1210\n      _it_40=Tonyu.iterator(_this,1);\n      while(_it_40.next()) {\n        o=_it_40[0];\n        \n        //$LASTPOS=9001240;//kernel.TQuery:1240\n        v = f(o);\n        //$LASTPOS=9001260;//kernel.TQuery:1260\n        if (res==null||v>=res) {\n          //$LASTPOS=9001299;//kernel.TQuery:1299\n          if (v>res) {\n            //$LASTPOS=9001310;//kernel.TQuery:1310\n            reso=new Tonyu.classes.kernel.TQuery;\n          }\n          //$LASTPOS=9001339;//kernel.TQuery:1339\n          reso.push(o);\n          //$LASTPOS=9001365;//kernel.TQuery:1365\n          res=v;\n          \n        }\n        \n      }\n      return reso;\n    },\n    fiber$maxs :function _trc_TQuery_f_maxs(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var f;\n      var res;\n      var reso;\n      var o;\n      var _it_40;\n      var v;\n      \n      //$LASTPOS=9001154;//kernel.TQuery:1154\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=9001181;//kernel.TQuery:1181\n      res;reso = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=9001210;//kernel.TQuery:1210\n      _it_40=Tonyu.iterator(_this,1);\n      while(_it_40.next()) {\n        o=_it_40[0];\n        \n        //$LASTPOS=9001240;//kernel.TQuery:1240\n        v = f(o);\n        //$LASTPOS=9001260;//kernel.TQuery:1260\n        if (res==null||v>=res) {\n          //$LASTPOS=9001299;//kernel.TQuery:1299\n          if (v>res) {\n            //$LASTPOS=9001310;//kernel.TQuery:1310\n            reso=new Tonyu.classes.kernel.TQuery;\n          }\n          //$LASTPOS=9001339;//kernel.TQuery:1339\n          reso.push(o);\n          //$LASTPOS=9001365;//kernel.TQuery:1365\n          res=v;\n          \n        }\n        \n      }\n      _thread.retVal=reso;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    mins :function _trc_TQuery_mins(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var f;\n      var res;\n      var reso;\n      var o;\n      var _it_47;\n      var v;\n      \n      //$LASTPOS=9001424;//kernel.TQuery:1424\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=9001451;//kernel.TQuery:1451\n      res;reso = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=9001480;//kernel.TQuery:1480\n      _it_47=Tonyu.iterator(_this,1);\n      while(_it_47.next()) {\n        o=_it_47[0];\n        \n        //$LASTPOS=9001510;//kernel.TQuery:1510\n        v = f(o);\n        //$LASTPOS=9001530;//kernel.TQuery:1530\n        if (res==null||v<=res) {\n          //$LASTPOS=9001569;//kernel.TQuery:1569\n          if (v<res) {\n            //$LASTPOS=9001580;//kernel.TQuery:1580\n            reso=new Tonyu.classes.kernel.TQuery;\n          }\n          //$LASTPOS=9001609;//kernel.TQuery:1609\n          reso.push(o);\n          //$LASTPOS=9001635;//kernel.TQuery:1635\n          res=v;\n          \n        }\n        \n      }\n      return reso;\n    },\n    fiber$mins :function _trc_TQuery_f_mins(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var f;\n      var res;\n      var reso;\n      var o;\n      var _it_47;\n      var v;\n      \n      //$LASTPOS=9001424;//kernel.TQuery:1424\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=9001451;//kernel.TQuery:1451\n      res;reso = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=9001480;//kernel.TQuery:1480\n      _it_47=Tonyu.iterator(_this,1);\n      while(_it_47.next()) {\n        o=_it_47[0];\n        \n        //$LASTPOS=9001510;//kernel.TQuery:1510\n        v = f(o);\n        //$LASTPOS=9001530;//kernel.TQuery:1530\n        if (res==null||v<=res) {\n          //$LASTPOS=9001569;//kernel.TQuery:1569\n          if (v<res) {\n            //$LASTPOS=9001580;//kernel.TQuery:1580\n            reso=new Tonyu.classes.kernel.TQuery;\n          }\n          //$LASTPOS=9001609;//kernel.TQuery:1609\n          reso.push(o);\n          //$LASTPOS=9001635;//kernel.TQuery:1635\n          res=v;\n          \n        }\n        \n      }\n      _thread.retVal=reso;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    minObj :function _trc_TQuery_minObj(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.mins(key)[0];\n    },\n    fiber$minObj :function _trc_TQuery_f_minObj(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.mins(key)[0];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    maxObj :function _trc_TQuery_maxObj(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.maxs(key)[0];\n    },\n    fiber$maxObj :function _trc_TQuery_f_maxObj(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.maxs(key)[0];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    nearests :function _trc_TQuery_nearests(x,y) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=9001782;//kernel.TQuery:1782\n      if (typeof  x=="object") {\n        //$LASTPOS=9001807;//kernel.TQuery:1807\n        y=x.y;\n        //$LASTPOS=9001813;//kernel.TQuery:1813\n        x=x.x;\n        \n      }\n      return _this.mins((function anonymous_1837(o) {\n        \n        return _this.dist(o.x-x,o.y-y);\n      }));\n    },\n    fiber$nearests :function _trc_TQuery_f_nearests(_thread,x,y) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=9001782;//kernel.TQuery:1782\n      if (typeof  x=="object") {\n        //$LASTPOS=9001807;//kernel.TQuery:1807\n        y=x.y;\n        //$LASTPOS=9001813;//kernel.TQuery:1813\n        x=x.x;\n        \n      }\n      _thread.retVal=_this.mins((function anonymous_1837(o) {\n        \n        return _this.dist(o.x-x,o.y-y);\n      }));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    nearest :function _trc_TQuery_nearest(x,y) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.nearests(x,y)[0];\n    },\n    fiber$nearest :function _trc_TQuery_f_nearest(_thread,x,y) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.nearests(x,y)[0];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    withins :function _trc_TQuery_withins(xo,yd,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var x;\n      var y;\n      \n      //$LASTPOS=9001958;//kernel.TQuery:1958\n      x;y;\n      //$LASTPOS=9001971;//kernel.TQuery:1971\n      if (typeof  xo=="object") {\n        //$LASTPOS=9002006;//kernel.TQuery:2006\n        x=xo.x;\n        //$LASTPOS=9002013;//kernel.TQuery:2013\n        y=xo.y;\n        //$LASTPOS=9002020;//kernel.TQuery:2020\n        d=yd;\n        \n      } else {\n        //$LASTPOS=9002047;//kernel.TQuery:2047\n        x=xo;\n        //$LASTPOS=9002052;//kernel.TQuery:2052\n        y=yd;\n        \n      }\n      return _this.find((function anonymous_2080(o) {\n        \n        return _this.dist(o.x-x,o.y-y)<=d;\n      }));\n    },\n    fiber$withins :function _trc_TQuery_f_withins(_thread,xo,yd,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var x;\n      var y;\n      \n      //$LASTPOS=9001958;//kernel.TQuery:1958\n      x;y;\n      //$LASTPOS=9001971;//kernel.TQuery:1971\n      if (typeof  xo=="object") {\n        //$LASTPOS=9002006;//kernel.TQuery:2006\n        x=xo.x;\n        //$LASTPOS=9002013;//kernel.TQuery:2013\n        y=xo.y;\n        //$LASTPOS=9002020;//kernel.TQuery:2020\n        d=yd;\n        \n      } else {\n        //$LASTPOS=9002047;//kernel.TQuery:2047\n        x=xo;\n        //$LASTPOS=9002052;//kernel.TQuery:2052\n        y=yd;\n        \n      }\n      _thread.retVal=_this.find((function anonymous_2080(o) {\n        \n        return _this.dist(o.x-x,o.y-y)<=d;\n      }));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    within :function _trc_TQuery_within(xo,yd,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.withins(xo,yd,d).nearest();\n    },\n    fiber$within :function _trc_TQuery_f_within(_thread,xo,yd,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.withins(xo,yd,d).nearest();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    max :function _trc_TQuery_max(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var f;\n      var res;\n      var o;\n      var _it_58;\n      var v;\n      \n      //$LASTPOS=9002210;//kernel.TQuery:2210\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=9002237;//kernel.TQuery:2237\n      res;\n      //$LASTPOS=9002250;//kernel.TQuery:2250\n      _it_58=Tonyu.iterator(_this,1);\n      while(_it_58.next()) {\n        o=_it_58[0];\n        \n        //$LASTPOS=9002280;//kernel.TQuery:2280\n        v = f(o);\n        //$LASTPOS=9002300;//kernel.TQuery:2300\n        if (res==null||v>res) {\n          //$LASTPOS=9002324;//kernel.TQuery:2324\n          res=v;\n        }\n        \n      }\n      return res;\n    },\n    fiber$max :function _trc_TQuery_f_max(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var f;\n      var res;\n      var o;\n      var _it_58;\n      var v;\n      \n      //$LASTPOS=9002210;//kernel.TQuery:2210\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=9002237;//kernel.TQuery:2237\n      res;\n      //$LASTPOS=9002250;//kernel.TQuery:2250\n      _it_58=Tonyu.iterator(_this,1);\n      while(_it_58.next()) {\n        o=_it_58[0];\n        \n        //$LASTPOS=9002280;//kernel.TQuery:2280\n        v = f(o);\n        //$LASTPOS=9002300;//kernel.TQuery:2300\n        if (res==null||v>res) {\n          //$LASTPOS=9002324;//kernel.TQuery:2324\n          res=v;\n        }\n        \n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    min :function _trc_TQuery_min(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var f;\n      var res;\n      var o;\n      var _it_64;\n      var v;\n      \n      //$LASTPOS=9002371;//kernel.TQuery:2371\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=9002398;//kernel.TQuery:2398\n      res;\n      //$LASTPOS=9002411;//kernel.TQuery:2411\n      _it_64=Tonyu.iterator(_this,1);\n      while(_it_64.next()) {\n        o=_it_64[0];\n        \n        //$LASTPOS=9002441;//kernel.TQuery:2441\n        v = f(o);\n        //$LASTPOS=9002461;//kernel.TQuery:2461\n        if (res==null||v<res) {\n          //$LASTPOS=9002485;//kernel.TQuery:2485\n          res=v;\n        }\n        \n      }\n      return res;\n    },\n    fiber$min :function _trc_TQuery_f_min(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var f;\n      var res;\n      var o;\n      var _it_64;\n      var v;\n      \n      //$LASTPOS=9002371;//kernel.TQuery:2371\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=9002398;//kernel.TQuery:2398\n      res;\n      //$LASTPOS=9002411;//kernel.TQuery:2411\n      _it_64=Tonyu.iterator(_this,1);\n      while(_it_64.next()) {\n        o=_it_64[0];\n        \n        //$LASTPOS=9002441;//kernel.TQuery:2441\n        v = f(o);\n        //$LASTPOS=9002461;//kernel.TQuery:2461\n        if (res==null||v<res) {\n          //$LASTPOS=9002485;//kernel.TQuery:2485\n          res=v;\n        }\n        \n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    push :function _trc_TQuery_push(e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=9002531;//kernel.TQuery:2531\n      _this[_this.length]=e;\n      //$LASTPOS=9002551;//kernel.TQuery:2551\n      _this.length++;\n    },\n    fiber$push :function _trc_TQuery_f_push(_thread,e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=9002531;//kernel.TQuery:2531\n      _this[_this.length]=e;\n      //$LASTPOS=9002551;//kernel.TQuery:2551\n      _this.length++;\n      \n      _thread.retVal=_this;return;\n    },\n    size :function _trc_TQuery_size() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.length;\n    },\n    fiber$size :function _trc_TQuery_f_size(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.length;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    find :function _trc_TQuery_find(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var no;\n      var o;\n      var _it_70;\n      \n      //$LASTPOS=9002603;//kernel.TQuery:2603\n      no = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=9002626;//kernel.TQuery:2626\n      _it_70=Tonyu.iterator(_this,1);\n      while(_it_70.next()) {\n        o=_it_70[0];\n        \n        //$LASTPOS=9002656;//kernel.TQuery:2656\n        if (f(o)) {\n          //$LASTPOS=9002666;//kernel.TQuery:2666\n          no.push(o);\n        }\n        \n      }\n      return no;\n    },\n    fiber$find :function _trc_TQuery_f_find(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var no;\n      var o;\n      var _it_70;\n      \n      //$LASTPOS=9002603;//kernel.TQuery:2603\n      no = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=9002626;//kernel.TQuery:2626\n      _it_70=Tonyu.iterator(_this,1);\n      while(_it_70.next()) {\n        o=_it_70[0];\n        \n        //$LASTPOS=9002656;//kernel.TQuery:2656\n        if (f(o)) {\n          //$LASTPOS=9002666;//kernel.TQuery:2666\n          no.push(o);\n        }\n        \n      }\n      _thread.retVal=no;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    find1 :function _trc_TQuery_find1(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.find(f)[0];\n    },\n    fiber$find1 :function _trc_TQuery_f_find1(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.find(f)[0];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    apply :function _trc_TQuery_apply(name,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      var o;\n      var _it_74;\n      var f;\n      \n      //$LASTPOS=9002764;//kernel.TQuery:2764\n      res;\n      //$LASTPOS=9002777;//kernel.TQuery:2777\n      if (! args) {\n        //$LASTPOS=9002788;//kernel.TQuery:2788\n        args=[];\n      }\n      //$LASTPOS=9002801;//kernel.TQuery:2801\n      _it_74=Tonyu.iterator(_this,1);\n      while(_it_74.next()) {\n        o=_it_74[0];\n        \n        //$LASTPOS=9002831;//kernel.TQuery:2831\n        f = o[name];\n        //$LASTPOS=9002854;//kernel.TQuery:2854\n        if (typeof  f=="function") {\n          //$LASTPOS=9002894;//kernel.TQuery:2894\n          res=f.apply(o,args);\n          \n        }\n        \n      }\n      return res;\n    },\n    fiber$apply :function _trc_TQuery_f_apply(_thread,name,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var res;\n      var o;\n      var _it_74;\n      var f;\n      \n      //$LASTPOS=9002764;//kernel.TQuery:2764\n      res;\n      //$LASTPOS=9002777;//kernel.TQuery:2777\n      if (! args) {\n        //$LASTPOS=9002788;//kernel.TQuery:2788\n        args=[];\n      }\n      //$LASTPOS=9002801;//kernel.TQuery:2801\n      _it_74=Tonyu.iterator(_this,1);\n      while(_it_74.next()) {\n        o=_it_74[0];\n        \n        //$LASTPOS=9002831;//kernel.TQuery:2831\n        f = o[name];\n        //$LASTPOS=9002854;//kernel.TQuery:2854\n        if (typeof  f=="function") {\n          //$LASTPOS=9002894;//kernel.TQuery:2894\n          res=f.apply(o,args);\n          \n        }\n        \n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    alive :function _trc_TQuery_alive() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.find((function anonymous_3032(o) {\n        \n        return ! o.isDead();\n      }));\n    },\n    fiber$alive :function _trc_TQuery_f_alive(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.find((function anonymous_3032(o) {\n        \n        return ! o.isDead();\n      }));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    die :function _trc_TQuery_die() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var a;\n      \n      //$LASTPOS=9003089;//kernel.TQuery:3089\n      a = _this.alive();\n      //$LASTPOS=9003108;//kernel.TQuery:3108\n      if (a.length==0) {\n        return false;\n      }\n      //$LASTPOS=9003143;//kernel.TQuery:3143\n      a.apply("die");\n      return true;\n    },\n    fiber$die :function _trc_TQuery_f_die(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var a;\n      \n      //$LASTPOS=9003089;//kernel.TQuery:3089\n      a = _this.alive();\n      //$LASTPOS=9003108;//kernel.TQuery:3108\n      if (a.length==0) {\n        _thread.retVal=false;return;\n        \n      }\n      //$LASTPOS=9003143;//kernel.TQuery:3143\n      a.apply("die");\n      _thread.retVal=true;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    klass :function _trc_TQuery_klass(k) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.find((function anonymous_3207(o) {\n        \n        return o instanceof k;\n      }));\n    },\n    fiber$klass :function _trc_TQuery_f_klass(_thread,k) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.find((function anonymous_3207(o) {\n        \n        return o instanceof k;\n      }));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"tonyuIterator":{"nowait":false},"attr":{"nowait":false},"genKeyfunc":{"nowait":false},"maxs":{"nowait":false},"mins":{"nowait":false},"minObj":{"nowait":false},"maxObj":{"nowait":false},"nearests":{"nowait":false},"nearest":{"nowait":false},"withins":{"nowait":false},"within":{"nowait":false},"max":{"nowait":false},"min":{"nowait":false},"push":{"nowait":false},"size":{"nowait":false},"find":{"nowait":false},"find1":{"nowait":false},"apply":{"nowait":false},"alive":{"nowait":false},"die":{"nowait":false},"klass":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.InputDevice\',\n  shortName: \'InputDevice\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_InputDevice_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_InputDevice_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_InputDevice_initialize() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=10000091;//kernel.InputDevice:91\n      _this.listeners=[];\n      //$LASTPOS=10000110;//kernel.InputDevice:110\n      _this.touchEmu=true;\n    },\n    handleListeners :function _trc_InputDevice_handleListeners() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var l;\n      \n      //$LASTPOS=10000155;//kernel.InputDevice:155\n      l = _this.listeners;\n      //$LASTPOS=10000177;//kernel.InputDevice:177\n      _this.listeners=[];\n      //$LASTPOS=10000196;//kernel.InputDevice:196\n      while (l.length>0) {\n        //$LASTPOS=10000217;//kernel.InputDevice:217\n        (l.shift())();\n        \n      }\n    },\n    fiber$handleListeners :function _trc_InputDevice_f_handleListeners(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var l;\n      \n      //$LASTPOS=10000155;//kernel.InputDevice:155\n      l = _this.listeners;\n      //$LASTPOS=10000177;//kernel.InputDevice:177\n      _this.listeners=[];\n      \n      _thread.enter(function _trc_InputDevice_ent_handleListeners(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=10000196;//kernel.InputDevice:196\n          case 1:\n            if (!(l.length>0)) { __pc=2; break; }\n            {\n              //$LASTPOS=10000217;//kernel.InputDevice:217\n              (l.shift())();\n            }\n            __pc=1;break;\n          case 2:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    addOnetimeListener :function _trc_InputDevice_addOnetimeListener(l) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=10000267;//kernel.InputDevice:267\n      _this.listeners.push(l);\n    },\n    fiber$addOnetimeListener :function _trc_InputDevice_f_addOnetimeListener(_thread,l) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=10000267;//kernel.InputDevice:267\n      _this.listeners.push(l);\n      \n      _thread.retVal=_this;return;\n    },\n    initCanvasEvents :function _trc_InputDevice_initCanvasEvents(cvj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var cv;\n      var handleMouse;\n      var handleTouch;\n      var handleTouchEnd;\n      var d;\n      \n      //$LASTPOS=10000320;//kernel.InputDevice:320\n      cv = cvj[0];\n      //$LASTPOS=10000340;//kernel.InputDevice:340\n      Tonyu.globals.$handleMouse=(function anonymous_353(e) {\n        var p;\n        var mp;\n        \n        //$LASTPOS=10000369;//kernel.InputDevice:369\n        p = cvj.offset();\n        //$LASTPOS=10000398;//kernel.InputDevice:398\n        mp = {x: e.clientX-p.left,y: e.clientY-p.top};\n        //$LASTPOS=10000455;//kernel.InputDevice:455\n        mp=Tonyu.globals.$Screen.canvas2buf(mp);\n        //$LASTPOS=10000491;//kernel.InputDevice:491\n        Tonyu.globals.$mouseX=mp.x;\n        //$LASTPOS=10000514;//kernel.InputDevice:514\n        Tonyu.globals.$mouseY=mp.y;\n        //$LASTPOS=10000537;//kernel.InputDevice:537\n        if (_this.touchEmu) {\n          //$LASTPOS=10000566;//kernel.InputDevice:566\n          Tonyu.globals.$touches[0].x=mp.x;\n          //$LASTPOS=10000599;//kernel.InputDevice:599\n          Tonyu.globals.$touches[0].y=mp.y;\n          \n        }\n        //$LASTPOS=10000639;//kernel.InputDevice:639\n        _this.handleListeners();\n      });\n      //$LASTPOS=10000671;//kernel.InputDevice:671\n      Tonyu.globals.$touches=[{},{},{},{},{}];\n      //$LASTPOS=10000703;//kernel.InputDevice:703\n      Tonyu.globals.$touches.findById=(function anonymous_721(id) {\n        var j;\n        \n        //$LASTPOS=10000738;//kernel.InputDevice:738\n        //$LASTPOS=10000743;//kernel.InputDevice:743\n        j = 0;\n        while(j<Tonyu.globals.$touches.length) {\n          {\n            //$LASTPOS=10000793;//kernel.InputDevice:793\n            if (Tonyu.globals.$touches[j].identifier==id) {\n              return Tonyu.globals.$touches[j];\n              \n            }\n          }\n          j++;\n        }\n      });\n      //$LASTPOS=10000903;//kernel.InputDevice:903\n      Tonyu.globals.$handleTouch=(function anonymous_916(e) {\n        var p;\n        var ts;\n        var i;\n        var src;\n        var dst;\n        var j;\n        \n        //$LASTPOS=10000932;//kernel.InputDevice:932\n        T2MediaLib.activate();\n        //$LASTPOS=10000964;//kernel.InputDevice:964\n        _this.touchEmu=false;\n        //$LASTPOS=10000989;//kernel.InputDevice:989\n        p = cvj.offset();\n        //$LASTPOS=10001018;//kernel.InputDevice:1018\n        e.preventDefault();\n        //$LASTPOS=10001047;//kernel.InputDevice:1047\n        ts = e.originalEvent.changedTouches;\n        //$LASTPOS=10001095;//kernel.InputDevice:1095\n        //$LASTPOS=10001100;//kernel.InputDevice:1100\n        i = 0;\n        while(i<ts.length) {\n          {\n            //$LASTPOS=10001145;//kernel.InputDevice:1145\n            src = ts[i];\n            //$LASTPOS=10001173;//kernel.InputDevice:1173\n            dst = Tonyu.globals.$touches.findById(src.identifier);\n            //$LASTPOS=10001229;//kernel.InputDevice:1229\n            if (! dst) {\n              //$LASTPOS=10001258;//kernel.InputDevice:1258\n              //$LASTPOS=10001263;//kernel.InputDevice:1263\n              j = 0;\n              while(j<Tonyu.globals.$touches.length) {\n                {\n                  //$LASTPOS=10001321;//kernel.InputDevice:1321\n                  if (! Tonyu.globals.$touches[j].touched) {\n                    //$LASTPOS=10001374;//kernel.InputDevice:1374\n                    dst=Tonyu.globals.$touches[j];\n                    //$LASTPOS=10001416;//kernel.InputDevice:1416\n                    dst.identifier=src.identifier;\n                    break;\n                    \n                    \n                  }\n                }\n                j++;\n              }\n              \n            }\n            //$LASTPOS=10001549;//kernel.InputDevice:1549\n            if (dst) {\n              //$LASTPOS=10001577;//kernel.InputDevice:1577\n              _this.mp={x: src.pageX-p.left,y: src.pageY-p.top};\n              //$LASTPOS=10001638;//kernel.InputDevice:1638\n              _this.mp=Tonyu.globals.$Screen.canvas2buf(_this.mp);\n              //$LASTPOS=10001682;//kernel.InputDevice:1682\n              dst.x=_this.mp.x;\n              //$LASTPOS=10001711;//kernel.InputDevice:1711\n              dst.y=_this.mp.y;\n              //$LASTPOS=10001740;//kernel.InputDevice:1740\n              if (! dst.touched) {\n                //$LASTPOS=10001757;//kernel.InputDevice:1757\n                dst.touched=1;\n              }\n              \n            }\n          }\n          i++;\n        }\n        //$LASTPOS=10001807;//kernel.InputDevice:1807\n        Tonyu.globals.$mouseX=Tonyu.globals.$touches[0].x;\n        //$LASTPOS=10001839;//kernel.InputDevice:1839\n        Tonyu.globals.$mouseY=Tonyu.globals.$touches[0].y;\n        //$LASTPOS=10001871;//kernel.InputDevice:1871\n        _this.handleListeners();\n      });\n      //$LASTPOS=10001903;//kernel.InputDevice:1903\n      Tonyu.globals.$handleTouchEnd=(function anonymous_1919(e) {\n        var ts;\n        var i;\n        var src;\n        var dst;\n        \n        //$LASTPOS=10001935;//kernel.InputDevice:1935\n        ts = e.originalEvent.changedTouches;\n        //$LASTPOS=10001983;//kernel.InputDevice:1983\n        //$LASTPOS=10001988;//kernel.InputDevice:1988\n        i = 0;\n        while(i<ts.length) {\n          {\n            //$LASTPOS=10002033;//kernel.InputDevice:2033\n            src = ts[i];\n            //$LASTPOS=10002061;//kernel.InputDevice:2061\n            dst = Tonyu.globals.$touches.findById(src.identifier);\n            //$LASTPOS=10002117;//kernel.InputDevice:2117\n            if (dst) {\n              //$LASTPOS=10002145;//kernel.InputDevice:2145\n              dst.touched=0;\n              //$LASTPOS=10002177;//kernel.InputDevice:2177\n              dst.identifier=- 1;\n              \n            }\n          }\n          i++;\n        }\n        //$LASTPOS=10002231;//kernel.InputDevice:2231\n        _this.handleListeners();\n      });\n      //$LASTPOS=10002263;//kernel.InputDevice:2263\n      handleMouse = (function anonymous_2279(e) {\n        \n        //$LASTPOS=10002284;//kernel.InputDevice:2284\n        Tonyu.globals.$handleMouse(e);\n      });\n      //$LASTPOS=10002308;//kernel.InputDevice:2308\n      handleTouch = (function anonymous_2324(e) {\n        \n        //$LASTPOS=10002329;//kernel.InputDevice:2329\n        Tonyu.globals.$handleTouch(e);\n      });\n      //$LASTPOS=10002353;//kernel.InputDevice:2353\n      handleTouchEnd = (function anonymous_2372(e) {\n        \n        //$LASTPOS=10002377;//kernel.InputDevice:2377\n        Tonyu.globals.$handleTouchEnd(e);\n      });\n      //$LASTPOS=10002404;//kernel.InputDevice:2404\n      d = $.data(cv,"events");\n      //$LASTPOS=10002436;//kernel.InputDevice:2436\n      if (! d) {\n        //$LASTPOS=10002455;//kernel.InputDevice:2455\n        $.data(cv,"events","true");\n        //$LASTPOS=10002492;//kernel.InputDevice:2492\n        cvj.mousedown(handleMouse);\n        //$LASTPOS=10002529;//kernel.InputDevice:2529\n        cvj.mousemove(handleMouse);\n        //$LASTPOS=10002566;//kernel.InputDevice:2566\n        cvj.on("touchstart",handleTouch);\n        //$LASTPOS=10002609;//kernel.InputDevice:2609\n        cvj.on("touchmove",handleTouch);\n        //$LASTPOS=10002651;//kernel.InputDevice:2651\n        cvj.on("touchend",handleTouchEnd);\n        \n      }\n    },\n    fiber$initCanvasEvents :function _trc_InputDevice_f_initCanvasEvents(_thread,cvj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var cv;\n      var handleMouse;\n      var handleTouch;\n      var handleTouchEnd;\n      var d;\n      \n      //$LASTPOS=10000320;//kernel.InputDevice:320\n      cv = cvj[0];\n      \n      _thread.enter(function _trc_InputDevice_ent_initCanvasEvents(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=10000340;//kernel.InputDevice:340\n            Tonyu.globals.$handleMouse=(function anonymous_353(e) {\n              var p;\n              var mp;\n              \n              //$LASTPOS=10000369;//kernel.InputDevice:369\n              p = cvj.offset();\n              //$LASTPOS=10000398;//kernel.InputDevice:398\n              mp = {x: e.clientX-p.left,y: e.clientY-p.top};\n              //$LASTPOS=10000455;//kernel.InputDevice:455\n              mp=Tonyu.globals.$Screen.canvas2buf(mp);\n              //$LASTPOS=10000491;//kernel.InputDevice:491\n              Tonyu.globals.$mouseX=mp.x;\n              //$LASTPOS=10000514;//kernel.InputDevice:514\n              Tonyu.globals.$mouseY=mp.y;\n              //$LASTPOS=10000537;//kernel.InputDevice:537\n              if (_this.touchEmu) {\n                //$LASTPOS=10000566;//kernel.InputDevice:566\n                Tonyu.globals.$touches[0].x=mp.x;\n                //$LASTPOS=10000599;//kernel.InputDevice:599\n                Tonyu.globals.$touches[0].y=mp.y;\n                \n              }\n              //$LASTPOS=10000639;//kernel.InputDevice:639\n              _this.handleListeners();\n            });\n            //$LASTPOS=10000671;//kernel.InputDevice:671\n            Tonyu.globals.$touches=[{},{},{},{},{}];\n            //$LASTPOS=10000703;//kernel.InputDevice:703\n            Tonyu.globals.$touches.findById=(function anonymous_721(id) {\n              var j;\n              \n              //$LASTPOS=10000738;//kernel.InputDevice:738\n              //$LASTPOS=10000743;//kernel.InputDevice:743\n              j = 0;\n              while(j<Tonyu.globals.$touches.length) {\n                {\n                  //$LASTPOS=10000793;//kernel.InputDevice:793\n                  if (Tonyu.globals.$touches[j].identifier==id) {\n                    return Tonyu.globals.$touches[j];\n                    \n                  }\n                }\n                j++;\n              }\n            });\n            //$LASTPOS=10000903;//kernel.InputDevice:903\n            Tonyu.globals.$handleTouch=(function anonymous_916(e) {\n              var p;\n              var ts;\n              var i;\n              var src;\n              var dst;\n              var j;\n              \n              //$LASTPOS=10000932;//kernel.InputDevice:932\n              T2MediaLib.activate();\n              //$LASTPOS=10000964;//kernel.InputDevice:964\n              _this.touchEmu=false;\n              //$LASTPOS=10000989;//kernel.InputDevice:989\n              p = cvj.offset();\n              //$LASTPOS=10001018;//kernel.InputDevice:1018\n              e.preventDefault();\n              //$LASTPOS=10001047;//kernel.InputDevice:1047\n              ts = e.originalEvent.changedTouches;\n              //$LASTPOS=10001095;//kernel.InputDevice:1095\n              //$LASTPOS=10001100;//kernel.InputDevice:1100\n              i = 0;\n              while(i<ts.length) {\n                {\n                  //$LASTPOS=10001145;//kernel.InputDevice:1145\n                  src = ts[i];\n                  //$LASTPOS=10001173;//kernel.InputDevice:1173\n                  dst = Tonyu.globals.$touches.findById(src.identifier);\n                  //$LASTPOS=10001229;//kernel.InputDevice:1229\n                  if (! dst) {\n                    //$LASTPOS=10001258;//kernel.InputDevice:1258\n                    //$LASTPOS=10001263;//kernel.InputDevice:1263\n                    j = 0;\n                    while(j<Tonyu.globals.$touches.length) {\n                      {\n                        //$LASTPOS=10001321;//kernel.InputDevice:1321\n                        if (! Tonyu.globals.$touches[j].touched) {\n                          //$LASTPOS=10001374;//kernel.InputDevice:1374\n                          dst=Tonyu.globals.$touches[j];\n                          //$LASTPOS=10001416;//kernel.InputDevice:1416\n                          dst.identifier=src.identifier;\n                          break;\n                          \n                          \n                        }\n                      }\n                      j++;\n                    }\n                    \n                  }\n                  //$LASTPOS=10001549;//kernel.InputDevice:1549\n                  if (dst) {\n                    //$LASTPOS=10001577;//kernel.InputDevice:1577\n                    _this.mp={x: src.pageX-p.left,y: src.pageY-p.top};\n                    //$LASTPOS=10001638;//kernel.InputDevice:1638\n                    _this.mp=Tonyu.globals.$Screen.canvas2buf(_this.mp);\n                    //$LASTPOS=10001682;//kernel.InputDevice:1682\n                    dst.x=_this.mp.x;\n                    //$LASTPOS=10001711;//kernel.InputDevice:1711\n                    dst.y=_this.mp.y;\n                    //$LASTPOS=10001740;//kernel.InputDevice:1740\n                    if (! dst.touched) {\n                      //$LASTPOS=10001757;//kernel.InputDevice:1757\n                      dst.touched=1;\n                    }\n                    \n                  }\n                }\n                i++;\n              }\n              //$LASTPOS=10001807;//kernel.InputDevice:1807\n              Tonyu.globals.$mouseX=Tonyu.globals.$touches[0].x;\n              //$LASTPOS=10001839;//kernel.InputDevice:1839\n              Tonyu.globals.$mouseY=Tonyu.globals.$touches[0].y;\n              //$LASTPOS=10001871;//kernel.InputDevice:1871\n              _this.handleListeners();\n            });\n            //$LASTPOS=10001903;//kernel.InputDevice:1903\n            Tonyu.globals.$handleTouchEnd=(function anonymous_1919(e) {\n              var ts;\n              var i;\n              var src;\n              var dst;\n              \n              //$LASTPOS=10001935;//kernel.InputDevice:1935\n              ts = e.originalEvent.changedTouches;\n              //$LASTPOS=10001983;//kernel.InputDevice:1983\n              //$LASTPOS=10001988;//kernel.InputDevice:1988\n              i = 0;\n              while(i<ts.length) {\n                {\n                  //$LASTPOS=10002033;//kernel.InputDevice:2033\n                  src = ts[i];\n                  //$LASTPOS=10002061;//kernel.InputDevice:2061\n                  dst = Tonyu.globals.$touches.findById(src.identifier);\n                  //$LASTPOS=10002117;//kernel.InputDevice:2117\n                  if (dst) {\n                    //$LASTPOS=10002145;//kernel.InputDevice:2145\n                    dst.touched=0;\n                    //$LASTPOS=10002177;//kernel.InputDevice:2177\n                    dst.identifier=- 1;\n                    \n                  }\n                }\n                i++;\n              }\n              //$LASTPOS=10002231;//kernel.InputDevice:2231\n              _this.handleListeners();\n            });\n            //$LASTPOS=10002263;//kernel.InputDevice:2263\n            handleMouse = (function anonymous_2279(e) {\n              \n              //$LASTPOS=10002284;//kernel.InputDevice:2284\n              Tonyu.globals.$handleMouse(e);\n            });\n            //$LASTPOS=10002308;//kernel.InputDevice:2308\n            handleTouch = (function anonymous_2324(e) {\n              \n              //$LASTPOS=10002329;//kernel.InputDevice:2329\n              Tonyu.globals.$handleTouch(e);\n            });\n            //$LASTPOS=10002353;//kernel.InputDevice:2353\n            handleTouchEnd = (function anonymous_2372(e) {\n              \n              //$LASTPOS=10002377;//kernel.InputDevice:2377\n              Tonyu.globals.$handleTouchEnd(e);\n            });\n            //$LASTPOS=10002404;//kernel.InputDevice:2404\n            d = $.data(cv,"events");\n            //$LASTPOS=10002436;//kernel.InputDevice:2436\n            if (! d) {\n              //$LASTPOS=10002455;//kernel.InputDevice:2455\n              $.data(cv,"events","true");\n              //$LASTPOS=10002492;//kernel.InputDevice:2492\n              cvj.mousedown(handleMouse);\n              //$LASTPOS=10002529;//kernel.InputDevice:2529\n              cvj.mousemove(handleMouse);\n              //$LASTPOS=10002566;//kernel.InputDevice:2566\n              cvj.on("touchstart",handleTouch);\n              //$LASTPOS=10002609;//kernel.InputDevice:2609\n              cvj.on("touchmove",handleTouch);\n              //$LASTPOS=10002651;//kernel.InputDevice:2651\n              cvj.on("touchend",handleTouchEnd);\n              \n            }\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    update :function _trc_InputDevice_update() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var _it_108;\n      \n      //$LASTPOS=10002716;//kernel.InputDevice:2716\n      _it_108=Tonyu.iterator(Tonyu.globals.$touches,1);\n      while(_it_108.next()) {\n        i=_it_108[0];\n        \n        //$LASTPOS=10002751;//kernel.InputDevice:2751\n        if (i.touched>0) {\n          //$LASTPOS=10002769;//kernel.InputDevice:2769\n          i.touched++;\n          \n        }\n        //$LASTPOS=10002792;//kernel.InputDevice:2792\n        if (i.touched==- 1) {\n          //$LASTPOS=10002811;//kernel.InputDevice:2811\n          i.touched=1;\n        }\n        \n      }\n    },\n    fiber$update :function _trc_InputDevice_f_update(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var _it_108;\n      \n      //$LASTPOS=10002716;//kernel.InputDevice:2716\n      _it_108=Tonyu.iterator(Tonyu.globals.$touches,1);\n      while(_it_108.next()) {\n        i=_it_108[0];\n        \n        //$LASTPOS=10002751;//kernel.InputDevice:2751\n        if (i.touched>0) {\n          //$LASTPOS=10002769;//kernel.InputDevice:2769\n          i.touched++;\n          \n        }\n        //$LASTPOS=10002792;//kernel.InputDevice:2792\n        if (i.touched==- 1) {\n          //$LASTPOS=10002811;//kernel.InputDevice:2811\n          i.touched=1;\n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"handleListeners":{"nowait":false},"addOnetimeListener":{"nowait":false},"initCanvasEvents":{"nowait":false},"update":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Keys\',\n  shortName: \'Keys\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [],\n  methods: {\n    main :function _trc_Keys_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      \n      //$LASTPOS=11000084;//kernel.Keys:84\n      _this.stats={};\n      //$LASTPOS=11000094;//kernel.Keys:94\n      _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,mouseleft: 1};\n      //$LASTPOS=11000212;//kernel.Keys:212\n      //$LASTPOS=11000217;//kernel.Keys:217\n      i = 65;\n      while(i<65+26) {\n        {\n          //$LASTPOS=11000248;//kernel.Keys:248\n          _this.codes[String.fromCharCode(i).toLowerCase()]=i;\n        }\n        i++;\n      }\n      //$LASTPOS=11000297;//kernel.Keys:297\n      //$LASTPOS=11000302;//kernel.Keys:302\n      i = 48;\n      while(i<58) {\n        {\n          //$LASTPOS=11000330;//kernel.Keys:330\n          _this.codes[String.fromCharCode(i)]=i;\n        }\n        i++;\n      }\n      //$LASTPOS=11000365;//kernel.Keys:365\n      if (! $.data(document,"key_event")) {\n        //$LASTPOS=11000406;//kernel.Keys:406\n        $.data(document,"key_event",true);\n        //$LASTPOS=11000445;//kernel.Keys:445\n        $(document).keydown((function anonymous_465(e) {\n          \n          //$LASTPOS=11000471;//kernel.Keys:471\n          Tonyu.globals.$Keys.keydown(e);\n        }));\n        //$LASTPOS=11000495;//kernel.Keys:495\n        $(document).keyup((function anonymous_513(e) {\n          \n          //$LASTPOS=11000519;//kernel.Keys:519\n          Tonyu.globals.$Keys.keyup(e);\n        }));\n        //$LASTPOS=11000541;//kernel.Keys:541\n        $(document).mousedown((function anonymous_563(e) {\n          \n          //$LASTPOS=11000578;//kernel.Keys:578\n          if (Tonyu.globals.$InputDevice.touchEmu) {\n            //$LASTPOS=11000619;//kernel.Keys:619\n            Tonyu.globals.$touches[0].touched=1;\n            \n          }\n          //$LASTPOS=11000660;//kernel.Keys:660\n          Tonyu.globals.$Keys.keydown({keyCode: 1});\n        }));\n        //$LASTPOS=11000697;//kernel.Keys:697\n        $(document).mouseup((function anonymous_717(e) {\n          \n          //$LASTPOS=11000732;//kernel.Keys:732\n          if (Tonyu.globals.$InputDevice.touchEmu) {\n            //$LASTPOS=11000773;//kernel.Keys:773\n            Tonyu.globals.$touches[0].touched=0;\n            \n          }\n          //$LASTPOS=11000814;//kernel.Keys:814\n          Tonyu.globals.$Keys.keyup({keyCode: 1});\n        }));\n        \n      }\n    },\n    fiber$main :function _trc_Keys_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      \n      //$LASTPOS=11000084;//kernel.Keys:84\n      _this.stats={};\n      //$LASTPOS=11000094;//kernel.Keys:94\n      _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,mouseleft: 1};\n      //$LASTPOS=11000212;//kernel.Keys:212\n      //$LASTPOS=11000217;//kernel.Keys:217\n      i = 65;\n      while(i<65+26) {\n        {\n          //$LASTPOS=11000248;//kernel.Keys:248\n          _this.codes[String.fromCharCode(i).toLowerCase()]=i;\n        }\n        i++;\n      }\n      //$LASTPOS=11000297;//kernel.Keys:297\n      //$LASTPOS=11000302;//kernel.Keys:302\n      i = 48;\n      while(i<58) {\n        {\n          //$LASTPOS=11000330;//kernel.Keys:330\n          _this.codes[String.fromCharCode(i)]=i;\n        }\n        i++;\n      }\n      //$LASTPOS=11000365;//kernel.Keys:365\n      if (! $.data(document,"key_event")) {\n        //$LASTPOS=11000406;//kernel.Keys:406\n        $.data(document,"key_event",true);\n        //$LASTPOS=11000445;//kernel.Keys:445\n        $(document).keydown((function anonymous_465(e) {\n          \n          //$LASTPOS=11000471;//kernel.Keys:471\n          Tonyu.globals.$Keys.keydown(e);\n        }));\n        //$LASTPOS=11000495;//kernel.Keys:495\n        $(document).keyup((function anonymous_513(e) {\n          \n          //$LASTPOS=11000519;//kernel.Keys:519\n          Tonyu.globals.$Keys.keyup(e);\n        }));\n        //$LASTPOS=11000541;//kernel.Keys:541\n        $(document).mousedown((function anonymous_563(e) {\n          \n          //$LASTPOS=11000578;//kernel.Keys:578\n          if (Tonyu.globals.$InputDevice.touchEmu) {\n            //$LASTPOS=11000619;//kernel.Keys:619\n            Tonyu.globals.$touches[0].touched=1;\n            \n          }\n          //$LASTPOS=11000660;//kernel.Keys:660\n          Tonyu.globals.$Keys.keydown({keyCode: 1});\n        }));\n        //$LASTPOS=11000697;//kernel.Keys:697\n        $(document).mouseup((function anonymous_717(e) {\n          \n          //$LASTPOS=11000732;//kernel.Keys:732\n          if (Tonyu.globals.$InputDevice.touchEmu) {\n            //$LASTPOS=11000773;//kernel.Keys:773\n            Tonyu.globals.$touches[0].touched=0;\n            \n          }\n          //$LASTPOS=11000814;//kernel.Keys:814\n          Tonyu.globals.$Keys.keyup({keyCode: 1});\n        }));\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    getkey :function _trc_Keys_getkey(code) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11000875;//kernel.Keys:875\n      if (typeof  code=="string") {\n        //$LASTPOS=11000912;//kernel.Keys:912\n        code=_this.codes[code.toLowerCase()];\n        \n      }\n      //$LASTPOS=11000954;//kernel.Keys:954\n      if (! code) {\n        return 0;\n      }\n      //$LASTPOS=11000979;//kernel.Keys:979\n      if (_this.stats[code]==- 1) {\n        return 0;\n      }\n      //$LASTPOS=11001014;//kernel.Keys:1014\n      if (! _this.stats[code]) {\n        //$LASTPOS=11001032;//kernel.Keys:1032\n        _this.stats[code]=0;\n      }\n      return _this.stats[code];\n    },\n    fiber$getkey :function _trc_Keys_f_getkey(_thread,code) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=11000875;//kernel.Keys:875\n      if (typeof  code=="string") {\n        //$LASTPOS=11000912;//kernel.Keys:912\n        code=_this.codes[code.toLowerCase()];\n        \n      }\n      //$LASTPOS=11000954;//kernel.Keys:954\n      if (! code) {\n        _thread.retVal=0;return;\n        \n      }\n      //$LASTPOS=11000979;//kernel.Keys:979\n      if (_this.stats[code]==- 1) {\n        _thread.retVal=0;return;\n        \n      }\n      //$LASTPOS=11001014;//kernel.Keys:1014\n      if (! _this.stats[code]) {\n        //$LASTPOS=11001032;//kernel.Keys:1032\n        _this.stats[code]=0;\n      }\n      _thread.retVal=_this.stats[code];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    update :function _trc_Keys_update() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var _it_116;\n      \n      //$LASTPOS=11001097;//kernel.Keys:1097\n      _it_116=Tonyu.iterator(_this.stats,1);\n      while(_it_116.next()) {\n        i=_it_116[0];\n        \n        //$LASTPOS=11001128;//kernel.Keys:1128\n        if (_this.stats[i]>0) {\n          //$LASTPOS=11001145;//kernel.Keys:1145\n          _this.stats[i]++;\n          \n        }\n        //$LASTPOS=11001166;//kernel.Keys:1166\n        if (_this.stats[i]==- 1) {\n          //$LASTPOS=11001184;//kernel.Keys:1184\n          _this.stats[i]=1;\n        }\n        \n      }\n    },\n    fiber$update :function _trc_Keys_f_update(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var _it_116;\n      \n      //$LASTPOS=11001097;//kernel.Keys:1097\n      _it_116=Tonyu.iterator(_this.stats,1);\n      while(_it_116.next()) {\n        i=_it_116[0];\n        \n        //$LASTPOS=11001128;//kernel.Keys:1128\n        if (_this.stats[i]>0) {\n          //$LASTPOS=11001145;//kernel.Keys:1145\n          _this.stats[i]++;\n          \n        }\n        //$LASTPOS=11001166;//kernel.Keys:1166\n        if (_this.stats[i]==- 1) {\n          //$LASTPOS=11001184;//kernel.Keys:1184\n          _this.stats[i]=1;\n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    keydown :function _trc_Keys_keydown(e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var s;\n      \n      //$LASTPOS=11001222;//kernel.Keys:1222\n      s = _this.stats[e.keyCode];\n      //$LASTPOS=11001250;//kernel.Keys:1250\n      if (! s) {\n        //$LASTPOS=11001268;//kernel.Keys:1268\n        _this.stats[e.keyCode]=1;\n        \n      }\n      //$LASTPOS=11001298;//kernel.Keys:1298\n      Tonyu.globals.$InputDevice.handleListeners();\n    },\n    fiber$keydown :function _trc_Keys_f_keydown(_thread,e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var s;\n      \n      //$LASTPOS=11001222;//kernel.Keys:1222\n      s = _this.stats[e.keyCode];\n      //$LASTPOS=11001250;//kernel.Keys:1250\n      if (! s) {\n        //$LASTPOS=11001268;//kernel.Keys:1268\n        _this.stats[e.keyCode]=1;\n        \n      }\n      //$LASTPOS=11001298;//kernel.Keys:1298\n      Tonyu.globals.$InputDevice.handleListeners();\n      \n      _thread.retVal=_this;return;\n    },\n    keyup :function _trc_Keys_keyup(e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11001348;//kernel.Keys:1348\n      _this.stats[e.keyCode]=0;\n      //$LASTPOS=11001372;//kernel.Keys:1372\n      Tonyu.globals.$InputDevice.handleListeners();\n    },\n    fiber$keyup :function _trc_Keys_f_keyup(_thread,e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=11001348;//kernel.Keys:1348\n      _this.stats[e.keyCode]=0;\n      //$LASTPOS=11001372;//kernel.Keys:1372\n      Tonyu.globals.$InputDevice.handleListeners();\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"getkey":{"nowait":false},"update":{"nowait":false},"keydown":{"nowait":false},"keyup":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.BaseActor\',\n  shortName: \'BaseActor\',\n  namespace: \'kernel\',\n  includes: [Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.TextRectMod,Tonyu.classes.kernel.OneframeSpriteMod,Tonyu.classes.kernel.ThreadGroupMod,Tonyu.classes.kernel.EventHandlerCaller],\n  methods: {\n    main :function _trc_BaseActor_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_BaseActor_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_BaseActor_initialize(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12000248;//kernel.BaseActor:248\n      _this._th=Tonyu.globals.$Boot.schedule(_this,"main",[]);\n      //$LASTPOS=12000293;//kernel.BaseActor:293\n      _this.registerEventHandler("screenOut",new Tonyu.classes.kernel.ScreenOutHandler);\n      //$LASTPOS=12000358;//kernel.BaseActor:358\n      _this.registerEventHandler("crashTo",new Tonyu.classes.kernel.CrashToHandler);\n      //$LASTPOS=12000419;//kernel.BaseActor:419\n      _this.registerEventHandler("within",new Tonyu.classes.kernel.WithinHandler);\n      //$LASTPOS=12000483;//kernel.BaseActor:483\n      if (typeof  x=="object") {\n        //$LASTPOS=12000507;//kernel.BaseActor:507\n        Tonyu.extend(_this,x);\n      } else {\n        //$LASTPOS=12000539;//kernel.BaseActor:539\n        if (typeof  x=="number") {\n          //$LASTPOS=12000574;//kernel.BaseActor:574\n          _this.x=x;\n          //$LASTPOS=12000593;//kernel.BaseActor:593\n          _this.y=y;\n          //$LASTPOS=12000612;//kernel.BaseActor:612\n          _this.p=p;\n          \n        }\n      }\n      //$LASTPOS=12000634;//kernel.BaseActor:634\n      if (_this.scaleX==null) {\n        //$LASTPOS=12000652;//kernel.BaseActor:652\n        _this.scaleX=1;\n      }\n      //$LASTPOS=12000667;//kernel.BaseActor:667\n      if (_this.rotation==null) {\n        //$LASTPOS=12000687;//kernel.BaseActor:687\n        _this.rotation=0;\n      }\n      //$LASTPOS=12000704;//kernel.BaseActor:704\n      if (_this.rotate==null) {\n        //$LASTPOS=12000722;//kernel.BaseActor:722\n        _this.rotate=0;\n      }\n      //$LASTPOS=12000737;//kernel.BaseActor:737\n      if (_this.alpha==null) {\n        //$LASTPOS=12000754;//kernel.BaseActor:754\n        _this.alpha=255;\n      }\n      //$LASTPOS=12000770;//kernel.BaseActor:770\n      if (_this.zOrder==null) {\n        //$LASTPOS=12000788;//kernel.BaseActor:788\n        _this.zOrder=0;\n      }\n      //$LASTPOS=12000803;//kernel.BaseActor:803\n      if (_this.age==null) {\n        //$LASTPOS=12000818;//kernel.BaseActor:818\n        _this.age=0;\n      }\n      //$LASTPOS=12000830;//kernel.BaseActor:830\n      if (_this.anim!=null&&typeof  _this.anim=="object") {\n        //$LASTPOS=12000881;//kernel.BaseActor:881\n        _this.animMode=true;\n        //$LASTPOS=12000905;//kernel.BaseActor:905\n        _this.animFrame=0;\n        \n      } else {\n        //$LASTPOS=12000939;//kernel.BaseActor:939\n        _this.animMode=false;\n        \n      }\n      //$LASTPOS=12000967;//kernel.BaseActor:967\n      if (_this.animFps==null) {\n        //$LASTPOS=12000986;//kernel.BaseActor:986\n        _this.animFps=1;\n      }\n    },\n    extend :function _trc_BaseActor_extend(obj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.extend(_this,obj);\n    },\n    print :function _trc_BaseActor_print(pt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var mergedArg;\n      var argCount;\n      var printCount;\n      \n      //$LASTPOS=12001090;//kernel.BaseActor:1090\n      console.log.apply(console,arguments);\n      //$LASTPOS=12001133;//kernel.BaseActor:1133\n      mergedArg = "";\n      //$LASTPOS=12001156;//kernel.BaseActor:1156\n      if (Tonyu.globals.$consolePanel) {\n        //$LASTPOS=12001184;//kernel.BaseActor:1184\n        //$LASTPOS=12001188;//kernel.BaseActor:1188\n        argCount = 0;\n        while(argCount<arguments.length) {\n          {\n            //$LASTPOS=12001255;//kernel.BaseActor:1255\n            mergedArg=mergedArg+arguments[argCount]+" ";\n          }\n          argCount++;\n        }\n        //$LASTPOS=12001320;//kernel.BaseActor:1320\n        _this.splits=mergedArg.split("\\n");\n        //$LASTPOS=12001359;//kernel.BaseActor:1359\n        //$LASTPOS=12001363;//kernel.BaseActor:1363\n        printCount = 0;\n        while(printCount<_this.splits.length) {\n          {\n            //$LASTPOS=12001433;//kernel.BaseActor:1433\n            Tonyu.globals.$consolePanel.scroll(0,20);\n            //$LASTPOS=12001474;//kernel.BaseActor:1474\n            Tonyu.globals.$consolePanel.setFillStyle("white");\n            //$LASTPOS=12001524;//kernel.BaseActor:1524\n            Tonyu.globals.$consolePanel.fillText(_this.splits[printCount],0,Tonyu.globals.$consolePrintY,20,"left");\n          }\n          printCount++;\n        }\n        \n      }\n    },\n    setAnimFps :function _trc_BaseActor_setAnimFps(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12001647;//kernel.BaseActor:1647\n      _this.animFps=f;\n      //$LASTPOS=12001668;//kernel.BaseActor:1668\n      _this.animFrame=0;\n      //$LASTPOS=12001691;//kernel.BaseActor:1691\n      _this.animMode=true;\n    },\n    startAnim :function _trc_BaseActor_startAnim() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12001741;//kernel.BaseActor:1741\n      _this.animMode=true;\n    },\n    stopAnim :function _trc_BaseActor_stopAnim() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12001790;//kernel.BaseActor:1790\n      _this.animMode=false;\n    },\n    update :function _trc_BaseActor_update() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12001832;//kernel.BaseActor:1832\n      _this.onUpdate();\n      //$LASTPOS=12001849;//kernel.BaseActor:1849\n      if (null) {\n        //$LASTPOS=12001872;//kernel.BaseActor:1872\n        null.suspend();\n        //$LASTPOS=12001900;//kernel.BaseActor:1900\n        if (Tonyu.globals.$Scheduler) {\n          //$LASTPOS=12001916;//kernel.BaseActor:1916\n          Tonyu.globals.$Scheduler.addToNext(null);\n        }\n        \n      }\n    },\n    fiber$update :function _trc_BaseActor_f_update(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=12001832;//kernel.BaseActor:1832\n      _this.onUpdate();\n      //$LASTPOS=12001849;//kernel.BaseActor:1849\n      if (_thread) {\n        //$LASTPOS=12001872;//kernel.BaseActor:1872\n        _thread.suspend();\n        //$LASTPOS=12001900;//kernel.BaseActor:1900\n        if (Tonyu.globals.$Scheduler) {\n          //$LASTPOS=12001916;//kernel.BaseActor:1916\n          Tonyu.globals.$Scheduler.addToNext(_thread);\n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    onUpdate :function _trc_BaseActor_onUpdate() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    updateEx :function _trc_BaseActor_updateEx(updateT) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var updateCount;\n      \n      //$LASTPOS=12002010;//kernel.BaseActor:2010\n      //$LASTPOS=12002014;//kernel.BaseActor:2014\n      updateCount = 0;\n      while(updateCount<updateT) {\n        {\n          //$LASTPOS=12002077;//kernel.BaseActor:2077\n          _this.update();\n        }\n        updateCount++;\n      }\n    },\n    fiber$updateEx :function _trc_BaseActor_f_updateEx(_thread,updateT) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var updateCount;\n      \n      \n      _thread.enter(function _trc_BaseActor_ent_updateEx(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=12002010;//kernel.BaseActor:2010\n            //$LASTPOS=12002014;//kernel.BaseActor:2014\n            updateCount = 0;;\n          case 1:\n            if (!(updateCount<updateT)) { __pc=3; break; }\n            //$LASTPOS=12002077;//kernel.BaseActor:2077\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            updateCount++;\n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    getkey :function _trc_BaseActor_getkey(k) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.globals.$Keys.getkey(k);\n    },\n    hitTo :function _trc_BaseActor_hitTo(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.crashTo(t);\n    },\n    all :function _trc_BaseActor_all(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      \n      //$LASTPOS=12002220;//kernel.BaseActor:2220\n      res = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=12002245;//kernel.BaseActor:2245\n      if (arguments.length>0&&typeof  c!="function") {\n        return res;\n        \n      }\n      //$LASTPOS=12002328;//kernel.BaseActor:2328\n      Tonyu.globals.$Sprites.sprites.forEach((function anonymous_2353(s) {\n        \n        //$LASTPOS=12002369;//kernel.BaseActor:2369\n        if (s===_this) {\n          return _this;\n        }\n        //$LASTPOS=12002400;//kernel.BaseActor:2400\n        if (! c||s instanceof c) {\n          //$LASTPOS=12002441;//kernel.BaseActor:2441\n          res.push(s);\n          \n        }\n      }));\n      return res;\n    },\n    allCrash :function _trc_BaseActor_allCrash(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      var sp;\n      var t1;\n      \n      //$LASTPOS=12002548;//kernel.BaseActor:2548\n      res = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=12002573;//kernel.BaseActor:2573\n      sp = _this;\n      //$LASTPOS=12002610;//kernel.BaseActor:2610\n      t1 = _this.getCrashRect();\n      //$LASTPOS=12002638;//kernel.BaseActor:2638\n      if (! t1) {\n        return res;\n      }\n      //$LASTPOS=12002664;//kernel.BaseActor:2664\n      Tonyu.globals.$Sprites.sprites.forEach((function anonymous_2689(s) {\n        var t2;\n        \n        //$LASTPOS=12002705;//kernel.BaseActor:2705\n        t2;\n        //$LASTPOS=12002722;//kernel.BaseActor:2722\n        if (s!==_this&&! s.excludeFromAll&&s instanceof t&&(t2=s.getCrashRect())&&Math.abs(t1.x-t2.x)*2<t1.width+t2.width&&Math.abs(t1.y-t2.y)*2<t1.height+t2.height) {\n          //$LASTPOS=12002948;//kernel.BaseActor:2948\n          res.push(s);\n          \n        }\n      }));\n      return res;\n    },\n    crashTo :function _trc_BaseActor_crashTo(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12003028;//kernel.BaseActor:3028\n      if (! t) {\n        return false;\n      }\n      //$LASTPOS=12003055;//kernel.BaseActor:3055\n      if (typeof  t=="function") {\n        return _this.allCrash(t)[0];\n        \n      }\n      return _this.crashTo1(t);\n    },\n    crashTo1 :function _trc_BaseActor_crashTo1(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var t1;\n      var t2;\n      \n      //$LASTPOS=12003178;//kernel.BaseActor:3178\n      if (! t||t._isDead) {\n        return false;\n      }\n      //$LASTPOS=12003306;//kernel.BaseActor:3306\n      t1 = _this.getCrashRect();\n      //$LASTPOS=12003334;//kernel.BaseActor:3334\n      t2 = t.getCrashRect();\n      return t1&&t2&&Math.abs(t1.x-t2.x)*2<t1.width+t2.width&&Math.abs(t1.y-t2.y)*2<t1.height+t2.height;\n    },\n    crashToChecker :function _trc_BaseActor_crashToChecker(d,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var obj;\n      var _it_133;\n      \n      //$LASTPOS=12003643;//kernel.BaseActor:3643\n      while (true) {\n        //$LASTPOS=12003665;//kernel.BaseActor:3665\n        if (typeof  d=="function") {\n          //$LASTPOS=12003704;//kernel.BaseActor:3704\n          _it_133=Tonyu.iterator(_this.allCrash(d),1);\n          while(_it_133.next()) {\n            obj=_it_133[0];\n            \n            //$LASTPOS=12003746;//kernel.BaseActor:3746\n            _this.callEventHandler(f,[obj]);\n            \n          }\n          \n        } else {\n          //$LASTPOS=12003803;//kernel.BaseActor:3803\n          if (_this.crashTo(d)) {\n            //$LASTPOS=12003832;//kernel.BaseActor:3832\n            _this.callEventHandler(f,[d]);\n            \n          }\n        }\n        //$LASTPOS=12003877;//kernel.BaseActor:3877\n        _this.update();\n        \n      }\n    },\n    fiber$crashToChecker :function _trc_BaseActor_f_crashToChecker(_thread,d,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var obj;\n      var _it_133;\n      \n      \n      _thread.enter(function _trc_BaseActor_ent_crashToChecker(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=12003643;//kernel.BaseActor:3643\n          case 1:\n            //$LASTPOS=12003665;//kernel.BaseActor:3665\n            if (!(typeof  d=="function")) { __pc=5; break; }\n            //$LASTPOS=12003704;//kernel.BaseActor:3704\n            _it_133=Tonyu.iterator(_this.allCrash(d),1);\n          case 2:\n            if (!(_it_133.next())) { __pc=4; break; }\n            obj=_it_133[0];\n            \n            //$LASTPOS=12003746;//kernel.BaseActor:3746\n            _this.fiber$callEventHandler(_thread, f, [obj]);\n            __pc=3;return;\n          case 3:\n            \n            __pc=2;break;\n          case 4:\n            \n            __pc=8;break;\n          case 5:\n            //$LASTPOS=12003803;//kernel.BaseActor:3803\n            if (!(_this.crashTo(d))) { __pc=7; break; }\n            //$LASTPOS=12003832;//kernel.BaseActor:3832\n            _this.fiber$callEventHandler(_thread, f, [d]);\n            __pc=6;return;\n          case 6:\n            \n          case 7:\n            \n          case 8:\n            \n            //$LASTPOS=12003877;//kernel.BaseActor:3877\n            _this.fiber$update(_thread);\n            __pc=9;return;\n          case 9:\n            \n            __pc=1;break;\n          case 10:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    getCrashRect :function _trc_BaseActor_getCrashRect() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var actWidth;\n      var actHeight;\n      \n      //$LASTPOS=12003928;//kernel.BaseActor:3928\n      actWidth = _this.width*_this.scaleX;actHeight;\n      //$LASTPOS=12003971;//kernel.BaseActor:3971\n      if (typeof  _this.scaleY==="undefined") {\n        //$LASTPOS=12004013;//kernel.BaseActor:4013\n        actHeight=_this.height*_this.scaleX;\n        \n      } else {\n        //$LASTPOS=12004059;//kernel.BaseActor:4059\n        actHeight=_this.height*_this.scaleY;\n        \n      }\n      return typeof  _this.x=="number"&&typeof  _this.y=="number"&&typeof  _this.width=="number"&&typeof  _this.height=="number"&&{x: _this.x,y: _this.y,width: Math.abs(actWidth),height: Math.abs(actHeight)};\n    },\n    allWithin :function _trc_BaseActor_allWithin(t,distance) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      var sp;\n      var t1;\n      \n      //$LASTPOS=12004320;//kernel.BaseActor:4320\n      res = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=12004345;//kernel.BaseActor:4345\n      sp = _this;\n      //$LASTPOS=12004382;//kernel.BaseActor:4382\n      t1 = _this.getCrashRect();\n      //$LASTPOS=12004410;//kernel.BaseActor:4410\n      if (! t1) {\n        return res;\n      }\n      //$LASTPOS=12004436;//kernel.BaseActor:4436\n      Tonyu.globals.$Sprites.sprites.forEach((function anonymous_4461(s) {\n        var t2;\n        \n        //$LASTPOS=12004477;//kernel.BaseActor:4477\n        t2;\n        //$LASTPOS=12004494;//kernel.BaseActor:4494\n        if (s!==_this&&! s.excludeFromAll&&s instanceof t&&Math.sqrt(Math.abs(_this.x-s.x)*Math.abs(_this.x-s.x)+Math.abs(_this.y-s.y)*Math.abs(_this.y-s.y))<distance) {\n          //$LASTPOS=12004679;//kernel.BaseActor:4679\n          res.push(s);\n          \n        }\n      }));\n      return res;\n    },\n    within :function _trc_BaseActor_within(t,distance) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12004770;//kernel.BaseActor:4770\n      if (! t) {\n        return false;\n      }\n      //$LASTPOS=12004796;//kernel.BaseActor:4796\n      if (typeof  t=="function") {\n        return _this.allWithin(t,distance)[0];\n        \n      }\n      return _this.within1(t,distance);\n    },\n    within1 :function _trc_BaseActor_within1(t,distance) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12004942;//kernel.BaseActor:4942\n      if (! t||t._isDead) {\n        return false;\n      }\n      //$LASTPOS=12004981;//kernel.BaseActor:4981\n      if (Math.sqrt(Math.abs(_this.x-t.x)*Math.abs(_this.x-t.x)+Math.abs(_this.y-t.y)*Math.abs(_this.y-t.y))<distance) {\n        return true;\n        \n      }\n      return false;\n    },\n    withinChecker :function _trc_BaseActor_withinChecker(d,r,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var obj;\n      var _it_143;\n      \n      //$LASTPOS=12005151;//kernel.BaseActor:5151\n      while (true) {\n        //$LASTPOS=12005173;//kernel.BaseActor:5173\n        if (typeof  d=="function") {\n          //$LASTPOS=12005212;//kernel.BaseActor:5212\n          _it_143=Tonyu.iterator(_this.allWithin(d,r),1);\n          while(_it_143.next()) {\n            obj=_it_143[0];\n            \n            //$LASTPOS=12005257;//kernel.BaseActor:5257\n            _this.print(r);\n            //$LASTPOS=12005284;//kernel.BaseActor:5284\n            f(obj);\n            \n          }\n          \n        } else {\n          //$LASTPOS=12005322;//kernel.BaseActor:5322\n          if (_this.within(d,r)) {\n            //$LASTPOS=12005352;//kernel.BaseActor:5352\n            f(d);\n            \n          }\n        }\n        //$LASTPOS=12005378;//kernel.BaseActor:5378\n        _this.update();\n        \n      }\n    },\n    fiber$withinChecker :function _trc_BaseActor_f_withinChecker(_thread,d,r,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var obj;\n      var _it_143;\n      \n      \n      _thread.enter(function _trc_BaseActor_ent_withinChecker(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=12005151;//kernel.BaseActor:5151\n          case 1:\n            //$LASTPOS=12005173;//kernel.BaseActor:5173\n            if (typeof  d=="function") {\n              //$LASTPOS=12005212;//kernel.BaseActor:5212\n              _it_143=Tonyu.iterator(_this.allWithin(d,r),1);\n              while(_it_143.next()) {\n                obj=_it_143[0];\n                \n                //$LASTPOS=12005257;//kernel.BaseActor:5257\n                _this.print(r);\n                //$LASTPOS=12005284;//kernel.BaseActor:5284\n                f(obj);\n                \n              }\n              \n            } else {\n              //$LASTPOS=12005322;//kernel.BaseActor:5322\n              if (_this.within(d,r)) {\n                //$LASTPOS=12005352;//kernel.BaseActor:5352\n                f(d);\n                \n              }\n            }\n            //$LASTPOS=12005378;//kernel.BaseActor:5378\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    watchHit :function _trc_BaseActor_watchHit(typeA,typeB,onHit) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12005442;//kernel.BaseActor:5442\n      Tonyu.globals.$Sprites.watchHit(typeA,typeB,(function anonymous_5475(a,b) {\n        \n        //$LASTPOS=12005493;//kernel.BaseActor:5493\n        onHit.apply(_this,[a,b]);\n      }));\n    },\n    currentThreadGroup :function _trc_BaseActor_currentThreadGroup() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.globals.$Scheduler;\n    },\n    die :function _trc_BaseActor_die() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12005647;//kernel.BaseActor:5647\n      _this.killThreadGroup();\n      //$LASTPOS=12005719;//kernel.BaseActor:5719\n      _this.hide();\n      //$LASTPOS=12005732;//kernel.BaseActor:5732\n      _this.fireEvent("die");\n      //$LASTPOS=12005755;//kernel.BaseActor:5755\n      _this._isDead=true;\n    },\n    hide :function _trc_BaseActor_hide() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12005934;//kernel.BaseActor:5934\n      if (_this.layer&&typeof  _this.layer.remove=="function") {\n        //$LASTPOS=12005989;//kernel.BaseActor:5989\n        _this.layer.remove(_this);\n        \n      } else {\n        //$LASTPOS=12006030;//kernel.BaseActor:6030\n        Tonyu.globals.$Sprites.remove(_this);\n        \n      }\n    },\n    show :function _trc_BaseActor_show(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12006091;//kernel.BaseActor:6091\n      if (_this.layer&&typeof  _this.layer.add=="function") {\n        //$LASTPOS=12006143;//kernel.BaseActor:6143\n        _this.layer.add(_this);\n        \n      } else {\n        //$LASTPOS=12006181;//kernel.BaseActor:6181\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      //$LASTPOS=12006213;//kernel.BaseActor:6213\n      if (x!=null) {\n        //$LASTPOS=12006226;//kernel.BaseActor:6226\n        _this.x=x;\n      }\n      //$LASTPOS=12006241;//kernel.BaseActor:6241\n      if (y!=null) {\n        //$LASTPOS=12006254;//kernel.BaseActor:6254\n        _this.y=y;\n      }\n      //$LASTPOS=12006269;//kernel.BaseActor:6269\n      if (p!=null) {\n        //$LASTPOS=12006282;//kernel.BaseActor:6282\n        _this.p=p;\n      }\n    },\n    detectShape :function _trc_BaseActor_detectShape() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12006327;//kernel.BaseActor:6327\n      if (typeof  _this.p!="number") {\n        //$LASTPOS=12006362;//kernel.BaseActor:6362\n        if (_this.text!=null) {\n          return _this;\n        }\n        //$LASTPOS=12006395;//kernel.BaseActor:6395\n        _this.p=0;\n        \n      }\n      //$LASTPOS=12006412;//kernel.BaseActor:6412\n      _this.p=Math.floor(_this.p);\n      //$LASTPOS=12006434;//kernel.BaseActor:6434\n      _this.pImg=Tonyu.globals.$Sprites.getImageList()[_this.p];\n      //$LASTPOS=12006472;//kernel.BaseActor:6472\n      if (! _this.pImg) {\n        return _this;\n      }\n      //$LASTPOS=12006496;//kernel.BaseActor:6496\n      _this.width=_this.pImg.width;\n      //$LASTPOS=12006519;//kernel.BaseActor:6519\n      _this.height=_this.pImg.height;\n    },\n    waitFor :function _trc_BaseActor_waitFor(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12006562;//kernel.BaseActor:6562\n      if (null) {\n        //$LASTPOS=12006586;//kernel.BaseActor:6586\n        null.waitFor(f);\n        \n      }\n    },\n    fiber$waitFor :function _trc_BaseActor_f_waitFor(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=12006562;//kernel.BaseActor:6562\n      if (_thread) {\n        //$LASTPOS=12006586;//kernel.BaseActor:6586\n        _thread.waitFor(f);\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    isDead :function _trc_BaseActor_isDead() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this._isDead;\n    },\n    animation :function _trc_BaseActor_animation() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12006706;//kernel.BaseActor:6706\n      _this.age++;\n      //$LASTPOS=12006718;//kernel.BaseActor:6718\n      if (_this.animMode&&_this.age%_this.animFps==0) {\n        //$LASTPOS=12006759;//kernel.BaseActor:6759\n        _this.p=_this.anim[_this.animFrame%_this.anim.length];\n        //$LASTPOS=12006799;//kernel.BaseActor:6799\n        _this.animFrame++;\n        \n      }\n    },\n    draw :function _trc_BaseActor_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var splitsText;\n      var textCount;\n      var rect;\n      \n      //$LASTPOS=12006848;//kernel.BaseActor:6848\n      if (_this.x==null||_this.y==null||_this._isInvisible) {\n        return _this;\n      }\n      //$LASTPOS=12006901;//kernel.BaseActor:6901\n      _this.detectShape();\n      //$LASTPOS=12006921;//kernel.BaseActor:6921\n      if (_this.pImg) {\n        //$LASTPOS=12006942;//kernel.BaseActor:6942\n        ctx.save();\n        //$LASTPOS=12006963;//kernel.BaseActor:6963\n        ctx.translate(_this.x,_this.y);\n        //$LASTPOS=12007107;//kernel.BaseActor:7107\n        _this.animation();\n        //$LASTPOS=12007129;//kernel.BaseActor:7129\n        if (_this.rotation!=0) {\n          //$LASTPOS=12007164;//kernel.BaseActor:7164\n          ctx.rotate(_this.rotation/180*Math.PI);\n          \n        } else {\n          //$LASTPOS=12007232;//kernel.BaseActor:7232\n          ctx.rotate(_this.rotate/180*Math.PI);\n          \n        }\n        //$LASTPOS=12007289;//kernel.BaseActor:7289\n        if (typeof  _this.scaleY==="undefined") {\n          //$LASTPOS=12007341;//kernel.BaseActor:7341\n          ctx.scale(_this.scaleX,_this.scaleX);\n          \n        } else {\n          //$LASTPOS=12007406;//kernel.BaseActor:7406\n          ctx.scale(_this.scaleX,_this.scaleY);\n          \n        }\n        //$LASTPOS=12007462;//kernel.BaseActor:7462\n        ctx.globalAlpha=_this.alpha/255;\n        //$LASTPOS=12007503;//kernel.BaseActor:7503\n        ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.width/2,- _this.height/2,_this.width,_this.height);\n        //$LASTPOS=12007635;//kernel.BaseActor:7635\n        ctx.restore();\n        \n      } else {\n        //$LASTPOS=12007662;//kernel.BaseActor:7662\n        if (_this.text!==null&&_this.text!==undefined) {\n          //$LASTPOS=12007710;//kernel.BaseActor:7710\n          splitsText = (_this.text+"").split("\\n");\n          //$LASTPOS=12007757;//kernel.BaseActor:7757\n          _this.drawY=_this.y;\n          //$LASTPOS=12007775;//kernel.BaseActor:7775\n          if (! _this.size) {\n            //$LASTPOS=12007786;//kernel.BaseActor:7786\n            _this.size=15;\n          }\n          //$LASTPOS=12007804;//kernel.BaseActor:7804\n          if (! _this.align) {\n            //$LASTPOS=12007816;//kernel.BaseActor:7816\n            _this.align="center";\n          }\n          //$LASTPOS=12007841;//kernel.BaseActor:7841\n          if (! _this.fillStyle) {\n            //$LASTPOS=12007857;//kernel.BaseActor:7857\n            _this.fillStyle="white";\n          }\n          //$LASTPOS=12007885;//kernel.BaseActor:7885\n          ctx.fillStyle=_this.fillStyle;\n          //$LASTPOS=12007919;//kernel.BaseActor:7919\n          ctx.globalAlpha=_this.alpha/255;\n          //$LASTPOS=12007960;//kernel.BaseActor:7960\n          _this.height=0;\n          //$LASTPOS=12007969;//kernel.BaseActor:7969\n          _this.width=0;\n          //$LASTPOS=12007987;//kernel.BaseActor:7987\n          //$LASTPOS=12007991;//kernel.BaseActor:7991\n          textCount = 0;\n          while(textCount<splitsText.length) {\n            {\n              //$LASTPOS=12008062;//kernel.BaseActor:8062\n              rect = _this.drawTextRect(ctx,splitsText[textCount],_this.x,_this.drawY,_this.size,_this.align,"fill");\n              //$LASTPOS=12008158;//kernel.BaseActor:8158\n              if (_this.width<rect.w) {\n                //$LASTPOS=12008175;//kernel.BaseActor:8175\n                _this.width=rect.w;\n              }\n              //$LASTPOS=12008202;//kernel.BaseActor:8202\n              _this.height+=rect.h;\n              //$LASTPOS=12008231;//kernel.BaseActor:8231\n              _this.drawY+=_this.size;\n            }\n            textCount++;\n          }\n          \n        }\n      }\n      //$LASTPOS=12008267;//kernel.BaseActor:8267\n      if (_this._fukidashi) {\n        //$LASTPOS=12008294;//kernel.BaseActor:8294\n        if (_this._fukidashi.c>0) {\n          //$LASTPOS=12008329;//kernel.BaseActor:8329\n          _this._fukidashi.c--;\n          //$LASTPOS=12008358;//kernel.BaseActor:8358\n          ctx.fillStyle="white";\n          //$LASTPOS=12008394;//kernel.BaseActor:8394\n          ctx.strokeStyle="black";\n          //$LASTPOS=12008432;//kernel.BaseActor:8432\n          _this.fukidashi(ctx,_this._fukidashi.text,_this.x,_this.y-_this.height/2-10,_this._fukidashi.size);\n          \n        }\n        \n      }\n    },\n    asyncResult :function _trc_BaseActor_asyncResult() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.asyncResult();\n    },\n    runAsync :function _trc_BaseActor_runAsync(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12008635;//kernel.BaseActor:8635\n      if (! null) {\n        throw new Error("runAsync should run in wait mode");\n        \n      }\n      //$LASTPOS=12008707;//kernel.BaseActor:8707\n      null.runAsync(f);\n    },\n    fiber$runAsync :function _trc_BaseActor_f_runAsync(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=12008635;//kernel.BaseActor:8635\n      if (! _thread) {\n        throw new Error("runAsync should run in wait mode");\n        \n      }\n      //$LASTPOS=12008707;//kernel.BaseActor:8707\n      _thread.runAsync(f);\n      \n      _thread.retVal=_this;return;\n    },\n    screenOut :function _trc_BaseActor_screenOut(a) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var r;\n      var viewX;\n      var viewY;\n      \n      //$LASTPOS=12008789;//kernel.BaseActor:8789\n      if (! a) {\n        //$LASTPOS=12008797;//kernel.BaseActor:8797\n        a=0;\n      }\n      //$LASTPOS=12008807;//kernel.BaseActor:8807\n      r = 0;\n      //$LASTPOS=12008821;//kernel.BaseActor:8821\n      viewX = Tonyu.globals.$Sprites.sx;viewY = Tonyu.globals.$Sprites.sy;\n      //$LASTPOS=12008867;//kernel.BaseActor:8867\n      if (_this.x<viewX+a) {\n        //$LASTPOS=12008896;//kernel.BaseActor:8896\n        r+=viewX+a-_this.x;\n      }\n      //$LASTPOS=12008915;//kernel.BaseActor:8915\n      if (_this.y<viewY+a) {\n        //$LASTPOS=12008944;//kernel.BaseActor:8944\n        r+=viewY+a-_this.y;\n      }\n      //$LASTPOS=12008963;//kernel.BaseActor:8963\n      if (_this.x>Tonyu.globals.$screenWidth+viewX-a) {\n        //$LASTPOS=12008992;//kernel.BaseActor:8992\n        r+=_this.x-(Tonyu.globals.$screenWidth+viewX-a);\n      }\n      //$LASTPOS=12009027;//kernel.BaseActor:9027\n      if (_this.y>Tonyu.globals.$screenHeight+viewY-a) {\n        //$LASTPOS=12009056;//kernel.BaseActor:9056\n        r+=_this.y-(Tonyu.globals.$screenHeight+viewY-a);\n      }\n      return r;\n    },\n    fiber$screenOut :function _trc_BaseActor_f_screenOut(_thread,a) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var r;\n      var viewX;\n      var viewY;\n      \n      //$LASTPOS=12008789;//kernel.BaseActor:8789\n      if (! a) {\n        //$LASTPOS=12008797;//kernel.BaseActor:8797\n        a=0;\n      }\n      //$LASTPOS=12008807;//kernel.BaseActor:8807\n      r = 0;\n      //$LASTPOS=12008821;//kernel.BaseActor:8821\n      viewX = Tonyu.globals.$Sprites.sx;viewY = Tonyu.globals.$Sprites.sy;\n      //$LASTPOS=12008867;//kernel.BaseActor:8867\n      if (_this.x<viewX+a) {\n        //$LASTPOS=12008896;//kernel.BaseActor:8896\n        r+=viewX+a-_this.x;\n      }\n      //$LASTPOS=12008915;//kernel.BaseActor:8915\n      if (_this.y<viewY+a) {\n        //$LASTPOS=12008944;//kernel.BaseActor:8944\n        r+=viewY+a-_this.y;\n      }\n      //$LASTPOS=12008963;//kernel.BaseActor:8963\n      if (_this.x>Tonyu.globals.$screenWidth+viewX-a) {\n        //$LASTPOS=12008992;//kernel.BaseActor:8992\n        r+=_this.x-(Tonyu.globals.$screenWidth+viewX-a);\n      }\n      //$LASTPOS=12009027;//kernel.BaseActor:9027\n      if (_this.y>Tonyu.globals.$screenHeight+viewY-a) {\n        //$LASTPOS=12009056;//kernel.BaseActor:9056\n        r+=_this.y-(Tonyu.globals.$screenHeight+viewY-a);\n      }\n      _thread.retVal=r;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    screenOutChecker :function _trc_BaseActor_screenOutChecker(d,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12009186;//kernel.BaseActor:9186\n      while (true) {\n        //$LASTPOS=12009208;//kernel.BaseActor:9208\n        while (true) {\n          //$LASTPOS=12009234;//kernel.BaseActor:9234\n          if (_this.screenOut()>d) {\n            //$LASTPOS=12009270;//kernel.BaseActor:9270\n            f();\n            break;\n            \n            \n          }\n          //$LASTPOS=12009327;//kernel.BaseActor:9327\n          _this.update();\n          \n        }\n        //$LASTPOS=12009357;//kernel.BaseActor:9357\n        while (true) {\n          //$LASTPOS=12009383;//kernel.BaseActor:9383\n          if (_this.screenOut()<=d) {\n            break;\n            \n            \n          }\n          //$LASTPOS=12009455;//kernel.BaseActor:9455\n          _this.update();\n          \n        }\n        //$LASTPOS=12009485;//kernel.BaseActor:9485\n        _this.update();\n        \n      }\n    },\n    fiber$screenOutChecker :function _trc_BaseActor_f_screenOutChecker(_thread,d,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_BaseActor_ent_screenOutChecker(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=12009186;//kernel.BaseActor:9186\n          case 1:\n            //$LASTPOS=12009208;//kernel.BaseActor:9208\n          case 2:\n            //$LASTPOS=12009234;//kernel.BaseActor:9234\n            if (!(_this.screenOut()>d)) { __pc=3; break; }\n            //$LASTPOS=12009270;//kernel.BaseActor:9270\n            f();\n            __pc=5; break;\n            \n          case 3:\n            \n            //$LASTPOS=12009327;//kernel.BaseActor:9327\n            _this.fiber$update(_thread);\n            __pc=4;return;\n          case 4:\n            \n            __pc=2;break;\n          case 5:\n            \n            //$LASTPOS=12009357;//kernel.BaseActor:9357\n          case 6:\n            //$LASTPOS=12009383;//kernel.BaseActor:9383\n            if (!(_this.screenOut()<=d)) { __pc=7; break; }\n            __pc=9; break;\n            \n          case 7:\n            \n            //$LASTPOS=12009455;//kernel.BaseActor:9455\n            _this.fiber$update(_thread);\n            __pc=8;return;\n          case 8:\n            \n            __pc=6;break;\n          case 9:\n            \n            //$LASTPOS=12009485;//kernel.BaseActor:9485\n            _this.fiber$update(_thread);\n            __pc=10;return;\n          case 10:\n            \n            __pc=1;break;\n          case 11:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    file :function _trc_BaseActor_file(path) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var d;\n      var files;\n      \n      //$LASTPOS=12009525;//kernel.BaseActor:9525\n      d = Tonyu.currentProject.getDir();\n      //$LASTPOS=12009567;//kernel.BaseActor:9567\n      files = d.rel("files/");\n      return FS.get(files.rel(path),{topDir: d});\n    },\n    fiber$file :function _trc_BaseActor_f_file(_thread,path) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var d;\n      var files;\n      \n      //$LASTPOS=12009525;//kernel.BaseActor:9525\n      d = Tonyu.currentProject.getDir();\n      //$LASTPOS=12009567;//kernel.BaseActor:9567\n      files = d.rel("files/");\n      _thread.retVal=FS.get(files.rel(path),{topDir: d});return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    waitInputDevice :function _trc_BaseActor_waitInputDevice(fl) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12009674;//kernel.BaseActor:9674\n      if (fl!==false) {\n        //$LASTPOS=12009701;//kernel.BaseActor:9701\n        if (! _this.origTG) {\n          \n          \n        }\n        //$LASTPOS=12009853;//kernel.BaseActor:9853\n        _this.a=_this.asyncResult();\n        //$LASTPOS=12009879;//kernel.BaseActor:9879\n        Tonyu.globals.$InputDevice.addOnetimeListener(_this.a.receiver);\n        //$LASTPOS=12009933;//kernel.BaseActor:9933\n        _this.waitFor(_this.a);\n        \n      } else {\n        //$LASTPOS=12009968;//kernel.BaseActor:9968\n        if (_this.origTG) {\n          \n          \n        }\n        \n      }\n    },\n    fiber$waitInputDevice :function _trc_BaseActor_f_waitInputDevice(_thread,fl) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_BaseActor_ent_waitInputDevice(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=12009674;//kernel.BaseActor:9674\n            if (!(fl!==false)) { __pc=3; break; }\n            //$LASTPOS=12009701;//kernel.BaseActor:9701\n            if (!(! _this.origTG)) { __pc=1; break; }\n            {\n              //$LASTPOS=12009755;//kernel.BaseActor:9755\n              _this.origTG=_thread.group;\n              //$LASTPOS=12009794;//kernel.BaseActor:9794\n              _thread.setGroup(null);\n            }\n          case 1:\n            \n            //$LASTPOS=12009853;//kernel.BaseActor:9853\n            _this.a=_this.asyncResult();\n            //$LASTPOS=12009879;//kernel.BaseActor:9879\n            Tonyu.globals.$InputDevice.addOnetimeListener(_this.a.receiver);\n            //$LASTPOS=12009933;//kernel.BaseActor:9933\n            _this.fiber$waitFor(_thread, _this.a);\n            __pc=2;return;\n          case 2:\n            \n            __pc=5;break;\n          case 3:\n            //$LASTPOS=12009968;//kernel.BaseActor:9968\n            if (!(_this.origTG)) { __pc=4; break; }\n            {\n              //$LASTPOS=12010021;//kernel.BaseActor:10021\n              _thread.setGroup(_this.origTG);\n              //$LASTPOS=12010064;//kernel.BaseActor:10064\n              _this.origTG=null;\n            }\n          case 4:\n            \n          case 5:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    redrawScreen :function _trc_BaseActor_redrawScreen() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12010137;//kernel.BaseActor:10137\n      Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n      //$LASTPOS=12010173;//kernel.BaseActor:10173\n      Tonyu.globals.$Screen.draw();\n    },\n    fiber$redrawScreen :function _trc_BaseActor_f_redrawScreen(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=12010137;//kernel.BaseActor:10137\n      Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n      //$LASTPOS=12010173;//kernel.BaseActor:10173\n      Tonyu.globals.$Screen.draw();\n      \n      _thread.retVal=_this;return;\n    },\n    color :function _trc_BaseActor_color(r,g,b) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return "rgb("+[r,g,b].join(",")+")";\n    },\n    fiber$color :function _trc_BaseActor_f_color(_thread,r,g,b) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal="rgb("+[r,g,b].join(",")+")";return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    loadPage :function _trc_BaseActor_loadPage(page,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12010882;//kernel.BaseActor:10882\n      _this.all().die();\n      //$LASTPOS=12010900;//kernel.BaseActor:10900\n      new page(arg);\n      //$LASTPOS=12010920;//kernel.BaseActor:10920\n      _this.die();\n    },\n    fiber$loadPage :function _trc_BaseActor_f_loadPage(_thread,page,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=12010882;//kernel.BaseActor:10882\n      _this.all().die();\n      //$LASTPOS=12010900;//kernel.BaseActor:10900\n      new page(arg);\n      //$LASTPOS=12010920;//kernel.BaseActor:10920\n      _this.die();\n      \n      _thread.retVal=_this;return;\n    },\n    setVisible :function _trc_BaseActor_setVisible(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12010955;//kernel.BaseActor:10955\n      _this._isInvisible=! v;\n    },\n    fiber$setVisible :function _trc_BaseActor_f_setVisible(_thread,v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=12010955;//kernel.BaseActor:10955\n      _this._isInvisible=! v;\n      \n      _thread.retVal=_this;return;\n    },\n    appear :function _trc_BaseActor_appear(o) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return o;\n    },\n    fiber$appear :function _trc_BaseActor_f_appear(_thread,o) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=o;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"extend":{"nowait":true},"print":{"nowait":true},"setAnimFps":{"nowait":true},"startAnim":{"nowait":true},"stopAnim":{"nowait":true},"update":{"nowait":false},"onUpdate":{"nowait":true},"updateEx":{"nowait":false},"getkey":{"nowait":true},"hitTo":{"nowait":true},"all":{"nowait":true},"allCrash":{"nowait":true},"crashTo":{"nowait":true},"crashTo1":{"nowait":true},"crashToChecker":{"nowait":false},"getCrashRect":{"nowait":true},"allWithin":{"nowait":true},"within":{"nowait":true},"within1":{"nowait":true},"withinChecker":{"nowait":false},"watchHit":{"nowait":true},"currentThreadGroup":{"nowait":true},"die":{"nowait":true},"hide":{"nowait":true},"show":{"nowait":true},"detectShape":{"nowait":true},"waitFor":{"nowait":false},"isDead":{"nowait":true},"animation":{"nowait":true},"draw":{"nowait":true},"asyncResult":{"nowait":true},"runAsync":{"nowait":false},"screenOut":{"nowait":false},"screenOutChecker":{"nowait":false},"file":{"nowait":false},"waitInputDevice":{"nowait":false},"redrawScreen":{"nowait":false},"color":{"nowait":false},"loadPage":{"nowait":false},"setVisible":{"nowait":false},"appear":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.EventHandler\',\n  shortName: \'EventHandler\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [Tonyu.classes.kernel.EventHandlerCaller],\n  methods: {\n    main :function _trc_EventHandler_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000067;//kernel.EventHandler:67\n      if (Tonyu.runMode) {\n        //$LASTPOS=13000086;//kernel.EventHandler:86\n        _this.listeners=[];\n      }\n    },\n    fiber$main :function _trc_EventHandler_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=13000067;//kernel.EventHandler:67\n      if (Tonyu.runMode) {\n        //$LASTPOS=13000086;//kernel.EventHandler:86\n        _this.listeners=[];\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    addListener :function _trc_EventHandler_addListener(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000126;//kernel.EventHandler:126\n      if (_this.target&&(typeof  f)=="string") {\n        //$LASTPOS=13000173;//kernel.EventHandler:173\n        f=_this.target[f];\n        \n      }\n      //$LASTPOS=13000198;//kernel.EventHandler:198\n      if (typeof  f!="function") {\n        throw new Error("Not a event listener: "+_this.target+" / "+f);\n        \n      }\n      //$LASTPOS=13000287;//kernel.EventHandler:287\n      _this.listeners.push(f);\n      return {remove: (function anonymous_337() {\n        \n        //$LASTPOS=13000352;//kernel.EventHandler:352\n        _this.removeListener(f);\n      })};\n    },\n    fiber$addListener :function _trc_EventHandler_f_addListener(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=13000126;//kernel.EventHandler:126\n      if (_this.target&&(typeof  f)=="string") {\n        //$LASTPOS=13000173;//kernel.EventHandler:173\n        f=_this.target[f];\n        \n      }\n      //$LASTPOS=13000198;//kernel.EventHandler:198\n      if (typeof  f!="function") {\n        throw new Error("Not a event listener: "+_this.target+" / "+f);\n        \n      }\n      //$LASTPOS=13000287;//kernel.EventHandler:287\n      _this.listeners.push(f);\n      \n      _thread.enter(function _trc_EventHandler_ent_addListener(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            _thread.exit({remove: (function anonymous_337() {\n              \n              //$LASTPOS=13000352;//kernel.EventHandler:352\n              _this.removeListener(f);\n            })});return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    removeListener :function _trc_EventHandler_removeListener(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      \n      //$LASTPOS=13000420;//kernel.EventHandler:420\n      i = _this.listeners.indexOf(f);\n      //$LASTPOS=13000453;//kernel.EventHandler:453\n      _this.listeners.splice(i,1);\n    },\n    fiber$removeListener :function _trc_EventHandler_f_removeListener(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      \n      //$LASTPOS=13000420;//kernel.EventHandler:420\n      i = _this.listeners.indexOf(f);\n      //$LASTPOS=13000453;//kernel.EventHandler:453\n      _this.listeners.splice(i,1);\n      \n      _thread.retVal=_this;return;\n    },\n    fire :function _trc_EventHandler_fire(args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var t;\n      var h;\n      var _it_159;\n      \n      //$LASTPOS=13000499;//kernel.EventHandler:499\n      if (_this.released) {\n        return _this;\n      }\n      //$LASTPOS=13000526;//kernel.EventHandler:526\n      t;\n      //$LASTPOS=13000538;//kernel.EventHandler:538\n      _it_159=Tonyu.iterator(_this.listeners,1);\n      while(_it_159.next()) {\n        h=_it_159[0];\n        \n        //$LASTPOS=13000782;//kernel.EventHandler:782\n        _this.callEventHandler(h,args);\n        \n      }\n    },\n    fiber$fire :function _trc_EventHandler_f_fire(_thread,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var t;\n      var h;\n      var _it_159;\n      \n      //$LASTPOS=13000499;//kernel.EventHandler:499\n      if (_this.released) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=13000526;//kernel.EventHandler:526\n      t;\n      \n      _thread.enter(function _trc_EventHandler_ent_fire(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=13000538;//kernel.EventHandler:538\n            _it_159=Tonyu.iterator(_this.listeners,1);\n          case 1:\n            if (!(_it_159.next())) { __pc=3; break; }\n            h=_it_159[0];\n            \n            //$LASTPOS=13000782;//kernel.EventHandler:782\n            _this.fiber$callEventHandler(_thread, h, args);\n            __pc=2;return;\n          case 2:\n            \n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    release :function _trc_EventHandler_release() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000838;//kernel.EventHandler:838\n      _this.released=true;\n    },\n    fiber$release :function _trc_EventHandler_f_release(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=13000838;//kernel.EventHandler:838\n      _this.released=true;\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"addListener":{"nowait":false},"removeListener":{"nowait":false},"fire":{"nowait":false},"release":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.ScreenOutHandler\',\n  shortName: \'ScreenOutHandler\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.EventHandler,\n  includes: [],\n  methods: {\n    main :function _trc_ScreenOutHandler_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_ScreenOutHandler_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    addListener :function _trc_ScreenOutHandler_addListener(d,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var retThread;\n      \n      //$LASTPOS=14000049;//kernel.ScreenOutHandler:49\n      retThread = _this.target.parallel("screenOutChecker",d,f);\n      return {remove: (function anonymous_135() {\n        \n        //$LASTPOS=14000151;//kernel.ScreenOutHandler:151\n        retThread.kill();\n      })};\n    },\n    fiber$addListener :function _trc_ScreenOutHandler_f_addListener(_thread,d,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var retThread;\n      \n      //$LASTPOS=14000049;//kernel.ScreenOutHandler:49\n      retThread = _this.target.parallel("screenOutChecker",d,f);\n      _thread.retVal={remove: (function anonymous_135() {\n        \n        //$LASTPOS=14000151;//kernel.ScreenOutHandler:151\n        retThread.kill();\n      })};return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_ScreenOutHandler_initialize(param) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=14000210;//kernel.ScreenOutHandler:210\n      Tonyu.classes.kernel.EventHandler.apply( _this, [param]);\n      //$LASTPOS=14000228;//kernel.ScreenOutHandler:228\n      _this.id=(Tonyu.globals.$idseq=(Tonyu.globals.$idseq||0)+1);\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"addListener":{"nowait":false},"new":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.WithinHandler\',\n  shortName: \'WithinHandler\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.EventHandler,\n  includes: [],\n  methods: {\n    main :function _trc_WithinHandler_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_WithinHandler_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    addListener :function _trc_WithinHandler_addListener(d,r,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var retThread;\n      \n      //$LASTPOS=15000052;//kernel.WithinHandler:52\n      retThread = _this.target.parallel("withinChecker",d,r,f);\n      return {remove: (function anonymous_137() {\n        \n        //$LASTPOS=15000153;//kernel.WithinHandler:153\n        retThread.kill();\n      })};\n    },\n    fiber$addListener :function _trc_WithinHandler_f_addListener(_thread,d,r,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var retThread;\n      \n      //$LASTPOS=15000052;//kernel.WithinHandler:52\n      retThread = _this.target.parallel("withinChecker",d,r,f);\n      _thread.retVal={remove: (function anonymous_137() {\n        \n        //$LASTPOS=15000153;//kernel.WithinHandler:153\n        retThread.kill();\n      })};return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_WithinHandler_initialize(param) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=15000213;//kernel.WithinHandler:213\n      Tonyu.classes.kernel.EventHandler.apply( _this, [param]);\n      //$LASTPOS=15000232;//kernel.WithinHandler:232\n      _this.id=(Tonyu.globals.$idseq=(Tonyu.globals.$idseq||0)+1);\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"addListener":{"nowait":false},"new":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.NoviceActor\',\n  shortName: \'NoviceActor\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.BaseActor,\n  includes: [],\n  methods: {\n    main :function _trc_NoviceActor_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_NoviceActor_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    sleep :function _trc_NoviceActor_sleep(n) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000050;//kernel.NoviceActor:50\n      if (! n) {\n        //$LASTPOS=16000057;//kernel.NoviceActor:57\n        n=1;\n      }\n      //$LASTPOS=16000066;//kernel.NoviceActor:66\n      //$LASTPOS=16000070;//kernel.NoviceActor:70\n      n;\n      while(n>0) {\n        //$LASTPOS=16000081;//kernel.NoviceActor:81\n        _this.update();\n        n--;\n      }\n    },\n    fiber$sleep :function _trc_NoviceActor_f_sleep(_thread,n) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=16000050;//kernel.NoviceActor:50\n      if (! n) {\n        //$LASTPOS=16000057;//kernel.NoviceActor:57\n        n=1;\n      }\n      \n      _thread.enter(function _trc_NoviceActor_ent_sleep(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=16000066;//kernel.NoviceActor:66\n            //$LASTPOS=16000070;//kernel.NoviceActor:70\n            n;;\n          case 1:\n            if (!(n>0)) { __pc=3; break; }\n            //$LASTPOS=16000081;//kernel.NoviceActor:81\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            n--;\n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initSprite :function _trc_NoviceActor_initSprite() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000113;//kernel.NoviceActor:113\n      if (! _this._sprite) {\n        //$LASTPOS=16000137;//kernel.NoviceActor:137\n        _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});\n        //$LASTPOS=16000207;//kernel.NoviceActor:207\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n    },\n    fiber$initSprite :function _trc_NoviceActor_f_initSprite(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=16000113;//kernel.NoviceActor:113\n      if (! _this._sprite) {\n        //$LASTPOS=16000137;//kernel.NoviceActor:137\n        _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});\n        //$LASTPOS=16000207;//kernel.NoviceActor:207\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    say :function _trc_NoviceActor_say(text,size) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000257;//kernel.NoviceActor:257\n      if (! size) {\n        //$LASTPOS=16000268;//kernel.NoviceActor:268\n        size=15;\n      }\n      //$LASTPOS=16000281;//kernel.NoviceActor:281\n      _this.initSprite();\n      //$LASTPOS=16000299;//kernel.NoviceActor:299\n      _this._sprite._fukidashi={text: text,size: size,c: 30};\n    },\n    fiber$say :function _trc_NoviceActor_f_say(_thread,text,size) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=16000257;//kernel.NoviceActor:257\n      if (! size) {\n        //$LASTPOS=16000268;//kernel.NoviceActor:268\n        size=15;\n      }\n      \n      _thread.enter(function _trc_NoviceActor_ent_say(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=16000281;//kernel.NoviceActor:281\n            _this.fiber$initSprite(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=16000299;//kernel.NoviceActor:299\n            _this._sprite._fukidashi={text: text,size: size,c: 30};\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    sprite :function _trc_NoviceActor_sprite(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000371;//kernel.NoviceActor:371\n      _this.go(x,y,p);\n    },\n    fiber$sprite :function _trc_NoviceActor_f_sprite(_thread,x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_NoviceActor_ent_sprite(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=16000371;//kernel.NoviceActor:371\n            _this.fiber$go(_thread, x, y, p);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    show :function _trc_NoviceActor_show(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000403;//kernel.NoviceActor:403\n      _this.go(x,y,p);\n    },\n    draw :function _trc_NoviceActor_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000440;//kernel.NoviceActor:440\n      _this._sprite.draw(ctx);\n    },\n    getCrashRect :function _trc_NoviceActor_getCrashRect() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this._sprite.getCrashRect();\n    },\n    go :function _trc_NoviceActor_go(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000533;//kernel.NoviceActor:533\n      _this.initSprite();\n      //$LASTPOS=16000551;//kernel.NoviceActor:551\n      _this._sprite.x=x;\n      //$LASTPOS=16000568;//kernel.NoviceActor:568\n      _this._sprite.y=y;\n      //$LASTPOS=16000585;//kernel.NoviceActor:585\n      if (p!=null) {\n        //$LASTPOS=16000598;//kernel.NoviceActor:598\n        _this._sprite.p=p;\n      }\n    },\n    fiber$go :function _trc_NoviceActor_f_go(_thread,x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_NoviceActor_ent_go(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=16000533;//kernel.NoviceActor:533\n            _this.fiber$initSprite(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=16000551;//kernel.NoviceActor:551\n            _this._sprite.x=x;\n            //$LASTPOS=16000568;//kernel.NoviceActor:568\n            _this._sprite.y=y;\n            //$LASTPOS=16000585;//kernel.NoviceActor:585\n            if (p!=null) {\n              //$LASTPOS=16000598;//kernel.NoviceActor:598\n              _this._sprite.p=p;\n            }\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    change :function _trc_NoviceActor_change(p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000646;//kernel.NoviceActor:646\n      _this.initSprite();\n      //$LASTPOS=16000664;//kernel.NoviceActor:664\n      _this._sprite.p=p;\n    },\n    fiber$change :function _trc_NoviceActor_f_change(_thread,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_NoviceActor_ent_change(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=16000646;//kernel.NoviceActor:646\n            _this.fiber$initSprite(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=16000664;//kernel.NoviceActor:664\n            _this._sprite.p=p;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"sleep":{"nowait":false},"initSprite":{"nowait":false},"say":{"nowait":false},"sprite":{"nowait":false},"show":{"nowait":true},"draw":{"nowait":true},"getCrashRect":{"nowait":true},"go":{"nowait":false},"change":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.MML\',\n  shortName: \'MML\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [Tonyu.classes.kernel.MathMod],\n  methods: {\n    main :function _trc_MML_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=17000050;//kernel.MML:50\n      _this.mmlBuf=[];\n    },\n    fiber$main :function _trc_MML_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=17000050;//kernel.MML:50\n      _this.mmlBuf=[];\n      \n      _thread.retVal=_this;return;\n    },\n    play :function _trc_MML_play(mmls) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=17000081;//kernel.MML:81\n      _this.mmlBuf.push(mmls);\n      //$LASTPOS=17000105;//kernel.MML:105\n      if (! _this.isPlaying()) {\n        //$LASTPOS=17000134;//kernel.MML:134\n        _this.playNext();\n        \n      }\n    },\n    fiber$play :function _trc_MML_f_play(_thread,mmls) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=17000081;//kernel.MML:81\n      _this.mmlBuf.push(mmls);\n      \n      _thread.enter(function _trc_MML_ent_play(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=17000105;//kernel.MML:105\n            if (!(! _this.isPlaying())) { __pc=2; break; }\n            //$LASTPOS=17000134;//kernel.MML:134\n            _this.fiber$playNext(_thread);\n            __pc=1;return;\n          case 1:\n            \n          case 2:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    playNext :function _trc_MML_playNext() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var mml;\n      \n      //$LASTPOS=17000220;//kernel.MML:220\n      if (_this.cTimeBase==null) {\n        //$LASTPOS=17000241;//kernel.MML:241\n        _this.cTimeBase=0;\n      }\n      //$LASTPOS=17000259;//kernel.MML:259\n      if (_this.m) {\n        //$LASTPOS=17000277;//kernel.MML:277\n        _this.cTimeBase+=_this.m.currentTime;\n        \n      }\n      //$LASTPOS=17000348;//kernel.MML:348\n      mml = _this.mmlBuf.shift();\n      //$LASTPOS=17000377;//kernel.MML:377\n      if (! mml) {\n        //$LASTPOS=17000398;//kernel.MML:398\n        _this.m=null;\n        //$LASTPOS=17000415;//kernel.MML:415\n        _this.cTimeBase=0;\n        return _this;\n        \n      }\n      //$LASTPOS=17000457;//kernel.MML:457\n      _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();\n      //$LASTPOS=17000495;//kernel.MML:495\n      _this.m=T("mml",{mml: mml},_this.mwav);\n      //$LASTPOS=17000525;//kernel.MML:525\n      _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));\n      //$LASTPOS=17000555;//kernel.MML:555\n      _this.m.start();\n      //$LASTPOS=17000571;//kernel.MML:571\n      Tonyu.globals.$MMLS[_this.id()]=_this;\n    },\n    fiber$playNext :function _trc_MML_f_playNext(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var mml;\n      \n      //$LASTPOS=17000220;//kernel.MML:220\n      if (_this.cTimeBase==null) {\n        //$LASTPOS=17000241;//kernel.MML:241\n        _this.cTimeBase=0;\n      }\n      //$LASTPOS=17000259;//kernel.MML:259\n      if (_this.m) {\n        //$LASTPOS=17000277;//kernel.MML:277\n        _this.cTimeBase+=_this.m.currentTime;\n        \n      }\n      //$LASTPOS=17000348;//kernel.MML:348\n      mml = _this.mmlBuf.shift();\n      //$LASTPOS=17000377;//kernel.MML:377\n      if (! mml) {\n        //$LASTPOS=17000398;//kernel.MML:398\n        _this.m=null;\n        //$LASTPOS=17000415;//kernel.MML:415\n        _this.cTimeBase=0;\n        _thread.retVal=_this;return;\n        \n        \n      }\n      //$LASTPOS=17000457;//kernel.MML:457\n      _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();\n      //$LASTPOS=17000495;//kernel.MML:495\n      _this.m=T("mml",{mml: mml},_this.mwav);\n      //$LASTPOS=17000525;//kernel.MML:525\n      _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));\n      //$LASTPOS=17000555;//kernel.MML:555\n      _this.m.start();\n      //$LASTPOS=17000571;//kernel.MML:571\n      Tonyu.globals.$MMLS[_this.id()]=_this;\n      \n      _thread.retVal=_this;return;\n    },\n    id :function _trc_MML_id() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=17000606;//kernel.MML:606\n      if (! _this._id) {\n        //$LASTPOS=17000616;//kernel.MML:616\n        _this._id=_this.rnd()+"";\n      }\n      return _this._id;\n    },\n    fiber$id :function _trc_MML_f_id(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=17000606;//kernel.MML:606\n      if (! _this._id) {\n        //$LASTPOS=17000616;//kernel.MML:616\n        _this._id=_this.rnd()+"";\n      }\n      _thread.retVal=_this._id;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    bufferCount :function _trc_MML_bufferCount() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.mmlBuf.length;\n    },\n    fiber$bufferCount :function _trc_MML_f_bufferCount(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.mmlBuf.length;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    isPlaying :function _trc_MML_isPlaying() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.m;\n    },\n    fiber$isPlaying :function _trc_MML_f_isPlaying(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.m;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    currentTime :function _trc_MML_currentTime() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=17000755;//kernel.MML:755\n      if (_this.m) {\n        return _this.m.currentTime+_this.cTimeBase;\n      }\n      return - 1;\n    },\n    fiber$currentTime :function _trc_MML_f_currentTime(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=17000755;//kernel.MML:755\n      if (_this.m) {\n        _thread.retVal=_this.m.currentTime+_this.cTimeBase;return;\n        \n      }\n      _thread.retVal=- 1;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stop :function _trc_MML_stop() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=17000829;//kernel.MML:829\n      if (_this.m) {\n        //$LASTPOS=17000847;//kernel.MML:847\n        if (_this.mwav) {\n          //$LASTPOS=17000872;//kernel.MML:872\n          _this.mwav.pause();\n          //$LASTPOS=17000899;//kernel.MML:899\n          _this.mwav.stop();\n          \n        }\n        //$LASTPOS=17000932;//kernel.MML:932\n        _this.m.pause();\n        //$LASTPOS=17000952;//kernel.MML:952\n        _this.m.stop();\n        //$LASTPOS=17000971;//kernel.MML:971\n        _this.m=null;\n        //$LASTPOS=17000988;//kernel.MML:988\n        _this.mmlBuf=[];\n        //$LASTPOS=17001056;//kernel.MML:1056\n        delete Tonyu.globals.$MMLS[_this.id()];\n        \n      }\n    },\n    fiber$stop :function _trc_MML_f_stop(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=17000829;//kernel.MML:829\n      if (_this.m) {\n        //$LASTPOS=17000847;//kernel.MML:847\n        if (_this.mwav) {\n          //$LASTPOS=17000872;//kernel.MML:872\n          _this.mwav.pause();\n          //$LASTPOS=17000899;//kernel.MML:899\n          _this.mwav.stop();\n          \n        }\n        //$LASTPOS=17000932;//kernel.MML:932\n        _this.m.pause();\n        //$LASTPOS=17000952;//kernel.MML:952\n        _this.m.stop();\n        //$LASTPOS=17000971;//kernel.MML:971\n        _this.m=null;\n        //$LASTPOS=17000988;//kernel.MML:988\n        _this.mmlBuf=[];\n        //$LASTPOS=17001056;//kernel.MML:1056\n        delete Tonyu.globals.$MMLS[_this.id()];\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"play":{"nowait":false},"playNext":{"nowait":false},"id":{"nowait":false},"bufferCount":{"nowait":false},"isPlaying":{"nowait":false},"currentTime":{"nowait":false},"stop":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.PlayMod\',\n  shortName: \'PlayMod\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.BaseActor,\n  includes: [],\n  methods: {\n    main :function _trc_PlayMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_PlayMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initMML :function _trc_PlayMod_initMML() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=18000045;//kernel.PlayMod:45\n      if (_this.mmlInited) {\n        return _this;\n      }\n      //$LASTPOS=18000073;//kernel.PlayMod:73\n      _this.mmlInited=true;\n      //$LASTPOS=18000094;//kernel.PlayMod:94\n      Tonyu.globals.$currentProject.requestPlugin("timbre");\n      //$LASTPOS=18000140;//kernel.PlayMod:140\n      if (! Tonyu.globals.$MMLS) {\n        //$LASTPOS=18000162;//kernel.PlayMod:162\n        Tonyu.globals.$MMLS={};\n        //$LASTPOS=18000180;//kernel.PlayMod:180\n        Tonyu.globals.$WaveTable=new Tonyu.classes.kernel.WaveTable;\n        //$LASTPOS=18000214;//kernel.PlayMod:214\n        Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseMML));\n        \n      }\n      //$LASTPOS=18000256;//kernel.PlayMod:256\n      _this.on("die",(function anonymous_266() {\n        \n        //$LASTPOS=18000272;//kernel.PlayMod:272\n        _this.play().stop();\n      }));\n    },\n    releaseMML :function _trc_PlayMod_releaseMML() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var k;\n      var v;\n      var _it_166;\n      \n      //$LASTPOS=18000322;//kernel.PlayMod:322\n      if (Tonyu.globals.$MMLS) {\n        //$LASTPOS=18000343;//kernel.PlayMod:343\n        _it_166=Tonyu.iterator(Tonyu.globals.$MMLS,2);\n        while(_it_166.next()) {\n          k=_it_166[0];\n          v=_it_166[1];\n          \n          //$LASTPOS=18000379;//kernel.PlayMod:379\n          v.stop();\n          \n        }\n        //$LASTPOS=18000407;//kernel.PlayMod:407\n        Tonyu.globals.$MMLS=null;\n        \n      }\n      //$LASTPOS=18000432;//kernel.PlayMod:432\n      if (Tonyu.globals.$WaveTable) {\n        //$LASTPOS=18000458;//kernel.PlayMod:458\n        Tonyu.globals.$WaveTable.stop();\n        //$LASTPOS=18000485;//kernel.PlayMod:485\n        Tonyu.globals.$WaveTable=null;\n        \n      }\n    },\n    play :function _trc_PlayMod_play() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var mmls;\n      var i;\n      \n      //$LASTPOS=18000528;//kernel.PlayMod:528\n      _this.initMML();\n      //$LASTPOS=18000544;//kernel.PlayMod:544\n      if (! _this._mml) {\n        //$LASTPOS=18000555;//kernel.PlayMod:555\n        _this._mml=new Tonyu.classes.kernel.MML;\n      }\n      //$LASTPOS=18000574;//kernel.PlayMod:574\n      if (_this.isDead()||arguments.length==0) {\n        return _this._mml;\n      }\n      //$LASTPOS=18000629;//kernel.PlayMod:629\n      mmls = [];\n      //$LASTPOS=18000647;//kernel.PlayMod:647\n      //$LASTPOS=18000652;//kernel.PlayMod:652\n      i = 0;\n      while(i<arguments.length) {\n        {\n          //$LASTPOS=18000697;//kernel.PlayMod:697\n          mmls.push(arguments[i]);\n        }\n        i++;\n      }\n      //$LASTPOS=18000734;//kernel.PlayMod:734\n      _this._mml.play(mmls);\n      //$LASTPOS=18000756;//kernel.PlayMod:756\n      while (_this._mml.bufferCount()>2) {\n        //$LASTPOS=18000796;//kernel.PlayMod:796\n        _this.update();\n        \n      }\n      return _this._mml;\n    },\n    fiber$play :function _trc_PlayMod_f_play(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var mmls;\n      var i;\n      \n      //$LASTPOS=18000528;//kernel.PlayMod:528\n      _this.initMML();\n      //$LASTPOS=18000544;//kernel.PlayMod:544\n      if (! _this._mml) {\n        //$LASTPOS=18000555;//kernel.PlayMod:555\n        _this._mml=new Tonyu.classes.kernel.MML;\n      }\n      //$LASTPOS=18000574;//kernel.PlayMod:574\n      if (_this.isDead()||_arguments.length==0) {\n        _thread.retVal=_this._mml;return;\n        \n      }\n      //$LASTPOS=18000629;//kernel.PlayMod:629\n      mmls = [];\n      //$LASTPOS=18000647;//kernel.PlayMod:647\n      //$LASTPOS=18000652;//kernel.PlayMod:652\n      i = 0;\n      while(i<_arguments.length) {\n        {\n          //$LASTPOS=18000697;//kernel.PlayMod:697\n          mmls.push(_arguments[i]);\n        }\n        i++;\n      }\n      //$LASTPOS=18000734;//kernel.PlayMod:734\n      _this._mml.play(mmls);\n      \n      _thread.enter(function _trc_PlayMod_ent_play(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=18000756;//kernel.PlayMod:756\n          case 1:\n            if (!(_this._mml.bufferCount()>2)) { __pc=3; break; }\n            //$LASTPOS=18000796;//kernel.PlayMod:796\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this._mml);return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    playSE :function _trc_PlayMod_playSE() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var mml;\n      var mmls;\n      var i;\n      \n      //$LASTPOS=18000859;//kernel.PlayMod:859\n      _this.initMML();\n      //$LASTPOS=18000875;//kernel.PlayMod:875\n      mml = new Tonyu.classes.kernel.MML;\n      //$LASTPOS=18000897;//kernel.PlayMod:897\n      mmls = [];\n      //$LASTPOS=18000915;//kernel.PlayMod:915\n      //$LASTPOS=18000920;//kernel.PlayMod:920\n      i = 0;\n      while(i<arguments.length) {\n        {\n          //$LASTPOS=18000965;//kernel.PlayMod:965\n          mmls.push(arguments[i]);\n        }\n        i++;\n      }\n      //$LASTPOS=18001002;//kernel.PlayMod:1002\n      mml.play(mmls);\n      return mml;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"initMML":{"nowait":true},"releaseMML":{"nowait":true},"play":{"nowait":false},"playSE":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.WaveTable\',\n  shortName: \'WaveTable\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [],\n  methods: {\n    main :function _trc_WaveTable_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=19000028;//kernel.WaveTable:28\n      _this.wav={};\n      //$LASTPOS=19000036;//kernel.WaveTable:36\n      _this.env={};\n      //$LASTPOS=19000313;//kernel.WaveTable:313\n      if (typeof  T!=="undefined") {\n        //$LASTPOS=19000392;//kernel.WaveTable:392\n        _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});\n        //$LASTPOS=19000460;//kernel.WaveTable:460\n        _this.setEnv(0,_this.env);\n        //$LASTPOS=19000480;//kernel.WaveTable:480\n        _this.setWav(0,T("pulse"));\n        \n      }\n    },\n    fiber$main :function _trc_WaveTable_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=19000028;//kernel.WaveTable:28\n      _this.wav={};\n      //$LASTPOS=19000036;//kernel.WaveTable:36\n      _this.env={};\n      \n      _thread.enter(function _trc_WaveTable_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=19000313;//kernel.WaveTable:313\n            if (!(typeof  T!=="undefined")) { __pc=3; break; }\n            //$LASTPOS=19000392;//kernel.WaveTable:392\n            _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});\n            //$LASTPOS=19000460;//kernel.WaveTable:460\n            _this.fiber$setEnv(_thread, 0, _this.env);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=19000480;//kernel.WaveTable:480\n            _this.fiber$setWav(_thread, 0, T("pulse"));\n            __pc=2;return;\n          case 2:\n            \n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    setWav :function _trc_WaveTable_setWav(num,synth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=19000070;//kernel.WaveTable:70\n      _this.wav[num]=synth;\n    },\n    fiber$setWav :function _trc_WaveTable_f_setWav(_thread,num,synth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=19000070;//kernel.WaveTable:70\n      _this.wav[num]=synth;\n      \n      _thread.retVal=_this;return;\n    },\n    setEnv :function _trc_WaveTable_setEnv(num,synth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=19000114;//kernel.WaveTable:114\n      _this.env[num]=synth;\n    },\n    fiber$setEnv :function _trc_WaveTable_f_setEnv(_thread,num,synth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=19000114;//kernel.WaveTable:114\n      _this.env[num]=synth;\n      \n      _thread.retVal=_this;return;\n    },\n    get :function _trc_WaveTable_get(w,e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var synth;\n      \n      //$LASTPOS=19000148;//kernel.WaveTable:148\n      synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});\n      return synth;\n    },\n    fiber$get :function _trc_WaveTable_f_get(_thread,w,e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var synth;\n      \n      //$LASTPOS=19000148;//kernel.WaveTable:148\n      synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});\n      _thread.retVal=synth;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stop :function _trc_WaveTable_stop() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$stop :function _trc_WaveTable_f_stop(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"setWav":{"nowait":false},"setEnv":{"nowait":false},"get":{"nowait":false},"stop":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.ParallelMod\',\n  shortName: \'ParallelMod\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.BaseActor,\n  includes: [],\n  methods: {\n    main :function _trc_ParallelMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_ParallelMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    parallel :function _trc_ParallelMod_parallel() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var args;\n      var i;\n      var name;\n      var th;\n      \n      //$LASTPOS=20000064;//kernel.ParallelMod:64\n      args = [];\n      //$LASTPOS=20000083;//kernel.ParallelMod:83\n      //$LASTPOS=20000088;//kernel.ParallelMod:88\n      i = 1;\n      while(i<arguments.length) {\n        {\n          //$LASTPOS=20000134;//kernel.ParallelMod:134\n          args.push(arguments[i]);\n        }\n        i++;\n      }\n      //$LASTPOS=20000173;//kernel.ParallelMod:173\n      name = arguments[0];\n      //$LASTPOS=20000202;//kernel.ParallelMod:202\n      th;\n      //$LASTPOS=20000216;//kernel.ParallelMod:216\n      th=Tonyu.globals.$Boot.schedule(_this,name,args);\n      return th;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"parallel":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Scheduler\',\n  shortName: \'Scheduler\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [],\n  methods: {\n    main :function _trc_Scheduler_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21000050;//kernel.Scheduler:50\n      _this.cur=[];\n      //$LASTPOS=21000059;//kernel.Scheduler:59\n      _this.next=[];\n    },\n    fiber$main :function _trc_Scheduler_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=21000050;//kernel.Scheduler:50\n      _this.cur=[];\n      //$LASTPOS=21000059;//kernel.Scheduler:59\n      _this.next=[];\n      \n      _thread.retVal=_this;return;\n    },\n    addObj :function _trc_Scheduler_addObj(obj,name,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.newThread(obj,name,args);\n    },\n    fiber$addObj :function _trc_Scheduler_f_addObj(_thread,obj,name,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.newThread(obj,name,args);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    newThread :function _trc_Scheduler_newThread(obj,name,args,options) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var th;\n      \n      //$LASTPOS=21000214;//kernel.Scheduler:214\n      name=name||"main";\n      //$LASTPOS=21000238;//kernel.Scheduler:238\n      args=args||[];\n      //$LASTPOS=21000258;//kernel.Scheduler:258\n      th = Tonyu.thread();\n      //$LASTPOS=21000286;//kernel.Scheduler:286\n      th.apply(obj,name,args);\n      //$LASTPOS=21000316;//kernel.Scheduler:316\n      _this.addToCur(th);\n      return th;\n    },\n    fiber$newThread :function _trc_Scheduler_f_newThread(_thread,obj,name,args,options) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var th;\n      \n      //$LASTPOS=21000214;//kernel.Scheduler:214\n      name=name||"main";\n      //$LASTPOS=21000238;//kernel.Scheduler:238\n      args=args||[];\n      //$LASTPOS=21000258;//kernel.Scheduler:258\n      th = Tonyu.thread();\n      //$LASTPOS=21000286;//kernel.Scheduler:286\n      th.apply(obj,name,args);\n      \n      _thread.enter(function _trc_Scheduler_ent_newThread(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=21000316;//kernel.Scheduler:316\n            _this.fiber$addToCur(_thread, th);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(th);return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    addToCur :function _trc_Scheduler_addToCur(th) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21000371;//kernel.Scheduler:371\n      _this.cur.push(th);\n      //$LASTPOS=21000390;//kernel.Scheduler:390\n      th.scheduled=_this;\n    },\n    fiber$addToCur :function _trc_Scheduler_f_addToCur(_thread,th) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=21000371;//kernel.Scheduler:371\n      _this.cur.push(th);\n      //$LASTPOS=21000390;//kernel.Scheduler:390\n      th.scheduled=_this;\n      \n      _thread.retVal=_this;return;\n    },\n    addToNext :function _trc_Scheduler_addToNext(th) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21000435;//kernel.Scheduler:435\n      _this.next.push(th);\n      //$LASTPOS=21000455;//kernel.Scheduler:455\n      th.scheduled=_this;\n    },\n    fiber$addToNext :function _trc_Scheduler_f_addToNext(_thread,th) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=21000435;//kernel.Scheduler:435\n      _this.next.push(th);\n      //$LASTPOS=21000455;//kernel.Scheduler:455\n      th.scheduled=_this;\n      \n      _thread.retVal=_this;return;\n    },\n    stepsAll :function _trc_Scheduler_stepsAll() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var t;\n      var _it_181;\n      \n      //$LASTPOS=21000497;//kernel.Scheduler:497\n      _it_181=Tonyu.iterator(_this.cur,1);\n      while(_it_181.next()) {\n        t=_it_181[0];\n        \n        //$LASTPOS=21000524;//kernel.Scheduler:524\n        delete t.scheduled;\n        //$LASTPOS=21000553;//kernel.Scheduler:553\n        t.steps();\n        //$LASTPOS=21000573;//kernel.Scheduler:573\n        if (t.preempted) {\n          //$LASTPOS=21000650;//kernel.Scheduler:650\n          _this.addToNext(t);\n          \n        }\n        \n      }\n      //$LASTPOS=21000687;//kernel.Scheduler:687\n      _this.cur=_this.next;\n      //$LASTPOS=21000702;//kernel.Scheduler:702\n      _this.next=[];\n    },\n    fiber$stepsAll :function _trc_Scheduler_f_stepsAll(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var t;\n      var _it_181;\n      \n      \n      _thread.enter(function _trc_Scheduler_ent_stepsAll(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=21000497;//kernel.Scheduler:497\n            _it_181=Tonyu.iterator(_this.cur,1);\n          case 1:\n            if (!(_it_181.next())) { __pc=4; break; }\n            t=_it_181[0];\n            \n            //$LASTPOS=21000524;//kernel.Scheduler:524\n            delete t.scheduled;\n            //$LASTPOS=21000553;//kernel.Scheduler:553\n            t.steps();\n            //$LASTPOS=21000573;//kernel.Scheduler:573\n            if (!(t.preempted)) { __pc=3; break; }\n            //$LASTPOS=21000650;//kernel.Scheduler:650\n            _this.fiber$addToNext(_thread, t);\n            __pc=2;return;\n          case 2:\n            \n          case 3:\n            \n            __pc=1;break;\n          case 4:\n            \n            //$LASTPOS=21000687;//kernel.Scheduler:687\n            _this.cur=_this.next;\n            //$LASTPOS=21000702;//kernel.Scheduler:702\n            _this.next=[];\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"addObj":{"nowait":false},"newThread":{"nowait":false},"addToCur":{"nowait":false},"addToNext":{"nowait":false},"stepsAll":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Actor\',\n  shortName: \'Actor\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.BaseActor,\n  includes: [Tonyu.classes.kernel.PlayMod,Tonyu.classes.kernel.ParallelMod],\n  methods: {\n    main :function _trc_Actor_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_Actor_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_Actor_initialize(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22000105;//kernel.Actor:105\n      Tonyu.classes.kernel.BaseActor.apply( _this, [x,y,p]);\n      //$LASTPOS=22000147;//kernel.Actor:147\n      _this.initSprite();\n    },\n    initSprite :function _trc_Actor_initSprite() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22000186;//kernel.Actor:186\n      if (_this.layer&&typeof  _this.layer.add=="function") {\n        //$LASTPOS=22000238;//kernel.Actor:238\n        _this.layer.add(_this);\n        \n      } else {\n        //$LASTPOS=22000276;//kernel.Actor:276\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      //$LASTPOS=22000308;//kernel.Actor:308\n      _this.onAppear();\n    },\n    fiber$initSprite :function _trc_Actor_f_initSprite(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=22000186;//kernel.Actor:186\n      if (_this.layer&&typeof  _this.layer.add=="function") {\n        //$LASTPOS=22000238;//kernel.Actor:238\n        _this.layer.add(_this);\n        \n      } else {\n        //$LASTPOS=22000276;//kernel.Actor:276\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      \n      _thread.enter(function _trc_Actor_ent_initSprite(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=22000308;//kernel.Actor:308\n            _this.fiber$onAppear(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    onAppear :function _trc_Actor_onAppear() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$onAppear :function _trc_Actor_f_onAppear(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"initSprite":{"nowait":false},"onAppear":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.CrashToHandler\',\n  shortName: \'CrashToHandler\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.EventHandler,\n  includes: [],\n  methods: {\n    main :function _trc_CrashToHandler_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_CrashToHandler_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    addListener :function _trc_CrashToHandler_addListener(d,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var retThread;\n      \n      //$LASTPOS=23000049;//kernel.CrashToHandler:49\n      retThread = _this.target.parallel("crashToChecker",d,f);\n      return {remove: (function anonymous_133() {\n        \n        //$LASTPOS=23000149;//kernel.CrashToHandler:149\n        retThread.kill();\n      })};\n    },\n    fiber$addListener :function _trc_CrashToHandler_f_addListener(_thread,d,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var retThread;\n      \n      //$LASTPOS=23000049;//kernel.CrashToHandler:49\n      retThread = _this.target.parallel("crashToChecker",d,f);\n      _thread.retVal={remove: (function anonymous_133() {\n        \n        //$LASTPOS=23000149;//kernel.CrashToHandler:149\n        retThread.kill();\n      })};return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_CrashToHandler_initialize(param) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=23000209;//kernel.CrashToHandler:209\n      Tonyu.classes.kernel.EventHandler.apply( _this, [param]);\n      //$LASTPOS=23000228;//kernel.CrashToHandler:228\n      _this.id=(Tonyu.globals.$idseq=(Tonyu.globals.$idseq||0)+1);\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"addListener":{"nowait":false},"new":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.GameScreen\',\n  shortName: \'GameScreen\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_GameScreen_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_GameScreen_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_GameScreen_initialize(opt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24000113;//kernel.GameScreen:113\n      _this.extend(opt);\n      //$LASTPOS=24000131;//kernel.GameScreen:131\n      _this.resize(_this.width,_this.height);\n      //$LASTPOS=24000159;//kernel.GameScreen:159\n      _this.bgColor="rgb(20,80,180)";\n      //$LASTPOS=24000195;//kernel.GameScreen:195\n      _this.isDrawGrid=Tonyu.globals.$Sprites.isDrawGrid;\n    },\n    resize :function _trc_GameScreen_resize(width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24000260;//kernel.GameScreen:260\n      _this.width=width;\n      //$LASTPOS=24000283;//kernel.GameScreen:283\n      _this.height=height;\n      //$LASTPOS=24000308;//kernel.GameScreen:308\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n      //$LASTPOS=24000351;//kernel.GameScreen:351\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=24000387;//kernel.GameScreen:387\n      _this.fireEvent("resize",width,height);\n    },\n    fiber$resize :function _trc_GameScreen_f_resize(_thread,width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=24000260;//kernel.GameScreen:260\n      _this.width=width;\n      //$LASTPOS=24000283;//kernel.GameScreen:283\n      _this.height=height;\n      //$LASTPOS=24000308;//kernel.GameScreen:308\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n      //$LASTPOS=24000351;//kernel.GameScreen:351\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=24000387;//kernel.GameScreen:387\n      _this.fireEvent("resize",width,height);\n      \n      _thread.retVal=_this;return;\n    },\n    setBounds :function _trc_GameScreen_setBounds(b) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24000622;//kernel.GameScreen:622\n      _this.bounds=b;\n    },\n    fiber$setBounds :function _trc_GameScreen_f_setBounds(_thread,b) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=24000622;//kernel.GameScreen:622\n      _this.bounds=b;\n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_GameScreen_draw(cctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b;\n      \n      //$LASTPOS=24000655;//kernel.GameScreen:655\n      b = _this.bounds;\n      //$LASTPOS=24000674;//kernel.GameScreen:674\n      _this.fillCanvas();\n      //$LASTPOS=24000693;//kernel.GameScreen:693\n      _this.sprites.draw(_this.buf[0]);\n      //$LASTPOS=24000720;//kernel.GameScreen:720\n      cctx.drawImage(_this.buf[0],0,0,_this.width,_this.height,b.left,b.top,b.width,b.height);\n    },\n    canvas2buf :function _trc_GameScreen_canvas2buf(point) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b;\n      \n      //$LASTPOS=24000859;//kernel.GameScreen:859\n      b = _this.bounds;\n      //$LASTPOS=24000878;//kernel.GameScreen:878\n      if (! b) {\n        return point;\n      }\n      return {x: (point.x-b.left)/b.width*_this.width,y: (point.y-b.top)/b.height*_this.height};\n    },\n    fiber$canvas2buf :function _trc_GameScreen_f_canvas2buf(_thread,point) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b;\n      \n      //$LASTPOS=24000859;//kernel.GameScreen:859\n      b = _this.bounds;\n      //$LASTPOS=24000878;//kernel.GameScreen:878\n      if (! b) {\n        _thread.retVal=point;return;\n        \n      }\n      _thread.retVal={x: (point.x-b.left)/b.width*_this.width,y: (point.y-b.top)/b.height*_this.height};return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGColor :function _trc_GameScreen_setBGColor(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24001016;//kernel.GameScreen:1016\n      _this.bgColor=c;\n    },\n    fiber$setBGColor :function _trc_GameScreen_f_setBGColor(_thread,c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=24001016;//kernel.GameScreen:1016\n      _this.bgColor=c;\n      \n      _thread.retVal=_this;return;\n    },\n    fillCanvas :function _trc_GameScreen_fillCanvas() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ctx;\n      \n      //$LASTPOS=24001056;//kernel.GameScreen:1056\n      ctx = _this.buf[0].getContext("2d");\n      //$LASTPOS=24001094;//kernel.GameScreen:1094\n      ctx.save();\n      //$LASTPOS=24001111;//kernel.GameScreen:1111\n      ctx.fillStyle=_this.bgColor;\n      //$LASTPOS=24001139;//kernel.GameScreen:1139\n      ctx.fillRect(0,0,_this.width,_this.height);\n      //$LASTPOS=24001213;//kernel.GameScreen:1213\n      ctx.restore();\n    },\n    fiber$fillCanvas :function _trc_GameScreen_f_fillCanvas(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var ctx;\n      \n      //$LASTPOS=24001056;//kernel.GameScreen:1056\n      ctx = _this.buf[0].getContext("2d");\n      //$LASTPOS=24001094;//kernel.GameScreen:1094\n      ctx.save();\n      //$LASTPOS=24001111;//kernel.GameScreen:1111\n      ctx.fillStyle=_this.bgColor;\n      //$LASTPOS=24001139;//kernel.GameScreen:1139\n      ctx.fillRect(0,0,_this.width,_this.height);\n      //$LASTPOS=24001213;//kernel.GameScreen:1213\n      ctx.restore();\n      \n      _thread.retVal=_this;return;\n    },\n    scrollTo :function _trc_GameScreen_scrollTo(scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24001265;//kernel.GameScreen:1265\n      _this.sprites.scrollTo(scrollX,scrollY);\n    },\n    fiber$scrollTo :function _trc_GameScreen_f_scrollTo(_thread,scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=24001265;//kernel.GameScreen:1265\n      _this.sprites.scrollTo(scrollX,scrollY);\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"resize":{"nowait":false},"setBounds":{"nowait":false},"draw":{"nowait":true},"canvas2buf":{"nowait":false},"setBGColor":{"nowait":false},"fillCanvas":{"nowait":false},"scrollTo":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Map\',\n  shortName: \'Map\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_Map_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_Map_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_Map_initialize(param) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var j;\n      var i;\n      \n      //$LASTPOS=25000060;//kernel.Map:60\n      _this.sx=0;\n      //$LASTPOS=25000071;//kernel.Map:71\n      _this.sy=0;\n      //$LASTPOS=25000082;//kernel.Map:82\n      Tonyu.classes.kernel.Actor.apply( _this, [param]);\n      //$LASTPOS=25000101;//kernel.Map:101\n      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n      //$LASTPOS=25000173;//kernel.Map:173\n      _this.mapObj=true;\n      //$LASTPOS=25000191;//kernel.Map:191\n      _this.mapTable=[];\n      //$LASTPOS=25000211;//kernel.Map:211\n      _this.mapOnTable=[];\n      //$LASTPOS=25000233;//kernel.Map:233\n      //$LASTPOS=25000237;//kernel.Map:237\n      j = 0;\n      while(j<_this.row) {\n        {\n          //$LASTPOS=25000266;//kernel.Map:266\n          _this.rows=[];\n          //$LASTPOS=25000286;//kernel.Map:286\n          //$LASTPOS=25000290;//kernel.Map:290\n          i = 0;\n          while(i<_this.col) {\n            {\n              //$LASTPOS=25000323;//kernel.Map:323\n              _this.rows.push(- 1);\n            }\n            i++;\n          }\n          //$LASTPOS=25000358;//kernel.Map:358\n          _this.mapTable.push(_this.rows);\n        }\n        j++;\n      }\n      //$LASTPOS=25000391;//kernel.Map:391\n      //$LASTPOS=25000395;//kernel.Map:395\n      j = 0;\n      while(j<_this.row) {\n        {\n          //$LASTPOS=25000424;//kernel.Map:424\n          _this.rows=[];\n          //$LASTPOS=25000444;//kernel.Map:444\n          //$LASTPOS=25000448;//kernel.Map:448\n          i = 0;\n          while(i<_this.col) {\n            {\n              //$LASTPOS=25000481;//kernel.Map:481\n              _this.rows.push(- 1);\n            }\n            i++;\n          }\n          //$LASTPOS=25000516;//kernel.Map:516\n          _this.mapOnTable.push(_this.rows);\n        }\n        j++;\n      }\n      //$LASTPOS=25000616;//kernel.Map:616\n      _this.initMap();\n    },\n    initMap :function _trc_Map_initMap() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var j;\n      \n      //$LASTPOS=25000648;//kernel.Map:648\n      if (! _this.mapData) {\n        return _this;\n      }\n      //$LASTPOS=25000674;//kernel.Map:674\n      //$LASTPOS=25000678;//kernel.Map:678\n      i = 0;\n      while(i<_this.row) {\n        {\n          //$LASTPOS=25000707;//kernel.Map:707\n          //$LASTPOS=25000711;//kernel.Map:711\n          j = 0;\n          while(j<_this.col) {\n            {\n              //$LASTPOS=25000744;//kernel.Map:744\n              _this.set(j,i,_this.mapData[i][j]);\n            }\n            j++;\n          }\n        }\n        i++;\n      }\n      //$LASTPOS=25000791;//kernel.Map:791\n      if (! _this.mapOnData) {\n        return _this;\n      }\n      //$LASTPOS=25000819;//kernel.Map:819\n      //$LASTPOS=25000823;//kernel.Map:823\n      i = 0;\n      while(i<_this.row) {\n        {\n          //$LASTPOS=25000852;//kernel.Map:852\n          //$LASTPOS=25000856;//kernel.Map:856\n          j = 0;\n          while(j<_this.col) {\n            {\n              //$LASTPOS=25000889;//kernel.Map:889\n              _this.setOn(j,i,_this.mapOnData[i][j]);\n            }\n            j++;\n          }\n        }\n        i++;\n      }\n    },\n    fiber$initMap :function _trc_Map_f_initMap(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var j;\n      \n      //$LASTPOS=25000648;//kernel.Map:648\n      if (! _this.mapData) {\n        _thread.retVal=_this;return;\n        \n      }\n      \n      _thread.enter(function _trc_Map_ent_initMap(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=25000674;//kernel.Map:674\n            //$LASTPOS=25000678;//kernel.Map:678\n            i = 0;;\n          case 1:\n            if (!(i<_this.row)) { __pc=5; break; }\n            //$LASTPOS=25000707;//kernel.Map:707\n            //$LASTPOS=25000711;//kernel.Map:711\n            j = 0;;\n          case 2:\n            if (!(j<_this.col)) { __pc=4; break; }\n            //$LASTPOS=25000744;//kernel.Map:744\n            _this.fiber$set(_thread, j, i, _this.mapData[i][j]);\n            __pc=3;return;\n          case 3:\n            \n            j++;\n            __pc=2;break;\n          case 4:\n            \n            i++;\n            __pc=1;break;\n          case 5:\n            \n            //$LASTPOS=25000791;//kernel.Map:791\n            if (!(! _this.mapOnData)) { __pc=6; break; }\n            _thread.exit(_this);return;\n          case 6:\n            \n            //$LASTPOS=25000819;//kernel.Map:819\n            //$LASTPOS=25000823;//kernel.Map:823\n            i = 0;;\n          case 7:\n            if (!(i<_this.row)) { __pc=11; break; }\n            //$LASTPOS=25000852;//kernel.Map:852\n            //$LASTPOS=25000856;//kernel.Map:856\n            j = 0;;\n          case 8:\n            if (!(j<_this.col)) { __pc=10; break; }\n            //$LASTPOS=25000889;//kernel.Map:889\n            _this.fiber$setOn(_thread, j, i, _this.mapOnData[i][j]);\n            __pc=9;return;\n          case 9:\n            \n            j++;\n            __pc=8;break;\n          case 10:\n            \n            i++;\n            __pc=7;break;\n          case 11:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    load :function _trc_Map_load(dataFile) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25000961;//kernel.Map:961\n      _this.baseData=_this.file("../maps/").rel(dataFile).obj();\n      //$LASTPOS=25001013;//kernel.Map:1013\n      if (! _this.baseData) {\n        //$LASTPOS=25001027;//kernel.Map:1027\n        _this.baseData=_this.file(dataFile).obj();\n      }\n      //$LASTPOS=25001063;//kernel.Map:1063\n      _this.mapTable=_this.baseData[0];\n      //$LASTPOS=25001090;//kernel.Map:1090\n      _this.mapData=_this.mapTable;\n      //$LASTPOS=25001113;//kernel.Map:1113\n      _this.row=_this.mapTable.length;\n      //$LASTPOS=25001139;//kernel.Map:1139\n      _this.col=_this.mapTable[0].length;\n      //$LASTPOS=25001168;//kernel.Map:1168\n      _this.mapOnTable=_this.baseData[1];\n      //$LASTPOS=25001197;//kernel.Map:1197\n      _this.mapOnData=_this.mapOnTable;\n      //$LASTPOS=25001224;//kernel.Map:1224\n      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n      //$LASTPOS=25001296;//kernel.Map:1296\n      _this.initMap();\n    },\n    fiber$load :function _trc_Map_f_load(_thread,dataFile) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=25000961;//kernel.Map:961\n      _this.baseData=_this.file("../maps/").rel(dataFile).obj();\n      //$LASTPOS=25001013;//kernel.Map:1013\n      if (! _this.baseData) {\n        //$LASTPOS=25001027;//kernel.Map:1027\n        _this.baseData=_this.file(dataFile).obj();\n      }\n      //$LASTPOS=25001063;//kernel.Map:1063\n      _this.mapTable=_this.baseData[0];\n      //$LASTPOS=25001090;//kernel.Map:1090\n      _this.mapData=_this.mapTable;\n      //$LASTPOS=25001113;//kernel.Map:1113\n      _this.row=_this.mapTable.length;\n      //$LASTPOS=25001139;//kernel.Map:1139\n      _this.col=_this.mapTable[0].length;\n      //$LASTPOS=25001168;//kernel.Map:1168\n      _this.mapOnTable=_this.baseData[1];\n      //$LASTPOS=25001197;//kernel.Map:1197\n      _this.mapOnData=_this.mapOnTable;\n      //$LASTPOS=25001224;//kernel.Map:1224\n      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n      \n      _thread.enter(function _trc_Map_ent_load(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=25001296;//kernel.Map:1296\n            _this.fiber$initMap(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    set :function _trc_Map_set(setCol,setRow,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25001339;//kernel.Map:1339\n      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n        return _this;\n      }\n      //$LASTPOS=25001407;//kernel.Map:1407\n      _this.mapTable[setRow][setCol]=p;\n      //$LASTPOS=25001478;//kernel.Map:1478\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=25001512;//kernel.Map:1512\n      p=Math.floor(p);\n      //$LASTPOS=25001534;//kernel.Map:1534\n      _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n      //$LASTPOS=25001572;//kernel.Map:1572\n      if (! _this.pImg) {\n        //$LASTPOS=25001594;//kernel.Map:1594\n        _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n        return _this;\n        \n      }\n      //$LASTPOS=25001695;//kernel.Map:1695\n      _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      //$LASTPOS=25001772;//kernel.Map:1772\n      _this.ctx.save();\n      //$LASTPOS=25001789;//kernel.Map:1789\n      _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      //$LASTPOS=25001933;//kernel.Map:1933\n      _this.ctx.restore();\n    },\n    fiber$set :function _trc_Map_f_set(_thread,setCol,setRow,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=25001339;//kernel.Map:1339\n      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=25001407;//kernel.Map:1407\n      _this.mapTable[setRow][setCol]=p;\n      //$LASTPOS=25001478;//kernel.Map:1478\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=25001512;//kernel.Map:1512\n      p=Math.floor(p);\n      //$LASTPOS=25001534;//kernel.Map:1534\n      _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n      //$LASTPOS=25001572;//kernel.Map:1572\n      if (! _this.pImg) {\n        //$LASTPOS=25001594;//kernel.Map:1594\n        _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n        _thread.retVal=_this;return;\n        \n        \n      }\n      //$LASTPOS=25001695;//kernel.Map:1695\n      _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      //$LASTPOS=25001772;//kernel.Map:1772\n      _this.ctx.save();\n      //$LASTPOS=25001789;//kernel.Map:1789\n      _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      //$LASTPOS=25001933;//kernel.Map:1933\n      _this.ctx.restore();\n      \n      _thread.retVal=_this;return;\n    },\n    setOn :function _trc_Map_setOn(setCol,setRow,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25001982;//kernel.Map:1982\n      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n        return _this;\n      }\n      //$LASTPOS=25002050;//kernel.Map:2050\n      _this.set(setCol,setRow,_this.mapTable[setRow][setCol]);\n      //$LASTPOS=25002100;//kernel.Map:2100\n      _this.mapOnTable[setRow][setCol]=p;\n      //$LASTPOS=25002135;//kernel.Map:2135\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=25002169;//kernel.Map:2169\n      p=Math.floor(p);\n      //$LASTPOS=25002191;//kernel.Map:2191\n      _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n      //$LASTPOS=25002229;//kernel.Map:2229\n      if (! _this.pImg) {\n        return _this;\n      }\n      //$LASTPOS=25002253;//kernel.Map:2253\n      _this.ctx.save();\n      //$LASTPOS=25002270;//kernel.Map:2270\n      _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      //$LASTPOS=25002414;//kernel.Map:2414\n      _this.ctx.restore();\n    },\n    fiber$setOn :function _trc_Map_f_setOn(_thread,setCol,setRow,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=25001982;//kernel.Map:1982\n      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n        _thread.retVal=_this;return;\n        \n      }\n      \n      _thread.enter(function _trc_Map_ent_setOn(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=25002050;//kernel.Map:2050\n            _this.fiber$set(_thread, setCol, setRow, _this.mapTable[setRow][setCol]);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=25002100;//kernel.Map:2100\n            _this.mapOnTable[setRow][setCol]=p;\n            //$LASTPOS=25002135;//kernel.Map:2135\n            _this.ctx=_this.buf[0].getContext("2d");\n            //$LASTPOS=25002169;//kernel.Map:2169\n            p=Math.floor(p);\n            //$LASTPOS=25002191;//kernel.Map:2191\n            _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n            //$LASTPOS=25002229;//kernel.Map:2229\n            if (!(! _this.pImg)) { __pc=2; break; }\n            _thread.exit(_this);return;\n          case 2:\n            \n            //$LASTPOS=25002253;//kernel.Map:2253\n            _this.ctx.save();\n            //$LASTPOS=25002270;//kernel.Map:2270\n            _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n            //$LASTPOS=25002414;//kernel.Map:2414\n            _this.ctx.restore();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    setOnAt :function _trc_Map_setOnAt(setX,setY,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25002461;//kernel.Map:2461\n      _this.setOn(Math.floor(setX/_this.chipWidth),Math.floor(setY/_this.chipHeight),p);\n    },\n    fiber$setOnAt :function _trc_Map_f_setOnAt(_thread,setX,setY,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Map_ent_setOnAt(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=25002461;//kernel.Map:2461\n            _this.fiber$setOn(_thread, Math.floor(setX/_this.chipWidth), Math.floor(setY/_this.chipHeight), p);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    setAt :function _trc_Map_setAt(setX,setY,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25002556;//kernel.Map:2556\n      _this.set(Math.floor(setX/_this.chipWidth),Math.floor(setY/_this.chipHeight),p);\n    },\n    fiber$setAt :function _trc_Map_f_setAt(_thread,setX,setY,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Map_ent_setAt(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=25002556;//kernel.Map:2556\n            _this.fiber$set(_thread, Math.floor(setX/_this.chipWidth), Math.floor(setY/_this.chipHeight), p);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    get :function _trc_Map_get(getCol,getRow) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25002649;//kernel.Map:2649\n      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n        return _this.mapTable[getRow][getCol];\n      }\n      return - 1;\n    },\n    fiber$get :function _trc_Map_f_get(_thread,getCol,getRow) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=25002649;//kernel.Map:2649\n      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n        _thread.retVal=_this.mapTable[getRow][getCol];return;\n        \n      }\n      _thread.retVal=- 1;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getAt :function _trc_Map_getAt(getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.get(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));\n    },\n    fiber$getAt :function _trc_Map_f_getAt(_thread,getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.get(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getOn :function _trc_Map_getOn(getCol,getRow) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25002881;//kernel.Map:2881\n      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n        return _this.mapOnTable[getRow][getCol];\n      }\n      return - 1;\n    },\n    fiber$getOn :function _trc_Map_f_getOn(_thread,getCol,getRow) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=25002881;//kernel.Map:2881\n      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n        _thread.retVal=_this.mapOnTable[getRow][getCol];return;\n        \n      }\n      _thread.retVal=- 1;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getOnAt :function _trc_Map_getOnAt(getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.getOn(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));\n    },\n    fiber$getOnAt :function _trc_Map_f_getOnAt(_thread,getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.getOn(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    scrollTo :function _trc_Map_scrollTo(scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25003124;//kernel.Map:3124\n      _this.sx=- scrollX;\n      //$LASTPOS=25003142;//kernel.Map:3142\n      _this.sy=- scrollY;\n    },\n    fiber$scrollTo :function _trc_Map_f_scrollTo(_thread,scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=25003124;//kernel.Map:3124\n      _this.sx=- scrollX;\n      //$LASTPOS=25003142;//kernel.Map:3142\n      _this.sy=- scrollY;\n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_Map_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25003177;//kernel.Map:3177\n      _this.pImg=_this.buf[0];\n      //$LASTPOS=25003195;//kernel.Map:3195\n      ctx.save();\n      //$LASTPOS=25003212;//kernel.Map:3212\n      ctx.drawImage(_this.pImg,0,0,_this.col*_this.chipWidth,_this.row*_this.chipHeight,_this.sx,_this.sy,_this.col*_this.chipWidth,_this.row*_this.chipHeight);\n      //$LASTPOS=25003324;//kernel.Map:3324\n      ctx.restore();\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"initMap":{"nowait":false},"load":{"nowait":false},"set":{"nowait":false},"setOn":{"nowait":false},"setOnAt":{"nowait":false},"setAt":{"nowait":false},"get":{"nowait":false},"getAt":{"nowait":false},"getOn":{"nowait":false},"getOnAt":{"nowait":false},"scrollTo":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Panel\',\n  shortName: \'Panel\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_Panel_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_Panel_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_Panel_initialize(opt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26000072;//kernel.Panel:72\n      Tonyu.classes.kernel.Actor.apply( _this, [opt]);\n      //$LASTPOS=26000089;//kernel.Panel:89\n      _this.width=_this.width;\n      //$LASTPOS=26000112;//kernel.Panel:112\n      _this.height=_this.height;\n      //$LASTPOS=26000137;//kernel.Panel:137\n      if (_this.align==null) {\n        //$LASTPOS=26000153;//kernel.Panel:153\n        _this.align="center";\n      }\n      //$LASTPOS=26000174;//kernel.Panel:174\n      if (_this.alpha==null) {\n        //$LASTPOS=26000190;//kernel.Panel:190\n        _this.alpha=255;\n      }\n      //$LASTPOS=26000206;//kernel.Panel:206\n      if (_this._drawn==null) {\n        //$LASTPOS=26000223;//kernel.Panel:223\n        _this._drawn=false;\n      }\n      //$LASTPOS=26000242;//kernel.Panel:242\n      _this.buf=$("<canvas>").attr({width: _this.width,height: _this.height});\n    },\n    setPanel :function _trc_Panel_setPanel(width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26000314;//kernel.Panel:314\n      _this.width=width;\n      //$LASTPOS=26000337;//kernel.Panel:337\n      _this.height=height;\n      //$LASTPOS=26000362;//kernel.Panel:362\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n    },\n    fiber$setPanel :function _trc_Panel_f_setPanel(_thread,width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=26000314;//kernel.Panel:314\n      _this.width=width;\n      //$LASTPOS=26000337;//kernel.Panel:337\n      _this.height=height;\n      //$LASTPOS=26000362;//kernel.Panel:362\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n      \n      _thread.retVal=_this;return;\n    },\n    resize :function _trc_Panel_resize(width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26000432;//kernel.Panel:432\n      _this.setPanel(width,height);\n    },\n    fiber$resize :function _trc_Panel_f_resize(_thread,width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_resize(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=26000432;//kernel.Panel:432\n            _this.fiber$setPanel(_thread, width, height);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    getContext :function _trc_Panel_getContext() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26000480;//kernel.Panel:480\n      _this._drawn=true;\n      return _this.buf[0].getContext("2d");\n    },\n    fiber$getContext :function _trc_Panel_f_getContext(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=26000480;//kernel.Panel:480\n      _this._drawn=true;\n      _thread.retVal=_this.buf[0].getContext("2d");return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setFillStyle :function _trc_Panel_setFillStyle(color) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26000561;//kernel.Panel:561\n      _this.fillStyle=color;\n    },\n    fiber$setFillStyle :function _trc_Panel_f_setFillStyle(_thread,color) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=26000561;//kernel.Panel:561\n      _this.fillStyle=color;\n      \n      _thread.retVal=_this;return;\n    },\n    fillRect :function _trc_Panel_fillRect(x,y,rectWidth,rectHeight) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26000629;//kernel.Panel:629\n      _this.ctx=_this.getContext();\n      //$LASTPOS=26000652;//kernel.Panel:652\n      _this.ctx.save();\n      //$LASTPOS=26000719;//kernel.Panel:719\n      _this.ctx.fillStyle=_this.fillStyle;\n      //$LASTPOS=26000749;//kernel.Panel:749\n      _this.ctx.fillRect(x,y,rectWidth,rectHeight);\n      //$LASTPOS=26000794;//kernel.Panel:794\n      _this.ctx.restore();\n    },\n    fiber$fillRect :function _trc_Panel_f_fillRect(_thread,x,y,rectWidth,rectHeight) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_fillRect(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=26000629;//kernel.Panel:629\n            _this.fiber$getContext(_thread);\n            __pc=1;return;\n          case 1:\n            _this.ctx=_thread.retVal;\n            \n            //$LASTPOS=26000652;//kernel.Panel:652\n            _this.ctx.save();\n            //$LASTPOS=26000719;//kernel.Panel:719\n            _this.ctx.fillStyle=_this.fillStyle;\n            //$LASTPOS=26000749;//kernel.Panel:749\n            _this.ctx.fillRect(x,y,rectWidth,rectHeight);\n            //$LASTPOS=26000794;//kernel.Panel:794\n            _this.ctx.restore();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    fillText :function _trc_Panel_fillText(text,x,y,size,align) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var splits;\n      var colCount;\n      \n      //$LASTPOS=26000850;//kernel.Panel:850\n      _this.ctx=_this.getContext();\n      //$LASTPOS=26000873;//kernel.Panel:873\n      _this.ctx.save();\n      //$LASTPOS=26000890;//kernel.Panel:890\n      text=text+"";\n      //$LASTPOS=26000909;//kernel.Panel:909\n      splits = text.split("\\n");\n      //$LASTPOS=26000995;//kernel.Panel:995\n      _this.ctx.textAlign=align;\n      //$LASTPOS=26001023;//kernel.Panel:1023\n      _this.ctx.fillStyle=_this.fillStyle;\n      //$LASTPOS=26001053;//kernel.Panel:1053\n      _this.ctx.font=size+"px \'Courier New\'";\n      //$LASTPOS=26001092;//kernel.Panel:1092\n      //$LASTPOS=26001096;//kernel.Panel:1096\n      colCount = 0;\n      while(colCount<splits.length) {\n        {\n          //$LASTPOS=26001156;//kernel.Panel:1156\n          _this.ctx.fillText(splits[colCount],x,y);\n          //$LASTPOS=26001201;//kernel.Panel:1201\n          y+=size;\n        }\n        colCount++;\n      }\n      //$LASTPOS=26001222;//kernel.Panel:1222\n      _this.ctx.restore();\n    },\n    fiber$fillText :function _trc_Panel_f_fillText(_thread,text,x,y,size,align) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var splits;\n      var colCount;\n      \n      \n      _thread.enter(function _trc_Panel_ent_fillText(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=26000850;//kernel.Panel:850\n            _this.fiber$getContext(_thread);\n            __pc=1;return;\n          case 1:\n            _this.ctx=_thread.retVal;\n            \n            //$LASTPOS=26000873;//kernel.Panel:873\n            _this.ctx.save();\n            //$LASTPOS=26000890;//kernel.Panel:890\n            text=text+"";\n            //$LASTPOS=26000909;//kernel.Panel:909\n            splits = text.split("\\n");\n            //$LASTPOS=26000995;//kernel.Panel:995\n            _this.ctx.textAlign=align;\n            //$LASTPOS=26001023;//kernel.Panel:1023\n            _this.ctx.fillStyle=_this.fillStyle;\n            //$LASTPOS=26001053;//kernel.Panel:1053\n            _this.ctx.font=size+"px \'Courier New\'";\n            //$LASTPOS=26001092;//kernel.Panel:1092\n            //$LASTPOS=26001096;//kernel.Panel:1096\n            colCount = 0;\n            while(colCount<splits.length) {\n              {\n                //$LASTPOS=26001156;//kernel.Panel:1156\n                _this.ctx.fillText(splits[colCount],x,y);\n                //$LASTPOS=26001201;//kernel.Panel:1201\n                y+=size;\n              }\n              colCount++;\n            }\n            //$LASTPOS=26001222;//kernel.Panel:1222\n            _this.ctx.restore();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    clearRect :function _trc_Panel_clearRect(clearX,clearY,clearW,clearH) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26001287;//kernel.Panel:1287\n      _this.ctx=_this.getContext();\n      //$LASTPOS=26001310;//kernel.Panel:1310\n      _this.ctx.save();\n      //$LASTPOS=26001327;//kernel.Panel:1327\n      _this.ctx.clearRect(clearX,clearY,clearW,clearH);\n      //$LASTPOS=26001376;//kernel.Panel:1376\n      _this.ctx.restore();\n    },\n    fiber$clearRect :function _trc_Panel_f_clearRect(_thread,clearX,clearY,clearW,clearH) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_clearRect(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=26001287;//kernel.Panel:1287\n            _this.fiber$getContext(_thread);\n            __pc=1;return;\n          case 1:\n            _this.ctx=_thread.retVal;\n            \n            //$LASTPOS=26001310;//kernel.Panel:1310\n            _this.ctx.save();\n            //$LASTPOS=26001327;//kernel.Panel:1327\n            _this.ctx.clearRect(clearX,clearY,clearW,clearH);\n            //$LASTPOS=26001376;//kernel.Panel:1376\n            _this.ctx.restore();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    getPixel :function _trc_Panel_getPixel(getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26001422;//kernel.Panel:1422\n      if (typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY)) {\n        //$LASTPOS=26001521;//kernel.Panel:1521\n        _this.ctx=_this.getContext();\n        //$LASTPOS=26001548;//kernel.Panel:1548\n        _this.imagedata=_this.ctx.getImageData(getX,getY,1,1);\n        //$LASTPOS=26001600;//kernel.Panel:1600\n        _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];\n        \n      } else {\n        //$LASTPOS=26001740;//kernel.Panel:1740\n        _this.colordata=[0,0,0,0];\n        \n      }\n      return (_this.colordata);\n    },\n    fiber$getPixel :function _trc_Panel_f_getPixel(_thread,getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_getPixel(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=26001422;//kernel.Panel:1422\n            if (!(typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY))) { __pc=2; break; }\n            //$LASTPOS=26001521;//kernel.Panel:1521\n            _this.fiber$getContext(_thread);\n            __pc=1;return;\n          case 1:\n            _this.ctx=_thread.retVal;\n            \n            //$LASTPOS=26001548;//kernel.Panel:1548\n            _this.imagedata=_this.ctx.getImageData(getX,getY,1,1);\n            //$LASTPOS=26001600;//kernel.Panel:1600\n            _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];\n            __pc=3;break;\n          case 2:\n            {\n              //$LASTPOS=26001740;//kernel.Panel:1740\n              _this.colordata=[0,0,0,0];\n            }\n          case 3:\n            \n            _thread.exit((_this.colordata));return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    scroll :function _trc_Panel_scroll(scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26001827;//kernel.Panel:1827\n      _this.ctx=_this.getContext();\n      //$LASTPOS=26001850;//kernel.Panel:1850\n      _this.ctx.save();\n      //$LASTPOS=26001867;//kernel.Panel:1867\n      _this.imagedata=_this.ctx.getImageData(0,0,_this.width,_this.height);\n      //$LASTPOS=26001928;//kernel.Panel:1928\n      _this.clearRect(0,0,_this.width,_this.height);\n      //$LASTPOS=26001962;//kernel.Panel:1962\n      _this.ctx.putImageData(_this.imagedata,- scrollX,- scrollY);\n      //$LASTPOS=26002014;//kernel.Panel:2014\n      _this.ctx.restore();\n    },\n    fiber$scroll :function _trc_Panel_f_scroll(_thread,scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_scroll(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=26001827;//kernel.Panel:1827\n            _this.fiber$getContext(_thread);\n            __pc=1;return;\n          case 1:\n            _this.ctx=_thread.retVal;\n            \n            //$LASTPOS=26001850;//kernel.Panel:1850\n            _this.ctx.save();\n            //$LASTPOS=26001867;//kernel.Panel:1867\n            _this.imagedata=_this.ctx.getImageData(0,0,_this.width,_this.height);\n            //$LASTPOS=26001928;//kernel.Panel:1928\n            _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=26001962;//kernel.Panel:1962\n            _this.ctx.putImageData(_this.imagedata,- scrollX,- scrollY);\n            //$LASTPOS=26002014;//kernel.Panel:2014\n            _this.ctx.restore();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    draw :function _trc_Panel_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26002050;//kernel.Panel:2050\n      if (_this._drawn) {\n        //$LASTPOS=26002071;//kernel.Panel:2071\n        _this.pImg=_this.buf[0];\n        //$LASTPOS=26002093;//kernel.Panel:2093\n        ctx.save();\n        //$LASTPOS=26002114;//kernel.Panel:2114\n        if (_this.align=="left") {\n          //$LASTPOS=26002146;//kernel.Panel:2146\n          ctx.translate(_this.x+_this.width/2,_this.y+_this.height/2);\n          \n        } else {\n          //$LASTPOS=26002198;//kernel.Panel:2198\n          if (_this.align=="center") {\n            //$LASTPOS=26002232;//kernel.Panel:2232\n            ctx.translate(_this.x,_this.y);\n            \n          } else {\n            //$LASTPOS=26002267;//kernel.Panel:2267\n            if (_this.align=="right") {\n              //$LASTPOS=26002300;//kernel.Panel:2300\n              ctx.translate(_this.x-_this.width/2,_this.y-_this.height/2);\n              \n            }\n          }\n        }\n        //$LASTPOS=26002357;//kernel.Panel:2357\n        if (_this.rotation!=0) {\n          //$LASTPOS=26002392;//kernel.Panel:2392\n          ctx.rotate(_this.rotation/180*Math.PI);\n          \n        } else {\n          //$LASTPOS=26002460;//kernel.Panel:2460\n          ctx.rotate(_this.rotate/180*Math.PI);\n          \n        }\n        //$LASTPOS=26002517;//kernel.Panel:2517\n        ctx.globalAlpha=_this.alpha/255;\n        //$LASTPOS=26002558;//kernel.Panel:2558\n        ctx.drawImage(_this.pImg,0,0,_this.width,_this.height,- _this.width/2,- _this.height/2,_this.width,_this.height);\n        //$LASTPOS=26002662;//kernel.Panel:2662\n        ctx.restore();\n        \n      }\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"setPanel":{"nowait":false},"resize":{"nowait":false},"getContext":{"nowait":false},"setFillStyle":{"nowait":false},"fillRect":{"nowait":false},"fillText":{"nowait":false},"clearRect":{"nowait":false},"getPixel":{"nowait":false},"scroll":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.ScaledCanvas\',\n  shortName: \'ScaledCanvas\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_ScaledCanvas_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_ScaledCanvas_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_ScaledCanvas_initialize(opt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27000095;//kernel.ScaledCanvas:95\n      _this.extend(opt);\n      //$LASTPOS=27000142;//kernel.ScaledCanvas:142\n      _this.resize(_this.width,_this.height);\n      //$LASTPOS=27000170;//kernel.ScaledCanvas:170\n      _this.cw=_this.canvas.width();\n      //$LASTPOS=27000194;//kernel.ScaledCanvas:194\n      _this.ch=_this.canvas.height();\n      //$LASTPOS=27000219;//kernel.ScaledCanvas:219\n      _this.cctx=_this.canvas[0].getContext("2d");\n      //$LASTPOS=27000257;//kernel.ScaledCanvas:257\n      _this.color="rgb(20,80,180)";\n      //$LASTPOS=27000291;//kernel.ScaledCanvas:291\n      _this.sx=0;\n      //$LASTPOS=27000302;//kernel.ScaledCanvas:302\n      _this.sy=0;\n      //$LASTPOS=27000313;//kernel.ScaledCanvas:313\n      _this.isDrawGrid=Tonyu.globals.$Sprites.isDrawGrid;\n    },\n    resize :function _trc_ScaledCanvas_resize(width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27000378;//kernel.ScaledCanvas:378\n      _this.width=width;\n      //$LASTPOS=27000401;//kernel.ScaledCanvas:401\n      _this.height=height;\n      //$LASTPOS=27000426;//kernel.ScaledCanvas:426\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n      //$LASTPOS=27000469;//kernel.ScaledCanvas:469\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=27000505;//kernel.ScaledCanvas:505\n      Tonyu.globals.$screenWidth=width;\n      //$LASTPOS=27000530;//kernel.ScaledCanvas:530\n      Tonyu.globals.$screenHeight=height;\n      //$LASTPOS=27000557;//kernel.ScaledCanvas:557\n      if (Tonyu.globals.$panel) {\n        //$LASTPOS=27000578;//kernel.ScaledCanvas:578\n        Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);\n        //$LASTPOS=27000632;//kernel.ScaledCanvas:632\n        Tonyu.globals.$panel.x=Tonyu.globals.$screenWidth/2;\n        //$LASTPOS=27000666;//kernel.ScaledCanvas:666\n        Tonyu.globals.$panel.y=Tonyu.globals.$screenHeight/2;\n        \n      }\n      //$LASTPOS=27000704;//kernel.ScaledCanvas:704\n      if (Tonyu.globals.$consolePanel) {\n        //$LASTPOS=27000732;//kernel.ScaledCanvas:732\n        Tonyu.globals.$consolePanel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);\n        //$LASTPOS=27000793;//kernel.ScaledCanvas:793\n        Tonyu.globals.$consolePanel.x=Tonyu.globals.$screenWidth/2;\n        //$LASTPOS=27000834;//kernel.ScaledCanvas:834\n        Tonyu.globals.$consolePanel.y=Tonyu.globals.$screenHeight/2;\n        //$LASTPOS=27000876;//kernel.ScaledCanvas:876\n        Tonyu.globals.$consolePrintY=Tonyu.globals.$screenHeight-15;\n        \n      }\n    },\n    fiber$resize :function _trc_ScaledCanvas_f_resize(_thread,width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27000378;//kernel.ScaledCanvas:378\n      _this.width=width;\n      //$LASTPOS=27000401;//kernel.ScaledCanvas:401\n      _this.height=height;\n      //$LASTPOS=27000426;//kernel.ScaledCanvas:426\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n      //$LASTPOS=27000469;//kernel.ScaledCanvas:469\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=27000505;//kernel.ScaledCanvas:505\n      Tonyu.globals.$screenWidth=width;\n      //$LASTPOS=27000530;//kernel.ScaledCanvas:530\n      Tonyu.globals.$screenHeight=height;\n      //$LASTPOS=27000557;//kernel.ScaledCanvas:557\n      if (Tonyu.globals.$panel) {\n        //$LASTPOS=27000578;//kernel.ScaledCanvas:578\n        Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);\n        //$LASTPOS=27000632;//kernel.ScaledCanvas:632\n        Tonyu.globals.$panel.x=Tonyu.globals.$screenWidth/2;\n        //$LASTPOS=27000666;//kernel.ScaledCanvas:666\n        Tonyu.globals.$panel.y=Tonyu.globals.$screenHeight/2;\n        \n      }\n      //$LASTPOS=27000704;//kernel.ScaledCanvas:704\n      if (Tonyu.globals.$consolePanel) {\n        //$LASTPOS=27000732;//kernel.ScaledCanvas:732\n        Tonyu.globals.$consolePanel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);\n        //$LASTPOS=27000793;//kernel.ScaledCanvas:793\n        Tonyu.globals.$consolePanel.x=Tonyu.globals.$screenWidth/2;\n        //$LASTPOS=27000834;//kernel.ScaledCanvas:834\n        Tonyu.globals.$consolePanel.y=Tonyu.globals.$screenHeight/2;\n        //$LASTPOS=27000876;//kernel.ScaledCanvas:876\n        Tonyu.globals.$consolePrintY=Tonyu.globals.$screenHeight-15;\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    shouldDraw1x1 :function _trc_ScaledCanvas_shouldDraw1x1(srcw,srch,dstw,dsth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var larger;\n      var smaller;\n      \n      //$LASTPOS=27000998;//kernel.ScaledCanvas:998\n      larger = 200;\n      //$LASTPOS=27001019;//kernel.ScaledCanvas:1019\n      smaller = 5;\n      return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;\n    },\n    fiber$shouldDraw1x1 :function _trc_ScaledCanvas_f_shouldDraw1x1(_thread,srcw,srch,dstw,dsth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var larger;\n      var smaller;\n      \n      //$LASTPOS=27000998;//kernel.ScaledCanvas:998\n      larger = 200;\n      //$LASTPOS=27001019;//kernel.ScaledCanvas:1019\n      smaller = 5;\n      _thread.retVal=srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_ScaledCanvas_draw() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var calcw;\n      var calch;\n      var marginw;\n      var marginh;\n      \n      //$LASTPOS=27001154;//kernel.ScaledCanvas:1154\n      _this.cw=_this.canvas.width();\n      //$LASTPOS=27001178;//kernel.ScaledCanvas:1178\n      _this.ch=_this.canvas.height();\n      //$LASTPOS=27001203;//kernel.ScaledCanvas:1203\n      calcw = _this.ch/_this.height*_this.width;\n      //$LASTPOS=27001247;//kernel.ScaledCanvas:1247\n      calch = _this.cw/_this.width*_this.height;\n      //$LASTPOS=27001291;//kernel.ScaledCanvas:1291\n      if (calch>_this.ch) {\n        //$LASTPOS=27001305;//kernel.ScaledCanvas:1305\n        calch=_this.ch;\n      }\n      //$LASTPOS=27001320;//kernel.ScaledCanvas:1320\n      if (calcw>_this.cw) {\n        //$LASTPOS=27001334;//kernel.ScaledCanvas:1334\n        calcw=_this.cw;\n      }\n      //$LASTPOS=27001349;//kernel.ScaledCanvas:1349\n      _this.cctx.clearRect(0,0,_this.cw,_this.ch);\n      //$LASTPOS=27001381;//kernel.ScaledCanvas:1381\n      if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n        //$LASTPOS=27001437;//kernel.ScaledCanvas:1437\n        calcw=_this.width;\n        //$LASTPOS=27001449;//kernel.ScaledCanvas:1449\n        calch=_this.height;\n        \n      }\n      //$LASTPOS=27001475;//kernel.ScaledCanvas:1475\n      marginw = Math.floor((_this.cw-calcw)/2);\n      //$LASTPOS=27001518;//kernel.ScaledCanvas:1518\n      marginh = Math.floor((_this.ch-calch)/2);\n      //$LASTPOS=27001561;//kernel.ScaledCanvas:1561\n      _this.cctx.drawImage(_this.buf[0],0,0,_this.width,_this.height,marginw,marginh,calcw,calch);\n    },\n    canvas2buf :function _trc_ScaledCanvas_canvas2buf(point) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var calcw;\n      var calch;\n      var marginw;\n      var marginh;\n      \n      //$LASTPOS=27001676;//kernel.ScaledCanvas:1676\n      calcw = _this.ch/_this.height*_this.width;\n      //$LASTPOS=27001720;//kernel.ScaledCanvas:1720\n      calch = _this.cw/_this.width*_this.height;\n      //$LASTPOS=27001764;//kernel.ScaledCanvas:1764\n      if (calch>_this.ch) {\n        //$LASTPOS=27001778;//kernel.ScaledCanvas:1778\n        calch=_this.ch;\n      }\n      //$LASTPOS=27001793;//kernel.ScaledCanvas:1793\n      if (calcw>_this.cw) {\n        //$LASTPOS=27001807;//kernel.ScaledCanvas:1807\n        calcw=_this.cw;\n      }\n      //$LASTPOS=27001822;//kernel.ScaledCanvas:1822\n      if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n        //$LASTPOS=27001878;//kernel.ScaledCanvas:1878\n        calcw=_this.width;\n        //$LASTPOS=27001890;//kernel.ScaledCanvas:1890\n        calch=_this.height;\n        \n      }\n      //$LASTPOS=27001916;//kernel.ScaledCanvas:1916\n      marginw = Math.floor((_this.cw-calcw)/2);\n      //$LASTPOS=27001959;//kernel.ScaledCanvas:1959\n      marginh = Math.floor((_this.ch-calch)/2);\n      //$LASTPOS=27002055;//kernel.ScaledCanvas:2055\n      _this._ret="("+point.x+"-"+marginw+")/"+calcw+"*"+_this.width+",";\n      return {x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};\n    },\n    fiber$canvas2buf :function _trc_ScaledCanvas_f_canvas2buf(_thread,point) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var calcw;\n      var calch;\n      var marginw;\n      var marginh;\n      \n      //$LASTPOS=27001676;//kernel.ScaledCanvas:1676\n      calcw = _this.ch/_this.height*_this.width;\n      //$LASTPOS=27001720;//kernel.ScaledCanvas:1720\n      calch = _this.cw/_this.width*_this.height;\n      //$LASTPOS=27001764;//kernel.ScaledCanvas:1764\n      if (calch>_this.ch) {\n        //$LASTPOS=27001778;//kernel.ScaledCanvas:1778\n        calch=_this.ch;\n      }\n      //$LASTPOS=27001793;//kernel.ScaledCanvas:1793\n      if (calcw>_this.cw) {\n        //$LASTPOS=27001807;//kernel.ScaledCanvas:1807\n        calcw=_this.cw;\n      }\n      //$LASTPOS=27001822;//kernel.ScaledCanvas:1822\n      if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n        //$LASTPOS=27001878;//kernel.ScaledCanvas:1878\n        calcw=_this.width;\n        //$LASTPOS=27001890;//kernel.ScaledCanvas:1890\n        calch=_this.height;\n        \n      }\n      //$LASTPOS=27001916;//kernel.ScaledCanvas:1916\n      marginw = Math.floor((_this.cw-calcw)/2);\n      //$LASTPOS=27001959;//kernel.ScaledCanvas:1959\n      marginh = Math.floor((_this.ch-calch)/2);\n      //$LASTPOS=27002055;//kernel.ScaledCanvas:2055\n      _this._ret="("+point.x+"-"+marginw+")/"+calcw+"*"+_this.width+",";\n      _thread.retVal={x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGColor :function _trc_ScaledCanvas_setBGColor(color) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27002228;//kernel.ScaledCanvas:2228\n      _this.color=color;\n    },\n    fiber$setBGColor :function _trc_ScaledCanvas_f_setBGColor(_thread,color) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27002228;//kernel.ScaledCanvas:2228\n      _this.color=color;\n      \n      _thread.retVal=_this;return;\n    },\n    fillCanvas :function _trc_ScaledCanvas_fillCanvas(cv) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ctx;\n      \n      //$LASTPOS=27002272;//kernel.ScaledCanvas:2272\n      ctx = cv.getContext("2d");\n      //$LASTPOS=27002306;//kernel.ScaledCanvas:2306\n      ctx.save();\n      //$LASTPOS=27002323;//kernel.ScaledCanvas:2323\n      ctx.fillStyle=Tonyu.globals.$Screen.color;\n      //$LASTPOS=27002357;//kernel.ScaledCanvas:2357\n      ctx.fillStyle=Tonyu.bindFunc(_this,_this.color);\n      //$LASTPOS=27002383;//kernel.ScaledCanvas:2383\n      ctx.fillRect(0,0,cv.width,cv.height);\n      //$LASTPOS=27002426;//kernel.ScaledCanvas:2426\n      if (_this.isDrawGrid) {\n        //$LASTPOS=27002442;//kernel.ScaledCanvas:2442\n        _this.drawGrid(cv);\n      }\n      //$LASTPOS=27002461;//kernel.ScaledCanvas:2461\n      ctx.restore();\n    },\n    fiber$fillCanvas :function _trc_ScaledCanvas_f_fillCanvas(_thread,cv) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var ctx;\n      \n      //$LASTPOS=27002272;//kernel.ScaledCanvas:2272\n      ctx = cv.getContext("2d");\n      //$LASTPOS=27002306;//kernel.ScaledCanvas:2306\n      ctx.save();\n      //$LASTPOS=27002323;//kernel.ScaledCanvas:2323\n      ctx.fillStyle=Tonyu.globals.$Screen.color;\n      //$LASTPOS=27002357;//kernel.ScaledCanvas:2357\n      ctx.fillStyle=Tonyu.bindFunc(_this,_this.color);\n      //$LASTPOS=27002383;//kernel.ScaledCanvas:2383\n      ctx.fillRect(0,0,cv.width,cv.height);\n      //$LASTPOS=27002426;//kernel.ScaledCanvas:2426\n      if (_this.isDrawGrid) {\n        //$LASTPOS=27002442;//kernel.ScaledCanvas:2442\n        _this.drawGrid(cv);\n      }\n      //$LASTPOS=27002461;//kernel.ScaledCanvas:2461\n      ctx.restore();\n      \n      _thread.retVal=_this;return;\n    },\n    scrollTo :function _trc_ScaledCanvas_scrollTo(scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27002805;//kernel.ScaledCanvas:2805\n      Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);\n    },\n    fiber$scrollTo :function _trc_ScaledCanvas_f_scrollTo(_thread,scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27002805;//kernel.ScaledCanvas:2805\n      Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"resize":{"nowait":false},"shouldDraw1x1":{"nowait":false},"draw":{"nowait":true},"canvas2buf":{"nowait":false},"setBGColor":{"nowait":false},"fillCanvas":{"nowait":false},"scrollTo":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Sprites\',\n  shortName: \'Sprites\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_Sprites_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_Sprites_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_Sprites_initialize() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28000045;//kernel.Sprites:45\n      _this.sprites=[];\n      //$LASTPOS=28000062;//kernel.Sprites:62\n      _this.imageList=[];\n      //$LASTPOS=28000081;//kernel.Sprites:81\n      _this.hitWatchers=[];\n      //$LASTPOS=28000102;//kernel.Sprites:102\n      _this.isDrawGrid=Tonyu.noviceMode;\n      //$LASTPOS=28000136;//kernel.Sprites:136\n      _this.sx=0;\n      //$LASTPOS=28000147;//kernel.Sprites:147\n      _this.sy=0;\n      //$LASTPOS=28000158;//kernel.Sprites:158\n      _this.objId=0;\n    },\n    add :function _trc_Sprites_add(s) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28000194;//kernel.Sprites:194\n      if (s.__addedToSprites) {\n        return _this;\n      }\n      //$LASTPOS=28000231;//kernel.Sprites:231\n      _this.sprites.push(s);\n      //$LASTPOS=28000253;//kernel.Sprites:253\n      if (s.__genId==null) {\n        //$LASTPOS=28000283;//kernel.Sprites:283\n        s.__genId=_this.objId;\n        //$LASTPOS=28000309;//kernel.Sprites:309\n        _this.objId++;\n        \n      }\n      //$LASTPOS=28000330;//kernel.Sprites:330\n      s.__addedToSprites=_this;\n      return s;\n    },\n    fiber$add :function _trc_Sprites_f_add(_thread,s) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=28000194;//kernel.Sprites:194\n      if (s.__addedToSprites) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=28000231;//kernel.Sprites:231\n      _this.sprites.push(s);\n      //$LASTPOS=28000253;//kernel.Sprites:253\n      if (s.__genId==null) {\n        //$LASTPOS=28000283;//kernel.Sprites:283\n        s.__genId=_this.objId;\n        //$LASTPOS=28000309;//kernel.Sprites:309\n        _this.objId++;\n        \n      }\n      //$LASTPOS=28000330;//kernel.Sprites:330\n      s.__addedToSprites=_this;\n      _thread.retVal=s;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    remove :function _trc_Sprites_remove(s) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var idx;\n      \n      //$LASTPOS=28000400;//kernel.Sprites:400\n      idx = _this.sprites.indexOf(s);\n      //$LASTPOS=28000433;//kernel.Sprites:433\n      if (idx<0) {\n        return _this;\n      }\n      //$LASTPOS=28000457;//kernel.Sprites:457\n      _this.sprites.splice(idx,1);\n      //$LASTPOS=28000485;//kernel.Sprites:485\n      delete s.__addedToSprites;\n    },\n    fiber$remove :function _trc_Sprites_f_remove(_thread,s) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var idx;\n      \n      //$LASTPOS=28000400;//kernel.Sprites:400\n      idx = _this.sprites.indexOf(s);\n      //$LASTPOS=28000433;//kernel.Sprites:433\n      if (idx<0) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=28000457;//kernel.Sprites:457\n      _this.sprites.splice(idx,1);\n      //$LASTPOS=28000485;//kernel.Sprites:485\n      delete s.__addedToSprites;\n      \n      _thread.retVal=_this;return;\n    },\n    removeOneframes :function _trc_Sprites_removeOneframes() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      \n      //$LASTPOS=28000542;//kernel.Sprites:542\n      //$LASTPOS=28000547;//kernel.Sprites:547\n      i = _this.sprites.length-1;\n      while(i>=0) {\n        {\n          //$LASTPOS=28000595;//kernel.Sprites:595\n          if (_this.sprites[i].oneframeSprite) {\n            //$LASTPOS=28000641;//kernel.Sprites:641\n            _this.sprites.splice(i,1);\n            \n          }\n        }\n        i--;\n      }\n    },\n    fiber$removeOneframes :function _trc_Sprites_f_removeOneframes(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      \n      //$LASTPOS=28000542;//kernel.Sprites:542\n      //$LASTPOS=28000547;//kernel.Sprites:547\n      i = _this.sprites.length-1;\n      while(i>=0) {\n        {\n          //$LASTPOS=28000595;//kernel.Sprites:595\n          if (_this.sprites[i].oneframeSprite) {\n            //$LASTPOS=28000641;//kernel.Sprites:641\n            _this.sprites.splice(i,1);\n            \n          }\n        }\n        i--;\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    clear :function _trc_Sprites_clear() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28000702;//kernel.Sprites:702\n      _this.sprites.splice(0,_this.sprites.length);\n    },\n    fiber$clear :function _trc_Sprites_f_clear(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=28000702;//kernel.Sprites:702\n      _this.sprites.splice(0,_this.sprites.length);\n      \n      _thread.retVal=_this;return;\n    },\n    compOrder :function _trc_Sprites_compOrder(obj1,obj2) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var val1;\n      var val2;\n      \n      //$LASTPOS=28000775;//kernel.Sprites:775\n      val1 = obj1.zOrder||0;\n      //$LASTPOS=28000805;//kernel.Sprites:805\n      val2 = obj2.zOrder||0;\n      //$LASTPOS=28000835;//kernel.Sprites:835\n      if (val1>val2) {\n        return - 1;\n        \n      } else {\n        //$LASTPOS=28000881;//kernel.Sprites:881\n        if (val1<val2) {\n          return 1;\n          \n        } else {\n          //$LASTPOS=28000926;//kernel.Sprites:926\n          if (val1==val2) {\n            //$LASTPOS=28000951;//kernel.Sprites:951\n            if (obj1.__genId>obj2.__genId) {\n              return 1;\n              \n            } else {\n              return - 1;\n              \n            }\n            return 0;\n            \n          }\n        }\n      }\n    },\n    fiber$compOrder :function _trc_Sprites_f_compOrder(_thread,obj1,obj2) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var val1;\n      var val2;\n      \n      //$LASTPOS=28000775;//kernel.Sprites:775\n      val1 = obj1.zOrder||0;\n      //$LASTPOS=28000805;//kernel.Sprites:805\n      val2 = obj2.zOrder||0;\n      //$LASTPOS=28000835;//kernel.Sprites:835\n      if (val1>val2) {\n        _thread.retVal=- 1;return;\n        \n        \n      } else {\n        //$LASTPOS=28000881;//kernel.Sprites:881\n        if (val1<val2) {\n          _thread.retVal=1;return;\n          \n          \n        } else {\n          //$LASTPOS=28000926;//kernel.Sprites:926\n          if (val1==val2) {\n            //$LASTPOS=28000951;//kernel.Sprites:951\n            if (obj1.__genId>obj2.__genId) {\n              _thread.retVal=1;return;\n              \n              \n            } else {\n              _thread.retVal=- 1;return;\n              \n              \n            }\n            _thread.retVal=0;return;\n            \n            \n          }\n        }\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_Sprites_draw(cv) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ctx;\n      var orderArray;\n      \n      //$LASTPOS=28001111;//kernel.Sprites:1111\n      ctx = cv.getContext("2d");\n      //$LASTPOS=28001145;//kernel.Sprites:1145\n      ctx.save();\n      //$LASTPOS=28001290;//kernel.Sprites:1290\n      orderArray = [];\n      //$LASTPOS=28001314;//kernel.Sprites:1314\n      orderArray=orderArray.concat(_this.sprites);\n      //$LASTPOS=28001358;//kernel.Sprites:1358\n      orderArray.sort(Tonyu.bindFunc(_this,_this.compOrder));\n      //$LASTPOS=28001391;//kernel.Sprites:1391\n      ctx.translate(- _this.sx,- _this.sy);\n      //$LASTPOS=28001420;//kernel.Sprites:1420\n      orderArray.forEach((function anonymous_1439(s) {\n        \n        //$LASTPOS=28001454;//kernel.Sprites:1454\n        s.draw(ctx);\n      }));\n      //$LASTPOS=28001481;//kernel.Sprites:1481\n      ctx.restore();\n    },\n    checkHit :function _trc_Sprites_checkHit() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28001527;//kernel.Sprites:1527\n      _this.hitWatchers.forEach((function anonymous_1547(w) {\n        \n        //$LASTPOS=28001571;//kernel.Sprites:1571\n        _this.sprites.forEach((function anonymous_1587(a) {\n          var a_owner;\n          \n          //$LASTPOS=28001659;//kernel.Sprites:1659\n          a_owner = a;\n          //$LASTPOS=28001701;//kernel.Sprites:1701\n          if (! (a_owner instanceof w.A)) {\n            return _this;\n          }\n          //$LASTPOS=28001754;//kernel.Sprites:1754\n          _this.sprites.forEach((function anonymous_1770(b) {\n            var b_owner;\n            \n            //$LASTPOS=28001802;//kernel.Sprites:1802\n            b_owner = b;\n            //$LASTPOS=28001848;//kernel.Sprites:1848\n            if (a===b) {\n              return _this;\n            }\n            //$LASTPOS=28001884;//kernel.Sprites:1884\n            if (! (b_owner instanceof w.B)) {\n              return _this;\n            }\n            //$LASTPOS=28001989;//kernel.Sprites:1989\n            if (a.crashTo1(b)) {\n              //$LASTPOS=28002092;//kernel.Sprites:2092\n              w.h(a_owner,b_owner);\n              \n            }\n          }));\n        }));\n      }));\n    },\n    fiber$checkHit :function _trc_Sprites_f_checkHit(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=28001527;//kernel.Sprites:1527\n      _this.hitWatchers.forEach((function anonymous_1547(w) {\n        \n        //$LASTPOS=28001571;//kernel.Sprites:1571\n        _this.sprites.forEach((function anonymous_1587(a) {\n          var a_owner;\n          \n          //$LASTPOS=28001659;//kernel.Sprites:1659\n          a_owner = a;\n          //$LASTPOS=28001701;//kernel.Sprites:1701\n          if (! (a_owner instanceof w.A)) {\n            return _this;\n          }\n          //$LASTPOS=28001754;//kernel.Sprites:1754\n          _this.sprites.forEach((function anonymous_1770(b) {\n            var b_owner;\n            \n            //$LASTPOS=28001802;//kernel.Sprites:1802\n            b_owner = b;\n            //$LASTPOS=28001848;//kernel.Sprites:1848\n            if (a===b) {\n              return _this;\n            }\n            //$LASTPOS=28001884;//kernel.Sprites:1884\n            if (! (b_owner instanceof w.B)) {\n              return _this;\n            }\n            //$LASTPOS=28001989;//kernel.Sprites:1989\n            if (a.crashTo1(b)) {\n              //$LASTPOS=28002092;//kernel.Sprites:2092\n              w.h(a_owner,b_owner);\n              \n            }\n          }));\n        }));\n      }));\n      \n      _thread.retVal=_this;return;\n    },\n    watchHit :function _trc_Sprites_watchHit(typeA,typeB,onHit) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var p;\n      \n      //$LASTPOS=28002222;//kernel.Sprites:2222\n      p = {A: typeA,B: typeB,h: onHit};\n      //$LASTPOS=28002286;//kernel.Sprites:2286\n      _this.hitWatchers.push(p);\n    },\n    drawGrid :function _trc_Sprites_drawGrid(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ctx;\n      var i;\n      \n      //$LASTPOS=28002339;//kernel.Sprites:2339\n      ctx = c.getContext("2d");\n      //$LASTPOS=28002372;//kernel.Sprites:2372\n      ctx.textBaseline="top";\n      //$LASTPOS=28002401;//kernel.Sprites:2401\n      ctx.save();\n      //$LASTPOS=28002418;//kernel.Sprites:2418\n      ctx.strokeStyle="rgb(40,100,200)";\n      //$LASTPOS=28002458;//kernel.Sprites:2458\n      //$LASTPOS=28002463;//kernel.Sprites:2463\n      i = 0;\n      while(i<c.width) {\n        {\n          //$LASTPOS=28002503;//kernel.Sprites:2503\n          ctx.beginPath();\n          //$LASTPOS=28002529;//kernel.Sprites:2529\n          ctx.lineWidth=(i%100==0?4:1);\n          //$LASTPOS=28002575;//kernel.Sprites:2575\n          ctx.moveTo(i,0);\n          //$LASTPOS=28002601;//kernel.Sprites:2601\n          ctx.lineTo(i,c.height);\n          //$LASTPOS=28002634;//kernel.Sprites:2634\n          ctx.closePath();\n          //$LASTPOS=28002660;//kernel.Sprites:2660\n          ctx.stroke();\n        }\n        i+=10;\n      }\n      //$LASTPOS=28002692;//kernel.Sprites:2692\n      //$LASTPOS=28002697;//kernel.Sprites:2697\n      i = 0;\n      while(i<c.height) {\n        {\n          //$LASTPOS=28002738;//kernel.Sprites:2738\n          ctx.beginPath();\n          //$LASTPOS=28002764;//kernel.Sprites:2764\n          ctx.lineWidth=(i%100==0?4:1);\n          //$LASTPOS=28002810;//kernel.Sprites:2810\n          ctx.moveTo(0,i);\n          //$LASTPOS=28002836;//kernel.Sprites:2836\n          ctx.lineTo(c.width,i);\n          //$LASTPOS=28002868;//kernel.Sprites:2868\n          ctx.closePath();\n          //$LASTPOS=28002894;//kernel.Sprites:2894\n          ctx.stroke();\n        }\n        i+=10;\n      }\n      //$LASTPOS=28002920;//kernel.Sprites:2920\n      ctx.fillStyle="white";\n      //$LASTPOS=28002948;//kernel.Sprites:2948\n      ctx.font="15px monospaced";\n      //$LASTPOS=28002981;//kernel.Sprites:2981\n      //$LASTPOS=28002986;//kernel.Sprites:2986\n      i = 100;\n      while(i<c.width) {\n        {\n          //$LASTPOS=28003029;//kernel.Sprites:3029\n          ctx.fillText(i,i,0);\n        }\n        i+=100;\n      }\n      //$LASTPOS=28003063;//kernel.Sprites:3063\n      //$LASTPOS=28003068;//kernel.Sprites:3068\n      i = 100;\n      while(i<c.height) {\n        {\n          //$LASTPOS=28003112;//kernel.Sprites:3112\n          ctx.fillText(i,0,i);\n        }\n        i+=100;\n      }\n      //$LASTPOS=28003146;//kernel.Sprites:3146\n      ctx.restore();\n    },\n    fiber$drawGrid :function _trc_Sprites_f_drawGrid(_thread,c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var ctx;\n      var i;\n      \n      //$LASTPOS=28002339;//kernel.Sprites:2339\n      ctx = c.getContext("2d");\n      //$LASTPOS=28002372;//kernel.Sprites:2372\n      ctx.textBaseline="top";\n      //$LASTPOS=28002401;//kernel.Sprites:2401\n      ctx.save();\n      //$LASTPOS=28002418;//kernel.Sprites:2418\n      ctx.strokeStyle="rgb(40,100,200)";\n      //$LASTPOS=28002458;//kernel.Sprites:2458\n      //$LASTPOS=28002463;//kernel.Sprites:2463\n      i = 0;\n      while(i<c.width) {\n        {\n          //$LASTPOS=28002503;//kernel.Sprites:2503\n          ctx.beginPath();\n          //$LASTPOS=28002529;//kernel.Sprites:2529\n          ctx.lineWidth=(i%100==0?4:1);\n          //$LASTPOS=28002575;//kernel.Sprites:2575\n          ctx.moveTo(i,0);\n          //$LASTPOS=28002601;//kernel.Sprites:2601\n          ctx.lineTo(i,c.height);\n          //$LASTPOS=28002634;//kernel.Sprites:2634\n          ctx.closePath();\n          //$LASTPOS=28002660;//kernel.Sprites:2660\n          ctx.stroke();\n        }\n        i+=10;\n      }\n      //$LASTPOS=28002692;//kernel.Sprites:2692\n      //$LASTPOS=28002697;//kernel.Sprites:2697\n      i = 0;\n      while(i<c.height) {\n        {\n          //$LASTPOS=28002738;//kernel.Sprites:2738\n          ctx.beginPath();\n          //$LASTPOS=28002764;//kernel.Sprites:2764\n          ctx.lineWidth=(i%100==0?4:1);\n          //$LASTPOS=28002810;//kernel.Sprites:2810\n          ctx.moveTo(0,i);\n          //$LASTPOS=28002836;//kernel.Sprites:2836\n          ctx.lineTo(c.width,i);\n          //$LASTPOS=28002868;//kernel.Sprites:2868\n          ctx.closePath();\n          //$LASTPOS=28002894;//kernel.Sprites:2894\n          ctx.stroke();\n        }\n        i+=10;\n      }\n      //$LASTPOS=28002920;//kernel.Sprites:2920\n      ctx.fillStyle="white";\n      //$LASTPOS=28002948;//kernel.Sprites:2948\n      ctx.font="15px monospaced";\n      //$LASTPOS=28002981;//kernel.Sprites:2981\n      //$LASTPOS=28002986;//kernel.Sprites:2986\n      i = 100;\n      while(i<c.width) {\n        {\n          //$LASTPOS=28003029;//kernel.Sprites:3029\n          ctx.fillText(i,i,0);\n        }\n        i+=100;\n      }\n      //$LASTPOS=28003063;//kernel.Sprites:3063\n      //$LASTPOS=28003068;//kernel.Sprites:3068\n      i = 100;\n      while(i<c.height) {\n        {\n          //$LASTPOS=28003112;//kernel.Sprites:3112\n          ctx.fillText(i,0,i);\n        }\n        i+=100;\n      }\n      //$LASTPOS=28003146;//kernel.Sprites:3146\n      ctx.restore();\n      \n      _thread.retVal=_this;return;\n    },\n    setImageList :function _trc_Sprites_setImageList(il) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28003198;//kernel.Sprites:3198\n      _this.imageList=il;\n    },\n    fiber$setImageList :function _trc_Sprites_f_setImageList(_thread,il) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=28003198;//kernel.Sprites:3198\n      _this.imageList=il;\n      \n      _thread.retVal=_this;return;\n    },\n    getImageList :function _trc_Sprites_getImageList() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.imageList;\n    },\n    fiber$getImageList :function _trc_Sprites_f_getImageList(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.imageList;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    scrollTo :function _trc_Sprites_scrollTo(scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28003310;//kernel.Sprites:3310\n      _this.sx=scrollX;\n      //$LASTPOS=28003327;//kernel.Sprites:3327\n      _this.sy=scrollY;\n    },\n    fiber$scrollTo :function _trc_Sprites_f_scrollTo(_thread,scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=28003310;//kernel.Sprites:3310\n      _this.sx=scrollX;\n      //$LASTPOS=28003327;//kernel.Sprites:3327\n      _this.sy=scrollY;\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"add":{"nowait":false},"remove":{"nowait":false},"removeOneframes":{"nowait":false},"clear":{"nowait":false},"compOrder":{"nowait":false},"draw":{"nowait":true},"checkHit":{"nowait":false},"watchHit":{"nowait":true},"drawGrid":{"nowait":false},"setImageList":{"nowait":false},"getImageList":{"nowait":false},"scrollTo":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.BodyActor\',\n  shortName: \'BodyActor\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [Tonyu.classes.kernel.T2Mod],\n  methods: {\n    main :function _trc_BodyActor_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_BodyActor_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getWorld :function _trc_BodyActor_getWorld() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=29000064;//kernel.BodyActor:64\n      if (Tonyu.globals.$t2World) {\n        return Tonyu.globals.$t2World;\n      }\n      //$LASTPOS=29000099;//kernel.BodyActor:99\n      Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;\n      return Tonyu.globals.$t2World;\n    },\n    fiber$getWorld :function _trc_BodyActor_f_getWorld(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=29000064;//kernel.BodyActor:64\n      if (Tonyu.globals.$t2World) {\n        _thread.retVal=Tonyu.globals.$t2World;return;\n        \n      }\n      //$LASTPOS=29000099;//kernel.BodyActor:99\n      Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;\n      _thread.retVal=Tonyu.globals.$t2World;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    onAppear :function _trc_BodyActor_onAppear() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var wworld;\n      var b2Vec2;\n      var b2BodyDef;\n      var b2Body;\n      var b2FixtureDef;\n      var b2Fixture;\n      var b2PolygonShape;\n      var b2CircleShape;\n      var fixDef;\n      var bodyDef;\n      var w;\n      var h;\n      var fps;\n      var r;\n      var ve;\n      var vr;\n      \n      //$LASTPOS=29000162;//kernel.BodyActor:162\n      wworld = _this.getWorld();\n      //$LASTPOS=29000189;//kernel.BodyActor:189\n      _this.world=wworld.world;\n      //$LASTPOS=29000213;//kernel.BodyActor:213\n      _this.scale=wworld.scale;\n      //$LASTPOS=29000237;//kernel.BodyActor:237\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=29000280;//kernel.BodyActor:280\n      b2BodyDef = Box2D.Dynamics.b2BodyDef;\n      //$LASTPOS=29000326;//kernel.BodyActor:326\n      b2Body = Box2D.Dynamics.b2Body;\n      //$LASTPOS=29000366;//kernel.BodyActor:366\n      b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n      //$LASTPOS=29000418;//kernel.BodyActor:418\n      b2Fixture = Box2D.Dynamics.b2Fixture;\n      //$LASTPOS=29000464;//kernel.BodyActor:464\n      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n      //$LASTPOS=29000528;//kernel.BodyActor:528\n      b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n      //$LASTPOS=29000595;//kernel.BodyActor:595\n      fixDef = new b2FixtureDef;\n      //$LASTPOS=29000630;//kernel.BodyActor:630\n      fixDef.density=_this.defv(_this.density,1);\n      //$LASTPOS=29000671;//kernel.BodyActor:671\n      fixDef.friction=_this.defv(_this.friction,0.5);\n      //$LASTPOS=29000714;//kernel.BodyActor:714\n      fixDef.restitution=_this.defv(_this.restitution,0.2);\n      //$LASTPOS=29000768;//kernel.BodyActor:768\n      bodyDef = new b2BodyDef;\n      //$LASTPOS=29000801;//kernel.BodyActor:801\n      bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;\n      //$LASTPOS=29000886;//kernel.BodyActor:886\n      bodyDef.position.x=_this.x/_this.scale;\n      //$LASTPOS=29000921;//kernel.BodyActor:921\n      bodyDef.position.y=_this.y/_this.scale;\n      //$LASTPOS=29000956;//kernel.BodyActor:956\n      _this.shape=_this.shape||(_this.radius?"circle":"box");\n      //$LASTPOS=29001004;//kernel.BodyActor:1004\n      w = _this.width;h = _this.height;\n      //$LASTPOS=29001030;//kernel.BodyActor:1030\n      if (! w) {\n        //$LASTPOS=29001048;//kernel.BodyActor:1048\n        _this.detectShape();\n        //$LASTPOS=29001071;//kernel.BodyActor:1071\n        w=_this.width*(_this.scaleX||1);\n        //$LASTPOS=29001100;//kernel.BodyActor:1100\n        h=_this.height*(_this.scaleY||_this.scaleX||1);\n        \n      }\n      //$LASTPOS=29001140;//kernel.BodyActor:1140\n      if (_this.shape=="box") {\n        //$LASTPOS=29001168;//kernel.BodyActor:1168\n        if (! h) {\n          //$LASTPOS=29001176;//kernel.BodyActor:1176\n          h=w;\n        }\n        //$LASTPOS=29001189;//kernel.BodyActor:1189\n        fixDef.shape=new b2PolygonShape;\n        //$LASTPOS=29001232;//kernel.BodyActor:1232\n        fixDef.shape.SetAsOrientedBox(w/2/_this.scale,h/2/_this.scale,new b2Vec2(0,0),0);\n        \n      } else {\n        //$LASTPOS=29001333;//kernel.BodyActor:1333\n        _this.radius=_this.radius||w/2||16;\n        //$LASTPOS=29001369;//kernel.BodyActor:1369\n        fixDef.shape=new b2CircleShape(_this.radius/_this.scale);\n        //$LASTPOS=29001443;//kernel.BodyActor:1443\n        _this.width=_this.height=_this.radius*2;\n        \n      }\n      //$LASTPOS=29001477;//kernel.BodyActor:1477\n      fps = wworld.fps;\n      //$LASTPOS=29001501;//kernel.BodyActor:1501\n      r = _this.rotation;ve = _this.bvec(_this.defv(_this.vx*fps,0),_this.defv(_this.vy*fps,0));vr = _this.defv(_this.vrotation,0);\n      //$LASTPOS=29001582;//kernel.BodyActor:1582\n      _this.body=_this.world.CreateBody(bodyDef);\n      //$LASTPOS=29001618;//kernel.BodyActor:1618\n      _this.body.CreateFixture(fixDef);\n      //$LASTPOS=29001650;//kernel.BodyActor:1650\n      _this.body.SetUserData(_this);\n      //$LASTPOS=29001678;//kernel.BodyActor:1678\n      _this.body.SetLinearVelocity(ve);\n      //$LASTPOS=29001710;//kernel.BodyActor:1710\n      _this.rotation=r;\n      //$LASTPOS=29001726;//kernel.BodyActor:1726\n      _this.vrotation=vr;\n    },\n    fiber$onAppear :function _trc_BodyActor_f_onAppear(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var wworld;\n      var b2Vec2;\n      var b2BodyDef;\n      var b2Body;\n      var b2FixtureDef;\n      var b2Fixture;\n      var b2PolygonShape;\n      var b2CircleShape;\n      var fixDef;\n      var bodyDef;\n      var w;\n      var h;\n      var fps;\n      var r;\n      var ve;\n      var vr;\n      \n      //$LASTPOS=29000162;//kernel.BodyActor:162\n      wworld = _this.getWorld();\n      //$LASTPOS=29000189;//kernel.BodyActor:189\n      _this.world=wworld.world;\n      //$LASTPOS=29000213;//kernel.BodyActor:213\n      _this.scale=wworld.scale;\n      //$LASTPOS=29000237;//kernel.BodyActor:237\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=29000280;//kernel.BodyActor:280\n      b2BodyDef = Box2D.Dynamics.b2BodyDef;\n      //$LASTPOS=29000326;//kernel.BodyActor:326\n      b2Body = Box2D.Dynamics.b2Body;\n      //$LASTPOS=29000366;//kernel.BodyActor:366\n      b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n      //$LASTPOS=29000418;//kernel.BodyActor:418\n      b2Fixture = Box2D.Dynamics.b2Fixture;\n      //$LASTPOS=29000464;//kernel.BodyActor:464\n      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n      //$LASTPOS=29000528;//kernel.BodyActor:528\n      b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n      //$LASTPOS=29000595;//kernel.BodyActor:595\n      fixDef = new b2FixtureDef;\n      \n      _thread.enter(function _trc_BodyActor_ent_onAppear(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=29000630;//kernel.BodyActor:630\n            _this.fiber$defv(_thread, _this.density, 1);\n            __pc=1;return;\n          case 1:\n            fixDef.density=_thread.retVal;\n            \n            //$LASTPOS=29000671;//kernel.BodyActor:671\n            _this.fiber$defv(_thread, _this.friction, 0.5);\n            __pc=2;return;\n          case 2:\n            fixDef.friction=_thread.retVal;\n            \n            //$LASTPOS=29000714;//kernel.BodyActor:714\n            _this.fiber$defv(_thread, _this.restitution, 0.2);\n            __pc=3;return;\n          case 3:\n            fixDef.restitution=_thread.retVal;\n            \n            //$LASTPOS=29000768;//kernel.BodyActor:768\n            bodyDef = new b2BodyDef;\n            //$LASTPOS=29000801;//kernel.BodyActor:801\n            bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;\n            //$LASTPOS=29000886;//kernel.BodyActor:886\n            bodyDef.position.x=_this.x/_this.scale;\n            //$LASTPOS=29000921;//kernel.BodyActor:921\n            bodyDef.position.y=_this.y/_this.scale;\n            //$LASTPOS=29000956;//kernel.BodyActor:956\n            _this.shape=_this.shape||(_this.radius?"circle":"box");\n            //$LASTPOS=29001004;//kernel.BodyActor:1004\n            w = _this.width;h = _this.height;\n            //$LASTPOS=29001030;//kernel.BodyActor:1030\n            if (! w) {\n              //$LASTPOS=29001048;//kernel.BodyActor:1048\n              _this.detectShape();\n              //$LASTPOS=29001071;//kernel.BodyActor:1071\n              w=_this.width*(_this.scaleX||1);\n              //$LASTPOS=29001100;//kernel.BodyActor:1100\n              h=_this.height*(_this.scaleY||_this.scaleX||1);\n              \n            }\n            //$LASTPOS=29001140;//kernel.BodyActor:1140\n            if (_this.shape=="box") {\n              //$LASTPOS=29001168;//kernel.BodyActor:1168\n              if (! h) {\n                //$LASTPOS=29001176;//kernel.BodyActor:1176\n                h=w;\n              }\n              //$LASTPOS=29001189;//kernel.BodyActor:1189\n              fixDef.shape=new b2PolygonShape;\n              //$LASTPOS=29001232;//kernel.BodyActor:1232\n              fixDef.shape.SetAsOrientedBox(w/2/_this.scale,h/2/_this.scale,new b2Vec2(0,0),0);\n              \n            } else {\n              //$LASTPOS=29001333;//kernel.BodyActor:1333\n              _this.radius=_this.radius||w/2||16;\n              //$LASTPOS=29001369;//kernel.BodyActor:1369\n              fixDef.shape=new b2CircleShape(_this.radius/_this.scale);\n              //$LASTPOS=29001443;//kernel.BodyActor:1443\n              _this.width=_this.height=_this.radius*2;\n              \n            }\n            //$LASTPOS=29001477;//kernel.BodyActor:1477\n            fps = wworld.fps;\n            //$LASTPOS=29001501;//kernel.BodyActor:1501\n            r = _this.rotation;ve = _this.bvec(_this.defv(_this.vx*fps,0),_this.defv(_this.vy*fps,0));vr = _this.defv(_this.vrotation,0);\n            //$LASTPOS=29001582;//kernel.BodyActor:1582\n            _this.body=_this.world.CreateBody(bodyDef);\n            //$LASTPOS=29001618;//kernel.BodyActor:1618\n            _this.body.CreateFixture(fixDef);\n            //$LASTPOS=29001650;//kernel.BodyActor:1650\n            _this.body.SetUserData(_this);\n            //$LASTPOS=29001678;//kernel.BodyActor:1678\n            _this.body.SetLinearVelocity(ve);\n            //$LASTPOS=29001710;//kernel.BodyActor:1710\n            _this.rotation=r;\n            //$LASTPOS=29001726;//kernel.BodyActor:1726\n            _this.vrotation=vr;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    allContactPoints :function _trc_BodyActor_allContactPoints(klass) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      var m;\n      var point;\n      var w;\n      var c;\n      var a;\n      var b;\n      \n      //$LASTPOS=29001773;//kernel.BodyActor:1773\n      res = [];m;point;\n      //$LASTPOS=29001797;//kernel.BodyActor:1797\n      w = _this.getWorld();\n      //$LASTPOS=29001819;//kernel.BodyActor:1819\n      //$LASTPOS=29001824;//kernel.BodyActor:1824\n      c = _this.world.GetContactList();\n      while(c) {\n        {\n          //$LASTPOS=29001880;//kernel.BodyActor:1880\n          if (c.IsTouching()) {\n            //$LASTPOS=29001911;//kernel.BodyActor:1911\n            c.GetWorldManifold(m=new Box2D.Collision.b2WorldManifold);\n            //$LASTPOS=29001982;//kernel.BodyActor:1982\n            if (m.m_points[0]) {\n              //$LASTPOS=29002019;//kernel.BodyActor:2019\n              if (m.m_points[1]&&m.m_points[1].x&&m.m_points[1].y) {\n                //$LASTPOS=29002092;//kernel.BodyActor:2092\n                point={x: (m.m_points[0].x+m.m_points[1].x)/2*w.scale,y: (m.m_points[0].y+m.m_points[1].y)/2*w.scale};\n                \n              } else {\n                //$LASTPOS=29002263;//kernel.BodyActor:2263\n                point={x: m.m_points[0].x*w.scale,y: m.m_points[0].y*w.scale};\n                \n              }\n              \n            } else {\n              //$LASTPOS=29002363;//kernel.BodyActor:2363\n              point={x: _this.x,y: _this.y};\n            }\n            //$LASTPOS=29002388;//kernel.BodyActor:2388\n            a = c.GetFixtureA().GetBody().GetUserData();\n            //$LASTPOS=29002447;//kernel.BodyActor:2447\n            b = c.GetFixtureB().GetBody().GetUserData();\n            //$LASTPOS=29002506;//kernel.BodyActor:2506\n            if (a===_this) {\n              //$LASTPOS=29002538;//kernel.BodyActor:2538\n              if (! klass||b===klass||b instanceof klass) {\n                //$LASTPOS=29002607;//kernel.BodyActor:2607\n                res.push({target: b,manifold: m,x: point.x,y: point.y});\n                \n              }\n              \n            } else {\n              //$LASTPOS=29002698;//kernel.BodyActor:2698\n              if (b===_this) {\n                //$LASTPOS=29002730;//kernel.BodyActor:2730\n                if (! klass||a===klass||a instanceof klass) {\n                  //$LASTPOS=29002799;//kernel.BodyActor:2799\n                  res.push({target: a,manifold: m,x: point.x,y: point.y});\n                  \n                }\n                \n              }\n            }\n            \n          }\n        }\n        c=c.GetNext();\n      }\n      return res;\n    },\n    fiber$allContactPoints :function _trc_BodyActor_f_allContactPoints(_thread,klass) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var res;\n      var m;\n      var point;\n      var w;\n      var c;\n      var a;\n      var b;\n      \n      //$LASTPOS=29001773;//kernel.BodyActor:1773\n      res = [];m;point;\n      //$LASTPOS=29001797;//kernel.BodyActor:1797\n      w = _this.getWorld();\n      //$LASTPOS=29001819;//kernel.BodyActor:1819\n      //$LASTPOS=29001824;//kernel.BodyActor:1824\n      c = _this.world.GetContactList();\n      while(c) {\n        {\n          //$LASTPOS=29001880;//kernel.BodyActor:1880\n          if (c.IsTouching()) {\n            //$LASTPOS=29001911;//kernel.BodyActor:1911\n            c.GetWorldManifold(m=new Box2D.Collision.b2WorldManifold);\n            //$LASTPOS=29001982;//kernel.BodyActor:1982\n            if (m.m_points[0]) {\n              //$LASTPOS=29002019;//kernel.BodyActor:2019\n              if (m.m_points[1]&&m.m_points[1].x&&m.m_points[1].y) {\n                //$LASTPOS=29002092;//kernel.BodyActor:2092\n                point={x: (m.m_points[0].x+m.m_points[1].x)/2*w.scale,y: (m.m_points[0].y+m.m_points[1].y)/2*w.scale};\n                \n              } else {\n                //$LASTPOS=29002263;//kernel.BodyActor:2263\n                point={x: m.m_points[0].x*w.scale,y: m.m_points[0].y*w.scale};\n                \n              }\n              \n            } else {\n              //$LASTPOS=29002363;//kernel.BodyActor:2363\n              point={x: _this.x,y: _this.y};\n            }\n            //$LASTPOS=29002388;//kernel.BodyActor:2388\n            a = c.GetFixtureA().GetBody().GetUserData();\n            //$LASTPOS=29002447;//kernel.BodyActor:2447\n            b = c.GetFixtureB().GetBody().GetUserData();\n            //$LASTPOS=29002506;//kernel.BodyActor:2506\n            if (a===_this) {\n              //$LASTPOS=29002538;//kernel.BodyActor:2538\n              if (! klass||b===klass||b instanceof klass) {\n                //$LASTPOS=29002607;//kernel.BodyActor:2607\n                res.push({target: b,manifold: m,x: point.x,y: point.y});\n                \n              }\n              \n            } else {\n              //$LASTPOS=29002698;//kernel.BodyActor:2698\n              if (b===_this) {\n                //$LASTPOS=29002730;//kernel.BodyActor:2730\n                if (! klass||a===klass||a instanceof klass) {\n                  //$LASTPOS=29002799;//kernel.BodyActor:2799\n                  res.push({target: a,manifold: m,x: point.x,y: point.y});\n                  \n                }\n                \n              }\n            }\n            \n          }\n        }\n        c=c.GetNext();\n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    contactPoint :function _trc_BodyActor_contactPoint(klass) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.allContactPoints(klass)[0];\n    },\n    fiber$contactPoint :function _trc_BodyActor_f_contactPoint(_thread,klass) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.allContactPoints(klass)[0];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    allContact :function _trc_BodyActor_allContact(klass) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.allContacts(klass);\n    },\n    fiber$allContact :function _trc_BodyActor_f_allContact(_thread,klass) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.allContacts(klass);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    allContacts :function _trc_BodyActor_allContacts(klass) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      var c;\n      var a;\n      var b;\n      \n      //$LASTPOS=29003061;//kernel.BodyActor:3061\n      res = [];\n      //$LASTPOS=29003077;//kernel.BodyActor:3077\n      //$LASTPOS=29003082;//kernel.BodyActor:3082\n      c = _this.world.GetContactList();\n      while(c) {\n        {\n          //$LASTPOS=29003138;//kernel.BodyActor:3138\n          if (c.IsTouching()) {\n            //$LASTPOS=29003172;//kernel.BodyActor:3172\n            a = c.GetFixtureA().GetBody().GetUserData();\n            //$LASTPOS=29003231;//kernel.BodyActor:3231\n            b = c.GetFixtureB().GetBody().GetUserData();\n            //$LASTPOS=29003290;//kernel.BodyActor:3290\n            if (a===_this) {\n              //$LASTPOS=29003322;//kernel.BodyActor:3322\n              if (! klass||b===klass||b instanceof klass) {\n                //$LASTPOS=29003391;//kernel.BodyActor:3391\n                res.push(b);\n                \n              }\n              \n            } else {\n              //$LASTPOS=29003441;//kernel.BodyActor:3441\n              if (b===_this) {\n                //$LASTPOS=29003473;//kernel.BodyActor:3473\n                if (! klass||a===klass||a instanceof klass) {\n                  //$LASTPOS=29003542;//kernel.BodyActor:3542\n                  res.push(a);\n                  \n                }\n                \n              }\n            }\n            \n          }\n        }\n        c=c.GetNext();\n      }\n      return res;\n    },\n    fiber$allContacts :function _trc_BodyActor_f_allContacts(_thread,klass) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var res;\n      var c;\n      var a;\n      var b;\n      \n      //$LASTPOS=29003061;//kernel.BodyActor:3061\n      res = [];\n      //$LASTPOS=29003077;//kernel.BodyActor:3077\n      //$LASTPOS=29003082;//kernel.BodyActor:3082\n      c = _this.world.GetContactList();\n      while(c) {\n        {\n          //$LASTPOS=29003138;//kernel.BodyActor:3138\n          if (c.IsTouching()) {\n            //$LASTPOS=29003172;//kernel.BodyActor:3172\n            a = c.GetFixtureA().GetBody().GetUserData();\n            //$LASTPOS=29003231;//kernel.BodyActor:3231\n            b = c.GetFixtureB().GetBody().GetUserData();\n            //$LASTPOS=29003290;//kernel.BodyActor:3290\n            if (a===_this) {\n              //$LASTPOS=29003322;//kernel.BodyActor:3322\n              if (! klass||b===klass||b instanceof klass) {\n                //$LASTPOS=29003391;//kernel.BodyActor:3391\n                res.push(b);\n                \n              }\n              \n            } else {\n              //$LASTPOS=29003441;//kernel.BodyActor:3441\n              if (b===_this) {\n                //$LASTPOS=29003473;//kernel.BodyActor:3473\n                if (! klass||a===klass||a instanceof klass) {\n                  //$LASTPOS=29003542;//kernel.BodyActor:3542\n                  res.push(a);\n                  \n                }\n                \n              }\n            }\n            \n          }\n        }\n        c=c.GetNext();\n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    applyForce :function _trc_BodyActor_applyForce(fx,fy,px,py) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b2Vec2;\n      var scale;\n      var fps;\n      \n      //$LASTPOS=29003652;//kernel.BodyActor:3652\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=29003695;//kernel.BodyActor:3695\n      scale = _this.getWorld().scale;\n      //$LASTPOS=29003727;//kernel.BodyActor:3727\n      fps = 60;\n      //$LASTPOS=29003743;//kernel.BodyActor:3743\n      _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());\n    },\n    fiber$applyForce :function _trc_BodyActor_f_applyForce(_thread,fx,fy,px,py) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b2Vec2;\n      var scale;\n      var fps;\n      \n      //$LASTPOS=29003652;//kernel.BodyActor:3652\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=29003695;//kernel.BodyActor:3695\n      scale = _this.getWorld().scale;\n      //$LASTPOS=29003727;//kernel.BodyActor:3727\n      fps = 60;\n      //$LASTPOS=29003743;//kernel.BodyActor:3743\n      _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());\n      \n      _thread.retVal=_this;return;\n    },\n    applyImpulse :function _trc_BodyActor_applyImpulse(fx,fy,px,py) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b2Vec2;\n      var scale;\n      var fps;\n      \n      //$LASTPOS=29003834;//kernel.BodyActor:3834\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=29003877;//kernel.BodyActor:3877\n      scale = _this.getWorld().scale;\n      //$LASTPOS=29003909;//kernel.BodyActor:3909\n      fps = 60;\n      //$LASTPOS=29003925;//kernel.BodyActor:3925\n      _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());\n    },\n    fiber$applyImpulse :function _trc_BodyActor_f_applyImpulse(_thread,fx,fy,px,py) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b2Vec2;\n      var scale;\n      var fps;\n      \n      //$LASTPOS=29003834;//kernel.BodyActor:3834\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=29003877;//kernel.BodyActor:3877\n      scale = _this.getWorld().scale;\n      //$LASTPOS=29003909;//kernel.BodyActor:3909\n      fps = 60;\n      //$LASTPOS=29003925;//kernel.BodyActor:3925\n      _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());\n      \n      _thread.retVal=_this;return;\n    },\n    applyTorque :function _trc_BodyActor_applyTorque(a) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=29004008;//kernel.BodyActor:4008\n      _this.body.ApplyTorque(a);\n    },\n    fiber$applyTorque :function _trc_BodyActor_f_applyTorque(_thread,a) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=29004008;//kernel.BodyActor:4008\n      _this.body.ApplyTorque(a);\n      \n      _thread.retVal=_this;return;\n    },\n    moveBy :function _trc_BodyActor_moveBy(dx,dy) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var pos;\n      \n      //$LASTPOS=29004052;//kernel.BodyActor:4052\n      pos = _this.body.GetPosition();\n      //$LASTPOS=29004084;//kernel.BodyActor:4084\n      pos.x+=dx/_this.scale;\n      //$LASTPOS=29004105;//kernel.BodyActor:4105\n      pos.y+=dy/_this.scale;\n      //$LASTPOS=29004126;//kernel.BodyActor:4126\n      _this.body.SetPosition(pos);\n    },\n    fiber$moveBy :function _trc_BodyActor_f_moveBy(_thread,dx,dy) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var pos;\n      \n      //$LASTPOS=29004052;//kernel.BodyActor:4052\n      pos = _this.body.GetPosition();\n      //$LASTPOS=29004084;//kernel.BodyActor:4084\n      pos.x+=dx/_this.scale;\n      //$LASTPOS=29004105;//kernel.BodyActor:4105\n      pos.y+=dy/_this.scale;\n      //$LASTPOS=29004126;//kernel.BodyActor:4126\n      _this.body.SetPosition(pos);\n      \n      _thread.retVal=_this;return;\n    },\n    contactTo :function _trc_BodyActor_contactTo(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.allContact(t)[0];\n    },\n    fiber$contactTo :function _trc_BodyActor_f_contactTo(_thread,t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.allContact(t)[0];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    die :function _trc_BodyActor_die() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=29004211;//kernel.BodyActor:4211\n      Tonyu.classes.kernel.Actor.prototype.die.apply( _this, []);\n      //$LASTPOS=29004228;//kernel.BodyActor:4228\n      _this.world.DestroyBody(_this.body);\n    },\n    addRevoluteJoint :function _trc_BodyActor_addRevoluteJoint(params) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var px;\n      var py;\n      var wworld;\n      var scale;\n      var world;\n      var b2BodyDef;\n      var b2Body;\n      var JDC;\n      var jd;\n      var bodyDef;\n      var bodyB;\n      var b2Vec2;\n      \n      //$LASTPOS=29004316;//kernel.BodyActor:4316\n      params=params||{};\n      //$LASTPOS=29004339;//kernel.BodyActor:4339\n      px = params.x||_this.x;\n      //$LASTPOS=29004363;//kernel.BodyActor:4363\n      py = params.y||_this.y;\n      //$LASTPOS=29004387;//kernel.BodyActor:4387\n      wworld = _this.getWorld();\n      //$LASTPOS=29004428;//kernel.BodyActor:4428\n      scale = wworld.scale;\n      //$LASTPOS=29004456;//kernel.BodyActor:4456\n      world = wworld.world;\n      //$LASTPOS=29004484;//kernel.BodyActor:4484\n      b2BodyDef = Box2D.Dynamics.b2BodyDef;\n      //$LASTPOS=29004530;//kernel.BodyActor:4530\n      b2Body = Box2D.Dynamics.b2Body;\n      //$LASTPOS=29004570;//kernel.BodyActor:4570\n      JDC = Box2D.Dynamics.Joints.b2RevoluteJointDef;\n      //$LASTPOS=29004624;//kernel.BodyActor:4624\n      jd = new JDC;\n      //$LASTPOS=29004644;//kernel.BodyActor:4644\n      bodyDef = new b2BodyDef;\n      //$LASTPOS=29004677;//kernel.BodyActor:4677\n      bodyDef.type=b2Body.b2_staticBody;\n      //$LASTPOS=29004718;//kernel.BodyActor:4718\n      bodyDef.position.x=px/scale;\n      //$LASTPOS=29004754;//kernel.BodyActor:4754\n      bodyDef.position.y=py/scale;\n      //$LASTPOS=29004790;//kernel.BodyActor:4790\n      bodyB = world.CreateBody(bodyDef);\n      //$LASTPOS=29004831;//kernel.BodyActor:4831\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=29004874;//kernel.BodyActor:4874\n      jd.Initialize(_this.body,bodyB,new b2Vec2(px/scale,py/scale));\n      //$LASTPOS=29004936;//kernel.BodyActor:4936\n      if (params.lowerAngle&&params.upperAngle) {\n        //$LASTPOS=29004989;//kernel.BodyActor:4989\n        jd.lowerAngle=_this.rad(params.lowerAngle);\n        //$LASTPOS=29005036;//kernel.BodyActor:5036\n        jd.upperAngle=_this.rad(params.upperAngle);\n        //$LASTPOS=29005083;//kernel.BodyActor:5083\n        jd.enableLimit=true;\n        \n      }\n      //$LASTPOS=29005116;//kernel.BodyActor:5116\n      world.CreateJoint(jd);\n    },\n    fiber$addRevoluteJoint :function _trc_BodyActor_f_addRevoluteJoint(_thread,params) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var px;\n      var py;\n      var wworld;\n      var scale;\n      var world;\n      var b2BodyDef;\n      var b2Body;\n      var JDC;\n      var jd;\n      var bodyDef;\n      var bodyB;\n      var b2Vec2;\n      \n      //$LASTPOS=29004316;//kernel.BodyActor:4316\n      params=params||{};\n      //$LASTPOS=29004339;//kernel.BodyActor:4339\n      px = params.x||_this.x;\n      //$LASTPOS=29004363;//kernel.BodyActor:4363\n      py = params.y||_this.y;\n      //$LASTPOS=29004387;//kernel.BodyActor:4387\n      wworld = _this.getWorld();\n      //$LASTPOS=29004428;//kernel.BodyActor:4428\n      scale = wworld.scale;\n      //$LASTPOS=29004456;//kernel.BodyActor:4456\n      world = wworld.world;\n      //$LASTPOS=29004484;//kernel.BodyActor:4484\n      b2BodyDef = Box2D.Dynamics.b2BodyDef;\n      //$LASTPOS=29004530;//kernel.BodyActor:4530\n      b2Body = Box2D.Dynamics.b2Body;\n      //$LASTPOS=29004570;//kernel.BodyActor:4570\n      JDC = Box2D.Dynamics.Joints.b2RevoluteJointDef;\n      //$LASTPOS=29004624;//kernel.BodyActor:4624\n      jd = new JDC;\n      //$LASTPOS=29004644;//kernel.BodyActor:4644\n      bodyDef = new b2BodyDef;\n      //$LASTPOS=29004677;//kernel.BodyActor:4677\n      bodyDef.type=b2Body.b2_staticBody;\n      //$LASTPOS=29004718;//kernel.BodyActor:4718\n      bodyDef.position.x=px/scale;\n      //$LASTPOS=29004754;//kernel.BodyActor:4754\n      bodyDef.position.y=py/scale;\n      //$LASTPOS=29004790;//kernel.BodyActor:4790\n      bodyB = world.CreateBody(bodyDef);\n      //$LASTPOS=29004831;//kernel.BodyActor:4831\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=29004874;//kernel.BodyActor:4874\n      jd.Initialize(_this.body,bodyB,new b2Vec2(px/scale,py/scale));\n      //$LASTPOS=29004936;//kernel.BodyActor:4936\n      if (params.lowerAngle&&params.upperAngle) {\n        //$LASTPOS=29004989;//kernel.BodyActor:4989\n        jd.lowerAngle=_this.rad(params.lowerAngle);\n        //$LASTPOS=29005036;//kernel.BodyActor:5036\n        jd.upperAngle=_this.rad(params.upperAngle);\n        //$LASTPOS=29005083;//kernel.BodyActor:5083\n        jd.enableLimit=true;\n        \n      }\n      //$LASTPOS=29005116;//kernel.BodyActor:5116\n      world.CreateJoint(jd);\n      \n      _thread.retVal=_this;return;\n    },\n    __getter__rotation :function _trc_BodyActor___getter__rotation() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=29005161;//kernel.BodyActor:5161\n      if (! _this.body||_this.manualRotation) {\n        return _this._rotation;\n      }\n      return _this.deg(_this.body.GetAngle());\n    },\n    __setter__rotation :function _trc_BodyActor___setter__rotation(r) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=29005261;//kernel.BodyActor:5261\n      r=r||0;\n      //$LASTPOS=29005273;//kernel.BodyActor:5273\n      if (! _this.body||_this.manualRotation) {\n        return _this._rotation=r;\n      }\n      //$LASTPOS=29005326;//kernel.BodyActor:5326\n      _this.body.SetAngle(_this.rad(r));\n    },\n    updatePos :function _trc_BodyActor_updatePos() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$updatePos :function _trc_BodyActor_f_updatePos(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __getter__x :function _trc_BodyActor___getter__x() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var pos;\n      \n      //$LASTPOS=29005509;//kernel.BodyActor:5509\n      if (! _this.body) {\n        return _this._x;\n      }\n      //$LASTPOS=29005535;//kernel.BodyActor:5535\n      pos = _this.body.GetPosition();\n      return pos.x*_this.scale;\n    },\n    __setter__x :function _trc_BodyActor___setter__x(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var pos;\n      \n      //$LASTPOS=29005600;//kernel.BodyActor:5600\n      if (! _this.body) {\n        return _this._x=v;\n      }\n      //$LASTPOS=29005628;//kernel.BodyActor:5628\n      v=v||0;\n      //$LASTPOS=29005640;//kernel.BodyActor:5640\n      pos = _this.body.GetPosition();\n      //$LASTPOS=29005672;//kernel.BodyActor:5672\n      pos.x=v/_this.scale;\n      //$LASTPOS=29005691;//kernel.BodyActor:5691\n      _this.body.SetPosition(pos);\n    },\n    __getter__y :function _trc_BodyActor___getter__y() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var pos;\n      \n      //$LASTPOS=29005725;//kernel.BodyActor:5725\n      if (! _this.body) {\n        return _this._y;\n      }\n      //$LASTPOS=29005751;//kernel.BodyActor:5751\n      pos = _this.body.GetPosition();\n      return pos.y*_this.scale;\n    },\n    __setter__y :function _trc_BodyActor___setter__y(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var pos;\n      \n      //$LASTPOS=29005816;//kernel.BodyActor:5816\n      if (! _this.body) {\n        return _this._y=v;\n      }\n      //$LASTPOS=29005844;//kernel.BodyActor:5844\n      v=v||0;\n      //$LASTPOS=29005856;//kernel.BodyActor:5856\n      pos = _this.body.GetPosition();\n      //$LASTPOS=29005888;//kernel.BodyActor:5888\n      pos.y=v/_this.scale;\n      //$LASTPOS=29005907;//kernel.BodyActor:5907\n      _this.body.SetPosition(pos);\n    },\n    __getter__vx :function _trc_BodyActor___getter__vx() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var v;\n      \n      //$LASTPOS=29005943;//kernel.BodyActor:5943\n      if (! _this.body) {\n        return _this._vx;\n      }\n      //$LASTPOS=29005970;//kernel.BodyActor:5970\n      v = _this.body.GetLinearVelocity();\n      return v.x*_this.scale/_this.getWorld().fps;\n    },\n    __setter__vx :function _trc_BodyActor___setter__vx(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ve;\n      \n      //$LASTPOS=29006053;//kernel.BodyActor:6053\n      if (! _this.body) {\n        return _this._vx=v;\n      }\n      //$LASTPOS=29006082;//kernel.BodyActor:6082\n      v=v||0;\n      //$LASTPOS=29006094;//kernel.BodyActor:6094\n      ve = _this.body.GetLinearVelocity();\n      //$LASTPOS=29006131;//kernel.BodyActor:6131\n      ve.x=v/_this.scale*_this.getWorld().fps;\n      //$LASTPOS=29006164;//kernel.BodyActor:6164\n      if (v) {\n        //$LASTPOS=29006171;//kernel.BodyActor:6171\n        _this.body.SetAwake(true);\n      }\n      //$LASTPOS=29006196;//kernel.BodyActor:6196\n      _this.body.SetLinearVelocity(ve);\n    },\n    __getter__vy :function _trc_BodyActor___getter__vy() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var v;\n      \n      //$LASTPOS=29006237;//kernel.BodyActor:6237\n      if (! _this.body) {\n        return _this._vy;\n      }\n      //$LASTPOS=29006264;//kernel.BodyActor:6264\n      v = _this.body.GetLinearVelocity();\n      return v.y*_this.scale/_this.getWorld().fps;\n    },\n    __setter__vy :function _trc_BodyActor___setter__vy(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ve;\n      \n      //$LASTPOS=29006347;//kernel.BodyActor:6347\n      if (! _this.body) {\n        return _this._vy=v;\n      }\n      //$LASTPOS=29006376;//kernel.BodyActor:6376\n      ve = _this.body.GetLinearVelocity();\n      //$LASTPOS=29006413;//kernel.BodyActor:6413\n      ve.y=v/_this.scale*_this.getWorld().fps;\n      //$LASTPOS=29006446;//kernel.BodyActor:6446\n      if (v) {\n        //$LASTPOS=29006453;//kernel.BodyActor:6453\n        _this.body.SetAwake(true);\n      }\n      //$LASTPOS=29006478;//kernel.BodyActor:6478\n      _this.body.SetLinearVelocity(ve);\n    },\n    __getter__vrotation :function _trc_BodyActor___getter__vrotation() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=29006525;//kernel.BodyActor:6525\n      if (! _this.body) {\n        return _this._vr;\n      }\n      return _this.deg(_this.body.GetAngularVelocity()/_this.getWorld().fps);\n    },\n    __setter__vrotation :function _trc_BodyActor___setter__vrotation(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=29006627;//kernel.BodyActor:6627\n      if (! _this.body) {\n        return _this._vr=v;\n      }\n      //$LASTPOS=29006656;//kernel.BodyActor:6656\n      v=v||0;\n      //$LASTPOS=29006668;//kernel.BodyActor:6668\n      if (v) {\n        //$LASTPOS=29006675;//kernel.BodyActor:6675\n        _this.body.SetAwake(true);\n      }\n      //$LASTPOS=29006700;//kernel.BodyActor:6700\n      _this.body.SetAngularVelocity(_this.rad(v*_this.getWorld().fps));\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"getWorld":{"nowait":false},"onAppear":{"nowait":false},"allContactPoints":{"nowait":false},"contactPoint":{"nowait":false},"allContact":{"nowait":false},"allContacts":{"nowait":false},"applyForce":{"nowait":false},"applyImpulse":{"nowait":false},"applyTorque":{"nowait":false},"moveBy":{"nowait":false},"contactTo":{"nowait":false},"die":{"nowait":true},"addRevoluteJoint":{"nowait":false},"__getter__rotation":{"nowait":true},"__setter__rotation":{"nowait":true},"updatePos":{"nowait":false},"__getter__x":{"nowait":true},"__setter__x":{"nowait":true},"__getter__y":{"nowait":true},"__setter__y":{"nowait":true},"__getter__vx":{"nowait":true},"__setter__vx":{"nowait":true},"__getter__vy":{"nowait":true},"__setter__vy":{"nowait":true},"__getter__vrotation":{"nowait":true},"__setter__vrotation":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T2Body\',\n  shortName: \'T2Body\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.BodyActor,\n  includes: [],\n  methods: {\n    main :function _trc_T2Body_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T2Body_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T2World\',\n  shortName: \'T2World\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [Tonyu.classes.kernel.T2Mod],\n  methods: {\n    main :function _trc_T2World_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=30000150;//kernel.T2World:150\n      _this.loop();\n    },\n    fiber$main :function _trc_T2World_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_T2World_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=30000150;//kernel.T2World:150\n            _this.fiber$loop(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    onAppear :function _trc_T2World_onAppear() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=30000086;//kernel.T2World:86\n      Tonyu.globals.$currentProject.requestPlugin("box2d");\n      //$LASTPOS=30000133;//kernel.T2World:133\n      _this.initWorld();\n    },\n    fiber$onAppear :function _trc_T2World_f_onAppear(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=30000086;//kernel.T2World:86\n      Tonyu.globals.$currentProject.requestPlugin("box2d");\n      \n      _thread.enter(function _trc_T2World_ent_onAppear(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=30000133;//kernel.T2World:133\n            _this.fiber$initWorld(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initWorld :function _trc_T2World_initWorld() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b2World;\n      var b2Vec2;\n      \n      //$LASTPOS=30000183;//kernel.T2World:183\n      _this.gravity=_this.defv(_this.gravity,9.8);\n      //$LASTPOS=30000216;//kernel.T2World:216\n      _this.gravityX=_this.defv(_this.gravityX,0);\n      //$LASTPOS=30000249;//kernel.T2World:249\n      _this.fps=Tonyu.globals.$Boot.getFrameRate();\n      //$LASTPOS=30000280;//kernel.T2World:280\n      b2World = Box2D.Dynamics.b2World;\n      //$LASTPOS=30000323;//kernel.T2World:323\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=30000367;//kernel.T2World:367\n      _this.scale=_this.scale||32;\n      //$LASTPOS=30000391;//kernel.T2World:391\n      _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);\n      //$LASTPOS=30000516;//kernel.T2World:516\n      Tonyu.globals.$t2World=_this;\n      //$LASTPOS=30000536;//kernel.T2World:536\n      Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));\n      //$LASTPOS=30000572;//kernel.T2World:572\n      _this.on("die",Tonyu.bindFunc(_this,_this.releaseWorld));\n    },\n    fiber$initWorld :function _trc_T2World_f_initWorld(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b2World;\n      var b2Vec2;\n      \n      \n      _thread.enter(function _trc_T2World_ent_initWorld(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=30000183;//kernel.T2World:183\n            _this.fiber$defv(_thread, _this.gravity, 9.8);\n            __pc=1;return;\n          case 1:\n            _this.gravity=_thread.retVal;\n            \n            //$LASTPOS=30000216;//kernel.T2World:216\n            _this.fiber$defv(_thread, _this.gravityX, 0);\n            __pc=2;return;\n          case 2:\n            _this.gravityX=_thread.retVal;\n            \n            //$LASTPOS=30000249;//kernel.T2World:249\n            _this.fps=Tonyu.globals.$Boot.getFrameRate();\n            //$LASTPOS=30000280;//kernel.T2World:280\n            b2World = Box2D.Dynamics.b2World;\n            //$LASTPOS=30000323;//kernel.T2World:323\n            b2Vec2 = Box2D.Common.Math.b2Vec2;\n            //$LASTPOS=30000367;//kernel.T2World:367\n            _this.scale=_this.scale||32;\n            //$LASTPOS=30000391;//kernel.T2World:391\n            _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);\n            //$LASTPOS=30000516;//kernel.T2World:516\n            Tonyu.globals.$t2World=_this;\n            //$LASTPOS=30000536;//kernel.T2World:536\n            Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));\n            //$LASTPOS=30000572;//kernel.T2World:572\n            _this.on("die",Tonyu.bindFunc(_this,_this.releaseWorld));\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    releaseWorld :function _trc_T2World_releaseWorld() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=30000623;//kernel.T2World:623\n      if (Tonyu.globals.$t2World===_this) {\n        //$LASTPOS=30000644;//kernel.T2World:644\n        Tonyu.globals.$t2World=null;\n      }\n    },\n    fiber$releaseWorld :function _trc_T2World_f_releaseWorld(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=30000623;//kernel.T2World:623\n      if (Tonyu.globals.$t2World===_this) {\n        //$LASTPOS=30000644;//kernel.T2World:644\n        Tonyu.globals.$t2World=null;\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    loop :function _trc_T2World_loop() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=30000680;//kernel.T2World:680\n      while (true) {\n        //$LASTPOS=30000703;//kernel.T2World:703\n        _this.fps=Tonyu.globals.$Boot.getFrameRate();\n        //$LASTPOS=30000738;//kernel.T2World:738\n        _this.world.Step(1/_this.fps,10,10);\n        //$LASTPOS=30000922;//kernel.T2World:922\n        _this.world.ClearForces();\n        //$LASTPOS=30000976;//kernel.T2World:976\n        _this.update();\n        \n      }\n    },\n    fiber$loop :function _trc_T2World_f_loop(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_T2World_ent_loop(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=30000680;//kernel.T2World:680\n          case 1:\n            //$LASTPOS=30000703;//kernel.T2World:703\n            _this.fps=Tonyu.globals.$Boot.getFrameRate();\n            //$LASTPOS=30000738;//kernel.T2World:738\n            _this.world.Step(1/_this.fps,10,10);\n            //$LASTPOS=30000922;//kernel.T2World:922\n            _this.world.ClearForces();\n            //$LASTPOS=30000976;//kernel.T2World:976\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    updatePos :function _trc_T2World_updatePos() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b;\n      var d;\n      \n      //$LASTPOS=30001017;//kernel.T2World:1017\n      //$LASTPOS=30001022;//kernel.T2World:1022\n      b = _this.world.GetBodyList();\n      while(b) {\n        {\n          //$LASTPOS=30001076;//kernel.T2World:1076\n          d = b.GetUserData();\n          //$LASTPOS=30001108;//kernel.T2World:1108\n          if (d) {\n            //$LASTPOS=30001114;//kernel.T2World:1114\n            d.updatePos();\n          }\n        }\n        b=b.GetNext();\n      }\n    },\n    fiber$updatePos :function _trc_T2World_f_updatePos(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b;\n      var d;\n      \n      //$LASTPOS=30001017;//kernel.T2World:1017\n      //$LASTPOS=30001022;//kernel.T2World:1022\n      b = _this.world.GetBodyList();\n      while(b) {\n        {\n          //$LASTPOS=30001076;//kernel.T2World:1076\n          d = b.GetUserData();\n          //$LASTPOS=30001108;//kernel.T2World:1108\n          if (d) {\n            //$LASTPOS=30001114;//kernel.T2World:1114\n            d.updatePos();\n          }\n        }\n        b=b.GetNext();\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"onAppear":{"nowait":false},"initWorld":{"nowait":false},"releaseWorld":{"nowait":false},"loop":{"nowait":false},"updatePos":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T2MediaPlayer\',\n  shortName: \'T2MediaPlayer\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_T2MediaPlayer_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T2MediaPlayer_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_T2MediaPlayer_initialize() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31000069;//kernel.T2MediaPlayer:69\n      _this.initT2MediaPlayer();\n    },\n    initT2MediaPlayer :function _trc_T2MediaPlayer_initT2MediaPlayer() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31000124;//kernel.T2MediaPlayer:124\n      if (T2MediaLib.inited) {\n        return _this;\n      }\n      //$LASTPOS=31000160;//kernel.T2MediaPlayer:160\n      T2MediaLib.init();\n      //$LASTPOS=31000184;//kernel.T2MediaPlayer:184\n      T2MediaLib.inited=true;\n      //$LASTPOS=31000213;//kernel.T2MediaPlayer:213\n      _this.bgmPlayerMax=T2MediaLib.bgmPlayerMax;\n    },\n    fiber$initT2MediaPlayer :function _trc_T2MediaPlayer_f_initT2MediaPlayer(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31000124;//kernel.T2MediaPlayer:124\n      if (T2MediaLib.inited) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=31000160;//kernel.T2MediaPlayer:160\n      T2MediaLib.init();\n      //$LASTPOS=31000184;//kernel.T2MediaPlayer:184\n      T2MediaLib.inited=true;\n      //$LASTPOS=31000213;//kernel.T2MediaPlayer:213\n      _this.bgmPlayerMax=T2MediaLib.bgmPlayerMax;\n      \n      _thread.retVal=_this;return;\n    },\n    clearSEData :function _trc_T2MediaPlayer_clearSEData() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31000281;//kernel.T2MediaPlayer:281\n      T2MediaLib.allStopBGM();\n      //$LASTPOS=31000311;//kernel.T2MediaPlayer:311\n      T2MediaLib.allClearData();\n    },\n    fiber$clearSEData :function _trc_T2MediaPlayer_f_clearSEData(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31000281;//kernel.T2MediaPlayer:281\n      T2MediaLib.allStopBGM();\n      //$LASTPOS=31000311;//kernel.T2MediaPlayer:311\n      T2MediaLib.allClearData();\n      \n      _thread.retVal=_this;return;\n    },\n    clearBGMData :function _trc_T2MediaPlayer_clearBGMData() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31000367;//kernel.T2MediaPlayer:367\n      _this.clearSEData();\n    },\n    fiber$clearBGMData :function _trc_T2MediaPlayer_f_clearBGMData(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_T2MediaPlayer_ent_clearBGMData(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=31000367;//kernel.T2MediaPlayer:367\n            _this.fiber$clearSEData(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    deleteSEData :function _trc_T2MediaPlayer_deleteSEData(idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31000414;//kernel.T2MediaPlayer:414\n      T2MediaLib.clearData(idx);\n    },\n    fiber$deleteSEData :function _trc_T2MediaPlayer_f_deleteSEData(_thread,idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31000414;//kernel.T2MediaPlayer:414\n      T2MediaLib.clearData(idx);\n      \n      _thread.retVal=_this;return;\n    },\n    loadSE :function _trc_T2MediaPlayer_loadSE(idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var data;\n      \n      //$LASTPOS=31000508;//kernel.T2MediaPlayer:508\n      _this.runAsync((function anonymous_517(succ,err) {\n        \n        //$LASTPOS=31000567;//kernel.T2MediaPlayer:567\n        T2MediaLib.loadSE(idx,src,{succ: succ,err: err});\n      }));\n      //$LASTPOS=31000620;//kernel.T2MediaPlayer:620\n      data = T2MediaLib.getSEData(idx);\n      return data;\n    },\n    fiber$loadSE :function _trc_T2MediaPlayer_f_loadSE(_thread,idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var data;\n      \n      \n      _thread.enter(function _trc_T2MediaPlayer_ent_loadSE(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=31000508;//kernel.T2MediaPlayer:508\n            _this.fiber$runAsync(_thread, (function anonymous_517(succ,err) {\n              \n              //$LASTPOS=31000567;//kernel.T2MediaPlayer:567\n              T2MediaLib.loadSE(idx,src,{succ: succ,err: err});\n            }));\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=31000620;//kernel.T2MediaPlayer:620\n            data = T2MediaLib.getSEData(idx);\n            _thread.exit(data);return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    __getter__available :function _trc_T2MediaPlayer___getter__available() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return ! ! T2MediaLib.context;\n    },\n    loadFromProject :function _trc_T2MediaPlayer_loadFromProject(prj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var r;\n      var s;\n      var _it_281;\n      var name;\n      var url;\n      var e;\n      \n      //$LASTPOS=31000881;//kernel.T2MediaPlayer:881\n      if (! _this.available) {\n        return _this;\n      }\n      //$LASTPOS=31000910;//kernel.T2MediaPlayer:910\n      r = prj.getResource();\n      //$LASTPOS=31000940;//kernel.T2MediaPlayer:940\n      if (! r||! r.sounds) {\n        return _this;\n      }\n      //$LASTPOS=31000974;//kernel.T2MediaPlayer:974\n      _it_281=Tonyu.iterator(r.sounds,1);\n      while(_it_281.next()) {\n        s=_it_281[0];\n        \n        //$LASTPOS=31001010;//kernel.T2MediaPlayer:1010\n        name = s.name;url = Tonyu.Assets.resolve(s.url,prj.getDir());\n        //$LASTPOS=31001084;//kernel.T2MediaPlayer:1084\n        Tonyu.setGlobal(name,name);\n        try {\n          //$LASTPOS=31001142;//kernel.T2MediaPlayer:1142\n          _this.print("Loading Sound2: "+name);\n          //$LASTPOS=31001187;//kernel.T2MediaPlayer:1187\n          _this.loadSE(name,url);\n          \n        } catch (e) {\n          //$LASTPOS=31001242;//kernel.T2MediaPlayer:1242\n          _this.print("Fail");\n          //$LASTPOS=31001270;//kernel.T2MediaPlayer:1270\n          Tonyu.setGlobal(name,"ERROR");\n          \n        }\n        \n      }\n    },\n    fiber$loadFromProject :function _trc_T2MediaPlayer_f_loadFromProject(_thread,prj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var r;\n      var s;\n      var _it_281;\n      var name;\n      var url;\n      var e;\n      \n      //$LASTPOS=31000881;//kernel.T2MediaPlayer:881\n      if (! _this.available) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=31000910;//kernel.T2MediaPlayer:910\n      r = prj.getResource();\n      //$LASTPOS=31000940;//kernel.T2MediaPlayer:940\n      if (! r||! r.sounds) {\n        _thread.retVal=_this;return;\n        \n      }\n      \n      _thread.enter(function _trc_T2MediaPlayer_ent_loadFromProject(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=31000974;//kernel.T2MediaPlayer:974\n            _it_281=Tonyu.iterator(r.sounds,1);\n          case 1:\n            if (!(_it_281.next())) { __pc=5; break; }\n            s=_it_281[0];\n            \n            //$LASTPOS=31001010;//kernel.T2MediaPlayer:1010\n            name = s.name;url = Tonyu.Assets.resolve(s.url,prj.getDir());\n            //$LASTPOS=31001084;//kernel.T2MediaPlayer:1084\n            Tonyu.setGlobal(name,name);\n            _thread.enterTry(3);\n            //$LASTPOS=31001142;//kernel.T2MediaPlayer:1142\n            _this.print("Loading Sound2: "+name);\n            //$LASTPOS=31001187;//kernel.T2MediaPlayer:1187\n            _this.fiber$loadSE(_thread, name, url);\n            __pc=2;return;\n          case 2:\n            _thread.exitTry();\n            __pc=4;break;\n          case 3:\n            e=_thread.startCatch();\n            _thread.exitTry();\n            {\n              //$LASTPOS=31001242;//kernel.T2MediaPlayer:1242\n              _this.print("Fail");\n              //$LASTPOS=31001270;//kernel.T2MediaPlayer:1270\n              Tonyu.setGlobal(name,"ERROR");\n            }\n          case 4:\n            \n            __pc=1;break;\n          case 5:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    playSE :function _trc_T2MediaPlayer_playSE(idx,vol,rate,offset,loop,loopStart,loopEnd) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31001408;//kernel.T2MediaPlayer:1408\n      if (_this.mute) {\n        return _this;\n      }\n      //$LASTPOS=31001467;//kernel.T2MediaPlayer:1467\n      if (vol==null) {\n        //$LASTPOS=31001484;//kernel.T2MediaPlayer:1484\n        vol=128;\n      }\n      //$LASTPOS=31001573;//kernel.T2MediaPlayer:1573\n      if (vol<0) {\n        //$LASTPOS=31001593;//kernel.T2MediaPlayer:1593\n        vol=0;\n      } else {\n        //$LASTPOS=31001614;//kernel.T2MediaPlayer:1614\n        if (vol>128) {\n          //$LASTPOS=31001629;//kernel.T2MediaPlayer:1629\n          vol=128;\n        }\n      }\n      return T2MediaLib.playSE(idx,vol/128,rate,offset,loop,loopStart,loopEnd);\n    },\n    stopSE :function _trc_T2MediaPlayer_stopSE(sourceObj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.stopSE(sourceObj);\n    },\n    fiber$stopSE :function _trc_T2MediaPlayer_f_stopSE(_thread,sourceObj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.stopSE(sourceObj);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getSEData :function _trc_T2MediaPlayer_getSEData(idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getSEData(idx);\n    },\n    fiber$getSEData :function _trc_T2MediaPlayer_f_getSEData(_thread,idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getSEData(idx);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    loadBGM :function _trc_T2MediaPlayer_loadBGM(idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var data;\n      \n      //$LASTPOS=31001920;//kernel.T2MediaPlayer:1920\n      T2MediaLib.loadBGM(idx,src);\n      //$LASTPOS=31001980;//kernel.T2MediaPlayer:1980\n      data = T2MediaLib.getBGMData(idx);\n      //$LASTPOS=31002024;//kernel.T2MediaPlayer:2024\n      while (data==null) {\n        //$LASTPOS=31002056;//kernel.T2MediaPlayer:2056\n        _this.update();\n        //$LASTPOS=31002075;//kernel.T2MediaPlayer:2075\n        data=T2MediaLib.getBGMData(idx);\n        \n      }\n      return data;\n    },\n    fiber$loadBGM :function _trc_T2MediaPlayer_f_loadBGM(_thread,idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var data;\n      \n      //$LASTPOS=31001920;//kernel.T2MediaPlayer:1920\n      T2MediaLib.loadBGM(idx,src);\n      //$LASTPOS=31001980;//kernel.T2MediaPlayer:1980\n      data = T2MediaLib.getBGMData(idx);\n      \n      _thread.enter(function _trc_T2MediaPlayer_ent_loadBGM(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=31002024;//kernel.T2MediaPlayer:2024\n          case 1:\n            if (!(data==null)) { __pc=3; break; }\n            //$LASTPOS=31002056;//kernel.T2MediaPlayer:2056\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=31002075;//kernel.T2MediaPlayer:2075\n            data=T2MediaLib.getBGMData(idx);\n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(data);return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    playBGM :function _trc_T2MediaPlayer_playBGM(idx,loop,offset,loopStart,loopEnd) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31002196;//kernel.T2MediaPlayer:2196\n      if (_this.mute) {\n        return _this;\n      }\n      //$LASTPOS=31002219;//kernel.T2MediaPlayer:2219\n      if (loop===null) {\n        //$LASTPOS=31002238;//kernel.T2MediaPlayer:2238\n        loop=false;\n      }\n      //$LASTPOS=31002257;//kernel.T2MediaPlayer:2257\n      if (offset===null) {\n        //$LASTPOS=31002278;//kernel.T2MediaPlayer:2278\n        offset=0;\n      }\n      return T2MediaLib.playBGM(0,idx,loop,offset,loopStart,loopEnd);\n    },\n    fiber$playBGM :function _trc_T2MediaPlayer_f_playBGM(_thread,idx,loop,offset,loopStart,loopEnd) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31002196;//kernel.T2MediaPlayer:2196\n      if (_this.mute) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=31002219;//kernel.T2MediaPlayer:2219\n      if (loop===null) {\n        //$LASTPOS=31002238;//kernel.T2MediaPlayer:2238\n        loop=false;\n      }\n      //$LASTPOS=31002257;//kernel.T2MediaPlayer:2257\n      if (offset===null) {\n        //$LASTPOS=31002278;//kernel.T2MediaPlayer:2278\n        offset=0;\n      }\n      _thread.retVal=T2MediaLib.playBGM(0,idx,loop,offset,loopStart,loopEnd);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stopBGM :function _trc_T2MediaPlayer_stopBGM() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.stopBGM(0);\n    },\n    fiber$stopBGM :function _trc_T2MediaPlayer_f_stopBGM(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.stopBGM(0);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    pauseBGM :function _trc_T2MediaPlayer_pauseBGM() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.pauseBGM(0);\n    },\n    fiber$pauseBGM :function _trc_T2MediaPlayer_f_pauseBGM(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.pauseBGM(0);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    resumeBGM :function _trc_T2MediaPlayer_resumeBGM() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.resumeBGM(0);\n    },\n    fiber$resumeBGM :function _trc_T2MediaPlayer_f_resumeBGM(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.resumeBGM(0);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGMVolume :function _trc_T2MediaPlayer_setBGMVolume(vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31002564;//kernel.T2MediaPlayer:2564\n      vol=vol/128;\n      //$LASTPOS=31002659;//kernel.T2MediaPlayer:2659\n      if (vol>1) {\n        //$LASTPOS=31002679;//kernel.T2MediaPlayer:2679\n        vol=1;\n      } else {\n        //$LASTPOS=31002700;//kernel.T2MediaPlayer:2700\n        if (vol<0) {\n          //$LASTPOS=31002715;//kernel.T2MediaPlayer:2715\n          vol=0;\n        }\n      }\n      return T2MediaLib.setBGMVolume(0,vol);\n    },\n    fiber$setBGMVolume :function _trc_T2MediaPlayer_f_setBGMVolume(_thread,vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31002564;//kernel.T2MediaPlayer:2564\n      vol=vol/128;\n      //$LASTPOS=31002659;//kernel.T2MediaPlayer:2659\n      if (vol>1) {\n        //$LASTPOS=31002679;//kernel.T2MediaPlayer:2679\n        vol=1;\n      } else {\n        //$LASTPOS=31002700;//kernel.T2MediaPlayer:2700\n        if (vol<0) {\n          //$LASTPOS=31002715;//kernel.T2MediaPlayer:2715\n          vol=0;\n        }\n      }\n      _thread.retVal=T2MediaLib.setBGMVolume(0,vol);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGMTempo :function _trc_T2MediaPlayer_setBGMTempo(tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.setBGMTempo(0,tempo);\n    },\n    fiber$setBGMTempo :function _trc_T2MediaPlayer_f_setBGMTempo(_thread,tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.setBGMTempo(0,tempo);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getBGMCurrentTime :function _trc_T2MediaPlayer_getBGMCurrentTime() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMCurrentTime(0);\n    },\n    fiber$getBGMCurrentTime :function _trc_T2MediaPlayer_f_getBGMCurrentTime(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMCurrentTime(0);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getBGMLength :function _trc_T2MediaPlayer_getBGMLength() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMLength(0);\n    },\n    fiber$getBGMLength :function _trc_T2MediaPlayer_f_getBGMLength(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMLength(0);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getBGMData :function _trc_T2MediaPlayer_getBGMData(idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMData(idx);\n    },\n    fiber$getBGMData :function _trc_T2MediaPlayer_f_getBGMData(_thread,idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMData(idx);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    playBGMID :function _trc_T2MediaPlayer_playBGMID(id,idx,loop,offset,loopStart,loopEnd) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31003219;//kernel.T2MediaPlayer:3219\n      if (loop===null) {\n        //$LASTPOS=31003238;//kernel.T2MediaPlayer:3238\n        loop=false;\n      }\n      //$LASTPOS=31003257;//kernel.T2MediaPlayer:3257\n      if (offset===null) {\n        //$LASTPOS=31003278;//kernel.T2MediaPlayer:3278\n        offset=0;\n      }\n      return T2MediaLib.playBGM(id,idx,loop,offset,loopStart,loopEnd);\n    },\n    fiber$playBGMID :function _trc_T2MediaPlayer_f_playBGMID(_thread,id,idx,loop,offset,loopStart,loopEnd) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31003219;//kernel.T2MediaPlayer:3219\n      if (loop===null) {\n        //$LASTPOS=31003238;//kernel.T2MediaPlayer:3238\n        loop=false;\n      }\n      //$LASTPOS=31003257;//kernel.T2MediaPlayer:3257\n      if (offset===null) {\n        //$LASTPOS=31003278;//kernel.T2MediaPlayer:3278\n        offset=0;\n      }\n      _thread.retVal=T2MediaLib.playBGM(id,idx,loop,offset,loopStart,loopEnd);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stopBGMID :function _trc_T2MediaPlayer_stopBGMID(id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.stopBGM(id);\n    },\n    fiber$stopBGMID :function _trc_T2MediaPlayer_f_stopBGMID(_thread,id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.stopBGM(id);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    pauseBGMID :function _trc_T2MediaPlayer_pauseBGMID(id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.pauseBGM(id);\n    },\n    fiber$pauseBGMID :function _trc_T2MediaPlayer_f_pauseBGMID(_thread,id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.pauseBGM(id);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    resumeBGMID :function _trc_T2MediaPlayer_resumeBGMID(id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.resumeBGM(id);\n    },\n    fiber$resumeBGMID :function _trc_T2MediaPlayer_f_resumeBGMID(_thread,id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.resumeBGM(id);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGMVolumeID :function _trc_T2MediaPlayer_setBGMVolumeID(id,vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31003586;//kernel.T2MediaPlayer:3586\n      vol=vol/128;\n      //$LASTPOS=31003681;//kernel.T2MediaPlayer:3681\n      if (vol>1) {\n        //$LASTPOS=31003701;//kernel.T2MediaPlayer:3701\n        vol=1;\n      } else {\n        //$LASTPOS=31003722;//kernel.T2MediaPlayer:3722\n        if (vol<0) {\n          //$LASTPOS=31003737;//kernel.T2MediaPlayer:3737\n          vol=0;\n        }\n      }\n      return T2MediaLib.setBGMVolume(id,vol);\n    },\n    fiber$setBGMVolumeID :function _trc_T2MediaPlayer_f_setBGMVolumeID(_thread,id,vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31003586;//kernel.T2MediaPlayer:3586\n      vol=vol/128;\n      //$LASTPOS=31003681;//kernel.T2MediaPlayer:3681\n      if (vol>1) {\n        //$LASTPOS=31003701;//kernel.T2MediaPlayer:3701\n        vol=1;\n      } else {\n        //$LASTPOS=31003722;//kernel.T2MediaPlayer:3722\n        if (vol<0) {\n          //$LASTPOS=31003737;//kernel.T2MediaPlayer:3737\n          vol=0;\n        }\n      }\n      _thread.retVal=T2MediaLib.setBGMVolume(id,vol);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGMTempoID :function _trc_T2MediaPlayer_setBGMTempoID(id,tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.setBGMTempo(id,tempo);\n    },\n    fiber$setBGMTempoID :function _trc_T2MediaPlayer_f_setBGMTempoID(_thread,id,tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.setBGMTempo(id,tempo);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getBGMCurrentTimeID :function _trc_T2MediaPlayer_getBGMCurrentTimeID(id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMCurrentTime(id);\n    },\n    fiber$getBGMCurrentTimeID :function _trc_T2MediaPlayer_f_getBGMCurrentTimeID(_thread,id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMCurrentTime(id);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getBGMLengthID :function _trc_T2MediaPlayer_getBGMLengthID(id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMLength(id);\n    },\n    fiber$getBGMLengthID :function _trc_T2MediaPlayer_f_getBGMLengthID(_thread,id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMLength(id);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    sizeBGMID :function _trc_T2MediaPlayer_sizeBGMID() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMPlayerMax();\n    },\n    fiber$sizeBGMID :function _trc_T2MediaPlayer_f_sizeBGMID(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMPlayerMax();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    allStopBGM :function _trc_T2MediaPlayer_allStopBGM() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31004197;//kernel.T2MediaPlayer:4197\n      T2MediaLib.allStopBGM();\n    },\n    fiber$allStopBGM :function _trc_T2MediaPlayer_f_allStopBGM(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31004197;//kernel.T2MediaPlayer:4197\n      T2MediaLib.allStopBGM();\n      \n      _thread.retVal=_this;return;\n    },\n    loadAudio :function _trc_T2MediaPlayer_loadAudio(idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31004276;//kernel.T2MediaPlayer:4276\n      T2MediaLib.loadAudio(idx,src);\n      //$LASTPOS=31004338;//kernel.T2MediaPlayer:4338\n      while (T2MediaLib.getAudioData(idx)==null) {\n        //$LASTPOS=31004383;//kernel.T2MediaPlayer:4383\n        _this.update();\n      }\n    },\n    fiber$loadAudio :function _trc_T2MediaPlayer_f_loadAudio(_thread,idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31004276;//kernel.T2MediaPlayer:4276\n      T2MediaLib.loadAudio(idx,src);\n      \n      _thread.enter(function _trc_T2MediaPlayer_ent_loadAudio(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=31004338;//kernel.T2MediaPlayer:4338\n          case 1:\n            if (!(T2MediaLib.getAudioData(idx)==null)) { __pc=3; break; }\n            //$LASTPOS=31004383;//kernel.T2MediaPlayer:4383\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    playAudio :function _trc_T2MediaPlayer_playAudio(idx,loop,startTime) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31004439;//kernel.T2MediaPlayer:4439\n      if (loop===null) {\n        //$LASTPOS=31004458;//kernel.T2MediaPlayer:4458\n        loop=false;\n      }\n      //$LASTPOS=31004477;//kernel.T2MediaPlayer:4477\n      if (startTime===null) {\n        //$LASTPOS=31004501;//kernel.T2MediaPlayer:4501\n        startTime=0;\n      }\n      return T2MediaLib.playAudio(idx,loop,startTime);\n    },\n    fiber$playAudio :function _trc_T2MediaPlayer_f_playAudio(_thread,idx,loop,startTime) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31004439;//kernel.T2MediaPlayer:4439\n      if (loop===null) {\n        //$LASTPOS=31004458;//kernel.T2MediaPlayer:4458\n        loop=false;\n      }\n      //$LASTPOS=31004477;//kernel.T2MediaPlayer:4477\n      if (startTime===null) {\n        //$LASTPOS=31004501;//kernel.T2MediaPlayer:4501\n        startTime=0;\n      }\n      _thread.retVal=T2MediaLib.playAudio(idx,loop,startTime);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stopAudio :function _trc_T2MediaPlayer_stopAudio() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.stopAudio();\n    },\n    fiber$stopAudio :function _trc_T2MediaPlayer_f_stopAudio(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.stopAudio();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    pauseAudio :function _trc_T2MediaPlayer_pauseAudio() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.pauseAudio();\n    },\n    fiber$pauseAudio :function _trc_T2MediaPlayer_f_pauseAudio(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.pauseAudio();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    resumeAudio :function _trc_T2MediaPlayer_resumeAudio() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.resumeAudio();\n    },\n    fiber$resumeAudio :function _trc_T2MediaPlayer_f_resumeAudio(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.resumeAudio();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setAudioVolume :function _trc_T2MediaPlayer_setAudioVolume(vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31004783;//kernel.T2MediaPlayer:4783\n      vol=vol/128;\n      //$LASTPOS=31004805;//kernel.T2MediaPlayer:4805\n      if (vol>1) {\n        //$LASTPOS=31004825;//kernel.T2MediaPlayer:4825\n        vol=1;\n      } else {\n        //$LASTPOS=31004846;//kernel.T2MediaPlayer:4846\n        if (vol<0) {\n          //$LASTPOS=31004861;//kernel.T2MediaPlayer:4861\n          vol=0;\n        }\n      }\n      return T2MediaLib.setAudioVolume(vol);\n    },\n    fiber$setAudioVolume :function _trc_T2MediaPlayer_f_setAudioVolume(_thread,vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31004783;//kernel.T2MediaPlayer:4783\n      vol=vol/128;\n      //$LASTPOS=31004805;//kernel.T2MediaPlayer:4805\n      if (vol>1) {\n        //$LASTPOS=31004825;//kernel.T2MediaPlayer:4825\n        vol=1;\n      } else {\n        //$LASTPOS=31004846;//kernel.T2MediaPlayer:4846\n        if (vol<0) {\n          //$LASTPOS=31004861;//kernel.T2MediaPlayer:4861\n          vol=0;\n        }\n      }\n      _thread.retVal=T2MediaLib.setAudioVolume(vol);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setAudioTempo :function _trc_T2MediaPlayer_setAudioTempo(tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31004951;//kernel.T2MediaPlayer:4951\n      if (tempo>4) {\n        //$LASTPOS=31004973;//kernel.T2MediaPlayer:4973\n        tempo=4;\n      } else {\n        //$LASTPOS=31004996;//kernel.T2MediaPlayer:4996\n        if (tempo<0.5) {\n          //$LASTPOS=31005013;//kernel.T2MediaPlayer:5013\n          tempo=0.5;\n        }\n      }\n      return T2MediaLib.setAudioTempo(tempo);\n    },\n    fiber$setAudioTempo :function _trc_T2MediaPlayer_f_setAudioTempo(_thread,tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31004951;//kernel.T2MediaPlayer:4951\n      if (tempo>4) {\n        //$LASTPOS=31004973;//kernel.T2MediaPlayer:4973\n        tempo=4;\n      } else {\n        //$LASTPOS=31004996;//kernel.T2MediaPlayer:4996\n        if (tempo<0.5) {\n          //$LASTPOS=31005013;//kernel.T2MediaPlayer:5013\n          tempo=0.5;\n        }\n      }\n      _thread.retVal=T2MediaLib.setAudioTempo(tempo);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setAudioPosition :function _trc_T2MediaPlayer_setAudioPosition(time) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.setAudioPosition(time);\n    },\n    fiber$setAudioPosition :function _trc_T2MediaPlayer_f_setAudioPosition(_thread,time) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.setAudioPosition(time);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getAudioCurrentTime :function _trc_T2MediaPlayer_getAudioCurrentTime() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getAudioCurrentTime();\n    },\n    fiber$getAudioCurrentTime :function _trc_T2MediaPlayer_f_getAudioCurrentTime(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getAudioCurrentTime();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getAudioLength :function _trc_T2MediaPlayer_getAudioLength() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getAudioLength();\n    },\n    fiber$getAudioLength :function _trc_T2MediaPlayer_f_getAudioLength(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getAudioLength();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getAudioData :function _trc_T2MediaPlayer_getAudioData(idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getAudioData(idx);\n    },\n    fiber$getAudioData :function _trc_T2MediaPlayer_f_getAudioData(_thread,idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getAudioData(idx);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"initT2MediaPlayer":{"nowait":false},"clearSEData":{"nowait":false},"clearBGMData":{"nowait":false},"deleteSEData":{"nowait":false},"loadSE":{"nowait":false},"__getter__available":{"nowait":true},"loadFromProject":{"nowait":false},"playSE":{"nowait":true},"stopSE":{"nowait":false},"getSEData":{"nowait":false},"loadBGM":{"nowait":false},"playBGM":{"nowait":false},"stopBGM":{"nowait":false},"pauseBGM":{"nowait":false},"resumeBGM":{"nowait":false},"setBGMVolume":{"nowait":false},"setBGMTempo":{"nowait":false},"getBGMCurrentTime":{"nowait":false},"getBGMLength":{"nowait":false},"getBGMData":{"nowait":false},"playBGMID":{"nowait":false},"stopBGMID":{"nowait":false},"pauseBGMID":{"nowait":false},"resumeBGMID":{"nowait":false},"setBGMVolumeID":{"nowait":false},"setBGMTempoID":{"nowait":false},"getBGMCurrentTimeID":{"nowait":false},"getBGMLengthID":{"nowait":false},"sizeBGMID":{"nowait":false},"allStopBGM":{"nowait":false},"loadAudio":{"nowait":false},"playAudio":{"nowait":false},"stopAudio":{"nowait":false},"pauseAudio":{"nowait":false},"resumeAudio":{"nowait":false},"setAudioVolume":{"nowait":false},"setAudioTempo":{"nowait":false},"setAudioPosition":{"nowait":false},"getAudioCurrentTime":{"nowait":false},"getAudioLength":{"nowait":false},"getAudioData":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.PlainChar\',\n  shortName: \'PlainChar\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_PlainChar_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_PlainChar_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_PlainChar_initialize(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=32000066;//kernel.PlainChar:66\n      if (Tonyu.runMode) {\n        //$LASTPOS=32000309;//kernel.PlainChar:309\n        _this._th=Tonyu.globals.$Boot.schedule(_this,"tMain",[]);\n        //$LASTPOS=32000355;//kernel.PlainChar:355\n        _this.initSprite();\n        \n      }\n      //$LASTPOS=32000381;//kernel.PlainChar:381\n      if (typeof  x=="object") {\n        //$LASTPOS=32000405;//kernel.PlainChar:405\n        Tonyu.extend(_this,x);\n      } else {\n        //$LASTPOS=32000437;//kernel.PlainChar:437\n        if (typeof  x=="number") {\n          //$LASTPOS=32000472;//kernel.PlainChar:472\n          _this.x=x;\n          //$LASTPOS=32000491;//kernel.PlainChar:491\n          _this.y=y;\n          //$LASTPOS=32000510;//kernel.PlainChar:510\n          _this.p=p;\n          \n        }\n      }\n    },\n    draw :function _trc_PlainChar_draw(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=32000547;//kernel.PlainChar:547\n      _this.onDraw();\n      //$LASTPOS=32000562;//kernel.PlainChar:562\n      if (_this._isInvisible) {\n        return _this;\n      }\n      //$LASTPOS=32000593;//kernel.PlainChar:593\n      Tonyu.classes.kernel.Actor.prototype.draw.apply( _this, [c]);\n    },\n    setVisible :function _trc_PlainChar_setVisible(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=32000634;//kernel.PlainChar:634\n      _this._isInvisible=! v;\n    },\n    fiber$setVisible :function _trc_PlainChar_f_setVisible(_thread,v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=32000634;//kernel.PlainChar:634\n      _this._isInvisible=! v;\n      \n      _thread.retVal=_this;return;\n    },\n    onDraw :function _trc_PlainChar_onDraw() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$onDraw :function _trc_PlainChar_f_onDraw(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    update :function _trc_PlainChar_update() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=32000690;//kernel.PlainChar:690\n      _this.onUpdate();\n      //$LASTPOS=32000707;//kernel.PlainChar:707\n      Tonyu.classes.kernel.Actor.prototype.update.apply( _this, []);\n    },\n    fiber$update :function _trc_PlainChar_f_update(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=32000690;//kernel.PlainChar:690\n      _this.onUpdate();\n      \n      _thread.enter(function _trc_PlainChar_ent_update(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=32000707;//kernel.PlainChar:707\n            Tonyu.classes.kernel.Actor.prototype.fiber$update.apply( _this, [_thread]);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    onUpdate :function _trc_PlainChar_onUpdate() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    initSprite :function _trc_PlainChar_initSprite() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=32000768;//kernel.PlainChar:768\n      if (_this.layer&&typeof  _this.layer.add=="function") {\n        //$LASTPOS=32000820;//kernel.PlainChar:820\n        _this.layer.add(_this);\n        \n      } else {\n        //$LASTPOS=32000858;//kernel.PlainChar:858\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      //$LASTPOS=32000890;//kernel.PlainChar:890\n      _this.onAppear();\n    },\n    fiber$initSprite :function _trc_PlainChar_f_initSprite(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=32000768;//kernel.PlainChar:768\n      if (_this.layer&&typeof  _this.layer.add=="function") {\n        //$LASTPOS=32000820;//kernel.PlainChar:820\n        _this.layer.add(_this);\n        \n      } else {\n        //$LASTPOS=32000858;//kernel.PlainChar:858\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      \n      _thread.enter(function _trc_PlainChar_ent_initSprite(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=32000890;//kernel.PlainChar:890\n            _this.fiber$onAppear(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    tMain :function _trc_PlainChar_tMain() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=32000922;//kernel.PlainChar:922\n      _this.main();\n      //$LASTPOS=32000935;//kernel.PlainChar:935\n      _this.die();\n    },\n    fiber$tMain :function _trc_PlainChar_f_tMain(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_PlainChar_ent_tMain(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=32000922;//kernel.PlainChar:922\n            _this.fiber$main(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=32000935;//kernel.PlainChar:935\n            _this.die();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    appear :function _trc_PlainChar_appear(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return t;\n    },\n    fiber$appear :function _trc_PlainChar_f_appear(_thread,t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=t;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    trunc :function _trc_PlainChar_trunc(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.trunc(f);\n    },\n    loadPage :function _trc_PlainChar_loadPage(page,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=32001673;//kernel.PlainChar:1673\n      _this.all().die();\n      //$LASTPOS=32001691;//kernel.PlainChar:1691\n      new page(arg);\n      //$LASTPOS=32001711;//kernel.PlainChar:1711\n      _this.die();\n    },\n    fiber$loadPage :function _trc_PlainChar_f_loadPage(_thread,page,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=32001673;//kernel.PlainChar:1673\n      _this.all().die();\n      //$LASTPOS=32001691;//kernel.PlainChar:1691\n      new page(arg);\n      //$LASTPOS=32001711;//kernel.PlainChar:1711\n      _this.die();\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true},"setVisible":{"nowait":false},"onDraw":{"nowait":false},"update":{"nowait":false},"onUpdate":{"nowait":true},"initSprite":{"nowait":false},"tMain":{"nowait":false},"appear":{"nowait":false},"trunc":{"nowait":true},"loadPage":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.SecretChar\',\n  shortName: \'SecretChar\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.PlainChar,\n  includes: [],\n  methods: {\n    main :function _trc_SecretChar_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_SecretChar_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_SecretChar_draw(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.SpriteChar\',\n  shortName: \'SpriteChar\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.PlainChar,\n  includes: [],\n  methods: {\n    main :function _trc_SpriteChar_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_SpriteChar_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_SpriteChar_initialize(x,y,p,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=33000043;//kernel.SpriteChar:43\n      Tonyu.classes.kernel.PlainChar.apply( _this, [x,y,p]);\n      //$LASTPOS=33000062;//kernel.SpriteChar:62\n      _this.f=f;\n      //$LASTPOS=33000077;//kernel.SpriteChar:77\n      if (! _this.x) {\n        //$LASTPOS=33000090;//kernel.SpriteChar:90\n        _this.x=0;\n      }\n      //$LASTPOS=33000105;//kernel.SpriteChar:105\n      if (! _this.y) {\n        //$LASTPOS=33000118;//kernel.SpriteChar:118\n        _this.y=0;\n      }\n      //$LASTPOS=33000133;//kernel.SpriteChar:133\n      if (! _this.p) {\n        //$LASTPOS=33000146;//kernel.SpriteChar:146\n        _this.p=0;\n      }\n      //$LASTPOS=33000161;//kernel.SpriteChar:161\n      if (typeof  _this.scaleX!="number") {\n        //$LASTPOS=33000190;//kernel.SpriteChar:190\n        _this.scaleX=1;\n      }\n    },\n    draw :function _trc_SpriteChar_draw(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=33000220;//kernel.SpriteChar:220\n      if (_this.f) {\n        //$LASTPOS=33000238;//kernel.SpriteChar:238\n        if (! _this.scaleY) {\n          //$LASTPOS=33000251;//kernel.SpriteChar:251\n          _this.scaleY=_this.scaleX;\n        }\n        //$LASTPOS=33000275;//kernel.SpriteChar:275\n        _this.scaleX*=- 1;\n        \n      }\n      //$LASTPOS=33000299;//kernel.SpriteChar:299\n      Tonyu.classes.kernel.PlainChar.prototype.draw.apply( _this, [c]);\n      //$LASTPOS=33000319;//kernel.SpriteChar:319\n      if (_this.f) {\n        //$LASTPOS=33000326;//kernel.SpriteChar:326\n        _this.scaleX*=- 1;\n      }\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T1Line\',\n  shortName: \'T1Line\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_T1Line_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T1Line_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_T1Line_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=34000034;//kernel.T1Line:34\n      if (_this.hidden) {\n        return _this;\n      }\n      //$LASTPOS=34000065;//kernel.T1Line:65\n      ctx.strokeStyle=_this.col;\n      //$LASTPOS=34000091;//kernel.T1Line:91\n      ctx.beginPath();\n      //$LASTPOS=34000113;//kernel.T1Line:113\n      ctx.moveTo(_this.x,_this.y);\n      //$LASTPOS=34000135;//kernel.T1Line:135\n      ctx.lineTo(_this.tx,_this.ty);\n      //$LASTPOS=34000159;//kernel.T1Line:159\n      ctx.stroke();\n      //$LASTPOS=34000178;//kernel.T1Line:178\n      _this.hidden=true;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T1Map\',\n  shortName: \'T1Map\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Map,\n  includes: [],\n  methods: {\n    main :function _trc_T1Map_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T1Map_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGColor :function _trc_T1Map_setBGColor(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=35000064;//kernel.T1Map:64\n      Tonyu.globals.$Screen.setBGColor(c);\n    },\n    fiber$setBGColor :function _trc_T1Map_f_setBGColor(_thread,c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=35000064;//kernel.T1Map:64\n      Tonyu.globals.$Screen.setBGColor(c);\n      \n      _thread.retVal=_this;return;\n    },\n    load :function _trc_T1Map_load(fileName) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var f;\n      var o;\n      \n      //$LASTPOS=35000469;//kernel.T1Map:469\n      f = _this.file("../maps/").rel(fileName);\n      //$LASTPOS=35000512;//kernel.T1Map:512\n      o = f.obj();\n      //$LASTPOS=35000532;//kernel.T1Map:532\n      _this.chipWidth=o.chipWidth;\n      //$LASTPOS=35000560;//kernel.T1Map:560\n      _this.chipHeight=o.chipHeight;\n      //$LASTPOS=35000590;//kernel.T1Map:590\n      _this.baseData=o.baseData;\n      //$LASTPOS=35000616;//kernel.T1Map:616\n      _this.mapTable=_this.conv(_this.baseData[0],o.pTable);\n      //$LASTPOS=35000658;//kernel.T1Map:658\n      _this.mapData=_this.mapTable;\n      //$LASTPOS=35000681;//kernel.T1Map:681\n      _this.row=_this.mapTable.length;\n      //$LASTPOS=35000707;//kernel.T1Map:707\n      _this.col=_this.mapTable[0].length;\n      //$LASTPOS=35000736;//kernel.T1Map:736\n      _this.mapOnTable=_this.conv(_this.baseData[1],o.pTable);\n      //$LASTPOS=35000780;//kernel.T1Map:780\n      _this.mapOnData=_this.mapOnTable;\n      //$LASTPOS=35000813;//kernel.T1Map:813\n      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n      //$LASTPOS=35000885;//kernel.T1Map:885\n      _this.initMap();\n    },\n    fiber$load :function _trc_T1Map_f_load(_thread,fileName) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var f;\n      var o;\n      \n      //$LASTPOS=35000469;//kernel.T1Map:469\n      f = _this.file("../maps/").rel(fileName);\n      //$LASTPOS=35000512;//kernel.T1Map:512\n      o = f.obj();\n      //$LASTPOS=35000532;//kernel.T1Map:532\n      _this.chipWidth=o.chipWidth;\n      //$LASTPOS=35000560;//kernel.T1Map:560\n      _this.chipHeight=o.chipHeight;\n      //$LASTPOS=35000590;//kernel.T1Map:590\n      _this.baseData=o.baseData;\n      \n      _thread.enter(function _trc_T1Map_ent_load(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=35000616;//kernel.T1Map:616\n            _this.fiber$conv(_thread, _this.baseData[0], o.pTable);\n            __pc=1;return;\n          case 1:\n            _this.mapTable=_thread.retVal;\n            \n            //$LASTPOS=35000658;//kernel.T1Map:658\n            _this.mapData=_this.mapTable;\n            //$LASTPOS=35000681;//kernel.T1Map:681\n            _this.row=_this.mapTable.length;\n            //$LASTPOS=35000707;//kernel.T1Map:707\n            _this.col=_this.mapTable[0].length;\n            //$LASTPOS=35000736;//kernel.T1Map:736\n            _this.fiber$conv(_thread, _this.baseData[1], o.pTable);\n            __pc=2;return;\n          case 2:\n            _this.mapOnTable=_thread.retVal;\n            \n            //$LASTPOS=35000780;//kernel.T1Map:780\n            _this.mapOnData=_this.mapOnTable;\n            //$LASTPOS=35000813;//kernel.T1Map:813\n            _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n            //$LASTPOS=35000885;//kernel.T1Map:885\n            _this.fiber$initMap(_thread);\n            __pc=3;return;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    conv :function _trc_T1Map_conv(mat,tbl) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      \n      //$LASTPOS=35000926;//kernel.T1Map:926\n      res = [];\n      //$LASTPOS=35000943;//kernel.T1Map:943\n      mat.forEach((function anonymous_955(row) {\n        var rrow;\n        \n        //$LASTPOS=35000973;//kernel.T1Map:973\n        rrow = [];\n        //$LASTPOS=35000995;//kernel.T1Map:995\n        res.push(rrow);\n        //$LASTPOS=35001020;//kernel.T1Map:1020\n        row.forEach((function anonymous_1032(dat) {\n          var t;\n          \n          //$LASTPOS=35001067;//kernel.T1Map:1067\n          t = tbl[dat[0]];\n          //$LASTPOS=35001099;//kernel.T1Map:1099\n          if (t) {\n            //$LASTPOS=35001106;//kernel.T1Map:1106\n            rrow.push(Tonyu.globals[t.name]+dat[1]);\n          } else {\n            //$LASTPOS=35001165;//kernel.T1Map:1165\n            rrow.push(dat[1]);\n          }\n        }));\n      }));\n      return res;\n    },\n    fiber$conv :function _trc_T1Map_f_conv(_thread,mat,tbl) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var res;\n      \n      //$LASTPOS=35000926;//kernel.T1Map:926\n      res = [];\n      //$LASTPOS=35000943;//kernel.T1Map:943\n      mat.forEach((function anonymous_955(row) {\n        var rrow;\n        \n        //$LASTPOS=35000973;//kernel.T1Map:973\n        rrow = [];\n        //$LASTPOS=35000995;//kernel.T1Map:995\n        res.push(rrow);\n        //$LASTPOS=35001020;//kernel.T1Map:1020\n        row.forEach((function anonymous_1032(dat) {\n          var t;\n          \n          //$LASTPOS=35001067;//kernel.T1Map:1067\n          t = tbl[dat[0]];\n          //$LASTPOS=35001099;//kernel.T1Map:1099\n          if (t) {\n            //$LASTPOS=35001106;//kernel.T1Map:1106\n            rrow.push(Tonyu.globals[t.name]+dat[1]);\n          } else {\n            //$LASTPOS=35001165;//kernel.T1Map:1165\n            rrow.push(dat[1]);\n          }\n        }));\n      }));\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"setBGColor":{"nowait":false},"load":{"nowait":false},"conv":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T1Page\',\n  shortName: \'T1Page\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.PlainChar,\n  includes: [],\n  methods: {\n    main :function _trc_T1Page_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T1Page_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initGlobals :function _trc_T1Page_initGlobals() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=36000044;//kernel.T1Page:44\n      Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;\n      //$LASTPOS=36000074;//kernel.T1Page:74\n      Tonyu.globals.$Boot.setFrameRate(60);\n      //$LASTPOS=36000103;//kernel.T1Page:103\n      Tonyu.globals.$clBlack=_this.color(0,0,0);\n      //$LASTPOS=36000131;//kernel.T1Page:131\n      Tonyu.globals.$clRed=_this.color(255,0,0);\n      //$LASTPOS=36000159;//kernel.T1Page:159\n      Tonyu.globals.$clGreen=_this.color(0,255,0);\n      //$LASTPOS=36000189;//kernel.T1Page:189\n      Tonyu.globals.$clYellow=_this.color(255,255,0);\n      //$LASTPOS=36000222;//kernel.T1Page:222\n      Tonyu.globals.$clBlue=_this.color(0,0,255);\n      //$LASTPOS=36000251;//kernel.T1Page:251\n      Tonyu.globals.$clPink=_this.color(255,0,255);\n      //$LASTPOS=36000282;//kernel.T1Page:282\n      Tonyu.globals.$clAqua=_this.color(0,255,255);\n      //$LASTPOS=36000313;//kernel.T1Page:313\n      Tonyu.globals.$clWhite=_this.color(255,255,255);\n      //$LASTPOS=36000347;//kernel.T1Page:347\n      Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;\n    },\n    fiber$initGlobals :function _trc_T1Page_f_initGlobals(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=36000044;//kernel.T1Page:44\n      Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;\n      //$LASTPOS=36000074;//kernel.T1Page:74\n      Tonyu.globals.$Boot.setFrameRate(60);\n      \n      _thread.enter(function _trc_T1Page_ent_initGlobals(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=36000103;//kernel.T1Page:103\n            _this.fiber$color(_thread, 0, 0, 0);\n            __pc=1;return;\n          case 1:\n            Tonyu.globals.$clBlack=_thread.retVal;\n            \n            //$LASTPOS=36000131;//kernel.T1Page:131\n            _this.fiber$color(_thread, 255, 0, 0);\n            __pc=2;return;\n          case 2:\n            Tonyu.globals.$clRed=_thread.retVal;\n            \n            //$LASTPOS=36000159;//kernel.T1Page:159\n            _this.fiber$color(_thread, 0, 255, 0);\n            __pc=3;return;\n          case 3:\n            Tonyu.globals.$clGreen=_thread.retVal;\n            \n            //$LASTPOS=36000189;//kernel.T1Page:189\n            _this.fiber$color(_thread, 255, 255, 0);\n            __pc=4;return;\n          case 4:\n            Tonyu.globals.$clYellow=_thread.retVal;\n            \n            //$LASTPOS=36000222;//kernel.T1Page:222\n            _this.fiber$color(_thread, 0, 0, 255);\n            __pc=5;return;\n          case 5:\n            Tonyu.globals.$clBlue=_thread.retVal;\n            \n            //$LASTPOS=36000251;//kernel.T1Page:251\n            _this.fiber$color(_thread, 255, 0, 255);\n            __pc=6;return;\n          case 6:\n            Tonyu.globals.$clPink=_thread.retVal;\n            \n            //$LASTPOS=36000282;//kernel.T1Page:282\n            _this.fiber$color(_thread, 0, 255, 255);\n            __pc=7;return;\n          case 7:\n            Tonyu.globals.$clAqua=_thread.retVal;\n            \n            //$LASTPOS=36000313;//kernel.T1Page:313\n            _this.fiber$color(_thread, 255, 255, 255);\n            __pc=8;return;\n          case 8:\n            Tonyu.globals.$clWhite=_thread.retVal;\n            \n            //$LASTPOS=36000347;//kernel.T1Page:347\n            Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"initGlobals":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T1Text\',\n  shortName: \'T1Text\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_T1Text_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T1Text_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_T1Text_draw(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=37000032;//kernel.T1Text:32\n      if (_this.hidden) {\n        return _this;\n      }\n      //$LASTPOS=37000057;//kernel.T1Text:57\n      c.font=_this.size+"px \'ＭＳ Ｐゴシック\'";\n      //$LASTPOS=37000097;//kernel.T1Text:97\n      Tonyu.classes.kernel.Actor.prototype.draw.apply( _this, [c]);\n      //$LASTPOS=37000117;//kernel.T1Text:117\n      _this.hidden=true;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.TextChar\',\n  shortName: \'TextChar\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.PlainChar,\n  includes: [Tonyu.classes.kernel.TextRectMod],\n  methods: {\n    main :function _trc_TextChar_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_TextChar_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_TextChar_initialize(xx,yy,t,c,s) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=38000070;//kernel.TextChar:70\n      Tonyu.classes.kernel.PlainChar.apply( _this, [xx,yy]);\n      //$LASTPOS=38000089;//kernel.TextChar:89\n      _this.text="";\n      //$LASTPOS=38000103;//kernel.TextChar:103\n      _this.col=Tonyu.globals.$clWhite;\n      //$LASTPOS=38000122;//kernel.TextChar:122\n      _this.size=20;\n      //$LASTPOS=38000136;//kernel.TextChar:136\n      if (! _this.x) {\n        //$LASTPOS=38000149;//kernel.TextChar:149\n        _this.x=0;\n      }\n      //$LASTPOS=38000164;//kernel.TextChar:164\n      if (! _this.y) {\n        //$LASTPOS=38000177;//kernel.TextChar:177\n        _this.y=0;\n      }\n      //$LASTPOS=38000192;//kernel.TextChar:192\n      if (t) {\n        //$LASTPOS=38000199;//kernel.TextChar:199\n        _this.text=t;\n      }\n      //$LASTPOS=38000212;//kernel.TextChar:212\n      if (c) {\n        //$LASTPOS=38000219;//kernel.TextChar:219\n        _this.fillStyle=c;\n      }\n      //$LASTPOS=38000237;//kernel.TextChar:237\n      if (s) {\n        //$LASTPOS=38000244;//kernel.TextChar:244\n        _this.size=s;\n      }\n    },\n    draw :function _trc_TextChar_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var rect;\n      \n      //$LASTPOS=38000274;//kernel.TextChar:274\n      if (! _this.size) {\n        //$LASTPOS=38000285;//kernel.TextChar:285\n        _this.size=15;\n      }\n      //$LASTPOS=38000299;//kernel.TextChar:299\n      if (! _this.align) {\n        //$LASTPOS=38000311;//kernel.TextChar:311\n        _this.align="left";\n      }\n      //$LASTPOS=38000330;//kernel.TextChar:330\n      if (! _this.fillStyle) {\n        //$LASTPOS=38000346;//kernel.TextChar:346\n        _this.fillStyle="white";\n      }\n      //$LASTPOS=38000370;//kernel.TextChar:370\n      ctx.fillStyle=_this.fillStyle;\n      //$LASTPOS=38000400;//kernel.TextChar:400\n      ctx.globalAlpha=_this.alpha/255;\n      //$LASTPOS=38000437;//kernel.TextChar:437\n      ctx.font=_this.size+"px \'ＭＳ Ｐゴシック\'";\n      //$LASTPOS=38000473;//kernel.TextChar:473\n      rect = _this.drawTextRect(ctx,_this.text,_this.x,_this.y,_this.size,_this.align,"fill");\n      //$LASTPOS=38000540;//kernel.TextChar:540\n      _this.width=rect.w;\n      //$LASTPOS=38000559;//kernel.TextChar:559\n      _this.height=rect.h;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.GameConsole\',\n  shortName: \'GameConsole\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_GameConsole_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_GameConsole_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_GameConsole_initialize(opt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=39000084;//kernel.GameConsole:84\n      _this.extend(opt);\n      //$LASTPOS=39000102;//kernel.GameConsole:102\n      _this.cw=_this.canvas.width();\n      //$LASTPOS=39000126;//kernel.GameConsole:126\n      _this.ch=_this.canvas.height();\n      //$LASTPOS=39000151;//kernel.GameConsole:151\n      Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites;\n      //$LASTPOS=39000178;//kernel.GameConsole:178\n      Tonyu.globals.$Screen=_this.gameScreen=new Tonyu.classes.kernel.GameScreen({width: 465,height: 465,sprites: Tonyu.globals.$Sprites});\n      //$LASTPOS=39000259;//kernel.GameConsole:259\n      Tonyu.globals.$FrontSprites=_this.sprites=new Tonyu.classes.kernel.Sprites;\n      //$LASTPOS=39000299;//kernel.GameConsole:299\n      _this.sprites.add(_this.gameScreen);\n      //$LASTPOS=39000329;//kernel.GameConsole:329\n      _this.cctx=_this.canvas[0].getContext("2d");\n    },\n    shouldDraw1x1 :function _trc_GameConsole_shouldDraw1x1(srcw,srch,dstw,dsth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var larger;\n      var smaller;\n      \n      //$LASTPOS=39000448;//kernel.GameConsole:448\n      larger = 200;\n      //$LASTPOS=39000469;//kernel.GameConsole:469\n      smaller = 5;\n      return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;\n    },\n    fiber$shouldDraw1x1 :function _trc_GameConsole_f_shouldDraw1x1(_thread,srcw,srch,dstw,dsth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var larger;\n      var smaller;\n      \n      //$LASTPOS=39000448;//kernel.GameConsole:448\n      larger = 200;\n      //$LASTPOS=39000469;//kernel.GameConsole:469\n      smaller = 5;\n      _thread.retVal=srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    layout :function _trc_GameConsole_layout() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var width;\n      var height;\n      var calcw;\n      var calch;\n      var marginw;\n      var marginh;\n      \n      //$LASTPOS=39000606;//kernel.GameConsole:606\n      _this.cw=_this.canvas.width();\n      //$LASTPOS=39000630;//kernel.GameConsole:630\n      _this.ch=_this.canvas.height();\n      //$LASTPOS=39000655;//kernel.GameConsole:655\n      width = _this.gameScreen.width;\n      //$LASTPOS=39000688;//kernel.GameConsole:688\n      height = _this.gameScreen.height;\n      //$LASTPOS=39000723;//kernel.GameConsole:723\n      calcw = _this.ch/height*width;\n      //$LASTPOS=39000767;//kernel.GameConsole:767\n      calch = _this.cw/width*height;\n      //$LASTPOS=39000811;//kernel.GameConsole:811\n      if (calch>_this.ch) {\n        //$LASTPOS=39000825;//kernel.GameConsole:825\n        calch=_this.ch;\n      }\n      //$LASTPOS=39000840;//kernel.GameConsole:840\n      if (calcw>_this.cw) {\n        //$LASTPOS=39000854;//kernel.GameConsole:854\n        calcw=_this.cw;\n      }\n      //$LASTPOS=39000869;//kernel.GameConsole:869\n      if (_this.shouldDraw1x1(width,height,calcw,calch)) {\n        //$LASTPOS=39000925;//kernel.GameConsole:925\n        calcw=width;\n        //$LASTPOS=39000937;//kernel.GameConsole:937\n        calch=height;\n        \n      }\n      //$LASTPOS=39000963;//kernel.GameConsole:963\n      marginw = Math.floor((_this.cw-calcw)/2);\n      //$LASTPOS=39001006;//kernel.GameConsole:1006\n      marginh = Math.floor((_this.ch-calch)/2);\n      //$LASTPOS=39001049;//kernel.GameConsole:1049\n      _this.gameScreen.setBounds({left: marginw,top: marginh,width: calcw,height: calch});\n    },\n    fiber$layout :function _trc_GameConsole_f_layout(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var width;\n      var height;\n      var calcw;\n      var calch;\n      var marginw;\n      var marginh;\n      \n      //$LASTPOS=39000606;//kernel.GameConsole:606\n      _this.cw=_this.canvas.width();\n      //$LASTPOS=39000630;//kernel.GameConsole:630\n      _this.ch=_this.canvas.height();\n      //$LASTPOS=39000655;//kernel.GameConsole:655\n      width = _this.gameScreen.width;\n      //$LASTPOS=39000688;//kernel.GameConsole:688\n      height = _this.gameScreen.height;\n      //$LASTPOS=39000723;//kernel.GameConsole:723\n      calcw = _this.ch/height*width;\n      //$LASTPOS=39000767;//kernel.GameConsole:767\n      calch = _this.cw/width*height;\n      //$LASTPOS=39000811;//kernel.GameConsole:811\n      if (calch>_this.ch) {\n        //$LASTPOS=39000825;//kernel.GameConsole:825\n        calch=_this.ch;\n      }\n      //$LASTPOS=39000840;//kernel.GameConsole:840\n      if (calcw>_this.cw) {\n        //$LASTPOS=39000854;//kernel.GameConsole:854\n        calcw=_this.cw;\n      }\n      //$LASTPOS=39000869;//kernel.GameConsole:869\n      if (_this.shouldDraw1x1(width,height,calcw,calch)) {\n        //$LASTPOS=39000925;//kernel.GameConsole:925\n        calcw=width;\n        //$LASTPOS=39000937;//kernel.GameConsole:937\n        calch=height;\n        \n      }\n      //$LASTPOS=39000963;//kernel.GameConsole:963\n      marginw = Math.floor((_this.cw-calcw)/2);\n      //$LASTPOS=39001006;//kernel.GameConsole:1006\n      marginh = Math.floor((_this.ch-calch)/2);\n      //$LASTPOS=39001049;//kernel.GameConsole:1049\n      _this.gameScreen.setBounds({left: marginw,top: marginh,width: calcw,height: calch});\n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_GameConsole_draw() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=39001144;//kernel.GameConsole:1144\n      _this.layout();\n      //$LASTPOS=39001159;//kernel.GameConsole:1159\n      _this.sprites.draw(_this.canvas[0]);\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"shouldDraw1x1":{"nowait":false},"layout":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.MapEditor\',\n  shortName: \'MapEditor\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_MapEditor_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var j;\n      \n      //$LASTPOS=40000030;//kernel.MapEditor:30\n      Tonyu.globals.$Screen.resize(480,640);\n      //$LASTPOS=40000055;//kernel.MapEditor:55\n      _this.loadMode=false;\n      //$LASTPOS=40000071;//kernel.MapEditor:71\n      _this.fileExist=false;\n      //$LASTPOS=40000088;//kernel.MapEditor:88\n      _this.print("map file(s)");\n      //$LASTPOS=40000110;//kernel.MapEditor:110\n      _this.fileList=_this.file("../maps/");\n      //$LASTPOS=40000137;//kernel.MapEditor:137\n      _this.fileList.recursive((function a(f) {\n        \n        //$LASTPOS=40000175;//kernel.MapEditor:175\n        f=f+"";\n        //$LASTPOS=40000187;//kernel.MapEditor:187\n        _this.fNames=f.split("/");\n        //$LASTPOS=40000212;//kernel.MapEditor:212\n        _this.print(_this.fNames[_this.fNames.length-1]);\n        //$LASTPOS=40000248;//kernel.MapEditor:248\n        _this.fileExist=true;\n      }));\n      //$LASTPOS=40000268;//kernel.MapEditor:268\n      if (_this.fileExist) {\n        //$LASTPOS=40000287;//kernel.MapEditor:287\n        _this.print("Load Data?: Y or N");\n        //$LASTPOS=40000320;//kernel.MapEditor:320\n        while (true) {\n          //$LASTPOS=40000341;//kernel.MapEditor:341\n          if (_this.getkey("y")>0) {\n            //$LASTPOS=40000372;//kernel.MapEditor:372\n            _this.loadMode=true;\n            break;\n            \n            \n          }\n          //$LASTPOS=40000424;//kernel.MapEditor:424\n          if (_this.getkey("n")>0) {\n            //$LASTPOS=40000455;//kernel.MapEditor:455\n            _this.loadMode=false;\n            break;\n            \n            \n          }\n          //$LASTPOS=40000508;//kernel.MapEditor:508\n          _this.update();\n          \n        }\n        //$LASTPOS=40000528;//kernel.MapEditor:528\n        if (_this.loadMode) {\n          //$LASTPOS=40000550;//kernel.MapEditor:550\n          _this.fileName=prompt("Input json file (*.json)","map.json");\n          //$LASTPOS=40000614;//kernel.MapEditor:614\n          if (_this.fileName) {\n            //$LASTPOS=40000640;//kernel.MapEditor:640\n            _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);\n            \n          }\n          //$LASTPOS=40000702;//kernel.MapEditor:702\n          if (_this.mapDataFile.obj()) {\n            //$LASTPOS=40000737;//kernel.MapEditor:737\n            _this.baseData=_this.mapDataFile.obj();\n            \n          } else {\n            //$LASTPOS=40000792;//kernel.MapEditor:792\n            _this.mapDataFile=_this.file(_this.fileName);\n            //$LASTPOS=40000832;//kernel.MapEditor:832\n            if (_this.mapDataFile.obj()) {\n              //$LASTPOS=40000871;//kernel.MapEditor:871\n              _this.baseData=_this.mapDataFile.obj();\n              \n            }\n            \n          }\n          //$LASTPOS=40000931;//kernel.MapEditor:931\n          if (_this.baseData==undefined) {\n            //$LASTPOS=40000968;//kernel.MapEditor:968\n            _this.print("Load failed");\n            //$LASTPOS=40001002;//kernel.MapEditor:1002\n            _this.loadMode=false;\n            \n          } else {\n            //$LASTPOS=40001032;//kernel.MapEditor:1032\n            if (_this.baseData[0]&&_this.baseData[1]) {\n              //$LASTPOS=40001076;//kernel.MapEditor:1076\n              _this.mapData=_this.baseData[0];\n              //$LASTPOS=40001109;//kernel.MapEditor:1109\n              _this.mapOnData=_this.baseData[1];\n              //$LASTPOS=40001144;//kernel.MapEditor:1144\n              if (_this.baseData.length>2) {\n                //$LASTPOS=40001183;//kernel.MapEditor:1183\n                _this.chipWidth=_this.baseData[_this.baseData.length-2];\n                //$LASTPOS=40001238;//kernel.MapEditor:1238\n                _this.chipHeight=_this.baseData[_this.baseData.length-1];\n                \n              }\n              \n            }\n          }\n          \n        }\n        \n      }\n      //$LASTPOS=40001310;//kernel.MapEditor:1310\n      _this.update();\n      //$LASTPOS=40001573;//kernel.MapEditor:1573\n      if (! _this.loadMode) {\n        //$LASTPOS=40001592;//kernel.MapEditor:1592\n        _this.row=prompt("input row");\n        //$LASTPOS=40001621;//kernel.MapEditor:1621\n        _this.col=prompt("input col");\n        //$LASTPOS=40001650;//kernel.MapEditor:1650\n        _this.chipWidth=prompt("input chipWidth");\n        //$LASTPOS=40001691;//kernel.MapEditor:1691\n        _this.chipHeight=prompt("input chipHeight");\n        //$LASTPOS=40001734;//kernel.MapEditor:1734\n        _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n        //$LASTPOS=40001798;//kernel.MapEditor:1798\n        _this.panel.x=_this.panel.width/2+40;\n        //$LASTPOS=40001828;//kernel.MapEditor:1828\n        _this.panel.y=_this.panel.height/2+40;\n        //$LASTPOS=40001859;//kernel.MapEditor:1859\n        _this.panel.setFillStyle("cyan");\n        //$LASTPOS=40001891;//kernel.MapEditor:1891\n        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n        //$LASTPOS=40001941;//kernel.MapEditor:1941\n        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});\n        \n      } else {\n        //$LASTPOS=40002245;//kernel.MapEditor:2245\n        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({chipWidth: 32,chipHeight: 32});\n        //$LASTPOS=40002291;//kernel.MapEditor:2291\n        Tonyu.globals.$map.load(_this.fileName);\n        //$LASTPOS=40002316;//kernel.MapEditor:2316\n        _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});\n        //$LASTPOS=40002411;//kernel.MapEditor:2411\n        _this.panel.x=_this.panel.width/2+40;\n        //$LASTPOS=40002441;//kernel.MapEditor:2441\n        _this.panel.y=_this.panel.height/2+40;\n        //$LASTPOS=40002472;//kernel.MapEditor:2472\n        _this.panel.setFillStyle("cyan");\n        //$LASTPOS=40002504;//kernel.MapEditor:2504\n        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n        \n      }\n      //$LASTPOS=40002552;//kernel.MapEditor:2552\n      Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});\n      //$LASTPOS=40002606;//kernel.MapEditor:2606\n      _this.counter=0;\n      //$LASTPOS=40002617;//kernel.MapEditor:2617\n      //$LASTPOS=40002621;//kernel.MapEditor:2621\n      i = 0;\n      while(i<16) {\n        {\n          //$LASTPOS=40002644;//kernel.MapEditor:2644\n          //$LASTPOS=40002648;//kernel.MapEditor:2648\n          j = 0;\n          while(j<8) {\n            {\n              //$LASTPOS=40002674;//kernel.MapEditor:2674\n              Tonyu.globals.$mp.set(j,i,Tonyu.globals.$pat_mapchip+_this.counter);\n              //$LASTPOS=40002717;//kernel.MapEditor:2717\n              _this.counter++;\n            }\n            j++;\n          }\n        }\n        i++;\n      }\n      //$LASTPOS=40002736;//kernel.MapEditor:2736\n      _this.drawPanel();\n      //$LASTPOS=40002749;//kernel.MapEditor:2749\n      _this.mode="get";\n      //$LASTPOS=40002761;//kernel.MapEditor:2761\n      _this.prevMode="set";\n      //$LASTPOS=40002777;//kernel.MapEditor:2777\n      _this.mapp=0;\n      //$LASTPOS=40002785;//kernel.MapEditor:2785\n      _this.mx=- 40;\n      //$LASTPOS=40002793;//kernel.MapEditor:2793\n      _this.my=- 40;\n      //$LASTPOS=40002801;//kernel.MapEditor:2801\n      _this.chipX=- 40;\n      //$LASTPOS=40002812;//kernel.MapEditor:2812\n      _this.chipY=- 40;\n      //$LASTPOS=40002823;//kernel.MapEditor:2823\n      _this.x=Tonyu.globals.$screenWidth-_this.chipWidth/2;\n      //$LASTPOS=40002851;//kernel.MapEditor:2851\n      _this.y=Tonyu.globals.$screenHeight-_this.chipHeight/2;\n      //$LASTPOS=40002881;//kernel.MapEditor:2881\n      Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n      //$LASTPOS=40002903;//kernel.MapEditor:2903\n      while (true) {\n        //$LASTPOS=40002920;//kernel.MapEditor:2920\n        _this.p=_this.mapp;\n        //$LASTPOS=40002932;//kernel.MapEditor:2932\n        if (_this.getkey("e")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {\n          //$LASTPOS=40003070;//kernel.MapEditor:3070\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=40003103;//kernel.MapEditor:3103\n          _this.mode="erase";\n          //$LASTPOS=40003125;//kernel.MapEditor:3125\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=40003156;//kernel.MapEditor:3156\n        if (_this.getkey("s")==1) {\n          //$LASTPOS=40003184;//kernel.MapEditor:3184\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=40003217;//kernel.MapEditor:3217\n          if (_this.mode=="set") {\n            //$LASTPOS=40003246;//kernel.MapEditor:3246\n            _this.mode="setOn";\n            \n          } else {\n            //$LASTPOS=40003287;//kernel.MapEditor:3287\n            _this.mode="set";\n            \n          }\n          //$LASTPOS=40003317;//kernel.MapEditor:3317\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=40003348;//kernel.MapEditor:3348\n        if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {\n          //$LASTPOS=40003466;//kernel.MapEditor:3466\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=40003499;//kernel.MapEditor:3499\n          _this.mode="set";\n          //$LASTPOS=40003519;//kernel.MapEditor:3519\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=40003550;//kernel.MapEditor:3550\n        if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {\n          //$LASTPOS=40003670;//kernel.MapEditor:3670\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=40003703;//kernel.MapEditor:3703\n          _this.mode="setOn";\n          //$LASTPOS=40003725;//kernel.MapEditor:3725\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=40003756;//kernel.MapEditor:3756\n        if (_this.getkey("o")==1) {\n          //$LASTPOS=40003784;//kernel.MapEditor:3784\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=40003817;//kernel.MapEditor:3817\n          _this.mode="setOn";\n          \n        }\n        //$LASTPOS=40003841;//kernel.MapEditor:3841\n        if (_this.getkey("g")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>240&&Tonyu.globals.$touches[0].x<360&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {\n          //$LASTPOS=40003981;//kernel.MapEditor:3981\n          if (_this.mode!="get") {\n            //$LASTPOS=40004010;//kernel.MapEditor:4010\n            _this.prevMode=_this.mode;\n            //$LASTPOS=40004037;//kernel.MapEditor:4037\n            Tonyu.globals.$mp.scrollTo(- 40,- 40);\n            //$LASTPOS=40004072;//kernel.MapEditor:4072\n            _this.mode="get";\n            //$LASTPOS=40004096;//kernel.MapEditor:4096\n            _this.chipX=- 40;\n            //$LASTPOS=40004119;//kernel.MapEditor:4119\n            _this.chipY=- 40;\n            \n          } else {\n            //$LASTPOS=40004157;//kernel.MapEditor:4157\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=40004194;//kernel.MapEditor:4194\n            _this.mode=_this.prevMode;\n            \n          }\n          //$LASTPOS=40004227;//kernel.MapEditor:4227\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=40004258;//kernel.MapEditor:4258\n        if (_this.getkey("p")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>360&&Tonyu.globals.$touches[0].x<480&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {\n          //$LASTPOS=40004412;//kernel.MapEditor:4412\n          _this.saveFileName=prompt("input json file(*.json)","map.json");\n          //$LASTPOS=40004885;//kernel.MapEditor:4885\n          _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);\n          //$LASTPOS=40004942;//kernel.MapEditor:4942\n          _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable,Tonyu.globals.$map.chipWidth,Tonyu.globals.$map.chipHeight];\n          //$LASTPOS=40005084;//kernel.MapEditor:5084\n          _this.saveDataFile.obj(_this.data);\n          //$LASTPOS=40005116;//kernel.MapEditor:5116\n          _this.print(_this.saveFileName+" Saved");\n          \n        }\n        //$LASTPOS=40005205;//kernel.MapEditor:5205\n        if (_this.getkey("c")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {\n          //$LASTPOS=40005345;//kernel.MapEditor:5345\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=40005378;//kernel.MapEditor:5378\n          _this.mode="copy";\n          //$LASTPOS=40005399;//kernel.MapEditor:5399\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=40005430;//kernel.MapEditor:5430\n        if (_this.mode!="get") {\n          //$LASTPOS=40005455;//kernel.MapEditor:5455\n          if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {\n            //$LASTPOS=40005561;//kernel.MapEditor:5561\n            _this.mx=_this.mx+8;\n          }\n          //$LASTPOS=40005578;//kernel.MapEditor:5578\n          if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {\n            //$LASTPOS=40005709;//kernel.MapEditor:5709\n            _this.mx=_this.mx-8;\n          }\n          //$LASTPOS=40005726;//kernel.MapEditor:5726\n          if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {\n            //$LASTPOS=40005839;//kernel.MapEditor:5839\n            _this.my=_this.my+8;\n          }\n          //$LASTPOS=40005856;//kernel.MapEditor:5856\n          if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {\n            //$LASTPOS=40005991;//kernel.MapEditor:5991\n            _this.my=_this.my-8;\n          }\n          //$LASTPOS=40006008;//kernel.MapEditor:6008\n          Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n          \n        } else {\n          //$LASTPOS=40006049;//kernel.MapEditor:6049\n          if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {\n            //$LASTPOS=40006155;//kernel.MapEditor:6155\n            _this.chipX=_this.chipX+8;\n          }\n          //$LASTPOS=40006178;//kernel.MapEditor:6178\n          if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {\n            //$LASTPOS=40006309;//kernel.MapEditor:6309\n            _this.chipX=_this.chipX-8;\n          }\n          //$LASTPOS=40006332;//kernel.MapEditor:6332\n          if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {\n            //$LASTPOS=40006445;//kernel.MapEditor:6445\n            _this.chipY=_this.chipY+8;\n          }\n          //$LASTPOS=40006468;//kernel.MapEditor:6468\n          if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {\n            //$LASTPOS=40006603;//kernel.MapEditor:6603\n            _this.chipY=_this.chipY-8;\n          }\n          //$LASTPOS=40006626;//kernel.MapEditor:6626\n          Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);\n          \n        }\n        //$LASTPOS=40006663;//kernel.MapEditor:6663\n        _this.panel.x=_this.panel.width/2-_this.mx;\n        //$LASTPOS=40006693;//kernel.MapEditor:6693\n        _this.panel.y=_this.panel.height/2-_this.my;\n        //$LASTPOS=40006724;//kernel.MapEditor:6724\n        if (_this.mode=="set"&&_this.getkey(1)>0&&_this.inRect()) {\n          //$LASTPOS=40006776;//kernel.MapEditor:6776\n          Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n          //$LASTPOS=40006824;//kernel.MapEditor:6824\n          Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n          \n        } else {\n          //$LASTPOS=40006874;//kernel.MapEditor:6874\n          if (_this.mode=="erase"&&_this.getkey(1)>0&&_this.inRect()) {\n            //$LASTPOS=40006928;//kernel.MapEditor:6928\n            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n            \n          } else {\n            //$LASTPOS=40006976;//kernel.MapEditor:6976\n            if (_this.mode=="get"&&_this.getkey(1)>0&&_this.inRect()) {\n              //$LASTPOS=40007028;//kernel.MapEditor:7028\n              _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);\n              //$LASTPOS=40007081;//kernel.MapEditor:7081\n              _this.mode=_this.prevMode;\n              //$LASTPOS=40007104;//kernel.MapEditor:7104\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=40007137;//kernel.MapEditor:7137\n              _this.print(_this.mode+" mode");\n              //$LASTPOS=40007166;//kernel.MapEditor:7166\n              _this.updateEx(10);\n              \n            } else {\n              //$LASTPOS=40007190;//kernel.MapEditor:7190\n              if (_this.mode=="setOn"&&_this.getkey(1)>0&&_this.inRect()) {\n                //$LASTPOS=40007244;//kernel.MapEditor:7244\n                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n                \n              } else {\n                //$LASTPOS=40007296;//kernel.MapEditor:7296\n                if (_this.mode=="copy"&&_this.getkey(1)>0&&_this.inRect()) {\n                  //$LASTPOS=40007349;//kernel.MapEditor:7349\n                  _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);\n                  //$LASTPOS=40007397;//kernel.MapEditor:7397\n                  _this.mode="set";\n                  //$LASTPOS=40007417;//kernel.MapEditor:7417\n                  _this.print(_this.mode+" mode");\n                  //$LASTPOS=40007446;//kernel.MapEditor:7446\n                  _this.updateEx(10);\n                  \n                }\n              }\n            }\n          }\n        }\n        //$LASTPOS=40007470;//kernel.MapEditor:7470\n        _this.update();\n        \n      }\n    },\n    fiber$main :function _trc_MapEditor_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var j;\n      \n      //$LASTPOS=40000030;//kernel.MapEditor:30\n      Tonyu.globals.$Screen.resize(480,640);\n      //$LASTPOS=40000055;//kernel.MapEditor:55\n      _this.loadMode=false;\n      //$LASTPOS=40000071;//kernel.MapEditor:71\n      _this.fileExist=false;\n      //$LASTPOS=40000088;//kernel.MapEditor:88\n      _this.print("map file(s)");\n      \n      _thread.enter(function _trc_MapEditor_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=40000110;//kernel.MapEditor:110\n            _this.fiber$file(_thread, "../maps/");\n            __pc=1;return;\n          case 1:\n            _this.fileList=_thread.retVal;\n            \n            //$LASTPOS=40000137;//kernel.MapEditor:137\n            _this.fileList.recursive((function a(f) {\n              \n              //$LASTPOS=40000175;//kernel.MapEditor:175\n              f=f+"";\n              //$LASTPOS=40000187;//kernel.MapEditor:187\n              _this.fNames=f.split("/");\n              //$LASTPOS=40000212;//kernel.MapEditor:212\n              _this.print(_this.fNames[_this.fNames.length-1]);\n              //$LASTPOS=40000248;//kernel.MapEditor:248\n              _this.fileExist=true;\n            }));\n            //$LASTPOS=40000268;//kernel.MapEditor:268\n            if (!(_this.fileExist)) { __pc=11; break; }\n            //$LASTPOS=40000287;//kernel.MapEditor:287\n            _this.print("Load Data?: Y or N");\n            //$LASTPOS=40000320;//kernel.MapEditor:320\n          case 2:\n            //$LASTPOS=40000341;//kernel.MapEditor:341\n            if (!(_this.getkey("y")>0)) { __pc=3; break; }\n            //$LASTPOS=40000372;//kernel.MapEditor:372\n            _this.loadMode=true;\n            __pc=6; break;\n            \n          case 3:\n            \n            //$LASTPOS=40000424;//kernel.MapEditor:424\n            if (!(_this.getkey("n")>0)) { __pc=4; break; }\n            //$LASTPOS=40000455;//kernel.MapEditor:455\n            _this.loadMode=false;\n            __pc=6; break;\n            \n          case 4:\n            \n            //$LASTPOS=40000508;//kernel.MapEditor:508\n            _this.fiber$update(_thread);\n            __pc=5;return;\n          case 5:\n            \n            __pc=2;break;\n          case 6:\n            \n            //$LASTPOS=40000528;//kernel.MapEditor:528\n            if (!(_this.loadMode)) { __pc=10; break; }\n            //$LASTPOS=40000550;//kernel.MapEditor:550\n            _this.fileName=prompt("Input json file (*.json)","map.json");\n            //$LASTPOS=40000614;//kernel.MapEditor:614\n            if (_this.fileName) {\n              //$LASTPOS=40000640;//kernel.MapEditor:640\n              _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);\n              \n            }\n            //$LASTPOS=40000702;//kernel.MapEditor:702\n            if (!(_this.mapDataFile.obj())) { __pc=7; break; }\n            {\n              //$LASTPOS=40000737;//kernel.MapEditor:737\n              _this.baseData=_this.mapDataFile.obj();\n            }\n            __pc=9;break;\n          case 7:\n            //$LASTPOS=40000792;//kernel.MapEditor:792\n            _this.fiber$file(_thread, _this.fileName);\n            __pc=8;return;\n          case 8:\n            _this.mapDataFile=_thread.retVal;\n            \n            //$LASTPOS=40000832;//kernel.MapEditor:832\n            if (_this.mapDataFile.obj()) {\n              //$LASTPOS=40000871;//kernel.MapEditor:871\n              _this.baseData=_this.mapDataFile.obj();\n              \n            }\n          case 9:\n            \n            //$LASTPOS=40000931;//kernel.MapEditor:931\n            if (_this.baseData==undefined) {\n              //$LASTPOS=40000968;//kernel.MapEditor:968\n              _this.print("Load failed");\n              //$LASTPOS=40001002;//kernel.MapEditor:1002\n              _this.loadMode=false;\n              \n            } else {\n              //$LASTPOS=40001032;//kernel.MapEditor:1032\n              if (_this.baseData[0]&&_this.baseData[1]) {\n                //$LASTPOS=40001076;//kernel.MapEditor:1076\n                _this.mapData=_this.baseData[0];\n                //$LASTPOS=40001109;//kernel.MapEditor:1109\n                _this.mapOnData=_this.baseData[1];\n                //$LASTPOS=40001144;//kernel.MapEditor:1144\n                if (_this.baseData.length>2) {\n                  //$LASTPOS=40001183;//kernel.MapEditor:1183\n                  _this.chipWidth=_this.baseData[_this.baseData.length-2];\n                  //$LASTPOS=40001238;//kernel.MapEditor:1238\n                  _this.chipHeight=_this.baseData[_this.baseData.length-1];\n                  \n                }\n                \n              }\n            }\n          case 10:\n            \n          case 11:\n            \n            //$LASTPOS=40001310;//kernel.MapEditor:1310\n            _this.fiber$update(_thread);\n            __pc=12;return;\n          case 12:\n            \n            //$LASTPOS=40001573;//kernel.MapEditor:1573\n            if (! _this.loadMode) {\n              //$LASTPOS=40001592;//kernel.MapEditor:1592\n              _this.row=prompt("input row");\n              //$LASTPOS=40001621;//kernel.MapEditor:1621\n              _this.col=prompt("input col");\n              //$LASTPOS=40001650;//kernel.MapEditor:1650\n              _this.chipWidth=prompt("input chipWidth");\n              //$LASTPOS=40001691;//kernel.MapEditor:1691\n              _this.chipHeight=prompt("input chipHeight");\n              //$LASTPOS=40001734;//kernel.MapEditor:1734\n              _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n              //$LASTPOS=40001798;//kernel.MapEditor:1798\n              _this.panel.x=_this.panel.width/2+40;\n              //$LASTPOS=40001828;//kernel.MapEditor:1828\n              _this.panel.y=_this.panel.height/2+40;\n              //$LASTPOS=40001859;//kernel.MapEditor:1859\n              _this.panel.setFillStyle("cyan");\n              //$LASTPOS=40001891;//kernel.MapEditor:1891\n              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n              //$LASTPOS=40001941;//kernel.MapEditor:1941\n              Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});\n              \n            } else {\n              //$LASTPOS=40002245;//kernel.MapEditor:2245\n              Tonyu.globals.$map=new Tonyu.classes.kernel.Map({chipWidth: 32,chipHeight: 32});\n              //$LASTPOS=40002291;//kernel.MapEditor:2291\n              Tonyu.globals.$map.load(_this.fileName);\n              //$LASTPOS=40002316;//kernel.MapEditor:2316\n              _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});\n              //$LASTPOS=40002411;//kernel.MapEditor:2411\n              _this.panel.x=_this.panel.width/2+40;\n              //$LASTPOS=40002441;//kernel.MapEditor:2441\n              _this.panel.y=_this.panel.height/2+40;\n              //$LASTPOS=40002472;//kernel.MapEditor:2472\n              _this.panel.setFillStyle("cyan");\n              //$LASTPOS=40002504;//kernel.MapEditor:2504\n              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n              \n            }\n            //$LASTPOS=40002552;//kernel.MapEditor:2552\n            Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});\n            //$LASTPOS=40002606;//kernel.MapEditor:2606\n            _this.counter=0;\n            //$LASTPOS=40002617;//kernel.MapEditor:2617\n            //$LASTPOS=40002621;//kernel.MapEditor:2621\n            i = 0;\n            while(i<16) {\n              {\n                //$LASTPOS=40002644;//kernel.MapEditor:2644\n                //$LASTPOS=40002648;//kernel.MapEditor:2648\n                j = 0;\n                while(j<8) {\n                  {\n                    //$LASTPOS=40002674;//kernel.MapEditor:2674\n                    Tonyu.globals.$mp.set(j,i,Tonyu.globals.$pat_mapchip+_this.counter);\n                    //$LASTPOS=40002717;//kernel.MapEditor:2717\n                    _this.counter++;\n                  }\n                  j++;\n                }\n              }\n              i++;\n            }\n            //$LASTPOS=40002736;//kernel.MapEditor:2736\n            _this.fiber$drawPanel(_thread);\n            __pc=13;return;\n          case 13:\n            \n            //$LASTPOS=40002749;//kernel.MapEditor:2749\n            _this.mode="get";\n            //$LASTPOS=40002761;//kernel.MapEditor:2761\n            _this.prevMode="set";\n            //$LASTPOS=40002777;//kernel.MapEditor:2777\n            _this.mapp=0;\n            //$LASTPOS=40002785;//kernel.MapEditor:2785\n            _this.mx=- 40;\n            //$LASTPOS=40002793;//kernel.MapEditor:2793\n            _this.my=- 40;\n            //$LASTPOS=40002801;//kernel.MapEditor:2801\n            _this.chipX=- 40;\n            //$LASTPOS=40002812;//kernel.MapEditor:2812\n            _this.chipY=- 40;\n            //$LASTPOS=40002823;//kernel.MapEditor:2823\n            _this.x=Tonyu.globals.$screenWidth-_this.chipWidth/2;\n            //$LASTPOS=40002851;//kernel.MapEditor:2851\n            _this.y=Tonyu.globals.$screenHeight-_this.chipHeight/2;\n            //$LASTPOS=40002881;//kernel.MapEditor:2881\n            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n            //$LASTPOS=40002903;//kernel.MapEditor:2903\n          case 14:\n            //$LASTPOS=40002920;//kernel.MapEditor:2920\n            _this.p=_this.mapp;\n            //$LASTPOS=40002932;//kernel.MapEditor:2932\n            if (_this.getkey("e")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {\n              //$LASTPOS=40003070;//kernel.MapEditor:3070\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=40003103;//kernel.MapEditor:3103\n              _this.mode="erase";\n              //$LASTPOS=40003125;//kernel.MapEditor:3125\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=40003156;//kernel.MapEditor:3156\n            if (_this.getkey("s")==1) {\n              //$LASTPOS=40003184;//kernel.MapEditor:3184\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=40003217;//kernel.MapEditor:3217\n              if (_this.mode=="set") {\n                //$LASTPOS=40003246;//kernel.MapEditor:3246\n                _this.mode="setOn";\n                \n              } else {\n                //$LASTPOS=40003287;//kernel.MapEditor:3287\n                _this.mode="set";\n                \n              }\n              //$LASTPOS=40003317;//kernel.MapEditor:3317\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=40003348;//kernel.MapEditor:3348\n            if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {\n              //$LASTPOS=40003466;//kernel.MapEditor:3466\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=40003499;//kernel.MapEditor:3499\n              _this.mode="set";\n              //$LASTPOS=40003519;//kernel.MapEditor:3519\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=40003550;//kernel.MapEditor:3550\n            if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {\n              //$LASTPOS=40003670;//kernel.MapEditor:3670\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=40003703;//kernel.MapEditor:3703\n              _this.mode="setOn";\n              //$LASTPOS=40003725;//kernel.MapEditor:3725\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=40003756;//kernel.MapEditor:3756\n            if (_this.getkey("o")==1) {\n              //$LASTPOS=40003784;//kernel.MapEditor:3784\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=40003817;//kernel.MapEditor:3817\n              _this.mode="setOn";\n              \n            }\n            //$LASTPOS=40003841;//kernel.MapEditor:3841\n            if (_this.getkey("g")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>240&&Tonyu.globals.$touches[0].x<360&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {\n              //$LASTPOS=40003981;//kernel.MapEditor:3981\n              if (_this.mode!="get") {\n                //$LASTPOS=40004010;//kernel.MapEditor:4010\n                _this.prevMode=_this.mode;\n                //$LASTPOS=40004037;//kernel.MapEditor:4037\n                Tonyu.globals.$mp.scrollTo(- 40,- 40);\n                //$LASTPOS=40004072;//kernel.MapEditor:4072\n                _this.mode="get";\n                //$LASTPOS=40004096;//kernel.MapEditor:4096\n                _this.chipX=- 40;\n                //$LASTPOS=40004119;//kernel.MapEditor:4119\n                _this.chipY=- 40;\n                \n              } else {\n                //$LASTPOS=40004157;//kernel.MapEditor:4157\n                Tonyu.globals.$mp.scrollTo(1000,1000);\n                //$LASTPOS=40004194;//kernel.MapEditor:4194\n                _this.mode=_this.prevMode;\n                \n              }\n              //$LASTPOS=40004227;//kernel.MapEditor:4227\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=40004258;//kernel.MapEditor:4258\n            if (_this.getkey("p")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>360&&Tonyu.globals.$touches[0].x<480&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {\n              //$LASTPOS=40004412;//kernel.MapEditor:4412\n              _this.saveFileName=prompt("input json file(*.json)","map.json");\n              //$LASTPOS=40004885;//kernel.MapEditor:4885\n              _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);\n              //$LASTPOS=40004942;//kernel.MapEditor:4942\n              _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable,Tonyu.globals.$map.chipWidth,Tonyu.globals.$map.chipHeight];\n              //$LASTPOS=40005084;//kernel.MapEditor:5084\n              _this.saveDataFile.obj(_this.data);\n              //$LASTPOS=40005116;//kernel.MapEditor:5116\n              _this.print(_this.saveFileName+" Saved");\n              \n            }\n            //$LASTPOS=40005205;//kernel.MapEditor:5205\n            if (_this.getkey("c")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {\n              //$LASTPOS=40005345;//kernel.MapEditor:5345\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=40005378;//kernel.MapEditor:5378\n              _this.mode="copy";\n              //$LASTPOS=40005399;//kernel.MapEditor:5399\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=40005430;//kernel.MapEditor:5430\n            if (_this.mode!="get") {\n              //$LASTPOS=40005455;//kernel.MapEditor:5455\n              if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {\n                //$LASTPOS=40005561;//kernel.MapEditor:5561\n                _this.mx=_this.mx+8;\n              }\n              //$LASTPOS=40005578;//kernel.MapEditor:5578\n              if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {\n                //$LASTPOS=40005709;//kernel.MapEditor:5709\n                _this.mx=_this.mx-8;\n              }\n              //$LASTPOS=40005726;//kernel.MapEditor:5726\n              if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {\n                //$LASTPOS=40005839;//kernel.MapEditor:5839\n                _this.my=_this.my+8;\n              }\n              //$LASTPOS=40005856;//kernel.MapEditor:5856\n              if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {\n                //$LASTPOS=40005991;//kernel.MapEditor:5991\n                _this.my=_this.my-8;\n              }\n              //$LASTPOS=40006008;//kernel.MapEditor:6008\n              Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n              \n            } else {\n              //$LASTPOS=40006049;//kernel.MapEditor:6049\n              if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {\n                //$LASTPOS=40006155;//kernel.MapEditor:6155\n                _this.chipX=_this.chipX+8;\n              }\n              //$LASTPOS=40006178;//kernel.MapEditor:6178\n              if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {\n                //$LASTPOS=40006309;//kernel.MapEditor:6309\n                _this.chipX=_this.chipX-8;\n              }\n              //$LASTPOS=40006332;//kernel.MapEditor:6332\n              if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {\n                //$LASTPOS=40006445;//kernel.MapEditor:6445\n                _this.chipY=_this.chipY+8;\n              }\n              //$LASTPOS=40006468;//kernel.MapEditor:6468\n              if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {\n                //$LASTPOS=40006603;//kernel.MapEditor:6603\n                _this.chipY=_this.chipY-8;\n              }\n              //$LASTPOS=40006626;//kernel.MapEditor:6626\n              Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);\n              \n            }\n            //$LASTPOS=40006663;//kernel.MapEditor:6663\n            _this.panel.x=_this.panel.width/2-_this.mx;\n            //$LASTPOS=40006693;//kernel.MapEditor:6693\n            _this.panel.y=_this.panel.height/2-_this.my;\n            //$LASTPOS=40006724;//kernel.MapEditor:6724\n            if (!(_this.mode=="set"&&_this.getkey(1)>0&&_this.inRect())) { __pc=15; break; }\n            {\n              //$LASTPOS=40006776;//kernel.MapEditor:6776\n              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n              //$LASTPOS=40006824;//kernel.MapEditor:6824\n              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n            }\n            __pc=25;break;\n          case 15:\n            //$LASTPOS=40006874;//kernel.MapEditor:6874\n            if (!(_this.mode=="erase"&&_this.getkey(1)>0&&_this.inRect())) { __pc=16; break; }\n            {\n              //$LASTPOS=40006928;//kernel.MapEditor:6928\n              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n            }\n            __pc=24;break;\n          case 16:\n            //$LASTPOS=40006976;//kernel.MapEditor:6976\n            if (!(_this.mode=="get"&&_this.getkey(1)>0&&_this.inRect())) { __pc=18; break; }\n            //$LASTPOS=40007028;//kernel.MapEditor:7028\n            _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);\n            //$LASTPOS=40007081;//kernel.MapEditor:7081\n            _this.mode=_this.prevMode;\n            //$LASTPOS=40007104;//kernel.MapEditor:7104\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=40007137;//kernel.MapEditor:7137\n            _this.print(_this.mode+" mode");\n            //$LASTPOS=40007166;//kernel.MapEditor:7166\n            _this.fiber$updateEx(_thread, 10);\n            __pc=17;return;\n          case 17:\n            \n            __pc=23;break;\n          case 18:\n            //$LASTPOS=40007190;//kernel.MapEditor:7190\n            if (!(_this.mode=="setOn"&&_this.getkey(1)>0&&_this.inRect())) { __pc=19; break; }\n            {\n              //$LASTPOS=40007244;//kernel.MapEditor:7244\n              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n            }\n            __pc=22;break;\n          case 19:\n            //$LASTPOS=40007296;//kernel.MapEditor:7296\n            if (!(_this.mode=="copy"&&_this.getkey(1)>0&&_this.inRect())) { __pc=21; break; }\n            //$LASTPOS=40007349;//kernel.MapEditor:7349\n            _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);\n            //$LASTPOS=40007397;//kernel.MapEditor:7397\n            _this.mode="set";\n            //$LASTPOS=40007417;//kernel.MapEditor:7417\n            _this.print(_this.mode+" mode");\n            //$LASTPOS=40007446;//kernel.MapEditor:7446\n            _this.fiber$updateEx(_thread, 10);\n            __pc=20;return;\n          case 20:\n            \n          case 21:\n            \n          case 22:\n            \n          case 23:\n            \n          case 24:\n            \n          case 25:\n            \n            //$LASTPOS=40007470;//kernel.MapEditor:7470\n            _this.fiber$update(_thread);\n            __pc=26;return;\n          case 26:\n            \n            __pc=14;break;\n          case 27:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    inRect :function _trc_MapEditor_inRect() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.globals.$mouseX>40&&Tonyu.globals.$mouseX<Tonyu.globals.$screenWidth-40&&Tonyu.globals.$mouseY>40&&Tonyu.globals.$mouseY<Tonyu.globals.$screenHeight-200;\n    },\n    fiber$inRect :function _trc_MapEditor_f_inRect(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=Tonyu.globals.$mouseX>40&&Tonyu.globals.$mouseX<Tonyu.globals.$screenWidth-40&&Tonyu.globals.$mouseY>40&&Tonyu.globals.$mouseY<Tonyu.globals.$screenHeight-200;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    drawPanel :function _trc_MapEditor_drawPanel() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=40007635;//kernel.MapEditor:7635\n      Tonyu.globals.$panel.setFillStyle("gray");\n      //$LASTPOS=40007668;//kernel.MapEditor:7668\n      Tonyu.globals.$panel.alpha=128;\n      //$LASTPOS=40007690;//kernel.MapEditor:7690\n      Tonyu.globals.$panel.fillRect(0,0,Tonyu.globals.$screenWidth,40);\n      //$LASTPOS=40007732;//kernel.MapEditor:7732\n      Tonyu.globals.$panel.fillRect(0,0,40,Tonyu.globals.$screenHeight-160);\n      //$LASTPOS=40007779;//kernel.MapEditor:7779\n      Tonyu.globals.$panel.fillRect(Tonyu.globals.$screenWidth-40,0,40,Tonyu.globals.$screenHeight-160);\n      //$LASTPOS=40007840;//kernel.MapEditor:7840\n      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-200,Tonyu.globals.$screenWidth,40);\n      //$LASTPOS=40007898;//kernel.MapEditor:7898\n      Tonyu.globals.$panel.alpha=255;\n      //$LASTPOS=40007920;//kernel.MapEditor:7920\n      Tonyu.globals.$panel.setFillStyle("black");\n      //$LASTPOS=40007972;//kernel.MapEditor:7972\n      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-160,120,80);\n      //$LASTPOS=40008021;//kernel.MapEditor:8021\n      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-160,120,80);\n      //$LASTPOS=40008072;//kernel.MapEditor:8072\n      Tonyu.globals.$panel.fillRect(240,Tonyu.globals.$screenHeight-160,120,80);\n      //$LASTPOS=40008123;//kernel.MapEditor:8123\n      Tonyu.globals.$panel.fillRect(360,Tonyu.globals.$screenHeight-160,120,80);\n      //$LASTPOS=40008174;//kernel.MapEditor:8174\n      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-80,120,80);\n      //$LASTPOS=40008222;//kernel.MapEditor:8222\n      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-80,120,80);\n      //$LASTPOS=40008272;//kernel.MapEditor:8272\n      Tonyu.globals.$panel.setFillStyle("white");\n      //$LASTPOS=40008306;//kernel.MapEditor:8306\n      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-150,100,60);\n      //$LASTPOS=40008356;//kernel.MapEditor:8356\n      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-150,100,60);\n      //$LASTPOS=40008407;//kernel.MapEditor:8407\n      Tonyu.globals.$panel.fillRect(250,Tonyu.globals.$screenHeight-150,100,60);\n      //$LASTPOS=40008458;//kernel.MapEditor:8458\n      Tonyu.globals.$panel.fillRect(370,Tonyu.globals.$screenHeight-150,100,60);\n      //$LASTPOS=40008509;//kernel.MapEditor:8509\n      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-70,100,60);\n      //$LASTPOS=40008558;//kernel.MapEditor:8558\n      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-70,100,60);\n      //$LASTPOS=40008608;//kernel.MapEditor:8608\n      Tonyu.globals.$panel.setFillStyle("black");\n      //$LASTPOS=40008652;//kernel.MapEditor:8652\n      Tonyu.globals.$panel.fillText("▲",Tonyu.globals.$screenWidth/2,30,40,"center");\n      //$LASTPOS=40008708;//kernel.MapEditor:8708\n      Tonyu.globals.$panel.fillText("◀",20,(Tonyu.globals.$screenHeight-200)/2,40,"center");\n      //$LASTPOS=40008771;//kernel.MapEditor:8771\n      Tonyu.globals.$panel.fillText("▼",Tonyu.globals.$screenWidth/2,Tonyu.globals.$screenHeight-160-10,40,"center");\n      //$LASTPOS=40008845;//kernel.MapEditor:8845\n      Tonyu.globals.$panel.fillText("▶",Tonyu.globals.$screenWidth-20,(Tonyu.globals.$screenHeight-200)/2,40,"center");\n      //$LASTPOS=40008948;//kernel.MapEditor:8948\n      Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");\n      //$LASTPOS=40009024;//kernel.MapEditor:9024\n      Tonyu.globals.$panel.fillText("setOn",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");\n      //$LASTPOS=40009102;//kernel.MapEditor:9102\n      Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");\n      //$LASTPOS=40009178;//kernel.MapEditor:9178\n      Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");\n      //$LASTPOS=40009253;//kernel.MapEditor:9253\n      Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");\n      //$LASTPOS=40009330;//kernel.MapEditor:9330\n      Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");\n    },\n    fiber$drawPanel :function _trc_MapEditor_f_drawPanel(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=40007635;//kernel.MapEditor:7635\n      Tonyu.globals.$panel.setFillStyle("gray");\n      //$LASTPOS=40007668;//kernel.MapEditor:7668\n      Tonyu.globals.$panel.alpha=128;\n      //$LASTPOS=40007690;//kernel.MapEditor:7690\n      Tonyu.globals.$panel.fillRect(0,0,Tonyu.globals.$screenWidth,40);\n      //$LASTPOS=40007732;//kernel.MapEditor:7732\n      Tonyu.globals.$panel.fillRect(0,0,40,Tonyu.globals.$screenHeight-160);\n      //$LASTPOS=40007779;//kernel.MapEditor:7779\n      Tonyu.globals.$panel.fillRect(Tonyu.globals.$screenWidth-40,0,40,Tonyu.globals.$screenHeight-160);\n      //$LASTPOS=40007840;//kernel.MapEditor:7840\n      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-200,Tonyu.globals.$screenWidth,40);\n      //$LASTPOS=40007898;//kernel.MapEditor:7898\n      Tonyu.globals.$panel.alpha=255;\n      //$LASTPOS=40007920;//kernel.MapEditor:7920\n      Tonyu.globals.$panel.setFillStyle("black");\n      //$LASTPOS=40007972;//kernel.MapEditor:7972\n      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-160,120,80);\n      //$LASTPOS=40008021;//kernel.MapEditor:8021\n      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-160,120,80);\n      //$LASTPOS=40008072;//kernel.MapEditor:8072\n      Tonyu.globals.$panel.fillRect(240,Tonyu.globals.$screenHeight-160,120,80);\n      //$LASTPOS=40008123;//kernel.MapEditor:8123\n      Tonyu.globals.$panel.fillRect(360,Tonyu.globals.$screenHeight-160,120,80);\n      //$LASTPOS=40008174;//kernel.MapEditor:8174\n      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-80,120,80);\n      //$LASTPOS=40008222;//kernel.MapEditor:8222\n      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-80,120,80);\n      //$LASTPOS=40008272;//kernel.MapEditor:8272\n      Tonyu.globals.$panel.setFillStyle("white");\n      //$LASTPOS=40008306;//kernel.MapEditor:8306\n      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-150,100,60);\n      //$LASTPOS=40008356;//kernel.MapEditor:8356\n      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-150,100,60);\n      //$LASTPOS=40008407;//kernel.MapEditor:8407\n      Tonyu.globals.$panel.fillRect(250,Tonyu.globals.$screenHeight-150,100,60);\n      //$LASTPOS=40008458;//kernel.MapEditor:8458\n      Tonyu.globals.$panel.fillRect(370,Tonyu.globals.$screenHeight-150,100,60);\n      //$LASTPOS=40008509;//kernel.MapEditor:8509\n      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-70,100,60);\n      //$LASTPOS=40008558;//kernel.MapEditor:8558\n      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-70,100,60);\n      //$LASTPOS=40008608;//kernel.MapEditor:8608\n      Tonyu.globals.$panel.setFillStyle("black");\n      //$LASTPOS=40008652;//kernel.MapEditor:8652\n      Tonyu.globals.$panel.fillText("▲",Tonyu.globals.$screenWidth/2,30,40,"center");\n      //$LASTPOS=40008708;//kernel.MapEditor:8708\n      Tonyu.globals.$panel.fillText("◀",20,(Tonyu.globals.$screenHeight-200)/2,40,"center");\n      //$LASTPOS=40008771;//kernel.MapEditor:8771\n      Tonyu.globals.$panel.fillText("▼",Tonyu.globals.$screenWidth/2,Tonyu.globals.$screenHeight-160-10,40,"center");\n      //$LASTPOS=40008845;//kernel.MapEditor:8845\n      Tonyu.globals.$panel.fillText("▶",Tonyu.globals.$screenWidth-20,(Tonyu.globals.$screenHeight-200)/2,40,"center");\n      //$LASTPOS=40008948;//kernel.MapEditor:8948\n      Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");\n      //$LASTPOS=40009024;//kernel.MapEditor:9024\n      Tonyu.globals.$panel.fillText("setOn",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");\n      //$LASTPOS=40009102;//kernel.MapEditor:9102\n      Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");\n      //$LASTPOS=40009178;//kernel.MapEditor:9178\n      Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");\n      //$LASTPOS=40009253;//kernel.MapEditor:9253\n      Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");\n      //$LASTPOS=40009330;//kernel.MapEditor:9330\n      Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"inRect":{"nowait":false},"drawPanel":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.MapEditorOLD\',\n  shortName: \'MapEditorOLD\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_MapEditorOLD_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var j;\n      \n      //$LASTPOS=41000032;//kernel.MapEditorOLD:32\n      _this.loadMode=false;\n      //$LASTPOS=41000049;//kernel.MapEditorOLD:49\n      _this.print("Load Data?: Y or N");\n      //$LASTPOS=41000079;//kernel.MapEditorOLD:79\n      while (true) {\n        //$LASTPOS=41000097;//kernel.MapEditorOLD:97\n        if (_this.getkey("y")>0) {\n          //$LASTPOS=41000125;//kernel.MapEditorOLD:125\n          _this.loadMode=true;\n          break;\n          \n          \n        }\n        //$LASTPOS=41000168;//kernel.MapEditorOLD:168\n        if (_this.getkey("n")>0) {\n          //$LASTPOS=41000196;//kernel.MapEditorOLD:196\n          _this.loadMode=false;\n          break;\n          \n          \n        }\n        //$LASTPOS=41000240;//kernel.MapEditorOLD:240\n        _this.update();\n        \n      }\n      //$LASTPOS=41000254;//kernel.MapEditorOLD:254\n      if (_this.loadMode) {\n        //$LASTPOS=41000273;//kernel.MapEditorOLD:273\n        _this.fileName=prompt("Input json file (*.json)","map.json");\n        //$LASTPOS=41000334;//kernel.MapEditorOLD:334\n        if (_this.fileName) {\n          //$LASTPOS=41000357;//kernel.MapEditorOLD:357\n          _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);\n          \n        }\n        //$LASTPOS=41000413;//kernel.MapEditorOLD:413\n        if (_this.mapDataFile.obj()) {\n          //$LASTPOS=41000445;//kernel.MapEditorOLD:445\n          _this.baseData=_this.mapDataFile.obj();\n          \n        } else {\n          //$LASTPOS=41000494;//kernel.MapEditorOLD:494\n          _this.mapDataFile=_this.file(_this.fileName);\n          //$LASTPOS=41000531;//kernel.MapEditorOLD:531\n          if (_this.mapDataFile.obj()) {\n            //$LASTPOS=41000567;//kernel.MapEditorOLD:567\n            _this.baseData=_this.mapDataFile.obj();\n            \n          }\n          \n        }\n        //$LASTPOS=41000618;//kernel.MapEditorOLD:618\n        if (_this.baseData==undefined) {\n          //$LASTPOS=41000652;//kernel.MapEditorOLD:652\n          _this.print("Load failed");\n          //$LASTPOS=41000683;//kernel.MapEditorOLD:683\n          _this.loadMode=false;\n          \n        } else {\n          //$LASTPOS=41000710;//kernel.MapEditorOLD:710\n          if (_this.baseData[0]&&_this.baseData[1]) {\n            //$LASTPOS=41000751;//kernel.MapEditorOLD:751\n            _this.mapData=_this.baseData[0];\n            //$LASTPOS=41000781;//kernel.MapEditorOLD:781\n            _this.mapOnData=_this.baseData[1];\n            \n          }\n        }\n        \n      }\n      //$LASTPOS=41000815;//kernel.MapEditorOLD:815\n      _this.update();\n      //$LASTPOS=41001093;//kernel.MapEditorOLD:1093\n      if (! _this.loadMode) {\n        //$LASTPOS=41001113;//kernel.MapEditorOLD:1113\n        _this.row=prompt("input row");\n        //$LASTPOS=41001143;//kernel.MapEditorOLD:1143\n        _this.update();\n        //$LASTPOS=41001158;//kernel.MapEditorOLD:1158\n        _this.col=prompt("input col");\n        //$LASTPOS=41001188;//kernel.MapEditorOLD:1188\n        _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});\n        //$LASTPOS=41001238;//kernel.MapEditorOLD:1238\n        _this.panel.x=_this.panel.width/2+10;\n        //$LASTPOS=41001269;//kernel.MapEditorOLD:1269\n        _this.panel.y=_this.panel.height/2;\n        //$LASTPOS=41001298;//kernel.MapEditorOLD:1298\n        _this.panel.setFillStyle("cyan");\n        //$LASTPOS=41001331;//kernel.MapEditorOLD:1331\n        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n        //$LASTPOS=41001382;//kernel.MapEditorOLD:1382\n        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});\n        \n      } else {\n        //$LASTPOS=41001445;//kernel.MapEditorOLD:1445\n        if (! _this.mapOnData) {\n          //$LASTPOS=41001470;//kernel.MapEditorOLD:1470\n          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});\n          \n        } else {\n          //$LASTPOS=41001582;//kernel.MapEditorOLD:1582\n          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});\n          \n        }\n        //$LASTPOS=41001695;//kernel.MapEditorOLD:1695\n        _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});\n        //$LASTPOS=41001766;//kernel.MapEditorOLD:1766\n        _this.panel.x=_this.panel.width/2;\n        //$LASTPOS=41001794;//kernel.MapEditorOLD:1794\n        _this.panel.y=_this.panel.height/2;\n        //$LASTPOS=41001823;//kernel.MapEditorOLD:1823\n        _this.panel.setFillStyle("cyan");\n        //$LASTPOS=41001856;//kernel.MapEditorOLD:1856\n        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n        \n      }\n      //$LASTPOS=41001906;//kernel.MapEditorOLD:1906\n      Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});\n      //$LASTPOS=41001961;//kernel.MapEditorOLD:1961\n      _this.counter=0;\n      //$LASTPOS=41001973;//kernel.MapEditorOLD:1973\n      //$LASTPOS=41001977;//kernel.MapEditorOLD:1977\n      i = 0;\n      while(i<16) {\n        {\n          //$LASTPOS=41002001;//kernel.MapEditorOLD:2001\n          //$LASTPOS=41002005;//kernel.MapEditorOLD:2005\n          j = 0;\n          while(j<8) {\n            {\n              //$LASTPOS=41002032;//kernel.MapEditorOLD:2032\n              Tonyu.globals.$mp.set(j,i,Tonyu.globals.$pat_mapchip+_this.counter);\n              //$LASTPOS=41002076;//kernel.MapEditorOLD:2076\n              _this.counter++;\n            }\n            j++;\n          }\n        }\n        i++;\n      }\n      //$LASTPOS=41002098;//kernel.MapEditorOLD:2098\n      _this.mode="get";\n      //$LASTPOS=41002111;//kernel.MapEditorOLD:2111\n      _this.prevMode="set";\n      //$LASTPOS=41002128;//kernel.MapEditorOLD:2128\n      _this.mapp=0;\n      //$LASTPOS=41002137;//kernel.MapEditorOLD:2137\n      _this.mx=0;\n      //$LASTPOS=41002144;//kernel.MapEditorOLD:2144\n      _this.my=0;\n      //$LASTPOS=41002151;//kernel.MapEditorOLD:2151\n      _this.chipX=0;\n      //$LASTPOS=41002161;//kernel.MapEditorOLD:2161\n      _this.chipY=0;\n      //$LASTPOS=41002171;//kernel.MapEditorOLD:2171\n      _this.x=Tonyu.globals.$screenWidth-16;\n      //$LASTPOS=41002191;//kernel.MapEditorOLD:2191\n      _this.y=Tonyu.globals.$screenHeight-16;\n      //$LASTPOS=41002212;//kernel.MapEditorOLD:2212\n      while (true) {\n        //$LASTPOS=41002230;//kernel.MapEditorOLD:2230\n        _this.p=_this.mapp;\n        //$LASTPOS=41002243;//kernel.MapEditorOLD:2243\n        if (_this.getkey("e")==1) {\n          //$LASTPOS=41002272;//kernel.MapEditorOLD:2272\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=41002306;//kernel.MapEditorOLD:2306\n          _this.mode="erase";\n          //$LASTPOS=41002329;//kernel.MapEditorOLD:2329\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=41002362;//kernel.MapEditorOLD:2362\n        if (_this.getkey("s")==1) {\n          //$LASTPOS=41002391;//kernel.MapEditorOLD:2391\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=41002425;//kernel.MapEditorOLD:2425\n          if (_this.mode=="set") {\n            //$LASTPOS=41002455;//kernel.MapEditorOLD:2455\n            _this.mode="setOn";\n            \n          } else {\n            //$LASTPOS=41002498;//kernel.MapEditorOLD:2498\n            _this.mode="set";\n            \n          }\n          //$LASTPOS=41002530;//kernel.MapEditorOLD:2530\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=41002563;//kernel.MapEditorOLD:2563\n        if (_this.getkey("o")==1) {\n          //$LASTPOS=41002592;//kernel.MapEditorOLD:2592\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=41002626;//kernel.MapEditorOLD:2626\n          _this.mode="setOn";\n          \n        }\n        //$LASTPOS=41002652;//kernel.MapEditorOLD:2652\n        if (_this.getkey("g")==1) {\n          //$LASTPOS=41002681;//kernel.MapEditorOLD:2681\n          if (_this.mode!="get") {\n            //$LASTPOS=41002711;//kernel.MapEditorOLD:2711\n            _this.prevMode=_this.mode;\n            //$LASTPOS=41002739;//kernel.MapEditorOLD:2739\n            Tonyu.globals.$mp.scrollTo(0,0);\n            //$LASTPOS=41002771;//kernel.MapEditorOLD:2771\n            _this.mode="get";\n            //$LASTPOS=41002796;//kernel.MapEditorOLD:2796\n            _this.chipX=0;\n            //$LASTPOS=41002818;//kernel.MapEditorOLD:2818\n            _this.chipY=0;\n            \n          } else {\n            //$LASTPOS=41002856;//kernel.MapEditorOLD:2856\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=41002894;//kernel.MapEditorOLD:2894\n            _this.mode=_this.prevMode;\n            \n          }\n          //$LASTPOS=41002929;//kernel.MapEditorOLD:2929\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=41002962;//kernel.MapEditorOLD:2962\n        if (_this.getkey("p")==1) {\n          //$LASTPOS=41003006;//kernel.MapEditorOLD:3006\n          _this.saveFileName=prompt("input json file(*.json)","map.json");\n          //$LASTPOS=41003495;//kernel.MapEditorOLD:3495\n          _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);\n          //$LASTPOS=41003553;//kernel.MapEditorOLD:3553\n          _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];\n          //$LASTPOS=41003668;//kernel.MapEditorOLD:3668\n          _this.saveDataFile.obj(_this.data);\n          //$LASTPOS=41003701;//kernel.MapEditorOLD:3701\n          _this.print(_this.saveFileName+" Saved");\n          \n        }\n        //$LASTPOS=41003793;//kernel.MapEditorOLD:3793\n        if (_this.getkey("c")==1) {\n          //$LASTPOS=41003822;//kernel.MapEditorOLD:3822\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=41003856;//kernel.MapEditorOLD:3856\n          _this.mode="spuit";\n          //$LASTPOS=41003879;//kernel.MapEditorOLD:3879\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=41003912;//kernel.MapEditorOLD:3912\n        if (_this.mode!="get") {\n          //$LASTPOS=41003938;//kernel.MapEditorOLD:3938\n          if (_this.getkey("left")>0) {\n            //$LASTPOS=41003959;//kernel.MapEditorOLD:3959\n            _this.mx=_this.mx+8;\n          }\n          //$LASTPOS=41003977;//kernel.MapEditorOLD:3977\n          if (_this.getkey("right")>0) {\n            //$LASTPOS=41003999;//kernel.MapEditorOLD:3999\n            _this.mx=_this.mx-8;\n          }\n          //$LASTPOS=41004017;//kernel.MapEditorOLD:4017\n          if (_this.getkey("up")>0) {\n            //$LASTPOS=41004036;//kernel.MapEditorOLD:4036\n            _this.my=_this.my+8;\n          }\n          //$LASTPOS=41004054;//kernel.MapEditorOLD:4054\n          if (_this.getkey("down")>0) {\n            //$LASTPOS=41004075;//kernel.MapEditorOLD:4075\n            _this.my=_this.my-8;\n          }\n          //$LASTPOS=41004093;//kernel.MapEditorOLD:4093\n          Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n          \n        } else {\n          //$LASTPOS=41004136;//kernel.MapEditorOLD:4136\n          if (_this.getkey("left")>0) {\n            //$LASTPOS=41004157;//kernel.MapEditorOLD:4157\n            _this.chipX=_this.chipX+8;\n          }\n          //$LASTPOS=41004181;//kernel.MapEditorOLD:4181\n          if (_this.getkey("right")>0) {\n            //$LASTPOS=41004203;//kernel.MapEditorOLD:4203\n            _this.chipX=_this.chipX-8;\n          }\n          //$LASTPOS=41004227;//kernel.MapEditorOLD:4227\n          if (_this.getkey("up")>0) {\n            //$LASTPOS=41004246;//kernel.MapEditorOLD:4246\n            _this.chipY=_this.chipY+8;\n          }\n          //$LASTPOS=41004270;//kernel.MapEditorOLD:4270\n          if (_this.getkey("down")>0) {\n            //$LASTPOS=41004291;//kernel.MapEditorOLD:4291\n            _this.chipY=_this.chipY-8;\n          }\n          //$LASTPOS=41004315;//kernel.MapEditorOLD:4315\n          Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);\n          \n        }\n        //$LASTPOS=41004354;//kernel.MapEditorOLD:4354\n        _this.panel.x=_this.panel.width/2-_this.mx;\n        //$LASTPOS=41004385;//kernel.MapEditorOLD:4385\n        _this.panel.y=_this.panel.height/2-_this.my;\n        //$LASTPOS=41004417;//kernel.MapEditorOLD:4417\n        if (_this.mode=="set"&&_this.getkey(1)>0) {\n          //$LASTPOS=41004458;//kernel.MapEditorOLD:4458\n          Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n          //$LASTPOS=41004507;//kernel.MapEditorOLD:4507\n          Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n          \n        } else {\n          //$LASTPOS=41004558;//kernel.MapEditorOLD:4558\n          if (_this.mode=="erase"&&_this.getkey(1)>0) {\n            //$LASTPOS=41004601;//kernel.MapEditorOLD:4601\n            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n            \n          } else {\n            //$LASTPOS=41004650;//kernel.MapEditorOLD:4650\n            if (_this.mode=="get"&&_this.getkey(1)>0) {\n              //$LASTPOS=41004691;//kernel.MapEditorOLD:4691\n              _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);\n              //$LASTPOS=41004745;//kernel.MapEditorOLD:4745\n              _this.mode=_this.prevMode;\n              //$LASTPOS=41004769;//kernel.MapEditorOLD:4769\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=41004803;//kernel.MapEditorOLD:4803\n              _this.print(_this.mode+" mode");\n              //$LASTPOS=41004833;//kernel.MapEditorOLD:4833\n              _this.updateEx(10);\n              \n            } else {\n              //$LASTPOS=41004858;//kernel.MapEditorOLD:4858\n              if (_this.mode=="setOn"&&_this.getkey(1)>0) {\n                //$LASTPOS=41004901;//kernel.MapEditorOLD:4901\n                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n                \n              } else {\n                //$LASTPOS=41004954;//kernel.MapEditorOLD:4954\n                if (_this.mode=="spuit"&&_this.getkey(1)>0) {\n                  //$LASTPOS=41004997;//kernel.MapEditorOLD:4997\n                  _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);\n                  //$LASTPOS=41005046;//kernel.MapEditorOLD:5046\n                  _this.mode="set";\n                  //$LASTPOS=41005067;//kernel.MapEditorOLD:5067\n                  _this.print(_this.mode+" mode");\n                  //$LASTPOS=41005097;//kernel.MapEditorOLD:5097\n                  _this.updateEx(10);\n                  \n                }\n              }\n            }\n          }\n        }\n        //$LASTPOS=41005123;//kernel.MapEditorOLD:5123\n        _this.update();\n        \n      }\n    },\n    fiber$main :function _trc_MapEditorOLD_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var j;\n      \n      //$LASTPOS=41000032;//kernel.MapEditorOLD:32\n      _this.loadMode=false;\n      //$LASTPOS=41000049;//kernel.MapEditorOLD:49\n      _this.print("Load Data?: Y or N");\n      \n      _thread.enter(function _trc_MapEditorOLD_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=41000079;//kernel.MapEditorOLD:79\n          case 1:\n            //$LASTPOS=41000097;//kernel.MapEditorOLD:97\n            if (!(_this.getkey("y")>0)) { __pc=2; break; }\n            //$LASTPOS=41000125;//kernel.MapEditorOLD:125\n            _this.loadMode=true;\n            __pc=5; break;\n            \n          case 2:\n            \n            //$LASTPOS=41000168;//kernel.MapEditorOLD:168\n            if (!(_this.getkey("n")>0)) { __pc=3; break; }\n            //$LASTPOS=41000196;//kernel.MapEditorOLD:196\n            _this.loadMode=false;\n            __pc=5; break;\n            \n          case 3:\n            \n            //$LASTPOS=41000240;//kernel.MapEditorOLD:240\n            _this.fiber$update(_thread);\n            __pc=4;return;\n          case 4:\n            \n            __pc=1;break;\n          case 5:\n            \n            //$LASTPOS=41000254;//kernel.MapEditorOLD:254\n            if (!(_this.loadMode)) { __pc=9; break; }\n            //$LASTPOS=41000273;//kernel.MapEditorOLD:273\n            _this.fileName=prompt("Input json file (*.json)","map.json");\n            //$LASTPOS=41000334;//kernel.MapEditorOLD:334\n            if (_this.fileName) {\n              //$LASTPOS=41000357;//kernel.MapEditorOLD:357\n              _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);\n              \n            }\n            //$LASTPOS=41000413;//kernel.MapEditorOLD:413\n            if (!(_this.mapDataFile.obj())) { __pc=6; break; }\n            {\n              //$LASTPOS=41000445;//kernel.MapEditorOLD:445\n              _this.baseData=_this.mapDataFile.obj();\n            }\n            __pc=8;break;\n          case 6:\n            //$LASTPOS=41000494;//kernel.MapEditorOLD:494\n            _this.fiber$file(_thread, _this.fileName);\n            __pc=7;return;\n          case 7:\n            _this.mapDataFile=_thread.retVal;\n            \n            //$LASTPOS=41000531;//kernel.MapEditorOLD:531\n            if (_this.mapDataFile.obj()) {\n              //$LASTPOS=41000567;//kernel.MapEditorOLD:567\n              _this.baseData=_this.mapDataFile.obj();\n              \n            }\n          case 8:\n            \n            //$LASTPOS=41000618;//kernel.MapEditorOLD:618\n            if (_this.baseData==undefined) {\n              //$LASTPOS=41000652;//kernel.MapEditorOLD:652\n              _this.print("Load failed");\n              //$LASTPOS=41000683;//kernel.MapEditorOLD:683\n              _this.loadMode=false;\n              \n            } else {\n              //$LASTPOS=41000710;//kernel.MapEditorOLD:710\n              if (_this.baseData[0]&&_this.baseData[1]) {\n                //$LASTPOS=41000751;//kernel.MapEditorOLD:751\n                _this.mapData=_this.baseData[0];\n                //$LASTPOS=41000781;//kernel.MapEditorOLD:781\n                _this.mapOnData=_this.baseData[1];\n                \n              }\n            }\n          case 9:\n            \n            //$LASTPOS=41000815;//kernel.MapEditorOLD:815\n            _this.fiber$update(_thread);\n            __pc=10;return;\n          case 10:\n            \n            //$LASTPOS=41001093;//kernel.MapEditorOLD:1093\n            if (!(! _this.loadMode)) { __pc=12; break; }\n            //$LASTPOS=41001113;//kernel.MapEditorOLD:1113\n            _this.row=prompt("input row");\n            //$LASTPOS=41001143;//kernel.MapEditorOLD:1143\n            _this.fiber$update(_thread);\n            __pc=11;return;\n          case 11:\n            \n            //$LASTPOS=41001158;//kernel.MapEditorOLD:1158\n            _this.col=prompt("input col");\n            //$LASTPOS=41001188;//kernel.MapEditorOLD:1188\n            _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});\n            //$LASTPOS=41001238;//kernel.MapEditorOLD:1238\n            _this.panel.x=_this.panel.width/2+10;\n            //$LASTPOS=41001269;//kernel.MapEditorOLD:1269\n            _this.panel.y=_this.panel.height/2;\n            //$LASTPOS=41001298;//kernel.MapEditorOLD:1298\n            _this.panel.setFillStyle("cyan");\n            //$LASTPOS=41001331;//kernel.MapEditorOLD:1331\n            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n            //$LASTPOS=41001382;//kernel.MapEditorOLD:1382\n            Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});\n            __pc=13;break;\n          case 12:\n            {\n              //$LASTPOS=41001445;//kernel.MapEditorOLD:1445\n              if (! _this.mapOnData) {\n                //$LASTPOS=41001470;//kernel.MapEditorOLD:1470\n                Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});\n                \n              } else {\n                //$LASTPOS=41001582;//kernel.MapEditorOLD:1582\n                Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});\n                \n              }\n              //$LASTPOS=41001695;//kernel.MapEditorOLD:1695\n              _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});\n              //$LASTPOS=41001766;//kernel.MapEditorOLD:1766\n              _this.panel.x=_this.panel.width/2;\n              //$LASTPOS=41001794;//kernel.MapEditorOLD:1794\n              _this.panel.y=_this.panel.height/2;\n              //$LASTPOS=41001823;//kernel.MapEditorOLD:1823\n              _this.panel.setFillStyle("cyan");\n              //$LASTPOS=41001856;//kernel.MapEditorOLD:1856\n              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n            }\n          case 13:\n            \n            //$LASTPOS=41001906;//kernel.MapEditorOLD:1906\n            Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});\n            //$LASTPOS=41001961;//kernel.MapEditorOLD:1961\n            _this.counter=0;\n            //$LASTPOS=41001973;//kernel.MapEditorOLD:1973\n            //$LASTPOS=41001977;//kernel.MapEditorOLD:1977\n            i = 0;\n            while(i<16) {\n              {\n                //$LASTPOS=41002001;//kernel.MapEditorOLD:2001\n                //$LASTPOS=41002005;//kernel.MapEditorOLD:2005\n                j = 0;\n                while(j<8) {\n                  {\n                    //$LASTPOS=41002032;//kernel.MapEditorOLD:2032\n                    Tonyu.globals.$mp.set(j,i,Tonyu.globals.$pat_mapchip+_this.counter);\n                    //$LASTPOS=41002076;//kernel.MapEditorOLD:2076\n                    _this.counter++;\n                  }\n                  j++;\n                }\n              }\n              i++;\n            }\n            //$LASTPOS=41002098;//kernel.MapEditorOLD:2098\n            _this.mode="get";\n            //$LASTPOS=41002111;//kernel.MapEditorOLD:2111\n            _this.prevMode="set";\n            //$LASTPOS=41002128;//kernel.MapEditorOLD:2128\n            _this.mapp=0;\n            //$LASTPOS=41002137;//kernel.MapEditorOLD:2137\n            _this.mx=0;\n            //$LASTPOS=41002144;//kernel.MapEditorOLD:2144\n            _this.my=0;\n            //$LASTPOS=41002151;//kernel.MapEditorOLD:2151\n            _this.chipX=0;\n            //$LASTPOS=41002161;//kernel.MapEditorOLD:2161\n            _this.chipY=0;\n            //$LASTPOS=41002171;//kernel.MapEditorOLD:2171\n            _this.x=Tonyu.globals.$screenWidth-16;\n            //$LASTPOS=41002191;//kernel.MapEditorOLD:2191\n            _this.y=Tonyu.globals.$screenHeight-16;\n            //$LASTPOS=41002212;//kernel.MapEditorOLD:2212\n          case 14:\n            //$LASTPOS=41002230;//kernel.MapEditorOLD:2230\n            _this.p=_this.mapp;\n            //$LASTPOS=41002243;//kernel.MapEditorOLD:2243\n            if (_this.getkey("e")==1) {\n              //$LASTPOS=41002272;//kernel.MapEditorOLD:2272\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=41002306;//kernel.MapEditorOLD:2306\n              _this.mode="erase";\n              //$LASTPOS=41002329;//kernel.MapEditorOLD:2329\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=41002362;//kernel.MapEditorOLD:2362\n            if (_this.getkey("s")==1) {\n              //$LASTPOS=41002391;//kernel.MapEditorOLD:2391\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=41002425;//kernel.MapEditorOLD:2425\n              if (_this.mode=="set") {\n                //$LASTPOS=41002455;//kernel.MapEditorOLD:2455\n                _this.mode="setOn";\n                \n              } else {\n                //$LASTPOS=41002498;//kernel.MapEditorOLD:2498\n                _this.mode="set";\n                \n              }\n              //$LASTPOS=41002530;//kernel.MapEditorOLD:2530\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=41002563;//kernel.MapEditorOLD:2563\n            if (_this.getkey("o")==1) {\n              //$LASTPOS=41002592;//kernel.MapEditorOLD:2592\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=41002626;//kernel.MapEditorOLD:2626\n              _this.mode="setOn";\n              \n            }\n            //$LASTPOS=41002652;//kernel.MapEditorOLD:2652\n            if (_this.getkey("g")==1) {\n              //$LASTPOS=41002681;//kernel.MapEditorOLD:2681\n              if (_this.mode!="get") {\n                //$LASTPOS=41002711;//kernel.MapEditorOLD:2711\n                _this.prevMode=_this.mode;\n                //$LASTPOS=41002739;//kernel.MapEditorOLD:2739\n                Tonyu.globals.$mp.scrollTo(0,0);\n                //$LASTPOS=41002771;//kernel.MapEditorOLD:2771\n                _this.mode="get";\n                //$LASTPOS=41002796;//kernel.MapEditorOLD:2796\n                _this.chipX=0;\n                //$LASTPOS=41002818;//kernel.MapEditorOLD:2818\n                _this.chipY=0;\n                \n              } else {\n                //$LASTPOS=41002856;//kernel.MapEditorOLD:2856\n                Tonyu.globals.$mp.scrollTo(1000,1000);\n                //$LASTPOS=41002894;//kernel.MapEditorOLD:2894\n                _this.mode=_this.prevMode;\n                \n              }\n              //$LASTPOS=41002929;//kernel.MapEditorOLD:2929\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=41002962;//kernel.MapEditorOLD:2962\n            if (_this.getkey("p")==1) {\n              //$LASTPOS=41003006;//kernel.MapEditorOLD:3006\n              _this.saveFileName=prompt("input json file(*.json)","map.json");\n              //$LASTPOS=41003495;//kernel.MapEditorOLD:3495\n              _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);\n              //$LASTPOS=41003553;//kernel.MapEditorOLD:3553\n              _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];\n              //$LASTPOS=41003668;//kernel.MapEditorOLD:3668\n              _this.saveDataFile.obj(_this.data);\n              //$LASTPOS=41003701;//kernel.MapEditorOLD:3701\n              _this.print(_this.saveFileName+" Saved");\n              \n            }\n            //$LASTPOS=41003793;//kernel.MapEditorOLD:3793\n            if (_this.getkey("c")==1) {\n              //$LASTPOS=41003822;//kernel.MapEditorOLD:3822\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=41003856;//kernel.MapEditorOLD:3856\n              _this.mode="spuit";\n              //$LASTPOS=41003879;//kernel.MapEditorOLD:3879\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=41003912;//kernel.MapEditorOLD:3912\n            if (_this.mode!="get") {\n              //$LASTPOS=41003938;//kernel.MapEditorOLD:3938\n              if (_this.getkey("left")>0) {\n                //$LASTPOS=41003959;//kernel.MapEditorOLD:3959\n                _this.mx=_this.mx+8;\n              }\n              //$LASTPOS=41003977;//kernel.MapEditorOLD:3977\n              if (_this.getkey("right")>0) {\n                //$LASTPOS=41003999;//kernel.MapEditorOLD:3999\n                _this.mx=_this.mx-8;\n              }\n              //$LASTPOS=41004017;//kernel.MapEditorOLD:4017\n              if (_this.getkey("up")>0) {\n                //$LASTPOS=41004036;//kernel.MapEditorOLD:4036\n                _this.my=_this.my+8;\n              }\n              //$LASTPOS=41004054;//kernel.MapEditorOLD:4054\n              if (_this.getkey("down")>0) {\n                //$LASTPOS=41004075;//kernel.MapEditorOLD:4075\n                _this.my=_this.my-8;\n              }\n              //$LASTPOS=41004093;//kernel.MapEditorOLD:4093\n              Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n              \n            } else {\n              //$LASTPOS=41004136;//kernel.MapEditorOLD:4136\n              if (_this.getkey("left")>0) {\n                //$LASTPOS=41004157;//kernel.MapEditorOLD:4157\n                _this.chipX=_this.chipX+8;\n              }\n              //$LASTPOS=41004181;//kernel.MapEditorOLD:4181\n              if (_this.getkey("right")>0) {\n                //$LASTPOS=41004203;//kernel.MapEditorOLD:4203\n                _this.chipX=_this.chipX-8;\n              }\n              //$LASTPOS=41004227;//kernel.MapEditorOLD:4227\n              if (_this.getkey("up")>0) {\n                //$LASTPOS=41004246;//kernel.MapEditorOLD:4246\n                _this.chipY=_this.chipY+8;\n              }\n              //$LASTPOS=41004270;//kernel.MapEditorOLD:4270\n              if (_this.getkey("down")>0) {\n                //$LASTPOS=41004291;//kernel.MapEditorOLD:4291\n                _this.chipY=_this.chipY-8;\n              }\n              //$LASTPOS=41004315;//kernel.MapEditorOLD:4315\n              Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);\n              \n            }\n            //$LASTPOS=41004354;//kernel.MapEditorOLD:4354\n            _this.panel.x=_this.panel.width/2-_this.mx;\n            //$LASTPOS=41004385;//kernel.MapEditorOLD:4385\n            _this.panel.y=_this.panel.height/2-_this.my;\n            //$LASTPOS=41004417;//kernel.MapEditorOLD:4417\n            if (!(_this.mode=="set"&&_this.getkey(1)>0)) { __pc=15; break; }\n            {\n              //$LASTPOS=41004458;//kernel.MapEditorOLD:4458\n              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n              //$LASTPOS=41004507;//kernel.MapEditorOLD:4507\n              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n            }\n            __pc=25;break;\n          case 15:\n            //$LASTPOS=41004558;//kernel.MapEditorOLD:4558\n            if (!(_this.mode=="erase"&&_this.getkey(1)>0)) { __pc=16; break; }\n            {\n              //$LASTPOS=41004601;//kernel.MapEditorOLD:4601\n              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n            }\n            __pc=24;break;\n          case 16:\n            //$LASTPOS=41004650;//kernel.MapEditorOLD:4650\n            if (!(_this.mode=="get"&&_this.getkey(1)>0)) { __pc=18; break; }\n            //$LASTPOS=41004691;//kernel.MapEditorOLD:4691\n            _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);\n            //$LASTPOS=41004745;//kernel.MapEditorOLD:4745\n            _this.mode=_this.prevMode;\n            //$LASTPOS=41004769;//kernel.MapEditorOLD:4769\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=41004803;//kernel.MapEditorOLD:4803\n            _this.print(_this.mode+" mode");\n            //$LASTPOS=41004833;//kernel.MapEditorOLD:4833\n            _this.fiber$updateEx(_thread, 10);\n            __pc=17;return;\n          case 17:\n            \n            __pc=23;break;\n          case 18:\n            //$LASTPOS=41004858;//kernel.MapEditorOLD:4858\n            if (!(_this.mode=="setOn"&&_this.getkey(1)>0)) { __pc=19; break; }\n            {\n              //$LASTPOS=41004901;//kernel.MapEditorOLD:4901\n              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n            }\n            __pc=22;break;\n          case 19:\n            //$LASTPOS=41004954;//kernel.MapEditorOLD:4954\n            if (!(_this.mode=="spuit"&&_this.getkey(1)>0)) { __pc=21; break; }\n            //$LASTPOS=41004997;//kernel.MapEditorOLD:4997\n            _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);\n            //$LASTPOS=41005046;//kernel.MapEditorOLD:5046\n            _this.mode="set";\n            //$LASTPOS=41005067;//kernel.MapEditorOLD:5067\n            _this.print(_this.mode+" mode");\n            //$LASTPOS=41005097;//kernel.MapEditorOLD:5097\n            _this.fiber$updateEx(_thread, 10);\n            __pc=20;return;\n          case 20:\n            \n          case 21:\n            \n          case 22:\n            \n          case 23:\n            \n          case 24:\n            \n          case 25:\n            \n            //$LASTPOS=41005123;//kernel.MapEditorOLD:5123\n            _this.fiber$update(_thread);\n            __pc=26;return;\n          case 26:\n            \n            __pc=14;break;\n          case 27:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Pad\',\n  shortName: \'Pad\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_Pad_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=42001202;//kernel.Pad:1202\n      _this.APAD_DIAG_SIZE=96;\n      //$LASTPOS=42003465;//kernel.Pad:3465\n      while (true) {\n        //$LASTPOS=42003484;//kernel.Pad:3484\n        _this.padUpdate();\n        //$LASTPOS=42003502;//kernel.Pad:3502\n        _this.update();\n        \n      }\n    },\n    fiber$main :function _trc_Pad_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=42001202;//kernel.Pad:1202\n      _this.APAD_DIAG_SIZE=96;\n      \n      _thread.enter(function _trc_Pad_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=42003465;//kernel.Pad:3465\n          case 1:\n            //$LASTPOS=42003484;//kernel.Pad:3484\n            _this.fiber$padUpdate(_thread);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=42003502;//kernel.Pad:3502\n            _this.fiber$update(_thread);\n            __pc=3;return;\n          case 3:\n            \n            __pc=1;break;\n          case 4:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initialize :function _trc_Pad_initialize(opt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=42000033;//kernel.Pad:33\n      Tonyu.classes.kernel.Actor.apply( _this, [opt]);\n      //$LASTPOS=42000050;//kernel.Pad:50\n      _this.padImageP=Tonyu.globals.$pat_inputPad;\n      //$LASTPOS=42000082;//kernel.Pad:82\n      _this.jujiKey=new Tonyu.classes.kernel.Actor({x: 96+1,y: Tonyu.globals.$screenHeight-96-1,p: _this.padImageP+0,zOrder: - 9,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=42000183;//kernel.Pad:183\n      _this.no1Key=new Tonyu.classes.kernel.Actor({x: Tonyu.globals.$screenWidth-96,y: Tonyu.globals.$screenHeight-96,p: _this.padImageP+1,zOrder: - 9,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=42000292;//kernel.Pad:292\n      _this.jujiKey.show();\n      //$LASTPOS=42000313;//kernel.Pad:313\n      _this.no1Key.show();\n      //$LASTPOS=42000339;//kernel.Pad:339\n      _this.jujiKeyPushU=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y-60,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=42000446;//kernel.Pad:446\n      _this.jujiKeyPushL=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x-60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=42000553;//kernel.Pad:553\n      _this.jujiKeyPushR=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x+60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=42000660;//kernel.Pad:660\n      _this.jujiKeyPushD=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y+60,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=42000767;//kernel.Pad:767\n      _this.jujiKeyPush1=new Tonyu.classes.kernel.Actor({x: _this.no1Key.x,y: _this.no1Key.y,p: _this.padImageP+2,scaleX: 2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=42000879;//kernel.Pad:879\n      _this.jujiKeyPushU.hide();\n      //$LASTPOS=42000905;//kernel.Pad:905\n      _this.jujiKeyPushL.hide();\n      //$LASTPOS=42000931;//kernel.Pad:931\n      _this.jujiKeyPushR.hide();\n      //$LASTPOS=42000957;//kernel.Pad:957\n      _this.jujiKeyPushD.hide();\n      //$LASTPOS=42000983;//kernel.Pad:983\n      _this.jujiKeyPush1.hide();\n    },\n    die :function _trc_Pad_die() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=42001021;//kernel.Pad:1021\n      _this.jujiKey.die();\n      //$LASTPOS=42001041;//kernel.Pad:1041\n      _this.no1Key.die();\n      //$LASTPOS=42001060;//kernel.Pad:1060\n      _this.jujiKeyPushU.die();\n      //$LASTPOS=42001085;//kernel.Pad:1085\n      _this.jujiKeyPushL.die();\n      //$LASTPOS=42001110;//kernel.Pad:1110\n      _this.jujiKeyPushR.die();\n      //$LASTPOS=42001135;//kernel.Pad:1135\n      _this.jujiKeyPushD.die();\n      //$LASTPOS=42001160;//kernel.Pad:1160\n      _this.jujiKeyPush1.die();\n      //$LASTPOS=42001185;//kernel.Pad:1185\n      Tonyu.classes.kernel.Actor.prototype.die.apply( _this, []);\n    },\n    padUpdate :function _trc_Pad_padUpdate() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var t;\n      \n      //$LASTPOS=42001258;//kernel.Pad:1258\n      _this.keyPushL=0;\n      //$LASTPOS=42001277;//kernel.Pad:1277\n      _this.keyPushR=0;\n      //$LASTPOS=42001296;//kernel.Pad:1296\n      _this.keyPushU=0;\n      //$LASTPOS=42001315;//kernel.Pad:1315\n      _this.keyPushD=0;\n      //$LASTPOS=42001334;//kernel.Pad:1334\n      _this.keyPush1=0;\n      //$LASTPOS=42001359;//kernel.Pad:1359\n      _this.padKeyNotapCnt++;\n      //$LASTPOS=42001383;//kernel.Pad:1383\n      //$LASTPOS=42001388;//kernel.Pad:1388\n      i = 0;\n      while(i<5) {\n        {\n          //$LASTPOS=42001436;//kernel.Pad:1436\n          t = Tonyu.globals.$touches[i];\n          //$LASTPOS=42001466;//kernel.Pad:1466\n          if (t.touched) {\n            //$LASTPOS=42001496;//kernel.Pad:1496\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {\n              //$LASTPOS=42001593;//kernel.Pad:1593\n              _this.keyPushU=1;\n            }\n            //$LASTPOS=42001620;//kernel.Pad:1620\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {\n              //$LASTPOS=42001717;//kernel.Pad:1717\n              _this.keyPushD=1;\n            }\n            //$LASTPOS=42001744;//kernel.Pad:1744\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n              //$LASTPOS=42001841;//kernel.Pad:1841\n              _this.keyPushL=1;\n            }\n            //$LASTPOS=42001868;//kernel.Pad:1868\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n              //$LASTPOS=42001965;//kernel.Pad:1965\n              _this.keyPushR=1;\n            }\n            //$LASTPOS=42001992;//kernel.Pad:1992\n            if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {\n              //$LASTPOS=42002054;//kernel.Pad:2054\n              _this.keyPush1=1;\n            }\n            //$LASTPOS=42002081;//kernel.Pad:2081\n            _this.padKeySW=1;\n            //$LASTPOS=42002108;//kernel.Pad:2108\n            _this.padKeyNotapCnt=0;\n            \n          }\n        }\n        i++;\n      }\n      //$LASTPOS=42002173;//kernel.Pad:2173\n      if (_this.keyPushL) {\n        //$LASTPOS=42002187;//kernel.Pad:2187\n        _this.keyCntL++;\n      } else {\n        //$LASTPOS=42002204;//kernel.Pad:2204\n        _this.keyCntL=0;\n      }\n      //$LASTPOS=42002222;//kernel.Pad:2222\n      if (_this.keyPushR) {\n        //$LASTPOS=42002236;//kernel.Pad:2236\n        _this.keyCntR++;\n      } else {\n        //$LASTPOS=42002253;//kernel.Pad:2253\n        _this.keyCntR=0;\n      }\n      //$LASTPOS=42002271;//kernel.Pad:2271\n      if (_this.keyPushU) {\n        //$LASTPOS=42002285;//kernel.Pad:2285\n        _this.keyCntU++;\n      } else {\n        //$LASTPOS=42002302;//kernel.Pad:2302\n        _this.keyCntU=0;\n      }\n      //$LASTPOS=42002320;//kernel.Pad:2320\n      if (_this.keyPushD) {\n        //$LASTPOS=42002334;//kernel.Pad:2334\n        _this.keyCntD++;\n      } else {\n        //$LASTPOS=42002351;//kernel.Pad:2351\n        _this.keyCntD=0;\n      }\n      //$LASTPOS=42002369;//kernel.Pad:2369\n      if (_this.keyPush1) {\n        //$LASTPOS=42002383;//kernel.Pad:2383\n        _this.keyCnt1++;\n      } else {\n        //$LASTPOS=42002400;//kernel.Pad:2400\n        _this.keyCnt1=0;\n      }\n      //$LASTPOS=42002435;//kernel.Pad:2435\n      if (_this.keyPushL) {\n        //$LASTPOS=42002449;//kernel.Pad:2449\n        _this.jujiKeyPushL.show();\n      } else {\n        //$LASTPOS=42002475;//kernel.Pad:2475\n        _this.jujiKeyPushL.hide();\n      }\n      //$LASTPOS=42002501;//kernel.Pad:2501\n      if (_this.keyPushR) {\n        //$LASTPOS=42002515;//kernel.Pad:2515\n        _this.jujiKeyPushR.show();\n      } else {\n        //$LASTPOS=42002541;//kernel.Pad:2541\n        _this.jujiKeyPushR.hide();\n      }\n      //$LASTPOS=42002567;//kernel.Pad:2567\n      if (_this.keyPushU) {\n        //$LASTPOS=42002581;//kernel.Pad:2581\n        _this.jujiKeyPushU.show();\n      } else {\n        //$LASTPOS=42002607;//kernel.Pad:2607\n        _this.jujiKeyPushU.hide();\n      }\n      //$LASTPOS=42002633;//kernel.Pad:2633\n      if (_this.keyPushD) {\n        //$LASTPOS=42002647;//kernel.Pad:2647\n        _this.jujiKeyPushD.show();\n      } else {\n        //$LASTPOS=42002673;//kernel.Pad:2673\n        _this.jujiKeyPushD.hide();\n      }\n      //$LASTPOS=42002699;//kernel.Pad:2699\n      if (_this.keyPush1) {\n        //$LASTPOS=42002713;//kernel.Pad:2713\n        _this.jujiKeyPush1.show();\n      } else {\n        //$LASTPOS=42002739;//kernel.Pad:2739\n        _this.jujiKeyPush1.hide();\n      }\n    },\n    fiber$padUpdate :function _trc_Pad_f_padUpdate(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var t;\n      \n      //$LASTPOS=42001258;//kernel.Pad:1258\n      _this.keyPushL=0;\n      //$LASTPOS=42001277;//kernel.Pad:1277\n      _this.keyPushR=0;\n      //$LASTPOS=42001296;//kernel.Pad:1296\n      _this.keyPushU=0;\n      //$LASTPOS=42001315;//kernel.Pad:1315\n      _this.keyPushD=0;\n      //$LASTPOS=42001334;//kernel.Pad:1334\n      _this.keyPush1=0;\n      //$LASTPOS=42001359;//kernel.Pad:1359\n      _this.padKeyNotapCnt++;\n      //$LASTPOS=42001383;//kernel.Pad:1383\n      //$LASTPOS=42001388;//kernel.Pad:1388\n      i = 0;\n      while(i<5) {\n        {\n          //$LASTPOS=42001436;//kernel.Pad:1436\n          t = Tonyu.globals.$touches[i];\n          //$LASTPOS=42001466;//kernel.Pad:1466\n          if (t.touched) {\n            //$LASTPOS=42001496;//kernel.Pad:1496\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {\n              //$LASTPOS=42001593;//kernel.Pad:1593\n              _this.keyPushU=1;\n            }\n            //$LASTPOS=42001620;//kernel.Pad:1620\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {\n              //$LASTPOS=42001717;//kernel.Pad:1717\n              _this.keyPushD=1;\n            }\n            //$LASTPOS=42001744;//kernel.Pad:1744\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n              //$LASTPOS=42001841;//kernel.Pad:1841\n              _this.keyPushL=1;\n            }\n            //$LASTPOS=42001868;//kernel.Pad:1868\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n              //$LASTPOS=42001965;//kernel.Pad:1965\n              _this.keyPushR=1;\n            }\n            //$LASTPOS=42001992;//kernel.Pad:1992\n            if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {\n              //$LASTPOS=42002054;//kernel.Pad:2054\n              _this.keyPush1=1;\n            }\n            //$LASTPOS=42002081;//kernel.Pad:2081\n            _this.padKeySW=1;\n            //$LASTPOS=42002108;//kernel.Pad:2108\n            _this.padKeyNotapCnt=0;\n            \n          }\n        }\n        i++;\n      }\n      //$LASTPOS=42002173;//kernel.Pad:2173\n      if (_this.keyPushL) {\n        //$LASTPOS=42002187;//kernel.Pad:2187\n        _this.keyCntL++;\n      } else {\n        //$LASTPOS=42002204;//kernel.Pad:2204\n        _this.keyCntL=0;\n      }\n      //$LASTPOS=42002222;//kernel.Pad:2222\n      if (_this.keyPushR) {\n        //$LASTPOS=42002236;//kernel.Pad:2236\n        _this.keyCntR++;\n      } else {\n        //$LASTPOS=42002253;//kernel.Pad:2253\n        _this.keyCntR=0;\n      }\n      //$LASTPOS=42002271;//kernel.Pad:2271\n      if (_this.keyPushU) {\n        //$LASTPOS=42002285;//kernel.Pad:2285\n        _this.keyCntU++;\n      } else {\n        //$LASTPOS=42002302;//kernel.Pad:2302\n        _this.keyCntU=0;\n      }\n      //$LASTPOS=42002320;//kernel.Pad:2320\n      if (_this.keyPushD) {\n        //$LASTPOS=42002334;//kernel.Pad:2334\n        _this.keyCntD++;\n      } else {\n        //$LASTPOS=42002351;//kernel.Pad:2351\n        _this.keyCntD=0;\n      }\n      //$LASTPOS=42002369;//kernel.Pad:2369\n      if (_this.keyPush1) {\n        //$LASTPOS=42002383;//kernel.Pad:2383\n        _this.keyCnt1++;\n      } else {\n        //$LASTPOS=42002400;//kernel.Pad:2400\n        _this.keyCnt1=0;\n      }\n      //$LASTPOS=42002435;//kernel.Pad:2435\n      if (_this.keyPushL) {\n        //$LASTPOS=42002449;//kernel.Pad:2449\n        _this.jujiKeyPushL.show();\n      } else {\n        //$LASTPOS=42002475;//kernel.Pad:2475\n        _this.jujiKeyPushL.hide();\n      }\n      //$LASTPOS=42002501;//kernel.Pad:2501\n      if (_this.keyPushR) {\n        //$LASTPOS=42002515;//kernel.Pad:2515\n        _this.jujiKeyPushR.show();\n      } else {\n        //$LASTPOS=42002541;//kernel.Pad:2541\n        _this.jujiKeyPushR.hide();\n      }\n      //$LASTPOS=42002567;//kernel.Pad:2567\n      if (_this.keyPushU) {\n        //$LASTPOS=42002581;//kernel.Pad:2581\n        _this.jujiKeyPushU.show();\n      } else {\n        //$LASTPOS=42002607;//kernel.Pad:2607\n        _this.jujiKeyPushU.hide();\n      }\n      //$LASTPOS=42002633;//kernel.Pad:2633\n      if (_this.keyPushD) {\n        //$LASTPOS=42002647;//kernel.Pad:2647\n        _this.jujiKeyPushD.show();\n      } else {\n        //$LASTPOS=42002673;//kernel.Pad:2673\n        _this.jujiKeyPushD.hide();\n      }\n      //$LASTPOS=42002699;//kernel.Pad:2699\n      if (_this.keyPush1) {\n        //$LASTPOS=42002713;//kernel.Pad:2713\n        _this.jujiKeyPush1.show();\n      } else {\n        //$LASTPOS=42002739;//kernel.Pad:2739\n        _this.jujiKeyPush1.hide();\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    getPadUp :function _trc_Pad_getPadUp() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntU;\n    },\n    fiber$getPadUp :function _trc_Pad_f_getPadUp(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntU;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getPadDown :function _trc_Pad_getPadDown() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntD;\n    },\n    fiber$getPadDown :function _trc_Pad_f_getPadDown(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntD;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getPadLeft :function _trc_Pad_getPadLeft() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntL;\n    },\n    fiber$getPadLeft :function _trc_Pad_f_getPadLeft(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntL;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getPadRight :function _trc_Pad_getPadRight() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntR;\n    },\n    fiber$getPadRight :function _trc_Pad_f_getPadRight(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntR;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getPadButton :function _trc_Pad_getPadButton(i) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var value;\n      \n      //$LASTPOS=42002940;//kernel.Pad:2940\n      value;\n      //$LASTPOS=42002956;//kernel.Pad:2956\n      if (i==0) {\n        //$LASTPOS=42002968;//kernel.Pad:2968\n        value=_this.keyCnt1;\n      }\n      return value;\n    },\n    fiber$getPadButton :function _trc_Pad_f_getPadButton(_thread,i) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var value;\n      \n      //$LASTPOS=42002940;//kernel.Pad:2940\n      value;\n      //$LASTPOS=42002956;//kernel.Pad:2956\n      if (i==0) {\n        //$LASTPOS=42002968;//kernel.Pad:2968\n        value=_this.keyCnt1;\n      }\n      _thread.retVal=value;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getUp :function _trc_Pad_getUp() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntU;\n    },\n    fiber$getUp :function _trc_Pad_f_getUp(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntU;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getDown :function _trc_Pad_getDown() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntD;\n    },\n    fiber$getDown :function _trc_Pad_f_getDown(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntD;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getLeft :function _trc_Pad_getLeft() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntL;\n    },\n    fiber$getLeft :function _trc_Pad_f_getLeft(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntL;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getRight :function _trc_Pad_getRight() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntR;\n    },\n    fiber$getRight :function _trc_Pad_f_getRight(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntR;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getButton :function _trc_Pad_getButton(i) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var value;\n      \n      //$LASTPOS=42003163;//kernel.Pad:3163\n      value;\n      //$LASTPOS=42003179;//kernel.Pad:3179\n      if (i==0) {\n        //$LASTPOS=42003191;//kernel.Pad:3191\n        value=_this.keyCnt1;\n      }\n      return value;\n    },\n    fiber$getButton :function _trc_Pad_f_getButton(_thread,i) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var value;\n      \n      //$LASTPOS=42003163;//kernel.Pad:3163\n      value;\n      //$LASTPOS=42003179;//kernel.Pad:3179\n      if (i==0) {\n        //$LASTPOS=42003191;//kernel.Pad:3191\n        value=_this.keyCnt1;\n      }\n      _thread.retVal=value;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    isOnRect :function _trc_Pad_isOnRect(mx,my,rx,ry,rx2,ry2) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return (rx<=mx&&mx<rx2&&ry<=my&&my<ry2);\n    },\n    fiber$isOnRect :function _trc_Pad_f_isOnRect(_thread,mx,my,rx,ry,rx2,ry2) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=(rx<=mx&&mx<rx2&&ry<=my&&my<ry2);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    isOnRectWH :function _trc_Pad_isOnRectWH(mx,my,rx,ry,rw,rh) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return (rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);\n    },\n    fiber$isOnRectWH :function _trc_Pad_f_isOnRectWH(_thread,mx,my,rx,ry,rw,rh) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=(rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"die":{"nowait":true},"padUpdate":{"nowait":false},"getPadUp":{"nowait":false},"getPadDown":{"nowait":false},"getPadLeft":{"nowait":false},"getPadRight":{"nowait":false},"getPadButton":{"nowait":false},"getUp":{"nowait":false},"getDown":{"nowait":false},"getLeft":{"nowait":false},"getRight":{"nowait":false},"getButton":{"nowait":false},"isOnRect":{"nowait":false},"isOnRectWH":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Boot\',\n  shortName: \'Boot\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [Tonyu.classes.kernel.T2MediaPlayer],\n  methods: {\n    main :function _trc_Boot_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=43002040;//kernel.Boot:2040\n      Tonyu.globals.$Boot=_this;\n      //$LASTPOS=43002053;//kernel.Boot:2053\n      _this.initSounds();\n      //$LASTPOS=43002068;//kernel.Boot:2068\n      _this.initSprites();\n      //$LASTPOS=43002084;//kernel.Boot:2084\n      Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;\n      //$LASTPOS=43002115;//kernel.Boot:2115\n      Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);\n      //$LASTPOS=43002152;//kernel.Boot:2152\n      _this.initThread();\n      //$LASTPOS=43002169;//kernel.Boot:2169\n      Tonyu.globals.$pat_fruits=30;\n      //$LASTPOS=43002186;//kernel.Boot:2186\n      Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;\n      //$LASTPOS=43002203;//kernel.Boot:2203\n      Tonyu.globals.$Math=Math;\n      //$LASTPOS=43002216;//kernel.Boot:2216\n      Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.Panel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=43002326;//kernel.Boot:2326\n      Tonyu.globals.$consolePrintY=465-15;\n      //$LASTPOS=43002350;//kernel.Boot:2350\n      Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=43002490;//kernel.Boot:2490\n      if (typeof  SplashScreen!="undefined") {\n        //$LASTPOS=43002528;//kernel.Boot:2528\n        SplashScreen.hide();\n      }\n      //$LASTPOS=43002550;//kernel.Boot:2550\n      _this.initFPSParams();\n      //$LASTPOS=43002570;//kernel.Boot:2570\n      Tonyu.globals.$mouseX=Tonyu.globals.$mouseX||0;\n      //$LASTPOS=43002591;//kernel.Boot:2591\n      Tonyu.globals.$mouseY=Tonyu.globals.$mouseY||0;\n      //$LASTPOS=43002612;//kernel.Boot:2612\n      while (true) {\n        //$LASTPOS=43002652;//kernel.Boot:2652\n        _this.scheduler.stepsAll();\n        //$LASTPOS=43002679;//kernel.Boot:2679\n        Tonyu.globals.$Keys.update();\n        //$LASTPOS=43002700;//kernel.Boot:2700\n        Tonyu.globals.$InputDevice.update();\n        //$LASTPOS=43002728;//kernel.Boot:2728\n        Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;\n        //$LASTPOS=43002761;//kernel.Boot:2761\n        Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;\n        //$LASTPOS=43002796;//kernel.Boot:2796\n        _this.doDraw=_this.now()<_this.deadLine;\n        //$LASTPOS=43002824;//kernel.Boot:2824\n        if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {\n          //$LASTPOS=43002878;//kernel.Boot:2878\n          _this.doDraw=true;\n          //$LASTPOS=43002900;//kernel.Boot:2900\n          _this.resetDeadLine();\n          \n        }\n        //$LASTPOS=43002929;//kernel.Boot:2929\n        if (_this.doDraw) {\n          //$LASTPOS=43002972;//kernel.Boot:2972\n          Tonyu.globals.$Screen.fillCanvas(Tonyu.globals.$Screen.buf[0]);\n          //$LASTPOS=43003017;//kernel.Boot:3017\n          Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n          //$LASTPOS=43003057;//kernel.Boot:3057\n          Tonyu.globals.$FrontSprites.draw(Tonyu.globals.$Screen.buf[0]);\n          //$LASTPOS=43003102;//kernel.Boot:3102\n          Tonyu.globals.$Screen.draw();\n          //$LASTPOS=43003127;//kernel.Boot:3127\n          _this.fps_fpsCnt++;\n          //$LASTPOS=43003151;//kernel.Boot:3151\n          _this.frameSkipped=0;\n          \n        } else {\n          //$LASTPOS=43003190;//kernel.Boot:3190\n          _this.frameSkipped++;\n          \n        }\n        //$LASTPOS=43003218;//kernel.Boot:3218\n        Tonyu.globals.$Sprites.checkHit();\n        //$LASTPOS=43003244;//kernel.Boot:3244\n        Tonyu.globals.$Sprites.removeOneframes();\n        //$LASTPOS=43003277;//kernel.Boot:3277\n        _this.fps_rpsCnt++;\n        //$LASTPOS=43003297;//kernel.Boot:3297\n        _this.measureFps();\n        //$LASTPOS=43003316;//kernel.Boot:3316\n        _this.waitFrame();\n        //$LASTPOS=43003343;//kernel.Boot:3343\n        while (_this.paused) {\n          //$LASTPOS=43003368;//kernel.Boot:3368\n          _this.waitFor(Tonyu.timeout(1));\n          //$LASTPOS=43003404;//kernel.Boot:3404\n          if (! _this.paused) {\n            //$LASTPOS=43003417;//kernel.Boot:3417\n            _this.resetDeadLine();\n          }\n          \n        }\n        \n      }\n    },\n    fiber$main :function _trc_Boot_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=43002040;//kernel.Boot:2040\n      Tonyu.globals.$Boot=_this;\n      \n      _thread.enter(function _trc_Boot_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=43002053;//kernel.Boot:2053\n            _this.fiber$initSounds(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=43002068;//kernel.Boot:2068\n            _this.fiber$initSprites(_thread);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=43002084;//kernel.Boot:2084\n            Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;\n            //$LASTPOS=43002115;//kernel.Boot:2115\n            Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);\n            //$LASTPOS=43002152;//kernel.Boot:2152\n            _this.fiber$initThread(_thread);\n            __pc=3;return;\n          case 3:\n            \n            //$LASTPOS=43002169;//kernel.Boot:2169\n            Tonyu.globals.$pat_fruits=30;\n            //$LASTPOS=43002186;//kernel.Boot:2186\n            Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;\n            //$LASTPOS=43002203;//kernel.Boot:2203\n            Tonyu.globals.$Math=Math;\n            //$LASTPOS=43002216;//kernel.Boot:2216\n            Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.Panel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n            //$LASTPOS=43002326;//kernel.Boot:2326\n            Tonyu.globals.$consolePrintY=465-15;\n            //$LASTPOS=43002350;//kernel.Boot:2350\n            Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});\n            //$LASTPOS=43002490;//kernel.Boot:2490\n            if (typeof  SplashScreen!="undefined") {\n              //$LASTPOS=43002528;//kernel.Boot:2528\n              SplashScreen.hide();\n            }\n            //$LASTPOS=43002550;//kernel.Boot:2550\n            _this.initFPSParams();\n            //$LASTPOS=43002570;//kernel.Boot:2570\n            Tonyu.globals.$mouseX=Tonyu.globals.$mouseX||0;\n            //$LASTPOS=43002591;//kernel.Boot:2591\n            Tonyu.globals.$mouseY=Tonyu.globals.$mouseY||0;\n            //$LASTPOS=43002612;//kernel.Boot:2612\n          case 4:\n            //$LASTPOS=43002652;//kernel.Boot:2652\n            _this.scheduler.stepsAll();\n            //$LASTPOS=43002679;//kernel.Boot:2679\n            Tonyu.globals.$Keys.update();\n            //$LASTPOS=43002700;//kernel.Boot:2700\n            Tonyu.globals.$InputDevice.update();\n            //$LASTPOS=43002728;//kernel.Boot:2728\n            Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;\n            //$LASTPOS=43002761;//kernel.Boot:2761\n            Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;\n            //$LASTPOS=43002796;//kernel.Boot:2796\n            _this.doDraw=_this.now()<_this.deadLine;\n            //$LASTPOS=43002824;//kernel.Boot:2824\n            if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {\n              //$LASTPOS=43002878;//kernel.Boot:2878\n              _this.doDraw=true;\n              //$LASTPOS=43002900;//kernel.Boot:2900\n              _this.resetDeadLine();\n              \n            }\n            //$LASTPOS=43002929;//kernel.Boot:2929\n            if (_this.doDraw) {\n              //$LASTPOS=43002972;//kernel.Boot:2972\n              Tonyu.globals.$Screen.fillCanvas(Tonyu.globals.$Screen.buf[0]);\n              //$LASTPOS=43003017;//kernel.Boot:3017\n              Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n              //$LASTPOS=43003057;//kernel.Boot:3057\n              Tonyu.globals.$FrontSprites.draw(Tonyu.globals.$Screen.buf[0]);\n              //$LASTPOS=43003102;//kernel.Boot:3102\n              Tonyu.globals.$Screen.draw();\n              //$LASTPOS=43003127;//kernel.Boot:3127\n              _this.fps_fpsCnt++;\n              //$LASTPOS=43003151;//kernel.Boot:3151\n              _this.frameSkipped=0;\n              \n            } else {\n              //$LASTPOS=43003190;//kernel.Boot:3190\n              _this.frameSkipped++;\n              \n            }\n            //$LASTPOS=43003218;//kernel.Boot:3218\n            Tonyu.globals.$Sprites.checkHit();\n            //$LASTPOS=43003244;//kernel.Boot:3244\n            Tonyu.globals.$Sprites.removeOneframes();\n            //$LASTPOS=43003277;//kernel.Boot:3277\n            _this.fps_rpsCnt++;\n            //$LASTPOS=43003297;//kernel.Boot:3297\n            _this.measureFps();\n            //$LASTPOS=43003316;//kernel.Boot:3316\n            _this.fiber$waitFrame(_thread);\n            __pc=5;return;\n          case 5:\n            \n            //$LASTPOS=43003343;//kernel.Boot:3343\n          case 6:\n            if (!(_this.paused)) { __pc=8; break; }\n            //$LASTPOS=43003368;//kernel.Boot:3368\n            _this.fiber$waitFor(_thread, Tonyu.timeout(1));\n            __pc=7;return;\n          case 7:\n            \n            //$LASTPOS=43003404;//kernel.Boot:3404\n            if (! _this.paused) {\n              //$LASTPOS=43003417;//kernel.Boot:3417\n              _this.resetDeadLine();\n            }\n            __pc=6;break;\n          case 8:\n            \n            __pc=4;break;\n          case 9:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initialize :function _trc_Boot_initialize(param) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=43000206;//kernel.Boot:206\n      _this.extend(param);\n    },\n    update :function _trc_Boot_update() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=43000242;//kernel.Boot:242\n      _this.waitFor(Tonyu.timeout(50));\n    },\n    fiber$update :function _trc_Boot_f_update(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Boot_ent_update(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=43000242;//kernel.Boot:242\n            _this.fiber$waitFor(_thread, Tonyu.timeout(50));\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initSprites :function _trc_Boot_initSprites() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var a;\n      var rs;\n      var r;\n      var name;\n      var val;\n      var _it_314;\n      \n      //$LASTPOS=43000323;//kernel.Boot:323\n      Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites();\n      //$LASTPOS=43000352;//kernel.Boot:352\n      Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites();\n      //$LASTPOS=43000386;//kernel.Boot:386\n      _this.print("Loading plugins..");\n      //$LASTPOS=43000420;//kernel.Boot:420\n      a = _this.asyncResult();\n      //$LASTPOS=43000446;//kernel.Boot:446\n      Tonyu.globals.$currentProject.loadPlugins(a.receiver);\n      //$LASTPOS=43000492;//kernel.Boot:492\n      _this.waitFor(a);\n      //$LASTPOS=43000509;//kernel.Boot:509\n      _this.print("Loading pats..");\n      //$LASTPOS=43000540;//kernel.Boot:540\n      rs = Tonyu.globals.$currentProject.getResource();\n      //$LASTPOS=43000583;//kernel.Boot:583\n      a=_this.asyncResult();\n      //$LASTPOS=43000605;//kernel.Boot:605\n      ImageList.load(rs.images,a.receiver,{baseDir: Tonyu.globals.$currentProject.getDir()});\n      //$LASTPOS=43000690;//kernel.Boot:690\n      _this.waitFor(a);\n      //$LASTPOS=43000707;//kernel.Boot:707\n      r = a[0];\n      //$LASTPOS=43000724;//kernel.Boot:724\n      Tonyu.globals.$Sprites.setImageList(r);\n      //$LASTPOS=43000755;//kernel.Boot:755\n      _it_314=Tonyu.iterator(r.names,2);\n      while(_it_314.next()) {\n        name=_it_314[0];\n        val=_it_314[1];\n        \n        //$LASTPOS=43000796;//kernel.Boot:796\n        Tonyu.setGlobal(name,val);\n        \n      }\n      //$LASTPOS=43000836;//kernel.Boot:836\n      _this.print("Loading pats done.");\n      //$LASTPOS=43000871;//kernel.Boot:871\n      _this.cvj=$("canvas");\n      //$LASTPOS=43000893;//kernel.Boot:893\n      if (Tonyu.noviceMode) {\n        //$LASTPOS=43000926;//kernel.Boot:926\n        Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 600,height: 300});\n        \n      } else {\n        //$LASTPOS=43001010;//kernel.Boot:1010\n        Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 465,height: 465});\n        \n      }\n    },\n    fiber$initSprites :function _trc_Boot_f_initSprites(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var a;\n      var rs;\n      var r;\n      var name;\n      var val;\n      var _it_314;\n      \n      //$LASTPOS=43000323;//kernel.Boot:323\n      Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites();\n      //$LASTPOS=43000352;//kernel.Boot:352\n      Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites();\n      //$LASTPOS=43000386;//kernel.Boot:386\n      _this.print("Loading plugins..");\n      //$LASTPOS=43000420;//kernel.Boot:420\n      a = _this.asyncResult();\n      //$LASTPOS=43000446;//kernel.Boot:446\n      Tonyu.globals.$currentProject.loadPlugins(a.receiver);\n      \n      _thread.enter(function _trc_Boot_ent_initSprites(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=43000492;//kernel.Boot:492\n            _this.fiber$waitFor(_thread, a);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=43000509;//kernel.Boot:509\n            _this.print("Loading pats..");\n            //$LASTPOS=43000540;//kernel.Boot:540\n            rs = Tonyu.globals.$currentProject.getResource();\n            //$LASTPOS=43000583;//kernel.Boot:583\n            a=_this.asyncResult();\n            //$LASTPOS=43000605;//kernel.Boot:605\n            ImageList.load(rs.images,a.receiver,{baseDir: Tonyu.globals.$currentProject.getDir()});\n            //$LASTPOS=43000690;//kernel.Boot:690\n            _this.fiber$waitFor(_thread, a);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=43000707;//kernel.Boot:707\n            r = a[0];\n            //$LASTPOS=43000724;//kernel.Boot:724\n            Tonyu.globals.$Sprites.setImageList(r);\n            //$LASTPOS=43000755;//kernel.Boot:755\n            _it_314=Tonyu.iterator(r.names,2);\n            while(_it_314.next()) {\n              name=_it_314[0];\n              val=_it_314[1];\n              \n              //$LASTPOS=43000796;//kernel.Boot:796\n              Tonyu.setGlobal(name,val);\n              \n            }\n            //$LASTPOS=43000836;//kernel.Boot:836\n            _this.print("Loading pats done.");\n            //$LASTPOS=43000871;//kernel.Boot:871\n            _this.cvj=$("canvas");\n            //$LASTPOS=43000893;//kernel.Boot:893\n            if (Tonyu.noviceMode) {\n              //$LASTPOS=43000926;//kernel.Boot:926\n              Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 600,height: 300});\n              \n            } else {\n              //$LASTPOS=43001010;//kernel.Boot:1010\n              Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 465,height: 465});\n              \n            }\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initSounds :function _trc_Boot_initSounds() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=43001103;//kernel.Boot:1103\n      _this.print("Loading sounds...");\n      //$LASTPOS=43001137;//kernel.Boot:1137\n      _this.initT2MediaPlayer();\n      //$LASTPOS=43001163;//kernel.Boot:1163\n      _this.loadFromProject(Tonyu.globals.$currentProject);\n      //$LASTPOS=43001202;//kernel.Boot:1202\n      _this.print("Loading sounds done.");\n      //$LASTPOS=43001239;//kernel.Boot:1239\n      _this.on("stop",(function anonymous_1249() {\n        \n        //$LASTPOS=43001261;//kernel.Boot:1261\n        _this.clearSEData();\n      }));\n      //$LASTPOS=43001289;//kernel.Boot:1289\n      Tonyu.globals.$sound=_this;\n    },\n    fiber$initSounds :function _trc_Boot_f_initSounds(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=43001103;//kernel.Boot:1103\n      _this.print("Loading sounds...");\n      \n      _thread.enter(function _trc_Boot_ent_initSounds(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=43001137;//kernel.Boot:1137\n            _this.fiber$initT2MediaPlayer(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=43001163;//kernel.Boot:1163\n            _this.fiber$loadFromProject(_thread, Tonyu.globals.$currentProject);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=43001202;//kernel.Boot:1202\n            _this.print("Loading sounds done.");\n            //$LASTPOS=43001239;//kernel.Boot:1239\n            _this.on("stop",(function anonymous_1249() {\n              \n              //$LASTPOS=43001261;//kernel.Boot:1261\n              _this.clearSEData();\n            }));\n            //$LASTPOS=43001289;//kernel.Boot:1289\n            Tonyu.globals.$sound=_this;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    hide :function _trc_Boot_hide() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    initThread :function _trc_Boot_initThread() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var o;\n      var mainClassName;\n      \n      //$LASTPOS=43001392;//kernel.Boot:1392\n      o = Tonyu.currentProject.getOptions();\n      //$LASTPOS=43001438;//kernel.Boot:1438\n      mainClassName = o.run.mainClass;\n      //$LASTPOS=43001478;//kernel.Boot:1478\n      _this.print("MainClass= "+mainClassName);\n      //$LASTPOS=43001519;//kernel.Boot:1519\n      _this.mainClass=Tonyu.getClass(mainClassName);\n      //$LASTPOS=43001565;//kernel.Boot:1565\n      if (! _this.mainClass) {\n        //$LASTPOS=43001592;//kernel.Boot:1592\n        TError(mainClassName+" というクラスはありません","不明",0).raise();\n        \n      }\n      //$LASTPOS=43001729;//kernel.Boot:1729\n      _this.scheduler=Tonyu.globals.$Scheduler=new Tonyu.classes.kernel.Scheduler;\n      //$LASTPOS=43001770;//kernel.Boot:1770\n      new _this.mainClass();\n    },\n    fiber$initThread :function _trc_Boot_f_initThread(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var o;\n      var mainClassName;\n      \n      //$LASTPOS=43001392;//kernel.Boot:1392\n      o = Tonyu.currentProject.getOptions();\n      //$LASTPOS=43001438;//kernel.Boot:1438\n      mainClassName = o.run.mainClass;\n      //$LASTPOS=43001478;//kernel.Boot:1478\n      _this.print("MainClass= "+mainClassName);\n      //$LASTPOS=43001519;//kernel.Boot:1519\n      _this.mainClass=Tonyu.getClass(mainClassName);\n      //$LASTPOS=43001565;//kernel.Boot:1565\n      if (! _this.mainClass) {\n        //$LASTPOS=43001592;//kernel.Boot:1592\n        TError(mainClassName+" というクラスはありません","不明",0).raise();\n        \n      }\n      //$LASTPOS=43001729;//kernel.Boot:1729\n      _this.scheduler=Tonyu.globals.$Scheduler=new Tonyu.classes.kernel.Scheduler;\n      //$LASTPOS=43001770;//kernel.Boot:1770\n      new _this.mainClass();\n      \n      _thread.retVal=_this;return;\n    },\n    stop :function _trc_Boot_stop() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=43001806;//kernel.Boot:1806\n      _this.fireEvent("stop");\n      //$LASTPOS=43001830;//kernel.Boot:1830\n      _this.die();\n    },\n    fiber$stop :function _trc_Boot_f_stop(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=43001806;//kernel.Boot:1806\n      _this.fireEvent("stop");\n      //$LASTPOS=43001830;//kernel.Boot:1830\n      _this.die();\n      \n      _thread.retVal=_this;return;\n    },\n    schedule :function _trc_Boot_schedule(obj,method,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var th;\n      \n      //$LASTPOS=43001875;//kernel.Boot:1875\n      method=method||"main";\n      //$LASTPOS=43001903;//kernel.Boot:1903\n      args=args||[];\n      //$LASTPOS=43001923;//kernel.Boot:1923\n      th = _this.scheduler.newThread(obj,method,args);\n      //$LASTPOS=43001975;//kernel.Boot:1975\n      _this.addThreadGroup(obj);\n      //$LASTPOS=43002001;//kernel.Boot:2001\n      obj.addThread(th);\n      return th;\n    },\n    fiber$schedule :function _trc_Boot_f_schedule(_thread,obj,method,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var th;\n      \n      //$LASTPOS=43001875;//kernel.Boot:1875\n      method=method||"main";\n      //$LASTPOS=43001903;//kernel.Boot:1903\n      args=args||[];\n      //$LASTPOS=43001923;//kernel.Boot:1923\n      th = _this.scheduler.newThread(obj,method,args);\n      \n      _thread.enter(function _trc_Boot_ent_schedule(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=43001975;//kernel.Boot:1975\n            _this.fiber$addThreadGroup(_thread, obj);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=43002001;//kernel.Boot:2001\n            obj.addThread(th);\n            _thread.exit(th);return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initFPSParams :function _trc_Boot_initFPSParams() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=43003497;//kernel.Boot:3497\n      _this._fps=30;\n      //$LASTPOS=43003513;//kernel.Boot:3513\n      _this.maxframeSkip=5;\n      //$LASTPOS=43003563;//kernel.Boot:3563\n      _this.frameCnt=0;\n      //$LASTPOS=43003582;//kernel.Boot:3582\n      _this.resetDeadLine();\n      //$LASTPOS=43003604;//kernel.Boot:3604\n      _this.lastMeasured=_this.now();\n      //$LASTPOS=43003629;//kernel.Boot:3629\n      _this.fps_fps=_this.fps_rps=_this.fps_fpsCnt=_this.fps_rpsCnt=0;\n    },\n    now :function _trc_Boot_now() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return new Date().getTime();\n    },\n    resetDeadLine :function _trc_Boot_resetDeadLine() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=43003759;//kernel.Boot:3759\n      _this.deadLine=_this.now()+1000/_this._fps;\n      //$LASTPOS=43003790;//kernel.Boot:3790\n      _this.frameSkipped=0;\n    },\n    waitFrame :function _trc_Boot_waitFrame() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var wt;\n      \n      //$LASTPOS=43003834;//kernel.Boot:3834\n      wt = _this.deadLine-_this.now();\n      //$LASTPOS=43003862;//kernel.Boot:3862\n      if (wt<1) {\n        //$LASTPOS=43003883;//kernel.Boot:3883\n        if (wt<- 1000) {\n          //$LASTPOS=43003897;//kernel.Boot:3897\n          _this.resetDeadLine();\n        }\n        //$LASTPOS=43003923;//kernel.Boot:3923\n        wt=1;\n        \n      }\n      //$LASTPOS=43003941;//kernel.Boot:3941\n      wt=_this.floor(wt);\n      //$LASTPOS=43003960;//kernel.Boot:3960\n      _this.waitFor(Tonyu.timeout(wt));\n      //$LASTPOS=43003993;//kernel.Boot:3993\n      _this.deadLine+=1000/_this._fps;\n    },\n    fiber$waitFrame :function _trc_Boot_f_waitFrame(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var wt;\n      \n      //$LASTPOS=43003834;//kernel.Boot:3834\n      wt = _this.deadLine-_this.now();\n      //$LASTPOS=43003862;//kernel.Boot:3862\n      if (wt<1) {\n        //$LASTPOS=43003883;//kernel.Boot:3883\n        if (wt<- 1000) {\n          //$LASTPOS=43003897;//kernel.Boot:3897\n          _this.resetDeadLine();\n        }\n        //$LASTPOS=43003923;//kernel.Boot:3923\n        wt=1;\n        \n      }\n      //$LASTPOS=43003941;//kernel.Boot:3941\n      wt=_this.floor(wt);\n      \n      _thread.enter(function _trc_Boot_ent_waitFrame(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=43003960;//kernel.Boot:3960\n            _this.fiber$waitFor(_thread, Tonyu.timeout(wt));\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=43003993;//kernel.Boot:3993\n            _this.deadLine+=1000/_this._fps;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    getFrameRate :function _trc_Boot_getFrameRate() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this._fps;\n    },\n    setFrameRate :function _trc_Boot_setFrameRate(fps,maxFrameSkip) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=43004153;//kernel.Boot:4153\n      _this._fps=fps;\n      //$LASTPOS=43004170;//kernel.Boot:4170\n      if (typeof  maxFrameSkip!="number") {\n        //$LASTPOS=43004205;//kernel.Boot:4205\n        maxFrameSkip=5;\n      }\n      //$LASTPOS=43004226;//kernel.Boot:4226\n      _this.maxFrameSkip=maxFrameSkip;\n      //$LASTPOS=43004265;//kernel.Boot:4265\n      _this.resetDeadLine();\n    },\n    getMeasuredFps :function _trc_Boot_getMeasuredFps() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.fps_fps;\n    },\n    getMeasuredRps :function _trc_Boot_getMeasuredRps() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.fps_rps;\n    },\n    measureFps :function _trc_Boot_measureFps() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=43004476;//kernel.Boot:4476\n      if (_this.now()>_this.lastMeasured+1000) {\n        //$LASTPOS=43004516;//kernel.Boot:4516\n        _this.fps_fps=_this.fps_fpsCnt;\n        //$LASTPOS=43004545;//kernel.Boot:4545\n        _this.fps_rps=_this.fps_rpsCnt;\n        //$LASTPOS=43004574;//kernel.Boot:4574\n        _this.fps_fpsCnt=0;\n        //$LASTPOS=43004597;//kernel.Boot:4597\n        _this.fps_rpsCnt=0;\n        //$LASTPOS=43004620;//kernel.Boot:4620\n        _this.lastMeasured=_this.now();\n        \n      }\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"update":{"nowait":false},"initSprites":{"nowait":false},"initSounds":{"nowait":false},"hide":{"nowait":true},"initThread":{"nowait":false},"stop":{"nowait":false},"schedule":{"nowait":false},"initFPSParams":{"nowait":true},"now":{"nowait":true},"resetDeadLine":{"nowait":true},"waitFrame":{"nowait":false},"getFrameRate":{"nowait":true},"setFrameRate":{"nowait":true},"getMeasuredFps":{"nowait":true},"getMeasuredRps":{"nowait":true},"measureFps":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.DxChar\',\n  shortName: \'DxChar\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.SpriteChar,\n  includes: [],\n  methods: {\n    main :function _trc_DxChar_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_DxChar_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_DxChar_initialize(xx,yy,pp,ff,sz,rt,al) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=44000057;//kernel.DxChar:57\n      Tonyu.classes.kernel.SpriteChar.apply( _this, [xx,yy,pp,ff]);\n      //$LASTPOS=44000082;//kernel.DxChar:82\n      _this.scaleX=1;\n      //$LASTPOS=44000097;//kernel.DxChar:97\n      if (sz) {\n        //$LASTPOS=44000105;//kernel.DxChar:105\n        _this.scaleX=sz;\n      }\n      //$LASTPOS=44000121;//kernel.DxChar:121\n      _this.angle=0;\n      //$LASTPOS=44000135;//kernel.DxChar:135\n      if (rt) {\n        //$LASTPOS=44000143;//kernel.DxChar:143\n        _this.angle=rt;\n      }\n      //$LASTPOS=44000158;//kernel.DxChar:158\n      _this.alpha=255;\n      //$LASTPOS=44000174;//kernel.DxChar:174\n      if (al) {\n        //$LASTPOS=44000182;//kernel.DxChar:182\n        _this.alpha=al;\n      }\n    },\n    draw :function _trc_DxChar_draw(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=44000212;//kernel.DxChar:212\n      _this.rotation=_this.angle;\n      //$LASTPOS=44000233;//kernel.DxChar:233\n      Tonyu.classes.kernel.SpriteChar.prototype.draw.apply( _this, [c]);\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}\n});\n',"js/index.html":'<script src="concat.js"></script>\n',"options.json":'{\n    "compiler":{\n        "namespace": "kernel",\n        "commentLastPos": true,\n        "outputFile": "js/concat.js"\n    }\n}\n',"physics/":'{"BodyActor.tonyu":{"lastUpdate":1437628346060},"T2Body.tonyu":{"lastUpdate":1425264703379},"T2Mod.tonyu":{"lastUpdate":1431610155789},"T2World.tonyu":{"lastUpdate":1431611371521}}',"physics/BodyActor.tonyu":'extends Actor;\nincludes T2Mod;\nnative Box2D;\n\n\\getWorld() {\n    if ($t2World) return $t2World;\n    $t2World=new T2World;\n    return $t2World;\n}\n\\onAppear() {\n    var wworld=getWorld();\n    world=wworld.world;\n    scale=wworld.scale;\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var b2BodyDef = Box2D.Dynamics.b2BodyDef;\n    var b2Body = Box2D.Dynamics.b2Body;\n    var b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n    var b2Fixture = Box2D.Dynamics.b2Fixture;\n    var b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n    var b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n    \n    var fixDef = new b2FixtureDef;\n    fixDef.density = defv(density, 1.0);\n    fixDef.friction = defv(friction, 0.5);\n    fixDef.restitution = defv(restitution, 0.2);\n    \n    var bodyDef = new b2BodyDef;\n    bodyDef.type = isStatic ? b2Body.b2_staticBody :\n    b2Body.b2_dynamicBody;\n    \n    bodyDef.position.x = x /scale;\n    bodyDef.position.y = y /scale;\n    shape=shape || (radius ? "circle" : "box");\n    var w=width,h=height;\n    if (!w) {\n        detectShape();\n        w=width*(scaleX||1);\n        h=height*(scaleY||scaleX||1);\n    }\n    if (shape=="box") {\n        if (!h) h=w;\n        fixDef.shape = new b2PolygonShape;\n        fixDef.shape.SetAsOrientedBox(w/2/scale, h/2/scale,\n        new b2Vec2(0,0),0);\n    } else {\n        radius=radius || w/2 || 16;\n        fixDef.shape = new b2CircleShape(\n        radius/scale\n        );\n        width=height=radius*2;\n    } \n    var fps=wworld.fps;\n    var r=rotation,ve=bvec(defv(vx*fps ,0),defv(vy*fps,0)),vr=defv(vrotation,0);\n    body=world.CreateBody(bodyDef);\n    body.CreateFixture(fixDef);\n    body.SetUserData(this);\n    body.SetLinearVelocity(ve);\n    rotation=r;\n    vrotation=vr;\n}\n\\allContactPoints(klass) {\n    var res=[],m,point;\n    var w=getWorld();\n    for (var c=world.GetContactList();c;c=c.GetNext()) {\n        if (c.IsTouching()) {\n	        c.GetWorldManifold(m=new Box2D.Collision.b2WorldManifold);\n            if (m.m_points[0]) {\n                if (m.m_points[1] && m.m_points[1].x && m.m_points[1].y) {\n	            	point={\n	            	x:(m.m_points[0].x+m.m_points[1].x)/2*w.scale, \n	            	y:(m.m_points[0].y+m.m_points[1].y)/2*w.scale};\n                } else {\n    	        	point={x:m.m_points[0].x*w.scale, y:m.m_points[0].y*w.scale};\n                } \n            } else point={x,y};\n            var a=c.GetFixtureA().GetBody().GetUserData();\n            var b=c.GetFixtureB().GetBody().GetUserData();\n            if (a===this) {\n                if (!klass || b===klass || b instanceof klass) {\n                    res.push{target:b, manifold:m, x:point.x,y:point.y };\n                }\n            } else if (b===this) {\n                if (!klass || a===klass || a instanceof klass) {\n                    res.push{target:a, manifold:m, x:point.x,y:point.y };\n                }\n            }\n        }\n    }\n    return res;\n}\n\\contactPoint(klass) {\n   return allContactPoints(klass)[0];\n}\n\\allContact(klass) {\n   return allContacts(klass);\n}\n\\allContacts(klass) {\n    var res=[];\n    for (var c=world.GetContactList();c;c=c.GetNext()) {\n        if (c.IsTouching()) {\n            var a=c.GetFixtureA().GetBody().GetUserData();\n            var b=c.GetFixtureB().GetBody().GetUserData();\n            if (a===this) {\n                if (!klass || b===klass || b instanceof klass) {\n                    res.push(b);\n                }\n            } else if (b===this) {\n                if (!klass || a===klass || a instanceof klass) {\n                    res.push(a);\n                }\n            }\n        }\n    }\n    return res;\n}\n\\applyForce(fx,fy,px,py) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var scale=getWorld().scale;\n    var fps=60;\n    body.ApplyForce(new b2Vec2(fx ,fy),body.GetPosition());\n}\n\\applyImpulse(fx,fy,px,py) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var scale=getWorld().scale;\n    var fps=60;\n    body.ApplyImpulse(new b2Vec2(fx ,fy),body.GetPosition());\n}\n\n\\applyTorque(a) {\n    body.ApplyTorque(a);\n}\n\\moveBy(dx,dy) {\n    var pos=body.GetPosition();\n    pos.x+=dx/scale;\n    pos.y+=dy/scale;\n    body.SetPosition(pos);\n}\n\\contactTo(t) {\n    return allContact(t)[0];\n}\n\\die() {\n    super.die();\n    world.DestroyBody(body);\n}\n\\addRevoluteJoint(params) {\n    // params:{x?,y?,other?}\n    params=params||{};\n    var px=params.x||x;\n    var py=params.y||y;\n    var wworld=getWorld();//wraped_world\n    var scale=wworld.scale;\n    var world=wworld.world;\n    var b2BodyDef = Box2D.Dynamics.b2BodyDef;\n    var b2Body = Box2D.Dynamics.b2Body;\n    var JDC=Box2D.Dynamics.Joints.b2RevoluteJointDef;\n    var jd=new JDC;\n    var bodyDef = new b2BodyDef;\n    bodyDef.type = b2Body.b2_staticBody;\n    bodyDef.position.x = px /scale;\n    bodyDef.position.y = py /scale;\n    var bodyB=world.CreateBody(bodyDef);\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    jd.Initialize(body,bodyB,new b2Vec2(px/scale, py/scale));\n    if (params.lowerAngle && params.upperAngle) {\n       jd.lowerAngle = rad(params.lowerAngle);\n       jd.upperAngle = rad(params.upperAngle);\n       jd.enableLimit = true;\n    }\n    world.CreateJoint(jd);    \n}\n\\rotation {\n    if (!body || manualRotation) return _rotation;\n    return deg(body.GetAngle());\n}\n\\rotation=r {\n    r=r||0;\n    if (!body || manualRotation) return _rotation=r;\n    body.SetAngle(rad(r));\n} \n\n\\updatePos() {\n/*    if (!body) return;\n    var scale=getWorld().scale;\n    var pos=body.GetPosition();\n    x=pos.x*scale;\n    y=pos.y*scale;*/\n}\n\n\\x {\n    if (!body) return _x;\n    var pos=body.GetPosition();\n    return pos.x*scale;\n}\n\\x=v {\n    if (!body) return _x=v;\n    v=v||0;\n    var pos=body.GetPosition();\n    pos.x=v/scale;\n    body.SetPosition(pos);\n}\n\\y {\n    if (!body) return _y;\n    var pos=body.GetPosition();\n    return pos.y*scale;\n}\n\\y=v {\n    if (!body) return _y=v;\n    v=v||0;\n    var pos=body.GetPosition();\n    pos.y=v/scale;\n    body.SetPosition(pos);\n}\n\n\\vx {\n    if (!body) return _vx;\n    var v=body.GetLinearVelocity();\n    return v.x*scale/getWorld().fps;\n}\n\\vx=v {\n    if (!body) return _vx=v;\n    v=v||0;\n    var ve=body.GetLinearVelocity();\n    ve.x=v/scale*getWorld().fps;\n    if (v) body.SetAwake(true);\n    body.SetLinearVelocity(ve);\n}\n\n\\vy {\n    if (!body) return _vy;\n    var v=body.GetLinearVelocity();\n    return v.y*scale/getWorld().fps;\n}\n\\vy=v {\n    if (!body) return _vy=v;\n    var ve=body.GetLinearVelocity();\n    ve.y=v/scale*getWorld().fps;\n    if (v) body.SetAwake(true);\n    body.SetLinearVelocity(ve);\n}\n\\vrotation {\n    if (!body) return _vr;\n    return deg(body.GetAngularVelocity()/getWorld().fps);\n}\n\\vrotation=v {\n    if (!body) return _vr=v;\n    v=v||0;\n    if (v) body.SetAwake(true);\n    body.SetAngularVelocity(rad(v*getWorld().fps));\n}\n\n',"physics/T2Body.tonyu":"extends BodyActor;\n","physics/T2Mod.tonyu":'native Box2D;\n\n\\bvec(tx,ty) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    return new b2Vec2(tx/scale,ty/scale);  \n}\n\n\\defv(t,d) {\n    return ( t===t && (typeof t)==="number") ? t : d;\n}\n\n',"physics/T2World.tonyu":'extends Actor;\n\nincludes T2Mod;\n\nnative Box2D;\nnative Tonyu;\n\\onAppear() {\n    $currentProject.requestPlugin("box2d");  \n    initWorld();\n}\nloop();\n\n\n\\initWorld() {\n    gravity=defv(gravity, 9.8);\n    gravityX=defv(gravityX, 0);\n    fps=$Boot.getFrameRate();\n    var b2World = Box2D.Dynamics.b2World;\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    scale=scale || 32;\n    world = new b2World(\n    new b2Vec2(gravityX, gravity)    //gravity\n    ,  true                 //allow sleep\n    );\n    $t2World=this;\n    $Boot.on("stop",releaseWorld);\n    on("die",releaseWorld);\n}\n\\releaseWorld() {\n    if ($t2World===this) $t2World=null;\n}\n\n\\loop() {\n    while(true) {\n        fps=$Boot.getFrameRate();\n        world.Step(\n        1 / fps  //frame-rate\n        ,  10       //velocity iterations\n        ,  10       //position iterations\n        );\n        //world.DrawDebugData();\n        world.ClearForces();\n        //updatePos();\n        update();\n    }\n}\n\\updatePos() {\n    for (var b=world.GetBodyList();b;b=b.GetNext()) {\n        var d=b.GetUserData();\n        if(d) d.updatePos();\n    }\n}\n',"sound/":'{"MediaPlayer.tonyu":{"lastUpdate":1421384204625},"MML.tonyu":{"lastUpdate":1424849946399},"PlayMod.tonyu":{"lastUpdate":1425018365373},"T2MediaPlayer.tonyu":{"lastUpdate":1432611755126},"WaveTable.tonyu":{"lastUpdate":1412697666000}}',"sound/MML.tonyu":'extends TObject;\nincludes MathMod;\nnative T;\n\nmmlBuf=[];\n\\play(mmls) {\n    mmlBuf.push(mmls);\n    if (!isPlaying()) {\n        playNext();\n    }\n}\n\\playNext() {\n    //print("play!", id(), bufferCount());\n    if (cTimeBase==null) cTimeBase=0;\n    if (m) {\n        cTimeBase+=m.currentTime;\n        //print(m.currentTime);\n    }\n    var mml=mmlBuf.shift();\n    if (!mml) {\n        m=null;\n        cTimeBase=0;\n        return;\n    }\n    mwav=$WaveTable.get(0,0).play();\n    m=T("mml", {mml}, mwav);\n    m.on("ended", playNext);\n    m.start();\n    $MMLS[id()]=this;\n}\n\\id() {\n    if (!_id) _id=rnd()+"";\n    return _id;\n}\n\\bufferCount() {\n    return mmlBuf.length;\n}\n\\isPlaying() {\n    return m;\n}\n\\currentTime() {\n    if (m) return m.currentTime+cTimeBase;\n    return -1;\n}\n\\stop() {\n    if (m) {\n        if (mwav) {\n            mwav.pause();\n            mwav.stop();\n        }\n        m.pause();\n        m.stop();\n        m=null;\n        mmlBuf=[];\n        //print("stop!", id(), bufferCount());\n        delete $MMLS[id()];\n    }\n}\n',"sound/MediaPlayer.tonyu":"\n\\play() {\n    \n}\n\\stop() {\n    \n}\n\\playSE() {\n    \n}\n\\setDelay(){\n    \n}\n\\setVolume(){\n    \n}","sound/PlayMod.tonyu":'extends BaseActor;\nnowait \\initMML() {\n    if (mmlInited) return;\n    mmlInited=true;\n    $currentProject.requestPlugin("timbre");\n    if (!$MMLS) {\n       $MMLS={};\n       $WaveTable=new WaveTable;\n       $Boot.on("stop", releaseMML);\n    }\n    on("die") \\() { play().stop(); };\n}\nnowait \\releaseMML() {\n    if ($MMLS) {\n       for (var k,v in $MMLS) {\n          v.stop();\n       }\n       $MMLS=null;\n    } \n    if ($WaveTable) {\n       $WaveTable.stop();\n       $WaveTable=null;\n    }\n}\n\\play() {\n    initMML();\n    if (!_mml) _mml=new MML;\n    if (isDead() || arguments.length==0) return _mml;\n    var mmls=[];\n    for (var i=0; i<arguments.length; i++) {\n        mmls.push(arguments[i]);\n    }\n    _mml.play(mmls);\n    while (_mml.bufferCount()>2) {\n        update();\n    }\n    return _mml;\n}\nnowait \\playSE() {\n    initMML();\n    var mml=new MML;\n    var mmls=[];\n    for (var i=0; i<arguments.length; i++) {\n        mmls.push(arguments[i]);\n    }\n    mml.play(mmls);\n    return mml;\n}\n',"sound/T2MediaPlayer.tonyu":'extends Actor;\n\nnative T2MediaLib;\nnative Tonyu;\n\n\\new() {\n    initT2MediaPlayer();\n}\n\n\\initT2MediaPlayer() {\n    if (T2MediaLib.inited) return;\n    T2MediaLib.init();\n    T2MediaLib.inited=true;\n    bgmPlayerMax = T2MediaLib.bgmPlayerMax;\n}\n\n\\clearSEData() {\n    T2MediaLib.allStopBGM();\n    T2MediaLib.allClearData();\n}\n\n\\clearBGMData() {\n    clearSEData();\n}\n\n\\deleteSEData(idx) {\n    T2MediaLib.clearData(idx);\n}\n\n// SE //\n\\loadSE(idx, src) {//@hoge1e3\n    // 非同期呼び出し\n    runAsync \\(succ,err) {\n       // 読み込み完了するまでブロッキング\n       T2MediaLib.loadSE(idx, src) {succ,err};\n    };\n    var data = T2MediaLib.getSEData(idx);\n    /*\n    while (data == null) {\n        update();\n        data = T2MediaLib.getSEData(idx);\n    }*/\n    return data;\n}\n\n\\available {\n    return !!T2MediaLib.context;\n}\n//@hoge1e3\n\\loadFromProject(prj) {\n    if (!available) return;\n    var r=prj.getResource();\n    if (!r || !r.sounds) return;\n    for (var s in r.sounds) {\n         var name=s.name, url=Tonyu.Assets.resolve(s.url, prj.getDir());\n         Tonyu.setGlobal(name, name);\n         try {\n            print("Loading Sound2: "+name);\n            loadSE(name, url);\n         } catch(e) {\n            print("Fail");\n            Tonyu.setGlobal(name, "ERROR");\n         }\n    }\n}\n\n\n// vol:0-128\n\\playSE(idx, vol, rate, offset, loop, loopStart, loopEnd) {\n    if (mute) return;\n    // vol : Tonyu1のように0～128の範囲にする\n    if (vol == null) vol = 128;\n    // vol はgainで実装しているため絶対値の大きい値を入れると危険\n    // そのため0.0～1.0の範囲になるようにする\n    if      (vol <   0) vol =   0;\n    else if (vol > 128) vol = 128;\n    return T2MediaLib.playSE(idx, vol / 128, rate, offset, loop, loopStart, loopEnd);\n}\n\n\\stopSE(sourceObj) {\n    return T2MediaLib.stopSE(sourceObj);\n}\n\n\\getSEData(idx) {\n    return T2MediaLib.getSEData(idx);\n}\n\n\n// BGM //\n\\loadBGM(idx, src) {\n    // 非同期呼び出し\n    T2MediaLib.loadBGM(idx, src);\n    // 読み込み完了するまでブロッキング\n    var data = T2MediaLib.getBGMData(idx);\n    while (data == null) {\n        update();\n        data = T2MediaLib.getBGMData(idx);\n    }\n    return data;\n}\n\n\\playBGM(idx, loop, offset, loopStart, loopEnd) {\n    if (mute) return;\n    if (loop === null) loop = false;\n    if (offset === null) offset = 0;\n    return T2MediaLib.playBGM(0, idx, loop, offset, loopStart, loopEnd);\n}\n\n\\stopBGM() {\n    return T2MediaLib.stopBGM(0);\n}\n\n\\pauseBGM() {\n    return T2MediaLib.pauseBGM(0);\n}\n\n\\resumeBGM() {\n    return T2MediaLib.resumeBGM(0);\n}\n\n\\setBGMVolume(vol) {\n    vol = vol / 128;\n    // vol はgainで実装しているため絶対値の大きい値を入れると危険\n    // そのため0.0～1.0の範囲になるようにする\n    if      (vol > 1.0) vol = 1.0;\n    else if (vol < 0.0) vol = 0.0;\n    return T2MediaLib.setBGMVolume(0, vol);\n}\n\n\\setBGMTempo(tempo) {\n    //if      (tempo > 4.0) tempo = 4.0;\n    //else if (tempo < 0.5) tempo = 0.5;\n    return T2MediaLib.setBGMTempo(0, tempo);\n}\n\n\\getBGMCurrentTime() {\n    return T2MediaLib.getBGMCurrentTime(0);\n}\n\n\\getBGMLength() {\n    return T2MediaLib.getBGMLength(0);\n}\n\n\\getBGMData(idx) {\n    return T2MediaLib.getBGMData(idx);\n}\n\n\n\n// BGM ID指定 //\n\\playBGMID(id, idx, loop, offset, loopStart, loopEnd) {\n    if (loop === null) loop = false;\n    if (offset === null) offset = 0;\n    return T2MediaLib.playBGM(id, idx, loop, offset, loopStart, loopEnd);\n}\n\n\\stopBGMID(id) {\n    return T2MediaLib.stopBGM(id);\n}\n\n\\pauseBGMID(id) {\n    return T2MediaLib.pauseBGM(id);\n}\n\n\\resumeBGMID(id) {\n    return T2MediaLib.resumeBGM(id);\n}\n\n\\setBGMVolumeID(id, vol) {\n    vol = vol / 128;\n    // vol はgainで実装しているため絶対値の大きい値を入れると危険\n    // そのため0.0～1.0の範囲になるようにする\n    if      (vol > 1.0) vol = 1.0;\n    else if (vol < 0.0) vol = 0.0;\n    return T2MediaLib.setBGMVolume(id, vol);\n}\n\n\\setBGMTempoID(id, tempo) {\n    //if      (tempo > 4.0) tempo = 4.0;\n    //else if (tempo < 0.5) tempo = 0.5;\n    return T2MediaLib.setBGMTempo(id, tempo);\n}\n\n\\getBGMCurrentTimeID(id) {\n    return T2MediaLib.getBGMCurrentTime(id);\n}\n\n\\getBGMLengthID(id) {\n    return T2MediaLib.getBGMLength(id);\n}\n\n\\sizeBGMID() {\n    return T2MediaLib.getBGMPlayerMax();\n}\n\n\\allStopBGM() {\n    T2MediaLib.allStopBGM();\n}\n\n\n\n\\loadAudio(idx, src) {\n    // 非同期呼び出し\n    T2MediaLib.loadAudio(idx, src);\n    // 読み込み完了するまでブロッキング\n    while (T2MediaLib.getAudioData(idx) == null) update();\n}\n\n\\playAudio(idx, loop, startTime) {\n    if (loop === null) loop = false;\n    if (startTime === null) startTime = 0;\n    return T2MediaLib.playAudio(idx, loop, startTime);\n}\n\n\\stopAudio() {\n    return T2MediaLib.stopAudio();\n}\n\n\\pauseAudio() {\n    return T2MediaLib.pauseAudio();\n}\n\n\\resumeAudio() {\n    return T2MediaLib.resumeAudio();\n}\n\n\\setAudioVolume(vol) {\n    vol = vol / 128;\n    if      (vol > 1.0) vol = 1.0;\n    else if (vol < 0.0) vol = 0.0;\n    return T2MediaLib.setAudioVolume(vol);\n}\n\n\\setAudioTempo(tempo) {\n    if      (tempo > 4.0) tempo = 4.0;\n    else if (tempo < 0.5) tempo = 0.5;\n    return T2MediaLib.setAudioTempo(tempo);\n}\n\n\\setAudioPosition(time) {\n    return T2MediaLib.setAudioPosition(time);\n}\n\n\\getAudioCurrentTime() {\n    return T2MediaLib.getAudioCurrentTime();\n}\n\n\\getAudioLength() {\n    return T2MediaLib.getAudioLength();\n}\n\n\\getAudioData(idx) {\n    return T2MediaLib.getAudioData(idx);\n}\n',"sound/WaveTable.tonyu":'extends TObject;\nnative T;\n\nwav={};\nenv={};\n\\setWav(num, synth) {\n    wav[num]=synth;\n}\n\\setEnv(num, synth) {\n    env[num]=synth;\n}\n\\get(w,e) {\n    var synth=T("OscGen") {osc:wav[w], env:env[e], mul:0.25};\n    return synth;\n}\n\\stop() {\n    /*for (var k,v in tbl) {\n        v.pause();\n        v.stop();\n    }*/\n}\n\nif (typeof T!=="undefined") {\n    //env=T("adsr", {a:0,d:200,s:0.5,r:10});\n    env = T("env",{table:[1, [0.6, 50], [0, 100]], releaseNode:2});\n    setEnv(0, env);\n    setWav(0, T("pulse"));\n    //    synth=T("OscGen") {wave:"pulse", env, mul:0.25};\n    //set(0,synth);    \n}\n',"t1/":'{"DxChar.tonyu":{"lastUpdate":1421384204610},"PlainChar.tonyu":{"lastUpdate":1429593897129},"SecretChar.tonyu":{"lastUpdate":1421384204695},"SpriteChar.tonyu":{"lastUpdate":1444289413782},"T1Line.tonyu":{"lastUpdate":1427965036844},"T1Map.tonyu":{"lastUpdate":1421384204728},"T1Page.tonyu":{"lastUpdate":1421384204737},"T1Text.tonyu":{"lastUpdate":1427965019581},"TextChar.tonyu":{"lastUpdate":1429503038967}}',"t1/DxChar.tonyu":"extends SpriteChar;\n\n\\new (xx,yy,pp,ff,sz,rt,al){\n    super(xx,yy,pp,ff);\n    scaleX=1;\n    if (sz) scaleX=sz;\n    angle=0;\n    if (rt) angle=rt;\n    alpha=255;\n    if (al) alpha=al;\n}\n\\draw(c) {\n    rotation=angle;\n    super.draw(c);\n}\n","t1/PlainChar.tonyu":'extends Actor;\n\nnative Tonyu;\nnative Math;\n\\new(x,y,p) {\n    if (Tonyu.runMode) {\n        /*if ($Scheduler) {\n            _th=$Scheduler.newThread(this, "tMain", []);\n        } else {\n            var thg=currentThreadGroup();\n            if (thg) _th=thg.addObj(this,"tMain");\n        }*/\n        _th=$Boot.schedule(this,"tMain",[]);\n        initSprite();\n    }\n    if (typeof x=="object") Tonyu.extend(this,x);\n    else if (typeof x=="number") {\n        this.x=x;\n        this.y=y;\n        this.p=p;\n    }\n}\n\\draw(c) {\n    onDraw();\n    if (_isInvisible) return;\n    super.draw(c);\n}\n\\setVisible(v) {\n    _isInvisible=!v;\n}\n\\onDraw() {\n\n}\n\\update() {\n    onUpdate();\n    super.update();\n}\n\\onUpdate() {\n\n}\n\\initSprite() {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    onAppear();\n}\n\\tMain() {\n    main();\n    die();\n}\n/*\\color(r,g,b) {\n    return "rgb("+[r,g,b].join(",")+")";\n}\n\n\\drawText(x,y,text,col,size) {\n    if ($debug) return;\n    if (!size) size=15;\n    if (!col) col="cyan";\n    var tp=all(T1Text).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,text,fillStyle:col, size,hidden:false};\n    }else {\n        new T1Text{x,y,text,fillStyle:col, size};\n    }\n}\n\\drawLine(x,y,tx,ty,col) {\n    if (!col) col="white";\n    var tp=all(T1Line).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,tx,ty,col};\n    }else {\n        new T1Line{x,y,tx,ty,col};\n    }\n}*/\n\\appear(t) {\n    return t;\n}\n\\trunc(f) {\n    return Math.trunc(f);\n}\n\\loadPage(page,arg){\n    all().die();\n    new page(arg);\n    die();\n}',"t1/SecretChar.tonyu":"extends PlainChar;\n\n\\draw(c) {\n    \n}","t1/SpriteChar.tonyu":'extends PlainChar;\n\n\\new(x,y,p,f) {\n    super(x,y,p);\n    this.f=f;\n    if (!this.x) this.x=0;\n    if (!this.y) this.y=0;\n    if (!this.p) this.p=0;\n    if (typeof scaleX!="number") scaleX=1;\n}\n\\draw(c) {\n    if (f) {\n        if (!scaleY) scaleY=scaleX;\n        scaleX*=-1;\n    }\n    super.draw(c);\n    if (f) scaleX*=-1;\n}',"t1/T1Line.tonyu":"extends Actor;\n\\draw(ctx) {\n    if (hidden) return;\n    \n    ctx.strokeStyle=col;\n    ctx.beginPath();\n    ctx.moveTo(x,y);\n    ctx.lineTo(tx,ty);\n    ctx.stroke();\n    hidden=true;\n}\n","t1/T1Map.tonyu":'extends Map;\nnative Tonyu;\nnative $;\n\n\\setBGColor(c) {\n    $Screen.setBGColor(c);\n}\n\\load(fileName) {\n    /*\n    o={\n        "chipWidth":"32","chipHeight":"32",\n        "pTable":[{name:"$pat_aaa", p:10}, {name:"$pat_bbb","p":25} ],\n        "baseData":[\n        [//map\n        [0,6],[0,5],[1,3],\n        [1,3],[1,2],[0,5]\n        ],\n        [//mapOn\n        [-1,-1],[1,4],[0,2],\n        [-1,-1],[-1,-1],[1,8]\n        ]\n        ]\n    }\n    */\n    var f=file("../maps/").rel(fileName);\n    var o=f.obj();\n    chipWidth=o.chipWidth;\n    chipHeight=o.chipHeight;\n    baseData=o.baseData;\n    mapTable=conv(baseData[0],o.pTable);\n    mapData=mapTable;\n    row=mapTable.length;\n    col=mapTable[0].length;\n    mapOnTable=conv(baseData[1],o.pTable);\n    mapOnData=mapOnTable;\n    \n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    initMap();   \n}\n\\conv(mat, tbl) {\n    var res=[];\n    mat.forEach \\(row) {\n        var rrow=[];\n        res.push(rrow);\n        row.forEach \\(dat) {// dat:[0,20]\n            var t=tbl[dat[0]];\n            if (t) rrow.push(Tonyu.globals[t.name]+dat[1]);\n            else rrow.push(dat[1]);\n        };\n    };\n    return res;\n}',"t1/T1Page.tonyu":"extends PlainChar;\n\n\\initGlobals() {\n    $chars=$Sprites.sprites;\n    $Boot.setFrameRate(60);\n    $clBlack=color(0,0,0);\n    $clRed=color(255,0,0);\n    $clGreen=color(0,255,0);\n    $clYellow=color(255,255,0);\n    $clBlue=color(0,0,255);\n    $clPink=color(255,0,255);\n    $clAqua=color(0,255,255);\n    $clWhite=color(255,255,255);\n    $mplayer=new MediaPlayer;\n}","t1/T1Text.tonyu":"extends Actor;\n\\draw(c) {\n    if (hidden) return;\n    c.font=size+\"px 'ＭＳ Ｐゴシック'\";\n    \n    super.draw(c);\n    hidden=true;\n}\n","t1/TextChar.tonyu":'extends PlainChar;\nincludes TextRectMod;\n\n\\new (xx,yy,t,c,s){\n    super(xx,yy);\n    text="";\n    col=$clWhite;\n    size=20;\n    if (!this.x) this.x=0;\n    if (!this.y) this.y=0;\n    if (t) text=t;\n    if (c) fillStyle=c;\n    if (s) size=s;\n}\n\\draw(ctx) {\n    if (!size) size=15;\n    if (!align) align="left";\n    if (!fillStyle) fillStyle="white";\n    ctx.fillStyle=fillStyle;\n    ctx.globalAlpha=this.alpha/255;\n    ctx.font=size+"px \'ＭＳ Ｐゴシック\'";\n    var rect=drawTextRect(ctx, text, x, y, size, align , "fill");\n    width=rect.w;\n    height=rect.h;\n    \n    //    fillStyle=col;\n    //super.draw(ctx);\n}',"thread/":'{"ParallelMod.tonyu":{"lastUpdate":1435654079714},"Scheduler.tonyu":{"lastUpdate":1434441149517},"ThreadGroupMod.tonyu":{"lastUpdate":1430106770277}}',"thread/ParallelMod.tonyu":"extends BaseActor;\nnative Tonyu;\n\nnowait \\parallel() {\n     var args=[];\n     for (var i=1; i<arguments.length; i++) {\n         args.push(arguments[i]);\n     }\n     var name=arguments[0];\n     var th;\n     th=$Boot.schedule(this,name,args);\n     return th;\n}\n\n","thread/Scheduler.tonyu":'extends TObject;\nnative Tonyu;\nnative console;\ncur=[];\nnext=[];\n\\addObj(obj,name,args) {\n    return newThread(obj, name, args);\n}\n\\newThread(obj, name, args, options) { //options:{pOrder, threadGroup}\n    name=name||"main";\n    args=args||[];\n    var th=Tonyu.thread();\n    th.apply(obj,name,args);\n    addToCur(th);\n    return th;\n}\n\\addToCur(th) {\n    cur.push(th);\n    th.scheduled=this;\n}\n\\addToNext(th) {\n    next.push(th);\n    th.scheduled=this;\n}\n\\stepsAll() {\n    for (var t in cur) {\n    	delete t.scheduled;\n        t.steps();\n        if (t.preempted) {\n            //console.log("Preempted: ",t);\n            addToNext(t);\n        }\n    }\n    cur=next;\n    next=[];\n}',"thread/ThreadGroupMod.tonyu":"extends null;\n\n\\addThread(t) {\n    threads=threads||[];\n    threads.push(t);\n}\n\\addThreadGroup(tg) {\n    threadGroups=threadGroups||[];\n    threadGroups.push(tg);\n}\n\\killThreadGroup() {\n    if (threads) {\n        for (var thread in threads) {\n            thread.kill();\n        }\n    }\n    if (threadGroups) {\n        for (var threadGroup in threadGroups) {\n            threadGroup.killThreadGroup();\n        }\n    }\n}","ui/":'{"GameConsole.tonyu":{"lastUpdate":1430361767671},"InputDevice.tonyu":{"lastUpdate":1437999921036},"Keys.tonyu":{"lastUpdate":1412697666000},"MapEditor.tonyu":{"lastUpdate":1437453536000},"MapEditorOLD.tonyu":{"lastUpdate":1421122943503},"Pad.tonyu":{"lastUpdate":1421122943510}}',"ui/GameConsole.tonyu":'extends Actor;\nnative Math;\n\n\\new (opt) {\n    //opt{ canvas:$("canvas")  }\n    extend(opt);\n    cw=canvas.width();\n    ch=canvas.height();\n    $Sprites=new Sprites;\n    $Screen=gameScreen=new GameScreen{width:465, height:465, sprites:$Sprites};\n    $FrontSprites=sprites=new Sprites;\n    sprites.add(gameScreen);\n    cctx=canvas[0].getContext("2d");    \n}\n\\shouldDraw1x1(srcw,srch,dstw,dsth) {\n    // srcw=465 -> dstw=460...665\n    var larger=200;\n    var smaller=5;\n    return srcw-smaller<=dstw && dstw<=srcw+larger &&\n    srch-smaller<=dsth && dsth<=srch+larger;\n}\n\\layout() {\n    cw=canvas.width();\n    ch=canvas.height();\n    var width=gameScreen.width;\n    var height=gameScreen.height;\n    var calcw=ch/height*width; // calch=ch\n    var calch=cw/width*height; // calcw=cw\n    if (calch>ch) calch=ch;\n    if (calcw>cw) calcw=cw;\n    if (shouldDraw1x1(width,height,calcw,calch)) {\n        calcw=width;calch=height;\n    }\n    var marginw=Math.floor((cw-calcw)/2);\n    var marginh=Math.floor((ch-calch)/2);\n    gameScreen.setBounds{left:marginw,top:marginh, width: calcw, height:calch};\n}\n\\draw() {\n    layout();\n    sprites.draw(canvas[0]);\n}\n',"ui/InputDevice.tonyu":'extends null;\nnative $;\nnative window;\nnative Tonyu;\nnative T2MediaLib;\n\\new() {\n    listeners=[];\n    touchEmu=true;\n}\n\\handleListeners() {\n    var l=listeners;\n    listeners=[];\n    while (l.length>0) { (l.shift())(); }\n}\n\\addOnetimeListener(l){\n    listeners.push(l);\n}\n\\initCanvasEvents(cvj) {\n    var cv=cvj[0];\n    $handleMouse=\\(e) {\n        var p=cvj.offset();\n        var mp={x:e.clientX-p.left, y:e.clientY-p.top};\n        mp=$Screen.canvas2buf(mp);\n        $mouseX=mp.x;\n        $mouseY=mp.y;\n        if (touchEmu) {\n            $touches[0].x=mp.x;\n            $touches[0].y=mp.y;\n        }\n        handleListeners();\n    };\n    $touches=[{},{},{},{},{}];\n    $touches.findById=\\(id) {\n        for (var j=0 ; j<$touches.length ; j++) {\n            if ($touches[j].identifier==id) {\n                return $touches[j];\n            }\n        }\n    };\n    $handleTouch=\\(e) {\n        T2MediaLib.activate();\n        touchEmu=false;\n        var p=cvj.offset();\n        e.preventDefault();\n        var ts=e.originalEvent.changedTouches;\n        for (var i =0 ; i<ts.length ; i++) {\n            var src=ts[i];\n            var dst=$touches.findById(src.identifier);\n            if (!dst) {\n                for (var j=0 ; j<$touches.length ; j++) {\n                    if (!$touches[j].touched) {\n                        dst=$touches[j];\n                        dst.identifier=src.identifier;\n                        break;\n                    }\n                }\n            }\n            if (dst) {\n                mp={x:src.pageX-p.left, y:src.pageY-p.top};\n                mp=$Screen.canvas2buf(mp);\n                dst.x=mp.x;\n                dst.y=mp.y;\n                if(!dst.touched) dst.touched=1;\n            }\n        }\n        $mouseX=$touches[0].x;\n        $mouseY=$touches[0].y;\n        handleListeners();\n    };\n    $handleTouchEnd=\\(e) {\n        var ts=e.originalEvent.changedTouches;\n        for (var i =0 ; i<ts.length ; i++) {\n            var src=ts[i];\n            var dst=$touches.findById(src.identifier);\n            if (dst) {\n                dst.touched=0;\n                dst.identifier=-1;\n            }\n        }\n        handleListeners();\n    };\n    var handleMouse=\\(e){$handleMouse(e);};\n    var handleTouch=\\(e){$handleTouch(e);};\n    var handleTouchEnd=\\(e){$handleTouchEnd(e);};\n    var d=$.data(cv,"events");\n    if (!d) {\n        $.data(cv,"events","true");\n        cvj.mousedown(handleMouse);\n        cvj.mousemove(handleMouse);\n        cvj.on("touchstart",handleTouch);\n        cvj.on("touchmove",handleTouch);\n        cvj.on("touchend",handleTouchEnd);\n    }\n}\n\n\\update() {\n    for (var i in $touches) {\n        if (i.touched>0) {i.touched++;}\n        if (i.touched==-1) i.touched=1;\n    }\n}',"ui/Keys.tonyu":'extends TObject;\nnative String;\nnative $;\nnative document;\n//\\new () {this.main();}\nstats={};\ncodes={\n    left: 37 , up:38 , right: 39, down:40, space:32, enter:13,\n    shift:16, ctrl:17, alt:18, mouseleft: 1\n};\nfor (var i=65 ; i<65+26; i++) {\n    codes[String.fromCharCode(i).toLowerCase()]=i;\n}\nfor (var i=48 ; i<58; i++) {\n    codes[String.fromCharCode(i)]=i;\n}\nif (!$.data(document,"key_event")) {\n    $.data(document,"key_event",true);\n    $(document).keydown \\(e) {$Keys.keydown(e);};\n    $(document).keyup \\(e) {$Keys.keyup(e);};\n    $(document).mousedown \\(e) {\n        if ($InputDevice.touchEmu) {\n            $touches[0].touched=1;\n        }\n        $Keys.keydown{keyCode:1};\n    };\n    $(document).mouseup \\(e) {\n        if ($InputDevice.touchEmu) {\n            $touches[0].touched=0;\n        }\n        $Keys.keyup{keyCode:1};\n    };\n}\nfunction getkey(code) {\n    if (typeof code=="string") {\n        code=codes[code.toLowerCase()];\n    }\n    if (!code) return 0;\n    if (stats[code]==-1) return 0;\n    if (!stats[code]) stats[code]=0;\n    return stats[code];\n}\nfunction update() {\n    for (var i in stats) {\n        if (stats[i]>0) {stats[i]++;}\n        if (stats[i]==-1) stats[i]=1;\n    }\n}\n\\keydown(e) {\n    var s=stats[e.keyCode];\n    if (!s) {\n        stats[e.keyCode]=1;\n    }\n    $InputDevice.handleListeners();\n}\n\\keyup(e) {\n    stats[e.keyCode]=0;\n    $InputDevice.handleListeners();\n}',"ui/MapEditor.tonyu":'extends Actor;\nnative prompt;\n$Screen.resize(480,640);\nloadMode=false;\nfileExist=false;\nprint("map file(s)");\nfileList=file("../maps/");\nfileList.recursive(function a(f){\n    f=f+"";\n    fNames=f.split("/");\n    print(fNames[fNames.length-1]);\n    fileExist=true;\n});\nif(fileExist){\n    print("Load Data?: Y or N");\n    while(true){\n        if(getkey("y")>0){\n            loadMode=true;\n            break;\n        }\n        if(getkey("n")>0){\n            loadMode=false;\n            break;\n        }\n        update();\n    }\n    if(loadMode){\n        fileName=prompt("Input json file (*.json)","map.json");\n        if(fileName){\n            mapDataFile=file("../maps/").rel(fileName);\n        }\n        if(mapDataFile.obj()){\n            baseData=mapDataFile.obj();\n        }else{\n            mapDataFile=file(fileName);\n            if(mapDataFile.obj()){\n                baseData=mapDataFile.obj();\n            }\n        }\n        if(baseData==undefined){\n            print("Load failed");\n            loadMode=false;\n        }else if(baseData[0] && baseData[1]){\n            mapData=baseData[0];\n            mapOnData=baseData[1];\n            if(baseData.length>2){\n                chipWidth=baseData[baseData.length-2];\n                chipHeight=baseData[baseData.length-1];\n            }\n        }\n    }\n}\nupdate();\n//if(mapData){\n    /*\n    print("Load Data?: Y or N");\n    while(true){\n        if(getkey("y")==1){\n            loadMode=true;\n            break;\n        }\n        if(getkey("n")==1){\n            loadMode=false;\n            break;\n        }\n    }*/\n//}\nif(!loadMode){\n    row=prompt("input row");\n    col=prompt("input col");\n    chipWidth=prompt("input chipWidth");\n    chipHeight=prompt("input chipHeight");\n    panel=new Panel{width:col*chipWidth,height:row*chipHeight};\n    panel.x=panel.width/2+40;\n    panel.y=panel.height/2+40;\n    panel.setFillStyle("cyan");\n    panel.fillRect(0,0,panel.width,panel.height);\n    $map=new Map{row,col,chipWidth,chipHeight};\n}else{\n    /*if(!mapOnData){\n        $map=new Map{row:mapData.length,col:mapData[0].length,chipWidth:32,chipHeight:32,mapData};\n    }else{\n        $map=new Map{row:mapData.length,col:mapData[0].length,chipWidth:32,chipHeight:32,mapData,mapOnData};\n    }*/\n    $map=new Map{chipWidth:32,chipHeight:32};\n    $map.load(fileName);\n    panel=new Panel{width:$map.col*$map.chipWidth,height:$map.row*$map.chipHeight,zOrder:100};\n    panel.x=panel.width/2+40;\n    panel.y=panel.height/2+40;\n    panel.setFillStyle("cyan");\n    panel.fillRect(0,0,panel.width,panel.height);\n}\n$mp=new Map{row:16,col:8,chipWidth:32,chipHeight:32};\ncounter=0;\nfor(var i=0;i<16;i++){\n    for(var j=0;j<8;j++){\n        $mp.set(j,i,$pat_mapchip+counter);\n        counter++;\n    }\n}\ndrawPanel();\nmode="get";\nprevMode="set";\nmapp=0;\nmx=-40;\nmy=-40;\nchipX=-40;\nchipY=-40;\nx=$screenWidth-chipWidth/2;\ny=$screenHeight-chipHeight/2;\n$map.scrollTo(mx,my);\nwhile(true){\n    p=mapp;\n    if(getkey("e")==1 || ($touches[0].touched==1 && $touches[0].x>0 && $touches[0].x<120 && $touches[0].y>560 && $touches[0].y<640)){\n        $mp.scrollTo(1000,1000);\n        mode="erase";\n        print(mode+" mode");\n    }\n    if(getkey("s")==1){\n        $mp.scrollTo(1000,1000);\n        if(mode=="set"){\n            mode="setOn";\n        }else{\n            mode="set";\n        }\n        print(mode+" mode");\n    }\n    if($touches[0].touched==1 && $touches[0].x>0 && $touches[0].x<120 && $touches[0].y>480 && $touches[0].y<560){\n        $mp.scrollTo(1000,1000);\n        mode="set";\n        print(mode+" mode");\n    }\n    if($touches[0].touched==1 && $touches[0].x>120 && $touches[0].x<240 && $touches[0].y>480 && $touches[0].y<560){\n        $mp.scrollTo(1000,1000);\n        mode="setOn";\n        print(mode+" mode");\n    }\n    if(getkey("o")==1){\n        $mp.scrollTo(1000,1000);\n        mode="setOn";\n    }\n    if(getkey("g")==1 || ($touches[0].touched==1 && $touches[0].x>240 && $touches[0].x<360 && $touches[0].y>480 && $touches[0].y<560)){\n        if(mode!="get"){\n            prevMode=mode;\n            $mp.scrollTo(-40,-40);\n            mode="get";\n            chipX=-40;\n            chipY=-40;\n        }else{\n            $mp.scrollTo(1000,1000);\n            mode=prevMode;\n        }\n        print(mode+" mode");\n    }\n    if(getkey("p")==1 || ($touches[0].touched==1 && $touches[0].x>360 && $touches[0].x<480 && $touches[0].y>480 && $touches[0].y<560)){\n        //add\n        saveFileName=prompt("input json file(*.json)","map.json");\n        /*print("mapTable=[");\n        data="[";\n        for(var i=0;i<$map.row-1;i++){\n            var tmp=[];\n            tmp=$map.mapTable[i].concat(tmp);\n            print("["+tmp+"],");\n            data+="["+tmp+"],";\n        }\n        var tmp=[];\n        tmp=$map.mapTable[i].concat(tmp);\n        print("["+tmp+"]");\n        data+="["+tmp+"]";\n        print("];");\n        data+="]";*/\n        //add\n        saveDataFile=file("../maps/").rel(saveFileName);\n        data=[$map.mapTable,$map.mapOnTable,$map.chipWidth,$map.chipHeight];\n        //comment\n        //mapDataFile.obj(data);\n        //add\n        saveDataFile.obj(data);\n        print(saveFileName+" Saved");\n        //mapDataFile.obj.push($map.mapOnTable);\n    }\n    if(getkey("c")==1 || ($touches[0].touched==1 && $touches[0].x>120 && $touches[0].x<240 && $touches[0].y>560 && $touches[0].y<640)){\n        $mp.scrollTo(1000,1000);\n        mode="copy";\n        print(mode+" mode");\n    }\n    if(mode!="get"){\n        if(getkey("left")>0 || ($touches[0].touched && $touches[0].x>0 && $touches[0].x<40 && $touches[0].y<480)) mx=mx+8;\n        if(getkey("right")>0 || ($touches[0].touched && $touches[0].x>$screenWidth-40 && $touches[0].x<$screenWidth && $touches[0].y<480)) mx=mx-8;\n        if(getkey("up")>0 || ($touches[0].touched && $touches[0].x>0 && $touches[0].x<$screenWidth && $touches[0].y<40)) my=my+8;\n        if(getkey("down")>0 || ($touches[0].touched && $touches[0].x>0 && $touches[0].x<$screenWidth && $touches[0].y<480&&$touches[0].y>440)) my=my-8;\n        $map.scrollTo(mx,my);\n    }else{\n        if(getkey("left")>0 || ($touches[0].touched && $touches[0].x>0 && $touches[0].x<40 && $touches[0].y<480)) chipX=chipX+8;\n        if(getkey("right")>0 || ($touches[0].touched && $touches[0].x>$screenWidth-40 && $touches[0].x<$screenWidth && $touches[0].y<480)) chipX=chipX-8;\n        if(getkey("up")>0 || ($touches[0].touched && $touches[0].x>0 && $touches[0].x<$screenWidth && $touches[0].y<40)) chipY=chipY+8;\n        if(getkey("down")>0 || ($touches[0].touched && $touches[0].x>0 && $touches[0].x<$screenWidth && $touches[0].y<480&&$touches[0].y>440)) chipY=chipY-8;\n        $mp.scrollTo(chipX,chipY);\n    }\n    panel.x=panel.width/2-mx;\n    panel.y=panel.height/2-my;\n    if(mode=="set" && getkey(1)>0 && inRect()){\n        $map.setAt($mouseX+mx,$mouseY+my,mapp);\n        $map.setOnAt($mouseX+mx,$mouseY+my,-1);\n    }else if(mode=="erase" && getkey(1)>0 && inRect()){\n        $map.setAt($mouseX+mx,$mouseY+my,-1);\n    }else if(mode=="get" && getkey(1)>0 && inRect()){\n        mapp=$mp.getAt($mouseX+chipX,$mouseY+chipY);\n        mode=prevMode;\n        $mp.scrollTo(1000,1000);\n        print(mode+" mode");\n        updateEx(10);\n    }else if(mode=="setOn" && getkey(1)>0 && inRect()){\n        $map.setOnAt($mouseX+mx,$mouseY+my,mapp);\n    }else if(mode=="copy" && getkey(1)>0 && inRect()){\n        mapp=$map.getAt($mouseX+mx,$mouseY+my);\n        mode="set";\n        print(mode+" mode");\n        updateEx(10);\n    }\n    update();\n}\nfunction inRect(){\n    return $mouseX > 40 && $mouseX < $screenWidth-40 && \n    $mouseY > 40 && $mouseY < $screenHeight-200;\n}\nfunction drawPanel(){\n    $panel.setFillStyle("gray");\n    $panel.alpha=128;\n    $panel.fillRect(0,0,$screenWidth,40);\n    $panel.fillRect(0,0,40,$screenHeight-160);\n    $panel.fillRect($screenWidth-40,0,40,$screenHeight-160);\n    $panel.fillRect(0,$screenHeight-200,$screenWidth,40);\n    $panel.alpha=255;\n    $panel.setFillStyle("black");\n    //lower panel\n    $panel.fillRect(0,$screenHeight-160,120,80);\n    $panel.fillRect(120,$screenHeight-160,120,80);\n    $panel.fillRect(240,$screenHeight-160,120,80);\n    $panel.fillRect(360,$screenHeight-160,120,80);\n    $panel.fillRect(0,$screenHeight-80,120,80);\n    $panel.fillRect(120,$screenHeight-80,120,80);\n    $panel.setFillStyle("white");\n    $panel.fillRect(10,$screenHeight-150,100,60);\n    $panel.fillRect(130,$screenHeight-150,100,60);\n    $panel.fillRect(250,$screenHeight-150,100,60);\n    $panel.fillRect(370,$screenHeight-150,100,60);\n    $panel.fillRect(10,$screenHeight-70,100,60);\n    $panel.fillRect(130,$screenHeight-70,100,60);\n    $panel.setFillStyle("black");\n    //dir\n    $panel.fillText("▲",$screenWidth/2,30,40,"center");\n    $panel.fillText("◀",20,($screenHeight-200)/2,40,"center");\n    $panel.fillText("▼",$screenWidth/2,$screenHeight-160-10,40,"center");\n    $panel.fillText("▶",$screenWidth-20,($screenHeight-200)/2,40,"center");\n    //set setOn letter etc\n    $panel.fillText("set",$screenWidth/4-60,$screenHeight-110,40,"center");\n    $panel.fillText("setOn",$screenWidth/4+60,$screenHeight-110,35,"center");\n    $panel.fillText("get",$screenWidth/2+60,$screenHeight-110,40,"center");\n    $panel.fillText("save",$screenWidth-60,$screenHeight-110,40,"center");\n    $panel.fillText("erase",$screenWidth/4-60,$screenHeight-30,35,"center");\n    $panel.fillText("copy",$screenWidth/4+60,$screenHeight-30,35,"center");\n}',"ui/MapEditorOLD.tonyu":'extends Actor;\nnative prompt;\nloadMode=false;\nprint("Load Data?: Y or N");\nwhile(true){\n    if(getkey("y")>0){\n        loadMode=true;\n        break;\n    }\n    if(getkey("n")>0){\n        loadMode=false;\n        break;\n    }\n    update();\n}\nif(loadMode){\n    fileName=prompt("Input json file (*.json)","map.json");\n    if(fileName){\n        mapDataFile=file("../maps/").rel(fileName);\n    }\n    if(mapDataFile.obj()){\n        baseData=mapDataFile.obj();\n    }else{\n        mapDataFile=file(fileName);\n        if(mapDataFile.obj()){\n            baseData=mapDataFile.obj();\n        }\n    }\n    if(baseData==undefined){\n        print("Load failed");\n        loadMode=false;\n    }else if(baseData[0] && baseData[1]){\n        mapData=baseData[0];\n        mapOnData=baseData[1];\n    }\n}\nupdate();\n//if(mapData){\n    /*\n    print("Load Data?: Y or N");\n    while(true){\n        if(getkey("y")==1){\n            loadMode=true;\n            break;\n        }\n        if(getkey("n")==1){\n            loadMode=false;\n            break;\n        }\n    }*/\n//}\nif(!loadMode){\n    row=prompt("input row");\n    update();\n    col=prompt("input col");\n    panel=new Panel{width:col*32,height:row*32};\n    panel.x=panel.width/2+10;\n    panel.y=panel.height/2;\n    panel.setFillStyle("cyan");\n    panel.fillRect(0,0,panel.width,panel.height);\n    $map=new Map{row,col,chipWidth:32,chipHeight:32};\n}else{\n    if(!mapOnData){\n        $map=new Map{row:mapData.length,col:mapData[0].length,chipWidth:32,chipHeight:32,mapData};\n    }else{\n        $map=new Map{row:mapData.length,col:mapData[0].length,chipWidth:32,chipHeight:32,mapData,mapOnData};\n    }\n    panel=new Panel{width:$map.col*32,height:$map.row*32,zOrder:100};\n    panel.x=panel.width/2;\n    panel.y=panel.height/2;\n    panel.setFillStyle("cyan");\n    panel.fillRect(0,0,panel.width,panel.height);\n}\n$mp=new Map{row:16,col:8,chipWidth:32,chipHeight:32};\ncounter=0;\nfor(var i=0;i<16;i++){\n    for(var j=0;j<8;j++){\n        $mp.set(j,i,$pat_mapchip+counter);\n        counter++;\n    }\n}\nmode="get";\nprevMode="set";\nmapp=0;\nmx=0;\nmy=0;\nchipX=0;\nchipY=0;\nx=$screenWidth-16;\ny=$screenHeight-16;\nwhile(true){\n    p=mapp;\n    if(getkey("e")==1){\n        $mp.scrollTo(1000,1000);\n        mode="erase";\n        print(mode+" mode");\n    }\n    if(getkey("s")==1){\n        $mp.scrollTo(1000,1000);\n        if(mode=="set"){\n            mode="setOn";\n        }else{\n            mode="set";\n        }\n        print(mode+" mode");\n    }\n    if(getkey("o")==1){\n        $mp.scrollTo(1000,1000);\n        mode="setOn";\n    }\n    if(getkey("g")==1){\n        if(mode!="get"){\n            prevMode=mode;\n            $mp.scrollTo(0,0);\n            mode="get";\n            chipX=0;\n            chipY=0;\n        }else{\n            $mp.scrollTo(1000,1000);\n            mode=prevMode;\n        }\n        print(mode+" mode");\n    }\n    if(getkey("p")==1){\n        //add\n        saveFileName=prompt("input json file(*.json)","map.json");\n        /*print("mapTable=[");\n        data="[";\n        for(var i=0;i<$map.row-1;i++){\n            var tmp=[];\n            tmp=$map.mapTable[i].concat(tmp);\n            print("["+tmp+"],");\n            data+="["+tmp+"],";\n        }\n        var tmp=[];\n        tmp=$map.mapTable[i].concat(tmp);\n        print("["+tmp+"]");\n        data+="["+tmp+"]";\n        print("];");\n        data+="]";*/\n        //add\n        saveDataFile=file("../maps/").rel(saveFileName);\n        data=[$map.mapTable,$map.mapOnTable];\n        //comment\n        //mapDataFile.obj(data);\n        //add\n        saveDataFile.obj(data);\n        print(saveFileName+" Saved");\n        //mapDataFile.obj.push($map.mapOnTable);\n    }\n    if(getkey("c")==1){\n        $mp.scrollTo(1000,1000);\n        mode="spuit";\n        print(mode+" mode");\n    }\n    if(mode!="get"){\n        if(getkey("left")>0) mx=mx+8;\n        if(getkey("right")>0) mx=mx-8;\n        if(getkey("up")>0) my=my+8;\n        if(getkey("down")>0) my=my-8;\n        $map.scrollTo(mx,my);\n    }else{\n        if(getkey("left")>0) chipX=chipX+8;\n        if(getkey("right")>0) chipX=chipX-8;\n        if(getkey("up")>0) chipY=chipY+8;\n        if(getkey("down")>0) chipY=chipY-8;\n        $mp.scrollTo(chipX,chipY);\n    }\n    panel.x=panel.width/2-mx;\n    panel.y=panel.height/2-my;\n    if(mode=="set" && getkey(1)>0){\n        $map.setAt($mouseX+mx,$mouseY+my,mapp);\n        $map.setOnAt($mouseX+mx,$mouseY+my,-1);\n    }else if(mode=="erase" && getkey(1)>0){\n        $map.setAt($mouseX+mx,$mouseY+my,-1);\n    }else if(mode=="get" && getkey(1)>0){\n        mapp=$mp.getAt($mouseX+chipX,$mouseY+chipY);\n        mode=prevMode;\n        $mp.scrollTo(1000,1000);\n        print(mode+" mode");\n        updateEx(10);\n    }else if(mode=="setOn" && getkey(1)>0){\n        $map.setOnAt($mouseX+mx,$mouseY+my,mapp);\n    }else if(mode=="spuit" && getkey(1)>0){\n        mapp=$map.getAt($mouseX+mx,$mouseY+my);\n        mode="set";\n        print(mode+" mode");\n        updateEx(10);\n    }\n    update();\n}',"ui/Pad.tonyu":"extends Actor;\n\\new(opt) {\n    super(opt);\n    padImageP = $pat_inputPad;\n    jujiKey = new Actor{x:96+1, y:$screenHeight-96-1, p:padImageP+0,zOrder:-9,layer:$FrontSprites};\n    no1Key = new Actor{x:$screenWidth-96, y:$screenHeight-96, p:padImageP+1,zOrder:-9,layer:$FrontSprites};\n    jujiKey.show();\n    no1Key.show();\n    \n    jujiKeyPushU = new Actor{x:jujiKey.x, y:jujiKey.y-60, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushL = new Actor{x:jujiKey.x-60, y:jujiKey.y, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushR = new Actor{x:jujiKey.x+60, y:jujiKey.y, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushD = new Actor{x:jujiKey.x, y:jujiKey.y+60, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPush1 = new Actor{x:no1Key.x, y:no1Key.y, p:padImageP+2, scaleX:2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushU.hide();\n    jujiKeyPushL.hide();\n    jujiKeyPushR.hide();\n    jujiKeyPushD.hide();\n    jujiKeyPush1.hide();\n}\n\\die(){\n    jujiKey.die();\n    no1Key.die();\n    jujiKeyPushU.die();\n    jujiKeyPushL.die();\n    jujiKeyPushR.die();\n    jujiKeyPushD.die();\n    jujiKeyPush1.die();\n    super.die();\n}\nAPAD_DIAG_SIZE = 96;\n\\padUpdate() {\n    // 操作 //\n    keyPushL = 0;\n    keyPushR = 0;\n    keyPushU = 0;\n    keyPushD = 0;\n    keyPush1 = 0;\n    \n    padKeyNotapCnt ++;\n    for (var i=0; i<5; i++) { // タップ判定・マウス判定 //\n        var t = $touches[i];\n        if (t.touched) {\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-APAD_DIAG_SIZE/2, jujiKey.y-32-64, 64+APAD_DIAG_SIZE, 64)) keyPushU = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-APAD_DIAG_SIZE/2, jujiKey.y-32+64, 64+APAD_DIAG_SIZE, 64)) keyPushD = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-64, jujiKey.y-32-APAD_DIAG_SIZE/2, 64, 64+APAD_DIAG_SIZE)) keyPushL = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32+64, jujiKey.y-32-APAD_DIAG_SIZE/2, 64, 64+APAD_DIAG_SIZE)) keyPushR = 1;\n            if (isOnRectWH(t.x, t.y, no1Key.x-64, no1Key.y-64, 128, 128)) keyPush1 = 1;\n            padKeySW = 1;\n            padKeyNotapCnt = 0;\n        }\n    }\n    \n    // カウントアップ\n    if (keyPushL) keyCntL ++; else keyCntL = 0;\n    if (keyPushR) keyCntR ++; else keyCntR = 0;\n    if (keyPushU) keyCntU ++; else keyCntU = 0;\n    if (keyPushD) keyCntD ++; else keyCntD = 0;\n    if (keyPush1) keyCnt1 ++; else keyCnt1 = 0;\n    \n    // 表示\n    if (keyPushL) jujiKeyPushL.show(); else jujiKeyPushL.hide();\n    if (keyPushR) jujiKeyPushR.show(); else jujiKeyPushR.hide();\n    if (keyPushU) jujiKeyPushU.show(); else jujiKeyPushU.hide();\n    if (keyPushD) jujiKeyPushD.show(); else jujiKeyPushD.hide();\n    if (keyPush1) jujiKeyPush1.show(); else jujiKeyPush1.hide();\n    \n}\n\n\\getPadUp()    { return keyCntU; }\n\\getPadDown()  { return keyCntD; }\n\\getPadLeft()  { return keyCntL; }\n\\getPadRight() { return keyCntR; }\n\\getPadButton(i) {\n    var value;\n    if (i == 0) value = keyCnt1;\n    return value;\n}\n\n\\getUp()    { return keyCntU; }\n\\getDown()  { return keyCntD; }\n\\getLeft()  { return keyCntL; }\n\\getRight() { return keyCntR; }\n\\getButton(i) {\n    var value;\n    if (i == 0) value = keyCnt1;\n    return value;\n}\n\n// 範囲 //\n\\isOnRect(mx, my, rx, ry, rx2, ry2) {\n    return (rx <= mx && mx < rx2 && ry <= my && my < ry2);\n}\n\n// 範囲 //\n\\isOnRectWH(mx, my, rx, ry, rw, rh) {\n    return (rx <= mx && mx < rx+rw && ry <= my && my < ry+rh);\n}\n\nwhile(true) {\n    padUpdate();\n    update();\n}"}};
WebSite.devMode||WebSite.disableROM["ROM_k.js"]||WebSite.isNW?n.base="/ROM"+n.base:FS.mountROM(n)}(),requireSimulator.setName("Tonyu"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return Tonyu=function(){function n(){function n(){return null!=$&&g}function e(){return P}function t(){O=!0,v=0}function r(n){$={prev:$,func:n}}function a(n,e,t){t||(t=[]);var i;"string"==typeof e&&(i=n["fiber$"+e]),"function"==typeof e&&(i=e.fiber),t=[m].concat(t);var a=0;r(function(){switch(a){case 0:i.apply(n,t),a=1;break;case 1:h(),a=2}})}function s(){if($)try{$.func(m)}catch(n){o(n)}}function o(n){if(0==m.tryStack.length)return f(),void i(n);m.lastEx=n;for(var e=m.tryStack.pop();$;){if(e.frame===$){m.catchPC=e.catchPC;break}$=$.prev}}function l(){var n=m.lastEx;return m.lastEx=null,n}function h(n){$=$?$.prev:null,m.retVal=n}function u(n){m.tryStack.push({frame:$,catchPC:n})}function c(){m.tryStack.pop()}function _(n,e){if(t(),n.on){var r;e=e.concat(function(){m.lastEvent=arguments,m.retVal=arguments[0],r.remove(),p()}),r=n.on.apply(n,e)}}function d(n){var e=function(){m.retVal=arguments,p()},r=function(){for(var n="",e=0;e<arguments.length;e++)n+=arguments[e]+",";0==n.length&&(n="Async fail");var t=new Error(n);t.args=arguments,o(t),p()};n(e,r),t()}function T(e){P=!0,t(),e&&e.addTerminatedListener&&e.addTerminatedListener(function(){if(P=!1,m.group)m.group.notifyResume();else if(n())try{m.steps()}catch(e){i(e)}})}function S(n){m.group=n,n&&n.add(m)}function p(){var e=Tonyu.currentThread;for(Tonyu.currentThread=m,v=A,m.preempted=!1,O=!1;v-->0&&$;)s();m.preempted=!O&&n(),Tonyu.currentThread=e}function f(){g=!1,$=null}function y(){$=null,tryStack=[]}var m={enter:r,apply:a,exit:h,steps:p,step:s,isAlive:n,isWaiting:e,suspend:t,retVal:0,tryStack:[],kill:f,waitFor:T,setGroup:S,enterTry:u,exitTry:c,startCatch:l,waitEvent:_,runAsync:d,clearFrame:y},$=null,g=!0,v=0,P=!1,O=!1;return m}function e(n){var e={},t=[];return e.addTerminatedListener=function(n){t.push(n)},setTimeout(function(){t.forEach(function(n){n()})},n),e}function t(){var n=[],e=[],t=!1;return n.addTerminatedListener=function(n){t?setTimeout(n,0):e.push(n)},n.receiver=function(){t=!0;for(var e=0;e<arguments.length;e++)n[e]=arguments[e];n.notify()},n.notify=function(){e.forEach(function(n){n()})},n}function r(){function e(n){n.group=l,_?_.push(n):h.push(n)}function t(t,r,i){r||(r="main");var a=n();return a.apply(t,r,i),e(a),a}function r(){try{a()}catch(n){i(n)}}function a(){function n(n){n.isWaiting()||(c=!1,n.steps())}for(var e=h.length-1;e>=0;e--){var t=h[e];t.isAlive()&&t.group===l||h.splice(e,1)}for(c=!0,_=[],h.forEach(n);_.length>0;)w=_,_=[],w.forEach(function(e){h.push(e),n(e)});_=null}function s(){u=!1}function o(){}var l,h=[],u=!0,c=!1,_=null;return l={add:e,addObj:t,steps:r,kill:s,notifyResume:o,threads:h}}function i(n){if(!Tonyu.onRuntimeError)throw alert("エラー! at "+$LASTPOS+" メッセージ  : "+n),n;Tonyu.onRuntimeError(n)}function a(n){if(n===Function)return null;if("function"==typeof n)n.constructor=null;else if("object"==typeof n)for(var e in n)n[e]=a(n[e]);return n}function s(){var n,e,t=[];if(1==arguments.length)e=arguments[0];else if(2==arguments.length&&"function"==typeof arguments[0])n=arguments[0],e=arguments[1];else if(2==arguments.length&&arguments[0]instanceof Array)t=arguments[0],e=arguments[1];else{if(3!=arguments.length)throw console.log(arguments),"Invalid argument spec";if(n=arguments[0],!n)throw console.log(arguments[2]),new Error("No parent class ");t=arguments[1],e=arguments[2]}e=a(e);var r=e.initialize?e.initialize:n?function(){n.apply(this,arguments)}:function(){};delete e.initialize,r.methods=e,t.forEach(function(n){if(!n.methods)throw n+" Does not have methods";for(var t in n.methods)t in e||(e[t]=n.methods[t])}),r.prototype=l(n,e),r.prototype.isTonyuObject=!0,o(r,{superclass:n?n.meta:null,includes:t.map(function(n){return n.meta})});var i=s.getMeta(r);return r.prototype.getClassInfo=function(){return i},r}function o(n,e){n.meta=n.meta||{},h(n.meta,e)}function l(n,e){return n?h(new n,e):e}function h(n,e){if(e&&"object"==typeof e)for(var t in e)n[t]=e[t];return n}function u(n,e){$[n]=e}function c(n){return $[n]}function _(n){var e=n.split("."),t=g;if(e.forEach(function(n){t&&(t=t[n])}),!t&&1==e.length){var r;for(var i in g){var a=g[i][n];if(a){if(t)throw new Error("曖昧なクラス名： "+i+"."+n+", "+r);t=a,r=i+"."+n}}}return t}function d(n,e){var t=function(){return e.apply(n,arguments)};return t.methodInfo=Tonyu.extend({thiz:n},e.methodInfo||{}),e.fiber&&(t.fiber=function(){return e.fiber.apply(n,arguments)},t.fiber.methodInfo=Tonyu.extend({thiz:n},e.fiber.methodInfo||{})),t}function T(n,e,t,r){if(!n)throw new Error(r+"(="+n+")のメソッド "+e+"を呼び出せません");var i=n[e];if("function"!=typeof i)throw new Error(("this"==r?"":r+".")+e+"(="+i+")はメソッドではありません");return i.apply(n,t)}function S(n,e,t){if("function"!=typeof n)throw new Error(t+"は関数ではありません");return n.apply({},e)}function p(n,e){if(n!=n||null==n)throw new Error(e+"(="+n+")は初期化されていません");return n}function f(n){for(var e=[],t=1;t<n.length;t++)e[t-1]=n[t];return e}function y(n){throw console.log("Not a tonyu object: ",n),n+" is not a tonyu object"}function m(n,e){return n in e}var A=60;s.addMeta=o,s.getMeta=function(n){return n.meta},s.ensureNamespace=function(n,e){var t,r=e.split("."),i=n;for(t=0;t<r.length;t++){var a=r[t];i[a]||(i[a]={}),i=i[a]}return i},s.define=function(n){var e=n.superclass,t=n.includes,r=n.fullName,i=n.shortName,h=n.namespace,u=n.methods,c=n.decls,_=s.ensureNamespace(Tonyu.classes,h),d=a(u),T=d.initialize;delete d.initialize;var S=T?e?function(){Tonyu.runMode?T.apply(this,arguments):e.apply(this,arguments)}:function(){Tonyu.runMode&&T.apply(this,arguments)}:e?function(){e.apply(this,arguments)}:function(){};_[i]=S,S.methods=d,t.forEach(function(n){if(!n.methods)throw n+" Does not have methods";for(var e in n.methods)e in d||(d[e]=n.methods[e])});var p={},f=/^__([gs]et)ter__(.*)$/;for(var y in d)if(!y.match(/^fiber\$/)){d["fiber$"+y]&&(d[y].fiber=d["fiber$"+y],d[y].fiber.methodInfo={name:y,klass:S,fiber:!0}),d[y].methodInfo={name:y,klass:S};var m=f.exec(y);m&&(p[m[2]]=p[m[2]]||{},p[m[2]][m[1]]=d[y])}S.prototype=l(e,d),S.prototype.isTonyuObject=!0;for(var y in p)Object.defineProperty(S.prototype,y,p[y]);o(S,{fullName:r,shortName:i,namepsace:h,decls:c,superclass:e?e.meta:null,func:S,includes:t.map(function(n){return n.meta})});var A=s.getMeta(S);return S.prototype.getClassInfo=function(){return A},S};var $={},g={};return Tonyu={thread:n,threadGroup:r,klass:s,bless:l,extend:h,globals:$,classes:g,setGlobal:u,getGlobal:c,getClass:_,timeout:e,asyncResult:t,bindFunc:d,not_a_tonyu_object:y,hasKey:m,invokeMethod:T,callFunc:S,checkNonNull:p,VERSION:1444289877223,A:f}}()}),requireSimulator.setName("Tonyu.Iterator"),define(["Tonyu"],function(){function n(n,e){var t={};if(n.tonyuIterator)return n.tonyuIterator(e);if(n instanceof Array)t.i=0,t.next=1==e?function(){return t.i>=n.length?!1:(this[0]=n[t.i],t.i++,!0)}:function(){return t.i>=n.length?!1:(this[0]=t.i,this[1]=n[t.i],t.i++,!0)};else{if(!(n instanceof Object))throw console.log(n),new Error(n+" is not iterable");t.i=0;var r=[];if(1==e){for(var i in n)r.push(i);t.next=function(){return t.i>=r.length?!1:(this[0]=r[t.i],t.i++,!0)}}else{for(var i in n)r.push([i,n[i]]);t.next=function(){return t.i>=r.length?!1:(this[0]=r[t.i][0],this[1]=r[t.i][1],t.i++,!0)}}}return t}return Tonyu.iterator=n,n}),requireSimulator.setName("IndentBuffer"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return IndentBuffer=function(){var n=function(){function e(){i++;var n=t[i];if(null==n)throw console.log(t),new Error(i+"th null param: fmt="+r);return n}for(var t=arguments,r=t[0],i=0;;){var a=r.indexOf("%");if(0>a){n.buf+=r;break}n.buf+=r.substring(0,a),a++;var s=r.charAt(a);if("s"==s){var o=e();"string"==typeof o||"number"==typeof o||(null==o?o="null":o.text&&(o=o.text)),n.buf+=o,a++}else if("d"==s){var l=e();if("number"!=typeof l)throw new Error(l+" is not a number: fmt="+r);n.buf+=l,a++}else if("n"==s)n.ln(),a++;else if("{"==s)n.indent(),a++;else if("}"==s)n.dedent(),a++;else if("%"==s)n.buf+="%";else if("f"==s)e()(n),a++;else if("l"==s){var h=e();n.buf+=n.toLiteral(h),a++}else if("v"==s){var u=e();if(!u)throw new Error("Null %v");if("object"!=typeof u)throw new Error("nonobject %v:"+u);n.visitor.visit(u),a++}else if("z"==s){var c=e();if("val"in c)return void(n.buf+=c.val);c.gen||n.lazy(c),n.buf+=c.gen,a++}else if("j"==s){var _=e(),d=_[0],T=_[1],S=!1;if(!T||!T.forEach)throw console.log(T),new Error(T+" is not array. cannot join fmt:"+r);T.forEach(function(e){S&&n.printf(d),S=!0,n.visitor.visit(e)}),a++}else"D"==s?(e(),a++):a+=2;r=r.substring(a)}};return n.print=function(e){n.buf+=e},n.printf=n,n.buf="",n.lazy=function(e){return e||(e={}),e.gen=("GENERETID"+Math.random()+"DITERENEG").replace(/\W/g,""),e.reg=new RegExp(e.gen,"g"),e.put=function(e){return this.val=e,n.buf=n.buf.replace(this.reg,e),e},e},n.ln=function(){n.buf+="\n"+n.indentBuf},n.indent=function(){n.indentBuf+=n.indentStr,n.buf+="\n"+n.indentBuf},n.dedent=function(){var e=n.indentStr.length;if(!n.buf.substring(n.buf.length-e).match(/^\s*$/))throw console.log(n.buf),new Error("Non-space truncated ");n.buf=n.buf.substring(0,n.buf.length-e),n.indentBuf=n.indentBuf.substring(0,n.indentBuf.length-e)},n.toLiteral=function(n,e){return e||(e="'"),n=n.replace(/\\/g,"\\\\"),n=n.replace(/\r/g,"\\r"),n=n.replace(/\n/g,"\\n"),n="'"==e?n.replace(/'/g,"\\'"):n.replace(/"/g,'\\"'),e+n+e},n.indentBuf="",n.indentStr="  ",n}}),requireSimulator.setName("disp"),"function"!=typeof define&&(define=require("requirejs").define),define(["IndentBuffer"],function(n){return disp=function(e){function t(n){if(null==n)return r("null%n");if("string"==typeof n)return r("'%s'%n",n);if("number"==typeof n)return r("%s%n",n);if("function"==typeof n)return r("func%n");r(n instanceof Array?"[%{":"{%{");var e="";for(var i in n)r(e+i+":"),t(n[i]);r(n instanceof Array?"%}]%n":"%}}%n")}var r=n();return t(e),r.buf}}),requireSimulator.setName("Parser"),"function"!=typeof define&&(define=require("requirejs").define),define(["disp"],function(){return Parser=function(){function n(n,e){var t;for(t in e)n[t]=e[t];return n}function e(n){this.parse=i.options.traceTap?function(e){console.log("tap: name="+this.name+"  pos="+(e?e.pos:"?"));var t=n.apply(this,[e]),r="NOIMG";return t.src&&t.src.str&&(r=t.src.str.substring(t.pos-3,t.pos)+"^"+t.src.str.substring(t.pos,t.pos+3)),t.src&&t.src.tokens&&(r=t.src.tokens[t.pos-1]+"["+t.src.tokens[t.pos]+"]"+t.src.tokens[t.pos+1]),console.log("/tap: name="+this.name+" pos="+(e?e.pos:"?")+"->"+(t?t.pos:"?")+" "+r+" res="+(t?t.success:"?")),t}:n}function t(n,e){if(null==n)throw e+" is null!";return n}function r(n,e){null!=n&&(this.src={maxPos:0,global:e},"string"==typeof n&&(this.src.str=n),n instanceof Array&&(this.src.tokens=n),this.pos=0,this.result=[],this.success=!0)}var i={consoleBuffer:"",options:{traceTap:!1,optimizeFirst:!0,profile:!1,verboseFirst:!1,traceFirstTbl:!1},Parser:e,StringParser:a,nc:t};i.dispTbl=function(n){var e="",t={};if(!n)return e;for(var r in n){var i=n[r].name;t[i]||(t[i]=""),t[i]+=r}for(var i in t)e+=t[i]+"->"+i+",";return e},e.create=function(n){return new e(n)},i.create=e.create,n(e.prototype,{except:function(n){var t=this;return this.ret(e.create(function(e){return n.apply({},e.result)&&(e.success=!1),e}).setName("(except "+t.name+")"))},noFollow:function(n){var r=this;return t(n,"p"),this.ret(e.create(function(e){var t=n.parse(e);return e.success=!t.success,e}).setName("("+r.name+" noFollow "+n.name+")"))},andNoUnify:function(n){t(n,"next");var r=this,i=e.create(function(e){var t=r.parse(e);if(!t.success)return t;var i=n.parse(t);return i.success&&(i.result=t.result.concat(i.result)),i});return i.setName("("+this.name+" "+n.name+")")},and:function(n){var t=this.andNoUnify(n);if(!this._first)return t;var r=this._first.tbl,a={};for(var s in r)a[s]=r[s].andNoUnify(n);return t=e.fromFirst(this._first.space,a),t.setName("("+this.name+" >> "+n.name+")"),i.options.verboseFirst&&console.log("Created aunify name="+t.name+" tbl="+i.dispTbl(a)),t},retNoUnify:function(n){var t,r=this;t="function"==typeof n?e.create(function(e){var t=e.clone();return t.result=[n.apply({},e.result)],t}).setName("retfunc"):n;var i=e.create(function(n){var e=r.parse(n);return e.success?t.parse(e):e}).setName("("+this.name+" >= "+t.name+")");return i},ret:function(n){if(!this._first)return this.retNoUnify(n);var t=this._first.tbl,r={};for(var a in t)r[a]=t[a].retNoUnify(n);return res=e.fromFirst(this._first.space,r),res.setName("("+this.name+" >>= "+n.name+")"),i.options.verboseFirst&&console.log("Created runify name="+res.name+" tbl="+i.dispTbl(r)),res},first:function(n,t){if(!i.options.optimizeFirst)return this;if(null==n)throw"Space is null2!";if("string"==typeof t){for(var r={},a=0;a<t.length;a++)r[t.substring(a,a+1)]=this;return e.fromFirst(n,r).setName("(fst "+this.name+")")}if(null==t)return e.fromFirst(n,{ALL:this}).setName("(fst "+this.name+")");if("object"==typeof t)throw"this._first={space: space, tbl:ct}";return this},firstTokens:function(n){if(!i.options.optimizeFirst)return this;"string"==typeof n&&(n=[n]);var t={};if(n){var r=this;n.forEach(function(n){t[n]=r})}else t.ALL=this;return e.fromFirstTokens(t).setName("(fstT "+this.name+")")},unifyFirst:function(t){function r(n,e){return n?e?n.orNoUnify(e).checkTbl():n:e}function a(){var n=t._first.tbl,e={};for(var i in s)e[i]=1;for(var i in n)e[i]=1;delete e.ALL,(s.ALL||n.ALL)&&(s.ALL=r(s.ALL,n.ALL));for(var i in e)s[i]&&n[i]?s[i]=r(s[i],n[i]):s[i]&&!n[i]?s[i]=r(s[i],n.ALL):!s[i]&&n[i]&&(s[i]=r(s.ALL,n[i]))}var s={};this.checkTbl(),t.checkTbl(),n(s,this._first.tbl),a();var o=e.fromFirst(this._first.space,s).setName("("+this.name+")U("+t.name+")");return i.options.verboseFirst&&console.log("Created unify name="+o.name+" tbl="+i.dispTbl(s)),o},or:function(n){return t(n,"other"),this._first&&n._first&&this._first.space&&this._first.space===n._first.space?this.unifyFirst(n):(i.options.verboseFirst&&console.log("Cannot unify"+this.name+" || "+n.name+" "+this._first+" - "+n._first),this.orNoUnify(n))},orNoUnify:function(n){var t=this,r=e.create(function(e){var r=t.parse(e);if(r.success)return r;var i=n.parse(e);return i});return r.name="("+this.name+")|("+n.name+")",r},setName:function(n){return this.name=n,this._first,this},profile:function(n){return i.options.profile&&(this.parse=this.parse.profile(n||this.name)),this},repN:function(n){var t=this;n||(n=0);var r=e.create(function(e){for(var r=e,i=[];;){var a=t.parse(r);if(!a.success){var s;return i.length>=n?(s=r.clone(),s.result=[i],s.success=!0,s):(s=e.clone(),s.success=!1,s)}i.push(a.result[0]),r=a}});return r.setName("("+t.name+" * "+n+")")},rep0:function(){return this.repN(0)},rep1:function(){return this.repN(1)},opt:function(){var n=this;return e.create(function(e){var t=n.parse(e);return t.success?t:(e=e.clone(),e.success=!0,e.result=[null],e)}).setName("("+n.name+")?")},sep1:function(n,e){var r=this;t(r,"value"),t(n,"sep");var i=n.and(r).ret(function(n,t){return e?t:{sep:n,value:t}});return r.and(i.rep0()).ret(function(n,t){var r;if(e){var i=[n];for(r in t)i.push(t[r]);return i}return{head:n,tails:t}}).setName("(sep1 "+r.name+"~~"+n.name+")")},sep0:function(n){return this.sep1(n,!0).opt().ret(function(n){return n?n:[]})},tap:function(n){return this},retN:function(n){return this.ret(function(){return arguments[n]})},parseStr:function(n,e){var t=new r(n,e);return this.parse(t)},checkTbl:function(){if(!this._first)return this;var n=this._first.tbl;for(var e in n)if(!n[e].parse)throw this.name+": tbl."+e+" is not a parser :"+n[e];return this}}),n(r.prototype,{clone:function(){var n=new r;return n.src=this.src,n.pos=this.pos,n.result=this.result.slice(),n.success=this.success,n},updateMaxPos:function(n){n>this.src.maxPos&&(this.src.maxPos=n)},isSuccess:function(){return this.success},getGlobal:function(){return this.src.global||(this.src.global={}),this.src.global}}),e.fromFirst=function(n,t){if("TOKEN"==n)return e.fromFirstTokens(t);var r=e.create(function(e){var r=n.parse(e),a=r.src.str.substring(r.pos,r.pos+1);return i.options.traceFirstTbl&&console.log(this.name+": first="+a+" tbl="+(t[a]?t[a].name:"-")),t[a]?t[a].parse(r):t.ALL?t.ALL.parse(r):(r.success=!1,r)});return r._first={space:n,tbl:t},r.checkTbl(),r},e.fromFirstTokens=function(n){var t=e.create(function(e){var t=e.src.tokens[e.pos],r=t?t.type:null;return i.options.traceFirstTbl&&console.log(this.name+": firstT="+r+" tbl="+(n[r]?n[r].name:"-")),null!=r&&n[r]?n[r].parse(e):n.ALL?n.ALL.parse(e):(e.success=!1,e)});return t._first={space:"TOKEN",tbl:n},t.checkTbl(),t};var a={empty:e.create(function(n){var e=n.clone();return e.success=!0,e.result=[null],e}).setName("E"),fail:e.create(function(n){return n.success=!1,n}).setName("F"),str:function(n){return this.strLike(function(e,t){return e.substring(t,t+n.length)===n?{len:n.length}:null}).setName(n)},reg:function(n){return(n+"").match(/^\/\^/)||console.log("Waring regex should have ^ at the head:"+(n+"")),this.strLike(function(e,t){var r=n.exec(e.substring(t));return r?(r.len=r[0].length,r):null}).setName(n+"")},strLike:function(t){return e.create(function(e){var r=e.src.str;if(null==r)throw"strLike: str is null!";var a=e.pos,s=t(r,a,e);if(i.options.traceToken&&console.log("pos="+a+" r="+s),s){i.options.traceToken&&console.log("str:succ"),s.pos=a,s.src=e.src;var o=e.clone();return n(o,{pos:a+s.len,success:!0,result:[s]}),e.updateMaxPos(o.pos),o}return i.options.traceToken&&console.log("str:fail"),e.success=!1,e}).setName("STRLIKE")},parse:function(n,e,t){var i=new r(e,t);return n.parse(i)}};a.eof=a.strLike(function(n,e){return e==n.length?{len:0}:null}).setName("EOF"),i.StringParser=a;var s={token:function(n){return e.create(function(e){var t=e.src.tokens[e.pos];return e.success=!1,t?(t.type==n&&(e=e.clone(),e.updateMaxPos(e.pos),e.pos++,e.success=!0,e.result=[t]),e):e}).setName(n).firstTokens(n)},parse:function(n,e,t){var i=new r(e,t);return n.parse(i)},eof:e.create(function(n){var e=n.pos>=n.src.tokens.length;return n.success=e,e&&(n=n.clone(),n.result=[{type:"EOF"}]),n}).setName("EOT")};return i.TokensParser=s,i.lazy=function(n){var t=null;return e.create(function(e){if(t||(t=n()),!t)throw n+" returned null!";return this.name=n.name,t.parse(e)}).setName("LZ")},i.addRange=function(n,e){if(null==e)return n;if("number"!=typeof n.pos)return n.pos=e.pos,n.len=e.len,n;var t=e.pos+e.len,r=n.pos+n.len;return e.pos<n.pos&&(n.pos=e.pos),t>r&&(n.len=t-n.pos),n},i.setRange=function(n){if(null!=n&&"string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n){var e=i.getRange(n);if(null!=e)return n;for(var t in n)if(n.hasOwnProperty(t)){var r=i.setRange(n[t]);i.addRange(n,r)}return n}},i.getRange=function(n){return null==n?null:"number"!=typeof n.pos?null:"number"==typeof n.len?n:null},i}()}),requireSimulator.setName("Grammar"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(n){return Grammar=function(){function e(n){return"string"==typeof n?r.get(n):n}var t=n,r=null;return r=function(t){var i={};return i.ands=function(){for(var i=e(arguments[0]),a=1;a<arguments.length;a++)i=i.and(e(arguments[a]));i=i.tap(t),r.defs[t]=i;var s={};return s.autoNode=function(){var e=i.ret(function(){for(var e={type:t},r=0;r<arguments.length;r++){var i=arguments[r],a=n.setRange(i);n.addRange(e,a),e["-element"+r]=i}e.toString=function(){return"("+this.type+")"}}).setName(t);return r.defs[t]=e},s.ret=function(e){if(0==arguments.length)return i;if("function"==typeof e)return r.defs[t]=i.ret(e);for(var a=[],s=function(n){return n},o=0;o<arguments.length;o++){if("function"==typeof arguments[o]){s=arguments[o];break}a[o]=arguments[o]}var l=i.ret(function(){var e={type:t};e[Grammar.SUBELEMENTS]=[];for(var r=0;r<arguments.length;r++){var i=arguments[r],o=n.setRange(i);n.addRange(e,o),a[r]&&(e[a[r]]=i),e[Grammar.SUBELEMENTS].push(i)}return e.toString=function(){return"("+this.type+")"},s(e)}).setName(t);return r.defs[t]=l},s},i.ors=function(){for(var n=e(arguments[0]),i=1;i<arguments.length;i++)n=n.or(e(arguments[i]));return r.defs[t]=n.setName(t)},i},r.defs={},r.get=function(n){return r.defs[n]?r.defs[n]:t.lazy(function(){var e=r.defs[n];if(!e)throw"grammar named '"+n+"' is undefined";return e}).setName("(Lazy of "+n+")")},r},Grammar.SUBELEMENTS="[SUBELEMENTS]",Grammar}),requireSimulator.setName("XMLBuffer"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(n){return XMLBuffer=function(e){var t;return t=function(r,i){if(null!=r&&"string"!=typeof r&&"number"!=typeof r){var a=n.getRange(r);if(a)for(;t.srcLen<a.pos;)t.src(e.substring(t.srcLen,a.pos));if(null!=r){if(i&&t.tag("<attr_"+i+">"),r.type&&t.tag("<"+r.type+">"),r.text)t.src(a.text);else{var s=t.orderByPos(r);s.forEach(function(n){n.name&&n.name.match(/^-/)?t(n.value):t(n.value,n.name)})}if(a)for(;t.srcLen<a.pos+a.len;)t.src(e.substring(t.srcLen,a.pos+a.len));r.type&&t.tag("</"+r.type+">"),i&&t.tag("</attr_"+i+">")}}},t.orderByPos=XMLBuffer.orderByPos,t.src=function(n){t.buf+=n.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"),t.srcLen+=n.length},t.tag=function(n){t.buf+=n},t.buf="",t.srcLen=0,t},XMLBuffer.orderByPos=function(n){var e=[];if(n[XMLBuffer.SUBELEMENTS])n[XMLBuffer.SUBELEMENTS].forEach(function(n){e.push(n)});else for(var t in n)n.hasOwnProperty(t)&&null!=n[t]&&"string"!=typeof n[t]&&"number"!=typeof n[t]&&"number"==typeof n[t].pos&&e.push(isNaN(parseInt(t))&&!(t+"").match(/-/)?{name:t,value:n[t]}:{value:n[t]});return e=e.sort(function(n,e){return n.value.pos-e.value.pos})},XMLBuffer.SUBELEMENTS="[SUBELEMENTS]",XMLBuffer}),requireSimulator.setName("TError"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return TError=function(n,e,t){if("string"==typeof e)return{isTError:!0,mesg:n,src:{name:function(){return e},text:function(){return e}},pos:t,toString:function(){return this.mesg+" at "+e+":"+this.pos},raise:function(){throw this}};var r=null;if(e&&e.src&&(r=e,e=r.src.tonyu),"function"!=typeof e.name)throw"src="+e+" should be file object";var i;if("function"==typeof e.text){var a=e.text();"string"==typeof a&&(i=TError.calcRowCol(a,t))}return{isTError:!0,mesg:n,src:e,pos:t,row:i.row,col:i.col,klass:r,toString:function(){return this.mesg+" at "+this.src.name()+":"+this.row+":"+this.col},raise:function(){throw this}}},TError.calcRowCol=function(n,e){var t,r,i=n.split("\n"),a=0;for(t=0;t<i.length;t++)if(a+=i[t].length+1,a>e){r=e-(a-i[t].length);break}return{row:t,col:r}},TError}),requireSimulator.setName("TT"),"function"!=typeof define&&(define=require("requirejs").define),define(["Grammar","XMLBuffer","IndentBuffer","disp","Parser","TError"],function(n,e,t,r,i){return TT=function(){function n(n,e){var t,i;"string"==typeof n?(t=o.str(n),n.length>0&&(i=n.substring(0,1)),e||(e=n)):(t=o.reg(n),e||(e=n+""));var a=c.and(t).ret(function(n,t){var i={};if(i.pos=t.pos,"number"!=typeof i.pos)throw"no pos for "+e+" "+r(t);if(i.len=t.len,i.text=t.src.str.substring(i.pos,i.pos+i.len),"string"!=typeof i.text)throw"no text("+i.text+") for "+e+" "+r(t);return i.toString=function(){return this.text},i});return i&&(a=a.first(c,i)),a.setName(e)}function e(e,t,r){"string"==typeof r&&(r=n(r)),_[e]=a(_[e],r.ret(function(n){return n.type=t,n}).setName(t))}function t(n,t,r,i){t==l&&(t=r);for(var a=1;n>=a;a*=2)0!=(n&a)&&e(n&a,t,r,i);d[t]=i}function a(n,e){return n?n.or(e):e}function s(n){var e=((new Date).getTime(),i.StringParser.parse(T,n));return e.success||console.log("Stopped at "+n.substring(e.src.maxPos-5,e.src.maxPos+5)),e}var o=i.StringParser,l="SAMENAME",h=1,u=2,c=o.reg(/^(\s*(\/\*([^\/]|[^*]\/|\r|\n)*\*\/)*(\/\/.*\r?\n)*)*/).setName("space"),_={},d={},T=i.create(function(n){for(var e=u,t=[];;){if(n=_[e].parse(n),!n.success)break;var r=n.result[0];e=d[r.type],t.push(r)}return n=c.parse(n),n.success=n.src.maxPos==n.src.str.length,n.result[0]=t,n}),S={"function":!0,"var":!0,"return":!0,"typeof":!0,"if":!0,"for":!0,"else":!0,"super":!0,"while":!0,"break":!0,"do":!0,"switch":!0,"try":!0,"catch":!0,"finally":!0,"throw":!0,"in":!0,fiber:!0,"native":!0,"instanceof":!0,"new":!0,is:!0,"true":!0,"false":!0,"null":!0,"this":!0,undefined:!0,usethread:!0,constructor:!0,ifwait:!0,nowait:!0,_thread:!0,arguments:!0,"delete":!0,"extends":!0,includes:!0},p=n(/^[0-9\.]+/).ret(function(n){return n.type="number",n.value=parseInt(n.text),n}).first(c,"0123456789"),f=n({exec:function(n){var e=n.substring(0,1);if('"'!==e&&"'"!==e)return!1;for(var t=1;t<n.length;t++){var r=n.substring(t,t+1);if(r===e)return[n.substring(0,t+1)];"\\"===r&&t++}return!1},toString:function(){return"literal"}}).first(c,"\"'"),y=n({exec:function(n){if("/"!==n.substring(0,1))return!1;for(var e=1;e<n.length;e++){var t=n.substring(e,e+1);if("/"===t){var r=/^[ig]*/.exec(n.substring(e+1));return[n.substring(0,e+1+r[0].length)]}if("\n"==t)return!1;"\\"===t&&e++}return!1},toString:function(){return"regex"}}).first(c,"/");t(u|h,"number",p,h),t(u,"regex",y,h),t(u|h,"literal",f,h),t(u|h,l,"++",h),t(u|h,l,"--",h),t(u|h,l,"!==",u),t(u|h,l,"===",u),t(u|h,l,"+=",u),t(u|h,l,"-=",u),t(u|h,l,"*=",u),t(u|h,l,"/=",u),t(u|h,l,"%=",u),t(u|h,l,">=",u),t(u|h,l,"<=",u),t(u|h,l,"!=",u),t(u|h,l,"==",u),t(u|h,l,">>",u),t(u|h,l,"<<",u),t(u|h,l,"&&",u),t(u|h,l,"||",u),t(u|h,l,"(",u),t(u|h,l,")",h),t(u|h,l,"[",u),t(u|h,l,"]",h),t(u|h,l,"{",u),t(u|h,l,"}",h),t(u|h,l,">",u),t(u|h,l,"<",u),t(u|h,l,"+",u),t(u|h,l,"-",u),t(u|h,l,".",u),t(u|h,l,"?",u),t(u|h,l,"=",u),t(u|h,l,"*",u),t(u|h,l,"%",u),t(h,l,"/",u),t(h|u,l,"^",u),t(h|u,l,"~",u),t(h|u,l,"\\",u),t(h|u,l,":",u),t(h|u,l,";",u),t(h|u,l,",",u),t(u|h,l,"!",u),t(u|h,l,"&",u),t(u|h,l,"|",u);var m=n(/^[a-zA-Z_$][a-zA-Z0-9_$]*/,"symresv_reg").ret(function(n){return n.type="constructor"==n.text?"tk_constructor":S.hasOwnProperty(n.text)?n.text:"symbol",n}).first(c);for(var A in S)d[A]=u;return d.tk_constructor=u,d.symbol=h,_[u]=a(_[u],m),_[h]=a(_[h],m),{parse:s,extension:"js"}}()}),requireSimulator.setName("ExpressionParser"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(n){return ExpressionParser=function(){function e(n,e){var t={};return t.eq=function(t){return n==t.type()&&e==t.prio()},t.type=function(e){return e?e==n:n},t.prio=function(){return e},t.toString=function(){return"["+n+":"+e+"]"},t}function t(n){var e={},t=n;return e.add=function(n){t=t?t.or(n):n},e.get=function(){return t},e}function r(){var r=t(),i={};return i.reg=function(t,i,a){var s=e(t,i);r.add(a.ret(n.create(function(n){return n.opType=s,n})).setName("(opType "+s+" "+a.name+")"))},i.get=function(){return r.get()},i.parse=function(n){return i.get().parse(n)},i}function i(n,e){return}function a(n,e){var t,r=e;if(i(e," start minprio= "+n),e=o.parse(e),i(e," prefixorelem "+n),!e.isSuccess())return e;if(t=e.opType,t.type("prefix")){if(pre=e.result[0],e=a(t.prio(),e),!e.isSuccess())return e;var h=s.mkPrefix.def(pre,e.result[0]);if(r=e.clone(),r.result=[h],!e.nextPostfixOrInfix)return r;e=e.nextPostfixOrInfix}else if(r=e.clone(),e=l.parse(e),!e.isSuccess())return r;for(;;){if(i(e,"st:pi"),i(r,"res:ex"),t=e.opType,t.prio()<n)return r.nextPostfixOrInfix=e,r;if(t.type("postfix")){var h=s.mkPostfix.def(r.result[0],e.result[0]);if(r=e.clone(),r.result=[h],i(e,"185"),e=l.parse(e),!e.isSuccess())return r}else if(t.type("infixl")){var c=e.result[0];if(e=a(t.prio()+1,e),!e.isSuccess())return r;var h=s.mkInfixl.def(r.result[0],c,e.result[0]);if(r=e.clone(),r.result=[h],!e.nextPostfixOrInfix)return r;e=e.nextPostfixOrInfix}else if(t.type("infixr")){var c=e.result[0];if(e=a(t.prio(),e),!e.isSuccess())return r;var h=s.mkInfixr.def(r.result[0],c,e.result[0]);if(r=e.clone(),r.result=[h],!e.nextPostfixOrInfix)return r;e=e.nextPostfixOrInfix}else if(t.type("trifixr")){var _=r.result[0],d=e.result[0];if(e=a(t.prio()+1,e),!e.isSuccess())return r;var T=e.result[0],e=u[t.prio()].parse(e);if(!e.isSuccess())return r;var S=e.result[0];if(e=a(t.prio(),e),!e.isSuccess())return r;var p=e.result[0],h=s.mkTrifixr.def(_,d,T,S,p);if(r=e.clone(),r.result=[h],!e.nextPostfixOrInfix)return r;e=e.nextPostfixOrInfix}else{var c=e.result[0];if(e=a(t.prio()+1,e),!e.isSuccess())return r;var h=s.mkInfix.def(r.result[0],c,e.result[0]);if(r=e.clone(),r.result=[h],!e.nextPostfixOrInfix)return r;if(e=e.nextPostfixOrInfix,t.prio()==e.opType.prio())return r.success=!1,r}}}var s={},o=r(),l=r(),h=t(),u=[];return s.element=function(n){o.reg("element",-1,n),h.add(n)},s.getElement=function(){return h.get()},s.prefix=function(n,e){o.reg("prefix",n,e)},s.postfix=function(n,e){l.reg("postfix",n,e)},s.infixl=function(n,e){l.reg("infixl",n,e)},s.infixr=function(n,e){l.reg("infixr",n,e)},s.infix=function(n,e){l.reg("infix",n,e)},s.trifixr=function(n,e,t){l.reg("trifixr",n,e),u[n]=t},s.custom=function(){},s.mkInfix=function(n){s.mkInfix.def=n},s.mkInfix.def=function(e,t,r){return n.setRange({type:"infix",op:t,left:e,right:r})},s.mkInfixl=function(n){s.mkInfixl.def=n},s.mkInfixl.def=function(e,t,r){return n.setRange({type:"infixl",op:t,left:e,right:r})},s.mkInfixr=function(n){s.mkInfixr.def=n},s.mkInfixr.def=function(e,t,r){return n.setRange({type:"infixr",op:t,left:e,right:r})},s.mkPrefix=function(n){s.mkPrefix.def=n},s.mkPrefix.def=function(e,t){return n.setRange({type:"prefix",op:e,right:t})},s.mkPostfix=function(n){s.mkPostfix.def=n},s.mkPostfix.def=function(e,t){return n.setRange({type:"postfix",left:e,op:t})},s.mkTrifixr=function(n){s.mkTrifixr.def=n},s.mkTrifixr.def=function(e,t,r,i,a){return n.setRange({type:"trifixr",left:e,op1:t,mid:r,op2:i,right:a})},s.build=function(){return s.built=n.create(function(n){return a(0,n)}).setName("ExpBuilt"),s.built},s.lazy=function(){return n.create(function(n){return s.built.parse(n)})},s}}),requireSimulator.setName("TonyuLang"),"function"!=typeof define&&(define=require("requirejs").define),define(["Grammar","XMLBuffer","IndentBuffer","TT","disp","Parser","ExpressionParser","TError"],function(n,e,t,r,i,a,s,o){return TonyuLang=function(){function t(n){return function(){return arguments[n]}}function l(n,e){var t=[];if(n&&!n.args)throw i(n);if(n){var r=a.getRange(n);a.addRange(t,r),n.args.forEach(function(n){t.push(n)})}return e.forEach(function(n){var e=a.getRange(n);a.addRange(t,e),t.push(n.obj)}),t}function h(n,e,t){var r={type:"infix",left:n,op:e,right:t};return a.setRange(r),r.toString=function(){return"("+n+e+t+")"},r}var u=a,c={},_=n(),d=_.get,T=(u.StringParser,u.TokensParser.token),S=T("number").ret(function(n){if(n.type="number","string"!=typeof n.text)throw"No text for "+i(n);if(n.value=parseFloat(n.text),isNaN(n.value))throw"No value for "+i(n);return n}),p=T("symbol"),f=T("==="),y=T("!=="),m=T("=="),A=T("!="),$=T(">="),g=T("<="),v=T(">"),P=T("<"),O=T("&&"),b=T("||"),k=T("-"),L=T("+"),w=T("*"),M=T("/"),x=T("%"),j=T("="),B=T("literal"),E=T("regex"),D=s(),C=_("arrayElem").ands(T("["),D.lazy(),T("]")).ret(null,"subscript"),G=_("argList").ands(T("("),D.lazy().sep0(T(","),!0),T(")")).ret(null,"args"),I=_("member").ands(T("."),p).ret(null,"name"),W=_("parenExpr").ands(T("("),D.lazy(),T(")")).ret(null,"expr"),N=_("varAccess").ands(p).ret("name"),R=d("funcExpr").firstTokens(["function","\\"]),V=_("funcExprArg").ands(R).ret("obj"),H=d("objlit").firstTokens("{"),F=_("objlitArg").ands(H).ret("obj"),K=F.or(V),U=G.and(K.rep0()).ret(function(n,e){return l(n,e)}).or(K.rep1().ret(function(n){return l(null,n)})),X=(G.or(F),_("call").ands(U).ret("args")),z=_("scall").ands(U).ret("args"),Y=_("newExpr").ands(T("new"),N,X.opt()).ret(null,"klass","params"),Q=_("superExpr").ands(T("super"),T(".").and(p).ret(t(1)).opt(),z).ret(null,"name","params"),q=T("true").or(T("false")).or(T("null")).or(T("undefined")).or(T("_thread")).or(T("this")).or(T("arguments")).ret(function(n){return n.type="reservedConst",n});D.element(S),D.element(q),D.element(E),D.element(B),D.element(W),D.element(Y),D.element(Q),D.element(R),D.element(H),D.element(d("arylit").firstTokens("[")),D.element(N);
var J=0;D.infixr(J,j),D.infixr(J,T("+=")),D.infixr(J,T("-=")),D.infixr(J,T("*=")),D.infixr(J,T("/=")),D.infixr(J,T("%=")),D.infixr(J,T("|=")),D.infixr(J,T("&=")),J++,D.trifixr(J,T("?"),T(":")),J++,D.infixl(J,b),J++,D.infixl(J,O),J++,D.infix(J,T("instanceof")),D.infix(J,T("is")),D.infix(J,f),D.infix(J,y),D.infix(J,m),D.infix(J,A),D.infix(J,$),D.infix(J,g),D.infix(J,v),D.infix(J,P),J++,D.postfix(J+3,T("++")),D.postfix(J+3,T("--")),D.infixl(J,k),D.infixl(J,L),J++,D.infixl(J,w),D.infixl(J,M),D.infixl(J,x),J++,D.prefix(J,T("typeof")),D.prefix(J,T("delete")),D.prefix(J,T("++")),D.prefix(J,T("--")),D.prefix(J,T("+")),D.prefix(J,T("-")),D.prefix(J,T("!")),J++,J++,D.postfix(J,X),D.postfix(J,I),D.postfix(J,C),D.mkInfixl(h),D.mkInfixr(h);{var Z=D.build().setName("expr").profile(),t=function(n){return function(){return arguments[n]}},ne=d("stmt").firstTokens();_("exprstmt").ands(Z,T(";")).ret("expr")}_("compound").ands(T("{"),ne.rep0(),T("}")).ret(null,"stmts");var ee=T("else").and(ne).ret(t(1)),te=(_("return").ands(T("return"),Z.opt(),T(";")).ret(null,"value"),_("if").ands(T("if"),T("("),Z,T(")"),ne,ee.opt()).ret(null,null,"cond",null,"then","_else"),_("forin").ands(T("var").opt(),p.sep1(T(","),!0),T("in"),Z).ret("isVar","vars",null,"set")),re=_("normalFor").ands(ne,Z.opt(),T(";"),Z.opt()).ret("init","cond",null,"next"),ie=re.or(te),ae=(_("for").ands(T("for"),T("("),ie,T(")"),"stmt").ret(null,null,"inFor",null,"loop"),_("while").ands(T("while"),T("("),Z,T(")"),"stmt").ret(null,null,"cond",null,"loop"),_("break").ands(T("break"),T(";")).ret("brk"),_("finally").ands(T("finally"),"stmt").ret(null,"stmt"),_("catch").ands(T("catch"),T("("),p,T(")"),"stmt").ret(null,null,"name",null,"stmt"),_("catches").ors("catch","finally")),se=(_("try").ands(T("try"),"stmt",ae.rep1()).ret(null,"stmt","catches"),_("throw").ands(T("throw"),Z,T(";")).ret(null,"ex"),p),oe=_("typeDecl").ands(T(":"),se).ret(null,"vtype"),le=_("varDecl").ands(p,oe.opt(),T("=").and(Z).ret(t(1)).opt()).ret("name","vtype","value"),he=(_("varsDecl").ands(T("var"),le.sep1(T(","),!0),T(";")).ret(null,"decls"),_("paramDecl").ands(p,oe.opt()).ret("name","vtype")),ue=_("paramDecls").ands(T("("),he.sep0(T(","),!0),T(")")).ret(null,"params"),ce=_("setterDecl").ands(T("="),he).ret(null,"value");_("funcDeclHead").ands(T("nowait").opt(),T("function").or(T("fiber")).or(T("tk_constructor")).or(T("\\")).opt(),p.or(T("new")),ce.opt(),ue.opt(),oe.opt()).ret("nowait","ftype","name","setter","params","rtype");_("funcDecl").ands("funcDeclHead","compound").ret("head","body"),_("nativeDecl").ands(T("native"),p,T(";")).ret(null,"name"),_("ifWait").ands(T("ifwait"),"stmt",ee.opt()).ret(null,"then","_else");ne=_("stmt").ors("return","if","for","while","break","ifWait","try","throw","nativeDecl","funcDecl","compound","exprstmt","varsDecl"),_("funcExprHead").ands(T("function").or(T("\\")),p.opt(),ue.opt()).ret(null,"name","params");var _e=(_("funcExpr").ands("funcExprHead","compound").ret("head","body"),_("jsonElem").ands(p.or(B),T(":").and(Z).ret(function(n,e){return e}).opt()).ret("key","value")),de=(_("objlit").ands(T("{"),_e.sep0(T(","),!0),T("}")).ret(null,"elems"),_("arylit").ands(T("["),Z.sep0(T(","),!0),T("]")).ret(null,"elems"),_("extends").ands(T("extends"),p.or(T("null")),T(";")).ret(null,"superclassName")),Te=_("includes").ands(T("includes"),p.sep1(T(","),!0),T(";")).ret(null,"includeClassNames"),Se=_("program").ands(de.opt(),Te.opt(),ne.rep0(),a.TokensParser.eof).ret("ext","incl","stmts");for(var pe in _.defs)_.defs[pe].profile();return c.parse=function(n){str="string"==typeof n?n:n.text(),str+="\n";var e=r.parse(str);if(!e.isSuccess())throw o("文法エラー(Token)",n,e.src.maxPos);var t=e.result[0],i=u.TokensParser.parse(Se,t);if(i.isSuccess()){var a=i.result[0];return a}var s=t[i.src.maxPos],l=s?s.pos+s.len:str.length;throw o("文法エラー",n,l)},c.genXML=function(n,t){var r=e(n);return r(t),r.buf},c.extension="tonyu",c}()}),requireSimulator.setName("ObjectMatcher"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return ObjectMatcher=function(){function n(n,e){var t={};return t[i]=n,e&&(t[a]=e),t}function e(n){return n&&n[i]}function t(n,e,r){if(n===e)return!0;if(null==n)return!1;if("string"==typeof n&&e instanceof RegExp)return n.match(e);if("function"==typeof e)return e(n,r);if("object"==typeof e){for(var s in e)if(s!=i){var o=s==a?n:n[s],l=e[s];if(!t(o,l,r))return!1}return e[i]&&(r[e[i]]=n),!0}return!1}var r={},i="$var",a="$this";r.v=n,r.isVar=e;for(var s="ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=0;o<s.length;o++){var l=s.substring(o,o+1);r[l]=n(l)}return r.match=function(n,e){var r={};return t(n,e,r)?r:null},r}()}),requireSimulator.setName("context"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return context=function(){function n(n,t){var r={};for(var i in n)i.match(/^\$/)?(i=RegExp.rightContext,r[i]=e[i],e[i]=e.ovrFunc(e[i],n[i])):(r[i]=e[i],e[i]=n[i]);t(e);for(var i in r)e[i]=r[i]}var e={};return e.ovrFunc=function(n,e){return e.parent=n,e},e.enter=n,e}}),requireSimulator.setName("Visitor"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return Visitor=function(n){var e={funcs:n,path:[]};return e.visit=function(t){try{e.path.push(t),e.debug&&console.log("visit ",t.type,t.pos);var r=t?n[t.type]:null;if(r)return r.call(e,t);if(e.def)return e.def.call(e,t)}finally{e.path.pop()}},e.replace=function(n){return e.def||(e.def=function(n){if("object"==typeof n)for(var t in n)n[t]&&"object"==typeof n[t]&&(n[t]=e.visit(n[t]));return n}),e.visit(n)},e}}),requireSimulator.setName("Tonyu.Compiler"),define(["Tonyu","ObjectMatcher","TError"],function(n){function e(n,e){var t={type:n};if(e)for(var r in e)t[r]=e[r];return t.name||(t.name=a("_"+n+"_")),t}function t(n){return n?n.type:null}function r(n){var e=function(){};return e.prototype=n,new e}function i(n,e){if(!n)throw e+" is null";return n}function a(n){return n+(d++ +"").replace(/\./g,"")}function s(n,e,t){e._id||(n._idseq||(n._idseq=0),e._id=++n._idseq);var r=n[e._id];if(r||(r=n[e._id]={node:e}),t)for(var i in t)r[i]=t[i];return r}function o(n,e){return n.substring(e.pos,e.pos+e.len)}function l(n,e){var t=null;return h(n).forEach(function(n){t||(t=n.decls.methods[e])}),t}function h(n){function e(n){t[n.fullName]||(t[n.fullName]=!0,r.push(n),n.superclass&&e(n.superclass),n.includes&&n.includes.forEach(e))}var t={},r=[];return e(n),r}function u(n){var e=[];if(!n.head)return e;n.head.setter&&e.push(n.head.setter.value);var t=n.head.params?n.head.params.params:null;if(t&&!t.forEach)throw n+" is not array ";return t&&(e=e.concat(t)),e}var c={};n.Compiler=c;var _={FIELD:"field",METHOD:"method",NATIVE:"native",LOCAL:"local",THVAR:"threadvar",PARAM:"param",GLOBAL:"global",CLASS:"class"};c.ScopeTypes=_;var d=1;return c.newScopeType=e,c.getScopeType=t,c.newScope=r,c.nullCheck=i,c.genSym=a,c.annotation=s,c.getSource=o,c.getMethod=l,c.getDependingClasses=h,c.getParams=u,c}),requireSimulator.setName("Tonyu.Compiler.JSGenerator"),"function"!=typeof define&&(define=require("requirejs").define),define(["Tonyu","Tonyu.Iterator","TonyuLang","ObjectMatcher","TError","IndentBuffer","context","Visitor","Tonyu.Compiler"],function(n,e,t,r,i,a,s,o,l){return l.JSGenerator=function(){function n(n,k){function L(n){return l.getSource(X,n)}function w(e,t){return b(n.annotation,e,t)}function M(n){return"string"==typeof n?m+(k.aliases[n]||n):n.builtin?n.fullName:m+n.fullName}function x(n){var e=[];return n.forEach(function(n){e.push(M(n))}),e}function j(n,e){return function(){Q.enter(n,function(){v.visit(e)})}}function B(n,r,i){var a=O(r);if(a==te.THVAR)z.printf("%s",e);else if(a==te.FIELD)z.printf("%s.%s",t,n);else if(a==te.METHOD)i&&i.noBind?z.printf("%s.%s",t,n):z.printf("%s(%s,%s.%s)",S,t,t,n);else if(a==te.CLASS)z.printf("%s",M(n));else if(a==te.GLOBAL)z.printf("%s%s",A,n);else{if(a!=te.PARAM&&a!=te.LOCAL&&a!=te.NATIVE)throw console.log("Unknown scope type: ",a),new Error("Unknown scope type: "+a);z.printf("%s",n)}return r}function E(n){return function(){D.apply(this,[n])}}function D(n){"compound"==n.type?Q.enter({noWait:!0},function(){z.printf("%j%n",["%n",n.stmts])}):v.visit(n)}function C(e){return function(){z.printf("%s%s=%s;//%s%n",k.options.compiler.commentLastPos?"//":"",_,Z.add(n,e.pos),n.fullName+":"+e.pos)}}function G(){Q.enter({},function(){Y("Tonyu.klass.define({%{"),Y("fullName: %l,%n",n.fullName),Y("shortName: %l,%n",n.shortName),Y("namespace: %l,%n",n.namespace),n.superclass&&Y("superclass: %s,%n",M(n.superclass)),Y("includes: [%s],%n",x(n.includes).join(",")),Y("methods: {%{");for(var e in ee){q&&console.log("method1",e);var t=ee[e];Q.enter({noWait:!0,threadAvail:!1},function(){N(t)}),q&&console.log("method2",e),t.nowait||Q.enter({noWait:!1,threadAvail:!0},function(){W(t)}),q&&console.log("method3",e)}Y("__dummy: false%n"),Y("%}},%n"),Y("decls: %s%n",JSON.stringify(I(n))),Y("%}});")})}function I(n){var e={methods:{}};for(var t in n.decls.methods)e.methods[t]={nowait:!!n.decls.methods[t].nowait};return e}function W(n){function r(){Q.enter({method:n,noWait:!0,threadAvail:!0},function(){s.forEach(function(n){Y("%v%n",n)})})}function i(){Q.enter({method:n,finfo:n,pc:1},function(){o.forEach(function(n){Y("%v%n",n)})})}if(!K(n)){var a=n.stmts,s=[],o=[],l=s,_=!0;_?a.forEach(function(n){w(n).fiberCallRequired&&(l=o),l.push(n)}):o=a,Y("%s%s :function %s(%j) {%{var %s=%s;%n%svar %s=%s;%nvar %s=0;%n%f%n%f%n",u,n.name,V(n.pos,"f_"+n.name),[",",[ae].concat(n.params)],t,$,n.useArgs?"":"//",h,"Tonyu.A(arguments)",c,F(n),r),o.length>0?Y("%s.enter(function %s(%s) {%{if (%s.lastEx) %s=%s.catchPC;%nfor(var %s=%d ; %s--;) {%{switch (%s) {%{%}case 0:%{%f%s.exit(%s);return;%n%}}%n%}}%n%}});%n",e,V(n.pos,"ent_"+n.name),e,e,c,e,d,T,d,c,i,e,t):Y("%s.retVal=%s;return;%n",e,t),Y("%}},%n")}}function N(n){function e(){Q.enter({method:n,finfo:n},function(){n.stmts.forEach(function(n){Y("%v%n",n)})})}var r=K(n)?"initialize":n.name;Y("%s :function %s(%j) {%{var %s=%s;%n%f%n%f%}},%n",r,V(n.pos,r),[",",n.params],t,$,F(n),e)}function R(n){function e(){Q.enter({noWait:!0,threadAvail:!1,finfo:t},function(){n.body.stmts.forEach(function(n){Y("%v%n",n)})})}var t=w(n);z.printf("(function %s(%j) {%{%f%n%f%}})",t.name,[",",t.params],F(t),e)}function V(e,t){return t||(t=re++ +""),"_trc_"+n.shortName+"_"+t}function H(n){function e(){Q.enter({noWait:!0,threadAvail:!1,finfo:t},function(){n.body.stmts.forEach(function(n){Y("%v%n",n)})})}var t=w(n);z.printf("function %s(%j) {%{%f%n%f%}}",t.name,[",",t.params],F(t),e)}function F(n){function e(){Q.enter({},function(){for(var e in n.locals.varDecls)z.printf("var %s;%n",e);for(var e in n.locals.subFuncDecls)H(n.locals.subFuncDecls[e])})}return e}function K(n){return J.match(n,{ftype:"constructor"})||J.match(n,{name:"new"})}var U=n.src.tonyu,X=U.text(),z=a(),Y=z.printf,Q=s(),q=!1,J=r,Z=k.traceTbl,ne=n.decls,ee=(ne.fields,ne.methods),te=(ne.natives,P),re=0,ie=k.options.compiler.diagnose,ae={type:"THNode"};v=z.visitor=o({THNode:function(){z.printf(e)},dummy:function(n){z.printf("",n)},literal:function(n){z.printf("%s",n.text)},paramDecl:function(n){z.printf("%v",n.name)},paramDecls:function(n){z.printf("(%j)",[", ",n.params])},funcDeclHead:function(n){z.printf("function %v %v",n.name,n.params)},funcDecl:function(){},"return":function(n){if(Q.inTry)throw i("現実装では、tryの中にreturnは書けません",U,n.pos);Q.noWait?Q.threadAvail?n.value?z.printf("%s.retVal=%v;return;%n",e,n.value):z.printf("%s.retVal=%s;return;%n",e,t):n.value?z.printf("return %v;",n.value):z.printf("return %s;",t):n.value?z.printf("%s.exit(%v);return;",e,n.value):z.printf("%s.exit(%s);return;",e,t)},program:function(n){genClass(n.stmts)},number:function(n){z.printf("%s",n.value)},reservedConst:function(n){"this"==n.text?z.printf("%s",t):"arguments"==n.text&&Q.threadAvail?z.printf("%s",h):n.text==e?z.printf("%s",Q.threadAvail?e:"null"):z.printf("%s",n.text)},varDecl:function(n){n.value?z.printf("%v = %v",n.name,n.value):z.printf("%v",n.name)},varsDecl:function(n){C(n)(),z.printf("%j;",[";",n.decls])},jsonElem:function(n){n.value?z.printf("%v: %v",n.key,n.value):z.printf("%v: %f",n.key,function(){B(n.key.text,w(n).scopeInfo,w(n))})},objlit:function(n){z.printf("{%j}",[",",n.elems])},arylit:function(n){z.printf("[%j]",[",",n.elems])},funcExpr:function(n){R(n)},parenExpr:function(n){z.printf("(%v)",n.expr)},varAccess:function(n){{var e=n.name.text;B(e,w(n).scopeInfo,w(n))}},exprstmt:function(r){var i={};if(C(r)(),Q.noWait||(i=w(r).fiberCall||{}),"noRet"==i.type)z.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{",t,u,i.N,[", ",[ae].concat(i.A)],c,Q.pc,Q.pc++);else if("ret"==i.type)z.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{%v%v%s.retVal;%n",t,u,i.N,[", ",[ae].concat(i.A)],c,Q.pc,Q.pc++,i.L,i.O,e);else if("noRetSuper"==i.type){var a=M(n.superclass);z.printf("%s.prototype.%s%s.apply( %s, [%j]);%n%s=%s;return;%n%}case %d:%{",a,u,i.S.name.text,t,[", ",[ae].concat(i.A)],c,Q.pc,Q.pc++)}else"retSuper"==i.type?z.printf("%s.prototype.%s%s.apply( %s, [%j]);%n%s=%s;return;%n%}case %d:%{%v%v%s.retVal;%n",a,u,i.S.name.text,t,[", ",[ae].concat(i.A)],c,Q.pc,Q.pc++,i.L,i.O,e):z.printf("%v;",r.expr)},infix:function(n){var e=n.op.text;if(ie){if("+"==e||"-"==e||"*"==e||"/"==e||"%"==e)return void z.printf("%s(%v,%l)%v%s(%v,%l)",y,n.left,L(n.left),n.op,y,n.right,L(n.right));if("+="==e||"-="==e||"*="==e||"/="==e||"%="==e)return void z.printf("%v%v%s(%v,%l)",n.left,n.op,y,n.right,L(n.right))}z.printf("%v%v%v",n.left,n.op,n.right)},trifixr:function(n){z.printf("%v%v%v%v%v",n.left,n.op1,n.mid,n.op2,n.right)},prefix:function(n){z.printf("%v %v",n.op,n.right)},postfix:function(n){var e=w(n);if(ie){if(e.myMethodCall){var r=e.myMethodCall,i=r.scopeInfo,a=O(i);return void(a==te.FIELD||a==te.METHOD?z.printf("%s(%s, %l, [%j], %l )",p,t,r.name,[",",r.args],"this"):z.printf("%s(%v, [%j], %l)",f,n.left,[",",r.args],L(n.left)))}if(e.othersMethodCall){var s=e.othersMethodCall;return void z.printf("%s(%v, %l, [%j], %l )",p,s.target,s.name,[",",s.args],L(s.target))}if(e.memberAccess){var o=e.memberAccess;return void z.printf("%s(%v,%l).%s",y,o.target,L(o.target),o.name)}}else if(e.myMethodCall){var r=e.myMethodCall,i=r.scopeInfo,a=O(i);if(a==te.METHOD)return void z.printf("%s.%s(%j)",t,r.name,[",",r.args])}z.printf("%v%v",n.left,n.op)},"break":function(n){if(Q.noWait)z.printf("break;%n");else{if(Q.inTry&&Q.exitTryOnJump)throw i("現実装では、tryの中にbreak;は書けません",U,n.pos);if(!Q.closestBrk)throw i("break； は繰り返しの中で使います",U,n.pos);z.printf("%s=%z; break;%n",c,Q.closestBrk)}},"try":function(n){var t=w(n);if(!Q.noWait&&(t.fiberCallRequired||t.hasJump||t.hasReturn)){if(1!=n.catches.length||"catch"!=n.catches[0].type)throw i("現実装では、catch節1個のみをサポートしています",U,n.pos);var r=n.catches[0],a={},s={};z.printf("%s.enterTry(%z);%n",e,a),z.printf("%f",j({inTry:!0,exitTryOnJump:!0},n.stmt)),z.printf("%s.exitTry();%n",e),z.printf("%s=%z;break;%n",c,s),z.printf("%}case %f:%{",function(){z.print(a.put(Q.pc++))}),z.printf("%s=%s.startCatch();%n",r.name.text,e),z.printf("%s.exitTry();%n",e),z.printf("%v%n",r.stmt),z.printf("%}case %f:%{",function(){z.print(s.put(Q.pc++))})}else Q.enter({noWait:!0},function(){z.printf("try {%{%f%n%}} ",E(n.stmt)),n.catches.forEach(v.visit)})},"catch":function(n){z.printf("catch (%s) {%{%f%n%}}",n.name.text,E(n.stmt))},"throw":function(n){z.printf("throw %v;%n",n.ex)},"while":function(n){C(n)();var e=w(n);if(Q.noWait||!e.fiberCallRequired&&!e.hasReturn)Q.enter({noWait:!0},function(){z.printf("while (%v) {%{%f%n%}}",n.cond,E(n.loop))});else{var t=z.lazy(),r=Q.pc++,i="reservedConst"==n.cond.type&&"true"==n.cond.text;z.printf("%}case %d:%{"+(i?"%D%D%D":"if (!(%v)) { %s=%z; break; }%n")+"%f%n%s=%s;break;%n%}case %f:%{",r,n.cond,c,t,j({closestBrk:t,exitTryOnJump:!1},n.loop),c,r,function(){z.print(t.put(Q.pc++))})}},"for":function(n){function e(n,e,t){return function(){t.forEach(function(e,t){z.printf("%s=%s[%s];%n",e.text,n,t)})}}C(n)();var t=w(n);if("forin"==n.inFor.type){var r=w(n.inFor).iterName;if(Q.noWait||!t.fiberCallRequired&&!t.hasReturn)Q.enter({noWait:!0},function(){z.printf("%s=%s(%v,%s);%nwhile(%s.next()) {%{%f%n%f%n%}}",r,g,n.inFor.set,n.inFor.vars.length,r,e(r,n.inFor.isVar,n.inFor.vars),E(n.loop))});else{var i=z.lazy(),a=Q.pc++;z.printf("%s=%s(%v,%s);%n%}case %d:%{if (!(%s.next())) { %s=%z; break; }%n%f%n%f%n%s=%s;break;%n%}case %f:%{",r,g,n.inFor.set,n.inFor.vars.length,a,r,c,i,e(r,n.inFor.isVar,n.inFor.vars),j({closestBrk:i,exitTryOnJump:!1},n.loop),c,a,function(n){n.print(i.put(Q.pc++))})}}else if(Q.noWait||!t.fiberCallRequired&&!t.hasReturn)Q.enter({noWait:!0},function(){z.printf("%v%nwhile(%v) {%{%v%n%v;%n%}}",n.inFor.init,n.inFor.cond,n.loop,n.inFor.next)});else{var i=z.lazy(),a=Q.pc++;z.printf("%v;%n%}case %d:%{if (!(%v)) { %s=%z; break; }%n%f%n%v;%n%s=%s;break;%n%}case %f:%{",n.inFor.init,a,n.inFor.cond,c,i,j({closestBrk:i,exitTryOnJump:!1},n.loop),n.inFor.next,c,a,function(n){n.print(i.put(Q.pc++))})}},"if":function(n){C(n)();var e=w(n);if(!Q.noWait&&(e.fiberCallRequired||e.hasJump||e.hasReturn)){var t={},r={};n._else?z.printf("if (!(%v)) { %s=%z; break; }%n%v%n%s=%z;break;%n%}case %f:%{%v%n%}case %f:%{",n.cond,c,r,n.then,c,t,function(){z.print(r.put(Q.pc++))},n._else,function(){z.print(t.put(Q.pc++))}):z.printf("if (!(%v)) { %s=%z; break; }%n%v%n%}case %f:%{",n.cond,c,t,n.then,function(){z.print(t.put(Q.pc++))})}else Q.enter({noWait:!0},function(){n._else?z.printf("if (%v) {%{%f%n%}} else {%{%f%n%}}",n.cond,E(n.then),E(n._else)):z.printf("if (%v) {%{%f%n%}}",n.cond,E(n.then))})},ifWait:function(n){Q.noWait?n._else&&z.printf("%v",n._else):z.printf("%v",n.then)},call:function(n){z.printf("(%j)",[",",n.args])},objlitArg:function(n){z.printf("%v",n.obj)},argList:function(n){z.printf("%j",[",",n.args])},newExpr:function(n){var e=n.params;e?z.printf("new %v%v",n.klass,e):z.printf("new %v",n.klass)},scall:function(n){z.printf("[%j]",[",",n.args])},superExpr:function(e){var r;if(!n.superclass)throw new Error(n.fullName+"には親クラスがありません");e.name?(r=e.name.text,z.printf("%s.prototype.%s.apply( %s, %v)",M(n.superclass),r,t,e.params)):z.printf("%s.apply( %s, %v)",M(n.superclass),t,e.params)},arrayElem:function(n){z.printf("[%v]",n.subscript)},member:function(n){z.printf(".%v",n.name)},symbol:function(n){z.print(n.text)},normalFor:function(n){z.printf("%v; %v; %v",n.init,n.cond,n.next)},compound:function(n){var e=w(n);!Q.noWait&&(e.fiberCallRequired||e.hasJump||e.hasReturn)?z.printf("%j",["%n",n.stmts]):Q.enter({noWait:!0},function(){z.printf("{%{%j%n%}}",["%n",n.stmts])})},"typeof":function(){z.printf("typeof ")},"instanceof":function(){z.printf(" instanceof ")},is:function(){z.printf(" instanceof ")},regex:function(n){z.printf("%s",n.text)}});var se=["++","--","!==","===","+=","-=","*=","/=","%=",">=","<=","!=","==",">>","<<","&&","||",">","<","+","?","=","*","%","/","^","~","\\",":",";",",","!","&","|","-","delete"];return se.forEach(function(n){v.funcs[n]=function(){z.printf("%s",n)}}),v.def=function(n){throw console.log("Err node="),console.log(n),n.type+" is not defined in visitor:compiler2"},v.cnt=0,G(),n.src.js=z.buf,q&&console.log("method4",z.buf),z.buf}{var e="_thread",t="_this",h="_arguments",u="fiber$",c="__pc",_="$LASTPOS",d="__cnt",T=100,S="Tonyu.bindFunc",p="Tonyu.invokeMethod",f="Tonyu.callFunc",y="Tonyu.checkNonNull",m="Tonyu.classes.",A="Tonyu.globals.",$="this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this)",g="Tonyu.iterator",P=l.ScopeTypes,O=l.getScopeType,b=l.annotation;l.getMethod,l.getDependingClasses,l.getParams}return{genJS:n}}()}),requireSimulator.setName("Tonyu.Compiler.Semantics"),"function"!=typeof define&&(define=require("requirejs").define),define(["Tonyu","Tonyu.Iterator","TonyuLang","ObjectMatcher","TError","IndentBuffer","context","Visitor","Tonyu.Compiler"],function(n,e,t,r,i,a,s,o,l){return l.Semantics=function(){function n(n,e){function a(t){var r,a=e.options.compiler.defaultSuperClass,o=0;if((r=_.match(t,{ext:{superclassName:{text:_.N,pos:_.P}}}))&&(a=r.N,o=r.P,"null"==a&&(a=null)),n.includes=[],(r=_.match(t,{incl:{includeClassNames:_.C}}))&&r.C.forEach(function(t){var r=t.text,a=t.pos,o=e.classes[e.aliases[r]||r];if(!o)throw i("クラス "+r+"は定義されていません",s,a);n.includes.push(o)}),"Array"==a)n.superclass={name:"Array",fullName:"Array",builtin:!0};else if(a){var h=e.classes[e.aliases[a]||a];if(!h)throw i("親クラス "+a+"は定義されていません",s,o);n.superclass=h}t.stmts.forEach(function(n){if("funcDecl"==n.type){var e=n.head,t="function";e.ftype&&(t=e.ftype.text);var r=e.name.text,i=e.params?"":e.setter?"__setter__":"__getter__";r=i+r,u[r]={nowait:!!e.nowait||""!=i,ftype:t,name:r,head:e,pos:e.pos,stmts:n.body.stmts}}else"nativeDecl"==n.type?c[n.name.text]=n:l.stmts.push(n)})}var s=n.src.tonyu,o=t.parse(s),l={name:"main",stmts:[],pos:0},h={},u={main:l},c={};n.decls={fields:h,methods:u,natives:c},n.node=o;var _=r;a(o)}function e(n,e){function t(n){return l.getSource(G,n)}function y(e,t){return d(n.annotation,e,t)}function m(n){if(!n.builtin){var e=V,t=n.decls;for(var r in t.fields)e[r]=h(R.FIELD,{klass:n.name,name:r});for(var r in t.methods)e[r]=h(R.METHOD,{klass:n.name,name:r})}}function A(){var t=V;S(n).forEach(m);var r=n.decls;for(var i in r.natives)t[i]=h(R.NATIVE,{name:"native::"+i});for(var i in f)t[i]=h(R.NATIVE,{name:"native::"+i});for(var i in e.aliases)t[i]=h(R.CLASS,{name:i})}function $(){var e=S(n);for(var t in n.decls.methods){var r=n.decls.methods[t];e.forEach(function(n){var e=n.decls.methods[t];e&&e.nowait&&(r.nowait=!0)})}}function g(e){return T(n,e)}function v(n){if("varAccess"==n.type||"postfix"==n.type&&("member"==n.op.type||"arrayElem"==n.op.type))return"varAccess"==n.type&&y(n,{noBind:!0}),!0;throw console.log("LVal",n),i("'"+t(n)+"'は左辺には書けません．",C,n.pos)}function P(e){var t=H.scope[e],r=u(t);if(!r){var i=e.match(/^\$/);r=i?R.GLOBAL:R.FIELD;var a={name:e};i||(a.klass=n.name),t=V[e]=h(r,a)}return t}function O(n){var e=this;if(n&&"object"==typeof n){var t;if(t=n instanceof Array?n:n[Grammar.SUBELEMENTS],!t){t=[];for(var r in n)t.push(n[r])}t.forEach(function(n){e.visit(n)})}}function b(n){var e={varDecls:{},subFuncDecls:{}};return H.enter({locals:e},function(){J.visit(n)}),e}function k(n,e){n.forEach(function(n){y(n,e)})}function L(n){H.method&&(H.method.fiberCallRequired=!0),k(n,{fiberCallRequired:!0})}function w(n,e){H.enter({scope:e},function(){Z.visit(n)})}function M(n,e){for(var t in n.varDecls)e[t]=h(R.LOCAL);for(var t in n.subFuncDecls)e[t]=h(R.LOCAL)}function x(n){n.locals=b(n.stmts),n.params=p(n)}function j(e){var t=c(H.scope);return e.params.forEach(function(r,i){t[r.name.text]=h(R.PARAM,{klass:n.name,name:e.name,no:i})}),M(e.locals,t),H.enter({method:e,finfo:e,noWait:!1},function(){w(e.stmts,t)}),e.scope=t,D(e.locals,t),t}function B(){H.enter({scope:V},function(){for(var n in N){F&&console.log("anon method1",n);var e=N[n];x(e),j(e)}})}function E(n){var e,t,r=n.body,i=n.head.name?n.head.name.text:"anonymous_"+n.pos;t=(e=I.match(n,{head:{params:{params:I.P}}}))?e.P:[];var a=c(H.scope);t.forEach(function(n){a[n.name.text]=h(R.PARAM)});var s=b(r,a);M(s,a);var o=y(n);H.enter({finfo:o},function(){w(r,a)});var l={scope:a,locals:s,name:i,params:t};return y(n,l),y(n,o),D(s,a),l}function D(n,e){H.enter({scope:e},function(){for(var e in n.subFuncDecls)E(n.subFuncDecls[e])})}var C=n.src.tonyu,G=C.text(),I=r,W=(e.traceTbl,n.decls),N=(W.fields,W.methods),R=(W.natives,a),V={},H=s(),F=!1,K={type:"postfix",left:{type:"postfix",left:I.T,op:{type:"member",name:{text:I.N}}},op:{type:"call",args:I.A}},U={type:"postfix",left:I.T,op:{type:"member",name:{text:I.N}}},X=fiberCallTmpl={type:"postfix",left:{type:"varAccess",name:{text:I.N}},op:{type:"call",args:I.A}},z={expr:fiberCallTmpl},Y={expr:{type:"infix",op:I.O,left:I.L,right:fiberCallTmpl}},Q={expr:{type:"superExpr",params:{args:I.A},$var:"S"}},q={expr:{type:"infix",op:I.O,left:I.L,right:{type:"superExpr",params:{args:I.A},$var:"S"}}};n.annotation={};var J=o({varDecl:function(n){H.locals.varDecls[n.name.text]=n},funcDecl:function(n){H.locals.subFuncDecls[n.head.name.text]=n},funcExpr:function(){},"catch":function(n){H.locals.varDecls[n.name.text]=n},exprstmt:function(){},forin:function(n){n.isVar;n.vars.forEach(function(e){H.locals.varDecls[e.text]=n});var e=_("_it_");y(n,{iterName:e}),H.locals.varDecls[e]=n}});J.def=O;var Z=o({varAccess:function(n){var e=P(n.name.text);y(n,{scopeInfo:e})},funcDecl:function(){},funcExpr:function(n){E(n)},jsonElem:function(n){if(n.value)this.visit(n.value);else{var e=P(n.key.text);y(n,{scopeInfo:e})}},"do":function(n){var e=this;H.enter({jumpable:!0},function(){e.def(n)})},"switch":function(n){var e=this;H.enter({jumpable:!0},function(){e.def(n)})},"while":function(n){var e=this;H.enter({jumpable:!0},function(){e.def(n)}),L(this.path)},"for":function(n){var e=this;H.enter({jumpable:!0},function(){e.def(n)})},forin:function(n){n.vars.forEach(function(n){var e=P(n.text);y(n,{scopeInfo:e})}),this.visit(n.set)},ifWait:function(n){var e="_thread",t=this,r=c(H.scope);r[e]=h(R.THVAR),H.enter({scope:r},function(){t.visit(n.then)}),n._else&&t.visit(n._else),L(this.path)},"try":function(n){H.finfo.useTry=!0,this.def(n)},"return":function(n){H.noWait||k(this.path,{hasReturn:!0}),this.visit(n.value)},"break":function(n){if(!H.jumpable)throw i("break； は繰り返しの中で使います.",C,n.pos);H.noWait||k(this.path,{hasJump:!0})},"continue":function(n){if(!H.jumpable)throw i("continue； は繰り返しの中で使います.",C,n.pos);H.noWait||k(this.path,{hasJump:!0})},reservedConst:function(n){"arguments"==n.text&&(H.finfo.useArgs=!0)},postfix:function(n){var e;if(this.visit(n.left),this.visit(n.op),e=I.match(n,X)){var t=y(n.left).scopeInfo;y(n,{myMethodCall:{name:e.N,args:e.A,scopeInfo:t}})}else(e=I.match(n,K))?y(n,{othersMethodCall:{target:e.T,name:e.N,args:e.A}}):(e=I.match(n,U))&&y(n,{memberAccess:{target:e.T,name:e.N}})},infix:function(n){var e=n.op.text;("="==e||"+="==e||"-="==e||"*="==e||"/="==e||"%="==e)&&v(n.left),this.def(n)},exprstmt:function(e){var t,r;if(H.noWait||!(t=I.match(e,z))||u(H.scope[t.N])!=R.METHOD||g(t.N).nowait)if(H.noWait||!(t=I.match(e,Y))||u(H.scope[t.N])!=R.METHOD||g(t.N).nowait){if(!H.noWait&&(t=I.match(e,Q))&&t.S.name){if(r=g(t.S.name.text),!r)throw new Error("メソッド"+t.S.name.text+" はありません。");r.nowait||(t.type="noRetSuper",t.superclass=n.superclass,y(e,{fiberCall:t}),L(this.path))}else if(!H.noWait&&(t=I.match(e,q))&&t.S.name){if(r=g(t.S.name.text),!r)throw new Error("メソッド"+t.S.name.text+" はありません。");r.nowait||(t.type="retSuper",t.superclass=n.superclass,y(e,{fiberCall:t}),L(this.path))}}else t.type="ret",y(e,{fiberCall:t}),L(this.path);else t.type="noRet",y(e,{fiberCall:t}),L(this.path);this.visit(e.expr)}});Z.def=O,A(),$(),B()}var a=l.ScopeTypes,h=l.newScopeType,u=l.getScopeType,c=l.newScope,_=l.genSym,d=l.annotation,T=l.getMethod,S=l.getDependingClasses,p=l.getParams,f={Array:1,String:1,Boolean:1,Number:1,Void:1,Object:1,RegExp:1,Error:1};return{initClassDecls:n,annotate:e}}()}),requireSimulator.setName("StackTrace"),define([],function(){var trc={},pat=/(_trc_[A-Za-z0-9_]*).*[^0-9]([0-9]+):([0-9]+)[\s\)]*\r?$/;return trc.isAvailable=function(){var scr="({\n    main :function _trc_func_17000000_0() {\n      var a=(this.t.x);\n    }\n}).main();\n",s;try{eval(scr)}catch(e){if(s=e.stack,"string"!=typeof s)return!1;for(var lines=s.split(/\n/),i=0;i<lines.length;i++){var p=pat.exec(lines[i]);if(p)return!0}}return!1},trc.get=function(n){var e=n.stack;if("string"!=typeof e)return!1;for(var t=e.split(/\n/),r=[],i=0;i<t.length;i++){var a=pat.exec(t[i]);if(a){var s=a[1],o=a[2],l=a[3];r.push({fname:s,row:o,col:l})}}return console.log("StackTrace.get",r),r},trc}),requireSimulator.setName("Tonyu.TraceTbl"),define(["Tonyu","FS","TError","StackTrace"],function(n,e,t,r){return n.TraceTbl=function(){var n={},i=1e6,a=1,s=1e4,o={},l=[],h={};n.add=function(n,e){var t=n.src.tonyu,r=t.path(),u=o[r];void 0==u&&(u=a++,a>s&&(a=0),o[r]=u,l[u]=r),h[r]=n,e>=i&&(e=i-1);var c=u*i+e;return c};var u={};return n.decodeOLD=function(n){var r=n%i,a=(n-r)/i,s=l[a];if(s){var o=e.get(s),u=h[s];return t("Trace info",u||o,r)}return null},n.srcMap=u,n.decode=function(n){var e=new RegExp("LASTPOS="+n+";//(.*)\r?\n");console.log("pat=",e);for(var t in u){var r=e.exec(u[t]);if(r)return r[1];console.log("pat=",e,"Not found in ",t)}},n.find=function(n){var e=r.get(n),t=e[0];if(!t)return null;var i=new RegExp("LASTPOS=[0-9]+;//(.*)\r?");for(var a in u){console.log("Finding ",t.fname," in ",a);var s=u[a].indexOf(t.fname);if(s>=0){console.log("fname found at ",s);var o=u[a].split(/\n/),l=t.row-1;console.log("Scan from row=",l);for(var h=l;h>=0&&(console.log("row ",h,o[h]),null!=o[h]);h--){var c=i.exec(o[h]);if(c)return c[1]}console.log("Not found LASTPOS pat")}else console.log("Not found in ",a)}},n.addSource=function(n,e){u[n]=e},n}()}),requireSimulator.setName("DeferredUtil"),define([],function(){var n;return n={directPromise:function(n){var e=new $.Deferred;return setTimeout(function(){e.resolve(n)},0),e.promise()},throwPromise:function(n){return d=new $.Deferred,setTimeout(function(){d.reject(n)},0),d.promise()},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(t){return n.throwPromise(t)}}}}}),requireSimulator.setName("compiledProject"),define([],function(){var n=function(n,e){return{getNamespace:function(){return n},sourceDir:function(){return null},getDependingProjects:function(){return[]},loadClasses:function(t){console.log("Load compiled classes ns=",n,"url=",e);var r=new $.Deferred,i=document.getElementsByTagName("head")[0]||document.documentElement,a=document.createElement("script");a.src=e;var s=!1;return a.onload=a.onreadystatechange=function(){if(!(s||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)){s=!0,a.onload=a.onreadystatechange=null,i&&a.parentNode&&i.removeChild(a),console.log("Done Load compiled classes ns=",n,"url=",e,Tonyu.classes);var o=Tonyu.classes;if(n.split(".").forEach(function(n){o&&(o=o[n])}),o)for(var l in o){var h=o[l],u=Tonyu.klass.getMeta(h);t.classes[u.fullName]=u}r.resolve()}},i.insertBefore(a,i.firstChild),r.promise()}}};return n}),requireSimulator.setName("ProjectCompiler"),define(["Tonyu","Tonyu.Compiler.JSGenerator","Tonyu.Compiler.Semantics","Tonyu.TraceTbl","FS","assert","SFile","DeferredUtil","compiledProject"],function(n,e,t,r,i,a,s,o,l){var h=function(r){function u(n){var e=d.env;return n||(n={}),n.visited||(n={visited:{},classes:e.classes=e.classes||{},options:n}),n}function c(n){function e(e){var t=e.superclass,i=t?[t]:[];return e.includes&&(i=i.concat(e.includes)),i=i.filter(function(e){return e&&n[e.fullName]&&!e.builtin&&!r[e.fullName]})}function t(n,r){if(console.log("detectloop",n.fullName),a[n.fullName]){console.log("Detected: ",n.fullName,a,a[n.fullName]);var i=n.fullName,s=[];do s.unshift(i),i=a[i];while(i!=n.fullName);return s.unshift(n.fullName),s}r&&(a[n.fullName]=r.fullName);var o,l=e(n);return l.forEach(function(e){if(!o){var r=t(e,n);r&&(o=r)}}),delete a[n.fullName],o}var r={},i=[],a={},s=0;for(var o in n)r[o]=!1,s++;for(;i.length<s;){var l=i.length;for(var o in n)if(!r[o]){var h=n[o],u=e(h);0==u.length&&(i.push(h),r[o]=!0)}if(i.length==l){var c=[];for(var o in n)if(!r[o]){c=t(n[o])||[];break}throw TError("次のクラス間に循環参照があります: "+c.join("->"),"不明",0)}}return i}function _(n){console.log("loading: "+n.path());var e=new Function(n.text());return T.addSource(n.path(),e+""),o.directPromise(e())}a(s.is(r)&&r.isDir(),"projectCompiler: "+r+" is not dir obj");var d={env:{}},T=n.TraceTbl,S=o.throwF;return d.env.traceTbl=T,d.EXT=".tonyu",d.getOptionsFile=function(){var n=r.rel("options.json");return n},d.getOptions=function(){var n=d.env;n.options={};var e=d.getOptionsFile();return e.exists()&&(n.options=e.obj()),d.fixOptions(n.options),n.options},d.setOptions=function(n){d.getOptionsFile().obj(n)},d.fixOptions=function(n){n.compiler||(n.compiler={})},d.resolve=function(n){if(n instanceof Array){var e=[];return n.forEach(function(n){e.push(d.resolve(n))}),e}if("string"==typeof n)return i.resolve(n,r.path());if(!n||!n.isDir)throw new Error("Cannot TPR.resolve: "+n);return n
},d.shouldCompile=function(){var e=d.getOutputFile();if(!e.exists())return!0;if(e.isReadOnly())return!1;var t=e.lastUpdate();if(t<n.VERSION)return console.log("Should compile: ",e.name()+" last="+new Date(t)+" < Tonyu.ver="+new Date(n.VERSION)),!0;var r=d.sourceFiles(d.getNamespace());for(var i in r){var a=r[i],s=a.lastUpdate();if(s>t)return console.log("Should compile: ",a.name()+" last="+new Date(s)),!0}var o=d.getOptionsFile();return o.exists()&&o.lastUpdate()>t?(console.log("Should compile: ",o.name()+" last="+new Date(o.lastUpdate())),!0):!1},d.getClassName=function(n){if(a(s.is(n)),r.contains(n))return d.getNamespace()+"."+n.truncExt(d.EXT);var e;return d.getDependingProjects().forEach(function(t){e||(e=t.getClassName(n))}),e},d.getNamespace=function(){var n=d.getOptions();return a(n.compiler.namespace,"namespace not specified opt="+JSON.stringify(n))},d.getOutputFile=function(){var n=d.getOptions(),e=d.resolve(a(n.compiler.outputFile,"output file should be specified in options"));if(e.isDir())throw new Error("out: directory style not supported");return e},d.loadDependingClasses=function(n){var e=o.directPromise(),t=d.getNamespace();return d.getDependingProjects().forEach(function(r){r.getNamespace()!=t&&(e=e.then(function(){return r.loadClasses(n)}))}),e},d.loadClasses=function(e){function t(){var t=d.getNamespace(),r=n.classes;if(t.split(".").forEach(function(n){r&&(r=r[n])}),r)for(var i in r){var a=r[i],s=n.klass.getMeta(a);e.classes[s.fullName]=s}}n.runMode=!1,console.log("LoadClasses: "+r.path()),e=u(e);var i=e.visited||{};return i[d.path()]?o.directPromise():(i[d.path()]=!0,d.loadDependingClasses(e).then(function(){return d.shouldCompile()}).then(function(n){if(n)return d.compile(e);var r=d.getOutputFile("js");return _(r).then(S(t))}))},d.compile=function(e){n.runMode=!1,console.log("Compile: "+r.path()),e=u(e);var i=d.getNamespace();return d.loadDependingClasses(e).then(S(function(){var n=e.classes;console.log("baseClasses",n);var r=(e.options,d.env);r.aliases={},r.classes=n;for(var a in n){var s=n[a];r.aliases[s.shortName]=s.fullName}var o={},l=d.sourceFiles(i);for(var h in l){var u=l[h],_=i+"."+h;o[_]=n[_]={fullName:_,shortName:h,namespace:i,src:{tonyu:u}},r.aliases[h]=_}for(var a in o)console.log("initClassDecl: "+a),t.initClassDecls(o[a],r);var T=c(o);T.forEach(function(n){console.log("annotate :"+n.fullName),t.annotate(n,r)}),d.concatJS(T)}))},d.concatJS=function(n){var t=d.env,r="";n.forEach(function(n){console.log("concatJS :"+n.fullName),e.genJS(n,t),r+=n.src.js+"\n"});var i=d.getOutputFile();i.text(r),_(i)},d.getDependingProjects=function(){var n=d.getOptions(),e=n.compiler.dependingProjects||[];return e.map(function(n){if("string"==typeof n){var e=d.resolve(n);return h(e)}return"object"==typeof n?l(n.namespace,i.expandPath(n.compiledURL)):void 0})},d.dir=r,d.path=function(){return r.path()},d.sourceFiles=function(n){function e(n){if(n.endsWith(d.EXT)){var e=n.truncExt(d.EXT);r[e]=n}}for(var t=d.sourceDirs(n),r={},i=t.length-1;i>=0;i--)t[i].recursive(e);return r},d.sourceDir=function(){return r},d.sourceDirs=function(n){var e=d.getDependingProjects(),t=[r];return e.forEach(function(e){var r=e.getNamespace();if(!n||r==n){var i=e.sourceDir();i&&t.push(i)}}),t},d.decodeTrace=function(n){var e=n.split(":"),t=e[0],r=parseInt(e[1]),i=t.split("."),a=i.pop(),s=i.join(".");if(s==d.getNamespace()){var o=d.sourceFiles(s);for(var l in o)if(a==l)return TError("Trace info",o[l],r)}},d};return h}),requireSimulator.setName("PatternParser"),define(["Tonyu"],function(n){return n.klass({initialize:function(n,e){this.options=e||{},this.img=n,this.height=n.height,this.width=n.width;var t=this.newImage(n.width,n.height),r=t.getContext("2d");r.drawImage(n,0,0),this.ctx=r,this.pixels=this.ctx.getImageData(0,0,n.width,n.height).data,this.base=this.getPixel(0,0)},newImage:function(n,e){var t=document.createElement("canvas");return t.width=n,t.height=e,t},getPixel:function(n,e){var t=this.pixels,r=4*(n+e*this.width),i=t[0+r],a=t[1+r],s=t[2+r],o=t[3+r];return 256*(256*(256*o+s)+a)+i},setPixel:function(n,e,t){var r=4*(n+e*this.width);this.pixels[0+r]=255&t,t=(t-(255&t))/256,this.pixels[1+r]=255&t,t=(t-(255&t))/256,this.pixels[2+r]=255&t,t=(t-(255&t))/256,this.pixels[3+r]=255&t},parse:function(){try{for(var n=[],e=0;e<this.height;e++)for(var t=0;t<this.width;t++){var r=this.getPixel(t,e);r!=this.base&&n.push(this.parse1Pattern(t,e))}return n}catch(i){if(i.isParseError)return console.log("parse error! "+i),{image:this.img,x:0,y:0,width:this.width,height:this.height};throw i}},parse1Pattern:function(n,e){function t(n){return n}function r(n,e,t){return{toString:function(){return"at ("+n+","+e+") :"+t},isParseError:!0}}for(var i=this.getPixel(n,e),a=n,s=e,o=this.base,l=this.width,h=this.height;l>a;){var u=this.getPixel(a,s);if(u!=i)break;a++}if(a>=l||this.getPixel(a,s)!=o)throw r(a,s,t(this.getPixel(a,s))+"!="+t(o));for(a--;h>s&&this.getPixel(a,s)==i;)s++;if(s>=h||this.getPixel(a,s)!=o)throw r(a,s,t(this.getPixel(a,s))+"!="+t(o));s--;var c=n+1,_=e+1,d=a-c,T=s-_;if(console.log("PP",c,_,d,T,a,s),d*T==0)throw r(a,s,"w*h==0");for(var S=this.newImage(d,T),p=S.getContext("2d"),f=p.getImageData(0,0,d,T),y=f.data,m=0,A=_;s>A;A++)for(var $=c;a>$;$++){var g=this.getPixel($,A);g==i?(y[m++]=0,y[m++]=0,y[m++]=0,y[m++]=0):(y[m++]=255&g,g=(g-(255&g))/256,y[m++]=255&g,g=(g-(255&g))/256,y[m++]=255&g,g=(g-(255&g))/256,y[m++]=255&g)}p.putImageData(f,0,0);for(var v=_-1;s>=v;v++)for(var P=c-1;a>=P;P++)this.setPixel(P,v,o);return this.options.boundsInSrc?{x:c,y:_,width:d,height:T}:{image:S,x:0,y:0,width:d,height:T}}})}),requireSimulator.setName("Util"),Util=function(){function n(n,t){null==t&&(t=""),n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+n+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?t:e(i[1])}function e(n){return decodeURIComponent(n.replace(/\+/g,"%20"))}function t(n,e){return n.substring(n.length-e.length)===e}function r(n,e){return n.substring(0,e.length)===e}function i(n){function e(e){throw console.log(e),console.log(n,h),new Error(e)}n=n.replace(/[\n=]/g,"");var t=new Object;t[65]=0,t[66]=1,t[67]=2,t[68]=3,t[69]=4,t[70]=5,t[71]=6,t[72]=7,t[73]=8,t[74]=9,t[75]=10,t[76]=11,t[77]=12,t[78]=13,t[79]=14,t[80]=15,t[81]=16,t[82]=17,t[83]=18,t[84]=19,t[85]=20,t[86]=21,t[87]=22,t[88]=23,t[89]=24,t[90]=25,t[97]=26,t[98]=27,t[99]=28,t[100]=29,t[101]=30,t[102]=31,t[103]=32,t[104]=33,t[105]=34,t[106]=35,t[107]=36,t[108]=37,t[109]=38,t[110]=39,t[111]=40,t[112]=41,t[113]=42,t[114]=43,t[115]=44,t[116]=45,t[117]=46,t[118]=47,t[119]=48,t[120]=49,t[121]=50,t[122]=51,t[48]=52,t[49]=53,t[50]=54,t[51]=55,t[52]=56,t[53]=57,t[54]=58,t[55]=59,t[56]=60,t[57]=61,t[43]=62,t[47]=63;var r,i=n.length,a=0,s=0;if(!i)return new ArrayBuffer(0);r=Math.floor(i/4*3),"="==n.charAt(i-1)&&(r-=1),"="==n.charAt(i-2)&&(r-=1);for(var o=new ArrayBuffer(r),l=new Uint8Array(o),h=0,u=0;r>u&&(s=t[n.charCodeAt(h)],void 0===s&&e("Invalid letter: "+n.charCodeAt(h)),a=s<<2,h++,s=t[n.charCodeAt(h)],void 0===s&&e("Invalid letter: "+n.charCodeAt(h)),l[u]=a|s>>4&3,a=(15&s)<<4,h++,u++,!(u>=r))&&(s=t[n.charCodeAt(h)],void 0===s&&e("Invalid letter: "+n.charCodeAt(h)),l[u]=a|s>>2&15,a=(3&s)<<6,h++,u++,!(u>=r));)s=t[n.charCodeAt(h)],void 0===s&&e("Invalid letter: "+n.charCodeAt(h)),l[u]=a|s,h++,u++;return o}function a(n){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],t="",r=new Uint8Array(n),i=r.length,a=0,s=0,o=0;i>o&&(s=r[o],t+=e[s>>2],a=(3&s)<<4,o++,!(o>=i))&&(s=r[o],t+=e[a|s>>4],a=(15&s)<<2,o++,!(o>=i));)s=r[o],t+=e[a|s>>6],t+=e[63&s],o++;var l=i%3;return l&&(t+=e[a]),1==l?t+="==":2==l&&(t+="="),t}return{getQueryString:n,endsWith:t,startsWith:r,Base64_To_ArrayBuffer:i,Base64_From_ArrayBuffer:a}}(),requireSimulator.setName("Assets"),define(["WebSite","Util","Tonyu"],function(n,e,t){var r={};return r.resolve=function(t,r){if(null==t&&(t=""),t=t.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,t){return n[t]}),n.urlAliases[t]&&(t=n.urlAliases[t]),e.startsWith(t,"ls:")){var i=t.substring("ls:".length);if(!r)throw new Error("Basedir not specified");var a=r.rel(i);if(!a.exists())throw"ImageList file not found: "+a;t=a.text()}return t},t.Assets=r,r}),requireSimulator.setName("ImageList"),define(["PatternParser","Util","Assets"],function(n,e,t){function r(n){var e=[];return n.forEach(function(n){n&&""!=n.url&&e.push(n)}),e}var i,a={};return i=function(e,t,s){s||(s={}),e=r(e);var o=[],l=e.length;e.forEach(function(e,r){function h(){var i,a;if((i=e.pwidth)&&(a=e.pheight)){for(var s=0,h=0,u=this.width,c=this.height,_=[];;){var d=i,T=a;if(s+i>u&&(d=u-s),h+a>c&&(T=c-h),_.push({image:this,x:s,y:h,width:d,height:T}),s+=i,s+i>u&&(s=0,h+=a,h+a>c))break}o[r]=_}else{var S=new n(this);o[r]=S.parse()}if(o[r].name=e.name,l--,0==l){var p=[],f={};o.forEach(function(n){f[n.name]=p.length,p=p.concat(n)}),p.names=f,t(p)}}console.log("loading",e,r);var u=e.url,c=u;if(a[c])return void h.apply(a[c],[]);u=i.convURL(u,s.baseDir);var _=$("<img>");_.load(function(){a[c]=this,h.apply(this,[])}),_.attr("src",u)})},i.load=i,i.parse1=function(e,t,r){var i,a,s;if((i=e.pwidth)&&(a=e.pheight)){for(var o=0,l=0,h=t.width,u=t.height,c=[];;)if(c.push({image:this,x:o,y:l,width:i,height:a}),o+=i,o+i>h&&(o=0,l+=a,l+a>u))break;s=c}else{var _=new n(t,r);s=_.parse()}return s.name=e.name,s},i.convURL=function(n,e){return t.resolve(n,e)},window.ImageList=i,i}),requireSimulator.setName("typeCheck"),"function"!=typeof define&&(define=require("requirejs").define),define(["Visitor"],function(){return TypeCheck=function(){}}),requireSimulator.setName("Auth"),define(["WebSite"],function(n){var e={};return e.currentUser=function(e){$.ajax({type:"get",url:n.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(n){console.log("auth.currentUser",n),n=JSON.parse(n);var t=n.user;"null"==t&&(t=null),console.log("user",t,"csrfToken",n.csrfToken),e(t,n.csrfToken)}})},e.assertLogin=function(t){e.currentUser(function(e,r){return e?t.success(e,r):(window.onLoggedIn=t.success,void t.showLoginLink(n.serverTop+"/login"))})},window.Auth=e,e}),requireSimulator.setName("Blob"),define(["Auth","WebSite","Util"],function(n,e,t){var r={},i="${blobPath}";return r.BLOB_PATH_EXPR=i,r.upload=function(n,t,r,i){var a=new FormData(document.getElementById("fileinfo"));i.error&&(i.error=function(n){alert(n)}),a.append("theFile",r),a.append("user",n),a.append("project",t),a.append("fileName",r.name),$.ajax({type:"get",url:e.serverTop+"/blobURL",success:function(n){$.ajax({url:n,type:"POST",data:a,processData:!1,contentType:!1,success:function(n){console.log("Res = "+n),i.success.apply({},arguments)},error:i.error})}})},r.isBlobURL=function(n){if(t.startsWith(n,i)){var e=n.split("/");return{user:e[1],project:e[2],fileName:e[3]}}},r.url=function(n,t,r){return e.blobPath+n+"/"+t+"/"+r},r.uploadToExe=function(n,t){var r=n.getBlobInfos(),i=r.length;return console.log("uploadBlobToExe cnt=",i),0==i?t.success():(t.progress||(t.progress=function(n){console.log("uploadBlobToExe cnt=",n)}),void r.forEach(function(n){var r={csrfToken:t.csrfToken};for(var a in n)r[a]=n[a];$.ajax({type:"get",url:e.serverTop+"/uploadBlobToExe",data:r,success:function(){return i--,0==i?t.success():void t.progress(i)},error:t.error})}))},r}),requireSimulator.setName("ImageRect"),define([],function(){function n(e,t){if("string"==typeof e){var r=new Image,i=null,a=null,s=function(n){n&&(a=n),a&&i&&a(i)};return r.onload=function(){i=n(r,t),s()},r.src=e,s}var o=t.width,l=t.height,h=t.getContext("2d"),u=e.width,c=e.height,_=l/c*u,d=o/u*c;d>l&&(d=l),_>o&&(_=o),h.clearRect(0,0,o,l);var T=Math.floor((o-_)/2),S=Math.floor((l-d)/2);return h.drawImage(e,0,0,u,c,T,S,_,d),{left:T,top:S,width:_,height:d,src:e}}return n}),requireSimulator.setName("thumbnail"),define(["ImageRect"],function(n){function e(e){try{var i=Tonyu.globals.$Screen.buf[0],a=$("<canvas>").attr({width:100,height:100});n(i,a[0]);var s=a[0].toDataURL(),o=e.getResource(),l=e.getDir(),h=t.file(e);h.text(s);for(var u={name:r,pwidth:100,pheight:100,url:"ls:"+h.relPath(l)},c=o.images,_=!1,d=0;d<c.length;d++)c[d].name==r&&(c[d]=u,_=!0);_||c.push(u),e.setResource(o),console.log("setRSRC",o)}catch(T){console.log("Create thumbnail failed",T)}}var t={},r="$icon_thumbnail";return t.set=function(n,t){setTimeout(function(){e(n)},t)},t.get=function(n){var e=t.file(n);return e.exists()?e.text():null},t.file=function(n){var e=n.getDir(),t=e.rel("images/").rel("icon_thumbnail.png");return t},t}),requireSimulator.setName("plugins"),define(["WebSite"],function(n){function e(n){return"function"==typeof n&&(n={onload:n}),n||(n={}),n.onload||(n.onload=function(){}),n}var t={},r={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/T2Body/,symbol:"Box2D"},timbre:{src:"timbre.js",detection:/\bplay(SE)?\b/,symbol:"T"}};return t.detectNeeded=function(n,e){for(var t in r){var i=r[t].detection.exec(n);i&&(e[t]=1)}return e},t.loaded=function(n){var e=r[n];if(!e)throw new Error("plugin not found: "+n);return window[e.symbol]},t.loadAll=function(n,i){function a(){l>=s.length?i.onload():t.load(s[l++],a)}i=e(i);var s=[];for(var o in n)r[o]&&!t.loaded(o)&&s.push(o);var l=0;console.log("loading plugins",s),a()},t.load=function(t,i){var a=r[t];if(!a)throw new Error("plugin not found: "+t);i=e(i);var s=n.pluginTop+"/"+a.src;location.href.match(/^file:/)?($("<script>").attr("src",s).appendTo("body"),setTimeout(i.onload,500)):$.getScript(s,i.onload)},t.request=function(n){if(!t.loaded(n)){var e=new Error("Plugin "+n+" required");e.pluginName=n}},t}),requireSimulator.setName("Tonyu.Project"),define(["Tonyu","ProjectCompiler","TError","FS","Tonyu.TraceTbl","ImageList","StackTrace","typeCheck","Blob","thumbnail","WebSite","plugins","Tonyu.Compiler.Semantics","Tonyu.Compiler.JSGenerator","DeferredUtil"],function(n,e,t,r,i,a,s,o,l,h,u,c,_,d,T){return n.Project=function(i,o){var _=e(i),d=e(o),S=(n.extend({},_),r.get(u.tonyuHome));o||(o=S.rel("Kernel/"));var p=n.TraceTbl,f={classes:{},traceTbl:p,options:{compiler:{}}};return _.EXT=".tonyu",_.NSP_KER="kernel",_.NSP_USR="user",_.env=f,_.dumpJS=function(n){function e(n){console.log("Class "+n+":\n"+f.classes[n].src.js)}if(n)e(n);else for(var n in f.classes)e(n)},_.stop=function(){var n=_.runningThread;n&&n.kill();var e=_.runningObj;e&&e.stop&&e.stop()},_.rawRun=function(n){if(u.removeJSOutput){var e=_.getOutputFile();e.exists()&&e.rm()}return _.loadClasses().then(T.throwF(function(){_.runScriptMode||h.set(_,2e3),_.rawBoot(n)}))},_.getResource=function(){var e=i.rel("res.json");if(e.exists()){var t=e.obj(),r=!1;for(var a in t)for(var s=t[a],o=s.length-1;o>=0;o--)s[o].url||(s.splice(o,1),r=!0);return r&&_.setResource(t),t}return n.defaultResource},_.hasSoundResource=function(){var n=_.getResource();return n&&n.sounds&&n.sounds.length>0},_.setResource=function(n){var e=i.rel("res.json");e.obj(n)},_.getThumbnail=function(){return h.get(_)},_.convertBlobInfos=function(n){function e(t){if("object"==typeof t)for(var i in t)if(t.hasOwnProperty(i)){var a=t[i];if("url"==i){var s;(s=l.isBlobURL(a))&&(t[i]=[l.BLOB_PATH_EXPR,n,r,s.fileName].join("/"))}e(a)}}var t=_.getResource(),r=_.getName();e(t),_.setResource(t)},_.getBlobInfos=function(){function n(e){if("object"==typeof e)for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if("url"==r){var a;(a=l.isBlobURL(i))&&t.push(a)}n(i)}}var e=_.getResource(),t=[];return n(e),t},_.loadResource=function(e){var t=_.getResource();a(t.images,function(t){var r=n.getGlobal("$Sprites");r&&r.setImageList(t);for(var i in t.names)n.setGlobal(i,t.names[i]);e&&e()})},_.getOptions=function(){f.options=null;var e=i.rel("options.json");return e.exists()&&(f.options=e.obj()),f.options&&!f.options.run&&(f.options=null),f.options||(f.options=n.defaultOptions),_.fixOptions(f.options),f.options},_.fixOptions=function(n){n.compiler||(n.compiler={}),n.compiler.commentLastPos=_.runScriptMode||s.isAvailable(),n.run.mainClass=_.fixClassName(n.run.mainClass),n.run.bootClass=_.fixClassName(n.run.bootClass),n.plugins||(n.plugins={},i.each(function(e){e.endsWith(_.EXT)&&c.detectNeeded(e.text(),n.plugins)}))},_.requestPlugin=function(n){if(!c.loaded(n)){var e=_.getOptions();e.plugins[n]=1,_.setOptions(e);var t=new Error("必要なプラグイン"+n+"を追加しました。もう一度実行してください");throw t.pluginName=n,t}},_.loadPlugins=function(n){var e=_.getOptions();c.loadAll(e.plugins,n)},_.fixClassName=function(n){if(_.classExists(n))return n;var e,t=n.split("."),r=t.pop();return e=_.NSP_USR+"."+r,_.classExists(e)?e:(e=_.NSP_KER+"."+r,_.classExists(e)?e:n)},_.classExists=function(n){var e=n.split(".");if(1==e.length)return!1;var t=e[0],r=e[1];if(_.isKernelEditable()){if(t==_.NSP_KER){if(i.rel(r+_.EXT).exists())return!0;if(o.rel(r+_.EXT).exists())return!0}}else{if(t==_.NSP_KER&&o.rel(r+_.EXT).exists())return!0;if(t==_.NSP_USR&&i.rel(r+_.EXT).exists())return!0}return!1},_.getNamespace=function(){var n=_.getOptions();return n.compiler&&n.compiler.namespace?n.compiler.namespace:_.isKernelEditable()?_.NSP_KER:_.NSP_USR},_.getDependingProjects=function(){return[d]},_.getOutputFile=function(){var n=_.getOptions();return n.compiler.outputFile?r.resolve(n.compiler.outputFile):i.rel("js/concat.js")},_.setOptions=function(n){n&&(f.options=n);var e=i.rel("options.json"),t=e.exists()?e.text():"",r=JSON.stringify(f.options);t!=r&&(console.log("update option",t,r),e.text(r))},_.rawBoot=function(e){var r=n.getClass(e);if(!r)throw t(e+" というクラスはありません","不明",0);n.runMode=!0;var i=new r,a=n.thread();a.apply(i,"main"),_.runningThread=a,_.runningObj=i,$LASTPOS=0,a.steps()},_.isKernel=function(n){var e=null;return o.recursive(function(t){t.truncExt(_.EXT)===n&&(e=t)}),e},_.isKernelEditable=function(){return f.options.kernelEditable},_.getDir=function(){return i},_.getName=function(){return i.name().replace(/\/$/,"")},_.renameClassName=function(n,e){_.compile();var t=_.env.classes;for(var r in t){var i=t[r],a=i.src?i.src.tonyu:null,s=i.annotation,o=[];if(s&&a){for(var l in s)try{var h=s[l],u=h.scopeInfo;if(u&&"class"==u.type&&u.name==n){var c=h.node.pos,d=h.node.len,T=a.text().substring(c,c+d);T==n&&(o.push({pos:c,len:d}),console.log(a.path(),c,d,a.text().substring(c-5,c+d+5),"->",e))}}catch(S){console.log(S)}o=o.sort(function(n,e){return e.pos-n.pos}),console.log(a.path(),o);var p=a.text(),f=p;o.forEach(function(n){p=p.substring(0,n.pos)+e+p.substring(n.pos+n.len)}),f==p||a.isReadOnly()||(console.log("Refact:",a.path(),p),a.text(p))}}},_}}),requireSimulator.setName("Shell"),define(["FS","Util","WebSite"],function(n,e,t){function r(n,e){var t=i(n);if(e&&!t.exists())throw t+": no such file or directory";return t}function i(t){if("string"!=typeof t)return t;if(e.startsWith(t,"/"))return n.get(t);var r=a.cwd;return r.rel(t)}var a={cwd:n.get("/")};return a.cd=function(n){return a.cwd=r(n,!0),a.pwd()},a.resolve=r,a.pwd=function(){return a.cwd+""},a.ls=function(n){return n=n?r(n,!0):a.cwd,n.ls()},a.mv=function(n,e){var t=r(n,!0),i=r(e);i.moveFrom(t)},a.cp=function(n,e,t){t||(t={}),t.v&&a.echo("cp",n,e);var i=r(n,!0),s=r(e);return s.copyFrom(i,t)},a.rm=function(n,e){return e||(e={}),e.notrash?(n=r(n,!1),n.removeWithoutTrash(),1):(n=r(n,!0),void n.rm(e))},a.cat=function(n){n=r(n,!0),a.echo(n.text())},a.resolve=function(n){return n||(n="."),n=r(n)},a.grep=function(n,e,t){function i(n,e,r){t.res&&t.res.push({file:n,lineNo:e,line:r}),a.echo(n+"("+e+"): "+r)}return e=r(e,!0),t||(t={}),t.res||(t.res=[]),e.isDir()?e.each(function(e){a.grep(n,e,t)}):"string"==typeof n&&e.lines().forEach(function(t,r){t.indexOf(n)>=0&&i(e,r+1,t)}),t.res},a.touch=function(n){return n=r(n),n.text(n.exists()?n.text():""),1},a.setout=function(n){a.outUI=n},a.echo=function(){console.log.apply(console,arguments),a.outUI&&a.outUI.log&&a.outUI.log.apply(a.outUI,arguments)},a.err=function(){console.log.apply(console,arguments),a.outUI&&a.outUI.err&&a.outUI.err.apply(a.outUI,arguments)},a.prompt=function(){},a.ASYNC={r:"SH_ASYNC"},a.help=function(){for(var n in a){var e=a[n];"function"==typeof e&&a.echo(n+(e.description?" - "+e.description:""))}},sh=a,t.isNW&&(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()}),a}),requireSimulator.setName("KeyEventChecker"),define([],function(){var n={};return n.down=function(e,t,r){e instanceof $||(e=$(e)),e.bind("keydown",function(i){return n.is(i,t)?r.call(e[0],i):void 0})},n.is=function(n,e){e=e.toLowerCase(),n=n.originalEvent||n;var t="";return n.altKey&&(t+="alt+"),n.ctrlKey&&(t+="ctrl+"),n.shiftKey&&(t+="shift+"),t+=n.keyCode>=112&&n.keyCode<=123?"f"+(n.keyCode-111):String.fromCharCode(n.keyCode),t=t.toLowerCase(),e==t},n}),requireSimulator.setName("ScriptTagFS"),define([],function(){var n={};return n.toObj=function(){function n(n,e){var t=n.split("\n"),r="";return t.forEach(function(n){r+=n.length>e?n.substring(0,e):n+"\n"}),r}var e=$("script"),t={};return e.each(function(){var e=this;if("text/tonyu"==e.type){var r=$(e).data("filename");if(r){var i=parseInt($(e).data("lastupdate")),a=$(e).data("wrap");a?(a=parseInt(a),t[r]={lastUpdate:i,text:n(e.innerHTML,a)}):t[r]={lastUpdate:i,text:e.innerHTML}}}}),t},n.copyTo=function(e){var t=n.toObj();for(var r in t){var i=e.rel(r);i.text(t[r].text)}},n}),requireSimulator.setName("T2MediaLib");var T2MediaLib_BGMPlayer=function(n){this.id=n,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1};T2MediaLib_BGMPlayer.prototype.playBGM=function(n,e,t,r,i){if(!T2MediaLib.context)return null;var a=this.playingBGM;return a instanceof AudioBufferSourceNode&&a.stop(0),this.playingBGM=T2MediaLib.playSE(n,this.bgmVolume,this.bgmTempo,t,e,r,i),this.playingBGMName=n,this.bgmPause=0,this.playingBGM},T2MediaLib_BGMPlayer.prototype.stopBGM=function(){var n=this.playingBGM;return n instanceof AudioBufferSourceNode?(n.stop(0),this.playingBGM=null,n):null},T2MediaLib_BGMPlayer.prototype.pauseBGM=function(){var n=this.playingBGM;return n instanceof AudioBufferSourceNode?(0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=n.loopStart,this.bgmPauseLoopEnd=n.loopEnd,this.bgmPauseLoop=n.loop,this.bgmPauseCurrentTime=n.context.currentTime,this.bgmPauseTempo=T2MediaLib.bgmTempo,n.stop(0),this.bgmPause=1),n):null},T2MediaLib_BGMPlayer.prototype.resumeBGM=function(){var n=this.playingBGM;return n instanceof AudioBufferSourceNode?(1===this.bgmPause&&(n=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd),this.bgmPause=0),n):null},T2MediaLib_BGMPlayer.prototype.setBGMVolume=function(n){var e=this.playingBGM;return e instanceof AudioBufferSourceNode?(this.bgmVolume=n,void T2MediaLib.setSEVolume(e,n)):null},T2MediaLib_BGMPlayer.prototype.setBGMTempo=function(n){var e=this.playingBGM;return e instanceof AudioBufferSourceNode?(0===this.bgmPause&&(e.plusTime-=(T2MediaLib.context.currentTime-e.playStartTime)*(n-this.bgmTempo)),this.bgmTempo=n,void T2MediaLib.setSERate(e,n)):null},T2MediaLib_BGMPlayer.prototype.getBGMCurrentTime=function(){var n=this.playingBGM;if(!(n instanceof AudioBufferSourceNode))return null;var e,t,r,i,a,s,o;return 0===this.bgmPause?(r=T2MediaLib.context.currentTime,i=this.bgmTempo):(r=this.bgmPauseCurrentTime,i=this.bgmPauseTempo),t=(r-n.playStartTime)*i+n.plusTime,n.loop&&(n.loopEnd-n.loopStart>0?t<n.loopStart?(a=0,s=0,o=n.buffer.duration):(a=n.loopStart,s=n.loopStart,o=n.loopEnd-n.loopStart):(o=n.buffer.duration,a=0,s=0)),n.loop?e=(t-s)%o+a:(e=t,e>n.buffer.duration&&(e=n.buffer.duration)),e},T2MediaLib_BGMPlayer.prototype.getBGMLength=function(){var n=this.playingBGM;return n instanceof AudioBufferSourceNode?n.buffer.duration:null};var T2MediaLib={context:null,seDataAry:{data:[]},bgmPlayerMax:16,bgmPlayerAry:[],playingBGM:null,playingBGMName:null,bgmPause:0,bgmPauseTime:0,bgmPauseCurrentTime:0,bgmPauseTempo:0,bgmPauseLoop:!1,bgmPauseLoopStart:0,bgmPauseLoopEnd:0,bgmVolume:1,bgmTempo:1,playingAudio:null,audioVolume:1,audioTempo:1,audioDataAry:{data:[]},init:function(){if(!this.inited&&(this.inited=!0,!this.disabled&&(window.AudioContext?T2MediaLib.context=new AudioContext:window.webkitAudioContext?T2MediaLib.context=new webkitAudioContext:(T2MediaLib.context=null,console.log("Your browser does not support yet Web Audio API")),T2MediaLib.context)))for(var n=0;n<T2MediaLib.bgmPlayerMax;n++)T2MediaLib.bgmPlayerAry[n]=new T2MediaLib_BGMPlayer(n)},allClearData:function(){var n=T2MediaLib.seDataAry.data;for(var e in n)delete n[e]},clearData:function(n){var e=T2MediaLib.seDataAry.data;delete e[n]},loadSEFromArray:function(n,e){for(var t=T2MediaLib.context,r=t.createBuffer(1,e.length,t.sampleRate),i=r.getChannelData(0),a=0;a<e.length;a++)i[a]=e[a];T2MediaLib.seDataAry.data[n]=r},loadSE:function(n,e,t){if(!T2MediaLib.context||T2MediaLib.disabled)return T2MediaLib.seDataAry.data[n]=-1,null;var r=new XMLHttpRequest;r.onload=function(){if(200===r.status||0===r.status){var e=r.response;if(e instanceof ArrayBuffer){var i=function(e){T2MediaLib.seDataAry.data[n]=e,t&&t.succ&&t.succ(n)},a=function(e){console.log(e instanceof Error?"T2MediaLib: "+e.message:"T2MediaLib: Error decodeAudioData()"),T2MediaLib.seDataAry.data[n]=-4,t&&t.err&&t.err(n,T2MediaLib.seDataAry.data[n])};T2MediaLib.context.decodeAudioData(e,i,a)}else T2MediaLib.seDataAry.data[n]=-3,t&&t.err&&t.err(n,T2MediaLib.seDataAry.data[n])}else T2MediaLib.seDataAry.data[n]=-2,t&&t.err&&t.err(n,T2MediaLib.seDataAry.data[n])},r.onerror=function(e){t&&t.err&&t.err(n,e+"")},T2MediaLib.seDataAry.data[n]=null,e.match(/^data:/)&&Util&&Util.Base64_To_ArrayBuffer?(r={onload:r.onload},r.response=Util.Base64_To_ArrayBuffer(e.replace(/^data:audio\/[a-zA-Z0-9]+;base64,/i,"")),r.status=200,r.onload()):(r.open("GET",e,!0),r.responseType="arraybuffer",r.send(null))},activate:function(){if(this.init(),!this.isActivated){this.isActivated=!0;for(var n=T2MediaLib.context,e=n.createBuffer(1,Math.floor(n.sampleRate/32),n.sampleRate),t=e.getChannelData(0),r=Math.floor(n.sampleRate/860),i=0;i<t.length;i++)t[i]=(r/2>i%r?.1:-.1)*(r>i?2:1);var a=n.createBufferSource();a.buffer=e,a.connect(n.destination),a.noteOn?a.noteOn(0):a.start&&a.start(0)}},playSE:function(n,e,t,r,i,a,s){if(!T2MediaLib.context)return null;var o=T2MediaLib.seDataAry.data[n];if(!(o instanceof AudioBuffer))return null;null===e&&(e=1),t||(t=1),r?r>o.duration?r=o.duration:0>r&&(r=0):r=0,i||(i=!1),a?0>a?a=0:a>o.duration&&(a=o.duration):a=0,s?0>s?s=0:s>o.duration&&(s=o.duration):s=o.duration;var l=T2MediaLib.context.createBufferSource();T2MediaLib.context.createGain=T2MediaLib.context.createGain||T2MediaLib.context.createGainNode;var h=T2MediaLib.context.createGain();l.buffer=o,l.loop=i,l.loopStart=a,l.loopEnd=s,l.playbackRate.value=t,l.connect(h),h.connect(T2MediaLib.context.destination);var u;return u=i&&s-a>0&&r>s?s:r,l.gainNode=h,l.playStartTime=T2MediaLib.context.currentTime,l.playOffset=u,l.plusTime=u,l.start=l.start||l.noteOn,l.stop=l.stop||l.noteOff,h.gain.value=e*e,r?i?l.start(0,r,86400):l.start(0,r):l.start(0),l.onended=function(){delete l.gainNode,l.onended=null},l},stopSE:function(n){return n instanceof AudioBufferSourceNode?(n.stop(0),n):null},setSEVolume:function(n,e){return n instanceof AudioBufferSourceNode?void(n.gainNode.gain.value=e*e):null},setSERate:function(n,e){return n instanceof AudioBufferSourceNode?void(n.playbackRate.value=e):null},getSEData:function(n){return T2MediaLib.seDataAry.data[n]},loadBGM:function(n,e,t){return T2MediaLib.loadSE(n,e,t)},playBGM:function(n,e,t,r,i,a){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var s=T2MediaLib.bgmPlayerAry[n];return s instanceof T2MediaLib_BGMPlayer?s.playBGM(e,t,r,i,a):null},stopBGM:function(n){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var e=T2MediaLib.bgmPlayerAry[n];return e instanceof T2MediaLib_BGMPlayer?e.stopBGM():null},pauseBGM:function(n){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var e=T2MediaLib.bgmPlayerAry[n];return e instanceof T2MediaLib_BGMPlayer?e.pauseBGM():null},resumeBGM:function(n){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var e=T2MediaLib.bgmPlayerAry[n];return e instanceof T2MediaLib_BGMPlayer?e.resumeBGM():null},setBGMVolume:function(n,e){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var t=T2MediaLib.bgmPlayerAry[n];return t instanceof T2MediaLib_BGMPlayer?t.setBGMVolume(e):null},setBGMTempo:function(n,e){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var t=T2MediaLib.bgmPlayerAry[n];return t instanceof T2MediaLib_BGMPlayer?t.setBGMTempo(e):null},getBGMCurrentTime:function(n){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var e=T2MediaLib.bgmPlayerAry[n];return e instanceof T2MediaLib_BGMPlayer?e.getBGMCurrentTime():null},getBGMLength:function(n){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var e=T2MediaLib.bgmPlayerAry[n];return e instanceof T2MediaLib_BGMPlayer?e.getBGMLength():null},getBGMData:function(n){return T2MediaLib.getSEData(n)},getBGMPlayerMax:function(){return T2MediaLib.bgmPlayerMax},allStopBGM:function(){for(var n=0;n<T2MediaLib.bgmPlayerMax;n++)T2MediaLib.stopBGM(n)},loadAudio:function(n,e){var t=new Audio(e);t.play(),T2MediaLib.audioDataAry.data[n]=null,t.addEventListener("loadstart",function(){if(!T2MediaLib.context)return null;var n=T2MediaLib.context.createMediaElementSource(t);n.connect(T2MediaLib.context.destination)},!1),t.addEventListener("canplay",function(){T2MediaLib.audioDataAry.data[n]=t},!1),t.load()},playAudio:function(n,e,t){var r=T2MediaLib.audioDataAry.data[n];return r?(t||(t=0),T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.pause(),T2MediaLib.playingAudio.currentTime=0),T2MediaLib.playingAudio=r,r.loop=e,r.volume=T2MediaLib.audioVolume,r.currentTime=t,r.play(),r):null},stopAudio:function(){var n=T2MediaLib.playingAudio;return n instanceof Audio?(n.pause(),n.currentTime=0,T2MediaLib.playingAudio=null,n):null},pauseAudio:function(){var n=T2MediaLib.playingAudio;return n?(n.pause(),n):null},resumeAudio:function(){var n=T2MediaLib.playingAudio;return n?(n.play(),n):null},setAudioVolume:function(n){T2MediaLib.audioVolume=n,T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.volume=n)},setAudioTempo:function(n){T2MediaLib.audioTempo=n,T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.playbackRate=n)},setAudioPosition:function(n){T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.currentTime=n)},getAudioData:function(n){return T2MediaLib.audioDataAry.data[n]},getAudioCurrentTime:function(){return T2MediaLib.playingAudio instanceof Audio?T2MediaLib.playingAudio.currentTime:null},getAudioLength:function(){return T2MediaLib.playingAudio instanceof Audio?T2MediaLib.playingAudio.duration:null}};requireSimulator.setName("runtime"),requirejs(["ImageList","T2MediaLib"],function(){}),requireSimulator.setName("SoundDiag"),define(["T2MediaLib"],function(n){return SoundDiag={},SoundDiag.show=function(e){function t(){n.init(),n.disabled=!1,n.activate(),console.log("Sound ON"),a.remove(),e()}function r(){n.disabled=!0,console.log("Sound OFF"),a.remove(),e()}var i={fontSize:"2em"};e=e||function(){};var a=$("<div>").css({position:"absolute",left:100,top:100}).append($("<button>").css(i).text("Sound on").click(t)).append($("<button>").css(i).text("Sound off").click(r)).appendTo("body")},SoundDiag}),requireSimulator.setName("runScript"),requirejs(["FS","Tonyu.Project","Shell","KeyEventChecker","ScriptTagFS","runtime","WebSite","SoundDiag"],function(n,e,t,r,i,a,s){$(function(){function r(){l=$(window).width(),h=$(window).height(),u.attr({width:l,height:h})}function a(){Tonyu.currentProject=Tonyu.globals.$currentProject=g;var n=g.getOptions();n.compiler&&n.compiler.diagnose&&(n.compiler.diagnose=!1,g.setOptions(n)),g.runScriptMode=!0,g.rawRun(n.run.bootClass)}var o=n.get(s.tonyuHome);Tonyu.defaultResource={images:[{name:"$pat_base",url:"images/base.png",pwidth:32,pheight:32},{name:"$pat_sample",url:"images/Sample.png"},{name:"$pat_neko",url:"images/neko.png",pwidth:32,pheight:32}],sounds:[]},SplashScreen={hide:function(){$("#splash").hide()
},show:function(){}};var l=$(window).width(),h=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var u=$("<canvas>").attr({width:l,height:h}).appendTo("body");$(window).resize(r);var c=location.href.replace(/\?.*/,"").split(/\//),_=c.pop();_.length<0&&(c="runscript");var d=o.rel(_+"/"),T=i.toObj();for(var S in T){var p=d.rel(S);if(!p.isDir()){var f=T[S];if("js/concat.js"==S){if(p.exists()&&p.lastUpdate()>f.lastUpdate)continue}else p.useRAMDisk();p.text(f.text),delete f.text,f.lastUpdate&&p.metaInfo(f)}}t.cd(d);var y="Main",m=$("script");m.each(function(){var n=this;if("text/tonyu"==n.type){var e=$(n).data("filename");if(e){var t=d.rel(e);$(n).data("main")&&(y=t.truncExt(".tonyu"))}}}),Tonyu.defaultOptions={compiler:{defaultSuperClass:"Actor"},run:{mainClass:y,bootClass:"Boot"},kernelEditable:!1};var A=o.rel("Kernel/"),g=e(d,A);a()})}),requireSimulator.setName();