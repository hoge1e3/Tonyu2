!function(){var n={};return n.def=function(e,t,r){var i=n.getModuleInfo(n.curName);i.type=r,n.setReqs(i,e),i.func=function(){return t.apply(this,n.getObjs(e))},n.loadIfAvailable(i)},define=function(e,t){n.def(e,t,"define")},require=requirejs=function(e,t){n.def(e,t,"require")},n.setReqs=function(e,t){t.forEach(function(t){var r=n.getModuleInfo(t);r.loaded||(e.reqs[t]=r,r.revReqs[e.name]=e)})},n.getModuleInfo=function(e){var t=n.modules;return t[e]||(t[e]={name:e,reqs:{},revReqs:{}}),t[e]},n.doLoad=function(e){var t=n.getModuleInfo(e);if(t.loaded)return t.obj;t.loaded=!0;var r=null;if(t.func)r=t.func();else{var i=e.split(/\./);r=function(){return this}(),i.forEach(function(n){r&&(r=r[n])}),null==r&&console.log("Warning: No obj for "+e)}if("define"==t.type&&null==r)throw"No obj for "+e;t.obj=r;for(var a in t.revReqs)n.notifyLoaded(t.revReqs[a],t.name);return r},n.notifyLoaded=function(e,t){delete e.reqs[t],n.loadIfAvailable(e)},n.loadIfAvailable=function(e){for(var t in e.reqs)return;n.doLoad(e.name)},n.getObjs=function(e){var t=[];return e.forEach(function(e){var r=n.doLoad(e);t.push(r)}),t},n.modules={},n.setName=function(e){n.curName&&(n.getModuleInfo(n.curName).func||n.doLoad(n.curName)),e&&(n.curName=e)},requireSimulator=n,n}(),requireSimulator.setName("WebSite"),define([],function(){var n=document.location.href,e=!!n.match(/html\/dev\//)&&!!n.match(/localhost:3/);return window.WebSite=n.match(/jsrun\.it/)?{urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/j/D/9/q/jD9qQ.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:e,pluginTop:"http://tonyuedit.appspot.com/js/plugins"}:n.match(/tonyuexe\.appspot\.com/)||n.match(/localhost:8887/)||(n.match(/^file:/)||n.match(/localhost/)||n.match(/tonyuedit\.appspot\.com/))&&n.match(/\/html\/((dev)|(build))\//)?{urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:e}:{urlAliases:{},top:"../..",devMode:e},window.WebSite.pluginTop||(window.WebSite.pluginTop=window.WebSite.top+"/js/plugins"),window.WebSite.disableROM={},n.match(/tonyuedit\.appspot\.com/)||n.match(/localhost:8888/),(n.match(/\.appspot\.com/)||n.match(/localhost:888[87]/))&&(window.WebSite.serverType="GAE"),n.match(/localhost:3000/)&&(window.WebSite.serverType="Node"),window.WebSite.serverTop=n.match(/tonyuexe\.appspot\.com/)||n.match(/localhost:8887/)?window.WebSite.top+"/exe":window.WebSite.top+"/edit",window.WebSite.sampleImg=window.WebSite.top+"/images",window.WebSite.blobPath=window.WebSite.serverTop+"/serveBlob",window.WebSite.isNW="object"==typeof process&&process.__node_webkit,window.WebSite.tonyuHome="/Tonyu/",window.WebSite.isNW&&(window.WebSite.tonyuHome=process.env.TONYU_HOME?process.env.TONYU_HOME.replace(/\\/g,"/"):process.cwd().replace(/\\/g,"/").replace(/\/$/,"")+"/fs/Tonyu/"),window.WebSite}),requireSimulator.setName("SFileNW"),define(["WebSite"],function(n){function e(n){this._path=o(n)}function t(n,e){for(var t in e)n[t]=e[t]}function r(n,e){return n.substring(n.length-e.length)===e}function i(n,e){return n.substring(0,e.length)===e}function a(n){return!f&&i(n,c)||f&&n.match(h)}function s(n){return r(n,c)?n.substring(0,n.length-1):n}function o(n,e){if(e=e||process.cwd(),e=e.replace(/\\/g,c),n=n.replace(/\\/g,c),f&&i(n,c)){var t=e,o=h.exec(t);if(!o)throw new Error(e+" : should have drive letter");n=o[0]+n}else a(n)||(n=s(e)+c+n);var l=n.split(c),u=[];l.forEach(function(n){return""!=n&&"."!=n?".."==n?void u.pop():void u.push(n):void 0});var _=u.join(c);if(f||(_=c+_),!a(_))throw new Error(_+": is not absolute. hasDriverLetter="+f);return _=s(_),r(n,c)&&(_+=c),_}var l={};if(!n.isNW)return{};var u=require("fs"),c="/",_=JSON,h=/^([a-zA-Z]):/,f=h.exec(process.cwd()),d={".png":"image/png",".jpg":"image/jpg",".gif":"image/gif",".jpeg":"image/jpg",".mp3":"audio/mp3",".ogg":"audio/ogg"};l.resolve=function(n,e){return l.get(o(n,e))},t(e.prototype,{text:function(){if(0==arguments.length)return this.isDir()?_.stringify(this.metaInfo()):this.isBinary()?this.readDataURLFromBin():u.readFileSync(this.path(),{encoding:"utf8"});var n=this.up();n&&n.mkdir(),this.isBinary()?this.writeBinFromDataURL(arguments[0]):u.writeFileSync(this.path(),arguments[0])},lines:function(){return this.text().split("\n")},readDataURLFromBin:function(){var n=this.dataHeader();if(b=u.readFileSync(this.path()),b[0]==n.charCodeAt(0)&&b[1]==n.charCodeAt(1)&&b[2]==n.charCodeAt(2)&&b[3]==n.charCodeAt(3)&&b[4]==n.charCodeAt(4))return b.toString("utf8");var e=b.toString("base64");return n+e},writeBinFromDataURL:function(n){var e=this.dataHeader(),t=n.substring(e.length),r=new Buffer(t,"base64"),i=u.createWriteStream(this.path());i.write(r),i.end()},isBinary:function(){return d[this.ext()]},dataHeader:function(){var n=this.isBinary();return"data:"+n+";base64,"},obj:function(){return 0==arguments.length?_.parse(this.text()):void this.text(_.stringify(arguments[0]))},isReadOnly:function(){return!1},rm:function(){return this.isDir()?u.rmdirSync(this.path()):u.unlinkSync(this.path())},path:function(){return this._path},pathTS:function(){return s(this.path())},name:function(){var n=this.pathTS(),e="";return r(this.path(),c)&&(e=c),n.split(c).pop()+e},ext:function(){var n=this.name(),e=/\.[a-zA-Z0-9]+$/.exec(n);return e?e[0]:null},truncExt:function(n){var e=this.name();return e.substring(0,e.length-n.length)},endsWith:function(n){return r(this.name(),n)},exists:function(){return u.existsSync(this.path())},each:function(n,e){if(e||(e={}),!this.isDir())throw new Error(this+" cannot each. not a dir.");if(this.exists()){var t=this.pathTS(),r=u.readdirSync(this.path()),i=this;r.forEach(function(r){if(".dirinfo"!=r||e.includeDirInfo){var a=u.statSync(t+c+r),s=a.isDirectory()?c:"",o=i.rel(r+s);n(o)}})}},ls:function(){var n=[];return this.each(function(e){n.push(e.name())}),n},parent:function(){return this.up()},recursive:function(n){this.each(function(e){e.isDir()?e.recursive(n):n(e)})},toString:function(){return this.path()},rel:function(n){return new e(this.pathTS()+c+n)},mkdir:function(){if(this.exists()){if(this.isDir())return;throw new Error(this+" is a file. not a dir.")}var n=this.up();n&&n.mkdir(),u.mkdirSync(this.path())},relPath:function(n){var e=n.path?n.path():n;if(e.substring(e.length-1)!=c)throw new Error(e+" is not a directory.");return this.path().substring(0,e.length)!=e?"../"+this.relPath(n.up()):this.path().substring(e.length)},equals:function(n){return n instanceof e&&n.path()==this.path()},lastModified:function(){return this.stat().mtime.getTime()},lastUpdate:function(){return this.lastModified()},up:function(){var n=this.pathTS(),t=n.split(c);return t.pop(),n=t.join(c),""==n?null:new e(n+c)},copyFrom:function(n,e){this.isDir()||(this.text(n.text()),e.a&&file.metaInfo(n.metaInfo()))},isDir:function(){return this.exists()?this.stat().isDirectory():r(this.path(),c)},stat:function(){return u.statSync(this.path())},metaInfo:function(){if(this.isDir()){var n={};return this.each(function(e){n[e.name()]=e.metaInfo()}),n}return{lastUpdate:this.lastUpdate()}}}),l.get=function(n){if(null==n)throw new Error("FS.get: null path");return n instanceof e?n:new e(n)};var T="DONOTEXPORT";return l.exportDir=function(n,e){function t(r){var a=r.relPath(n);if(i[a]=r.text(),e.keepCR||(i[a]=i[a].replace(/\r/g,"")),r.isDir()){if(r.rel(T).exists())return;r.each(t)}}e||(e={}),"string"==typeof n&&(n=l.get(n));var r={base:n.path()},i=r.data={};return t(n),r},l}),requireSimulator.setName("FS"),define(["WebSite","SFileNW"],function(n,e){function t(n,e){if(e)for(var t in e)n[t]=e[t]}function r(n,e){return n.substring(n.length-e.length)===e}function i(n,e){return n.substring(0,e.length)===e}function a(){return(new Date).getTime()}function s(n){var e=n.split(x);return""==e[e.length-1]&&(e[e.length-2]+=x,e.pop()),e}function o(n){for(var e in O){var t=n.substring(0,e.length),r=n.substring(e.length);if(t==e)return{rom:O[e],rel:r}}return null}function l(n){return h(n)?g:localStorage}function u(n,e){var t=l(n),r=o(n);if(2!=arguments.length)return r?r.rom[r.rel]:t[n];if(r)throw new Error(n+" is Read only.");return null!=e?t[n]=e:void delete t[n]}function c(n){var e=l(n),t=o(n);return t?t.rel in t.rom:n in e}function _(n,e,t,r){if(null==n)throw new Error("putDir: Null path");if(!v(n))throw new Error("Not a directory : "+n);r==P?g[n]=e:u(n,JSON.stringify(e));var i=y(n);if(null!=i){var a=f(i,r);d(a,i,m(n),t,r)}}function h(n){return"ALL"==$?!0:"object"==typeof $&&$?n in $:!1}function f(n,e){if(null==n)throw new Error("getDir: Null path");r(n,x)||(n+=x);var i={},a={};if(e&P&&(a=g[n]||{}),e&A)try{var s=u(n);s&&(i=JSON.parse(s))}catch(o){console.log("dinfo err : "+n+" - "+i)}t(i,a),t(i,L[n]);for(var l in i)"number"==typeof i[l]&&(i[l]={lastUpdate:i[l]});return i}function d(n,e,t,r,i){n[t]||(n[t]={},r&&(n[t].trashed=!0)),r||delete n[t].trashed,n[t].lastUpdate=a(),_(e,n,r,i)}function T(n,e,t,r){n[t]&&(n[t]={lastUpdate:a(),trashed:!0},_(e,n,!0,r))}function S(n,e,t,r){n[t]&&(delete n[t],_(e,n,!0,r))}function y(n){if(n==x)return null;var e=s(n);return e[e.length-1]="",e.join(x)}function p(n){return i(n,x)}function v(n){return r(n,x)}function m(n){var e=s(n);return e[e.length-1]}if(e&&e.get)return"object"==typeof window&&(window.FS=e),e;var P=1,A=2,k=3,g={},$=null;("undefined"==typeof localStorage||null==localStorage)&&(console.log("FS: Using RAMDisk"),$="ALL");var b={};"object"==typeof window&&(window.FS=b),b.ramDisk=g,b.ramDiskUsage=$;var O={},L={},x="/";b.roms=O,b.romParents=L,b.endsWith=r,b.splitPath=s,b.orderByNewest=function(n,e){if(!(n&&e&&n.lastUpdate&&e.lastUpdate))return 0;var t=n.lastUpdate(),r=e.lastUpdate();return r>t?1:t>r?-1:0},b.orderByName=function(n,e){return n.name&&e.name&&(n=n.name(),e=e.name()),n>e?1:e>n?-1:0},b.orderByNumberedName=function(n,e){function t(n){for(var e=[],t=/^[0-9]*/,r=/^[^0-9]*/;n&&(n.match(r),e.push(RegExp.lastMatch),n=n.replace(r,""));){n.match(t);var i=parseInt(RegExp.lastMatch);e.push(i),n=n.replace(t,"")}return e}n.name&&e.name&&(n=n.name(),e=e.name());var r,i=t(n),a=t(e);for(r=0;r<i.length;r++){if(r>=a.length)return 1;if(i[r]>a[r])return 1;if(i[r]<a[r])return-1}return r<a.length?-1:0},b.importDir=function(n){var e=b.get(n.base);n.confirm||e.mkdir();var t=n.data,r=[];for(var i in t){var a=e.path()+i,s=b.get(a);if(r.push("["+(s.isReadOnly()?"ro":s.exists()?"exists":"new")+"]"+a),!s.isReadOnly()&&!n.confirm)if(s.isDir()){var o=f(a,A),l=JSON.parse(t[i]);for(var c in l)o[c]=l[c];_(a,o,!1,A)}else u(a,t[i])}return r},b.mountROM=function(n){console.log("ROM mouted on ",n.base),O[n.base]=n.data;var e=s(n.base),t=e.pop(),r=e.join(x)+x;L[r]||(L[r]={}),L[r][t]={lastUpdate:(new Date).getTime()}};var w="DONOTEXPORT";return b.exportDir=function(n,e){function t(r){var a=r.relPath(n);if(i[a]=r.text(),e.keepCR||(i[a]=i[a].replace(/\r/g,"")),r.isDir()){if(r.rel(w).exists())return;r.each(t)}}e||(e={}),"string"==typeof n&&(n=b.get(n));var r={base:n.path()},i=r.data={};return t(n),r},b.resolve=function(n,e){return b.get(e?b.get(e).rel(n):n)},b.get=function(n,e){if(e||(e={}),null==n)throw new Error("FS.get: Null path");if(n.isDir)return n;if(e.topDir&&!i(n,e.topDir))throw new Error(n+" is out of securtyDomain");if(!p(n))throw new Error(n+": Path must starts with '/'");var t,a=y(n),l=m(n);if(v(n)){var O=t={};O.files=function(n,e){var t=[];return O.each(function(n){t.add(n)},e),t},O.each=function(n,e){O.ls(e).forEach(function(e){var t=O.rel(e);n(t)})},O.recursive=function(n,e){O.each(function(e){e.isDir()?e.recursive(n):n(e)},e)},O.listFiles=function(e){var t;"function"==typeof e&&(t=e),e=O.convertOptions(e),t||(t=e.order);var r=f(n,k),i=[];for(var a in r)(e.includeTrashed||!r[a].trashed)&&(e.excludes[n+a]||i.push(O.rel(a)));return"function"==typeof t&&i.sort&&i.sort(t),i},O.ls=function(n){var e=O.listFiles(n),t=[];return e.forEach(function(n){t.push(n.name())}),t},O.convertOptions=function(e){if(e||(e={}),e.excludes||(e.excludes={}),e.excludes instanceof Array){var t={};e.excludes.forEach(function(e){i(e,"/")?t[e]=1:t[n+e]=1}),e.excludes=t}return e},O.isDir=function(){return!0},O.rel=function(n){var t=s(n),r=O.path();return r=r.replace(/\/$/,""),t.forEach(function(n){".."==n||"../"==n?r=y(r):(r=r.replace(/\/$/,""),r+=x+("."==n||"./"==n?"":n))}),b.get(r,e)},O.rm=function(){if(!O.exists())throw new Error(n+": No such dir.");var e=O.ls();if(e.length>0)throw new Error(n+": Directory not empty");if(null!=a){var t=O.mediaType(),r=f(a,t);T(r,a,l,t)}},O.removeWithoutTrash=function(){var e=O.mediaType();if(O.each(function(n){n.removeWithoutTrash()},{includeTrashed:!0}),u(n,null),null!=a){var t=f(a,e);S(t,a,l,e)}},O.mkdir=function(){O.touch()},O.text=function(){return u(n)},O.obj=function(){return JSON.parse(O.text())},O.exists=function(){if("/"==n)return!0;var e=f(a,k);return e&&e[l]&&!e[l].trashed},O.mediaType=function(){return g[n]&&!localStorage[n]?P:A}}else{var L=t={};L.isDir=function(){return!1},L.rm=function(){if(!L.exists())throw new Error(n+": No such file.");if(u(n,null),null!=a){var e=L.mediaType(),t=f(a,e);T(t,a,l,e)}},L.removeWithoutTrash=function(){if(!L.exists()&&!L.isTrashed())throw new Error(n+": No such file.");if(u(n,null),null!=a){var e=L.mediaType(),t=f(a,e);S(t,a,l,e)}},L.text=function(){return 0==arguments.length?u(n):(u(n,arguments[0]),void L.touch())},L.lines=function(){return L.text().split("\n")},L.obj=function(){if(0==arguments.length){var n=L.text();return n?JSON.parse(n):null}L.text(JSON.stringify(arguments[0]))},L.copyFrom=function(n,e){L.text(n.text()),e.a&&L.metaInfo(n.metaInfo())},L.exists=function(){return c(n)},L.useRAMDisk=function(){return"ALL"==$?L:($=$||{},$[n]=!0,L)},L.mediaType=function(){return h(n)?P:A}}return t.relPath=function(e){var r=e.path?e.path():e;if(r.substring(r.length-1)!=x)throw new Error(r+" is not a directory.");return n.substring(0,r.length)!=r?"../"+t.relPath(e.up()):n.substring(r.length)},t.isTrashed=function(){var n=t.metaInfo();return n?n.trashed:!1},t.metaInfo=function(){if(null!=a){var n;if(0==arguments.length)return n=f(a,k),n[l];var e=t.mediaType();n=f(a,e),n[l]=arguments[0],_(a,n,n[l].trashed,e)}return{}},t.lastUpdate=function(){return t.metaInfo().lastUpdate},t.up=function(){return null==a?null:b.get(a,e)},t.path=function(){return n},t.name=function(){return l},t.truncExt=function(n){return l.substring(0,l.length-n.length)},t.touch=function(){if(null!=a){var n=t.mediaType(),e=f(a,n);d(e,a,l,!1,n)}},t.isReadOnly=function(){var e=o(n);return!!e},t.startsWith=function(n){return i(l,n)},t.endsWith=function(n){return r(l,n)},t.equals=function(e){return e&&"function"==typeof e.path&&e.path()==n},t.toString=function(){return n},t},b.scan=function(){for(var n in localStorage)if(p(n)){var e=y(n);if(null!=e){var t=f(e,A),r=m(n);d(t,e,r,t[r]&&t[r].trashed,A)}}},b.dump=function(){for(var n in localStorage)console.log(n)},b.ls=function(n){return b.get(n).ls()},b}),requireSimulator.setName("fs/ROMk"),function(){var n={base:"/Tonyu/Kernel/",data:{"":'{".desktop":{"lastUpdate":1424849946377},"Actor.tonyu":{"lastUpdate":1428655839871},"BaseActor.tonyu":{"lastUpdate":1428922164311},"BodyActor.tonyu":{"lastUpdate":1425555929415},"Boot.tonyu":{"lastUpdate":1428922182137},"DxChar.tonyu":{"lastUpdate":1421384204610},"EventHandler.tonyu":{"lastUpdate":1428548570968},"EventMod.tonyu":{"lastUpdate":1428548427699},"InputDevice.tonyu":{"lastUpdate":1416890086000},"js/":{"concat.js":{"lastUpdate":1429359986781}},"Keys.tonyu":{"lastUpdate":1412697666000},"Map.tonyu":{"lastUpdate":1421122943495},"MapEditor.tonyu":{"lastUpdate":1421122943503},"MathMod.tonyu":{"lastUpdate":1424849946395},"MediaPlayer.tonyu":{"lastUpdate":1421384204625},"MML.tonyu":{"lastUpdate":1424849946399},"NoviceActor.tonyu":{"lastUpdate":1412697666000},"options.json":{"lastUpdate":1428228309742},"Pad.tonyu":{"lastUpdate":1421122943510},"Panel.tonyu":{"lastUpdate":1427702417187},"ParallelMod.tonyu":{"lastUpdate":1428655814791},"PlainChar.tonyu":{"lastUpdate":1427964942819},"PlayMod.tonyu":{"lastUpdate":1425018365373},"ScaledCanvas.tonyu":{"lastUpdate":1421122943524},"SecretChar.tonyu":{"lastUpdate":1421384204695},"SpriteChar.tonyu":{"lastUpdate":1421384204710},"Sprites.tonyu":{"lastUpdate":1421122943538},"T1Line.tonyu":{"lastUpdate":1427965036844},"T1Map.tonyu":{"lastUpdate":1421384204728},"T1Page.tonyu":{"lastUpdate":1421384204737},"T1Text.tonyu":{"lastUpdate":1427965019581},"T2Body.tonyu":{"lastUpdate":1425264703379},"T2MediaPlayer.tonyu":{"lastUpdate":1428977881924},"T2Mod.tonyu":{"lastUpdate":1425020004839},"T2World.tonyu":{"lastUpdate":1427976124069},"TextChar.tonyu":{"lastUpdate":1421384204762},"TextRectMod.tonyu":{"lastUpdate":1427702468448},"thread/":{"Scheduler.tonyu":{"lastUpdate":1429178321244}},"TObject.tonyu":{"lastUpdate":1421122943543},"TQuery.tonyu":{"lastUpdate":1412697666000},"WaveTable.tonyu":{"lastUpdate":1412697666000}}',".desktop":'{"runMenuOrd":["Main0121","Main1023","TouchedTestMain","Main2","MapLoad","Main","AcTestM","NObjTest","NObjTest2","AcTest","AltBoot","Ball","Bar","Bounce","MapTest","MapTest2nd","SetBGCTest","Label","PanelTest","BaseActor","Panel","MathMod"]}',"Actor.tonyu":'extends BaseActor;\nincludes PlayMod, ParallelMod;\nnative Sprites;\nnative Tonyu;\n\n\\new(x,y,p) {\n    super(x,y,p);\n    if (Tonyu.runMode) initSprite();\n}\n\\initSprite() {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    onAppear();\n}\n\\onAppear() {\n}\n',"BaseActor.tonyu":'extends null;\nincludes MathMod,EventMod,TextRectMod;\nnative Tonyu;\nnative Key;\nnative console;\nnative Math;\nnative FS;\nnative Array;\n\n\\new(x,y,p) {\n    if (Tonyu.runMode) {\n        var thg=currentThreadGroup();\n        if (thg) _th=thg.addObj(this);\n    }\n    if (typeof x=="object") Tonyu.extend(this,x);\n    else if (typeof x=="number") {\n        this.x=x;\n        this.y=y;\n        this.p=p;\n    }\n    if (scaleX==null) scaleX=1;\n    if (rotation==null) rotation=0;\n    if (rotate==null) rotate=0;\n    if (alpha==null) alpha=255;\n    if (zOrder==null) zOrder=0;\n    if (age==null) age=0;\n    if (anim!=null && typeof anim=="object"){\n        animMode=true;\n        animFrame=0;\n    }else{\n        animMode=false;\n    }\n    if (animFps==null) animFps=1;\n}\nnowait \\extend(obj) {\n    return Tonyu.extend(this,obj);\n}\n\nnowait \\print(pt) {\n    console.log.apply(console,arguments);\n    if($consolePanel){\n        $consolePanel.scroll(0,20);\n        $consolePanel.setFillStyle("white");\n        $consolePanel.fillText(pt,0,$consolePrintY,20,"left");\n    }\n}\n\nnowait \\setAnimFps(f){\n    this.animFps=f;\n    this.animFrame=0;\n    this.animMode=true;\n}\nnowait \\startAnim(){\n    this.animMode=true;\n}\nnowait \\stopAnim(){\n    this.animMode=false;\n}\n\\update() {\n    onUpdate();\n    if(_thread) {\n        _thread.suspend();\n    }\n}\nnowait \\onUpdate() {\n\n}\n\\updateEx(updateT){\n    for(var updateCount=0;updateCount<updateT;updateCount++){\n        update();\n    }\n}\nnowait \\getkey(k) {\n    return $Keys.getkey(k);\n}\nnowait \\hitTo(t) {\n    return crashTo(t);\n}\nnowait \\all(c) {\n    var res=new TQuery;\n    $Sprites.sprites.forEach \\(s) {\n        if (s===this) return;\n        if (!c || s instanceof c) {\n            res.push(s);\n        }\n    };\n    return res;// new TQuery{objects:res};\n}\nnowait \\allCrash(t) {\n    var res=new TQuery;\n    var sp=this; //_sprite || this;\n    var t1=getCrashRect();\n    if (!t1) return res;\n    $Sprites.sprites.forEach(\\(s) {\n        var t2;\n        if (s!==this &&\n        !s.excludeFromAll &&\n        s instanceof t &&\n        (t2=s.getCrashRect()) &&\n        Math.abs(t1.x-t2.x)*2<t1.width+t2.width &&\n        Math.abs(t1.y-t2.y)*2<t1.height+t2.height) {\n            res.push(s);\n        }\n    });\n    return res;\n}\nnowait \\crashTo(t) {\n    if (!t) return false;\n    if (typeof t=="function") {\n        return allCrash(t)[0];\n    }\n    return crashTo1(t);\n}\nnowait \\crashTo1(t) {\n    if (!t || t._isDead) return false;\n    /*if (_sprite && t._sprite) {\n        return _sprite.crashTo(t._sprite);\n    }*/\n    var t1=getCrashRect();\n    var t2=t.getCrashRect();\n    return\n    //    t1.x!=null && t1.y!=null && t1.width && t1.height &&\n    //    t2.x!=null && t2.y!=null && t2.width && t2.height &&\n    t1 && t2 &&\n    Math.abs(t1.x-t2.x)*2<t1.width+t2.width &&\n    Math.abs(t1.y-t2.y)*2<t1.height+t2.height;\n}\nnowait \\getCrashRect() {\n    var actWidth=width*scaleX, actHeight;\n    if(typeof scaleY==="undefined"){\n        actHeight=height*scaleX;\n    }else{\n        actHeight=height*scaleY;\n    }\n    return typeof x=="number" &&\n    typeof y=="number" &&\n    typeof width=="number" &&\n    typeof height=="number" &&\n    {x,y,width:actWidth,height:actHeight};\n}\nnowait \\within(t,distance){\n    if(!t || t._isDead) return false;\n    if(Math.sqrt(Math.abs(x-t.x)*Math.abs(x-t.x)+ Math.abs(y-t.y)*Math.abs(y-t.y))<distance){\n        return true;\n    }\n    return false;\n}\nnowait \\watchHit(typeA,typeB,onHit) {\n    $Sprites.watchHit(typeA , typeB, \\(a,b) {\n        onHit.apply(this,[a,b]);\n    });\n}\nnowait \\currentThreadGroup() {\n    return $currentThreadGroup;\n}\nnowait \\die() {\n    if (_th) {\n        _th.kill();\n    }\n    hide();\n    fireEvent("die");\n    _isDead=true;\n}\nnowait \\hide() {\n    /*if (_sprite) {\n        $Sprites.remove(_sprite);\n        _sprite=null;\n    } else {*/\n        //$Sprites.remove(this);\n    //}\n    if(layer && typeof layer.remove=="function"){\n        layer.remove(this);\n    }else{\n        $Sprites.remove(this);\n    }\n}\nnowait \\show(x,y,p) {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    if (x!=null) this.x=x;\n    if (y!=null) this.y=y;\n    if (p!=null) this.p=p;\n}\n\nnowait \\detectShape() {\n    if (typeof p!="number") {\n        if (text!=null) return;\n        p=0;\n    }\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) return;\n    width=pImg.width;\n    height=pImg.height;\n}\n\\waitFor(f) {\n    if (_thread) {\n        _thread.waitFor(f);\n    }\n    //update();\n}\nnowait \\isDead() {\n    return _isDead;\n}\n\nnowait \\animation(){\n    age++;\n    if(animMode && age%animFps==0){\n        p=anim[animFrame%anim.length];\n        animFrame++;\n    }\n}\nnowait \\draw(ctx) {\n    if (x==null || y==null || _isInvisible) return;\n    detectShape();\n    if (pImg) {\n        ctx.save();\n        ctx.translate(x,y);\n        //if (typeof rotate=="number" ) rotation=rotate;// 削除予定\n        //ctx.rotate(this.rotation/180*Math.PI);\n        animation();\n        if(this.rotation!=0){\n            ctx.rotate(this.rotation/180*Math.PI);\n        }else{\n            ctx.rotate(this.rotate/180*Math.PI);\n        }\n        if(typeof this.scaleY==="undefined") {\n            ctx.scale(this.scaleX,this.scaleX);\n        }else{\n            ctx.scale(this.scaleX,this.scaleY);\n        }\n        ctx.globalAlpha=this.alpha/255;\n        ctx.drawImage(\n        pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n        -width/2, -height/2, width, height);\n        ctx.restore();\n    } else if (text!==null && text!==undefined) {\n        if (!size) size=15;\n        if (!align) align="center";\n        if (!fillStyle) fillStyle="white";\n        ctx.fillStyle=fillStyle;\n        ctx.globalAlpha=this.alpha/255;\n        var rect=drawTextRect(ctx, text, x, y, size, align , "fill");\n        width=rect.w;\n        height=rect.h;\n    }\n    if (_fukidashi) {\n        if (_fukidashi.c>0) {\n            _fukidashi.c--;\n            ctx.fillStyle="white";\n            ctx.strokeStyle="black";\n            fukidashi ( ctx , _fukidashi.text,\n            x, y-height/2-10, _fukidashi.size);\n        }\n    }\n}\nnowait \\asyncResult() {\n    return Tonyu.asyncResult();\n}\n\n\\screenOut(a) {\n    //オブジェクトが画面外に出たかどうかを判定します。\n    if (!a) a=0;\n    var r=0;\n    var viewX=0,viewY=0;\n    if (x<viewX+a)               r+=viewX+a-x;\n    if (y<viewY+a)               r+=viewY+a-y;\n    if (x>$screenWidth +viewX-a) r+=x-($screenWidth +viewX-a);\n    if (y>$screenHeight+viewY-a) r+=y-($screenHeight+viewY-a);\n    return r;\n}\n\\file(path) {\n    var d=Tonyu.currentProject.getDir();\n    var files=d.rel("files/");\n    return FS.get(files.rel(path)) {topDir:d};\n}\n\\waitInputDevice(fl) {\n    if (fl!==false) {\n        if (!origTG) {\n            ifwait {\n                origTG=_thread.group;\n                _thread.setGroup(null);\n            }\n        }\n        a=asyncResult();\n        $InputDevice.addOnetimeListener(a.receiver);\n        waitFor(a);\n    } else {\n        if (origTG) {\n            ifwait {\n                _thread.setGroup(origTG);\n                origTG=null;\n            }\n        }\n    }\n}\n\\redrawScreen() {\n    $Sprites.draw($Screen.buf[0]);\n    $Screen.draw();\n}\n\n// from PlainChar\n\\color(r,g,b) {\n    return "rgb("+[r,g,b].join(",")+")";\n}\n\\drawText(x,y,text,col,size) {\n    if ($debug) return;\n    if (!size) size=15;\n    if (!col) col="cyan";\n    var tp=all(T1Text).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,text,fillStyle:col, size,hidden:false};\n    }else {\n        new T1Text{x,y,text,fillStyle:col, size};\n    }\n}\n\\drawLine(x,y,tx,ty,col) {\n    if (!col) col="white";\n    var tp=all(T1Line).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,tx,ty,col, hidden:false};\n    }else {\n        new T1Line{x,y,tx,ty,col};\n    }\n}\n\\loadPage(page,arg){\n    all().die();\n    new page(arg);\n    die();\n}\n\n\\setVisible(v) {\n    _isInvisible=!v;\n}',"BodyActor.tonyu":'extends Actor;\nincludes T2Mod;\nnative Box2D;\n\n\\getWorld() {\n    if ($t2World) return $t2World;\n    $t2World=new T2World;\n    return $t2World;\n}\n\\onAppear() {\n    world=getWorld().world;\n    scale=getWorld().scale;\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var b2BodyDef = Box2D.Dynamics.b2BodyDef;\n    var b2Body = Box2D.Dynamics.b2Body;\n    var b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n    var b2Fixture = Box2D.Dynamics.b2Fixture;\n    var b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n    var b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n    \n    var fixDef = new b2FixtureDef;\n    fixDef.density = density || 1.0;\n    fixDef.friction = friction || 0.5;\n    fixDef.restitution = restitution || 0.2;\n    \n    var bodyDef = new b2BodyDef;\n    bodyDef.type = isStatic ? b2Body.b2_staticBody :\n    b2Body.b2_dynamicBody;\n    \n    bodyDef.position.x = x /scale;\n    bodyDef.position.y = y /scale;\n    shape=shape || (radius ? "circle" : "box");\n    var w=width,h=height;\n    if (!w) {\n        detectShape();\n        w=width*(scaleX||1);\n        h=height*(scaleY||scaleX||1);\n    }\n    if (shape=="box") {\n        if (!h) h=w;\n        fixDef.shape = new b2PolygonShape;\n        fixDef.shape.SetAsOrientedBox(w/2/scale, h/2/scale,\n        new b2Vec2(0,0),0);\n    } else {\n        radius=radius || w/2 || 16;\n        fixDef.shape = new b2CircleShape(\n        radius/scale\n        );\n        width=height=radius*2;\n    } \n    body=world.CreateBody(bodyDef);\n    body.CreateFixture(fixDef);\n    body.SetUserData(this);\n    body.SetAngle(rad(rotation));\n}\n\\allContact(klass) {\n    var res=[];\n    for (var c=world.GetContactList();c;c=c.GetNext()) {\n        if (c.IsTouching()) {\n            var a=c.GetFixtureA().GetBody().GetUserData();\n            var b=c.GetFixtureB().GetBody().GetUserData();\n            if (a===this) {\n                if (!klass || b===klass || b instanceof klass) {\n                    res.push(b);\n                }\n            } else if (b===this) {\n                if (!klass || a===klass || a instanceof klass) {\n                    res.push(a);\n                }\n            }\n        }\n    }\n    return res;\n}\n\\applyForce(fx,fy,px,py) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var scale=getWorld().scale;\n    var fps=60;\n    body.ApplyForce(new b2Vec2(fx ,fy),body.GetPosition());\n}\n\\applyImpulse(fx,fy,px,py) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var scale=getWorld().scale;\n    var fps=60;\n    body.ApplyImpulse(new b2Vec2(fx ,fy),body.GetPosition());\n}\n\n\\applyTorque(a) {\n    body.ApplyTorque(a);\n}\n\\moveBy(dx,dy) {\n    var pos=body.GetPosition();\n    pos.x+=dx/scale;\n    pos.y+=dy/scale;\n    body.SetPosition(pos);\n}\n\\contactTo(t) {\n    return allContact(t)[0];\n}\n\\die() {\n    super.die();\n    world.DestroyBody(body);\n}\n\\updatePos() {\n    if (!body) return;\n    var scale=getWorld().scale;\n    var pos=body.GetPosition();\n    x=pos.x*scale;\n    y=pos.y*scale;\n    rotation=deg(body.GetAngle());\n}\n\n',"Boot.tonyu":'extends Actor;\nincludes T2MediaPlayer;\n\nnative $;\nnative TError;\nnative $LASTPOS;\nnative Key;\nnative Date;\nnative ImageList;\nnative Tonyu;\nnative SplashScreen;\nnative Math;\n\n\\update() {\n    waitFor(Tonyu.timeout(50)); // waitFor calls update...\n}\n\\initSprites() {\n    $Sprites=new Sprites();\n    $FrontSprites=new Sprites();\n    print ("Loading plugins..");\n    var a=asyncResult();\n    $currentProject.loadPlugins(a.receiver);\n    waitFor(a);\n    print ("Loading pats..");\n    var rs=$currentProject.getResource();\n    a=asyncResult();\n    ImageList.load( rs.images, a.receiver)\n    {baseDir:$currentProject.getDir()};\n    waitFor(a);\n    var r=a[0];\n    $Sprites.setImageList(r);\n    for (var name,val in r.names) {\n        Tonyu.setGlobal(name, val);\n    }\n    print ("Loading pats done.");\n    cvj=$("canvas");\n    if (Tonyu.noviceMode) {\n        $Screen=new ScaledCanvas{canvas:cvj, width:600, height:300};\n    } else {\n        $Screen=new ScaledCanvas{canvas:cvj, width:465, height:465};\n    }\n}\n\\initSounds() {\n    print ("Loading sounds...");\n    initT2MediaPlayer();\n    loadFromProject($currentProject);\n    print ("Loading sounds done.");\n}\n\n\n\\initThread() {\n    $mainThreadGroup=thg=Tonyu.threadGroup();\n    var o=Tonyu.currentProject.getOptions();\n    var mainClassName=o.run.mainClass;\n    print("MainClass= "+mainClassName);\n    mainClass=Tonyu.getClass(mainClassName);\n    if (!mainClass) {\n        TError( mainClassName+" というクラスはありません",\n        "不明" ,0).raise();\n    }\n    Tonyu.runMode=true;\n    $currentThreadGroup=thg;\n    new mainClass();\n}\n\\stop() {\n    fireEvent("stop");\n}\ninitSounds();\ninitSprites();\n$InputDevice=new InputDevice;\n$InputDevice.initCanvasEvents(cvj);\ninitThread();\n\n$pat_fruits=30;\n$Keys=new Keys;\n$Math=Math;\n$consolePanel=new Panel{align:"center",x:465/2,y:465/2,width:465,height:465,zOrder:-10,layer:$FrontSprites};\n$consolePrintY=465-15;\n$panel=new Panel{align:"center",x:$screenWidth/2,y:$screenHeight/2,width:$screenWidth,height:$screenHeight,zOrder:-1,layer:$FrontSprites};\nif (typeof SplashScreen!="undefined") SplashScreen.hide();\ninitFPSParams();\n\nwhile (true) {\n    thg.steps();\n    $Keys.update();\n    $InputDevice.update();\n    $screenWidth=$Screen.width;\n    $screenHeight=$Screen.height;\n\n    doDraw=now()<deadLine;\n    if (!doDraw && frameSkipped>=maxFrameSkip) {\n        doDraw=true;\n        resetDeadLine();\n    }\n    if (doDraw) { // フレームスキップの時は描画しない\n        $Screen.fillCanvas($Screen.buf[0]);\n        $Sprites.draw($Screen.buf[0]);\n        $FrontSprites.draw($Screen.buf[0]);\n        $Screen.draw();\n        fps_fpsCnt ++;\n        frameSkipped=0;\n    } else {\n        frameSkipped++;\n    }\n    $Sprites.checkHit();\n    fps_rpsCnt ++;\n    measureFps();\n    waitFrame(); // FPS制御\n    while(paused) {\n        waitFor(Tonyu.timeout(1));\n        if (!paused) resetDeadLine();\n    }\n}\n\nnowait \\initFPSParams() {\n    // フレームレートの設定\n    _fps = 30;\n    maxframeSkip = 5;\n    // フレームレート制御でつかう変数 //\n    frameCnt = 0;\n    resetDeadLine();\n    $Boot = this;\n    lastMeasured=now();\n    fps_fps=fps_rps=fps_fpsCnt=fps_rpsCnt=0;\n}\nnowait \\now() {\n    return new Date().getTime();\n}\nnowait \\resetDeadLine() {\n    deadLine=now()+1000/_fps;\n    frameSkipped = 0;\n}\n\n\\waitFrame() {\n    var wt=deadLine-now();\n    if (wt<1) {\n        if (wt<-1000) resetDeadLine();\n        wt=1;\n    }\n    wt=floor(wt);\n    waitFor(Tonyu.timeout(wt));\n    deadLine+=1000/_fps;\n}\n\nnowait \\getFrameRate() {\n    return _fps;\n}\n\n// Tonyu1の$System.setFrameRate() //\nnowait \\setFrameRate(fps, maxFrameSkip) {\n    _fps = fps;\n    if (typeof maxFrameSkip!="number") maxFrameSkip=5;\n    this.maxFrameSkip = maxFrameSkip;\n    resetDeadLine();\n}\n\n// FPS（計測したフレームレート）を返す //\nnowait \\getMeasuredFps() {\n    return fps_fps;\n}\n\n// RPS（計測した実行レート）を返す //\nnowait \\getMeasuredRps() {\n    return fps_rps;\n}\n\nnowait \\measureFps() {\n    if (now()>lastMeasured+1000) {\n        fps_fps=fps_fpsCnt;\n        fps_rps=fps_rpsCnt;\n        fps_fpsCnt=0;\n        fps_rpsCnt=0;\n        lastMeasured=now();\n    }\n}\n\n',"DxChar.tonyu":"extends SpriteChar;\n\n\\new (xx,yy,pp,ff,sz,rt,al){\n    super(xx,yy,pp,ff);\n    scaleX=1;\n    if (sz) scaleX=sz;\n    angle=0;\n    if (rt) angle=rt;\n    alpha=255;\n    if (al) alpha=al;\n}\n\\draw(c) {\n    rotation=angle;\n    super.draw(c);\n}\n","EventHandler.tonyu":"extends TObject;\n\nlisteners=[];\n\n\\addListener(f) {\n    listeners.push(f);\n    return {\n        remove: \\{\n           removeListener(f);\n        }\n    };\n}\n\\removeListener(f) {\n    var i=listeners.indexOf(f);\n    listeners.splice(i,1);\n}\n\\fire(args) {\n    if (released) return;\n    for (var h in listeners) {\n        h.apply(this,args);\n    }\n}\n\\release() {\n    released=true;\n}\n","EventMod.tonyu":'extends null;\nnative console;\n\n\\initEventMod() {\n   if (_eventHandlers) return;\n   _eventHandlers={};\n   on ("die",releaseEventMod);\n}\n\\releaseEventMod() {\n   for (var k,v in _eventHandlers) {\n       v.release();\n   }\n}\n\\parseArgs(a) {\n   var res={type:a[0], args:[]};\n   for (var i=1 ; i<a.length ; i++) {\n       res.args.push(a[i]);\n   }\n   return res;   \n}\n\\registerEventHandler(type, obj) {\n   // obj:{ attach, fire }\n   initEventMod();\n   if (typeof type=="function") {\n       obj=obj||new type;\n       type=obj.getClassInfo().fullName;\n   }  else {\n       obj=obj || new EventHandler;\n   }\n   return _eventHandlers[type]=obj;\n}\n\\getEventHandler(type) {\n   initEventMod();\n   var res=_eventHandlers[type] || registerEventHandler(type);\n   return res;\n}\n\n\\on() {\n    var a=parseArgs(arguments);\n    var h=getEventHandler(a.type);\n    h.addListener.apply(h,a.args);\n}\n\n\\fireEvent(type, args) {\n    getEventHandler(type).fire(args);\n}\n',"InputDevice.tonyu":'extends null;\nnative $;\nnative window;\nnative Tonyu;\n\\new() {\n    listeners=[];\n    touchEmu=true;\n}\n\\handleListeners() {\n    var l=listeners;\n    listeners=[];\n    while (l.length>0) { (l.shift())(); }\n}\n\\addOnetimeListener(l){\n    listeners.push(l);\n}\n\\initCanvasEvents(cvj) {\n    var cv=cvj[0];\n    $handleMouse=\\(e) {\n        var p=cvj.offset();\n        var mp={x:e.clientX-p.left, y:e.clientY-p.top};\n        mp=$Screen.canvas2buf(mp);\n        $mouseX=mp.x;\n        $mouseY=mp.y;\n        if (touchEmu) {\n            $touches[0].x=mp.x;\n            $touches[0].y=mp.y;\n        }\n        handleListeners();\n    };\n    $touches=[{},{},{},{},{}];\n    $touches.findById=\\(id) {\n        for (var j=0 ; j<$touches.length ; j++) {\n            if ($touches[j].identifier==id) {\n                return $touches[j];\n            }\n        }\n    };\n    $handleTouch=\\(e) {\n        touchEmu=false;\n        var p=cvj.offset();\n        e.preventDefault();\n        var ts=e.originalEvent.changedTouches;\n        for (var i =0 ; i<ts.length ; i++) {\n            var src=ts[i];\n            var dst=$touches.findById(src.identifier);\n            if (!dst) {\n                for (var j=0 ; j<$touches.length ; j++) {\n                    if (!$touches[j].touched) {\n                        dst=$touches[j];\n                        dst.identifier=src.identifier;\n                        break;\n                    }\n                }\n            }\n            if (dst) {\n                mp={x:src.pageX-p.left, y:src.pageY-p.top};\n                mp=$Screen.canvas2buf(mp);\n                dst.x=mp.x;\n                dst.y=mp.y;\n                if(!dst.touched) dst.touched=1;\n            }\n        }\n        $mouseX=$touches[0].x;\n        $mouseY=$touches[0].y;\n        handleListeners();\n    };\n    $handleTouchEnd=\\(e) {\n        var ts=e.originalEvent.changedTouches;\n        for (var i =0 ; i<ts.length ; i++) {\n            var src=ts[i];\n            var dst=$touches.findById(src.identifier);\n            if (dst) {\n                dst.touched=0;\n                dst.identifier=-1;\n            }\n        }\n        handleListeners();\n    };\n    var handleMouse=\\(e){$handleMouse(e);};\n    var handleTouch=\\(e){$handleTouch(e);};\n    var handleTouchEnd=\\(e){$handleTouchEnd(e);};\n    var d=$.data(cv,"events");\n    if (!d) {\n        $.data(cv,"events","true");\n        cvj.mousedown(handleMouse);\n        cvj.mousemove(handleMouse);\n        cvj.on("touchstart",handleTouch);\n        cvj.on("touchmove",handleTouch);\n        cvj.on("touchend",handleTouchEnd);\n    }\n}\n\n\\update() {\n    for (var i in $touches) {\n        if (i.touched>0) {i.touched++;}\n        if (i.touched==-1) i.touched=1;\n    }\n}',"Keys.tonyu":'extends TObject;\nnative String;\nnative $;\nnative document;\n//\\new () {this.main();}\nstats={};\ncodes={\n    left: 37 , up:38 , right: 39, down:40, space:32, enter:13,\n    shift:16, ctrl:17, alt:18, mouseleft: 1\n};\nfor (var i=65 ; i<65+26; i++) {\n    codes[String.fromCharCode(i).toLowerCase()]=i;\n}\nfor (var i=48 ; i<58; i++) {\n    codes[String.fromCharCode(i)]=i;\n}\nif (!$.data(document,"key_event")) {\n    $.data(document,"key_event",true);\n    $(document).keydown \\(e) {$Keys.keydown(e);};\n    $(document).keyup \\(e) {$Keys.keyup(e);};\n    $(document).mousedown \\(e) {\n        if ($InputDevice.touchEmu) {\n            $touches[0].touched=1;\n        }\n        $Keys.keydown{keyCode:1};\n    };\n    $(document).mouseup \\(e) {\n        if ($InputDevice.touchEmu) {\n            $touches[0].touched=0;\n        }\n        $Keys.keyup{keyCode:1};\n    };\n}\nfunction getkey(code) {\n    if (typeof code=="string") {\n        code=codes[code.toLowerCase()];\n    }\n    if (!code) return 0;\n    if (stats[code]==-1) return 0;\n    if (!stats[code]) stats[code]=0;\n    return stats[code];\n}\nfunction update() {\n    for (var i in stats) {\n        if (stats[i]>0) {stats[i]++;}\n        if (stats[i]==-1) stats[i]=1;\n    }\n}\n\\keydown(e) {\n    var s=stats[e.keyCode];\n    if (!s) {\n        stats[e.keyCode]=1;\n    }\n    $InputDevice.handleListeners();\n}\n\\keyup(e) {\n    stats[e.keyCode]=0;\n    $InputDevice.handleListeners();\n}',"MML.tonyu":'extends TObject;\nincludes MathMod;\nnative T;\n\nmmlBuf=[];\n\\play(mmls) {\n    mmlBuf.push(mmls);\n    if (!isPlaying()) {\n        playNext();\n    }\n}\n\\playNext() {\n    //print("play!", id(), bufferCount());\n    if (cTimeBase==null) cTimeBase=0;\n    if (m) {\n        cTimeBase+=m.currentTime;\n        //print(m.currentTime);\n    }\n    var mml=mmlBuf.shift();\n    if (!mml) {\n        m=null;\n        cTimeBase=0;\n        return;\n    }\n    mwav=$WaveTable.get(0,0).play();\n    m=T("mml", {mml}, mwav);\n    m.on("ended", playNext);\n    m.start();\n    $MMLS[id()]=this;\n}\n\\id() {\n    if (!_id) _id=rnd()+"";\n    return _id;\n}\n\\bufferCount() {\n    return mmlBuf.length;\n}\n\\isPlaying() {\n    return m;\n}\n\\currentTime() {\n    if (m) return m.currentTime+cTimeBase;\n    return -1;\n}\n\\stop() {\n    if (m) {\n        if (mwav) {\n            mwav.pause();\n            mwav.stop();\n        }\n        m.pause();\n        m.stop();\n        m=null;\n        mmlBuf=[];\n        //print("stop!", id(), bufferCount());\n        delete $MMLS[id()];\n    }\n}\n',"Map.tonyu":'extends Actor;\nnative Math;\nnative $;\n\\new (param){\n    sx=0;\n    sy=0;\n    super(param);\n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    mapObj=true;\n    mapTable = [];\n    mapOnTable = [];\n    for(var j=0;j<row;j++){\n        rows = [];\n        for(var i=0;i<col;i++){\n            rows.push(-1);\n        }\n        mapTable.push(rows);\n    }\n    for(var j=0;j<row;j++){\n        rows = [];\n        for(var i=0;i<col;i++){\n            rows.push(-1);\n        }\n        mapOnTable.push(rows);\n    }\n    /*for(var i=0;i<col;i++){\n        mapTable[i]=[];\n    }*/\n    initMap();\n}\n\\initMap(){\n    if(!mapData) return;\n    for(var i=0;i<row;i++){\n        for(var j=0;j<col;j++){\n            set(j,i,mapData[i][j]);\n        }\n    }\n    if(!mapOnData) return;\n    for(var i=0;i<row;i++){\n        for(var j=0;j<col;j++){\n            setOn(j,i,mapOnData[i][j]);\n        }\n    }\n}\n\\load(dataFile){\n    baseData=file("../maps/").rel(dataFile).obj();\n    if(!baseData) baseData=file(dataFile).obj();\n    mapTable=baseData[0];\n    mapData=mapTable;\n    row=mapTable.length;\n    col=mapTable[0].length;\n    mapOnTable=baseData[1];\n    mapOnData=mapOnTable;\n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    initMap();\n}\n\\set(setCol,setRow,p){\n    if(setCol>=col || setRow>=row || setCol<0 || setRow<0) return;\n    mapTable[setRow][setCol]=p;\n    //mapOnTable[setRow][setCol]=-1;\n    ctx=buf[0].getContext("2d");\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) {\n        ctx.clearRect(setCol*chipWidth,setRow*chipHeight,chipWidth,chipHeight);\n        return;\n    }\n    ctx.clearRect(setCol*chipWidth,setRow*chipHeight,chipWidth,chipHeight);\n    ctx.save();\n    ctx.drawImage(\n    pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n    setCol*chipWidth, setRow*chipHeight, chipWidth, chipHeight);\n    ctx.restore();\n}\n\\setOn(setCol,setRow,p){\n    if(setCol>=col || setRow>=row || setCol<0 || setRow<0) return;\n    set(setCol,setRow,mapTable[setRow][setCol]);\n    mapOnTable[setRow][setCol]=p;\n    ctx=buf[0].getContext("2d");\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) return;\n    ctx.save();\n    ctx.drawImage(\n    pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n    setCol*chipWidth, setRow*chipHeight, chipWidth, chipHeight);\n    ctx.restore();\n}\n\\setOnAt(setX,setY,p){\n    setOn(Math.floor(setX/chipWidth),Math.floor(setY/chipHeight),p);\n}\n\\setAt(setX,setY,p){\n    set(Math.floor(setX/chipWidth),Math.floor(setY/chipHeight),p);\n}\n\\get(getCol,getRow){\n    if(getCol<col && getRow<row && getCol>=0 && getRow>=0) return mapTable[getRow][getCol];\n    return -1;\n}\n\\getAt(getX,getY){\n    return get(Math.floor(getX/chipWidth),Math.floor(getY/chipHeight));\n}\n\\getOn(getCol,getRow){\n    if(getCol<col && getRow<row && getCol>=0 && getRow>=0) return mapOnTable[getRow][getCol];\n    return -1;\n}\n\\getOnAt(getX,getY){\n    return getOn(Math.floor(getX/chipWidth),Math.floor(getY/chipHeight));\n}\n\\scrollTo(scrollX,scrollY){\n    sx=-scrollX;\n    sy=-scrollY;\n}\n\\draw(ctx) {\n    pImg=buf[0];\n    ctx.save();\n    ctx.drawImage(\n    pImg, 0, 0,col*chipWidth, row*chipHeight,\n    sx, sy, col*chipWidth, row*chipHeight);\n    ctx.restore();\n}\n',"MapEditor.tonyu":'extends Actor;\nnative prompt;\nloadMode=false;\nprint("Load Data?: Y or N");\nwhile(true){\n    if(getkey("y")>0){\n        loadMode=true;\n        break;\n    }\n    if(getkey("n")>0){\n        loadMode=false;\n        break;\n    }\n    update();\n}\nif(loadMode){\n    fileName=prompt("Input json file (*.json)","map.json");\n    if(fileName){\n        mapDataFile=file("../maps/").rel(fileName);\n    }\n    if(mapDataFile.obj()){\n        baseData=mapDataFile.obj();\n    }else{\n        mapDataFile=file(fileName);\n        if(mapDataFile.obj()){\n            baseData=mapDataFile.obj();\n        }\n    }\n    if(baseData==undefined){\n        print("Load failed");\n        loadMode=false;\n    }else if(baseData[0] && baseData[1]){\n        mapData=baseData[0];\n        mapOnData=baseData[1];\n    }\n}\nupdate();\n//if(mapData){\n    /*\n    print("Load Data?: Y or N");\n    while(true){\n        if(getkey("y")==1){\n            loadMode=true;\n            break;\n        }\n        if(getkey("n")==1){\n            loadMode=false;\n            break;\n        }\n    }*/\n//}\nif(!loadMode){\n    row=prompt("input row");\n    update();\n    col=prompt("input col");\n    panel=new Panel{width:col*32,height:row*32};\n    panel.x=panel.width/2+10;\n    panel.y=panel.height/2;\n    panel.setFillStyle("cyan");\n    panel.fillRect(0,0,panel.width,panel.height);\n    $map=new Map{row,col,chipWidth:32,chipHeight:32};\n}else{\n    if(!mapOnData){\n        $map=new Map{row:mapData.length,col:mapData[0].length,chipWidth:32,chipHeight:32,mapData};\n    }else{\n        $map=new Map{row:mapData.length,col:mapData[0].length,chipWidth:32,chipHeight:32,mapData,mapOnData};\n    }\n    panel=new Panel{width:$map.col*32,height:$map.row*32,zOrder:100};\n    panel.x=panel.width/2;\n    panel.y=panel.height/2;\n    panel.setFillStyle("cyan");\n    panel.fillRect(0,0,panel.width,panel.height);\n}\n$mp=new Map{row:16,col:8,chipWidth:32,chipHeight:32};\ncounter=0;\nfor(var i=0;i<16;i++){\n    for(var j=0;j<8;j++){\n        $mp.set(j,i,$pat_mapchip+counter);\n        counter++;\n    }\n}\nmode="get";\nprevMode="set";\nmapp=0;\nmx=0;\nmy=0;\nchipX=0;\nchipY=0;\nx=$screenWidth-16;\ny=$screenHeight-16;\nwhile(true){\n    p=mapp;\n    if(getkey("e")==1){\n        $mp.scrollTo(1000,1000);\n        mode="erase";\n        print(mode+" mode");\n    }\n    if(getkey("s")==1){\n        $mp.scrollTo(1000,1000);\n        if(mode=="set"){\n            mode="setOn";\n        }else{\n            mode="set";\n        }\n        print(mode+" mode");\n    }\n    if(getkey("o")==1){\n        $mp.scrollTo(1000,1000);\n        mode="setOn";\n    }\n    if(getkey("g")==1){\n        if(mode!="get"){\n            prevMode=mode;\n            $mp.scrollTo(0,0);\n            mode="get";\n            chipX=0;\n            chipY=0;\n        }else{\n            $mp.scrollTo(1000,1000);\n            mode=prevMode;\n        }\n        print(mode+" mode");\n    }\n    if(getkey("p")==1){\n        //add\n        saveFileName=prompt("input json file(*.json)","map.json");\n        /*print("mapTable=[");\n        data="[";\n        for(var i=0;i<$map.row-1;i++){\n            var tmp=[];\n            tmp=$map.mapTable[i].concat(tmp);\n            print("["+tmp+"],");\n            data+="["+tmp+"],";\n        }\n        var tmp=[];\n        tmp=$map.mapTable[i].concat(tmp);\n        print("["+tmp+"]");\n        data+="["+tmp+"]";\n        print("];");\n        data+="]";*/\n        //add\n        saveDataFile=file("../maps/").rel(saveFileName);\n        data=[$map.mapTable,$map.mapOnTable];\n        //comment\n        //mapDataFile.obj(data);\n        //add\n        saveDataFile.obj(data);\n        print(saveFileName+" Saved");\n        //mapDataFile.obj.push($map.mapOnTable);\n    }\n    if(getkey("c")==1){\n        $mp.scrollTo(1000,1000);\n        mode="spuit";\n        print(mode+" mode");\n    }\n    if(mode!="get"){\n        if(getkey("left")>0) mx=mx+8;\n        if(getkey("right")>0) mx=mx-8;\n        if(getkey("up")>0) my=my+8;\n        if(getkey("down")>0) my=my-8;\n        $map.scrollTo(mx,my);\n    }else{\n        if(getkey("left")>0) chipX=chipX+8;\n        if(getkey("right")>0) chipX=chipX-8;\n        if(getkey("up")>0) chipY=chipY+8;\n        if(getkey("down")>0) chipY=chipY-8;\n        $mp.scrollTo(chipX,chipY);\n    }\n    panel.x=panel.width/2-mx;\n    panel.y=panel.height/2-my;\n    if(mode=="set" && getkey(1)>0){\n        $map.setAt($mouseX+mx,$mouseY+my,mapp);\n        $map.setOnAt($mouseX+mx,$mouseY+my,-1);\n    }else if(mode=="erase" && getkey(1)>0){\n        $map.setAt($mouseX+mx,$mouseY+my,-1);\n    }else if(mode=="get" && getkey(1)>0){\n        mapp=$mp.getAt($mouseX+chipX,$mouseY+chipY);\n        mode=prevMode;\n        $mp.scrollTo(1000,1000);\n        print(mode+" mode");\n        updateEx(10);\n    }else if(mode=="setOn" && getkey(1)>0){\n        $map.setOnAt($mouseX+mx,$mouseY+my,mapp);\n    }else if(mode=="spuit" && getkey(1)>0){\n        mapp=$map.getAt($mouseX+mx,$mouseY+my);\n        mode="set";\n        print(mode+" mode");\n        updateEx(10);\n    }\n    update();\n}',"MathMod.tonyu":'extends null;\nnative Math;\n\nnowait \\sin(d) {\n    return Math.sin(rad(d));\n}\nnowait \\cos(d) {\n    return Math.cos(rad(d));\n}\nnowait \\rad(d) {\n    return d/180*Math.PI;\n}\nnowait \\deg(d) {\n    return d/Math.PI*180;\n}\n\nnowait \\abs(v) {\n    return Math.abs(v);\n}\nnowait \\atan2(x,y) {\n    return deg(Math.atan2(x,y));\n}\nnowait \\floor(x) {\n    return Math.floor(x);\n}\nnowait \\angleDiff(a,b) {\n    var c;\n    a=floor(a);\n    b=floor(b);\n    if (a>=b) {\n        c=(a-b) % 360;\n        if (c>=180) c-=360;\n    } else {\n        c=-((b-a) % 360);\n        if (c<-180) c+=360;\n    }\n    return c;\n}\nnowait \\sqrt(t) {\n    return Math.sqrt(t);\n}\nnowait \\dist(dx,dy) {\n    if (typeof dx=="object") {\n        var t=dx;\n        dx=t.x-x;dy=t.y-y;\n    }\n    return sqrt(dx*dx+dy*dy);\n}\nnowait \\trunc(f) {\n    if(f>=0) return Math.floor(f);\n    else return Math.ceil(f);\n}\nnowait \\ceil(f){\n    return Math.ceil(f);\n}\n\nnowait \\rnd(r) {\n    if (typeof r=="number") {\n        return Math.floor(Math.random()*r);\n    }\n    return Math.random();\n}',"MediaPlayer.tonyu":"\n\\play() {\n    \n}\n\\stop() {\n    \n}\n\\playSE() {\n    \n}\n\\setDelay(){\n    \n}\n\\setVolume(){\n    \n}","NoviceActor.tonyu":"extends BaseActor;\nnative Tonyu;\n\n\\sleep(n) {\n    if(!n) n=1;\n    for(n;n>0;n--) update();\n}\n\\initSprite() {\n    if (!_sprite) {\n        _sprite=new BaseActor{owner:this};// Sprites.add{owner:this};\n        $Sprites.add(this);\n    }\n}\n\\say(text,size) {\n    if (!size) size=15;\n    initSprite();\n    _sprite._fukidashi={text:text, size:size, c:30};\n}\n\\sprite(x,y,p) {\n    go(x,y,p);\n}\n\\show(x,y,p) {\n    go(x,y,p);\n}\nnowait \\draw(ctx) {\n    _sprite.draw(ctx);\n}\n\\getCrashRect() {\n    return _sprite.getCrashRect();\n}\n\\go(x,y,p) {\n    initSprite();\n    _sprite.x=x;\n    _sprite.y=y;\n    if (p!=null) _sprite.p=p;\n    //update();\n}\n\\change(p) {\n    initSprite();\n    _sprite.p=p;\n}","Pad.tonyu":"extends Actor;\n\\new(opt) {\n    super(opt);\n    padImageP = $pat_inputPad;\n    jujiKey = new Actor{x:96+1, y:$screenHeight-96-1, p:padImageP+0,zOrder:-9,layer:$FrontSprites};\n    no1Key = new Actor{x:$screenWidth-96, y:$screenHeight-96, p:padImageP+1,zOrder:-9,layer:$FrontSprites};\n    jujiKey.show();\n    no1Key.show();\n    \n    jujiKeyPushU = new Actor{x:jujiKey.x, y:jujiKey.y-60, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushL = new Actor{x:jujiKey.x-60, y:jujiKey.y, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushR = new Actor{x:jujiKey.x+60, y:jujiKey.y, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushD = new Actor{x:jujiKey.x, y:jujiKey.y+60, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPush1 = new Actor{x:no1Key.x, y:no1Key.y, p:padImageP+2, scaleX:2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushU.hide();\n    jujiKeyPushL.hide();\n    jujiKeyPushR.hide();\n    jujiKeyPushD.hide();\n    jujiKeyPush1.hide();\n}\n\\die(){\n    jujiKey.die();\n    no1Key.die();\n    jujiKeyPushU.die();\n    jujiKeyPushL.die();\n    jujiKeyPushR.die();\n    jujiKeyPushD.die();\n    jujiKeyPush1.die();\n    super.die();\n}\nAPAD_DIAG_SIZE = 96;\n\\padUpdate() {\n    // 操作 //\n    keyPushL = 0;\n    keyPushR = 0;\n    keyPushU = 0;\n    keyPushD = 0;\n    keyPush1 = 0;\n    \n    padKeyNotapCnt ++;\n    for (var i=0; i<5; i++) { // タップ判定・マウス判定 //\n        var t = $touches[i];\n        if (t.touched) {\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-APAD_DIAG_SIZE/2, jujiKey.y-32-64, 64+APAD_DIAG_SIZE, 64)) keyPushU = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-APAD_DIAG_SIZE/2, jujiKey.y-32+64, 64+APAD_DIAG_SIZE, 64)) keyPushD = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-64, jujiKey.y-32-APAD_DIAG_SIZE/2, 64, 64+APAD_DIAG_SIZE)) keyPushL = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32+64, jujiKey.y-32-APAD_DIAG_SIZE/2, 64, 64+APAD_DIAG_SIZE)) keyPushR = 1;\n            if (isOnRectWH(t.x, t.y, no1Key.x-64, no1Key.y-64, 128, 128)) keyPush1 = 1;\n            padKeySW = 1;\n            padKeyNotapCnt = 0;\n        }\n    }\n    \n    // カウントアップ\n    if (keyPushL) keyCntL ++; else keyCntL = 0;\n    if (keyPushR) keyCntR ++; else keyCntR = 0;\n    if (keyPushU) keyCntU ++; else keyCntU = 0;\n    if (keyPushD) keyCntD ++; else keyCntD = 0;\n    if (keyPush1) keyCnt1 ++; else keyCnt1 = 0;\n    \n    // 表示\n    if (keyPushL) jujiKeyPushL.show(); else jujiKeyPushL.hide();\n    if (keyPushR) jujiKeyPushR.show(); else jujiKeyPushR.hide();\n    if (keyPushU) jujiKeyPushU.show(); else jujiKeyPushU.hide();\n    if (keyPushD) jujiKeyPushD.show(); else jujiKeyPushD.hide();\n    if (keyPush1) jujiKeyPush1.show(); else jujiKeyPush1.hide();\n    \n}\n\n\\getPadUp()    { return keyCntU; }\n\\getPadDown()  { return keyCntD; }\n\\getPadLeft()  { return keyCntL; }\n\\getPadRight() { return keyCntR; }\n\\getPadButton(i) {\n    var value;\n    if (i == 0) value = keyCnt1;\n    return value;\n}\n\n\\getUp()    { return keyCntU; }\n\\getDown()  { return keyCntD; }\n\\getLeft()  { return keyCntL; }\n\\getRight() { return keyCntR; }\n\\getButton(i) {\n    var value;\n    if (i == 0) value = keyCnt1;\n    return value;\n}\n\n// 範囲 //\n\\isOnRect(mx, my, rx, ry, rx2, ry2) {\n    return (rx <= mx && mx < rx2 && ry <= my && my < ry2);\n}\n\n// 範囲 //\n\\isOnRectWH(mx, my, rx, ry, rw, rh) {\n    return (rx <= mx && mx < rx+rw && ry <= my && my < ry+rh);\n}\n\nwhile(true) {\n    padUpdate();\n    update();\n}","Panel.tonyu":'extends Actor;\nnative $;\nnative Math;\nnative isNaN;\n\\new(opt){\n    super(opt);\n    this.width=width;\n    this.height=height;\n    if(align==null) align="center";\n    if(alpha==null) alpha=255;\n    if(_drawn==null) _drawn=false;\n    buf=$("<canvas>").attr{width,height};\n}\n\\setPanel(width,height){\n    this.width=width;\n    this.height=height;\n    buf=$("<canvas>").attr{width,height};\n}\n\\resize(width,height){\n    setPanel(width,height);\n}\n\\getContext(){\n    _drawn=true;\n    return buf[0].getContext("2d");\n}\n\\setFillStyle(color){\n    this.fillStyle=color;\n}\n\\fillRect(x,y,rectWidth,rectHeight){\n    ctx=getContext();\n    ctx.save();\n    //ctx.clearRect(0,0,this.width,this.height);\n    ctx.fillStyle=fillStyle;\n    ctx.fillRect(x,y,rectWidth,rectHeight);\n    ctx.restore();\n}\n\\fillText(text,x,y,size,align){\n    ctx=getContext();\n    ctx.save();\n    //ctx.clearRect(0,0,this.width,this.height);\n    ctx.textAlign = align;\n    ctx.fillStyle=fillStyle;\n    ctx.font=size+"px \'Courier New\'";\n    ctx.fillText(text,x,y);\n    ctx.restore();\n}\n\\clearRect(clearX,clearY,clearW,clearH){\n    ctx=getContext();\n    ctx.save();\n    ctx.clearRect(clearX,clearY,clearW,clearH);\n    ctx.restore();\n}\n\\getPixel(getX,getY){\n    if(typeof getX=="number" && !isNaN(getX) && \n    typeof getY=="number" && !isNaN(getY)){\n        ctx=getContext();\n        imagedata=ctx.getImageData(getX,getY,1,1);\n        colordata=[imagedata.data[0],imagedata.data[1],imagedata.data[2],imagedata.data[3]];\n        //print(imagedata.data);\n    }else{\n        colordata=[0,0,0,0];\n    }\n    return(colordata);\n}\n\\scroll(scrollX,scrollY){\n    ctx=getContext();\n    ctx.save();\n    imagedata=ctx.getImageData(0,0,this.width,this.height);\n    clearRect(0,0,width,height);\n    ctx.putImageData(imagedata,-scrollX,-scrollY);\n    ctx.restore();\n}\n\\draw(ctx){\n    if(_drawn){\n        pImg=buf[0];\n        ctx.save();\n        if(align=="left"){\n            ctx.translate(x+width/2,y+height/2);\n        }else if(align=="center"){\n            ctx.translate(x,y);\n        }else if(align=="right"){\n            ctx.translate(x-width/2,y-height/2);\n        }\n        if(this.rotation!=0){\n            ctx.rotate(this.rotation/180*Math.PI);\n        }else{\n            ctx.rotate(this.rotate/180*Math.PI);\n        }\n        ctx.globalAlpha=this.alpha/255;\n        ctx.drawImage(\n        pImg, 0, 0,width,height,\n        -width/2, -height/2, width ,height);\n        ctx.restore();\n    }\n}',"ParallelMod.tonyu":'extends BaseActor;\nnative Tonyu;\n\nnowait \\parallel() {\n     var args=[];\n     for (var i=1; i<arguments.length; i++) {\n         args.push(arguments[i]);\n     }\n     var name=arguments[0];          \n     var thg=$currentThreadGroup;\n     var th;\n     if (thg) th=thg.addObj(this, name, args);\n     on("die") \\{th.kill();};\n     return th;\n}\n\n',"PlainChar.tonyu":'extends Actor;\n\nnative Tonyu;\nnative Math;\n\\new(x,y,p) {\n    if (Tonyu.runMode) {\n        var thg=currentThreadGroup();\n        if (thg) _th=thg.addObj(this,"tMain");\n        initSprite();\n    }\n    if (typeof x=="object") Tonyu.extend(this,x); \n    else if (typeof x=="number") {\n        this.x=x;\n        this.y=y;\n        this.p=p;\n    }\n}\n\\draw(c) {\n    onDraw();\n    if (_isInvisible) return;\n    super.draw(c);\n}\n\\setVisible(v) {\n    _isInvisible=!v;\n}\n\\onDraw() {\n    \n}\n\\update() {\n    onUpdate();\n    super.update();\n}\n\\onUpdate() {\n    \n}\n\\initSprite() {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    onAppear();\n}\n\\tMain() {\n    main();\n    die();\n}\n\\color(r,g,b) {\n    return "rgb("+[r,g,b].join(",")+")";\n}\n\\drawText(x,y,text,col,size) {\n    if ($debug) return;\n    if (!size) size=15;\n    if (!col) col="cyan";\n    var tp=all(T1Text).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,text,fillStyle:col, size,hidden:false};\n    }else {\n        new T1Text{x,y,text,fillStyle:col, size};  \n    }\n}\n\\drawLine(x,y,tx,ty,col) {\n    if (!col) col="white";\n    var tp=all(T1Line).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,tx,ty,col};\n    }else {\n        new T1Line{x,y,tx,ty,col};  \n    }\n}\n\\appear(t) {\n    return t;\n}\n\\trunc(f) {\n    return Math.trunc(f);\n}\n\\loadPage(page,arg){\n    all().die();\n    new page(arg);\n    die();\n}',"PlayMod.tonyu":'extends BaseActor;\nnowait \\initMML() {\n    if (mmlInited) return;\n    mmlInited=true;\n    $currentProject.requestPlugin("timbre");\n    if (!$MMLS) {\n       $MMLS={};\n       $WaveTable=new WaveTable;\n       $Boot.on("stop", releaseMML);\n    }\n    on("die") \\() { play().stop(); };\n}\nnowait \\releaseMML() {\n    if ($MMLS) {\n       for (var k,v in $MMLS) {\n          v.stop();\n       }\n       $MMLS=null;\n    } \n    if ($WaveTable) {\n       $WaveTable.stop();\n       $WaveTable=null;\n    }\n}\n\\play() {\n    initMML();\n    if (!_mml) _mml=new MML;\n    if (isDead() || arguments.length==0) return _mml;\n    var mmls=[];\n    for (var i=0; i<arguments.length; i++) {\n        mmls.push(arguments[i]);\n    }\n    _mml.play(mmls);\n    while (_mml.bufferCount()>2) {\n        update();\n    }\n    return _mml;\n}\nnowait \\playSE() {\n    initMML();\n    var mml=new MML;\n    var mmls=[];\n    for (var i=0; i<arguments.length; i++) {\n        mmls.push(arguments[i]);\n    }\n    mml.play(mmls);\n    return mml;\n}\n',"ScaledCanvas.tonyu":'extends Actor;\nnative $;\nnative Math;\n\n// canvas:phisical  buf: logical\n\\new (opt) {\n    extend(opt);\n    // canvas/ width,height\n    resize(width, height);\n    cw=canvas.width();\n    ch=canvas.height();\n    cctx=canvas[0].getContext("2d");\n    this.color="rgb(20,80,180)";\n    sx=0;\n    sy=0;\n    isDrawGrid=$Sprites.isDrawGrid;\n}\n\\resize(width,height) {\n    this.width=width;\n    this.height=height;\n    buf=$("<canvas>").attr{width,height};\n    ctx=buf[0].getContext("2d");  \n    $screenWidth=width;\n    $screenHeight=height;\n    if($panel){\n        $panel.setPanel($screenWidth,$screenHeight);\n    }\n}\n\\shouldDraw1x1(srcw,srch,dstw,dsth) {\n    // srcw=465 -> dstw=460...665\n    var larger=200;\n    var smaller=5;\n    return srcw-smaller<=dstw && dstw<=srcw+larger &&\n    srch-smaller<=dsth && dsth<=srch+larger;\n}\n\\draw() {\n    cw=canvas.width();\n    ch=canvas.height();\n    var calcw=ch/height*width; // calch=ch\n    var calch=cw/width*height; // calcw=cw\n    if (calch>ch) calch=ch;\n    if (calcw>cw) calcw=cw;\n    cctx.clearRect(0,0,cw,ch);\n    if (shouldDraw1x1(width,height,calcw,calch)) {\n        calcw=width;calch=height;\n    }\n    var marginw=Math.floor((cw-calcw)/2);\n    var marginh=Math.floor((ch-calch)/2);\n    cctx.drawImage(buf[0],\n    0,0,width, height, \n    marginw,marginh,calcw, calch );\n}\n\\canvas2buf(point) {\n    var calcw=ch/height*width; // calch=ch\n    var calch=cw/width*height; // calcw=cw\n    if (calch>ch) calch=ch;\n    if (calcw>cw) calcw=cw;\n    if (shouldDraw1x1(width,height,calcw,calch)) {\n        calcw=width;calch=height;\n    }\n    var marginw=Math.floor((cw-calcw)/2);\n    var marginh=Math.floor((ch-calch)/2);\n    \n    return {x: (point.x-marginw)/calcw*width, \n    y: (point.y-marginh)/calch*height};\n}\n\\setBGColor(color){\n    this.color=color;\n}\n\\fillCanvas(cv){\n    var ctx=cv.getContext("2d");\n    ctx.save();\n    ctx.fillStyle=$Screen.color;\n    ctx.fillStyle=color;\n    ctx.fillRect(0,0,cv.width,cv.height);\n    if (isDrawGrid) drawGrid(cv);\n    ctx.restore();\n}\n\\scrollTo(scrollX,scrollY){\n    /*for(o in all()){\n        //print(o.mapObj);\n        if(o.mapObj){\n            o.scrollTo(o.sx+scrollX,o.sy+scrollY);\n        }else if(o.x!=undefined && o.y!=undefined){\n            o.x+=scrollX;\n            o.y+=scrollY;\n        }\n    }*/\n    //sx=scrollX;\n    //sy=scrollY;\n    $Sprites.scrollTo(scrollX,scrollY);\n}',"SecretChar.tonyu":"extends PlainChar;\n\n\\draw(c) {\n    \n}","SpriteChar.tonyu":"extends PlainChar;\n\n\\new(x,y,p,f) {\n    super(x,y,p);\n    this.f=f;\n    if (!this.x) this.x=0;\n    if (!this.y) this.y=0;\n    if (!this.p) this.p=0;\n}\n\\draw(c) {\n    if (f) {\n        if (!scaleY) scaleY=scaleX;\n        scaleX*=-1;\n    }\n    super.draw(c);\n    if (f) scaleX*=-1;\n}","Sprites.tonyu":'extends Actor;\nnative Tonyu;\n\\new() {\n    sprites=[];\n    imageList=[];\n    hitWatchers=[];\n    isDrawGrid=Tonyu.noviceMode;\n    sx=0;\n    sy=0;\n    objId=0;\n}\nfunction add(s) {\n    if (s.__addedToSprites) return;\n    sprites.push(s);\n    if(s.__genId==null){\n        s.__genId=objId;\n        objId++;\n    }\n    s.__addedToSprites=this;\n    return s;\n}\nfunction remove(s) {\n    var idx=sprites.indexOf(s);\n    if (idx<0) return;\n    sprites.splice(idx,1);\n    delete s.__addedToSprites;\n}\nfunction clear() {sprites.splice(0,sprites.length);}\nfunction compOrder(obj1, obj2){\n    var val1=obj1.zOrder;\n    var val2=obj2.zOrder;\n    if(val1>val2){\n        return -1;\n    }else if(val1<val2){\n        return 1;\n    }else if(val1==val2){\n        if(obj1.__genId>obj2.__genId){\n            return 1;\n        }else{\n            return -1;\n        }\n        return 0;\n    }\n}\nfunction draw(cv) {\n    var ctx=cv.getContext("2d");\n    ctx.save();\n    /*\n    ctx.fillStyle=$Screen.color;\n    ctx.fillRect(0,0,cv.width,cv.height);\n    if (isDrawGrid) drawGrid(cv);\n    */\n    var orderArray=[];\n    orderArray=orderArray.concat(sprites);\n    orderArray.sort(compOrder);\n    ctx.translate(-sx,-sy);\n    orderArray.forEach(\\(s){\n        s.draw(ctx);\n    });\n    ctx.restore();\n}\nfunction checkHit() {\n    hitWatchers.forEach(function (w) {\n        sprites.forEach(function (a) {\n            //console.log("a:",  a.owner);\n            var a_owner=a;//a.owner|| a;\n            if (! (a_owner instanceof w.A)) return;\n            sprites.forEach(function (b) {\n                var b_owner=b;//b.owner|| b;\n                if (a===b) return;\n                if (! (b_owner instanceof w.B)) return;\n                //console.log("b:",  b.owner);\n                if (a.crashTo1(b)) {\n                    //console.log("hit", a.owner, b.owner);\n                    w.h(a_owner,b_owner);\n                }\n            });\n        });\n    });\n}\nfunction watchHit(typeA, typeB, onHit) {\n    var p={A: typeA, B:typeB, h:onHit};\n    //console.log(p);\n    hitWatchers.push(p);\n}\nfunction drawGrid(c) {\n    var ctx=c.getContext("2d");\n    ctx.textBaseline="top";\n    ctx.save();\n    ctx.strokeStyle="rgb(40,100,200)";\n    for (var i=0 ; i<c.width ; i+=10) {\n        ctx.beginPath();\n        ctx.lineWidth=(i % 100 ==0 ? 4 : 1);\n        ctx.moveTo(i,0);\n        ctx.lineTo(i,c.height);\n        ctx.closePath();\n        ctx.stroke();\n    }\n    \n    for (var i=0 ; i<c.height ; i+=10) {\n        ctx.beginPath();\n        ctx.lineWidth=(i % 100 ==0 ? 4 : 1);\n        ctx.moveTo(0,i);\n        ctx.lineTo(c.width,i);\n        ctx.closePath();\n        ctx.stroke();\n    }\n    ctx.fillStyle="white";\n    ctx.font="15px monospaced";\n    for (var i=100 ; i<c.width ; i+=100) {\n        ctx.fillText(i, i,0);\n    }\n    for (var i=100 ; i<c.height ; i+=100) {\n        ctx.fillText(i, 0,i);\n    }\n    ctx.restore();\n}\nfunction setImageList(il) {\n    imageList=il;\n}\nfunction getImageList() {\n    return imageList;\n}\nfunction scrollTo(scrollX,scrollY){\n    sx=scrollX;\n    sy=scrollY;\n}',"T1Line.tonyu":"extends Actor;\n\\draw(ctx) {\n    if (hidden) return;\n    \n    ctx.strokeStyle=col;\n    ctx.beginPath();\n    ctx.moveTo(x,y);\n    ctx.lineTo(tx,ty);\n    ctx.stroke();\n    hidden=true;\n}\n","T1Map.tonyu":'extends Map;\nnative Tonyu;\nnative $;\n\n\\setBGColor(c) {\n    $Screen.setBGColor(c);\n}\n\\load(fileName) {\n    /*\n    o={\n        "chipWidth":"32","chipHeight":"32",\n        "pTable":[{name:"$pat_aaa", p:10}, {name:"$pat_bbb","p":25} ],\n        "baseData":[\n        [//map\n        [0,6],[0,5],[1,3],\n        [1,3],[1,2],[0,5]\n        ],\n        [//mapOn\n        [-1,-1],[1,4],[0,2],\n        [-1,-1],[-1,-1],[1,8]\n        ]\n        ]\n    }\n    */\n    var f=file("../maps/").rel(fileName);\n    var o=f.obj();\n    chipWidth=o.chipWidth;\n    chipHeight=o.chipHeight;\n    baseData=o.baseData;\n    mapTable=conv(baseData[0],o.pTable);\n    mapData=mapTable;\n    row=mapTable.length;\n    col=mapTable[0].length;\n    mapOnTable=conv(baseData[1],o.pTable);\n    mapOnData=mapOnTable;\n    \n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    initMap();   \n}\n\\conv(mat, tbl) {\n    var res=[];\n    mat.forEach \\(row) {\n        var rrow=[];\n        res.push(rrow);\n        row.forEach \\(dat) {// dat:[0,20]\n            var t=tbl[dat[0]];\n            if (t) rrow.push(Tonyu.globals[t.name]+dat[1]);\n            else rrow.push(dat[1]);\n        };\n    };\n    return res;\n}',"T1Page.tonyu":"extends PlainChar;\n\n\\initGlobals() {\n    $chars=$Sprites.sprites;\n    $Boot.setFrameRate(60);\n    $clBlack=color(0,0,0);\n    $clRed=color(255,0,0);\n    $clGreen=color(0,255,0);\n    $clYellow=color(255,255,0);\n    $clBlue=color(0,0,255);\n    $clPink=color(255,0,255);\n    $clAqua=color(0,255,255);\n    $clWhite=color(255,255,255);\n    $mplayer=new MediaPlayer;\n}","T1Text.tonyu":"extends Actor;\n\\draw(c) {\n    if (hidden) return;\n    c.font=size+\"px 'ＭＳ Ｐゴシック'\";\n    \n    super.draw(c);\n    hidden=true;\n}\n","T2Body.tonyu":"extends BodyActor;\n","T2MediaPlayer.tonyu":'extends Actor;\n\nnative T2MediaLib;\nnative Tonyu;\n\n\\new() {\n    initT2MediaPlayer();\n}\n\n\\initT2MediaPlayer() {\n    if (T2MediaLib.inited) return;\n    T2MediaLib.init();\n    T2MediaLib.inited=true;\n    bgmPlayerMax = T2MediaLib.bgmPlayerMax;\n}\n\n\\clearSEData() {\n    T2MediaLib.allStopBGM();\n    T2MediaLib.allClearData();\n}\n\n\\clearBGMData() {\n    clearSEData();\n}\n\n\\deleteSEData(idx) {\n    T2MediaLib.clearData(idx);\n}\n\n// SE //\n\\loadSE(idx, src) {\n    // 非同期呼び出し\n    T2MediaLib.loadSE(idx, src);\n    // 読み込み完了するまでブロッキング\n    var data = T2MediaLib.getSEData(idx);\n    var cnt=0;\n    while (data == null) {\n        update();\n        data = T2MediaLib.getSEData(idx);\n        cnt++;\n        //print(cnt);\n        //if (cnt>100) {throw new Error("machisugi th="+_thread); }\n    }\n    return data;\n}\n\n//@hoge1e3\n\\loadFromProject(prj) {\n    var r=prj.getResource();\n    if (!r || !r.sounds) return;\n    for (var s in r.sounds) {\n         var name=s.name, url=s.url;\n         var ls=/^ls:(.*)/.exec(url);\n         if (ls) {\n            var f=prj.getDir().rel(ls[1]);\n            if (f.exists()) {\n                url=f.text();\n                $lastURL=url;\n            }\n         }\n         Tonyu.setGlobal(name, name);\n         print("Loading Sound: "+name);\n         loadSE(name, url);\n         //loadBGM(name, url);\n    }\n}\n\n\n// vol:0-128\n\\playSE(idx, vol, rate, offset, loop, loopStart, loopEnd) {\n    // vol : Tonyu1のように0～128の範囲にする\n    if (vol == null) vol = 128;\n    // vol はgainで実装しているため絶対値の大きい値を入れると危険\n    // そのため0.0～1.0の範囲になるようにする\n    if      (vol <   0) vol =   0;\n    else if (vol > 128) vol = 128;\n    return T2MediaLib.playSE(idx, vol / 128, rate, offset, loop, loopStart, loopEnd);\n}\n\n\\stopSE(sourceObj) {\n    return T2MediaLib.stopSE(sourceObj);\n}\n\n\\getSEData(idx) {\n    return T2MediaLib.getSEData(idx);\n}\n\n\n// BGM //\n\\loadBGM(idx, src) {\n    // 非同期呼び出し\n    T2MediaLib.loadBGM(idx, src);\n    // 読み込み完了するまでブロッキング\n    var data = T2MediaLib.getBGMData(idx);\n    while (data == null) {\n        update();\n        data = T2MediaLib.getBGMData(idx);\n    }\n    return data;\n}\n\n\\playBGM(idx, loop, offset, loopStart, loopEnd) {\n    if (loop === null) loop = false;\n    if (offset === null) offset = 0;\n    return T2MediaLib.playBGM(0, idx, loop, offset, loopStart, loopEnd);\n}\n\n\\stopBGM() {\n    return T2MediaLib.stopBGM(0);\n}\n\n\\pauseBGM() {\n    return T2MediaLib.pauseBGM(0);\n}\n\n\\resumeBGM() {\n    return T2MediaLib.resumeBGM(0);\n}\n\n\\setBGMVolume(vol) {\n    vol = vol / 128;\n    // vol はgainで実装しているため絶対値の大きい値を入れると危険\n    // そのため0.0～1.0の範囲になるようにする\n    if      (vol > 1.0) vol = 1.0;\n    else if (vol < 0.0) vol = 0.0;\n    return T2MediaLib.setBGMVolume(0, vol);\n}\n\n\\setBGMTempo(tempo) {\n    //if      (tempo > 4.0) tempo = 4.0;\n    //else if (tempo < 0.5) tempo = 0.5;\n    return T2MediaLib.setBGMTempo(0, tempo);\n}\n\n\\getBGMCurrentTime() {\n    return T2MediaLib.getBGMCurrentTime(0);\n}\n\n\\getBGMLength() {\n    return T2MediaLib.getBGMLength(0);\n}\n\n\\getBGMData(idx) {\n    return T2MediaLib.getBGMData(idx);\n}\n\n\n\n// BGM ID指定 //\n\\playBGMID(id, idx, loop, offset, loopStart, loopEnd) {\n    if (loop === null) loop = false;\n    if (offset === null) offset = 0;\n    return T2MediaLib.playBGM(id, idx, loop, offset, loopStart, loopEnd);\n}\n\n\\stopBGMID(id) {\n    return T2MediaLib.stopBGM(id);\n}\n\n\\pauseBGMID(id) {\n    return T2MediaLib.pauseBGM(id);\n}\n\n\\resumeBGMID(id) {\n    return T2MediaLib.resumeBGM(id);\n}\n\n\\setBGMVolumeID(id, vol) {\n    vol = vol / 128;\n    // vol はgainで実装しているため絶対値の大きい値を入れると危険\n    // そのため0.0～1.0の範囲になるようにする\n    if      (vol > 1.0) vol = 1.0;\n    else if (vol < 0.0) vol = 0.0;\n    return T2MediaLib.setBGMVolume(id, vol);\n}\n\n\\setBGMTempoID(id, tempo) {\n    //if      (tempo > 4.0) tempo = 4.0;\n    //else if (tempo < 0.5) tempo = 0.5;\n    return T2MediaLib.setBGMTempo(id, tempo);\n}\n\n\\getBGMCurrentTimeID(id) {\n    return T2MediaLib.getBGMCurrentTime(id);\n}\n\n\\getBGMLengthID(id) {\n    return T2MediaLib.getBGMLength(id);\n}\n\n\\sizeBGMID() {\n    return T2MediaLib.getBGMPlayerMax();\n}\n\n\\allStopBGM() {\n    T2MediaLib.allStopBGM();\n}\n\n\n\n\\loadAudio(idx, src) {\n    // 非同期呼び出し\n    T2MediaLib.loadAudio(idx, src);\n    // 読み込み完了するまでブロッキング\n    while (T2MediaLib.getAudioData(idx) == null) update();\n}\n\n\\playAudio(idx, loop, startTime) {\n    if (loop === null) loop = false;\n    if (startTime === null) startTime = 0;\n    return T2MediaLib.playAudio(idx, loop, startTime);\n}\n\n\\stopAudio() {\n    return T2MediaLib.stopAudio();\n}\n\n\\pauseAudio() {\n    return T2MediaLib.pauseAudio();\n}\n\n\\resumeAudio() {\n    return T2MediaLib.resumeAudio();\n}\n\n\\setAudioVolume(vol) {\n    vol = vol / 128;\n    if      (vol > 1.0) vol = 1.0;\n    else if (vol < 0.0) vol = 0.0;\n    return T2MediaLib.setAudioVolume(vol);\n}\n\n\\setAudioTempo(tempo) {\n    if      (tempo > 4.0) tempo = 4.0;\n    else if (tempo < 0.5) tempo = 0.5;\n    return T2MediaLib.setAudioTempo(tempo);\n}\n\n\\setAudioPosition(time) {\n    return T2MediaLib.setAudioPosition(time);\n}\n\n\\getAudioCurrentTime() {\n    return T2MediaLib.getAudioCurrentTime();\n}\n\n\\getAudioLength() {\n    return T2MediaLib.getAudioLength();\n}\n\n\\getAudioData(idx) {\n    return T2MediaLib.getAudioData(idx);\n}\n',"T2Mod.tonyu":"native Box2D;\n\n\\bvec(tx,ty) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    return new b2Vec2(tx/scale,ty/scale);  \n}","T2World.tonyu":'extends Actor;\n\nincludes T2Mod;\n\nnative Box2D;\nnative Tonyu;\n\\onAppear() {\n    $currentProject.requestPlugin("box2d");  \n    initWorld();\n}\nloop();\n\n\n\\initWorld() {\n    gravity=gravity || 9.8;\n    gravityX=gravityX || 0;\n    var b2World = Box2D.Dynamics.b2World;\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    scale=scale || 32;\n    world = new b2World(\n    new b2Vec2(gravityX, gravity)    //gravity\n    ,  true                 //allow sleep\n    );\n    $t2World=this;\n    $Boot.on("stop",releaseWorld);\n    on("die",releaseWorld);\n}\n\\releaseWorld() {\n    if ($t2World===this) $t2World=null;\n}\n\n\\loop() {\n    while(true) {\n        world.Step(\n        1 / $Boot.getFrameRate()  //frame-rate\n        ,  10       //velocity iterations\n        ,  10       //position iterations\n        );\n        world.DrawDebugData();\n        world.ClearForces();\n        updatePos();\n        update();\n    }\n}\n\\updatePos() {\n    for (var b=world.GetBodyList();b;b=b.GetNext()) {\n        var d=b.GetUserData();\n        if(d) d.updatePos();\n    }\n}\n',"TObject.tonyu":'extends null;\nnative Tonyu;\n\\new (options) {\n    if (typeof options=="object") extend(options);\n    this.main();\n}\nnowait \\extend(obj) {\n    return Tonyu.extend(this,obj);\n}',"TQuery.tonyu":'extends TObject;\nincludes MathMod;\n\\new () {\n    length=0;\n}\n\\tonyuIterator(arity) {\n    var res={};\n    res.i=0;\n    if (arity==1) {\n        res.next=function () {\n            if (res.i>=this.length) return false;\n            res[0]=this[res.i];\n            res.i++;\n            return true;\n        };\n    } else {\n        res.next=function () {\n            if (res.i>=this.length) return false;\n            res[0]=res.i;\n            res[1]=this[res.i];\n            res.i++;\n            return true;\n        };\n    }\n    return res;\n}\n\\attr() {\n    var values;\n    if (length==0) return;\n    if (arguments.length==1 && typeof arguments[0]=="string") {\n        return this[0][arguments[0]];\n    }\n    if (arguments.length>=2) {\n        values={};\n        for (var i=0 ; i<arguments.length-1 ;i+=2) {\n            values[arguments[i]]=arguments[i+1];\n        }\n    } else {\n        values=arguments[0];\n    }\n    if (values) {\n        for (var e in this) {\n            e.extend( values);\n        }\n    }\n}\n\\genKeyfunc(key) {\n    if (typeof key!="function") {\n        return \\(o) {return o[key];};\n    } else {\n        return key;\n    }\n}\n\\maxs(key) {\n    var f=genKeyfunc(key);\n    var res,reso=new TQuery;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v>=res) {\n            if (v>res) reso=new TQuery;\n            reso.push(o);\n            res=v;\n        }\n    }\n    return reso;\n}\n\\mins(key) {\n    var f=genKeyfunc(key);\n    var res,reso=new TQuery;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v<=res) {\n            if (v<res) reso=new TQuery;\n            reso.push(o);\n            res=v;\n        }\n    }\n    return reso;\n}\n\\minObj(key) {\n    return mins(key)[0];\n}\n\\maxObj(key) {\n    return maxs(key)[0];\n}\n\\nearests(x,y) {\n    if (typeof x=="object") {y=x.y;x=x.x;}\n    return mins \\(o) {\n        return dist(o.x-x,o.y-y);\n    };\n}\n\\nearest(x,y) {\n    return nearests(x,y)[0];\n}\n\\withins(xo,yd,d) {\n    var x,y;\n    if (typeof xo=="object") {\n        x=xo.x;y=xo.y;d=yd;\n    } else {\n        x=xo;y=yd;\n    }\n    return find \\(o) {\n        return dist(o.x-x,o.y-y)<=d;\n    };\n}\n\\within(xo,yd,d) {\n    return withins(xo,yd,d).nearest();\n}\n\n\\max(key) {\n    var f=genKeyfunc(key);\n    var res;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v>res) res=v;\n    }\n    return res;\n}\n\\min(key) {\n    var f=genKeyfunc(key);\n    var res;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v<res) res=v;\n    }\n    return res;\n}\n\\push(e) {\n    this[length]=e;\n    length++;\n}\n\\size() {return length;}\n\\find(f) {\n    var no=new TQuery;\n    for (var o in this) {\n        if (f(o)) no.push(o);\n    }\n    return no;\n} \n\\apply(name, args) {\n    var res;\n    if (!args) args=[];\n    for (var o in this) {\n        var f=o[name];\n        if (typeof f=="function") {\n            res=f.apply(o, args);\n        }\n    }\n    return res;\n}\n// \\alive => find \\(o) => !o.isDead()  //  (in future)\n\\alive() {\n    return find \\(o) {\n        return !o.isDead();\n    };\n}\n\\die() {\n    var a=alive();\n    if (a.length==0) return false;\n    a.apply("die");\n    return true;\n}\n\n\\klass(k) {\n    return find \\(o) { return o instanceof k; };\n}',"TextChar.tonyu":'extends PlainChar;\nnative TextRect;\n\n\\new (xx,yy,t,c,s){\n    super(xx,yy);\n    text="";\n    col=$clWhite;\n    size=20;\n    if (!this.x) this.x=0;\n    if (!this.y) this.y=0;\n    if (t) text=t;\n    if (c) fillStyle=c;\n    if (s) size=s;\n}\n\\draw(ctx) {\n    if (!size) size=15;\n    if (!align) align="left";\n    if (!fillStyle) fillStyle="white";\n    ctx.fillStyle=fillStyle;\n    ctx.globalAlpha=this.alpha/255;\n    ctx.font=size+"px \'ＭＳ Ｐゴシック\'";\n    var rect=TextRect.draw(ctx, text, x, y, size, align , "fill");\n    width=rect.w;\n    height=rect.h;\n    \n    //    fillStyle=col;\n    //super.draw(ctx);\n}',"TextRectMod.tonyu":'extends null;\n\nnowait function drawTextRect(ctx, text, x, topY, h, align , type) {\n    if (!align) align="center";\n    ctx.textBaseline="top";\n    setFontSize(ctx, h);\n    var met=ctx.measureText(text);\n    var res={y:topY, w: met.width, h:h};\n    var t=align.substring(0,1).toLowerCase();\n    if (t=="l") res.x=x;\n    else if (t=="r") res.x=x-met.width;\n    else if (t=="c") res.x=x-met.width/2;\n    if (type=="fill") ctx.fillText(text, res.x,topY);\n    if (type=="stroke") ctx.strokeText(text, res.x,topY);\n    return res;\n}\nnowait function setFontSize(ctx,sz) {\n    var post=ctx.font.replace(/^[0-9\\.]+/,"");\n    ctx.font=sz+post;\n}\n\nnowait function fukidashi(ctx, text, x, y, sz) {\n    var align="c";\n    var theight=20;\n    var margin=5;\n    var r=drawTextRect(ctx, text, x,y-theight-margin-sz, sz, align);\n    ctx.beginPath();\n    ctx.moveTo(x , y);\n    ctx.lineTo(x+margin , y-theight);\n    ctx.lineTo(x+r.w/2+margin , y-theight);\n    ctx.lineTo(x+r.w/2+margin , y-theight-r.h-margin*2);\n    ctx.lineTo(x-r.w/2-margin , y-theight-r.h-margin*2);\n    ctx.lineTo(x-r.w/2-margin , y-theight);\n    ctx.lineTo(x-margin , y-theight);\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke();\n    \n    var fs=ctx.fillStyle;\n    ctx.fillStyle=ctx.strokeStyle;\n    drawTextRect(ctx, text, x, y-theight-margin-sz, sz, align, "fill");\n    ctx.fillStyle=fs;\n}\n\n',"WaveTable.tonyu":'extends TObject;\nnative T;\n\nwav={};\nenv={};\n\\setWav(num, synth) {\n    wav[num]=synth;\n}\n\\setEnv(num, synth) {\n    env[num]=synth;\n}\n\\get(w,e) {\n    var synth=T("OscGen") {osc:wav[w], env:env[e], mul:0.25};\n    return synth;\n}\n\\stop() {\n    /*for (var k,v in tbl) {\n        v.pause();\n        v.stop();\n    }*/\n}\n\nif (typeof T!=="undefined") {\n    //env=T("adsr", {a:0,d:200,s:0.5,r:10});\n    env = T("env",{table:[1, [0.6, 50], [0, 100]], releaseNode:2});\n    setEnv(0, env);\n    setWav(0, T("pulse"));\n    //    synth=T("OscGen") {wave:"pulse", env, mul:0.25};\n    //set(0,synth);    \n}\n',"js/":'{"concat.js":{"lastUpdate":1429359986781}}',"js/concat.js":'Tonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.EventMod=Tonyu.klass([],{\n  main :function _trc_func_1000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_1000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initEventMod :function _trc_func_1000034_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=1000056;//kernel.EventMod:56\n    if (_this._eventHandlers) {\n      return _this;\n    }\n    //$LASTPOS=1000088;//kernel.EventMod:88\n    _this._eventHandlers={};\n    //$LASTPOS=1000111;//kernel.EventMod:111\n    _this.on("die",Tonyu.bindFunc(_this,_this.releaseEventMod));\n  },\n  fiber$initEventMod :function _trc_func_1000034_3(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=1000056;//kernel.EventMod:56\n    if (_this._eventHandlers) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=1000088;//kernel.EventMod:88\n    _this._eventHandlers={};\n    \n    _thread.enter(function _trc_func_1000034_4(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=1000111;//kernel.EventMod:111\n          _this.fiber$on(_thread, "die", Tonyu.bindFunc(_this,_this.releaseEventMod));\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  releaseEventMod :function _trc_func_1000143_5() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var k;\n    var v;\n    var _it_1;\n    \n    //$LASTPOS=1000168;//kernel.EventMod:168\n    _it_1=Tonyu.iterator(_this._eventHandlers,2);\n    while(_it_1.next()) {\n      k=_it_1[0];\n      v=_it_1[1];\n      \n      //$LASTPOS=1000210;//kernel.EventMod:210\n      v.release();\n      \n    }\n  },\n  fiber$releaseEventMod :function _trc_func_1000143_6(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var k;\n    var v;\n    var _it_1;\n    \n    //$LASTPOS=1000168;//kernel.EventMod:168\n    _it_1=Tonyu.iterator(_this._eventHandlers,2);\n    while(_it_1.next()) {\n      k=_it_1[0];\n      v=_it_1[1];\n      \n      //$LASTPOS=1000210;//kernel.EventMod:210\n      v.release();\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  parseArgs :function _trc_func_1000233_7(a) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    var i;\n    \n    //$LASTPOS=1000253;//kernel.EventMod:253\n    res = {type: a[0],args: []};\n    //$LASTPOS=1000287;//kernel.EventMod:287\n    //$LASTPOS=1000292;//kernel.EventMod:292\n    i = 1;\n    while(i<a.length) {\n      {\n        //$LASTPOS=1000330;//kernel.EventMod:330\n        res.args.push(a[i]);\n      }\n      i++;\n    }\n    return res;\n  },\n  fiber$parseArgs :function _trc_func_1000233_8(_thread,a) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var res;\n    var i;\n    \n    //$LASTPOS=1000253;//kernel.EventMod:253\n    res = {type: a[0],args: []};\n    //$LASTPOS=1000287;//kernel.EventMod:287\n    //$LASTPOS=1000292;//kernel.EventMod:292\n    i = 1;\n    while(i<a.length) {\n      {\n        //$LASTPOS=1000330;//kernel.EventMod:330\n        res.args.push(a[i]);\n      }\n      i++;\n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  registerEventHandler :function _trc_func_1000380_9(type,obj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=1000447;//kernel.EventMod:447\n    _this.initEventMod();\n    //$LASTPOS=1000467;//kernel.EventMod:467\n    if (typeof  type=="function") {\n      //$LASTPOS=1000506;//kernel.EventMod:506\n      obj=obj||new type;\n      //$LASTPOS=1000533;//kernel.EventMod:533\n      type=obj.getClassInfo().fullName;\n      \n    } else {\n      //$LASTPOS=1000589;//kernel.EventMod:589\n      obj=obj||new Tonyu.classes.kernel.EventHandler;\n      \n    }\n    return _this._eventHandlers[type]=obj;\n  },\n  fiber$registerEventHandler :function _trc_func_1000380_10(_thread,type,obj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_1000380_11(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=1000447;//kernel.EventMod:447\n          _this.fiber$initEventMod(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=1000467;//kernel.EventMod:467\n          if (typeof  type=="function") {\n            //$LASTPOS=1000506;//kernel.EventMod:506\n            obj=obj||new type;\n            //$LASTPOS=1000533;//kernel.EventMod:533\n            type=obj.getClassInfo().fullName;\n            \n          } else {\n            //$LASTPOS=1000589;//kernel.EventMod:589\n            obj=obj||new Tonyu.classes.kernel.EventHandler;\n            \n          }\n          _thread.exit(_this._eventHandlers[type]=obj);return;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  getEventHandler :function _trc_func_1000665_12(type) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    \n    //$LASTPOS=1000694;//kernel.EventMod:694\n    _this.initEventMod();\n    //$LASTPOS=1000714;//kernel.EventMod:714\n    res = _this._eventHandlers[type]||_this.registerEventHandler(type);\n    return res;\n  },\n  fiber$getEventHandler :function _trc_func_1000665_13(_thread,type) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var res;\n    \n    \n    _thread.enter(function _trc_func_1000665_14(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=1000694;//kernel.EventMod:694\n          _this.fiber$initEventMod(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=1000714;//kernel.EventMod:714\n          res = _this._eventHandlers[type]||_this.registerEventHandler(type);\n          _thread.exit(res);return;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  on :function _trc_func_1000796_15() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var a;\n    var h;\n    \n    //$LASTPOS=1000809;//kernel.EventMod:809\n    a = _this.parseArgs(arguments);\n    //$LASTPOS=1000842;//kernel.EventMod:842\n    h = _this.getEventHandler(a.type);\n    //$LASTPOS=1000878;//kernel.EventMod:878\n    h.addListener.apply(h,a.args);\n  },\n  fiber$on :function _trc_func_1000796_16(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var a;\n    var h;\n    \n    //$LASTPOS=1000809;//kernel.EventMod:809\n    a = _this.parseArgs(_arguments);\n    //$LASTPOS=1000842;//kernel.EventMod:842\n    h = _this.getEventHandler(a.type);\n    //$LASTPOS=1000878;//kernel.EventMod:878\n    h.addListener.apply(h,a.args);\n    \n    _thread.retVal=_this;return;\n  },\n  fireEvent :function _trc_func_1000915_17(type,args) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=1000945;//kernel.EventMod:945\n    _this.getEventHandler(type).fire(args);\n  },\n  fiber$fireEvent :function _trc_func_1000915_18(_thread,type,args) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=1000945;//kernel.EventMod:945\n    _this.getEventHandler(type).fire(args);\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.EventMod,{"fullName":"kernel.EventMod","namespace":"kernel","shortName":"EventMod","decls":{"methods":{"main":{"nowait":false},"initEventMod":{"nowait":false},"releaseEventMod":{"nowait":false},"parseArgs":{"nowait":false},"registerEventHandler":{"nowait":false},"getEventHandler":{"nowait":false},"on":{"nowait":false},"fireEvent":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.InputDevice=Tonyu.klass([],{\n  main :function _trc_func_2000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_2000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_2000057_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=2000071;//kernel.InputDevice:71\n    _this.listeners=[];\n    //$LASTPOS=2000090;//kernel.InputDevice:90\n    _this.touchEmu=true;\n  },\n  handleListeners :function _trc_func_2000109_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var l;\n    \n    //$LASTPOS=2000135;//kernel.InputDevice:135\n    l = _this.listeners;\n    //$LASTPOS=2000157;//kernel.InputDevice:157\n    _this.listeners=[];\n    //$LASTPOS=2000176;//kernel.InputDevice:176\n    while (l.length>0) {\n      //$LASTPOS=2000197;//kernel.InputDevice:197\n      (l.shift())();\n      \n    }\n  },\n  fiber$handleListeners :function _trc_func_2000109_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var l;\n    \n    //$LASTPOS=2000135;//kernel.InputDevice:135\n    l = _this.listeners;\n    //$LASTPOS=2000157;//kernel.InputDevice:157\n    _this.listeners=[];\n    //$LASTPOS=2000176;//kernel.InputDevice:176\n    while (l.length>0) {\n      //$LASTPOS=2000197;//kernel.InputDevice:197\n      (l.shift())();\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  addOnetimeListener :function _trc_func_2000218_5(l) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=2000247;//kernel.InputDevice:247\n    _this.listeners.push(l);\n  },\n  fiber$addOnetimeListener :function _trc_func_2000218_6(_thread,l) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=2000247;//kernel.InputDevice:247\n    _this.listeners.push(l);\n    \n    _thread.retVal=_this;return;\n  },\n  initCanvasEvents :function _trc_func_2000270_7(cvj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var cv;\n    var handleMouse;\n    var handleTouch;\n    var handleTouchEnd;\n    var d;\n    \n    //$LASTPOS=2000300;//kernel.InputDevice:300\n    cv = cvj[0];\n    //$LASTPOS=2000320;//kernel.InputDevice:320\n    Tonyu.globals.$handleMouse=function (e) {\n      var p;\n      var mp;\n      \n      //$LASTPOS=2000349;//kernel.InputDevice:349\n      p = cvj.offset();\n      //$LASTPOS=2000378;//kernel.InputDevice:378\n      mp = {x: e.clientX-p.left,y: e.clientY-p.top};\n      //$LASTPOS=2000435;//kernel.InputDevice:435\n      mp=Tonyu.globals.$Screen.canvas2buf(mp);\n      //$LASTPOS=2000471;//kernel.InputDevice:471\n      Tonyu.globals.$mouseX=mp.x;\n      //$LASTPOS=2000494;//kernel.InputDevice:494\n      Tonyu.globals.$mouseY=mp.y;\n      //$LASTPOS=2000517;//kernel.InputDevice:517\n      if (_this.touchEmu) {\n        //$LASTPOS=2000546;//kernel.InputDevice:546\n        Tonyu.globals.$touches[0].x=mp.x;\n        //$LASTPOS=2000579;//kernel.InputDevice:579\n        Tonyu.globals.$touches[0].y=mp.y;\n        \n      }\n      //$LASTPOS=2000619;//kernel.InputDevice:619\n      _this.handleListeners();\n    };\n    //$LASTPOS=2000651;//kernel.InputDevice:651\n    Tonyu.globals.$touches=[{},{},{},{},{}];\n    //$LASTPOS=2000683;//kernel.InputDevice:683\n    Tonyu.globals.$touches.findById=function (id) {\n      var j;\n      \n      //$LASTPOS=2000718;//kernel.InputDevice:718\n      //$LASTPOS=2000723;//kernel.InputDevice:723\n      j = 0;\n      while(j<Tonyu.globals.$touches.length) {\n        {\n          //$LASTPOS=2000773;//kernel.InputDevice:773\n          if (Tonyu.globals.$touches[j].identifier==id) {\n            return Tonyu.globals.$touches[j];\n            \n          }\n        }\n        j++;\n      }\n    };\n    //$LASTPOS=2000883;//kernel.InputDevice:883\n    Tonyu.globals.$handleTouch=function (e) {\n      var p;\n      var ts;\n      var i;\n      var src;\n      var dst;\n      var j;\n      \n      //$LASTPOS=2000912;//kernel.InputDevice:912\n      _this.touchEmu=false;\n      //$LASTPOS=2000937;//kernel.InputDevice:937\n      p = cvj.offset();\n      //$LASTPOS=2000966;//kernel.InputDevice:966\n      e.preventDefault();\n      //$LASTPOS=2000995;//kernel.InputDevice:995\n      ts = e.originalEvent.changedTouches;\n      //$LASTPOS=2001043;//kernel.InputDevice:1043\n      //$LASTPOS=2001048;//kernel.InputDevice:1048\n      i = 0;\n      while(i<ts.length) {\n        {\n          //$LASTPOS=2001093;//kernel.InputDevice:1093\n          src = ts[i];\n          //$LASTPOS=2001121;//kernel.InputDevice:1121\n          dst = Tonyu.globals.$touches.findById(src.identifier);\n          //$LASTPOS=2001177;//kernel.InputDevice:1177\n          if (! dst) {\n            //$LASTPOS=2001206;//kernel.InputDevice:1206\n            //$LASTPOS=2001211;//kernel.InputDevice:1211\n            j = 0;\n            while(j<Tonyu.globals.$touches.length) {\n              {\n                //$LASTPOS=2001269;//kernel.InputDevice:1269\n                if (! Tonyu.globals.$touches[j].touched) {\n                  //$LASTPOS=2001322;//kernel.InputDevice:1322\n                  dst=Tonyu.globals.$touches[j];\n                  //$LASTPOS=2001364;//kernel.InputDevice:1364\n                  dst.identifier=src.identifier;\n                  break;\n                  \n                  \n                }\n              }\n              j++;\n            }\n            \n          }\n          //$LASTPOS=2001497;//kernel.InputDevice:1497\n          if (dst) {\n            //$LASTPOS=2001525;//kernel.InputDevice:1525\n            _this.mp={x: src.pageX-p.left,y: src.pageY-p.top};\n            //$LASTPOS=2001586;//kernel.InputDevice:1586\n            _this.mp=Tonyu.globals.$Screen.canvas2buf(_this.mp);\n            //$LASTPOS=2001630;//kernel.InputDevice:1630\n            dst.x=_this.mp.x;\n            //$LASTPOS=2001659;//kernel.InputDevice:1659\n            dst.y=_this.mp.y;\n            //$LASTPOS=2001688;//kernel.InputDevice:1688\n            if (! dst.touched) {\n              //$LASTPOS=2001705;//kernel.InputDevice:1705\n              dst.touched=1;\n            }\n            \n          }\n        }\n        i++;\n      }\n      //$LASTPOS=2001755;//kernel.InputDevice:1755\n      Tonyu.globals.$mouseX=Tonyu.globals.$touches[0].x;\n      //$LASTPOS=2001787;//kernel.InputDevice:1787\n      Tonyu.globals.$mouseY=Tonyu.globals.$touches[0].y;\n      //$LASTPOS=2001819;//kernel.InputDevice:1819\n      _this.handleListeners();\n    };\n    //$LASTPOS=2001851;//kernel.InputDevice:1851\n    Tonyu.globals.$handleTouchEnd=function (e) {\n      var ts;\n      var i;\n      var src;\n      var dst;\n      \n      //$LASTPOS=2001883;//kernel.InputDevice:1883\n      ts = e.originalEvent.changedTouches;\n      //$LASTPOS=2001931;//kernel.InputDevice:1931\n      //$LASTPOS=2001936;//kernel.InputDevice:1936\n      i = 0;\n      while(i<ts.length) {\n        {\n          //$LASTPOS=2001981;//kernel.InputDevice:1981\n          src = ts[i];\n          //$LASTPOS=2002009;//kernel.InputDevice:2009\n          dst = Tonyu.globals.$touches.findById(src.identifier);\n          //$LASTPOS=2002065;//kernel.InputDevice:2065\n          if (dst) {\n            //$LASTPOS=2002093;//kernel.InputDevice:2093\n            dst.touched=0;\n            //$LASTPOS=2002125;//kernel.InputDevice:2125\n            dst.identifier=- 1;\n            \n          }\n        }\n        i++;\n      }\n      //$LASTPOS=2002179;//kernel.InputDevice:2179\n      _this.handleListeners();\n    };\n    //$LASTPOS=2002211;//kernel.InputDevice:2211\n    handleMouse = function (e) {\n      \n      //$LASTPOS=2002232;//kernel.InputDevice:2232\n      Tonyu.globals.$handleMouse(e);\n    };\n    //$LASTPOS=2002256;//kernel.InputDevice:2256\n    handleTouch = function (e) {\n      \n      //$LASTPOS=2002277;//kernel.InputDevice:2277\n      Tonyu.globals.$handleTouch(e);\n    };\n    //$LASTPOS=2002301;//kernel.InputDevice:2301\n    handleTouchEnd = function (e) {\n      \n      //$LASTPOS=2002325;//kernel.InputDevice:2325\n      Tonyu.globals.$handleTouchEnd(e);\n    };\n    //$LASTPOS=2002352;//kernel.InputDevice:2352\n    d = $.data(cv,"events");\n    //$LASTPOS=2002384;//kernel.InputDevice:2384\n    if (! d) {\n      //$LASTPOS=2002403;//kernel.InputDevice:2403\n      $.data(cv,"events","true");\n      //$LASTPOS=2002440;//kernel.InputDevice:2440\n      cvj.mousedown(handleMouse);\n      //$LASTPOS=2002477;//kernel.InputDevice:2477\n      cvj.mousemove(handleMouse);\n      //$LASTPOS=2002514;//kernel.InputDevice:2514\n      cvj.on("touchstart",handleTouch);\n      //$LASTPOS=2002557;//kernel.InputDevice:2557\n      cvj.on("touchmove",handleTouch);\n      //$LASTPOS=2002599;//kernel.InputDevice:2599\n      cvj.on("touchend",handleTouchEnd);\n      \n    }\n  },\n  fiber$initCanvasEvents :function _trc_func_2000270_8(_thread,cvj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var cv;\n    var handleMouse;\n    var handleTouch;\n    var handleTouchEnd;\n    var d;\n    \n    //$LASTPOS=2000300;//kernel.InputDevice:300\n    cv = cvj[0];\n    \n    _thread.enter(function _trc_func_2000270_9(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=2000320;//kernel.InputDevice:320\n          Tonyu.globals.$handleMouse=function (e) {\n            var p;\n            var mp;\n            \n            //$LASTPOS=2000349;//kernel.InputDevice:349\n            p = cvj.offset();\n            //$LASTPOS=2000378;//kernel.InputDevice:378\n            mp = {x: e.clientX-p.left,y: e.clientY-p.top};\n            //$LASTPOS=2000435;//kernel.InputDevice:435\n            mp=Tonyu.globals.$Screen.canvas2buf(mp);\n            //$LASTPOS=2000471;//kernel.InputDevice:471\n            Tonyu.globals.$mouseX=mp.x;\n            //$LASTPOS=2000494;//kernel.InputDevice:494\n            Tonyu.globals.$mouseY=mp.y;\n            //$LASTPOS=2000517;//kernel.InputDevice:517\n            if (_this.touchEmu) {\n              //$LASTPOS=2000546;//kernel.InputDevice:546\n              Tonyu.globals.$touches[0].x=mp.x;\n              //$LASTPOS=2000579;//kernel.InputDevice:579\n              Tonyu.globals.$touches[0].y=mp.y;\n              \n            }\n            //$LASTPOS=2000619;//kernel.InputDevice:619\n            _this.handleListeners();\n          };\n          //$LASTPOS=2000651;//kernel.InputDevice:651\n          Tonyu.globals.$touches=[{},{},{},{},{}];\n          //$LASTPOS=2000683;//kernel.InputDevice:683\n          Tonyu.globals.$touches.findById=function (id) {\n            var j;\n            \n            //$LASTPOS=2000718;//kernel.InputDevice:718\n            //$LASTPOS=2000723;//kernel.InputDevice:723\n            j = 0;\n            while(j<Tonyu.globals.$touches.length) {\n              {\n                //$LASTPOS=2000773;//kernel.InputDevice:773\n                if (Tonyu.globals.$touches[j].identifier==id) {\n                  return Tonyu.globals.$touches[j];\n                  \n                }\n              }\n              j++;\n            }\n          };\n          //$LASTPOS=2000883;//kernel.InputDevice:883\n          Tonyu.globals.$handleTouch=function (e) {\n            var p;\n            var ts;\n            var i;\n            var src;\n            var dst;\n            var j;\n            \n            //$LASTPOS=2000912;//kernel.InputDevice:912\n            _this.touchEmu=false;\n            //$LASTPOS=2000937;//kernel.InputDevice:937\n            p = cvj.offset();\n            //$LASTPOS=2000966;//kernel.InputDevice:966\n            e.preventDefault();\n            //$LASTPOS=2000995;//kernel.InputDevice:995\n            ts = e.originalEvent.changedTouches;\n            //$LASTPOS=2001043;//kernel.InputDevice:1043\n            //$LASTPOS=2001048;//kernel.InputDevice:1048\n            i = 0;\n            while(i<ts.length) {\n              {\n                //$LASTPOS=2001093;//kernel.InputDevice:1093\n                src = ts[i];\n                //$LASTPOS=2001121;//kernel.InputDevice:1121\n                dst = Tonyu.globals.$touches.findById(src.identifier);\n                //$LASTPOS=2001177;//kernel.InputDevice:1177\n                if (! dst) {\n                  //$LASTPOS=2001206;//kernel.InputDevice:1206\n                  //$LASTPOS=2001211;//kernel.InputDevice:1211\n                  j = 0;\n                  while(j<Tonyu.globals.$touches.length) {\n                    {\n                      //$LASTPOS=2001269;//kernel.InputDevice:1269\n                      if (! Tonyu.globals.$touches[j].touched) {\n                        //$LASTPOS=2001322;//kernel.InputDevice:1322\n                        dst=Tonyu.globals.$touches[j];\n                        //$LASTPOS=2001364;//kernel.InputDevice:1364\n                        dst.identifier=src.identifier;\n                        break;\n                        \n                        \n                      }\n                    }\n                    j++;\n                  }\n                  \n                }\n                //$LASTPOS=2001497;//kernel.InputDevice:1497\n                if (dst) {\n                  //$LASTPOS=2001525;//kernel.InputDevice:1525\n                  _this.mp={x: src.pageX-p.left,y: src.pageY-p.top};\n                  //$LASTPOS=2001586;//kernel.InputDevice:1586\n                  _this.mp=Tonyu.globals.$Screen.canvas2buf(_this.mp);\n                  //$LASTPOS=2001630;//kernel.InputDevice:1630\n                  dst.x=_this.mp.x;\n                  //$LASTPOS=2001659;//kernel.InputDevice:1659\n                  dst.y=_this.mp.y;\n                  //$LASTPOS=2001688;//kernel.InputDevice:1688\n                  if (! dst.touched) {\n                    //$LASTPOS=2001705;//kernel.InputDevice:1705\n                    dst.touched=1;\n                  }\n                  \n                }\n              }\n              i++;\n            }\n            //$LASTPOS=2001755;//kernel.InputDevice:1755\n            Tonyu.globals.$mouseX=Tonyu.globals.$touches[0].x;\n            //$LASTPOS=2001787;//kernel.InputDevice:1787\n            Tonyu.globals.$mouseY=Tonyu.globals.$touches[0].y;\n            //$LASTPOS=2001819;//kernel.InputDevice:1819\n            _this.handleListeners();\n          };\n          //$LASTPOS=2001851;//kernel.InputDevice:1851\n          Tonyu.globals.$handleTouchEnd=function (e) {\n            var ts;\n            var i;\n            var src;\n            var dst;\n            \n            //$LASTPOS=2001883;//kernel.InputDevice:1883\n            ts = e.originalEvent.changedTouches;\n            //$LASTPOS=2001931;//kernel.InputDevice:1931\n            //$LASTPOS=2001936;//kernel.InputDevice:1936\n            i = 0;\n            while(i<ts.length) {\n              {\n                //$LASTPOS=2001981;//kernel.InputDevice:1981\n                src = ts[i];\n                //$LASTPOS=2002009;//kernel.InputDevice:2009\n                dst = Tonyu.globals.$touches.findById(src.identifier);\n                //$LASTPOS=2002065;//kernel.InputDevice:2065\n                if (dst) {\n                  //$LASTPOS=2002093;//kernel.InputDevice:2093\n                  dst.touched=0;\n                  //$LASTPOS=2002125;//kernel.InputDevice:2125\n                  dst.identifier=- 1;\n                  \n                }\n              }\n              i++;\n            }\n            //$LASTPOS=2002179;//kernel.InputDevice:2179\n            _this.handleListeners();\n          };\n          //$LASTPOS=2002211;//kernel.InputDevice:2211\n          handleMouse = function (e) {\n            \n            //$LASTPOS=2002232;//kernel.InputDevice:2232\n            Tonyu.globals.$handleMouse(e);\n          };\n          //$LASTPOS=2002256;//kernel.InputDevice:2256\n          handleTouch = function (e) {\n            \n            //$LASTPOS=2002277;//kernel.InputDevice:2277\n            Tonyu.globals.$handleTouch(e);\n          };\n          //$LASTPOS=2002301;//kernel.InputDevice:2301\n          handleTouchEnd = function (e) {\n            \n            //$LASTPOS=2002325;//kernel.InputDevice:2325\n            Tonyu.globals.$handleTouchEnd(e);\n          };\n          //$LASTPOS=2002352;//kernel.InputDevice:2352\n          d = $.data(cv,"events");\n          //$LASTPOS=2002384;//kernel.InputDevice:2384\n          if (! d) {\n            //$LASTPOS=2002403;//kernel.InputDevice:2403\n            $.data(cv,"events","true");\n            //$LASTPOS=2002440;//kernel.InputDevice:2440\n            cvj.mousedown(handleMouse);\n            //$LASTPOS=2002477;//kernel.InputDevice:2477\n            cvj.mousemove(handleMouse);\n            //$LASTPOS=2002514;//kernel.InputDevice:2514\n            cvj.on("touchstart",handleTouch);\n            //$LASTPOS=2002557;//kernel.InputDevice:2557\n            cvj.on("touchmove",handleTouch);\n            //$LASTPOS=2002599;//kernel.InputDevice:2599\n            cvj.on("touchend",handleTouchEnd);\n            \n          }\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  update :function _trc_func_2002647_10() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    var _it_36;\n    \n    //$LASTPOS=2002664;//kernel.InputDevice:2664\n    _it_36=Tonyu.iterator(Tonyu.globals.$touches,1);\n    while(_it_36.next()) {\n      i=_it_36[0];\n      \n      //$LASTPOS=2002699;//kernel.InputDevice:2699\n      if (i.touched>0) {\n        //$LASTPOS=2002717;//kernel.InputDevice:2717\n        i.touched++;\n        \n      }\n      //$LASTPOS=2002740;//kernel.InputDevice:2740\n      if (i.touched==- 1) {\n        //$LASTPOS=2002759;//kernel.InputDevice:2759\n        i.touched=1;\n      }\n      \n    }\n  },\n  fiber$update :function _trc_func_2002647_11(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    var _it_36;\n    \n    //$LASTPOS=2002664;//kernel.InputDevice:2664\n    _it_36=Tonyu.iterator(Tonyu.globals.$touches,1);\n    while(_it_36.next()) {\n      i=_it_36[0];\n      \n      //$LASTPOS=2002699;//kernel.InputDevice:2699\n      if (i.touched>0) {\n        //$LASTPOS=2002717;//kernel.InputDevice:2717\n        i.touched++;\n        \n      }\n      //$LASTPOS=2002740;//kernel.InputDevice:2740\n      if (i.touched==- 1) {\n        //$LASTPOS=2002759;//kernel.InputDevice:2759\n        i.touched=1;\n      }\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.InputDevice,{"fullName":"kernel.InputDevice","namespace":"kernel","shortName":"InputDevice","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"handleListeners":{"nowait":false},"addOnetimeListener":{"nowait":false},"initCanvasEvents":{"nowait":false},"update":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.MathMod=Tonyu.klass([],{\n  main :function _trc_func_3000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_3000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  sin :function _trc_func_3000031_2(d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.sin(_this.rad(d));\n  },\n  cos :function _trc_func_3000082_3(d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.cos(_this.rad(d));\n  },\n  rad :function _trc_func_3000133_4(d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return d/180*Math.PI;\n  },\n  deg :function _trc_func_3000181_5(d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return d/Math.PI*180;\n  },\n  abs :function _trc_func_3000231_6(v) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.abs(v);\n  },\n  atan2 :function _trc_func_3000277_7(x,y) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.deg(Math.atan2(x,y));\n  },\n  floor :function _trc_func_3000336_8(x) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.floor(x);\n  },\n  angleDiff :function _trc_func_3000386_9(a,b) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var c;\n    \n    //$LASTPOS=3000416;//kernel.MathMod:416\n    c;\n    //$LASTPOS=3000428;//kernel.MathMod:428\n    a=_this.floor(a);\n    //$LASTPOS=3000445;//kernel.MathMod:445\n    b=_this.floor(b);\n    //$LASTPOS=3000462;//kernel.MathMod:462\n    if (a>=b) {\n      //$LASTPOS=3000483;//kernel.MathMod:483\n      c=(a-b)%360;\n      //$LASTPOS=3000507;//kernel.MathMod:507\n      if (c>=180) {\n        //$LASTPOS=3000519;//kernel.MathMod:519\n        c-=360;\n      }\n      \n    } else {\n      //$LASTPOS=3000550;//kernel.MathMod:550\n      c=- ((b-a)%360);\n      //$LASTPOS=3000577;//kernel.MathMod:577\n      if (c<- 180) {\n        //$LASTPOS=3000589;//kernel.MathMod:589\n        c+=360;\n      }\n      \n    }\n    return c;\n  },\n  sqrt :function _trc_func_3000623_10(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.sqrt(t);\n  },\n  dist :function _trc_func_3000671_11(dx,dy) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var t;\n    \n    //$LASTPOS=3000698;//kernel.MathMod:698\n    if (typeof  dx=="object") {\n      //$LASTPOS=3000734;//kernel.MathMod:734\n      t = dx;\n      //$LASTPOS=3000753;//kernel.MathMod:753\n      dx=t.x-_this.x;\n      //$LASTPOS=3000762;//kernel.MathMod:762\n      dy=t.y-_this.y;\n      \n    }\n    return _this.sqrt(dx*dx+dy*dy);\n  },\n  trunc :function _trc_func_3000814_12(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=3000838;//kernel.MathMod:838\n    if (f>=0) {\n      return Math.floor(f);\n    } else {\n      return Math.ceil(f);\n    }\n  },\n  ceil :function _trc_func_3000904_13(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.ceil(f);\n  },\n  rnd :function _trc_func_3000953_14(r) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=3000975;//kernel.MathMod:975\n    if (typeof  r=="number") {\n      return Math.floor(Math.random()*r);\n      \n    }\n    return Math.random();\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.MathMod,{"fullName":"kernel.MathMod","namespace":"kernel","shortName":"MathMod","decls":{"methods":{"main":{"nowait":false},"sin":{"nowait":true},"cos":{"nowait":true},"rad":{"nowait":true},"deg":{"nowait":true},"abs":{"nowait":true},"atan2":{"nowait":true},"floor":{"nowait":true},"angleDiff":{"nowait":true},"sqrt":{"nowait":true},"dist":{"nowait":true},"trunc":{"nowait":true},"ceil":{"nowait":true},"rnd":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.MediaPlayer=Tonyu.klass([],{\n  main :function _trc_func_4000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_4000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  play :function _trc_func_4000002_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$play :function _trc_func_4000002_3(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  stop :function _trc_func_4000022_4() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$stop :function _trc_func_4000022_5(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  playSE :function _trc_func_4000042_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$playSE :function _trc_func_4000042_7(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setDelay :function _trc_func_4000064_8() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$setDelay :function _trc_func_4000064_9(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setVolume :function _trc_func_4000087_10() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$setVolume :function _trc_func_4000087_11(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.MediaPlayer,{"fullName":"kernel.MediaPlayer","namespace":"kernel","shortName":"MediaPlayer","decls":{"methods":{"main":{"nowait":false},"play":{"nowait":false},"stop":{"nowait":false},"playSE":{"nowait":false},"setDelay":{"nowait":false},"setVolume":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T2Mod=Tonyu.klass([],{\n  main :function _trc_func_5000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_5000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  bvec :function _trc_func_5000015_2(tx,ty) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b2Vec2;\n    \n    //$LASTPOS=5000034;//kernel.T2Mod:34\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    return new b2Vec2(tx/_this.scale,ty/_this.scale);\n  },\n  fiber$bvec :function _trc_func_5000015_3(_thread,tx,ty) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b2Vec2;\n    \n    //$LASTPOS=5000034;//kernel.T2Mod:34\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    _thread.retVal=new b2Vec2(tx/_this.scale,ty/_this.scale);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T2Mod,{"fullName":"kernel.T2Mod","namespace":"kernel","shortName":"T2Mod","decls":{"methods":{"main":{"nowait":false},"bvec":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.TextRectMod=Tonyu.klass([],{\n  main :function _trc_func_6000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_6000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  drawTextRect :function _trc_func_6000017_2(ctx,text,x,topY,h,align,type) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var met;\n    var res;\n    var t;\n    \n    //$LASTPOS=6000090;//kernel.TextRectMod:90\n    if (! align) {\n      //$LASTPOS=6000102;//kernel.TextRectMod:102\n      align="center";\n    }\n    //$LASTPOS=6000123;//kernel.TextRectMod:123\n    ctx.textBaseline="top";\n    //$LASTPOS=6000152;//kernel.TextRectMod:152\n    _this.setFontSize(ctx,h);\n    //$LASTPOS=6000178;//kernel.TextRectMod:178\n    met = ctx.measureText(text);\n    //$LASTPOS=6000214;//kernel.TextRectMod:214\n    res = {y: topY,w: met.width,h: h};\n    //$LASTPOS=6000256;//kernel.TextRectMod:256\n    t = align.substring(0,1).toLowerCase();\n    //$LASTPOS=6000303;//kernel.TextRectMod:303\n    if (t=="l") {\n      //$LASTPOS=6000315;//kernel.TextRectMod:315\n      res.x=x;\n    } else {\n      //$LASTPOS=6000334;//kernel.TextRectMod:334\n      if (t=="r") {\n        //$LASTPOS=6000346;//kernel.TextRectMod:346\n        res.x=x-met.width;\n      } else {\n        //$LASTPOS=6000375;//kernel.TextRectMod:375\n        if (t=="c") {\n          //$LASTPOS=6000387;//kernel.TextRectMod:387\n          res.x=x-met.width/2;\n        }\n      }\n    }\n    //$LASTPOS=6000413;//kernel.TextRectMod:413\n    if (type=="fill") {\n      //$LASTPOS=6000431;//kernel.TextRectMod:431\n      ctx.fillText(text,res.x,topY);\n    }\n    //$LASTPOS=6000468;//kernel.TextRectMod:468\n    if (type=="stroke") {\n      //$LASTPOS=6000488;//kernel.TextRectMod:488\n      ctx.strokeText(text,res.x,topY);\n    }\n    return res;\n  },\n  setFontSize :function _trc_func_6000543_3(ctx,sz) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var post;\n    \n    //$LASTPOS=6000586;//kernel.TextRectMod:586\n    post = ctx.font.replace(/^[0-9\\.]+/,"");\n    //$LASTPOS=6000634;//kernel.TextRectMod:634\n    ctx.font=sz+post;\n  },\n  fukidashi :function _trc_func_6000658_4(ctx,text,x,y,sz) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var align;\n    var theight;\n    var margin;\n    var r;\n    var fs;\n    \n    //$LASTPOS=6000712;//kernel.TextRectMod:712\n    align = "c";\n    //$LASTPOS=6000732;//kernel.TextRectMod:732\n    theight = 20;\n    //$LASTPOS=6000753;//kernel.TextRectMod:753\n    margin = 5;\n    //$LASTPOS=6000772;//kernel.TextRectMod:772\n    r = _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align);\n    //$LASTPOS=6000842;//kernel.TextRectMod:842\n    ctx.beginPath();\n    //$LASTPOS=6000864;//kernel.TextRectMod:864\n    ctx.moveTo(x,y);\n    //$LASTPOS=6000888;//kernel.TextRectMod:888\n    ctx.lineTo(x+margin,y-theight);\n    //$LASTPOS=6000927;//kernel.TextRectMod:927\n    ctx.lineTo(x+r.w/2+margin,y-theight);\n    //$LASTPOS=6000972;//kernel.TextRectMod:972\n    ctx.lineTo(x+r.w/2+margin,y-theight-r.h-margin*2);\n    //$LASTPOS=6001030;//kernel.TextRectMod:1030\n    ctx.lineTo(x-r.w/2-margin,y-theight-r.h-margin*2);\n    //$LASTPOS=6001088;//kernel.TextRectMod:1088\n    ctx.lineTo(x-r.w/2-margin,y-theight);\n    //$LASTPOS=6001133;//kernel.TextRectMod:1133\n    ctx.lineTo(x-margin,y-theight);\n    //$LASTPOS=6001172;//kernel.TextRectMod:1172\n    ctx.closePath();\n    //$LASTPOS=6001194;//kernel.TextRectMod:1194\n    ctx.fill();\n    //$LASTPOS=6001211;//kernel.TextRectMod:1211\n    ctx.stroke();\n    //$LASTPOS=6001236;//kernel.TextRectMod:1236\n    fs = ctx.fillStyle;\n    //$LASTPOS=6001263;//kernel.TextRectMod:1263\n    ctx.fillStyle=ctx.strokeStyle;\n    //$LASTPOS=6001299;//kernel.TextRectMod:1299\n    _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align,"fill");\n    //$LASTPOS=6001372;//kernel.TextRectMod:1372\n    ctx.fillStyle=fs;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.TextRectMod,{"fullName":"kernel.TextRectMod","namespace":"kernel","shortName":"TextRectMod","decls":{"methods":{"main":{"nowait":false},"drawTextRect":{"nowait":true},"setFontSize":{"nowait":true},"fukidashi":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Scheduler=Tonyu.klass([],{\n  main :function _trc_func_7000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_7000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Scheduler,{"fullName":"kernel.Scheduler","namespace":"kernel","shortName":"Scheduler","decls":{"methods":{"main":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.TObject=Tonyu.klass([],{\n  main :function _trc_func_8000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_8000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_8000030_2(options) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=8000052;//kernel.TObject:52\n    if (typeof  options=="object") {\n      //$LASTPOS=8000082;//kernel.TObject:82\n      _this.extend(options);\n    }\n    //$LASTPOS=8000104;//kernel.TObject:104\n    _this.main();\n  },\n  extend :function _trc_func_8000121_3(obj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Tonyu.extend(_this,obj);\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.TObject,{"fullName":"kernel.TObject","namespace":"kernel","shortName":"TObject","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"extend":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.TQuery=Tonyu.klass(Tonyu.classes.kernel.TObject,[Tonyu.classes.kernel.MathMod],{\n  main :function _trc_func_9000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_9000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_9000035_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=9000049;//kernel.TQuery:49\n    _this.length=0;\n  },\n  tonyuIterator :function _trc_func_9000061_3(arity) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    \n    //$LASTPOS=9000089;//kernel.TQuery:89\n    res = {};\n    //$LASTPOS=9000105;//kernel.TQuery:105\n    res.i=0;\n    //$LASTPOS=9000118;//kernel.TQuery:118\n    if (arity==1) {\n      //$LASTPOS=9000142;//kernel.TQuery:142\n      res.next=function () {\n        \n        //$LASTPOS=9000177;//kernel.TQuery:177\n        if (res.i>=_this.length) {\n          return false;\n        }\n        //$LASTPOS=9000227;//kernel.TQuery:227\n        res[0]=_this[res.i];\n        //$LASTPOS=9000259;//kernel.TQuery:259\n        res.i++;\n        return true;\n      };\n      \n    } else {\n      //$LASTPOS=9000325;//kernel.TQuery:325\n      res.next=function () {\n        \n        //$LASTPOS=9000360;//kernel.TQuery:360\n        if (res.i>=_this.length) {\n          return false;\n        }\n        //$LASTPOS=9000410;//kernel.TQuery:410\n        res[0]=res.i;\n        //$LASTPOS=9000436;//kernel.TQuery:436\n        res[1]=_this[res.i];\n        //$LASTPOS=9000468;//kernel.TQuery:468\n        res.i++;\n        return true;\n      };\n      \n    }\n    return res;\n  },\n  fiber$tonyuIterator :function _trc_func_9000061_4(_thread,arity) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var res;\n    \n    //$LASTPOS=9000089;//kernel.TQuery:89\n    res = {};\n    //$LASTPOS=9000105;//kernel.TQuery:105\n    res.i=0;\n    //$LASTPOS=9000118;//kernel.TQuery:118\n    if (arity==1) {\n      //$LASTPOS=9000142;//kernel.TQuery:142\n      res.next=function () {\n        \n        //$LASTPOS=9000177;//kernel.TQuery:177\n        if (res.i>=_this.length) {\n          return false;\n        }\n        //$LASTPOS=9000227;//kernel.TQuery:227\n        res[0]=_this[res.i];\n        //$LASTPOS=9000259;//kernel.TQuery:259\n        res.i++;\n        return true;\n      };\n      \n    } else {\n      //$LASTPOS=9000325;//kernel.TQuery:325\n      res.next=function () {\n        \n        //$LASTPOS=9000360;//kernel.TQuery:360\n        if (res.i>=_this.length) {\n          return false;\n        }\n        //$LASTPOS=9000410;//kernel.TQuery:410\n        res[0]=res.i;\n        //$LASTPOS=9000436;//kernel.TQuery:436\n        res[1]=_this[res.i];\n        //$LASTPOS=9000468;//kernel.TQuery:468\n        res.i++;\n        return true;\n      };\n      \n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  attr :function _trc_func_9000537_5() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var values;\n    var i;\n    var e;\n    var _it_52;\n    \n    //$LASTPOS=9000551;//kernel.TQuery:551\n    values;\n    //$LASTPOS=9000567;//kernel.TQuery:567\n    if (_this.length==0) {\n      return _this;\n    }\n    //$LASTPOS=9000594;//kernel.TQuery:594\n    if (arguments.length==1&&typeof  arguments[0]=="string") {\n      return _this[0][arguments[0]];\n      \n    }\n    //$LASTPOS=9000702;//kernel.TQuery:702\n    if (arguments.length>=2) {\n      //$LASTPOS=9000737;//kernel.TQuery:737\n      values={};\n      //$LASTPOS=9000756;//kernel.TQuery:756\n      //$LASTPOS=9000761;//kernel.TQuery:761\n      i = 0;\n      while(i<arguments.length-1) {\n        {\n          //$LASTPOS=9000813;//kernel.TQuery:813\n          values[arguments[i]]=arguments[i+1];\n        }\n        i+=2;\n      }\n      \n    } else {\n      //$LASTPOS=9000881;//kernel.TQuery:881\n      values=arguments[0];\n      \n    }\n    //$LASTPOS=9000912;//kernel.TQuery:912\n    if (values) {\n      //$LASTPOS=9000934;//kernel.TQuery:934\n      _it_52=Tonyu.iterator(_this,1);\n      while(_it_52.next()) {\n        e=_it_52[0];\n        \n        //$LASTPOS=9000968;//kernel.TQuery:968\n        e.extend(values);\n        \n      }\n      \n    }\n  },\n  fiber$attr :function _trc_func_9000537_6(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var values;\n    var i;\n    var e;\n    var _it_52;\n    \n    //$LASTPOS=9000551;//kernel.TQuery:551\n    values;\n    //$LASTPOS=9000567;//kernel.TQuery:567\n    if (_this.length==0) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=9000594;//kernel.TQuery:594\n    if (_arguments.length==1&&typeof  _arguments[0]=="string") {\n      _thread.retVal=_this[0][_arguments[0]];return;\n      \n      \n    }\n    //$LASTPOS=9000702;//kernel.TQuery:702\n    if (_arguments.length>=2) {\n      //$LASTPOS=9000737;//kernel.TQuery:737\n      values={};\n      //$LASTPOS=9000756;//kernel.TQuery:756\n      //$LASTPOS=9000761;//kernel.TQuery:761\n      i = 0;\n      while(i<_arguments.length-1) {\n        {\n          //$LASTPOS=9000813;//kernel.TQuery:813\n          values[_arguments[i]]=_arguments[i+1];\n        }\n        i+=2;\n      }\n      \n    } else {\n      //$LASTPOS=9000881;//kernel.TQuery:881\n      values=_arguments[0];\n      \n    }\n    //$LASTPOS=9000912;//kernel.TQuery:912\n    if (values) {\n      //$LASTPOS=9000934;//kernel.TQuery:934\n      _it_52=Tonyu.iterator(_this,1);\n      while(_it_52.next()) {\n        e=_it_52[0];\n        \n        //$LASTPOS=9000968;//kernel.TQuery:968\n        e.extend(values);\n        \n      }\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  genKeyfunc :function _trc_func_9001005_7(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=9001028;//kernel.TQuery:1028\n    if (typeof  key!="function") {\n      return function (o) {\n        \n        return o[key];\n      };\n      \n    } else {\n      return key;\n      \n    }\n  },\n  fiber$genKeyfunc :function _trc_func_9001005_8(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=9001028;//kernel.TQuery:1028\n    if (typeof  key!="function") {\n      _thread.retVal=function (o) {\n        \n        return o[key];\n      };return;\n      \n      \n    } else {\n      _thread.retVal=key;return;\n      \n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  maxs :function _trc_func_9001137_9(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var f;\n    var res;\n    var reso;\n    var o;\n    var _it_58;\n    var v;\n    \n    //$LASTPOS=9001154;//kernel.TQuery:1154\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=9001181;//kernel.TQuery:1181\n    res;reso = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=9001210;//kernel.TQuery:1210\n    _it_58=Tonyu.iterator(_this,1);\n    while(_it_58.next()) {\n      o=_it_58[0];\n      \n      //$LASTPOS=9001240;//kernel.TQuery:1240\n      v = f(o);\n      //$LASTPOS=9001260;//kernel.TQuery:1260\n      if (res==null||v>=res) {\n        //$LASTPOS=9001299;//kernel.TQuery:1299\n        if (v>res) {\n          //$LASTPOS=9001310;//kernel.TQuery:1310\n          reso=new Tonyu.classes.kernel.TQuery;\n        }\n        //$LASTPOS=9001339;//kernel.TQuery:1339\n        reso.push(o);\n        //$LASTPOS=9001365;//kernel.TQuery:1365\n        res=v;\n        \n      }\n      \n    }\n    return reso;\n  },\n  fiber$maxs :function _trc_func_9001137_10(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var f;\n    var res;\n    var reso;\n    var o;\n    var _it_58;\n    var v;\n    \n    //$LASTPOS=9001154;//kernel.TQuery:1154\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=9001181;//kernel.TQuery:1181\n    res;reso = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=9001210;//kernel.TQuery:1210\n    _it_58=Tonyu.iterator(_this,1);\n    while(_it_58.next()) {\n      o=_it_58[0];\n      \n      //$LASTPOS=9001240;//kernel.TQuery:1240\n      v = f(o);\n      //$LASTPOS=9001260;//kernel.TQuery:1260\n      if (res==null||v>=res) {\n        //$LASTPOS=9001299;//kernel.TQuery:1299\n        if (v>res) {\n          //$LASTPOS=9001310;//kernel.TQuery:1310\n          reso=new Tonyu.classes.kernel.TQuery;\n        }\n        //$LASTPOS=9001339;//kernel.TQuery:1339\n        reso.push(o);\n        //$LASTPOS=9001365;//kernel.TQuery:1365\n        res=v;\n        \n      }\n      \n    }\n    _thread.retVal=reso;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  mins :function _trc_func_9001407_11(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var f;\n    var res;\n    var reso;\n    var o;\n    var _it_65;\n    var v;\n    \n    //$LASTPOS=9001424;//kernel.TQuery:1424\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=9001451;//kernel.TQuery:1451\n    res;reso = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=9001480;//kernel.TQuery:1480\n    _it_65=Tonyu.iterator(_this,1);\n    while(_it_65.next()) {\n      o=_it_65[0];\n      \n      //$LASTPOS=9001510;//kernel.TQuery:1510\n      v = f(o);\n      //$LASTPOS=9001530;//kernel.TQuery:1530\n      if (res==null||v<=res) {\n        //$LASTPOS=9001569;//kernel.TQuery:1569\n        if (v<res) {\n          //$LASTPOS=9001580;//kernel.TQuery:1580\n          reso=new Tonyu.classes.kernel.TQuery;\n        }\n        //$LASTPOS=9001609;//kernel.TQuery:1609\n        reso.push(o);\n        //$LASTPOS=9001635;//kernel.TQuery:1635\n        res=v;\n        \n      }\n      \n    }\n    return reso;\n  },\n  fiber$mins :function _trc_func_9001407_12(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var f;\n    var res;\n    var reso;\n    var o;\n    var _it_65;\n    var v;\n    \n    //$LASTPOS=9001424;//kernel.TQuery:1424\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=9001451;//kernel.TQuery:1451\n    res;reso = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=9001480;//kernel.TQuery:1480\n    _it_65=Tonyu.iterator(_this,1);\n    while(_it_65.next()) {\n      o=_it_65[0];\n      \n      //$LASTPOS=9001510;//kernel.TQuery:1510\n      v = f(o);\n      //$LASTPOS=9001530;//kernel.TQuery:1530\n      if (res==null||v<=res) {\n        //$LASTPOS=9001569;//kernel.TQuery:1569\n        if (v<res) {\n          //$LASTPOS=9001580;//kernel.TQuery:1580\n          reso=new Tonyu.classes.kernel.TQuery;\n        }\n        //$LASTPOS=9001609;//kernel.TQuery:1609\n        reso.push(o);\n        //$LASTPOS=9001635;//kernel.TQuery:1635\n        res=v;\n        \n      }\n      \n    }\n    _thread.retVal=reso;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  minObj :function _trc_func_9001677_13(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.mins(key)[0];\n  },\n  fiber$minObj :function _trc_func_9001677_14(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.mins(key)[0];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  maxObj :function _trc_func_9001719_15(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.maxs(key)[0];\n  },\n  fiber$maxObj :function _trc_func_9001719_16(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.maxs(key)[0];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  nearests :function _trc_func_9001761_17(x,y) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=9001782;//kernel.TQuery:1782\n    if (typeof  x=="object") {\n      //$LASTPOS=9001807;//kernel.TQuery:1807\n      y=x.y;\n      //$LASTPOS=9001813;//kernel.TQuery:1813\n      x=x.x;\n      \n    }\n    return _this.mins(function (o) {\n      \n      return _this.dist(o.x-x,o.y-y);\n    });\n  },\n  fiber$nearests :function _trc_func_9001761_18(_thread,x,y) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=9001782;//kernel.TQuery:1782\n    if (typeof  x=="object") {\n      //$LASTPOS=9001807;//kernel.TQuery:1807\n      y=x.y;\n      //$LASTPOS=9001813;//kernel.TQuery:1813\n      x=x.x;\n      \n    }\n    _thread.retVal=_this.mins(function (o) {\n      \n      return _this.dist(o.x-x,o.y-y);\n    });return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  nearest :function _trc_func_9001887_19(x,y) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.nearests(x,y)[0];\n  },\n  fiber$nearest :function _trc_func_9001887_20(_thread,x,y) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.nearests(x,y)[0];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  withins :function _trc_func_9001934_21(xo,yd,d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var x;\n    var y;\n    \n    //$LASTPOS=9001958;//kernel.TQuery:1958\n    x;y;\n    //$LASTPOS=9001971;//kernel.TQuery:1971\n    if (typeof  xo=="object") {\n      //$LASTPOS=9002006;//kernel.TQuery:2006\n      x=xo.x;\n      //$LASTPOS=9002013;//kernel.TQuery:2013\n      y=xo.y;\n      //$LASTPOS=9002020;//kernel.TQuery:2020\n      d=yd;\n      \n    } else {\n      //$LASTPOS=9002047;//kernel.TQuery:2047\n      x=xo;\n      //$LASTPOS=9002052;//kernel.TQuery:2052\n      y=yd;\n      \n    }\n    return _this.find(function (o) {\n      \n      return _this.dist(o.x-x,o.y-y)<=d;\n    });\n  },\n  fiber$withins :function _trc_func_9001934_22(_thread,xo,yd,d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var x;\n    var y;\n    \n    //$LASTPOS=9001958;//kernel.TQuery:1958\n    x;y;\n    //$LASTPOS=9001971;//kernel.TQuery:1971\n    if (typeof  xo=="object") {\n      //$LASTPOS=9002006;//kernel.TQuery:2006\n      x=xo.x;\n      //$LASTPOS=9002013;//kernel.TQuery:2013\n      y=xo.y;\n      //$LASTPOS=9002020;//kernel.TQuery:2020\n      d=yd;\n      \n    } else {\n      //$LASTPOS=9002047;//kernel.TQuery:2047\n      x=xo;\n      //$LASTPOS=9002052;//kernel.TQuery:2052\n      y=yd;\n      \n    }\n    _thread.retVal=_this.find(function (o) {\n      \n      return _this.dist(o.x-x,o.y-y)<=d;\n    });return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  within :function _trc_func_9002133_23(xo,yd,d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.withins(xo,yd,d).nearest();\n  },\n  fiber$within :function _trc_func_9002133_24(_thread,xo,yd,d) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.withins(xo,yd,d).nearest();return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  max :function _trc_func_9002194_25(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var f;\n    var res;\n    var o;\n    var _it_76;\n    var v;\n    \n    //$LASTPOS=9002210;//kernel.TQuery:2210\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=9002237;//kernel.TQuery:2237\n    res;\n    //$LASTPOS=9002250;//kernel.TQuery:2250\n    _it_76=Tonyu.iterator(_this,1);\n    while(_it_76.next()) {\n      o=_it_76[0];\n      \n      //$LASTPOS=9002280;//kernel.TQuery:2280\n      v = f(o);\n      //$LASTPOS=9002300;//kernel.TQuery:2300\n      if (res==null||v>res) {\n        //$LASTPOS=9002324;//kernel.TQuery:2324\n        res=v;\n      }\n      \n    }\n    return res;\n  },\n  fiber$max :function _trc_func_9002194_26(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var f;\n    var res;\n    var o;\n    var _it_76;\n    var v;\n    \n    //$LASTPOS=9002210;//kernel.TQuery:2210\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=9002237;//kernel.TQuery:2237\n    res;\n    //$LASTPOS=9002250;//kernel.TQuery:2250\n    _it_76=Tonyu.iterator(_this,1);\n    while(_it_76.next()) {\n      o=_it_76[0];\n      \n      //$LASTPOS=9002280;//kernel.TQuery:2280\n      v = f(o);\n      //$LASTPOS=9002300;//kernel.TQuery:2300\n      if (res==null||v>res) {\n        //$LASTPOS=9002324;//kernel.TQuery:2324\n        res=v;\n      }\n      \n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  min :function _trc_func_9002355_27(key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var f;\n    var res;\n    var o;\n    var _it_82;\n    var v;\n    \n    //$LASTPOS=9002371;//kernel.TQuery:2371\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=9002398;//kernel.TQuery:2398\n    res;\n    //$LASTPOS=9002411;//kernel.TQuery:2411\n    _it_82=Tonyu.iterator(_this,1);\n    while(_it_82.next()) {\n      o=_it_82[0];\n      \n      //$LASTPOS=9002441;//kernel.TQuery:2441\n      v = f(o);\n      //$LASTPOS=9002461;//kernel.TQuery:2461\n      if (res==null||v<res) {\n        //$LASTPOS=9002485;//kernel.TQuery:2485\n        res=v;\n      }\n      \n    }\n    return res;\n  },\n  fiber$min :function _trc_func_9002355_28(_thread,key) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var f;\n    var res;\n    var o;\n    var _it_82;\n    var v;\n    \n    //$LASTPOS=9002371;//kernel.TQuery:2371\n    f = _this.genKeyfunc(key);\n    //$LASTPOS=9002398;//kernel.TQuery:2398\n    res;\n    //$LASTPOS=9002411;//kernel.TQuery:2411\n    _it_82=Tonyu.iterator(_this,1);\n    while(_it_82.next()) {\n      o=_it_82[0];\n      \n      //$LASTPOS=9002441;//kernel.TQuery:2441\n      v = f(o);\n      //$LASTPOS=9002461;//kernel.TQuery:2461\n      if (res==null||v<res) {\n        //$LASTPOS=9002485;//kernel.TQuery:2485\n        res=v;\n      }\n      \n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  push :function _trc_func_9002516_29(e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=9002531;//kernel.TQuery:2531\n    _this[_this.length]=e;\n    //$LASTPOS=9002551;//kernel.TQuery:2551\n    _this.length++;\n  },\n  fiber$push :function _trc_func_9002516_30(_thread,e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=9002531;//kernel.TQuery:2531\n    _this[_this.length]=e;\n    //$LASTPOS=9002551;//kernel.TQuery:2551\n    _this.length++;\n    \n    _thread.retVal=_this;return;\n  },\n  size :function _trc_func_9002563_31() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.length;\n  },\n  fiber$size :function _trc_func_9002563_32(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.length;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  find :function _trc_func_9002588_33(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var no;\n    var o;\n    var _it_88;\n    \n    //$LASTPOS=9002603;//kernel.TQuery:2603\n    no = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=9002626;//kernel.TQuery:2626\n    _it_88=Tonyu.iterator(_this,1);\n    while(_it_88.next()) {\n      o=_it_88[0];\n      \n      //$LASTPOS=9002656;//kernel.TQuery:2656\n      if (f(o)) {\n        //$LASTPOS=9002666;//kernel.TQuery:2666\n        no.push(o);\n      }\n      \n    }\n    return no;\n  },\n  fiber$find :function _trc_func_9002588_34(_thread,f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var no;\n    var o;\n    var _it_88;\n    \n    //$LASTPOS=9002603;//kernel.TQuery:2603\n    no = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=9002626;//kernel.TQuery:2626\n    _it_88=Tonyu.iterator(_this,1);\n    while(_it_88.next()) {\n      o=_it_88[0];\n      \n      //$LASTPOS=9002656;//kernel.TQuery:2656\n      if (f(o)) {\n        //$LASTPOS=9002666;//kernel.TQuery:2666\n        no.push(o);\n      }\n      \n    }\n    _thread.retVal=no;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  apply :function _trc_func_9002702_35(name,args) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    var o;\n    var _it_92;\n    var f;\n    \n    //$LASTPOS=9002727;//kernel.TQuery:2727\n    res;\n    //$LASTPOS=9002740;//kernel.TQuery:2740\n    if (! args) {\n      //$LASTPOS=9002751;//kernel.TQuery:2751\n      args=[];\n    }\n    //$LASTPOS=9002764;//kernel.TQuery:2764\n    _it_92=Tonyu.iterator(_this,1);\n    while(_it_92.next()) {\n      o=_it_92[0];\n      \n      //$LASTPOS=9002794;//kernel.TQuery:2794\n      f = o[name];\n      //$LASTPOS=9002817;//kernel.TQuery:2817\n      if (typeof  f=="function") {\n        //$LASTPOS=9002857;//kernel.TQuery:2857\n        res=f.apply(o,args);\n        \n      }\n      \n    }\n    return res;\n  },\n  fiber$apply :function _trc_func_9002702_36(_thread,name,args) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var res;\n    var o;\n    var _it_92;\n    var f;\n    \n    //$LASTPOS=9002727;//kernel.TQuery:2727\n    res;\n    //$LASTPOS=9002740;//kernel.TQuery:2740\n    if (! args) {\n      //$LASTPOS=9002751;//kernel.TQuery:2751\n      args=[];\n    }\n    //$LASTPOS=9002764;//kernel.TQuery:2764\n    _it_92=Tonyu.iterator(_this,1);\n    while(_it_92.next()) {\n      o=_it_92[0];\n      \n      //$LASTPOS=9002794;//kernel.TQuery:2794\n      f = o[name];\n      //$LASTPOS=9002817;//kernel.TQuery:2817\n      if (typeof  f=="function") {\n        //$LASTPOS=9002857;//kernel.TQuery:2857\n        res=f.apply(o,args);\n        \n      }\n      \n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  alive :function _trc_func_9002968_37() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.find(function (o) {\n      \n      return ! o.isDead();\n    });\n  },\n  fiber$alive :function _trc_func_9002968_38(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.find(function (o) {\n      \n      return ! o.isDead();\n    });return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  die :function _trc_func_9003039_39() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var a;\n    \n    //$LASTPOS=9003052;//kernel.TQuery:3052\n    a = _this.alive();\n    //$LASTPOS=9003071;//kernel.TQuery:3071\n    if (a.length==0) {\n      return false;\n    }\n    //$LASTPOS=9003106;//kernel.TQuery:3106\n    a.apply("die");\n    return true;\n  },\n  fiber$die :function _trc_func_9003039_40(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var a;\n    \n    //$LASTPOS=9003052;//kernel.TQuery:3052\n    a = _this.alive();\n    //$LASTPOS=9003071;//kernel.TQuery:3071\n    if (a.length==0) {\n      _thread.retVal=false;return;\n      \n    }\n    //$LASTPOS=9003106;//kernel.TQuery:3106\n    a.apply("die");\n    _thread.retVal=true;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  klass :function _trc_func_9003142_41(k) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.find(function (o) {\n      \n      return o instanceof k;\n    });\n  },\n  fiber$klass :function _trc_func_9003142_42(_thread,k) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.find(function (o) {\n      \n      return o instanceof k;\n    });return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.TQuery,{"fullName":"kernel.TQuery","namespace":"kernel","shortName":"TQuery","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"tonyuIterator":{"nowait":false},"attr":{"nowait":false},"genKeyfunc":{"nowait":false},"maxs":{"nowait":false},"mins":{"nowait":false},"minObj":{"nowait":false},"maxObj":{"nowait":false},"nearests":{"nowait":false},"nearest":{"nowait":false},"withins":{"nowait":false},"within":{"nowait":false},"max":{"nowait":false},"min":{"nowait":false},"push":{"nowait":false},"size":{"nowait":false},"find":{"nowait":false},"apply":{"nowait":false},"alive":{"nowait":false},"die":{"nowait":false},"klass":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.WaveTable=Tonyu.klass(Tonyu.classes.kernel.TObject,[],{\n  main :function _trc_func_10000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10000028;//kernel.WaveTable:28\n    _this.wav={};\n    //$LASTPOS=10000036;//kernel.WaveTable:36\n    _this.env={};\n    //$LASTPOS=10000313;//kernel.WaveTable:313\n    if (typeof  T!=="undefined") {\n      //$LASTPOS=10000392;//kernel.WaveTable:392\n      _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});\n      //$LASTPOS=10000460;//kernel.WaveTable:460\n      _this.setEnv(0,_this.env);\n      //$LASTPOS=10000480;//kernel.WaveTable:480\n      _this.setWav(0,T("pulse"));\n      \n    }\n  },\n  fiber$main :function _trc_func_10000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=10000028;//kernel.WaveTable:28\n    _this.wav={};\n    //$LASTPOS=10000036;//kernel.WaveTable:36\n    _this.env={};\n    \n    _thread.enter(function _trc_func_10000000_2(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=10000313;//kernel.WaveTable:313\n          if (!(typeof  T!=="undefined")) { __pc=3; break; }\n          //$LASTPOS=10000392;//kernel.WaveTable:392\n          _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});\n          //$LASTPOS=10000460;//kernel.WaveTable:460\n          _this.fiber$setEnv(_thread, 0, _this.env);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=10000480;//kernel.WaveTable:480\n          _this.fiber$setWav(_thread, 0, T("pulse"));\n          __pc=2;return;\n        case 2:\n          \n        case 3:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  setWav :function _trc_func_10000044_3(num,synth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10000070;//kernel.WaveTable:70\n    _this.wav[num]=synth;\n  },\n  fiber$setWav :function _trc_func_10000044_4(_thread,num,synth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=10000070;//kernel.WaveTable:70\n    _this.wav[num]=synth;\n    \n    _thread.retVal=_this;return;\n  },\n  setEnv :function _trc_func_10000088_5(num,synth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=10000114;//kernel.WaveTable:114\n    _this.env[num]=synth;\n  },\n  fiber$setEnv :function _trc_func_10000088_6(_thread,num,synth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=10000114;//kernel.WaveTable:114\n    _this.env[num]=synth;\n    \n    _thread.retVal=_this;return;\n  },\n  get :function _trc_func_10000132_7(w,e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var synth;\n    \n    //$LASTPOS=10000148;//kernel.WaveTable:148\n    synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});\n    return synth;\n  },\n  fiber$get :function _trc_func_10000132_8(_thread,w,e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var synth;\n    \n    //$LASTPOS=10000148;//kernel.WaveTable:148\n    synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});\n    _thread.retVal=synth;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  stop :function _trc_func_10000226_9() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$stop :function _trc_func_10000226_10(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.WaveTable,{"fullName":"kernel.WaveTable","namespace":"kernel","shortName":"WaveTable","decls":{"methods":{"main":{"nowait":false},"setWav":{"nowait":false},"setEnv":{"nowait":false},"get":{"nowait":false},"stop":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.BaseActor=Tonyu.klass([Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.TextRectMod],{\n  main :function _trc_func_11000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_11000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_11000143_2(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var thg;\n    \n    //$LASTPOS=11000162;//kernel.BaseActor:162\n    if (Tonyu.runMode) {\n      //$LASTPOS=11000192;//kernel.BaseActor:192\n      thg = _this.currentThreadGroup();\n      //$LASTPOS=11000231;//kernel.BaseActor:231\n      if (thg) {\n        //$LASTPOS=11000240;//kernel.BaseActor:240\n        _this._th=thg.addObj(_this);\n      }\n      \n    }\n    //$LASTPOS=11000274;//kernel.BaseActor:274\n    if (typeof  x=="object") {\n      //$LASTPOS=11000298;//kernel.BaseActor:298\n      Tonyu.extend(_this,x);\n    } else {\n      //$LASTPOS=11000330;//kernel.BaseActor:330\n      if (typeof  x=="number") {\n        //$LASTPOS=11000365;//kernel.BaseActor:365\n        _this.x=x;\n        //$LASTPOS=11000384;//kernel.BaseActor:384\n        _this.y=y;\n        //$LASTPOS=11000403;//kernel.BaseActor:403\n        _this.p=p;\n        \n      }\n    }\n    //$LASTPOS=11000425;//kernel.BaseActor:425\n    if (_this.scaleX==null) {\n      //$LASTPOS=11000443;//kernel.BaseActor:443\n      _this.scaleX=1;\n    }\n    //$LASTPOS=11000458;//kernel.BaseActor:458\n    if (_this.rotation==null) {\n      //$LASTPOS=11000478;//kernel.BaseActor:478\n      _this.rotation=0;\n    }\n    //$LASTPOS=11000495;//kernel.BaseActor:495\n    if (_this.rotate==null) {\n      //$LASTPOS=11000513;//kernel.BaseActor:513\n      _this.rotate=0;\n    }\n    //$LASTPOS=11000528;//kernel.BaseActor:528\n    if (_this.alpha==null) {\n      //$LASTPOS=11000545;//kernel.BaseActor:545\n      _this.alpha=255;\n    }\n    //$LASTPOS=11000561;//kernel.BaseActor:561\n    if (_this.zOrder==null) {\n      //$LASTPOS=11000579;//kernel.BaseActor:579\n      _this.zOrder=0;\n    }\n    //$LASTPOS=11000594;//kernel.BaseActor:594\n    if (_this.age==null) {\n      //$LASTPOS=11000609;//kernel.BaseActor:609\n      _this.age=0;\n    }\n    //$LASTPOS=11000621;//kernel.BaseActor:621\n    if (_this.anim!=null&&typeof  _this.anim=="object") {\n      //$LASTPOS=11000672;//kernel.BaseActor:672\n      _this.animMode=true;\n      //$LASTPOS=11000696;//kernel.BaseActor:696\n      _this.animFrame=0;\n      \n    } else {\n      //$LASTPOS=11000730;//kernel.BaseActor:730\n      _this.animMode=false;\n      \n    }\n    //$LASTPOS=11000758;//kernel.BaseActor:758\n    if (_this.animFps==null) {\n      //$LASTPOS=11000777;//kernel.BaseActor:777\n      _this.animFps=1;\n    }\n  },\n  extend :function _trc_func_11000792_3(obj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Tonyu.extend(_this,obj);\n  },\n  print :function _trc_func_11000856_4(pt) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11000881;//kernel.BaseActor:881\n    console.log.apply(console,arguments);\n    //$LASTPOS=11000924;//kernel.BaseActor:924\n    if (Tonyu.globals.$consolePanel) {\n      //$LASTPOS=11000952;//kernel.BaseActor:952\n      Tonyu.globals.$consolePanel.scroll(0,20);\n      //$LASTPOS=11000989;//kernel.BaseActor:989\n      Tonyu.globals.$consolePanel.setFillStyle("white");\n      //$LASTPOS=11001035;//kernel.BaseActor:1035\n      Tonyu.globals.$consolePanel.fillText(pt,0,Tonyu.globals.$consolePrintY,20,"left");\n      \n    }\n  },\n  setAnimFps :function _trc_func_11001103_5(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11001131;//kernel.BaseActor:1131\n    _this.animFps=f;\n    //$LASTPOS=11001152;//kernel.BaseActor:1152\n    _this.animFrame=0;\n    //$LASTPOS=11001175;//kernel.BaseActor:1175\n    _this.animMode=true;\n  },\n  startAnim :function _trc_func_11001199_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11001225;//kernel.BaseActor:1225\n    _this.animMode=true;\n  },\n  stopAnim :function _trc_func_11001249_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11001274;//kernel.BaseActor:1274\n    _this.animMode=false;\n  },\n  update :function _trc_func_11001299_8() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11001316;//kernel.BaseActor:1316\n    _this.onUpdate();\n    //$LASTPOS=11001333;//kernel.BaseActor:1333\n    if (null) {\n      //$LASTPOS=11001356;//kernel.BaseActor:1356\n      null.suspend();\n      \n    }\n  },\n  fiber$update :function _trc_func_11001299_9(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=11001316;//kernel.BaseActor:1316\n    _this.onUpdate();\n    //$LASTPOS=11001333;//kernel.BaseActor:1333\n    if (_thread) {\n      //$LASTPOS=11001356;//kernel.BaseActor:1356\n      _thread.suspend();\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  onUpdate :function _trc_func_11001386_10() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  updateEx :function _trc_func_11001413_11(updateT) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var updateCount;\n    \n    //$LASTPOS=11001438;//kernel.BaseActor:1438\n    //$LASTPOS=11001442;//kernel.BaseActor:1442\n    updateCount = 0;\n    while(updateCount<updateT) {\n      {\n        //$LASTPOS=11001505;//kernel.BaseActor:1505\n        _this.update();\n      }\n      updateCount++;\n    }\n  },\n  fiber$updateEx :function _trc_func_11001413_12(_thread,updateT) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var updateCount;\n    \n    \n    _thread.enter(function _trc_func_11001413_13(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=11001438;//kernel.BaseActor:1438\n          //$LASTPOS=11001442;//kernel.BaseActor:1442\n          updateCount = 0;;\n        case 1:\n          if (!(updateCount<updateT)) { __pc=3; break; }\n          //$LASTPOS=11001505;//kernel.BaseActor:1505\n          _this.fiber$update(_thread);\n          __pc=2;return;\n        case 2:\n          \n          updateCount++;\n          __pc=1;break;\n        case 3:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  getkey :function _trc_func_11001526_14(k) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Tonyu.globals.$Keys.getkey(k);\n  },\n  hitTo :function _trc_func_11001579_15(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.crashTo(t);\n  },\n  all :function _trc_func_11001626_16(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    \n    //$LASTPOS=11001648;//kernel.BaseActor:1648\n    res = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=11001673;//kernel.BaseActor:1673\n    Tonyu.globals.$Sprites.sprites.forEach(function (s) {\n      \n      //$LASTPOS=11001714;//kernel.BaseActor:1714\n      if (s===_this) {\n        return _this;\n      }\n      //$LASTPOS=11001745;//kernel.BaseActor:1745\n      if (! c||s instanceof c) {\n        //$LASTPOS=11001786;//kernel.BaseActor:1786\n        res.push(s);\n        \n      }\n    });\n    return res;\n  },\n  allCrash :function _trc_func_11001866_17(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    var sp;\n    var t1;\n    \n    //$LASTPOS=11001893;//kernel.BaseActor:1893\n    res = new Tonyu.classes.kernel.TQuery;\n    //$LASTPOS=11001918;//kernel.BaseActor:1918\n    sp = _this;\n    //$LASTPOS=11001955;//kernel.BaseActor:1955\n    t1 = _this.getCrashRect();\n    //$LASTPOS=11001983;//kernel.BaseActor:1983\n    if (! t1) {\n      return res;\n    }\n    //$LASTPOS=11002009;//kernel.BaseActor:2009\n    Tonyu.globals.$Sprites.sprites.forEach(function (s) {\n      var t2;\n      \n      //$LASTPOS=11002050;//kernel.BaseActor:2050\n      t2;\n      //$LASTPOS=11002067;//kernel.BaseActor:2067\n      if (s!==_this&&! s.excludeFromAll&&s instanceof t&&(t2=s.getCrashRect())&&Math.abs(t1.x-t2.x)*2<t1.width+t2.width&&Math.abs(t1.y-t2.y)*2<t1.height+t2.height) {\n        //$LASTPOS=11002293;//kernel.BaseActor:2293\n        res.push(s);\n        \n      }\n    });\n    return res;\n  },\n  crashTo :function _trc_func_11002347_18(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11002373;//kernel.BaseActor:2373\n    if (! t) {\n      return false;\n    }\n    //$LASTPOS=11002400;//kernel.BaseActor:2400\n    if (typeof  t=="function") {\n      return _this.allCrash(t)[0];\n      \n    }\n    return _this.crashTo1(t);\n  },\n  crashTo1 :function _trc_func_11002496_19(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var t1;\n    var t2;\n    \n    //$LASTPOS=11002523;//kernel.BaseActor:2523\n    if (! t||t._isDead) {\n      return false;\n    }\n    //$LASTPOS=11002651;//kernel.BaseActor:2651\n    t1 = _this.getCrashRect();\n    //$LASTPOS=11002679;//kernel.BaseActor:2679\n    t2 = t.getCrashRect();\n    return t1&&t2&&Math.abs(t1.x-t2.x)*2<t1.width+t2.width&&Math.abs(t1.y-t2.y)*2<t1.height+t2.height;\n  },\n  getCrashRect :function _trc_func_11002961_20() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var actWidth;\n    var actHeight;\n    \n    //$LASTPOS=11002991;//kernel.BaseActor:2991\n    actWidth = _this.width*_this.scaleX;actHeight;\n    //$LASTPOS=11003034;//kernel.BaseActor:3034\n    if (typeof  _this.scaleY==="undefined") {\n      //$LASTPOS=11003076;//kernel.BaseActor:3076\n      actHeight=_this.height*_this.scaleX;\n      \n    } else {\n      //$LASTPOS=11003122;//kernel.BaseActor:3122\n      actHeight=_this.height*_this.scaleY;\n      \n    }\n    return typeof  _this.x=="number"&&typeof  _this.y=="number"&&typeof  _this.width=="number"&&typeof  _this.height=="number"&&{x: _this.x,y: _this.y,width: actWidth,height: actHeight};\n  },\n  within :function _trc_func_11003326_21(t,distance) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11003359;//kernel.BaseActor:3359\n    if (! t||t._isDead) {\n      return false;\n    }\n    //$LASTPOS=11003398;//kernel.BaseActor:3398\n    if (Math.sqrt(Math.abs(_this.x-t.x)*Math.abs(_this.x-t.x)+Math.abs(_this.y-t.y)*Math.abs(_this.y-t.y))<distance) {\n      return true;\n      \n    }\n    return false;\n  },\n  watchHit :function _trc_func_11003540_22(typeA,typeB,onHit) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11003583;//kernel.BaseActor:3583\n    Tonyu.globals.$Sprites.watchHit(typeA,typeB,function (a,b) {\n      \n      //$LASTPOS=11003634;//kernel.BaseActor:3634\n      onHit.apply(_this,[a,b]);\n    });\n  },\n  currentThreadGroup :function _trc_func_11003672_23() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Tonyu.globals.$currentThreadGroup;\n  },\n  die :function _trc_func_11003740_24() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11003761;//kernel.BaseActor:3761\n    if (_this._th) {\n      //$LASTPOS=11003781;//kernel.BaseActor:3781\n      _this._th.kill();\n      \n    }\n    //$LASTPOS=11003805;//kernel.BaseActor:3805\n    _this.hide();\n    //$LASTPOS=11003818;//kernel.BaseActor:3818\n    _this.fireEvent("die");\n    //$LASTPOS=11003841;//kernel.BaseActor:3841\n    _this._isDead=true;\n  },\n  hide :function _trc_func_11003859_25() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11004020;//kernel.BaseActor:4020\n    if (_this.layer&&typeof  _this.layer.remove=="function") {\n      //$LASTPOS=11004075;//kernel.BaseActor:4075\n      _this.layer.remove(_this);\n      \n    } else {\n      //$LASTPOS=11004116;//kernel.BaseActor:4116\n      Tonyu.globals.$Sprites.remove(_this);\n      \n    }\n  },\n  show :function _trc_func_11004150_26(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11004177;//kernel.BaseActor:4177\n    if (_this.layer&&typeof  _this.layer.add=="function") {\n      //$LASTPOS=11004229;//kernel.BaseActor:4229\n      _this.layer.add(_this);\n      \n    } else {\n      //$LASTPOS=11004267;//kernel.BaseActor:4267\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    //$LASTPOS=11004299;//kernel.BaseActor:4299\n    if (x!=null) {\n      //$LASTPOS=11004312;//kernel.BaseActor:4312\n      _this.x=x;\n    }\n    //$LASTPOS=11004327;//kernel.BaseActor:4327\n    if (y!=null) {\n      //$LASTPOS=11004340;//kernel.BaseActor:4340\n      _this.y=y;\n    }\n    //$LASTPOS=11004355;//kernel.BaseActor:4355\n    if (p!=null) {\n      //$LASTPOS=11004368;//kernel.BaseActor:4368\n      _this.p=p;\n    }\n  },\n  detectShape :function _trc_func_11004384_27() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11004413;//kernel.BaseActor:4413\n    if (typeof  _this.p!="number") {\n      //$LASTPOS=11004448;//kernel.BaseActor:4448\n      if (_this.text!=null) {\n        return _this;\n      }\n      //$LASTPOS=11004481;//kernel.BaseActor:4481\n      _this.p=0;\n      \n    }\n    //$LASTPOS=11004498;//kernel.BaseActor:4498\n    _this.p=Math.floor(_this.p);\n    //$LASTPOS=11004520;//kernel.BaseActor:4520\n    _this.pImg=Tonyu.globals.$Sprites.getImageList()[_this.p];\n    //$LASTPOS=11004558;//kernel.BaseActor:4558\n    if (! _this.pImg) {\n      return _this;\n    }\n    //$LASTPOS=11004582;//kernel.BaseActor:4582\n    _this.width=_this.pImg.width;\n    //$LASTPOS=11004605;//kernel.BaseActor:4605\n    _this.height=_this.pImg.height;\n  },\n  waitFor :function _trc_func_11004629_28(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11004648;//kernel.BaseActor:4648\n    if (null) {\n      //$LASTPOS=11004672;//kernel.BaseActor:4672\n      null.waitFor(f);\n      \n    }\n  },\n  fiber$waitFor :function _trc_func_11004629_29(_thread,f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=11004648;//kernel.BaseActor:4648\n    if (_thread) {\n      //$LASTPOS=11004672;//kernel.BaseActor:4672\n      _thread.waitFor(f);\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  isDead :function _trc_func_11004720_30() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this._isDead;\n  },\n  animation :function _trc_func_11004766_31() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11004792;//kernel.BaseActor:4792\n    _this.age++;\n    //$LASTPOS=11004804;//kernel.BaseActor:4804\n    if (_this.animMode&&_this.age%_this.animFps==0) {\n      //$LASTPOS=11004845;//kernel.BaseActor:4845\n      _this.p=_this.anim[_this.animFrame%_this.anim.length];\n      //$LASTPOS=11004885;//kernel.BaseActor:4885\n      _this.animFrame++;\n      \n    }\n  },\n  draw :function _trc_func_11004909_32(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var rect;\n    \n    //$LASTPOS=11004934;//kernel.BaseActor:4934\n    if (_this.x==null||_this.y==null||_this._isInvisible) {\n      return _this;\n    }\n    //$LASTPOS=11004987;//kernel.BaseActor:4987\n    _this.detectShape();\n    //$LASTPOS=11005007;//kernel.BaseActor:5007\n    if (_this.pImg) {\n      //$LASTPOS=11005028;//kernel.BaseActor:5028\n      ctx.save();\n      //$LASTPOS=11005049;//kernel.BaseActor:5049\n      ctx.translate(_this.x,_this.y);\n      //$LASTPOS=11005193;//kernel.BaseActor:5193\n      _this.animation();\n      //$LASTPOS=11005215;//kernel.BaseActor:5215\n      if (_this.rotation!=0) {\n        //$LASTPOS=11005250;//kernel.BaseActor:5250\n        ctx.rotate(_this.rotation/180*Math.PI);\n        \n      } else {\n        //$LASTPOS=11005318;//kernel.BaseActor:5318\n        ctx.rotate(_this.rotate/180*Math.PI);\n        \n      }\n      //$LASTPOS=11005375;//kernel.BaseActor:5375\n      if (typeof  _this.scaleY==="undefined") {\n        //$LASTPOS=11005427;//kernel.BaseActor:5427\n        ctx.scale(_this.scaleX,_this.scaleX);\n        \n      } else {\n        //$LASTPOS=11005492;//kernel.BaseActor:5492\n        ctx.scale(_this.scaleX,_this.scaleY);\n        \n      }\n      //$LASTPOS=11005548;//kernel.BaseActor:5548\n      ctx.globalAlpha=_this.alpha/255;\n      //$LASTPOS=11005589;//kernel.BaseActor:5589\n      ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.width/2,- _this.height/2,_this.width,_this.height);\n      //$LASTPOS=11005721;//kernel.BaseActor:5721\n      ctx.restore();\n      \n    } else {\n      //$LASTPOS=11005748;//kernel.BaseActor:5748\n      if (_this.text!==null&&_this.text!==undefined) {\n        //$LASTPOS=11005796;//kernel.BaseActor:5796\n        if (! _this.size) {\n          //$LASTPOS=11005807;//kernel.BaseActor:5807\n          _this.size=15;\n        }\n        //$LASTPOS=11005825;//kernel.BaseActor:5825\n        if (! _this.align) {\n          //$LASTPOS=11005837;//kernel.BaseActor:5837\n          _this.align="center";\n        }\n        //$LASTPOS=11005862;//kernel.BaseActor:5862\n        if (! _this.fillStyle) {\n          //$LASTPOS=11005878;//kernel.BaseActor:5878\n          _this.fillStyle="white";\n        }\n        //$LASTPOS=11005906;//kernel.BaseActor:5906\n        ctx.fillStyle=_this.fillStyle;\n        //$LASTPOS=11005940;//kernel.BaseActor:5940\n        ctx.globalAlpha=_this.alpha/255;\n        //$LASTPOS=11005981;//kernel.BaseActor:5981\n        rect = _this.drawTextRect(ctx,_this.text,_this.x,_this.y,_this.size,_this.align,"fill");\n        //$LASTPOS=11006052;//kernel.BaseActor:6052\n        _this.width=rect.w;\n        //$LASTPOS=11006075;//kernel.BaseActor:6075\n        _this.height=rect.h;\n        \n      }\n    }\n    //$LASTPOS=11006102;//kernel.BaseActor:6102\n    if (_this._fukidashi) {\n      //$LASTPOS=11006129;//kernel.BaseActor:6129\n      if (_this._fukidashi.c>0) {\n        //$LASTPOS=11006164;//kernel.BaseActor:6164\n        _this._fukidashi.c--;\n        //$LASTPOS=11006193;//kernel.BaseActor:6193\n        ctx.fillStyle="white";\n        //$LASTPOS=11006229;//kernel.BaseActor:6229\n        ctx.strokeStyle="black";\n        //$LASTPOS=11006267;//kernel.BaseActor:6267\n        _this.fukidashi(ctx,_this._fukidashi.text,_this.x,_this.y-_this.height/2-10,_this._fukidashi.size);\n        \n      }\n      \n    }\n  },\n  asyncResult :function _trc_func_11006373_33() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Tonyu.asyncResult();\n  },\n  screenOut :function _trc_func_11006436_34(a) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var r;\n    var viewX;\n    var viewY;\n    \n    //$LASTPOS=11006489;//kernel.BaseActor:6489\n    if (! a) {\n      //$LASTPOS=11006497;//kernel.BaseActor:6497\n      a=0;\n    }\n    //$LASTPOS=11006507;//kernel.BaseActor:6507\n    r = 0;\n    //$LASTPOS=11006521;//kernel.BaseActor:6521\n    viewX = 0;viewY = 0;\n    //$LASTPOS=11006547;//kernel.BaseActor:6547\n    if (_this.x<viewX+a) {\n      //$LASTPOS=11006576;//kernel.BaseActor:6576\n      r+=viewX+a-_this.x;\n    }\n    //$LASTPOS=11006595;//kernel.BaseActor:6595\n    if (_this.y<viewY+a) {\n      //$LASTPOS=11006624;//kernel.BaseActor:6624\n      r+=viewY+a-_this.y;\n    }\n    //$LASTPOS=11006643;//kernel.BaseActor:6643\n    if (_this.x>Tonyu.globals.$screenWidth+viewX-a) {\n      //$LASTPOS=11006672;//kernel.BaseActor:6672\n      r+=_this.x-(Tonyu.globals.$screenWidth+viewX-a);\n    }\n    //$LASTPOS=11006707;//kernel.BaseActor:6707\n    if (_this.y>Tonyu.globals.$screenHeight+viewY-a) {\n      //$LASTPOS=11006736;//kernel.BaseActor:6736\n      r+=_this.y-(Tonyu.globals.$screenHeight+viewY-a);\n    }\n    return r;\n  },\n  fiber$screenOut :function _trc_func_11006436_35(_thread,a) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var r;\n    var viewX;\n    var viewY;\n    \n    //$LASTPOS=11006489;//kernel.BaseActor:6489\n    if (! a) {\n      //$LASTPOS=11006497;//kernel.BaseActor:6497\n      a=0;\n    }\n    //$LASTPOS=11006507;//kernel.BaseActor:6507\n    r = 0;\n    //$LASTPOS=11006521;//kernel.BaseActor:6521\n    viewX = 0;viewY = 0;\n    //$LASTPOS=11006547;//kernel.BaseActor:6547\n    if (_this.x<viewX+a) {\n      //$LASTPOS=11006576;//kernel.BaseActor:6576\n      r+=viewX+a-_this.x;\n    }\n    //$LASTPOS=11006595;//kernel.BaseActor:6595\n    if (_this.y<viewY+a) {\n      //$LASTPOS=11006624;//kernel.BaseActor:6624\n      r+=viewY+a-_this.y;\n    }\n    //$LASTPOS=11006643;//kernel.BaseActor:6643\n    if (_this.x>Tonyu.globals.$screenWidth+viewX-a) {\n      //$LASTPOS=11006672;//kernel.BaseActor:6672\n      r+=_this.x-(Tonyu.globals.$screenWidth+viewX-a);\n    }\n    //$LASTPOS=11006707;//kernel.BaseActor:6707\n    if (_this.y>Tonyu.globals.$screenHeight+viewY-a) {\n      //$LASTPOS=11006736;//kernel.BaseActor:6736\n      r+=_this.y-(Tonyu.globals.$screenHeight+viewY-a);\n    }\n    _thread.retVal=r;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  file :function _trc_func_11006785_36(path) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var d;\n    var files;\n    \n    //$LASTPOS=11006804;//kernel.BaseActor:6804\n    d = Tonyu.currentProject.getDir();\n    //$LASTPOS=11006846;//kernel.BaseActor:6846\n    files = d.rel("files/");\n    return FS.get(files.rel(path),{topDir: d});\n  },\n  fiber$file :function _trc_func_11006785_37(_thread,path) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var d;\n    var files;\n    \n    //$LASTPOS=11006804;//kernel.BaseActor:6804\n    d = Tonyu.currentProject.getDir();\n    //$LASTPOS=11006846;//kernel.BaseActor:6846\n    files = d.rel("files/");\n    _thread.retVal=FS.get(files.rel(path),{topDir: d});return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  waitInputDevice :function _trc_func_11006925_38(fl) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11006953;//kernel.BaseActor:6953\n    if (fl!==false) {\n      //$LASTPOS=11006980;//kernel.BaseActor:6980\n      if (! _this.origTG) {\n        \n        \n      }\n      //$LASTPOS=11007132;//kernel.BaseActor:7132\n      _this.a=_this.asyncResult();\n      //$LASTPOS=11007158;//kernel.BaseActor:7158\n      Tonyu.globals.$InputDevice.addOnetimeListener(_this.a.receiver);\n      //$LASTPOS=11007212;//kernel.BaseActor:7212\n      _this.waitFor(_this.a);\n      \n    } else {\n      //$LASTPOS=11007247;//kernel.BaseActor:7247\n      if (_this.origTG) {\n        \n        \n      }\n      \n    }\n  },\n  fiber$waitInputDevice :function _trc_func_11006925_39(_thread,fl) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_11006925_40(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=11006953;//kernel.BaseActor:6953\n          if (!(fl!==false)) { __pc=3; break; }\n          //$LASTPOS=11006980;//kernel.BaseActor:6980\n          if (!(! _this.origTG)) { __pc=1; break; }\n          {\n            //$LASTPOS=11007034;//kernel.BaseActor:7034\n            _this.origTG=_thread.group;\n            //$LASTPOS=11007073;//kernel.BaseActor:7073\n            _thread.setGroup(null);\n          }\n        case 1:\n          \n          //$LASTPOS=11007132;//kernel.BaseActor:7132\n          _this.a=_this.asyncResult();\n          //$LASTPOS=11007158;//kernel.BaseActor:7158\n          Tonyu.globals.$InputDevice.addOnetimeListener(_this.a.receiver);\n          //$LASTPOS=11007212;//kernel.BaseActor:7212\n          _this.fiber$waitFor(_thread, _this.a);\n          __pc=2;return;\n        case 2:\n          \n          __pc=5;break;\n        case 3:\n          //$LASTPOS=11007247;//kernel.BaseActor:7247\n          if (!(_this.origTG)) { __pc=4; break; }\n          {\n            //$LASTPOS=11007300;//kernel.BaseActor:7300\n            _thread.setGroup(_this.origTG);\n            //$LASTPOS=11007343;//kernel.BaseActor:7343\n            _this.origTG=null;\n          }\n        case 4:\n          \n        case 5:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  redrawScreen :function _trc_func_11007393_41() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11007416;//kernel.BaseActor:7416\n    Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n    //$LASTPOS=11007452;//kernel.BaseActor:7452\n    Tonyu.globals.$Screen.draw();\n  },\n  fiber$redrawScreen :function _trc_func_11007393_42(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=11007416;//kernel.BaseActor:7416\n    Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n    //$LASTPOS=11007452;//kernel.BaseActor:7452\n    Tonyu.globals.$Screen.draw();\n    \n    _thread.retVal=_this;return;\n  },\n  color :function _trc_func_11007493_43(r,g,b) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return "rgb("+[r,g,b].join(",")+")";\n  },\n  fiber$color :function _trc_func_11007493_44(_thread,r,g,b) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal="rgb("+[r,g,b].join(",")+")";return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  drawText :function _trc_func_11007555_45(x,y,text,col,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var tp;\n    \n    //$LASTPOS=11007591;//kernel.BaseActor:7591\n    if (Tonyu.globals.$debug) {\n      return _this;\n    }\n    //$LASTPOS=11007616;//kernel.BaseActor:7616\n    if (! size) {\n      //$LASTPOS=11007627;//kernel.BaseActor:7627\n      size=15;\n    }\n    //$LASTPOS=11007641;//kernel.BaseActor:7641\n    if (! col) {\n      //$LASTPOS=11007651;//kernel.BaseActor:7651\n      col="cyan";\n    }\n    //$LASTPOS=11007668;//kernel.BaseActor:7668\n    tp = _this.all(Tonyu.classes.kernel.T1Text).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=11007722;//kernel.BaseActor:7722\n    if (tp.length>0) {\n      //$LASTPOS=11007750;//kernel.BaseActor:7750\n      tp[0].extend({x: x,y: y,text: text,fillStyle: col,size: size,hidden: false});\n      \n    } else {\n      //$LASTPOS=11007829;//kernel.BaseActor:7829\n      new Tonyu.classes.kernel.T1Text({x: x,y: y,text: text,fillStyle: col,size: size});\n      \n    }\n  },\n  fiber$drawText :function _trc_func_11007555_46(_thread,x,y,text,col,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var tp;\n    \n    //$LASTPOS=11007591;//kernel.BaseActor:7591\n    if (Tonyu.globals.$debug) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=11007616;//kernel.BaseActor:7616\n    if (! size) {\n      //$LASTPOS=11007627;//kernel.BaseActor:7627\n      size=15;\n    }\n    //$LASTPOS=11007641;//kernel.BaseActor:7641\n    if (! col) {\n      //$LASTPOS=11007651;//kernel.BaseActor:7651\n      col="cyan";\n    }\n    //$LASTPOS=11007668;//kernel.BaseActor:7668\n    tp = _this.all(Tonyu.classes.kernel.T1Text).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=11007722;//kernel.BaseActor:7722\n    if (tp.length>0) {\n      //$LASTPOS=11007750;//kernel.BaseActor:7750\n      tp[0].extend({x: x,y: y,text: text,fillStyle: col,size: size,hidden: false});\n      \n    } else {\n      //$LASTPOS=11007829;//kernel.BaseActor:7829\n      new Tonyu.classes.kernel.T1Text({x: x,y: y,text: text,fillStyle: col,size: size});\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  drawLine :function _trc_func_11007882_47(x,y,tx,ty,col) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var tp;\n    \n    //$LASTPOS=11007914;//kernel.BaseActor:7914\n    if (! col) {\n      //$LASTPOS=11007924;//kernel.BaseActor:7924\n      col="white";\n    }\n    //$LASTPOS=11007942;//kernel.BaseActor:7942\n    tp = _this.all(Tonyu.classes.kernel.T1Line).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=11007996;//kernel.BaseActor:7996\n    if (tp.length>0) {\n      //$LASTPOS=11008024;//kernel.BaseActor:8024\n      tp[0].extend({x: x,y: y,tx: tx,ty: ty,col: col,hidden: false});\n      \n    } else {\n      //$LASTPOS=11008089;//kernel.BaseActor:8089\n      new Tonyu.classes.kernel.T1Line({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    }\n  },\n  fiber$drawLine :function _trc_func_11007882_48(_thread,x,y,tx,ty,col) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var tp;\n    \n    //$LASTPOS=11007914;//kernel.BaseActor:7914\n    if (! col) {\n      //$LASTPOS=11007924;//kernel.BaseActor:7924\n      col="white";\n    }\n    //$LASTPOS=11007942;//kernel.BaseActor:7942\n    tp = _this.all(Tonyu.classes.kernel.T1Line).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=11007996;//kernel.BaseActor:7996\n    if (tp.length>0) {\n      //$LASTPOS=11008024;//kernel.BaseActor:8024\n      tp[0].extend({x: x,y: y,tx: tx,ty: ty,col: col,hidden: false});\n      \n    } else {\n      //$LASTPOS=11008089;//kernel.BaseActor:8089\n      new Tonyu.classes.kernel.T1Line({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  loadPage :function _trc_func_11008127_49(page,arg) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11008153;//kernel.BaseActor:8153\n    _this.all().die();\n    //$LASTPOS=11008171;//kernel.BaseActor:8171\n    new page(arg);\n    //$LASTPOS=11008191;//kernel.BaseActor:8191\n    _this.die();\n  },\n  fiber$loadPage :function _trc_func_11008127_50(_thread,page,arg) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=11008153;//kernel.BaseActor:8153\n    _this.all().die();\n    //$LASTPOS=11008171;//kernel.BaseActor:8171\n    new page(arg);\n    //$LASTPOS=11008191;//kernel.BaseActor:8191\n    _this.die();\n    \n    _thread.retVal=_this;return;\n  },\n  setVisible :function _trc_func_11008204_51(v) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=11008226;//kernel.BaseActor:8226\n    _this._isInvisible=! v;\n  },\n  fiber$setVisible :function _trc_func_11008204_52(_thread,v) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=11008226;//kernel.BaseActor:8226\n    _this._isInvisible=! v;\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.BaseActor,{"fullName":"kernel.BaseActor","namespace":"kernel","shortName":"BaseActor","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"extend":{"nowait":true},"print":{"nowait":true},"setAnimFps":{"nowait":true},"startAnim":{"nowait":true},"stopAnim":{"nowait":true},"update":{"nowait":false},"onUpdate":{"nowait":true},"updateEx":{"nowait":false},"getkey":{"nowait":true},"hitTo":{"nowait":true},"all":{"nowait":true},"allCrash":{"nowait":true},"crashTo":{"nowait":true},"crashTo1":{"nowait":true},"getCrashRect":{"nowait":true},"within":{"nowait":true},"watchHit":{"nowait":true},"currentThreadGroup":{"nowait":true},"die":{"nowait":true},"hide":{"nowait":true},"show":{"nowait":true},"detectShape":{"nowait":true},"waitFor":{"nowait":false},"isDead":{"nowait":true},"animation":{"nowait":true},"draw":{"nowait":true},"asyncResult":{"nowait":true},"screenOut":{"nowait":false},"file":{"nowait":false},"waitInputDevice":{"nowait":false},"redrawScreen":{"nowait":false},"color":{"nowait":false},"drawText":{"nowait":false},"drawLine":{"nowait":false},"loadPage":{"nowait":false},"setVisible":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.EventHandler=Tonyu.klass(Tonyu.classes.kernel.TObject,[],{\n  main :function _trc_func_12000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=12000020;//kernel.EventHandler:20\n    _this.listeners=[];\n  },\n  fiber$main :function _trc_func_12000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=12000020;//kernel.EventHandler:20\n    _this.listeners=[];\n    \n    _thread.retVal=_this;return;\n  },\n  addListener :function _trc_func_12000037_2(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=12000060;//kernel.EventHandler:60\n    _this.listeners.push(f);\n    return {remove: function () {\n      \n      //$LASTPOS=12000125;//kernel.EventHandler:125\n      _this.removeListener(f);\n    }};\n  },\n  fiber$addListener :function _trc_func_12000037_3(_thread,f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=12000060;//kernel.EventHandler:60\n    _this.listeners.push(f);\n    \n    _thread.enter(function _trc_func_12000037_4(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          _thread.exit({remove: function () {\n            \n            //$LASTPOS=12000125;//kernel.EventHandler:125\n            _this.removeListener(f);\n          }});return;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  removeListener :function _trc_func_12000167_5(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    \n    //$LASTPOS=12000193;//kernel.EventHandler:193\n    i = _this.listeners.indexOf(f);\n    //$LASTPOS=12000226;//kernel.EventHandler:226\n    _this.listeners.splice(i,1);\n  },\n  fiber$removeListener :function _trc_func_12000167_6(_thread,f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    \n    //$LASTPOS=12000193;//kernel.EventHandler:193\n    i = _this.listeners.indexOf(f);\n    //$LASTPOS=12000226;//kernel.EventHandler:226\n    _this.listeners.splice(i,1);\n    \n    _thread.retVal=_this;return;\n  },\n  fire :function _trc_func_12000253_7(args) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var h;\n    var _it_129;\n    \n    //$LASTPOS=12000272;//kernel.EventHandler:272\n    if (_this.released) {\n      return _this;\n    }\n    //$LASTPOS=12000299;//kernel.EventHandler:299\n    _it_129=Tonyu.iterator(_this.listeners,1);\n    while(_it_129.next()) {\n      h=_it_129[0];\n      \n      //$LASTPOS=12000335;//kernel.EventHandler:335\n      h.apply(_this,args);\n      \n    }\n  },\n  fiber$fire :function _trc_func_12000253_8(_thread,args) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var h;\n    var _it_129;\n    \n    //$LASTPOS=12000272;//kernel.EventHandler:272\n    if (_this.released) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=12000299;//kernel.EventHandler:299\n    _it_129=Tonyu.iterator(_this.listeners,1);\n    while(_it_129.next()) {\n      h=_it_129[0];\n      \n      //$LASTPOS=12000335;//kernel.EventHandler:335\n      h.apply(_this,args);\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  release :function _trc_func_12000366_9() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=12000384;//kernel.EventHandler:384\n    _this.released=true;\n  },\n  fiber$release :function _trc_func_12000366_10(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=12000384;//kernel.EventHandler:384\n    _this.released=true;\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.EventHandler,{"fullName":"kernel.EventHandler","namespace":"kernel","shortName":"EventHandler","decls":{"methods":{"main":{"nowait":false},"addListener":{"nowait":false},"removeListener":{"nowait":false},"fire":{"nowait":false},"release":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Keys=Tonyu.klass(Tonyu.classes.kernel.TObject,[],{\n  main :function _trc_func_13000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    \n    //$LASTPOS=13000084;//kernel.Keys:84\n    _this.stats={};\n    //$LASTPOS=13000094;//kernel.Keys:94\n    _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,mouseleft: 1};\n    //$LASTPOS=13000212;//kernel.Keys:212\n    //$LASTPOS=13000217;//kernel.Keys:217\n    i = 65;\n    while(i<65+26) {\n      {\n        //$LASTPOS=13000248;//kernel.Keys:248\n        _this.codes[String.fromCharCode(i).toLowerCase()]=i;\n      }\n      i++;\n    }\n    //$LASTPOS=13000297;//kernel.Keys:297\n    //$LASTPOS=13000302;//kernel.Keys:302\n    i = 48;\n    while(i<58) {\n      {\n        //$LASTPOS=13000330;//kernel.Keys:330\n        _this.codes[String.fromCharCode(i)]=i;\n      }\n      i++;\n    }\n    //$LASTPOS=13000365;//kernel.Keys:365\n    if (! $.data(document,"key_event")) {\n      //$LASTPOS=13000406;//kernel.Keys:406\n      $.data(document,"key_event",true);\n      //$LASTPOS=13000445;//kernel.Keys:445\n      $(document).keydown(function (e) {\n        \n        //$LASTPOS=13000471;//kernel.Keys:471\n        Tonyu.globals.$Keys.keydown(e);\n      });\n      //$LASTPOS=13000495;//kernel.Keys:495\n      $(document).keyup(function (e) {\n        \n        //$LASTPOS=13000519;//kernel.Keys:519\n        Tonyu.globals.$Keys.keyup(e);\n      });\n      //$LASTPOS=13000541;//kernel.Keys:541\n      $(document).mousedown(function (e) {\n        \n        //$LASTPOS=13000578;//kernel.Keys:578\n        if (Tonyu.globals.$InputDevice.touchEmu) {\n          //$LASTPOS=13000619;//kernel.Keys:619\n          Tonyu.globals.$touches[0].touched=1;\n          \n        }\n        //$LASTPOS=13000660;//kernel.Keys:660\n        Tonyu.globals.$Keys.keydown({keyCode: 1});\n      });\n      //$LASTPOS=13000697;//kernel.Keys:697\n      $(document).mouseup(function (e) {\n        \n        //$LASTPOS=13000732;//kernel.Keys:732\n        if (Tonyu.globals.$InputDevice.touchEmu) {\n          //$LASTPOS=13000773;//kernel.Keys:773\n          Tonyu.globals.$touches[0].touched=0;\n          \n        }\n        //$LASTPOS=13000814;//kernel.Keys:814\n        Tonyu.globals.$Keys.keyup({keyCode: 1});\n      });\n      \n    }\n  },\n  fiber$main :function _trc_func_13000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    \n    //$LASTPOS=13000084;//kernel.Keys:84\n    _this.stats={};\n    //$LASTPOS=13000094;//kernel.Keys:94\n    _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,mouseleft: 1};\n    //$LASTPOS=13000212;//kernel.Keys:212\n    //$LASTPOS=13000217;//kernel.Keys:217\n    i = 65;\n    while(i<65+26) {\n      {\n        //$LASTPOS=13000248;//kernel.Keys:248\n        _this.codes[String.fromCharCode(i).toLowerCase()]=i;\n      }\n      i++;\n    }\n    //$LASTPOS=13000297;//kernel.Keys:297\n    //$LASTPOS=13000302;//kernel.Keys:302\n    i = 48;\n    while(i<58) {\n      {\n        //$LASTPOS=13000330;//kernel.Keys:330\n        _this.codes[String.fromCharCode(i)]=i;\n      }\n      i++;\n    }\n    //$LASTPOS=13000365;//kernel.Keys:365\n    if (! $.data(document,"key_event")) {\n      //$LASTPOS=13000406;//kernel.Keys:406\n      $.data(document,"key_event",true);\n      //$LASTPOS=13000445;//kernel.Keys:445\n      $(document).keydown(function (e) {\n        \n        //$LASTPOS=13000471;//kernel.Keys:471\n        Tonyu.globals.$Keys.keydown(e);\n      });\n      //$LASTPOS=13000495;//kernel.Keys:495\n      $(document).keyup(function (e) {\n        \n        //$LASTPOS=13000519;//kernel.Keys:519\n        Tonyu.globals.$Keys.keyup(e);\n      });\n      //$LASTPOS=13000541;//kernel.Keys:541\n      $(document).mousedown(function (e) {\n        \n        //$LASTPOS=13000578;//kernel.Keys:578\n        if (Tonyu.globals.$InputDevice.touchEmu) {\n          //$LASTPOS=13000619;//kernel.Keys:619\n          Tonyu.globals.$touches[0].touched=1;\n          \n        }\n        //$LASTPOS=13000660;//kernel.Keys:660\n        Tonyu.globals.$Keys.keydown({keyCode: 1});\n      });\n      //$LASTPOS=13000697;//kernel.Keys:697\n      $(document).mouseup(function (e) {\n        \n        //$LASTPOS=13000732;//kernel.Keys:732\n        if (Tonyu.globals.$InputDevice.touchEmu) {\n          //$LASTPOS=13000773;//kernel.Keys:773\n          Tonyu.globals.$touches[0].touched=0;\n          \n        }\n        //$LASTPOS=13000814;//kernel.Keys:814\n        Tonyu.globals.$Keys.keyup({keyCode: 1});\n      });\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  getkey :function _trc_func_13000847_2(code) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=13000875;//kernel.Keys:875\n    if (typeof  code=="string") {\n      //$LASTPOS=13000912;//kernel.Keys:912\n      code=_this.codes[code.toLowerCase()];\n      \n    }\n    //$LASTPOS=13000954;//kernel.Keys:954\n    if (! code) {\n      return 0;\n    }\n    //$LASTPOS=13000979;//kernel.Keys:979\n    if (_this.stats[code]==- 1) {\n      return 0;\n    }\n    //$LASTPOS=13001014;//kernel.Keys:1014\n    if (! _this.stats[code]) {\n      //$LASTPOS=13001032;//kernel.Keys:1032\n      _this.stats[code]=0;\n    }\n    return _this.stats[code];\n  },\n  fiber$getkey :function _trc_func_13000847_3(_thread,code) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=13000875;//kernel.Keys:875\n    if (typeof  code=="string") {\n      //$LASTPOS=13000912;//kernel.Keys:912\n      code=_this.codes[code.toLowerCase()];\n      \n    }\n    //$LASTPOS=13000954;//kernel.Keys:954\n    if (! code) {\n      _thread.retVal=0;return;\n      \n    }\n    //$LASTPOS=13000979;//kernel.Keys:979\n    if (_this.stats[code]==- 1) {\n      _thread.retVal=0;return;\n      \n    }\n    //$LASTPOS=13001014;//kernel.Keys:1014\n    if (! _this.stats[code]) {\n      //$LASTPOS=13001032;//kernel.Keys:1032\n      _this.stats[code]=0;\n    }\n    _thread.retVal=_this.stats[code];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  update :function _trc_func_13001073_4() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    var _it_137;\n    \n    //$LASTPOS=13001097;//kernel.Keys:1097\n    _it_137=Tonyu.iterator(_this.stats,1);\n    while(_it_137.next()) {\n      i=_it_137[0];\n      \n      //$LASTPOS=13001128;//kernel.Keys:1128\n      if (_this.stats[i]>0) {\n        //$LASTPOS=13001145;//kernel.Keys:1145\n        _this.stats[i]++;\n        \n      }\n      //$LASTPOS=13001166;//kernel.Keys:1166\n      if (_this.stats[i]==- 1) {\n        //$LASTPOS=13001184;//kernel.Keys:1184\n        _this.stats[i]=1;\n      }\n      \n    }\n  },\n  fiber$update :function _trc_func_13001073_5(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    var _it_137;\n    \n    //$LASTPOS=13001097;//kernel.Keys:1097\n    _it_137=Tonyu.iterator(_this.stats,1);\n    while(_it_137.next()) {\n      i=_it_137[0];\n      \n      //$LASTPOS=13001128;//kernel.Keys:1128\n      if (_this.stats[i]>0) {\n        //$LASTPOS=13001145;//kernel.Keys:1145\n        _this.stats[i]++;\n        \n      }\n      //$LASTPOS=13001166;//kernel.Keys:1166\n      if (_this.stats[i]==- 1) {\n        //$LASTPOS=13001184;//kernel.Keys:1184\n        _this.stats[i]=1;\n      }\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  keydown :function _trc_func_13001204_6(e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var s;\n    \n    //$LASTPOS=13001222;//kernel.Keys:1222\n    s = _this.stats[e.keyCode];\n    //$LASTPOS=13001250;//kernel.Keys:1250\n    if (! s) {\n      //$LASTPOS=13001268;//kernel.Keys:1268\n      _this.stats[e.keyCode]=1;\n      \n    }\n    //$LASTPOS=13001298;//kernel.Keys:1298\n    Tonyu.globals.$InputDevice.handleListeners();\n  },\n  fiber$keydown :function _trc_func_13001204_7(_thread,e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var s;\n    \n    //$LASTPOS=13001222;//kernel.Keys:1222\n    s = _this.stats[e.keyCode];\n    //$LASTPOS=13001250;//kernel.Keys:1250\n    if (! s) {\n      //$LASTPOS=13001268;//kernel.Keys:1268\n      _this.stats[e.keyCode]=1;\n      \n    }\n    //$LASTPOS=13001298;//kernel.Keys:1298\n    Tonyu.globals.$InputDevice.handleListeners();\n    \n    _thread.retVal=_this;return;\n  },\n  keyup :function _trc_func_13001332_8(e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=13001348;//kernel.Keys:1348\n    _this.stats[e.keyCode]=0;\n    //$LASTPOS=13001372;//kernel.Keys:1372\n    Tonyu.globals.$InputDevice.handleListeners();\n  },\n  fiber$keyup :function _trc_func_13001332_9(_thread,e) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=13001348;//kernel.Keys:1348\n    _this.stats[e.keyCode]=0;\n    //$LASTPOS=13001372;//kernel.Keys:1372\n    Tonyu.globals.$InputDevice.handleListeners();\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Keys,{"fullName":"kernel.Keys","namespace":"kernel","shortName":"Keys","decls":{"methods":{"main":{"nowait":false},"getkey":{"nowait":false},"update":{"nowait":false},"keydown":{"nowait":false},"keyup":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.MML=Tonyu.klass(Tonyu.classes.kernel.TObject,[Tonyu.classes.kernel.MathMod],{\n  main :function _trc_func_14000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=14000050;//kernel.MML:50\n    _this.mmlBuf=[];\n  },\n  fiber$main :function _trc_func_14000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=14000050;//kernel.MML:50\n    _this.mmlBuf=[];\n    \n    _thread.retVal=_this;return;\n  },\n  play :function _trc_func_14000062_2(mmls) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=14000081;//kernel.MML:81\n    _this.mmlBuf.push(mmls);\n    //$LASTPOS=14000105;//kernel.MML:105\n    if (! _this.isPlaying()) {\n      //$LASTPOS=14000134;//kernel.MML:134\n      _this.playNext();\n      \n    }\n  },\n  fiber$play :function _trc_func_14000062_3(_thread,mmls) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=14000081;//kernel.MML:81\n    _this.mmlBuf.push(mmls);\n    \n    _thread.enter(function _trc_func_14000062_4(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=14000105;//kernel.MML:105\n          if (!(! _this.isPlaying())) { __pc=2; break; }\n          //$LASTPOS=14000134;//kernel.MML:134\n          _this.fiber$playNext(_thread);\n          __pc=1;return;\n        case 1:\n          \n        case 2:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  playNext :function _trc_func_14000157_5() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var mml;\n    \n    //$LASTPOS=14000220;//kernel.MML:220\n    if (_this.cTimeBase==null) {\n      //$LASTPOS=14000241;//kernel.MML:241\n      _this.cTimeBase=0;\n    }\n    //$LASTPOS=14000259;//kernel.MML:259\n    if (_this.m) {\n      //$LASTPOS=14000277;//kernel.MML:277\n      _this.cTimeBase+=_this.m.currentTime;\n      \n    }\n    //$LASTPOS=14000348;//kernel.MML:348\n    mml = _this.mmlBuf.shift();\n    //$LASTPOS=14000377;//kernel.MML:377\n    if (! mml) {\n      //$LASTPOS=14000398;//kernel.MML:398\n      _this.m=null;\n      //$LASTPOS=14000415;//kernel.MML:415\n      _this.cTimeBase=0;\n      return _this;\n      \n    }\n    //$LASTPOS=14000457;//kernel.MML:457\n    _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();\n    //$LASTPOS=14000495;//kernel.MML:495\n    _this.m=T("mml",{mml: mml},_this.mwav);\n    //$LASTPOS=14000525;//kernel.MML:525\n    _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));\n    //$LASTPOS=14000555;//kernel.MML:555\n    _this.m.start();\n    //$LASTPOS=14000571;//kernel.MML:571\n    Tonyu.globals.$MMLS[_this.id()]=_this;\n  },\n  fiber$playNext :function _trc_func_14000157_6(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var mml;\n    \n    //$LASTPOS=14000220;//kernel.MML:220\n    if (_this.cTimeBase==null) {\n      //$LASTPOS=14000241;//kernel.MML:241\n      _this.cTimeBase=0;\n    }\n    //$LASTPOS=14000259;//kernel.MML:259\n    if (_this.m) {\n      //$LASTPOS=14000277;//kernel.MML:277\n      _this.cTimeBase+=_this.m.currentTime;\n      \n    }\n    //$LASTPOS=14000348;//kernel.MML:348\n    mml = _this.mmlBuf.shift();\n    //$LASTPOS=14000377;//kernel.MML:377\n    if (! mml) {\n      //$LASTPOS=14000398;//kernel.MML:398\n      _this.m=null;\n      //$LASTPOS=14000415;//kernel.MML:415\n      _this.cTimeBase=0;\n      _thread.retVal=_this;return;\n      \n      \n    }\n    //$LASTPOS=14000457;//kernel.MML:457\n    _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();\n    //$LASTPOS=14000495;//kernel.MML:495\n    _this.m=T("mml",{mml: mml},_this.mwav);\n    //$LASTPOS=14000525;//kernel.MML:525\n    _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));\n    //$LASTPOS=14000555;//kernel.MML:555\n    _this.m.start();\n    //$LASTPOS=14000571;//kernel.MML:571\n    Tonyu.globals.$MMLS[_this.id()]=_this;\n    \n    _thread.retVal=_this;return;\n  },\n  id :function _trc_func_14000593_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=14000606;//kernel.MML:606\n    if (! _this._id) {\n      //$LASTPOS=14000616;//kernel.MML:616\n      _this._id=_this.rnd()+"";\n    }\n    return _this._id;\n  },\n  fiber$id :function _trc_func_14000593_8(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=14000606;//kernel.MML:606\n    if (! _this._id) {\n      //$LASTPOS=14000616;//kernel.MML:616\n      _this._id=_this.rnd()+"";\n    }\n    _thread.retVal=_this._id;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  bufferCount :function _trc_func_14000651_9() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.mmlBuf.length;\n  },\n  fiber$bufferCount :function _trc_func_14000651_10(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.mmlBuf.length;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  isPlaying :function _trc_func_14000699_11() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.m;\n  },\n  fiber$isPlaying :function _trc_func_14000699_12(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.m;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  currentTime :function _trc_func_14000733_13() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=14000755;//kernel.MML:755\n    if (_this.m) {\n      return _this.m.currentTime+_this.cTimeBase;\n    }\n    return - 1;\n  },\n  fiber$currentTime :function _trc_func_14000733_14(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=14000755;//kernel.MML:755\n    if (_this.m) {\n      _thread.retVal=_this.m.currentTime+_this.cTimeBase;return;\n      \n    }\n    _thread.retVal=- 1;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  stop :function _trc_func_14000814_15() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=14000829;//kernel.MML:829\n    if (_this.m) {\n      //$LASTPOS=14000847;//kernel.MML:847\n      if (_this.mwav) {\n        //$LASTPOS=14000872;//kernel.MML:872\n        _this.mwav.pause();\n        //$LASTPOS=14000899;//kernel.MML:899\n        _this.mwav.stop();\n        \n      }\n      //$LASTPOS=14000932;//kernel.MML:932\n      _this.m.pause();\n      //$LASTPOS=14000952;//kernel.MML:952\n      _this.m.stop();\n      //$LASTPOS=14000971;//kernel.MML:971\n      _this.m=null;\n      //$LASTPOS=14000988;//kernel.MML:988\n      _this.mmlBuf=[];\n      //$LASTPOS=14001056;//kernel.MML:1056\n      delete Tonyu.globals.$MMLS[_this.id()];\n      \n    }\n  },\n  fiber$stop :function _trc_func_14000814_16(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=14000829;//kernel.MML:829\n    if (_this.m) {\n      //$LASTPOS=14000847;//kernel.MML:847\n      if (_this.mwav) {\n        //$LASTPOS=14000872;//kernel.MML:872\n        _this.mwav.pause();\n        //$LASTPOS=14000899;//kernel.MML:899\n        _this.mwav.stop();\n        \n      }\n      //$LASTPOS=14000932;//kernel.MML:932\n      _this.m.pause();\n      //$LASTPOS=14000952;//kernel.MML:952\n      _this.m.stop();\n      //$LASTPOS=14000971;//kernel.MML:971\n      _this.m=null;\n      //$LASTPOS=14000988;//kernel.MML:988\n      _this.mmlBuf=[];\n      //$LASTPOS=14001056;//kernel.MML:1056\n      delete Tonyu.globals.$MMLS[_this.id()];\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.MML,{"fullName":"kernel.MML","namespace":"kernel","shortName":"MML","decls":{"methods":{"main":{"nowait":false},"play":{"nowait":false},"playNext":{"nowait":false},"id":{"nowait":false},"bufferCount":{"nowait":false},"isPlaying":{"nowait":false},"currentTime":{"nowait":false},"stop":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.NoviceActor=Tonyu.klass(Tonyu.classes.kernel.BaseActor,[],{\n  main :function _trc_func_15000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_15000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  sleep :function _trc_func_15000034_2(n) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=15000050;//kernel.NoviceActor:50\n    if (! n) {\n      //$LASTPOS=15000057;//kernel.NoviceActor:57\n      n=1;\n    }\n    //$LASTPOS=15000066;//kernel.NoviceActor:66\n    //$LASTPOS=15000070;//kernel.NoviceActor:70\n    n;\n    while(n>0) {\n      //$LASTPOS=15000081;//kernel.NoviceActor:81\n      _this.update();\n      n--;\n    }\n  },\n  fiber$sleep :function _trc_func_15000034_3(_thread,n) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=15000050;//kernel.NoviceActor:50\n    if (! n) {\n      //$LASTPOS=15000057;//kernel.NoviceActor:57\n      n=1;\n    }\n    \n    _thread.enter(function _trc_func_15000034_4(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=15000066;//kernel.NoviceActor:66\n          //$LASTPOS=15000070;//kernel.NoviceActor:70\n          n;;\n        case 1:\n          if (!(n>0)) { __pc=3; break; }\n          //$LASTPOS=15000081;//kernel.NoviceActor:81\n          _this.fiber$update(_thread);\n          __pc=2;return;\n        case 2:\n          \n          n--;\n          __pc=1;break;\n        case 3:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initSprite :function _trc_func_15000093_5() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=15000113;//kernel.NoviceActor:113\n    if (! _this._sprite) {\n      //$LASTPOS=15000137;//kernel.NoviceActor:137\n      _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});\n      //$LASTPOS=15000207;//kernel.NoviceActor:207\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n  },\n  fiber$initSprite :function _trc_func_15000093_6(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=15000113;//kernel.NoviceActor:113\n    if (! _this._sprite) {\n      //$LASTPOS=15000137;//kernel.NoviceActor:137\n      _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});\n      //$LASTPOS=15000207;//kernel.NoviceActor:207\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  say :function _trc_func_15000235_7(text,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=15000257;//kernel.NoviceActor:257\n    if (! size) {\n      //$LASTPOS=15000268;//kernel.NoviceActor:268\n      size=15;\n    }\n    //$LASTPOS=15000281;//kernel.NoviceActor:281\n    _this.initSprite();\n    //$LASTPOS=15000299;//kernel.NoviceActor:299\n    _this._sprite._fukidashi={text: text,size: size,c: 30};\n  },\n  fiber$say :function _trc_func_15000235_8(_thread,text,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=15000257;//kernel.NoviceActor:257\n    if (! size) {\n      //$LASTPOS=15000268;//kernel.NoviceActor:268\n      size=15;\n    }\n    \n    _thread.enter(function _trc_func_15000235_9(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=15000281;//kernel.NoviceActor:281\n          _this.fiber$initSprite(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=15000299;//kernel.NoviceActor:299\n          _this._sprite._fukidashi={text: text,size: size,c: 30};\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  sprite :function _trc_func_15000350_10(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=15000371;//kernel.NoviceActor:371\n    _this.go(x,y,p);\n  },\n  fiber$sprite :function _trc_func_15000350_11(_thread,x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_15000350_12(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=15000371;//kernel.NoviceActor:371\n          _this.fiber$go(_thread, x, y, p);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  show :function _trc_func_15000384_13(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=15000403;//kernel.NoviceActor:403\n    _this.go(x,y,p);\n  },\n  draw :function _trc_func_15000416_14(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=15000440;//kernel.NoviceActor:440\n    _this._sprite.draw(ctx);\n  },\n  getCrashRect :function _trc_func_15000461_15() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this._sprite.getCrashRect();\n  },\n  go :function _trc_func_15000516_16(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=15000533;//kernel.NoviceActor:533\n    _this.initSprite();\n    //$LASTPOS=15000551;//kernel.NoviceActor:551\n    _this._sprite.x=x;\n    //$LASTPOS=15000568;//kernel.NoviceActor:568\n    _this._sprite.y=y;\n    //$LASTPOS=15000585;//kernel.NoviceActor:585\n    if (p!=null) {\n      //$LASTPOS=15000598;//kernel.NoviceActor:598\n      _this._sprite.p=p;\n    }\n  },\n  fiber$go :function _trc_func_15000516_17(_thread,x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_15000516_18(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=15000533;//kernel.NoviceActor:533\n          _this.fiber$initSprite(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=15000551;//kernel.NoviceActor:551\n          _this._sprite.x=x;\n          //$LASTPOS=15000568;//kernel.NoviceActor:568\n          _this._sprite.y=y;\n          //$LASTPOS=15000585;//kernel.NoviceActor:585\n          if (p!=null) {\n            //$LASTPOS=15000598;//kernel.NoviceActor:598\n            _this._sprite.p=p;\n          }\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  change :function _trc_func_15000629_19(p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=15000646;//kernel.NoviceActor:646\n    _this.initSprite();\n    //$LASTPOS=15000664;//kernel.NoviceActor:664\n    _this._sprite.p=p;\n  },\n  fiber$change :function _trc_func_15000629_20(_thread,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_15000629_21(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=15000646;//kernel.NoviceActor:646\n          _this.fiber$initSprite(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=15000664;//kernel.NoviceActor:664\n          _this._sprite.p=p;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.NoviceActor,{"fullName":"kernel.NoviceActor","namespace":"kernel","shortName":"NoviceActor","decls":{"methods":{"main":{"nowait":false},"sleep":{"nowait":false},"initSprite":{"nowait":false},"say":{"nowait":false},"sprite":{"nowait":false},"show":{"nowait":true},"draw":{"nowait":true},"getCrashRect":{"nowait":true},"go":{"nowait":false},"change":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.ParallelMod=Tonyu.klass(Tonyu.classes.kernel.BaseActor,[],{\n  main :function _trc_func_16000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_16000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  parallel :function _trc_func_16000037_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var args;\n    var i;\n    var name;\n    var thg;\n    var th;\n    \n    //$LASTPOS=16000064;//kernel.ParallelMod:64\n    args = [];\n    //$LASTPOS=16000083;//kernel.ParallelMod:83\n    //$LASTPOS=16000088;//kernel.ParallelMod:88\n    i = 1;\n    while(i<arguments.length) {\n      {\n        //$LASTPOS=16000134;//kernel.ParallelMod:134\n        args.push(arguments[i]);\n      }\n      i++;\n    }\n    //$LASTPOS=16000173;//kernel.ParallelMod:173\n    name = arguments[0];\n    //$LASTPOS=16000212;//kernel.ParallelMod:212\n    thg = Tonyu.globals.$currentThreadGroup;\n    //$LASTPOS=16000247;//kernel.ParallelMod:247\n    th;\n    //$LASTPOS=16000261;//kernel.ParallelMod:261\n    if (thg) {\n      //$LASTPOS=16000270;//kernel.ParallelMod:270\n      th=thg.addObj(_this,name,args);\n    }\n    //$LASTPOS=16000309;//kernel.ParallelMod:309\n    _this.on("die",function () {\n      \n      //$LASTPOS=16000321;//kernel.ParallelMod:321\n      th.kill();\n    });\n    return th;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.ParallelMod,{"fullName":"kernel.ParallelMod","namespace":"kernel","shortName":"ParallelMod","decls":{"methods":{"main":{"nowait":false},"parallel":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.PlayMod=Tonyu.klass(Tonyu.classes.kernel.BaseActor,[],{\n  main :function _trc_func_17000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_17000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initMML :function _trc_func_17000020_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=17000045;//kernel.PlayMod:45\n    if (_this.mmlInited) {\n      return _this;\n    }\n    //$LASTPOS=17000073;//kernel.PlayMod:73\n    _this.mmlInited=true;\n    //$LASTPOS=17000094;//kernel.PlayMod:94\n    Tonyu.globals.$currentProject.requestPlugin("timbre");\n    //$LASTPOS=17000140;//kernel.PlayMod:140\n    if (! Tonyu.globals.$MMLS) {\n      //$LASTPOS=17000162;//kernel.PlayMod:162\n      Tonyu.globals.$MMLS={};\n      //$LASTPOS=17000180;//kernel.PlayMod:180\n      Tonyu.globals.$WaveTable=new Tonyu.classes.kernel.WaveTable;\n      //$LASTPOS=17000214;//kernel.PlayMod:214\n      Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseMML));\n      \n    }\n    //$LASTPOS=17000256;//kernel.PlayMod:256\n    _this.on("die",function () {\n      \n      //$LASTPOS=17000272;//kernel.PlayMod:272\n      _this.play().stop();\n    });\n  },\n  releaseMML :function _trc_func_17000294_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var k;\n    var v;\n    var _it_147;\n    \n    //$LASTPOS=17000322;//kernel.PlayMod:322\n    if (Tonyu.globals.$MMLS) {\n      //$LASTPOS=17000343;//kernel.PlayMod:343\n      _it_147=Tonyu.iterator(Tonyu.globals.$MMLS,2);\n      while(_it_147.next()) {\n        k=_it_147[0];\n        v=_it_147[1];\n        \n        //$LASTPOS=17000379;//kernel.PlayMod:379\n        v.stop();\n        \n      }\n      //$LASTPOS=17000407;//kernel.PlayMod:407\n      Tonyu.globals.$MMLS=null;\n      \n    }\n    //$LASTPOS=17000432;//kernel.PlayMod:432\n    if (Tonyu.globals.$WaveTable) {\n      //$LASTPOS=17000458;//kernel.PlayMod:458\n      Tonyu.globals.$WaveTable.stop();\n      //$LASTPOS=17000485;//kernel.PlayMod:485\n      Tonyu.globals.$WaveTable=null;\n      \n    }\n  },\n  play :function _trc_func_17000513_4() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var mmls;\n    var i;\n    \n    //$LASTPOS=17000528;//kernel.PlayMod:528\n    _this.initMML();\n    //$LASTPOS=17000544;//kernel.PlayMod:544\n    if (! _this._mml) {\n      //$LASTPOS=17000555;//kernel.PlayMod:555\n      _this._mml=new Tonyu.classes.kernel.MML;\n    }\n    //$LASTPOS=17000574;//kernel.PlayMod:574\n    if (_this.isDead()||arguments.length==0) {\n      return _this._mml;\n    }\n    //$LASTPOS=17000629;//kernel.PlayMod:629\n    mmls = [];\n    //$LASTPOS=17000647;//kernel.PlayMod:647\n    //$LASTPOS=17000652;//kernel.PlayMod:652\n    i = 0;\n    while(i<arguments.length) {\n      {\n        //$LASTPOS=17000697;//kernel.PlayMod:697\n        mmls.push(arguments[i]);\n      }\n      i++;\n    }\n    //$LASTPOS=17000734;//kernel.PlayMod:734\n    _this._mml.play(mmls);\n    //$LASTPOS=17000756;//kernel.PlayMod:756\n    while (_this._mml.bufferCount()>2) {\n      //$LASTPOS=17000796;//kernel.PlayMod:796\n      _this.update();\n      \n    }\n    return _this._mml;\n  },\n  fiber$play :function _trc_func_17000513_5(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var mmls;\n    var i;\n    \n    //$LASTPOS=17000528;//kernel.PlayMod:528\n    _this.initMML();\n    //$LASTPOS=17000544;//kernel.PlayMod:544\n    if (! _this._mml) {\n      //$LASTPOS=17000555;//kernel.PlayMod:555\n      _this._mml=new Tonyu.classes.kernel.MML;\n    }\n    //$LASTPOS=17000574;//kernel.PlayMod:574\n    if (_this.isDead()||_arguments.length==0) {\n      _thread.retVal=_this._mml;return;\n      \n    }\n    //$LASTPOS=17000629;//kernel.PlayMod:629\n    mmls = [];\n    //$LASTPOS=17000647;//kernel.PlayMod:647\n    //$LASTPOS=17000652;//kernel.PlayMod:652\n    i = 0;\n    while(i<_arguments.length) {\n      {\n        //$LASTPOS=17000697;//kernel.PlayMod:697\n        mmls.push(_arguments[i]);\n      }\n      i++;\n    }\n    //$LASTPOS=17000734;//kernel.PlayMod:734\n    _this._mml.play(mmls);\n    \n    _thread.enter(function _trc_func_17000513_6(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=17000756;//kernel.PlayMod:756\n        case 1:\n          if (!(_this._mml.bufferCount()>2)) { __pc=3; break; }\n          //$LASTPOS=17000796;//kernel.PlayMod:796\n          _this.fiber$update(_thread);\n          __pc=2;return;\n        case 2:\n          \n          __pc=1;break;\n        case 3:\n          \n          _thread.exit(_this._mml);return;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  playSE :function _trc_func_17000835_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var mml;\n    var mmls;\n    var i;\n    \n    //$LASTPOS=17000859;//kernel.PlayMod:859\n    _this.initMML();\n    //$LASTPOS=17000875;//kernel.PlayMod:875\n    mml = new Tonyu.classes.kernel.MML;\n    //$LASTPOS=17000897;//kernel.PlayMod:897\n    mmls = [];\n    //$LASTPOS=17000915;//kernel.PlayMod:915\n    //$LASTPOS=17000920;//kernel.PlayMod:920\n    i = 0;\n    while(i<arguments.length) {\n      {\n        //$LASTPOS=17000965;//kernel.PlayMod:965\n        mmls.push(arguments[i]);\n      }\n      i++;\n    }\n    //$LASTPOS=17001002;//kernel.PlayMod:1002\n    mml.play(mmls);\n    return mml;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.PlayMod,{"fullName":"kernel.PlayMod","namespace":"kernel","shortName":"PlayMod","decls":{"methods":{"main":{"nowait":false},"initMML":{"nowait":true},"releaseMML":{"nowait":true},"play":{"nowait":false},"playSE":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Actor=Tonyu.klass(Tonyu.classes.kernel.BaseActor,[Tonyu.classes.kernel.PlayMod,Tonyu.classes.kernel.ParallelMod],{\n  main :function _trc_func_18000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_18000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_18000086_2(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18000105;//kernel.Actor:105\n    Tonyu.classes.kernel.BaseActor.apply( _this, [x,y,p]);\n    //$LASTPOS=18000124;//kernel.Actor:124\n    if (Tonyu.runMode) {\n      //$LASTPOS=18000143;//kernel.Actor:143\n      _this.initSprite();\n    }\n  },\n  initSprite :function _trc_func_18000161_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=18000182;//kernel.Actor:182\n    if (_this.layer&&typeof  _this.layer.add=="function") {\n      //$LASTPOS=18000234;//kernel.Actor:234\n      _this.layer.add(_this);\n      \n    } else {\n      //$LASTPOS=18000272;//kernel.Actor:272\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    //$LASTPOS=18000304;//kernel.Actor:304\n    _this.onAppear();\n  },\n  fiber$initSprite :function _trc_func_18000161_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=18000182;//kernel.Actor:182\n    if (_this.layer&&typeof  _this.layer.add=="function") {\n      //$LASTPOS=18000234;//kernel.Actor:234\n      _this.layer.add(_this);\n      \n    } else {\n      //$LASTPOS=18000272;//kernel.Actor:272\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    \n    _thread.enter(function _trc_func_18000161_5(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=18000304;//kernel.Actor:304\n          _this.fiber$onAppear(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  onAppear :function _trc_func_18000320_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$onAppear :function _trc_func_18000320_7(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Actor,{"fullName":"kernel.Actor","namespace":"kernel","shortName":"Actor","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"initSprite":{"nowait":false},"onAppear":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.BodyActor=Tonyu.klass(Tonyu.classes.kernel.Actor,[Tonyu.classes.kernel.T2Mod],{\n  main :function _trc_func_19000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_19000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getWorld :function _trc_func_19000046_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=19000064;//kernel.BodyActor:64\n    if (Tonyu.globals.$t2World) {\n      return Tonyu.globals.$t2World;\n    }\n    //$LASTPOS=19000099;//kernel.BodyActor:99\n    Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;\n    return Tonyu.globals.$t2World;\n  },\n  fiber$getWorld :function _trc_func_19000046_3(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=19000064;//kernel.BodyActor:64\n    if (Tonyu.globals.$t2World) {\n      _thread.retVal=Tonyu.globals.$t2World;return;\n      \n    }\n    //$LASTPOS=19000099;//kernel.BodyActor:99\n    Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;\n    _thread.retVal=Tonyu.globals.$t2World;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  onAppear :function _trc_func_19000144_4() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b2Vec2;\n    var b2BodyDef;\n    var b2Body;\n    var b2FixtureDef;\n    var b2Fixture;\n    var b2PolygonShape;\n    var b2CircleShape;\n    var fixDef;\n    var bodyDef;\n    var w;\n    var h;\n    \n    //$LASTPOS=19000162;//kernel.BodyActor:162\n    _this.world=_this.getWorld().world;\n    //$LASTPOS=19000190;//kernel.BodyActor:190\n    _this.scale=_this.getWorld().scale;\n    //$LASTPOS=19000218;//kernel.BodyActor:218\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=19000261;//kernel.BodyActor:261\n    b2BodyDef = Box2D.Dynamics.b2BodyDef;\n    //$LASTPOS=19000307;//kernel.BodyActor:307\n    b2Body = Box2D.Dynamics.b2Body;\n    //$LASTPOS=19000347;//kernel.BodyActor:347\n    b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n    //$LASTPOS=19000399;//kernel.BodyActor:399\n    b2Fixture = Box2D.Dynamics.b2Fixture;\n    //$LASTPOS=19000445;//kernel.BodyActor:445\n    b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n    //$LASTPOS=19000509;//kernel.BodyActor:509\n    b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n    //$LASTPOS=19000576;//kernel.BodyActor:576\n    fixDef = new b2FixtureDef;\n    //$LASTPOS=19000611;//kernel.BodyActor:611\n    fixDef.density=_this.density||1;\n    //$LASTPOS=19000648;//kernel.BodyActor:648\n    fixDef.friction=_this.friction||0.5;\n    //$LASTPOS=19000687;//kernel.BodyActor:687\n    fixDef.restitution=_this.restitution||0.2;\n    //$LASTPOS=19000737;//kernel.BodyActor:737\n    bodyDef = new b2BodyDef;\n    //$LASTPOS=19000770;//kernel.BodyActor:770\n    bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;\n    //$LASTPOS=19000855;//kernel.BodyActor:855\n    bodyDef.position.x=_this.x/_this.scale;\n    //$LASTPOS=19000890;//kernel.BodyActor:890\n    bodyDef.position.y=_this.y/_this.scale;\n    //$LASTPOS=19000925;//kernel.BodyActor:925\n    _this.shape=_this.shape||(_this.radius?"circle":"box");\n    //$LASTPOS=19000973;//kernel.BodyActor:973\n    w = _this.width;h = _this.height;\n    //$LASTPOS=19000999;//kernel.BodyActor:999\n    if (! w) {\n      //$LASTPOS=19001017;//kernel.BodyActor:1017\n      _this.detectShape();\n      //$LASTPOS=19001040;//kernel.BodyActor:1040\n      w=_this.width*(_this.scaleX||1);\n      //$LASTPOS=19001069;//kernel.BodyActor:1069\n      h=_this.height*(_this.scaleY||_this.scaleX||1);\n      \n    }\n    //$LASTPOS=19001109;//kernel.BodyActor:1109\n    if (_this.shape=="box") {\n      //$LASTPOS=19001137;//kernel.BodyActor:1137\n      if (! h) {\n        //$LASTPOS=19001145;//kernel.BodyActor:1145\n        h=w;\n      }\n      //$LASTPOS=19001158;//kernel.BodyActor:1158\n      fixDef.shape=new b2PolygonShape;\n      //$LASTPOS=19001201;//kernel.BodyActor:1201\n      fixDef.shape.SetAsOrientedBox(w/2/_this.scale,h/2/_this.scale,new b2Vec2(0,0),0);\n      \n    } else {\n      //$LASTPOS=19001302;//kernel.BodyActor:1302\n      _this.radius=_this.radius||w/2||16;\n      //$LASTPOS=19001338;//kernel.BodyActor:1338\n      fixDef.shape=new b2CircleShape(_this.radius/_this.scale);\n      //$LASTPOS=19001412;//kernel.BodyActor:1412\n      _this.width=_this.height=_this.radius*2;\n      \n    }\n    //$LASTPOS=19001446;//kernel.BodyActor:1446\n    _this.body=_this.world.CreateBody(bodyDef);\n    //$LASTPOS=19001482;//kernel.BodyActor:1482\n    _this.body.CreateFixture(fixDef);\n    //$LASTPOS=19001514;//kernel.BodyActor:1514\n    _this.body.SetUserData(_this);\n    //$LASTPOS=19001542;//kernel.BodyActor:1542\n    _this.body.SetAngle(_this.rad(_this.rotation));\n  },\n  fiber$onAppear :function _trc_func_19000144_5(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b2Vec2;\n    var b2BodyDef;\n    var b2Body;\n    var b2FixtureDef;\n    var b2Fixture;\n    var b2PolygonShape;\n    var b2CircleShape;\n    var fixDef;\n    var bodyDef;\n    var w;\n    var h;\n    \n    //$LASTPOS=19000162;//kernel.BodyActor:162\n    _this.world=_this.getWorld().world;\n    //$LASTPOS=19000190;//kernel.BodyActor:190\n    _this.scale=_this.getWorld().scale;\n    //$LASTPOS=19000218;//kernel.BodyActor:218\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=19000261;//kernel.BodyActor:261\n    b2BodyDef = Box2D.Dynamics.b2BodyDef;\n    //$LASTPOS=19000307;//kernel.BodyActor:307\n    b2Body = Box2D.Dynamics.b2Body;\n    //$LASTPOS=19000347;//kernel.BodyActor:347\n    b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n    //$LASTPOS=19000399;//kernel.BodyActor:399\n    b2Fixture = Box2D.Dynamics.b2Fixture;\n    //$LASTPOS=19000445;//kernel.BodyActor:445\n    b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n    //$LASTPOS=19000509;//kernel.BodyActor:509\n    b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n    //$LASTPOS=19000576;//kernel.BodyActor:576\n    fixDef = new b2FixtureDef;\n    //$LASTPOS=19000611;//kernel.BodyActor:611\n    fixDef.density=_this.density||1;\n    //$LASTPOS=19000648;//kernel.BodyActor:648\n    fixDef.friction=_this.friction||0.5;\n    //$LASTPOS=19000687;//kernel.BodyActor:687\n    fixDef.restitution=_this.restitution||0.2;\n    //$LASTPOS=19000737;//kernel.BodyActor:737\n    bodyDef = new b2BodyDef;\n    //$LASTPOS=19000770;//kernel.BodyActor:770\n    bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;\n    //$LASTPOS=19000855;//kernel.BodyActor:855\n    bodyDef.position.x=_this.x/_this.scale;\n    //$LASTPOS=19000890;//kernel.BodyActor:890\n    bodyDef.position.y=_this.y/_this.scale;\n    //$LASTPOS=19000925;//kernel.BodyActor:925\n    _this.shape=_this.shape||(_this.radius?"circle":"box");\n    //$LASTPOS=19000973;//kernel.BodyActor:973\n    w = _this.width;h = _this.height;\n    //$LASTPOS=19000999;//kernel.BodyActor:999\n    if (! w) {\n      //$LASTPOS=19001017;//kernel.BodyActor:1017\n      _this.detectShape();\n      //$LASTPOS=19001040;//kernel.BodyActor:1040\n      w=_this.width*(_this.scaleX||1);\n      //$LASTPOS=19001069;//kernel.BodyActor:1069\n      h=_this.height*(_this.scaleY||_this.scaleX||1);\n      \n    }\n    //$LASTPOS=19001109;//kernel.BodyActor:1109\n    if (_this.shape=="box") {\n      //$LASTPOS=19001137;//kernel.BodyActor:1137\n      if (! h) {\n        //$LASTPOS=19001145;//kernel.BodyActor:1145\n        h=w;\n      }\n      //$LASTPOS=19001158;//kernel.BodyActor:1158\n      fixDef.shape=new b2PolygonShape;\n      //$LASTPOS=19001201;//kernel.BodyActor:1201\n      fixDef.shape.SetAsOrientedBox(w/2/_this.scale,h/2/_this.scale,new b2Vec2(0,0),0);\n      \n    } else {\n      //$LASTPOS=19001302;//kernel.BodyActor:1302\n      _this.radius=_this.radius||w/2||16;\n      //$LASTPOS=19001338;//kernel.BodyActor:1338\n      fixDef.shape=new b2CircleShape(_this.radius/_this.scale);\n      //$LASTPOS=19001412;//kernel.BodyActor:1412\n      _this.width=_this.height=_this.radius*2;\n      \n    }\n    //$LASTPOS=19001446;//kernel.BodyActor:1446\n    _this.body=_this.world.CreateBody(bodyDef);\n    //$LASTPOS=19001482;//kernel.BodyActor:1482\n    _this.body.CreateFixture(fixDef);\n    //$LASTPOS=19001514;//kernel.BodyActor:1514\n    _this.body.SetUserData(_this);\n    //$LASTPOS=19001542;//kernel.BodyActor:1542\n    _this.body.SetAngle(_this.rad(_this.rotation));\n    \n    _thread.retVal=_this;return;\n  },\n  allContact :function _trc_func_19001574_6(klass) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    var c;\n    var a;\n    var b;\n    \n    //$LASTPOS=19001599;//kernel.BodyActor:1599\n    res = [];\n    //$LASTPOS=19001615;//kernel.BodyActor:1615\n    //$LASTPOS=19001620;//kernel.BodyActor:1620\n    c = _this.world.GetContactList();\n    while(c) {\n      {\n        //$LASTPOS=19001676;//kernel.BodyActor:1676\n        if (c.IsTouching()) {\n          //$LASTPOS=19001710;//kernel.BodyActor:1710\n          a = c.GetFixtureA().GetBody().GetUserData();\n          //$LASTPOS=19001769;//kernel.BodyActor:1769\n          b = c.GetFixtureB().GetBody().GetUserData();\n          //$LASTPOS=19001828;//kernel.BodyActor:1828\n          if (a===_this) {\n            //$LASTPOS=19001860;//kernel.BodyActor:1860\n            if (! klass||b===klass||b instanceof klass) {\n              //$LASTPOS=19001929;//kernel.BodyActor:1929\n              res.push(b);\n              \n            }\n            \n          } else {\n            //$LASTPOS=19001979;//kernel.BodyActor:1979\n            if (b===_this) {\n              //$LASTPOS=19002011;//kernel.BodyActor:2011\n              if (! klass||a===klass||a instanceof klass) {\n                //$LASTPOS=19002080;//kernel.BodyActor:2080\n                res.push(a);\n                \n              }\n              \n            }\n          }\n          \n        }\n      }\n      c=c.GetNext();\n    }\n    return res;\n  },\n  fiber$allContact :function _trc_func_19001574_7(_thread,klass) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var res;\n    var c;\n    var a;\n    var b;\n    \n    //$LASTPOS=19001599;//kernel.BodyActor:1599\n    res = [];\n    //$LASTPOS=19001615;//kernel.BodyActor:1615\n    //$LASTPOS=19001620;//kernel.BodyActor:1620\n    c = _this.world.GetContactList();\n    while(c) {\n      {\n        //$LASTPOS=19001676;//kernel.BodyActor:1676\n        if (c.IsTouching()) {\n          //$LASTPOS=19001710;//kernel.BodyActor:1710\n          a = c.GetFixtureA().GetBody().GetUserData();\n          //$LASTPOS=19001769;//kernel.BodyActor:1769\n          b = c.GetFixtureB().GetBody().GetUserData();\n          //$LASTPOS=19001828;//kernel.BodyActor:1828\n          if (a===_this) {\n            //$LASTPOS=19001860;//kernel.BodyActor:1860\n            if (! klass||b===klass||b instanceof klass) {\n              //$LASTPOS=19001929;//kernel.BodyActor:1929\n              res.push(b);\n              \n            }\n            \n          } else {\n            //$LASTPOS=19001979;//kernel.BodyActor:1979\n            if (b===_this) {\n              //$LASTPOS=19002011;//kernel.BodyActor:2011\n              if (! klass||a===klass||a instanceof klass) {\n                //$LASTPOS=19002080;//kernel.BodyActor:2080\n                res.push(a);\n                \n              }\n              \n            }\n          }\n          \n        }\n      }\n      c=c.GetNext();\n    }\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  applyForce :function _trc_func_19002159_8(fx,fy,px,py) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b2Vec2;\n    var scale;\n    var fps;\n    \n    //$LASTPOS=19002190;//kernel.BodyActor:2190\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=19002233;//kernel.BodyActor:2233\n    scale = _this.getWorld().scale;\n    //$LASTPOS=19002265;//kernel.BodyActor:2265\n    fps = 60;\n    //$LASTPOS=19002281;//kernel.BodyActor:2281\n    _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());\n  },\n  fiber$applyForce :function _trc_func_19002159_9(_thread,fx,fy,px,py) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b2Vec2;\n    var scale;\n    var fps;\n    \n    //$LASTPOS=19002190;//kernel.BodyActor:2190\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=19002233;//kernel.BodyActor:2233\n    scale = _this.getWorld().scale;\n    //$LASTPOS=19002265;//kernel.BodyActor:2265\n    fps = 60;\n    //$LASTPOS=19002281;//kernel.BodyActor:2281\n    _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());\n    \n    _thread.retVal=_this;return;\n  },\n  applyImpulse :function _trc_func_19002339_10(fx,fy,px,py) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b2Vec2;\n    var scale;\n    var fps;\n    \n    //$LASTPOS=19002372;//kernel.BodyActor:2372\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=19002415;//kernel.BodyActor:2415\n    scale = _this.getWorld().scale;\n    //$LASTPOS=19002447;//kernel.BodyActor:2447\n    fps = 60;\n    //$LASTPOS=19002463;//kernel.BodyActor:2463\n    _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());\n  },\n  fiber$applyImpulse :function _trc_func_19002339_11(_thread,fx,fy,px,py) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b2Vec2;\n    var scale;\n    var fps;\n    \n    //$LASTPOS=19002372;//kernel.BodyActor:2372\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=19002415;//kernel.BodyActor:2415\n    scale = _this.getWorld().scale;\n    //$LASTPOS=19002447;//kernel.BodyActor:2447\n    fps = 60;\n    //$LASTPOS=19002463;//kernel.BodyActor:2463\n    _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());\n    \n    _thread.retVal=_this;return;\n  },\n  applyTorque :function _trc_func_19002524_12(a) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=19002546;//kernel.BodyActor:2546\n    _this.body.ApplyTorque(a);\n  },\n  fiber$applyTorque :function _trc_func_19002524_13(_thread,a) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=19002546;//kernel.BodyActor:2546\n    _this.body.ApplyTorque(a);\n    \n    _thread.retVal=_this;return;\n  },\n  moveBy :function _trc_func_19002569_14(dx,dy) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var pos;\n    \n    //$LASTPOS=19002590;//kernel.BodyActor:2590\n    pos = _this.body.GetPosition();\n    //$LASTPOS=19002622;//kernel.BodyActor:2622\n    pos.x+=dx/_this.scale;\n    //$LASTPOS=19002643;//kernel.BodyActor:2643\n    pos.y+=dy/_this.scale;\n    //$LASTPOS=19002664;//kernel.BodyActor:2664\n    _this.body.SetPosition(pos);\n  },\n  fiber$moveBy :function _trc_func_19002569_15(_thread,dx,dy) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var pos;\n    \n    //$LASTPOS=19002590;//kernel.BodyActor:2590\n    pos = _this.body.GetPosition();\n    //$LASTPOS=19002622;//kernel.BodyActor:2622\n    pos.x+=dx/_this.scale;\n    //$LASTPOS=19002643;//kernel.BodyActor:2643\n    pos.y+=dy/_this.scale;\n    //$LASTPOS=19002664;//kernel.BodyActor:2664\n    _this.body.SetPosition(pos);\n    \n    _thread.retVal=_this;return;\n  },\n  contactTo :function _trc_func_19002689_16(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.allContact(t)[0];\n  },\n  fiber$contactTo :function _trc_func_19002689_17(_thread,t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.allContact(t)[0];return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  die :function _trc_func_19002736_18() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=19002749;//kernel.BodyActor:2749\n    Tonyu.classes.kernel.Actor.prototype.die.apply( _this, []);\n    //$LASTPOS=19002766;//kernel.BodyActor:2766\n    _this.world.DestroyBody(_this.body);\n  },\n  updatePos :function _trc_func_19002793_19() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var scale;\n    var pos;\n    \n    //$LASTPOS=19002812;//kernel.BodyActor:2812\n    if (! _this.body) {\n      return _this;\n    }\n    //$LASTPOS=19002835;//kernel.BodyActor:2835\n    scale = _this.getWorld().scale;\n    //$LASTPOS=19002867;//kernel.BodyActor:2867\n    pos = _this.body.GetPosition();\n    //$LASTPOS=19002899;//kernel.BodyActor:2899\n    _this.x=pos.x*scale;\n    //$LASTPOS=19002918;//kernel.BodyActor:2918\n    _this.y=pos.y*scale;\n    //$LASTPOS=19002937;//kernel.BodyActor:2937\n    _this.rotation=_this.deg(_this.body.GetAngle());\n  },\n  fiber$updatePos :function _trc_func_19002793_20(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var scale;\n    var pos;\n    \n    //$LASTPOS=19002812;//kernel.BodyActor:2812\n    if (! _this.body) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=19002835;//kernel.BodyActor:2835\n    scale = _this.getWorld().scale;\n    //$LASTPOS=19002867;//kernel.BodyActor:2867\n    pos = _this.body.GetPosition();\n    //$LASTPOS=19002899;//kernel.BodyActor:2899\n    _this.x=pos.x*scale;\n    //$LASTPOS=19002918;//kernel.BodyActor:2918\n    _this.y=pos.y*scale;\n    //$LASTPOS=19002937;//kernel.BodyActor:2937\n    _this.rotation=_this.deg(_this.body.GetAngle());\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.BodyActor,{"fullName":"kernel.BodyActor","namespace":"kernel","shortName":"BodyActor","decls":{"methods":{"main":{"nowait":false},"getWorld":{"nowait":false},"onAppear":{"nowait":false},"allContact":{"nowait":false},"applyForce":{"nowait":false},"applyImpulse":{"nowait":false},"applyTorque":{"nowait":false},"moveBy":{"nowait":false},"contactTo":{"nowait":false},"die":{"nowait":true},"updatePos":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Map=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_20000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_20000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_20000041_2(param) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var j;\n    var i;\n    \n    //$LASTPOS=20000060;//kernel.Map:60\n    _this.sx=0;\n    //$LASTPOS=20000071;//kernel.Map:71\n    _this.sy=0;\n    //$LASTPOS=20000082;//kernel.Map:82\n    Tonyu.classes.kernel.Actor.apply( _this, [param]);\n    //$LASTPOS=20000101;//kernel.Map:101\n    _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n    //$LASTPOS=20000173;//kernel.Map:173\n    _this.mapObj=true;\n    //$LASTPOS=20000191;//kernel.Map:191\n    _this.mapTable=[];\n    //$LASTPOS=20000211;//kernel.Map:211\n    _this.mapOnTable=[];\n    //$LASTPOS=20000233;//kernel.Map:233\n    //$LASTPOS=20000237;//kernel.Map:237\n    j = 0;\n    while(j<_this.row) {\n      {\n        //$LASTPOS=20000266;//kernel.Map:266\n        _this.rows=[];\n        //$LASTPOS=20000286;//kernel.Map:286\n        //$LASTPOS=20000290;//kernel.Map:290\n        i = 0;\n        while(i<_this.col) {\n          {\n            //$LASTPOS=20000323;//kernel.Map:323\n            _this.rows.push(- 1);\n          }\n          i++;\n        }\n        //$LASTPOS=20000358;//kernel.Map:358\n        _this.mapTable.push(_this.rows);\n      }\n      j++;\n    }\n    //$LASTPOS=20000391;//kernel.Map:391\n    //$LASTPOS=20000395;//kernel.Map:395\n    j = 0;\n    while(j<_this.row) {\n      {\n        //$LASTPOS=20000424;//kernel.Map:424\n        _this.rows=[];\n        //$LASTPOS=20000444;//kernel.Map:444\n        //$LASTPOS=20000448;//kernel.Map:448\n        i = 0;\n        while(i<_this.col) {\n          {\n            //$LASTPOS=20000481;//kernel.Map:481\n            _this.rows.push(- 1);\n          }\n          i++;\n        }\n        //$LASTPOS=20000516;//kernel.Map:516\n        _this.mapOnTable.push(_this.rows);\n      }\n      j++;\n    }\n    //$LASTPOS=20000616;//kernel.Map:616\n    _this.initMap();\n  },\n  initMap :function _trc_func_20000631_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    var j;\n    \n    //$LASTPOS=20000648;//kernel.Map:648\n    if (! _this.mapData) {\n      return _this;\n    }\n    //$LASTPOS=20000674;//kernel.Map:674\n    //$LASTPOS=20000678;//kernel.Map:678\n    i = 0;\n    while(i<_this.row) {\n      {\n        //$LASTPOS=20000707;//kernel.Map:707\n        //$LASTPOS=20000711;//kernel.Map:711\n        j = 0;\n        while(j<_this.col) {\n          {\n            //$LASTPOS=20000744;//kernel.Map:744\n            _this.set(j,i,_this.mapData[i][j]);\n          }\n          j++;\n        }\n      }\n      i++;\n    }\n    //$LASTPOS=20000791;//kernel.Map:791\n    if (! _this.mapOnData) {\n      return _this;\n    }\n    //$LASTPOS=20000819;//kernel.Map:819\n    //$LASTPOS=20000823;//kernel.Map:823\n    i = 0;\n    while(i<_this.row) {\n      {\n        //$LASTPOS=20000852;//kernel.Map:852\n        //$LASTPOS=20000856;//kernel.Map:856\n        j = 0;\n        while(j<_this.col) {\n          {\n            //$LASTPOS=20000889;//kernel.Map:889\n            _this.setOn(j,i,_this.mapOnData[i][j]);\n          }\n          j++;\n        }\n      }\n      i++;\n    }\n  },\n  fiber$initMap :function _trc_func_20000631_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    var j;\n    \n    //$LASTPOS=20000648;//kernel.Map:648\n    if (! _this.mapData) {\n      _thread.retVal=_this;return;\n      \n    }\n    \n    _thread.enter(function _trc_func_20000631_5(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=20000674;//kernel.Map:674\n          //$LASTPOS=20000678;//kernel.Map:678\n          i = 0;;\n        case 1:\n          if (!(i<_this.row)) { __pc=5; break; }\n          //$LASTPOS=20000707;//kernel.Map:707\n          //$LASTPOS=20000711;//kernel.Map:711\n          j = 0;;\n        case 2:\n          if (!(j<_this.col)) { __pc=4; break; }\n          //$LASTPOS=20000744;//kernel.Map:744\n          _this.fiber$set(_thread, j, i, _this.mapData[i][j]);\n          __pc=3;return;\n        case 3:\n          \n          j++;\n          __pc=2;break;\n        case 4:\n          \n          i++;\n          __pc=1;break;\n        case 5:\n          \n          //$LASTPOS=20000791;//kernel.Map:791\n          if (!(! _this.mapOnData)) { __pc=6; break; }\n          _thread.exit(_this);return;\n        case 6:\n          \n          //$LASTPOS=20000819;//kernel.Map:819\n          //$LASTPOS=20000823;//kernel.Map:823\n          i = 0;;\n        case 7:\n          if (!(i<_this.row)) { __pc=11; break; }\n          //$LASTPOS=20000852;//kernel.Map:852\n          //$LASTPOS=20000856;//kernel.Map:856\n          j = 0;;\n        case 8:\n          if (!(j<_this.col)) { __pc=10; break; }\n          //$LASTPOS=20000889;//kernel.Map:889\n          _this.fiber$setOn(_thread, j, i, _this.mapOnData[i][j]);\n          __pc=9;return;\n        case 9:\n          \n          j++;\n          __pc=8;break;\n        case 10:\n          \n          i++;\n          __pc=7;break;\n        case 11:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  load :function _trc_func_20000939_6(dataFile) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20000961;//kernel.Map:961\n    _this.baseData=_this.file("../maps/").rel(dataFile).obj();\n    //$LASTPOS=20001013;//kernel.Map:1013\n    if (! _this.baseData) {\n      //$LASTPOS=20001027;//kernel.Map:1027\n      _this.baseData=_this.file(dataFile).obj();\n    }\n    //$LASTPOS=20001063;//kernel.Map:1063\n    _this.mapTable=_this.baseData[0];\n    //$LASTPOS=20001090;//kernel.Map:1090\n    _this.mapData=_this.mapTable;\n    //$LASTPOS=20001113;//kernel.Map:1113\n    _this.row=_this.mapTable.length;\n    //$LASTPOS=20001139;//kernel.Map:1139\n    _this.col=_this.mapTable[0].length;\n    //$LASTPOS=20001168;//kernel.Map:1168\n    _this.mapOnTable=_this.baseData[1];\n    //$LASTPOS=20001197;//kernel.Map:1197\n    _this.mapOnData=_this.mapOnTable;\n    //$LASTPOS=20001224;//kernel.Map:1224\n    _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n    //$LASTPOS=20001296;//kernel.Map:1296\n    _this.initMap();\n  },\n  fiber$load :function _trc_func_20000939_7(_thread,dataFile) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=20000961;//kernel.Map:961\n    _this.baseData=_this.file("../maps/").rel(dataFile).obj();\n    //$LASTPOS=20001013;//kernel.Map:1013\n    if (! _this.baseData) {\n      //$LASTPOS=20001027;//kernel.Map:1027\n      _this.baseData=_this.file(dataFile).obj();\n    }\n    //$LASTPOS=20001063;//kernel.Map:1063\n    _this.mapTable=_this.baseData[0];\n    //$LASTPOS=20001090;//kernel.Map:1090\n    _this.mapData=_this.mapTable;\n    //$LASTPOS=20001113;//kernel.Map:1113\n    _this.row=_this.mapTable.length;\n    //$LASTPOS=20001139;//kernel.Map:1139\n    _this.col=_this.mapTable[0].length;\n    //$LASTPOS=20001168;//kernel.Map:1168\n    _this.mapOnTable=_this.baseData[1];\n    //$LASTPOS=20001197;//kernel.Map:1197\n    _this.mapOnData=_this.mapOnTable;\n    //$LASTPOS=20001224;//kernel.Map:1224\n    _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n    \n    _thread.enter(function _trc_func_20000939_8(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=20001296;//kernel.Map:1296\n          _this.fiber$initMap(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  set :function _trc_func_20001311_9(setCol,setRow,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20001339;//kernel.Map:1339\n    if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n      return _this;\n    }\n    //$LASTPOS=20001407;//kernel.Map:1407\n    _this.mapTable[setRow][setCol]=p;\n    //$LASTPOS=20001478;//kernel.Map:1478\n    _this.ctx=_this.buf[0].getContext("2d");\n    //$LASTPOS=20001512;//kernel.Map:1512\n    p=Math.floor(p);\n    //$LASTPOS=20001534;//kernel.Map:1534\n    _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n    //$LASTPOS=20001572;//kernel.Map:1572\n    if (! _this.pImg) {\n      //$LASTPOS=20001594;//kernel.Map:1594\n      _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      return _this;\n      \n    }\n    //$LASTPOS=20001695;//kernel.Map:1695\n    _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n    //$LASTPOS=20001772;//kernel.Map:1772\n    _this.ctx.save();\n    //$LASTPOS=20001789;//kernel.Map:1789\n    _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n    //$LASTPOS=20001933;//kernel.Map:1933\n    _this.ctx.restore();\n  },\n  fiber$set :function _trc_func_20001311_10(_thread,setCol,setRow,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=20001339;//kernel.Map:1339\n    if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=20001407;//kernel.Map:1407\n    _this.mapTable[setRow][setCol]=p;\n    //$LASTPOS=20001478;//kernel.Map:1478\n    _this.ctx=_this.buf[0].getContext("2d");\n    //$LASTPOS=20001512;//kernel.Map:1512\n    p=Math.floor(p);\n    //$LASTPOS=20001534;//kernel.Map:1534\n    _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n    //$LASTPOS=20001572;//kernel.Map:1572\n    if (! _this.pImg) {\n      //$LASTPOS=20001594;//kernel.Map:1594\n      _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      _thread.retVal=_this;return;\n      \n      \n    }\n    //$LASTPOS=20001695;//kernel.Map:1695\n    _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n    //$LASTPOS=20001772;//kernel.Map:1772\n    _this.ctx.save();\n    //$LASTPOS=20001789;//kernel.Map:1789\n    _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n    //$LASTPOS=20001933;//kernel.Map:1933\n    _this.ctx.restore();\n    \n    _thread.retVal=_this;return;\n  },\n  setOn :function _trc_func_20001952_11(setCol,setRow,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20001982;//kernel.Map:1982\n    if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n      return _this;\n    }\n    //$LASTPOS=20002050;//kernel.Map:2050\n    _this.set(setCol,setRow,_this.mapTable[setRow][setCol]);\n    //$LASTPOS=20002100;//kernel.Map:2100\n    _this.mapOnTable[setRow][setCol]=p;\n    //$LASTPOS=20002135;//kernel.Map:2135\n    _this.ctx=_this.buf[0].getContext("2d");\n    //$LASTPOS=20002169;//kernel.Map:2169\n    p=Math.floor(p);\n    //$LASTPOS=20002191;//kernel.Map:2191\n    _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n    //$LASTPOS=20002229;//kernel.Map:2229\n    if (! _this.pImg) {\n      return _this;\n    }\n    //$LASTPOS=20002253;//kernel.Map:2253\n    _this.ctx.save();\n    //$LASTPOS=20002270;//kernel.Map:2270\n    _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n    //$LASTPOS=20002414;//kernel.Map:2414\n    _this.ctx.restore();\n  },\n  fiber$setOn :function _trc_func_20001952_12(_thread,setCol,setRow,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=20001982;//kernel.Map:1982\n    if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n      _thread.retVal=_this;return;\n      \n    }\n    \n    _thread.enter(function _trc_func_20001952_13(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=20002050;//kernel.Map:2050\n          _this.fiber$set(_thread, setCol, setRow, _this.mapTable[setRow][setCol]);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=20002100;//kernel.Map:2100\n          _this.mapOnTable[setRow][setCol]=p;\n          //$LASTPOS=20002135;//kernel.Map:2135\n          _this.ctx=_this.buf[0].getContext("2d");\n          //$LASTPOS=20002169;//kernel.Map:2169\n          p=Math.floor(p);\n          //$LASTPOS=20002191;//kernel.Map:2191\n          _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n          //$LASTPOS=20002229;//kernel.Map:2229\n          if (!(! _this.pImg)) { __pc=2; break; }\n          _thread.exit(_this);return;\n        case 2:\n          \n          //$LASTPOS=20002253;//kernel.Map:2253\n          _this.ctx.save();\n          //$LASTPOS=20002270;//kernel.Map:2270\n          _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n          //$LASTPOS=20002414;//kernel.Map:2414\n          _this.ctx.restore();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  setOnAt :function _trc_func_20002433_14(setX,setY,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20002461;//kernel.Map:2461\n    _this.setOn(Math.floor(setX/_this.chipWidth),Math.floor(setY/_this.chipHeight),p);\n  },\n  fiber$setOnAt :function _trc_func_20002433_15(_thread,setX,setY,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_20002433_16(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=20002461;//kernel.Map:2461\n          _this.fiber$setOn(_thread, Math.floor(setX/_this.chipWidth), Math.floor(setY/_this.chipHeight), p);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  setAt :function _trc_func_20002530_17(setX,setY,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20002556;//kernel.Map:2556\n    _this.set(Math.floor(setX/_this.chipWidth),Math.floor(setY/_this.chipHeight),p);\n  },\n  fiber$setAt :function _trc_func_20002530_18(_thread,setX,setY,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_20002530_19(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=20002556;//kernel.Map:2556\n          _this.fiber$set(_thread, Math.floor(setX/_this.chipWidth), Math.floor(setY/_this.chipHeight), p);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  get :function _trc_func_20002623_20(getCol,getRow) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20002649;//kernel.Map:2649\n    if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n      return _this.mapTable[getRow][getCol];\n    }\n    return - 1;\n  },\n  fiber$get :function _trc_func_20002623_21(_thread,getCol,getRow) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=20002649;//kernel.Map:2649\n    if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n      _thread.retVal=_this.mapTable[getRow][getCol];return;\n      \n    }\n    _thread.retVal=- 1;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getAt :function _trc_func_20002757_22(getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.get(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));\n  },\n  fiber$getAt :function _trc_func_20002757_23(_thread,getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.get(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getOn :function _trc_func_20002853_24(getCol,getRow) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20002881;//kernel.Map:2881\n    if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n      return _this.mapOnTable[getRow][getCol];\n    }\n    return - 1;\n  },\n  fiber$getOn :function _trc_func_20002853_25(_thread,getCol,getRow) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=20002881;//kernel.Map:2881\n    if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n      _thread.retVal=_this.mapOnTable[getRow][getCol];return;\n      \n    }\n    _thread.retVal=- 1;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getOnAt :function _trc_func_20002991_26(getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.getOn(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));\n  },\n  fiber$getOnAt :function _trc_func_20002991_27(_thread,getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.getOn(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  scrollTo :function _trc_func_20003091_28(scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20003124;//kernel.Map:3124\n    _this.sx=- scrollX;\n    //$LASTPOS=20003142;//kernel.Map:3142\n    _this.sy=- scrollY;\n  },\n  fiber$scrollTo :function _trc_func_20003091_29(_thread,scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=20003124;//kernel.Map:3124\n    _this.sx=- scrollX;\n    //$LASTPOS=20003142;//kernel.Map:3142\n    _this.sy=- scrollY;\n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_20003159_30(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=20003177;//kernel.Map:3177\n    _this.pImg=_this.buf[0];\n    //$LASTPOS=20003195;//kernel.Map:3195\n    ctx.save();\n    //$LASTPOS=20003212;//kernel.Map:3212\n    ctx.drawImage(_this.pImg,0,0,_this.col*_this.chipWidth,_this.row*_this.chipHeight,_this.sx,_this.sy,_this.col*_this.chipWidth,_this.row*_this.chipHeight);\n    //$LASTPOS=20003324;//kernel.Map:3324\n    ctx.restore();\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Map,{"fullName":"kernel.Map","namespace":"kernel","shortName":"Map","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"initMap":{"nowait":false},"load":{"nowait":false},"set":{"nowait":false},"setOn":{"nowait":false},"setOnAt":{"nowait":false},"setAt":{"nowait":false},"get":{"nowait":false},"getAt":{"nowait":false},"getOn":{"nowait":false},"getOnAt":{"nowait":false},"scrollTo":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.MapEditor=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_21000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    var j;\n    \n    //$LASTPOS=21000032;//kernel.MapEditor:32\n    _this.loadMode=false;\n    //$LASTPOS=21000049;//kernel.MapEditor:49\n    _this.print("Load Data?: Y or N");\n    //$LASTPOS=21000079;//kernel.MapEditor:79\n    while (true) {\n      //$LASTPOS=21000097;//kernel.MapEditor:97\n      if (_this.getkey("y")>0) {\n        //$LASTPOS=21000125;//kernel.MapEditor:125\n        _this.loadMode=true;\n        break;\n        \n        \n      }\n      //$LASTPOS=21000168;//kernel.MapEditor:168\n      if (_this.getkey("n")>0) {\n        //$LASTPOS=21000196;//kernel.MapEditor:196\n        _this.loadMode=false;\n        break;\n        \n        \n      }\n      //$LASTPOS=21000240;//kernel.MapEditor:240\n      _this.update();\n      \n    }\n    //$LASTPOS=21000254;//kernel.MapEditor:254\n    if (_this.loadMode) {\n      //$LASTPOS=21000273;//kernel.MapEditor:273\n      _this.fileName=prompt("Input json file (*.json)","map.json");\n      //$LASTPOS=21000334;//kernel.MapEditor:334\n      if (_this.fileName) {\n        //$LASTPOS=21000357;//kernel.MapEditor:357\n        _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);\n        \n      }\n      //$LASTPOS=21000413;//kernel.MapEditor:413\n      if (_this.mapDataFile.obj()) {\n        //$LASTPOS=21000445;//kernel.MapEditor:445\n        _this.baseData=_this.mapDataFile.obj();\n        \n      } else {\n        //$LASTPOS=21000494;//kernel.MapEditor:494\n        _this.mapDataFile=_this.file(_this.fileName);\n        //$LASTPOS=21000531;//kernel.MapEditor:531\n        if (_this.mapDataFile.obj()) {\n          //$LASTPOS=21000567;//kernel.MapEditor:567\n          _this.baseData=_this.mapDataFile.obj();\n          \n        }\n        \n      }\n      //$LASTPOS=21000618;//kernel.MapEditor:618\n      if (_this.baseData==undefined) {\n        //$LASTPOS=21000652;//kernel.MapEditor:652\n        _this.print("Load failed");\n        //$LASTPOS=21000683;//kernel.MapEditor:683\n        _this.loadMode=false;\n        \n      } else {\n        //$LASTPOS=21000710;//kernel.MapEditor:710\n        if (_this.baseData[0]&&_this.baseData[1]) {\n          //$LASTPOS=21000751;//kernel.MapEditor:751\n          _this.mapData=_this.baseData[0];\n          //$LASTPOS=21000781;//kernel.MapEditor:781\n          _this.mapOnData=_this.baseData[1];\n          \n        }\n      }\n      \n    }\n    //$LASTPOS=21000815;//kernel.MapEditor:815\n    _this.update();\n    //$LASTPOS=21001093;//kernel.MapEditor:1093\n    if (! _this.loadMode) {\n      //$LASTPOS=21001113;//kernel.MapEditor:1113\n      _this.row=prompt("input row");\n      //$LASTPOS=21001143;//kernel.MapEditor:1143\n      _this.update();\n      //$LASTPOS=21001158;//kernel.MapEditor:1158\n      _this.col=prompt("input col");\n      //$LASTPOS=21001188;//kernel.MapEditor:1188\n      _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});\n      //$LASTPOS=21001238;//kernel.MapEditor:1238\n      _this.panel.x=_this.panel.width/2+10;\n      //$LASTPOS=21001269;//kernel.MapEditor:1269\n      _this.panel.y=_this.panel.height/2;\n      //$LASTPOS=21001298;//kernel.MapEditor:1298\n      _this.panel.setFillStyle("cyan");\n      //$LASTPOS=21001331;//kernel.MapEditor:1331\n      _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n      //$LASTPOS=21001382;//kernel.MapEditor:1382\n      Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});\n      \n    } else {\n      //$LASTPOS=21001445;//kernel.MapEditor:1445\n      if (! _this.mapOnData) {\n        //$LASTPOS=21001470;//kernel.MapEditor:1470\n        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});\n        \n      } else {\n        //$LASTPOS=21001582;//kernel.MapEditor:1582\n        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});\n        \n      }\n      //$LASTPOS=21001695;//kernel.MapEditor:1695\n      _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});\n      //$LASTPOS=21001766;//kernel.MapEditor:1766\n      _this.panel.x=_this.panel.width/2;\n      //$LASTPOS=21001794;//kernel.MapEditor:1794\n      _this.panel.y=_this.panel.height/2;\n      //$LASTPOS=21001823;//kernel.MapEditor:1823\n      _this.panel.setFillStyle("cyan");\n      //$LASTPOS=21001856;//kernel.MapEditor:1856\n      _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n      \n    }\n    //$LASTPOS=21001906;//kernel.MapEditor:1906\n    Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});\n    //$LASTPOS=21001961;//kernel.MapEditor:1961\n    _this.counter=0;\n    //$LASTPOS=21001973;//kernel.MapEditor:1973\n    //$LASTPOS=21001977;//kernel.MapEditor:1977\n    i = 0;\n    while(i<16) {\n      {\n        //$LASTPOS=21002001;//kernel.MapEditor:2001\n        //$LASTPOS=21002005;//kernel.MapEditor:2005\n        j = 0;\n        while(j<8) {\n          {\n            //$LASTPOS=21002032;//kernel.MapEditor:2032\n            Tonyu.globals.$mp.set(j,i,Tonyu.globals.$pat_mapchip+_this.counter);\n            //$LASTPOS=21002076;//kernel.MapEditor:2076\n            _this.counter++;\n          }\n          j++;\n        }\n      }\n      i++;\n    }\n    //$LASTPOS=21002098;//kernel.MapEditor:2098\n    _this.mode="get";\n    //$LASTPOS=21002111;//kernel.MapEditor:2111\n    _this.prevMode="set";\n    //$LASTPOS=21002128;//kernel.MapEditor:2128\n    _this.mapp=0;\n    //$LASTPOS=21002137;//kernel.MapEditor:2137\n    _this.mx=0;\n    //$LASTPOS=21002144;//kernel.MapEditor:2144\n    _this.my=0;\n    //$LASTPOS=21002151;//kernel.MapEditor:2151\n    _this.chipX=0;\n    //$LASTPOS=21002161;//kernel.MapEditor:2161\n    _this.chipY=0;\n    //$LASTPOS=21002171;//kernel.MapEditor:2171\n    _this.x=Tonyu.globals.$screenWidth-16;\n    //$LASTPOS=21002191;//kernel.MapEditor:2191\n    _this.y=Tonyu.globals.$screenHeight-16;\n    //$LASTPOS=21002212;//kernel.MapEditor:2212\n    while (true) {\n      //$LASTPOS=21002230;//kernel.MapEditor:2230\n      _this.p=_this.mapp;\n      //$LASTPOS=21002243;//kernel.MapEditor:2243\n      if (_this.getkey("e")==1) {\n        //$LASTPOS=21002272;//kernel.MapEditor:2272\n        Tonyu.globals.$mp.scrollTo(1000,1000);\n        //$LASTPOS=21002306;//kernel.MapEditor:2306\n        _this.mode="erase";\n        //$LASTPOS=21002329;//kernel.MapEditor:2329\n        _this.print(_this.mode+" mode");\n        \n      }\n      //$LASTPOS=21002362;//kernel.MapEditor:2362\n      if (_this.getkey("s")==1) {\n        //$LASTPOS=21002391;//kernel.MapEditor:2391\n        Tonyu.globals.$mp.scrollTo(1000,1000);\n        //$LASTPOS=21002425;//kernel.MapEditor:2425\n        if (_this.mode=="set") {\n          //$LASTPOS=21002455;//kernel.MapEditor:2455\n          _this.mode="setOn";\n          \n        } else {\n          //$LASTPOS=21002498;//kernel.MapEditor:2498\n          _this.mode="set";\n          \n        }\n        //$LASTPOS=21002530;//kernel.MapEditor:2530\n        _this.print(_this.mode+" mode");\n        \n      }\n      //$LASTPOS=21002563;//kernel.MapEditor:2563\n      if (_this.getkey("o")==1) {\n        //$LASTPOS=21002592;//kernel.MapEditor:2592\n        Tonyu.globals.$mp.scrollTo(1000,1000);\n        //$LASTPOS=21002626;//kernel.MapEditor:2626\n        _this.mode="setOn";\n        \n      }\n      //$LASTPOS=21002652;//kernel.MapEditor:2652\n      if (_this.getkey("g")==1) {\n        //$LASTPOS=21002681;//kernel.MapEditor:2681\n        if (_this.mode!="get") {\n          //$LASTPOS=21002711;//kernel.MapEditor:2711\n          _this.prevMode=_this.mode;\n          //$LASTPOS=21002739;//kernel.MapEditor:2739\n          Tonyu.globals.$mp.scrollTo(0,0);\n          //$LASTPOS=21002771;//kernel.MapEditor:2771\n          _this.mode="get";\n          //$LASTPOS=21002796;//kernel.MapEditor:2796\n          _this.chipX=0;\n          //$LASTPOS=21002818;//kernel.MapEditor:2818\n          _this.chipY=0;\n          \n        } else {\n          //$LASTPOS=21002856;//kernel.MapEditor:2856\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=21002894;//kernel.MapEditor:2894\n          _this.mode=_this.prevMode;\n          \n        }\n        //$LASTPOS=21002929;//kernel.MapEditor:2929\n        _this.print(_this.mode+" mode");\n        \n      }\n      //$LASTPOS=21002962;//kernel.MapEditor:2962\n      if (_this.getkey("p")==1) {\n        //$LASTPOS=21003006;//kernel.MapEditor:3006\n        _this.saveFileName=prompt("input json file(*.json)","map.json");\n        //$LASTPOS=21003495;//kernel.MapEditor:3495\n        _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);\n        //$LASTPOS=21003553;//kernel.MapEditor:3553\n        _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];\n        //$LASTPOS=21003668;//kernel.MapEditor:3668\n        _this.saveDataFile.obj(_this.data);\n        //$LASTPOS=21003701;//kernel.MapEditor:3701\n        _this.print(_this.saveFileName+" Saved");\n        \n      }\n      //$LASTPOS=21003793;//kernel.MapEditor:3793\n      if (_this.getkey("c")==1) {\n        //$LASTPOS=21003822;//kernel.MapEditor:3822\n        Tonyu.globals.$mp.scrollTo(1000,1000);\n        //$LASTPOS=21003856;//kernel.MapEditor:3856\n        _this.mode="spuit";\n        //$LASTPOS=21003879;//kernel.MapEditor:3879\n        _this.print(_this.mode+" mode");\n        \n      }\n      //$LASTPOS=21003912;//kernel.MapEditor:3912\n      if (_this.mode!="get") {\n        //$LASTPOS=21003938;//kernel.MapEditor:3938\n        if (_this.getkey("left")>0) {\n          //$LASTPOS=21003959;//kernel.MapEditor:3959\n          _this.mx=_this.mx+8;\n        }\n        //$LASTPOS=21003977;//kernel.MapEditor:3977\n        if (_this.getkey("right")>0) {\n          //$LASTPOS=21003999;//kernel.MapEditor:3999\n          _this.mx=_this.mx-8;\n        }\n        //$LASTPOS=21004017;//kernel.MapEditor:4017\n        if (_this.getkey("up")>0) {\n          //$LASTPOS=21004036;//kernel.MapEditor:4036\n          _this.my=_this.my+8;\n        }\n        //$LASTPOS=21004054;//kernel.MapEditor:4054\n        if (_this.getkey("down")>0) {\n          //$LASTPOS=21004075;//kernel.MapEditor:4075\n          _this.my=_this.my-8;\n        }\n        //$LASTPOS=21004093;//kernel.MapEditor:4093\n        Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n        \n      } else {\n        //$LASTPOS=21004136;//kernel.MapEditor:4136\n        if (_this.getkey("left")>0) {\n          //$LASTPOS=21004157;//kernel.MapEditor:4157\n          _this.chipX=_this.chipX+8;\n        }\n        //$LASTPOS=21004181;//kernel.MapEditor:4181\n        if (_this.getkey("right")>0) {\n          //$LASTPOS=21004203;//kernel.MapEditor:4203\n          _this.chipX=_this.chipX-8;\n        }\n        //$LASTPOS=21004227;//kernel.MapEditor:4227\n        if (_this.getkey("up")>0) {\n          //$LASTPOS=21004246;//kernel.MapEditor:4246\n          _this.chipY=_this.chipY+8;\n        }\n        //$LASTPOS=21004270;//kernel.MapEditor:4270\n        if (_this.getkey("down")>0) {\n          //$LASTPOS=21004291;//kernel.MapEditor:4291\n          _this.chipY=_this.chipY-8;\n        }\n        //$LASTPOS=21004315;//kernel.MapEditor:4315\n        Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);\n        \n      }\n      //$LASTPOS=21004354;//kernel.MapEditor:4354\n      _this.panel.x=_this.panel.width/2-_this.mx;\n      //$LASTPOS=21004385;//kernel.MapEditor:4385\n      _this.panel.y=_this.panel.height/2-_this.my;\n      //$LASTPOS=21004417;//kernel.MapEditor:4417\n      if (_this.mode=="set"&&_this.getkey(1)>0) {\n        //$LASTPOS=21004458;//kernel.MapEditor:4458\n        Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n        //$LASTPOS=21004507;//kernel.MapEditor:4507\n        Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n        \n      } else {\n        //$LASTPOS=21004558;//kernel.MapEditor:4558\n        if (_this.mode=="erase"&&_this.getkey(1)>0) {\n          //$LASTPOS=21004601;//kernel.MapEditor:4601\n          Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n          \n        } else {\n          //$LASTPOS=21004650;//kernel.MapEditor:4650\n          if (_this.mode=="get"&&_this.getkey(1)>0) {\n            //$LASTPOS=21004691;//kernel.MapEditor:4691\n            _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);\n            //$LASTPOS=21004745;//kernel.MapEditor:4745\n            _this.mode=_this.prevMode;\n            //$LASTPOS=21004769;//kernel.MapEditor:4769\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=21004803;//kernel.MapEditor:4803\n            _this.print(_this.mode+" mode");\n            //$LASTPOS=21004833;//kernel.MapEditor:4833\n            _this.updateEx(10);\n            \n          } else {\n            //$LASTPOS=21004858;//kernel.MapEditor:4858\n            if (_this.mode=="setOn"&&_this.getkey(1)>0) {\n              //$LASTPOS=21004901;//kernel.MapEditor:4901\n              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n              \n            } else {\n              //$LASTPOS=21004954;//kernel.MapEditor:4954\n              if (_this.mode=="spuit"&&_this.getkey(1)>0) {\n                //$LASTPOS=21004997;//kernel.MapEditor:4997\n                _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);\n                //$LASTPOS=21005046;//kernel.MapEditor:5046\n                _this.mode="set";\n                //$LASTPOS=21005067;//kernel.MapEditor:5067\n                _this.print(_this.mode+" mode");\n                //$LASTPOS=21005097;//kernel.MapEditor:5097\n                _this.updateEx(10);\n                \n              }\n            }\n          }\n        }\n      }\n      //$LASTPOS=21005123;//kernel.MapEditor:5123\n      _this.update();\n      \n    }\n  },\n  fiber$main :function _trc_func_21000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    var j;\n    \n    //$LASTPOS=21000032;//kernel.MapEditor:32\n    _this.loadMode=false;\n    //$LASTPOS=21000049;//kernel.MapEditor:49\n    _this.print("Load Data?: Y or N");\n    \n    _thread.enter(function _trc_func_21000000_2(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=21000079;//kernel.MapEditor:79\n        case 1:\n          //$LASTPOS=21000097;//kernel.MapEditor:97\n          if (!(_this.getkey("y")>0)) { __pc=2; break; }\n          //$LASTPOS=21000125;//kernel.MapEditor:125\n          _this.loadMode=true;\n          __pc=5; break;\n          \n        case 2:\n          \n          //$LASTPOS=21000168;//kernel.MapEditor:168\n          if (!(_this.getkey("n")>0)) { __pc=3; break; }\n          //$LASTPOS=21000196;//kernel.MapEditor:196\n          _this.loadMode=false;\n          __pc=5; break;\n          \n        case 3:\n          \n          //$LASTPOS=21000240;//kernel.MapEditor:240\n          _this.fiber$update(_thread);\n          __pc=4;return;\n        case 4:\n          \n          __pc=1;break;\n        case 5:\n          \n          //$LASTPOS=21000254;//kernel.MapEditor:254\n          if (!(_this.loadMode)) { __pc=9; break; }\n          //$LASTPOS=21000273;//kernel.MapEditor:273\n          _this.fileName=prompt("Input json file (*.json)","map.json");\n          //$LASTPOS=21000334;//kernel.MapEditor:334\n          if (_this.fileName) {\n            //$LASTPOS=21000357;//kernel.MapEditor:357\n            _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);\n            \n          }\n          //$LASTPOS=21000413;//kernel.MapEditor:413\n          if (!(_this.mapDataFile.obj())) { __pc=6; break; }\n          {\n            //$LASTPOS=21000445;//kernel.MapEditor:445\n            _this.baseData=_this.mapDataFile.obj();\n          }\n          __pc=8;break;\n        case 6:\n          //$LASTPOS=21000494;//kernel.MapEditor:494\n          _this.fiber$file(_thread, _this.fileName);\n          __pc=7;return;\n        case 7:\n          _this.mapDataFile=_thread.retVal;\n          \n          //$LASTPOS=21000531;//kernel.MapEditor:531\n          if (_this.mapDataFile.obj()) {\n            //$LASTPOS=21000567;//kernel.MapEditor:567\n            _this.baseData=_this.mapDataFile.obj();\n            \n          }\n        case 8:\n          \n          //$LASTPOS=21000618;//kernel.MapEditor:618\n          if (_this.baseData==undefined) {\n            //$LASTPOS=21000652;//kernel.MapEditor:652\n            _this.print("Load failed");\n            //$LASTPOS=21000683;//kernel.MapEditor:683\n            _this.loadMode=false;\n            \n          } else {\n            //$LASTPOS=21000710;//kernel.MapEditor:710\n            if (_this.baseData[0]&&_this.baseData[1]) {\n              //$LASTPOS=21000751;//kernel.MapEditor:751\n              _this.mapData=_this.baseData[0];\n              //$LASTPOS=21000781;//kernel.MapEditor:781\n              _this.mapOnData=_this.baseData[1];\n              \n            }\n          }\n        case 9:\n          \n          //$LASTPOS=21000815;//kernel.MapEditor:815\n          _this.fiber$update(_thread);\n          __pc=10;return;\n        case 10:\n          \n          //$LASTPOS=21001093;//kernel.MapEditor:1093\n          if (!(! _this.loadMode)) { __pc=12; break; }\n          //$LASTPOS=21001113;//kernel.MapEditor:1113\n          _this.row=prompt("input row");\n          //$LASTPOS=21001143;//kernel.MapEditor:1143\n          _this.fiber$update(_thread);\n          __pc=11;return;\n        case 11:\n          \n          //$LASTPOS=21001158;//kernel.MapEditor:1158\n          _this.col=prompt("input col");\n          //$LASTPOS=21001188;//kernel.MapEditor:1188\n          _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});\n          //$LASTPOS=21001238;//kernel.MapEditor:1238\n          _this.panel.x=_this.panel.width/2+10;\n          //$LASTPOS=21001269;//kernel.MapEditor:1269\n          _this.panel.y=_this.panel.height/2;\n          //$LASTPOS=21001298;//kernel.MapEditor:1298\n          _this.panel.setFillStyle("cyan");\n          //$LASTPOS=21001331;//kernel.MapEditor:1331\n          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n          //$LASTPOS=21001382;//kernel.MapEditor:1382\n          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});\n          __pc=13;break;\n        case 12:\n          {\n            //$LASTPOS=21001445;//kernel.MapEditor:1445\n            if (! _this.mapOnData) {\n              //$LASTPOS=21001470;//kernel.MapEditor:1470\n              Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});\n              \n            } else {\n              //$LASTPOS=21001582;//kernel.MapEditor:1582\n              Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});\n              \n            }\n            //$LASTPOS=21001695;//kernel.MapEditor:1695\n            _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});\n            //$LASTPOS=21001766;//kernel.MapEditor:1766\n            _this.panel.x=_this.panel.width/2;\n            //$LASTPOS=21001794;//kernel.MapEditor:1794\n            _this.panel.y=_this.panel.height/2;\n            //$LASTPOS=21001823;//kernel.MapEditor:1823\n            _this.panel.setFillStyle("cyan");\n            //$LASTPOS=21001856;//kernel.MapEditor:1856\n            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n          }\n        case 13:\n          \n          //$LASTPOS=21001906;//kernel.MapEditor:1906\n          Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});\n          //$LASTPOS=21001961;//kernel.MapEditor:1961\n          _this.counter=0;\n          //$LASTPOS=21001973;//kernel.MapEditor:1973\n          //$LASTPOS=21001977;//kernel.MapEditor:1977\n          i = 0;\n          while(i<16) {\n            {\n              //$LASTPOS=21002001;//kernel.MapEditor:2001\n              //$LASTPOS=21002005;//kernel.MapEditor:2005\n              j = 0;\n              while(j<8) {\n                {\n                  //$LASTPOS=21002032;//kernel.MapEditor:2032\n                  Tonyu.globals.$mp.set(j,i,Tonyu.globals.$pat_mapchip+_this.counter);\n                  //$LASTPOS=21002076;//kernel.MapEditor:2076\n                  _this.counter++;\n                }\n                j++;\n              }\n            }\n            i++;\n          }\n          //$LASTPOS=21002098;//kernel.MapEditor:2098\n          _this.mode="get";\n          //$LASTPOS=21002111;//kernel.MapEditor:2111\n          _this.prevMode="set";\n          //$LASTPOS=21002128;//kernel.MapEditor:2128\n          _this.mapp=0;\n          //$LASTPOS=21002137;//kernel.MapEditor:2137\n          _this.mx=0;\n          //$LASTPOS=21002144;//kernel.MapEditor:2144\n          _this.my=0;\n          //$LASTPOS=21002151;//kernel.MapEditor:2151\n          _this.chipX=0;\n          //$LASTPOS=21002161;//kernel.MapEditor:2161\n          _this.chipY=0;\n          //$LASTPOS=21002171;//kernel.MapEditor:2171\n          _this.x=Tonyu.globals.$screenWidth-16;\n          //$LASTPOS=21002191;//kernel.MapEditor:2191\n          _this.y=Tonyu.globals.$screenHeight-16;\n          //$LASTPOS=21002212;//kernel.MapEditor:2212\n        case 14:\n          //$LASTPOS=21002230;//kernel.MapEditor:2230\n          _this.p=_this.mapp;\n          //$LASTPOS=21002243;//kernel.MapEditor:2243\n          if (_this.getkey("e")==1) {\n            //$LASTPOS=21002272;//kernel.MapEditor:2272\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=21002306;//kernel.MapEditor:2306\n            _this.mode="erase";\n            //$LASTPOS=21002329;//kernel.MapEditor:2329\n            _this.print(_this.mode+" mode");\n            \n          }\n          //$LASTPOS=21002362;//kernel.MapEditor:2362\n          if (_this.getkey("s")==1) {\n            //$LASTPOS=21002391;//kernel.MapEditor:2391\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=21002425;//kernel.MapEditor:2425\n            if (_this.mode=="set") {\n              //$LASTPOS=21002455;//kernel.MapEditor:2455\n              _this.mode="setOn";\n              \n            } else {\n              //$LASTPOS=21002498;//kernel.MapEditor:2498\n              _this.mode="set";\n              \n            }\n            //$LASTPOS=21002530;//kernel.MapEditor:2530\n            _this.print(_this.mode+" mode");\n            \n          }\n          //$LASTPOS=21002563;//kernel.MapEditor:2563\n          if (_this.getkey("o")==1) {\n            //$LASTPOS=21002592;//kernel.MapEditor:2592\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=21002626;//kernel.MapEditor:2626\n            _this.mode="setOn";\n            \n          }\n          //$LASTPOS=21002652;//kernel.MapEditor:2652\n          if (_this.getkey("g")==1) {\n            //$LASTPOS=21002681;//kernel.MapEditor:2681\n            if (_this.mode!="get") {\n              //$LASTPOS=21002711;//kernel.MapEditor:2711\n              _this.prevMode=_this.mode;\n              //$LASTPOS=21002739;//kernel.MapEditor:2739\n              Tonyu.globals.$mp.scrollTo(0,0);\n              //$LASTPOS=21002771;//kernel.MapEditor:2771\n              _this.mode="get";\n              //$LASTPOS=21002796;//kernel.MapEditor:2796\n              _this.chipX=0;\n              //$LASTPOS=21002818;//kernel.MapEditor:2818\n              _this.chipY=0;\n              \n            } else {\n              //$LASTPOS=21002856;//kernel.MapEditor:2856\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=21002894;//kernel.MapEditor:2894\n              _this.mode=_this.prevMode;\n              \n            }\n            //$LASTPOS=21002929;//kernel.MapEditor:2929\n            _this.print(_this.mode+" mode");\n            \n          }\n          //$LASTPOS=21002962;//kernel.MapEditor:2962\n          if (_this.getkey("p")==1) {\n            //$LASTPOS=21003006;//kernel.MapEditor:3006\n            _this.saveFileName=prompt("input json file(*.json)","map.json");\n            //$LASTPOS=21003495;//kernel.MapEditor:3495\n            _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);\n            //$LASTPOS=21003553;//kernel.MapEditor:3553\n            _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];\n            //$LASTPOS=21003668;//kernel.MapEditor:3668\n            _this.saveDataFile.obj(_this.data);\n            //$LASTPOS=21003701;//kernel.MapEditor:3701\n            _this.print(_this.saveFileName+" Saved");\n            \n          }\n          //$LASTPOS=21003793;//kernel.MapEditor:3793\n          if (_this.getkey("c")==1) {\n            //$LASTPOS=21003822;//kernel.MapEditor:3822\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=21003856;//kernel.MapEditor:3856\n            _this.mode="spuit";\n            //$LASTPOS=21003879;//kernel.MapEditor:3879\n            _this.print(_this.mode+" mode");\n            \n          }\n          //$LASTPOS=21003912;//kernel.MapEditor:3912\n          if (_this.mode!="get") {\n            //$LASTPOS=21003938;//kernel.MapEditor:3938\n            if (_this.getkey("left")>0) {\n              //$LASTPOS=21003959;//kernel.MapEditor:3959\n              _this.mx=_this.mx+8;\n            }\n            //$LASTPOS=21003977;//kernel.MapEditor:3977\n            if (_this.getkey("right")>0) {\n              //$LASTPOS=21003999;//kernel.MapEditor:3999\n              _this.mx=_this.mx-8;\n            }\n            //$LASTPOS=21004017;//kernel.MapEditor:4017\n            if (_this.getkey("up")>0) {\n              //$LASTPOS=21004036;//kernel.MapEditor:4036\n              _this.my=_this.my+8;\n            }\n            //$LASTPOS=21004054;//kernel.MapEditor:4054\n            if (_this.getkey("down")>0) {\n              //$LASTPOS=21004075;//kernel.MapEditor:4075\n              _this.my=_this.my-8;\n            }\n            //$LASTPOS=21004093;//kernel.MapEditor:4093\n            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n            \n          } else {\n            //$LASTPOS=21004136;//kernel.MapEditor:4136\n            if (_this.getkey("left")>0) {\n              //$LASTPOS=21004157;//kernel.MapEditor:4157\n              _this.chipX=_this.chipX+8;\n            }\n            //$LASTPOS=21004181;//kernel.MapEditor:4181\n            if (_this.getkey("right")>0) {\n              //$LASTPOS=21004203;//kernel.MapEditor:4203\n              _this.chipX=_this.chipX-8;\n            }\n            //$LASTPOS=21004227;//kernel.MapEditor:4227\n            if (_this.getkey("up")>0) {\n              //$LASTPOS=21004246;//kernel.MapEditor:4246\n              _this.chipY=_this.chipY+8;\n            }\n            //$LASTPOS=21004270;//kernel.MapEditor:4270\n            if (_this.getkey("down")>0) {\n              //$LASTPOS=21004291;//kernel.MapEditor:4291\n              _this.chipY=_this.chipY-8;\n            }\n            //$LASTPOS=21004315;//kernel.MapEditor:4315\n            Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);\n            \n          }\n          //$LASTPOS=21004354;//kernel.MapEditor:4354\n          _this.panel.x=_this.panel.width/2-_this.mx;\n          //$LASTPOS=21004385;//kernel.MapEditor:4385\n          _this.panel.y=_this.panel.height/2-_this.my;\n          //$LASTPOS=21004417;//kernel.MapEditor:4417\n          if (!(_this.mode=="set"&&_this.getkey(1)>0)) { __pc=15; break; }\n          {\n            //$LASTPOS=21004458;//kernel.MapEditor:4458\n            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n            //$LASTPOS=21004507;//kernel.MapEditor:4507\n            Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n          }\n          __pc=25;break;\n        case 15:\n          //$LASTPOS=21004558;//kernel.MapEditor:4558\n          if (!(_this.mode=="erase"&&_this.getkey(1)>0)) { __pc=16; break; }\n          {\n            //$LASTPOS=21004601;//kernel.MapEditor:4601\n            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n          }\n          __pc=24;break;\n        case 16:\n          //$LASTPOS=21004650;//kernel.MapEditor:4650\n          if (!(_this.mode=="get"&&_this.getkey(1)>0)) { __pc=18; break; }\n          //$LASTPOS=21004691;//kernel.MapEditor:4691\n          _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);\n          //$LASTPOS=21004745;//kernel.MapEditor:4745\n          _this.mode=_this.prevMode;\n          //$LASTPOS=21004769;//kernel.MapEditor:4769\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=21004803;//kernel.MapEditor:4803\n          _this.print(_this.mode+" mode");\n          //$LASTPOS=21004833;//kernel.MapEditor:4833\n          _this.fiber$updateEx(_thread, 10);\n          __pc=17;return;\n        case 17:\n          \n          __pc=23;break;\n        case 18:\n          //$LASTPOS=21004858;//kernel.MapEditor:4858\n          if (!(_this.mode=="setOn"&&_this.getkey(1)>0)) { __pc=19; break; }\n          {\n            //$LASTPOS=21004901;//kernel.MapEditor:4901\n            Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n          }\n          __pc=22;break;\n        case 19:\n          //$LASTPOS=21004954;//kernel.MapEditor:4954\n          if (!(_this.mode=="spuit"&&_this.getkey(1)>0)) { __pc=21; break; }\n          //$LASTPOS=21004997;//kernel.MapEditor:4997\n          _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);\n          //$LASTPOS=21005046;//kernel.MapEditor:5046\n          _this.mode="set";\n          //$LASTPOS=21005067;//kernel.MapEditor:5067\n          _this.print(_this.mode+" mode");\n          //$LASTPOS=21005097;//kernel.MapEditor:5097\n          _this.fiber$updateEx(_thread, 10);\n          __pc=20;return;\n        case 20:\n          \n        case 21:\n          \n        case 22:\n          \n        case 23:\n          \n        case 24:\n          \n        case 25:\n          \n          //$LASTPOS=21005123;//kernel.MapEditor:5123\n          _this.fiber$update(_thread);\n          __pc=26;return;\n        case 26:\n          \n          __pc=14;break;\n        case 27:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.MapEditor,{"fullName":"kernel.MapEditor","namespace":"kernel","shortName":"MapEditor","decls":{"methods":{"main":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Pad=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_22000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=22001202;//kernel.Pad:1202\n    _this.APAD_DIAG_SIZE=96;\n    //$LASTPOS=22003465;//kernel.Pad:3465\n    while (true) {\n      //$LASTPOS=22003484;//kernel.Pad:3484\n      _this.padUpdate();\n      //$LASTPOS=22003502;//kernel.Pad:3502\n      _this.update();\n      \n    }\n  },\n  fiber$main :function _trc_func_22000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=22001202;//kernel.Pad:1202\n    _this.APAD_DIAG_SIZE=96;\n    \n    _thread.enter(function _trc_func_22000000_2(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=22003465;//kernel.Pad:3465\n        case 1:\n          //$LASTPOS=22003484;//kernel.Pad:3484\n          _this.fiber$padUpdate(_thread);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=22003502;//kernel.Pad:3502\n          _this.fiber$update(_thread);\n          __pc=3;return;\n        case 3:\n          \n          __pc=1;break;\n        case 4:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initialize :function _trc_func_22000016_3(opt) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=22000033;//kernel.Pad:33\n    Tonyu.classes.kernel.Actor.apply( _this, [opt]);\n    //$LASTPOS=22000050;//kernel.Pad:50\n    _this.padImageP=Tonyu.globals.$pat_inputPad;\n    //$LASTPOS=22000082;//kernel.Pad:82\n    _this.jujiKey=new Tonyu.classes.kernel.Actor({x: 96+1,y: Tonyu.globals.$screenHeight-96-1,p: _this.padImageP+0,zOrder: - 9,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=22000183;//kernel.Pad:183\n    _this.no1Key=new Tonyu.classes.kernel.Actor({x: Tonyu.globals.$screenWidth-96,y: Tonyu.globals.$screenHeight-96,p: _this.padImageP+1,zOrder: - 9,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=22000292;//kernel.Pad:292\n    _this.jujiKey.show();\n    //$LASTPOS=22000313;//kernel.Pad:313\n    _this.no1Key.show();\n    //$LASTPOS=22000339;//kernel.Pad:339\n    _this.jujiKeyPushU=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y-60,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=22000446;//kernel.Pad:446\n    _this.jujiKeyPushL=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x-60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=22000553;//kernel.Pad:553\n    _this.jujiKeyPushR=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x+60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=22000660;//kernel.Pad:660\n    _this.jujiKeyPushD=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y+60,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=22000767;//kernel.Pad:767\n    _this.jujiKeyPush1=new Tonyu.classes.kernel.Actor({x: _this.no1Key.x,y: _this.no1Key.y,p: _this.padImageP+2,scaleX: 2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=22000879;//kernel.Pad:879\n    _this.jujiKeyPushU.hide();\n    //$LASTPOS=22000905;//kernel.Pad:905\n    _this.jujiKeyPushL.hide();\n    //$LASTPOS=22000931;//kernel.Pad:931\n    _this.jujiKeyPushR.hide();\n    //$LASTPOS=22000957;//kernel.Pad:957\n    _this.jujiKeyPushD.hide();\n    //$LASTPOS=22000983;//kernel.Pad:983\n    _this.jujiKeyPush1.hide();\n  },\n  die :function _trc_func_22001008_4() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=22001021;//kernel.Pad:1021\n    _this.jujiKey.die();\n    //$LASTPOS=22001041;//kernel.Pad:1041\n    _this.no1Key.die();\n    //$LASTPOS=22001060;//kernel.Pad:1060\n    _this.jujiKeyPushU.die();\n    //$LASTPOS=22001085;//kernel.Pad:1085\n    _this.jujiKeyPushL.die();\n    //$LASTPOS=22001110;//kernel.Pad:1110\n    _this.jujiKeyPushR.die();\n    //$LASTPOS=22001135;//kernel.Pad:1135\n    _this.jujiKeyPushD.die();\n    //$LASTPOS=22001160;//kernel.Pad:1160\n    _this.jujiKeyPush1.die();\n    //$LASTPOS=22001185;//kernel.Pad:1185\n    Tonyu.classes.kernel.Actor.prototype.die.apply( _this, []);\n  },\n  padUpdate :function _trc_func_22001224_5() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var i;\n    var t;\n    \n    //$LASTPOS=22001258;//kernel.Pad:1258\n    _this.keyPushL=0;\n    //$LASTPOS=22001277;//kernel.Pad:1277\n    _this.keyPushR=0;\n    //$LASTPOS=22001296;//kernel.Pad:1296\n    _this.keyPushU=0;\n    //$LASTPOS=22001315;//kernel.Pad:1315\n    _this.keyPushD=0;\n    //$LASTPOS=22001334;//kernel.Pad:1334\n    _this.keyPush1=0;\n    //$LASTPOS=22001359;//kernel.Pad:1359\n    _this.padKeyNotapCnt++;\n    //$LASTPOS=22001383;//kernel.Pad:1383\n    //$LASTPOS=22001388;//kernel.Pad:1388\n    i = 0;\n    while(i<5) {\n      {\n        //$LASTPOS=22001436;//kernel.Pad:1436\n        t = Tonyu.globals.$touches[i];\n        //$LASTPOS=22001466;//kernel.Pad:1466\n        if (t.touched) {\n          //$LASTPOS=22001496;//kernel.Pad:1496\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {\n            //$LASTPOS=22001593;//kernel.Pad:1593\n            _this.keyPushU=1;\n          }\n          //$LASTPOS=22001620;//kernel.Pad:1620\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {\n            //$LASTPOS=22001717;//kernel.Pad:1717\n            _this.keyPushD=1;\n          }\n          //$LASTPOS=22001744;//kernel.Pad:1744\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n            //$LASTPOS=22001841;//kernel.Pad:1841\n            _this.keyPushL=1;\n          }\n          //$LASTPOS=22001868;//kernel.Pad:1868\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n            //$LASTPOS=22001965;//kernel.Pad:1965\n            _this.keyPushR=1;\n          }\n          //$LASTPOS=22001992;//kernel.Pad:1992\n          if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {\n            //$LASTPOS=22002054;//kernel.Pad:2054\n            _this.keyPush1=1;\n          }\n          //$LASTPOS=22002081;//kernel.Pad:2081\n          _this.padKeySW=1;\n          //$LASTPOS=22002108;//kernel.Pad:2108\n          _this.padKeyNotapCnt=0;\n          \n        }\n      }\n      i++;\n    }\n    //$LASTPOS=22002173;//kernel.Pad:2173\n    if (_this.keyPushL) {\n      //$LASTPOS=22002187;//kernel.Pad:2187\n      _this.keyCntL++;\n    } else {\n      //$LASTPOS=22002204;//kernel.Pad:2204\n      _this.keyCntL=0;\n    }\n    //$LASTPOS=22002222;//kernel.Pad:2222\n    if (_this.keyPushR) {\n      //$LASTPOS=22002236;//kernel.Pad:2236\n      _this.keyCntR++;\n    } else {\n      //$LASTPOS=22002253;//kernel.Pad:2253\n      _this.keyCntR=0;\n    }\n    //$LASTPOS=22002271;//kernel.Pad:2271\n    if (_this.keyPushU) {\n      //$LASTPOS=22002285;//kernel.Pad:2285\n      _this.keyCntU++;\n    } else {\n      //$LASTPOS=22002302;//kernel.Pad:2302\n      _this.keyCntU=0;\n    }\n    //$LASTPOS=22002320;//kernel.Pad:2320\n    if (_this.keyPushD) {\n      //$LASTPOS=22002334;//kernel.Pad:2334\n      _this.keyCntD++;\n    } else {\n      //$LASTPOS=22002351;//kernel.Pad:2351\n      _this.keyCntD=0;\n    }\n    //$LASTPOS=22002369;//kernel.Pad:2369\n    if (_this.keyPush1) {\n      //$LASTPOS=22002383;//kernel.Pad:2383\n      _this.keyCnt1++;\n    } else {\n      //$LASTPOS=22002400;//kernel.Pad:2400\n      _this.keyCnt1=0;\n    }\n    //$LASTPOS=22002435;//kernel.Pad:2435\n    if (_this.keyPushL) {\n      //$LASTPOS=22002449;//kernel.Pad:2449\n      _this.jujiKeyPushL.show();\n    } else {\n      //$LASTPOS=22002475;//kernel.Pad:2475\n      _this.jujiKeyPushL.hide();\n    }\n    //$LASTPOS=22002501;//kernel.Pad:2501\n    if (_this.keyPushR) {\n      //$LASTPOS=22002515;//kernel.Pad:2515\n      _this.jujiKeyPushR.show();\n    } else {\n      //$LASTPOS=22002541;//kernel.Pad:2541\n      _this.jujiKeyPushR.hide();\n    }\n    //$LASTPOS=22002567;//kernel.Pad:2567\n    if (_this.keyPushU) {\n      //$LASTPOS=22002581;//kernel.Pad:2581\n      _this.jujiKeyPushU.show();\n    } else {\n      //$LASTPOS=22002607;//kernel.Pad:2607\n      _this.jujiKeyPushU.hide();\n    }\n    //$LASTPOS=22002633;//kernel.Pad:2633\n    if (_this.keyPushD) {\n      //$LASTPOS=22002647;//kernel.Pad:2647\n      _this.jujiKeyPushD.show();\n    } else {\n      //$LASTPOS=22002673;//kernel.Pad:2673\n      _this.jujiKeyPushD.hide();\n    }\n    //$LASTPOS=22002699;//kernel.Pad:2699\n    if (_this.keyPush1) {\n      //$LASTPOS=22002713;//kernel.Pad:2713\n      _this.jujiKeyPush1.show();\n    } else {\n      //$LASTPOS=22002739;//kernel.Pad:2739\n      _this.jujiKeyPush1.hide();\n    }\n  },\n  fiber$padUpdate :function _trc_func_22001224_6(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var i;\n    var t;\n    \n    //$LASTPOS=22001258;//kernel.Pad:1258\n    _this.keyPushL=0;\n    //$LASTPOS=22001277;//kernel.Pad:1277\n    _this.keyPushR=0;\n    //$LASTPOS=22001296;//kernel.Pad:1296\n    _this.keyPushU=0;\n    //$LASTPOS=22001315;//kernel.Pad:1315\n    _this.keyPushD=0;\n    //$LASTPOS=22001334;//kernel.Pad:1334\n    _this.keyPush1=0;\n    //$LASTPOS=22001359;//kernel.Pad:1359\n    _this.padKeyNotapCnt++;\n    //$LASTPOS=22001383;//kernel.Pad:1383\n    //$LASTPOS=22001388;//kernel.Pad:1388\n    i = 0;\n    while(i<5) {\n      {\n        //$LASTPOS=22001436;//kernel.Pad:1436\n        t = Tonyu.globals.$touches[i];\n        //$LASTPOS=22001466;//kernel.Pad:1466\n        if (t.touched) {\n          //$LASTPOS=22001496;//kernel.Pad:1496\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {\n            //$LASTPOS=22001593;//kernel.Pad:1593\n            _this.keyPushU=1;\n          }\n          //$LASTPOS=22001620;//kernel.Pad:1620\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {\n            //$LASTPOS=22001717;//kernel.Pad:1717\n            _this.keyPushD=1;\n          }\n          //$LASTPOS=22001744;//kernel.Pad:1744\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n            //$LASTPOS=22001841;//kernel.Pad:1841\n            _this.keyPushL=1;\n          }\n          //$LASTPOS=22001868;//kernel.Pad:1868\n          if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n            //$LASTPOS=22001965;//kernel.Pad:1965\n            _this.keyPushR=1;\n          }\n          //$LASTPOS=22001992;//kernel.Pad:1992\n          if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {\n            //$LASTPOS=22002054;//kernel.Pad:2054\n            _this.keyPush1=1;\n          }\n          //$LASTPOS=22002081;//kernel.Pad:2081\n          _this.padKeySW=1;\n          //$LASTPOS=22002108;//kernel.Pad:2108\n          _this.padKeyNotapCnt=0;\n          \n        }\n      }\n      i++;\n    }\n    //$LASTPOS=22002173;//kernel.Pad:2173\n    if (_this.keyPushL) {\n      //$LASTPOS=22002187;//kernel.Pad:2187\n      _this.keyCntL++;\n    } else {\n      //$LASTPOS=22002204;//kernel.Pad:2204\n      _this.keyCntL=0;\n    }\n    //$LASTPOS=22002222;//kernel.Pad:2222\n    if (_this.keyPushR) {\n      //$LASTPOS=22002236;//kernel.Pad:2236\n      _this.keyCntR++;\n    } else {\n      //$LASTPOS=22002253;//kernel.Pad:2253\n      _this.keyCntR=0;\n    }\n    //$LASTPOS=22002271;//kernel.Pad:2271\n    if (_this.keyPushU) {\n      //$LASTPOS=22002285;//kernel.Pad:2285\n      _this.keyCntU++;\n    } else {\n      //$LASTPOS=22002302;//kernel.Pad:2302\n      _this.keyCntU=0;\n    }\n    //$LASTPOS=22002320;//kernel.Pad:2320\n    if (_this.keyPushD) {\n      //$LASTPOS=22002334;//kernel.Pad:2334\n      _this.keyCntD++;\n    } else {\n      //$LASTPOS=22002351;//kernel.Pad:2351\n      _this.keyCntD=0;\n    }\n    //$LASTPOS=22002369;//kernel.Pad:2369\n    if (_this.keyPush1) {\n      //$LASTPOS=22002383;//kernel.Pad:2383\n      _this.keyCnt1++;\n    } else {\n      //$LASTPOS=22002400;//kernel.Pad:2400\n      _this.keyCnt1=0;\n    }\n    //$LASTPOS=22002435;//kernel.Pad:2435\n    if (_this.keyPushL) {\n      //$LASTPOS=22002449;//kernel.Pad:2449\n      _this.jujiKeyPushL.show();\n    } else {\n      //$LASTPOS=22002475;//kernel.Pad:2475\n      _this.jujiKeyPushL.hide();\n    }\n    //$LASTPOS=22002501;//kernel.Pad:2501\n    if (_this.keyPushR) {\n      //$LASTPOS=22002515;//kernel.Pad:2515\n      _this.jujiKeyPushR.show();\n    } else {\n      //$LASTPOS=22002541;//kernel.Pad:2541\n      _this.jujiKeyPushR.hide();\n    }\n    //$LASTPOS=22002567;//kernel.Pad:2567\n    if (_this.keyPushU) {\n      //$LASTPOS=22002581;//kernel.Pad:2581\n      _this.jujiKeyPushU.show();\n    } else {\n      //$LASTPOS=22002607;//kernel.Pad:2607\n      _this.jujiKeyPushU.hide();\n    }\n    //$LASTPOS=22002633;//kernel.Pad:2633\n    if (_this.keyPushD) {\n      //$LASTPOS=22002647;//kernel.Pad:2647\n      _this.jujiKeyPushD.show();\n    } else {\n      //$LASTPOS=22002673;//kernel.Pad:2673\n      _this.jujiKeyPushD.hide();\n    }\n    //$LASTPOS=22002699;//kernel.Pad:2699\n    if (_this.keyPush1) {\n      //$LASTPOS=22002713;//kernel.Pad:2713\n      _this.jujiKeyPush1.show();\n    } else {\n      //$LASTPOS=22002739;//kernel.Pad:2739\n      _this.jujiKeyPush1.hide();\n    }\n    \n    _thread.retVal=_this;return;\n  },\n  getPadUp :function _trc_func_22002772_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntU;\n  },\n  fiber$getPadUp :function _trc_func_22002772_8(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntU;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getPadDown :function _trc_func_22002808_9() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntD;\n  },\n  fiber$getPadDown :function _trc_func_22002808_10(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntD;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getPadLeft :function _trc_func_22002844_11() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntL;\n  },\n  fiber$getPadLeft :function _trc_func_22002844_12(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntL;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getPadRight :function _trc_func_22002880_13() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntR;\n  },\n  fiber$getPadRight :function _trc_func_22002880_14(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntR;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getPadButton :function _trc_func_22002916_15(i) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var value;\n    \n    //$LASTPOS=22002940;//kernel.Pad:2940\n    value;\n    //$LASTPOS=22002956;//kernel.Pad:2956\n    if (i==0) {\n      //$LASTPOS=22002968;//kernel.Pad:2968\n      value=_this.keyCnt1;\n    }\n    return value;\n  },\n  fiber$getPadButton :function _trc_func_22002916_16(_thread,i) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var value;\n    \n    //$LASTPOS=22002940;//kernel.Pad:2940\n    value;\n    //$LASTPOS=22002956;//kernel.Pad:2956\n    if (i==0) {\n      //$LASTPOS=22002968;//kernel.Pad:2968\n      value=_this.keyCnt1;\n    }\n    _thread.retVal=value;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getUp :function _trc_func_22003010_17() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntU;\n  },\n  fiber$getUp :function _trc_func_22003010_18(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntU;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getDown :function _trc_func_22003043_19() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntD;\n  },\n  fiber$getDown :function _trc_func_22003043_20(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntD;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getLeft :function _trc_func_22003076_21() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntL;\n  },\n  fiber$getLeft :function _trc_func_22003076_22(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntL;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getRight :function _trc_func_22003109_23() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.keyCntR;\n  },\n  fiber$getRight :function _trc_func_22003109_24(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.keyCntR;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getButton :function _trc_func_22003142_25(i) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var value;\n    \n    //$LASTPOS=22003163;//kernel.Pad:3163\n    value;\n    //$LASTPOS=22003179;//kernel.Pad:3179\n    if (i==0) {\n      //$LASTPOS=22003191;//kernel.Pad:3191\n      value=_this.keyCnt1;\n    }\n    return value;\n  },\n  fiber$getButton :function _trc_func_22003142_26(_thread,i) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var value;\n    \n    //$LASTPOS=22003163;//kernel.Pad:3163\n    value;\n    //$LASTPOS=22003179;//kernel.Pad:3179\n    if (i==0) {\n      //$LASTPOS=22003191;//kernel.Pad:3191\n      value=_this.keyCnt1;\n    }\n    _thread.retVal=value;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  isOnRect :function _trc_func_22003243_27(mx,my,rx,ry,rx2,ry2) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return (rx<=mx&&mx<rx2&&ry<=my&&my<ry2);\n  },\n  fiber$isOnRect :function _trc_func_22003243_28(_thread,mx,my,rx,ry,rx2,ry2) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=(rx<=mx&&mx<rx2&&ry<=my&&my<ry2);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  isOnRectWH :function _trc_func_22003357_29(mx,my,rx,ry,rw,rh) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return (rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);\n  },\n  fiber$isOnRectWH :function _trc_func_22003357_30(_thread,mx,my,rx,ry,rw,rh) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=(rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Pad,{"fullName":"kernel.Pad","namespace":"kernel","shortName":"Pad","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"die":{"nowait":true},"padUpdate":{"nowait":false},"getPadUp":{"nowait":false},"getPadDown":{"nowait":false},"getPadLeft":{"nowait":false},"getPadRight":{"nowait":false},"getPadButton":{"nowait":false},"getUp":{"nowait":false},"getDown":{"nowait":false},"getLeft":{"nowait":false},"getRight":{"nowait":false},"getButton":{"nowait":false},"isOnRect":{"nowait":false},"isOnRectWH":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Panel=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_23000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_23000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_23000056_2(opt) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23000072;//kernel.Panel:72\n    Tonyu.classes.kernel.Actor.apply( _this, [opt]);\n    //$LASTPOS=23000089;//kernel.Panel:89\n    _this.width=_this.width;\n    //$LASTPOS=23000112;//kernel.Panel:112\n    _this.height=_this.height;\n    //$LASTPOS=23000137;//kernel.Panel:137\n    if (_this.align==null) {\n      //$LASTPOS=23000153;//kernel.Panel:153\n      _this.align="center";\n    }\n    //$LASTPOS=23000174;//kernel.Panel:174\n    if (_this.alpha==null) {\n      //$LASTPOS=23000190;//kernel.Panel:190\n      _this.alpha=255;\n    }\n    //$LASTPOS=23000206;//kernel.Panel:206\n    if (_this._drawn==null) {\n      //$LASTPOS=23000223;//kernel.Panel:223\n      _this._drawn=false;\n    }\n    //$LASTPOS=23000242;//kernel.Panel:242\n    _this.buf=$("<canvas>").attr({width: _this.width,height: _this.height});\n  },\n  setPanel :function _trc_func_23000284_3(width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23000314;//kernel.Panel:314\n    _this.width=width;\n    //$LASTPOS=23000337;//kernel.Panel:337\n    _this.height=height;\n    //$LASTPOS=23000362;//kernel.Panel:362\n    _this.buf=$("<canvas>").attr({width: width,height: height});\n  },\n  fiber$setPanel :function _trc_func_23000284_4(_thread,width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=23000314;//kernel.Panel:314\n    _this.width=width;\n    //$LASTPOS=23000337;//kernel.Panel:337\n    _this.height=height;\n    //$LASTPOS=23000362;//kernel.Panel:362\n    _this.buf=$("<canvas>").attr({width: width,height: height});\n    \n    _thread.retVal=_this;return;\n  },\n  resize :function _trc_func_23000404_5(width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23000432;//kernel.Panel:432\n    _this.setPanel(width,height);\n  },\n  fiber$resize :function _trc_func_23000404_6(_thread,width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_23000404_7(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=23000432;//kernel.Panel:432\n          _this.fiber$setPanel(_thread, width, height);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  getContext :function _trc_func_23000460_8() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23000480;//kernel.Panel:480\n    _this._drawn=true;\n    return _this.buf[0].getContext("2d");\n  },\n  fiber$getContext :function _trc_func_23000460_9(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=23000480;//kernel.Panel:480\n    _this._drawn=true;\n    _thread.retVal=_this.buf[0].getContext("2d");return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setFillStyle :function _trc_func_23000534_10(color) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23000561;//kernel.Panel:561\n    _this.fillStyle=color;\n  },\n  fiber$setFillStyle :function _trc_func_23000534_11(_thread,color) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=23000561;//kernel.Panel:561\n    _this.fillStyle=color;\n    \n    _thread.retVal=_this;return;\n  },\n  fillRect :function _trc_func_23000587_12(x,y,rectWidth,rectHeight) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23000629;//kernel.Panel:629\n    _this.ctx=_this.getContext();\n    //$LASTPOS=23000652;//kernel.Panel:652\n    _this.ctx.save();\n    //$LASTPOS=23000719;//kernel.Panel:719\n    _this.ctx.fillStyle=_this.fillStyle;\n    //$LASTPOS=23000749;//kernel.Panel:749\n    _this.ctx.fillRect(x,y,rectWidth,rectHeight);\n    //$LASTPOS=23000794;//kernel.Panel:794\n    _this.ctx.restore();\n  },\n  fiber$fillRect :function _trc_func_23000587_13(_thread,x,y,rectWidth,rectHeight) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_23000587_14(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=23000629;//kernel.Panel:629\n          _this.fiber$getContext(_thread);\n          __pc=1;return;\n        case 1:\n          _this.ctx=_thread.retVal;\n          \n          //$LASTPOS=23000652;//kernel.Panel:652\n          _this.ctx.save();\n          //$LASTPOS=23000719;//kernel.Panel:719\n          _this.ctx.fillStyle=_this.fillStyle;\n          //$LASTPOS=23000749;//kernel.Panel:749\n          _this.ctx.fillRect(x,y,rectWidth,rectHeight);\n          //$LASTPOS=23000794;//kernel.Panel:794\n          _this.ctx.restore();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  fillText :function _trc_func_23000813_15(text,x,y,size,align) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23000850;//kernel.Panel:850\n    _this.ctx=_this.getContext();\n    //$LASTPOS=23000873;//kernel.Panel:873\n    _this.ctx.save();\n    //$LASTPOS=23000940;//kernel.Panel:940\n    _this.ctx.textAlign=align;\n    //$LASTPOS=23000968;//kernel.Panel:968\n    _this.ctx.fillStyle=_this.fillStyle;\n    //$LASTPOS=23000998;//kernel.Panel:998\n    _this.ctx.font=size+"px \'Courier New\'";\n    //$LASTPOS=23001037;//kernel.Panel:1037\n    _this.ctx.fillText(text,x,y);\n    //$LASTPOS=23001066;//kernel.Panel:1066\n    _this.ctx.restore();\n  },\n  fiber$fillText :function _trc_func_23000813_16(_thread,text,x,y,size,align) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_23000813_17(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=23000850;//kernel.Panel:850\n          _this.fiber$getContext(_thread);\n          __pc=1;return;\n        case 1:\n          _this.ctx=_thread.retVal;\n          \n          //$LASTPOS=23000873;//kernel.Panel:873\n          _this.ctx.save();\n          //$LASTPOS=23000940;//kernel.Panel:940\n          _this.ctx.textAlign=align;\n          //$LASTPOS=23000968;//kernel.Panel:968\n          _this.ctx.fillStyle=_this.fillStyle;\n          //$LASTPOS=23000998;//kernel.Panel:998\n          _this.ctx.font=size+"px \'Courier New\'";\n          //$LASTPOS=23001037;//kernel.Panel:1037\n          _this.ctx.fillText(text,x,y);\n          //$LASTPOS=23001066;//kernel.Panel:1066\n          _this.ctx.restore();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  clearRect :function _trc_func_23001085_18(clearX,clearY,clearW,clearH) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23001131;//kernel.Panel:1131\n    _this.ctx=_this.getContext();\n    //$LASTPOS=23001154;//kernel.Panel:1154\n    _this.ctx.save();\n    //$LASTPOS=23001171;//kernel.Panel:1171\n    _this.ctx.clearRect(clearX,clearY,clearW,clearH);\n    //$LASTPOS=23001220;//kernel.Panel:1220\n    _this.ctx.restore();\n  },\n  fiber$clearRect :function _trc_func_23001085_19(_thread,clearX,clearY,clearW,clearH) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_23001085_20(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=23001131;//kernel.Panel:1131\n          _this.fiber$getContext(_thread);\n          __pc=1;return;\n        case 1:\n          _this.ctx=_thread.retVal;\n          \n          //$LASTPOS=23001154;//kernel.Panel:1154\n          _this.ctx.save();\n          //$LASTPOS=23001171;//kernel.Panel:1171\n          _this.ctx.clearRect(clearX,clearY,clearW,clearH);\n          //$LASTPOS=23001220;//kernel.Panel:1220\n          _this.ctx.restore();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  getPixel :function _trc_func_23001239_21(getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23001266;//kernel.Panel:1266\n    if (typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY)) {\n      //$LASTPOS=23001365;//kernel.Panel:1365\n      _this.ctx=_this.getContext();\n      //$LASTPOS=23001392;//kernel.Panel:1392\n      _this.imagedata=_this.ctx.getImageData(getX,getY,1,1);\n      //$LASTPOS=23001444;//kernel.Panel:1444\n      _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];\n      \n    } else {\n      //$LASTPOS=23001584;//kernel.Panel:1584\n      _this.colordata=[0,0,0,0];\n      \n    }\n    return (_this.colordata);\n  },\n  fiber$getPixel :function _trc_func_23001239_22(_thread,getX,getY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_23001239_23(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=23001266;//kernel.Panel:1266\n          if (!(typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY))) { __pc=2; break; }\n          //$LASTPOS=23001365;//kernel.Panel:1365\n          _this.fiber$getContext(_thread);\n          __pc=1;return;\n        case 1:\n          _this.ctx=_thread.retVal;\n          \n          //$LASTPOS=23001392;//kernel.Panel:1392\n          _this.imagedata=_this.ctx.getImageData(getX,getY,1,1);\n          //$LASTPOS=23001444;//kernel.Panel:1444\n          _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];\n          __pc=3;break;\n        case 2:\n          {\n            //$LASTPOS=23001584;//kernel.Panel:1584\n            _this.colordata=[0,0,0,0];\n          }\n        case 3:\n          \n          _thread.exit((_this.colordata));return;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  scroll :function _trc_func_23001640_24(scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23001671;//kernel.Panel:1671\n    _this.ctx=_this.getContext();\n    //$LASTPOS=23001694;//kernel.Panel:1694\n    _this.ctx.save();\n    //$LASTPOS=23001711;//kernel.Panel:1711\n    _this.imagedata=_this.ctx.getImageData(0,0,_this.width,_this.height);\n    //$LASTPOS=23001772;//kernel.Panel:1772\n    _this.clearRect(0,0,_this.width,_this.height);\n    //$LASTPOS=23001806;//kernel.Panel:1806\n    _this.ctx.putImageData(_this.imagedata,- scrollX,- scrollY);\n    //$LASTPOS=23001858;//kernel.Panel:1858\n    _this.ctx.restore();\n  },\n  fiber$scroll :function _trc_func_23001640_25(_thread,scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_23001640_26(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=23001671;//kernel.Panel:1671\n          _this.fiber$getContext(_thread);\n          __pc=1;return;\n        case 1:\n          _this.ctx=_thread.retVal;\n          \n          //$LASTPOS=23001694;//kernel.Panel:1694\n          _this.ctx.save();\n          //$LASTPOS=23001711;//kernel.Panel:1711\n          _this.imagedata=_this.ctx.getImageData(0,0,_this.width,_this.height);\n          //$LASTPOS=23001772;//kernel.Panel:1772\n          _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=23001806;//kernel.Panel:1806\n          _this.ctx.putImageData(_this.imagedata,- scrollX,- scrollY);\n          //$LASTPOS=23001858;//kernel.Panel:1858\n          _this.ctx.restore();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  draw :function _trc_func_23001877_27(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=23001894;//kernel.Panel:1894\n    if (_this._drawn) {\n      //$LASTPOS=23001915;//kernel.Panel:1915\n      _this.pImg=_this.buf[0];\n      //$LASTPOS=23001937;//kernel.Panel:1937\n      ctx.save();\n      //$LASTPOS=23001958;//kernel.Panel:1958\n      if (_this.align=="left") {\n        //$LASTPOS=23001990;//kernel.Panel:1990\n        ctx.translate(_this.x+_this.width/2,_this.y+_this.height/2);\n        \n      } else {\n        //$LASTPOS=23002042;//kernel.Panel:2042\n        if (_this.align=="center") {\n          //$LASTPOS=23002076;//kernel.Panel:2076\n          ctx.translate(_this.x,_this.y);\n          \n        } else {\n          //$LASTPOS=23002111;//kernel.Panel:2111\n          if (_this.align=="right") {\n            //$LASTPOS=23002144;//kernel.Panel:2144\n            ctx.translate(_this.x-_this.width/2,_this.y-_this.height/2);\n            \n          }\n        }\n      }\n      //$LASTPOS=23002201;//kernel.Panel:2201\n      if (_this.rotation!=0) {\n        //$LASTPOS=23002236;//kernel.Panel:2236\n        ctx.rotate(_this.rotation/180*Math.PI);\n        \n      } else {\n        //$LASTPOS=23002304;//kernel.Panel:2304\n        ctx.rotate(_this.rotate/180*Math.PI);\n        \n      }\n      //$LASTPOS=23002361;//kernel.Panel:2361\n      ctx.globalAlpha=_this.alpha/255;\n      //$LASTPOS=23002402;//kernel.Panel:2402\n      ctx.drawImage(_this.pImg,0,0,_this.width,_this.height,- _this.width/2,- _this.height/2,_this.width,_this.height);\n      //$LASTPOS=23002506;//kernel.Panel:2506\n      ctx.restore();\n      \n    }\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Panel,{"fullName":"kernel.Panel","namespace":"kernel","shortName":"Panel","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"setPanel":{"nowait":false},"resize":{"nowait":false},"getContext":{"nowait":false},"setFillStyle":{"nowait":false},"fillRect":{"nowait":false},"fillText":{"nowait":false},"clearRect":{"nowait":false},"getPixel":{"nowait":false},"scroll":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.PlainChar=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_24000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_24000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_24000047_2(x,y,p) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var thg;\n    \n    //$LASTPOS=24000066;//kernel.PlainChar:66\n    if (Tonyu.runMode) {\n      //$LASTPOS=24000096;//kernel.PlainChar:96\n      thg = _this.currentThreadGroup();\n      //$LASTPOS=24000135;//kernel.PlainChar:135\n      if (thg) {\n        //$LASTPOS=24000144;//kernel.PlainChar:144\n        _this._th=thg.addObj(_this,"tMain");\n      }\n      //$LASTPOS=24000183;//kernel.PlainChar:183\n      _this.initSprite();\n      \n    }\n    //$LASTPOS=24000209;//kernel.PlainChar:209\n    if (typeof  x=="object") {\n      //$LASTPOS=24000233;//kernel.PlainChar:233\n      Tonyu.extend(_this,x);\n    } else {\n      //$LASTPOS=24000266;//kernel.PlainChar:266\n      if (typeof  x=="number") {\n        //$LASTPOS=24000301;//kernel.PlainChar:301\n        _this.x=x;\n        //$LASTPOS=24000320;//kernel.PlainChar:320\n        _this.y=y;\n        //$LASTPOS=24000339;//kernel.PlainChar:339\n        _this.p=p;\n        \n      }\n    }\n  },\n  draw :function _trc_func_24000360_3(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=24000376;//kernel.PlainChar:376\n    _this.onDraw();\n    //$LASTPOS=24000391;//kernel.PlainChar:391\n    if (_this._isInvisible) {\n      return _this;\n    }\n    //$LASTPOS=24000422;//kernel.PlainChar:422\n    Tonyu.classes.kernel.Actor.prototype.draw.apply( _this, [c]);\n  },\n  setVisible :function _trc_func_24000441_4(v) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=24000463;//kernel.PlainChar:463\n    _this._isInvisible=! v;\n  },\n  fiber$setVisible :function _trc_func_24000441_5(_thread,v) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=24000463;//kernel.PlainChar:463\n    _this._isInvisible=! v;\n    \n    _thread.retVal=_this;return;\n  },\n  onDraw :function _trc_func_24000484_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$onDraw :function _trc_func_24000484_7(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  update :function _trc_func_24000506_8() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=24000523;//kernel.PlainChar:523\n    _this.onUpdate();\n    //$LASTPOS=24000540;//kernel.PlainChar:540\n    Tonyu.classes.kernel.Actor.prototype.update.apply( _this, []);\n  },\n  fiber$update :function _trc_func_24000506_9(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=24000523;//kernel.PlainChar:523\n    _this.onUpdate();\n    \n    _thread.enter(function _trc_func_24000506_10(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=24000540;//kernel.PlainChar:540\n          Tonyu.classes.kernel.Actor.prototype.fiber$update.apply( _this, [_thread]);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  onUpdate :function _trc_func_24000560_11() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  initSprite :function _trc_func_24000584_12() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=24000605;//kernel.PlainChar:605\n    if (_this.layer&&typeof  _this.layer.add=="function") {\n      //$LASTPOS=24000657;//kernel.PlainChar:657\n      _this.layer.add(_this);\n      \n    } else {\n      //$LASTPOS=24000695;//kernel.PlainChar:695\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    //$LASTPOS=24000727;//kernel.PlainChar:727\n    _this.onAppear();\n  },\n  fiber$initSprite :function _trc_func_24000584_13(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=24000605;//kernel.PlainChar:605\n    if (_this.layer&&typeof  _this.layer.add=="function") {\n      //$LASTPOS=24000657;//kernel.PlainChar:657\n      _this.layer.add(_this);\n      \n    } else {\n      //$LASTPOS=24000695;//kernel.PlainChar:695\n      Tonyu.globals.$Sprites.add(_this);\n      \n    }\n    \n    _thread.enter(function _trc_func_24000584_14(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=24000727;//kernel.PlainChar:727\n          _this.fiber$onAppear(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  tMain :function _trc_func_24000743_15() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=24000759;//kernel.PlainChar:759\n    _this.main();\n    //$LASTPOS=24000772;//kernel.PlainChar:772\n    _this.die();\n  },\n  fiber$tMain :function _trc_func_24000743_16(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_24000743_17(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=24000759;//kernel.PlainChar:759\n          _this.fiber$main(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=24000772;//kernel.PlainChar:772\n          _this.die();\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  color :function _trc_func_24000783_18(r,g,b) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return "rgb("+[r,g,b].join(",")+")";\n  },\n  fiber$color :function _trc_func_24000783_19(_thread,r,g,b) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal="rgb("+[r,g,b].join(",")+")";return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  drawText :function _trc_func_24000845_20(x,y,text,col,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var tp;\n    \n    //$LASTPOS=24000881;//kernel.PlainChar:881\n    if (Tonyu.globals.$debug) {\n      return _this;\n    }\n    //$LASTPOS=24000906;//kernel.PlainChar:906\n    if (! size) {\n      //$LASTPOS=24000917;//kernel.PlainChar:917\n      size=15;\n    }\n    //$LASTPOS=24000931;//kernel.PlainChar:931\n    if (! col) {\n      //$LASTPOS=24000941;//kernel.PlainChar:941\n      col="cyan";\n    }\n    //$LASTPOS=24000958;//kernel.PlainChar:958\n    tp = _this.all(Tonyu.classes.kernel.T1Text).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=24001012;//kernel.PlainChar:1012\n    if (tp.length>0) {\n      //$LASTPOS=24001040;//kernel.PlainChar:1040\n      tp[0].extend({x: x,y: y,text: text,fillStyle: col,size: size,hidden: false});\n      \n    } else {\n      //$LASTPOS=24001119;//kernel.PlainChar:1119\n      new Tonyu.classes.kernel.T1Text({x: x,y: y,text: text,fillStyle: col,size: size});\n      \n    }\n  },\n  fiber$drawText :function _trc_func_24000845_21(_thread,x,y,text,col,size) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var tp;\n    \n    //$LASTPOS=24000881;//kernel.PlainChar:881\n    if (Tonyu.globals.$debug) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=24000906;//kernel.PlainChar:906\n    if (! size) {\n      //$LASTPOS=24000917;//kernel.PlainChar:917\n      size=15;\n    }\n    //$LASTPOS=24000931;//kernel.PlainChar:931\n    if (! col) {\n      //$LASTPOS=24000941;//kernel.PlainChar:941\n      col="cyan";\n    }\n    //$LASTPOS=24000958;//kernel.PlainChar:958\n    tp = _this.all(Tonyu.classes.kernel.T1Text).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=24001012;//kernel.PlainChar:1012\n    if (tp.length>0) {\n      //$LASTPOS=24001040;//kernel.PlainChar:1040\n      tp[0].extend({x: x,y: y,text: text,fillStyle: col,size: size,hidden: false});\n      \n    } else {\n      //$LASTPOS=24001119;//kernel.PlainChar:1119\n      new Tonyu.classes.kernel.T1Text({x: x,y: y,text: text,fillStyle: col,size: size});\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  drawLine :function _trc_func_24001174_22(x,y,tx,ty,col) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var tp;\n    \n    //$LASTPOS=24001206;//kernel.PlainChar:1206\n    if (! col) {\n      //$LASTPOS=24001216;//kernel.PlainChar:1216\n      col="white";\n    }\n    //$LASTPOS=24001234;//kernel.PlainChar:1234\n    tp = _this.all(Tonyu.classes.kernel.T1Line).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=24001288;//kernel.PlainChar:1288\n    if (tp.length>0) {\n      //$LASTPOS=24001316;//kernel.PlainChar:1316\n      tp[0].extend({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    } else {\n      //$LASTPOS=24001367;//kernel.PlainChar:1367\n      new Tonyu.classes.kernel.T1Line({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    }\n  },\n  fiber$drawLine :function _trc_func_24001174_23(_thread,x,y,tx,ty,col) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var tp;\n    \n    //$LASTPOS=24001206;//kernel.PlainChar:1206\n    if (! col) {\n      //$LASTPOS=24001216;//kernel.PlainChar:1216\n      col="white";\n    }\n    //$LASTPOS=24001234;//kernel.PlainChar:1234\n    tp = _this.all(Tonyu.classes.kernel.T1Line).find(function (t) {\n      \n      return t.hidden;\n    });\n    //$LASTPOS=24001288;//kernel.PlainChar:1288\n    if (tp.length>0) {\n      //$LASTPOS=24001316;//kernel.PlainChar:1316\n      tp[0].extend({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    } else {\n      //$LASTPOS=24001367;//kernel.PlainChar:1367\n      new Tonyu.classes.kernel.T1Line({x: x,y: y,tx: tx,ty: ty,col: col});\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  appear :function _trc_func_24001407_24(t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return t;\n  },\n  fiber$appear :function _trc_func_24001407_25(_thread,t) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=t;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  trunc :function _trc_func_24001439_26(f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return Math.trunc(f);\n  },\n  loadPage :function _trc_func_24001482_27(page,arg) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=24001508;//kernel.PlainChar:1508\n    _this.all().die();\n    //$LASTPOS=24001526;//kernel.PlainChar:1526\n    new page(arg);\n    //$LASTPOS=24001546;//kernel.PlainChar:1546\n    _this.die();\n  },\n  fiber$loadPage :function _trc_func_24001482_28(_thread,page,arg) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=24001508;//kernel.PlainChar:1508\n    _this.all().die();\n    //$LASTPOS=24001526;//kernel.PlainChar:1526\n    new page(arg);\n    //$LASTPOS=24001546;//kernel.PlainChar:1546\n    _this.die();\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.PlainChar,{"fullName":"kernel.PlainChar","namespace":"kernel","shortName":"PlainChar","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true},"setVisible":{"nowait":false},"onDraw":{"nowait":false},"update":{"nowait":false},"onUpdate":{"nowait":true},"initSprite":{"nowait":false},"tMain":{"nowait":false},"color":{"nowait":false},"drawText":{"nowait":false},"drawLine":{"nowait":false},"appear":{"nowait":false},"trunc":{"nowait":true},"loadPage":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.ScaledCanvas=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_25000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_25000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_25000077_2(opt) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=25000095;//kernel.ScaledCanvas:95\n    _this.extend(opt);\n    //$LASTPOS=25000142;//kernel.ScaledCanvas:142\n    _this.resize(_this.width,_this.height);\n    //$LASTPOS=25000170;//kernel.ScaledCanvas:170\n    _this.cw=_this.canvas.width();\n    //$LASTPOS=25000194;//kernel.ScaledCanvas:194\n    _this.ch=_this.canvas.height();\n    //$LASTPOS=25000219;//kernel.ScaledCanvas:219\n    _this.cctx=_this.canvas[0].getContext("2d");\n    //$LASTPOS=25000257;//kernel.ScaledCanvas:257\n    _this.color="rgb(20,80,180)";\n    //$LASTPOS=25000291;//kernel.ScaledCanvas:291\n    _this.sx=0;\n    //$LASTPOS=25000302;//kernel.ScaledCanvas:302\n    _this.sy=0;\n    //$LASTPOS=25000313;//kernel.ScaledCanvas:313\n    _this.isDrawGrid=Tonyu.globals.$Sprites.isDrawGrid;\n  },\n  resize :function _trc_func_25000349_3(width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=25000378;//kernel.ScaledCanvas:378\n    _this.width=width;\n    //$LASTPOS=25000401;//kernel.ScaledCanvas:401\n    _this.height=height;\n    //$LASTPOS=25000426;//kernel.ScaledCanvas:426\n    _this.buf=$("<canvas>").attr({width: width,height: height});\n    //$LASTPOS=25000469;//kernel.ScaledCanvas:469\n    _this.ctx=_this.buf[0].getContext("2d");\n    //$LASTPOS=25000505;//kernel.ScaledCanvas:505\n    Tonyu.globals.$screenWidth=width;\n    //$LASTPOS=25000530;//kernel.ScaledCanvas:530\n    Tonyu.globals.$screenHeight=height;\n    //$LASTPOS=25000557;//kernel.ScaledCanvas:557\n    if (Tonyu.globals.$panel) {\n      //$LASTPOS=25000578;//kernel.ScaledCanvas:578\n      Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);\n      \n    }\n  },\n  fiber$resize :function _trc_func_25000349_4(_thread,width,height) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=25000378;//kernel.ScaledCanvas:378\n    _this.width=width;\n    //$LASTPOS=25000401;//kernel.ScaledCanvas:401\n    _this.height=height;\n    //$LASTPOS=25000426;//kernel.ScaledCanvas:426\n    _this.buf=$("<canvas>").attr({width: width,height: height});\n    //$LASTPOS=25000469;//kernel.ScaledCanvas:469\n    _this.ctx=_this.buf[0].getContext("2d");\n    //$LASTPOS=25000505;//kernel.ScaledCanvas:505\n    Tonyu.globals.$screenWidth=width;\n    //$LASTPOS=25000530;//kernel.ScaledCanvas:530\n    Tonyu.globals.$screenHeight=height;\n    //$LASTPOS=25000557;//kernel.ScaledCanvas:557\n    if (Tonyu.globals.$panel) {\n      //$LASTPOS=25000578;//kernel.ScaledCanvas:578\n      Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);\n      \n    }\n    \n    _thread.retVal=_this;return;\n  },\n  shouldDraw1x1 :function _trc_func_25000634_5(srcw,srch,dstw,dsth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var larger;\n    var smaller;\n    \n    //$LASTPOS=25000712;//kernel.ScaledCanvas:712\n    larger = 200;\n    //$LASTPOS=25000733;//kernel.ScaledCanvas:733\n    smaller = 5;\n    return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;\n  },\n  fiber$shouldDraw1x1 :function _trc_func_25000634_6(_thread,srcw,srch,dstw,dsth) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var larger;\n    var smaller;\n    \n    //$LASTPOS=25000712;//kernel.ScaledCanvas:712\n    larger = 200;\n    //$LASTPOS=25000733;//kernel.ScaledCanvas:733\n    smaller = 5;\n    _thread.retVal=srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_25000853_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var calcw;\n    var calch;\n    var marginw;\n    var marginh;\n    \n    //$LASTPOS=25000868;//kernel.ScaledCanvas:868\n    _this.cw=_this.canvas.width();\n    //$LASTPOS=25000892;//kernel.ScaledCanvas:892\n    _this.ch=_this.canvas.height();\n    //$LASTPOS=25000917;//kernel.ScaledCanvas:917\n    calcw = _this.ch/_this.height*_this.width;\n    //$LASTPOS=25000961;//kernel.ScaledCanvas:961\n    calch = _this.cw/_this.width*_this.height;\n    //$LASTPOS=25001005;//kernel.ScaledCanvas:1005\n    if (calch>_this.ch) {\n      //$LASTPOS=25001019;//kernel.ScaledCanvas:1019\n      calch=_this.ch;\n    }\n    //$LASTPOS=25001034;//kernel.ScaledCanvas:1034\n    if (calcw>_this.cw) {\n      //$LASTPOS=25001048;//kernel.ScaledCanvas:1048\n      calcw=_this.cw;\n    }\n    //$LASTPOS=25001063;//kernel.ScaledCanvas:1063\n    _this.cctx.clearRect(0,0,_this.cw,_this.ch);\n    //$LASTPOS=25001095;//kernel.ScaledCanvas:1095\n    if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n      //$LASTPOS=25001151;//kernel.ScaledCanvas:1151\n      calcw=_this.width;\n      //$LASTPOS=25001163;//kernel.ScaledCanvas:1163\n      calch=_this.height;\n      \n    }\n    //$LASTPOS=25001189;//kernel.ScaledCanvas:1189\n    marginw = Math.floor((_this.cw-calcw)/2);\n    //$LASTPOS=25001232;//kernel.ScaledCanvas:1232\n    marginh = Math.floor((_this.ch-calch)/2);\n    //$LASTPOS=25001275;//kernel.ScaledCanvas:1275\n    _this.cctx.drawImage(_this.buf[0],0,0,_this.width,_this.height,marginw,marginh,calcw,calch);\n  },\n  canvas2buf :function _trc_func_25001364_8(point) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var calcw;\n    var calch;\n    var marginw;\n    var marginh;\n    \n    //$LASTPOS=25001390;//kernel.ScaledCanvas:1390\n    calcw = _this.ch/_this.height*_this.width;\n    //$LASTPOS=25001434;//kernel.ScaledCanvas:1434\n    calch = _this.cw/_this.width*_this.height;\n    //$LASTPOS=25001478;//kernel.ScaledCanvas:1478\n    if (calch>_this.ch) {\n      //$LASTPOS=25001492;//kernel.ScaledCanvas:1492\n      calch=_this.ch;\n    }\n    //$LASTPOS=25001507;//kernel.ScaledCanvas:1507\n    if (calcw>_this.cw) {\n      //$LASTPOS=25001521;//kernel.ScaledCanvas:1521\n      calcw=_this.cw;\n    }\n    //$LASTPOS=25001536;//kernel.ScaledCanvas:1536\n    if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n      //$LASTPOS=25001592;//kernel.ScaledCanvas:1592\n      calcw=_this.width;\n      //$LASTPOS=25001604;//kernel.ScaledCanvas:1604\n      calch=_this.height;\n      \n    }\n    //$LASTPOS=25001630;//kernel.ScaledCanvas:1630\n    marginw = Math.floor((_this.cw-calcw)/2);\n    //$LASTPOS=25001673;//kernel.ScaledCanvas:1673\n    marginh = Math.floor((_this.ch-calch)/2);\n    return {x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};\n  },\n  fiber$canvas2buf :function _trc_func_25001364_9(_thread,point) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var calcw;\n    var calch;\n    var marginw;\n    var marginh;\n    \n    //$LASTPOS=25001390;//kernel.ScaledCanvas:1390\n    calcw = _this.ch/_this.height*_this.width;\n    //$LASTPOS=25001434;//kernel.ScaledCanvas:1434\n    calch = _this.cw/_this.width*_this.height;\n    //$LASTPOS=25001478;//kernel.ScaledCanvas:1478\n    if (calch>_this.ch) {\n      //$LASTPOS=25001492;//kernel.ScaledCanvas:1492\n      calch=_this.ch;\n    }\n    //$LASTPOS=25001507;//kernel.ScaledCanvas:1507\n    if (calcw>_this.cw) {\n      //$LASTPOS=25001521;//kernel.ScaledCanvas:1521\n      calcw=_this.cw;\n    }\n    //$LASTPOS=25001536;//kernel.ScaledCanvas:1536\n    if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n      //$LASTPOS=25001592;//kernel.ScaledCanvas:1592\n      calcw=_this.width;\n      //$LASTPOS=25001604;//kernel.ScaledCanvas:1604\n      calch=_this.height;\n      \n    }\n    //$LASTPOS=25001630;//kernel.ScaledCanvas:1630\n    marginw = Math.floor((_this.cw-calcw)/2);\n    //$LASTPOS=25001673;//kernel.ScaledCanvas:1673\n    marginh = Math.floor((_this.ch-calch)/2);\n    _thread.retVal={x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setBGColor :function _trc_func_25001810_10(color) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=25001835;//kernel.ScaledCanvas:1835\n    _this.color=color;\n  },\n  fiber$setBGColor :function _trc_func_25001810_11(_thread,color) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=25001835;//kernel.ScaledCanvas:1835\n    _this.color=color;\n    \n    _thread.retVal=_this;return;\n  },\n  fillCanvas :function _trc_func_25001857_12(cv) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var ctx;\n    \n    //$LASTPOS=25001879;//kernel.ScaledCanvas:1879\n    ctx = cv.getContext("2d");\n    //$LASTPOS=25001913;//kernel.ScaledCanvas:1913\n    ctx.save();\n    //$LASTPOS=25001930;//kernel.ScaledCanvas:1930\n    ctx.fillStyle=Tonyu.globals.$Screen.color;\n    //$LASTPOS=25001964;//kernel.ScaledCanvas:1964\n    ctx.fillStyle=Tonyu.bindFunc(_this,_this.color);\n    //$LASTPOS=25001990;//kernel.ScaledCanvas:1990\n    ctx.fillRect(0,0,cv.width,cv.height);\n    //$LASTPOS=25002033;//kernel.ScaledCanvas:2033\n    if (_this.isDrawGrid) {\n      //$LASTPOS=25002049;//kernel.ScaledCanvas:2049\n      _this.drawGrid(cv);\n    }\n    //$LASTPOS=25002068;//kernel.ScaledCanvas:2068\n    ctx.restore();\n  },\n  fiber$fillCanvas :function _trc_func_25001857_13(_thread,cv) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var ctx;\n    \n    //$LASTPOS=25001879;//kernel.ScaledCanvas:1879\n    ctx = cv.getContext("2d");\n    //$LASTPOS=25001913;//kernel.ScaledCanvas:1913\n    ctx.save();\n    //$LASTPOS=25001930;//kernel.ScaledCanvas:1930\n    ctx.fillStyle=Tonyu.globals.$Screen.color;\n    //$LASTPOS=25001964;//kernel.ScaledCanvas:1964\n    ctx.fillStyle=Tonyu.bindFunc(_this,_this.color);\n    //$LASTPOS=25001990;//kernel.ScaledCanvas:1990\n    ctx.fillRect(0,0,cv.width,cv.height);\n    //$LASTPOS=25002033;//kernel.ScaledCanvas:2033\n    if (_this.isDrawGrid) {\n      //$LASTPOS=25002049;//kernel.ScaledCanvas:2049\n      _this.drawGrid(cv);\n    }\n    //$LASTPOS=25002068;//kernel.ScaledCanvas:2068\n    ctx.restore();\n    \n    _thread.retVal=_this;return;\n  },\n  scrollTo :function _trc_func_25002087_14(scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=25002412;//kernel.ScaledCanvas:2412\n    Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);\n  },\n  fiber$scrollTo :function _trc_func_25002087_15(_thread,scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=25002412;//kernel.ScaledCanvas:2412\n    Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.ScaledCanvas,{"fullName":"kernel.ScaledCanvas","namespace":"kernel","shortName":"ScaledCanvas","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"resize":{"nowait":false},"shouldDraw1x1":{"nowait":false},"draw":{"nowait":true},"canvas2buf":{"nowait":false},"setBGColor":{"nowait":false},"fillCanvas":{"nowait":false},"scrollTo":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.SecretChar=Tonyu.klass(Tonyu.classes.kernel.PlainChar,[],{\n  main :function _trc_func_26000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_26000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_26000022_2(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.SecretChar,{"fullName":"kernel.SecretChar","namespace":"kernel","shortName":"SecretChar","decls":{"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.SpriteChar=Tonyu.klass(Tonyu.classes.kernel.PlainChar,[],{\n  main :function _trc_func_27000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_27000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_27000022_2(x,y,p,f) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=27000043;//kernel.SpriteChar:43\n    Tonyu.classes.kernel.PlainChar.apply( _this, [x,y,p]);\n    //$LASTPOS=27000062;//kernel.SpriteChar:62\n    _this.f=f;\n    //$LASTPOS=27000077;//kernel.SpriteChar:77\n    if (! _this.x) {\n      //$LASTPOS=27000090;//kernel.SpriteChar:90\n      _this.x=0;\n    }\n    //$LASTPOS=27000105;//kernel.SpriteChar:105\n    if (! _this.y) {\n      //$LASTPOS=27000118;//kernel.SpriteChar:118\n      _this.y=0;\n    }\n    //$LASTPOS=27000133;//kernel.SpriteChar:133\n    if (! _this.p) {\n      //$LASTPOS=27000146;//kernel.SpriteChar:146\n      _this.p=0;\n    }\n  },\n  draw :function _trc_func_27000160_3(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=27000176;//kernel.SpriteChar:176\n    if (_this.f) {\n      //$LASTPOS=27000194;//kernel.SpriteChar:194\n      if (! _this.scaleY) {\n        //$LASTPOS=27000207;//kernel.SpriteChar:207\n        _this.scaleY=_this.scaleX;\n      }\n      //$LASTPOS=27000231;//kernel.SpriteChar:231\n      _this.scaleX*=- 1;\n      \n    }\n    //$LASTPOS=27000255;//kernel.SpriteChar:255\n    Tonyu.classes.kernel.PlainChar.prototype.draw.apply( _this, [c]);\n    //$LASTPOS=27000275;//kernel.SpriteChar:275\n    if (_this.f) {\n      //$LASTPOS=27000282;//kernel.SpriteChar:282\n      _this.scaleX*=- 1;\n    }\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.SpriteChar,{"fullName":"kernel.SpriteChar","namespace":"kernel","shortName":"SpriteChar","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Sprites=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_28000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_28000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_28000031_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=28000045;//kernel.Sprites:45\n    _this.sprites=[];\n    //$LASTPOS=28000062;//kernel.Sprites:62\n    _this.imageList=[];\n    //$LASTPOS=28000081;//kernel.Sprites:81\n    _this.hitWatchers=[];\n    //$LASTPOS=28000102;//kernel.Sprites:102\n    _this.isDrawGrid=Tonyu.noviceMode;\n    //$LASTPOS=28000136;//kernel.Sprites:136\n    _this.sx=0;\n    //$LASTPOS=28000147;//kernel.Sprites:147\n    _this.sy=0;\n    //$LASTPOS=28000158;//kernel.Sprites:158\n    _this.objId=0;\n  },\n  add :function _trc_func_28000171_3(s) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=28000194;//kernel.Sprites:194\n    if (s.__addedToSprites) {\n      return _this;\n    }\n    //$LASTPOS=28000231;//kernel.Sprites:231\n    _this.sprites.push(s);\n    //$LASTPOS=28000253;//kernel.Sprites:253\n    if (s.__genId==null) {\n      //$LASTPOS=28000283;//kernel.Sprites:283\n      s.__genId=_this.objId;\n      //$LASTPOS=28000309;//kernel.Sprites:309\n      _this.objId++;\n      \n    }\n    //$LASTPOS=28000330;//kernel.Sprites:330\n    s.__addedToSprites=_this;\n    return s;\n  },\n  fiber$add :function _trc_func_28000171_4(_thread,s) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=28000194;//kernel.Sprites:194\n    if (s.__addedToSprites) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=28000231;//kernel.Sprites:231\n    _this.sprites.push(s);\n    //$LASTPOS=28000253;//kernel.Sprites:253\n    if (s.__genId==null) {\n      //$LASTPOS=28000283;//kernel.Sprites:283\n      s.__genId=_this.objId;\n      //$LASTPOS=28000309;//kernel.Sprites:309\n      _this.objId++;\n      \n    }\n    //$LASTPOS=28000330;//kernel.Sprites:330\n    s.__addedToSprites=_this;\n    _thread.retVal=s;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  remove :function _trc_func_28000374_5(s) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var idx;\n    \n    //$LASTPOS=28000400;//kernel.Sprites:400\n    idx = _this.sprites.indexOf(s);\n    //$LASTPOS=28000433;//kernel.Sprites:433\n    if (idx<0) {\n      return _this;\n    }\n    //$LASTPOS=28000457;//kernel.Sprites:457\n    _this.sprites.splice(idx,1);\n    //$LASTPOS=28000485;//kernel.Sprites:485\n    delete s.__addedToSprites;\n  },\n  fiber$remove :function _trc_func_28000374_6(_thread,s) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var idx;\n    \n    //$LASTPOS=28000400;//kernel.Sprites:400\n    idx = _this.sprites.indexOf(s);\n    //$LASTPOS=28000433;//kernel.Sprites:433\n    if (idx<0) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=28000457;//kernel.Sprites:457\n    _this.sprites.splice(idx,1);\n    //$LASTPOS=28000485;//kernel.Sprites:485\n    delete s.__addedToSprites;\n    \n    _thread.retVal=_this;return;\n  },\n  clear :function _trc_func_28000516_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=28000534;//kernel.Sprites:534\n    _this.sprites.splice(0,_this.sprites.length);\n  },\n  fiber$clear :function _trc_func_28000516_8(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=28000534;//kernel.Sprites:534\n    _this.sprites.splice(0,_this.sprites.length);\n    \n    _thread.retVal=_this;return;\n  },\n  compOrder :function _trc_func_28000570_9(obj1,obj2) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var val1;\n    var val2;\n    \n    //$LASTPOS=28000607;//kernel.Sprites:607\n    val1 = obj1.zOrder;\n    //$LASTPOS=28000634;//kernel.Sprites:634\n    val2 = obj2.zOrder;\n    //$LASTPOS=28000661;//kernel.Sprites:661\n    if (val1>val2) {\n      return - 1;\n      \n    } else {\n      //$LASTPOS=28000707;//kernel.Sprites:707\n      if (val1<val2) {\n        return 1;\n        \n      } else {\n        //$LASTPOS=28000752;//kernel.Sprites:752\n        if (val1==val2) {\n          //$LASTPOS=28000777;//kernel.Sprites:777\n          if (obj1.__genId>obj2.__genId) {\n            return 1;\n            \n          } else {\n            return - 1;\n            \n          }\n          return 0;\n          \n        }\n      }\n    }\n  },\n  fiber$compOrder :function _trc_func_28000570_10(_thread,obj1,obj2) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var val1;\n    var val2;\n    \n    //$LASTPOS=28000607;//kernel.Sprites:607\n    val1 = obj1.zOrder;\n    //$LASTPOS=28000634;//kernel.Sprites:634\n    val2 = obj2.zOrder;\n    //$LASTPOS=28000661;//kernel.Sprites:661\n    if (val1>val2) {\n      _thread.retVal=- 1;return;\n      \n      \n    } else {\n      //$LASTPOS=28000707;//kernel.Sprites:707\n      if (val1<val2) {\n        _thread.retVal=1;return;\n        \n        \n      } else {\n        //$LASTPOS=28000752;//kernel.Sprites:752\n        if (val1==val2) {\n          //$LASTPOS=28000777;//kernel.Sprites:777\n          if (obj1.__genId>obj2.__genId) {\n            _thread.retVal=1;return;\n            \n            \n          } else {\n            _thread.retVal=- 1;return;\n            \n            \n          }\n          _thread.retVal=0;return;\n          \n          \n        }\n      }\n    }\n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_28000912_11(cv) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var ctx;\n    var orderArray;\n    \n    //$LASTPOS=28000937;//kernel.Sprites:937\n    ctx = cv.getContext("2d");\n    //$LASTPOS=28000971;//kernel.Sprites:971\n    ctx.save();\n    //$LASTPOS=28001116;//kernel.Sprites:1116\n    orderArray = [];\n    //$LASTPOS=28001140;//kernel.Sprites:1140\n    orderArray=orderArray.concat(_this.sprites);\n    //$LASTPOS=28001184;//kernel.Sprites:1184\n    orderArray.sort(Tonyu.bindFunc(_this,_this.compOrder));\n    //$LASTPOS=28001217;//kernel.Sprites:1217\n    ctx.translate(- _this.sx,- _this.sy);\n    //$LASTPOS=28001246;//kernel.Sprites:1246\n    orderArray.forEach(function (s) {\n      \n      //$LASTPOS=28001280;//kernel.Sprites:1280\n      s.draw(ctx);\n    });\n    //$LASTPOS=28001307;//kernel.Sprites:1307\n    ctx.restore();\n  },\n  checkHit :function _trc_func_28001326_12() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=28001353;//kernel.Sprites:1353\n    _this.hitWatchers.forEach(function (w) {\n      \n      //$LASTPOS=28001397;//kernel.Sprites:1397\n      _this.sprites.forEach(function (a) {\n        var a_owner;\n        \n        //$LASTPOS=28001485;//kernel.Sprites:1485\n        a_owner = a;\n        //$LASTPOS=28001527;//kernel.Sprites:1527\n        if (! (a_owner instanceof w.A)) {\n          return _this;\n        }\n        //$LASTPOS=28001580;//kernel.Sprites:1580\n        _this.sprites.forEach(function (b) {\n          var b_owner;\n          \n          //$LASTPOS=28001628;//kernel.Sprites:1628\n          b_owner = b;\n          //$LASTPOS=28001674;//kernel.Sprites:1674\n          if (a===b) {\n            return _this;\n          }\n          //$LASTPOS=28001710;//kernel.Sprites:1710\n          if (! (b_owner instanceof w.B)) {\n            return _this;\n          }\n          //$LASTPOS=28001815;//kernel.Sprites:1815\n          if (a.crashTo1(b)) {\n            //$LASTPOS=28001918;//kernel.Sprites:1918\n            w.h(a_owner,b_owner);\n            \n          }\n        });\n      });\n    });\n  },\n  fiber$checkHit :function _trc_func_28001326_13(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=28001353;//kernel.Sprites:1353\n    _this.hitWatchers.forEach(function (w) {\n      \n      //$LASTPOS=28001397;//kernel.Sprites:1397\n      _this.sprites.forEach(function (a) {\n        var a_owner;\n        \n        //$LASTPOS=28001485;//kernel.Sprites:1485\n        a_owner = a;\n        //$LASTPOS=28001527;//kernel.Sprites:1527\n        if (! (a_owner instanceof w.A)) {\n          return _this;\n        }\n        //$LASTPOS=28001580;//kernel.Sprites:1580\n        _this.sprites.forEach(function (b) {\n          var b_owner;\n          \n          //$LASTPOS=28001628;//kernel.Sprites:1628\n          b_owner = b;\n          //$LASTPOS=28001674;//kernel.Sprites:1674\n          if (a===b) {\n            return _this;\n          }\n          //$LASTPOS=28001710;//kernel.Sprites:1710\n          if (! (b_owner instanceof w.B)) {\n            return _this;\n          }\n          //$LASTPOS=28001815;//kernel.Sprites:1815\n          if (a.crashTo1(b)) {\n            //$LASTPOS=28001918;//kernel.Sprites:1918\n            w.h(a_owner,b_owner);\n            \n          }\n        });\n      });\n    });\n    \n    _thread.retVal=_this;return;\n  },\n  watchHit :function _trc_func_28002002_14(typeA,typeB,onHit) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var p;\n    \n    //$LASTPOS=28002048;//kernel.Sprites:2048\n    p = {A: typeA,B: typeB,h: onHit};\n    //$LASTPOS=28002112;//kernel.Sprites:2112\n    _this.hitWatchers.push(p);\n  },\n  drawGrid :function _trc_func_28002137_15(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var ctx;\n    var i;\n    \n    //$LASTPOS=28002165;//kernel.Sprites:2165\n    ctx = c.getContext("2d");\n    //$LASTPOS=28002198;//kernel.Sprites:2198\n    ctx.textBaseline="top";\n    //$LASTPOS=28002227;//kernel.Sprites:2227\n    ctx.save();\n    //$LASTPOS=28002244;//kernel.Sprites:2244\n    ctx.strokeStyle="rgb(40,100,200)";\n    //$LASTPOS=28002284;//kernel.Sprites:2284\n    //$LASTPOS=28002289;//kernel.Sprites:2289\n    i = 0;\n    while(i<c.width) {\n      {\n        //$LASTPOS=28002329;//kernel.Sprites:2329\n        ctx.beginPath();\n        //$LASTPOS=28002355;//kernel.Sprites:2355\n        ctx.lineWidth=(i%100==0?4:1);\n        //$LASTPOS=28002401;//kernel.Sprites:2401\n        ctx.moveTo(i,0);\n        //$LASTPOS=28002427;//kernel.Sprites:2427\n        ctx.lineTo(i,c.height);\n        //$LASTPOS=28002460;//kernel.Sprites:2460\n        ctx.closePath();\n        //$LASTPOS=28002486;//kernel.Sprites:2486\n        ctx.stroke();\n      }\n      i+=10;\n    }\n    //$LASTPOS=28002518;//kernel.Sprites:2518\n    //$LASTPOS=28002523;//kernel.Sprites:2523\n    i = 0;\n    while(i<c.height) {\n      {\n        //$LASTPOS=28002564;//kernel.Sprites:2564\n        ctx.beginPath();\n        //$LASTPOS=28002590;//kernel.Sprites:2590\n        ctx.lineWidth=(i%100==0?4:1);\n        //$LASTPOS=28002636;//kernel.Sprites:2636\n        ctx.moveTo(0,i);\n        //$LASTPOS=28002662;//kernel.Sprites:2662\n        ctx.lineTo(c.width,i);\n        //$LASTPOS=28002694;//kernel.Sprites:2694\n        ctx.closePath();\n        //$LASTPOS=28002720;//kernel.Sprites:2720\n        ctx.stroke();\n      }\n      i+=10;\n    }\n    //$LASTPOS=28002746;//kernel.Sprites:2746\n    ctx.fillStyle="white";\n    //$LASTPOS=28002774;//kernel.Sprites:2774\n    ctx.font="15px monospaced";\n    //$LASTPOS=28002807;//kernel.Sprites:2807\n    //$LASTPOS=28002812;//kernel.Sprites:2812\n    i = 100;\n    while(i<c.width) {\n      {\n        //$LASTPOS=28002855;//kernel.Sprites:2855\n        ctx.fillText(i,i,0);\n      }\n      i+=100;\n    }\n    //$LASTPOS=28002889;//kernel.Sprites:2889\n    //$LASTPOS=28002894;//kernel.Sprites:2894\n    i = 100;\n    while(i<c.height) {\n      {\n        //$LASTPOS=28002938;//kernel.Sprites:2938\n        ctx.fillText(i,0,i);\n      }\n      i+=100;\n    }\n    //$LASTPOS=28002972;//kernel.Sprites:2972\n    ctx.restore();\n  },\n  fiber$drawGrid :function _trc_func_28002137_16(_thread,c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var ctx;\n    var i;\n    \n    //$LASTPOS=28002165;//kernel.Sprites:2165\n    ctx = c.getContext("2d");\n    //$LASTPOS=28002198;//kernel.Sprites:2198\n    ctx.textBaseline="top";\n    //$LASTPOS=28002227;//kernel.Sprites:2227\n    ctx.save();\n    //$LASTPOS=28002244;//kernel.Sprites:2244\n    ctx.strokeStyle="rgb(40,100,200)";\n    //$LASTPOS=28002284;//kernel.Sprites:2284\n    //$LASTPOS=28002289;//kernel.Sprites:2289\n    i = 0;\n    while(i<c.width) {\n      {\n        //$LASTPOS=28002329;//kernel.Sprites:2329\n        ctx.beginPath();\n        //$LASTPOS=28002355;//kernel.Sprites:2355\n        ctx.lineWidth=(i%100==0?4:1);\n        //$LASTPOS=28002401;//kernel.Sprites:2401\n        ctx.moveTo(i,0);\n        //$LASTPOS=28002427;//kernel.Sprites:2427\n        ctx.lineTo(i,c.height);\n        //$LASTPOS=28002460;//kernel.Sprites:2460\n        ctx.closePath();\n        //$LASTPOS=28002486;//kernel.Sprites:2486\n        ctx.stroke();\n      }\n      i+=10;\n    }\n    //$LASTPOS=28002518;//kernel.Sprites:2518\n    //$LASTPOS=28002523;//kernel.Sprites:2523\n    i = 0;\n    while(i<c.height) {\n      {\n        //$LASTPOS=28002564;//kernel.Sprites:2564\n        ctx.beginPath();\n        //$LASTPOS=28002590;//kernel.Sprites:2590\n        ctx.lineWidth=(i%100==0?4:1);\n        //$LASTPOS=28002636;//kernel.Sprites:2636\n        ctx.moveTo(0,i);\n        //$LASTPOS=28002662;//kernel.Sprites:2662\n        ctx.lineTo(c.width,i);\n        //$LASTPOS=28002694;//kernel.Sprites:2694\n        ctx.closePath();\n        //$LASTPOS=28002720;//kernel.Sprites:2720\n        ctx.stroke();\n      }\n      i+=10;\n    }\n    //$LASTPOS=28002746;//kernel.Sprites:2746\n    ctx.fillStyle="white";\n    //$LASTPOS=28002774;//kernel.Sprites:2774\n    ctx.font="15px monospaced";\n    //$LASTPOS=28002807;//kernel.Sprites:2807\n    //$LASTPOS=28002812;//kernel.Sprites:2812\n    i = 100;\n    while(i<c.width) {\n      {\n        //$LASTPOS=28002855;//kernel.Sprites:2855\n        ctx.fillText(i,i,0);\n      }\n      i+=100;\n    }\n    //$LASTPOS=28002889;//kernel.Sprites:2889\n    //$LASTPOS=28002894;//kernel.Sprites:2894\n    i = 100;\n    while(i<c.height) {\n      {\n        //$LASTPOS=28002938;//kernel.Sprites:2938\n        ctx.fillText(i,0,i);\n      }\n      i+=100;\n    }\n    //$LASTPOS=28002972;//kernel.Sprites:2972\n    ctx.restore();\n    \n    _thread.retVal=_this;return;\n  },\n  setImageList :function _trc_func_28002991_17(il) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=28003024;//kernel.Sprites:3024\n    _this.imageList=il;\n  },\n  fiber$setImageList :function _trc_func_28002991_18(_thread,il) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=28003024;//kernel.Sprites:3024\n    _this.imageList=il;\n    \n    _thread.retVal=_this;return;\n  },\n  getImageList :function _trc_func_28003042_19() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.imageList;\n  },\n  fiber$getImageList :function _trc_func_28003042_20(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=_this.imageList;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  scrollTo :function _trc_func_28003095_21(scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=28003136;//kernel.Sprites:3136\n    _this.sx=scrollX;\n    //$LASTPOS=28003153;//kernel.Sprites:3153\n    _this.sy=scrollY;\n  },\n  fiber$scrollTo :function _trc_func_28003095_22(_thread,scrollX,scrollY) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=28003136;//kernel.Sprites:3136\n    _this.sx=scrollX;\n    //$LASTPOS=28003153;//kernel.Sprites:3153\n    _this.sy=scrollY;\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Sprites,{"fullName":"kernel.Sprites","namespace":"kernel","shortName":"Sprites","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"add":{"nowait":false},"remove":{"nowait":false},"clear":{"nowait":false},"compOrder":{"nowait":false},"draw":{"nowait":true},"checkHit":{"nowait":false},"watchHit":{"nowait":true},"drawGrid":{"nowait":false},"setImageList":{"nowait":false},"getImageList":{"nowait":false},"scrollTo":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T1Line=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_29000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_29000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_29000016_2(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=29000034;//kernel.T1Line:34\n    if (_this.hidden) {\n      return _this;\n    }\n    //$LASTPOS=29000065;//kernel.T1Line:65\n    ctx.strokeStyle=_this.col;\n    //$LASTPOS=29000091;//kernel.T1Line:91\n    ctx.beginPath();\n    //$LASTPOS=29000113;//kernel.T1Line:113\n    ctx.moveTo(_this.x,_this.y);\n    //$LASTPOS=29000135;//kernel.T1Line:135\n    ctx.lineTo(_this.tx,_this.ty);\n    //$LASTPOS=29000159;//kernel.T1Line:159\n    ctx.stroke();\n    //$LASTPOS=29000178;//kernel.T1Line:178\n    _this.hidden=true;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T1Line,{"fullName":"kernel.T1Line","namespace":"kernel","shortName":"T1Line","decls":{"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T1Map=Tonyu.klass(Tonyu.classes.kernel.Map,[],{\n  main :function _trc_func_30000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_30000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setBGColor :function _trc_func_30000042_2(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=30000064;//kernel.T1Map:64\n    Tonyu.globals.$Screen.setBGColor(c);\n  },\n  fiber$setBGColor :function _trc_func_30000042_3(_thread,c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=30000064;//kernel.T1Map:64\n    Tonyu.globals.$Screen.setBGColor(c);\n    \n    _thread.retVal=_this;return;\n  },\n  load :function _trc_func_30000091_4(fileName) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var f;\n    var o;\n    \n    //$LASTPOS=30000469;//kernel.T1Map:469\n    f = _this.file("../maps/").rel(fileName);\n    //$LASTPOS=30000512;//kernel.T1Map:512\n    o = f.obj();\n    //$LASTPOS=30000532;//kernel.T1Map:532\n    _this.chipWidth=o.chipWidth;\n    //$LASTPOS=30000560;//kernel.T1Map:560\n    _this.chipHeight=o.chipHeight;\n    //$LASTPOS=30000590;//kernel.T1Map:590\n    _this.baseData=o.baseData;\n    //$LASTPOS=30000616;//kernel.T1Map:616\n    _this.mapTable=_this.conv(_this.baseData[0],o.pTable);\n    //$LASTPOS=30000658;//kernel.T1Map:658\n    _this.mapData=_this.mapTable;\n    //$LASTPOS=30000681;//kernel.T1Map:681\n    _this.row=_this.mapTable.length;\n    //$LASTPOS=30000707;//kernel.T1Map:707\n    _this.col=_this.mapTable[0].length;\n    //$LASTPOS=30000736;//kernel.T1Map:736\n    _this.mapOnTable=_this.conv(_this.baseData[1],o.pTable);\n    //$LASTPOS=30000780;//kernel.T1Map:780\n    _this.mapOnData=_this.mapOnTable;\n    //$LASTPOS=30000813;//kernel.T1Map:813\n    _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n    //$LASTPOS=30000885;//kernel.T1Map:885\n    _this.initMap();\n  },\n  fiber$load :function _trc_func_30000091_5(_thread,fileName) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var f;\n    var o;\n    \n    //$LASTPOS=30000469;//kernel.T1Map:469\n    f = _this.file("../maps/").rel(fileName);\n    //$LASTPOS=30000512;//kernel.T1Map:512\n    o = f.obj();\n    //$LASTPOS=30000532;//kernel.T1Map:532\n    _this.chipWidth=o.chipWidth;\n    //$LASTPOS=30000560;//kernel.T1Map:560\n    _this.chipHeight=o.chipHeight;\n    //$LASTPOS=30000590;//kernel.T1Map:590\n    _this.baseData=o.baseData;\n    \n    _thread.enter(function _trc_func_30000091_6(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=30000616;//kernel.T1Map:616\n          _this.fiber$conv(_thread, _this.baseData[0], o.pTable);\n          __pc=1;return;\n        case 1:\n          _this.mapTable=_thread.retVal;\n          \n          //$LASTPOS=30000658;//kernel.T1Map:658\n          _this.mapData=_this.mapTable;\n          //$LASTPOS=30000681;//kernel.T1Map:681\n          _this.row=_this.mapTable.length;\n          //$LASTPOS=30000707;//kernel.T1Map:707\n          _this.col=_this.mapTable[0].length;\n          //$LASTPOS=30000736;//kernel.T1Map:736\n          _this.fiber$conv(_thread, _this.baseData[1], o.pTable);\n          __pc=2;return;\n        case 2:\n          _this.mapOnTable=_thread.retVal;\n          \n          //$LASTPOS=30000780;//kernel.T1Map:780\n          _this.mapOnData=_this.mapOnTable;\n          //$LASTPOS=30000813;//kernel.T1Map:813\n          _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n          //$LASTPOS=30000885;//kernel.T1Map:885\n          _this.fiber$initMap(_thread);\n          __pc=3;return;\n        case 3:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  conv :function _trc_func_30000903_7(mat,tbl) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var res;\n    \n    //$LASTPOS=30000926;//kernel.T1Map:926\n    res = [];\n    //$LASTPOS=30000943;//kernel.T1Map:943\n    mat.forEach(function (row) {\n      var rrow;\n      \n      //$LASTPOS=30000973;//kernel.T1Map:973\n      rrow = [];\n      //$LASTPOS=30000995;//kernel.T1Map:995\n      res.push(rrow);\n      //$LASTPOS=30001020;//kernel.T1Map:1020\n      row.forEach(function (dat) {\n        var t;\n        \n        //$LASTPOS=30001067;//kernel.T1Map:1067\n        t = tbl[dat[0]];\n        //$LASTPOS=30001099;//kernel.T1Map:1099\n        if (t) {\n          //$LASTPOS=30001106;//kernel.T1Map:1106\n          rrow.push(Tonyu.globals[t.name]+dat[1]);\n        } else {\n          //$LASTPOS=30001165;//kernel.T1Map:1165\n          rrow.push(dat[1]);\n        }\n      });\n    });\n    return res;\n  },\n  fiber$conv :function _trc_func_30000903_8(_thread,mat,tbl) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var res;\n    \n    //$LASTPOS=30000926;//kernel.T1Map:926\n    res = [];\n    //$LASTPOS=30000943;//kernel.T1Map:943\n    mat.forEach(function (row) {\n      var rrow;\n      \n      //$LASTPOS=30000973;//kernel.T1Map:973\n      rrow = [];\n      //$LASTPOS=30000995;//kernel.T1Map:995\n      res.push(rrow);\n      //$LASTPOS=30001020;//kernel.T1Map:1020\n      row.forEach(function (dat) {\n        var t;\n        \n        //$LASTPOS=30001067;//kernel.T1Map:1067\n        t = tbl[dat[0]];\n        //$LASTPOS=30001099;//kernel.T1Map:1099\n        if (t) {\n          //$LASTPOS=30001106;//kernel.T1Map:1106\n          rrow.push(Tonyu.globals[t.name]+dat[1]);\n        } else {\n          //$LASTPOS=30001165;//kernel.T1Map:1165\n          rrow.push(dat[1]);\n        }\n      });\n    });\n    _thread.retVal=res;return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T1Map,{"fullName":"kernel.T1Map","namespace":"kernel","shortName":"T1Map","decls":{"methods":{"main":{"nowait":false},"setBGColor":{"nowait":false},"load":{"nowait":false},"conv":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T1Page=Tonyu.klass(Tonyu.classes.kernel.PlainChar,[],{\n  main :function _trc_func_31000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_31000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initGlobals :function _trc_func_31000022_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=31000044;//kernel.T1Page:44\n    Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;\n    //$LASTPOS=31000074;//kernel.T1Page:74\n    Tonyu.globals.$Boot.setFrameRate(60);\n    //$LASTPOS=31000103;//kernel.T1Page:103\n    Tonyu.globals.$clBlack=_this.color(0,0,0);\n    //$LASTPOS=31000131;//kernel.T1Page:131\n    Tonyu.globals.$clRed=_this.color(255,0,0);\n    //$LASTPOS=31000159;//kernel.T1Page:159\n    Tonyu.globals.$clGreen=_this.color(0,255,0);\n    //$LASTPOS=31000189;//kernel.T1Page:189\n    Tonyu.globals.$clYellow=_this.color(255,255,0);\n    //$LASTPOS=31000222;//kernel.T1Page:222\n    Tonyu.globals.$clBlue=_this.color(0,0,255);\n    //$LASTPOS=31000251;//kernel.T1Page:251\n    Tonyu.globals.$clPink=_this.color(255,0,255);\n    //$LASTPOS=31000282;//kernel.T1Page:282\n    Tonyu.globals.$clAqua=_this.color(0,255,255);\n    //$LASTPOS=31000313;//kernel.T1Page:313\n    Tonyu.globals.$clWhite=_this.color(255,255,255);\n    //$LASTPOS=31000347;//kernel.T1Page:347\n    Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;\n  },\n  fiber$initGlobals :function _trc_func_31000022_3(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=31000044;//kernel.T1Page:44\n    Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;\n    //$LASTPOS=31000074;//kernel.T1Page:74\n    Tonyu.globals.$Boot.setFrameRate(60);\n    \n    _thread.enter(function _trc_func_31000022_4(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=31000103;//kernel.T1Page:103\n          _this.fiber$color(_thread, 0, 0, 0);\n          __pc=1;return;\n        case 1:\n          Tonyu.globals.$clBlack=_thread.retVal;\n          \n          //$LASTPOS=31000131;//kernel.T1Page:131\n          _this.fiber$color(_thread, 255, 0, 0);\n          __pc=2;return;\n        case 2:\n          Tonyu.globals.$clRed=_thread.retVal;\n          \n          //$LASTPOS=31000159;//kernel.T1Page:159\n          _this.fiber$color(_thread, 0, 255, 0);\n          __pc=3;return;\n        case 3:\n          Tonyu.globals.$clGreen=_thread.retVal;\n          \n          //$LASTPOS=31000189;//kernel.T1Page:189\n          _this.fiber$color(_thread, 255, 255, 0);\n          __pc=4;return;\n        case 4:\n          Tonyu.globals.$clYellow=_thread.retVal;\n          \n          //$LASTPOS=31000222;//kernel.T1Page:222\n          _this.fiber$color(_thread, 0, 0, 255);\n          __pc=5;return;\n        case 5:\n          Tonyu.globals.$clBlue=_thread.retVal;\n          \n          //$LASTPOS=31000251;//kernel.T1Page:251\n          _this.fiber$color(_thread, 255, 0, 255);\n          __pc=6;return;\n        case 6:\n          Tonyu.globals.$clPink=_thread.retVal;\n          \n          //$LASTPOS=31000282;//kernel.T1Page:282\n          _this.fiber$color(_thread, 0, 255, 255);\n          __pc=7;return;\n        case 7:\n          Tonyu.globals.$clAqua=_thread.retVal;\n          \n          //$LASTPOS=31000313;//kernel.T1Page:313\n          _this.fiber$color(_thread, 255, 255, 255);\n          __pc=8;return;\n        case 8:\n          Tonyu.globals.$clWhite=_thread.retVal;\n          \n          //$LASTPOS=31000347;//kernel.T1Page:347\n          Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T1Page,{"fullName":"kernel.T1Page","namespace":"kernel","shortName":"T1Page","decls":{"methods":{"main":{"nowait":false},"initGlobals":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T1Text=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_32000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_32000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  draw :function _trc_func_32000016_2(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=32000032;//kernel.T1Text:32\n    if (_this.hidden) {\n      return _this;\n    }\n    //$LASTPOS=32000057;//kernel.T1Text:57\n    c.font=_this.size+"px \'ＭＳ Ｐゴシック\'";\n    //$LASTPOS=32000097;//kernel.T1Text:97\n    Tonyu.classes.kernel.Actor.prototype.draw.apply( _this, [c]);\n    //$LASTPOS=32000117;//kernel.T1Text:117\n    _this.hidden=true;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T1Text,{"fullName":"kernel.T1Text","namespace":"kernel","shortName":"T1Text","decls":{"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T2Body=Tonyu.klass(Tonyu.classes.kernel.BodyActor,[],{\n  main :function _trc_func_33000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_33000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T2Body,{"fullName":"kernel.T2Body","namespace":"kernel","shortName":"T2Body","decls":{"methods":{"main":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T2MediaPlayer=Tonyu.klass(Tonyu.classes.kernel.Actor,[],{\n  main :function _trc_func_34000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_34000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_34000055_2() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34000069;//kernel.T2MediaPlayer:69\n    _this.initT2MediaPlayer();\n  },\n  initT2MediaPlayer :function _trc_func_34000096_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34000124;//kernel.T2MediaPlayer:124\n    if (T2MediaLib.inited) {\n      return _this;\n    }\n    //$LASTPOS=34000160;//kernel.T2MediaPlayer:160\n    T2MediaLib.init();\n    //$LASTPOS=34000184;//kernel.T2MediaPlayer:184\n    T2MediaLib.inited=true;\n    //$LASTPOS=34000213;//kernel.T2MediaPlayer:213\n    _this.bgmPlayerMax=T2MediaLib.bgmPlayerMax;\n  },\n  fiber$initT2MediaPlayer :function _trc_func_34000096_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34000124;//kernel.T2MediaPlayer:124\n    if (T2MediaLib.inited) {\n      _thread.retVal=_this;return;\n      \n    }\n    //$LASTPOS=34000160;//kernel.T2MediaPlayer:160\n    T2MediaLib.init();\n    //$LASTPOS=34000184;//kernel.T2MediaPlayer:184\n    T2MediaLib.inited=true;\n    //$LASTPOS=34000213;//kernel.T2MediaPlayer:213\n    _this.bgmPlayerMax=T2MediaLib.bgmPlayerMax;\n    \n    _thread.retVal=_this;return;\n  },\n  clearSEData :function _trc_func_34000259_5() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34000281;//kernel.T2MediaPlayer:281\n    T2MediaLib.allStopBGM();\n    //$LASTPOS=34000311;//kernel.T2MediaPlayer:311\n    T2MediaLib.allClearData();\n  },\n  fiber$clearSEData :function _trc_func_34000259_6(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34000281;//kernel.T2MediaPlayer:281\n    T2MediaLib.allStopBGM();\n    //$LASTPOS=34000311;//kernel.T2MediaPlayer:311\n    T2MediaLib.allClearData();\n    \n    _thread.retVal=_this;return;\n  },\n  clearBGMData :function _trc_func_34000344_7() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34000367;//kernel.T2MediaPlayer:367\n    _this.clearSEData();\n  },\n  fiber$clearBGMData :function _trc_func_34000344_8(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_34000344_9(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=34000367;//kernel.T2MediaPlayer:367\n          _this.fiber$clearSEData(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  deleteSEData :function _trc_func_34000388_10(idx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34000414;//kernel.T2MediaPlayer:414\n    T2MediaLib.clearData(idx);\n  },\n  fiber$deleteSEData :function _trc_func_34000388_11(_thread,idx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34000414;//kernel.T2MediaPlayer:414\n    T2MediaLib.clearData(idx);\n    \n    _thread.retVal=_this;return;\n  },\n  loadSE :function _trc_func_34000457_12(idx,src) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var data;\n    var cnt;\n    \n    //$LASTPOS=34000498;//kernel.T2MediaPlayer:498\n    T2MediaLib.loadSE(idx,src);\n    //$LASTPOS=34000557;//kernel.T2MediaPlayer:557\n    data = T2MediaLib.getSEData(idx);\n    //$LASTPOS=34000600;//kernel.T2MediaPlayer:600\n    cnt = 0;\n    //$LASTPOS=34000616;//kernel.T2MediaPlayer:616\n    while (data==null) {\n      //$LASTPOS=34000648;//kernel.T2MediaPlayer:648\n      _this.update();\n      //$LASTPOS=34000667;//kernel.T2MediaPlayer:667\n      data=T2MediaLib.getSEData(idx);\n      //$LASTPOS=34000710;//kernel.T2MediaPlayer:710\n      cnt++;\n      \n    }\n    return data;\n  },\n  fiber$loadSE :function _trc_func_34000457_13(_thread,idx,src) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var data;\n    var cnt;\n    \n    //$LASTPOS=34000498;//kernel.T2MediaPlayer:498\n    T2MediaLib.loadSE(idx,src);\n    //$LASTPOS=34000557;//kernel.T2MediaPlayer:557\n    data = T2MediaLib.getSEData(idx);\n    //$LASTPOS=34000600;//kernel.T2MediaPlayer:600\n    cnt = 0;\n    \n    _thread.enter(function _trc_func_34000457_14(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=34000616;//kernel.T2MediaPlayer:616\n        case 1:\n          if (!(data==null)) { __pc=3; break; }\n          //$LASTPOS=34000648;//kernel.T2MediaPlayer:648\n          _this.fiber$update(_thread);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=34000667;//kernel.T2MediaPlayer:667\n          data=T2MediaLib.getSEData(idx);\n          //$LASTPOS=34000710;//kernel.T2MediaPlayer:710\n          cnt++;\n          __pc=1;break;\n        case 3:\n          \n          _thread.exit(data);return;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  loadFromProject :function _trc_func_34000852_15(prj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var r;\n    var s;\n    var _it_229;\n    var name;\n    var url;\n    var ls;\n    var f;\n    \n    //$LASTPOS=34000881;//kernel.T2MediaPlayer:881\n    r = prj.getResource();\n    //$LASTPOS=34000911;//kernel.T2MediaPlayer:911\n    if (! r||! r.sounds) {\n      return _this;\n    }\n    //$LASTPOS=34000945;//kernel.T2MediaPlayer:945\n    _it_229=Tonyu.iterator(r.sounds,1);\n    while(_it_229.next()) {\n      s=_it_229[0];\n      \n      //$LASTPOS=34000981;//kernel.T2MediaPlayer:981\n      name = s.name;url = s.url;\n      //$LASTPOS=34001019;//kernel.T2MediaPlayer:1019\n      ls = /^ls:(.*)/.exec(url);\n      //$LASTPOS=34001058;//kernel.T2MediaPlayer:1058\n      if (ls) {\n        //$LASTPOS=34001081;//kernel.T2MediaPlayer:1081\n        f = prj.getDir().rel(ls[1]);\n        //$LASTPOS=34001125;//kernel.T2MediaPlayer:1125\n        if (f.exists()) {\n          //$LASTPOS=34001160;//kernel.T2MediaPlayer:1160\n          url=f.text();\n          //$LASTPOS=34001191;//kernel.T2MediaPlayer:1191\n          Tonyu.globals.$lastURL=url;\n          \n        }\n        \n      }\n      //$LASTPOS=34001242;//kernel.T2MediaPlayer:1242\n      Tonyu.setGlobal(name,name);\n      //$LASTPOS=34001281;//kernel.T2MediaPlayer:1281\n      _this.print("Loading Sound: "+name);\n      //$LASTPOS=34001322;//kernel.T2MediaPlayer:1322\n      _this.loadSE(name,url);\n      \n    }\n  },\n  fiber$loadFromProject :function _trc_func_34000852_16(_thread,prj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var r;\n    var s;\n    var _it_229;\n    var name;\n    var url;\n    var ls;\n    var f;\n    \n    //$LASTPOS=34000881;//kernel.T2MediaPlayer:881\n    r = prj.getResource();\n    //$LASTPOS=34000911;//kernel.T2MediaPlayer:911\n    if (! r||! r.sounds) {\n      _thread.retVal=_this;return;\n      \n    }\n    \n    _thread.enter(function _trc_func_34000852_17(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=34000945;//kernel.T2MediaPlayer:945\n          _it_229=Tonyu.iterator(r.sounds,1);\n        case 1:\n          if (!(_it_229.next())) { __pc=3; break; }\n          s=_it_229[0];\n          \n          //$LASTPOS=34000981;//kernel.T2MediaPlayer:981\n          name = s.name;url = s.url;\n          //$LASTPOS=34001019;//kernel.T2MediaPlayer:1019\n          ls = /^ls:(.*)/.exec(url);\n          //$LASTPOS=34001058;//kernel.T2MediaPlayer:1058\n          if (ls) {\n            //$LASTPOS=34001081;//kernel.T2MediaPlayer:1081\n            f = prj.getDir().rel(ls[1]);\n            //$LASTPOS=34001125;//kernel.T2MediaPlayer:1125\n            if (f.exists()) {\n              //$LASTPOS=34001160;//kernel.T2MediaPlayer:1160\n              url=f.text();\n              //$LASTPOS=34001191;//kernel.T2MediaPlayer:1191\n              Tonyu.globals.$lastURL=url;\n              \n            }\n            \n          }\n          //$LASTPOS=34001242;//kernel.T2MediaPlayer:1242\n          Tonyu.setGlobal(name,name);\n          //$LASTPOS=34001281;//kernel.T2MediaPlayer:1281\n          _this.print("Loading Sound: "+name);\n          //$LASTPOS=34001322;//kernel.T2MediaPlayer:1322\n          _this.fiber$loadSE(_thread, name, url);\n          __pc=2;return;\n        case 2:\n          \n          __pc=1;break;\n        case 3:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  playSE :function _trc_func_34001402_18(idx,vol,rate,offset,loop,loopStart,loopEnd) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34001503;//kernel.T2MediaPlayer:1503\n    if (vol==null) {\n      //$LASTPOS=34001520;//kernel.T2MediaPlayer:1520\n      vol=128;\n    }\n    //$LASTPOS=34001609;//kernel.T2MediaPlayer:1609\n    if (vol<0) {\n      //$LASTPOS=34001629;//kernel.T2MediaPlayer:1629\n      vol=0;\n    } else {\n      //$LASTPOS=34001650;//kernel.T2MediaPlayer:1650\n      if (vol>128) {\n        //$LASTPOS=34001665;//kernel.T2MediaPlayer:1665\n        vol=128;\n      }\n    }\n    return T2MediaLib.playSE(idx,vol/128,rate,offset,loop,loopStart,loopEnd);\n  },\n  stopSE :function _trc_func_34001769_19(sourceObj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.stopSE(sourceObj);\n  },\n  fiber$stopSE :function _trc_func_34001769_20(_thread,sourceObj) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.stopSE(sourceObj);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getSEData :function _trc_func_34001838_21(idx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.getSEData(idx);\n  },\n  fiber$getSEData :function _trc_func_34001838_22(_thread,idx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.getSEData(idx);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  loadBGM :function _trc_func_34001914_23(idx,src) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var data;\n    \n    //$LASTPOS=34001956;//kernel.T2MediaPlayer:1956\n    T2MediaLib.loadBGM(idx,src);\n    //$LASTPOS=34002016;//kernel.T2MediaPlayer:2016\n    data = T2MediaLib.getBGMData(idx);\n    //$LASTPOS=34002060;//kernel.T2MediaPlayer:2060\n    while (data==null) {\n      //$LASTPOS=34002092;//kernel.T2MediaPlayer:2092\n      _this.update();\n      //$LASTPOS=34002111;//kernel.T2MediaPlayer:2111\n      data=T2MediaLib.getBGMData(idx);\n      \n    }\n    return data;\n  },\n  fiber$loadBGM :function _trc_func_34001914_24(_thread,idx,src) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var data;\n    \n    //$LASTPOS=34001956;//kernel.T2MediaPlayer:1956\n    T2MediaLib.loadBGM(idx,src);\n    //$LASTPOS=34002016;//kernel.T2MediaPlayer:2016\n    data = T2MediaLib.getBGMData(idx);\n    \n    _thread.enter(function _trc_func_34001914_25(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=34002060;//kernel.T2MediaPlayer:2060\n        case 1:\n          if (!(data==null)) { __pc=3; break; }\n          //$LASTPOS=34002092;//kernel.T2MediaPlayer:2092\n          _this.fiber$update(_thread);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=34002111;//kernel.T2MediaPlayer:2111\n          data=T2MediaLib.getBGMData(idx);\n          __pc=1;break;\n        case 3:\n          \n          _thread.exit(data);return;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  playBGM :function _trc_func_34002177_26(idx,loop,offset,loopStart,loopEnd) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34002232;//kernel.T2MediaPlayer:2232\n    if (loop===null) {\n      //$LASTPOS=34002251;//kernel.T2MediaPlayer:2251\n      loop=false;\n    }\n    //$LASTPOS=34002270;//kernel.T2MediaPlayer:2270\n    if (offset===null) {\n      //$LASTPOS=34002291;//kernel.T2MediaPlayer:2291\n      offset=0;\n    }\n    return T2MediaLib.playBGM(0,idx,loop,offset,loopStart,loopEnd);\n  },\n  fiber$playBGM :function _trc_func_34002177_27(_thread,idx,loop,offset,loopStart,loopEnd) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34002232;//kernel.T2MediaPlayer:2232\n    if (loop===null) {\n      //$LASTPOS=34002251;//kernel.T2MediaPlayer:2251\n      loop=false;\n    }\n    //$LASTPOS=34002270;//kernel.T2MediaPlayer:2270\n    if (offset===null) {\n      //$LASTPOS=34002291;//kernel.T2MediaPlayer:2291\n      offset=0;\n    }\n    _thread.retVal=T2MediaLib.playBGM(0,idx,loop,offset,loopStart,loopEnd);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  stopBGM :function _trc_func_34002383_28() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.stopBGM(0);\n  },\n  fiber$stopBGM :function _trc_func_34002383_29(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.stopBGM(0);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  pauseBGM :function _trc_func_34002437_30() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.pauseBGM(0);\n  },\n  fiber$pauseBGM :function _trc_func_34002437_31(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.pauseBGM(0);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  resumeBGM :function _trc_func_34002493_32() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.resumeBGM(0);\n  },\n  fiber$resumeBGM :function _trc_func_34002493_33(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.resumeBGM(0);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setBGMVolume :function _trc_func_34002551_34(vol) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34002577;//kernel.T2MediaPlayer:2577\n    vol=vol/128;\n    //$LASTPOS=34002672;//kernel.T2MediaPlayer:2672\n    if (vol>1) {\n      //$LASTPOS=34002692;//kernel.T2MediaPlayer:2692\n      vol=1;\n    } else {\n      //$LASTPOS=34002713;//kernel.T2MediaPlayer:2713\n      if (vol<0) {\n        //$LASTPOS=34002728;//kernel.T2MediaPlayer:2728\n        vol=0;\n      }\n    }\n    return T2MediaLib.setBGMVolume(0,vol);\n  },\n  fiber$setBGMVolume :function _trc_func_34002551_35(_thread,vol) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34002577;//kernel.T2MediaPlayer:2577\n    vol=vol/128;\n    //$LASTPOS=34002672;//kernel.T2MediaPlayer:2672\n    if (vol>1) {\n      //$LASTPOS=34002692;//kernel.T2MediaPlayer:2692\n      vol=1;\n    } else {\n      //$LASTPOS=34002713;//kernel.T2MediaPlayer:2713\n      if (vol<0) {\n        //$LASTPOS=34002728;//kernel.T2MediaPlayer:2728\n        vol=0;\n      }\n    }\n    _thread.retVal=T2MediaLib.setBGMVolume(0,vol);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setBGMTempo :function _trc_func_34002790_36(tempo) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.setBGMTempo(0,tempo);\n  },\n  fiber$setBGMTempo :function _trc_func_34002790_37(_thread,tempo) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.setBGMTempo(0,tempo);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getBGMCurrentTime :function _trc_func_34002948_38() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.getBGMCurrentTime(0);\n  },\n  fiber$getBGMCurrentTime :function _trc_func_34002948_39(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.getBGMCurrentTime(0);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getBGMLength :function _trc_func_34003022_40() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.getBGMLength(0);\n  },\n  fiber$getBGMLength :function _trc_func_34003022_41(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.getBGMLength(0);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getBGMData :function _trc_func_34003086_42(idx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.getBGMData(idx);\n  },\n  fiber$getBGMData :function _trc_func_34003086_43(_thread,idx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.getBGMData(idx);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  playBGMID :function _trc_func_34003171_44(id,idx,loop,offset,loopStart,loopEnd) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34003232;//kernel.T2MediaPlayer:3232\n    if (loop===null) {\n      //$LASTPOS=34003251;//kernel.T2MediaPlayer:3251\n      loop=false;\n    }\n    //$LASTPOS=34003270;//kernel.T2MediaPlayer:3270\n    if (offset===null) {\n      //$LASTPOS=34003291;//kernel.T2MediaPlayer:3291\n      offset=0;\n    }\n    return T2MediaLib.playBGM(id,idx,loop,offset,loopStart,loopEnd);\n  },\n  fiber$playBGMID :function _trc_func_34003171_45(_thread,id,idx,loop,offset,loopStart,loopEnd) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34003232;//kernel.T2MediaPlayer:3232\n    if (loop===null) {\n      //$LASTPOS=34003251;//kernel.T2MediaPlayer:3251\n      loop=false;\n    }\n    //$LASTPOS=34003270;//kernel.T2MediaPlayer:3270\n    if (offset===null) {\n      //$LASTPOS=34003291;//kernel.T2MediaPlayer:3291\n      offset=0;\n    }\n    _thread.retVal=T2MediaLib.playBGM(id,idx,loop,offset,loopStart,loopEnd);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  stopBGMID :function _trc_func_34003384_46(id) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.stopBGM(id);\n  },\n  fiber$stopBGMID :function _trc_func_34003384_47(_thread,id) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.stopBGM(id);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  pauseBGMID :function _trc_func_34003443_48(id) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.pauseBGM(id);\n  },\n  fiber$pauseBGMID :function _trc_func_34003443_49(_thread,id) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.pauseBGM(id);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  resumeBGMID :function _trc_func_34003504_50(id) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.resumeBGM(id);\n  },\n  fiber$resumeBGMID :function _trc_func_34003504_51(_thread,id) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.resumeBGM(id);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setBGMVolumeID :function _trc_func_34003567_52(id,vol) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34003599;//kernel.T2MediaPlayer:3599\n    vol=vol/128;\n    //$LASTPOS=34003694;//kernel.T2MediaPlayer:3694\n    if (vol>1) {\n      //$LASTPOS=34003714;//kernel.T2MediaPlayer:3714\n      vol=1;\n    } else {\n      //$LASTPOS=34003735;//kernel.T2MediaPlayer:3735\n      if (vol<0) {\n        //$LASTPOS=34003750;//kernel.T2MediaPlayer:3750\n        vol=0;\n      }\n    }\n    return T2MediaLib.setBGMVolume(id,vol);\n  },\n  fiber$setBGMVolumeID :function _trc_func_34003567_53(_thread,id,vol) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34003599;//kernel.T2MediaPlayer:3599\n    vol=vol/128;\n    //$LASTPOS=34003694;//kernel.T2MediaPlayer:3694\n    if (vol>1) {\n      //$LASTPOS=34003714;//kernel.T2MediaPlayer:3714\n      vol=1;\n    } else {\n      //$LASTPOS=34003735;//kernel.T2MediaPlayer:3735\n      if (vol<0) {\n        //$LASTPOS=34003750;//kernel.T2MediaPlayer:3750\n        vol=0;\n      }\n    }\n    _thread.retVal=T2MediaLib.setBGMVolume(id,vol);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setBGMTempoID :function _trc_func_34003813_54(id,tempo) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.setBGMTempo(id,tempo);\n  },\n  fiber$setBGMTempoID :function _trc_func_34003813_55(_thread,id,tempo) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.setBGMTempo(id,tempo);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getBGMCurrentTimeID :function _trc_func_34003978_56(id) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.getBGMCurrentTime(id);\n  },\n  fiber$getBGMCurrentTimeID :function _trc_func_34003978_57(_thread,id) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.getBGMCurrentTime(id);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getBGMLengthID :function _trc_func_34004057_58(id) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.getBGMLength(id);\n  },\n  fiber$getBGMLengthID :function _trc_func_34004057_59(_thread,id) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.getBGMLength(id);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  sizeBGMID :function _trc_func_34004126_60() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.getBGMPlayerMax();\n  },\n  fiber$sizeBGMID :function _trc_func_34004126_61(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.getBGMPlayerMax();return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  allStopBGM :function _trc_func_34004189_62() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34004210;//kernel.T2MediaPlayer:4210\n    T2MediaLib.allStopBGM();\n  },\n  fiber$allStopBGM :function _trc_func_34004189_63(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34004210;//kernel.T2MediaPlayer:4210\n    T2MediaLib.allStopBGM();\n    \n    _thread.retVal=_this;return;\n  },\n  loadAudio :function _trc_func_34004245_64(idx,src) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34004289;//kernel.T2MediaPlayer:4289\n    T2MediaLib.loadAudio(idx,src);\n    //$LASTPOS=34004351;//kernel.T2MediaPlayer:4351\n    while (T2MediaLib.getAudioData(idx)==null) {\n      //$LASTPOS=34004396;//kernel.T2MediaPlayer:4396\n      _this.update();\n    }\n  },\n  fiber$loadAudio :function _trc_func_34004245_65(_thread,idx,src) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34004289;//kernel.T2MediaPlayer:4289\n    T2MediaLib.loadAudio(idx,src);\n    \n    _thread.enter(function _trc_func_34004245_66(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=34004351;//kernel.T2MediaPlayer:4351\n        case 1:\n          if (!(T2MediaLib.getAudioData(idx)==null)) { __pc=3; break; }\n          //$LASTPOS=34004396;//kernel.T2MediaPlayer:4396\n          _this.fiber$update(_thread);\n          __pc=2;return;\n        case 2:\n          \n          __pc=1;break;\n        case 3:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  playAudio :function _trc_func_34004412_67(idx,loop,startTime) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34004452;//kernel.T2MediaPlayer:4452\n    if (loop===null) {\n      //$LASTPOS=34004471;//kernel.T2MediaPlayer:4471\n      loop=false;\n    }\n    //$LASTPOS=34004490;//kernel.T2MediaPlayer:4490\n    if (startTime===null) {\n      //$LASTPOS=34004514;//kernel.T2MediaPlayer:4514\n      startTime=0;\n    }\n    return T2MediaLib.playAudio(idx,loop,startTime);\n  },\n  fiber$playAudio :function _trc_func_34004412_68(_thread,idx,loop,startTime) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34004452;//kernel.T2MediaPlayer:4452\n    if (loop===null) {\n      //$LASTPOS=34004471;//kernel.T2MediaPlayer:4471\n      loop=false;\n    }\n    //$LASTPOS=34004490;//kernel.T2MediaPlayer:4490\n    if (startTime===null) {\n      //$LASTPOS=34004514;//kernel.T2MediaPlayer:4514\n      startTime=0;\n    }\n    _thread.retVal=T2MediaLib.playAudio(idx,loop,startTime);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  stopAudio :function _trc_func_34004591_69() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.stopAudio();\n  },\n  fiber$stopAudio :function _trc_func_34004591_70(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.stopAudio();return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  pauseAudio :function _trc_func_34004648_71() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.pauseAudio();\n  },\n  fiber$pauseAudio :function _trc_func_34004648_72(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.pauseAudio();return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  resumeAudio :function _trc_func_34004707_73() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.resumeAudio();\n  },\n  fiber$resumeAudio :function _trc_func_34004707_74(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.resumeAudio();return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setAudioVolume :function _trc_func_34004768_75(vol) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34004796;//kernel.T2MediaPlayer:4796\n    vol=vol/128;\n    //$LASTPOS=34004818;//kernel.T2MediaPlayer:4818\n    if (vol>1) {\n      //$LASTPOS=34004838;//kernel.T2MediaPlayer:4838\n      vol=1;\n    } else {\n      //$LASTPOS=34004859;//kernel.T2MediaPlayer:4859\n      if (vol<0) {\n        //$LASTPOS=34004874;//kernel.T2MediaPlayer:4874\n        vol=0;\n      }\n    }\n    return T2MediaLib.setAudioVolume(vol);\n  },\n  fiber$setAudioVolume :function _trc_func_34004768_76(_thread,vol) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34004796;//kernel.T2MediaPlayer:4796\n    vol=vol/128;\n    //$LASTPOS=34004818;//kernel.T2MediaPlayer:4818\n    if (vol>1) {\n      //$LASTPOS=34004838;//kernel.T2MediaPlayer:4838\n      vol=1;\n    } else {\n      //$LASTPOS=34004859;//kernel.T2MediaPlayer:4859\n      if (vol<0) {\n        //$LASTPOS=34004874;//kernel.T2MediaPlayer:4874\n        vol=0;\n      }\n    }\n    _thread.retVal=T2MediaLib.setAudioVolume(vol);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setAudioTempo :function _trc_func_34004935_77(tempo) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=34004964;//kernel.T2MediaPlayer:4964\n    if (tempo>4) {\n      //$LASTPOS=34004986;//kernel.T2MediaPlayer:4986\n      tempo=4;\n    } else {\n      //$LASTPOS=34005009;//kernel.T2MediaPlayer:5009\n      if (tempo<0.5) {\n        //$LASTPOS=34005026;//kernel.T2MediaPlayer:5026\n        tempo=0.5;\n      }\n    }\n    return T2MediaLib.setAudioTempo(tempo);\n  },\n  fiber$setAudioTempo :function _trc_func_34004935_78(_thread,tempo) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=34004964;//kernel.T2MediaPlayer:4964\n    if (tempo>4) {\n      //$LASTPOS=34004986;//kernel.T2MediaPlayer:4986\n      tempo=4;\n    } else {\n      //$LASTPOS=34005009;//kernel.T2MediaPlayer:5009\n      if (tempo<0.5) {\n        //$LASTPOS=34005026;//kernel.T2MediaPlayer:5026\n        tempo=0.5;\n      }\n    }\n    _thread.retVal=T2MediaLib.setAudioTempo(tempo);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  setAudioPosition :function _trc_func_34005090_79(time) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.setAudioPosition(time);\n  },\n  fiber$setAudioPosition :function _trc_func_34005090_80(_thread,time) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.setAudioPosition(time);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getAudioCurrentTime :function _trc_func_34005169_81() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.getAudioCurrentTime();\n  },\n  fiber$getAudioCurrentTime :function _trc_func_34005169_82(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.getAudioCurrentTime();return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getAudioLength :function _trc_func_34005246_83() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.getAudioLength();\n  },\n  fiber$getAudioLength :function _trc_func_34005246_84(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.getAudioLength();return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  getAudioData :function _trc_func_34005313_85(idx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return T2MediaLib.getAudioData(idx);\n  },\n  fiber$getAudioData :function _trc_func_34005313_86(_thread,idx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    _thread.retVal=T2MediaLib.getAudioData(idx);return;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T2MediaPlayer,{"fullName":"kernel.T2MediaPlayer","namespace":"kernel","shortName":"T2MediaPlayer","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"initT2MediaPlayer":{"nowait":false},"clearSEData":{"nowait":false},"clearBGMData":{"nowait":false},"deleteSEData":{"nowait":false},"loadSE":{"nowait":false},"loadFromProject":{"nowait":false},"playSE":{"nowait":true},"stopSE":{"nowait":false},"getSEData":{"nowait":false},"loadBGM":{"nowait":false},"playBGM":{"nowait":false},"stopBGM":{"nowait":false},"pauseBGM":{"nowait":false},"resumeBGM":{"nowait":false},"setBGMVolume":{"nowait":false},"setBGMTempo":{"nowait":false},"getBGMCurrentTime":{"nowait":false},"getBGMLength":{"nowait":false},"getBGMData":{"nowait":false},"playBGMID":{"nowait":false},"stopBGMID":{"nowait":false},"pauseBGMID":{"nowait":false},"resumeBGMID":{"nowait":false},"setBGMVolumeID":{"nowait":false},"setBGMTempoID":{"nowait":false},"getBGMCurrentTimeID":{"nowait":false},"getBGMLengthID":{"nowait":false},"sizeBGMID":{"nowait":false},"allStopBGM":{"nowait":false},"loadAudio":{"nowait":false},"playAudio":{"nowait":false},"stopAudio":{"nowait":false},"pauseAudio":{"nowait":false},"resumeAudio":{"nowait":false},"setAudioVolume":{"nowait":false},"setAudioTempo":{"nowait":false},"setAudioPosition":{"nowait":false},"getAudioCurrentTime":{"nowait":false},"getAudioLength":{"nowait":false},"getAudioData":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.T2World=Tonyu.klass(Tonyu.classes.kernel.Actor,[Tonyu.classes.kernel.T2Mod],{\n  main :function _trc_func_35000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=35000150;//kernel.T2World:150\n    _this.loop();\n  },\n  fiber$main :function _trc_func_35000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_35000000_2(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=35000150;//kernel.T2World:150\n          _this.fiber$loop(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  onAppear :function _trc_func_35000067_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=35000086;//kernel.T2World:86\n    Tonyu.globals.$currentProject.requestPlugin("box2d");\n    //$LASTPOS=35000133;//kernel.T2World:133\n    _this.initWorld();\n  },\n  fiber$onAppear :function _trc_func_35000067_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=35000086;//kernel.T2World:86\n    Tonyu.globals.$currentProject.requestPlugin("box2d");\n    \n    _thread.enter(function _trc_func_35000067_5(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=35000133;//kernel.T2World:133\n          _this.fiber$initWorld(_thread);\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initWorld :function _trc_func_35000163_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b2World;\n    var b2Vec2;\n    \n    //$LASTPOS=35000183;//kernel.T2World:183\n    _this.gravity=_this.gravity||9.8;\n    //$LASTPOS=35000212;//kernel.T2World:212\n    _this.gravityX=_this.gravityX||0;\n    //$LASTPOS=35000241;//kernel.T2World:241\n    b2World = Box2D.Dynamics.b2World;\n    //$LASTPOS=35000284;//kernel.T2World:284\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=35000328;//kernel.T2World:328\n    _this.scale=_this.scale||32;\n    //$LASTPOS=35000352;//kernel.T2World:352\n    _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);\n    //$LASTPOS=35000477;//kernel.T2World:477\n    Tonyu.globals.$t2World=_this;\n    //$LASTPOS=35000497;//kernel.T2World:497\n    Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));\n    //$LASTPOS=35000533;//kernel.T2World:533\n    _this.on("die",Tonyu.bindFunc(_this,_this.releaseWorld));\n  },\n  fiber$initWorld :function _trc_func_35000163_7(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b2World;\n    var b2Vec2;\n    \n    //$LASTPOS=35000183;//kernel.T2World:183\n    _this.gravity=_this.gravity||9.8;\n    //$LASTPOS=35000212;//kernel.T2World:212\n    _this.gravityX=_this.gravityX||0;\n    //$LASTPOS=35000241;//kernel.T2World:241\n    b2World = Box2D.Dynamics.b2World;\n    //$LASTPOS=35000284;//kernel.T2World:284\n    b2Vec2 = Box2D.Common.Math.b2Vec2;\n    //$LASTPOS=35000328;//kernel.T2World:328\n    _this.scale=_this.scale||32;\n    //$LASTPOS=35000352;//kernel.T2World:352\n    _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);\n    //$LASTPOS=35000477;//kernel.T2World:477\n    Tonyu.globals.$t2World=_this;\n    //$LASTPOS=35000497;//kernel.T2World:497\n    Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));\n    \n    _thread.enter(function _trc_func_35000163_8(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=35000533;//kernel.T2World:533\n          _this.fiber$on(_thread, "die", Tonyu.bindFunc(_this,_this.releaseWorld));\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  releaseWorld :function _trc_func_35000561_9() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=35000584;//kernel.T2World:584\n    if (Tonyu.globals.$t2World===_this) {\n      //$LASTPOS=35000605;//kernel.T2World:605\n      Tonyu.globals.$t2World=null;\n    }\n  },\n  fiber$releaseWorld :function _trc_func_35000561_10(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=35000584;//kernel.T2World:584\n    if (Tonyu.globals.$t2World===_this) {\n      //$LASTPOS=35000605;//kernel.T2World:605\n      Tonyu.globals.$t2World=null;\n    }\n    \n    _thread.retVal=_this;return;\n  },\n  loop :function _trc_func_35000626_11() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=35000641;//kernel.T2World:641\n    while (true) {\n      //$LASTPOS=35000664;//kernel.T2World:664\n      _this.world.Step(1/Tonyu.globals.$Boot.getFrameRate(),10,10);\n      //$LASTPOS=35000831;//kernel.T2World:831\n      _this.world.DrawDebugData();\n      //$LASTPOS=35000863;//kernel.T2World:863\n      _this.world.ClearForces();\n      //$LASTPOS=35000893;//kernel.T2World:893\n      _this.updatePos();\n      //$LASTPOS=35000915;//kernel.T2World:915\n      _this.update();\n      \n    }\n  },\n  fiber$loop :function _trc_func_35000626_12(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_35000626_13(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=35000641;//kernel.T2World:641\n        case 1:\n          //$LASTPOS=35000664;//kernel.T2World:664\n          _this.world.Step(1/Tonyu.globals.$Boot.getFrameRate(),10,10);\n          //$LASTPOS=35000831;//kernel.T2World:831\n          _this.world.DrawDebugData();\n          //$LASTPOS=35000863;//kernel.T2World:863\n          _this.world.ClearForces();\n          //$LASTPOS=35000893;//kernel.T2World:893\n          _this.fiber$updatePos(_thread);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=35000915;//kernel.T2World:915\n          _this.fiber$update(_thread);\n          __pc=3;return;\n        case 3:\n          \n          __pc=1;break;\n        case 4:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  updatePos :function _trc_func_35000936_14() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var b;\n    var d;\n    \n    //$LASTPOS=35000956;//kernel.T2World:956\n    //$LASTPOS=35000961;//kernel.T2World:961\n    b = _this.world.GetBodyList();\n    while(b) {\n      {\n        //$LASTPOS=35001015;//kernel.T2World:1015\n        d = b.GetUserData();\n        //$LASTPOS=35001047;//kernel.T2World:1047\n        if (d) {\n          //$LASTPOS=35001053;//kernel.T2World:1053\n          d.updatePos();\n        }\n      }\n      b=b.GetNext();\n    }\n  },\n  fiber$updatePos :function _trc_func_35000936_15(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var b;\n    var d;\n    \n    //$LASTPOS=35000956;//kernel.T2World:956\n    //$LASTPOS=35000961;//kernel.T2World:961\n    b = _this.world.GetBodyList();\n    while(b) {\n      {\n        //$LASTPOS=35001015;//kernel.T2World:1015\n        d = b.GetUserData();\n        //$LASTPOS=35001047;//kernel.T2World:1047\n        if (d) {\n          //$LASTPOS=35001053;//kernel.T2World:1053\n          d.updatePos();\n        }\n      }\n      b=b.GetNext();\n    }\n    \n    _thread.retVal=_this;return;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.T2World,{"fullName":"kernel.T2World","namespace":"kernel","shortName":"T2World","decls":{"methods":{"main":{"nowait":false},"onAppear":{"nowait":false},"initWorld":{"nowait":false},"releaseWorld":{"nowait":false},"loop":{"nowait":false},"updatePos":{"nowait":false}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.TextChar=Tonyu.klass(Tonyu.classes.kernel.PlainChar,[],{\n  main :function _trc_func_36000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_36000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_36000040_2(xx,yy,t,c,s) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=36000065;//kernel.TextChar:65\n    Tonyu.classes.kernel.PlainChar.apply( _this, [xx,yy]);\n    //$LASTPOS=36000084;//kernel.TextChar:84\n    _this.text="";\n    //$LASTPOS=36000098;//kernel.TextChar:98\n    _this.col=Tonyu.globals.$clWhite;\n    //$LASTPOS=36000117;//kernel.TextChar:117\n    _this.size=20;\n    //$LASTPOS=36000131;//kernel.TextChar:131\n    if (! _this.x) {\n      //$LASTPOS=36000144;//kernel.TextChar:144\n      _this.x=0;\n    }\n    //$LASTPOS=36000159;//kernel.TextChar:159\n    if (! _this.y) {\n      //$LASTPOS=36000172;//kernel.TextChar:172\n      _this.y=0;\n    }\n    //$LASTPOS=36000187;//kernel.TextChar:187\n    if (t) {\n      //$LASTPOS=36000194;//kernel.TextChar:194\n      _this.text=t;\n    }\n    //$LASTPOS=36000207;//kernel.TextChar:207\n    if (c) {\n      //$LASTPOS=36000214;//kernel.TextChar:214\n      _this.fillStyle=c;\n    }\n    //$LASTPOS=36000232;//kernel.TextChar:232\n    if (s) {\n      //$LASTPOS=36000239;//kernel.TextChar:239\n      _this.size=s;\n    }\n  },\n  draw :function _trc_func_36000251_3(ctx) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var rect;\n    \n    //$LASTPOS=36000269;//kernel.TextChar:269\n    if (! _this.size) {\n      //$LASTPOS=36000280;//kernel.TextChar:280\n      _this.size=15;\n    }\n    //$LASTPOS=36000294;//kernel.TextChar:294\n    if (! _this.align) {\n      //$LASTPOS=36000306;//kernel.TextChar:306\n      _this.align="left";\n    }\n    //$LASTPOS=36000325;//kernel.TextChar:325\n    if (! _this.fillStyle) {\n      //$LASTPOS=36000341;//kernel.TextChar:341\n      _this.fillStyle="white";\n    }\n    //$LASTPOS=36000365;//kernel.TextChar:365\n    ctx.fillStyle=_this.fillStyle;\n    //$LASTPOS=36000395;//kernel.TextChar:395\n    ctx.globalAlpha=_this.alpha/255;\n    //$LASTPOS=36000432;//kernel.TextChar:432\n    ctx.font=_this.size+"px \'ＭＳ Ｐゴシック\'";\n    //$LASTPOS=36000468;//kernel.TextChar:468\n    rect = TextRect.draw(ctx,_this.text,_this.x,_this.y,_this.size,_this.align,"fill");\n    //$LASTPOS=36000536;//kernel.TextChar:536\n    _this.width=rect.w;\n    //$LASTPOS=36000555;//kernel.TextChar:555\n    _this.height=rect.h;\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.TextChar,{"fullName":"kernel.TextChar","namespace":"kernel","shortName":"TextChar","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.Boot=Tonyu.klass(Tonyu.classes.kernel.Actor,[Tonyu.classes.kernel.T2MediaPlayer],{\n  main :function _trc_func_37000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=37001664;//kernel.Boot:1664\n    _this.initSounds();\n    //$LASTPOS=37001679;//kernel.Boot:1679\n    _this.initSprites();\n    //$LASTPOS=37001695;//kernel.Boot:1695\n    Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;\n    //$LASTPOS=37001726;//kernel.Boot:1726\n    Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);\n    //$LASTPOS=37001763;//kernel.Boot:1763\n    _this.initThread();\n    //$LASTPOS=37001780;//kernel.Boot:1780\n    Tonyu.globals.$pat_fruits=30;\n    //$LASTPOS=37001797;//kernel.Boot:1797\n    Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;\n    //$LASTPOS=37001814;//kernel.Boot:1814\n    Tonyu.globals.$Math=Math;\n    //$LASTPOS=37001827;//kernel.Boot:1827\n    Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.Panel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=37001937;//kernel.Boot:1937\n    Tonyu.globals.$consolePrintY=465-15;\n    //$LASTPOS=37001961;//kernel.Boot:1961\n    Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});\n    //$LASTPOS=37002101;//kernel.Boot:2101\n    if (typeof  SplashScreen!="undefined") {\n      //$LASTPOS=37002139;//kernel.Boot:2139\n      SplashScreen.hide();\n    }\n    //$LASTPOS=37002161;//kernel.Boot:2161\n    _this.initFPSParams();\n    //$LASTPOS=37002181;//kernel.Boot:2181\n    while (true) {\n      //$LASTPOS=37002201;//kernel.Boot:2201\n      _this.thg.steps();\n      //$LASTPOS=37002219;//kernel.Boot:2219\n      Tonyu.globals.$Keys.update();\n      //$LASTPOS=37002240;//kernel.Boot:2240\n      Tonyu.globals.$InputDevice.update();\n      //$LASTPOS=37002268;//kernel.Boot:2268\n      Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;\n      //$LASTPOS=37002301;//kernel.Boot:2301\n      Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;\n      //$LASTPOS=37002338;//kernel.Boot:2338\n      _this.doDraw=_this.now()<_this.deadLine;\n      //$LASTPOS=37002366;//kernel.Boot:2366\n      if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {\n        //$LASTPOS=37002420;//kernel.Boot:2420\n        _this.doDraw=true;\n        //$LASTPOS=37002442;//kernel.Boot:2442\n        _this.resetDeadLine();\n        \n      }\n      //$LASTPOS=37002471;//kernel.Boot:2471\n      if (_this.doDraw) {\n        //$LASTPOS=37002514;//kernel.Boot:2514\n        Tonyu.globals.$Screen.fillCanvas(Tonyu.globals.$Screen.buf[0]);\n        //$LASTPOS=37002559;//kernel.Boot:2559\n        Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n        //$LASTPOS=37002599;//kernel.Boot:2599\n        Tonyu.globals.$FrontSprites.draw(Tonyu.globals.$Screen.buf[0]);\n        //$LASTPOS=37002644;//kernel.Boot:2644\n        Tonyu.globals.$Screen.draw();\n        //$LASTPOS=37002669;//kernel.Boot:2669\n        _this.fps_fpsCnt++;\n        //$LASTPOS=37002693;//kernel.Boot:2693\n        _this.frameSkipped=0;\n        \n      } else {\n        //$LASTPOS=37002732;//kernel.Boot:2732\n        _this.frameSkipped++;\n        \n      }\n      //$LASTPOS=37002760;//kernel.Boot:2760\n      Tonyu.globals.$Sprites.checkHit();\n      //$LASTPOS=37002786;//kernel.Boot:2786\n      _this.fps_rpsCnt++;\n      //$LASTPOS=37002806;//kernel.Boot:2806\n      _this.measureFps();\n      //$LASTPOS=37002825;//kernel.Boot:2825\n      _this.waitFrame();\n      //$LASTPOS=37002852;//kernel.Boot:2852\n      while (_this.paused) {\n        //$LASTPOS=37002877;//kernel.Boot:2877\n        _this.waitFor(Tonyu.timeout(1));\n        //$LASTPOS=37002913;//kernel.Boot:2913\n        if (! _this.paused) {\n          //$LASTPOS=37002926;//kernel.Boot:2926\n          _this.resetDeadLine();\n        }\n        \n      }\n      \n    }\n  },\n  fiber$main :function _trc_func_37000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_37000000_2(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=37001664;//kernel.Boot:1664\n          _this.fiber$initSounds(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=37001679;//kernel.Boot:1679\n          _this.fiber$initSprites(_thread);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=37001695;//kernel.Boot:1695\n          Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;\n          //$LASTPOS=37001726;//kernel.Boot:1726\n          Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);\n          //$LASTPOS=37001763;//kernel.Boot:1763\n          _this.fiber$initThread(_thread);\n          __pc=3;return;\n        case 3:\n          \n          //$LASTPOS=37001780;//kernel.Boot:1780\n          Tonyu.globals.$pat_fruits=30;\n          //$LASTPOS=37001797;//kernel.Boot:1797\n          Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;\n          //$LASTPOS=37001814;//kernel.Boot:1814\n          Tonyu.globals.$Math=Math;\n          //$LASTPOS=37001827;//kernel.Boot:1827\n          Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.Panel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n          //$LASTPOS=37001937;//kernel.Boot:1937\n          Tonyu.globals.$consolePrintY=465-15;\n          //$LASTPOS=37001961;//kernel.Boot:1961\n          Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});\n          //$LASTPOS=37002101;//kernel.Boot:2101\n          if (typeof  SplashScreen!="undefined") {\n            //$LASTPOS=37002139;//kernel.Boot:2139\n            SplashScreen.hide();\n          }\n          //$LASTPOS=37002161;//kernel.Boot:2161\n          _this.initFPSParams();\n          //$LASTPOS=37002181;//kernel.Boot:2181\n        case 4:\n          //$LASTPOS=37002201;//kernel.Boot:2201\n          _this.thg.steps();\n          //$LASTPOS=37002219;//kernel.Boot:2219\n          Tonyu.globals.$Keys.update();\n          //$LASTPOS=37002240;//kernel.Boot:2240\n          Tonyu.globals.$InputDevice.update();\n          //$LASTPOS=37002268;//kernel.Boot:2268\n          Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;\n          //$LASTPOS=37002301;//kernel.Boot:2301\n          Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;\n          //$LASTPOS=37002338;//kernel.Boot:2338\n          _this.doDraw=_this.now()<_this.deadLine;\n          //$LASTPOS=37002366;//kernel.Boot:2366\n          if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {\n            //$LASTPOS=37002420;//kernel.Boot:2420\n            _this.doDraw=true;\n            //$LASTPOS=37002442;//kernel.Boot:2442\n            _this.resetDeadLine();\n            \n          }\n          //$LASTPOS=37002471;//kernel.Boot:2471\n          if (_this.doDraw) {\n            //$LASTPOS=37002514;//kernel.Boot:2514\n            Tonyu.globals.$Screen.fillCanvas(Tonyu.globals.$Screen.buf[0]);\n            //$LASTPOS=37002559;//kernel.Boot:2559\n            Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n            //$LASTPOS=37002599;//kernel.Boot:2599\n            Tonyu.globals.$FrontSprites.draw(Tonyu.globals.$Screen.buf[0]);\n            //$LASTPOS=37002644;//kernel.Boot:2644\n            Tonyu.globals.$Screen.draw();\n            //$LASTPOS=37002669;//kernel.Boot:2669\n            _this.fps_fpsCnt++;\n            //$LASTPOS=37002693;//kernel.Boot:2693\n            _this.frameSkipped=0;\n            \n          } else {\n            //$LASTPOS=37002732;//kernel.Boot:2732\n            _this.frameSkipped++;\n            \n          }\n          //$LASTPOS=37002760;//kernel.Boot:2760\n          Tonyu.globals.$Sprites.checkHit();\n          //$LASTPOS=37002786;//kernel.Boot:2786\n          _this.fps_rpsCnt++;\n          //$LASTPOS=37002806;//kernel.Boot:2806\n          _this.measureFps();\n          //$LASTPOS=37002825;//kernel.Boot:2825\n          _this.fiber$waitFrame(_thread);\n          __pc=5;return;\n        case 5:\n          \n          //$LASTPOS=37002852;//kernel.Boot:2852\n        case 6:\n          if (!(_this.paused)) { __pc=8; break; }\n          //$LASTPOS=37002877;//kernel.Boot:2877\n          _this.fiber$waitFor(_thread, Tonyu.timeout(1));\n          __pc=7;return;\n        case 7:\n          \n          //$LASTPOS=37002913;//kernel.Boot:2913\n          if (! _this.paused) {\n            //$LASTPOS=37002926;//kernel.Boot:2926\n            _this.resetDeadLine();\n          }\n          __pc=6;break;\n        case 8:\n          \n          __pc=4;break;\n        case 9:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  update :function _trc_func_37000187_3() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=37000204;//kernel.Boot:204\n    _this.waitFor(Tonyu.timeout(50));\n  },\n  fiber$update :function _trc_func_37000187_4(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_37000187_5(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=37000204;//kernel.Boot:204\n          _this.fiber$waitFor(_thread, Tonyu.timeout(50));\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initSprites :function _trc_func_37000263_6() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var a;\n    var rs;\n    var r;\n    var name;\n    var val;\n    var _it_243;\n    \n    //$LASTPOS=37000285;//kernel.Boot:285\n    Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites();\n    //$LASTPOS=37000314;//kernel.Boot:314\n    Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites();\n    //$LASTPOS=37000348;//kernel.Boot:348\n    _this.print("Loading plugins..");\n    //$LASTPOS=37000382;//kernel.Boot:382\n    a = _this.asyncResult();\n    //$LASTPOS=37000408;//kernel.Boot:408\n    Tonyu.globals.$currentProject.loadPlugins(a.receiver);\n    //$LASTPOS=37000454;//kernel.Boot:454\n    _this.waitFor(a);\n    //$LASTPOS=37000471;//kernel.Boot:471\n    _this.print("Loading pats..");\n    //$LASTPOS=37000502;//kernel.Boot:502\n    rs = Tonyu.globals.$currentProject.getResource();\n    //$LASTPOS=37000545;//kernel.Boot:545\n    a=_this.asyncResult();\n    //$LASTPOS=37000567;//kernel.Boot:567\n    ImageList.load(rs.images,a.receiver,{baseDir: Tonyu.globals.$currentProject.getDir()});\n    //$LASTPOS=37000652;//kernel.Boot:652\n    _this.waitFor(a);\n    //$LASTPOS=37000669;//kernel.Boot:669\n    r = a[0];\n    //$LASTPOS=37000686;//kernel.Boot:686\n    Tonyu.globals.$Sprites.setImageList(r);\n    //$LASTPOS=37000717;//kernel.Boot:717\n    _it_243=Tonyu.iterator(r.names,2);\n    while(_it_243.next()) {\n      name=_it_243[0];\n      val=_it_243[1];\n      \n      //$LASTPOS=37000758;//kernel.Boot:758\n      Tonyu.setGlobal(name,val);\n      \n    }\n    //$LASTPOS=37000798;//kernel.Boot:798\n    _this.print("Loading pats done.");\n    //$LASTPOS=37000833;//kernel.Boot:833\n    _this.cvj=$("canvas");\n    //$LASTPOS=37000855;//kernel.Boot:855\n    if (Tonyu.noviceMode) {\n      //$LASTPOS=37000888;//kernel.Boot:888\n      Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 600,height: 300});\n      \n    } else {\n      //$LASTPOS=37000972;//kernel.Boot:972\n      Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 465,height: 465});\n      \n    }\n  },\n  fiber$initSprites :function _trc_func_37000263_7(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var a;\n    var rs;\n    var r;\n    var name;\n    var val;\n    var _it_243;\n    \n    //$LASTPOS=37000285;//kernel.Boot:285\n    Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites();\n    //$LASTPOS=37000314;//kernel.Boot:314\n    Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites();\n    //$LASTPOS=37000348;//kernel.Boot:348\n    _this.print("Loading plugins..");\n    //$LASTPOS=37000382;//kernel.Boot:382\n    a = _this.asyncResult();\n    //$LASTPOS=37000408;//kernel.Boot:408\n    Tonyu.globals.$currentProject.loadPlugins(a.receiver);\n    \n    _thread.enter(function _trc_func_37000263_8(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=37000454;//kernel.Boot:454\n          _this.fiber$waitFor(_thread, a);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=37000471;//kernel.Boot:471\n          _this.print("Loading pats..");\n          //$LASTPOS=37000502;//kernel.Boot:502\n          rs = Tonyu.globals.$currentProject.getResource();\n          //$LASTPOS=37000545;//kernel.Boot:545\n          a=_this.asyncResult();\n          //$LASTPOS=37000567;//kernel.Boot:567\n          ImageList.load(rs.images,a.receiver,{baseDir: Tonyu.globals.$currentProject.getDir()});\n          //$LASTPOS=37000652;//kernel.Boot:652\n          _this.fiber$waitFor(_thread, a);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=37000669;//kernel.Boot:669\n          r = a[0];\n          //$LASTPOS=37000686;//kernel.Boot:686\n          Tonyu.globals.$Sprites.setImageList(r);\n          //$LASTPOS=37000717;//kernel.Boot:717\n          _it_243=Tonyu.iterator(r.names,2);\n          while(_it_243.next()) {\n            name=_it_243[0];\n            val=_it_243[1];\n            \n            //$LASTPOS=37000758;//kernel.Boot:758\n            Tonyu.setGlobal(name,val);\n            \n          }\n          //$LASTPOS=37000798;//kernel.Boot:798\n          _this.print("Loading pats done.");\n          //$LASTPOS=37000833;//kernel.Boot:833\n          _this.cvj=$("canvas");\n          //$LASTPOS=37000855;//kernel.Boot:855\n          if (Tonyu.noviceMode) {\n            //$LASTPOS=37000888;//kernel.Boot:888\n            Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 600,height: 300});\n            \n          } else {\n            //$LASTPOS=37000972;//kernel.Boot:972\n            Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 465,height: 465});\n            \n          }\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initSounds :function _trc_func_37001044_9() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=37001065;//kernel.Boot:1065\n    _this.print("Loading sounds...");\n    //$LASTPOS=37001099;//kernel.Boot:1099\n    _this.initT2MediaPlayer();\n    //$LASTPOS=37001125;//kernel.Boot:1125\n    _this.loadFromProject(Tonyu.globals.$currentProject);\n    //$LASTPOS=37001164;//kernel.Boot:1164\n    _this.print("Loading sounds done.");\n  },\n  fiber$initSounds :function _trc_func_37001044_10(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    //$LASTPOS=37001065;//kernel.Boot:1065\n    _this.print("Loading sounds...");\n    \n    _thread.enter(function _trc_func_37001044_11(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=37001099;//kernel.Boot:1099\n          _this.fiber$initT2MediaPlayer(_thread);\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=37001125;//kernel.Boot:1125\n          _this.fiber$loadFromProject(_thread, Tonyu.globals.$currentProject);\n          __pc=2;return;\n        case 2:\n          \n          //$LASTPOS=37001164;//kernel.Boot:1164\n          _this.print("Loading sounds done.");\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initThread :function _trc_func_37001204_12() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var o;\n    var mainClassName;\n    \n    //$LASTPOS=37001225;//kernel.Boot:1225\n    Tonyu.globals.$mainThreadGroup=_this.thg=Tonyu.threadGroup();\n    //$LASTPOS=37001272;//kernel.Boot:1272\n    o = Tonyu.currentProject.getOptions();\n    //$LASTPOS=37001318;//kernel.Boot:1318\n    mainClassName = o.run.mainClass;\n    //$LASTPOS=37001358;//kernel.Boot:1358\n    _this.print("MainClass= "+mainClassName);\n    //$LASTPOS=37001399;//kernel.Boot:1399\n    _this.mainClass=Tonyu.getClass(mainClassName);\n    //$LASTPOS=37001445;//kernel.Boot:1445\n    if (! _this.mainClass) {\n      //$LASTPOS=37001472;//kernel.Boot:1472\n      TError(mainClassName+" というクラスはありません","不明",0).raise();\n      \n    }\n    //$LASTPOS=37001550;//kernel.Boot:1550\n    Tonyu.runMode=true;\n    //$LASTPOS=37001575;//kernel.Boot:1575\n    Tonyu.globals.$currentThreadGroup=_this.thg;\n    //$LASTPOS=37001605;//kernel.Boot:1605\n    new _this.mainClass();\n  },\n  fiber$initThread :function _trc_func_37001204_13(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var o;\n    var mainClassName;\n    \n    //$LASTPOS=37001225;//kernel.Boot:1225\n    Tonyu.globals.$mainThreadGroup=_this.thg=Tonyu.threadGroup();\n    //$LASTPOS=37001272;//kernel.Boot:1272\n    o = Tonyu.currentProject.getOptions();\n    //$LASTPOS=37001318;//kernel.Boot:1318\n    mainClassName = o.run.mainClass;\n    //$LASTPOS=37001358;//kernel.Boot:1358\n    _this.print("MainClass= "+mainClassName);\n    //$LASTPOS=37001399;//kernel.Boot:1399\n    _this.mainClass=Tonyu.getClass(mainClassName);\n    //$LASTPOS=37001445;//kernel.Boot:1445\n    if (! _this.mainClass) {\n      //$LASTPOS=37001472;//kernel.Boot:1472\n      TError(mainClassName+" というクラスはありません","不明",0).raise();\n      \n    }\n    //$LASTPOS=37001550;//kernel.Boot:1550\n    Tonyu.runMode=true;\n    //$LASTPOS=37001575;//kernel.Boot:1575\n    Tonyu.globals.$currentThreadGroup=_this.thg;\n    //$LASTPOS=37001605;//kernel.Boot:1605\n    new _this.mainClass();\n    \n    _thread.retVal=_this;return;\n  },\n  stop :function _trc_func_37001626_14() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=37001641;//kernel.Boot:1641\n    _this.fireEvent("stop");\n  },\n  fiber$stop :function _trc_func_37001626_15(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.enter(function _trc_func_37001626_16(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=37001641;//kernel.Boot:1641\n          _this.fiber$fireEvent(_thread, "stop");\n          __pc=1;return;\n        case 1:\n          \n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  initFPSParams :function _trc_func_37002956_17() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=37003006;//kernel.Boot:3006\n    _this._fps=30;\n    //$LASTPOS=37003022;//kernel.Boot:3022\n    _this.maxframeSkip=5;\n    //$LASTPOS=37003072;//kernel.Boot:3072\n    _this.frameCnt=0;\n    //$LASTPOS=37003091;//kernel.Boot:3091\n    _this.resetDeadLine();\n    //$LASTPOS=37003113;//kernel.Boot:3113\n    Tonyu.globals.$Boot=_this;\n    //$LASTPOS=37003132;//kernel.Boot:3132\n    _this.lastMeasured=_this.now();\n    //$LASTPOS=37003157;//kernel.Boot:3157\n    _this.fps_fps=_this.fps_rps=_this.fps_fpsCnt=_this.fps_rpsCnt=0;\n  },\n  now :function _trc_func_37003202_18() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return new Date().getTime();\n  },\n  resetDeadLine :function _trc_func_37003256_19() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=37003287;//kernel.Boot:3287\n    _this.deadLine=_this.now()+1000/_this._fps;\n    //$LASTPOS=37003318;//kernel.Boot:3318\n    _this.frameSkipped=0;\n  },\n  waitFrame :function _trc_func_37003342_20() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    var wt;\n    \n    //$LASTPOS=37003362;//kernel.Boot:3362\n    wt = _this.deadLine-_this.now();\n    //$LASTPOS=37003390;//kernel.Boot:3390\n    if (wt<1) {\n      //$LASTPOS=37003411;//kernel.Boot:3411\n      if (wt<- 1000) {\n        //$LASTPOS=37003425;//kernel.Boot:3425\n        _this.resetDeadLine();\n      }\n      //$LASTPOS=37003451;//kernel.Boot:3451\n      wt=1;\n      \n    }\n    //$LASTPOS=37003469;//kernel.Boot:3469\n    wt=_this.floor(wt);\n    //$LASTPOS=37003488;//kernel.Boot:3488\n    _this.waitFor(Tonyu.timeout(wt));\n    //$LASTPOS=37003521;//kernel.Boot:3521\n    _this.deadLine+=1000/_this._fps;\n  },\n  fiber$waitFrame :function _trc_func_37003342_21(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    var wt;\n    \n    //$LASTPOS=37003362;//kernel.Boot:3362\n    wt = _this.deadLine-_this.now();\n    //$LASTPOS=37003390;//kernel.Boot:3390\n    if (wt<1) {\n      //$LASTPOS=37003411;//kernel.Boot:3411\n      if (wt<- 1000) {\n        //$LASTPOS=37003425;//kernel.Boot:3425\n        _this.resetDeadLine();\n      }\n      //$LASTPOS=37003451;//kernel.Boot:3451\n      wt=1;\n      \n    }\n    //$LASTPOS=37003469;//kernel.Boot:3469\n    wt=_this.floor(wt);\n    \n    _thread.enter(function _trc_func_37003342_22(_thread) {\n      if (_thread.lastEx) __pc=_thread.catchPC;\n      for(var __cnt=100 ; __cnt--;) {\n        switch (__pc) {\n        case 0:\n          //$LASTPOS=37003488;//kernel.Boot:3488\n          _this.fiber$waitFor(_thread, Tonyu.timeout(wt));\n          __pc=1;return;\n        case 1:\n          \n          //$LASTPOS=37003521;//kernel.Boot:3521\n          _this.deadLine+=1000/_this._fps;\n          _thread.exit(_this);return;\n        }\n      }\n    });\n  },\n  getFrameRate :function _trc_func_37003548_23() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this._fps;\n  },\n  setFrameRate :function _trc_func_37003634_24(fps,maxFrameSkip) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=37003681;//kernel.Boot:3681\n    _this._fps=fps;\n    //$LASTPOS=37003698;//kernel.Boot:3698\n    if (typeof  maxFrameSkip!="number") {\n      //$LASTPOS=37003733;//kernel.Boot:3733\n      maxFrameSkip=5;\n    }\n    //$LASTPOS=37003754;//kernel.Boot:3754\n    _this.maxFrameSkip=maxFrameSkip;\n    //$LASTPOS=37003793;//kernel.Boot:3793\n    _this.resetDeadLine();\n  },\n  getMeasuredFps :function _trc_func_37003843_25() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.fps_fps;\n  },\n  getMeasuredRps :function _trc_func_37003922_26() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    return _this.fps_rps;\n  },\n  measureFps :function _trc_func_37003976_27() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=37004004;//kernel.Boot:4004\n    if (_this.now()>_this.lastMeasured+1000) {\n      //$LASTPOS=37004044;//kernel.Boot:4044\n      _this.fps_fps=_this.fps_fpsCnt;\n      //$LASTPOS=37004073;//kernel.Boot:4073\n      _this.fps_rps=_this.fps_rpsCnt;\n      //$LASTPOS=37004102;//kernel.Boot:4102\n      _this.fps_fpsCnt=0;\n      //$LASTPOS=37004125;//kernel.Boot:4125\n      _this.fps_rpsCnt=0;\n      //$LASTPOS=37004148;//kernel.Boot:4148\n      _this.lastMeasured=_this.now();\n      \n    }\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.Boot,{"fullName":"kernel.Boot","namespace":"kernel","shortName":"Boot","decls":{"methods":{"main":{"nowait":false},"update":{"nowait":false},"initSprites":{"nowait":false},"initSounds":{"nowait":false},"initThread":{"nowait":false},"stop":{"nowait":false},"initFPSParams":{"nowait":true},"now":{"nowait":true},"resetDeadLine":{"nowait":true},"waitFrame":{"nowait":false},"getFrameRate":{"nowait":true},"setFrameRate":{"nowait":true},"getMeasuredFps":{"nowait":true},"getMeasuredRps":{"nowait":true},"measureFps":{"nowait":true}}}});\n\nTonyu.klass.ensureNamespace(Tonyu.classes,\'kernel\');\nTonyu.classes.kernel.DxChar=Tonyu.klass(Tonyu.classes.kernel.SpriteChar,[],{\n  main :function _trc_func_38000000_0() {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n  },\n  fiber$main :function _trc_func_38000000_1(_thread) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    //var _arguments=Tonyu.A(arguments);\n    var __pc=0;\n    \n    \n    _thread.retVal=_this;return;\n  },\n  initialize :function _trc_func_38000023_2(xx,yy,pp,ff,sz,rt,al) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=38000057;//kernel.DxChar:57\n    Tonyu.classes.kernel.SpriteChar.apply( _this, [xx,yy,pp,ff]);\n    //$LASTPOS=38000082;//kernel.DxChar:82\n    _this.scaleX=1;\n    //$LASTPOS=38000097;//kernel.DxChar:97\n    if (sz) {\n      //$LASTPOS=38000105;//kernel.DxChar:105\n      _this.scaleX=sz;\n    }\n    //$LASTPOS=38000121;//kernel.DxChar:121\n    _this.angle=0;\n    //$LASTPOS=38000135;//kernel.DxChar:135\n    if (rt) {\n      //$LASTPOS=38000143;//kernel.DxChar:143\n      _this.angle=rt;\n    }\n    //$LASTPOS=38000158;//kernel.DxChar:158\n    _this.alpha=255;\n    //$LASTPOS=38000174;//kernel.DxChar:174\n    if (al) {\n      //$LASTPOS=38000182;//kernel.DxChar:182\n      _this.alpha=al;\n    }\n  },\n  draw :function _trc_func_38000196_3(c) {\n    var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n    \n    //$LASTPOS=38000212;//kernel.DxChar:212\n    _this.rotation=_this.angle;\n    //$LASTPOS=38000233;//kernel.DxChar:233\n    Tonyu.classes.kernel.SpriteChar.prototype.draw.apply( _this, [c]);\n  },\n  __dummy: false\n});\nTonyu.klass.addMeta(Tonyu.classes.kernel.DxChar,{"fullName":"kernel.DxChar","namespace":"kernel","shortName":"DxChar","decls":{"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}});\n\n',"options.json":'{\n    "compiler":{\n        "namespace": "kernel",\n        "commentLastPos": true,\n        "outputFile": "js/concat.js"\n    }\n}\n',"thread/":'{"Scheduler.tonyu":{"lastUpdate":1429178321244}}',"thread/Scheduler.tonyu":"\n"}};
WebSite.devMode||WebSite.disableROM["ROM_k.js"]||WebSite.isNW?n.base="/ROM"+n.base:FS.mountROM(n)}(),requireSimulator.setName("Tonyu"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return Tonyu=function(){function n(){function n(){return null!=p&&v}function e(){return A}function t(){P=0}function r(n){p={prev:p,func:n}}function a(n,e,t){t||(t=[]),t=[y].concat(t);var i=0;r(function(){switch(i){case 0:n["fiber$"+e].apply(n,t),i=1;break;case 1:u(),i=2}})}function s(){if(p)try{p.func(y)}catch(n){o(n)}}function o(n){if(0==y.tryStack.length)return S(),p=null,void i(n);y.lastEx=n;for(var e=y.tryStack.pop();p;){if(e.frame===p){y.catchPC=e.catchPC;break}p=p.prev}}function l(){var n=y.lastEx;return y.lastEx=null,n}function u(n){p=p.prev,y.retVal=n}function c(n){y.tryStack.push({frame:p,catchPC:n})}function _(){y.tryStack.pop()}function h(n,e){if(t(),n.on){var r;e=e.concat(function(){r.remove(),T()}),r=n.on.apply(n,e)}}function f(e){A=!0,t(),e&&e.addTerminatedListener&&e.addTerminatedListener(function(){if(A=!1,y.group)y.group.notifyResume();else if(n())try{y.steps()}catch(e){i(e)}})}function d(n){y.group=n,n&&n.add(y)}function T(){var n=Tonyu.currentThread;for(Tonyu.currentThread=y,P=m;P-->0;)s();Tonyu.currentThread=n}function S(){v=!1}var y={enter:r,apply:a,exit:u,steps:T,step:s,isAlive:n,isWaiting:e,suspend:t,retVal:0,tryStack:[],kill:S,waitFor:f,setGroup:d,enterTry:c,exitTry:_,startCatch:l,waitEvent:h},p=null,v=!0,P=0,A=!1;return y}function e(n){var e={},t=[];return e.addTerminatedListener=function(n){t.push(n)},setTimeout(function(){t.forEach(function(n){n()})},n),e}function t(){var n=[],e=[],t=!1;return n.addTerminatedListener=function(n){t?setTimeout(n,0):e.push(n)},n.receiver=function(){t=!0;for(var e=0;e<arguments.length;e++)n[e]=arguments[e];n.notify()},n.notify=function(){e.forEach(function(n){n()})},n}function r(){function e(n){n.group=l,h?h.push(n):u.push(n)}function t(t,r,i){r||(r="main");var a=n();return a.apply(t,r,i),e(a),a}function r(){try{a()}catch(n){i(n)}}function a(){function n(n){n.isWaiting()||(_=!1,n.steps())}for(var e=u.length-1;e>=0;e--){var t=u[e];t.isAlive()&&t.group===l||u.splice(e,1)}for(_=!0,h=[],u.forEach(n);h.length>0;)w=h,h=[],w.forEach(function(e){u.push(e),n(e)});h=null}function s(){c=!1}function o(){}var l,u=[],c=!0,_=!1,h=null;return l={add:e,addObj:t,steps:r,kill:s,notifyResume:o,threads:u}}function i(n){if(!Tonyu.onRuntimeError)throw alert("エラー! at "+$LASTPOS+" メッセージ  : "+n),n;Tonyu.onRuntimeError(n)}function a(n){if(n===Function)return null;if("function"==typeof n)n.constructor=null;else if("object"==typeof n)for(var e in n)n[e]=a(n[e]);return n}function s(){var n,e,t=[];if(1==arguments.length)e=arguments[0];else if(2==arguments.length&&"function"==typeof arguments[0])n=arguments[0],e=arguments[1];else if(2==arguments.length&&arguments[0]instanceof Array)t=arguments[0],e=arguments[1];else{if(3!=arguments.length)throw console.log(arguments),"Invalid argument spec";if(n=arguments[0],!n)throw"No parent class";t=arguments[1],e=arguments[2]}e=a(e);var r=e.initialize?e.initialize:n?function(){n.apply(this,arguments)}:function(){};delete e.initialize,r.methods=e,t.forEach(function(n){if(!n.methods)throw n+" Does not have methods";for(var t in n.methods)t in e||(e[t]=n.methods[t])}),r.prototype=l(n,e),r.prototype.isTonyuObject=!0,o(r,{superClass:n?n.meta:null,includes:t.map(function(n){return n.meta})});var i=s.getMeta(r);return r.prototype.getClassInfo=function(){return i},r}function o(n,e){n.meta=n.meta||{},u(n.meta,e)}function l(n,e){return n?u(new n,e):e}function u(n,e){if(e&&"object"==typeof e)for(var t in e)n[t]=e[t];return n}function c(n,e){P[n]=e}function _(n){return P[n]}function h(n){var e=n.split("."),t=A;if(e.forEach(function(n){t&&(t=t[n])}),!t&&1==e.length){var r;for(var i in A){var a=A[i][n];if(a){if(t)throw new Error("曖昧なクラス名： "+i+"."+n+", "+r);t=a,r=i+"."+n}}}return t}function f(n,e){return function(){return e.apply(n,arguments)}}function d(n,e,t,r){if(!n)throw new Error(r+"(="+n+")のメソッド "+e+"を呼び出せません");var i=n[e];if("function"!=typeof i)throw new Error(("this"==r?"":r+".")+e+"(="+i+")はメソッドではありません");return i.apply(n,t)}function T(n,e,t){if("function"!=typeof n)throw new Error(t+"は関数ではありません");return n.apply({},e)}function S(n,e){if(n!=n||null==n)throw new Error(e+"(="+n+")は初期化されていません");return n}function y(n){for(var e=[],t=1;t<n.length;t++)e[t-1]=n[t];return e}function p(n){throw console.log("Not a tonyu object: ",n),n+" is not a tonyu object"}function v(n,e){return n in e}var m=60;s.addMeta=o,s.getMeta=function(n){return n.meta},s.ensureNamespace=function(n,e){var t,r=e.split("."),i=n;for(t=0;t<r.length;t++){var a=r[t];i[a]||(i[a]={}),i=i[a]}},s.define=function(){};var P={},A={};return Tonyu={thread:n,threadGroup:r,klass:s,bless:l,extend:u,globals:P,classes:A,setGlobal:c,getGlobal:_,getClass:h,timeout:e,asyncResult:t,bindFunc:f,not_a_tonyu_object:p,hasKey:v,invokeMethod:d,callFunc:T,checkNonNull:S,A:y}}()}),requireSimulator.setName("Tonyu.Iterator"),define(["Tonyu"],function(){function n(n,e){var t={};if(n.tonyuIterator)return n.tonyuIterator(e);if(n instanceof Array)t.i=0,t.next=1==e?function(){return t.i>=n.length?!1:(this[0]=n[t.i],t.i++,!0)}:function(){return t.i>=n.length?!1:(this[0]=t.i,this[1]=n[t.i],t.i++,!0)};else{if(!(n instanceof Object))throw console.log(n),new Error(n+" is not iterable");t.i=0;var r=[];if(1==e){for(var i in n)r.push(i);t.next=function(){return t.i>=r.length?!1:(this[0]=r[t.i],t.i++,!0)}}else{for(var i in n)r.push([i,n[i]]);t.next=function(){return t.i>=r.length?!1:(this[0]=r[t.i][0],this[1]=r[t.i][1],t.i++,!0)}}}return t}return Tonyu.iterator=n,n}),requireSimulator.setName("IndentBuffer"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return IndentBuffer=function(){var n=function(){function e(){i++;var n=t[i];if(null==n)throw console.log(t),new Error(i+"th null param: fmt="+r);return n}for(var t=arguments,r=t[0],i=0;;){var a=r.indexOf("%");if(0>a){n.buf+=r;break}n.buf+=r.substring(0,a),a++;var s=r.charAt(a);if("s"==s){var o=e();"string"==typeof o||"number"==typeof o||(null==o?o="null":o.text&&(o=o.text)),n.buf+=o,a++}else if("d"==s){var l=e();if("number"!=typeof l)throw new Error(l+" is not a number: fmt="+r);n.buf+=l,a++}else if("n"==s)n.ln(),a++;else if("{"==s)n.indent(),a++;else if("}"==s)n.dedent(),a++;else if("%"==s)n.buf+="%";else if("f"==s)e()(n),a++;else if("l"==s){var u=e();n.buf+=n.toLiteral(u),a++}else if("v"==s){var c=e();if(!c)throw new Error("Null %v");if("object"!=typeof c)throw new Error("nonobject %v:"+c);n.visitor.visit(c),a++}else if("z"==s){var _=e();if("val"in _)return void(n.buf+=_.val);_.gen||n.lazy(_),n.buf+=_.gen,a++}else if("j"==s){var h=e(),f=h[0],d=h[1],T=!1;if(!d||!d.forEach)throw console.log(d),new Error(d+" is not array. cannot join fmt:"+r);d.forEach(function(e){T&&n.printf(f),T=!0,n.visitor.visit(e)}),a++}else"D"==s?(e(),a++):a+=2;r=r.substring(a)}};return n.print=function(e){n.buf+=e},n.printf=n,n.buf="",n.lazy=function(e){return e||(e={}),e.gen=("GENERETID"+Math.random()+"DITERENEG").replace(/\W/g,""),e.reg=new RegExp(e.gen,"g"),e.put=function(e){return this.val=e,n.buf=n.buf.replace(this.reg,e),e},e},n.ln=function(){n.buf+="\n"+n.indentBuf},n.indent=function(){n.indentBuf+=n.indentStr,n.buf+="\n"+n.indentBuf},n.dedent=function(){var e=n.indentStr.length;if(!n.buf.substring(n.buf.length-e).match(/^\s*$/))throw console.log(n.buf),new Error("Non-space truncated ");n.buf=n.buf.substring(0,n.buf.length-e),n.indentBuf=n.indentBuf.substring(0,n.indentBuf.length-e)},n.toLiteral=function(n,e){return e||(e="'"),n=n.replace(/\\/g,"\\\\"),n=n.replace(/\r/g,"\\r"),n=n.replace(/\n/g,"\\n"),n="'"==e?n.replace(/'/g,"\\'"):n.replace(/"/g,'\\"'),e+n+e},n.indentBuf="",n.indentStr="  ",n}}),requireSimulator.setName("disp"),"function"!=typeof define&&(define=require("requirejs").define),define(["IndentBuffer"],function(n){return disp=function(e){function t(n){if(null==n)return r("null%n");if("string"==typeof n)return r("'%s'%n",n);if("number"==typeof n)return r("%s%n",n);if("function"==typeof n)return r("func%n");r(n instanceof Array?"[%{":"{%{");var e="";for(var i in n)r(e+i+":"),t(n[i]);r(n instanceof Array?"%}]%n":"%}}%n")}var r=n();return t(e),r.buf}}),requireSimulator.setName("Parser"),"function"!=typeof define&&(define=require("requirejs").define),define(["disp"],function(){return Parser=function(){function n(n,e){var t;for(t in e)n[t]=e[t];return n}function e(n){this.parse=i.options.traceTap?function(e){console.log("tap: name="+this.name+"  pos="+(e?e.pos:"?"));var t=n.apply(this,[e]),r="NOIMG";return t.src&&t.src.str&&(r=t.src.str.substring(t.pos-3,t.pos)+"^"+t.src.str.substring(t.pos,t.pos+3)),t.src&&t.src.tokens&&(r=t.src.tokens[t.pos-1]+"["+t.src.tokens[t.pos]+"]"+t.src.tokens[t.pos+1]),console.log("/tap: name="+this.name+" pos="+(e?e.pos:"?")+"->"+(t?t.pos:"?")+" "+r+" res="+(t?t.success:"?")),t}:n}function t(n,e){if(null==n)throw e+" is null!";return n}function r(n,e){null!=n&&(this.src={maxPos:0,global:e},"string"==typeof n&&(this.src.str=n),n instanceof Array&&(this.src.tokens=n),this.pos=0,this.result=[],this.success=!0)}var i={consoleBuffer:"",options:{traceTap:!1,optimizeFirst:!0,profile:!1,verboseFirst:!1,traceFirstTbl:!1},Parser:e,StringParser:a,nc:t};i.dispTbl=function(n){var e="",t={};if(!n)return e;for(var r in n){var i=n[r].name;t[i]||(t[i]=""),t[i]+=r}for(var i in t)e+=t[i]+"->"+i+",";return e},e.create=function(n){return new e(n)},i.create=e.create,n(e.prototype,{except:function(n){var t=this;return this.ret(e.create(function(e){return n.apply({},e.result)&&(e.success=!1),e}).setName("(except "+t.name+")"))},noFollow:function(n){var r=this;return t(n,"p"),this.ret(e.create(function(e){var t=n.parse(e);return e.success=!t.success,e}).setName("("+r.name+" noFollow "+n.name+")"))},andNoUnify:function(n){t(n,"next");var r=this,i=e.create(function(e){var t=r.parse(e);if(!t.success)return t;var i=n.parse(t);return i.success&&(i.result=t.result.concat(i.result)),i});return i.setName("("+this.name+" "+n.name+")")},and:function(n){var t=this.andNoUnify(n);if(!this._first)return t;var r=this._first.tbl,a={};for(var s in r)a[s]=r[s].andNoUnify(n);return t=e.fromFirst(this._first.space,a),t.setName("("+this.name+" >> "+n.name+")"),i.options.verboseFirst&&console.log("Created aunify name="+t.name+" tbl="+i.dispTbl(a)),t},retNoUnify:function(n){var t,r=this;t="function"==typeof n?e.create(function(e){var t=e.clone();return t.result=[n.apply({},e.result)],t}).setName("retfunc"):n;var i=e.create(function(n){var e=r.parse(n);return e.success?t.parse(e):e}).setName("("+this.name+" >= "+t.name+")");return i},ret:function(n){if(!this._first)return this.retNoUnify(n);var t=this._first.tbl,r={};for(var a in t)r[a]=t[a].retNoUnify(n);return res=e.fromFirst(this._first.space,r),res.setName("("+this.name+" >>= "+n.name+")"),i.options.verboseFirst&&console.log("Created runify name="+res.name+" tbl="+i.dispTbl(r)),res},first:function(n,t){if(!i.options.optimizeFirst)return this;if(null==n)throw"Space is null2!";if("string"==typeof t){for(var r={},a=0;a<t.length;a++)r[t.substring(a,a+1)]=this;return e.fromFirst(n,r).setName("(fst "+this.name+")")}if(null==t)return e.fromFirst(n,{ALL:this}).setName("(fst "+this.name+")");if("object"==typeof t)throw"this._first={space: space, tbl:ct}";return this},firstTokens:function(n){if(!i.options.optimizeFirst)return this;"string"==typeof n&&(n=[n]);var t={};if(n){var r=this;n.forEach(function(n){t[n]=r})}else t.ALL=this;return e.fromFirstTokens(t).setName("(fstT "+this.name+")")},unifyFirst:function(t){function r(n,e){return n?e?n.orNoUnify(e).checkTbl():n:e}function a(){var n=t._first.tbl,e={};for(var i in s)e[i]=1;for(var i in n)e[i]=1;delete e.ALL,(s.ALL||n.ALL)&&(s.ALL=r(s.ALL,n.ALL));for(var i in e)s[i]&&n[i]?s[i]=r(s[i],n[i]):s[i]&&!n[i]?s[i]=r(s[i],n.ALL):!s[i]&&n[i]&&(s[i]=r(s.ALL,n[i]))}var s={};this.checkTbl(),t.checkTbl(),n(s,this._first.tbl),a();var o=e.fromFirst(this._first.space,s).setName("("+this.name+")U("+t.name+")");return i.options.verboseFirst&&console.log("Created unify name="+o.name+" tbl="+i.dispTbl(s)),o},or:function(n){return t(n,"other"),this._first&&n._first&&this._first.space&&this._first.space===n._first.space?this.unifyFirst(n):(i.options.verboseFirst&&console.log("Cannot unify"+this.name+" || "+n.name+" "+this._first+" - "+n._first),this.orNoUnify(n))},orNoUnify:function(n){var t=this,r=e.create(function(e){var r=t.parse(e);if(r.success)return r;var i=n.parse(e);return i});return r.name="("+this.name+")|("+n.name+")",r},setName:function(n){return this.name=n,this._first,this},profile:function(n){return i.options.profile&&(this.parse=this.parse.profile(n||this.name)),this},repN:function(n){var t=this;n||(n=0);var r=e.create(function(e){for(var r=e,i=[];;){var a=t.parse(r);if(!a.success){var s;return i.length>=n?(s=r.clone(),s.result=[i],s.success=!0,s):(s=e.clone(),s.success=!1,s)}i.push(a.result[0]),r=a}});return r.setName("("+t.name+" * "+n+")")},rep0:function(){return this.repN(0)},rep1:function(){return this.repN(1)},opt:function(){var n=this;return e.create(function(e){var t=n.parse(e);return t.success?t:(e=e.clone(),e.success=!0,e.result=[null],e)}).setName("("+n.name+")?")},sep1:function(n,e){var r=this;t(r,"value"),t(n,"sep");var i=n.and(r).ret(function(n,t){return e?t:{sep:n,value:t}});return r.and(i.rep0()).ret(function(n,t){var r;if(e){var i=[n];for(r in t)i.push(t[r]);return i}return{head:n,tails:t}}).setName("(sep1 "+r.name+"~~"+n.name+")")},sep0:function(n){return this.sep1(n,!0).opt().ret(function(n){return n?n:[]})},tap:function(n){return this},retN:function(n){return this.ret(function(){return arguments[n]})},parseStr:function(n,e){var t=new r(n,e);return this.parse(t)},checkTbl:function(){if(!this._first)return this;var n=this._first.tbl;for(var e in n)if(!n[e].parse)throw this.name+": tbl."+e+" is not a parser :"+n[e];return this}}),n(r.prototype,{clone:function(){var n=new r;return n.src=this.src,n.pos=this.pos,n.result=this.result.slice(),n.success=this.success,n},updateMaxPos:function(n){n>this.src.maxPos&&(this.src.maxPos=n)},isSuccess:function(){return this.success},getGlobal:function(){return this.src.global||(this.src.global={}),this.src.global}}),e.fromFirst=function(n,t){if("TOKEN"==n)return e.fromFirstTokens(t);var r=e.create(function(e){var r=n.parse(e),a=r.src.str.substring(r.pos,r.pos+1);return i.options.traceFirstTbl&&console.log(this.name+": first="+a+" tbl="+(t[a]?t[a].name:"-")),t[a]?t[a].parse(r):t.ALL?t.ALL.parse(r):(r.success=!1,r)});return r._first={space:n,tbl:t},r.checkTbl(),r},e.fromFirstTokens=function(n){var t=e.create(function(e){var t=e.src.tokens[e.pos],r=t?t.type:null;return i.options.traceFirstTbl&&console.log(this.name+": firstT="+r+" tbl="+(n[r]?n[r].name:"-")),null!=r&&n[r]?n[r].parse(e):n.ALL?n.ALL.parse(e):(e.success=!1,e)});return t._first={space:"TOKEN",tbl:n},t.checkTbl(),t};var a={empty:e.create(function(n){var e=n.clone();return e.success=!0,e.result=[null],e}).setName("E"),fail:e.create(function(n){return n.success=!1,n}).setName("F"),str:function(n){return this.strLike(function(e,t){return e.substring(t,t+n.length)===n?{len:n.length}:null}).setName(n)},reg:function(n){return(n+"").match(/^\/\^/)||console.log("Waring regex should have ^ at the head:"+(n+"")),this.strLike(function(e,t){var r=n.exec(e.substring(t));return r?(r.len=r[0].length,r):null}).setName(n+"")},strLike:function(t){return e.create(function(e){var r=e.src.str;if(null==r)throw"strLike: str is null!";var a=e.pos,s=t(r,a,e);if(i.options.traceToken&&console.log("pos="+a+" r="+s),s){i.options.traceToken&&console.log("str:succ"),s.pos=a,s.src=e.src;var o=e.clone();return n(o,{pos:a+s.len,success:!0,result:[s]}),e.updateMaxPos(o.pos),o}return i.options.traceToken&&console.log("str:fail"),e.success=!1,e}).setName("STRLIKE")},parse:function(n,e,t){var i=new r(e,t);return n.parse(i)}};a.eof=a.strLike(function(n,e){return e==n.length?{len:0}:null}).setName("EOF"),i.StringParser=a;var s={token:function(n){return e.create(function(e){var t=e.src.tokens[e.pos];return e.success=!1,t?(t.type==n&&(e=e.clone(),e.updateMaxPos(e.pos),e.pos++,e.success=!0,e.result=[t]),e):e}).setName(n).firstTokens(n)},parse:function(n,e,t){var i=new r(e,t);return n.parse(i)},eof:e.create(function(n){var e=n.pos>=n.src.tokens.length;return n.success=e,e&&(n=n.clone(),n.result=[{type:"EOF"}]),n}).setName("EOT")};return i.TokensParser=s,i.lazy=function(n){var t=null;return e.create(function(e){if(t||(t=n()),!t)throw n+" returned null!";return this.name=n.name,t.parse(e)}).setName("LZ")},i.addRange=function(n,e){if(null==e)return n;if("number"!=typeof n.pos)return n.pos=e.pos,n.len=e.len,n;var t=e.pos+e.len,r=n.pos+n.len;return e.pos<n.pos&&(n.pos=e.pos),t>r&&(n.len=t-n.pos),n},i.setRange=function(n){if(null!=n&&"string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n){var e=i.getRange(n);if(null!=e)return n;for(var t in n)if(n.hasOwnProperty(t)){var r=i.setRange(n[t]);i.addRange(n,r)}return n}},i.getRange=function(n){return null==n?null:"number"!=typeof n.pos?null:"number"==typeof n.len?n:null},i}()}),requireSimulator.setName("Grammar"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(n){return Grammar=function(){function e(n){return"string"==typeof n?r.get(n):n}var t=n,r=null;return r=function(t){var i={};return i.ands=function(){for(var i=e(arguments[0]),a=1;a<arguments.length;a++)i=i.and(e(arguments[a]));i=i.tap(t),r.defs[t]=i;var s={};return s.autoNode=function(){var e=i.ret(function(){for(var e={type:t},r=0;r<arguments.length;r++){var i=arguments[r],a=n.setRange(i);n.addRange(e,a),e["-element"+r]=i}e.toString=function(){return"("+this.type+")"}}).setName(t);return r.defs[t]=e},s.ret=function(e){if(0==arguments.length)return i;if("function"==typeof e)return r.defs[t]=i.ret(e);for(var a=[],s=function(n){return n},o=0;o<arguments.length;o++){if("function"==typeof arguments[o]){s=arguments[o];break}a[o]=arguments[o]}var l=i.ret(function(){var e={type:t};e[Grammar.SUBELEMENTS]=[];for(var r=0;r<arguments.length;r++){var i=arguments[r],o=n.setRange(i);n.addRange(e,o),a[r]&&(e[a[r]]=i),e[Grammar.SUBELEMENTS].push(i)}return e.toString=function(){return"("+this.type+")"},s(e)}).setName(t);return r.defs[t]=l},s},i.ors=function(){for(var n=e(arguments[0]),i=1;i<arguments.length;i++)n=n.or(e(arguments[i]));return r.defs[t]=n.setName(t)},i},r.defs={},r.get=function(n){return r.defs[n]?r.defs[n]:t.lazy(function(){var e=r.defs[n];if(!e)throw"grammar named '"+n+"' is undefined";return e}).setName("(Lazy of "+n+")")},r},Grammar.SUBELEMENTS="[SUBELEMENTS]",Grammar}),requireSimulator.setName("XMLBuffer"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(n){return XMLBuffer=function(e){var t;return t=function(r,i){if(null!=r&&"string"!=typeof r&&"number"!=typeof r){var a=n.getRange(r);if(a)for(;t.srcLen<a.pos;)t.src(e.substring(t.srcLen,a.pos));if(null!=r){if(i&&t.tag("<attr_"+i+">"),r.type&&t.tag("<"+r.type+">"),r.text)t.src(a.text);else{var s=t.orderByPos(r);s.forEach(function(n){n.name&&n.name.match(/^-/)?t(n.value):t(n.value,n.name)})}if(a)for(;t.srcLen<a.pos+a.len;)t.src(e.substring(t.srcLen,a.pos+a.len));r.type&&t.tag("</"+r.type+">"),i&&t.tag("</attr_"+i+">")}}},t.orderByPos=XMLBuffer.orderByPos,t.src=function(n){t.buf+=n.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"),t.srcLen+=n.length},t.tag=function(n){t.buf+=n},t.buf="",t.srcLen=0,t},XMLBuffer.orderByPos=function(n){var e=[];if(n[XMLBuffer.SUBELEMENTS])n[XMLBuffer.SUBELEMENTS].forEach(function(n){e.push(n)});else for(var t in n)n.hasOwnProperty(t)&&null!=n[t]&&"string"!=typeof n[t]&&"number"!=typeof n[t]&&"number"==typeof n[t].pos&&e.push(isNaN(parseInt(t))&&!(t+"").match(/-/)?{name:t,value:n[t]}:{value:n[t]});return e=e.sort(function(n,e){return n.value.pos-e.value.pos})},XMLBuffer.SUBELEMENTS="[SUBELEMENTS]",XMLBuffer}),requireSimulator.setName("TError"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return TError=function(n,e,t){if("string"==typeof e)return{isTError:!0,mesg:n,src:{name:function(){return e},text:function(){return e}},pos:t,toString:function(){return this.mesg+" at "+e+":"+this.pos},raise:function(){throw this}};var r=null;if(e&&e.src&&(r=e,e=r.src.tonyu),"function"!=typeof e.name)throw"src="+e+" should be file object";var i;if("function"==typeof e.text){var a=e.text();"string"==typeof a&&(i=TError.calcRowCol(a,t))}return{isTError:!0,mesg:n,src:e,pos:t,row:i.row,col:i.col,klass:r,toString:function(){return this.mesg+" at "+this.src.name()+":"+this.row+":"+this.col},raise:function(){throw this}}},TError.calcRowCol=function(n,e){var t,r,i=n.split("\n"),a=0;for(t=0;t<i.length;t++)if(a+=i[t].length+1,a>e){r=e-(a-i[t].length);break}return{row:t,col:r}},TError}),requireSimulator.setName("TT"),"function"!=typeof define&&(define=require("requirejs").define),define(["Grammar","XMLBuffer","IndentBuffer","disp","Parser","TError"],function(n,e,t,r,i){return TT=function(){function n(n,e){var t,i;"string"==typeof n?(t=o.str(n),n.length>0&&(i=n.substring(0,1)),e||(e=n)):(t=o.reg(n),e||(e=n+""));var a=_.and(t).ret(function(n,t){var i={};if(i.pos=t.pos,"number"!=typeof i.pos)throw"no pos for "+e+" "+r(t);if(i.len=t.len,i.text=t.src.str.substring(i.pos,i.pos+i.len),"string"!=typeof i.text)throw"no text("+i.text+") for "+e+" "+r(t);return i.toString=function(){return this.text},i});return i&&(a=a.first(_,i)),a.setName(e)}function e(e,t,r){"string"==typeof r&&(r=n(r)),h[e]=a(h[e],r.ret(function(n){return n.type=t,n}).setName(t))}function t(n,t,r,i){t==l&&(t=r);for(var a=1;n>=a;a*=2)0!=(n&a)&&e(n&a,t,r,i);f[t]=i}function a(n,e){return n?n.or(e):e}function s(n){var e=((new Date).getTime(),i.StringParser.parse(d,n));return e.success||console.log("Stopped at "+n.substring(e.src.maxPos-5,e.src.maxPos+5)),"object"==typeof WebSite&&WebSite.devMode&&(window.tokenStat=window.tokenStat||{},e.result[0].forEach(function(n){window.tokenStat[n.text]=window.tokenStat[n.text]||0,window.tokenStat[n.text]++})),e}var o=i.StringParser,l="SAMENAME",u=1,c=2,_=o.reg(/^(\s*(\/\*([^\/]|[^*]\/|\r|\n)*\*\/)*(\/\/.*\r?\n)*)*/).setName("space"),h={},f={},d=i.create(function(n){for(var e=c,t=[];;){if(n=h[e].parse(n),!n.success)break;var r=n.result[0];e=f[r.type],t.push(r)}return n=_.parse(n),n.success=n.src.maxPos==n.src.str.length,n.result[0]=t,n}),T={"function":!0,"var":!0,"return":!0,"typeof":!0,"if":!0,"for":!0,"else":!0,"super":!0,"while":!0,"break":!0,"do":!0,"switch":!0,"try":!0,"catch":!0,"finally":!0,"throw":!0,"in":!0,fiber:!0,"native":!0,"instanceof":!0,"new":!0,is:!0,"true":!0,"false":!0,"null":!0,"this":!0,undefined:!0,usethread:!0,constructor:!0,ifwait:!0,nowait:!0,_thread:!0,arguments:!0,"delete":!0,"extends":!0,includes:!0},S=n(/^[0-9\.]+/).ret(function(n){return n.type="number",n.value=parseInt(n.text),n}).first(_,"0123456789"),y=n({exec:function(n){var e=n.substring(0,1);if('"'!==e&&"'"!==e)return!1;for(var t=1;t<n.length;t++){var r=n.substring(t,t+1);if(r===e)return[n.substring(0,t+1)];"\\"===r&&t++}return!1},toString:function(){return"literal"}}).first(_,"\"'"),p=n({exec:function(n){if("/"!==n.substring(0,1))return!1;for(var e=1;e<n.length;e++){var t=n.substring(e,e+1);if("/"===t){var r=/^[ig]*/.exec(n.substring(e+1));return[n.substring(0,e+1+r[0].length)]}if("\n"==t)return!1;"\\"===t&&e++}return!1},toString:function(){return"regex"}}).first(_,"/");t(c|u,"number",S,u),t(c,"regex",p,u),t(c|u,"literal",y,u),t(c|u,l,"++",u),t(c|u,l,"--",u),t(c|u,l,"!==",c),t(c|u,l,"===",c),t(c|u,l,"+=",c),t(c|u,l,"-=",c),t(c|u,l,"*=",c),t(c|u,l,"/=",c),t(c|u,l,"%=",c),t(c|u,l,">=",c),t(c|u,l,"<=",c),t(c|u,l,"!=",c),t(c|u,l,"==",c),t(c|u,l,">>",c),t(c|u,l,"<<",c),t(c|u,l,"&&",c),t(c|u,l,"||",c),t(c|u,l,"(",c),t(c|u,l,")",u),t(c|u,l,"[",c),t(c|u,l,"]",u),t(c|u,l,"{",c),t(c|u,l,"}",u),t(c|u,l,">",c),t(c|u,l,"<",c),t(c|u,l,"+",c),t(c|u,l,"-",c),t(c|u,l,".",c),t(c|u,l,"?",c),t(c|u,l,"=",c),t(c|u,l,"*",c),t(c|u,l,"%",c),t(u,l,"/",c),t(u|c,l,"^",c),t(u|c,l,"~",c),t(u|c,l,"\\",c),t(u|c,l,":",c),t(u|c,l,";",c),t(u|c,l,",",c),t(c|u,l,"!",c),t(c|u,l,"&",c),t(c|u,l,"|",c);var v=n(/^[a-zA-Z_$][a-zA-Z0-9_$]*/,"symresv_reg").ret(function(n){return n.type="constructor"==n.text?"tk_constructor":T.hasOwnProperty(n.text)?n.text:"symbol",n}).first(_);for(var m in T)f[m]=c;return f.tk_constructor=c,f.symbol=u,h[c]=a(h[c],v),h[u]=a(h[u],v),{parse:s,extension:"js"}}()}),requireSimulator.setName("ExpressionParser"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(n){return ExpressionParser=function(){function e(n,e){var t={};return t.eq=function(t){return n==t.type()&&e==t.prio()},t.type=function(e){return e?e==n:n},t.prio=function(){return e},t.toString=function(){return"["+n+":"+e+"]"},t}function t(n){var e={},t=n;return e.add=function(n){t=t?t.or(n):n},e.get=function(){return t},e}function r(){var r=t(),i={};return i.reg=function(t,i,a){var s=e(t,i);r.add(a.ret(n.create(function(n){return n.opType=s,n})).setName("(opType "+s+" "+a.name+")"))},i.get=function(){return r.get()},i.parse=function(n){return i.get().parse(n)},i}function i(n,e){return}function a(n,e){var t,r=e;if(i(e," start minprio= "+n),e=o.parse(e),i(e," prefixorelem "+n),!e.isSuccess())return e;if(t=e.opType,t.type("prefix")){if(pre=e.result[0],e=a(t.prio(),e),!e.isSuccess())return e;var u=s.mkPrefix.def(pre,e.result[0]);if(r=e.clone(),r.result=[u],!e.nextPostfixOrInfix)return r;e=e.nextPostfixOrInfix}else if(r=e.clone(),e=l.parse(e),!e.isSuccess())return r;for(;;){if(i(e,"st:pi"),i(r,"res:ex"),t=e.opType,t.prio()<n)return r.nextPostfixOrInfix=e,r;if(t.type("postfix")){var u=s.mkPostfix.def(r.result[0],e.result[0]);if(r=e.clone(),r.result=[u],i(e,"185"),e=l.parse(e),!e.isSuccess())return r}else if(t.type("infixl")){var _=e.result[0];if(e=a(t.prio()+1,e),!e.isSuccess())return r;var u=s.mkInfixl.def(r.result[0],_,e.result[0]);if(r=e.clone(),r.result=[u],!e.nextPostfixOrInfix)return r;e=e.nextPostfixOrInfix}else if(t.type("infixr")){var _=e.result[0];if(e=a(t.prio(),e),!e.isSuccess())return r;var u=s.mkInfixr.def(r.result[0],_,e.result[0]);if(r=e.clone(),r.result=[u],!e.nextPostfixOrInfix)return r;e=e.nextPostfixOrInfix}else if(t.type("trifixr")){var h=r.result[0],f=e.result[0];if(e=a(t.prio()+1,e),!e.isSuccess())return r;var d=e.result[0],e=c[t.prio()].parse(e);if(!e.isSuccess())return r;var T=e.result[0];if(e=a(t.prio(),e),!e.isSuccess())return r;var S=e.result[0],u=s.mkTrifixr.def(h,f,d,T,S);if(r=e.clone(),r.result=[u],!e.nextPostfixOrInfix)return r;e=e.nextPostfixOrInfix}else{var _=e.result[0];if(e=a(t.prio()+1,e),!e.isSuccess())return r;var u=s.mkInfix.def(r.result[0],_,e.result[0]);if(r=e.clone(),r.result=[u],!e.nextPostfixOrInfix)return r;if(e=e.nextPostfixOrInfix,t.prio()==e.opType.prio())return r.success=!1,r}}}var s={},o=r(),l=r(),u=t(),c=[];return s.element=function(n){o.reg("element",-1,n),u.add(n)},s.getElement=function(){return u.get()},s.prefix=function(n,e){o.reg("prefix",n,e)},s.postfix=function(n,e){l.reg("postfix",n,e)},s.infixl=function(n,e){l.reg("infixl",n,e)},s.infixr=function(n,e){l.reg("infixr",n,e)},s.infix=function(n,e){l.reg("infix",n,e)},s.trifixr=function(n,e,t){l.reg("trifixr",n,e),c[n]=t},s.custom=function(){},s.mkInfix=function(n){s.mkInfix.def=n},s.mkInfix.def=function(e,t,r){return n.setRange({type:"infix",op:t,left:e,right:r})},s.mkInfixl=function(n){s.mkInfixl.def=n},s.mkInfixl.def=function(e,t,r){return n.setRange({type:"infixl",op:t,left:e,right:r})},s.mkInfixr=function(n){s.mkInfixr.def=n},s.mkInfixr.def=function(e,t,r){return n.setRange({type:"infixr",op:t,left:e,right:r})},s.mkPrefix=function(n){s.mkPrefix.def=n},s.mkPrefix.def=function(e,t){return n.setRange({type:"prefix",op:e,right:t})},s.mkPostfix=function(n){s.mkPostfix.def=n},s.mkPostfix.def=function(e,t){return n.setRange({type:"postfix",left:e,op:t})},s.mkTrifixr=function(n){s.mkTrifixr.def=n},s.mkTrifixr.def=function(e,t,r,i,a){return n.setRange({type:"trifixr",left:e,op1:t,mid:r,op2:i,right:a})},s.build=function(){return s.built=n.create(function(n){return a(0,n)}).setName("ExpBuilt"),s.built},s.lazy=function(){return n.create(function(n){return s.built.parse(n)})},s}}),requireSimulator.setName("TonyuLang"),"function"!=typeof define&&(define=require("requirejs").define),define(["Grammar","XMLBuffer","IndentBuffer","TT","disp","Parser","ExpressionParser","TError"],function(n,e,t,r,i,a,s,o){return TonyuLang=function(){function t(n){return function(){return arguments[n]}}function l(n,e){var t=[];if(n&&!n.args)throw i(n);if(n){var r=a.getRange(n);a.addRange(t,r),n.args.forEach(function(n){t.push(n)})}return e.forEach(function(n){var e=a.getRange(n);a.addRange(t,e),t.push(n.obj)}),t}function u(n,e,t){var r={type:"infix",left:n,op:e,right:t};return a.setRange(r),r.toString=function(){return"("+n+e+t+")"},r}var c=a,_={},h=n(),f=h.get,d=(c.StringParser,c.TokensParser.token),T=d("number").ret(function(n){if(n.type="number","string"!=typeof n.text)throw"No text for "+i(n);if(n.value=parseFloat(n.text),isNaN(n.value))throw"No value for "+i(n);return n}),S=d("symbol"),y=d("==="),p=d("!=="),v=d("=="),m=d("!="),P=d(">="),A=d("<="),k=d(">"),g=d("<"),$=d("&&"),b=d("||"),O=d("-"),L=d("+"),x=d("*"),w=d("/"),M=d("%"),j=d("="),B=d("literal"),D=d("regex"),E=s(),C=h("arrayElem").ands(d("["),E.lazy(),d("]")).ret(null,"subscript"),I=h("argList").ands(d("("),E.lazy().sep0(d(","),!0),d(")")).ret(null,"args"),N=h("member").ands(d("."),S).ret(null,"name"),V=h("parenExpr").ands(d("("),E.lazy(),d(")")).ret(null,"expr"),R=h("varAccess").ands(S).ret("name"),W=f("funcExpr").firstTokens(["function","\\"]),G=h("funcExprArg").ands(W).ret("obj"),F=f("objlit").firstTokens("{"),K=h("objlitArg").ands(F).ret("obj"),H=K.or(G),X=I.and(H.rep0()).ret(function(n,e){return l(n,e)}).or(H.rep1().ret(function(n){return l(null,n)})),z=(I.or(K),h("call").ands(X).ret("args")),U=h("scall").ands(X).ret("args"),Q=h("newExpr").ands(d("new"),R,z.opt()).ret(null,"klass","params"),Y=h("superExpr").ands(d("super"),d(".").and(S).ret(t(1)).opt(),U).ret(null,"name","params"),q=d("true").or(d("false")).or(d("null")).or(d("undefined")).or(d("_thread")).or(d("this")).or(d("arguments")).ret(function(n){return n.type="reservedConst",n});E.element(T),E.element(q),E.element(D),E.element(B),E.element(V),E.element(Q),E.element(Y),E.element(W),E.element(F),E.element(f("arylit").firstTokens("[")),E.element(R);var Z=0;E.infixr(Z,j),E.infixr(Z,d("+=")),E.infixr(Z,d("-=")),E.infixr(Z,d("*=")),E.infixr(Z,d("/=")),E.infixr(Z,d("%=")),E.infixr(Z,d("|=")),E.infixr(Z,d("&=")),Z++,E.trifixr(Z,d("?"),d(":")),Z++,E.infixl(Z,b),Z++,E.infixl(Z,$),Z++,E.infix(Z,d("instanceof")),E.infix(Z,d("is")),E.infix(Z,y),E.infix(Z,p),E.infix(Z,v),E.infix(Z,m),E.infix(Z,P),E.infix(Z,A),E.infix(Z,k),E.infix(Z,g),Z++,E.postfix(Z+3,d("++")),E.postfix(Z+3,d("--")),E.infixl(Z,O),E.infixl(Z,L),Z++,E.infixl(Z,x),E.infixl(Z,w),E.infixl(Z,M),Z++,E.prefix(Z,d("typeof")),E.prefix(Z,d("delete")),E.prefix(Z,d("++")),E.prefix(Z,d("--")),E.prefix(Z,d("+")),E.prefix(Z,d("-")),E.prefix(Z,d("!")),Z++,Z++,E.postfix(Z,z),E.postfix(Z,N),E.postfix(Z,C),E.mkInfixl(u),E.mkInfixr(u);{var J=E.build().setName("expr").profile(),t=function(n){return function(){return arguments[n]}},ne=f("stmt").firstTokens();h("exprstmt").ands(J,d(";")).ret("expr")}h("compound").ands(d("{"),ne.rep0(),d("}")).ret(null,"stmts");{var ee=d("else").and(ne).ret(t(1)),te=(h("return").ands(d("return"),J.opt(),d(";")).ret(null,"value"),h("if").ands(d("if"),d("("),J,d(")"),ne,ee.opt()).ret(null,null,"cond",null,"then","_else"),h("forin").ands(d("var").opt(),S.sep1(d(","),!0),d("in"),J).ret("isVar","vars",null,"set")),re=h("normalFor").ands(ne,J.opt(),d(";"),J.opt()).ret("init","cond",null,"next"),ie=re.or(te),ae=(h("for").ands(d("for"),d("("),ie,d(")"),"stmt").ret(null,null,"inFor",null,"loop"),h("while").ands(d("while"),d("("),J,d(")"),"stmt").ret(null,null,"cond",null,"loop"),h("break").ands(d("break"),d(";")).ret("brk"),h("finally").ands(d("finally"),"stmt").ret(null,"stmt"),h("catch").ands(d("catch"),d("("),S,d(")"),"stmt").ret(null,null,"name",null,"stmt"),h("catches").ors("catch","finally")),se=(h("try").ands(d("try"),"stmt",ae.rep1()).ret(null,"stmt","catches"),h("throw").ands(d("throw"),J,d(";")).ret(null,"ex"),h("varDecl").ands(S,d("=").and(J).ret(t(1)).opt()).ret("name","value"));
h("varsDecl").ands(d("var"),se.sep1(d(","),!0),d(";")).ret(null,"decls")}h("funcDeclHead").ands(d("nowait").opt(),d("function").or(d("fiber")).or(d("tk_constructor")).or(d("\\")).opt(),S.or(d("new")),"paramDecls").ret("nowait","ftype","name","params");h("funcDecl").ands("funcDeclHead","compound").ret("head","body"),h("nativeDecl").ands(d("native"),S,d(";")).ret(null,"name"),h("ifWait").ands(d("ifwait"),"stmt",ee.opt()).ret(null,"then","_else");ne=h("stmt").ors("return","if","for","while","break","ifWait","try","throw","nativeDecl","funcDecl","compound","exprstmt","varsDecl");var oe=h("paramDecl").ands(S).ret("name"),le=h("paramDecls").ands(d("("),oe.sep0(d(","),!0),d(")")).ret(null,"params");h("funcExprHead").ands(d("function").or(d("\\")),S.opt(),le.opt()).ret(null,"name","params");var ue=(h("funcExpr").ands("funcExprHead","compound").ret("head","body"),h("jsonElem").ands(S.or(B),d(":").and(J).ret(function(n,e){return e}).opt()).ret("key","value")),ce=(h("objlit").ands(d("{"),ue.sep0(d(","),!0),d("}")).ret(null,"elems"),h("arylit").ands(d("["),J.sep0(d(","),!0),d("]")).ret(null,"elems"),h("extends").ands(d("extends"),S.or(d("null")),d(";")).ret(null,"superClassName")),_e=h("includes").ands(d("includes"),S.sep1(d(","),!0),d(";")).ret(null,"includeClassNames"),he=h("program").ands(ce.opt(),_e.opt(),ne.rep0(),a.TokensParser.eof).ret("ext","incl","stmts");for(var fe in h.defs)h.defs[fe].profile();return _.parse=function(n){str="string"==typeof n?n:n.text(),str+="\n";var e=r.parse(str);if(!e.isSuccess())throw o("文法エラー(Token)",n,e.src.maxPos);var t=e.result[0],i=c.TokensParser.parse(he,t);if(i.isSuccess()){var a=i.result[0];return a}var s=t[i.src.maxPos],l=s?s.pos+s.len:str.length;throw o("文法エラー",n,l)},_.genXML=function(n,t){var r=e(n);return r(t),r.buf},_.extension="tonyu",_}()}),requireSimulator.setName("ObjectMatcher"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return ObjectMatcher=function(){function n(n,e){var t={};return t[i]=n,e&&(t[a]=e),t}function e(n){return n&&n[i]}function t(n,e,r){if(n===e)return!0;if(null==n)return!1;if("string"==typeof n&&e instanceof RegExp)return n.match(e);if("function"==typeof e)return e(n,r);if("object"==typeof e){for(var s in e)if(s!=i){var o=s==a?n:n[s],l=e[s];if(!t(o,l,r))return!1}return e[i]&&(r[e[i]]=n),!0}return!1}var r={},i="$var",a="$this";r.v=n,r.isVar=e;for(var s="ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=0;o<s.length;o++){var l=s.substring(o,o+1);r[l]=n(l)}return r.match=function(n,e){var r={};return t(n,e,r)?r:null},r}()}),requireSimulator.setName("context"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return context=function(){function n(n,t){var r={};for(var i in n)i.match(/^\$/)?(i=RegExp.rightContext,r[i]=e[i],e[i]=e.ovrFunc(e[i],n[i])):(r[i]=e[i],e[i]=n[i]);t(e);for(var i in r)e[i]=r[i]}var e={};return e.ovrFunc=function(n,e){return e.parent=n,e},e.enter=n,e}}),requireSimulator.setName("Visitor"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return Visitor=function(n){var e={funcs:n,path:[]};return e.visit=function(t){try{e.path.push(t),e.debug&&console.log("visit ",t.type,t.pos);var r=t?n[t.type]:null;if(r)return r.call(e,t);if(e.def)return e.def.call(e,t)}finally{e.path.pop()}},e.replace=function(n){return e.def||(e.def=function(n){if("object"==typeof n)for(var t in n)n[t]&&"object"==typeof n[t]&&(n[t]=e.visit(n[t]));return n}),e.visit(n)},e}}),requireSimulator.setName("Tonyu.Compiler"),define(["Tonyu","ObjectMatcher","TError"],function(n){function e(n,e){var t={type:n};if(e)for(var r in e)t[r]=e[r];return t.name||(t.name=a("_"+n+"_")),t}function t(n){return n?n.type:null}function r(n){var e=function(){};return e.prototype=n,new e}function i(n,e){if(!n)throw e+" is null";return n}function a(n){return n+(f++ +"").replace(/\./g,"")}function s(n,e,t){e._id||(n._idseq||(n._idseq=0),e._id=++n._idseq);var r=n[e._id];if(r||(r=n[e._id]={node:e}),t)for(var i in t)r[i]=t[i];return r}function o(n){return srcCont.substring(n.pos,n.pos+n.len)}function l(n,e){var t=null;return u(n).forEach(function(n){t||(t=n.decls.methods[e])}),t}function u(n){function e(n){t[n.fullName]||(t[n.fullName]=!0,r.push(n),n.superClass&&e(n.superClass),n.includes&&n.includes.forEach(e))}var t={},r=[];return e(n),r}function c(n){if(!n.head)return[];var e=n.head.params.params;if(!e.forEach)throw n+" is not array ";return e}var _={};n.Compiler=_;var h={FIELD:"field",METHOD:"method",NATIVE:"native",LOCAL:"local",THVAR:"threadvar",PARAM:"param",GLOBAL:"global",CLASS:"class"};_.ScopeTypes=h;var f=1;return _.newScopeType=e,_.getScopeType=t,_.newScope=r,_.nullCheck=i,_.genSym=a,_.annotation=s,_.getSource=o,_.getMethod=l,_.getDependingClasses=u,_.getParams=c,_}),requireSimulator.setName("Tonyu.Compiler.JSGenerator"),"function"!=typeof define&&(define=require("requirejs").define),define(["Tonyu","Tonyu.Iterator","TonyuLang","ObjectMatcher","TError","IndentBuffer","context","Visitor","Tonyu.Compiler"],function(n,e,t,r,i,a,s,o,l){return l.JSGenerator=function(){function n(n,l){function L(e,t){return b(n.annotation,e,t)}function x(n){return"string"==typeof n?m+(l.aliases[n]||n):n.builtin?n.fullName:m+n.fullName}function w(n){var e=[];return n.forEach(function(n){e.push(x(n))}),e}function M(n,e){return function(){U.enter(n,function(){v.visit(e)})}}function j(n,r,i){var a=$(r);if(a==ne.THVAR)X.printf("%s",e);else if(a==ne.FIELD)X.printf("%s.%s",t,n);else if(a==ne.METHOD)i&&i.noBind?X.printf("%s.%s",t,n):X.printf("%s(%s,%s.%s)",T,t,t,n);else if(a==ne.CLASS)X.printf("%s",x(n));else if(a==ne.GLOBAL)X.printf("%s%s",P,n);else{if(a!=ne.PARAM&&a!=ne.LOCAL&&a!=ne.NATIVE)throw console.log("Unknown scope type: ",a),new Error("Unknown scope type: "+a);X.printf("%s",n)}return r}function B(n){return function(){D.apply(this,[n])}}function D(n){"compound"==n.type?U.enter({noWait:!0},function(){X.printf("%j%n",["%n",n.stmts])}):v.visit(n)}function E(e){return function(){X.printf("%s%s=%s;//%s%n",l.options.compiler.commentLastPos?"//":"",h,q.add(n,e.pos),n.fullName+":"+e.pos)}}function C(){U.enter({},function(){m+n.namespace;z("Tonyu.klass.ensureNamespace(%s,%l);%n",m.replace(/\.$/,""),n.namespace),n.superClass?z("%s=Tonyu.klass(%s,[%s],{%{",x(n),x(n.superClass),w(n.includes).join(",")):z("%s=Tonyu.klass([%s],{%{",x(n),w(n.includes).join(","));for(var e in J){Q&&console.log("method1",e);var t=J[e];U.enter({noWait:!0,threadAvail:!1},function(){V(t)}),Q&&console.log("method2",e),t.nowait||U.enter({noWait:!1,threadAvail:!0},function(){N(t)}),Q&&console.log("method3",e)}z("__dummy: false%n"),z("%}});%n")}),z("Tonyu.klass.addMeta(%s,%s);%n",x(n),JSON.stringify(I(n)))}function I(n){var e={fullName:n.fullName,namespace:n.namespace,shortName:n.shortName,decls:{methods:{}}};for(var t in n.decls.methods)e.decls.methods[t]={nowait:!!n.decls.methods[t].nowait};return e}function N(n){function r(){U.enter({method:n,noWait:!0,threadAvail:!0},function(){s.forEach(function(n){z("%v%n",n)})})}function i(){U.enter({method:n,finfo:n,pc:1},function(){o.forEach(function(n){z("%v%n",n)})})}if(!K(n)){var a=n.stmts,s=[],o=[],l=s,h=!0;h?a.forEach(function(n){L(n).fiberCallRequired&&(l=o),l.push(n)}):o=a,z("%s%s :function %s(%j) {%{var %s=%s;%n%svar %s=%s;%nvar %s=0;%n%f%n%f%n",c,n.name,W(n.pos),[",",[re].concat(n.params)],t,A,n.useArgs?"":"//",u,"Tonyu.A(arguments)",_,F(n),r),o.length>0?z("%s.enter(function %s(%s) {%{if (%s.lastEx) %s=%s.catchPC;%nfor(var %s=%d ; %s--;) {%{switch (%s) {%{%}case 0:%{%f%s.exit(%s);return;%n%}}%n%}}%n%}});%n",e,W(n.pos),e,e,_,e,f,d,f,_,i,e,t):z("%s.retVal=%s;return;%n",e,t),z("%}},%n")}}function V(n){function e(){U.enter({method:n,finfo:n},function(){n.stmts.forEach(function(n){z("%v%n",n)})})}var r=K(n)?"initialize":n.name;z("%s :function %s(%j) {%{var %s=%s;%n%f%n%f%}},%n",r,W(n.pos),[",",n.params],t,A,F(n),e)}function R(n){function e(){U.enter({noWait:!0,threadAvail:!1,finfo:t},function(){n.body.stmts.forEach(function(n){z("%v%n",n)})})}var t=L(n);X.printf("function (%j) {%{%f%n%f%}}",[",",t.params],F(t),e)}function W(e){return"_trc_func_"+q.add(n,e)+"_"+ee++}function G(n){function e(){U.enter({noWait:!0,threadAvail:!1,finfo:t},function(){n.body.stmts.forEach(function(n){z("%v%n",n)})})}var t=L(n);X.printf("function %s(%j) {%{%f%n%f%}}",t.name,[",",t.params],F(t),e)}function F(n){function e(){U.enter({},function(){for(var e in n.locals.varDecls)X.printf("var %s;%n",e);for(var e in n.locals.subFuncDecls)G(n.locals.subFuncDecls[e])})}return e}function K(n){return Y.match(n,{ftype:"constructor"})||Y.match(n,{name:"new"})}var H=n.src.tonyu,X=a(),z=X.printf,U=s(),Q=!1,Y=r,q=l.traceTbl,Z=n.decls,J=(Z.fields,Z.methods),ne=(Z.natives,g),ee=0,te=l.options.compiler.diagnose,re={type:"THNode"};v=X.visitor=o({THNode:function(){X.printf(e)},dummy:function(n){X.printf("",n)},literal:function(n){X.printf("%s",n.text)},paramDecl:function(n){X.printf("%v",n.name)},paramDecls:function(n){X.printf("(%j)",[", ",n.params])},funcDeclHead:function(n){X.printf("function %v %v",n.name,n.params)},funcDecl:function(){},"return":function(n){if(U.inTry)throw i("現実装では、tryの中にreturnは書けません",H,n.pos);U.noWait?U.threadAvail?n.value?X.printf("%s.retVal=%v;return;%n",e,n.value):X.printf("%s.retVal=%s;return;%n",e,t):n.value?X.printf("return %v;",n.value):X.printf("return %s;",t):n.value?X.printf("%s.exit(%v);return;",e,n.value):X.printf("%s.exit(%s);return;",e,t)},program:function(n){genClass(n.stmts)},number:function(n){X.printf("%s",n.value)},reservedConst:function(n){"this"==n.text?X.printf("%s",t):"arguments"==n.text&&U.threadAvail?X.printf("%s",u):n.text==e?X.printf("%s",U.threadAvail?e:"null"):X.printf("%s",n.text)},varDecl:function(n){n.value?X.printf("%v = %v",n.name,n.value):X.printf("%v",n.name)},varsDecl:function(n){E(n)(),X.printf("%j;",[";",n.decls])},jsonElem:function(n){n.value?X.printf("%v: %v",n.key,n.value):X.printf("%v: %f",n.key,function(){j(n.key.text,L(n).scopeInfo,L(n))})},objlit:function(n){X.printf("{%j}",[",",n.elems])},arylit:function(n){X.printf("[%j]",[",",n.elems])},funcExpr:function(n){R(n)},parenExpr:function(n){X.printf("(%v)",n.expr)},varAccess:function(n){{var e=n.name.text;j(e,L(n).scopeInfo,L(n))}},exprstmt:function(r){var i={};if(E(r)(),U.noWait||(i=L(r).fiberCall||{}),"noRet"==i.type)X.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{",t,c,i.N,[", ",[re].concat(i.A)],_,U.pc,U.pc++);else if("ret"==i.type)X.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{%v%v%s.retVal;%n",t,c,i.N,[", ",[re].concat(i.A)],_,U.pc,U.pc++,i.L,i.O,e);else if("noRetSuper"==i.type){var a=x(n.superClass);X.printf("%s.prototype.%s%s.apply( %s, [%j]);%n%s=%s;return;%n%}case %d:%{",a,c,i.S.name.text,t,[", ",[re].concat(i.A)],_,U.pc,U.pc++)}else"retSuper"==i.type?X.printf("%s.prototype.%s%s.apply( %s, [%j]);%n%s=%s;return;%n%}case %d:%{%v%v%s.retVal;%n",a,c,i.S.name.text,t,[", ",[re].concat(i.A)],_,U.pc,U.pc++,i.L,i.O,e):X.printf("%v;",r.expr)},infix:function(n){var e=n.op.text;if(te){if("+"==e||"-"==e||"*"==e||"/"==e||"%"==e)return void X.printf("%s(%v,%l)%v%s(%v,%l)",p,n.left,O(n.left),n.op,p,n.right,O(n.right));if("+="==e||"-="==e||"*="==e||"/="==e||"%="==e)return void X.printf("%v%v%s(%v,%l)",n.left,n.op,p,n.right,O(n.right))}X.printf("%v%v%v",n.left,n.op,n.right)},trifixr:function(n){X.printf("%v%v%v%v%v",n.left,n.op1,n.mid,n.op2,n.right)},prefix:function(n){X.printf("%v %v",n.op,n.right)},postfix:function(n){var e=L(n);if(te){if(e.myMethodCall){var r=e.myMethodCall,i=r.scopeInfo,a=$(i);return void(a==ne.FIELD||a==ne.METHOD?X.printf("%s(%s, %l, [%j], %l )",S,t,r.name,[",",r.args],"this"):X.printf("%s(%v, [%j], %l)",y,n.left,[",",r.args],O(n.left)))}if(e.othersMethodCall){var s=e.othersMethodCall;return void X.printf("%s(%v, %l, [%j], %l )",S,s.target,s.name,[",",s.args],O(s.target))}if(e.memberAccess){var o=e.memberAccess;return void X.printf("%s(%v,%l).%s",p,o.target,O(o.target),o.name)}}else if(e.myMethodCall){var r=e.myMethodCall,i=r.scopeInfo,a=$(i);if(a==ne.METHOD)return void X.printf("%s.%s(%j)",t,r.name,[",",r.args])}X.printf("%v%v",n.left,n.op)},"break":function(n){if(U.noWait)X.printf("break;%n");else{if(U.inTry&&U.exitTryOnJump)throw i("現実装では、tryの中にbreak;は書けません",H,n.pos);if(!U.closestBrk)throw i("break； は繰り返しの中で使います",H,n.pos);X.printf("%s=%z; break;%n",_,U.closestBrk)}},"try":function(n){var t=L(n);if(!U.noWait&&(t.fiberCallRequired||t.hasJump||t.hasReturn)){if(1!=n.catches.length||"catch"!=n.catches[0].type)throw i("現実装では、catch節1個のみをサポートしています",H,n.pos);var r=n.catches[0],a={},s={};X.printf("%s.enterTry(%z);%n",e,a),X.printf("%f",M({inTry:!0,exitTryOnJump:!0},n.stmt)),X.printf("%s.exitTry();%n",e),X.printf("%s=%z;break;%n",_,s),X.printf("%}case %f:%{",function(){X.print(a.put(U.pc++))}),X.printf("%s=%s.startCatch();%n",r.name.text,e),X.printf("%s.exitTry();%n",e),X.printf("%v%n",r.stmt),X.printf("%}case %f:%{",function(){X.print(s.put(U.pc++))})}else U.enter({noWait:!0},function(){X.printf("try {%{%f%n%}} ",B(n.stmt)),n.catches.forEach(v.visit)})},"catch":function(n){X.printf("catch (%s) {%{%f%n%}}",n.name.text,B(n.stmt))},"throw":function(n){X.printf("throw %v;%n",n.ex)},"while":function(n){E(n)();var e=L(n);if(U.noWait||!e.fiberCallRequired&&!e.hasReturn)U.enter({noWait:!0},function(){X.printf("while (%v) {%{%f%n%}}",n.cond,B(n.loop))});else{var t=X.lazy(),r=U.pc++,i="reservedConst"==n.cond.type&&"true"==n.cond.text;X.printf("%}case %d:%{"+(i?"%D%D%D":"if (!(%v)) { %s=%z; break; }%n")+"%f%n%s=%s;break;%n%}case %f:%{",r,n.cond,_,t,M({closestBrk:t,exitTryOnJump:!1},n.loop),_,r,function(){X.print(t.put(U.pc++))})}},"for":function(n){function e(n,e,t){return function(){t.forEach(function(e,t){X.printf("%s=%s[%s];%n",e.text,n,t)})}}E(n)();var t=L(n);if("forin"==n.inFor.type){var r=L(n.inFor).iterName;if(U.noWait||!t.fiberCallRequired&&!t.hasReturn)U.enter({noWait:!0},function(){X.printf("%s=%s(%v,%s);%nwhile(%s.next()) {%{%f%n%f%n%}}",r,k,n.inFor.set,n.inFor.vars.length,r,e(r,n.inFor.isVar,n.inFor.vars),B(n.loop))});else{var i=X.lazy(),a=U.pc++;X.printf("%s=%s(%v,%s);%n%}case %d:%{if (!(%s.next())) { %s=%z; break; }%n%f%n%f%n%s=%s;break;%n%}case %f:%{",r,k,n.inFor.set,n.inFor.vars.length,a,r,_,i,e(r,n.inFor.isVar,n.inFor.vars),M({closestBrk:i,exitTryOnJump:!1},n.loop),_,a,function(n){n.print(i.put(U.pc++))})}}else if(U.noWait||!t.fiberCallRequired&&!t.hasReturn)U.enter({noWait:!0},function(){X.printf("%v%nwhile(%v) {%{%v%n%v;%n%}}",n.inFor.init,n.inFor.cond,n.loop,n.inFor.next)});else{var i=X.lazy(),a=U.pc++;X.printf("%v;%n%}case %d:%{if (!(%v)) { %s=%z; break; }%n%f%n%v;%n%s=%s;break;%n%}case %f:%{",n.inFor.init,a,n.inFor.cond,_,i,M({closestBrk:i,exitTryOnJump:!1},n.loop),n.inFor.next,_,a,function(n){n.print(i.put(U.pc++))})}},"if":function(n){E(n)();var e=L(n);if(!U.noWait&&(e.fiberCallRequired||e.hasJump||e.hasReturn)){var t={},r={};n._else?X.printf("if (!(%v)) { %s=%z; break; }%n%v%n%s=%z;break;%n%}case %f:%{%v%n%}case %f:%{",n.cond,_,r,n.then,_,t,function(){X.print(r.put(U.pc++))},n._else,function(){X.print(t.put(U.pc++))}):X.printf("if (!(%v)) { %s=%z; break; }%n%v%n%}case %f:%{",n.cond,_,t,n.then,function(){X.print(t.put(U.pc++))})}else U.enter({noWait:!0},function(){n._else?X.printf("if (%v) {%{%f%n%}} else {%{%f%n%}}",n.cond,B(n.then),B(n._else)):X.printf("if (%v) {%{%f%n%}}",n.cond,B(n.then))})},ifWait:function(n){U.noWait?n._else&&X.printf("%v",n._else):X.printf("%v",n.then)},call:function(n){X.printf("(%j)",[",",n.args])},objlitArg:function(n){X.printf("%v",n.obj)},argList:function(n){X.printf("%j",[",",n.args])},newExpr:function(n){var e=n.params;e?X.printf("new %v%v",n.klass,e):X.printf("new %v",n.klass)},scall:function(n){X.printf("[%j]",[",",n.args])},superExpr:function(e){var r;if(!n.superClass)throw new Error(n.fullName+"には親クラスがありません");e.name?(r=e.name.text,X.printf("%s.prototype.%s.apply( %s, %v)",x(n.superClass),r,t,e.params)):X.printf("%s.apply( %s, %v)",x(n.superClass),t,e.params)},arrayElem:function(n){X.printf("[%v]",n.subscript)},member:function(n){X.printf(".%v",n.name)},symbol:function(n){X.print(n.text)},normalFor:function(n){X.printf("%v; %v; %v",n.init,n.cond,n.next)},compound:function(n){var e=L(n);!U.noWait&&(e.fiberCallRequired||e.hasJump||e.hasReturn)?X.printf("%j",["%n",n.stmts]):U.enter({noWait:!0},function(){X.printf("{%{%j%n%}}",["%n",n.stmts])})},"typeof":function(){X.printf("typeof ")},"instanceof":function(){X.printf(" instanceof ")},is:function(){X.printf(" instanceof ")},regex:function(n){X.printf("%s",n.text)}});var ie=["++","--","!==","===","+=","-=","*=","/=","%=",">=","<=","!=","==",">>","<<","&&","||",">","<","+","?","=","*","%","/","^","~","\\",":",";",",","!","&","|","-","delete"];return ie.forEach(function(n){v.funcs[n]=function(){X.printf("%s",n)}}),v.def=function(n){throw console.log("Err node="),console.log(n),n.type+" is not defined in visitor:compiler2"},v.cnt=0,C(),n.src.js=X.buf,Q&&console.log("method4",X.buf),X.buf}{var e="_thread",t="_this",u="_arguments",c="fiber$",_="__pc",h="$LASTPOS",f="__cnt",d=100,T="Tonyu.bindFunc",S="Tonyu.invokeMethod",y="Tonyu.callFunc",p="Tonyu.checkNonNull",m="Tonyu.classes.",P="Tonyu.globals.",A="this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this)",k="Tonyu.iterator",g=l.ScopeTypes,$=l.getScopeType,b=l.annotation,O=l.getSource;l.getMethod,l.getDependingClasses,l.getParams}return{genJS:n}}()}),requireSimulator.setName("Tonyu.Compiler.Semantics"),"function"!=typeof define&&(define=require("requirejs").define),define(["Tonyu","Tonyu.Iterator","TonyuLang","ObjectMatcher","TError","IndentBuffer","context","Visitor","Tonyu.Compiler"],function(n,e,t,r,i,a,s,o,l){return l.Semantics=function(){function n(n,e){function a(t){var r,a=e.options.compiler.defaultSuperClass,o=0;if((r=h.match(t,{ext:{superClassName:{text:h.N,pos:h.P}}}))&&(a=r.N,o=r.P,"null"==a&&(a=null)),n.includes=[],(r=h.match(t,{incl:{includeClassNames:h.C}}))&&r.C.forEach(function(t){var r=t.text,a=t.pos,o=e.classes[e.aliases[r]||r];if(!o)throw i("クラス "+r+"は定義されていません",s,a);n.includes.push(o)}),"Array"==a)n.superClass={name:"Array",fullName:"Array",builtin:!0};else if(a){var u=e.classes[e.aliases[a]||a];if(!u)throw i("親クラス "+a+"は定義されていません",s,o);n.superClass=u}t.stmts.forEach(function(n){if("funcDecl"==n.type){var e=n.head,t="function";e.ftype&&(t=e.ftype.text),c[e.name.text]={nowait:!!e.nowait,ftype:t,name:e.name.text,head:e,pos:e.pos,stmts:n.body.stmts}}else"nativeDecl"==n.type?_[n.name.text]=n:l.stmts.push(n)})}var s=n.src.tonyu,o=t.parse(s),l={name:"main",stmts:[],pos:0},u={},c={main:l},_={};n.decls={fields:u,methods:c,natives:_},n.node=o;var h=r;a(o)}function e(n,e){function t(e,t){return f(n.annotation,e,t)}function l(n){if(!n.builtin){var e=R,t=n.decls;for(var r in t.fields)e[r]=u(V.FIELD,{klass:n.name,name:r});for(var r in t.methods)e[r]=u(V.METHOD,{klass:n.name,name:r})}}function v(){var t=R;S(n).forEach(l);var r=n.decls;for(var i in r.natives)t[i]=u(V.NATIVE,{name:"native::"+i});for(var i in p)t[i]=u(V.NATIVE,{name:"native::"+i});for(var i in e.aliases)t[i]=u(V.CLASS,{name:i})}function m(){var e=S(n);for(var t in n.decls.methods){var r=n.decls.methods[t];e.forEach(function(n){var e=n.decls.methods[t];e&&e.nowait&&(r.nowait=!0)})}}function P(e){return T(n,e)}function A(n){if("varAccess"==n.type||"postfix"==n.type&&("member"==n.op.type||"arrayElem"==n.op.type))return"varAccess"==n.type&&t(n,{noBind:!0}),!0;throw console.log("LVal",n),i("'"+d(n)+"'は左辺には書けません．",E,n.pos)}function k(e){var t=W.scope[e],r=c(t);if(!r){var i=e.match(/^\$/);r=i?V.GLOBAL:V.FIELD;var a={name:e};i||(a.klass=n.name),t=R[e]=u(r,a)}return t}function g(n){var e=this;if(n&&"object"==typeof n){var t;if(t=n instanceof Array?n:n[Grammar.SUBELEMENTS],!t){t=[];for(var r in n)t.push(n[r])}t.forEach(function(n){e.visit(n)})}}function $(n){var e={varDecls:{},subFuncDecls:{}};return W.enter({locals:e},function(){Y.visit(n)}),e}function b(n,e){n.forEach(function(n){t(n,e)})}function O(n){W.method&&(W.method.fiberCallRequired=!0),b(n,{fiberCallRequired:!0})}function L(n,e){W.enter({scope:e},function(){q.visit(n)})}function x(n,e){for(var t in n.varDecls)e[t]=u(V.LOCAL);for(var t in n.subFuncDecls)e[t]=u(V.LOCAL)}function w(n){n.locals=$(n.stmts),n.params=y(n)}function M(e){var t=_(W.scope);return e.params.forEach(function(r,i){t[r.name.text]=u(V.PARAM,{klass:n.name,name:e.name,no:i})}),x(e.locals,t),W.enter({method:e,finfo:e,noWait:!1},function(){L(e.stmts,t)}),e.scope=t,D(e.locals,t),t}function j(){W.enter({scope:R},function(){for(var n in N){G&&console.log("anon method1",n);var e=N[n];w(e),M(e)}})}function B(n){var e,r,i=n.body,a=n.head.name?n.head.name.text:"anonymous";r=(e=C.match(n,{head:{params:{params:C.P}}}))?e.P:[];var s=_(W.scope);r.forEach(function(n){s[n.name.text]=u(V.PARAM)});var o=$(i,s);x(o,s);var l=t(n);W.enter({finfo:l},function(){L(i,s)});var c={scope:s,locals:o,name:a,params:r};return t(n,c),t(n,l),D(o,s),c}function D(n,e){W.enter({scope:e},function(){for(var e in n.subFuncDecls)B(n.subFuncDecls[e])})}var E=n.src.tonyu,C=(E.text(),r),I=(e.traceTbl,n.decls),N=(I.fields,I.methods),V=(I.natives,a),R={},W=s(),G=!1,F={type:"postfix",left:{type:"postfix",left:C.T,op:{type:"member",name:{text:C.N}}},op:{type:"call",args:C.A}},K={type:"postfix",left:C.T,op:{type:"member",name:{text:C.N}}},H=fiberCallTmpl={type:"postfix",left:{type:"varAccess",name:{text:C.N}},op:{type:"call",args:C.A}},X={expr:fiberCallTmpl},z={expr:{type:"infix",op:C.O,left:C.L,right:fiberCallTmpl}},U={expr:{type:"superExpr",params:{args:C.A},$var:"S"}},Q={expr:{type:"infix",op:C.O,left:C.L,right:{type:"superExpr",params:{args:C.A},$var:"S"}}};n.annotation={};var Y=o({varDecl:function(n){W.locals.varDecls[n.name.text]=n},funcDecl:function(n){W.locals.subFuncDecls[n.head.name.text]=n},funcExpr:function(){},"catch":function(n){W.locals.varDecls[n.name.text]=n},exprstmt:function(){},forin:function(n){n.isVar;n.vars.forEach(function(e){W.locals.varDecls[e.text]=n});var e=h("_it_");t(n,{iterName:e}),W.locals.varDecls[e]=n}});Y.def=g;var q=o({varAccess:function(n){var e=k(n.name.text);t(n,{scopeInfo:e})},funcDecl:function(){},funcExpr:function(n){B(n)},jsonElem:function(n){if(n.value)this.visit(n.value);else{var e=k(n.key.text);t(n,{scopeInfo:e})}},"do":function(n){var e=this;W.enter({jumpable:!0},function(){e.def(n)})},"switch":function(n){var e=this;W.enter({jumpable:!0},function(){e.def(n)})},"while":function(n){var e=this;W.enter({jumpable:!0},function(){e.def(n)})},"for":function(n){var e=this;W.enter({jumpable:!0},function(){e.def(n)})},forin:function(n){n.vars.forEach(function(n){var e=k(n.text);t(n,{scopeInfo:e})}),this.visit(n.set)},ifWait:function(n){var e="_thread",t=this,r=_(W.scope);r[e]=u(V.THVAR),W.enter({scope:r},function(){t.visit(n.then)}),n._else&&t.visit(n._else),O(this.path)},"try":function(n){W.finfo.useTry=!0,this.def(n)},"return":function(n){W.noWait||b(this.path,{hasReturn:!0}),this.visit(n.value)},"break":function(n){if(!W.jumpable)throw i("break； は繰り返しの中で使います.",E,n.pos);W.noWait||b(this.path,{hasJump:!0})},"continue":function(n){if(!W.jumpable)throw i("continue； は繰り返しの中で使います.",E,n.pos);W.noWait||b(this.path,{hasJump:!0})},reservedConst:function(n){"arguments"==n.text&&(W.finfo.useArgs=!0)},postfix:function(n){var e;if(this.visit(n.left),this.visit(n.op),e=C.match(n,H)){var r=t(n.left).scopeInfo;t(n,{myMethodCall:{name:e.N,args:e.A,scopeInfo:r}})}else(e=C.match(n,F))?t(n,{othersMethodCall:{target:e.T,name:e.N,args:e.A}}):(e=C.match(n,K))&&t(n,{memberAccess:{target:e.T,name:e.N}})},infix:function(n){var e=n.op.text;("="==e||"+="==e||"-="==e||"*="==e||"/="==e||"%="==e)&&A(n.left),this.def(n)},exprstmt:function(e){var r,i;if(W.noWait||!(r=C.match(e,X))||c(W.scope[r.N])!=V.METHOD||P(r.N).nowait)if(W.noWait||!(r=C.match(e,z))||c(W.scope[r.N])!=V.METHOD||P(r.N).nowait){if(!W.noWait&&(r=C.match(e,U))&&r.S.name){if(i=P(r.S.name.text),!i)throw new Error("メソッド"+r.S.name.text+" はありません。");i.nowait||(r.type="noRetSuper",r.superClass=n.superClass,t(e,{fiberCall:r}),O(this.path))}else if(!W.noWait&&(r=C.match(e,Q))&&r.S.name){if(i=P(r.S.name.text),!i)throw new Error("メソッド"+r.S.name.text+" はありません。");i.nowait||(r.type="retSuper",r.superClass=n.superClass,t(e,{fiberCall:r}),O(this.path))}}else r.type="ret",t(e,{fiberCall:r}),O(this.path);else r.type="noRet",t(e,{fiberCall:r}),O(this.path);this.visit(e.expr)}});q.def=g,v(),m(),j()}var a=l.ScopeTypes,u=l.newScopeType,c=l.getScopeType,_=l.newScope,h=l.genSym,f=l.annotation,d=l.getSource,T=l.getMethod,S=l.getDependingClasses,y=l.getParams,p={Array:1,String:1,Boolean:1,Number:1,Void:1,Object:1,RegExp:1,Error:1};return{initClassDecls:n,annotate:e}}()}),requireSimulator.setName("StackTrace"),define([],function(){var trc={},pat=/(_trc_[A-Za-z0-9_]*).*[^0-9]([0-9]+):([0-9]+)[\s\)]*\r?$/;return trc.isAvailable=function(){var scr="({\n    main :function _trc_func_17000000_0() {\n      var a=(this.t.x);\n    }\n}).main();\n",s;try{eval(scr)}catch(e){if(s=e.stack,"string"!=typeof s)return!1;for(var lines=s.split(/\n/),i=0;i<lines.length;i++){var p=pat.exec(lines[i]);if(p)return!0}}return!1},trc.get=function(n){var e=n.stack;if("string"!=typeof e)return!1;for(var t=e.split(/\n/),r=[],i=0;i<t.length;i++){var a=pat.exec(t[i]);if(a){var s=a[1],o=a[2],l=a[3];r.push({fname:s,row:o,col:l})}}return console.log("StackTrace.get",r),r},trc}),requireSimulator.setName("Tonyu.TraceTbl"),define(["Tonyu","FS","TError","StackTrace"],function(n,e,t,r){return n.TraceTbl=function(){var n={},i=1e6,a=1,s=1e4,o={},l=[],u={};n.add=function(n,e){var t=n.src.tonyu,r=t.path(),c=o[r];void 0==c&&(c=a++,a>s&&(a=0),o[r]=c,l[c]=r),u[r]=n,e>=i&&(e=i-1);var _=c*i+e;return _};var c={};return n.decodeOLD=function(n){var r=n%i,a=(n-r)/i,s=l[a];if(s){var o=e.get(s),c=u[s];return t("Trace info",c||o,r)}return null},n.srcMap=c,n.decode=function(n){var e=new RegExp("LASTPOS="+n+";//(.*)\r?\n");console.log("pat=",e);for(var t in c){var r=e.exec(c[t]);if(r)return r[1];console.log("pat=",e,"Not found in ",t)}},n.find=function(n){var e=r.get(n),t=e[0];if(!t)return null;var i=new RegExp("LASTPOS=[0-9]+;//(.*)\r?");for(var a in c){console.log("Finding ",t.fname," in ",a);var s=c[a].indexOf(t.fname);if(s>=0){console.log("fname found at ",s);var o=c[a].split(/\n/),l=t.row-1;console.log("Scan from row=",l);for(var u=l;u>=0&&(console.log("row ",u,o[u]),null!=o[u]);u--){var _=i.exec(o[u]);if(_)return _[1]}console.log("Not found LASTPOS pat")}else console.log("Not found in ",a)}},n.addSource=function(n,e){c[n]=e},n}()}),requireSimulator.setName("ProjectCompiler"),define(["Tonyu","Tonyu.Compiler.JSGenerator","Tonyu.Compiler.Semantics","Tonyu.TraceTbl","FS"],function(n,e,t,r,i){var a=function(r){function s(n){var e=u.env;return n||(n={}),n.visited||(n={visited:{},classes:e.classes=e.classes||{},options:n}),n}function o(n){function e(e){var t=e.superClass,i=t?[t]:[];return e.includes&&(i=i.concat(e.includes)),i=i.filter(function(e){return e&&n[e.fullName]&&!e.builtin&&!r[e.fullName]})}function t(n,r){if(console.log("detectloop",n.fullName),a[n.fullName]){console.log("Detected: ",n.fullName,a,a[n.fullName]);var i=n.fullName,s=[];do s.unshift(i),i=a[i];while(i!=n.fullName);return s.unshift(n.fullName),s}r&&(a[n.fullName]=r.fullName);var o,l=e(n);return l.forEach(function(e){if(!o){var r=t(e,n);r&&(o=r)}}),delete a[n.fullName],o}var r={},i=[],a={},s=0;for(var o in n)r[o]=!1,s++;for(;i.length<s;){var l=i.length;for(var o in n)if(!r[o]){var u=n[o],c=e(u);0==c.length&&(i.push(u),r[o]=!0)}if(i.length==l){var _=[];for(var o in n)if(!r[o]){_=t(n[o])||[];break}throw TError("次のクラス間に循環参照があります: "+_.join("->"),"不明",0)}}return i}function l(n){console.log("loading: "+n.path());var e=new Function(n.text());return c.addSource(n.path(),e+""),e()}if(!r.rel)throw new Error("projectCompiler: "+r+" is not dir obj");var u={env:{}},c=n.TraceTbl;return u.env.traceTbl=c,u.EXT=".tonyu",u.getOptionsFile=function(){var n=r.rel("options.json");return n},u.getOptions=function(){var n=u.env;n.options={};var e=u.getOptionsFile();return e.exists()&&(n.options=e.obj()),u.fixOptions(n.options),n.options},u.fixOptions=function(n){n.compiler||(n.compiler={})},u.resolve=function(n){if(n instanceof Array){var e=[];return n.forEach(function(n){e.push(u.resolve(n))}),e}if("string"==typeof n)return i.resolve(n,r.path());if(!n||!n.isDir)throw new Error("Cannot TPR.resolve: "+n);return n},u.shouldCompile=function(){var n=u.getOutputFile();if(!n.exists())return!0;if(n.isReadOnly())return!1;var e=n.lastUpdate(),t=u.sourceFiles();for(var r in t){var i=t[r],a=i.lastUpdate();if(a>e)return console.log("Should compile: ",i.name()+" last="+new Date(a)),!0}var s=u.getOptionsFile();return s.exists()&&s.lastUpdate()>e?(console.log("Should compile: ",s.name()+" last="+new Date(s.lastUpdate())),!0):!1},u.getNamespace=function(){var n=u.getOptions();return n.compiler.namespace},u.getOutputFile=function(){var n=u.getOptions();console.log("Loaded option: ",r,n);var e=u.resolve(n.compiler.outputFile);if(e.isDir())throw new Error("out: directory style not supported");return e},u.loadClasses=function(e){n.runMode=!1,console.log("LoadClasses: "+r.path()),e=s(e);var t=e.visited||{},i=e.classes||{};if(!t[u.path()]){t[u.path()]=!0;var a=u.getNamespace();if(u.getDependingProjects().forEach(function(n){n.getNamespace()!=a&&n.loadClasses(e)}),u.shouldCompile())u.compile(e);else{var o=u.getOutputFile("js");l(o);var c=u.getNamespace(),_=n.classes;c.split(".").forEach(function(n){if(_=_[n],!_)throw new Error("namespace Not found :"+c)});for(var h in _){var f=_[h],d=n.klass.getMeta(f);i[d.fullName]=d}}}},u.compile=function(e){n.runMode=!1,console.log("Compile: "+r.path()),e=s(e);var t=u.getDependingProjects(),i=u.getNamespace();t.forEach(function(n){var t=n.getNamespace();t!=i&&n.loadClasses(e)});var a=u.sourceDirs();u.compileDir(i,a,e)},u.compileDir=function(n,e,r){{var i=r.classes;r.options}e=u.resolve(e);var a=u.env;a.aliases={},a.classes=i;for(var s in i){var l=i[s];a.aliases[l.shortName]=l.fullName}var c={},_=u.sourceFiles(n,e);for(var h in _){var f=_[h],d=n+"."+h;c[d]=i[d]={fullName:d,shortName:h,namespace:n,src:{tonyu:f}},a.aliases[h]=d}for(var s in c)console.log("initClassDecl: "+s),t.initClassDecls(c[s],a);var T=o(c);T.forEach(function(n){console.log("annotate :"+n.fullName),t.annotate(n,a)}),u.concatJS(T)},u.concatJS=function(n){var t=u.env,r="";n.forEach(function(n){console.log("concatJS :"+n.fullName),e.genJS(n,t),r+=n.src.js+"\n"});var i=u.getOutputFile();i.text(r),l(i)},u.getDependingProjects=function(){var n=u.getOptions(),e=n.compiler.dependingProjects||[];return e.map(function(n){var e=u.resolve(n);return a(e)})},u.dir=r,u.path=function(){return r.path()},u.sourceFiles=function(n,e){function t(n){if(n.endsWith(u.EXT)){var e=n.truncExt(u.EXT);r[e]=n}}n=n||u.getNamespace(),e=e||u.sourceDirs();for(var r={},i=e.length-1;i>=0;i--)e[i].recursive(t);return r},u.sourceDirs=function(){var n=u.getDependingProjects(),e=u.getNamespace(),t=[r];return n.forEach(function(n){var r=n.getNamespace();r==e&&t.push(n.dir)}),t},u.decodeTrace=function(n){var e=n.split(":"),t=e[0],r=parseInt(e[1]),i=t.split("."),a=i.pop(),s=i.join(".");if(s==u.getNamespace()){var o=u.sourceFiles();for(var l in o)if(a==l)return TError("Trace info",o[l],r)}},u};return a}),requireSimulator.setName("PatternParser"),define(["Tonyu"],function(n){return n.klass({initialize:function(n,e){this.options=e||{},this.img=n,this.height=n.height,this.width=n.width;var t=this.newImage(n.width,n.height),r=t.getContext("2d");r.drawImage(n,0,0),this.ctx=r,this.pixels=this.ctx.getImageData(0,0,n.width,n.height).data,this.base=this.getPixel(0,0)},newImage:function(n,e){var t=document.createElement("canvas");return t.width=n,t.height=e,t},getPixel:function(n,e){var t=this.pixels,r=4*(n+e*this.width),i=t[0+r],a=t[1+r],s=t[2+r],o=t[3+r];return 256*(256*(256*o+s)+a)+i},setPixel:function(n,e,t){var r=4*(n+e*this.width);this.pixels[0+r]=255&t,t=(t-(255&t))/256,this.pixels[1+r]=255&t,t=(t-(255&t))/256,this.pixels[2+r]=255&t,t=(t-(255&t))/256,this.pixels[3+r]=255&t},parse:function(){try{for(var n=[],e=0;e<this.height;e++)for(var t=0;t<this.width;t++){var r=this.getPixel(t,e);
r!=this.base&&n.push(this.parse1Pattern(t,e))}return n}catch(i){if(i.isParseError)return console.log("parse error! "+i),{image:this.img,x:0,y:0,width:this.width,height:this.height};throw i}},parse1Pattern:function(n,e){function t(n){return n}function r(n,e,t){return{toString:function(){return"at ("+n+","+e+") :"+t},isParseError:!0}}for(var i=this.getPixel(n,e),a=n,s=e,o=this.base,l=this.width,u=this.height;l>a;){var c=this.getPixel(a,s);if(c!=i)break;a++}if(a>=l||this.getPixel(a,s)!=o)throw r(a,s,t(this.getPixel(a,s))+"!="+t(o));for(a--;u>s&&this.getPixel(a,s)==i;)s++;if(s>=u||this.getPixel(a,s)!=o)throw r(a,s,t(this.getPixel(a,s))+"!="+t(o));s--;var _=n+1,h=e+1,f=a-_,d=s-h;if(console.log("PP",_,h,f,d,a,s),f*d==0)throw r(a,s,"w*h==0");for(var T=this.newImage(f,d),S=T.getContext("2d"),y=S.getImageData(0,0,f,d),p=y.data,v=0,m=h;s>m;m++)for(var P=_;a>P;P++){var A=this.getPixel(P,m);A==i?(p[v++]=0,p[v++]=0,p[v++]=0,p[v++]=0):(p[v++]=255&A,A=(A-(255&A))/256,p[v++]=255&A,A=(A-(255&A))/256,p[v++]=255&A,A=(A-(255&A))/256,p[v++]=255&A)}S.putImageData(y,0,0);for(var k=h-1;s>=k;k++)for(var g=_-1;a>=g;g++)this.setPixel(g,k,o);return this.options.boundsInSrc?{x:_,y:h,width:f,height:d}:{image:T,x:0,y:0,width:f,height:d}}})}),requireSimulator.setName("Util"),Util=function(){function n(n,t){null==t&&(t=""),n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+n+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?t:e(i[1])}function e(n){return decodeURIComponent(n.replace(/\+/g,"%20"))}function t(n,e){return n.substring(n.length-e.length)===e}function r(n,e){return n.substring(0,e.length)===e}return{getQueryString:n,endsWith:t,startsWith:r}}(),requireSimulator.setName("ImageList"),define(["PatternParser","Util","WebSite"],function(n,e,t){function r(n){var e=[];return n.forEach(function(n){n&&""!=n.url&&e.push(n)}),e}var i,a={};return i=function(e,t,s){s||(s={}),e=r(e);var o=[],l=e.length;e.forEach(function(e,r){function u(){var i,a;if((i=e.pwidth)&&(a=e.pheight)){for(var s=0,u=0,c=this.width,_=this.height,h=[];;){var f=i,d=a;if(s+i>c&&(f=c-s),u+a>_&&(d=_-u),h.push({image:this,x:s,y:u,width:f,height:d}),s+=i,s+i>c&&(s=0,u+=a,u+a>_))break}o[r]=h}else{var T=new n(this);o[r]=T.parse()}if(o[r].name=e.name,l--,0==l){var S=[],y={};o.forEach(function(n){y[n.name]=S.length,S=S.concat(n)}),S.names=y,t(S)}}console.log("loading",e,r);var c=e.url,_=c;if(a[_])return void u.apply(a[_],[]);c=i.convURL(c,s.baseDir);var h=$("<img>");h.load(function(){a[_]=this,u.apply(this,[])}),h.attr("src",c)})},i.load=i,i.parse1=function(e,t,r){var i,a,s;if((i=e.pwidth)&&(a=e.pheight)){for(var o=0,l=0,u=t.width,c=t.height,_=[];;)if(_.push({image:this,x:o,y:l,width:i,height:a}),o+=i,o+i>u&&(o=0,l+=a,l+a>c))break;s=_}else{var h=new n(t,r);s=h.parse()}return s.name=e.name,s},i.convURL=function(n,r){if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(n,e){return t[e]}),t.urlAliases[n]&&(n=t.urlAliases[n]),e.startsWith(n,"ls:")){var i=n.substring("ls:".length);if(!r)throw new Error("Basedir not specified");var a=r.rel(i);if(!a.exists())throw"ImageList file not found: "+a;n=a.text()}return n},window.ImageList=i,i}),requireSimulator.setName("typeCheck"),"function"!=typeof define&&(define=require("requirejs").define),define(["Visitor"],function(){return TypeCheck=function(){}}),requireSimulator.setName("Auth"),define(["WebSite"],function(n){var e={};return e.currentUser=function(e){$.ajax({type:"get",url:n.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(n){console.log("auth.currentUser",n),n=JSON.parse(n);var t=n.user;"null"==t&&(t=null),console.log("user",t,"csrfToken",n.csrfToken),e(t,n.csrfToken)}})},e.assertLogin=function(t){e.currentUser(function(e,r){return e?t.success(e,r):(window.onLoggedIn=t.success,void t.showLoginLink(n.serverTop+"/login"))})},window.Auth=e,e}),requireSimulator.setName("Blob"),define(["Auth","WebSite","Util"],function(n,e,t){var r={},i="${blobPath}";return r.BLOB_PATH_EXPR=i,r.upload=function(n,t,r,i){var a=new FormData(document.getElementById("fileinfo"));i.error&&(i.error=function(n){alert(n)}),a.append("theFile",r),a.append("user",n),a.append("project",t),a.append("fileName",r.name),$.ajax({type:"get",url:e.serverTop+"/blobURL",success:function(n){$.ajax({url:n,type:"POST",data:a,processData:!1,contentType:!1,success:function(n){console.log("Res = "+n),i.success.apply({},arguments)},error:i.error})}})},r.isBlobURL=function(n){if(t.startsWith(n,i)){var e=n.split("/");return{user:e[1],project:e[2],fileName:e[3]}}},r.url=function(n,t,r){return e.blobPath+n+"/"+t+"/"+r},r.uploadToExe=function(n,t){var r=n.getBlobInfos(),i=r.length;return console.log("uploadBlobToExe cnt=",i),0==i?t.success():(t.progress||(t.progress=function(n){console.log("uploadBlobToExe cnt=",n)}),void r.forEach(function(n){var r={csrfToken:t.csrfToken};for(var a in n)r[a]=n[a];$.ajax({type:"get",url:e.serverTop+"/uploadBlobToExe",data:r,success:function(){return i--,0==i?t.success():void t.progress(i)},error:t.error})}))},r}),requireSimulator.setName("ImageRect"),define([],function(){function n(e,t){if("string"==typeof e){var r=new Image,i=null,a=null,s=function(n){n&&(a=n),a&&i&&a(i)};return r.onload=function(){i=n(r,t),s()},r.src=e,s}var o=t.width,l=t.height,u=t.getContext("2d"),c=e.width,_=e.height,h=l/_*c,f=o/c*_;f>l&&(f=l),h>o&&(h=o),u.clearRect(0,0,o,l);var d=Math.floor((o-h)/2),T=Math.floor((l-f)/2);return u.drawImage(e,0,0,c,_,d,T,h,f),{left:d,top:T,width:h,height:f,src:e}}return n}),requireSimulator.setName("thumbnail"),define(["ImageRect"],function(n){function e(e){try{var i=Tonyu.globals.$Screen.buf[0],a=$("<canvas>").attr({width:100,height:100});n(i,a[0]);var s=a[0].toDataURL(),o=e.getResource(),l=e.getDir(),u=t.file(e);u.text(s);for(var c={name:r,pwidth:100,pheight:100,url:"ls:"+u.relPath(l)},_=o.images,h=!1,f=0;f<_.length;f++)_[f].name==r&&(_[f]=c,h=!0);h||_.push(c),e.setResource(o),console.log("setRSRC",o)}catch(d){console.log("Create thumbnail failed",d)}}var t={},r="$icon_thumbnail";return t.set=function(n,t){setTimeout(function(){e(n)},t)},t.get=function(n){var e=t.file(n);return e.exists()?e.text():null},t.file=function(n){var e=n.getDir(),t=e.rel("images/").rel("icon_thumbnail.png");return t},t}),requireSimulator.setName("plugins"),define(["WebSite"],function(n){function e(n){return"function"==typeof n&&(n={onload:n}),n||(n={}),n.onload||(n.onload=function(){}),n}var t={},r={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/T2Body/,symbol:"Box2D"},timbre:{src:"timbre.js",detection:/\bplay(SE)?\b/,symbol:"T"}};return t.detectNeeded=function(n,e){for(var t in r){var i=r[t].detection.exec(n);i&&(e[t]=1)}return e},t.loaded=function(n){var e=r[n];if(!e)throw new Error("plugin not found: "+n);return window[e.symbol]},t.loadAll=function(n,i){function a(){l>=s.length?i.onload():t.load(s[l++],a)}i=e(i);var s=[];for(var o in n)r[o]&&!t.loaded(o)&&s.push(o);var l=0;console.log("loading plugins",s),a()},t.load=function(t,i){var a=r[t];if(!a)throw new Error("plugin not found: "+t);i=e(i);var s=n.pluginTop+"/"+a.src;$.getScript(s,i.onload)},t.request=function(n){if(!t.loaded(n)){var e=new Error("Plugin "+n+" required");e.pluginName=n}},t}),requireSimulator.setName("Tonyu.Project"),define(["Tonyu","ProjectCompiler","TError","FS","Tonyu.TraceTbl","ImageList","StackTrace","typeCheck","Blob","thumbnail","WebSite","plugins","Tonyu.Compiler.Semantics","Tonyu.Compiler.JSGenerator"],function(n,e,t,r,i,a,s,o,l,u,c,_){return n.Project=function(i,o){var h=e(i),f=e(o),d=(n.extend({},h),r.get(c.tonyuHome));o||(o=d.rel("Kernel/"));var T=n.TraceTbl,S={classes:{},traceTbl:T,options:{compiler:{}}};return h.EXT=".tonyu",h.NSP_KER="kernel",h.NSP_USR="user",h.env=S,h.dumpJS=function(n){function e(n){console.log("Class "+n+":\n"+S.classes[n].src.js)}if(n)e(n);else for(var n in S.classes)e(n)},h.stop=function(){var n=h.runningThread;n&&n.kill();var e=h.runningObj;e&&e.stop&&e.stop()},h.rawRun=function(n){h.loadClasses(),h.runScriptMode||u.set(h,2e3),h.rawBoot(n)},h.getResource=function(){var e=i.rel("res.json");return e.exists()?e.obj():n.defaultResource},h.setResource=function(n){var e=i.rel("res.json");e.obj(n)},h.getThumbnail=function(){return u.get(h)},h.convertBlobInfos=function(n){function e(t){if("object"==typeof t)for(var i in t)if(t.hasOwnProperty(i)){var a=t[i];if("url"==i){var s;(s=l.isBlobURL(a))&&(t[i]=[l.BLOB_PATH_EXPR,n,r,s.fileName].join("/"))}e(a)}}var t=h.getResource(),r=h.getName();e(t),h.setResource(t)},h.getBlobInfos=function(){function n(e){if("object"==typeof e)for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if("url"==r){var a;(a=l.isBlobURL(i))&&t.push(a)}n(i)}}var e=h.getResource(),t=[];return n(e),t},h.loadResource=function(e){var t=h.getResource();a(t.images,function(t){var r=n.getGlobal("$Sprites");r&&r.setImageList(t);for(var i in t.names)n.setGlobal(i,t.names[i]);e&&e()})},h.getOptions=function(){S.options=null;var e=i.rel("options.json");return e.exists()&&(S.options=e.obj()),S.options&&!S.options.run&&(S.options=null),S.options||(S.options=n.defaultOptions),h.fixOptions(S.options),S.options},h.fixOptions=function(n){n.compiler||(n.compiler={}),n.compiler.commentLastPos=h.runScriptMode||s.isAvailable(),n.run.mainClass=h.fixClassName(n.run.mainClass),n.run.bootClass=h.fixClassName(n.run.bootClass),n.plugins||(n.plugins={},i.each(function(e){e.endsWith(h.EXT)&&_.detectNeeded(e.text(),n.plugins)}))},h.requestPlugin=function(n){if(!_.loaded(n)){var e=h.getOptions();e.plugins[n]=1,h.setOptions(e);var t=new Error("必要なプラグイン"+n+"を追加しました。もう一度実行してください");throw t.pluginName=n,t}},h.loadPlugins=function(n){var e=h.getOptions();_.loadAll(e.plugins,n)},h.fixClassName=function(n){if(h.classExists(n))return n;var e,t=n.split("."),r=t.pop();return e=h.NSP_USR+"."+r,h.classExists(e)?e:(e=h.NSP_KER+"."+r,h.classExists(e)?e:n)},h.classExists=function(n){var e=n.split(".");if(1==e.length)return!1;var t=e[0],r=e[1];if(h.isKernelEditable()){if(t==h.NSP_KER){if(i.rel(r+h.EXT).exists())return!0;if(o.rel(r+h.EXT).exists())return!0}}else{if(t==h.NSP_KER&&o.rel(r+h.EXT).exists())return!0;if(t==h.NSP_USR&&i.rel(r+h.EXT).exists())return!0}return!1},h.getNamespace=function(){var n=h.getOptions();return n.compiler&&n.compiler.namespace?n.compiler.namespace:h.isKernelEditable()?h.NSP_KER:h.NSP_USR},h.getDependingProjects=function(){return[f]},h.getOutputFile=function(){var n=h.getOptions();return n.compiler.outputFile?r.resolve(n.compiler.outputFile):i.rel("js/concat.js")},h.setOptions=function(n){n&&(S.options=n);var e=i.rel("options.json"),t=e.exists()?e.text():"",r=JSON.stringify(S.options);t!=r&&(console.log("update option",t,r),e.text(r))},h.rawBoot=function(e){var r=n.getClass(e);if(!r)throw t(e+" というクラスはありません","不明",0);var i=new r,a=n.thread();a.apply(i,"main"),h.runningThread=a,h.runningObj=i,$LASTPOS=0,a.steps()},h.isKernel=function(n){var e=o.rel(n+h.EXT);return e.exists()?e:null},h.isKernelEditable=function(){return S.options.kernelEditable},h.getDir=function(){return i},h.getName=function(){return i.name().replace(/\/$/,"")},h.renameClassName=function(n,e){h.compile();var t=h.env.classes;for(var r in t){var i=t[r],a=i.src?i.src.tonyu:null,s=i.annotation,o=[];if(s&&a){for(var l in s)try{var u=s[l],c=u.scopeInfo;if(c&&"class"==c.type&&c.name==n){var _=u.node.pos,f=u.node.len,d=a.text().substring(_,_+f);d==n&&(o.push({pos:_,len:f}),console.log(a.path(),_,f,a.text().substring(_-5,_+f+5),"->",e))}}catch(T){console.log(T)}o=o.sort(function(n,e){return e.pos-n.pos}),console.log(a.path(),o);var S=a.text(),y=S;o.forEach(function(n){S=S.substring(0,n.pos)+e+S.substring(n.pos+n.len)}),y==S||a.isReadOnly()||(console.log("Refact:",a.path(),S),a.text(S))}}},h}}),requireSimulator.setName("Shell"),define(["FS","Util","WebSite"],function(n,e,t){function r(n,e){var t=i(n);if(e&&!t.exists())throw t+": no such file or directory";return t}function i(t){if("string"!=typeof t)return t;if(e.startsWith(t,"/"))return n.get(t);var r=a.cwd;return r.rel(t)}var a={cwd:n.get("/")};return a.cd=function(n){return a.cwd=r(n,!0),a.pwd()},a.resolve=r,a.pwd=function(){return a.cwd+""},a.ls=function(n){return n=n?r(n,!0):a.cwd,n.ls()},a.cp=function(n,e,t){t||(t={}),t.v&&a.echo("cp",n,e);var i=r(n,!0),s=r(e);if(i.isDir()&&s.isDir()){var o=0;return i.recursive(function(n){var e=n.relPath(i),r=s.rel(e);(t.test||t.v)&&a.echo((r.exists()?"[ovr]":"[new]")+r+"<-"+n),t.test||r.copyFrom(n,t),o++}),o}if(i.isDir()||s.isDir()){if(!i.isDir()&&s.isDir())return s.rel(i.name()).text(i.text()),1;throw"Cannot copy directory "+i+" to file "+s}return s.text(i.text()),1},a.rm=function(n,e){if(e||(e={}),e.notrash)return n=r(n,!1),n.removeWithoutTrash(),1;if(n=r(n,!0),n.isDir()&&e.r){var t=n,i=0;return t.each(function(n){n.exists()&&(i+=a.rm(n,e))}),t.rm(),i+1}return n.rm(),1},a.cat=function(n){n=r(n,!0),a.echo(n.text())},a.resolve=function(n){return n||(n="."),n=r(n)},a.grep=function(n,e,t){function i(n,e,r){t.res&&t.res.push({file:n,lineNo:e,line:r}),a.echo(n+"("+e+"): "+r)}return e=r(e,!0),t||(t={}),t.res||(t.res=[]),e.isDir()?e.each(function(e){a.grep(n,e,t)}):"string"==typeof n&&e.lines().forEach(function(t,r){t.indexOf(n)>=0&&i(e,r+1,t)}),t.res},a.touch=function(n){return n=r(n),n.text(n.exists()?n.text():""),1},a.setout=function(n){a.outUI=n},a.echo=function(){console.log.apply(console,arguments),a.outUI&&a.outUI.log&&a.outUI.log.apply(a.outUI,arguments)},a.err=function(){console.log.apply(console,arguments),a.outUI&&a.outUI.err&&a.outUI.err.apply(a.outUI,arguments)},a.prompt=function(){},a.ASYNC={r:"SH_ASYNC"},a.help=function(){for(var n in a){var e=a[n];"function"==typeof e&&a.echo(n+(e.description?" - "+e.description:""))}},sh=a,t.isNW&&(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()}),a}),requireSimulator.setName("KeyEventChecker"),define([],function(){var n={};return n.down=function(e,t,r){e instanceof $||(e=$(e)),e.bind("keydown",function(i){return n.is(i,t)?r.call(e[0],i):void 0})},n.is=function(n,e){e=e.toLowerCase(),n=n.originalEvent||n;var t="";return n.altKey&&(t+="alt+"),n.ctrlKey&&(t+="ctrl+"),n.shiftKey&&(t+="shift+"),t+=n.keyCode>=112&&n.keyCode<=123?"f"+(n.keyCode-111):String.fromCharCode(n.keyCode),t=t.toLowerCase(),e==t},n}),requireSimulator.setName("ScriptTagFS"),define([],function(){var n={};return n.toObj=function(){function n(n,e){var t=n.split("\n"),r="";return t.forEach(function(n){r+=n.length>e?n.substring(0,e):n+"\n"}),r}var e=$("script"),t={};return e.each(function(){var e=this;if("text/tonyu"==e.type){var r=$(e).data("filename");if(r){var i=parseInt($(e).data("lastupdate")),a=$(e).data("wrap");a?(a=parseInt(a),t[r]={lastUpdate:i,text:n(e.innerHTML,a)}):t[r]={lastUpdate:i,text:e.innerHTML}}}}),t},n}),requireSimulator.setName("T2MediaLib");var T2MediaLib_BGMPlayer=function(n){this.id=n,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1};T2MediaLib_BGMPlayer.prototype.playBGM=function(n,e,t,r,i){if(!T2MediaLib.context)return null;var a=this.playingBGM;return a instanceof AudioBufferSourceNode&&a.stop(),this.playingBGM=T2MediaLib.playSE(n,this.bgmVolume,this.bgmTempo,t,e,r,i),this.playingBGMName=n,this.bgmPause=0,this.playingBGM},T2MediaLib_BGMPlayer.prototype.stopBGM=function(){var n=this.playingBGM;return n instanceof AudioBufferSourceNode?(n.stop(0),this.playingBGM=null,n):null},T2MediaLib_BGMPlayer.prototype.pauseBGM=function(){var n=this.playingBGM;return n instanceof AudioBufferSourceNode?(0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=n.loopStart,this.bgmPauseLoopEnd=n.loopEnd,this.bgmPauseLoop=n.loop,this.bgmPauseCurrentTime=n.context.currentTime,this.bgmPauseTempo=T2MediaLib.bgmTempo,n.stop(0),this.bgmPause=1),n):null},T2MediaLib_BGMPlayer.prototype.resumeBGM=function(){var n=this.playingBGM;return n instanceof AudioBufferSourceNode?(1===this.bgmPause&&(n=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd),this.bgmPause=0),n):null},T2MediaLib_BGMPlayer.prototype.setBGMVolume=function(n){var e=this.playingBGM;return e instanceof AudioBufferSourceNode?(this.bgmVolume=n,void T2MediaLib.setSEVolume(e,n)):null},T2MediaLib_BGMPlayer.prototype.setBGMTempo=function(n){var e=this.playingBGM;return e instanceof AudioBufferSourceNode?(0===this.bgmPause&&(e.plusTime-=(T2MediaLib.context.currentTime-e.playStartTime)*(n-this.bgmTempo)),this.bgmTempo=n,void T2MediaLib.setSERate(e,n)):null},T2MediaLib_BGMPlayer.prototype.getBGMCurrentTime=function(){var n=this.playingBGM;if(!(n instanceof AudioBufferSourceNode))return null;var e,t,r,i,a,s,o;return 0===this.bgmPause?(r=T2MediaLib.context.currentTime,i=this.bgmTempo):(r=this.bgmPauseCurrentTime,i=this.bgmPauseTempo),t=(r-n.playStartTime)*i+n.plusTime,n.loop&&(n.loopEnd-n.loopStart>0?t<n.loopStart?(a=0,s=0,o=n.buffer.duration):(a=n.loopStart,s=n.loopStart,o=n.loopEnd-n.loopStart):(o=n.buffer.duration,a=0,s=0)),n.loop?e=(t-s)%o+a:(e=t,e>n.buffer.duration&&(e=n.buffer.duration)),e},T2MediaLib_BGMPlayer.prototype.getBGMLength=function(){var n=this.playingBGM;return n instanceof AudioBufferSourceNode?n.buffer.duration:null};var T2MediaLib={context:null,seDataAry:{data:[]},bgmPlayerMax:16,bgmPlayerAry:[],playingBGM:null,playingBGMName:null,bgmPause:0,bgmPauseTime:0,bgmPauseCurrentTime:0,bgmPauseTempo:0,bgmPauseLoop:!1,bgmPauseLoopStart:0,bgmPauseLoopEnd:0,bgmVolume:1,bgmTempo:1,playingAudio:null,audioVolume:1,audioTempo:1,audioDataAry:{data:[]},init:function(){if(window.AudioContext?T2MediaLib.context=new AudioContext:window.webkitAudioContext?T2MediaLib.context=new webkitAudioContext:(T2MediaLib.context=null,console.log("Your browser does not support yet Web Audio API")),T2MediaLib.context)for(var n=0;n<T2MediaLib.bgmPlayerMax;n++)T2MediaLib.bgmPlayerAry[n]=new T2MediaLib_BGMPlayer(n)},allClearData:function(){var n=T2MediaLib.seDataAry.data;for(var e in n)delete n[e]},clearData:function(n){var e=T2MediaLib.seDataAry.data;delete e[n]},loadSE:function(n,e){if(!T2MediaLib.context)return T2MediaLib.seDataAry.data[n]=-1,null;var t=new XMLHttpRequest;t.onload=function(){if(200===t.status||0===t.status){var e=t.response;if(e instanceof ArrayBuffer){var r=function(e){T2MediaLib.seDataAry.data[n]=e},i=function(e){console.log(e instanceof Error?"T2MediaLib: "+e.message:"T2MediaLib: Error decodeAudioData()"),T2MediaLib.seDataAry.data[n]=-4};T2MediaLib.context.decodeAudioData(e,r,i)}else T2MediaLib.seDataAry.data[n]=-3}else T2MediaLib.seDataAry.data[n]=-2},T2MediaLib.seDataAry.data[n]=null,t.responseType="arraybuffer",t.open("GET",e,!0),t.send(null)},playSE:function(n,e,t,r,i,a,s){if(!T2MediaLib.context)return null;var o=T2MediaLib.seDataAry.data[n];if(!(o instanceof AudioBuffer))return null;null===e&&(e=1),t||(t=1),r?r>o.duration?r=o.duration:0>r&&(r=0):r=0,i||(i=!1),a?0>a?a=0:a>o.duration&&(a=o.duration):a=0,s?0>s?s=0:s>o.duration&&(s=o.duration):s=o.duration;var l=T2MediaLib.context.createBufferSource();T2MediaLib.context.createGain=T2MediaLib.context.createGain||T2MediaLib.context.createGainNode;var u=T2MediaLib.context.createGain();l.buffer=o,l.loop=i,l.loopStart=a,l.loopEnd=s,l.playbackRate.value=t,l.connect(u),u.connect(T2MediaLib.context.destination);var c;return c=i&&s-a>0&&r>s?s:r,l.gainNode=u,l.playStartTime=T2MediaLib.context.currentTime,l.playOffset=c,l.plusTime=c,l.start=l.start||l.noteOn,l.stop=l.stop||l.noteOff,u.gain.value=e*e,l.start(0,r),l.onended=function(n){l.onended=null,l.stop(0),console.log('"on'+n.type+'" event handler !!')},l},stopSE:function(n){return n instanceof AudioBufferSourceNode?(n.stop(0),n):null},setSEVolume:function(n,e){return n instanceof AudioBufferSourceNode?void(n.gainNode.gain.value=e*e):null},setSERate:function(n,e){return n instanceof AudioBufferSourceNode?void(n.playbackRate.value=e):null},getSEData:function(n){return T2MediaLib.seDataAry.data[n]},loadBGM:function(n,e){return T2MediaLib.loadSE(n,e)},playBGM:function(n,e,t,r,i,a){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var s=T2MediaLib.bgmPlayerAry[n];return s instanceof T2MediaLib_BGMPlayer?s.playBGM(e,t,r,i,a):null},stopBGM:function(n){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var e=T2MediaLib.bgmPlayerAry[n];return e instanceof T2MediaLib_BGMPlayer?e.stopBGM():null},pauseBGM:function(n){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var e=T2MediaLib.bgmPlayerAry[n];return e instanceof T2MediaLib_BGMPlayer?e.pauseBGM():null},resumeBGM:function(n){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var e=T2MediaLib.bgmPlayerAry[n];return e instanceof T2MediaLib_BGMPlayer?e.resumeBGM():null},setBGMVolume:function(n,e){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var t=T2MediaLib.bgmPlayerAry[n];return t instanceof T2MediaLib_BGMPlayer?t.setBGMVolume(e):null},setBGMTempo:function(n,e){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var t=T2MediaLib.bgmPlayerAry[n];return t instanceof T2MediaLib_BGMPlayer?t.setBGMTempo(e):null},getBGMCurrentTime:function(n){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var e=T2MediaLib.bgmPlayerAry[n];return e instanceof T2MediaLib_BGMPlayer?e.getBGMCurrentTime():null},getBGMLength:function(n){if(0>n||T2MediaLib.bgmPlayerMax<=n)return null;var e=T2MediaLib.bgmPlayerAry[n];return e instanceof T2MediaLib_BGMPlayer?e.getBGMLength():null},getBGMData:function(n){return T2MediaLib.getSEData(n)},getBGMPlayerMax:function(){return T2MediaLib.bgmPlayerMax},allStopBGM:function(){for(var n=0;n<T2MediaLib.bgmPlayerMax;n++)T2MediaLib.stopBGM(n)},loadAudio:function(n,e){var t=new Audio(e);t.play(),T2MediaLib.audioDataAry.data[n]=null,t.addEventListener("loadstart",function(){if(!T2MediaLib.context)return null;var n=T2MediaLib.context.createMediaElementSource(t);n.connect(T2MediaLib.context.destination)},!1),t.addEventListener("canplay",function(){T2MediaLib.audioDataAry.data[n]=t},!1),t.load()},playAudio:function(n,e,t){var r=T2MediaLib.audioDataAry.data[n];return r?(t||(t=0),T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.pause(),T2MediaLib.playingAudio.currentTime=0),T2MediaLib.playingAudio=r,r.loop=e,r.volume=T2MediaLib.audioVolume,r.currentTime=t,r.play(),r):null},stopAudio:function(){var n=T2MediaLib.playingAudio;return n instanceof Audio?(n.pause(),n.currentTime=0,T2MediaLib.playingAudio=null,n):null},pauseAudio:function(){var n=T2MediaLib.playingAudio;return n?(n.pause(),n):null},resumeAudio:function(){var n=T2MediaLib.playingAudio;return n?(n.play(),n):null},setAudioVolume:function(n){T2MediaLib.audioVolume=n,T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.volume=n)},setAudioTempo:function(n){T2MediaLib.audioTempo=n,T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.playbackRate=n)},setAudioPosition:function(n){T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.currentTime=n)},getAudioData:function(n){return T2MediaLib.audioDataAry.data[n]},getAudioCurrentTime:function(){return T2MediaLib.playingAudio instanceof Audio?T2MediaLib.playingAudio.currentTime:null},getAudioLength:function(){return T2MediaLib.playingAudio instanceof Audio?T2MediaLib.playingAudio.duration:null}};T2SoundLib=T2MediaLib,requireSimulator.setName("runtime"),requirejs(["ImageList","T2MediaLib"],function(){}),requireSimulator.setName("runScript"),requirejs(["FS","Tonyu.Project","Shell","KeyEventChecker","ScriptTagFS","runtime","WebSite"],function(n,e,t,r,i,a,s){$(function(){function r(){o=$(window).width(),l=$(window).height(),u.attr({width:o,height:l})}var a=n.get(s.tonyuHome);Tonyu.defaultResource={images:[{name:"$pat_base",url:"images/base.png",pwidth:32,pheight:32},{name:"$pat_sample",url:"images/Sample.png"},{name:"$pat_neko",url:"images/neko.png",pwidth:32,pheight:32}],sounds:[]},SplashScreen={hide:function(){$("#splash").hide()},show:function(){}};var o=$(window).width(),l=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var u=$("<canvas>").attr({width:o,height:l}).appendTo("body");$(window).resize(r);var c=location.href.replace(/\?.*/,"").split(/\//),_=c.pop();_.length<0&&(c="runscript");var h=a.rel(_+"/"),f=i.toObj();for(var d in f){var T=h.rel(d);if(!T.isDir()){T.useRAMDisk();var S=f[d];T.text(S.text),delete S.text,S.lastUpdate&&T.metaInfo(S)}}t.cd(h);var y="Main",p=$("script");p.each(function(){var n=this;if("text/tonyu"==n.type){var e=$(n).data("filename");if(e){var t=h.rel(e);$(n).data("main")&&(y=t.truncExt(".tonyu"))}}}),Tonyu.defaultOptions={compiler:{defaultSuperClass:"Actor"},run:{mainClass:y,bootClass:"Boot"},kernelEditable:!1};var v=a.rel("Kernel/"),m=e(h,v);Tonyu.currentProject=Tonyu.globals.$currentProject=m;var P=m.getOptions();P.compiler&&P.compiler.diagnose&&(P.compiler.diagnose=!1,m.setOptions(P)),m.runScriptMode=!0,m.rawRun(P.run.bootClass)})}),requireSimulator.setName();