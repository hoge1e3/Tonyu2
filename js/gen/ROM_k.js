(function () {
  var rom={
    base: '/Tonyu/Kernel/',
    data: {
      '': '{".desktop":{"lastUpdate":1424849946377},"Actor.tonyu":{"lastUpdate":1428655839871},"BaseActor.tonyu":{"lastUpdate":1431156678251},"Boot.tonyu":{"lastUpdate":1431943895972},"event/":{"EventHandler.tonyu":{"lastUpdate":1430185681070},"EventMod.tonyu":{"lastUpdate":1430185637321}},"graphics/":{"GameScreen.tonyu":{"lastUpdate":1430361716021},"Map.tonyu":{"lastUpdate":1421122943495},"OneframeSpriteMod.tonyu":{"lastUpdate":1430110560296},"Panel.tonyu":{"lastUpdate":1427702417187},"ScaledCanvas.tonyu":{"lastUpdate":1431410186048},"Sprites.tonyu":{"lastUpdate":1429581265216},"TextRectMod.tonyu":{"lastUpdate":1427702468448}},"js/":{"concat.js":{"lastUpdate":1432606561083},"index.html":{"lastUpdate":1430107873565}},"MathMod.tonyu":{"lastUpdate":1424849946395},"NoviceActor.tonyu":{"lastUpdate":1412697666000},"options.json":{"lastUpdate":1428228309742},"physics/":{"BodyActor.tonyu":{"lastUpdate":1431660674619},"T2Body.tonyu":{"lastUpdate":1425264703379},"T2Mod.tonyu":{"lastUpdate":1431610155789},"T2World.tonyu":{"lastUpdate":1431611371521}},"sound/":{"MediaPlayer.tonyu":{"lastUpdate":1421384204625},"MML.tonyu":{"lastUpdate":1424849946399},"PlayMod.tonyu":{"lastUpdate":1425018365373},"T2MediaPlayer.tonyu":{"lastUpdate":1432606533205},"WaveTable.tonyu":{"lastUpdate":1412697666000}},"t1/":{"DxChar.tonyu":{"lastUpdate":1421384204610},"PlainChar.tonyu":{"lastUpdate":1429593897129},"SecretChar.tonyu":{"lastUpdate":1421384204695},"SpriteChar.tonyu":{"lastUpdate":1421384204710},"T1Line.tonyu":{"lastUpdate":1427965036844},"T1Map.tonyu":{"lastUpdate":1421384204728},"T1Page.tonyu":{"lastUpdate":1421384204737},"T1Text.tonyu":{"lastUpdate":1427965019581},"TextChar.tonyu":{"lastUpdate":1429503038967}},"thread/":{"ParallelMod.tonyu":{"lastUpdate":1429593932153},"Scheduler.tonyu":{"lastUpdate":1431159537947},"ThreadGroupMod.tonyu":{"lastUpdate":1430106770277}},"TObject.tonyu":{"lastUpdate":1421122943543},"TQuery.tonyu":{"lastUpdate":1412697666000},"ui/":{"GameConsole.tonyu":{"lastUpdate":1430361767671},"InputDevice.tonyu":{"lastUpdate":1416890086000},"Keys.tonyu":{"lastUpdate":1412697666000},"MapEditor.tonyu":{"lastUpdate":1421122943503},"Pad.tonyu":{"lastUpdate":1421122943510}}}',
      '.desktop': '{"runMenuOrd":["Main0121","Main1023","TouchedTestMain","Main2","MapLoad","Main","AcTestM","NObjTest","NObjTest2","AcTest","AltBoot","Ball","Bar","Bounce","MapTest","MapTest2nd","SetBGCTest","Label","PanelTest","BaseActor","Panel","MathMod"]}',
      'Actor.tonyu': 'extends BaseActor;\nincludes PlayMod, ParallelMod;\nnative Sprites;\nnative Tonyu;\n\n\\new(x,y,p) {\n    super(x,y,p);\n    if (Tonyu.runMode) initSprite();\n}\n\\initSprite() {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    onAppear();\n}\n\\onAppear() {\n}\n',
      'BaseActor.tonyu': 'extends null;\nincludes MathMod,EventMod,TextRectMod,OneframeSpriteMod,ThreadGroupMod;\nnative Tonyu;\nnative Key;\nnative console;\nnative Math;\nnative FS;\nnative Array;\n\n\\new(x,y,p) {\n    if (Tonyu.runMode) {\n        /*if ($Scheduler) {\n            _th=$Scheduler.newThread(this, "main", []);\n        } else {\n            var thg=currentThreadGroup();\n            if (thg) _th=thg.addObj(this);\n        }*/\n        _th=$Boot.schedule(this,"main",[]);\n    }\n    if (typeof x=="object") Tonyu.extend(this,x);\n    else if (typeof x=="number") {\n        this.x=x;\n        this.y=y;\n        this.p=p;\n    }\n    if (scaleX==null) scaleX=1;\n    if (rotation==null) rotation=0;\n    if (rotate==null) rotate=0;\n    if (alpha==null) alpha=255;\n    if (zOrder==null) zOrder=0;\n    if (age==null) age=0;\n    if (anim!=null && typeof anim=="object"){\n        animMode=true;\n        animFrame=0;\n    }else{\n        animMode=false;\n    }\n    if (animFps==null) animFps=1;\n}\nnowait \\extend(obj) {\n    return Tonyu.extend(this,obj);\n}\n\nnowait \\print(pt) {\n    console.log.apply(console,arguments);\n    if($consolePanel){\n        $consolePanel.scroll(0,20);\n        $consolePanel.setFillStyle("white");\n        $consolePanel.fillText(pt,0,$consolePrintY,20,"left");\n    }\n}\n\nnowait \\setAnimFps(f){\n    this.animFps=f;\n    this.animFrame=0;\n    this.animMode=true;\n}\nnowait \\startAnim(){\n    this.animMode=true;\n}\nnowait \\stopAnim(){\n    this.animMode=false;\n}\n\\update() {\n    onUpdate();\n    if(_thread) {\n        _thread.suspend();\n        if ($Scheduler) $Scheduler.addToNext(_thread);\n    }\n}\nnowait \\onUpdate() {\n\n}\n\\updateEx(updateT){\n    for(var updateCount=0;updateCount<updateT;updateCount++){\n        update();\n    }\n}\nnowait \\getkey(k) {\n    return $Keys.getkey(k);\n}\nnowait \\hitTo(t) {\n    return crashTo(t);\n}\nnowait \\all(c) {\n    var res=new TQuery;\n    $Sprites.sprites.forEach \\(s) {\n        if (s===this) return;\n        if (!c || s instanceof c) {\n            res.push(s);\n        }\n    };\n    return res;// new TQuery{objects:res};\n}\nnowait \\allCrash(t) {\n    var res=new TQuery;\n    var sp=this; //_sprite || this;\n    var t1=getCrashRect();\n    if (!t1) return res;\n    $Sprites.sprites.forEach(\\(s) {\n        var t2;\n        if (s!==this &&\n        !s.excludeFromAll &&\n        s instanceof t &&\n        (t2=s.getCrashRect()) &&\n        Math.abs(t1.x-t2.x)*2<t1.width+t2.width &&\n        Math.abs(t1.y-t2.y)*2<t1.height+t2.height) {\n            res.push(s);\n        }\n    });\n    return res;\n}\nnowait \\crashTo(t) {\n    if (!t) return false;\n    if (typeof t=="function") {\n        return allCrash(t)[0];\n    }\n    return crashTo1(t);\n}\nnowait \\crashTo1(t) {\n    if (!t || t._isDead) return false;\n    /*if (_sprite && t._sprite) {\n        return _sprite.crashTo(t._sprite);\n    }*/\n    var t1=getCrashRect();\n    var t2=t.getCrashRect();\n    return\n    //    t1.x!=null && t1.y!=null && t1.width && t1.height &&\n    //    t2.x!=null && t2.y!=null && t2.width && t2.height &&\n    t1 && t2 &&\n    Math.abs(t1.x-t2.x)*2<t1.width+t2.width &&\n    Math.abs(t1.y-t2.y)*2<t1.height+t2.height;\n}\nnowait \\getCrashRect() {\n    var actWidth=width*scaleX, actHeight;\n    if(typeof scaleY==="undefined"){\n        actHeight=height*scaleX;\n    }else{\n        actHeight=height*scaleY;\n    }\n    return typeof x=="number" &&\n    typeof y=="number" &&\n    typeof width=="number" &&\n    typeof height=="number" &&\n    {x,y,width:actWidth,height:actHeight};\n}\nnowait \\within(t,distance){\n    if(!t || t._isDead) return false;\n    if(Math.sqrt(Math.abs(x-t.x)*Math.abs(x-t.x)+ Math.abs(y-t.y)*Math.abs(y-t.y))<distance){\n        return true;\n    }\n    return false;\n}\nnowait \\watchHit(typeA,typeB,onHit) {\n    $Sprites.watchHit(typeA , typeB, \\(a,b) {\n        onHit.apply(this,[a,b]);\n    });\n}\nnowait \\currentThreadGroup() {//@deprecated\n    return $Scheduler; //$currentThreadGroup;\n}\nnowait \\die() {\n    killThreadGroup();\n    /*if (_th) {\n        _th.kill();\n    }*/\n    hide();\n    fireEvent("die");\n    _isDead=true;\n}\nnowait \\hide() {\n    /*if (_sprite) {\n        $Sprites.remove(_sprite);\n        _sprite=null;\n    } else {*/\n        //$Sprites.remove(this);\n    //}\n    if(layer && typeof layer.remove=="function"){\n        layer.remove(this);\n    }else{\n        $Sprites.remove(this);\n    }\n}\nnowait \\show(x,y,p) {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    if (x!=null) this.x=x;\n    if (y!=null) this.y=y;\n    if (p!=null) this.p=p;\n}\n\nnowait \\detectShape() {\n    if (typeof p!="number") {\n        if (text!=null) return;\n        p=0;\n    }\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) return;\n    width=pImg.width;\n    height=pImg.height;\n}\n\\waitFor(f) {\n    if (_thread) {\n        _thread.waitFor(f);\n    }\n    //update();\n}\nnowait \\isDead() {\n    return _isDead;\n}\n\nnowait \\animation(){\n    age++;\n    if(animMode && age%animFps==0){\n        p=anim[animFrame%anim.length];\n        animFrame++;\n    }\n}\nnowait \\draw(ctx) {\n    if (x==null || y==null || _isInvisible) return;\n    detectShape();\n    if (pImg) {\n        ctx.save();\n        ctx.translate(x,y);\n        //if (typeof rotate=="number" ) rotation=rotate;// 削除予定\n        //ctx.rotate(this.rotation/180*Math.PI);\n        animation();\n        if(this.rotation!=0){\n            ctx.rotate(this.rotation/180*Math.PI);\n        }else{\n            ctx.rotate(this.rotate/180*Math.PI);\n        }\n        if(typeof this.scaleY==="undefined") {\n            ctx.scale(this.scaleX,this.scaleX);\n        }else{\n            ctx.scale(this.scaleX,this.scaleY);\n        }\n        ctx.globalAlpha=this.alpha/255;\n        ctx.drawImage(\n        pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n        -width/2, -height/2, width, height);\n        ctx.restore();\n    } else if (text!==null && text!==undefined) {\n        if (!size) size=15;\n        if (!align) align="center";\n        if (!fillStyle) fillStyle="white";\n        ctx.fillStyle=fillStyle;\n        ctx.globalAlpha=this.alpha/255;\n        var rect=drawTextRect(ctx, text, x, y, size, align , "fill");\n        width=rect.w;\n        height=rect.h;\n    }\n    if (_fukidashi) {\n        if (_fukidashi.c>0) {\n            _fukidashi.c--;\n            ctx.fillStyle="white";\n            ctx.strokeStyle="black";\n            fukidashi ( ctx , _fukidashi.text,\n            x, y-height/2-10, _fukidashi.size);\n        }\n    }\n}\nnowait \\asyncResult() {//@deperecated\n    return Tonyu.asyncResult();\n}\n\n\\runAsync(f) {\n    if (!_thread) throw new Error("runAsync should run in wait mode");\n    _thread.runAsync(f);\n}\n\n\n\\screenOut(a) {\n    //オブジェクトが画面外に出たかどうかを判定します。\n    if (!a) a=0;\n    var r=0;\n    var viewX=0,viewY=0;\n    if (x<viewX+a)               r+=viewX+a-x;\n    if (y<viewY+a)               r+=viewY+a-y;\n    if (x>$screenWidth +viewX-a) r+=x-($screenWidth +viewX-a);\n    if (y>$screenHeight+viewY-a) r+=y-($screenHeight+viewY-a);\n    return r;\n}\n\\file(path) {\n    var d=Tonyu.currentProject.getDir();\n    var files=d.rel("files/");\n    return FS.get(files.rel(path)) {topDir:d};\n}\n\\waitInputDevice(fl) {\n    if (fl!==false) {\n        if (!origTG) {\n            ifwait {\n                origTG=_thread.group;\n                _thread.setGroup(null);\n            }\n        }\n        a=asyncResult();\n        $InputDevice.addOnetimeListener(a.receiver);\n        waitFor(a);\n    } else {\n        if (origTG) {\n            ifwait {\n                _thread.setGroup(origTG);\n                origTG=null;\n            }\n        }\n    }\n}\n\\redrawScreen() {\n    $Sprites.draw($Screen.buf[0]);\n    $Screen.draw();\n}\n\n// from PlainChar\n\\color(r,g,b) {\n    return "rgb("+[r,g,b].join(",")+")";\n}\n/*\n\\drawText(x,y,text,col,size) {\n    if ($debug) return;\n    if (!size) size=15;\n    if (!col) col="cyan";\n    var tp=all(T1Text).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,text,fillStyle:col, size,hidden:false};\n    }else {\n        new T1Text{x,y,text,fillStyle:col, size};\n    }\n}\n\\drawLine(x,y,tx,ty,col) {\n    if (!col) col="white";\n    var tp=all(T1Line).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,tx,ty,col, hidden:false};\n    }else {\n        new T1Line{x,y,tx,ty,col};\n    }\n}\n*/\n\\loadPage(page,arg){\n    all().die();\n    new page(arg);\n    die();\n}\n\n\\setVisible(v) {\n    _isInvisible=!v;\n}\n\\appear(o) {\n    return o;\n}\n',
      'Boot.tonyu': 'extends Actor;\nincludes T2MediaPlayer;\n\nnative $;\nnative TError;\nnative $LASTPOS;\nnative Key;\nnative Date;\nnative ImageList;\nnative Tonyu;\nnative SplashScreen;\nnative Math;\n\n\\update() {\n    waitFor(Tonyu.timeout(50)); // waitFor calls update...\n}\n\\initSprites() {\n    $Sprites=new Sprites();\n    $FrontSprites=new Sprites();\n    print ("Loading plugins..");\n    var a=asyncResult();\n    $currentProject.loadPlugins(a.receiver);\n    waitFor(a);\n    print ("Loading pats..");\n    var rs=$currentProject.getResource();\n    a=asyncResult();\n    ImageList.load( rs.images, a.receiver)\n    {baseDir:$currentProject.getDir()};\n    waitFor(a);\n    var r=a[0];\n    $Sprites.setImageList(r);\n    for (var name,val in r.names) {\n        Tonyu.setGlobal(name, val);\n    }\n    print ("Loading pats done.");\n    cvj=$("canvas");\n    if (Tonyu.noviceMode) {\n        $Screen=new ScaledCanvas{canvas:cvj, width:600, height:300};\n    } else {\n        $Screen=new ScaledCanvas{canvas:cvj, width:465, height:465};\n    }\n}\n\\initSounds() {\n    print ("Loading sounds...");\n    initT2MediaPlayer();\n    loadFromProject($currentProject);\n    print ("Loading sounds done.");\n    on("stop")\\{\n        clearSEData();\n    };\n    $sound=this;\n}\n\\hide() {\n}\n\n\\initThread() {\n    //$mainThreadGroup=thg=Tonyu.threadGroup();\n    var o=Tonyu.currentProject.getOptions();\n    var mainClassName=o.run.mainClass;\n    print("MainClass= "+mainClassName);\n    mainClass=Tonyu.getClass(mainClassName);\n    if (!mainClass) {\n        TError( mainClassName+" というクラスはありません",\n        "不明" ,0).raise();\n    }\n    Tonyu.runMode=true;\n    //$currentThreadGroup=thg;\n    scheduler=$Scheduler=new Scheduler;\n    new mainClass();\n}\n\\stop() {\n    fireEvent("stop");\n    die();\n}\n\\schedule(obj,method,args) {\n    method=method||"main";\n    args=args||[];\n    var th=scheduler.newThread(obj, method, args);\n    addThreadGroup(obj);\n    obj.addThread(th);\n    return th;\n}\n$Boot=this;\ninitSounds();\ninitSprites();\n$InputDevice=new InputDevice;\n$InputDevice.initCanvasEvents(cvj);\ninitThread();\n\n$pat_fruits=30;\n$Keys=new Keys;\n$Math=Math;\n$consolePanel=new Panel{align:"center",x:465/2,y:465/2,width:465,height:465,zOrder:-10,layer:$FrontSprites};\n$consolePrintY=465-15;\n$panel=new Panel{align:"center",x:$screenWidth/2,y:$screenHeight/2,width:$screenWidth,height:$screenHeight,zOrder:-1,layer:$FrontSprites};\nif (typeof SplashScreen!="undefined") SplashScreen.hide();\ninitFPSParams();\n\n$mouseX=$mouseX||0;\n$mouseY=$mouseY||0;\nwhile (true) {\n    //thg.steps();\n    scheduler.stepsAll();\n    $Keys.update();\n    $InputDevice.update();\n    $screenWidth=$Screen.width;\n    $screenHeight=$Screen.height;\n    doDraw=now()<deadLine;\n    if (!doDraw && frameSkipped>=maxFrameSkip) {\n        doDraw=true;\n        resetDeadLine();\n    }\n    if (doDraw) { // フレームスキップの時は描画しない\n        $Screen.fillCanvas($Screen.buf[0]);\n        $Sprites.draw($Screen.buf[0]);\n        $FrontSprites.draw($Screen.buf[0]);\n        $Screen.draw();\n        fps_fpsCnt ++;\n        frameSkipped=0;\n    } else {\n        frameSkipped++;\n    }\n    $Sprites.checkHit();\n    $Sprites.removeOneframes();\n    fps_rpsCnt ++;\n    measureFps();\n    waitFrame(); // FPS制御\n    while(paused) {\n        waitFor(Tonyu.timeout(1));\n        if (!paused) resetDeadLine();\n    }\n}\n\nnowait \\initFPSParams() {\n    // フレームレートの設定\n    _fps = 30;\n    maxframeSkip = 5;\n    // フレームレート制御でつかう変数 //\n    frameCnt = 0;\n    resetDeadLine();\n    lastMeasured=now();\n    fps_fps=fps_rps=fps_fpsCnt=fps_rpsCnt=0;\n}\nnowait \\now() {\n    return new Date().getTime();\n}\nnowait \\resetDeadLine() {\n    deadLine=now()+1000/_fps;\n    frameSkipped = 0;\n}\n\n\\waitFrame() {\n    var wt=deadLine-now();\n    if (wt<1) {\n        if (wt<-1000) resetDeadLine();\n        wt=1;\n    }\n    wt=floor(wt);\n    waitFor(Tonyu.timeout(wt));\n    deadLine+=1000/_fps;\n}\n\nnowait \\getFrameRate() {\n    return _fps;\n}\n\n// Tonyu1の$System.setFrameRate() //\nnowait \\setFrameRate(fps, maxFrameSkip) {\n    _fps = fps;\n    if (typeof maxFrameSkip!="number") maxFrameSkip=5;\n    this.maxFrameSkip = maxFrameSkip;\n    resetDeadLine();\n}\n\n// FPS（計測したフレームレート）を返す //\nnowait \\getMeasuredFps() {\n    return fps_fps;\n}\n\n// RPS（計測した実行レート）を返す //\nnowait \\getMeasuredRps() {\n    return fps_rps;\n}\n\nnowait \\measureFps() {\n    if (now()>lastMeasured+1000) {\n        fps_fps=fps_fpsCnt;\n        fps_rps=fps_rpsCnt;\n        fps_fpsCnt=0;\n        fps_rpsCnt=0;\n        lastMeasured=now();\n    }\n}\n\n',
      'MathMod.tonyu': 'extends null;\nnative Math;\n\nnowait \\sin(d) {\n    return Math.sin(rad(d));\n}\nnowait \\cos(d) {\n    return Math.cos(rad(d));\n}\nnowait \\rad(d) {\n    return d/180*Math.PI;\n}\nnowait \\deg(d) {\n    return d/Math.PI*180;\n}\n\nnowait \\abs(v) {\n    return Math.abs(v);\n}\nnowait \\atan2(x,y) {\n    return deg(Math.atan2(x,y));\n}\nnowait \\floor(x) {\n    return Math.floor(x);\n}\nnowait \\angleDiff(a,b) {\n    var c;\n    a=floor(a);\n    b=floor(b);\n    if (a>=b) {\n        c=(a-b) % 360;\n        if (c>=180) c-=360;\n    } else {\n        c=-((b-a) % 360);\n        if (c<-180) c+=360;\n    }\n    return c;\n}\nnowait \\sqrt(t) {\n    return Math.sqrt(t);\n}\nnowait \\dist(dx,dy) {\n    if (typeof dx=="object") {\n        var t=dx;\n        dx=t.x-x;dy=t.y-y;\n    }\n    return sqrt(dx*dx+dy*dy);\n}\nnowait \\trunc(f) {\n    if(f>=0) return Math.floor(f);\n    else return Math.ceil(f);\n}\nnowait \\ceil(f){\n    return Math.ceil(f);\n}\n\nnowait \\rnd(r) {\n    if (typeof r=="number") {\n        return Math.floor(Math.random()*r);\n    }\n    return Math.random();\n}',
      'NoviceActor.tonyu': 'extends BaseActor;\nnative Tonyu;\n\n\\sleep(n) {\n    if(!n) n=1;\n    for(n;n>0;n--) update();\n}\n\\initSprite() {\n    if (!_sprite) {\n        _sprite=new BaseActor{owner:this};// Sprites.add{owner:this};\n        $Sprites.add(this);\n    }\n}\n\\say(text,size) {\n    if (!size) size=15;\n    initSprite();\n    _sprite._fukidashi={text:text, size:size, c:30};\n}\n\\sprite(x,y,p) {\n    go(x,y,p);\n}\n\\show(x,y,p) {\n    go(x,y,p);\n}\nnowait \\draw(ctx) {\n    _sprite.draw(ctx);\n}\n\\getCrashRect() {\n    return _sprite.getCrashRect();\n}\n\\go(x,y,p) {\n    initSprite();\n    _sprite.x=x;\n    _sprite.y=y;\n    if (p!=null) _sprite.p=p;\n    //update();\n}\n\\change(p) {\n    initSprite();\n    _sprite.p=p;\n}',
      'TObject.tonyu': 'extends null;\nnative Tonyu;\n\\new (options) {\n    if (typeof options=="object") extend(options);\n    this.main();\n}\nnowait \\extend(obj) {\n    return Tonyu.extend(this,obj);\n}',
      'TQuery.tonyu': 'extends TObject;\nincludes MathMod;\n\\new () {\n    length=0;\n}\n\\tonyuIterator(arity) {\n    var res={};\n    res.i=0;\n    if (arity==1) {\n        res.next=function () {\n            if (res.i>=this.length) return false;\n            res[0]=this[res.i];\n            res.i++;\n            return true;\n        };\n    } else {\n        res.next=function () {\n            if (res.i>=this.length) return false;\n            res[0]=res.i;\n            res[1]=this[res.i];\n            res.i++;\n            return true;\n        };\n    }\n    return res;\n}\n\\attr() {\n    var values;\n    if (length==0) return;\n    if (arguments.length==1 && typeof arguments[0]=="string") {\n        return this[0][arguments[0]];\n    }\n    if (arguments.length>=2) {\n        values={};\n        for (var i=0 ; i<arguments.length-1 ;i+=2) {\n            values[arguments[i]]=arguments[i+1];\n        }\n    } else {\n        values=arguments[0];\n    }\n    if (values) {\n        for (var e in this) {\n            e.extend( values);\n        }\n    }\n}\n\\genKeyfunc(key) {\n    if (typeof key!="function") {\n        return \\(o) {return o[key];};\n    } else {\n        return key;\n    }\n}\n\\maxs(key) {\n    var f=genKeyfunc(key);\n    var res,reso=new TQuery;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v>=res) {\n            if (v>res) reso=new TQuery;\n            reso.push(o);\n            res=v;\n        }\n    }\n    return reso;\n}\n\\mins(key) {\n    var f=genKeyfunc(key);\n    var res,reso=new TQuery;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v<=res) {\n            if (v<res) reso=new TQuery;\n            reso.push(o);\n            res=v;\n        }\n    }\n    return reso;\n}\n\\minObj(key) {\n    return mins(key)[0];\n}\n\\maxObj(key) {\n    return maxs(key)[0];\n}\n\\nearests(x,y) {\n    if (typeof x=="object") {y=x.y;x=x.x;}\n    return mins \\(o) {\n        return dist(o.x-x,o.y-y);\n    };\n}\n\\nearest(x,y) {\n    return nearests(x,y)[0];\n}\n\\withins(xo,yd,d) {\n    var x,y;\n    if (typeof xo=="object") {\n        x=xo.x;y=xo.y;d=yd;\n    } else {\n        x=xo;y=yd;\n    }\n    return find \\(o) {\n        return dist(o.x-x,o.y-y)<=d;\n    };\n}\n\\within(xo,yd,d) {\n    return withins(xo,yd,d).nearest();\n}\n\n\\max(key) {\n    var f=genKeyfunc(key);\n    var res;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v>res) res=v;\n    }\n    return res;\n}\n\\min(key) {\n    var f=genKeyfunc(key);\n    var res;\n    for (var o in this) {\n        var v=f(o);\n        if (res==null || v<res) res=v;\n    }\n    return res;\n}\n\\push(e) {\n    this[length]=e;\n    length++;\n}\n\\size() {return length;}\n\\find(f) {\n    var no=new TQuery;\n    for (var o in this) {\n        if (f(o)) no.push(o);\n    }\n    return no;\n} \n\\apply(name, args) {\n    var res;\n    if (!args) args=[];\n    for (var o in this) {\n        var f=o[name];\n        if (typeof f=="function") {\n            res=f.apply(o, args);\n        }\n    }\n    return res;\n}\n// \\alive => find \\(o) => !o.isDead()  //  (in future)\n\\alive() {\n    return find \\(o) {\n        return !o.isDead();\n    };\n}\n\\die() {\n    var a=alive();\n    if (a.length==0) return false;\n    a.apply("die");\n    return true;\n}\n\n\\klass(k) {\n    return find \\(o) { return o instanceof k; };\n}',
      'event/': '{"EventHandler.tonyu":{"lastUpdate":1430185681070},"EventMod.tonyu":{"lastUpdate":1430185637321}}',
      'event/EventHandler.tonyu': 'extends TObject;\nnative Tonyu;\n\nlisteners=[];\n\n\\addListener(f) {\n    if (target && (typeof f)=="string") {\n        f=target[f];\n    }\n    if (typeof f!="function") throw new Error("Not a event listener: "+target+" / "+f);\n    listeners.push(f);\n    return {\n        remove: \\{\n           removeListener(f);\n        }\n    };\n}\n\\removeListener(f) {\n    var i=listeners.indexOf(f);\n    listeners.splice(i,1);\n}\n\\fire(args) {\n    if (released) return;\n    var t;\n    for (var h in listeners) {\n        if (h["fiber"]) {\n            t=Tonyu.thread();\n            h["fiber"].apply(target, [t].concat(args) );\n            t.steps();\n        } else {\n            h.apply(target,args);\n        }\n    }\n}\n\\release() {\n    released=true;\n}\n',
      'event/EventMod.tonyu': 'extends null;\nnative console;\n\nnowait \\initEventMod() {\n   if (_eventHandlers) return;\n   _eventHandlers={};\n   on ("die",releaseEventMod);\n}\nnowait \\releaseEventMod() {\n   for (var k,v in _eventHandlers) {\n       v.release();\n   }\n}\nnowait \\parseArgs(a) {\n   var res={type:a[0], args:[]};\n   for (var i=1 ; i<a.length ; i++) {\n       res.args.push(a[i]);\n   }\n   return res;\n}\n\nnowait \\registerEventHandler(type, obj) {\n   // obj:{ attach, fire }\n   initEventMod();\n   if (typeof type=="function") {\n       obj=obj||new type{target:this};\n       type=obj.getClassInfo().fullName;\n   }  else {\n       obj=obj || new EventHandler{target:this};\n   }\n   return _eventHandlers[type]=obj;\n}\n\nnowait \\getEventHandler(type) {\n   initEventMod();\n   if (typeof type=="function") {\n       type=type.meta.fullName;\n   }\n   var res=_eventHandlers[type];\n   return res;\n}\nnowait \\getOrRegisterEventHandler(type) {\n   var res=getEventHandler(type) || registerEventHandler(type);\n   return res;\n}\n\nnowait \\on() {\n    var a=parseArgs(arguments);\n    var h=getOrRegisterEventHandler(a.type);\n    return h.addListener.apply(h,a.args);\n}\n\nnowait \\fireEvent(type, arg) {\n    var h=getEventHandler(type);\n    if (h) h.fire([arg]);\n}\nnowait \\sendEvent(type, arg) {\n    fireEvent(type,arg);\n}\n\n\\waitEvent() {\n    if (_thread) {\n        var args=[];\n        for (var i=0;i<arguments.length;i++) {\n            if (arguments[i]===undefined) break;\n            args.push(arguments[i]);\n        }\n        _thread.waitEvent(this, args);\n    }\n}\n/*\n\\waitEvent(type, a1,a2,a3,a4,a5) {\n    if (_thread) {\n        waitEventRaw(type,a1,a2,a3,a4,a5); // TODO: cannot apply with thread.enter\n        return _thread.lastEvent[0];\n    }\n}*/\n/*\n\\waitEvent2() {\n    if (_thread) {\n        t=obj.pararell.apply(obj, ["waitEventRaw"].concat(arguments) );\n        t.on("terminate") \\{ _thread.steps(); }\n\n    }\n}\n*/',
      'graphics/': '{"GameScreen.tonyu":{"lastUpdate":1430361716021},"Map.tonyu":{"lastUpdate":1421122943495},"OneframeSpriteMod.tonyu":{"lastUpdate":1430110560296},"Panel.tonyu":{"lastUpdate":1427702417187},"ScaledCanvas.tonyu":{"lastUpdate":1431410186048},"Sprites.tonyu":{"lastUpdate":1429581265216},"TextRectMod.tonyu":{"lastUpdate":1427702468448}}',
      'graphics/GameScreen.tonyu': 'extends Actor;\nnative $;\nnative Math;\n\n// buf: logical\n\\new (opt) {\n    // opt:{width,height,sprites}\n    extend(opt);\n    resize(width, height);\n    this.bgColor="rgb(20,80,180)";\n    isDrawGrid=$Sprites.isDrawGrid;\n}\n\\resize(width,height) {\n    this.width=width;\n    this.height=height;\n    buf=$("<canvas>").attr{width,height};\n    ctx=buf[0].getContext("2d");  \n    fireEvent("resize", width, height);\n    /*$screenWidth=width;\n    $screenHeight=height;\n    if($panel){\n        $panel.setPanel($screenWidth,$screenHeight);\n    }*/\n}\n\\setBounds(b) { //left,top,width,height in game console\n    bounds=b;\n}\n\\draw(cctx) {\n    var b=bounds;\n    fillCanvas();\n    sprites.draw(buf[0]);\n    cctx.drawImage(buf[0],\n    0,0,width, height, \n    b.left, b.top, b.width, b.height);\n}\n\\canvas2buf(point) {// canvas=gameConsole\n    var b=bounds;\n    if (!b) return point;\n    return {x: (point.x-b.left)/b.width*width, \n    y: (point.y-b.top)/b.height*height};\n}\n\\setBGColor(c){\n    this.bgColor=c;\n}\n\\fillCanvas(){\n    var ctx=buf[0].getContext("2d");\n    ctx.save();\n    ctx.fillStyle=bgColor;\n    ctx.fillRect(0,0,width,height);\n    //if (isDrawGrid) drawGrid(cv);\n    ctx.restore();\n}\n\\scrollTo(scrollX,scrollY){\n    sprites.scrollTo(scrollX,scrollY);\n}\n\n',
      'graphics/Map.tonyu': 'extends Actor;\nnative Math;\nnative $;\n\\new (param){\n    sx=0;\n    sy=0;\n    super(param);\n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    mapObj=true;\n    mapTable = [];\n    mapOnTable = [];\n    for(var j=0;j<row;j++){\n        rows = [];\n        for(var i=0;i<col;i++){\n            rows.push(-1);\n        }\n        mapTable.push(rows);\n    }\n    for(var j=0;j<row;j++){\n        rows = [];\n        for(var i=0;i<col;i++){\n            rows.push(-1);\n        }\n        mapOnTable.push(rows);\n    }\n    /*for(var i=0;i<col;i++){\n        mapTable[i]=[];\n    }*/\n    initMap();\n}\n\\initMap(){\n    if(!mapData) return;\n    for(var i=0;i<row;i++){\n        for(var j=0;j<col;j++){\n            set(j,i,mapData[i][j]);\n        }\n    }\n    if(!mapOnData) return;\n    for(var i=0;i<row;i++){\n        for(var j=0;j<col;j++){\n            setOn(j,i,mapOnData[i][j]);\n        }\n    }\n}\n\\load(dataFile){\n    baseData=file("../maps/").rel(dataFile).obj();\n    if(!baseData) baseData=file(dataFile).obj();\n    mapTable=baseData[0];\n    mapData=mapTable;\n    row=mapTable.length;\n    col=mapTable[0].length;\n    mapOnTable=baseData[1];\n    mapOnData=mapOnTable;\n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    initMap();\n}\n\\set(setCol,setRow,p){\n    if(setCol>=col || setRow>=row || setCol<0 || setRow<0) return;\n    mapTable[setRow][setCol]=p;\n    //mapOnTable[setRow][setCol]=-1;\n    ctx=buf[0].getContext("2d");\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) {\n        ctx.clearRect(setCol*chipWidth,setRow*chipHeight,chipWidth,chipHeight);\n        return;\n    }\n    ctx.clearRect(setCol*chipWidth,setRow*chipHeight,chipWidth,chipHeight);\n    ctx.save();\n    ctx.drawImage(\n    pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n    setCol*chipWidth, setRow*chipHeight, chipWidth, chipHeight);\n    ctx.restore();\n}\n\\setOn(setCol,setRow,p){\n    if(setCol>=col || setRow>=row || setCol<0 || setRow<0) return;\n    set(setCol,setRow,mapTable[setRow][setCol]);\n    mapOnTable[setRow][setCol]=p;\n    ctx=buf[0].getContext("2d");\n    p=Math.floor(p);\n    pImg=$Sprites.getImageList()[p];\n    if (!pImg) return;\n    ctx.save();\n    ctx.drawImage(\n    pImg.image, pImg.x, pImg.y, pImg.width, pImg.height,\n    setCol*chipWidth, setRow*chipHeight, chipWidth, chipHeight);\n    ctx.restore();\n}\n\\setOnAt(setX,setY,p){\n    setOn(Math.floor(setX/chipWidth),Math.floor(setY/chipHeight),p);\n}\n\\setAt(setX,setY,p){\n    set(Math.floor(setX/chipWidth),Math.floor(setY/chipHeight),p);\n}\n\\get(getCol,getRow){\n    if(getCol<col && getRow<row && getCol>=0 && getRow>=0) return mapTable[getRow][getCol];\n    return -1;\n}\n\\getAt(getX,getY){\n    return get(Math.floor(getX/chipWidth),Math.floor(getY/chipHeight));\n}\n\\getOn(getCol,getRow){\n    if(getCol<col && getRow<row && getCol>=0 && getRow>=0) return mapOnTable[getRow][getCol];\n    return -1;\n}\n\\getOnAt(getX,getY){\n    return getOn(Math.floor(getX/chipWidth),Math.floor(getY/chipHeight));\n}\n\\scrollTo(scrollX,scrollY){\n    sx=-scrollX;\n    sy=-scrollY;\n}\n\\draw(ctx) {\n    pImg=buf[0];\n    ctx.save();\n    ctx.drawImage(\n    pImg, 0, 0,col*chipWidth, row*chipHeight,\n    sx, sy, col*chipWidth, row*chipHeight);\n    ctx.restore();\n}\n',
      'graphics/OneframeSpriteMod.tonyu': 'extends null;\n\nnowait \\drawText(x,y,text,col,size) {\n    if (!size) size=15;\n    if (!col) col="cyan";\n    new T1Text{x,y,text,fillStyle:col, size,oneframeSprite:true};\n}\nnowait \\drawLine(x,y,tx,ty,col) {\n    if (!col) col="white";\n    new T1Line{x,y,tx,ty,col,oneframeSprite:true};\n}\n\n',
      'graphics/Panel.tonyu': 'extends Actor;\nnative $;\nnative Math;\nnative isNaN;\n\\new(opt){\n    super(opt);\n    this.width=width;\n    this.height=height;\n    if(align==null) align="center";\n    if(alpha==null) alpha=255;\n    if(_drawn==null) _drawn=false;\n    buf=$("<canvas>").attr{width,height};\n}\n\\setPanel(width,height){\n    this.width=width;\n    this.height=height;\n    buf=$("<canvas>").attr{width,height};\n}\n\\resize(width,height){\n    setPanel(width,height);\n}\n\\getContext(){\n    _drawn=true;\n    return buf[0].getContext("2d");\n}\n\\setFillStyle(color){\n    this.fillStyle=color;\n}\n\\fillRect(x,y,rectWidth,rectHeight){\n    ctx=getContext();\n    ctx.save();\n    //ctx.clearRect(0,0,this.width,this.height);\n    ctx.fillStyle=fillStyle;\n    ctx.fillRect(x,y,rectWidth,rectHeight);\n    ctx.restore();\n}\n\\fillText(text,x,y,size,align){\n    ctx=getContext();\n    ctx.save();\n    //ctx.clearRect(0,0,this.width,this.height);\n    ctx.textAlign = align;\n    ctx.fillStyle=fillStyle;\n    ctx.font=size+"px \'Courier New\'";\n    ctx.fillText(text,x,y);\n    ctx.restore();\n}\n\\clearRect(clearX,clearY,clearW,clearH){\n    ctx=getContext();\n    ctx.save();\n    ctx.clearRect(clearX,clearY,clearW,clearH);\n    ctx.restore();\n}\n\\getPixel(getX,getY){\n    if(typeof getX=="number" && !isNaN(getX) && \n    typeof getY=="number" && !isNaN(getY)){\n        ctx=getContext();\n        imagedata=ctx.getImageData(getX,getY,1,1);\n        colordata=[imagedata.data[0],imagedata.data[1],imagedata.data[2],imagedata.data[3]];\n        //print(imagedata.data);\n    }else{\n        colordata=[0,0,0,0];\n    }\n    return(colordata);\n}\n\\scroll(scrollX,scrollY){\n    ctx=getContext();\n    ctx.save();\n    imagedata=ctx.getImageData(0,0,this.width,this.height);\n    clearRect(0,0,width,height);\n    ctx.putImageData(imagedata,-scrollX,-scrollY);\n    ctx.restore();\n}\n\\draw(ctx){\n    if(_drawn){\n        pImg=buf[0];\n        ctx.save();\n        if(align=="left"){\n            ctx.translate(x+width/2,y+height/2);\n        }else if(align=="center"){\n            ctx.translate(x,y);\n        }else if(align=="right"){\n            ctx.translate(x-width/2,y-height/2);\n        }\n        if(this.rotation!=0){\n            ctx.rotate(this.rotation/180*Math.PI);\n        }else{\n            ctx.rotate(this.rotate/180*Math.PI);\n        }\n        ctx.globalAlpha=this.alpha/255;\n        ctx.drawImage(\n        pImg, 0, 0,width,height,\n        -width/2, -height/2, width ,height);\n        ctx.restore();\n    }\n}',
      'graphics/ScaledCanvas.tonyu': 'extends Actor;\nnative $;\nnative Math;\n\n// canvas:phisical  buf: logical\n\\new (opt) {\n    extend(opt);\n    // canvas/ width,height\n    resize(width, height);\n    cw=canvas.width();\n    ch=canvas.height();\n    cctx=canvas[0].getContext("2d");\n    this.color="rgb(20,80,180)";\n    sx=0;\n    sy=0;\n    isDrawGrid=$Sprites.isDrawGrid;\n}\n\\resize(width,height) {\n    this.width=width;\n    this.height=height;\n    buf=$("<canvas>").attr{width,height};\n    ctx=buf[0].getContext("2d");  \n    $screenWidth=width;\n    $screenHeight=height;\n    if($panel){\n        $panel.setPanel($screenWidth,$screenHeight);\n    }\n}\n\\shouldDraw1x1(srcw,srch,dstw,dsth) {\n    // srcw=465 -> dstw=460...665\n    var larger=200;\n    var smaller=5;\n    return srcw-smaller<=dstw && dstw<=srcw+larger &&\n    srch-smaller<=dsth && dsth<=srch+larger;\n}\n\\draw() {\n    cw=canvas.width();\n    ch=canvas.height();\n    var calcw=ch/height*width; // calch=ch\n    var calch=cw/width*height; // calcw=cw\n    if (calch>ch) calch=ch;\n    if (calcw>cw) calcw=cw;\n    cctx.clearRect(0,0,cw,ch);\n    if (shouldDraw1x1(width,height,calcw,calch)) {\n        calcw=width;calch=height;\n    }\n    var marginw=Math.floor((cw-calcw)/2);\n    var marginh=Math.floor((ch-calch)/2);\n    cctx.drawImage(buf[0],\n    0,0,width, height, \n    marginw,marginh,calcw, calch );\n}\n\\canvas2buf(point) {\n    var calcw=ch/height*width; // calch=ch\n    var calch=cw/width*height; // calcw=cw\n    if (calch>ch) calch=ch;\n    if (calcw>cw) calcw=cw;\n    if (shouldDraw1x1(width,height,calcw,calch)) {\n        calcw=width;calch=height;\n    }\n    var marginw=Math.floor((cw-calcw)/2);\n    var marginh=Math.floor((ch-calch)/2);\n    //For mysterious bug of Chrome on Android 5....\n    _ret="("+point.x+"-"+marginw+")/"+calcw+"*"+width+",";\n    return {x: (point.x-marginw)/calcw*width, \n    y: (point.y-marginh)/calch*height};\n}\n\\setBGColor(color){\n    this.color=color;\n}\n\\fillCanvas(cv){\n    var ctx=cv.getContext("2d");\n    ctx.save();\n    ctx.fillStyle=$Screen.color;\n    ctx.fillStyle=color;\n    ctx.fillRect(0,0,cv.width,cv.height);\n    if (isDrawGrid) drawGrid(cv);\n    ctx.restore();\n}\n\\scrollTo(scrollX,scrollY){\n    /*for(o in all()){\n        //print(o.mapObj);\n        if(o.mapObj){\n            o.scrollTo(o.sx+scrollX,o.sy+scrollY);\n        }else if(o.x!=undefined && o.y!=undefined){\n            o.x+=scrollX;\n            o.y+=scrollY;\n        }\n    }*/\n    //sx=scrollX;\n    //sy=scrollY;\n    $Sprites.scrollTo(scrollX,scrollY);\n}',
      'graphics/Sprites.tonyu': 'extends Actor;\nnative Tonyu;\n\\new() {\n    sprites=[];\n    imageList=[];\n    hitWatchers=[];\n    isDrawGrid=Tonyu.noviceMode;\n    sx=0;\n    sy=0;\n    objId=0;\n}\nfunction add(s) {\n    if (s.__addedToSprites) return;\n    sprites.push(s);\n    if(s.__genId==null){\n        s.__genId=objId;\n        objId++;\n    }\n    s.__addedToSprites=this;\n    return s;\n}\nfunction remove(s) {\n    var idx=sprites.indexOf(s);\n    if (idx<0) return;\n    sprites.splice(idx,1);\n    delete s.__addedToSprites;\n}\n\\removeOneframes() {\n    for (var i=sprites.length-1 ; i>=0 ; i--) {\n        if (sprites[i].oneframeSprite) {\n            sprites.splice(i,1);\n        }\n    }\n}\nfunction clear() {sprites.splice(0,sprites.length);}\nfunction compOrder(obj1, obj2){\n    var val1=obj1.zOrder;\n    var val2=obj2.zOrder;\n    if(val1>val2){\n        return -1;\n    }else if(val1<val2){\n        return 1;\n    }else if(val1==val2){\n        if(obj1.__genId>obj2.__genId){\n            return 1;\n        }else{\n            return -1;\n        }\n        return 0;\n    }\n}\nfunction draw(cv) {\n    var ctx=cv.getContext("2d");\n    ctx.save();\n    /*\n    ctx.fillStyle=$Screen.color;\n    ctx.fillRect(0,0,cv.width,cv.height);\n    if (isDrawGrid) drawGrid(cv);\n    */\n    var orderArray=[];\n    orderArray=orderArray.concat(sprites);\n    orderArray.sort(compOrder);\n    ctx.translate(-sx,-sy);\n    orderArray.forEach(\\(s){\n        s.draw(ctx);\n    });\n    ctx.restore();\n}\nfunction checkHit() {\n    hitWatchers.forEach(function (w) {\n        sprites.forEach(function (a) {\n            //console.log("a:",  a.owner);\n            var a_owner=a;//a.owner|| a;\n            if (! (a_owner instanceof w.A)) return;\n            sprites.forEach(function (b) {\n                var b_owner=b;//b.owner|| b;\n                if (a===b) return;\n                if (! (b_owner instanceof w.B)) return;\n                //console.log("b:",  b.owner);\n                if (a.crashTo1(b)) {\n                    //console.log("hit", a.owner, b.owner);\n                    w.h(a_owner,b_owner);\n                }\n            });\n        });\n    });\n}\nfunction watchHit(typeA, typeB, onHit) {\n    var p={A: typeA, B:typeB, h:onHit};\n    //console.log(p);\n    hitWatchers.push(p);\n}\nfunction drawGrid(c) {\n    var ctx=c.getContext("2d");\n    ctx.textBaseline="top";\n    ctx.save();\n    ctx.strokeStyle="rgb(40,100,200)";\n    for (var i=0 ; i<c.width ; i+=10) {\n        ctx.beginPath();\n        ctx.lineWidth=(i % 100 ==0 ? 4 : 1);\n        ctx.moveTo(i,0);\n        ctx.lineTo(i,c.height);\n        ctx.closePath();\n        ctx.stroke();\n    }\n    \n    for (var i=0 ; i<c.height ; i+=10) {\n        ctx.beginPath();\n        ctx.lineWidth=(i % 100 ==0 ? 4 : 1);\n        ctx.moveTo(0,i);\n        ctx.lineTo(c.width,i);\n        ctx.closePath();\n        ctx.stroke();\n    }\n    ctx.fillStyle="white";\n    ctx.font="15px monospaced";\n    for (var i=100 ; i<c.width ; i+=100) {\n        ctx.fillText(i, i,0);\n    }\n    for (var i=100 ; i<c.height ; i+=100) {\n        ctx.fillText(i, 0,i);\n    }\n    ctx.restore();\n}\nfunction setImageList(il) {\n    imageList=il;\n}\nfunction getImageList() {\n    return imageList;\n}\nfunction scrollTo(scrollX,scrollY){\n    sx=scrollX;\n    sy=scrollY;\n}',
      'graphics/TextRectMod.tonyu': 'extends null;\n\nnowait function drawTextRect(ctx, text, x, topY, h, align , type) {\n    if (!align) align="center";\n    ctx.textBaseline="top";\n    setFontSize(ctx, h);\n    var met=ctx.measureText(text);\n    var res={y:topY, w: met.width, h:h};\n    var t=align.substring(0,1).toLowerCase();\n    if (t=="l") res.x=x;\n    else if (t=="r") res.x=x-met.width;\n    else if (t=="c") res.x=x-met.width/2;\n    if (type=="fill") ctx.fillText(text, res.x,topY);\n    if (type=="stroke") ctx.strokeText(text, res.x,topY);\n    return res;\n}\nnowait function setFontSize(ctx,sz) {\n    var post=ctx.font.replace(/^[0-9\\.]+/,"");\n    ctx.font=sz+post;\n}\n\nnowait function fukidashi(ctx, text, x, y, sz) {\n    var align="c";\n    var theight=20;\n    var margin=5;\n    var r=drawTextRect(ctx, text, x,y-theight-margin-sz, sz, align);\n    ctx.beginPath();\n    ctx.moveTo(x , y);\n    ctx.lineTo(x+margin , y-theight);\n    ctx.lineTo(x+r.w/2+margin , y-theight);\n    ctx.lineTo(x+r.w/2+margin , y-theight-r.h-margin*2);\n    ctx.lineTo(x-r.w/2-margin , y-theight-r.h-margin*2);\n    ctx.lineTo(x-r.w/2-margin , y-theight);\n    ctx.lineTo(x-margin , y-theight);\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke();\n    \n    var fs=ctx.fillStyle;\n    ctx.fillStyle=ctx.strokeStyle;\n    drawTextRect(ctx, text, x, y-theight-margin-sz, sz, align, "fill");\n    ctx.fillStyle=fs;\n}\n\n',
      'js/': '{"concat.js":{"lastUpdate":1432606561083},"index.html":{"lastUpdate":1430107873565}}',
      'js/concat.js': 'Tonyu.klass.define({\n  fullName: \'kernel.EventMod\',\n  shortName: \'EventMod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_EventMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_EventMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initEventMod :function _trc_EventMod_initEventMod() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=1000063;//kernel.EventMod:63\n      if (_this._eventHandlers) {\n        return _this;\n      }\n      //$LASTPOS=1000095;//kernel.EventMod:95\n      _this._eventHandlers={};\n      //$LASTPOS=1000118;//kernel.EventMod:118\n      _this.on("die",Tonyu.bindFunc(_this,_this.releaseEventMod));\n    },\n    releaseEventMod :function _trc_EventMod_releaseEventMod() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var k;\n      var v;\n      var _it_1;\n      \n      //$LASTPOS=1000182;//kernel.EventMod:182\n      _it_1=Tonyu.iterator(_this._eventHandlers,2);\n      while(_it_1.next()) {\n        k=_it_1[0];\n        v=_it_1[1];\n        \n        //$LASTPOS=1000224;//kernel.EventMod:224\n        v.release();\n        \n      }\n    },\n    parseArgs :function _trc_EventMod_parseArgs(a) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      var i;\n      \n      //$LASTPOS=1000274;//kernel.EventMod:274\n      res = {type: a[0],args: []};\n      //$LASTPOS=1000308;//kernel.EventMod:308\n      //$LASTPOS=1000313;//kernel.EventMod:313\n      i = 1;\n      while(i<a.length) {\n        {\n          //$LASTPOS=1000351;//kernel.EventMod:351\n          res.args.push(a[i]);\n        }\n        i++;\n      }\n      return res;\n    },\n    registerEventHandler :function _trc_EventMod_registerEventHandler(type,obj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=1000474;//kernel.EventMod:474\n      _this.initEventMod();\n      //$LASTPOS=1000494;//kernel.EventMod:494\n      if (typeof  type=="function") {\n        //$LASTPOS=1000533;//kernel.EventMod:533\n        obj=obj||new type({target: _this});\n        //$LASTPOS=1000573;//kernel.EventMod:573\n        type=obj.getClassInfo().fullName;\n        \n      } else {\n        //$LASTPOS=1000629;//kernel.EventMod:629\n        obj=obj||new Tonyu.classes.kernel.EventHandler({target: _this});\n        \n      }\n      return _this._eventHandlers[type]=obj;\n    },\n    getEventHandler :function _trc_EventMod_getEventHandler(type) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      \n      //$LASTPOS=1000756;//kernel.EventMod:756\n      _this.initEventMod();\n      //$LASTPOS=1000776;//kernel.EventMod:776\n      if (typeof  type=="function") {\n        //$LASTPOS=1000815;//kernel.EventMod:815\n        type=type.meta.fullName;\n        \n      }\n      //$LASTPOS=1000850;//kernel.EventMod:850\n      res = _this._eventHandlers[type];\n      return res;\n    },\n    getOrRegisterEventHandler :function _trc_EventMod_getOrRegisterEventHandler(type) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      \n      //$LASTPOS=1000946;//kernel.EventMod:946\n      res = _this.getEventHandler(type)||_this.registerEventHandler(type);\n      return res;\n    },\n    on :function _trc_EventMod_on() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var a;\n      var h;\n      \n      //$LASTPOS=1001049;//kernel.EventMod:1049\n      a = _this.parseArgs(arguments);\n      //$LASTPOS=1001082;//kernel.EventMod:1082\n      h = _this.getOrRegisterEventHandler(a.type);\n      return h.addListener.apply(h,a.args);\n    },\n    fireEvent :function _trc_EventMod_fireEvent(type,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var h;\n      \n      //$LASTPOS=1001208;//kernel.EventMod:1208\n      h = _this.getEventHandler(type);\n      //$LASTPOS=1001242;//kernel.EventMod:1242\n      if (h) {\n        //$LASTPOS=1001249;//kernel.EventMod:1249\n        h.fire([arg]);\n      }\n    },\n    sendEvent :function _trc_EventMod_sendEvent(type,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=1001304;//kernel.EventMod:1304\n      _this.fireEvent(type,arg);\n    },\n    waitEvent :function _trc_EventMod_waitEvent() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var args;\n      var i;\n      \n      //$LASTPOS=1001351;//kernel.EventMod:1351\n      if (null) {\n        //$LASTPOS=1001375;//kernel.EventMod:1375\n        args = [];\n        //$LASTPOS=1001397;//kernel.EventMod:1397\n        //$LASTPOS=1001402;//kernel.EventMod:1402\n        i = 0;\n        while(i<arguments.length) {\n          {\n            //$LASTPOS=1001449;//kernel.EventMod:1449\n            if (arguments[i]===undefined) {\n              break;\n              \n            }\n            //$LASTPOS=1001499;//kernel.EventMod:1499\n            args.push(arguments[i]);\n          }\n          i++;\n        }\n        //$LASTPOS=1001544;//kernel.EventMod:1544\n        null.waitEvent(_this,args);\n        \n      }\n    },\n    fiber$waitEvent :function _trc_EventMod_f_waitEvent(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var args;\n      var i;\n      \n      //$LASTPOS=1001351;//kernel.EventMod:1351\n      if (_thread) {\n        //$LASTPOS=1001375;//kernel.EventMod:1375\n        args = [];\n        //$LASTPOS=1001397;//kernel.EventMod:1397\n        //$LASTPOS=1001402;//kernel.EventMod:1402\n        i = 0;\n        while(i<_arguments.length) {\n          {\n            //$LASTPOS=1001449;//kernel.EventMod:1449\n            if (_arguments[i]===undefined) {\n              break;\n              \n            }\n            //$LASTPOS=1001499;//kernel.EventMod:1499\n            args.push(_arguments[i]);\n          }\n          i++;\n        }\n        //$LASTPOS=1001544;//kernel.EventMod:1544\n        _thread.waitEvent(_this,args);\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"initEventMod":{"nowait":true},"releaseEventMod":{"nowait":true},"parseArgs":{"nowait":true},"registerEventHandler":{"nowait":true},"getEventHandler":{"nowait":true},"getOrRegisterEventHandler":{"nowait":true},"on":{"nowait":true},"fireEvent":{"nowait":true},"sendEvent":{"nowait":true},"waitEvent":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.OneframeSpriteMod\',\n  shortName: \'OneframeSpriteMod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_OneframeSpriteMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_OneframeSpriteMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    drawText :function _trc_OneframeSpriteMod_drawText(x,y,text,col,size) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=2000060;//kernel.OneframeSpriteMod:60\n      if (! size) {\n        //$LASTPOS=2000071;//kernel.OneframeSpriteMod:71\n        size=15;\n      }\n      //$LASTPOS=2000085;//kernel.OneframeSpriteMod:85\n      if (! col) {\n        //$LASTPOS=2000095;//kernel.OneframeSpriteMod:95\n        col="cyan";\n      }\n      //$LASTPOS=2000112;//kernel.OneframeSpriteMod:112\n      new Tonyu.classes.kernel.T1Text({x: x,y: y,text: text,fillStyle: col,size: size,oneframeSprite: true});\n    },\n    drawLine :function _trc_OneframeSpriteMod_drawLine(x,y,tx,ty,col) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=2000217;//kernel.OneframeSpriteMod:217\n      if (! col) {\n        //$LASTPOS=2000227;//kernel.OneframeSpriteMod:227\n        col="white";\n      }\n      //$LASTPOS=2000245;//kernel.OneframeSpriteMod:245\n      new Tonyu.classes.kernel.T1Line({x: x,y: y,tx: tx,ty: ty,col: col,oneframeSprite: true});\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"drawText":{"nowait":true},"drawLine":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.TextRectMod\',\n  shortName: \'TextRectMod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_TextRectMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_TextRectMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    drawTextRect :function _trc_TextRectMod_drawTextRect(ctx,text,x,topY,h,align,type) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var met;\n      var res;\n      var t;\n      \n      //$LASTPOS=3000090;//kernel.TextRectMod:90\n      if (! align) {\n        //$LASTPOS=3000102;//kernel.TextRectMod:102\n        align="center";\n      }\n      //$LASTPOS=3000123;//kernel.TextRectMod:123\n      ctx.textBaseline="top";\n      //$LASTPOS=3000152;//kernel.TextRectMod:152\n      _this.setFontSize(ctx,h);\n      //$LASTPOS=3000178;//kernel.TextRectMod:178\n      met = ctx.measureText(text);\n      //$LASTPOS=3000214;//kernel.TextRectMod:214\n      res = {y: topY,w: met.width,h: h};\n      //$LASTPOS=3000256;//kernel.TextRectMod:256\n      t = align.substring(0,1).toLowerCase();\n      //$LASTPOS=3000303;//kernel.TextRectMod:303\n      if (t=="l") {\n        //$LASTPOS=3000315;//kernel.TextRectMod:315\n        res.x=x;\n      } else {\n        //$LASTPOS=3000334;//kernel.TextRectMod:334\n        if (t=="r") {\n          //$LASTPOS=3000346;//kernel.TextRectMod:346\n          res.x=x-met.width;\n        } else {\n          //$LASTPOS=3000375;//kernel.TextRectMod:375\n          if (t=="c") {\n            //$LASTPOS=3000387;//kernel.TextRectMod:387\n            res.x=x-met.width/2;\n          }\n        }\n      }\n      //$LASTPOS=3000413;//kernel.TextRectMod:413\n      if (type=="fill") {\n        //$LASTPOS=3000431;//kernel.TextRectMod:431\n        ctx.fillText(text,res.x,topY);\n      }\n      //$LASTPOS=3000468;//kernel.TextRectMod:468\n      if (type=="stroke") {\n        //$LASTPOS=3000488;//kernel.TextRectMod:488\n        ctx.strokeText(text,res.x,topY);\n      }\n      return res;\n    },\n    setFontSize :function _trc_TextRectMod_setFontSize(ctx,sz) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var post;\n      \n      //$LASTPOS=3000586;//kernel.TextRectMod:586\n      post = ctx.font.replace(/^[0-9\\.]+/,"");\n      //$LASTPOS=3000634;//kernel.TextRectMod:634\n      ctx.font=sz+post;\n    },\n    fukidashi :function _trc_TextRectMod_fukidashi(ctx,text,x,y,sz) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var align;\n      var theight;\n      var margin;\n      var r;\n      var fs;\n      \n      //$LASTPOS=3000712;//kernel.TextRectMod:712\n      align = "c";\n      //$LASTPOS=3000732;//kernel.TextRectMod:732\n      theight = 20;\n      //$LASTPOS=3000753;//kernel.TextRectMod:753\n      margin = 5;\n      //$LASTPOS=3000772;//kernel.TextRectMod:772\n      r = _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align);\n      //$LASTPOS=3000842;//kernel.TextRectMod:842\n      ctx.beginPath();\n      //$LASTPOS=3000864;//kernel.TextRectMod:864\n      ctx.moveTo(x,y);\n      //$LASTPOS=3000888;//kernel.TextRectMod:888\n      ctx.lineTo(x+margin,y-theight);\n      //$LASTPOS=3000927;//kernel.TextRectMod:927\n      ctx.lineTo(x+r.w/2+margin,y-theight);\n      //$LASTPOS=3000972;//kernel.TextRectMod:972\n      ctx.lineTo(x+r.w/2+margin,y-theight-r.h-margin*2);\n      //$LASTPOS=3001030;//kernel.TextRectMod:1030\n      ctx.lineTo(x-r.w/2-margin,y-theight-r.h-margin*2);\n      //$LASTPOS=3001088;//kernel.TextRectMod:1088\n      ctx.lineTo(x-r.w/2-margin,y-theight);\n      //$LASTPOS=3001133;//kernel.TextRectMod:1133\n      ctx.lineTo(x-margin,y-theight);\n      //$LASTPOS=3001172;//kernel.TextRectMod:1172\n      ctx.closePath();\n      //$LASTPOS=3001194;//kernel.TextRectMod:1194\n      ctx.fill();\n      //$LASTPOS=3001211;//kernel.TextRectMod:1211\n      ctx.stroke();\n      //$LASTPOS=3001236;//kernel.TextRectMod:1236\n      fs = ctx.fillStyle;\n      //$LASTPOS=3001263;//kernel.TextRectMod:1263\n      ctx.fillStyle=ctx.strokeStyle;\n      //$LASTPOS=3001299;//kernel.TextRectMod:1299\n      _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align,"fill");\n      //$LASTPOS=3001372;//kernel.TextRectMod:1372\n      ctx.fillStyle=fs;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"drawTextRect":{"nowait":true},"setFontSize":{"nowait":true},"fukidashi":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.MathMod\',\n  shortName: \'MathMod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_MathMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_MathMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    sin :function _trc_MathMod_sin(d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.sin(_this.rad(d));\n    },\n    cos :function _trc_MathMod_cos(d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.cos(_this.rad(d));\n    },\n    rad :function _trc_MathMod_rad(d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return d/180*Math.PI;\n    },\n    deg :function _trc_MathMod_deg(d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return d/Math.PI*180;\n    },\n    abs :function _trc_MathMod_abs(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.abs(v);\n    },\n    atan2 :function _trc_MathMod_atan2(x,y) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.deg(Math.atan2(x,y));\n    },\n    floor :function _trc_MathMod_floor(x) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.floor(x);\n    },\n    angleDiff :function _trc_MathMod_angleDiff(a,b) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var c;\n      \n      //$LASTPOS=4000416;//kernel.MathMod:416\n      c;\n      //$LASTPOS=4000428;//kernel.MathMod:428\n      a=_this.floor(a);\n      //$LASTPOS=4000445;//kernel.MathMod:445\n      b=_this.floor(b);\n      //$LASTPOS=4000462;//kernel.MathMod:462\n      if (a>=b) {\n        //$LASTPOS=4000483;//kernel.MathMod:483\n        c=(a-b)%360;\n        //$LASTPOS=4000507;//kernel.MathMod:507\n        if (c>=180) {\n          //$LASTPOS=4000519;//kernel.MathMod:519\n          c-=360;\n        }\n        \n      } else {\n        //$LASTPOS=4000550;//kernel.MathMod:550\n        c=- ((b-a)%360);\n        //$LASTPOS=4000577;//kernel.MathMod:577\n        if (c<- 180) {\n          //$LASTPOS=4000589;//kernel.MathMod:589\n          c+=360;\n        }\n        \n      }\n      return c;\n    },\n    sqrt :function _trc_MathMod_sqrt(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.sqrt(t);\n    },\n    dist :function _trc_MathMod_dist(dx,dy) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var t;\n      \n      //$LASTPOS=4000698;//kernel.MathMod:698\n      if (typeof  dx=="object") {\n        //$LASTPOS=4000734;//kernel.MathMod:734\n        t = dx;\n        //$LASTPOS=4000753;//kernel.MathMod:753\n        dx=t.x-_this.x;\n        //$LASTPOS=4000762;//kernel.MathMod:762\n        dy=t.y-_this.y;\n        \n      }\n      return _this.sqrt(dx*dx+dy*dy);\n    },\n    trunc :function _trc_MathMod_trunc(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=4000838;//kernel.MathMod:838\n      if (f>=0) {\n        return Math.floor(f);\n      } else {\n        return Math.ceil(f);\n      }\n    },\n    ceil :function _trc_MathMod_ceil(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.ceil(f);\n    },\n    rnd :function _trc_MathMod_rnd(r) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=4000975;//kernel.MathMod:975\n      if (typeof  r=="number") {\n        return Math.floor(Math.random()*r);\n        \n      }\n      return Math.random();\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"sin":{"nowait":true},"cos":{"nowait":true},"rad":{"nowait":true},"deg":{"nowait":true},"abs":{"nowait":true},"atan2":{"nowait":true},"floor":{"nowait":true},"angleDiff":{"nowait":true},"sqrt":{"nowait":true},"dist":{"nowait":true},"trunc":{"nowait":true},"ceil":{"nowait":true},"rnd":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T2Mod\',\n  shortName: \'T2Mod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_T2Mod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T2Mod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    bvec :function _trc_T2Mod_bvec(tx,ty) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b2Vec2;\n      \n      //$LASTPOS=5000034;//kernel.T2Mod:34\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      return new b2Vec2(tx/_this.scale,ty/_this.scale);\n    },\n    fiber$bvec :function _trc_T2Mod_f_bvec(_thread,tx,ty) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b2Vec2;\n      \n      //$LASTPOS=5000034;//kernel.T2Mod:34\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      _thread.retVal=new b2Vec2(tx/_this.scale,ty/_this.scale);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    defv :function _trc_T2Mod_defv(t,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return (t===t&&(typeof  t)==="number")?t:d;\n    },\n    fiber$defv :function _trc_T2Mod_f_defv(_thread,t,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=(t===t&&(typeof  t)==="number")?t:d;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"bvec":{"nowait":false},"defv":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.MediaPlayer\',\n  shortName: \'MediaPlayer\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_MediaPlayer_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_MediaPlayer_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    play :function _trc_MediaPlayer_play() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$play :function _trc_MediaPlayer_f_play(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stop :function _trc_MediaPlayer_stop() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$stop :function _trc_MediaPlayer_f_stop(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    playSE :function _trc_MediaPlayer_playSE() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$playSE :function _trc_MediaPlayer_f_playSE(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setDelay :function _trc_MediaPlayer_setDelay() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$setDelay :function _trc_MediaPlayer_f_setDelay(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setVolume :function _trc_MediaPlayer_setVolume() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$setVolume :function _trc_MediaPlayer_f_setVolume(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"play":{"nowait":false},"stop":{"nowait":false},"playSE":{"nowait":false},"setDelay":{"nowait":false},"setVolume":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.ThreadGroupMod\',\n  shortName: \'ThreadGroupMod\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_ThreadGroupMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_ThreadGroupMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    addThread :function _trc_ThreadGroupMod_addThread(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=6000038;//kernel.ThreadGroupMod:38\n      _this.threads=_this.threads||[];\n      //$LASTPOS=6000064;//kernel.ThreadGroupMod:64\n      _this.threads.push(t);\n    },\n    fiber$addThread :function _trc_ThreadGroupMod_f_addThread(_thread,t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=6000038;//kernel.ThreadGroupMod:38\n      _this.threads=_this.threads||[];\n      //$LASTPOS=6000064;//kernel.ThreadGroupMod:64\n      _this.threads.push(t);\n      \n      _thread.retVal=_this;return;\n    },\n    addThreadGroup :function _trc_ThreadGroupMod_addThreadGroup(tg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=6000112;//kernel.ThreadGroupMod:112\n      _this.threadGroups=_this.threadGroups||[];\n      //$LASTPOS=6000148;//kernel.ThreadGroupMod:148\n      _this.threadGroups.push(tg);\n    },\n    fiber$addThreadGroup :function _trc_ThreadGroupMod_f_addThreadGroup(_thread,tg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=6000112;//kernel.ThreadGroupMod:112\n      _this.threadGroups=_this.threadGroups||[];\n      //$LASTPOS=6000148;//kernel.ThreadGroupMod:148\n      _this.threadGroups.push(tg);\n      \n      _thread.retVal=_this;return;\n    },\n    killThreadGroup :function _trc_ThreadGroupMod_killThreadGroup() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var thread;\n      var _it_26;\n      var threadGroup;\n      var _it_27;\n      \n      //$LASTPOS=6000201;//kernel.ThreadGroupMod:201\n      if (_this.threads) {\n        //$LASTPOS=6000225;//kernel.ThreadGroupMod:225\n        _it_26=Tonyu.iterator(_this.threads,1);\n        while(_it_26.next()) {\n          thread=_it_26[0];\n          \n          //$LASTPOS=6000268;//kernel.ThreadGroupMod:268\n          thread.kill();\n          \n        }\n        \n      }\n      //$LASTPOS=6000306;//kernel.ThreadGroupMod:306\n      if (_this.threadGroups) {\n        //$LASTPOS=6000335;//kernel.ThreadGroupMod:335\n        _it_27=Tonyu.iterator(_this.threadGroups,1);\n        while(_it_27.next()) {\n          threadGroup=_it_27[0];\n          \n          //$LASTPOS=6000388;//kernel.ThreadGroupMod:388\n          threadGroup.killThreadGroup();\n          \n        }\n        \n      }\n    },\n    fiber$killThreadGroup :function _trc_ThreadGroupMod_f_killThreadGroup(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var thread;\n      var _it_26;\n      var threadGroup;\n      var _it_27;\n      \n      //$LASTPOS=6000201;//kernel.ThreadGroupMod:201\n      if (_this.threads) {\n        //$LASTPOS=6000225;//kernel.ThreadGroupMod:225\n        _it_26=Tonyu.iterator(_this.threads,1);\n        while(_it_26.next()) {\n          thread=_it_26[0];\n          \n          //$LASTPOS=6000268;//kernel.ThreadGroupMod:268\n          thread.kill();\n          \n        }\n        \n      }\n      //$LASTPOS=6000306;//kernel.ThreadGroupMod:306\n      if (_this.threadGroups) {\n        //$LASTPOS=6000335;//kernel.ThreadGroupMod:335\n        _it_27=Tonyu.iterator(_this.threadGroups,1);\n        while(_it_27.next()) {\n          threadGroup=_it_27[0];\n          \n          //$LASTPOS=6000388;//kernel.ThreadGroupMod:388\n          threadGroup.killThreadGroup();\n          \n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"addThread":{"nowait":false},"addThreadGroup":{"nowait":false},"killThreadGroup":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.TObject\',\n  shortName: \'TObject\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_TObject_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_TObject_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_TObject_initialize(options) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=7000052;//kernel.TObject:52\n      if (typeof  options=="object") {\n        //$LASTPOS=7000082;//kernel.TObject:82\n        _this.extend(options);\n      }\n      //$LASTPOS=7000104;//kernel.TObject:104\n      _this.main();\n    },\n    extend :function _trc_TObject_extend(obj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.extend(_this,obj);\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"extend":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.TQuery\',\n  shortName: \'TQuery\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [Tonyu.classes.kernel.MathMod],\n  methods: {\n    main :function _trc_TQuery_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_TQuery_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_TQuery_initialize() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=8000049;//kernel.TQuery:49\n      _this.length=0;\n    },\n    tonyuIterator :function _trc_TQuery_tonyuIterator(arity) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      \n      //$LASTPOS=8000089;//kernel.TQuery:89\n      res = {};\n      //$LASTPOS=8000105;//kernel.TQuery:105\n      res.i=0;\n      //$LASTPOS=8000118;//kernel.TQuery:118\n      if (arity==1) {\n        //$LASTPOS=8000142;//kernel.TQuery:142\n        res.next=(function anonymous_151() {\n          \n          //$LASTPOS=8000177;//kernel.TQuery:177\n          if (res.i>=_this.length) {\n            return false;\n          }\n          //$LASTPOS=8000227;//kernel.TQuery:227\n          res[0]=_this[res.i];\n          //$LASTPOS=8000259;//kernel.TQuery:259\n          res.i++;\n          return true;\n        });\n        \n      } else {\n        //$LASTPOS=8000325;//kernel.TQuery:325\n        res.next=(function anonymous_334() {\n          \n          //$LASTPOS=8000360;//kernel.TQuery:360\n          if (res.i>=_this.length) {\n            return false;\n          }\n          //$LASTPOS=8000410;//kernel.TQuery:410\n          res[0]=res.i;\n          //$LASTPOS=8000436;//kernel.TQuery:436\n          res[1]=_this[res.i];\n          //$LASTPOS=8000468;//kernel.TQuery:468\n          res.i++;\n          return true;\n        });\n        \n      }\n      return res;\n    },\n    fiber$tonyuIterator :function _trc_TQuery_f_tonyuIterator(_thread,arity) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var res;\n      \n      //$LASTPOS=8000089;//kernel.TQuery:89\n      res = {};\n      //$LASTPOS=8000105;//kernel.TQuery:105\n      res.i=0;\n      //$LASTPOS=8000118;//kernel.TQuery:118\n      if (arity==1) {\n        //$LASTPOS=8000142;//kernel.TQuery:142\n        res.next=(function anonymous_151() {\n          \n          //$LASTPOS=8000177;//kernel.TQuery:177\n          if (res.i>=_this.length) {\n            return false;\n          }\n          //$LASTPOS=8000227;//kernel.TQuery:227\n          res[0]=_this[res.i];\n          //$LASTPOS=8000259;//kernel.TQuery:259\n          res.i++;\n          return true;\n        });\n        \n      } else {\n        //$LASTPOS=8000325;//kernel.TQuery:325\n        res.next=(function anonymous_334() {\n          \n          //$LASTPOS=8000360;//kernel.TQuery:360\n          if (res.i>=_this.length) {\n            return false;\n          }\n          //$LASTPOS=8000410;//kernel.TQuery:410\n          res[0]=res.i;\n          //$LASTPOS=8000436;//kernel.TQuery:436\n          res[1]=_this[res.i];\n          //$LASTPOS=8000468;//kernel.TQuery:468\n          res.i++;\n          return true;\n        });\n        \n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    attr :function _trc_TQuery_attr() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var values;\n      var i;\n      var e;\n      var _it_33;\n      \n      //$LASTPOS=8000551;//kernel.TQuery:551\n      values;\n      //$LASTPOS=8000567;//kernel.TQuery:567\n      if (_this.length==0) {\n        return _this;\n      }\n      //$LASTPOS=8000594;//kernel.TQuery:594\n      if (arguments.length==1&&typeof  arguments[0]=="string") {\n        return _this[0][arguments[0]];\n        \n      }\n      //$LASTPOS=8000702;//kernel.TQuery:702\n      if (arguments.length>=2) {\n        //$LASTPOS=8000737;//kernel.TQuery:737\n        values={};\n        //$LASTPOS=8000756;//kernel.TQuery:756\n        //$LASTPOS=8000761;//kernel.TQuery:761\n        i = 0;\n        while(i<arguments.length-1) {\n          {\n            //$LASTPOS=8000813;//kernel.TQuery:813\n            values[arguments[i]]=arguments[i+1];\n          }\n          i+=2;\n        }\n        \n      } else {\n        //$LASTPOS=8000881;//kernel.TQuery:881\n        values=arguments[0];\n        \n      }\n      //$LASTPOS=8000912;//kernel.TQuery:912\n      if (values) {\n        //$LASTPOS=8000934;//kernel.TQuery:934\n        _it_33=Tonyu.iterator(_this,1);\n        while(_it_33.next()) {\n          e=_it_33[0];\n          \n          //$LASTPOS=8000968;//kernel.TQuery:968\n          e.extend(values);\n          \n        }\n        \n      }\n    },\n    fiber$attr :function _trc_TQuery_f_attr(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var values;\n      var i;\n      var e;\n      var _it_33;\n      \n      //$LASTPOS=8000551;//kernel.TQuery:551\n      values;\n      //$LASTPOS=8000567;//kernel.TQuery:567\n      if (_this.length==0) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=8000594;//kernel.TQuery:594\n      if (_arguments.length==1&&typeof  _arguments[0]=="string") {\n        _thread.retVal=_this[0][_arguments[0]];return;\n        \n        \n      }\n      //$LASTPOS=8000702;//kernel.TQuery:702\n      if (_arguments.length>=2) {\n        //$LASTPOS=8000737;//kernel.TQuery:737\n        values={};\n        //$LASTPOS=8000756;//kernel.TQuery:756\n        //$LASTPOS=8000761;//kernel.TQuery:761\n        i = 0;\n        while(i<_arguments.length-1) {\n          {\n            //$LASTPOS=8000813;//kernel.TQuery:813\n            values[_arguments[i]]=_arguments[i+1];\n          }\n          i+=2;\n        }\n        \n      } else {\n        //$LASTPOS=8000881;//kernel.TQuery:881\n        values=_arguments[0];\n        \n      }\n      //$LASTPOS=8000912;//kernel.TQuery:912\n      if (values) {\n        //$LASTPOS=8000934;//kernel.TQuery:934\n        _it_33=Tonyu.iterator(_this,1);\n        while(_it_33.next()) {\n          e=_it_33[0];\n          \n          //$LASTPOS=8000968;//kernel.TQuery:968\n          e.extend(values);\n          \n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    genKeyfunc :function _trc_TQuery_genKeyfunc(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=8001028;//kernel.TQuery:1028\n      if (typeof  key!="function") {\n        return (function anonymous_1073(o) {\n          \n          return o[key];\n        });\n        \n      } else {\n        return key;\n        \n      }\n    },\n    fiber$genKeyfunc :function _trc_TQuery_f_genKeyfunc(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=8001028;//kernel.TQuery:1028\n      if (typeof  key!="function") {\n        _thread.retVal=(function anonymous_1073(o) {\n          \n          return o[key];\n        });return;\n        \n        \n      } else {\n        _thread.retVal=key;return;\n        \n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    maxs :function _trc_TQuery_maxs(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var f;\n      var res;\n      var reso;\n      var o;\n      var _it_39;\n      var v;\n      \n      //$LASTPOS=8001154;//kernel.TQuery:1154\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=8001181;//kernel.TQuery:1181\n      res;reso = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=8001210;//kernel.TQuery:1210\n      _it_39=Tonyu.iterator(_this,1);\n      while(_it_39.next()) {\n        o=_it_39[0];\n        \n        //$LASTPOS=8001240;//kernel.TQuery:1240\n        v = f(o);\n        //$LASTPOS=8001260;//kernel.TQuery:1260\n        if (res==null||v>=res) {\n          //$LASTPOS=8001299;//kernel.TQuery:1299\n          if (v>res) {\n            //$LASTPOS=8001310;//kernel.TQuery:1310\n            reso=new Tonyu.classes.kernel.TQuery;\n          }\n          //$LASTPOS=8001339;//kernel.TQuery:1339\n          reso.push(o);\n          //$LASTPOS=8001365;//kernel.TQuery:1365\n          res=v;\n          \n        }\n        \n      }\n      return reso;\n    },\n    fiber$maxs :function _trc_TQuery_f_maxs(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var f;\n      var res;\n      var reso;\n      var o;\n      var _it_39;\n      var v;\n      \n      //$LASTPOS=8001154;//kernel.TQuery:1154\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=8001181;//kernel.TQuery:1181\n      res;reso = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=8001210;//kernel.TQuery:1210\n      _it_39=Tonyu.iterator(_this,1);\n      while(_it_39.next()) {\n        o=_it_39[0];\n        \n        //$LASTPOS=8001240;//kernel.TQuery:1240\n        v = f(o);\n        //$LASTPOS=8001260;//kernel.TQuery:1260\n        if (res==null||v>=res) {\n          //$LASTPOS=8001299;//kernel.TQuery:1299\n          if (v>res) {\n            //$LASTPOS=8001310;//kernel.TQuery:1310\n            reso=new Tonyu.classes.kernel.TQuery;\n          }\n          //$LASTPOS=8001339;//kernel.TQuery:1339\n          reso.push(o);\n          //$LASTPOS=8001365;//kernel.TQuery:1365\n          res=v;\n          \n        }\n        \n      }\n      _thread.retVal=reso;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    mins :function _trc_TQuery_mins(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var f;\n      var res;\n      var reso;\n      var o;\n      var _it_46;\n      var v;\n      \n      //$LASTPOS=8001424;//kernel.TQuery:1424\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=8001451;//kernel.TQuery:1451\n      res;reso = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=8001480;//kernel.TQuery:1480\n      _it_46=Tonyu.iterator(_this,1);\n      while(_it_46.next()) {\n        o=_it_46[0];\n        \n        //$LASTPOS=8001510;//kernel.TQuery:1510\n        v = f(o);\n        //$LASTPOS=8001530;//kernel.TQuery:1530\n        if (res==null||v<=res) {\n          //$LASTPOS=8001569;//kernel.TQuery:1569\n          if (v<res) {\n            //$LASTPOS=8001580;//kernel.TQuery:1580\n            reso=new Tonyu.classes.kernel.TQuery;\n          }\n          //$LASTPOS=8001609;//kernel.TQuery:1609\n          reso.push(o);\n          //$LASTPOS=8001635;//kernel.TQuery:1635\n          res=v;\n          \n        }\n        \n      }\n      return reso;\n    },\n    fiber$mins :function _trc_TQuery_f_mins(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var f;\n      var res;\n      var reso;\n      var o;\n      var _it_46;\n      var v;\n      \n      //$LASTPOS=8001424;//kernel.TQuery:1424\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=8001451;//kernel.TQuery:1451\n      res;reso = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=8001480;//kernel.TQuery:1480\n      _it_46=Tonyu.iterator(_this,1);\n      while(_it_46.next()) {\n        o=_it_46[0];\n        \n        //$LASTPOS=8001510;//kernel.TQuery:1510\n        v = f(o);\n        //$LASTPOS=8001530;//kernel.TQuery:1530\n        if (res==null||v<=res) {\n          //$LASTPOS=8001569;//kernel.TQuery:1569\n          if (v<res) {\n            //$LASTPOS=8001580;//kernel.TQuery:1580\n            reso=new Tonyu.classes.kernel.TQuery;\n          }\n          //$LASTPOS=8001609;//kernel.TQuery:1609\n          reso.push(o);\n          //$LASTPOS=8001635;//kernel.TQuery:1635\n          res=v;\n          \n        }\n        \n      }\n      _thread.retVal=reso;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    minObj :function _trc_TQuery_minObj(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.mins(key)[0];\n    },\n    fiber$minObj :function _trc_TQuery_f_minObj(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.mins(key)[0];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    maxObj :function _trc_TQuery_maxObj(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.maxs(key)[0];\n    },\n    fiber$maxObj :function _trc_TQuery_f_maxObj(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.maxs(key)[0];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    nearests :function _trc_TQuery_nearests(x,y) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=8001782;//kernel.TQuery:1782\n      if (typeof  x=="object") {\n        //$LASTPOS=8001807;//kernel.TQuery:1807\n        y=x.y;\n        //$LASTPOS=8001813;//kernel.TQuery:1813\n        x=x.x;\n        \n      }\n      return _this.mins((function anonymous_1837(o) {\n        \n        return _this.dist(o.x-x,o.y-y);\n      }));\n    },\n    fiber$nearests :function _trc_TQuery_f_nearests(_thread,x,y) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=8001782;//kernel.TQuery:1782\n      if (typeof  x=="object") {\n        //$LASTPOS=8001807;//kernel.TQuery:1807\n        y=x.y;\n        //$LASTPOS=8001813;//kernel.TQuery:1813\n        x=x.x;\n        \n      }\n      _thread.retVal=_this.mins((function anonymous_1837(o) {\n        \n        return _this.dist(o.x-x,o.y-y);\n      }));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    nearest :function _trc_TQuery_nearest(x,y) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.nearests(x,y)[0];\n    },\n    fiber$nearest :function _trc_TQuery_f_nearest(_thread,x,y) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.nearests(x,y)[0];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    withins :function _trc_TQuery_withins(xo,yd,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var x;\n      var y;\n      \n      //$LASTPOS=8001958;//kernel.TQuery:1958\n      x;y;\n      //$LASTPOS=8001971;//kernel.TQuery:1971\n      if (typeof  xo=="object") {\n        //$LASTPOS=8002006;//kernel.TQuery:2006\n        x=xo.x;\n        //$LASTPOS=8002013;//kernel.TQuery:2013\n        y=xo.y;\n        //$LASTPOS=8002020;//kernel.TQuery:2020\n        d=yd;\n        \n      } else {\n        //$LASTPOS=8002047;//kernel.TQuery:2047\n        x=xo;\n        //$LASTPOS=8002052;//kernel.TQuery:2052\n        y=yd;\n        \n      }\n      return _this.find((function anonymous_2080(o) {\n        \n        return _this.dist(o.x-x,o.y-y)<=d;\n      }));\n    },\n    fiber$withins :function _trc_TQuery_f_withins(_thread,xo,yd,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var x;\n      var y;\n      \n      //$LASTPOS=8001958;//kernel.TQuery:1958\n      x;y;\n      //$LASTPOS=8001971;//kernel.TQuery:1971\n      if (typeof  xo=="object") {\n        //$LASTPOS=8002006;//kernel.TQuery:2006\n        x=xo.x;\n        //$LASTPOS=8002013;//kernel.TQuery:2013\n        y=xo.y;\n        //$LASTPOS=8002020;//kernel.TQuery:2020\n        d=yd;\n        \n      } else {\n        //$LASTPOS=8002047;//kernel.TQuery:2047\n        x=xo;\n        //$LASTPOS=8002052;//kernel.TQuery:2052\n        y=yd;\n        \n      }\n      _thread.retVal=_this.find((function anonymous_2080(o) {\n        \n        return _this.dist(o.x-x,o.y-y)<=d;\n      }));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    within :function _trc_TQuery_within(xo,yd,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.withins(xo,yd,d).nearest();\n    },\n    fiber$within :function _trc_TQuery_f_within(_thread,xo,yd,d) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.withins(xo,yd,d).nearest();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    max :function _trc_TQuery_max(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var f;\n      var res;\n      var o;\n      var _it_57;\n      var v;\n      \n      //$LASTPOS=8002210;//kernel.TQuery:2210\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=8002237;//kernel.TQuery:2237\n      res;\n      //$LASTPOS=8002250;//kernel.TQuery:2250\n      _it_57=Tonyu.iterator(_this,1);\n      while(_it_57.next()) {\n        o=_it_57[0];\n        \n        //$LASTPOS=8002280;//kernel.TQuery:2280\n        v = f(o);\n        //$LASTPOS=8002300;//kernel.TQuery:2300\n        if (res==null||v>res) {\n          //$LASTPOS=8002324;//kernel.TQuery:2324\n          res=v;\n        }\n        \n      }\n      return res;\n    },\n    fiber$max :function _trc_TQuery_f_max(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var f;\n      var res;\n      var o;\n      var _it_57;\n      var v;\n      \n      //$LASTPOS=8002210;//kernel.TQuery:2210\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=8002237;//kernel.TQuery:2237\n      res;\n      //$LASTPOS=8002250;//kernel.TQuery:2250\n      _it_57=Tonyu.iterator(_this,1);\n      while(_it_57.next()) {\n        o=_it_57[0];\n        \n        //$LASTPOS=8002280;//kernel.TQuery:2280\n        v = f(o);\n        //$LASTPOS=8002300;//kernel.TQuery:2300\n        if (res==null||v>res) {\n          //$LASTPOS=8002324;//kernel.TQuery:2324\n          res=v;\n        }\n        \n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    min :function _trc_TQuery_min(key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var f;\n      var res;\n      var o;\n      var _it_63;\n      var v;\n      \n      //$LASTPOS=8002371;//kernel.TQuery:2371\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=8002398;//kernel.TQuery:2398\n      res;\n      //$LASTPOS=8002411;//kernel.TQuery:2411\n      _it_63=Tonyu.iterator(_this,1);\n      while(_it_63.next()) {\n        o=_it_63[0];\n        \n        //$LASTPOS=8002441;//kernel.TQuery:2441\n        v = f(o);\n        //$LASTPOS=8002461;//kernel.TQuery:2461\n        if (res==null||v<res) {\n          //$LASTPOS=8002485;//kernel.TQuery:2485\n          res=v;\n        }\n        \n      }\n      return res;\n    },\n    fiber$min :function _trc_TQuery_f_min(_thread,key) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var f;\n      var res;\n      var o;\n      var _it_63;\n      var v;\n      \n      //$LASTPOS=8002371;//kernel.TQuery:2371\n      f = _this.genKeyfunc(key);\n      //$LASTPOS=8002398;//kernel.TQuery:2398\n      res;\n      //$LASTPOS=8002411;//kernel.TQuery:2411\n      _it_63=Tonyu.iterator(_this,1);\n      while(_it_63.next()) {\n        o=_it_63[0];\n        \n        //$LASTPOS=8002441;//kernel.TQuery:2441\n        v = f(o);\n        //$LASTPOS=8002461;//kernel.TQuery:2461\n        if (res==null||v<res) {\n          //$LASTPOS=8002485;//kernel.TQuery:2485\n          res=v;\n        }\n        \n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    push :function _trc_TQuery_push(e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=8002531;//kernel.TQuery:2531\n      _this[_this.length]=e;\n      //$LASTPOS=8002551;//kernel.TQuery:2551\n      _this.length++;\n    },\n    fiber$push :function _trc_TQuery_f_push(_thread,e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=8002531;//kernel.TQuery:2531\n      _this[_this.length]=e;\n      //$LASTPOS=8002551;//kernel.TQuery:2551\n      _this.length++;\n      \n      _thread.retVal=_this;return;\n    },\n    size :function _trc_TQuery_size() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.length;\n    },\n    fiber$size :function _trc_TQuery_f_size(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.length;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    find :function _trc_TQuery_find(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var no;\n      var o;\n      var _it_69;\n      \n      //$LASTPOS=8002603;//kernel.TQuery:2603\n      no = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=8002626;//kernel.TQuery:2626\n      _it_69=Tonyu.iterator(_this,1);\n      while(_it_69.next()) {\n        o=_it_69[0];\n        \n        //$LASTPOS=8002656;//kernel.TQuery:2656\n        if (f(o)) {\n          //$LASTPOS=8002666;//kernel.TQuery:2666\n          no.push(o);\n        }\n        \n      }\n      return no;\n    },\n    fiber$find :function _trc_TQuery_f_find(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var no;\n      var o;\n      var _it_69;\n      \n      //$LASTPOS=8002603;//kernel.TQuery:2603\n      no = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=8002626;//kernel.TQuery:2626\n      _it_69=Tonyu.iterator(_this,1);\n      while(_it_69.next()) {\n        o=_it_69[0];\n        \n        //$LASTPOS=8002656;//kernel.TQuery:2656\n        if (f(o)) {\n          //$LASTPOS=8002666;//kernel.TQuery:2666\n          no.push(o);\n        }\n        \n      }\n      _thread.retVal=no;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    apply :function _trc_TQuery_apply(name,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      var o;\n      var _it_73;\n      var f;\n      \n      //$LASTPOS=8002727;//kernel.TQuery:2727\n      res;\n      //$LASTPOS=8002740;//kernel.TQuery:2740\n      if (! args) {\n        //$LASTPOS=8002751;//kernel.TQuery:2751\n        args=[];\n      }\n      //$LASTPOS=8002764;//kernel.TQuery:2764\n      _it_73=Tonyu.iterator(_this,1);\n      while(_it_73.next()) {\n        o=_it_73[0];\n        \n        //$LASTPOS=8002794;//kernel.TQuery:2794\n        f = o[name];\n        //$LASTPOS=8002817;//kernel.TQuery:2817\n        if (typeof  f=="function") {\n          //$LASTPOS=8002857;//kernel.TQuery:2857\n          res=f.apply(o,args);\n          \n        }\n        \n      }\n      return res;\n    },\n    fiber$apply :function _trc_TQuery_f_apply(_thread,name,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var res;\n      var o;\n      var _it_73;\n      var f;\n      \n      //$LASTPOS=8002727;//kernel.TQuery:2727\n      res;\n      //$LASTPOS=8002740;//kernel.TQuery:2740\n      if (! args) {\n        //$LASTPOS=8002751;//kernel.TQuery:2751\n        args=[];\n      }\n      //$LASTPOS=8002764;//kernel.TQuery:2764\n      _it_73=Tonyu.iterator(_this,1);\n      while(_it_73.next()) {\n        o=_it_73[0];\n        \n        //$LASTPOS=8002794;//kernel.TQuery:2794\n        f = o[name];\n        //$LASTPOS=8002817;//kernel.TQuery:2817\n        if (typeof  f=="function") {\n          //$LASTPOS=8002857;//kernel.TQuery:2857\n          res=f.apply(o,args);\n          \n        }\n        \n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    alive :function _trc_TQuery_alive() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.find((function anonymous_2995(o) {\n        \n        return ! o.isDead();\n      }));\n    },\n    fiber$alive :function _trc_TQuery_f_alive(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.find((function anonymous_2995(o) {\n        \n        return ! o.isDead();\n      }));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    die :function _trc_TQuery_die() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var a;\n      \n      //$LASTPOS=8003052;//kernel.TQuery:3052\n      a = _this.alive();\n      //$LASTPOS=8003071;//kernel.TQuery:3071\n      if (a.length==0) {\n        return false;\n      }\n      //$LASTPOS=8003106;//kernel.TQuery:3106\n      a.apply("die");\n      return true;\n    },\n    fiber$die :function _trc_TQuery_f_die(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var a;\n      \n      //$LASTPOS=8003052;//kernel.TQuery:3052\n      a = _this.alive();\n      //$LASTPOS=8003071;//kernel.TQuery:3071\n      if (a.length==0) {\n        _thread.retVal=false;return;\n        \n      }\n      //$LASTPOS=8003106;//kernel.TQuery:3106\n      a.apply("die");\n      _thread.retVal=true;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    klass :function _trc_TQuery_klass(k) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.find((function anonymous_3170(o) {\n        \n        return o instanceof k;\n      }));\n    },\n    fiber$klass :function _trc_TQuery_f_klass(_thread,k) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.find((function anonymous_3170(o) {\n        \n        return o instanceof k;\n      }));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"tonyuIterator":{"nowait":false},"attr":{"nowait":false},"genKeyfunc":{"nowait":false},"maxs":{"nowait":false},"mins":{"nowait":false},"minObj":{"nowait":false},"maxObj":{"nowait":false},"nearests":{"nowait":false},"nearest":{"nowait":false},"withins":{"nowait":false},"within":{"nowait":false},"max":{"nowait":false},"min":{"nowait":false},"push":{"nowait":false},"size":{"nowait":false},"find":{"nowait":false},"apply":{"nowait":false},"alive":{"nowait":false},"die":{"nowait":false},"klass":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.InputDevice\',\n  shortName: \'InputDevice\',\n  namespace: \'kernel\',\n  includes: [],\n  methods: {\n    main :function _trc_InputDevice_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_InputDevice_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_InputDevice_initialize() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=9000071;//kernel.InputDevice:71\n      _this.listeners=[];\n      //$LASTPOS=9000090;//kernel.InputDevice:90\n      _this.touchEmu=true;\n    },\n    handleListeners :function _trc_InputDevice_handleListeners() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var l;\n      \n      //$LASTPOS=9000135;//kernel.InputDevice:135\n      l = _this.listeners;\n      //$LASTPOS=9000157;//kernel.InputDevice:157\n      _this.listeners=[];\n      //$LASTPOS=9000176;//kernel.InputDevice:176\n      while (l.length>0) {\n        //$LASTPOS=9000197;//kernel.InputDevice:197\n        (l.shift())();\n        \n      }\n    },\n    fiber$handleListeners :function _trc_InputDevice_f_handleListeners(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var l;\n      \n      //$LASTPOS=9000135;//kernel.InputDevice:135\n      l = _this.listeners;\n      //$LASTPOS=9000157;//kernel.InputDevice:157\n      _this.listeners=[];\n      //$LASTPOS=9000176;//kernel.InputDevice:176\n      while (l.length>0) {\n        //$LASTPOS=9000197;//kernel.InputDevice:197\n        (l.shift())();\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    addOnetimeListener :function _trc_InputDevice_addOnetimeListener(l) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=9000247;//kernel.InputDevice:247\n      _this.listeners.push(l);\n    },\n    fiber$addOnetimeListener :function _trc_InputDevice_f_addOnetimeListener(_thread,l) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=9000247;//kernel.InputDevice:247\n      _this.listeners.push(l);\n      \n      _thread.retVal=_this;return;\n    },\n    initCanvasEvents :function _trc_InputDevice_initCanvasEvents(cvj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var cv;\n      var handleMouse;\n      var handleTouch;\n      var handleTouchEnd;\n      var d;\n      \n      //$LASTPOS=9000300;//kernel.InputDevice:300\n      cv = cvj[0];\n      //$LASTPOS=9000320;//kernel.InputDevice:320\n      Tonyu.globals.$handleMouse=(function anonymous_333(e) {\n        var p;\n        var mp;\n        \n        //$LASTPOS=9000349;//kernel.InputDevice:349\n        p = cvj.offset();\n        //$LASTPOS=9000378;//kernel.InputDevice:378\n        mp = {x: e.clientX-p.left,y: e.clientY-p.top};\n        //$LASTPOS=9000435;//kernel.InputDevice:435\n        mp=Tonyu.globals.$Screen.canvas2buf(mp);\n        //$LASTPOS=9000471;//kernel.InputDevice:471\n        Tonyu.globals.$mouseX=mp.x;\n        //$LASTPOS=9000494;//kernel.InputDevice:494\n        Tonyu.globals.$mouseY=mp.y;\n        //$LASTPOS=9000517;//kernel.InputDevice:517\n        if (_this.touchEmu) {\n          //$LASTPOS=9000546;//kernel.InputDevice:546\n          Tonyu.globals.$touches[0].x=mp.x;\n          //$LASTPOS=9000579;//kernel.InputDevice:579\n          Tonyu.globals.$touches[0].y=mp.y;\n          \n        }\n        //$LASTPOS=9000619;//kernel.InputDevice:619\n        _this.handleListeners();\n      });\n      //$LASTPOS=9000651;//kernel.InputDevice:651\n      Tonyu.globals.$touches=[{},{},{},{},{}];\n      //$LASTPOS=9000683;//kernel.InputDevice:683\n      Tonyu.globals.$touches.findById=(function anonymous_701(id) {\n        var j;\n        \n        //$LASTPOS=9000718;//kernel.InputDevice:718\n        //$LASTPOS=9000723;//kernel.InputDevice:723\n        j = 0;\n        while(j<Tonyu.globals.$touches.length) {\n          {\n            //$LASTPOS=9000773;//kernel.InputDevice:773\n            if (Tonyu.globals.$touches[j].identifier==id) {\n              return Tonyu.globals.$touches[j];\n              \n            }\n          }\n          j++;\n        }\n      });\n      //$LASTPOS=9000883;//kernel.InputDevice:883\n      Tonyu.globals.$handleTouch=(function anonymous_896(e) {\n        var p;\n        var ts;\n        var i;\n        var src;\n        var dst;\n        var j;\n        \n        //$LASTPOS=9000912;//kernel.InputDevice:912\n        _this.touchEmu=false;\n        //$LASTPOS=9000937;//kernel.InputDevice:937\n        p = cvj.offset();\n        //$LASTPOS=9000966;//kernel.InputDevice:966\n        e.preventDefault();\n        //$LASTPOS=9000995;//kernel.InputDevice:995\n        ts = e.originalEvent.changedTouches;\n        //$LASTPOS=9001043;//kernel.InputDevice:1043\n        //$LASTPOS=9001048;//kernel.InputDevice:1048\n        i = 0;\n        while(i<ts.length) {\n          {\n            //$LASTPOS=9001093;//kernel.InputDevice:1093\n            src = ts[i];\n            //$LASTPOS=9001121;//kernel.InputDevice:1121\n            dst = Tonyu.globals.$touches.findById(src.identifier);\n            //$LASTPOS=9001177;//kernel.InputDevice:1177\n            if (! dst) {\n              //$LASTPOS=9001206;//kernel.InputDevice:1206\n              //$LASTPOS=9001211;//kernel.InputDevice:1211\n              j = 0;\n              while(j<Tonyu.globals.$touches.length) {\n                {\n                  //$LASTPOS=9001269;//kernel.InputDevice:1269\n                  if (! Tonyu.globals.$touches[j].touched) {\n                    //$LASTPOS=9001322;//kernel.InputDevice:1322\n                    dst=Tonyu.globals.$touches[j];\n                    //$LASTPOS=9001364;//kernel.InputDevice:1364\n                    dst.identifier=src.identifier;\n                    break;\n                    \n                    \n                  }\n                }\n                j++;\n              }\n              \n            }\n            //$LASTPOS=9001497;//kernel.InputDevice:1497\n            if (dst) {\n              //$LASTPOS=9001525;//kernel.InputDevice:1525\n              _this.mp={x: src.pageX-p.left,y: src.pageY-p.top};\n              //$LASTPOS=9001586;//kernel.InputDevice:1586\n              _this.mp=Tonyu.globals.$Screen.canvas2buf(_this.mp);\n              //$LASTPOS=9001630;//kernel.InputDevice:1630\n              dst.x=_this.mp.x;\n              //$LASTPOS=9001659;//kernel.InputDevice:1659\n              dst.y=_this.mp.y;\n              //$LASTPOS=9001688;//kernel.InputDevice:1688\n              if (! dst.touched) {\n                //$LASTPOS=9001705;//kernel.InputDevice:1705\n                dst.touched=1;\n              }\n              \n            }\n          }\n          i++;\n        }\n        //$LASTPOS=9001755;//kernel.InputDevice:1755\n        Tonyu.globals.$mouseX=Tonyu.globals.$touches[0].x;\n        //$LASTPOS=9001787;//kernel.InputDevice:1787\n        Tonyu.globals.$mouseY=Tonyu.globals.$touches[0].y;\n        //$LASTPOS=9001819;//kernel.InputDevice:1819\n        _this.handleListeners();\n      });\n      //$LASTPOS=9001851;//kernel.InputDevice:1851\n      Tonyu.globals.$handleTouchEnd=(function anonymous_1867(e) {\n        var ts;\n        var i;\n        var src;\n        var dst;\n        \n        //$LASTPOS=9001883;//kernel.InputDevice:1883\n        ts = e.originalEvent.changedTouches;\n        //$LASTPOS=9001931;//kernel.InputDevice:1931\n        //$LASTPOS=9001936;//kernel.InputDevice:1936\n        i = 0;\n        while(i<ts.length) {\n          {\n            //$LASTPOS=9001981;//kernel.InputDevice:1981\n            src = ts[i];\n            //$LASTPOS=9002009;//kernel.InputDevice:2009\n            dst = Tonyu.globals.$touches.findById(src.identifier);\n            //$LASTPOS=9002065;//kernel.InputDevice:2065\n            if (dst) {\n              //$LASTPOS=9002093;//kernel.InputDevice:2093\n              dst.touched=0;\n              //$LASTPOS=9002125;//kernel.InputDevice:2125\n              dst.identifier=- 1;\n              \n            }\n          }\n          i++;\n        }\n        //$LASTPOS=9002179;//kernel.InputDevice:2179\n        _this.handleListeners();\n      });\n      //$LASTPOS=9002211;//kernel.InputDevice:2211\n      handleMouse = (function anonymous_2227(e) {\n        \n        //$LASTPOS=9002232;//kernel.InputDevice:2232\n        Tonyu.globals.$handleMouse(e);\n      });\n      //$LASTPOS=9002256;//kernel.InputDevice:2256\n      handleTouch = (function anonymous_2272(e) {\n        \n        //$LASTPOS=9002277;//kernel.InputDevice:2277\n        Tonyu.globals.$handleTouch(e);\n      });\n      //$LASTPOS=9002301;//kernel.InputDevice:2301\n      handleTouchEnd = (function anonymous_2320(e) {\n        \n        //$LASTPOS=9002325;//kernel.InputDevice:2325\n        Tonyu.globals.$handleTouchEnd(e);\n      });\n      //$LASTPOS=9002352;//kernel.InputDevice:2352\n      d = $.data(cv,"events");\n      //$LASTPOS=9002384;//kernel.InputDevice:2384\n      if (! d) {\n        //$LASTPOS=9002403;//kernel.InputDevice:2403\n        $.data(cv,"events","true");\n        //$LASTPOS=9002440;//kernel.InputDevice:2440\n        cvj.mousedown(handleMouse);\n        //$LASTPOS=9002477;//kernel.InputDevice:2477\n        cvj.mousemove(handleMouse);\n        //$LASTPOS=9002514;//kernel.InputDevice:2514\n        cvj.on("touchstart",handleTouch);\n        //$LASTPOS=9002557;//kernel.InputDevice:2557\n        cvj.on("touchmove",handleTouch);\n        //$LASTPOS=9002599;//kernel.InputDevice:2599\n        cvj.on("touchend",handleTouchEnd);\n        \n      }\n    },\n    fiber$initCanvasEvents :function _trc_InputDevice_f_initCanvasEvents(_thread,cvj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var cv;\n      var handleMouse;\n      var handleTouch;\n      var handleTouchEnd;\n      var d;\n      \n      //$LASTPOS=9000300;//kernel.InputDevice:300\n      cv = cvj[0];\n      \n      _thread.enter(function _trc_InputDevice_ent_initCanvasEvents(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=9000320;//kernel.InputDevice:320\n            Tonyu.globals.$handleMouse=(function anonymous_333(e) {\n              var p;\n              var mp;\n              \n              //$LASTPOS=9000349;//kernel.InputDevice:349\n              p = cvj.offset();\n              //$LASTPOS=9000378;//kernel.InputDevice:378\n              mp = {x: e.clientX-p.left,y: e.clientY-p.top};\n              //$LASTPOS=9000435;//kernel.InputDevice:435\n              mp=Tonyu.globals.$Screen.canvas2buf(mp);\n              //$LASTPOS=9000471;//kernel.InputDevice:471\n              Tonyu.globals.$mouseX=mp.x;\n              //$LASTPOS=9000494;//kernel.InputDevice:494\n              Tonyu.globals.$mouseY=mp.y;\n              //$LASTPOS=9000517;//kernel.InputDevice:517\n              if (_this.touchEmu) {\n                //$LASTPOS=9000546;//kernel.InputDevice:546\n                Tonyu.globals.$touches[0].x=mp.x;\n                //$LASTPOS=9000579;//kernel.InputDevice:579\n                Tonyu.globals.$touches[0].y=mp.y;\n                \n              }\n              //$LASTPOS=9000619;//kernel.InputDevice:619\n              _this.handleListeners();\n            });\n            //$LASTPOS=9000651;//kernel.InputDevice:651\n            Tonyu.globals.$touches=[{},{},{},{},{}];\n            //$LASTPOS=9000683;//kernel.InputDevice:683\n            Tonyu.globals.$touches.findById=(function anonymous_701(id) {\n              var j;\n              \n              //$LASTPOS=9000718;//kernel.InputDevice:718\n              //$LASTPOS=9000723;//kernel.InputDevice:723\n              j = 0;\n              while(j<Tonyu.globals.$touches.length) {\n                {\n                  //$LASTPOS=9000773;//kernel.InputDevice:773\n                  if (Tonyu.globals.$touches[j].identifier==id) {\n                    return Tonyu.globals.$touches[j];\n                    \n                  }\n                }\n                j++;\n              }\n            });\n            //$LASTPOS=9000883;//kernel.InputDevice:883\n            Tonyu.globals.$handleTouch=(function anonymous_896(e) {\n              var p;\n              var ts;\n              var i;\n              var src;\n              var dst;\n              var j;\n              \n              //$LASTPOS=9000912;//kernel.InputDevice:912\n              _this.touchEmu=false;\n              //$LASTPOS=9000937;//kernel.InputDevice:937\n              p = cvj.offset();\n              //$LASTPOS=9000966;//kernel.InputDevice:966\n              e.preventDefault();\n              //$LASTPOS=9000995;//kernel.InputDevice:995\n              ts = e.originalEvent.changedTouches;\n              //$LASTPOS=9001043;//kernel.InputDevice:1043\n              //$LASTPOS=9001048;//kernel.InputDevice:1048\n              i = 0;\n              while(i<ts.length) {\n                {\n                  //$LASTPOS=9001093;//kernel.InputDevice:1093\n                  src = ts[i];\n                  //$LASTPOS=9001121;//kernel.InputDevice:1121\n                  dst = Tonyu.globals.$touches.findById(src.identifier);\n                  //$LASTPOS=9001177;//kernel.InputDevice:1177\n                  if (! dst) {\n                    //$LASTPOS=9001206;//kernel.InputDevice:1206\n                    //$LASTPOS=9001211;//kernel.InputDevice:1211\n                    j = 0;\n                    while(j<Tonyu.globals.$touches.length) {\n                      {\n                        //$LASTPOS=9001269;//kernel.InputDevice:1269\n                        if (! Tonyu.globals.$touches[j].touched) {\n                          //$LASTPOS=9001322;//kernel.InputDevice:1322\n                          dst=Tonyu.globals.$touches[j];\n                          //$LASTPOS=9001364;//kernel.InputDevice:1364\n                          dst.identifier=src.identifier;\n                          break;\n                          \n                          \n                        }\n                      }\n                      j++;\n                    }\n                    \n                  }\n                  //$LASTPOS=9001497;//kernel.InputDevice:1497\n                  if (dst) {\n                    //$LASTPOS=9001525;//kernel.InputDevice:1525\n                    _this.mp={x: src.pageX-p.left,y: src.pageY-p.top};\n                    //$LASTPOS=9001586;//kernel.InputDevice:1586\n                    _this.mp=Tonyu.globals.$Screen.canvas2buf(_this.mp);\n                    //$LASTPOS=9001630;//kernel.InputDevice:1630\n                    dst.x=_this.mp.x;\n                    //$LASTPOS=9001659;//kernel.InputDevice:1659\n                    dst.y=_this.mp.y;\n                    //$LASTPOS=9001688;//kernel.InputDevice:1688\n                    if (! dst.touched) {\n                      //$LASTPOS=9001705;//kernel.InputDevice:1705\n                      dst.touched=1;\n                    }\n                    \n                  }\n                }\n                i++;\n              }\n              //$LASTPOS=9001755;//kernel.InputDevice:1755\n              Tonyu.globals.$mouseX=Tonyu.globals.$touches[0].x;\n              //$LASTPOS=9001787;//kernel.InputDevice:1787\n              Tonyu.globals.$mouseY=Tonyu.globals.$touches[0].y;\n              //$LASTPOS=9001819;//kernel.InputDevice:1819\n              _this.handleListeners();\n            });\n            //$LASTPOS=9001851;//kernel.InputDevice:1851\n            Tonyu.globals.$handleTouchEnd=(function anonymous_1867(e) {\n              var ts;\n              var i;\n              var src;\n              var dst;\n              \n              //$LASTPOS=9001883;//kernel.InputDevice:1883\n              ts = e.originalEvent.changedTouches;\n              //$LASTPOS=9001931;//kernel.InputDevice:1931\n              //$LASTPOS=9001936;//kernel.InputDevice:1936\n              i = 0;\n              while(i<ts.length) {\n                {\n                  //$LASTPOS=9001981;//kernel.InputDevice:1981\n                  src = ts[i];\n                  //$LASTPOS=9002009;//kernel.InputDevice:2009\n                  dst = Tonyu.globals.$touches.findById(src.identifier);\n                  //$LASTPOS=9002065;//kernel.InputDevice:2065\n                  if (dst) {\n                    //$LASTPOS=9002093;//kernel.InputDevice:2093\n                    dst.touched=0;\n                    //$LASTPOS=9002125;//kernel.InputDevice:2125\n                    dst.identifier=- 1;\n                    \n                  }\n                }\n                i++;\n              }\n              //$LASTPOS=9002179;//kernel.InputDevice:2179\n              _this.handleListeners();\n            });\n            //$LASTPOS=9002211;//kernel.InputDevice:2211\n            handleMouse = (function anonymous_2227(e) {\n              \n              //$LASTPOS=9002232;//kernel.InputDevice:2232\n              Tonyu.globals.$handleMouse(e);\n            });\n            //$LASTPOS=9002256;//kernel.InputDevice:2256\n            handleTouch = (function anonymous_2272(e) {\n              \n              //$LASTPOS=9002277;//kernel.InputDevice:2277\n              Tonyu.globals.$handleTouch(e);\n            });\n            //$LASTPOS=9002301;//kernel.InputDevice:2301\n            handleTouchEnd = (function anonymous_2320(e) {\n              \n              //$LASTPOS=9002325;//kernel.InputDevice:2325\n              Tonyu.globals.$handleTouchEnd(e);\n            });\n            //$LASTPOS=9002352;//kernel.InputDevice:2352\n            d = $.data(cv,"events");\n            //$LASTPOS=9002384;//kernel.InputDevice:2384\n            if (! d) {\n              //$LASTPOS=9002403;//kernel.InputDevice:2403\n              $.data(cv,"events","true");\n              //$LASTPOS=9002440;//kernel.InputDevice:2440\n              cvj.mousedown(handleMouse);\n              //$LASTPOS=9002477;//kernel.InputDevice:2477\n              cvj.mousemove(handleMouse);\n              //$LASTPOS=9002514;//kernel.InputDevice:2514\n              cvj.on("touchstart",handleTouch);\n              //$LASTPOS=9002557;//kernel.InputDevice:2557\n              cvj.on("touchmove",handleTouch);\n              //$LASTPOS=9002599;//kernel.InputDevice:2599\n              cvj.on("touchend",handleTouchEnd);\n              \n            }\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    update :function _trc_InputDevice_update() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var _it_107;\n      \n      //$LASTPOS=9002664;//kernel.InputDevice:2664\n      _it_107=Tonyu.iterator(Tonyu.globals.$touches,1);\n      while(_it_107.next()) {\n        i=_it_107[0];\n        \n        //$LASTPOS=9002699;//kernel.InputDevice:2699\n        if (i.touched>0) {\n          //$LASTPOS=9002717;//kernel.InputDevice:2717\n          i.touched++;\n          \n        }\n        //$LASTPOS=9002740;//kernel.InputDevice:2740\n        if (i.touched==- 1) {\n          //$LASTPOS=9002759;//kernel.InputDevice:2759\n          i.touched=1;\n        }\n        \n      }\n    },\n    fiber$update :function _trc_InputDevice_f_update(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var _it_107;\n      \n      //$LASTPOS=9002664;//kernel.InputDevice:2664\n      _it_107=Tonyu.iterator(Tonyu.globals.$touches,1);\n      while(_it_107.next()) {\n        i=_it_107[0];\n        \n        //$LASTPOS=9002699;//kernel.InputDevice:2699\n        if (i.touched>0) {\n          //$LASTPOS=9002717;//kernel.InputDevice:2717\n          i.touched++;\n          \n        }\n        //$LASTPOS=9002740;//kernel.InputDevice:2740\n        if (i.touched==- 1) {\n          //$LASTPOS=9002759;//kernel.InputDevice:2759\n          i.touched=1;\n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"handleListeners":{"nowait":false},"addOnetimeListener":{"nowait":false},"initCanvasEvents":{"nowait":false},"update":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Keys\',\n  shortName: \'Keys\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [],\n  methods: {\n    main :function _trc_Keys_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      \n      //$LASTPOS=10000084;//kernel.Keys:84\n      _this.stats={};\n      //$LASTPOS=10000094;//kernel.Keys:94\n      _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,mouseleft: 1};\n      //$LASTPOS=10000212;//kernel.Keys:212\n      //$LASTPOS=10000217;//kernel.Keys:217\n      i = 65;\n      while(i<65+26) {\n        {\n          //$LASTPOS=10000248;//kernel.Keys:248\n          _this.codes[String.fromCharCode(i).toLowerCase()]=i;\n        }\n        i++;\n      }\n      //$LASTPOS=10000297;//kernel.Keys:297\n      //$LASTPOS=10000302;//kernel.Keys:302\n      i = 48;\n      while(i<58) {\n        {\n          //$LASTPOS=10000330;//kernel.Keys:330\n          _this.codes[String.fromCharCode(i)]=i;\n        }\n        i++;\n      }\n      //$LASTPOS=10000365;//kernel.Keys:365\n      if (! $.data(document,"key_event")) {\n        //$LASTPOS=10000406;//kernel.Keys:406\n        $.data(document,"key_event",true);\n        //$LASTPOS=10000445;//kernel.Keys:445\n        $(document).keydown((function anonymous_465(e) {\n          \n          //$LASTPOS=10000471;//kernel.Keys:471\n          Tonyu.globals.$Keys.keydown(e);\n        }));\n        //$LASTPOS=10000495;//kernel.Keys:495\n        $(document).keyup((function anonymous_513(e) {\n          \n          //$LASTPOS=10000519;//kernel.Keys:519\n          Tonyu.globals.$Keys.keyup(e);\n        }));\n        //$LASTPOS=10000541;//kernel.Keys:541\n        $(document).mousedown((function anonymous_563(e) {\n          \n          //$LASTPOS=10000578;//kernel.Keys:578\n          if (Tonyu.globals.$InputDevice.touchEmu) {\n            //$LASTPOS=10000619;//kernel.Keys:619\n            Tonyu.globals.$touches[0].touched=1;\n            \n          }\n          //$LASTPOS=10000660;//kernel.Keys:660\n          Tonyu.globals.$Keys.keydown({keyCode: 1});\n        }));\n        //$LASTPOS=10000697;//kernel.Keys:697\n        $(document).mouseup((function anonymous_717(e) {\n          \n          //$LASTPOS=10000732;//kernel.Keys:732\n          if (Tonyu.globals.$InputDevice.touchEmu) {\n            //$LASTPOS=10000773;//kernel.Keys:773\n            Tonyu.globals.$touches[0].touched=0;\n            \n          }\n          //$LASTPOS=10000814;//kernel.Keys:814\n          Tonyu.globals.$Keys.keyup({keyCode: 1});\n        }));\n        \n      }\n    },\n    fiber$main :function _trc_Keys_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      \n      //$LASTPOS=10000084;//kernel.Keys:84\n      _this.stats={};\n      //$LASTPOS=10000094;//kernel.Keys:94\n      _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,mouseleft: 1};\n      //$LASTPOS=10000212;//kernel.Keys:212\n      //$LASTPOS=10000217;//kernel.Keys:217\n      i = 65;\n      while(i<65+26) {\n        {\n          //$LASTPOS=10000248;//kernel.Keys:248\n          _this.codes[String.fromCharCode(i).toLowerCase()]=i;\n        }\n        i++;\n      }\n      //$LASTPOS=10000297;//kernel.Keys:297\n      //$LASTPOS=10000302;//kernel.Keys:302\n      i = 48;\n      while(i<58) {\n        {\n          //$LASTPOS=10000330;//kernel.Keys:330\n          _this.codes[String.fromCharCode(i)]=i;\n        }\n        i++;\n      }\n      //$LASTPOS=10000365;//kernel.Keys:365\n      if (! $.data(document,"key_event")) {\n        //$LASTPOS=10000406;//kernel.Keys:406\n        $.data(document,"key_event",true);\n        //$LASTPOS=10000445;//kernel.Keys:445\n        $(document).keydown((function anonymous_465(e) {\n          \n          //$LASTPOS=10000471;//kernel.Keys:471\n          Tonyu.globals.$Keys.keydown(e);\n        }));\n        //$LASTPOS=10000495;//kernel.Keys:495\n        $(document).keyup((function anonymous_513(e) {\n          \n          //$LASTPOS=10000519;//kernel.Keys:519\n          Tonyu.globals.$Keys.keyup(e);\n        }));\n        //$LASTPOS=10000541;//kernel.Keys:541\n        $(document).mousedown((function anonymous_563(e) {\n          \n          //$LASTPOS=10000578;//kernel.Keys:578\n          if (Tonyu.globals.$InputDevice.touchEmu) {\n            //$LASTPOS=10000619;//kernel.Keys:619\n            Tonyu.globals.$touches[0].touched=1;\n            \n          }\n          //$LASTPOS=10000660;//kernel.Keys:660\n          Tonyu.globals.$Keys.keydown({keyCode: 1});\n        }));\n        //$LASTPOS=10000697;//kernel.Keys:697\n        $(document).mouseup((function anonymous_717(e) {\n          \n          //$LASTPOS=10000732;//kernel.Keys:732\n          if (Tonyu.globals.$InputDevice.touchEmu) {\n            //$LASTPOS=10000773;//kernel.Keys:773\n            Tonyu.globals.$touches[0].touched=0;\n            \n          }\n          //$LASTPOS=10000814;//kernel.Keys:814\n          Tonyu.globals.$Keys.keyup({keyCode: 1});\n        }));\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    getkey :function _trc_Keys_getkey(code) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=10000875;//kernel.Keys:875\n      if (typeof  code=="string") {\n        //$LASTPOS=10000912;//kernel.Keys:912\n        code=_this.codes[code.toLowerCase()];\n        \n      }\n      //$LASTPOS=10000954;//kernel.Keys:954\n      if (! code) {\n        return 0;\n      }\n      //$LASTPOS=10000979;//kernel.Keys:979\n      if (_this.stats[code]==- 1) {\n        return 0;\n      }\n      //$LASTPOS=10001014;//kernel.Keys:1014\n      if (! _this.stats[code]) {\n        //$LASTPOS=10001032;//kernel.Keys:1032\n        _this.stats[code]=0;\n      }\n      return _this.stats[code];\n    },\n    fiber$getkey :function _trc_Keys_f_getkey(_thread,code) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=10000875;//kernel.Keys:875\n      if (typeof  code=="string") {\n        //$LASTPOS=10000912;//kernel.Keys:912\n        code=_this.codes[code.toLowerCase()];\n        \n      }\n      //$LASTPOS=10000954;//kernel.Keys:954\n      if (! code) {\n        _thread.retVal=0;return;\n        \n      }\n      //$LASTPOS=10000979;//kernel.Keys:979\n      if (_this.stats[code]==- 1) {\n        _thread.retVal=0;return;\n        \n      }\n      //$LASTPOS=10001014;//kernel.Keys:1014\n      if (! _this.stats[code]) {\n        //$LASTPOS=10001032;//kernel.Keys:1032\n        _this.stats[code]=0;\n      }\n      _thread.retVal=_this.stats[code];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    update :function _trc_Keys_update() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var _it_115;\n      \n      //$LASTPOS=10001097;//kernel.Keys:1097\n      _it_115=Tonyu.iterator(_this.stats,1);\n      while(_it_115.next()) {\n        i=_it_115[0];\n        \n        //$LASTPOS=10001128;//kernel.Keys:1128\n        if (_this.stats[i]>0) {\n          //$LASTPOS=10001145;//kernel.Keys:1145\n          _this.stats[i]++;\n          \n        }\n        //$LASTPOS=10001166;//kernel.Keys:1166\n        if (_this.stats[i]==- 1) {\n          //$LASTPOS=10001184;//kernel.Keys:1184\n          _this.stats[i]=1;\n        }\n        \n      }\n    },\n    fiber$update :function _trc_Keys_f_update(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var _it_115;\n      \n      //$LASTPOS=10001097;//kernel.Keys:1097\n      _it_115=Tonyu.iterator(_this.stats,1);\n      while(_it_115.next()) {\n        i=_it_115[0];\n        \n        //$LASTPOS=10001128;//kernel.Keys:1128\n        if (_this.stats[i]>0) {\n          //$LASTPOS=10001145;//kernel.Keys:1145\n          _this.stats[i]++;\n          \n        }\n        //$LASTPOS=10001166;//kernel.Keys:1166\n        if (_this.stats[i]==- 1) {\n          //$LASTPOS=10001184;//kernel.Keys:1184\n          _this.stats[i]=1;\n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    keydown :function _trc_Keys_keydown(e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var s;\n      \n      //$LASTPOS=10001222;//kernel.Keys:1222\n      s = _this.stats[e.keyCode];\n      //$LASTPOS=10001250;//kernel.Keys:1250\n      if (! s) {\n        //$LASTPOS=10001268;//kernel.Keys:1268\n        _this.stats[e.keyCode]=1;\n        \n      }\n      //$LASTPOS=10001298;//kernel.Keys:1298\n      Tonyu.globals.$InputDevice.handleListeners();\n    },\n    fiber$keydown :function _trc_Keys_f_keydown(_thread,e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var s;\n      \n      //$LASTPOS=10001222;//kernel.Keys:1222\n      s = _this.stats[e.keyCode];\n      //$LASTPOS=10001250;//kernel.Keys:1250\n      if (! s) {\n        //$LASTPOS=10001268;//kernel.Keys:1268\n        _this.stats[e.keyCode]=1;\n        \n      }\n      //$LASTPOS=10001298;//kernel.Keys:1298\n      Tonyu.globals.$InputDevice.handleListeners();\n      \n      _thread.retVal=_this;return;\n    },\n    keyup :function _trc_Keys_keyup(e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=10001348;//kernel.Keys:1348\n      _this.stats[e.keyCode]=0;\n      //$LASTPOS=10001372;//kernel.Keys:1372\n      Tonyu.globals.$InputDevice.handleListeners();\n    },\n    fiber$keyup :function _trc_Keys_f_keyup(_thread,e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=10001348;//kernel.Keys:1348\n      _this.stats[e.keyCode]=0;\n      //$LASTPOS=10001372;//kernel.Keys:1372\n      Tonyu.globals.$InputDevice.handleListeners();\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"getkey":{"nowait":false},"update":{"nowait":false},"keydown":{"nowait":false},"keyup":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.BaseActor\',\n  shortName: \'BaseActor\',\n  namespace: \'kernel\',\n  includes: [Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.TextRectMod,Tonyu.classes.kernel.OneframeSpriteMod,Tonyu.classes.kernel.ThreadGroupMod],\n  methods: {\n    main :function _trc_BaseActor_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_BaseActor_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_BaseActor_initialize(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11000195;//kernel.BaseActor:195\n      if (Tonyu.runMode) {\n        //$LASTPOS=11000429;//kernel.BaseActor:429\n        _this._th=Tonyu.globals.$Boot.schedule(_this,"main",[]);\n        \n      }\n      //$LASTPOS=11000477;//kernel.BaseActor:477\n      if (typeof  x=="object") {\n        //$LASTPOS=11000501;//kernel.BaseActor:501\n        Tonyu.extend(_this,x);\n      } else {\n        //$LASTPOS=11000533;//kernel.BaseActor:533\n        if (typeof  x=="number") {\n          //$LASTPOS=11000568;//kernel.BaseActor:568\n          _this.x=x;\n          //$LASTPOS=11000587;//kernel.BaseActor:587\n          _this.y=y;\n          //$LASTPOS=11000606;//kernel.BaseActor:606\n          _this.p=p;\n          \n        }\n      }\n      //$LASTPOS=11000628;//kernel.BaseActor:628\n      if (_this.scaleX==null) {\n        //$LASTPOS=11000646;//kernel.BaseActor:646\n        _this.scaleX=1;\n      }\n      //$LASTPOS=11000661;//kernel.BaseActor:661\n      if (_this.rotation==null) {\n        //$LASTPOS=11000681;//kernel.BaseActor:681\n        _this.rotation=0;\n      }\n      //$LASTPOS=11000698;//kernel.BaseActor:698\n      if (_this.rotate==null) {\n        //$LASTPOS=11000716;//kernel.BaseActor:716\n        _this.rotate=0;\n      }\n      //$LASTPOS=11000731;//kernel.BaseActor:731\n      if (_this.alpha==null) {\n        //$LASTPOS=11000748;//kernel.BaseActor:748\n        _this.alpha=255;\n      }\n      //$LASTPOS=11000764;//kernel.BaseActor:764\n      if (_this.zOrder==null) {\n        //$LASTPOS=11000782;//kernel.BaseActor:782\n        _this.zOrder=0;\n      }\n      //$LASTPOS=11000797;//kernel.BaseActor:797\n      if (_this.age==null) {\n        //$LASTPOS=11000812;//kernel.BaseActor:812\n        _this.age=0;\n      }\n      //$LASTPOS=11000824;//kernel.BaseActor:824\n      if (_this.anim!=null&&typeof  _this.anim=="object") {\n        //$LASTPOS=11000875;//kernel.BaseActor:875\n        _this.animMode=true;\n        //$LASTPOS=11000899;//kernel.BaseActor:899\n        _this.animFrame=0;\n        \n      } else {\n        //$LASTPOS=11000933;//kernel.BaseActor:933\n        _this.animMode=false;\n        \n      }\n      //$LASTPOS=11000961;//kernel.BaseActor:961\n      if (_this.animFps==null) {\n        //$LASTPOS=11000980;//kernel.BaseActor:980\n        _this.animFps=1;\n      }\n    },\n    extend :function _trc_BaseActor_extend(obj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.extend(_this,obj);\n    },\n    print :function _trc_BaseActor_print(pt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11001084;//kernel.BaseActor:1084\n      console.log.apply(console,arguments);\n      //$LASTPOS=11001127;//kernel.BaseActor:1127\n      if (Tonyu.globals.$consolePanel) {\n        //$LASTPOS=11001155;//kernel.BaseActor:1155\n        Tonyu.globals.$consolePanel.scroll(0,20);\n        //$LASTPOS=11001192;//kernel.BaseActor:1192\n        Tonyu.globals.$consolePanel.setFillStyle("white");\n        //$LASTPOS=11001238;//kernel.BaseActor:1238\n        Tonyu.globals.$consolePanel.fillText(pt,0,Tonyu.globals.$consolePrintY,20,"left");\n        \n      }\n    },\n    setAnimFps :function _trc_BaseActor_setAnimFps(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11001334;//kernel.BaseActor:1334\n      _this.animFps=f;\n      //$LASTPOS=11001355;//kernel.BaseActor:1355\n      _this.animFrame=0;\n      //$LASTPOS=11001378;//kernel.BaseActor:1378\n      _this.animMode=true;\n    },\n    startAnim :function _trc_BaseActor_startAnim() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11001428;//kernel.BaseActor:1428\n      _this.animMode=true;\n    },\n    stopAnim :function _trc_BaseActor_stopAnim() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11001477;//kernel.BaseActor:1477\n      _this.animMode=false;\n    },\n    update :function _trc_BaseActor_update() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11001519;//kernel.BaseActor:1519\n      _this.onUpdate();\n      //$LASTPOS=11001536;//kernel.BaseActor:1536\n      if (null) {\n        //$LASTPOS=11001559;//kernel.BaseActor:1559\n        null.suspend();\n        //$LASTPOS=11001587;//kernel.BaseActor:1587\n        if (Tonyu.globals.$Scheduler) {\n          //$LASTPOS=11001603;//kernel.BaseActor:1603\n          Tonyu.globals.$Scheduler.addToNext(null);\n        }\n        \n      }\n    },\n    fiber$update :function _trc_BaseActor_f_update(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=11001519;//kernel.BaseActor:1519\n      _this.onUpdate();\n      //$LASTPOS=11001536;//kernel.BaseActor:1536\n      if (_thread) {\n        //$LASTPOS=11001559;//kernel.BaseActor:1559\n        _thread.suspend();\n        //$LASTPOS=11001587;//kernel.BaseActor:1587\n        if (Tonyu.globals.$Scheduler) {\n          //$LASTPOS=11001603;//kernel.BaseActor:1603\n          Tonyu.globals.$Scheduler.addToNext(_thread);\n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    onUpdate :function _trc_BaseActor_onUpdate() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    updateEx :function _trc_BaseActor_updateEx(updateT) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var updateCount;\n      \n      //$LASTPOS=11001697;//kernel.BaseActor:1697\n      //$LASTPOS=11001701;//kernel.BaseActor:1701\n      updateCount = 0;\n      while(updateCount<updateT) {\n        {\n          //$LASTPOS=11001764;//kernel.BaseActor:1764\n          _this.update();\n        }\n        updateCount++;\n      }\n    },\n    fiber$updateEx :function _trc_BaseActor_f_updateEx(_thread,updateT) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var updateCount;\n      \n      \n      _thread.enter(function _trc_BaseActor_ent_updateEx(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=11001697;//kernel.BaseActor:1697\n            //$LASTPOS=11001701;//kernel.BaseActor:1701\n            updateCount = 0;;\n          case 1:\n            if (!(updateCount<updateT)) { __pc=3; break; }\n            //$LASTPOS=11001764;//kernel.BaseActor:1764\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            updateCount++;\n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    getkey :function _trc_BaseActor_getkey(k) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.globals.$Keys.getkey(k);\n    },\n    hitTo :function _trc_BaseActor_hitTo(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.crashTo(t);\n    },\n    all :function _trc_BaseActor_all(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      \n      //$LASTPOS=11001907;//kernel.BaseActor:1907\n      res = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=11001932;//kernel.BaseActor:1932\n      Tonyu.globals.$Sprites.sprites.forEach((function anonymous_1957(s) {\n        \n        //$LASTPOS=11001973;//kernel.BaseActor:1973\n        if (s===_this) {\n          return _this;\n        }\n        //$LASTPOS=11002004;//kernel.BaseActor:2004\n        if (! c||s instanceof c) {\n          //$LASTPOS=11002045;//kernel.BaseActor:2045\n          res.push(s);\n          \n        }\n      }));\n      return res;\n    },\n    allCrash :function _trc_BaseActor_allCrash(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      var sp;\n      var t1;\n      \n      //$LASTPOS=11002152;//kernel.BaseActor:2152\n      res = new Tonyu.classes.kernel.TQuery;\n      //$LASTPOS=11002177;//kernel.BaseActor:2177\n      sp = _this;\n      //$LASTPOS=11002214;//kernel.BaseActor:2214\n      t1 = _this.getCrashRect();\n      //$LASTPOS=11002242;//kernel.BaseActor:2242\n      if (! t1) {\n        return res;\n      }\n      //$LASTPOS=11002268;//kernel.BaseActor:2268\n      Tonyu.globals.$Sprites.sprites.forEach((function anonymous_2293(s) {\n        var t2;\n        \n        //$LASTPOS=11002309;//kernel.BaseActor:2309\n        t2;\n        //$LASTPOS=11002326;//kernel.BaseActor:2326\n        if (s!==_this&&! s.excludeFromAll&&s instanceof t&&(t2=s.getCrashRect())&&Math.abs(t1.x-t2.x)*2<t1.width+t2.width&&Math.abs(t1.y-t2.y)*2<t1.height+t2.height) {\n          //$LASTPOS=11002552;//kernel.BaseActor:2552\n          res.push(s);\n          \n        }\n      }));\n      return res;\n    },\n    crashTo :function _trc_BaseActor_crashTo(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11002632;//kernel.BaseActor:2632\n      if (! t) {\n        return false;\n      }\n      //$LASTPOS=11002659;//kernel.BaseActor:2659\n      if (typeof  t=="function") {\n        return _this.allCrash(t)[0];\n        \n      }\n      return _this.crashTo1(t);\n    },\n    crashTo1 :function _trc_BaseActor_crashTo1(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var t1;\n      var t2;\n      \n      //$LASTPOS=11002782;//kernel.BaseActor:2782\n      if (! t||t._isDead) {\n        return false;\n      }\n      //$LASTPOS=11002910;//kernel.BaseActor:2910\n      t1 = _this.getCrashRect();\n      //$LASTPOS=11002938;//kernel.BaseActor:2938\n      t2 = t.getCrashRect();\n      return t1&&t2&&Math.abs(t1.x-t2.x)*2<t1.width+t2.width&&Math.abs(t1.y-t2.y)*2<t1.height+t2.height;\n    },\n    getCrashRect :function _trc_BaseActor_getCrashRect() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var actWidth;\n      var actHeight;\n      \n      //$LASTPOS=11003250;//kernel.BaseActor:3250\n      actWidth = _this.width*_this.scaleX;actHeight;\n      //$LASTPOS=11003293;//kernel.BaseActor:3293\n      if (typeof  _this.scaleY==="undefined") {\n        //$LASTPOS=11003335;//kernel.BaseActor:3335\n        actHeight=_this.height*_this.scaleX;\n        \n      } else {\n        //$LASTPOS=11003381;//kernel.BaseActor:3381\n        actHeight=_this.height*_this.scaleY;\n        \n      }\n      return typeof  _this.x=="number"&&typeof  _this.y=="number"&&typeof  _this.width=="number"&&typeof  _this.height=="number"&&{x: _this.x,y: _this.y,width: actWidth,height: actHeight};\n    },\n    within :function _trc_BaseActor_within(t,distance) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11003618;//kernel.BaseActor:3618\n      if (! t||t._isDead) {\n        return false;\n      }\n      //$LASTPOS=11003657;//kernel.BaseActor:3657\n      if (Math.sqrt(Math.abs(_this.x-t.x)*Math.abs(_this.x-t.x)+Math.abs(_this.y-t.y)*Math.abs(_this.y-t.y))<distance) {\n        return true;\n        \n      }\n      return false;\n    },\n    watchHit :function _trc_BaseActor_watchHit(typeA,typeB,onHit) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11003842;//kernel.BaseActor:3842\n      Tonyu.globals.$Sprites.watchHit(typeA,typeB,(function anonymous_3875(a,b) {\n        \n        //$LASTPOS=11003893;//kernel.BaseActor:3893\n        onHit.apply(_this,[a,b]);\n      }));\n    },\n    currentThreadGroup :function _trc_BaseActor_currentThreadGroup() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.globals.$Scheduler;\n    },\n    die :function _trc_BaseActor_die() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11004047;//kernel.BaseActor:4047\n      _this.killThreadGroup();\n      //$LASTPOS=11004119;//kernel.BaseActor:4119\n      _this.hide();\n      //$LASTPOS=11004132;//kernel.BaseActor:4132\n      _this.fireEvent("die");\n      //$LASTPOS=11004155;//kernel.BaseActor:4155\n      _this._isDead=true;\n    },\n    hide :function _trc_BaseActor_hide() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11004334;//kernel.BaseActor:4334\n      if (_this.layer&&typeof  _this.layer.remove=="function") {\n        //$LASTPOS=11004389;//kernel.BaseActor:4389\n        _this.layer.remove(_this);\n        \n      } else {\n        //$LASTPOS=11004430;//kernel.BaseActor:4430\n        Tonyu.globals.$Sprites.remove(_this);\n        \n      }\n    },\n    show :function _trc_BaseActor_show(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11004491;//kernel.BaseActor:4491\n      if (_this.layer&&typeof  _this.layer.add=="function") {\n        //$LASTPOS=11004543;//kernel.BaseActor:4543\n        _this.layer.add(_this);\n        \n      } else {\n        //$LASTPOS=11004581;//kernel.BaseActor:4581\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      //$LASTPOS=11004613;//kernel.BaseActor:4613\n      if (x!=null) {\n        //$LASTPOS=11004626;//kernel.BaseActor:4626\n        _this.x=x;\n      }\n      //$LASTPOS=11004641;//kernel.BaseActor:4641\n      if (y!=null) {\n        //$LASTPOS=11004654;//kernel.BaseActor:4654\n        _this.y=y;\n      }\n      //$LASTPOS=11004669;//kernel.BaseActor:4669\n      if (p!=null) {\n        //$LASTPOS=11004682;//kernel.BaseActor:4682\n        _this.p=p;\n      }\n    },\n    detectShape :function _trc_BaseActor_detectShape() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11004727;//kernel.BaseActor:4727\n      if (typeof  _this.p!="number") {\n        //$LASTPOS=11004762;//kernel.BaseActor:4762\n        if (_this.text!=null) {\n          return _this;\n        }\n        //$LASTPOS=11004795;//kernel.BaseActor:4795\n        _this.p=0;\n        \n      }\n      //$LASTPOS=11004812;//kernel.BaseActor:4812\n      _this.p=Math.floor(_this.p);\n      //$LASTPOS=11004834;//kernel.BaseActor:4834\n      _this.pImg=Tonyu.globals.$Sprites.getImageList()[_this.p];\n      //$LASTPOS=11004872;//kernel.BaseActor:4872\n      if (! _this.pImg) {\n        return _this;\n      }\n      //$LASTPOS=11004896;//kernel.BaseActor:4896\n      _this.width=_this.pImg.width;\n      //$LASTPOS=11004919;//kernel.BaseActor:4919\n      _this.height=_this.pImg.height;\n    },\n    waitFor :function _trc_BaseActor_waitFor(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11004962;//kernel.BaseActor:4962\n      if (null) {\n        //$LASTPOS=11004986;//kernel.BaseActor:4986\n        null.waitFor(f);\n        \n      }\n    },\n    fiber$waitFor :function _trc_BaseActor_f_waitFor(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=11004962;//kernel.BaseActor:4962\n      if (_thread) {\n        //$LASTPOS=11004986;//kernel.BaseActor:4986\n        _thread.waitFor(f);\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    isDead :function _trc_BaseActor_isDead() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this._isDead;\n    },\n    animation :function _trc_BaseActor_animation() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11005106;//kernel.BaseActor:5106\n      _this.age++;\n      //$LASTPOS=11005118;//kernel.BaseActor:5118\n      if (_this.animMode&&_this.age%_this.animFps==0) {\n        //$LASTPOS=11005159;//kernel.BaseActor:5159\n        _this.p=_this.anim[_this.animFrame%_this.anim.length];\n        //$LASTPOS=11005199;//kernel.BaseActor:5199\n        _this.animFrame++;\n        \n      }\n    },\n    draw :function _trc_BaseActor_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var rect;\n      \n      //$LASTPOS=11005248;//kernel.BaseActor:5248\n      if (_this.x==null||_this.y==null||_this._isInvisible) {\n        return _this;\n      }\n      //$LASTPOS=11005301;//kernel.BaseActor:5301\n      _this.detectShape();\n      //$LASTPOS=11005321;//kernel.BaseActor:5321\n      if (_this.pImg) {\n        //$LASTPOS=11005342;//kernel.BaseActor:5342\n        ctx.save();\n        //$LASTPOS=11005363;//kernel.BaseActor:5363\n        ctx.translate(_this.x,_this.y);\n        //$LASTPOS=11005507;//kernel.BaseActor:5507\n        _this.animation();\n        //$LASTPOS=11005529;//kernel.BaseActor:5529\n        if (_this.rotation!=0) {\n          //$LASTPOS=11005564;//kernel.BaseActor:5564\n          ctx.rotate(_this.rotation/180*Math.PI);\n          \n        } else {\n          //$LASTPOS=11005632;//kernel.BaseActor:5632\n          ctx.rotate(_this.rotate/180*Math.PI);\n          \n        }\n        //$LASTPOS=11005689;//kernel.BaseActor:5689\n        if (typeof  _this.scaleY==="undefined") {\n          //$LASTPOS=11005741;//kernel.BaseActor:5741\n          ctx.scale(_this.scaleX,_this.scaleX);\n          \n        } else {\n          //$LASTPOS=11005806;//kernel.BaseActor:5806\n          ctx.scale(_this.scaleX,_this.scaleY);\n          \n        }\n        //$LASTPOS=11005862;//kernel.BaseActor:5862\n        ctx.globalAlpha=_this.alpha/255;\n        //$LASTPOS=11005903;//kernel.BaseActor:5903\n        ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.width/2,- _this.height/2,_this.width,_this.height);\n        //$LASTPOS=11006035;//kernel.BaseActor:6035\n        ctx.restore();\n        \n      } else {\n        //$LASTPOS=11006062;//kernel.BaseActor:6062\n        if (_this.text!==null&&_this.text!==undefined) {\n          //$LASTPOS=11006110;//kernel.BaseActor:6110\n          if (! _this.size) {\n            //$LASTPOS=11006121;//kernel.BaseActor:6121\n            _this.size=15;\n          }\n          //$LASTPOS=11006139;//kernel.BaseActor:6139\n          if (! _this.align) {\n            //$LASTPOS=11006151;//kernel.BaseActor:6151\n            _this.align="center";\n          }\n          //$LASTPOS=11006176;//kernel.BaseActor:6176\n          if (! _this.fillStyle) {\n            //$LASTPOS=11006192;//kernel.BaseActor:6192\n            _this.fillStyle="white";\n          }\n          //$LASTPOS=11006220;//kernel.BaseActor:6220\n          ctx.fillStyle=_this.fillStyle;\n          //$LASTPOS=11006254;//kernel.BaseActor:6254\n          ctx.globalAlpha=_this.alpha/255;\n          //$LASTPOS=11006295;//kernel.BaseActor:6295\n          rect = _this.drawTextRect(ctx,_this.text,_this.x,_this.y,_this.size,_this.align,"fill");\n          //$LASTPOS=11006366;//kernel.BaseActor:6366\n          _this.width=rect.w;\n          //$LASTPOS=11006389;//kernel.BaseActor:6389\n          _this.height=rect.h;\n          \n        }\n      }\n      //$LASTPOS=11006416;//kernel.BaseActor:6416\n      if (_this._fukidashi) {\n        //$LASTPOS=11006443;//kernel.BaseActor:6443\n        if (_this._fukidashi.c>0) {\n          //$LASTPOS=11006478;//kernel.BaseActor:6478\n          _this._fukidashi.c--;\n          //$LASTPOS=11006507;//kernel.BaseActor:6507\n          ctx.fillStyle="white";\n          //$LASTPOS=11006543;//kernel.BaseActor:6543\n          ctx.strokeStyle="black";\n          //$LASTPOS=11006581;//kernel.BaseActor:6581\n          _this.fukidashi(ctx,_this._fukidashi.text,_this.x,_this.y-_this.height/2-10,_this._fukidashi.size);\n          \n        }\n        \n      }\n    },\n    asyncResult :function _trc_BaseActor_asyncResult() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Tonyu.asyncResult();\n    },\n    runAsync :function _trc_BaseActor_runAsync(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11006784;//kernel.BaseActor:6784\n      if (! null) {\n        throw new Error("runAsync should run in wait mode");\n        \n      }\n      //$LASTPOS=11006856;//kernel.BaseActor:6856\n      null.runAsync(f);\n    },\n    fiber$runAsync :function _trc_BaseActor_f_runAsync(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=11006784;//kernel.BaseActor:6784\n      if (! _thread) {\n        throw new Error("runAsync should run in wait mode");\n        \n      }\n      //$LASTPOS=11006856;//kernel.BaseActor:6856\n      _thread.runAsync(f);\n      \n      _thread.retVal=_this;return;\n    },\n    screenOut :function _trc_BaseActor_screenOut(a) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var r;\n      var viewX;\n      var viewY;\n      \n      //$LASTPOS=11006938;//kernel.BaseActor:6938\n      if (! a) {\n        //$LASTPOS=11006946;//kernel.BaseActor:6946\n        a=0;\n      }\n      //$LASTPOS=11006956;//kernel.BaseActor:6956\n      r = 0;\n      //$LASTPOS=11006970;//kernel.BaseActor:6970\n      viewX = 0;viewY = 0;\n      //$LASTPOS=11006996;//kernel.BaseActor:6996\n      if (_this.x<viewX+a) {\n        //$LASTPOS=11007025;//kernel.BaseActor:7025\n        r+=viewX+a-_this.x;\n      }\n      //$LASTPOS=11007044;//kernel.BaseActor:7044\n      if (_this.y<viewY+a) {\n        //$LASTPOS=11007073;//kernel.BaseActor:7073\n        r+=viewY+a-_this.y;\n      }\n      //$LASTPOS=11007092;//kernel.BaseActor:7092\n      if (_this.x>Tonyu.globals.$screenWidth+viewX-a) {\n        //$LASTPOS=11007121;//kernel.BaseActor:7121\n        r+=_this.x-(Tonyu.globals.$screenWidth+viewX-a);\n      }\n      //$LASTPOS=11007156;//kernel.BaseActor:7156\n      if (_this.y>Tonyu.globals.$screenHeight+viewY-a) {\n        //$LASTPOS=11007185;//kernel.BaseActor:7185\n        r+=_this.y-(Tonyu.globals.$screenHeight+viewY-a);\n      }\n      return r;\n    },\n    fiber$screenOut :function _trc_BaseActor_f_screenOut(_thread,a) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var r;\n      var viewX;\n      var viewY;\n      \n      //$LASTPOS=11006938;//kernel.BaseActor:6938\n      if (! a) {\n        //$LASTPOS=11006946;//kernel.BaseActor:6946\n        a=0;\n      }\n      //$LASTPOS=11006956;//kernel.BaseActor:6956\n      r = 0;\n      //$LASTPOS=11006970;//kernel.BaseActor:6970\n      viewX = 0;viewY = 0;\n      //$LASTPOS=11006996;//kernel.BaseActor:6996\n      if (_this.x<viewX+a) {\n        //$LASTPOS=11007025;//kernel.BaseActor:7025\n        r+=viewX+a-_this.x;\n      }\n      //$LASTPOS=11007044;//kernel.BaseActor:7044\n      if (_this.y<viewY+a) {\n        //$LASTPOS=11007073;//kernel.BaseActor:7073\n        r+=viewY+a-_this.y;\n      }\n      //$LASTPOS=11007092;//kernel.BaseActor:7092\n      if (_this.x>Tonyu.globals.$screenWidth+viewX-a) {\n        //$LASTPOS=11007121;//kernel.BaseActor:7121\n        r+=_this.x-(Tonyu.globals.$screenWidth+viewX-a);\n      }\n      //$LASTPOS=11007156;//kernel.BaseActor:7156\n      if (_this.y>Tonyu.globals.$screenHeight+viewY-a) {\n        //$LASTPOS=11007185;//kernel.BaseActor:7185\n        r+=_this.y-(Tonyu.globals.$screenHeight+viewY-a);\n      }\n      _thread.retVal=r;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    file :function _trc_BaseActor_file(path) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var d;\n      var files;\n      \n      //$LASTPOS=11007253;//kernel.BaseActor:7253\n      d = Tonyu.currentProject.getDir();\n      //$LASTPOS=11007295;//kernel.BaseActor:7295\n      files = d.rel("files/");\n      return FS.get(files.rel(path),{topDir: d});\n    },\n    fiber$file :function _trc_BaseActor_f_file(_thread,path) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var d;\n      var files;\n      \n      //$LASTPOS=11007253;//kernel.BaseActor:7253\n      d = Tonyu.currentProject.getDir();\n      //$LASTPOS=11007295;//kernel.BaseActor:7295\n      files = d.rel("files/");\n      _thread.retVal=FS.get(files.rel(path),{topDir: d});return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    waitInputDevice :function _trc_BaseActor_waitInputDevice(fl) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11007402;//kernel.BaseActor:7402\n      if (fl!==false) {\n        //$LASTPOS=11007429;//kernel.BaseActor:7429\n        if (! _this.origTG) {\n          \n          \n        }\n        //$LASTPOS=11007581;//kernel.BaseActor:7581\n        _this.a=_this.asyncResult();\n        //$LASTPOS=11007607;//kernel.BaseActor:7607\n        Tonyu.globals.$InputDevice.addOnetimeListener(_this.a.receiver);\n        //$LASTPOS=11007661;//kernel.BaseActor:7661\n        _this.waitFor(_this.a);\n        \n      } else {\n        //$LASTPOS=11007696;//kernel.BaseActor:7696\n        if (_this.origTG) {\n          \n          \n        }\n        \n      }\n    },\n    fiber$waitInputDevice :function _trc_BaseActor_f_waitInputDevice(_thread,fl) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_BaseActor_ent_waitInputDevice(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=11007402;//kernel.BaseActor:7402\n            if (!(fl!==false)) { __pc=3; break; }\n            //$LASTPOS=11007429;//kernel.BaseActor:7429\n            if (!(! _this.origTG)) { __pc=1; break; }\n            {\n              //$LASTPOS=11007483;//kernel.BaseActor:7483\n              _this.origTG=_thread.group;\n              //$LASTPOS=11007522;//kernel.BaseActor:7522\n              _thread.setGroup(null);\n            }\n          case 1:\n            \n            //$LASTPOS=11007581;//kernel.BaseActor:7581\n            _this.a=_this.asyncResult();\n            //$LASTPOS=11007607;//kernel.BaseActor:7607\n            Tonyu.globals.$InputDevice.addOnetimeListener(_this.a.receiver);\n            //$LASTPOS=11007661;//kernel.BaseActor:7661\n            _this.fiber$waitFor(_thread, _this.a);\n            __pc=2;return;\n          case 2:\n            \n            __pc=5;break;\n          case 3:\n            //$LASTPOS=11007696;//kernel.BaseActor:7696\n            if (!(_this.origTG)) { __pc=4; break; }\n            {\n              //$LASTPOS=11007749;//kernel.BaseActor:7749\n              _thread.setGroup(_this.origTG);\n              //$LASTPOS=11007792;//kernel.BaseActor:7792\n              _this.origTG=null;\n            }\n          case 4:\n            \n          case 5:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    redrawScreen :function _trc_BaseActor_redrawScreen() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11007865;//kernel.BaseActor:7865\n      Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n      //$LASTPOS=11007901;//kernel.BaseActor:7901\n      Tonyu.globals.$Screen.draw();\n    },\n    fiber$redrawScreen :function _trc_BaseActor_f_redrawScreen(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=11007865;//kernel.BaseActor:7865\n      Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n      //$LASTPOS=11007901;//kernel.BaseActor:7901\n      Tonyu.globals.$Screen.draw();\n      \n      _thread.retVal=_this;return;\n    },\n    color :function _trc_BaseActor_color(r,g,b) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return "rgb("+[r,g,b].join(",")+")";\n    },\n    fiber$color :function _trc_BaseActor_f_color(_thread,r,g,b) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal="rgb("+[r,g,b].join(",")+")";return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    loadPage :function _trc_BaseActor_loadPage(page,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11008610;//kernel.BaseActor:8610\n      _this.all().die();\n      //$LASTPOS=11008628;//kernel.BaseActor:8628\n      new page(arg);\n      //$LASTPOS=11008648;//kernel.BaseActor:8648\n      _this.die();\n    },\n    fiber$loadPage :function _trc_BaseActor_f_loadPage(_thread,page,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=11008610;//kernel.BaseActor:8610\n      _this.all().die();\n      //$LASTPOS=11008628;//kernel.BaseActor:8628\n      new page(arg);\n      //$LASTPOS=11008648;//kernel.BaseActor:8648\n      _this.die();\n      \n      _thread.retVal=_this;return;\n    },\n    setVisible :function _trc_BaseActor_setVisible(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=11008683;//kernel.BaseActor:8683\n      _this._isInvisible=! v;\n    },\n    fiber$setVisible :function _trc_BaseActor_f_setVisible(_thread,v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=11008683;//kernel.BaseActor:8683\n      _this._isInvisible=! v;\n      \n      _thread.retVal=_this;return;\n    },\n    appear :function _trc_BaseActor_appear(o) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return o;\n    },\n    fiber$appear :function _trc_BaseActor_f_appear(_thread,o) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=o;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"extend":{"nowait":true},"print":{"nowait":true},"setAnimFps":{"nowait":true},"startAnim":{"nowait":true},"stopAnim":{"nowait":true},"update":{"nowait":false},"onUpdate":{"nowait":true},"updateEx":{"nowait":false},"getkey":{"nowait":true},"hitTo":{"nowait":true},"all":{"nowait":true},"allCrash":{"nowait":true},"crashTo":{"nowait":true},"crashTo1":{"nowait":true},"getCrashRect":{"nowait":true},"within":{"nowait":true},"watchHit":{"nowait":true},"currentThreadGroup":{"nowait":true},"die":{"nowait":true},"hide":{"nowait":true},"show":{"nowait":true},"detectShape":{"nowait":true},"waitFor":{"nowait":false},"isDead":{"nowait":true},"animation":{"nowait":true},"draw":{"nowait":true},"asyncResult":{"nowait":true},"runAsync":{"nowait":false},"screenOut":{"nowait":false},"file":{"nowait":false},"waitInputDevice":{"nowait":false},"redrawScreen":{"nowait":false},"color":{"nowait":false},"loadPage":{"nowait":false},"setVisible":{"nowait":false},"appear":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.EventHandler\',\n  shortName: \'EventHandler\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [],\n  methods: {\n    main :function _trc_EventHandler_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12000035;//kernel.EventHandler:35\n      _this.listeners=[];\n    },\n    fiber$main :function _trc_EventHandler_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=12000035;//kernel.EventHandler:35\n      _this.listeners=[];\n      \n      _thread.retVal=_this;return;\n    },\n    addListener :function _trc_EventHandler_addListener(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12000075;//kernel.EventHandler:75\n      if (_this.target&&(typeof  f)=="string") {\n        //$LASTPOS=12000122;//kernel.EventHandler:122\n        f=_this.target[f];\n        \n      }\n      //$LASTPOS=12000147;//kernel.EventHandler:147\n      if (typeof  f!="function") {\n        throw new Error("Not a event listener: "+_this.target+" / "+f);\n        \n      }\n      //$LASTPOS=12000236;//kernel.EventHandler:236\n      _this.listeners.push(f);\n      return {remove: (function anonymous_286() {\n        \n        //$LASTPOS=12000301;//kernel.EventHandler:301\n        _this.removeListener(f);\n      })};\n    },\n    fiber$addListener :function _trc_EventHandler_f_addListener(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=12000075;//kernel.EventHandler:75\n      if (_this.target&&(typeof  f)=="string") {\n        //$LASTPOS=12000122;//kernel.EventHandler:122\n        f=_this.target[f];\n        \n      }\n      //$LASTPOS=12000147;//kernel.EventHandler:147\n      if (typeof  f!="function") {\n        throw new Error("Not a event listener: "+_this.target+" / "+f);\n        \n      }\n      //$LASTPOS=12000236;//kernel.EventHandler:236\n      _this.listeners.push(f);\n      \n      _thread.enter(function _trc_EventHandler_ent_addListener(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            _thread.exit({remove: (function anonymous_286() {\n              \n              //$LASTPOS=12000301;//kernel.EventHandler:301\n              _this.removeListener(f);\n            })});return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    removeListener :function _trc_EventHandler_removeListener(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      \n      //$LASTPOS=12000369;//kernel.EventHandler:369\n      i = _this.listeners.indexOf(f);\n      //$LASTPOS=12000402;//kernel.EventHandler:402\n      _this.listeners.splice(i,1);\n    },\n    fiber$removeListener :function _trc_EventHandler_f_removeListener(_thread,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      \n      //$LASTPOS=12000369;//kernel.EventHandler:369\n      i = _this.listeners.indexOf(f);\n      //$LASTPOS=12000402;//kernel.EventHandler:402\n      _this.listeners.splice(i,1);\n      \n      _thread.retVal=_this;return;\n    },\n    fire :function _trc_EventHandler_fire(args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var t;\n      var h;\n      var _it_142;\n      \n      //$LASTPOS=12000448;//kernel.EventHandler:448\n      if (_this.released) {\n        return _this;\n      }\n      //$LASTPOS=12000475;//kernel.EventHandler:475\n      t;\n      //$LASTPOS=12000487;//kernel.EventHandler:487\n      _it_142=Tonyu.iterator(_this.listeners,1);\n      while(_it_142.next()) {\n        h=_it_142[0];\n        \n        //$LASTPOS=12000523;//kernel.EventHandler:523\n        if (h["fiber"]) {\n          //$LASTPOS=12000554;//kernel.EventHandler:554\n          t=Tonyu.thread();\n          //$LASTPOS=12000585;//kernel.EventHandler:585\n          h["fiber"].apply(_this.target,[t].concat(args));\n          //$LASTPOS=12000643;//kernel.EventHandler:643\n          t.steps();\n          \n        } else {\n          //$LASTPOS=12000685;//kernel.EventHandler:685\n          h.apply(_this.target,args);\n          \n        }\n        \n      }\n    },\n    fiber$fire :function _trc_EventHandler_f_fire(_thread,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var t;\n      var h;\n      var _it_142;\n      \n      //$LASTPOS=12000448;//kernel.EventHandler:448\n      if (_this.released) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=12000475;//kernel.EventHandler:475\n      t;\n      //$LASTPOS=12000487;//kernel.EventHandler:487\n      _it_142=Tonyu.iterator(_this.listeners,1);\n      while(_it_142.next()) {\n        h=_it_142[0];\n        \n        //$LASTPOS=12000523;//kernel.EventHandler:523\n        if (h["fiber"]) {\n          //$LASTPOS=12000554;//kernel.EventHandler:554\n          t=Tonyu.thread();\n          //$LASTPOS=12000585;//kernel.EventHandler:585\n          h["fiber"].apply(_this.target,[t].concat(args));\n          //$LASTPOS=12000643;//kernel.EventHandler:643\n          t.steps();\n          \n        } else {\n          //$LASTPOS=12000685;//kernel.EventHandler:685\n          h.apply(_this.target,args);\n          \n        }\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    release :function _trc_EventHandler_release() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=12000747;//kernel.EventHandler:747\n      _this.released=true;\n    },\n    fiber$release :function _trc_EventHandler_f_release(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=12000747;//kernel.EventHandler:747\n      _this.released=true;\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"addListener":{"nowait":false},"removeListener":{"nowait":false},"fire":{"nowait":false},"release":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.NoviceActor\',\n  shortName: \'NoviceActor\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.BaseActor,\n  includes: [],\n  methods: {\n    main :function _trc_NoviceActor_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_NoviceActor_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    sleep :function _trc_NoviceActor_sleep(n) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000050;//kernel.NoviceActor:50\n      if (! n) {\n        //$LASTPOS=13000057;//kernel.NoviceActor:57\n        n=1;\n      }\n      //$LASTPOS=13000066;//kernel.NoviceActor:66\n      //$LASTPOS=13000070;//kernel.NoviceActor:70\n      n;\n      while(n>0) {\n        //$LASTPOS=13000081;//kernel.NoviceActor:81\n        _this.update();\n        n--;\n      }\n    },\n    fiber$sleep :function _trc_NoviceActor_f_sleep(_thread,n) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=13000050;//kernel.NoviceActor:50\n      if (! n) {\n        //$LASTPOS=13000057;//kernel.NoviceActor:57\n        n=1;\n      }\n      \n      _thread.enter(function _trc_NoviceActor_ent_sleep(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=13000066;//kernel.NoviceActor:66\n            //$LASTPOS=13000070;//kernel.NoviceActor:70\n            n;;\n          case 1:\n            if (!(n>0)) { __pc=3; break; }\n            //$LASTPOS=13000081;//kernel.NoviceActor:81\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            n--;\n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initSprite :function _trc_NoviceActor_initSprite() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000113;//kernel.NoviceActor:113\n      if (! _this._sprite) {\n        //$LASTPOS=13000137;//kernel.NoviceActor:137\n        _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});\n        //$LASTPOS=13000207;//kernel.NoviceActor:207\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n    },\n    fiber$initSprite :function _trc_NoviceActor_f_initSprite(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=13000113;//kernel.NoviceActor:113\n      if (! _this._sprite) {\n        //$LASTPOS=13000137;//kernel.NoviceActor:137\n        _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});\n        //$LASTPOS=13000207;//kernel.NoviceActor:207\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    say :function _trc_NoviceActor_say(text,size) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000257;//kernel.NoviceActor:257\n      if (! size) {\n        //$LASTPOS=13000268;//kernel.NoviceActor:268\n        size=15;\n      }\n      //$LASTPOS=13000281;//kernel.NoviceActor:281\n      _this.initSprite();\n      //$LASTPOS=13000299;//kernel.NoviceActor:299\n      _this._sprite._fukidashi={text: text,size: size,c: 30};\n    },\n    fiber$say :function _trc_NoviceActor_f_say(_thread,text,size) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=13000257;//kernel.NoviceActor:257\n      if (! size) {\n        //$LASTPOS=13000268;//kernel.NoviceActor:268\n        size=15;\n      }\n      \n      _thread.enter(function _trc_NoviceActor_ent_say(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=13000281;//kernel.NoviceActor:281\n            _this.fiber$initSprite(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=13000299;//kernel.NoviceActor:299\n            _this._sprite._fukidashi={text: text,size: size,c: 30};\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    sprite :function _trc_NoviceActor_sprite(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000371;//kernel.NoviceActor:371\n      _this.go(x,y,p);\n    },\n    fiber$sprite :function _trc_NoviceActor_f_sprite(_thread,x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_NoviceActor_ent_sprite(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=13000371;//kernel.NoviceActor:371\n            _this.fiber$go(_thread, x, y, p);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    show :function _trc_NoviceActor_show(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000403;//kernel.NoviceActor:403\n      _this.go(x,y,p);\n    },\n    draw :function _trc_NoviceActor_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000440;//kernel.NoviceActor:440\n      _this._sprite.draw(ctx);\n    },\n    getCrashRect :function _trc_NoviceActor_getCrashRect() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this._sprite.getCrashRect();\n    },\n    go :function _trc_NoviceActor_go(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000533;//kernel.NoviceActor:533\n      _this.initSprite();\n      //$LASTPOS=13000551;//kernel.NoviceActor:551\n      _this._sprite.x=x;\n      //$LASTPOS=13000568;//kernel.NoviceActor:568\n      _this._sprite.y=y;\n      //$LASTPOS=13000585;//kernel.NoviceActor:585\n      if (p!=null) {\n        //$LASTPOS=13000598;//kernel.NoviceActor:598\n        _this._sprite.p=p;\n      }\n    },\n    fiber$go :function _trc_NoviceActor_f_go(_thread,x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_NoviceActor_ent_go(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=13000533;//kernel.NoviceActor:533\n            _this.fiber$initSprite(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=13000551;//kernel.NoviceActor:551\n            _this._sprite.x=x;\n            //$LASTPOS=13000568;//kernel.NoviceActor:568\n            _this._sprite.y=y;\n            //$LASTPOS=13000585;//kernel.NoviceActor:585\n            if (p!=null) {\n              //$LASTPOS=13000598;//kernel.NoviceActor:598\n              _this._sprite.p=p;\n            }\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    change :function _trc_NoviceActor_change(p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=13000646;//kernel.NoviceActor:646\n      _this.initSprite();\n      //$LASTPOS=13000664;//kernel.NoviceActor:664\n      _this._sprite.p=p;\n    },\n    fiber$change :function _trc_NoviceActor_f_change(_thread,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_NoviceActor_ent_change(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=13000646;//kernel.NoviceActor:646\n            _this.fiber$initSprite(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=13000664;//kernel.NoviceActor:664\n            _this._sprite.p=p;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"sleep":{"nowait":false},"initSprite":{"nowait":false},"say":{"nowait":false},"sprite":{"nowait":false},"show":{"nowait":true},"draw":{"nowait":true},"getCrashRect":{"nowait":true},"go":{"nowait":false},"change":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.MML\',\n  shortName: \'MML\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [Tonyu.classes.kernel.MathMod],\n  methods: {\n    main :function _trc_MML_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=14000050;//kernel.MML:50\n      _this.mmlBuf=[];\n    },\n    fiber$main :function _trc_MML_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=14000050;//kernel.MML:50\n      _this.mmlBuf=[];\n      \n      _thread.retVal=_this;return;\n    },\n    play :function _trc_MML_play(mmls) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=14000081;//kernel.MML:81\n      _this.mmlBuf.push(mmls);\n      //$LASTPOS=14000105;//kernel.MML:105\n      if (! _this.isPlaying()) {\n        //$LASTPOS=14000134;//kernel.MML:134\n        _this.playNext();\n        \n      }\n    },\n    fiber$play :function _trc_MML_f_play(_thread,mmls) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=14000081;//kernel.MML:81\n      _this.mmlBuf.push(mmls);\n      \n      _thread.enter(function _trc_MML_ent_play(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=14000105;//kernel.MML:105\n            if (!(! _this.isPlaying())) { __pc=2; break; }\n            //$LASTPOS=14000134;//kernel.MML:134\n            _this.fiber$playNext(_thread);\n            __pc=1;return;\n          case 1:\n            \n          case 2:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    playNext :function _trc_MML_playNext() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var mml;\n      \n      //$LASTPOS=14000220;//kernel.MML:220\n      if (_this.cTimeBase==null) {\n        //$LASTPOS=14000241;//kernel.MML:241\n        _this.cTimeBase=0;\n      }\n      //$LASTPOS=14000259;//kernel.MML:259\n      if (_this.m) {\n        //$LASTPOS=14000277;//kernel.MML:277\n        _this.cTimeBase+=_this.m.currentTime;\n        \n      }\n      //$LASTPOS=14000348;//kernel.MML:348\n      mml = _this.mmlBuf.shift();\n      //$LASTPOS=14000377;//kernel.MML:377\n      if (! mml) {\n        //$LASTPOS=14000398;//kernel.MML:398\n        _this.m=null;\n        //$LASTPOS=14000415;//kernel.MML:415\n        _this.cTimeBase=0;\n        return _this;\n        \n      }\n      //$LASTPOS=14000457;//kernel.MML:457\n      _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();\n      //$LASTPOS=14000495;//kernel.MML:495\n      _this.m=T("mml",{mml: mml},_this.mwav);\n      //$LASTPOS=14000525;//kernel.MML:525\n      _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));\n      //$LASTPOS=14000555;//kernel.MML:555\n      _this.m.start();\n      //$LASTPOS=14000571;//kernel.MML:571\n      Tonyu.globals.$MMLS[_this.id()]=_this;\n    },\n    fiber$playNext :function _trc_MML_f_playNext(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var mml;\n      \n      //$LASTPOS=14000220;//kernel.MML:220\n      if (_this.cTimeBase==null) {\n        //$LASTPOS=14000241;//kernel.MML:241\n        _this.cTimeBase=0;\n      }\n      //$LASTPOS=14000259;//kernel.MML:259\n      if (_this.m) {\n        //$LASTPOS=14000277;//kernel.MML:277\n        _this.cTimeBase+=_this.m.currentTime;\n        \n      }\n      //$LASTPOS=14000348;//kernel.MML:348\n      mml = _this.mmlBuf.shift();\n      //$LASTPOS=14000377;//kernel.MML:377\n      if (! mml) {\n        //$LASTPOS=14000398;//kernel.MML:398\n        _this.m=null;\n        //$LASTPOS=14000415;//kernel.MML:415\n        _this.cTimeBase=0;\n        _thread.retVal=_this;return;\n        \n        \n      }\n      //$LASTPOS=14000457;//kernel.MML:457\n      _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();\n      //$LASTPOS=14000495;//kernel.MML:495\n      _this.m=T("mml",{mml: mml},_this.mwav);\n      //$LASTPOS=14000525;//kernel.MML:525\n      _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));\n      //$LASTPOS=14000555;//kernel.MML:555\n      _this.m.start();\n      //$LASTPOS=14000571;//kernel.MML:571\n      Tonyu.globals.$MMLS[_this.id()]=_this;\n      \n      _thread.retVal=_this;return;\n    },\n    id :function _trc_MML_id() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=14000606;//kernel.MML:606\n      if (! _this._id) {\n        //$LASTPOS=14000616;//kernel.MML:616\n        _this._id=_this.rnd()+"";\n      }\n      return _this._id;\n    },\n    fiber$id :function _trc_MML_f_id(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=14000606;//kernel.MML:606\n      if (! _this._id) {\n        //$LASTPOS=14000616;//kernel.MML:616\n        _this._id=_this.rnd()+"";\n      }\n      _thread.retVal=_this._id;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    bufferCount :function _trc_MML_bufferCount() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.mmlBuf.length;\n    },\n    fiber$bufferCount :function _trc_MML_f_bufferCount(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.mmlBuf.length;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    isPlaying :function _trc_MML_isPlaying() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.m;\n    },\n    fiber$isPlaying :function _trc_MML_f_isPlaying(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.m;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    currentTime :function _trc_MML_currentTime() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=14000755;//kernel.MML:755\n      if (_this.m) {\n        return _this.m.currentTime+_this.cTimeBase;\n      }\n      return - 1;\n    },\n    fiber$currentTime :function _trc_MML_f_currentTime(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=14000755;//kernel.MML:755\n      if (_this.m) {\n        _thread.retVal=_this.m.currentTime+_this.cTimeBase;return;\n        \n      }\n      _thread.retVal=- 1;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stop :function _trc_MML_stop() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=14000829;//kernel.MML:829\n      if (_this.m) {\n        //$LASTPOS=14000847;//kernel.MML:847\n        if (_this.mwav) {\n          //$LASTPOS=14000872;//kernel.MML:872\n          _this.mwav.pause();\n          //$LASTPOS=14000899;//kernel.MML:899\n          _this.mwav.stop();\n          \n        }\n        //$LASTPOS=14000932;//kernel.MML:932\n        _this.m.pause();\n        //$LASTPOS=14000952;//kernel.MML:952\n        _this.m.stop();\n        //$LASTPOS=14000971;//kernel.MML:971\n        _this.m=null;\n        //$LASTPOS=14000988;//kernel.MML:988\n        _this.mmlBuf=[];\n        //$LASTPOS=14001056;//kernel.MML:1056\n        delete Tonyu.globals.$MMLS[_this.id()];\n        \n      }\n    },\n    fiber$stop :function _trc_MML_f_stop(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=14000829;//kernel.MML:829\n      if (_this.m) {\n        //$LASTPOS=14000847;//kernel.MML:847\n        if (_this.mwav) {\n          //$LASTPOS=14000872;//kernel.MML:872\n          _this.mwav.pause();\n          //$LASTPOS=14000899;//kernel.MML:899\n          _this.mwav.stop();\n          \n        }\n        //$LASTPOS=14000932;//kernel.MML:932\n        _this.m.pause();\n        //$LASTPOS=14000952;//kernel.MML:952\n        _this.m.stop();\n        //$LASTPOS=14000971;//kernel.MML:971\n        _this.m=null;\n        //$LASTPOS=14000988;//kernel.MML:988\n        _this.mmlBuf=[];\n        //$LASTPOS=14001056;//kernel.MML:1056\n        delete Tonyu.globals.$MMLS[_this.id()];\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"play":{"nowait":false},"playNext":{"nowait":false},"id":{"nowait":false},"bufferCount":{"nowait":false},"isPlaying":{"nowait":false},"currentTime":{"nowait":false},"stop":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.PlayMod\',\n  shortName: \'PlayMod\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.BaseActor,\n  includes: [],\n  methods: {\n    main :function _trc_PlayMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_PlayMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initMML :function _trc_PlayMod_initMML() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=15000045;//kernel.PlayMod:45\n      if (_this.mmlInited) {\n        return _this;\n      }\n      //$LASTPOS=15000073;//kernel.PlayMod:73\n      _this.mmlInited=true;\n      //$LASTPOS=15000094;//kernel.PlayMod:94\n      Tonyu.globals.$currentProject.requestPlugin("timbre");\n      //$LASTPOS=15000140;//kernel.PlayMod:140\n      if (! Tonyu.globals.$MMLS) {\n        //$LASTPOS=15000162;//kernel.PlayMod:162\n        Tonyu.globals.$MMLS={};\n        //$LASTPOS=15000180;//kernel.PlayMod:180\n        Tonyu.globals.$WaveTable=new Tonyu.classes.kernel.WaveTable;\n        //$LASTPOS=15000214;//kernel.PlayMod:214\n        Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseMML));\n        \n      }\n      //$LASTPOS=15000256;//kernel.PlayMod:256\n      _this.on("die",(function anonymous_266() {\n        \n        //$LASTPOS=15000272;//kernel.PlayMod:272\n        _this.play().stop();\n      }));\n    },\n    releaseMML :function _trc_PlayMod_releaseMML() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var k;\n      var v;\n      var _it_147;\n      \n      //$LASTPOS=15000322;//kernel.PlayMod:322\n      if (Tonyu.globals.$MMLS) {\n        //$LASTPOS=15000343;//kernel.PlayMod:343\n        _it_147=Tonyu.iterator(Tonyu.globals.$MMLS,2);\n        while(_it_147.next()) {\n          k=_it_147[0];\n          v=_it_147[1];\n          \n          //$LASTPOS=15000379;//kernel.PlayMod:379\n          v.stop();\n          \n        }\n        //$LASTPOS=15000407;//kernel.PlayMod:407\n        Tonyu.globals.$MMLS=null;\n        \n      }\n      //$LASTPOS=15000432;//kernel.PlayMod:432\n      if (Tonyu.globals.$WaveTable) {\n        //$LASTPOS=15000458;//kernel.PlayMod:458\n        Tonyu.globals.$WaveTable.stop();\n        //$LASTPOS=15000485;//kernel.PlayMod:485\n        Tonyu.globals.$WaveTable=null;\n        \n      }\n    },\n    play :function _trc_PlayMod_play() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var mmls;\n      var i;\n      \n      //$LASTPOS=15000528;//kernel.PlayMod:528\n      _this.initMML();\n      //$LASTPOS=15000544;//kernel.PlayMod:544\n      if (! _this._mml) {\n        //$LASTPOS=15000555;//kernel.PlayMod:555\n        _this._mml=new Tonyu.classes.kernel.MML;\n      }\n      //$LASTPOS=15000574;//kernel.PlayMod:574\n      if (_this.isDead()||arguments.length==0) {\n        return _this._mml;\n      }\n      //$LASTPOS=15000629;//kernel.PlayMod:629\n      mmls = [];\n      //$LASTPOS=15000647;//kernel.PlayMod:647\n      //$LASTPOS=15000652;//kernel.PlayMod:652\n      i = 0;\n      while(i<arguments.length) {\n        {\n          //$LASTPOS=15000697;//kernel.PlayMod:697\n          mmls.push(arguments[i]);\n        }\n        i++;\n      }\n      //$LASTPOS=15000734;//kernel.PlayMod:734\n      _this._mml.play(mmls);\n      //$LASTPOS=15000756;//kernel.PlayMod:756\n      while (_this._mml.bufferCount()>2) {\n        //$LASTPOS=15000796;//kernel.PlayMod:796\n        _this.update();\n        \n      }\n      return _this._mml;\n    },\n    fiber$play :function _trc_PlayMod_f_play(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var mmls;\n      var i;\n      \n      //$LASTPOS=15000528;//kernel.PlayMod:528\n      _this.initMML();\n      //$LASTPOS=15000544;//kernel.PlayMod:544\n      if (! _this._mml) {\n        //$LASTPOS=15000555;//kernel.PlayMod:555\n        _this._mml=new Tonyu.classes.kernel.MML;\n      }\n      //$LASTPOS=15000574;//kernel.PlayMod:574\n      if (_this.isDead()||_arguments.length==0) {\n        _thread.retVal=_this._mml;return;\n        \n      }\n      //$LASTPOS=15000629;//kernel.PlayMod:629\n      mmls = [];\n      //$LASTPOS=15000647;//kernel.PlayMod:647\n      //$LASTPOS=15000652;//kernel.PlayMod:652\n      i = 0;\n      while(i<_arguments.length) {\n        {\n          //$LASTPOS=15000697;//kernel.PlayMod:697\n          mmls.push(_arguments[i]);\n        }\n        i++;\n      }\n      //$LASTPOS=15000734;//kernel.PlayMod:734\n      _this._mml.play(mmls);\n      \n      _thread.enter(function _trc_PlayMod_ent_play(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=15000756;//kernel.PlayMod:756\n          case 1:\n            if (!(_this._mml.bufferCount()>2)) { __pc=3; break; }\n            //$LASTPOS=15000796;//kernel.PlayMod:796\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this._mml);return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    playSE :function _trc_PlayMod_playSE() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var mml;\n      var mmls;\n      var i;\n      \n      //$LASTPOS=15000859;//kernel.PlayMod:859\n      _this.initMML();\n      //$LASTPOS=15000875;//kernel.PlayMod:875\n      mml = new Tonyu.classes.kernel.MML;\n      //$LASTPOS=15000897;//kernel.PlayMod:897\n      mmls = [];\n      //$LASTPOS=15000915;//kernel.PlayMod:915\n      //$LASTPOS=15000920;//kernel.PlayMod:920\n      i = 0;\n      while(i<arguments.length) {\n        {\n          //$LASTPOS=15000965;//kernel.PlayMod:965\n          mmls.push(arguments[i]);\n        }\n        i++;\n      }\n      //$LASTPOS=15001002;//kernel.PlayMod:1002\n      mml.play(mmls);\n      return mml;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"initMML":{"nowait":true},"releaseMML":{"nowait":true},"play":{"nowait":false},"playSE":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.WaveTable\',\n  shortName: \'WaveTable\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [],\n  methods: {\n    main :function _trc_WaveTable_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000028;//kernel.WaveTable:28\n      _this.wav={};\n      //$LASTPOS=16000036;//kernel.WaveTable:36\n      _this.env={};\n      //$LASTPOS=16000313;//kernel.WaveTable:313\n      if (typeof  T!=="undefined") {\n        //$LASTPOS=16000392;//kernel.WaveTable:392\n        _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});\n        //$LASTPOS=16000460;//kernel.WaveTable:460\n        _this.setEnv(0,_this.env);\n        //$LASTPOS=16000480;//kernel.WaveTable:480\n        _this.setWav(0,T("pulse"));\n        \n      }\n    },\n    fiber$main :function _trc_WaveTable_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=16000028;//kernel.WaveTable:28\n      _this.wav={};\n      //$LASTPOS=16000036;//kernel.WaveTable:36\n      _this.env={};\n      \n      _thread.enter(function _trc_WaveTable_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=16000313;//kernel.WaveTable:313\n            if (!(typeof  T!=="undefined")) { __pc=3; break; }\n            //$LASTPOS=16000392;//kernel.WaveTable:392\n            _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});\n            //$LASTPOS=16000460;//kernel.WaveTable:460\n            _this.fiber$setEnv(_thread, 0, _this.env);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=16000480;//kernel.WaveTable:480\n            _this.fiber$setWav(_thread, 0, T("pulse"));\n            __pc=2;return;\n          case 2:\n            \n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    setWav :function _trc_WaveTable_setWav(num,synth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000070;//kernel.WaveTable:70\n      _this.wav[num]=synth;\n    },\n    fiber$setWav :function _trc_WaveTable_f_setWav(_thread,num,synth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=16000070;//kernel.WaveTable:70\n      _this.wav[num]=synth;\n      \n      _thread.retVal=_this;return;\n    },\n    setEnv :function _trc_WaveTable_setEnv(num,synth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=16000114;//kernel.WaveTable:114\n      _this.env[num]=synth;\n    },\n    fiber$setEnv :function _trc_WaveTable_f_setEnv(_thread,num,synth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=16000114;//kernel.WaveTable:114\n      _this.env[num]=synth;\n      \n      _thread.retVal=_this;return;\n    },\n    get :function _trc_WaveTable_get(w,e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var synth;\n      \n      //$LASTPOS=16000148;//kernel.WaveTable:148\n      synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});\n      return synth;\n    },\n    fiber$get :function _trc_WaveTable_f_get(_thread,w,e) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var synth;\n      \n      //$LASTPOS=16000148;//kernel.WaveTable:148\n      synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});\n      _thread.retVal=synth;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stop :function _trc_WaveTable_stop() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$stop :function _trc_WaveTable_f_stop(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"setWav":{"nowait":false},"setEnv":{"nowait":false},"get":{"nowait":false},"stop":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.ParallelMod\',\n  shortName: \'ParallelMod\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.BaseActor,\n  includes: [],\n  methods: {\n    main :function _trc_ParallelMod_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_ParallelMod_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    parallel :function _trc_ParallelMod_parallel() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var args;\n      var i;\n      var name;\n      var th;\n      \n      //$LASTPOS=17000064;//kernel.ParallelMod:64\n      args = [];\n      //$LASTPOS=17000083;//kernel.ParallelMod:83\n      //$LASTPOS=17000088;//kernel.ParallelMod:88\n      i = 1;\n      while(i<arguments.length) {\n        {\n          //$LASTPOS=17000134;//kernel.ParallelMod:134\n          args.push(arguments[i]);\n        }\n        i++;\n      }\n      //$LASTPOS=17000173;//kernel.ParallelMod:173\n      name = arguments[0];\n      //$LASTPOS=17000202;//kernel.ParallelMod:202\n      th;\n      //$LASTPOS=17000409;//kernel.ParallelMod:409\n      th=Tonyu.globals.$Boot.schedule(_this,name,args);\n      return th;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"parallel":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Scheduler\',\n  shortName: \'Scheduler\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.TObject,\n  includes: [],\n  methods: {\n    main :function _trc_Scheduler_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=18000050;//kernel.Scheduler:50\n      _this.cur=[];\n      //$LASTPOS=18000059;//kernel.Scheduler:59\n      _this.next=[];\n    },\n    fiber$main :function _trc_Scheduler_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=18000050;//kernel.Scheduler:50\n      _this.cur=[];\n      //$LASTPOS=18000059;//kernel.Scheduler:59\n      _this.next=[];\n      \n      _thread.retVal=_this;return;\n    },\n    addObj :function _trc_Scheduler_addObj(obj,name,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.newThread(obj,name,args);\n    },\n    fiber$addObj :function _trc_Scheduler_f_addObj(_thread,obj,name,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.newThread(obj,name,args);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    newThread :function _trc_Scheduler_newThread(obj,name,args,options) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var th;\n      \n      //$LASTPOS=18000214;//kernel.Scheduler:214\n      name=name||"main";\n      //$LASTPOS=18000238;//kernel.Scheduler:238\n      args=args||[];\n      //$LASTPOS=18000258;//kernel.Scheduler:258\n      th = Tonyu.thread();\n      //$LASTPOS=18000286;//kernel.Scheduler:286\n      th.apply(obj,name,args);\n      //$LASTPOS=18000316;//kernel.Scheduler:316\n      _this.addToCur(th);\n      return th;\n    },\n    fiber$newThread :function _trc_Scheduler_f_newThread(_thread,obj,name,args,options) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var th;\n      \n      //$LASTPOS=18000214;//kernel.Scheduler:214\n      name=name||"main";\n      //$LASTPOS=18000238;//kernel.Scheduler:238\n      args=args||[];\n      //$LASTPOS=18000258;//kernel.Scheduler:258\n      th = Tonyu.thread();\n      //$LASTPOS=18000286;//kernel.Scheduler:286\n      th.apply(obj,name,args);\n      \n      _thread.enter(function _trc_Scheduler_ent_newThread(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=18000316;//kernel.Scheduler:316\n            _this.fiber$addToCur(_thread, th);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(th);return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    addToCur :function _trc_Scheduler_addToCur(th) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=18000371;//kernel.Scheduler:371\n      _this.cur.push(th);\n    },\n    fiber$addToCur :function _trc_Scheduler_f_addToCur(_thread,th) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=18000371;//kernel.Scheduler:371\n      _this.cur.push(th);\n      \n      _thread.retVal=_this;return;\n    },\n    addToNext :function _trc_Scheduler_addToNext(th) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=18000411;//kernel.Scheduler:411\n      _this.next.push(th);\n    },\n    fiber$addToNext :function _trc_Scheduler_f_addToNext(_thread,th) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=18000411;//kernel.Scheduler:411\n      _this.next.push(th);\n      \n      _thread.retVal=_this;return;\n    },\n    stepsAll :function _trc_Scheduler_stepsAll() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var t;\n      var _it_162;\n      \n      //$LASTPOS=18000449;//kernel.Scheduler:449\n      _it_162=Tonyu.iterator(_this.cur,1);\n      while(_it_162.next()) {\n        t=_it_162[0];\n        \n        //$LASTPOS=18000479;//kernel.Scheduler:479\n        t.steps();\n        //$LASTPOS=18000499;//kernel.Scheduler:499\n        if (t.preempted) {\n          //$LASTPOS=18000576;//kernel.Scheduler:576\n          _this.next.push(t);\n          \n        }\n        \n      }\n      //$LASTPOS=18000613;//kernel.Scheduler:613\n      _this.cur=_this.next;\n      //$LASTPOS=18000628;//kernel.Scheduler:628\n      _this.next=[];\n    },\n    fiber$stepsAll :function _trc_Scheduler_f_stepsAll(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var t;\n      var _it_162;\n      \n      //$LASTPOS=18000449;//kernel.Scheduler:449\n      _it_162=Tonyu.iterator(_this.cur,1);\n      while(_it_162.next()) {\n        t=_it_162[0];\n        \n        //$LASTPOS=18000479;//kernel.Scheduler:479\n        t.steps();\n        //$LASTPOS=18000499;//kernel.Scheduler:499\n        if (t.preempted) {\n          //$LASTPOS=18000576;//kernel.Scheduler:576\n          _this.next.push(t);\n          \n        }\n        \n      }\n      //$LASTPOS=18000613;//kernel.Scheduler:613\n      _this.cur=_this.next;\n      //$LASTPOS=18000628;//kernel.Scheduler:628\n      _this.next=[];\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"addObj":{"nowait":false},"newThread":{"nowait":false},"addToCur":{"nowait":false},"addToNext":{"nowait":false},"stepsAll":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Actor\',\n  shortName: \'Actor\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.BaseActor,\n  includes: [Tonyu.classes.kernel.PlayMod,Tonyu.classes.kernel.ParallelMod],\n  methods: {\n    main :function _trc_Actor_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_Actor_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_Actor_initialize(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=19000105;//kernel.Actor:105\n      Tonyu.classes.kernel.BaseActor.apply( _this, [x,y,p]);\n      //$LASTPOS=19000124;//kernel.Actor:124\n      if (Tonyu.runMode) {\n        //$LASTPOS=19000143;//kernel.Actor:143\n        _this.initSprite();\n      }\n    },\n    initSprite :function _trc_Actor_initSprite() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=19000182;//kernel.Actor:182\n      if (_this.layer&&typeof  _this.layer.add=="function") {\n        //$LASTPOS=19000234;//kernel.Actor:234\n        _this.layer.add(_this);\n        \n      } else {\n        //$LASTPOS=19000272;//kernel.Actor:272\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      //$LASTPOS=19000304;//kernel.Actor:304\n      _this.onAppear();\n    },\n    fiber$initSprite :function _trc_Actor_f_initSprite(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=19000182;//kernel.Actor:182\n      if (_this.layer&&typeof  _this.layer.add=="function") {\n        //$LASTPOS=19000234;//kernel.Actor:234\n        _this.layer.add(_this);\n        \n      } else {\n        //$LASTPOS=19000272;//kernel.Actor:272\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      \n      _thread.enter(function _trc_Actor_ent_initSprite(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=19000304;//kernel.Actor:304\n            _this.fiber$onAppear(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    onAppear :function _trc_Actor_onAppear() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$onAppear :function _trc_Actor_f_onAppear(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"initSprite":{"nowait":false},"onAppear":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.GameScreen\',\n  shortName: \'GameScreen\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_GameScreen_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_GameScreen_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_GameScreen_initialize(opt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=20000113;//kernel.GameScreen:113\n      _this.extend(opt);\n      //$LASTPOS=20000131;//kernel.GameScreen:131\n      _this.resize(_this.width,_this.height);\n      //$LASTPOS=20000159;//kernel.GameScreen:159\n      _this.bgColor="rgb(20,80,180)";\n      //$LASTPOS=20000195;//kernel.GameScreen:195\n      _this.isDrawGrid=Tonyu.globals.$Sprites.isDrawGrid;\n    },\n    resize :function _trc_GameScreen_resize(width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=20000260;//kernel.GameScreen:260\n      _this.width=width;\n      //$LASTPOS=20000283;//kernel.GameScreen:283\n      _this.height=height;\n      //$LASTPOS=20000308;//kernel.GameScreen:308\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n      //$LASTPOS=20000351;//kernel.GameScreen:351\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=20000387;//kernel.GameScreen:387\n      _this.fireEvent("resize",width,height);\n    },\n    fiber$resize :function _trc_GameScreen_f_resize(_thread,width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=20000260;//kernel.GameScreen:260\n      _this.width=width;\n      //$LASTPOS=20000283;//kernel.GameScreen:283\n      _this.height=height;\n      //$LASTPOS=20000308;//kernel.GameScreen:308\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n      //$LASTPOS=20000351;//kernel.GameScreen:351\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=20000387;//kernel.GameScreen:387\n      _this.fireEvent("resize",width,height);\n      \n      _thread.retVal=_this;return;\n    },\n    setBounds :function _trc_GameScreen_setBounds(b) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=20000622;//kernel.GameScreen:622\n      _this.bounds=b;\n    },\n    fiber$setBounds :function _trc_GameScreen_f_setBounds(_thread,b) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=20000622;//kernel.GameScreen:622\n      _this.bounds=b;\n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_GameScreen_draw(cctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b;\n      \n      //$LASTPOS=20000655;//kernel.GameScreen:655\n      b = _this.bounds;\n      //$LASTPOS=20000674;//kernel.GameScreen:674\n      _this.fillCanvas();\n      //$LASTPOS=20000693;//kernel.GameScreen:693\n      _this.sprites.draw(_this.buf[0]);\n      //$LASTPOS=20000720;//kernel.GameScreen:720\n      cctx.drawImage(_this.buf[0],0,0,_this.width,_this.height,b.left,b.top,b.width,b.height);\n    },\n    canvas2buf :function _trc_GameScreen_canvas2buf(point) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b;\n      \n      //$LASTPOS=20000859;//kernel.GameScreen:859\n      b = _this.bounds;\n      //$LASTPOS=20000878;//kernel.GameScreen:878\n      if (! b) {\n        return point;\n      }\n      return {x: (point.x-b.left)/b.width*_this.width,y: (point.y-b.top)/b.height*_this.height};\n    },\n    fiber$canvas2buf :function _trc_GameScreen_f_canvas2buf(_thread,point) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b;\n      \n      //$LASTPOS=20000859;//kernel.GameScreen:859\n      b = _this.bounds;\n      //$LASTPOS=20000878;//kernel.GameScreen:878\n      if (! b) {\n        _thread.retVal=point;return;\n        \n      }\n      _thread.retVal={x: (point.x-b.left)/b.width*_this.width,y: (point.y-b.top)/b.height*_this.height};return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGColor :function _trc_GameScreen_setBGColor(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=20001016;//kernel.GameScreen:1016\n      _this.bgColor=c;\n    },\n    fiber$setBGColor :function _trc_GameScreen_f_setBGColor(_thread,c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=20001016;//kernel.GameScreen:1016\n      _this.bgColor=c;\n      \n      _thread.retVal=_this;return;\n    },\n    fillCanvas :function _trc_GameScreen_fillCanvas() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ctx;\n      \n      //$LASTPOS=20001056;//kernel.GameScreen:1056\n      ctx = _this.buf[0].getContext("2d");\n      //$LASTPOS=20001094;//kernel.GameScreen:1094\n      ctx.save();\n      //$LASTPOS=20001111;//kernel.GameScreen:1111\n      ctx.fillStyle=_this.bgColor;\n      //$LASTPOS=20001139;//kernel.GameScreen:1139\n      ctx.fillRect(0,0,_this.width,_this.height);\n      //$LASTPOS=20001213;//kernel.GameScreen:1213\n      ctx.restore();\n    },\n    fiber$fillCanvas :function _trc_GameScreen_f_fillCanvas(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var ctx;\n      \n      //$LASTPOS=20001056;//kernel.GameScreen:1056\n      ctx = _this.buf[0].getContext("2d");\n      //$LASTPOS=20001094;//kernel.GameScreen:1094\n      ctx.save();\n      //$LASTPOS=20001111;//kernel.GameScreen:1111\n      ctx.fillStyle=_this.bgColor;\n      //$LASTPOS=20001139;//kernel.GameScreen:1139\n      ctx.fillRect(0,0,_this.width,_this.height);\n      //$LASTPOS=20001213;//kernel.GameScreen:1213\n      ctx.restore();\n      \n      _thread.retVal=_this;return;\n    },\n    scrollTo :function _trc_GameScreen_scrollTo(scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=20001265;//kernel.GameScreen:1265\n      _this.sprites.scrollTo(scrollX,scrollY);\n    },\n    fiber$scrollTo :function _trc_GameScreen_f_scrollTo(_thread,scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=20001265;//kernel.GameScreen:1265\n      _this.sprites.scrollTo(scrollX,scrollY);\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"resize":{"nowait":false},"setBounds":{"nowait":false},"draw":{"nowait":true},"canvas2buf":{"nowait":false},"setBGColor":{"nowait":false},"fillCanvas":{"nowait":false},"scrollTo":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Map\',\n  shortName: \'Map\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_Map_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_Map_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_Map_initialize(param) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var j;\n      var i;\n      \n      //$LASTPOS=21000060;//kernel.Map:60\n      _this.sx=0;\n      //$LASTPOS=21000071;//kernel.Map:71\n      _this.sy=0;\n      //$LASTPOS=21000082;//kernel.Map:82\n      Tonyu.classes.kernel.Actor.apply( _this, [param]);\n      //$LASTPOS=21000101;//kernel.Map:101\n      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n      //$LASTPOS=21000173;//kernel.Map:173\n      _this.mapObj=true;\n      //$LASTPOS=21000191;//kernel.Map:191\n      _this.mapTable=[];\n      //$LASTPOS=21000211;//kernel.Map:211\n      _this.mapOnTable=[];\n      //$LASTPOS=21000233;//kernel.Map:233\n      //$LASTPOS=21000237;//kernel.Map:237\n      j = 0;\n      while(j<_this.row) {\n        {\n          //$LASTPOS=21000266;//kernel.Map:266\n          _this.rows=[];\n          //$LASTPOS=21000286;//kernel.Map:286\n          //$LASTPOS=21000290;//kernel.Map:290\n          i = 0;\n          while(i<_this.col) {\n            {\n              //$LASTPOS=21000323;//kernel.Map:323\n              _this.rows.push(- 1);\n            }\n            i++;\n          }\n          //$LASTPOS=21000358;//kernel.Map:358\n          _this.mapTable.push(_this.rows);\n        }\n        j++;\n      }\n      //$LASTPOS=21000391;//kernel.Map:391\n      //$LASTPOS=21000395;//kernel.Map:395\n      j = 0;\n      while(j<_this.row) {\n        {\n          //$LASTPOS=21000424;//kernel.Map:424\n          _this.rows=[];\n          //$LASTPOS=21000444;//kernel.Map:444\n          //$LASTPOS=21000448;//kernel.Map:448\n          i = 0;\n          while(i<_this.col) {\n            {\n              //$LASTPOS=21000481;//kernel.Map:481\n              _this.rows.push(- 1);\n            }\n            i++;\n          }\n          //$LASTPOS=21000516;//kernel.Map:516\n          _this.mapOnTable.push(_this.rows);\n        }\n        j++;\n      }\n      //$LASTPOS=21000616;//kernel.Map:616\n      _this.initMap();\n    },\n    initMap :function _trc_Map_initMap() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var j;\n      \n      //$LASTPOS=21000648;//kernel.Map:648\n      if (! _this.mapData) {\n        return _this;\n      }\n      //$LASTPOS=21000674;//kernel.Map:674\n      //$LASTPOS=21000678;//kernel.Map:678\n      i = 0;\n      while(i<_this.row) {\n        {\n          //$LASTPOS=21000707;//kernel.Map:707\n          //$LASTPOS=21000711;//kernel.Map:711\n          j = 0;\n          while(j<_this.col) {\n            {\n              //$LASTPOS=21000744;//kernel.Map:744\n              _this.set(j,i,_this.mapData[i][j]);\n            }\n            j++;\n          }\n        }\n        i++;\n      }\n      //$LASTPOS=21000791;//kernel.Map:791\n      if (! _this.mapOnData) {\n        return _this;\n      }\n      //$LASTPOS=21000819;//kernel.Map:819\n      //$LASTPOS=21000823;//kernel.Map:823\n      i = 0;\n      while(i<_this.row) {\n        {\n          //$LASTPOS=21000852;//kernel.Map:852\n          //$LASTPOS=21000856;//kernel.Map:856\n          j = 0;\n          while(j<_this.col) {\n            {\n              //$LASTPOS=21000889;//kernel.Map:889\n              _this.setOn(j,i,_this.mapOnData[i][j]);\n            }\n            j++;\n          }\n        }\n        i++;\n      }\n    },\n    fiber$initMap :function _trc_Map_f_initMap(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var j;\n      \n      //$LASTPOS=21000648;//kernel.Map:648\n      if (! _this.mapData) {\n        _thread.retVal=_this;return;\n        \n      }\n      \n      _thread.enter(function _trc_Map_ent_initMap(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=21000674;//kernel.Map:674\n            //$LASTPOS=21000678;//kernel.Map:678\n            i = 0;;\n          case 1:\n            if (!(i<_this.row)) { __pc=5; break; }\n            //$LASTPOS=21000707;//kernel.Map:707\n            //$LASTPOS=21000711;//kernel.Map:711\n            j = 0;;\n          case 2:\n            if (!(j<_this.col)) { __pc=4; break; }\n            //$LASTPOS=21000744;//kernel.Map:744\n            _this.fiber$set(_thread, j, i, _this.mapData[i][j]);\n            __pc=3;return;\n          case 3:\n            \n            j++;\n            __pc=2;break;\n          case 4:\n            \n            i++;\n            __pc=1;break;\n          case 5:\n            \n            //$LASTPOS=21000791;//kernel.Map:791\n            if (!(! _this.mapOnData)) { __pc=6; break; }\n            _thread.exit(_this);return;\n          case 6:\n            \n            //$LASTPOS=21000819;//kernel.Map:819\n            //$LASTPOS=21000823;//kernel.Map:823\n            i = 0;;\n          case 7:\n            if (!(i<_this.row)) { __pc=11; break; }\n            //$LASTPOS=21000852;//kernel.Map:852\n            //$LASTPOS=21000856;//kernel.Map:856\n            j = 0;;\n          case 8:\n            if (!(j<_this.col)) { __pc=10; break; }\n            //$LASTPOS=21000889;//kernel.Map:889\n            _this.fiber$setOn(_thread, j, i, _this.mapOnData[i][j]);\n            __pc=9;return;\n          case 9:\n            \n            j++;\n            __pc=8;break;\n          case 10:\n            \n            i++;\n            __pc=7;break;\n          case 11:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    load :function _trc_Map_load(dataFile) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21000961;//kernel.Map:961\n      _this.baseData=_this.file("../maps/").rel(dataFile).obj();\n      //$LASTPOS=21001013;//kernel.Map:1013\n      if (! _this.baseData) {\n        //$LASTPOS=21001027;//kernel.Map:1027\n        _this.baseData=_this.file(dataFile).obj();\n      }\n      //$LASTPOS=21001063;//kernel.Map:1063\n      _this.mapTable=_this.baseData[0];\n      //$LASTPOS=21001090;//kernel.Map:1090\n      _this.mapData=_this.mapTable;\n      //$LASTPOS=21001113;//kernel.Map:1113\n      _this.row=_this.mapTable.length;\n      //$LASTPOS=21001139;//kernel.Map:1139\n      _this.col=_this.mapTable[0].length;\n      //$LASTPOS=21001168;//kernel.Map:1168\n      _this.mapOnTable=_this.baseData[1];\n      //$LASTPOS=21001197;//kernel.Map:1197\n      _this.mapOnData=_this.mapOnTable;\n      //$LASTPOS=21001224;//kernel.Map:1224\n      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n      //$LASTPOS=21001296;//kernel.Map:1296\n      _this.initMap();\n    },\n    fiber$load :function _trc_Map_f_load(_thread,dataFile) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=21000961;//kernel.Map:961\n      _this.baseData=_this.file("../maps/").rel(dataFile).obj();\n      //$LASTPOS=21001013;//kernel.Map:1013\n      if (! _this.baseData) {\n        //$LASTPOS=21001027;//kernel.Map:1027\n        _this.baseData=_this.file(dataFile).obj();\n      }\n      //$LASTPOS=21001063;//kernel.Map:1063\n      _this.mapTable=_this.baseData[0];\n      //$LASTPOS=21001090;//kernel.Map:1090\n      _this.mapData=_this.mapTable;\n      //$LASTPOS=21001113;//kernel.Map:1113\n      _this.row=_this.mapTable.length;\n      //$LASTPOS=21001139;//kernel.Map:1139\n      _this.col=_this.mapTable[0].length;\n      //$LASTPOS=21001168;//kernel.Map:1168\n      _this.mapOnTable=_this.baseData[1];\n      //$LASTPOS=21001197;//kernel.Map:1197\n      _this.mapOnData=_this.mapOnTable;\n      //$LASTPOS=21001224;//kernel.Map:1224\n      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n      \n      _thread.enter(function _trc_Map_ent_load(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=21001296;//kernel.Map:1296\n            _this.fiber$initMap(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    set :function _trc_Map_set(setCol,setRow,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21001339;//kernel.Map:1339\n      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n        return _this;\n      }\n      //$LASTPOS=21001407;//kernel.Map:1407\n      _this.mapTable[setRow][setCol]=p;\n      //$LASTPOS=21001478;//kernel.Map:1478\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=21001512;//kernel.Map:1512\n      p=Math.floor(p);\n      //$LASTPOS=21001534;//kernel.Map:1534\n      _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n      //$LASTPOS=21001572;//kernel.Map:1572\n      if (! _this.pImg) {\n        //$LASTPOS=21001594;//kernel.Map:1594\n        _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n        return _this;\n        \n      }\n      //$LASTPOS=21001695;//kernel.Map:1695\n      _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      //$LASTPOS=21001772;//kernel.Map:1772\n      _this.ctx.save();\n      //$LASTPOS=21001789;//kernel.Map:1789\n      _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      //$LASTPOS=21001933;//kernel.Map:1933\n      _this.ctx.restore();\n    },\n    fiber$set :function _trc_Map_f_set(_thread,setCol,setRow,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=21001339;//kernel.Map:1339\n      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=21001407;//kernel.Map:1407\n      _this.mapTable[setRow][setCol]=p;\n      //$LASTPOS=21001478;//kernel.Map:1478\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=21001512;//kernel.Map:1512\n      p=Math.floor(p);\n      //$LASTPOS=21001534;//kernel.Map:1534\n      _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n      //$LASTPOS=21001572;//kernel.Map:1572\n      if (! _this.pImg) {\n        //$LASTPOS=21001594;//kernel.Map:1594\n        _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n        _thread.retVal=_this;return;\n        \n        \n      }\n      //$LASTPOS=21001695;//kernel.Map:1695\n      _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      //$LASTPOS=21001772;//kernel.Map:1772\n      _this.ctx.save();\n      //$LASTPOS=21001789;//kernel.Map:1789\n      _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      //$LASTPOS=21001933;//kernel.Map:1933\n      _this.ctx.restore();\n      \n      _thread.retVal=_this;return;\n    },\n    setOn :function _trc_Map_setOn(setCol,setRow,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21001982;//kernel.Map:1982\n      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n        return _this;\n      }\n      //$LASTPOS=21002050;//kernel.Map:2050\n      _this.set(setCol,setRow,_this.mapTable[setRow][setCol]);\n      //$LASTPOS=21002100;//kernel.Map:2100\n      _this.mapOnTable[setRow][setCol]=p;\n      //$LASTPOS=21002135;//kernel.Map:2135\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=21002169;//kernel.Map:2169\n      p=Math.floor(p);\n      //$LASTPOS=21002191;//kernel.Map:2191\n      _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n      //$LASTPOS=21002229;//kernel.Map:2229\n      if (! _this.pImg) {\n        return _this;\n      }\n      //$LASTPOS=21002253;//kernel.Map:2253\n      _this.ctx.save();\n      //$LASTPOS=21002270;//kernel.Map:2270\n      _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n      //$LASTPOS=21002414;//kernel.Map:2414\n      _this.ctx.restore();\n    },\n    fiber$setOn :function _trc_Map_f_setOn(_thread,setCol,setRow,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=21001982;//kernel.Map:1982\n      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {\n        _thread.retVal=_this;return;\n        \n      }\n      \n      _thread.enter(function _trc_Map_ent_setOn(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=21002050;//kernel.Map:2050\n            _this.fiber$set(_thread, setCol, setRow, _this.mapTable[setRow][setCol]);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=21002100;//kernel.Map:2100\n            _this.mapOnTable[setRow][setCol]=p;\n            //$LASTPOS=21002135;//kernel.Map:2135\n            _this.ctx=_this.buf[0].getContext("2d");\n            //$LASTPOS=21002169;//kernel.Map:2169\n            p=Math.floor(p);\n            //$LASTPOS=21002191;//kernel.Map:2191\n            _this.pImg=Tonyu.globals.$Sprites.getImageList()[p];\n            //$LASTPOS=21002229;//kernel.Map:2229\n            if (!(! _this.pImg)) { __pc=2; break; }\n            _thread.exit(_this);return;\n          case 2:\n            \n            //$LASTPOS=21002253;//kernel.Map:2253\n            _this.ctx.save();\n            //$LASTPOS=21002270;//kernel.Map:2270\n            _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);\n            //$LASTPOS=21002414;//kernel.Map:2414\n            _this.ctx.restore();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    setOnAt :function _trc_Map_setOnAt(setX,setY,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21002461;//kernel.Map:2461\n      _this.setOn(Math.floor(setX/_this.chipWidth),Math.floor(setY/_this.chipHeight),p);\n    },\n    fiber$setOnAt :function _trc_Map_f_setOnAt(_thread,setX,setY,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Map_ent_setOnAt(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=21002461;//kernel.Map:2461\n            _this.fiber$setOn(_thread, Math.floor(setX/_this.chipWidth), Math.floor(setY/_this.chipHeight), p);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    setAt :function _trc_Map_setAt(setX,setY,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21002556;//kernel.Map:2556\n      _this.set(Math.floor(setX/_this.chipWidth),Math.floor(setY/_this.chipHeight),p);\n    },\n    fiber$setAt :function _trc_Map_f_setAt(_thread,setX,setY,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Map_ent_setAt(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=21002556;//kernel.Map:2556\n            _this.fiber$set(_thread, Math.floor(setX/_this.chipWidth), Math.floor(setY/_this.chipHeight), p);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    get :function _trc_Map_get(getCol,getRow) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21002649;//kernel.Map:2649\n      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n        return _this.mapTable[getRow][getCol];\n      }\n      return - 1;\n    },\n    fiber$get :function _trc_Map_f_get(_thread,getCol,getRow) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=21002649;//kernel.Map:2649\n      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n        _thread.retVal=_this.mapTable[getRow][getCol];return;\n        \n      }\n      _thread.retVal=- 1;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getAt :function _trc_Map_getAt(getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.get(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));\n    },\n    fiber$getAt :function _trc_Map_f_getAt(_thread,getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.get(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getOn :function _trc_Map_getOn(getCol,getRow) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21002881;//kernel.Map:2881\n      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n        return _this.mapOnTable[getRow][getCol];\n      }\n      return - 1;\n    },\n    fiber$getOn :function _trc_Map_f_getOn(_thread,getCol,getRow) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=21002881;//kernel.Map:2881\n      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {\n        _thread.retVal=_this.mapOnTable[getRow][getCol];return;\n        \n      }\n      _thread.retVal=- 1;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getOnAt :function _trc_Map_getOnAt(getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.getOn(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));\n    },\n    fiber$getOnAt :function _trc_Map_f_getOnAt(_thread,getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.getOn(Math.floor(getX/_this.chipWidth),Math.floor(getY/_this.chipHeight));return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    scrollTo :function _trc_Map_scrollTo(scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21003124;//kernel.Map:3124\n      _this.sx=- scrollX;\n      //$LASTPOS=21003142;//kernel.Map:3142\n      _this.sy=- scrollY;\n    },\n    fiber$scrollTo :function _trc_Map_f_scrollTo(_thread,scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=21003124;//kernel.Map:3124\n      _this.sx=- scrollX;\n      //$LASTPOS=21003142;//kernel.Map:3142\n      _this.sy=- scrollY;\n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_Map_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=21003177;//kernel.Map:3177\n      _this.pImg=_this.buf[0];\n      //$LASTPOS=21003195;//kernel.Map:3195\n      ctx.save();\n      //$LASTPOS=21003212;//kernel.Map:3212\n      ctx.drawImage(_this.pImg,0,0,_this.col*_this.chipWidth,_this.row*_this.chipHeight,_this.sx,_this.sy,_this.col*_this.chipWidth,_this.row*_this.chipHeight);\n      //$LASTPOS=21003324;//kernel.Map:3324\n      ctx.restore();\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"initMap":{"nowait":false},"load":{"nowait":false},"set":{"nowait":false},"setOn":{"nowait":false},"setOnAt":{"nowait":false},"setAt":{"nowait":false},"get":{"nowait":false},"getAt":{"nowait":false},"getOn":{"nowait":false},"getOnAt":{"nowait":false},"scrollTo":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Panel\',\n  shortName: \'Panel\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_Panel_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_Panel_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_Panel_initialize(opt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22000072;//kernel.Panel:72\n      Tonyu.classes.kernel.Actor.apply( _this, [opt]);\n      //$LASTPOS=22000089;//kernel.Panel:89\n      _this.width=_this.width;\n      //$LASTPOS=22000112;//kernel.Panel:112\n      _this.height=_this.height;\n      //$LASTPOS=22000137;//kernel.Panel:137\n      if (_this.align==null) {\n        //$LASTPOS=22000153;//kernel.Panel:153\n        _this.align="center";\n      }\n      //$LASTPOS=22000174;//kernel.Panel:174\n      if (_this.alpha==null) {\n        //$LASTPOS=22000190;//kernel.Panel:190\n        _this.alpha=255;\n      }\n      //$LASTPOS=22000206;//kernel.Panel:206\n      if (_this._drawn==null) {\n        //$LASTPOS=22000223;//kernel.Panel:223\n        _this._drawn=false;\n      }\n      //$LASTPOS=22000242;//kernel.Panel:242\n      _this.buf=$("<canvas>").attr({width: _this.width,height: _this.height});\n    },\n    setPanel :function _trc_Panel_setPanel(width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22000314;//kernel.Panel:314\n      _this.width=width;\n      //$LASTPOS=22000337;//kernel.Panel:337\n      _this.height=height;\n      //$LASTPOS=22000362;//kernel.Panel:362\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n    },\n    fiber$setPanel :function _trc_Panel_f_setPanel(_thread,width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=22000314;//kernel.Panel:314\n      _this.width=width;\n      //$LASTPOS=22000337;//kernel.Panel:337\n      _this.height=height;\n      //$LASTPOS=22000362;//kernel.Panel:362\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n      \n      _thread.retVal=_this;return;\n    },\n    resize :function _trc_Panel_resize(width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22000432;//kernel.Panel:432\n      _this.setPanel(width,height);\n    },\n    fiber$resize :function _trc_Panel_f_resize(_thread,width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_resize(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=22000432;//kernel.Panel:432\n            _this.fiber$setPanel(_thread, width, height);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    getContext :function _trc_Panel_getContext() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22000480;//kernel.Panel:480\n      _this._drawn=true;\n      return _this.buf[0].getContext("2d");\n    },\n    fiber$getContext :function _trc_Panel_f_getContext(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=22000480;//kernel.Panel:480\n      _this._drawn=true;\n      _thread.retVal=_this.buf[0].getContext("2d");return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setFillStyle :function _trc_Panel_setFillStyle(color) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22000561;//kernel.Panel:561\n      _this.fillStyle=color;\n    },\n    fiber$setFillStyle :function _trc_Panel_f_setFillStyle(_thread,color) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=22000561;//kernel.Panel:561\n      _this.fillStyle=color;\n      \n      _thread.retVal=_this;return;\n    },\n    fillRect :function _trc_Panel_fillRect(x,y,rectWidth,rectHeight) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22000629;//kernel.Panel:629\n      _this.ctx=_this.getContext();\n      //$LASTPOS=22000652;//kernel.Panel:652\n      _this.ctx.save();\n      //$LASTPOS=22000719;//kernel.Panel:719\n      _this.ctx.fillStyle=_this.fillStyle;\n      //$LASTPOS=22000749;//kernel.Panel:749\n      _this.ctx.fillRect(x,y,rectWidth,rectHeight);\n      //$LASTPOS=22000794;//kernel.Panel:794\n      _this.ctx.restore();\n    },\n    fiber$fillRect :function _trc_Panel_f_fillRect(_thread,x,y,rectWidth,rectHeight) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_fillRect(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=22000629;//kernel.Panel:629\n            _this.fiber$getContext(_thread);\n            __pc=1;return;\n          case 1:\n            _this.ctx=_thread.retVal;\n            \n            //$LASTPOS=22000652;//kernel.Panel:652\n            _this.ctx.save();\n            //$LASTPOS=22000719;//kernel.Panel:719\n            _this.ctx.fillStyle=_this.fillStyle;\n            //$LASTPOS=22000749;//kernel.Panel:749\n            _this.ctx.fillRect(x,y,rectWidth,rectHeight);\n            //$LASTPOS=22000794;//kernel.Panel:794\n            _this.ctx.restore();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    fillText :function _trc_Panel_fillText(text,x,y,size,align) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22000850;//kernel.Panel:850\n      _this.ctx=_this.getContext();\n      //$LASTPOS=22000873;//kernel.Panel:873\n      _this.ctx.save();\n      //$LASTPOS=22000940;//kernel.Panel:940\n      _this.ctx.textAlign=align;\n      //$LASTPOS=22000968;//kernel.Panel:968\n      _this.ctx.fillStyle=_this.fillStyle;\n      //$LASTPOS=22000998;//kernel.Panel:998\n      _this.ctx.font=size+"px \'Courier New\'";\n      //$LASTPOS=22001037;//kernel.Panel:1037\n      _this.ctx.fillText(text,x,y);\n      //$LASTPOS=22001066;//kernel.Panel:1066\n      _this.ctx.restore();\n    },\n    fiber$fillText :function _trc_Panel_f_fillText(_thread,text,x,y,size,align) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_fillText(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=22000850;//kernel.Panel:850\n            _this.fiber$getContext(_thread);\n            __pc=1;return;\n          case 1:\n            _this.ctx=_thread.retVal;\n            \n            //$LASTPOS=22000873;//kernel.Panel:873\n            _this.ctx.save();\n            //$LASTPOS=22000940;//kernel.Panel:940\n            _this.ctx.textAlign=align;\n            //$LASTPOS=22000968;//kernel.Panel:968\n            _this.ctx.fillStyle=_this.fillStyle;\n            //$LASTPOS=22000998;//kernel.Panel:998\n            _this.ctx.font=size+"px \'Courier New\'";\n            //$LASTPOS=22001037;//kernel.Panel:1037\n            _this.ctx.fillText(text,x,y);\n            //$LASTPOS=22001066;//kernel.Panel:1066\n            _this.ctx.restore();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    clearRect :function _trc_Panel_clearRect(clearX,clearY,clearW,clearH) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22001131;//kernel.Panel:1131\n      _this.ctx=_this.getContext();\n      //$LASTPOS=22001154;//kernel.Panel:1154\n      _this.ctx.save();\n      //$LASTPOS=22001171;//kernel.Panel:1171\n      _this.ctx.clearRect(clearX,clearY,clearW,clearH);\n      //$LASTPOS=22001220;//kernel.Panel:1220\n      _this.ctx.restore();\n    },\n    fiber$clearRect :function _trc_Panel_f_clearRect(_thread,clearX,clearY,clearW,clearH) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_clearRect(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=22001131;//kernel.Panel:1131\n            _this.fiber$getContext(_thread);\n            __pc=1;return;\n          case 1:\n            _this.ctx=_thread.retVal;\n            \n            //$LASTPOS=22001154;//kernel.Panel:1154\n            _this.ctx.save();\n            //$LASTPOS=22001171;//kernel.Panel:1171\n            _this.ctx.clearRect(clearX,clearY,clearW,clearH);\n            //$LASTPOS=22001220;//kernel.Panel:1220\n            _this.ctx.restore();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    getPixel :function _trc_Panel_getPixel(getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22001266;//kernel.Panel:1266\n      if (typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY)) {\n        //$LASTPOS=22001365;//kernel.Panel:1365\n        _this.ctx=_this.getContext();\n        //$LASTPOS=22001392;//kernel.Panel:1392\n        _this.imagedata=_this.ctx.getImageData(getX,getY,1,1);\n        //$LASTPOS=22001444;//kernel.Panel:1444\n        _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];\n        \n      } else {\n        //$LASTPOS=22001584;//kernel.Panel:1584\n        _this.colordata=[0,0,0,0];\n        \n      }\n      return (_this.colordata);\n    },\n    fiber$getPixel :function _trc_Panel_f_getPixel(_thread,getX,getY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_getPixel(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=22001266;//kernel.Panel:1266\n            if (!(typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY))) { __pc=2; break; }\n            //$LASTPOS=22001365;//kernel.Panel:1365\n            _this.fiber$getContext(_thread);\n            __pc=1;return;\n          case 1:\n            _this.ctx=_thread.retVal;\n            \n            //$LASTPOS=22001392;//kernel.Panel:1392\n            _this.imagedata=_this.ctx.getImageData(getX,getY,1,1);\n            //$LASTPOS=22001444;//kernel.Panel:1444\n            _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];\n            __pc=3;break;\n          case 2:\n            {\n              //$LASTPOS=22001584;//kernel.Panel:1584\n              _this.colordata=[0,0,0,0];\n            }\n          case 3:\n            \n            _thread.exit((_this.colordata));return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    scroll :function _trc_Panel_scroll(scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22001671;//kernel.Panel:1671\n      _this.ctx=_this.getContext();\n      //$LASTPOS=22001694;//kernel.Panel:1694\n      _this.ctx.save();\n      //$LASTPOS=22001711;//kernel.Panel:1711\n      _this.imagedata=_this.ctx.getImageData(0,0,_this.width,_this.height);\n      //$LASTPOS=22001772;//kernel.Panel:1772\n      _this.clearRect(0,0,_this.width,_this.height);\n      //$LASTPOS=22001806;//kernel.Panel:1806\n      _this.ctx.putImageData(_this.imagedata,- scrollX,- scrollY);\n      //$LASTPOS=22001858;//kernel.Panel:1858\n      _this.ctx.restore();\n    },\n    fiber$scroll :function _trc_Panel_f_scroll(_thread,scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Panel_ent_scroll(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=22001671;//kernel.Panel:1671\n            _this.fiber$getContext(_thread);\n            __pc=1;return;\n          case 1:\n            _this.ctx=_thread.retVal;\n            \n            //$LASTPOS=22001694;//kernel.Panel:1694\n            _this.ctx.save();\n            //$LASTPOS=22001711;//kernel.Panel:1711\n            _this.imagedata=_this.ctx.getImageData(0,0,_this.width,_this.height);\n            //$LASTPOS=22001772;//kernel.Panel:1772\n            _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=22001806;//kernel.Panel:1806\n            _this.ctx.putImageData(_this.imagedata,- scrollX,- scrollY);\n            //$LASTPOS=22001858;//kernel.Panel:1858\n            _this.ctx.restore();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    draw :function _trc_Panel_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=22001894;//kernel.Panel:1894\n      if (_this._drawn) {\n        //$LASTPOS=22001915;//kernel.Panel:1915\n        _this.pImg=_this.buf[0];\n        //$LASTPOS=22001937;//kernel.Panel:1937\n        ctx.save();\n        //$LASTPOS=22001958;//kernel.Panel:1958\n        if (_this.align=="left") {\n          //$LASTPOS=22001990;//kernel.Panel:1990\n          ctx.translate(_this.x+_this.width/2,_this.y+_this.height/2);\n          \n        } else {\n          //$LASTPOS=22002042;//kernel.Panel:2042\n          if (_this.align=="center") {\n            //$LASTPOS=22002076;//kernel.Panel:2076\n            ctx.translate(_this.x,_this.y);\n            \n          } else {\n            //$LASTPOS=22002111;//kernel.Panel:2111\n            if (_this.align=="right") {\n              //$LASTPOS=22002144;//kernel.Panel:2144\n              ctx.translate(_this.x-_this.width/2,_this.y-_this.height/2);\n              \n            }\n          }\n        }\n        //$LASTPOS=22002201;//kernel.Panel:2201\n        if (_this.rotation!=0) {\n          //$LASTPOS=22002236;//kernel.Panel:2236\n          ctx.rotate(_this.rotation/180*Math.PI);\n          \n        } else {\n          //$LASTPOS=22002304;//kernel.Panel:2304\n          ctx.rotate(_this.rotate/180*Math.PI);\n          \n        }\n        //$LASTPOS=22002361;//kernel.Panel:2361\n        ctx.globalAlpha=_this.alpha/255;\n        //$LASTPOS=22002402;//kernel.Panel:2402\n        ctx.drawImage(_this.pImg,0,0,_this.width,_this.height,- _this.width/2,- _this.height/2,_this.width,_this.height);\n        //$LASTPOS=22002506;//kernel.Panel:2506\n        ctx.restore();\n        \n      }\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"setPanel":{"nowait":false},"resize":{"nowait":false},"getContext":{"nowait":false},"setFillStyle":{"nowait":false},"fillRect":{"nowait":false},"fillText":{"nowait":false},"clearRect":{"nowait":false},"getPixel":{"nowait":false},"scroll":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.ScaledCanvas\',\n  shortName: \'ScaledCanvas\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_ScaledCanvas_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_ScaledCanvas_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_ScaledCanvas_initialize(opt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=23000095;//kernel.ScaledCanvas:95\n      _this.extend(opt);\n      //$LASTPOS=23000142;//kernel.ScaledCanvas:142\n      _this.resize(_this.width,_this.height);\n      //$LASTPOS=23000170;//kernel.ScaledCanvas:170\n      _this.cw=_this.canvas.width();\n      //$LASTPOS=23000194;//kernel.ScaledCanvas:194\n      _this.ch=_this.canvas.height();\n      //$LASTPOS=23000219;//kernel.ScaledCanvas:219\n      _this.cctx=_this.canvas[0].getContext("2d");\n      //$LASTPOS=23000257;//kernel.ScaledCanvas:257\n      _this.color="rgb(20,80,180)";\n      //$LASTPOS=23000291;//kernel.ScaledCanvas:291\n      _this.sx=0;\n      //$LASTPOS=23000302;//kernel.ScaledCanvas:302\n      _this.sy=0;\n      //$LASTPOS=23000313;//kernel.ScaledCanvas:313\n      _this.isDrawGrid=Tonyu.globals.$Sprites.isDrawGrid;\n    },\n    resize :function _trc_ScaledCanvas_resize(width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=23000378;//kernel.ScaledCanvas:378\n      _this.width=width;\n      //$LASTPOS=23000401;//kernel.ScaledCanvas:401\n      _this.height=height;\n      //$LASTPOS=23000426;//kernel.ScaledCanvas:426\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n      //$LASTPOS=23000469;//kernel.ScaledCanvas:469\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=23000505;//kernel.ScaledCanvas:505\n      Tonyu.globals.$screenWidth=width;\n      //$LASTPOS=23000530;//kernel.ScaledCanvas:530\n      Tonyu.globals.$screenHeight=height;\n      //$LASTPOS=23000557;//kernel.ScaledCanvas:557\n      if (Tonyu.globals.$panel) {\n        //$LASTPOS=23000578;//kernel.ScaledCanvas:578\n        Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);\n        \n      }\n    },\n    fiber$resize :function _trc_ScaledCanvas_f_resize(_thread,width,height) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=23000378;//kernel.ScaledCanvas:378\n      _this.width=width;\n      //$LASTPOS=23000401;//kernel.ScaledCanvas:401\n      _this.height=height;\n      //$LASTPOS=23000426;//kernel.ScaledCanvas:426\n      _this.buf=$("<canvas>").attr({width: width,height: height});\n      //$LASTPOS=23000469;//kernel.ScaledCanvas:469\n      _this.ctx=_this.buf[0].getContext("2d");\n      //$LASTPOS=23000505;//kernel.ScaledCanvas:505\n      Tonyu.globals.$screenWidth=width;\n      //$LASTPOS=23000530;//kernel.ScaledCanvas:530\n      Tonyu.globals.$screenHeight=height;\n      //$LASTPOS=23000557;//kernel.ScaledCanvas:557\n      if (Tonyu.globals.$panel) {\n        //$LASTPOS=23000578;//kernel.ScaledCanvas:578\n        Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);\n        \n      }\n      \n      _thread.retVal=_this;return;\n    },\n    shouldDraw1x1 :function _trc_ScaledCanvas_shouldDraw1x1(srcw,srch,dstw,dsth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var larger;\n      var smaller;\n      \n      //$LASTPOS=23000712;//kernel.ScaledCanvas:712\n      larger = 200;\n      //$LASTPOS=23000733;//kernel.ScaledCanvas:733\n      smaller = 5;\n      return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;\n    },\n    fiber$shouldDraw1x1 :function _trc_ScaledCanvas_f_shouldDraw1x1(_thread,srcw,srch,dstw,dsth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var larger;\n      var smaller;\n      \n      //$LASTPOS=23000712;//kernel.ScaledCanvas:712\n      larger = 200;\n      //$LASTPOS=23000733;//kernel.ScaledCanvas:733\n      smaller = 5;\n      _thread.retVal=srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_ScaledCanvas_draw() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var calcw;\n      var calch;\n      var marginw;\n      var marginh;\n      \n      //$LASTPOS=23000868;//kernel.ScaledCanvas:868\n      _this.cw=_this.canvas.width();\n      //$LASTPOS=23000892;//kernel.ScaledCanvas:892\n      _this.ch=_this.canvas.height();\n      //$LASTPOS=23000917;//kernel.ScaledCanvas:917\n      calcw = _this.ch/_this.height*_this.width;\n      //$LASTPOS=23000961;//kernel.ScaledCanvas:961\n      calch = _this.cw/_this.width*_this.height;\n      //$LASTPOS=23001005;//kernel.ScaledCanvas:1005\n      if (calch>_this.ch) {\n        //$LASTPOS=23001019;//kernel.ScaledCanvas:1019\n        calch=_this.ch;\n      }\n      //$LASTPOS=23001034;//kernel.ScaledCanvas:1034\n      if (calcw>_this.cw) {\n        //$LASTPOS=23001048;//kernel.ScaledCanvas:1048\n        calcw=_this.cw;\n      }\n      //$LASTPOS=23001063;//kernel.ScaledCanvas:1063\n      _this.cctx.clearRect(0,0,_this.cw,_this.ch);\n      //$LASTPOS=23001095;//kernel.ScaledCanvas:1095\n      if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n        //$LASTPOS=23001151;//kernel.ScaledCanvas:1151\n        calcw=_this.width;\n        //$LASTPOS=23001163;//kernel.ScaledCanvas:1163\n        calch=_this.height;\n        \n      }\n      //$LASTPOS=23001189;//kernel.ScaledCanvas:1189\n      marginw = Math.floor((_this.cw-calcw)/2);\n      //$LASTPOS=23001232;//kernel.ScaledCanvas:1232\n      marginh = Math.floor((_this.ch-calch)/2);\n      //$LASTPOS=23001275;//kernel.ScaledCanvas:1275\n      _this.cctx.drawImage(_this.buf[0],0,0,_this.width,_this.height,marginw,marginh,calcw,calch);\n    },\n    canvas2buf :function _trc_ScaledCanvas_canvas2buf(point) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var calcw;\n      var calch;\n      var marginw;\n      var marginh;\n      \n      //$LASTPOS=23001390;//kernel.ScaledCanvas:1390\n      calcw = _this.ch/_this.height*_this.width;\n      //$LASTPOS=23001434;//kernel.ScaledCanvas:1434\n      calch = _this.cw/_this.width*_this.height;\n      //$LASTPOS=23001478;//kernel.ScaledCanvas:1478\n      if (calch>_this.ch) {\n        //$LASTPOS=23001492;//kernel.ScaledCanvas:1492\n        calch=_this.ch;\n      }\n      //$LASTPOS=23001507;//kernel.ScaledCanvas:1507\n      if (calcw>_this.cw) {\n        //$LASTPOS=23001521;//kernel.ScaledCanvas:1521\n        calcw=_this.cw;\n      }\n      //$LASTPOS=23001536;//kernel.ScaledCanvas:1536\n      if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n        //$LASTPOS=23001592;//kernel.ScaledCanvas:1592\n        calcw=_this.width;\n        //$LASTPOS=23001604;//kernel.ScaledCanvas:1604\n        calch=_this.height;\n        \n      }\n      //$LASTPOS=23001630;//kernel.ScaledCanvas:1630\n      marginw = Math.floor((_this.cw-calcw)/2);\n      //$LASTPOS=23001673;//kernel.ScaledCanvas:1673\n      marginh = Math.floor((_this.ch-calch)/2);\n      //$LASTPOS=23001769;//kernel.ScaledCanvas:1769\n      _this._ret="("+point.x+"-"+marginw+")/"+calcw+"*"+_this.width+",";\n      return {x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};\n    },\n    fiber$canvas2buf :function _trc_ScaledCanvas_f_canvas2buf(_thread,point) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var calcw;\n      var calch;\n      var marginw;\n      var marginh;\n      \n      //$LASTPOS=23001390;//kernel.ScaledCanvas:1390\n      calcw = _this.ch/_this.height*_this.width;\n      //$LASTPOS=23001434;//kernel.ScaledCanvas:1434\n      calch = _this.cw/_this.width*_this.height;\n      //$LASTPOS=23001478;//kernel.ScaledCanvas:1478\n      if (calch>_this.ch) {\n        //$LASTPOS=23001492;//kernel.ScaledCanvas:1492\n        calch=_this.ch;\n      }\n      //$LASTPOS=23001507;//kernel.ScaledCanvas:1507\n      if (calcw>_this.cw) {\n        //$LASTPOS=23001521;//kernel.ScaledCanvas:1521\n        calcw=_this.cw;\n      }\n      //$LASTPOS=23001536;//kernel.ScaledCanvas:1536\n      if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {\n        //$LASTPOS=23001592;//kernel.ScaledCanvas:1592\n        calcw=_this.width;\n        //$LASTPOS=23001604;//kernel.ScaledCanvas:1604\n        calch=_this.height;\n        \n      }\n      //$LASTPOS=23001630;//kernel.ScaledCanvas:1630\n      marginw = Math.floor((_this.cw-calcw)/2);\n      //$LASTPOS=23001673;//kernel.ScaledCanvas:1673\n      marginh = Math.floor((_this.ch-calch)/2);\n      //$LASTPOS=23001769;//kernel.ScaledCanvas:1769\n      _this._ret="("+point.x+"-"+marginw+")/"+calcw+"*"+_this.width+",";\n      _thread.retVal={x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGColor :function _trc_ScaledCanvas_setBGColor(color) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=23001942;//kernel.ScaledCanvas:1942\n      _this.color=color;\n    },\n    fiber$setBGColor :function _trc_ScaledCanvas_f_setBGColor(_thread,color) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=23001942;//kernel.ScaledCanvas:1942\n      _this.color=color;\n      \n      _thread.retVal=_this;return;\n    },\n    fillCanvas :function _trc_ScaledCanvas_fillCanvas(cv) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ctx;\n      \n      //$LASTPOS=23001986;//kernel.ScaledCanvas:1986\n      ctx = cv.getContext("2d");\n      //$LASTPOS=23002020;//kernel.ScaledCanvas:2020\n      ctx.save();\n      //$LASTPOS=23002037;//kernel.ScaledCanvas:2037\n      ctx.fillStyle=Tonyu.globals.$Screen.color;\n      //$LASTPOS=23002071;//kernel.ScaledCanvas:2071\n      ctx.fillStyle=Tonyu.bindFunc(_this,_this.color);\n      //$LASTPOS=23002097;//kernel.ScaledCanvas:2097\n      ctx.fillRect(0,0,cv.width,cv.height);\n      //$LASTPOS=23002140;//kernel.ScaledCanvas:2140\n      if (_this.isDrawGrid) {\n        //$LASTPOS=23002156;//kernel.ScaledCanvas:2156\n        _this.drawGrid(cv);\n      }\n      //$LASTPOS=23002175;//kernel.ScaledCanvas:2175\n      ctx.restore();\n    },\n    fiber$fillCanvas :function _trc_ScaledCanvas_f_fillCanvas(_thread,cv) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var ctx;\n      \n      //$LASTPOS=23001986;//kernel.ScaledCanvas:1986\n      ctx = cv.getContext("2d");\n      //$LASTPOS=23002020;//kernel.ScaledCanvas:2020\n      ctx.save();\n      //$LASTPOS=23002037;//kernel.ScaledCanvas:2037\n      ctx.fillStyle=Tonyu.globals.$Screen.color;\n      //$LASTPOS=23002071;//kernel.ScaledCanvas:2071\n      ctx.fillStyle=Tonyu.bindFunc(_this,_this.color);\n      //$LASTPOS=23002097;//kernel.ScaledCanvas:2097\n      ctx.fillRect(0,0,cv.width,cv.height);\n      //$LASTPOS=23002140;//kernel.ScaledCanvas:2140\n      if (_this.isDrawGrid) {\n        //$LASTPOS=23002156;//kernel.ScaledCanvas:2156\n        _this.drawGrid(cv);\n      }\n      //$LASTPOS=23002175;//kernel.ScaledCanvas:2175\n      ctx.restore();\n      \n      _thread.retVal=_this;return;\n    },\n    scrollTo :function _trc_ScaledCanvas_scrollTo(scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=23002519;//kernel.ScaledCanvas:2519\n      Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);\n    },\n    fiber$scrollTo :function _trc_ScaledCanvas_f_scrollTo(_thread,scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=23002519;//kernel.ScaledCanvas:2519\n      Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"resize":{"nowait":false},"shouldDraw1x1":{"nowait":false},"draw":{"nowait":true},"canvas2buf":{"nowait":false},"setBGColor":{"nowait":false},"fillCanvas":{"nowait":false},"scrollTo":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Sprites\',\n  shortName: \'Sprites\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_Sprites_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_Sprites_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_Sprites_initialize() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24000045;//kernel.Sprites:45\n      _this.sprites=[];\n      //$LASTPOS=24000062;//kernel.Sprites:62\n      _this.imageList=[];\n      //$LASTPOS=24000081;//kernel.Sprites:81\n      _this.hitWatchers=[];\n      //$LASTPOS=24000102;//kernel.Sprites:102\n      _this.isDrawGrid=Tonyu.noviceMode;\n      //$LASTPOS=24000136;//kernel.Sprites:136\n      _this.sx=0;\n      //$LASTPOS=24000147;//kernel.Sprites:147\n      _this.sy=0;\n      //$LASTPOS=24000158;//kernel.Sprites:158\n      _this.objId=0;\n    },\n    add :function _trc_Sprites_add(s) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24000194;//kernel.Sprites:194\n      if (s.__addedToSprites) {\n        return _this;\n      }\n      //$LASTPOS=24000231;//kernel.Sprites:231\n      _this.sprites.push(s);\n      //$LASTPOS=24000253;//kernel.Sprites:253\n      if (s.__genId==null) {\n        //$LASTPOS=24000283;//kernel.Sprites:283\n        s.__genId=_this.objId;\n        //$LASTPOS=24000309;//kernel.Sprites:309\n        _this.objId++;\n        \n      }\n      //$LASTPOS=24000330;//kernel.Sprites:330\n      s.__addedToSprites=_this;\n      return s;\n    },\n    fiber$add :function _trc_Sprites_f_add(_thread,s) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=24000194;//kernel.Sprites:194\n      if (s.__addedToSprites) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=24000231;//kernel.Sprites:231\n      _this.sprites.push(s);\n      //$LASTPOS=24000253;//kernel.Sprites:253\n      if (s.__genId==null) {\n        //$LASTPOS=24000283;//kernel.Sprites:283\n        s.__genId=_this.objId;\n        //$LASTPOS=24000309;//kernel.Sprites:309\n        _this.objId++;\n        \n      }\n      //$LASTPOS=24000330;//kernel.Sprites:330\n      s.__addedToSprites=_this;\n      _thread.retVal=s;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    remove :function _trc_Sprites_remove(s) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var idx;\n      \n      //$LASTPOS=24000400;//kernel.Sprites:400\n      idx = _this.sprites.indexOf(s);\n      //$LASTPOS=24000433;//kernel.Sprites:433\n      if (idx<0) {\n        return _this;\n      }\n      //$LASTPOS=24000457;//kernel.Sprites:457\n      _this.sprites.splice(idx,1);\n      //$LASTPOS=24000485;//kernel.Sprites:485\n      delete s.__addedToSprites;\n    },\n    fiber$remove :function _trc_Sprites_f_remove(_thread,s) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var idx;\n      \n      //$LASTPOS=24000400;//kernel.Sprites:400\n      idx = _this.sprites.indexOf(s);\n      //$LASTPOS=24000433;//kernel.Sprites:433\n      if (idx<0) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=24000457;//kernel.Sprites:457\n      _this.sprites.splice(idx,1);\n      //$LASTPOS=24000485;//kernel.Sprites:485\n      delete s.__addedToSprites;\n      \n      _thread.retVal=_this;return;\n    },\n    removeOneframes :function _trc_Sprites_removeOneframes() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      \n      //$LASTPOS=24000542;//kernel.Sprites:542\n      //$LASTPOS=24000547;//kernel.Sprites:547\n      i = _this.sprites.length-1;\n      while(i>=0) {\n        {\n          //$LASTPOS=24000595;//kernel.Sprites:595\n          if (_this.sprites[i].oneframeSprite) {\n            //$LASTPOS=24000641;//kernel.Sprites:641\n            _this.sprites.splice(i,1);\n            \n          }\n        }\n        i--;\n      }\n    },\n    fiber$removeOneframes :function _trc_Sprites_f_removeOneframes(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      \n      //$LASTPOS=24000542;//kernel.Sprites:542\n      //$LASTPOS=24000547;//kernel.Sprites:547\n      i = _this.sprites.length-1;\n      while(i>=0) {\n        {\n          //$LASTPOS=24000595;//kernel.Sprites:595\n          if (_this.sprites[i].oneframeSprite) {\n            //$LASTPOS=24000641;//kernel.Sprites:641\n            _this.sprites.splice(i,1);\n            \n          }\n        }\n        i--;\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    clear :function _trc_Sprites_clear() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24000702;//kernel.Sprites:702\n      _this.sprites.splice(0,_this.sprites.length);\n    },\n    fiber$clear :function _trc_Sprites_f_clear(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=24000702;//kernel.Sprites:702\n      _this.sprites.splice(0,_this.sprites.length);\n      \n      _thread.retVal=_this;return;\n    },\n    compOrder :function _trc_Sprites_compOrder(obj1,obj2) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var val1;\n      var val2;\n      \n      //$LASTPOS=24000775;//kernel.Sprites:775\n      val1 = obj1.zOrder;\n      //$LASTPOS=24000802;//kernel.Sprites:802\n      val2 = obj2.zOrder;\n      //$LASTPOS=24000829;//kernel.Sprites:829\n      if (val1>val2) {\n        return - 1;\n        \n      } else {\n        //$LASTPOS=24000875;//kernel.Sprites:875\n        if (val1<val2) {\n          return 1;\n          \n        } else {\n          //$LASTPOS=24000920;//kernel.Sprites:920\n          if (val1==val2) {\n            //$LASTPOS=24000945;//kernel.Sprites:945\n            if (obj1.__genId>obj2.__genId) {\n              return 1;\n              \n            } else {\n              return - 1;\n              \n            }\n            return 0;\n            \n          }\n        }\n      }\n    },\n    fiber$compOrder :function _trc_Sprites_f_compOrder(_thread,obj1,obj2) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var val1;\n      var val2;\n      \n      //$LASTPOS=24000775;//kernel.Sprites:775\n      val1 = obj1.zOrder;\n      //$LASTPOS=24000802;//kernel.Sprites:802\n      val2 = obj2.zOrder;\n      //$LASTPOS=24000829;//kernel.Sprites:829\n      if (val1>val2) {\n        _thread.retVal=- 1;return;\n        \n        \n      } else {\n        //$LASTPOS=24000875;//kernel.Sprites:875\n        if (val1<val2) {\n          _thread.retVal=1;return;\n          \n          \n        } else {\n          //$LASTPOS=24000920;//kernel.Sprites:920\n          if (val1==val2) {\n            //$LASTPOS=24000945;//kernel.Sprites:945\n            if (obj1.__genId>obj2.__genId) {\n              _thread.retVal=1;return;\n              \n              \n            } else {\n              _thread.retVal=- 1;return;\n              \n              \n            }\n            _thread.retVal=0;return;\n            \n            \n          }\n        }\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_Sprites_draw(cv) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ctx;\n      var orderArray;\n      \n      //$LASTPOS=24001105;//kernel.Sprites:1105\n      ctx = cv.getContext("2d");\n      //$LASTPOS=24001139;//kernel.Sprites:1139\n      ctx.save();\n      //$LASTPOS=24001284;//kernel.Sprites:1284\n      orderArray = [];\n      //$LASTPOS=24001308;//kernel.Sprites:1308\n      orderArray=orderArray.concat(_this.sprites);\n      //$LASTPOS=24001352;//kernel.Sprites:1352\n      orderArray.sort(Tonyu.bindFunc(_this,_this.compOrder));\n      //$LASTPOS=24001385;//kernel.Sprites:1385\n      ctx.translate(- _this.sx,- _this.sy);\n      //$LASTPOS=24001414;//kernel.Sprites:1414\n      orderArray.forEach((function anonymous_1433(s) {\n        \n        //$LASTPOS=24001448;//kernel.Sprites:1448\n        s.draw(ctx);\n      }));\n      //$LASTPOS=24001475;//kernel.Sprites:1475\n      ctx.restore();\n    },\n    checkHit :function _trc_Sprites_checkHit() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24001521;//kernel.Sprites:1521\n      _this.hitWatchers.forEach((function anonymous_1541(w) {\n        \n        //$LASTPOS=24001565;//kernel.Sprites:1565\n        _this.sprites.forEach((function anonymous_1581(a) {\n          var a_owner;\n          \n          //$LASTPOS=24001653;//kernel.Sprites:1653\n          a_owner = a;\n          //$LASTPOS=24001695;//kernel.Sprites:1695\n          if (! (a_owner instanceof w.A)) {\n            return _this;\n          }\n          //$LASTPOS=24001748;//kernel.Sprites:1748\n          _this.sprites.forEach((function anonymous_1764(b) {\n            var b_owner;\n            \n            //$LASTPOS=24001796;//kernel.Sprites:1796\n            b_owner = b;\n            //$LASTPOS=24001842;//kernel.Sprites:1842\n            if (a===b) {\n              return _this;\n            }\n            //$LASTPOS=24001878;//kernel.Sprites:1878\n            if (! (b_owner instanceof w.B)) {\n              return _this;\n            }\n            //$LASTPOS=24001983;//kernel.Sprites:1983\n            if (a.crashTo1(b)) {\n              //$LASTPOS=24002086;//kernel.Sprites:2086\n              w.h(a_owner,b_owner);\n              \n            }\n          }));\n        }));\n      }));\n    },\n    fiber$checkHit :function _trc_Sprites_f_checkHit(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=24001521;//kernel.Sprites:1521\n      _this.hitWatchers.forEach((function anonymous_1541(w) {\n        \n        //$LASTPOS=24001565;//kernel.Sprites:1565\n        _this.sprites.forEach((function anonymous_1581(a) {\n          var a_owner;\n          \n          //$LASTPOS=24001653;//kernel.Sprites:1653\n          a_owner = a;\n          //$LASTPOS=24001695;//kernel.Sprites:1695\n          if (! (a_owner instanceof w.A)) {\n            return _this;\n          }\n          //$LASTPOS=24001748;//kernel.Sprites:1748\n          _this.sprites.forEach((function anonymous_1764(b) {\n            var b_owner;\n            \n            //$LASTPOS=24001796;//kernel.Sprites:1796\n            b_owner = b;\n            //$LASTPOS=24001842;//kernel.Sprites:1842\n            if (a===b) {\n              return _this;\n            }\n            //$LASTPOS=24001878;//kernel.Sprites:1878\n            if (! (b_owner instanceof w.B)) {\n              return _this;\n            }\n            //$LASTPOS=24001983;//kernel.Sprites:1983\n            if (a.crashTo1(b)) {\n              //$LASTPOS=24002086;//kernel.Sprites:2086\n              w.h(a_owner,b_owner);\n              \n            }\n          }));\n        }));\n      }));\n      \n      _thread.retVal=_this;return;\n    },\n    watchHit :function _trc_Sprites_watchHit(typeA,typeB,onHit) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var p;\n      \n      //$LASTPOS=24002216;//kernel.Sprites:2216\n      p = {A: typeA,B: typeB,h: onHit};\n      //$LASTPOS=24002280;//kernel.Sprites:2280\n      _this.hitWatchers.push(p);\n    },\n    drawGrid :function _trc_Sprites_drawGrid(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ctx;\n      var i;\n      \n      //$LASTPOS=24002333;//kernel.Sprites:2333\n      ctx = c.getContext("2d");\n      //$LASTPOS=24002366;//kernel.Sprites:2366\n      ctx.textBaseline="top";\n      //$LASTPOS=24002395;//kernel.Sprites:2395\n      ctx.save();\n      //$LASTPOS=24002412;//kernel.Sprites:2412\n      ctx.strokeStyle="rgb(40,100,200)";\n      //$LASTPOS=24002452;//kernel.Sprites:2452\n      //$LASTPOS=24002457;//kernel.Sprites:2457\n      i = 0;\n      while(i<c.width) {\n        {\n          //$LASTPOS=24002497;//kernel.Sprites:2497\n          ctx.beginPath();\n          //$LASTPOS=24002523;//kernel.Sprites:2523\n          ctx.lineWidth=(i%100==0?4:1);\n          //$LASTPOS=24002569;//kernel.Sprites:2569\n          ctx.moveTo(i,0);\n          //$LASTPOS=24002595;//kernel.Sprites:2595\n          ctx.lineTo(i,c.height);\n          //$LASTPOS=24002628;//kernel.Sprites:2628\n          ctx.closePath();\n          //$LASTPOS=24002654;//kernel.Sprites:2654\n          ctx.stroke();\n        }\n        i+=10;\n      }\n      //$LASTPOS=24002686;//kernel.Sprites:2686\n      //$LASTPOS=24002691;//kernel.Sprites:2691\n      i = 0;\n      while(i<c.height) {\n        {\n          //$LASTPOS=24002732;//kernel.Sprites:2732\n          ctx.beginPath();\n          //$LASTPOS=24002758;//kernel.Sprites:2758\n          ctx.lineWidth=(i%100==0?4:1);\n          //$LASTPOS=24002804;//kernel.Sprites:2804\n          ctx.moveTo(0,i);\n          //$LASTPOS=24002830;//kernel.Sprites:2830\n          ctx.lineTo(c.width,i);\n          //$LASTPOS=24002862;//kernel.Sprites:2862\n          ctx.closePath();\n          //$LASTPOS=24002888;//kernel.Sprites:2888\n          ctx.stroke();\n        }\n        i+=10;\n      }\n      //$LASTPOS=24002914;//kernel.Sprites:2914\n      ctx.fillStyle="white";\n      //$LASTPOS=24002942;//kernel.Sprites:2942\n      ctx.font="15px monospaced";\n      //$LASTPOS=24002975;//kernel.Sprites:2975\n      //$LASTPOS=24002980;//kernel.Sprites:2980\n      i = 100;\n      while(i<c.width) {\n        {\n          //$LASTPOS=24003023;//kernel.Sprites:3023\n          ctx.fillText(i,i,0);\n        }\n        i+=100;\n      }\n      //$LASTPOS=24003057;//kernel.Sprites:3057\n      //$LASTPOS=24003062;//kernel.Sprites:3062\n      i = 100;\n      while(i<c.height) {\n        {\n          //$LASTPOS=24003106;//kernel.Sprites:3106\n          ctx.fillText(i,0,i);\n        }\n        i+=100;\n      }\n      //$LASTPOS=24003140;//kernel.Sprites:3140\n      ctx.restore();\n    },\n    fiber$drawGrid :function _trc_Sprites_f_drawGrid(_thread,c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var ctx;\n      var i;\n      \n      //$LASTPOS=24002333;//kernel.Sprites:2333\n      ctx = c.getContext("2d");\n      //$LASTPOS=24002366;//kernel.Sprites:2366\n      ctx.textBaseline="top";\n      //$LASTPOS=24002395;//kernel.Sprites:2395\n      ctx.save();\n      //$LASTPOS=24002412;//kernel.Sprites:2412\n      ctx.strokeStyle="rgb(40,100,200)";\n      //$LASTPOS=24002452;//kernel.Sprites:2452\n      //$LASTPOS=24002457;//kernel.Sprites:2457\n      i = 0;\n      while(i<c.width) {\n        {\n          //$LASTPOS=24002497;//kernel.Sprites:2497\n          ctx.beginPath();\n          //$LASTPOS=24002523;//kernel.Sprites:2523\n          ctx.lineWidth=(i%100==0?4:1);\n          //$LASTPOS=24002569;//kernel.Sprites:2569\n          ctx.moveTo(i,0);\n          //$LASTPOS=24002595;//kernel.Sprites:2595\n          ctx.lineTo(i,c.height);\n          //$LASTPOS=24002628;//kernel.Sprites:2628\n          ctx.closePath();\n          //$LASTPOS=24002654;//kernel.Sprites:2654\n          ctx.stroke();\n        }\n        i+=10;\n      }\n      //$LASTPOS=24002686;//kernel.Sprites:2686\n      //$LASTPOS=24002691;//kernel.Sprites:2691\n      i = 0;\n      while(i<c.height) {\n        {\n          //$LASTPOS=24002732;//kernel.Sprites:2732\n          ctx.beginPath();\n          //$LASTPOS=24002758;//kernel.Sprites:2758\n          ctx.lineWidth=(i%100==0?4:1);\n          //$LASTPOS=24002804;//kernel.Sprites:2804\n          ctx.moveTo(0,i);\n          //$LASTPOS=24002830;//kernel.Sprites:2830\n          ctx.lineTo(c.width,i);\n          //$LASTPOS=24002862;//kernel.Sprites:2862\n          ctx.closePath();\n          //$LASTPOS=24002888;//kernel.Sprites:2888\n          ctx.stroke();\n        }\n        i+=10;\n      }\n      //$LASTPOS=24002914;//kernel.Sprites:2914\n      ctx.fillStyle="white";\n      //$LASTPOS=24002942;//kernel.Sprites:2942\n      ctx.font="15px monospaced";\n      //$LASTPOS=24002975;//kernel.Sprites:2975\n      //$LASTPOS=24002980;//kernel.Sprites:2980\n      i = 100;\n      while(i<c.width) {\n        {\n          //$LASTPOS=24003023;//kernel.Sprites:3023\n          ctx.fillText(i,i,0);\n        }\n        i+=100;\n      }\n      //$LASTPOS=24003057;//kernel.Sprites:3057\n      //$LASTPOS=24003062;//kernel.Sprites:3062\n      i = 100;\n      while(i<c.height) {\n        {\n          //$LASTPOS=24003106;//kernel.Sprites:3106\n          ctx.fillText(i,0,i);\n        }\n        i+=100;\n      }\n      //$LASTPOS=24003140;//kernel.Sprites:3140\n      ctx.restore();\n      \n      _thread.retVal=_this;return;\n    },\n    setImageList :function _trc_Sprites_setImageList(il) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24003192;//kernel.Sprites:3192\n      _this.imageList=il;\n    },\n    fiber$setImageList :function _trc_Sprites_f_setImageList(_thread,il) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=24003192;//kernel.Sprites:3192\n      _this.imageList=il;\n      \n      _thread.retVal=_this;return;\n    },\n    getImageList :function _trc_Sprites_getImageList() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.imageList;\n    },\n    fiber$getImageList :function _trc_Sprites_f_getImageList(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.imageList;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    scrollTo :function _trc_Sprites_scrollTo(scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=24003304;//kernel.Sprites:3304\n      _this.sx=scrollX;\n      //$LASTPOS=24003321;//kernel.Sprites:3321\n      _this.sy=scrollY;\n    },\n    fiber$scrollTo :function _trc_Sprites_f_scrollTo(_thread,scrollX,scrollY) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=24003304;//kernel.Sprites:3304\n      _this.sx=scrollX;\n      //$LASTPOS=24003321;//kernel.Sprites:3321\n      _this.sy=scrollY;\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"add":{"nowait":false},"remove":{"nowait":false},"removeOneframes":{"nowait":false},"clear":{"nowait":false},"compOrder":{"nowait":false},"draw":{"nowait":true},"checkHit":{"nowait":false},"watchHit":{"nowait":true},"drawGrid":{"nowait":false},"setImageList":{"nowait":false},"getImageList":{"nowait":false},"scrollTo":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.BodyActor\',\n  shortName: \'BodyActor\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [Tonyu.classes.kernel.T2Mod],\n  methods: {\n    main :function _trc_BodyActor_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_BodyActor_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getWorld :function _trc_BodyActor_getWorld() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25000064;//kernel.BodyActor:64\n      if (Tonyu.globals.$t2World) {\n        return Tonyu.globals.$t2World;\n      }\n      //$LASTPOS=25000099;//kernel.BodyActor:99\n      Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;\n      return Tonyu.globals.$t2World;\n    },\n    fiber$getWorld :function _trc_BodyActor_f_getWorld(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=25000064;//kernel.BodyActor:64\n      if (Tonyu.globals.$t2World) {\n        _thread.retVal=Tonyu.globals.$t2World;return;\n        \n      }\n      //$LASTPOS=25000099;//kernel.BodyActor:99\n      Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;\n      _thread.retVal=Tonyu.globals.$t2World;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    onAppear :function _trc_BodyActor_onAppear() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var wworld;\n      var b2Vec2;\n      var b2BodyDef;\n      var b2Body;\n      var b2FixtureDef;\n      var b2Fixture;\n      var b2PolygonShape;\n      var b2CircleShape;\n      var fixDef;\n      var bodyDef;\n      var w;\n      var h;\n      var fps;\n      var r;\n      var ve;\n      var vr;\n      \n      //$LASTPOS=25000162;//kernel.BodyActor:162\n      wworld = _this.getWorld();\n      //$LASTPOS=25000189;//kernel.BodyActor:189\n      _this.world=wworld.world;\n      //$LASTPOS=25000213;//kernel.BodyActor:213\n      _this.scale=wworld.scale;\n      //$LASTPOS=25000237;//kernel.BodyActor:237\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=25000280;//kernel.BodyActor:280\n      b2BodyDef = Box2D.Dynamics.b2BodyDef;\n      //$LASTPOS=25000326;//kernel.BodyActor:326\n      b2Body = Box2D.Dynamics.b2Body;\n      //$LASTPOS=25000366;//kernel.BodyActor:366\n      b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n      //$LASTPOS=25000418;//kernel.BodyActor:418\n      b2Fixture = Box2D.Dynamics.b2Fixture;\n      //$LASTPOS=25000464;//kernel.BodyActor:464\n      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n      //$LASTPOS=25000528;//kernel.BodyActor:528\n      b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n      //$LASTPOS=25000595;//kernel.BodyActor:595\n      fixDef = new b2FixtureDef;\n      //$LASTPOS=25000630;//kernel.BodyActor:630\n      fixDef.density=_this.defv(_this.density,1);\n      //$LASTPOS=25000671;//kernel.BodyActor:671\n      fixDef.friction=_this.defv(_this.friction,0.5);\n      //$LASTPOS=25000714;//kernel.BodyActor:714\n      fixDef.restitution=_this.defv(_this.restitution,0.2);\n      //$LASTPOS=25000768;//kernel.BodyActor:768\n      bodyDef = new b2BodyDef;\n      //$LASTPOS=25000801;//kernel.BodyActor:801\n      bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;\n      //$LASTPOS=25000886;//kernel.BodyActor:886\n      bodyDef.position.x=_this.x/_this.scale;\n      //$LASTPOS=25000921;//kernel.BodyActor:921\n      bodyDef.position.y=_this.y/_this.scale;\n      //$LASTPOS=25000956;//kernel.BodyActor:956\n      _this.shape=_this.shape||(_this.radius?"circle":"box");\n      //$LASTPOS=25001004;//kernel.BodyActor:1004\n      w = _this.width;h = _this.height;\n      //$LASTPOS=25001030;//kernel.BodyActor:1030\n      if (! w) {\n        //$LASTPOS=25001048;//kernel.BodyActor:1048\n        _this.detectShape();\n        //$LASTPOS=25001071;//kernel.BodyActor:1071\n        w=_this.width*(_this.scaleX||1);\n        //$LASTPOS=25001100;//kernel.BodyActor:1100\n        h=_this.height*(_this.scaleY||_this.scaleX||1);\n        \n      }\n      //$LASTPOS=25001140;//kernel.BodyActor:1140\n      if (_this.shape=="box") {\n        //$LASTPOS=25001168;//kernel.BodyActor:1168\n        if (! h) {\n          //$LASTPOS=25001176;//kernel.BodyActor:1176\n          h=w;\n        }\n        //$LASTPOS=25001189;//kernel.BodyActor:1189\n        fixDef.shape=new b2PolygonShape;\n        //$LASTPOS=25001232;//kernel.BodyActor:1232\n        fixDef.shape.SetAsOrientedBox(w/2/_this.scale,h/2/_this.scale,new b2Vec2(0,0),0);\n        \n      } else {\n        //$LASTPOS=25001333;//kernel.BodyActor:1333\n        _this.radius=_this.radius||w/2||16;\n        //$LASTPOS=25001369;//kernel.BodyActor:1369\n        fixDef.shape=new b2CircleShape(_this.radius/_this.scale);\n        //$LASTPOS=25001443;//kernel.BodyActor:1443\n        _this.width=_this.height=_this.radius*2;\n        \n      }\n      //$LASTPOS=25001477;//kernel.BodyActor:1477\n      fps = wworld.fps;\n      //$LASTPOS=25001501;//kernel.BodyActor:1501\n      r = _this.rotation;ve = _this.bvec(_this.defv(_this.vx*fps,0),_this.defv(_this.vy*fps,0));vr = _this.defv(_this.vrotation,0);\n      //$LASTPOS=25001582;//kernel.BodyActor:1582\n      _this.body=_this.world.CreateBody(bodyDef);\n      //$LASTPOS=25001618;//kernel.BodyActor:1618\n      _this.body.CreateFixture(fixDef);\n      //$LASTPOS=25001650;//kernel.BodyActor:1650\n      _this.body.SetUserData(_this);\n      //$LASTPOS=25001678;//kernel.BodyActor:1678\n      _this.body.SetLinearVelocity(ve);\n      //$LASTPOS=25001710;//kernel.BodyActor:1710\n      _this.rotation=r;\n      //$LASTPOS=25001726;//kernel.BodyActor:1726\n      _this.vrotation=vr;\n    },\n    fiber$onAppear :function _trc_BodyActor_f_onAppear(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var wworld;\n      var b2Vec2;\n      var b2BodyDef;\n      var b2Body;\n      var b2FixtureDef;\n      var b2Fixture;\n      var b2PolygonShape;\n      var b2CircleShape;\n      var fixDef;\n      var bodyDef;\n      var w;\n      var h;\n      var fps;\n      var r;\n      var ve;\n      var vr;\n      \n      //$LASTPOS=25000162;//kernel.BodyActor:162\n      wworld = _this.getWorld();\n      //$LASTPOS=25000189;//kernel.BodyActor:189\n      _this.world=wworld.world;\n      //$LASTPOS=25000213;//kernel.BodyActor:213\n      _this.scale=wworld.scale;\n      //$LASTPOS=25000237;//kernel.BodyActor:237\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=25000280;//kernel.BodyActor:280\n      b2BodyDef = Box2D.Dynamics.b2BodyDef;\n      //$LASTPOS=25000326;//kernel.BodyActor:326\n      b2Body = Box2D.Dynamics.b2Body;\n      //$LASTPOS=25000366;//kernel.BodyActor:366\n      b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n      //$LASTPOS=25000418;//kernel.BodyActor:418\n      b2Fixture = Box2D.Dynamics.b2Fixture;\n      //$LASTPOS=25000464;//kernel.BodyActor:464\n      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n      //$LASTPOS=25000528;//kernel.BodyActor:528\n      b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n      //$LASTPOS=25000595;//kernel.BodyActor:595\n      fixDef = new b2FixtureDef;\n      \n      _thread.enter(function _trc_BodyActor_ent_onAppear(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=25000630;//kernel.BodyActor:630\n            _this.fiber$defv(_thread, _this.density, 1);\n            __pc=1;return;\n          case 1:\n            fixDef.density=_thread.retVal;\n            \n            //$LASTPOS=25000671;//kernel.BodyActor:671\n            _this.fiber$defv(_thread, _this.friction, 0.5);\n            __pc=2;return;\n          case 2:\n            fixDef.friction=_thread.retVal;\n            \n            //$LASTPOS=25000714;//kernel.BodyActor:714\n            _this.fiber$defv(_thread, _this.restitution, 0.2);\n            __pc=3;return;\n          case 3:\n            fixDef.restitution=_thread.retVal;\n            \n            //$LASTPOS=25000768;//kernel.BodyActor:768\n            bodyDef = new b2BodyDef;\n            //$LASTPOS=25000801;//kernel.BodyActor:801\n            bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;\n            //$LASTPOS=25000886;//kernel.BodyActor:886\n            bodyDef.position.x=_this.x/_this.scale;\n            //$LASTPOS=25000921;//kernel.BodyActor:921\n            bodyDef.position.y=_this.y/_this.scale;\n            //$LASTPOS=25000956;//kernel.BodyActor:956\n            _this.shape=_this.shape||(_this.radius?"circle":"box");\n            //$LASTPOS=25001004;//kernel.BodyActor:1004\n            w = _this.width;h = _this.height;\n            //$LASTPOS=25001030;//kernel.BodyActor:1030\n            if (! w) {\n              //$LASTPOS=25001048;//kernel.BodyActor:1048\n              _this.detectShape();\n              //$LASTPOS=25001071;//kernel.BodyActor:1071\n              w=_this.width*(_this.scaleX||1);\n              //$LASTPOS=25001100;//kernel.BodyActor:1100\n              h=_this.height*(_this.scaleY||_this.scaleX||1);\n              \n            }\n            //$LASTPOS=25001140;//kernel.BodyActor:1140\n            if (_this.shape=="box") {\n              //$LASTPOS=25001168;//kernel.BodyActor:1168\n              if (! h) {\n                //$LASTPOS=25001176;//kernel.BodyActor:1176\n                h=w;\n              }\n              //$LASTPOS=25001189;//kernel.BodyActor:1189\n              fixDef.shape=new b2PolygonShape;\n              //$LASTPOS=25001232;//kernel.BodyActor:1232\n              fixDef.shape.SetAsOrientedBox(w/2/_this.scale,h/2/_this.scale,new b2Vec2(0,0),0);\n              \n            } else {\n              //$LASTPOS=25001333;//kernel.BodyActor:1333\n              _this.radius=_this.radius||w/2||16;\n              //$LASTPOS=25001369;//kernel.BodyActor:1369\n              fixDef.shape=new b2CircleShape(_this.radius/_this.scale);\n              //$LASTPOS=25001443;//kernel.BodyActor:1443\n              _this.width=_this.height=_this.radius*2;\n              \n            }\n            //$LASTPOS=25001477;//kernel.BodyActor:1477\n            fps = wworld.fps;\n            //$LASTPOS=25001501;//kernel.BodyActor:1501\n            r = _this.rotation;ve = _this.bvec(_this.defv(_this.vx*fps,0),_this.defv(_this.vy*fps,0));vr = _this.defv(_this.vrotation,0);\n            //$LASTPOS=25001582;//kernel.BodyActor:1582\n            _this.body=_this.world.CreateBody(bodyDef);\n            //$LASTPOS=25001618;//kernel.BodyActor:1618\n            _this.body.CreateFixture(fixDef);\n            //$LASTPOS=25001650;//kernel.BodyActor:1650\n            _this.body.SetUserData(_this);\n            //$LASTPOS=25001678;//kernel.BodyActor:1678\n            _this.body.SetLinearVelocity(ve);\n            //$LASTPOS=25001710;//kernel.BodyActor:1710\n            _this.rotation=r;\n            //$LASTPOS=25001726;//kernel.BodyActor:1726\n            _this.vrotation=vr;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    allContact :function _trc_BodyActor_allContact(klass) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      var c;\n      var a;\n      var b;\n      \n      //$LASTPOS=25001767;//kernel.BodyActor:1767\n      res = [];\n      //$LASTPOS=25001783;//kernel.BodyActor:1783\n      //$LASTPOS=25001788;//kernel.BodyActor:1788\n      c = _this.world.GetContactList();\n      while(c) {\n        {\n          //$LASTPOS=25001844;//kernel.BodyActor:1844\n          if (c.IsTouching()) {\n            //$LASTPOS=25001878;//kernel.BodyActor:1878\n            a = c.GetFixtureA().GetBody().GetUserData();\n            //$LASTPOS=25001937;//kernel.BodyActor:1937\n            b = c.GetFixtureB().GetBody().GetUserData();\n            //$LASTPOS=25001996;//kernel.BodyActor:1996\n            if (a===_this) {\n              //$LASTPOS=25002028;//kernel.BodyActor:2028\n              if (! klass||b===klass||b instanceof klass) {\n                //$LASTPOS=25002097;//kernel.BodyActor:2097\n                res.push(b);\n                \n              }\n              \n            } else {\n              //$LASTPOS=25002147;//kernel.BodyActor:2147\n              if (b===_this) {\n                //$LASTPOS=25002179;//kernel.BodyActor:2179\n                if (! klass||a===klass||a instanceof klass) {\n                  //$LASTPOS=25002248;//kernel.BodyActor:2248\n                  res.push(a);\n                  \n                }\n                \n              }\n            }\n            \n          }\n        }\n        c=c.GetNext();\n      }\n      return res;\n    },\n    fiber$allContact :function _trc_BodyActor_f_allContact(_thread,klass) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var res;\n      var c;\n      var a;\n      var b;\n      \n      //$LASTPOS=25001767;//kernel.BodyActor:1767\n      res = [];\n      //$LASTPOS=25001783;//kernel.BodyActor:1783\n      //$LASTPOS=25001788;//kernel.BodyActor:1788\n      c = _this.world.GetContactList();\n      while(c) {\n        {\n          //$LASTPOS=25001844;//kernel.BodyActor:1844\n          if (c.IsTouching()) {\n            //$LASTPOS=25001878;//kernel.BodyActor:1878\n            a = c.GetFixtureA().GetBody().GetUserData();\n            //$LASTPOS=25001937;//kernel.BodyActor:1937\n            b = c.GetFixtureB().GetBody().GetUserData();\n            //$LASTPOS=25001996;//kernel.BodyActor:1996\n            if (a===_this) {\n              //$LASTPOS=25002028;//kernel.BodyActor:2028\n              if (! klass||b===klass||b instanceof klass) {\n                //$LASTPOS=25002097;//kernel.BodyActor:2097\n                res.push(b);\n                \n              }\n              \n            } else {\n              //$LASTPOS=25002147;//kernel.BodyActor:2147\n              if (b===_this) {\n                //$LASTPOS=25002179;//kernel.BodyActor:2179\n                if (! klass||a===klass||a instanceof klass) {\n                  //$LASTPOS=25002248;//kernel.BodyActor:2248\n                  res.push(a);\n                  \n                }\n                \n              }\n            }\n            \n          }\n        }\n        c=c.GetNext();\n      }\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    applyForce :function _trc_BodyActor_applyForce(fx,fy,px,py) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b2Vec2;\n      var scale;\n      var fps;\n      \n      //$LASTPOS=25002358;//kernel.BodyActor:2358\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=25002401;//kernel.BodyActor:2401\n      scale = _this.getWorld().scale;\n      //$LASTPOS=25002433;//kernel.BodyActor:2433\n      fps = 60;\n      //$LASTPOS=25002449;//kernel.BodyActor:2449\n      _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());\n    },\n    fiber$applyForce :function _trc_BodyActor_f_applyForce(_thread,fx,fy,px,py) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b2Vec2;\n      var scale;\n      var fps;\n      \n      //$LASTPOS=25002358;//kernel.BodyActor:2358\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=25002401;//kernel.BodyActor:2401\n      scale = _this.getWorld().scale;\n      //$LASTPOS=25002433;//kernel.BodyActor:2433\n      fps = 60;\n      //$LASTPOS=25002449;//kernel.BodyActor:2449\n      _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());\n      \n      _thread.retVal=_this;return;\n    },\n    applyImpulse :function _trc_BodyActor_applyImpulse(fx,fy,px,py) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b2Vec2;\n      var scale;\n      var fps;\n      \n      //$LASTPOS=25002540;//kernel.BodyActor:2540\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=25002583;//kernel.BodyActor:2583\n      scale = _this.getWorld().scale;\n      //$LASTPOS=25002615;//kernel.BodyActor:2615\n      fps = 60;\n      //$LASTPOS=25002631;//kernel.BodyActor:2631\n      _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());\n    },\n    fiber$applyImpulse :function _trc_BodyActor_f_applyImpulse(_thread,fx,fy,px,py) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b2Vec2;\n      var scale;\n      var fps;\n      \n      //$LASTPOS=25002540;//kernel.BodyActor:2540\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=25002583;//kernel.BodyActor:2583\n      scale = _this.getWorld().scale;\n      //$LASTPOS=25002615;//kernel.BodyActor:2615\n      fps = 60;\n      //$LASTPOS=25002631;//kernel.BodyActor:2631\n      _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());\n      \n      _thread.retVal=_this;return;\n    },\n    applyTorque :function _trc_BodyActor_applyTorque(a) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25002714;//kernel.BodyActor:2714\n      _this.body.ApplyTorque(a);\n    },\n    fiber$applyTorque :function _trc_BodyActor_f_applyTorque(_thread,a) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=25002714;//kernel.BodyActor:2714\n      _this.body.ApplyTorque(a);\n      \n      _thread.retVal=_this;return;\n    },\n    moveBy :function _trc_BodyActor_moveBy(dx,dy) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var pos;\n      \n      //$LASTPOS=25002758;//kernel.BodyActor:2758\n      pos = _this.body.GetPosition();\n      //$LASTPOS=25002790;//kernel.BodyActor:2790\n      pos.x+=dx/_this.scale;\n      //$LASTPOS=25002811;//kernel.BodyActor:2811\n      pos.y+=dy/_this.scale;\n      //$LASTPOS=25002832;//kernel.BodyActor:2832\n      _this.body.SetPosition(pos);\n    },\n    fiber$moveBy :function _trc_BodyActor_f_moveBy(_thread,dx,dy) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var pos;\n      \n      //$LASTPOS=25002758;//kernel.BodyActor:2758\n      pos = _this.body.GetPosition();\n      //$LASTPOS=25002790;//kernel.BodyActor:2790\n      pos.x+=dx/_this.scale;\n      //$LASTPOS=25002811;//kernel.BodyActor:2811\n      pos.y+=dy/_this.scale;\n      //$LASTPOS=25002832;//kernel.BodyActor:2832\n      _this.body.SetPosition(pos);\n      \n      _thread.retVal=_this;return;\n    },\n    contactTo :function _trc_BodyActor_contactTo(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.allContact(t)[0];\n    },\n    fiber$contactTo :function _trc_BodyActor_f_contactTo(_thread,t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.allContact(t)[0];return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    die :function _trc_BodyActor_die() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25002917;//kernel.BodyActor:2917\n      Tonyu.classes.kernel.Actor.prototype.die.apply( _this, []);\n      //$LASTPOS=25002934;//kernel.BodyActor:2934\n      _this.world.DestroyBody(_this.body);\n    },\n    addRevoluteJoint :function _trc_BodyActor_addRevoluteJoint(params) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var px;\n      var py;\n      var wworld;\n      var scale;\n      var world;\n      var b2BodyDef;\n      var b2Body;\n      var JDC;\n      var jd;\n      var bodyDef;\n      var bodyB;\n      var b2Vec2;\n      \n      //$LASTPOS=25003022;//kernel.BodyActor:3022\n      params=params||{};\n      //$LASTPOS=25003045;//kernel.BodyActor:3045\n      px = params.x||_this.x;\n      //$LASTPOS=25003069;//kernel.BodyActor:3069\n      py = params.y||_this.y;\n      //$LASTPOS=25003093;//kernel.BodyActor:3093\n      wworld = _this.getWorld();\n      //$LASTPOS=25003134;//kernel.BodyActor:3134\n      scale = wworld.scale;\n      //$LASTPOS=25003162;//kernel.BodyActor:3162\n      world = wworld.world;\n      //$LASTPOS=25003190;//kernel.BodyActor:3190\n      b2BodyDef = Box2D.Dynamics.b2BodyDef;\n      //$LASTPOS=25003236;//kernel.BodyActor:3236\n      b2Body = Box2D.Dynamics.b2Body;\n      //$LASTPOS=25003276;//kernel.BodyActor:3276\n      JDC = Box2D.Dynamics.Joints.b2RevoluteJointDef;\n      //$LASTPOS=25003330;//kernel.BodyActor:3330\n      jd = new JDC;\n      //$LASTPOS=25003350;//kernel.BodyActor:3350\n      bodyDef = new b2BodyDef;\n      //$LASTPOS=25003383;//kernel.BodyActor:3383\n      bodyDef.type=b2Body.b2_staticBody;\n      //$LASTPOS=25003424;//kernel.BodyActor:3424\n      bodyDef.position.x=px/scale;\n      //$LASTPOS=25003460;//kernel.BodyActor:3460\n      bodyDef.position.y=py/scale;\n      //$LASTPOS=25003496;//kernel.BodyActor:3496\n      bodyB = world.CreateBody(bodyDef);\n      //$LASTPOS=25003537;//kernel.BodyActor:3537\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=25003580;//kernel.BodyActor:3580\n      jd.Initialize(_this.body,bodyB,new b2Vec2(px/scale,py/scale));\n      //$LASTPOS=25003642;//kernel.BodyActor:3642\n      if (params.lowerAngle&&params.upperAngle) {\n        //$LASTPOS=25003695;//kernel.BodyActor:3695\n        jd.lowerAngle=_this.rad(params.lowerAngle);\n        //$LASTPOS=25003742;//kernel.BodyActor:3742\n        jd.upperAngle=_this.rad(params.upperAngle);\n        //$LASTPOS=25003789;//kernel.BodyActor:3789\n        jd.enableLimit=true;\n        \n      }\n      //$LASTPOS=25003822;//kernel.BodyActor:3822\n      world.CreateJoint(jd);\n    },\n    fiber$addRevoluteJoint :function _trc_BodyActor_f_addRevoluteJoint(_thread,params) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var px;\n      var py;\n      var wworld;\n      var scale;\n      var world;\n      var b2BodyDef;\n      var b2Body;\n      var JDC;\n      var jd;\n      var bodyDef;\n      var bodyB;\n      var b2Vec2;\n      \n      //$LASTPOS=25003022;//kernel.BodyActor:3022\n      params=params||{};\n      //$LASTPOS=25003045;//kernel.BodyActor:3045\n      px = params.x||_this.x;\n      //$LASTPOS=25003069;//kernel.BodyActor:3069\n      py = params.y||_this.y;\n      //$LASTPOS=25003093;//kernel.BodyActor:3093\n      wworld = _this.getWorld();\n      //$LASTPOS=25003134;//kernel.BodyActor:3134\n      scale = wworld.scale;\n      //$LASTPOS=25003162;//kernel.BodyActor:3162\n      world = wworld.world;\n      //$LASTPOS=25003190;//kernel.BodyActor:3190\n      b2BodyDef = Box2D.Dynamics.b2BodyDef;\n      //$LASTPOS=25003236;//kernel.BodyActor:3236\n      b2Body = Box2D.Dynamics.b2Body;\n      //$LASTPOS=25003276;//kernel.BodyActor:3276\n      JDC = Box2D.Dynamics.Joints.b2RevoluteJointDef;\n      //$LASTPOS=25003330;//kernel.BodyActor:3330\n      jd = new JDC;\n      //$LASTPOS=25003350;//kernel.BodyActor:3350\n      bodyDef = new b2BodyDef;\n      //$LASTPOS=25003383;//kernel.BodyActor:3383\n      bodyDef.type=b2Body.b2_staticBody;\n      //$LASTPOS=25003424;//kernel.BodyActor:3424\n      bodyDef.position.x=px/scale;\n      //$LASTPOS=25003460;//kernel.BodyActor:3460\n      bodyDef.position.y=py/scale;\n      //$LASTPOS=25003496;//kernel.BodyActor:3496\n      bodyB = world.CreateBody(bodyDef);\n      //$LASTPOS=25003537;//kernel.BodyActor:3537\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=25003580;//kernel.BodyActor:3580\n      jd.Initialize(_this.body,bodyB,new b2Vec2(px/scale,py/scale));\n      //$LASTPOS=25003642;//kernel.BodyActor:3642\n      if (params.lowerAngle&&params.upperAngle) {\n        //$LASTPOS=25003695;//kernel.BodyActor:3695\n        jd.lowerAngle=_this.rad(params.lowerAngle);\n        //$LASTPOS=25003742;//kernel.BodyActor:3742\n        jd.upperAngle=_this.rad(params.upperAngle);\n        //$LASTPOS=25003789;//kernel.BodyActor:3789\n        jd.enableLimit=true;\n        \n      }\n      //$LASTPOS=25003822;//kernel.BodyActor:3822\n      world.CreateJoint(jd);\n      \n      _thread.retVal=_this;return;\n    },\n    __getter__rotation :function _trc_BodyActor___getter__rotation() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25003867;//kernel.BodyActor:3867\n      if (! _this.body||_this.manualRotation) {\n        return _this._rotation;\n      }\n      return _this.deg(_this.body.GetAngle());\n    },\n    __setter__rotation :function _trc_BodyActor___setter__rotation(r) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25003967;//kernel.BodyActor:3967\n      r=r||0;\n      //$LASTPOS=25003979;//kernel.BodyActor:3979\n      if (! _this.body||_this.manualRotation) {\n        return _this._rotation=r;\n      }\n      //$LASTPOS=25004032;//kernel.BodyActor:4032\n      _this.body.SetAngle(_this.rad(r));\n    },\n    updatePos :function _trc_BodyActor_updatePos() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$updatePos :function _trc_BodyActor_f_updatePos(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __getter__x :function _trc_BodyActor___getter__x() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var pos;\n      \n      //$LASTPOS=25004215;//kernel.BodyActor:4215\n      if (! _this.body) {\n        return _this._x;\n      }\n      //$LASTPOS=25004241;//kernel.BodyActor:4241\n      pos = _this.body.GetPosition();\n      return pos.x*_this.scale;\n    },\n    __setter__x :function _trc_BodyActor___setter__x(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var pos;\n      \n      //$LASTPOS=25004306;//kernel.BodyActor:4306\n      if (! _this.body) {\n        return _this._x=v;\n      }\n      //$LASTPOS=25004334;//kernel.BodyActor:4334\n      v=v||0;\n      //$LASTPOS=25004346;//kernel.BodyActor:4346\n      pos = _this.body.GetPosition();\n      //$LASTPOS=25004378;//kernel.BodyActor:4378\n      pos.x=v/_this.scale;\n      //$LASTPOS=25004397;//kernel.BodyActor:4397\n      _this.body.SetPosition(pos);\n    },\n    __getter__y :function _trc_BodyActor___getter__y() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var pos;\n      \n      //$LASTPOS=25004431;//kernel.BodyActor:4431\n      if (! _this.body) {\n        return _this._y;\n      }\n      //$LASTPOS=25004457;//kernel.BodyActor:4457\n      pos = _this.body.GetPosition();\n      return pos.y*_this.scale;\n    },\n    __setter__y :function _trc_BodyActor___setter__y(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var pos;\n      \n      //$LASTPOS=25004522;//kernel.BodyActor:4522\n      if (! _this.body) {\n        return _this._y=v;\n      }\n      //$LASTPOS=25004550;//kernel.BodyActor:4550\n      v=v||0;\n      //$LASTPOS=25004562;//kernel.BodyActor:4562\n      pos = _this.body.GetPosition();\n      //$LASTPOS=25004594;//kernel.BodyActor:4594\n      pos.y=v/_this.scale;\n      //$LASTPOS=25004613;//kernel.BodyActor:4613\n      _this.body.SetPosition(pos);\n    },\n    __getter__vx :function _trc_BodyActor___getter__vx() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var v;\n      \n      //$LASTPOS=25004649;//kernel.BodyActor:4649\n      if (! _this.body) {\n        return _this._vx;\n      }\n      //$LASTPOS=25004676;//kernel.BodyActor:4676\n      v = _this.body.GetLinearVelocity();\n      return v.x*_this.scale/_this.getWorld().fps;\n    },\n    __setter__vx :function _trc_BodyActor___setter__vx(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ve;\n      \n      //$LASTPOS=25004759;//kernel.BodyActor:4759\n      if (! _this.body) {\n        return _this._vx=v;\n      }\n      //$LASTPOS=25004788;//kernel.BodyActor:4788\n      v=v||0;\n      //$LASTPOS=25004800;//kernel.BodyActor:4800\n      ve = _this.body.GetLinearVelocity();\n      //$LASTPOS=25004837;//kernel.BodyActor:4837\n      ve.x=v/_this.scale*_this.getWorld().fps;\n      //$LASTPOS=25004870;//kernel.BodyActor:4870\n      if (v) {\n        //$LASTPOS=25004877;//kernel.BodyActor:4877\n        _this.body.SetAwake(true);\n      }\n      //$LASTPOS=25004902;//kernel.BodyActor:4902\n      _this.body.SetLinearVelocity(ve);\n    },\n    __getter__vy :function _trc_BodyActor___getter__vy() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var v;\n      \n      //$LASTPOS=25004943;//kernel.BodyActor:4943\n      if (! _this.body) {\n        return _this._vy;\n      }\n      //$LASTPOS=25004970;//kernel.BodyActor:4970\n      v = _this.body.GetLinearVelocity();\n      return v.y*_this.scale/_this.getWorld().fps;\n    },\n    __setter__vy :function _trc_BodyActor___setter__vy(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var ve;\n      \n      //$LASTPOS=25005053;//kernel.BodyActor:5053\n      if (! _this.body) {\n        return _this._vy=v;\n      }\n      //$LASTPOS=25005082;//kernel.BodyActor:5082\n      ve = _this.body.GetLinearVelocity();\n      //$LASTPOS=25005119;//kernel.BodyActor:5119\n      ve.y=v/_this.scale*_this.getWorld().fps;\n      //$LASTPOS=25005152;//kernel.BodyActor:5152\n      if (v) {\n        //$LASTPOS=25005159;//kernel.BodyActor:5159\n        _this.body.SetAwake(true);\n      }\n      //$LASTPOS=25005184;//kernel.BodyActor:5184\n      _this.body.SetLinearVelocity(ve);\n    },\n    __getter__vrotation :function _trc_BodyActor___getter__vrotation() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25005231;//kernel.BodyActor:5231\n      if (! _this.body) {\n        return _this._vr;\n      }\n      return _this.deg(_this.body.GetAngularVelocity()/_this.getWorld().fps);\n    },\n    __setter__vrotation :function _trc_BodyActor___setter__vrotation(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=25005333;//kernel.BodyActor:5333\n      if (! _this.body) {\n        return _this._vr=v;\n      }\n      //$LASTPOS=25005362;//kernel.BodyActor:5362\n      v=v||0;\n      //$LASTPOS=25005374;//kernel.BodyActor:5374\n      if (v) {\n        //$LASTPOS=25005381;//kernel.BodyActor:5381\n        _this.body.SetAwake(true);\n      }\n      //$LASTPOS=25005406;//kernel.BodyActor:5406\n      _this.body.SetAngularVelocity(_this.rad(v*_this.getWorld().fps));\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"getWorld":{"nowait":false},"onAppear":{"nowait":false},"allContact":{"nowait":false},"applyForce":{"nowait":false},"applyImpulse":{"nowait":false},"applyTorque":{"nowait":false},"moveBy":{"nowait":false},"contactTo":{"nowait":false},"die":{"nowait":true},"addRevoluteJoint":{"nowait":false},"__getter__rotation":{"nowait":true},"__setter__rotation":{"nowait":true},"updatePos":{"nowait":false},"__getter__x":{"nowait":true},"__setter__x":{"nowait":true},"__getter__y":{"nowait":true},"__setter__y":{"nowait":true},"__getter__vx":{"nowait":true},"__setter__vx":{"nowait":true},"__getter__vy":{"nowait":true},"__setter__vy":{"nowait":true},"__getter__vrotation":{"nowait":true},"__setter__vrotation":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T2Body\',\n  shortName: \'T2Body\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.BodyActor,\n  includes: [],\n  methods: {\n    main :function _trc_T2Body_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T2Body_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T2World\',\n  shortName: \'T2World\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [Tonyu.classes.kernel.T2Mod],\n  methods: {\n    main :function _trc_T2World_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26000150;//kernel.T2World:150\n      _this.loop();\n    },\n    fiber$main :function _trc_T2World_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_T2World_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=26000150;//kernel.T2World:150\n            _this.fiber$loop(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    onAppear :function _trc_T2World_onAppear() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26000086;//kernel.T2World:86\n      Tonyu.globals.$currentProject.requestPlugin("box2d");\n      //$LASTPOS=26000133;//kernel.T2World:133\n      _this.initWorld();\n    },\n    fiber$onAppear :function _trc_T2World_f_onAppear(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=26000086;//kernel.T2World:86\n      Tonyu.globals.$currentProject.requestPlugin("box2d");\n      \n      _thread.enter(function _trc_T2World_ent_onAppear(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=26000133;//kernel.T2World:133\n            _this.fiber$initWorld(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initWorld :function _trc_T2World_initWorld() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b2World;\n      var b2Vec2;\n      \n      //$LASTPOS=26000183;//kernel.T2World:183\n      _this.gravity=_this.defv(_this.gravity,9.8);\n      //$LASTPOS=26000216;//kernel.T2World:216\n      _this.gravityX=_this.defv(_this.gravityX,0);\n      //$LASTPOS=26000249;//kernel.T2World:249\n      _this.fps=Tonyu.globals.$Boot.getFrameRate();\n      //$LASTPOS=26000280;//kernel.T2World:280\n      b2World = Box2D.Dynamics.b2World;\n      //$LASTPOS=26000323;//kernel.T2World:323\n      b2Vec2 = Box2D.Common.Math.b2Vec2;\n      //$LASTPOS=26000367;//kernel.T2World:367\n      _this.scale=_this.scale||32;\n      //$LASTPOS=26000391;//kernel.T2World:391\n      _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);\n      //$LASTPOS=26000516;//kernel.T2World:516\n      Tonyu.globals.$t2World=_this;\n      //$LASTPOS=26000536;//kernel.T2World:536\n      Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));\n      //$LASTPOS=26000572;//kernel.T2World:572\n      _this.on("die",Tonyu.bindFunc(_this,_this.releaseWorld));\n    },\n    fiber$initWorld :function _trc_T2World_f_initWorld(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b2World;\n      var b2Vec2;\n      \n      \n      _thread.enter(function _trc_T2World_ent_initWorld(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=26000183;//kernel.T2World:183\n            _this.fiber$defv(_thread, _this.gravity, 9.8);\n            __pc=1;return;\n          case 1:\n            _this.gravity=_thread.retVal;\n            \n            //$LASTPOS=26000216;//kernel.T2World:216\n            _this.fiber$defv(_thread, _this.gravityX, 0);\n            __pc=2;return;\n          case 2:\n            _this.gravityX=_thread.retVal;\n            \n            //$LASTPOS=26000249;//kernel.T2World:249\n            _this.fps=Tonyu.globals.$Boot.getFrameRate();\n            //$LASTPOS=26000280;//kernel.T2World:280\n            b2World = Box2D.Dynamics.b2World;\n            //$LASTPOS=26000323;//kernel.T2World:323\n            b2Vec2 = Box2D.Common.Math.b2Vec2;\n            //$LASTPOS=26000367;//kernel.T2World:367\n            _this.scale=_this.scale||32;\n            //$LASTPOS=26000391;//kernel.T2World:391\n            _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);\n            //$LASTPOS=26000516;//kernel.T2World:516\n            Tonyu.globals.$t2World=_this;\n            //$LASTPOS=26000536;//kernel.T2World:536\n            Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));\n            //$LASTPOS=26000572;//kernel.T2World:572\n            _this.on("die",Tonyu.bindFunc(_this,_this.releaseWorld));\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    releaseWorld :function _trc_T2World_releaseWorld() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26000623;//kernel.T2World:623\n      if (Tonyu.globals.$t2World===_this) {\n        //$LASTPOS=26000644;//kernel.T2World:644\n        Tonyu.globals.$t2World=null;\n      }\n    },\n    fiber$releaseWorld :function _trc_T2World_f_releaseWorld(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=26000623;//kernel.T2World:623\n      if (Tonyu.globals.$t2World===_this) {\n        //$LASTPOS=26000644;//kernel.T2World:644\n        Tonyu.globals.$t2World=null;\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    loop :function _trc_T2World_loop() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=26000680;//kernel.T2World:680\n      while (true) {\n        //$LASTPOS=26000703;//kernel.T2World:703\n        _this.fps=Tonyu.globals.$Boot.getFrameRate();\n        //$LASTPOS=26000738;//kernel.T2World:738\n        _this.world.Step(1/_this.fps,10,10);\n        //$LASTPOS=26000922;//kernel.T2World:922\n        _this.world.ClearForces();\n        //$LASTPOS=26000976;//kernel.T2World:976\n        _this.update();\n        \n      }\n    },\n    fiber$loop :function _trc_T2World_f_loop(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_T2World_ent_loop(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=26000680;//kernel.T2World:680\n          case 1:\n            //$LASTPOS=26000703;//kernel.T2World:703\n            _this.fps=Tonyu.globals.$Boot.getFrameRate();\n            //$LASTPOS=26000738;//kernel.T2World:738\n            _this.world.Step(1/_this.fps,10,10);\n            //$LASTPOS=26000922;//kernel.T2World:922\n            _this.world.ClearForces();\n            //$LASTPOS=26000976;//kernel.T2World:976\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    updatePos :function _trc_T2World_updatePos() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var b;\n      var d;\n      \n      //$LASTPOS=26001017;//kernel.T2World:1017\n      //$LASTPOS=26001022;//kernel.T2World:1022\n      b = _this.world.GetBodyList();\n      while(b) {\n        {\n          //$LASTPOS=26001076;//kernel.T2World:1076\n          d = b.GetUserData();\n          //$LASTPOS=26001108;//kernel.T2World:1108\n          if (d) {\n            //$LASTPOS=26001114;//kernel.T2World:1114\n            d.updatePos();\n          }\n        }\n        b=b.GetNext();\n      }\n    },\n    fiber$updatePos :function _trc_T2World_f_updatePos(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var b;\n      var d;\n      \n      //$LASTPOS=26001017;//kernel.T2World:1017\n      //$LASTPOS=26001022;//kernel.T2World:1022\n      b = _this.world.GetBodyList();\n      while(b) {\n        {\n          //$LASTPOS=26001076;//kernel.T2World:1076\n          d = b.GetUserData();\n          //$LASTPOS=26001108;//kernel.T2World:1108\n          if (d) {\n            //$LASTPOS=26001114;//kernel.T2World:1114\n            d.updatePos();\n          }\n        }\n        b=b.GetNext();\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"onAppear":{"nowait":false},"initWorld":{"nowait":false},"releaseWorld":{"nowait":false},"loop":{"nowait":false},"updatePos":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T2MediaPlayer\',\n  shortName: \'T2MediaPlayer\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_T2MediaPlayer_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T2MediaPlayer_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_T2MediaPlayer_initialize() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27000069;//kernel.T2MediaPlayer:69\n      _this.initT2MediaPlayer();\n    },\n    initT2MediaPlayer :function _trc_T2MediaPlayer_initT2MediaPlayer() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27000124;//kernel.T2MediaPlayer:124\n      if (T2MediaLib.inited) {\n        return _this;\n      }\n      //$LASTPOS=27000160;//kernel.T2MediaPlayer:160\n      T2MediaLib.init();\n      //$LASTPOS=27000184;//kernel.T2MediaPlayer:184\n      T2MediaLib.inited=true;\n      //$LASTPOS=27000213;//kernel.T2MediaPlayer:213\n      _this.bgmPlayerMax=T2MediaLib.bgmPlayerMax;\n    },\n    fiber$initT2MediaPlayer :function _trc_T2MediaPlayer_f_initT2MediaPlayer(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27000124;//kernel.T2MediaPlayer:124\n      if (T2MediaLib.inited) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=27000160;//kernel.T2MediaPlayer:160\n      T2MediaLib.init();\n      //$LASTPOS=27000184;//kernel.T2MediaPlayer:184\n      T2MediaLib.inited=true;\n      //$LASTPOS=27000213;//kernel.T2MediaPlayer:213\n      _this.bgmPlayerMax=T2MediaLib.bgmPlayerMax;\n      \n      _thread.retVal=_this;return;\n    },\n    clearSEData :function _trc_T2MediaPlayer_clearSEData() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27000281;//kernel.T2MediaPlayer:281\n      T2MediaLib.allStopBGM();\n      //$LASTPOS=27000311;//kernel.T2MediaPlayer:311\n      T2MediaLib.allClearData();\n    },\n    fiber$clearSEData :function _trc_T2MediaPlayer_f_clearSEData(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27000281;//kernel.T2MediaPlayer:281\n      T2MediaLib.allStopBGM();\n      //$LASTPOS=27000311;//kernel.T2MediaPlayer:311\n      T2MediaLib.allClearData();\n      \n      _thread.retVal=_this;return;\n    },\n    clearBGMData :function _trc_T2MediaPlayer_clearBGMData() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27000367;//kernel.T2MediaPlayer:367\n      _this.clearSEData();\n    },\n    fiber$clearBGMData :function _trc_T2MediaPlayer_f_clearBGMData(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_T2MediaPlayer_ent_clearBGMData(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=27000367;//kernel.T2MediaPlayer:367\n            _this.fiber$clearSEData(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    deleteSEData :function _trc_T2MediaPlayer_deleteSEData(idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27000414;//kernel.T2MediaPlayer:414\n      T2MediaLib.clearData(idx);\n    },\n    fiber$deleteSEData :function _trc_T2MediaPlayer_f_deleteSEData(_thread,idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27000414;//kernel.T2MediaPlayer:414\n      T2MediaLib.clearData(idx);\n      \n      _thread.retVal=_this;return;\n    },\n    loadSE :function _trc_T2MediaPlayer_loadSE(idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var data;\n      \n      //$LASTPOS=27000508;//kernel.T2MediaPlayer:508\n      _this.runAsync((function anonymous_517(succ,err) {\n        \n        //$LASTPOS=27000567;//kernel.T2MediaPlayer:567\n        T2MediaLib.loadSE(idx,src,{succ: succ,err: err});\n      }));\n      //$LASTPOS=27000620;//kernel.T2MediaPlayer:620\n      data = T2MediaLib.getSEData(idx);\n      return data;\n    },\n    fiber$loadSE :function _trc_T2MediaPlayer_f_loadSE(_thread,idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var data;\n      \n      \n      _thread.enter(function _trc_T2MediaPlayer_ent_loadSE(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=27000508;//kernel.T2MediaPlayer:508\n            _this.fiber$runAsync(_thread, (function anonymous_517(succ,err) {\n              \n              //$LASTPOS=27000567;//kernel.T2MediaPlayer:567\n              T2MediaLib.loadSE(idx,src,{succ: succ,err: err});\n            }));\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=27000620;//kernel.T2MediaPlayer:620\n            data = T2MediaLib.getSEData(idx);\n            _thread.exit(data);return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    __getter__available :function _trc_T2MediaPlayer___getter__available() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return ! ! T2MediaLib.context;\n    },\n    loadFromProject :function _trc_T2MediaPlayer_loadFromProject(prj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var r;\n      var s;\n      var _it_252;\n      var name;\n      var url;\n      var e;\n      \n      //$LASTPOS=27000881;//kernel.T2MediaPlayer:881\n      if (! _this.available) {\n        return _this;\n      }\n      //$LASTPOS=27000910;//kernel.T2MediaPlayer:910\n      r = prj.getResource();\n      //$LASTPOS=27000940;//kernel.T2MediaPlayer:940\n      if (! r||! r.sounds) {\n        return _this;\n      }\n      //$LASTPOS=27000974;//kernel.T2MediaPlayer:974\n      _it_252=Tonyu.iterator(r.sounds,1);\n      while(_it_252.next()) {\n        s=_it_252[0];\n        \n        //$LASTPOS=27001010;//kernel.T2MediaPlayer:1010\n        name = s.name;url = Tonyu.Assets.resolve(s.url,prj.getDir());\n        //$LASTPOS=27001084;//kernel.T2MediaPlayer:1084\n        Tonyu.setGlobal(name,name);\n        try {\n          //$LASTPOS=27001142;//kernel.T2MediaPlayer:1142\n          _this.print("Loading Sound: "+name);\n          //$LASTPOS=27001186;//kernel.T2MediaPlayer:1186\n          _this.loadSE(name,url);\n          \n        } catch (e) {\n          //$LASTPOS=27001241;//kernel.T2MediaPlayer:1241\n          _this.print("Fail");\n          //$LASTPOS=27001269;//kernel.T2MediaPlayer:1269\n          Tonyu.setGlobal(name,"ERROR");\n          \n        }\n        \n      }\n    },\n    fiber$loadFromProject :function _trc_T2MediaPlayer_f_loadFromProject(_thread,prj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var r;\n      var s;\n      var _it_252;\n      var name;\n      var url;\n      var e;\n      \n      //$LASTPOS=27000881;//kernel.T2MediaPlayer:881\n      if (! _this.available) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=27000910;//kernel.T2MediaPlayer:910\n      r = prj.getResource();\n      //$LASTPOS=27000940;//kernel.T2MediaPlayer:940\n      if (! r||! r.sounds) {\n        _thread.retVal=_this;return;\n        \n      }\n      \n      _thread.enter(function _trc_T2MediaPlayer_ent_loadFromProject(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=27000974;//kernel.T2MediaPlayer:974\n            _it_252=Tonyu.iterator(r.sounds,1);\n          case 1:\n            if (!(_it_252.next())) { __pc=5; break; }\n            s=_it_252[0];\n            \n            //$LASTPOS=27001010;//kernel.T2MediaPlayer:1010\n            name = s.name;url = Tonyu.Assets.resolve(s.url,prj.getDir());\n            //$LASTPOS=27001084;//kernel.T2MediaPlayer:1084\n            Tonyu.setGlobal(name,name);\n            _thread.enterTry(3);\n            //$LASTPOS=27001142;//kernel.T2MediaPlayer:1142\n            _this.print("Loading Sound: "+name);\n            //$LASTPOS=27001186;//kernel.T2MediaPlayer:1186\n            _this.fiber$loadSE(_thread, name, url);\n            __pc=2;return;\n          case 2:\n            _thread.exitTry();\n            __pc=4;break;\n          case 3:\n            e=_thread.startCatch();\n            _thread.exitTry();\n            {\n              //$LASTPOS=27001241;//kernel.T2MediaPlayer:1241\n              _this.print("Fail");\n              //$LASTPOS=27001269;//kernel.T2MediaPlayer:1269\n              Tonyu.setGlobal(name,"ERROR");\n            }\n          case 4:\n            \n            __pc=1;break;\n          case 5:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    playSE :function _trc_T2MediaPlayer_playSE(idx,vol,rate,offset,loop,loopStart,loopEnd) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27001407;//kernel.T2MediaPlayer:1407\n      if (_this.mute) {\n        return _this;\n      }\n      //$LASTPOS=27001466;//kernel.T2MediaPlayer:1466\n      if (vol==null) {\n        //$LASTPOS=27001483;//kernel.T2MediaPlayer:1483\n        vol=128;\n      }\n      //$LASTPOS=27001572;//kernel.T2MediaPlayer:1572\n      if (vol<0) {\n        //$LASTPOS=27001592;//kernel.T2MediaPlayer:1592\n        vol=0;\n      } else {\n        //$LASTPOS=27001613;//kernel.T2MediaPlayer:1613\n        if (vol>128) {\n          //$LASTPOS=27001628;//kernel.T2MediaPlayer:1628\n          vol=128;\n        }\n      }\n      return T2MediaLib.playSE(idx,vol/128,rate,offset,loop,loopStart,loopEnd);\n    },\n    stopSE :function _trc_T2MediaPlayer_stopSE(sourceObj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.stopSE(sourceObj);\n    },\n    fiber$stopSE :function _trc_T2MediaPlayer_f_stopSE(_thread,sourceObj) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.stopSE(sourceObj);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getSEData :function _trc_T2MediaPlayer_getSEData(idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getSEData(idx);\n    },\n    fiber$getSEData :function _trc_T2MediaPlayer_f_getSEData(_thread,idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getSEData(idx);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    loadBGM :function _trc_T2MediaPlayer_loadBGM(idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var data;\n      \n      //$LASTPOS=27001919;//kernel.T2MediaPlayer:1919\n      T2MediaLib.loadBGM(idx,src);\n      //$LASTPOS=27001979;//kernel.T2MediaPlayer:1979\n      data = T2MediaLib.getBGMData(idx);\n      //$LASTPOS=27002023;//kernel.T2MediaPlayer:2023\n      while (data==null) {\n        //$LASTPOS=27002055;//kernel.T2MediaPlayer:2055\n        _this.update();\n        //$LASTPOS=27002074;//kernel.T2MediaPlayer:2074\n        data=T2MediaLib.getBGMData(idx);\n        \n      }\n      return data;\n    },\n    fiber$loadBGM :function _trc_T2MediaPlayer_f_loadBGM(_thread,idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var data;\n      \n      //$LASTPOS=27001919;//kernel.T2MediaPlayer:1919\n      T2MediaLib.loadBGM(idx,src);\n      //$LASTPOS=27001979;//kernel.T2MediaPlayer:1979\n      data = T2MediaLib.getBGMData(idx);\n      \n      _thread.enter(function _trc_T2MediaPlayer_ent_loadBGM(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=27002023;//kernel.T2MediaPlayer:2023\n          case 1:\n            if (!(data==null)) { __pc=3; break; }\n            //$LASTPOS=27002055;//kernel.T2MediaPlayer:2055\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=27002074;//kernel.T2MediaPlayer:2074\n            data=T2MediaLib.getBGMData(idx);\n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(data);return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    playBGM :function _trc_T2MediaPlayer_playBGM(idx,loop,offset,loopStart,loopEnd) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27002195;//kernel.T2MediaPlayer:2195\n      if (_this.mute) {\n        return _this;\n      }\n      //$LASTPOS=27002218;//kernel.T2MediaPlayer:2218\n      if (loop===null) {\n        //$LASTPOS=27002237;//kernel.T2MediaPlayer:2237\n        loop=false;\n      }\n      //$LASTPOS=27002256;//kernel.T2MediaPlayer:2256\n      if (offset===null) {\n        //$LASTPOS=27002277;//kernel.T2MediaPlayer:2277\n        offset=0;\n      }\n      return T2MediaLib.playBGM(0,idx,loop,offset,loopStart,loopEnd);\n    },\n    fiber$playBGM :function _trc_T2MediaPlayer_f_playBGM(_thread,idx,loop,offset,loopStart,loopEnd) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27002195;//kernel.T2MediaPlayer:2195\n      if (_this.mute) {\n        _thread.retVal=_this;return;\n        \n      }\n      //$LASTPOS=27002218;//kernel.T2MediaPlayer:2218\n      if (loop===null) {\n        //$LASTPOS=27002237;//kernel.T2MediaPlayer:2237\n        loop=false;\n      }\n      //$LASTPOS=27002256;//kernel.T2MediaPlayer:2256\n      if (offset===null) {\n        //$LASTPOS=27002277;//kernel.T2MediaPlayer:2277\n        offset=0;\n      }\n      _thread.retVal=T2MediaLib.playBGM(0,idx,loop,offset,loopStart,loopEnd);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stopBGM :function _trc_T2MediaPlayer_stopBGM() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.stopBGM(0);\n    },\n    fiber$stopBGM :function _trc_T2MediaPlayer_f_stopBGM(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.stopBGM(0);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    pauseBGM :function _trc_T2MediaPlayer_pauseBGM() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.pauseBGM(0);\n    },\n    fiber$pauseBGM :function _trc_T2MediaPlayer_f_pauseBGM(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.pauseBGM(0);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    resumeBGM :function _trc_T2MediaPlayer_resumeBGM() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.resumeBGM(0);\n    },\n    fiber$resumeBGM :function _trc_T2MediaPlayer_f_resumeBGM(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.resumeBGM(0);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGMVolume :function _trc_T2MediaPlayer_setBGMVolume(vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27002563;//kernel.T2MediaPlayer:2563\n      vol=vol/128;\n      //$LASTPOS=27002658;//kernel.T2MediaPlayer:2658\n      if (vol>1) {\n        //$LASTPOS=27002678;//kernel.T2MediaPlayer:2678\n        vol=1;\n      } else {\n        //$LASTPOS=27002699;//kernel.T2MediaPlayer:2699\n        if (vol<0) {\n          //$LASTPOS=27002714;//kernel.T2MediaPlayer:2714\n          vol=0;\n        }\n      }\n      return T2MediaLib.setBGMVolume(0,vol);\n    },\n    fiber$setBGMVolume :function _trc_T2MediaPlayer_f_setBGMVolume(_thread,vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27002563;//kernel.T2MediaPlayer:2563\n      vol=vol/128;\n      //$LASTPOS=27002658;//kernel.T2MediaPlayer:2658\n      if (vol>1) {\n        //$LASTPOS=27002678;//kernel.T2MediaPlayer:2678\n        vol=1;\n      } else {\n        //$LASTPOS=27002699;//kernel.T2MediaPlayer:2699\n        if (vol<0) {\n          //$LASTPOS=27002714;//kernel.T2MediaPlayer:2714\n          vol=0;\n        }\n      }\n      _thread.retVal=T2MediaLib.setBGMVolume(0,vol);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGMTempo :function _trc_T2MediaPlayer_setBGMTempo(tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.setBGMTempo(0,tempo);\n    },\n    fiber$setBGMTempo :function _trc_T2MediaPlayer_f_setBGMTempo(_thread,tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.setBGMTempo(0,tempo);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getBGMCurrentTime :function _trc_T2MediaPlayer_getBGMCurrentTime() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMCurrentTime(0);\n    },\n    fiber$getBGMCurrentTime :function _trc_T2MediaPlayer_f_getBGMCurrentTime(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMCurrentTime(0);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getBGMLength :function _trc_T2MediaPlayer_getBGMLength() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMLength(0);\n    },\n    fiber$getBGMLength :function _trc_T2MediaPlayer_f_getBGMLength(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMLength(0);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getBGMData :function _trc_T2MediaPlayer_getBGMData(idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMData(idx);\n    },\n    fiber$getBGMData :function _trc_T2MediaPlayer_f_getBGMData(_thread,idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMData(idx);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    playBGMID :function _trc_T2MediaPlayer_playBGMID(id,idx,loop,offset,loopStart,loopEnd) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27003218;//kernel.T2MediaPlayer:3218\n      if (loop===null) {\n        //$LASTPOS=27003237;//kernel.T2MediaPlayer:3237\n        loop=false;\n      }\n      //$LASTPOS=27003256;//kernel.T2MediaPlayer:3256\n      if (offset===null) {\n        //$LASTPOS=27003277;//kernel.T2MediaPlayer:3277\n        offset=0;\n      }\n      return T2MediaLib.playBGM(id,idx,loop,offset,loopStart,loopEnd);\n    },\n    fiber$playBGMID :function _trc_T2MediaPlayer_f_playBGMID(_thread,id,idx,loop,offset,loopStart,loopEnd) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27003218;//kernel.T2MediaPlayer:3218\n      if (loop===null) {\n        //$LASTPOS=27003237;//kernel.T2MediaPlayer:3237\n        loop=false;\n      }\n      //$LASTPOS=27003256;//kernel.T2MediaPlayer:3256\n      if (offset===null) {\n        //$LASTPOS=27003277;//kernel.T2MediaPlayer:3277\n        offset=0;\n      }\n      _thread.retVal=T2MediaLib.playBGM(id,idx,loop,offset,loopStart,loopEnd);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stopBGMID :function _trc_T2MediaPlayer_stopBGMID(id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.stopBGM(id);\n    },\n    fiber$stopBGMID :function _trc_T2MediaPlayer_f_stopBGMID(_thread,id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.stopBGM(id);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    pauseBGMID :function _trc_T2MediaPlayer_pauseBGMID(id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.pauseBGM(id);\n    },\n    fiber$pauseBGMID :function _trc_T2MediaPlayer_f_pauseBGMID(_thread,id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.pauseBGM(id);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    resumeBGMID :function _trc_T2MediaPlayer_resumeBGMID(id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.resumeBGM(id);\n    },\n    fiber$resumeBGMID :function _trc_T2MediaPlayer_f_resumeBGMID(_thread,id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.resumeBGM(id);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGMVolumeID :function _trc_T2MediaPlayer_setBGMVolumeID(id,vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27003585;//kernel.T2MediaPlayer:3585\n      vol=vol/128;\n      //$LASTPOS=27003680;//kernel.T2MediaPlayer:3680\n      if (vol>1) {\n        //$LASTPOS=27003700;//kernel.T2MediaPlayer:3700\n        vol=1;\n      } else {\n        //$LASTPOS=27003721;//kernel.T2MediaPlayer:3721\n        if (vol<0) {\n          //$LASTPOS=27003736;//kernel.T2MediaPlayer:3736\n          vol=0;\n        }\n      }\n      return T2MediaLib.setBGMVolume(id,vol);\n    },\n    fiber$setBGMVolumeID :function _trc_T2MediaPlayer_f_setBGMVolumeID(_thread,id,vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27003585;//kernel.T2MediaPlayer:3585\n      vol=vol/128;\n      //$LASTPOS=27003680;//kernel.T2MediaPlayer:3680\n      if (vol>1) {\n        //$LASTPOS=27003700;//kernel.T2MediaPlayer:3700\n        vol=1;\n      } else {\n        //$LASTPOS=27003721;//kernel.T2MediaPlayer:3721\n        if (vol<0) {\n          //$LASTPOS=27003736;//kernel.T2MediaPlayer:3736\n          vol=0;\n        }\n      }\n      _thread.retVal=T2MediaLib.setBGMVolume(id,vol);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGMTempoID :function _trc_T2MediaPlayer_setBGMTempoID(id,tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.setBGMTempo(id,tempo);\n    },\n    fiber$setBGMTempoID :function _trc_T2MediaPlayer_f_setBGMTempoID(_thread,id,tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.setBGMTempo(id,tempo);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getBGMCurrentTimeID :function _trc_T2MediaPlayer_getBGMCurrentTimeID(id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMCurrentTime(id);\n    },\n    fiber$getBGMCurrentTimeID :function _trc_T2MediaPlayer_f_getBGMCurrentTimeID(_thread,id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMCurrentTime(id);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getBGMLengthID :function _trc_T2MediaPlayer_getBGMLengthID(id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMLength(id);\n    },\n    fiber$getBGMLengthID :function _trc_T2MediaPlayer_f_getBGMLengthID(_thread,id) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMLength(id);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    sizeBGMID :function _trc_T2MediaPlayer_sizeBGMID() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getBGMPlayerMax();\n    },\n    fiber$sizeBGMID :function _trc_T2MediaPlayer_f_sizeBGMID(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getBGMPlayerMax();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    allStopBGM :function _trc_T2MediaPlayer_allStopBGM() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27004196;//kernel.T2MediaPlayer:4196\n      T2MediaLib.allStopBGM();\n    },\n    fiber$allStopBGM :function _trc_T2MediaPlayer_f_allStopBGM(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27004196;//kernel.T2MediaPlayer:4196\n      T2MediaLib.allStopBGM();\n      \n      _thread.retVal=_this;return;\n    },\n    loadAudio :function _trc_T2MediaPlayer_loadAudio(idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27004275;//kernel.T2MediaPlayer:4275\n      T2MediaLib.loadAudio(idx,src);\n      //$LASTPOS=27004337;//kernel.T2MediaPlayer:4337\n      while (T2MediaLib.getAudioData(idx)==null) {\n        //$LASTPOS=27004382;//kernel.T2MediaPlayer:4382\n        _this.update();\n      }\n    },\n    fiber$loadAudio :function _trc_T2MediaPlayer_f_loadAudio(_thread,idx,src) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27004275;//kernel.T2MediaPlayer:4275\n      T2MediaLib.loadAudio(idx,src);\n      \n      _thread.enter(function _trc_T2MediaPlayer_ent_loadAudio(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=27004337;//kernel.T2MediaPlayer:4337\n          case 1:\n            if (!(T2MediaLib.getAudioData(idx)==null)) { __pc=3; break; }\n            //$LASTPOS=27004382;//kernel.T2MediaPlayer:4382\n            _this.fiber$update(_thread);\n            __pc=2;return;\n          case 2:\n            \n            __pc=1;break;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    playAudio :function _trc_T2MediaPlayer_playAudio(idx,loop,startTime) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27004438;//kernel.T2MediaPlayer:4438\n      if (loop===null) {\n        //$LASTPOS=27004457;//kernel.T2MediaPlayer:4457\n        loop=false;\n      }\n      //$LASTPOS=27004476;//kernel.T2MediaPlayer:4476\n      if (startTime===null) {\n        //$LASTPOS=27004500;//kernel.T2MediaPlayer:4500\n        startTime=0;\n      }\n      return T2MediaLib.playAudio(idx,loop,startTime);\n    },\n    fiber$playAudio :function _trc_T2MediaPlayer_f_playAudio(_thread,idx,loop,startTime) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27004438;//kernel.T2MediaPlayer:4438\n      if (loop===null) {\n        //$LASTPOS=27004457;//kernel.T2MediaPlayer:4457\n        loop=false;\n      }\n      //$LASTPOS=27004476;//kernel.T2MediaPlayer:4476\n      if (startTime===null) {\n        //$LASTPOS=27004500;//kernel.T2MediaPlayer:4500\n        startTime=0;\n      }\n      _thread.retVal=T2MediaLib.playAudio(idx,loop,startTime);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    stopAudio :function _trc_T2MediaPlayer_stopAudio() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.stopAudio();\n    },\n    fiber$stopAudio :function _trc_T2MediaPlayer_f_stopAudio(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.stopAudio();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    pauseAudio :function _trc_T2MediaPlayer_pauseAudio() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.pauseAudio();\n    },\n    fiber$pauseAudio :function _trc_T2MediaPlayer_f_pauseAudio(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.pauseAudio();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    resumeAudio :function _trc_T2MediaPlayer_resumeAudio() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.resumeAudio();\n    },\n    fiber$resumeAudio :function _trc_T2MediaPlayer_f_resumeAudio(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.resumeAudio();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setAudioVolume :function _trc_T2MediaPlayer_setAudioVolume(vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27004782;//kernel.T2MediaPlayer:4782\n      vol=vol/128;\n      //$LASTPOS=27004804;//kernel.T2MediaPlayer:4804\n      if (vol>1) {\n        //$LASTPOS=27004824;//kernel.T2MediaPlayer:4824\n        vol=1;\n      } else {\n        //$LASTPOS=27004845;//kernel.T2MediaPlayer:4845\n        if (vol<0) {\n          //$LASTPOS=27004860;//kernel.T2MediaPlayer:4860\n          vol=0;\n        }\n      }\n      return T2MediaLib.setAudioVolume(vol);\n    },\n    fiber$setAudioVolume :function _trc_T2MediaPlayer_f_setAudioVolume(_thread,vol) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27004782;//kernel.T2MediaPlayer:4782\n      vol=vol/128;\n      //$LASTPOS=27004804;//kernel.T2MediaPlayer:4804\n      if (vol>1) {\n        //$LASTPOS=27004824;//kernel.T2MediaPlayer:4824\n        vol=1;\n      } else {\n        //$LASTPOS=27004845;//kernel.T2MediaPlayer:4845\n        if (vol<0) {\n          //$LASTPOS=27004860;//kernel.T2MediaPlayer:4860\n          vol=0;\n        }\n      }\n      _thread.retVal=T2MediaLib.setAudioVolume(vol);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setAudioTempo :function _trc_T2MediaPlayer_setAudioTempo(tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=27004950;//kernel.T2MediaPlayer:4950\n      if (tempo>4) {\n        //$LASTPOS=27004972;//kernel.T2MediaPlayer:4972\n        tempo=4;\n      } else {\n        //$LASTPOS=27004995;//kernel.T2MediaPlayer:4995\n        if (tempo<0.5) {\n          //$LASTPOS=27005012;//kernel.T2MediaPlayer:5012\n          tempo=0.5;\n        }\n      }\n      return T2MediaLib.setAudioTempo(tempo);\n    },\n    fiber$setAudioTempo :function _trc_T2MediaPlayer_f_setAudioTempo(_thread,tempo) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=27004950;//kernel.T2MediaPlayer:4950\n      if (tempo>4) {\n        //$LASTPOS=27004972;//kernel.T2MediaPlayer:4972\n        tempo=4;\n      } else {\n        //$LASTPOS=27004995;//kernel.T2MediaPlayer:4995\n        if (tempo<0.5) {\n          //$LASTPOS=27005012;//kernel.T2MediaPlayer:5012\n          tempo=0.5;\n        }\n      }\n      _thread.retVal=T2MediaLib.setAudioTempo(tempo);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setAudioPosition :function _trc_T2MediaPlayer_setAudioPosition(time) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.setAudioPosition(time);\n    },\n    fiber$setAudioPosition :function _trc_T2MediaPlayer_f_setAudioPosition(_thread,time) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.setAudioPosition(time);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getAudioCurrentTime :function _trc_T2MediaPlayer_getAudioCurrentTime() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getAudioCurrentTime();\n    },\n    fiber$getAudioCurrentTime :function _trc_T2MediaPlayer_f_getAudioCurrentTime(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getAudioCurrentTime();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getAudioLength :function _trc_T2MediaPlayer_getAudioLength() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getAudioLength();\n    },\n    fiber$getAudioLength :function _trc_T2MediaPlayer_f_getAudioLength(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getAudioLength();return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getAudioData :function _trc_T2MediaPlayer_getAudioData(idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return T2MediaLib.getAudioData(idx);\n    },\n    fiber$getAudioData :function _trc_T2MediaPlayer_f_getAudioData(_thread,idx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=T2MediaLib.getAudioData(idx);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"initT2MediaPlayer":{"nowait":false},"clearSEData":{"nowait":false},"clearBGMData":{"nowait":false},"deleteSEData":{"nowait":false},"loadSE":{"nowait":false},"__getter__available":{"nowait":true},"loadFromProject":{"nowait":false},"playSE":{"nowait":true},"stopSE":{"nowait":false},"getSEData":{"nowait":false},"loadBGM":{"nowait":false},"playBGM":{"nowait":false},"stopBGM":{"nowait":false},"pauseBGM":{"nowait":false},"resumeBGM":{"nowait":false},"setBGMVolume":{"nowait":false},"setBGMTempo":{"nowait":false},"getBGMCurrentTime":{"nowait":false},"getBGMLength":{"nowait":false},"getBGMData":{"nowait":false},"playBGMID":{"nowait":false},"stopBGMID":{"nowait":false},"pauseBGMID":{"nowait":false},"resumeBGMID":{"nowait":false},"setBGMVolumeID":{"nowait":false},"setBGMTempoID":{"nowait":false},"getBGMCurrentTimeID":{"nowait":false},"getBGMLengthID":{"nowait":false},"sizeBGMID":{"nowait":false},"allStopBGM":{"nowait":false},"loadAudio":{"nowait":false},"playAudio":{"nowait":false},"stopAudio":{"nowait":false},"pauseAudio":{"nowait":false},"resumeAudio":{"nowait":false},"setAudioVolume":{"nowait":false},"setAudioTempo":{"nowait":false},"setAudioPosition":{"nowait":false},"getAudioCurrentTime":{"nowait":false},"getAudioLength":{"nowait":false},"getAudioData":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.PlainChar\',\n  shortName: \'PlainChar\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_PlainChar_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_PlainChar_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_PlainChar_initialize(x,y,p) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28000066;//kernel.PlainChar:66\n      if (Tonyu.runMode) {\n        //$LASTPOS=28000309;//kernel.PlainChar:309\n        _this._th=Tonyu.globals.$Boot.schedule(_this,"tMain",[]);\n        //$LASTPOS=28000355;//kernel.PlainChar:355\n        _this.initSprite();\n        \n      }\n      //$LASTPOS=28000381;//kernel.PlainChar:381\n      if (typeof  x=="object") {\n        //$LASTPOS=28000405;//kernel.PlainChar:405\n        Tonyu.extend(_this,x);\n      } else {\n        //$LASTPOS=28000437;//kernel.PlainChar:437\n        if (typeof  x=="number") {\n          //$LASTPOS=28000472;//kernel.PlainChar:472\n          _this.x=x;\n          //$LASTPOS=28000491;//kernel.PlainChar:491\n          _this.y=y;\n          //$LASTPOS=28000510;//kernel.PlainChar:510\n          _this.p=p;\n          \n        }\n      }\n    },\n    draw :function _trc_PlainChar_draw(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28000547;//kernel.PlainChar:547\n      _this.onDraw();\n      //$LASTPOS=28000562;//kernel.PlainChar:562\n      if (_this._isInvisible) {\n        return _this;\n      }\n      //$LASTPOS=28000593;//kernel.PlainChar:593\n      Tonyu.classes.kernel.Actor.prototype.draw.apply( _this, [c]);\n    },\n    setVisible :function _trc_PlainChar_setVisible(v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28000634;//kernel.PlainChar:634\n      _this._isInvisible=! v;\n    },\n    fiber$setVisible :function _trc_PlainChar_f_setVisible(_thread,v) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=28000634;//kernel.PlainChar:634\n      _this._isInvisible=! v;\n      \n      _thread.retVal=_this;return;\n    },\n    onDraw :function _trc_PlainChar_onDraw() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$onDraw :function _trc_PlainChar_f_onDraw(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    update :function _trc_PlainChar_update() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28000690;//kernel.PlainChar:690\n      _this.onUpdate();\n      //$LASTPOS=28000707;//kernel.PlainChar:707\n      Tonyu.classes.kernel.Actor.prototype.update.apply( _this, []);\n    },\n    fiber$update :function _trc_PlainChar_f_update(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=28000690;//kernel.PlainChar:690\n      _this.onUpdate();\n      \n      _thread.enter(function _trc_PlainChar_ent_update(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=28000707;//kernel.PlainChar:707\n            Tonyu.classes.kernel.Actor.prototype.fiber$update.apply( _this, [_thread]);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    onUpdate :function _trc_PlainChar_onUpdate() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    initSprite :function _trc_PlainChar_initSprite() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28000768;//kernel.PlainChar:768\n      if (_this.layer&&typeof  _this.layer.add=="function") {\n        //$LASTPOS=28000820;//kernel.PlainChar:820\n        _this.layer.add(_this);\n        \n      } else {\n        //$LASTPOS=28000858;//kernel.PlainChar:858\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      //$LASTPOS=28000890;//kernel.PlainChar:890\n      _this.onAppear();\n    },\n    fiber$initSprite :function _trc_PlainChar_f_initSprite(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=28000768;//kernel.PlainChar:768\n      if (_this.layer&&typeof  _this.layer.add=="function") {\n        //$LASTPOS=28000820;//kernel.PlainChar:820\n        _this.layer.add(_this);\n        \n      } else {\n        //$LASTPOS=28000858;//kernel.PlainChar:858\n        Tonyu.globals.$Sprites.add(_this);\n        \n      }\n      \n      _thread.enter(function _trc_PlainChar_ent_initSprite(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=28000890;//kernel.PlainChar:890\n            _this.fiber$onAppear(_thread);\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    tMain :function _trc_PlainChar_tMain() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28000922;//kernel.PlainChar:922\n      _this.main();\n      //$LASTPOS=28000935;//kernel.PlainChar:935\n      _this.die();\n    },\n    fiber$tMain :function _trc_PlainChar_f_tMain(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_PlainChar_ent_tMain(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=28000922;//kernel.PlainChar:922\n            _this.fiber$main(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=28000935;//kernel.PlainChar:935\n            _this.die();\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    appear :function _trc_PlainChar_appear(t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return t;\n    },\n    fiber$appear :function _trc_PlainChar_f_appear(_thread,t) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=t;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    trunc :function _trc_PlainChar_trunc(f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return Math.trunc(f);\n    },\n    loadPage :function _trc_PlainChar_loadPage(page,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=28001673;//kernel.PlainChar:1673\n      _this.all().die();\n      //$LASTPOS=28001691;//kernel.PlainChar:1691\n      new page(arg);\n      //$LASTPOS=28001711;//kernel.PlainChar:1711\n      _this.die();\n    },\n    fiber$loadPage :function _trc_PlainChar_f_loadPage(_thread,page,arg) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=28001673;//kernel.PlainChar:1673\n      _this.all().die();\n      //$LASTPOS=28001691;//kernel.PlainChar:1691\n      new page(arg);\n      //$LASTPOS=28001711;//kernel.PlainChar:1711\n      _this.die();\n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true},"setVisible":{"nowait":false},"onDraw":{"nowait":false},"update":{"nowait":false},"onUpdate":{"nowait":true},"initSprite":{"nowait":false},"tMain":{"nowait":false},"appear":{"nowait":false},"trunc":{"nowait":true},"loadPage":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.SecretChar\',\n  shortName: \'SecretChar\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.PlainChar,\n  includes: [],\n  methods: {\n    main :function _trc_SecretChar_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_SecretChar_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_SecretChar_draw(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.SpriteChar\',\n  shortName: \'SpriteChar\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.PlainChar,\n  includes: [],\n  methods: {\n    main :function _trc_SpriteChar_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_SpriteChar_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_SpriteChar_initialize(x,y,p,f) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=29000043;//kernel.SpriteChar:43\n      Tonyu.classes.kernel.PlainChar.apply( _this, [x,y,p]);\n      //$LASTPOS=29000062;//kernel.SpriteChar:62\n      _this.f=f;\n      //$LASTPOS=29000077;//kernel.SpriteChar:77\n      if (! _this.x) {\n        //$LASTPOS=29000090;//kernel.SpriteChar:90\n        _this.x=0;\n      }\n      //$LASTPOS=29000105;//kernel.SpriteChar:105\n      if (! _this.y) {\n        //$LASTPOS=29000118;//kernel.SpriteChar:118\n        _this.y=0;\n      }\n      //$LASTPOS=29000133;//kernel.SpriteChar:133\n      if (! _this.p) {\n        //$LASTPOS=29000146;//kernel.SpriteChar:146\n        _this.p=0;\n      }\n    },\n    draw :function _trc_SpriteChar_draw(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=29000176;//kernel.SpriteChar:176\n      if (_this.f) {\n        //$LASTPOS=29000194;//kernel.SpriteChar:194\n        if (! _this.scaleY) {\n          //$LASTPOS=29000207;//kernel.SpriteChar:207\n          _this.scaleY=_this.scaleX;\n        }\n        //$LASTPOS=29000231;//kernel.SpriteChar:231\n        _this.scaleX*=- 1;\n        \n      }\n      //$LASTPOS=29000255;//kernel.SpriteChar:255\n      Tonyu.classes.kernel.PlainChar.prototype.draw.apply( _this, [c]);\n      //$LASTPOS=29000275;//kernel.SpriteChar:275\n      if (_this.f) {\n        //$LASTPOS=29000282;//kernel.SpriteChar:282\n        _this.scaleX*=- 1;\n      }\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T1Line\',\n  shortName: \'T1Line\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_T1Line_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T1Line_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_T1Line_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=30000034;//kernel.T1Line:34\n      if (_this.hidden) {\n        return _this;\n      }\n      //$LASTPOS=30000065;//kernel.T1Line:65\n      ctx.strokeStyle=_this.col;\n      //$LASTPOS=30000091;//kernel.T1Line:91\n      ctx.beginPath();\n      //$LASTPOS=30000113;//kernel.T1Line:113\n      ctx.moveTo(_this.x,_this.y);\n      //$LASTPOS=30000135;//kernel.T1Line:135\n      ctx.lineTo(_this.tx,_this.ty);\n      //$LASTPOS=30000159;//kernel.T1Line:159\n      ctx.stroke();\n      //$LASTPOS=30000178;//kernel.T1Line:178\n      _this.hidden=true;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T1Map\',\n  shortName: \'T1Map\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Map,\n  includes: [],\n  methods: {\n    main :function _trc_T1Map_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T1Map_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    setBGColor :function _trc_T1Map_setBGColor(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=31000064;//kernel.T1Map:64\n      Tonyu.globals.$Screen.setBGColor(c);\n    },\n    fiber$setBGColor :function _trc_T1Map_f_setBGColor(_thread,c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=31000064;//kernel.T1Map:64\n      Tonyu.globals.$Screen.setBGColor(c);\n      \n      _thread.retVal=_this;return;\n    },\n    load :function _trc_T1Map_load(fileName) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var f;\n      var o;\n      \n      //$LASTPOS=31000469;//kernel.T1Map:469\n      f = _this.file("../maps/").rel(fileName);\n      //$LASTPOS=31000512;//kernel.T1Map:512\n      o = f.obj();\n      //$LASTPOS=31000532;//kernel.T1Map:532\n      _this.chipWidth=o.chipWidth;\n      //$LASTPOS=31000560;//kernel.T1Map:560\n      _this.chipHeight=o.chipHeight;\n      //$LASTPOS=31000590;//kernel.T1Map:590\n      _this.baseData=o.baseData;\n      //$LASTPOS=31000616;//kernel.T1Map:616\n      _this.mapTable=_this.conv(_this.baseData[0],o.pTable);\n      //$LASTPOS=31000658;//kernel.T1Map:658\n      _this.mapData=_this.mapTable;\n      //$LASTPOS=31000681;//kernel.T1Map:681\n      _this.row=_this.mapTable.length;\n      //$LASTPOS=31000707;//kernel.T1Map:707\n      _this.col=_this.mapTable[0].length;\n      //$LASTPOS=31000736;//kernel.T1Map:736\n      _this.mapOnTable=_this.conv(_this.baseData[1],o.pTable);\n      //$LASTPOS=31000780;//kernel.T1Map:780\n      _this.mapOnData=_this.mapOnTable;\n      //$LASTPOS=31000813;//kernel.T1Map:813\n      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n      //$LASTPOS=31000885;//kernel.T1Map:885\n      _this.initMap();\n    },\n    fiber$load :function _trc_T1Map_f_load(_thread,fileName) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var f;\n      var o;\n      \n      //$LASTPOS=31000469;//kernel.T1Map:469\n      f = _this.file("../maps/").rel(fileName);\n      //$LASTPOS=31000512;//kernel.T1Map:512\n      o = f.obj();\n      //$LASTPOS=31000532;//kernel.T1Map:532\n      _this.chipWidth=o.chipWidth;\n      //$LASTPOS=31000560;//kernel.T1Map:560\n      _this.chipHeight=o.chipHeight;\n      //$LASTPOS=31000590;//kernel.T1Map:590\n      _this.baseData=o.baseData;\n      \n      _thread.enter(function _trc_T1Map_ent_load(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=31000616;//kernel.T1Map:616\n            _this.fiber$conv(_thread, _this.baseData[0], o.pTable);\n            __pc=1;return;\n          case 1:\n            _this.mapTable=_thread.retVal;\n            \n            //$LASTPOS=31000658;//kernel.T1Map:658\n            _this.mapData=_this.mapTable;\n            //$LASTPOS=31000681;//kernel.T1Map:681\n            _this.row=_this.mapTable.length;\n            //$LASTPOS=31000707;//kernel.T1Map:707\n            _this.col=_this.mapTable[0].length;\n            //$LASTPOS=31000736;//kernel.T1Map:736\n            _this.fiber$conv(_thread, _this.baseData[1], o.pTable);\n            __pc=2;return;\n          case 2:\n            _this.mapOnTable=_thread.retVal;\n            \n            //$LASTPOS=31000780;//kernel.T1Map:780\n            _this.mapOnData=_this.mapOnTable;\n            //$LASTPOS=31000813;//kernel.T1Map:813\n            _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});\n            //$LASTPOS=31000885;//kernel.T1Map:885\n            _this.fiber$initMap(_thread);\n            __pc=3;return;\n          case 3:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    conv :function _trc_T1Map_conv(mat,tbl) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var res;\n      \n      //$LASTPOS=31000926;//kernel.T1Map:926\n      res = [];\n      //$LASTPOS=31000943;//kernel.T1Map:943\n      mat.forEach((function anonymous_955(row) {\n        var rrow;\n        \n        //$LASTPOS=31000973;//kernel.T1Map:973\n        rrow = [];\n        //$LASTPOS=31000995;//kernel.T1Map:995\n        res.push(rrow);\n        //$LASTPOS=31001020;//kernel.T1Map:1020\n        row.forEach((function anonymous_1032(dat) {\n          var t;\n          \n          //$LASTPOS=31001067;//kernel.T1Map:1067\n          t = tbl[dat[0]];\n          //$LASTPOS=31001099;//kernel.T1Map:1099\n          if (t) {\n            //$LASTPOS=31001106;//kernel.T1Map:1106\n            rrow.push(Tonyu.globals[t.name]+dat[1]);\n          } else {\n            //$LASTPOS=31001165;//kernel.T1Map:1165\n            rrow.push(dat[1]);\n          }\n        }));\n      }));\n      return res;\n    },\n    fiber$conv :function _trc_T1Map_f_conv(_thread,mat,tbl) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var res;\n      \n      //$LASTPOS=31000926;//kernel.T1Map:926\n      res = [];\n      //$LASTPOS=31000943;//kernel.T1Map:943\n      mat.forEach((function anonymous_955(row) {\n        var rrow;\n        \n        //$LASTPOS=31000973;//kernel.T1Map:973\n        rrow = [];\n        //$LASTPOS=31000995;//kernel.T1Map:995\n        res.push(rrow);\n        //$LASTPOS=31001020;//kernel.T1Map:1020\n        row.forEach((function anonymous_1032(dat) {\n          var t;\n          \n          //$LASTPOS=31001067;//kernel.T1Map:1067\n          t = tbl[dat[0]];\n          //$LASTPOS=31001099;//kernel.T1Map:1099\n          if (t) {\n            //$LASTPOS=31001106;//kernel.T1Map:1106\n            rrow.push(Tonyu.globals[t.name]+dat[1]);\n          } else {\n            //$LASTPOS=31001165;//kernel.T1Map:1165\n            rrow.push(dat[1]);\n          }\n        }));\n      }));\n      _thread.retVal=res;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"setBGColor":{"nowait":false},"load":{"nowait":false},"conv":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T1Page\',\n  shortName: \'T1Page\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.PlainChar,\n  includes: [],\n  methods: {\n    main :function _trc_T1Page_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T1Page_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initGlobals :function _trc_T1Page_initGlobals() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=32000044;//kernel.T1Page:44\n      Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;\n      //$LASTPOS=32000074;//kernel.T1Page:74\n      Tonyu.globals.$Boot.setFrameRate(60);\n      //$LASTPOS=32000103;//kernel.T1Page:103\n      Tonyu.globals.$clBlack=_this.color(0,0,0);\n      //$LASTPOS=32000131;//kernel.T1Page:131\n      Tonyu.globals.$clRed=_this.color(255,0,0);\n      //$LASTPOS=32000159;//kernel.T1Page:159\n      Tonyu.globals.$clGreen=_this.color(0,255,0);\n      //$LASTPOS=32000189;//kernel.T1Page:189\n      Tonyu.globals.$clYellow=_this.color(255,255,0);\n      //$LASTPOS=32000222;//kernel.T1Page:222\n      Tonyu.globals.$clBlue=_this.color(0,0,255);\n      //$LASTPOS=32000251;//kernel.T1Page:251\n      Tonyu.globals.$clPink=_this.color(255,0,255);\n      //$LASTPOS=32000282;//kernel.T1Page:282\n      Tonyu.globals.$clAqua=_this.color(0,255,255);\n      //$LASTPOS=32000313;//kernel.T1Page:313\n      Tonyu.globals.$clWhite=_this.color(255,255,255);\n      //$LASTPOS=32000347;//kernel.T1Page:347\n      Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;\n    },\n    fiber$initGlobals :function _trc_T1Page_f_initGlobals(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=32000044;//kernel.T1Page:44\n      Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;\n      //$LASTPOS=32000074;//kernel.T1Page:74\n      Tonyu.globals.$Boot.setFrameRate(60);\n      \n      _thread.enter(function _trc_T1Page_ent_initGlobals(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=32000103;//kernel.T1Page:103\n            _this.fiber$color(_thread, 0, 0, 0);\n            __pc=1;return;\n          case 1:\n            Tonyu.globals.$clBlack=_thread.retVal;\n            \n            //$LASTPOS=32000131;//kernel.T1Page:131\n            _this.fiber$color(_thread, 255, 0, 0);\n            __pc=2;return;\n          case 2:\n            Tonyu.globals.$clRed=_thread.retVal;\n            \n            //$LASTPOS=32000159;//kernel.T1Page:159\n            _this.fiber$color(_thread, 0, 255, 0);\n            __pc=3;return;\n          case 3:\n            Tonyu.globals.$clGreen=_thread.retVal;\n            \n            //$LASTPOS=32000189;//kernel.T1Page:189\n            _this.fiber$color(_thread, 255, 255, 0);\n            __pc=4;return;\n          case 4:\n            Tonyu.globals.$clYellow=_thread.retVal;\n            \n            //$LASTPOS=32000222;//kernel.T1Page:222\n            _this.fiber$color(_thread, 0, 0, 255);\n            __pc=5;return;\n          case 5:\n            Tonyu.globals.$clBlue=_thread.retVal;\n            \n            //$LASTPOS=32000251;//kernel.T1Page:251\n            _this.fiber$color(_thread, 255, 0, 255);\n            __pc=6;return;\n          case 6:\n            Tonyu.globals.$clPink=_thread.retVal;\n            \n            //$LASTPOS=32000282;//kernel.T1Page:282\n            _this.fiber$color(_thread, 0, 255, 255);\n            __pc=7;return;\n          case 7:\n            Tonyu.globals.$clAqua=_thread.retVal;\n            \n            //$LASTPOS=32000313;//kernel.T1Page:313\n            _this.fiber$color(_thread, 255, 255, 255);\n            __pc=8;return;\n          case 8:\n            Tonyu.globals.$clWhite=_thread.retVal;\n            \n            //$LASTPOS=32000347;//kernel.T1Page:347\n            Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"initGlobals":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.T1Text\',\n  shortName: \'T1Text\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_T1Text_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_T1Text_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_T1Text_draw(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=33000032;//kernel.T1Text:32\n      if (_this.hidden) {\n        return _this;\n      }\n      //$LASTPOS=33000057;//kernel.T1Text:57\n      c.font=_this.size+"px \'ＭＳ Ｐゴシック\'";\n      //$LASTPOS=33000097;//kernel.T1Text:97\n      Tonyu.classes.kernel.Actor.prototype.draw.apply( _this, [c]);\n      //$LASTPOS=33000117;//kernel.T1Text:117\n      _this.hidden=true;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.TextChar\',\n  shortName: \'TextChar\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.PlainChar,\n  includes: [Tonyu.classes.kernel.TextRectMod],\n  methods: {\n    main :function _trc_TextChar_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_TextChar_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_TextChar_initialize(xx,yy,t,c,s) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=34000070;//kernel.TextChar:70\n      Tonyu.classes.kernel.PlainChar.apply( _this, [xx,yy]);\n      //$LASTPOS=34000089;//kernel.TextChar:89\n      _this.text="";\n      //$LASTPOS=34000103;//kernel.TextChar:103\n      _this.col=Tonyu.globals.$clWhite;\n      //$LASTPOS=34000122;//kernel.TextChar:122\n      _this.size=20;\n      //$LASTPOS=34000136;//kernel.TextChar:136\n      if (! _this.x) {\n        //$LASTPOS=34000149;//kernel.TextChar:149\n        _this.x=0;\n      }\n      //$LASTPOS=34000164;//kernel.TextChar:164\n      if (! _this.y) {\n        //$LASTPOS=34000177;//kernel.TextChar:177\n        _this.y=0;\n      }\n      //$LASTPOS=34000192;//kernel.TextChar:192\n      if (t) {\n        //$LASTPOS=34000199;//kernel.TextChar:199\n        _this.text=t;\n      }\n      //$LASTPOS=34000212;//kernel.TextChar:212\n      if (c) {\n        //$LASTPOS=34000219;//kernel.TextChar:219\n        _this.fillStyle=c;\n      }\n      //$LASTPOS=34000237;//kernel.TextChar:237\n      if (s) {\n        //$LASTPOS=34000244;//kernel.TextChar:244\n        _this.size=s;\n      }\n    },\n    draw :function _trc_TextChar_draw(ctx) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var rect;\n      \n      //$LASTPOS=34000274;//kernel.TextChar:274\n      if (! _this.size) {\n        //$LASTPOS=34000285;//kernel.TextChar:285\n        _this.size=15;\n      }\n      //$LASTPOS=34000299;//kernel.TextChar:299\n      if (! _this.align) {\n        //$LASTPOS=34000311;//kernel.TextChar:311\n        _this.align="left";\n      }\n      //$LASTPOS=34000330;//kernel.TextChar:330\n      if (! _this.fillStyle) {\n        //$LASTPOS=34000346;//kernel.TextChar:346\n        _this.fillStyle="white";\n      }\n      //$LASTPOS=34000370;//kernel.TextChar:370\n      ctx.fillStyle=_this.fillStyle;\n      //$LASTPOS=34000400;//kernel.TextChar:400\n      ctx.globalAlpha=_this.alpha/255;\n      //$LASTPOS=34000437;//kernel.TextChar:437\n      ctx.font=_this.size+"px \'ＭＳ Ｐゴシック\'";\n      //$LASTPOS=34000473;//kernel.TextChar:473\n      rect = _this.drawTextRect(ctx,_this.text,_this.x,_this.y,_this.size,_this.align,"fill");\n      //$LASTPOS=34000540;//kernel.TextChar:540\n      _this.width=rect.w;\n      //$LASTPOS=34000559;//kernel.TextChar:559\n      _this.height=rect.h;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.GameConsole\',\n  shortName: \'GameConsole\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_GameConsole_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_GameConsole_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_GameConsole_initialize(opt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=35000084;//kernel.GameConsole:84\n      _this.extend(opt);\n      //$LASTPOS=35000102;//kernel.GameConsole:102\n      _this.cw=_this.canvas.width();\n      //$LASTPOS=35000126;//kernel.GameConsole:126\n      _this.ch=_this.canvas.height();\n      //$LASTPOS=35000151;//kernel.GameConsole:151\n      Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites;\n      //$LASTPOS=35000178;//kernel.GameConsole:178\n      Tonyu.globals.$Screen=_this.gameScreen=new Tonyu.classes.kernel.GameScreen({width: 465,height: 465,sprites: Tonyu.globals.$Sprites});\n      //$LASTPOS=35000259;//kernel.GameConsole:259\n      Tonyu.globals.$FrontSprites=_this.sprites=new Tonyu.classes.kernel.Sprites;\n      //$LASTPOS=35000299;//kernel.GameConsole:299\n      _this.sprites.add(_this.gameScreen);\n      //$LASTPOS=35000329;//kernel.GameConsole:329\n      _this.cctx=_this.canvas[0].getContext("2d");\n    },\n    shouldDraw1x1 :function _trc_GameConsole_shouldDraw1x1(srcw,srch,dstw,dsth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var larger;\n      var smaller;\n      \n      //$LASTPOS=35000448;//kernel.GameConsole:448\n      larger = 200;\n      //$LASTPOS=35000469;//kernel.GameConsole:469\n      smaller = 5;\n      return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;\n    },\n    fiber$shouldDraw1x1 :function _trc_GameConsole_f_shouldDraw1x1(_thread,srcw,srch,dstw,dsth) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var larger;\n      var smaller;\n      \n      //$LASTPOS=35000448;//kernel.GameConsole:448\n      larger = 200;\n      //$LASTPOS=35000469;//kernel.GameConsole:469\n      smaller = 5;\n      _thread.retVal=srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    layout :function _trc_GameConsole_layout() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var width;\n      var height;\n      var calcw;\n      var calch;\n      var marginw;\n      var marginh;\n      \n      //$LASTPOS=35000606;//kernel.GameConsole:606\n      _this.cw=_this.canvas.width();\n      //$LASTPOS=35000630;//kernel.GameConsole:630\n      _this.ch=_this.canvas.height();\n      //$LASTPOS=35000655;//kernel.GameConsole:655\n      width = _this.gameScreen.width;\n      //$LASTPOS=35000688;//kernel.GameConsole:688\n      height = _this.gameScreen.height;\n      //$LASTPOS=35000723;//kernel.GameConsole:723\n      calcw = _this.ch/height*width;\n      //$LASTPOS=35000767;//kernel.GameConsole:767\n      calch = _this.cw/width*height;\n      //$LASTPOS=35000811;//kernel.GameConsole:811\n      if (calch>_this.ch) {\n        //$LASTPOS=35000825;//kernel.GameConsole:825\n        calch=_this.ch;\n      }\n      //$LASTPOS=35000840;//kernel.GameConsole:840\n      if (calcw>_this.cw) {\n        //$LASTPOS=35000854;//kernel.GameConsole:854\n        calcw=_this.cw;\n      }\n      //$LASTPOS=35000869;//kernel.GameConsole:869\n      if (_this.shouldDraw1x1(width,height,calcw,calch)) {\n        //$LASTPOS=35000925;//kernel.GameConsole:925\n        calcw=width;\n        //$LASTPOS=35000937;//kernel.GameConsole:937\n        calch=height;\n        \n      }\n      //$LASTPOS=35000963;//kernel.GameConsole:963\n      marginw = Math.floor((_this.cw-calcw)/2);\n      //$LASTPOS=35001006;//kernel.GameConsole:1006\n      marginh = Math.floor((_this.ch-calch)/2);\n      //$LASTPOS=35001049;//kernel.GameConsole:1049\n      _this.gameScreen.setBounds({left: marginw,top: marginh,width: calcw,height: calch});\n    },\n    fiber$layout :function _trc_GameConsole_f_layout(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var width;\n      var height;\n      var calcw;\n      var calch;\n      var marginw;\n      var marginh;\n      \n      //$LASTPOS=35000606;//kernel.GameConsole:606\n      _this.cw=_this.canvas.width();\n      //$LASTPOS=35000630;//kernel.GameConsole:630\n      _this.ch=_this.canvas.height();\n      //$LASTPOS=35000655;//kernel.GameConsole:655\n      width = _this.gameScreen.width;\n      //$LASTPOS=35000688;//kernel.GameConsole:688\n      height = _this.gameScreen.height;\n      //$LASTPOS=35000723;//kernel.GameConsole:723\n      calcw = _this.ch/height*width;\n      //$LASTPOS=35000767;//kernel.GameConsole:767\n      calch = _this.cw/width*height;\n      //$LASTPOS=35000811;//kernel.GameConsole:811\n      if (calch>_this.ch) {\n        //$LASTPOS=35000825;//kernel.GameConsole:825\n        calch=_this.ch;\n      }\n      //$LASTPOS=35000840;//kernel.GameConsole:840\n      if (calcw>_this.cw) {\n        //$LASTPOS=35000854;//kernel.GameConsole:854\n        calcw=_this.cw;\n      }\n      //$LASTPOS=35000869;//kernel.GameConsole:869\n      if (_this.shouldDraw1x1(width,height,calcw,calch)) {\n        //$LASTPOS=35000925;//kernel.GameConsole:925\n        calcw=width;\n        //$LASTPOS=35000937;//kernel.GameConsole:937\n        calch=height;\n        \n      }\n      //$LASTPOS=35000963;//kernel.GameConsole:963\n      marginw = Math.floor((_this.cw-calcw)/2);\n      //$LASTPOS=35001006;//kernel.GameConsole:1006\n      marginh = Math.floor((_this.ch-calch)/2);\n      //$LASTPOS=35001049;//kernel.GameConsole:1049\n      _this.gameScreen.setBounds({left: marginw,top: marginh,width: calcw,height: calch});\n      \n      _thread.retVal=_this;return;\n    },\n    draw :function _trc_GameConsole_draw() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=35001144;//kernel.GameConsole:1144\n      _this.layout();\n      //$LASTPOS=35001159;//kernel.GameConsole:1159\n      _this.sprites.draw(_this.canvas[0]);\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"shouldDraw1x1":{"nowait":false},"layout":{"nowait":false},"draw":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.MapEditor\',\n  shortName: \'MapEditor\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_MapEditor_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var j;\n      \n      //$LASTPOS=36000032;//kernel.MapEditor:32\n      _this.loadMode=false;\n      //$LASTPOS=36000049;//kernel.MapEditor:49\n      _this.print("Load Data?: Y or N");\n      //$LASTPOS=36000079;//kernel.MapEditor:79\n      while (true) {\n        //$LASTPOS=36000097;//kernel.MapEditor:97\n        if (_this.getkey("y")>0) {\n          //$LASTPOS=36000125;//kernel.MapEditor:125\n          _this.loadMode=true;\n          break;\n          \n          \n        }\n        //$LASTPOS=36000168;//kernel.MapEditor:168\n        if (_this.getkey("n")>0) {\n          //$LASTPOS=36000196;//kernel.MapEditor:196\n          _this.loadMode=false;\n          break;\n          \n          \n        }\n        //$LASTPOS=36000240;//kernel.MapEditor:240\n        _this.update();\n        \n      }\n      //$LASTPOS=36000254;//kernel.MapEditor:254\n      if (_this.loadMode) {\n        //$LASTPOS=36000273;//kernel.MapEditor:273\n        _this.fileName=prompt("Input json file (*.json)","map.json");\n        //$LASTPOS=36000334;//kernel.MapEditor:334\n        if (_this.fileName) {\n          //$LASTPOS=36000357;//kernel.MapEditor:357\n          _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);\n          \n        }\n        //$LASTPOS=36000413;//kernel.MapEditor:413\n        if (_this.mapDataFile.obj()) {\n          //$LASTPOS=36000445;//kernel.MapEditor:445\n          _this.baseData=_this.mapDataFile.obj();\n          \n        } else {\n          //$LASTPOS=36000494;//kernel.MapEditor:494\n          _this.mapDataFile=_this.file(_this.fileName);\n          //$LASTPOS=36000531;//kernel.MapEditor:531\n          if (_this.mapDataFile.obj()) {\n            //$LASTPOS=36000567;//kernel.MapEditor:567\n            _this.baseData=_this.mapDataFile.obj();\n            \n          }\n          \n        }\n        //$LASTPOS=36000618;//kernel.MapEditor:618\n        if (_this.baseData==undefined) {\n          //$LASTPOS=36000652;//kernel.MapEditor:652\n          _this.print("Load failed");\n          //$LASTPOS=36000683;//kernel.MapEditor:683\n          _this.loadMode=false;\n          \n        } else {\n          //$LASTPOS=36000710;//kernel.MapEditor:710\n          if (_this.baseData[0]&&_this.baseData[1]) {\n            //$LASTPOS=36000751;//kernel.MapEditor:751\n            _this.mapData=_this.baseData[0];\n            //$LASTPOS=36000781;//kernel.MapEditor:781\n            _this.mapOnData=_this.baseData[1];\n            \n          }\n        }\n        \n      }\n      //$LASTPOS=36000815;//kernel.MapEditor:815\n      _this.update();\n      //$LASTPOS=36001093;//kernel.MapEditor:1093\n      if (! _this.loadMode) {\n        //$LASTPOS=36001113;//kernel.MapEditor:1113\n        _this.row=prompt("input row");\n        //$LASTPOS=36001143;//kernel.MapEditor:1143\n        _this.update();\n        //$LASTPOS=36001158;//kernel.MapEditor:1158\n        _this.col=prompt("input col");\n        //$LASTPOS=36001188;//kernel.MapEditor:1188\n        _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});\n        //$LASTPOS=36001238;//kernel.MapEditor:1238\n        _this.panel.x=_this.panel.width/2+10;\n        //$LASTPOS=36001269;//kernel.MapEditor:1269\n        _this.panel.y=_this.panel.height/2;\n        //$LASTPOS=36001298;//kernel.MapEditor:1298\n        _this.panel.setFillStyle("cyan");\n        //$LASTPOS=36001331;//kernel.MapEditor:1331\n        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n        //$LASTPOS=36001382;//kernel.MapEditor:1382\n        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});\n        \n      } else {\n        //$LASTPOS=36001445;//kernel.MapEditor:1445\n        if (! _this.mapOnData) {\n          //$LASTPOS=36001470;//kernel.MapEditor:1470\n          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});\n          \n        } else {\n          //$LASTPOS=36001582;//kernel.MapEditor:1582\n          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});\n          \n        }\n        //$LASTPOS=36001695;//kernel.MapEditor:1695\n        _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});\n        //$LASTPOS=36001766;//kernel.MapEditor:1766\n        _this.panel.x=_this.panel.width/2;\n        //$LASTPOS=36001794;//kernel.MapEditor:1794\n        _this.panel.y=_this.panel.height/2;\n        //$LASTPOS=36001823;//kernel.MapEditor:1823\n        _this.panel.setFillStyle("cyan");\n        //$LASTPOS=36001856;//kernel.MapEditor:1856\n        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n        \n      }\n      //$LASTPOS=36001906;//kernel.MapEditor:1906\n      Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});\n      //$LASTPOS=36001961;//kernel.MapEditor:1961\n      _this.counter=0;\n      //$LASTPOS=36001973;//kernel.MapEditor:1973\n      //$LASTPOS=36001977;//kernel.MapEditor:1977\n      i = 0;\n      while(i<16) {\n        {\n          //$LASTPOS=36002001;//kernel.MapEditor:2001\n          //$LASTPOS=36002005;//kernel.MapEditor:2005\n          j = 0;\n          while(j<8) {\n            {\n              //$LASTPOS=36002032;//kernel.MapEditor:2032\n              Tonyu.globals.$mp.set(j,i,Tonyu.globals.$pat_mapchip+_this.counter);\n              //$LASTPOS=36002076;//kernel.MapEditor:2076\n              _this.counter++;\n            }\n            j++;\n          }\n        }\n        i++;\n      }\n      //$LASTPOS=36002098;//kernel.MapEditor:2098\n      _this.mode="get";\n      //$LASTPOS=36002111;//kernel.MapEditor:2111\n      _this.prevMode="set";\n      //$LASTPOS=36002128;//kernel.MapEditor:2128\n      _this.mapp=0;\n      //$LASTPOS=36002137;//kernel.MapEditor:2137\n      _this.mx=0;\n      //$LASTPOS=36002144;//kernel.MapEditor:2144\n      _this.my=0;\n      //$LASTPOS=36002151;//kernel.MapEditor:2151\n      _this.chipX=0;\n      //$LASTPOS=36002161;//kernel.MapEditor:2161\n      _this.chipY=0;\n      //$LASTPOS=36002171;//kernel.MapEditor:2171\n      _this.x=Tonyu.globals.$screenWidth-16;\n      //$LASTPOS=36002191;//kernel.MapEditor:2191\n      _this.y=Tonyu.globals.$screenHeight-16;\n      //$LASTPOS=36002212;//kernel.MapEditor:2212\n      while (true) {\n        //$LASTPOS=36002230;//kernel.MapEditor:2230\n        _this.p=_this.mapp;\n        //$LASTPOS=36002243;//kernel.MapEditor:2243\n        if (_this.getkey("e")==1) {\n          //$LASTPOS=36002272;//kernel.MapEditor:2272\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=36002306;//kernel.MapEditor:2306\n          _this.mode="erase";\n          //$LASTPOS=36002329;//kernel.MapEditor:2329\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=36002362;//kernel.MapEditor:2362\n        if (_this.getkey("s")==1) {\n          //$LASTPOS=36002391;//kernel.MapEditor:2391\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=36002425;//kernel.MapEditor:2425\n          if (_this.mode=="set") {\n            //$LASTPOS=36002455;//kernel.MapEditor:2455\n            _this.mode="setOn";\n            \n          } else {\n            //$LASTPOS=36002498;//kernel.MapEditor:2498\n            _this.mode="set";\n            \n          }\n          //$LASTPOS=36002530;//kernel.MapEditor:2530\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=36002563;//kernel.MapEditor:2563\n        if (_this.getkey("o")==1) {\n          //$LASTPOS=36002592;//kernel.MapEditor:2592\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=36002626;//kernel.MapEditor:2626\n          _this.mode="setOn";\n          \n        }\n        //$LASTPOS=36002652;//kernel.MapEditor:2652\n        if (_this.getkey("g")==1) {\n          //$LASTPOS=36002681;//kernel.MapEditor:2681\n          if (_this.mode!="get") {\n            //$LASTPOS=36002711;//kernel.MapEditor:2711\n            _this.prevMode=_this.mode;\n            //$LASTPOS=36002739;//kernel.MapEditor:2739\n            Tonyu.globals.$mp.scrollTo(0,0);\n            //$LASTPOS=36002771;//kernel.MapEditor:2771\n            _this.mode="get";\n            //$LASTPOS=36002796;//kernel.MapEditor:2796\n            _this.chipX=0;\n            //$LASTPOS=36002818;//kernel.MapEditor:2818\n            _this.chipY=0;\n            \n          } else {\n            //$LASTPOS=36002856;//kernel.MapEditor:2856\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=36002894;//kernel.MapEditor:2894\n            _this.mode=_this.prevMode;\n            \n          }\n          //$LASTPOS=36002929;//kernel.MapEditor:2929\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=36002962;//kernel.MapEditor:2962\n        if (_this.getkey("p")==1) {\n          //$LASTPOS=36003006;//kernel.MapEditor:3006\n          _this.saveFileName=prompt("input json file(*.json)","map.json");\n          //$LASTPOS=36003495;//kernel.MapEditor:3495\n          _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);\n          //$LASTPOS=36003553;//kernel.MapEditor:3553\n          _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];\n          //$LASTPOS=36003668;//kernel.MapEditor:3668\n          _this.saveDataFile.obj(_this.data);\n          //$LASTPOS=36003701;//kernel.MapEditor:3701\n          _this.print(_this.saveFileName+" Saved");\n          \n        }\n        //$LASTPOS=36003793;//kernel.MapEditor:3793\n        if (_this.getkey("c")==1) {\n          //$LASTPOS=36003822;//kernel.MapEditor:3822\n          Tonyu.globals.$mp.scrollTo(1000,1000);\n          //$LASTPOS=36003856;//kernel.MapEditor:3856\n          _this.mode="spuit";\n          //$LASTPOS=36003879;//kernel.MapEditor:3879\n          _this.print(_this.mode+" mode");\n          \n        }\n        //$LASTPOS=36003912;//kernel.MapEditor:3912\n        if (_this.mode!="get") {\n          //$LASTPOS=36003938;//kernel.MapEditor:3938\n          if (_this.getkey("left")>0) {\n            //$LASTPOS=36003959;//kernel.MapEditor:3959\n            _this.mx=_this.mx+8;\n          }\n          //$LASTPOS=36003977;//kernel.MapEditor:3977\n          if (_this.getkey("right")>0) {\n            //$LASTPOS=36003999;//kernel.MapEditor:3999\n            _this.mx=_this.mx-8;\n          }\n          //$LASTPOS=36004017;//kernel.MapEditor:4017\n          if (_this.getkey("up")>0) {\n            //$LASTPOS=36004036;//kernel.MapEditor:4036\n            _this.my=_this.my+8;\n          }\n          //$LASTPOS=36004054;//kernel.MapEditor:4054\n          if (_this.getkey("down")>0) {\n            //$LASTPOS=36004075;//kernel.MapEditor:4075\n            _this.my=_this.my-8;\n          }\n          //$LASTPOS=36004093;//kernel.MapEditor:4093\n          Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n          \n        } else {\n          //$LASTPOS=36004136;//kernel.MapEditor:4136\n          if (_this.getkey("left")>0) {\n            //$LASTPOS=36004157;//kernel.MapEditor:4157\n            _this.chipX=_this.chipX+8;\n          }\n          //$LASTPOS=36004181;//kernel.MapEditor:4181\n          if (_this.getkey("right")>0) {\n            //$LASTPOS=36004203;//kernel.MapEditor:4203\n            _this.chipX=_this.chipX-8;\n          }\n          //$LASTPOS=36004227;//kernel.MapEditor:4227\n          if (_this.getkey("up")>0) {\n            //$LASTPOS=36004246;//kernel.MapEditor:4246\n            _this.chipY=_this.chipY+8;\n          }\n          //$LASTPOS=36004270;//kernel.MapEditor:4270\n          if (_this.getkey("down")>0) {\n            //$LASTPOS=36004291;//kernel.MapEditor:4291\n            _this.chipY=_this.chipY-8;\n          }\n          //$LASTPOS=36004315;//kernel.MapEditor:4315\n          Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);\n          \n        }\n        //$LASTPOS=36004354;//kernel.MapEditor:4354\n        _this.panel.x=_this.panel.width/2-_this.mx;\n        //$LASTPOS=36004385;//kernel.MapEditor:4385\n        _this.panel.y=_this.panel.height/2-_this.my;\n        //$LASTPOS=36004417;//kernel.MapEditor:4417\n        if (_this.mode=="set"&&_this.getkey(1)>0) {\n          //$LASTPOS=36004458;//kernel.MapEditor:4458\n          Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n          //$LASTPOS=36004507;//kernel.MapEditor:4507\n          Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n          \n        } else {\n          //$LASTPOS=36004558;//kernel.MapEditor:4558\n          if (_this.mode=="erase"&&_this.getkey(1)>0) {\n            //$LASTPOS=36004601;//kernel.MapEditor:4601\n            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n            \n          } else {\n            //$LASTPOS=36004650;//kernel.MapEditor:4650\n            if (_this.mode=="get"&&_this.getkey(1)>0) {\n              //$LASTPOS=36004691;//kernel.MapEditor:4691\n              _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);\n              //$LASTPOS=36004745;//kernel.MapEditor:4745\n              _this.mode=_this.prevMode;\n              //$LASTPOS=36004769;//kernel.MapEditor:4769\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=36004803;//kernel.MapEditor:4803\n              _this.print(_this.mode+" mode");\n              //$LASTPOS=36004833;//kernel.MapEditor:4833\n              _this.updateEx(10);\n              \n            } else {\n              //$LASTPOS=36004858;//kernel.MapEditor:4858\n              if (_this.mode=="setOn"&&_this.getkey(1)>0) {\n                //$LASTPOS=36004901;//kernel.MapEditor:4901\n                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n                \n              } else {\n                //$LASTPOS=36004954;//kernel.MapEditor:4954\n                if (_this.mode=="spuit"&&_this.getkey(1)>0) {\n                  //$LASTPOS=36004997;//kernel.MapEditor:4997\n                  _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);\n                  //$LASTPOS=36005046;//kernel.MapEditor:5046\n                  _this.mode="set";\n                  //$LASTPOS=36005067;//kernel.MapEditor:5067\n                  _this.print(_this.mode+" mode");\n                  //$LASTPOS=36005097;//kernel.MapEditor:5097\n                  _this.updateEx(10);\n                  \n                }\n              }\n            }\n          }\n        }\n        //$LASTPOS=36005123;//kernel.MapEditor:5123\n        _this.update();\n        \n      }\n    },\n    fiber$main :function _trc_MapEditor_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var j;\n      \n      //$LASTPOS=36000032;//kernel.MapEditor:32\n      _this.loadMode=false;\n      //$LASTPOS=36000049;//kernel.MapEditor:49\n      _this.print("Load Data?: Y or N");\n      \n      _thread.enter(function _trc_MapEditor_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=36000079;//kernel.MapEditor:79\n          case 1:\n            //$LASTPOS=36000097;//kernel.MapEditor:97\n            if (!(_this.getkey("y")>0)) { __pc=2; break; }\n            //$LASTPOS=36000125;//kernel.MapEditor:125\n            _this.loadMode=true;\n            __pc=5; break;\n            \n          case 2:\n            \n            //$LASTPOS=36000168;//kernel.MapEditor:168\n            if (!(_this.getkey("n")>0)) { __pc=3; break; }\n            //$LASTPOS=36000196;//kernel.MapEditor:196\n            _this.loadMode=false;\n            __pc=5; break;\n            \n          case 3:\n            \n            //$LASTPOS=36000240;//kernel.MapEditor:240\n            _this.fiber$update(_thread);\n            __pc=4;return;\n          case 4:\n            \n            __pc=1;break;\n          case 5:\n            \n            //$LASTPOS=36000254;//kernel.MapEditor:254\n            if (!(_this.loadMode)) { __pc=9; break; }\n            //$LASTPOS=36000273;//kernel.MapEditor:273\n            _this.fileName=prompt("Input json file (*.json)","map.json");\n            //$LASTPOS=36000334;//kernel.MapEditor:334\n            if (_this.fileName) {\n              //$LASTPOS=36000357;//kernel.MapEditor:357\n              _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);\n              \n            }\n            //$LASTPOS=36000413;//kernel.MapEditor:413\n            if (!(_this.mapDataFile.obj())) { __pc=6; break; }\n            {\n              //$LASTPOS=36000445;//kernel.MapEditor:445\n              _this.baseData=_this.mapDataFile.obj();\n            }\n            __pc=8;break;\n          case 6:\n            //$LASTPOS=36000494;//kernel.MapEditor:494\n            _this.fiber$file(_thread, _this.fileName);\n            __pc=7;return;\n          case 7:\n            _this.mapDataFile=_thread.retVal;\n            \n            //$LASTPOS=36000531;//kernel.MapEditor:531\n            if (_this.mapDataFile.obj()) {\n              //$LASTPOS=36000567;//kernel.MapEditor:567\n              _this.baseData=_this.mapDataFile.obj();\n              \n            }\n          case 8:\n            \n            //$LASTPOS=36000618;//kernel.MapEditor:618\n            if (_this.baseData==undefined) {\n              //$LASTPOS=36000652;//kernel.MapEditor:652\n              _this.print("Load failed");\n              //$LASTPOS=36000683;//kernel.MapEditor:683\n              _this.loadMode=false;\n              \n            } else {\n              //$LASTPOS=36000710;//kernel.MapEditor:710\n              if (_this.baseData[0]&&_this.baseData[1]) {\n                //$LASTPOS=36000751;//kernel.MapEditor:751\n                _this.mapData=_this.baseData[0];\n                //$LASTPOS=36000781;//kernel.MapEditor:781\n                _this.mapOnData=_this.baseData[1];\n                \n              }\n            }\n          case 9:\n            \n            //$LASTPOS=36000815;//kernel.MapEditor:815\n            _this.fiber$update(_thread);\n            __pc=10;return;\n          case 10:\n            \n            //$LASTPOS=36001093;//kernel.MapEditor:1093\n            if (!(! _this.loadMode)) { __pc=12; break; }\n            //$LASTPOS=36001113;//kernel.MapEditor:1113\n            _this.row=prompt("input row");\n            //$LASTPOS=36001143;//kernel.MapEditor:1143\n            _this.fiber$update(_thread);\n            __pc=11;return;\n          case 11:\n            \n            //$LASTPOS=36001158;//kernel.MapEditor:1158\n            _this.col=prompt("input col");\n            //$LASTPOS=36001188;//kernel.MapEditor:1188\n            _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});\n            //$LASTPOS=36001238;//kernel.MapEditor:1238\n            _this.panel.x=_this.panel.width/2+10;\n            //$LASTPOS=36001269;//kernel.MapEditor:1269\n            _this.panel.y=_this.panel.height/2;\n            //$LASTPOS=36001298;//kernel.MapEditor:1298\n            _this.panel.setFillStyle("cyan");\n            //$LASTPOS=36001331;//kernel.MapEditor:1331\n            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n            //$LASTPOS=36001382;//kernel.MapEditor:1382\n            Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});\n            __pc=13;break;\n          case 12:\n            {\n              //$LASTPOS=36001445;//kernel.MapEditor:1445\n              if (! _this.mapOnData) {\n                //$LASTPOS=36001470;//kernel.MapEditor:1470\n                Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});\n                \n              } else {\n                //$LASTPOS=36001582;//kernel.MapEditor:1582\n                Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});\n                \n              }\n              //$LASTPOS=36001695;//kernel.MapEditor:1695\n              _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});\n              //$LASTPOS=36001766;//kernel.MapEditor:1766\n              _this.panel.x=_this.panel.width/2;\n              //$LASTPOS=36001794;//kernel.MapEditor:1794\n              _this.panel.y=_this.panel.height/2;\n              //$LASTPOS=36001823;//kernel.MapEditor:1823\n              _this.panel.setFillStyle("cyan");\n              //$LASTPOS=36001856;//kernel.MapEditor:1856\n              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);\n            }\n          case 13:\n            \n            //$LASTPOS=36001906;//kernel.MapEditor:1906\n            Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});\n            //$LASTPOS=36001961;//kernel.MapEditor:1961\n            _this.counter=0;\n            //$LASTPOS=36001973;//kernel.MapEditor:1973\n            //$LASTPOS=36001977;//kernel.MapEditor:1977\n            i = 0;\n            while(i<16) {\n              {\n                //$LASTPOS=36002001;//kernel.MapEditor:2001\n                //$LASTPOS=36002005;//kernel.MapEditor:2005\n                j = 0;\n                while(j<8) {\n                  {\n                    //$LASTPOS=36002032;//kernel.MapEditor:2032\n                    Tonyu.globals.$mp.set(j,i,Tonyu.globals.$pat_mapchip+_this.counter);\n                    //$LASTPOS=36002076;//kernel.MapEditor:2076\n                    _this.counter++;\n                  }\n                  j++;\n                }\n              }\n              i++;\n            }\n            //$LASTPOS=36002098;//kernel.MapEditor:2098\n            _this.mode="get";\n            //$LASTPOS=36002111;//kernel.MapEditor:2111\n            _this.prevMode="set";\n            //$LASTPOS=36002128;//kernel.MapEditor:2128\n            _this.mapp=0;\n            //$LASTPOS=36002137;//kernel.MapEditor:2137\n            _this.mx=0;\n            //$LASTPOS=36002144;//kernel.MapEditor:2144\n            _this.my=0;\n            //$LASTPOS=36002151;//kernel.MapEditor:2151\n            _this.chipX=0;\n            //$LASTPOS=36002161;//kernel.MapEditor:2161\n            _this.chipY=0;\n            //$LASTPOS=36002171;//kernel.MapEditor:2171\n            _this.x=Tonyu.globals.$screenWidth-16;\n            //$LASTPOS=36002191;//kernel.MapEditor:2191\n            _this.y=Tonyu.globals.$screenHeight-16;\n            //$LASTPOS=36002212;//kernel.MapEditor:2212\n          case 14:\n            //$LASTPOS=36002230;//kernel.MapEditor:2230\n            _this.p=_this.mapp;\n            //$LASTPOS=36002243;//kernel.MapEditor:2243\n            if (_this.getkey("e")==1) {\n              //$LASTPOS=36002272;//kernel.MapEditor:2272\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=36002306;//kernel.MapEditor:2306\n              _this.mode="erase";\n              //$LASTPOS=36002329;//kernel.MapEditor:2329\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=36002362;//kernel.MapEditor:2362\n            if (_this.getkey("s")==1) {\n              //$LASTPOS=36002391;//kernel.MapEditor:2391\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=36002425;//kernel.MapEditor:2425\n              if (_this.mode=="set") {\n                //$LASTPOS=36002455;//kernel.MapEditor:2455\n                _this.mode="setOn";\n                \n              } else {\n                //$LASTPOS=36002498;//kernel.MapEditor:2498\n                _this.mode="set";\n                \n              }\n              //$LASTPOS=36002530;//kernel.MapEditor:2530\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=36002563;//kernel.MapEditor:2563\n            if (_this.getkey("o")==1) {\n              //$LASTPOS=36002592;//kernel.MapEditor:2592\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=36002626;//kernel.MapEditor:2626\n              _this.mode="setOn";\n              \n            }\n            //$LASTPOS=36002652;//kernel.MapEditor:2652\n            if (_this.getkey("g")==1) {\n              //$LASTPOS=36002681;//kernel.MapEditor:2681\n              if (_this.mode!="get") {\n                //$LASTPOS=36002711;//kernel.MapEditor:2711\n                _this.prevMode=_this.mode;\n                //$LASTPOS=36002739;//kernel.MapEditor:2739\n                Tonyu.globals.$mp.scrollTo(0,0);\n                //$LASTPOS=36002771;//kernel.MapEditor:2771\n                _this.mode="get";\n                //$LASTPOS=36002796;//kernel.MapEditor:2796\n                _this.chipX=0;\n                //$LASTPOS=36002818;//kernel.MapEditor:2818\n                _this.chipY=0;\n                \n              } else {\n                //$LASTPOS=36002856;//kernel.MapEditor:2856\n                Tonyu.globals.$mp.scrollTo(1000,1000);\n                //$LASTPOS=36002894;//kernel.MapEditor:2894\n                _this.mode=_this.prevMode;\n                \n              }\n              //$LASTPOS=36002929;//kernel.MapEditor:2929\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=36002962;//kernel.MapEditor:2962\n            if (_this.getkey("p")==1) {\n              //$LASTPOS=36003006;//kernel.MapEditor:3006\n              _this.saveFileName=prompt("input json file(*.json)","map.json");\n              //$LASTPOS=36003495;//kernel.MapEditor:3495\n              _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);\n              //$LASTPOS=36003553;//kernel.MapEditor:3553\n              _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];\n              //$LASTPOS=36003668;//kernel.MapEditor:3668\n              _this.saveDataFile.obj(_this.data);\n              //$LASTPOS=36003701;//kernel.MapEditor:3701\n              _this.print(_this.saveFileName+" Saved");\n              \n            }\n            //$LASTPOS=36003793;//kernel.MapEditor:3793\n            if (_this.getkey("c")==1) {\n              //$LASTPOS=36003822;//kernel.MapEditor:3822\n              Tonyu.globals.$mp.scrollTo(1000,1000);\n              //$LASTPOS=36003856;//kernel.MapEditor:3856\n              _this.mode="spuit";\n              //$LASTPOS=36003879;//kernel.MapEditor:3879\n              _this.print(_this.mode+" mode");\n              \n            }\n            //$LASTPOS=36003912;//kernel.MapEditor:3912\n            if (_this.mode!="get") {\n              //$LASTPOS=36003938;//kernel.MapEditor:3938\n              if (_this.getkey("left")>0) {\n                //$LASTPOS=36003959;//kernel.MapEditor:3959\n                _this.mx=_this.mx+8;\n              }\n              //$LASTPOS=36003977;//kernel.MapEditor:3977\n              if (_this.getkey("right")>0) {\n                //$LASTPOS=36003999;//kernel.MapEditor:3999\n                _this.mx=_this.mx-8;\n              }\n              //$LASTPOS=36004017;//kernel.MapEditor:4017\n              if (_this.getkey("up")>0) {\n                //$LASTPOS=36004036;//kernel.MapEditor:4036\n                _this.my=_this.my+8;\n              }\n              //$LASTPOS=36004054;//kernel.MapEditor:4054\n              if (_this.getkey("down")>0) {\n                //$LASTPOS=36004075;//kernel.MapEditor:4075\n                _this.my=_this.my-8;\n              }\n              //$LASTPOS=36004093;//kernel.MapEditor:4093\n              Tonyu.globals.$map.scrollTo(_this.mx,_this.my);\n              \n            } else {\n              //$LASTPOS=36004136;//kernel.MapEditor:4136\n              if (_this.getkey("left")>0) {\n                //$LASTPOS=36004157;//kernel.MapEditor:4157\n                _this.chipX=_this.chipX+8;\n              }\n              //$LASTPOS=36004181;//kernel.MapEditor:4181\n              if (_this.getkey("right")>0) {\n                //$LASTPOS=36004203;//kernel.MapEditor:4203\n                _this.chipX=_this.chipX-8;\n              }\n              //$LASTPOS=36004227;//kernel.MapEditor:4227\n              if (_this.getkey("up")>0) {\n                //$LASTPOS=36004246;//kernel.MapEditor:4246\n                _this.chipY=_this.chipY+8;\n              }\n              //$LASTPOS=36004270;//kernel.MapEditor:4270\n              if (_this.getkey("down")>0) {\n                //$LASTPOS=36004291;//kernel.MapEditor:4291\n                _this.chipY=_this.chipY-8;\n              }\n              //$LASTPOS=36004315;//kernel.MapEditor:4315\n              Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);\n              \n            }\n            //$LASTPOS=36004354;//kernel.MapEditor:4354\n            _this.panel.x=_this.panel.width/2-_this.mx;\n            //$LASTPOS=36004385;//kernel.MapEditor:4385\n            _this.panel.y=_this.panel.height/2-_this.my;\n            //$LASTPOS=36004417;//kernel.MapEditor:4417\n            if (!(_this.mode=="set"&&_this.getkey(1)>0)) { __pc=15; break; }\n            {\n              //$LASTPOS=36004458;//kernel.MapEditor:4458\n              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n              //$LASTPOS=36004507;//kernel.MapEditor:4507\n              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n            }\n            __pc=25;break;\n          case 15:\n            //$LASTPOS=36004558;//kernel.MapEditor:4558\n            if (!(_this.mode=="erase"&&_this.getkey(1)>0)) { __pc=16; break; }\n            {\n              //$LASTPOS=36004601;//kernel.MapEditor:4601\n              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);\n            }\n            __pc=24;break;\n          case 16:\n            //$LASTPOS=36004650;//kernel.MapEditor:4650\n            if (!(_this.mode=="get"&&_this.getkey(1)>0)) { __pc=18; break; }\n            //$LASTPOS=36004691;//kernel.MapEditor:4691\n            _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);\n            //$LASTPOS=36004745;//kernel.MapEditor:4745\n            _this.mode=_this.prevMode;\n            //$LASTPOS=36004769;//kernel.MapEditor:4769\n            Tonyu.globals.$mp.scrollTo(1000,1000);\n            //$LASTPOS=36004803;//kernel.MapEditor:4803\n            _this.print(_this.mode+" mode");\n            //$LASTPOS=36004833;//kernel.MapEditor:4833\n            _this.fiber$updateEx(_thread, 10);\n            __pc=17;return;\n          case 17:\n            \n            __pc=23;break;\n          case 18:\n            //$LASTPOS=36004858;//kernel.MapEditor:4858\n            if (!(_this.mode=="setOn"&&_this.getkey(1)>0)) { __pc=19; break; }\n            {\n              //$LASTPOS=36004901;//kernel.MapEditor:4901\n              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);\n            }\n            __pc=22;break;\n          case 19:\n            //$LASTPOS=36004954;//kernel.MapEditor:4954\n            if (!(_this.mode=="spuit"&&_this.getkey(1)>0)) { __pc=21; break; }\n            //$LASTPOS=36004997;//kernel.MapEditor:4997\n            _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);\n            //$LASTPOS=36005046;//kernel.MapEditor:5046\n            _this.mode="set";\n            //$LASTPOS=36005067;//kernel.MapEditor:5067\n            _this.print(_this.mode+" mode");\n            //$LASTPOS=36005097;//kernel.MapEditor:5097\n            _this.fiber$updateEx(_thread, 10);\n            __pc=20;return;\n          case 20:\n            \n          case 21:\n            \n          case 22:\n            \n          case 23:\n            \n          case 24:\n            \n          case 25:\n            \n            //$LASTPOS=36005123;//kernel.MapEditor:5123\n            _this.fiber$update(_thread);\n            __pc=26;return;\n          case 26:\n            \n            __pc=14;break;\n          case 27:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Pad\',\n  shortName: \'Pad\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [],\n  methods: {\n    main :function _trc_Pad_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=37001202;//kernel.Pad:1202\n      _this.APAD_DIAG_SIZE=96;\n      //$LASTPOS=37003465;//kernel.Pad:3465\n      while (true) {\n        //$LASTPOS=37003484;//kernel.Pad:3484\n        _this.padUpdate();\n        //$LASTPOS=37003502;//kernel.Pad:3502\n        _this.update();\n        \n      }\n    },\n    fiber$main :function _trc_Pad_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=37001202;//kernel.Pad:1202\n      _this.APAD_DIAG_SIZE=96;\n      \n      _thread.enter(function _trc_Pad_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=37003465;//kernel.Pad:3465\n          case 1:\n            //$LASTPOS=37003484;//kernel.Pad:3484\n            _this.fiber$padUpdate(_thread);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=37003502;//kernel.Pad:3502\n            _this.fiber$update(_thread);\n            __pc=3;return;\n          case 3:\n            \n            __pc=1;break;\n          case 4:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initialize :function _trc_Pad_initialize(opt) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=37000033;//kernel.Pad:33\n      Tonyu.classes.kernel.Actor.apply( _this, [opt]);\n      //$LASTPOS=37000050;//kernel.Pad:50\n      _this.padImageP=Tonyu.globals.$pat_inputPad;\n      //$LASTPOS=37000082;//kernel.Pad:82\n      _this.jujiKey=new Tonyu.classes.kernel.Actor({x: 96+1,y: Tonyu.globals.$screenHeight-96-1,p: _this.padImageP+0,zOrder: - 9,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=37000183;//kernel.Pad:183\n      _this.no1Key=new Tonyu.classes.kernel.Actor({x: Tonyu.globals.$screenWidth-96,y: Tonyu.globals.$screenHeight-96,p: _this.padImageP+1,zOrder: - 9,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=37000292;//kernel.Pad:292\n      _this.jujiKey.show();\n      //$LASTPOS=37000313;//kernel.Pad:313\n      _this.no1Key.show();\n      //$LASTPOS=37000339;//kernel.Pad:339\n      _this.jujiKeyPushU=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y-60,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=37000446;//kernel.Pad:446\n      _this.jujiKeyPushL=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x-60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=37000553;//kernel.Pad:553\n      _this.jujiKeyPushR=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x+60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=37000660;//kernel.Pad:660\n      _this.jujiKeyPushD=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y+60,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=37000767;//kernel.Pad:767\n      _this.jujiKeyPush1=new Tonyu.classes.kernel.Actor({x: _this.no1Key.x,y: _this.no1Key.y,p: _this.padImageP+2,scaleX: 2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=37000879;//kernel.Pad:879\n      _this.jujiKeyPushU.hide();\n      //$LASTPOS=37000905;//kernel.Pad:905\n      _this.jujiKeyPushL.hide();\n      //$LASTPOS=37000931;//kernel.Pad:931\n      _this.jujiKeyPushR.hide();\n      //$LASTPOS=37000957;//kernel.Pad:957\n      _this.jujiKeyPushD.hide();\n      //$LASTPOS=37000983;//kernel.Pad:983\n      _this.jujiKeyPush1.hide();\n    },\n    die :function _trc_Pad_die() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=37001021;//kernel.Pad:1021\n      _this.jujiKey.die();\n      //$LASTPOS=37001041;//kernel.Pad:1041\n      _this.no1Key.die();\n      //$LASTPOS=37001060;//kernel.Pad:1060\n      _this.jujiKeyPushU.die();\n      //$LASTPOS=37001085;//kernel.Pad:1085\n      _this.jujiKeyPushL.die();\n      //$LASTPOS=37001110;//kernel.Pad:1110\n      _this.jujiKeyPushR.die();\n      //$LASTPOS=37001135;//kernel.Pad:1135\n      _this.jujiKeyPushD.die();\n      //$LASTPOS=37001160;//kernel.Pad:1160\n      _this.jujiKeyPush1.die();\n      //$LASTPOS=37001185;//kernel.Pad:1185\n      Tonyu.classes.kernel.Actor.prototype.die.apply( _this, []);\n    },\n    padUpdate :function _trc_Pad_padUpdate() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var i;\n      var t;\n      \n      //$LASTPOS=37001258;//kernel.Pad:1258\n      _this.keyPushL=0;\n      //$LASTPOS=37001277;//kernel.Pad:1277\n      _this.keyPushR=0;\n      //$LASTPOS=37001296;//kernel.Pad:1296\n      _this.keyPushU=0;\n      //$LASTPOS=37001315;//kernel.Pad:1315\n      _this.keyPushD=0;\n      //$LASTPOS=37001334;//kernel.Pad:1334\n      _this.keyPush1=0;\n      //$LASTPOS=37001359;//kernel.Pad:1359\n      _this.padKeyNotapCnt++;\n      //$LASTPOS=37001383;//kernel.Pad:1383\n      //$LASTPOS=37001388;//kernel.Pad:1388\n      i = 0;\n      while(i<5) {\n        {\n          //$LASTPOS=37001436;//kernel.Pad:1436\n          t = Tonyu.globals.$touches[i];\n          //$LASTPOS=37001466;//kernel.Pad:1466\n          if (t.touched) {\n            //$LASTPOS=37001496;//kernel.Pad:1496\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {\n              //$LASTPOS=37001593;//kernel.Pad:1593\n              _this.keyPushU=1;\n            }\n            //$LASTPOS=37001620;//kernel.Pad:1620\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {\n              //$LASTPOS=37001717;//kernel.Pad:1717\n              _this.keyPushD=1;\n            }\n            //$LASTPOS=37001744;//kernel.Pad:1744\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n              //$LASTPOS=37001841;//kernel.Pad:1841\n              _this.keyPushL=1;\n            }\n            //$LASTPOS=37001868;//kernel.Pad:1868\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n              //$LASTPOS=37001965;//kernel.Pad:1965\n              _this.keyPushR=1;\n            }\n            //$LASTPOS=37001992;//kernel.Pad:1992\n            if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {\n              //$LASTPOS=37002054;//kernel.Pad:2054\n              _this.keyPush1=1;\n            }\n            //$LASTPOS=37002081;//kernel.Pad:2081\n            _this.padKeySW=1;\n            //$LASTPOS=37002108;//kernel.Pad:2108\n            _this.padKeyNotapCnt=0;\n            \n          }\n        }\n        i++;\n      }\n      //$LASTPOS=37002173;//kernel.Pad:2173\n      if (_this.keyPushL) {\n        //$LASTPOS=37002187;//kernel.Pad:2187\n        _this.keyCntL++;\n      } else {\n        //$LASTPOS=37002204;//kernel.Pad:2204\n        _this.keyCntL=0;\n      }\n      //$LASTPOS=37002222;//kernel.Pad:2222\n      if (_this.keyPushR) {\n        //$LASTPOS=37002236;//kernel.Pad:2236\n        _this.keyCntR++;\n      } else {\n        //$LASTPOS=37002253;//kernel.Pad:2253\n        _this.keyCntR=0;\n      }\n      //$LASTPOS=37002271;//kernel.Pad:2271\n      if (_this.keyPushU) {\n        //$LASTPOS=37002285;//kernel.Pad:2285\n        _this.keyCntU++;\n      } else {\n        //$LASTPOS=37002302;//kernel.Pad:2302\n        _this.keyCntU=0;\n      }\n      //$LASTPOS=37002320;//kernel.Pad:2320\n      if (_this.keyPushD) {\n        //$LASTPOS=37002334;//kernel.Pad:2334\n        _this.keyCntD++;\n      } else {\n        //$LASTPOS=37002351;//kernel.Pad:2351\n        _this.keyCntD=0;\n      }\n      //$LASTPOS=37002369;//kernel.Pad:2369\n      if (_this.keyPush1) {\n        //$LASTPOS=37002383;//kernel.Pad:2383\n        _this.keyCnt1++;\n      } else {\n        //$LASTPOS=37002400;//kernel.Pad:2400\n        _this.keyCnt1=0;\n      }\n      //$LASTPOS=37002435;//kernel.Pad:2435\n      if (_this.keyPushL) {\n        //$LASTPOS=37002449;//kernel.Pad:2449\n        _this.jujiKeyPushL.show();\n      } else {\n        //$LASTPOS=37002475;//kernel.Pad:2475\n        _this.jujiKeyPushL.hide();\n      }\n      //$LASTPOS=37002501;//kernel.Pad:2501\n      if (_this.keyPushR) {\n        //$LASTPOS=37002515;//kernel.Pad:2515\n        _this.jujiKeyPushR.show();\n      } else {\n        //$LASTPOS=37002541;//kernel.Pad:2541\n        _this.jujiKeyPushR.hide();\n      }\n      //$LASTPOS=37002567;//kernel.Pad:2567\n      if (_this.keyPushU) {\n        //$LASTPOS=37002581;//kernel.Pad:2581\n        _this.jujiKeyPushU.show();\n      } else {\n        //$LASTPOS=37002607;//kernel.Pad:2607\n        _this.jujiKeyPushU.hide();\n      }\n      //$LASTPOS=37002633;//kernel.Pad:2633\n      if (_this.keyPushD) {\n        //$LASTPOS=37002647;//kernel.Pad:2647\n        _this.jujiKeyPushD.show();\n      } else {\n        //$LASTPOS=37002673;//kernel.Pad:2673\n        _this.jujiKeyPushD.hide();\n      }\n      //$LASTPOS=37002699;//kernel.Pad:2699\n      if (_this.keyPush1) {\n        //$LASTPOS=37002713;//kernel.Pad:2713\n        _this.jujiKeyPush1.show();\n      } else {\n        //$LASTPOS=37002739;//kernel.Pad:2739\n        _this.jujiKeyPush1.hide();\n      }\n    },\n    fiber$padUpdate :function _trc_Pad_f_padUpdate(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var i;\n      var t;\n      \n      //$LASTPOS=37001258;//kernel.Pad:1258\n      _this.keyPushL=0;\n      //$LASTPOS=37001277;//kernel.Pad:1277\n      _this.keyPushR=0;\n      //$LASTPOS=37001296;//kernel.Pad:1296\n      _this.keyPushU=0;\n      //$LASTPOS=37001315;//kernel.Pad:1315\n      _this.keyPushD=0;\n      //$LASTPOS=37001334;//kernel.Pad:1334\n      _this.keyPush1=0;\n      //$LASTPOS=37001359;//kernel.Pad:1359\n      _this.padKeyNotapCnt++;\n      //$LASTPOS=37001383;//kernel.Pad:1383\n      //$LASTPOS=37001388;//kernel.Pad:1388\n      i = 0;\n      while(i<5) {\n        {\n          //$LASTPOS=37001436;//kernel.Pad:1436\n          t = Tonyu.globals.$touches[i];\n          //$LASTPOS=37001466;//kernel.Pad:1466\n          if (t.touched) {\n            //$LASTPOS=37001496;//kernel.Pad:1496\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {\n              //$LASTPOS=37001593;//kernel.Pad:1593\n              _this.keyPushU=1;\n            }\n            //$LASTPOS=37001620;//kernel.Pad:1620\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {\n              //$LASTPOS=37001717;//kernel.Pad:1717\n              _this.keyPushD=1;\n            }\n            //$LASTPOS=37001744;//kernel.Pad:1744\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n              //$LASTPOS=37001841;//kernel.Pad:1841\n              _this.keyPushL=1;\n            }\n            //$LASTPOS=37001868;//kernel.Pad:1868\n            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {\n              //$LASTPOS=37001965;//kernel.Pad:1965\n              _this.keyPushR=1;\n            }\n            //$LASTPOS=37001992;//kernel.Pad:1992\n            if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {\n              //$LASTPOS=37002054;//kernel.Pad:2054\n              _this.keyPush1=1;\n            }\n            //$LASTPOS=37002081;//kernel.Pad:2081\n            _this.padKeySW=1;\n            //$LASTPOS=37002108;//kernel.Pad:2108\n            _this.padKeyNotapCnt=0;\n            \n          }\n        }\n        i++;\n      }\n      //$LASTPOS=37002173;//kernel.Pad:2173\n      if (_this.keyPushL) {\n        //$LASTPOS=37002187;//kernel.Pad:2187\n        _this.keyCntL++;\n      } else {\n        //$LASTPOS=37002204;//kernel.Pad:2204\n        _this.keyCntL=0;\n      }\n      //$LASTPOS=37002222;//kernel.Pad:2222\n      if (_this.keyPushR) {\n        //$LASTPOS=37002236;//kernel.Pad:2236\n        _this.keyCntR++;\n      } else {\n        //$LASTPOS=37002253;//kernel.Pad:2253\n        _this.keyCntR=0;\n      }\n      //$LASTPOS=37002271;//kernel.Pad:2271\n      if (_this.keyPushU) {\n        //$LASTPOS=37002285;//kernel.Pad:2285\n        _this.keyCntU++;\n      } else {\n        //$LASTPOS=37002302;//kernel.Pad:2302\n        _this.keyCntU=0;\n      }\n      //$LASTPOS=37002320;//kernel.Pad:2320\n      if (_this.keyPushD) {\n        //$LASTPOS=37002334;//kernel.Pad:2334\n        _this.keyCntD++;\n      } else {\n        //$LASTPOS=37002351;//kernel.Pad:2351\n        _this.keyCntD=0;\n      }\n      //$LASTPOS=37002369;//kernel.Pad:2369\n      if (_this.keyPush1) {\n        //$LASTPOS=37002383;//kernel.Pad:2383\n        _this.keyCnt1++;\n      } else {\n        //$LASTPOS=37002400;//kernel.Pad:2400\n        _this.keyCnt1=0;\n      }\n      //$LASTPOS=37002435;//kernel.Pad:2435\n      if (_this.keyPushL) {\n        //$LASTPOS=37002449;//kernel.Pad:2449\n        _this.jujiKeyPushL.show();\n      } else {\n        //$LASTPOS=37002475;//kernel.Pad:2475\n        _this.jujiKeyPushL.hide();\n      }\n      //$LASTPOS=37002501;//kernel.Pad:2501\n      if (_this.keyPushR) {\n        //$LASTPOS=37002515;//kernel.Pad:2515\n        _this.jujiKeyPushR.show();\n      } else {\n        //$LASTPOS=37002541;//kernel.Pad:2541\n        _this.jujiKeyPushR.hide();\n      }\n      //$LASTPOS=37002567;//kernel.Pad:2567\n      if (_this.keyPushU) {\n        //$LASTPOS=37002581;//kernel.Pad:2581\n        _this.jujiKeyPushU.show();\n      } else {\n        //$LASTPOS=37002607;//kernel.Pad:2607\n        _this.jujiKeyPushU.hide();\n      }\n      //$LASTPOS=37002633;//kernel.Pad:2633\n      if (_this.keyPushD) {\n        //$LASTPOS=37002647;//kernel.Pad:2647\n        _this.jujiKeyPushD.show();\n      } else {\n        //$LASTPOS=37002673;//kernel.Pad:2673\n        _this.jujiKeyPushD.hide();\n      }\n      //$LASTPOS=37002699;//kernel.Pad:2699\n      if (_this.keyPush1) {\n        //$LASTPOS=37002713;//kernel.Pad:2713\n        _this.jujiKeyPush1.show();\n      } else {\n        //$LASTPOS=37002739;//kernel.Pad:2739\n        _this.jujiKeyPush1.hide();\n      }\n      \n      _thread.retVal=_this;return;\n    },\n    getPadUp :function _trc_Pad_getPadUp() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntU;\n    },\n    fiber$getPadUp :function _trc_Pad_f_getPadUp(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntU;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getPadDown :function _trc_Pad_getPadDown() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntD;\n    },\n    fiber$getPadDown :function _trc_Pad_f_getPadDown(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntD;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getPadLeft :function _trc_Pad_getPadLeft() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntL;\n    },\n    fiber$getPadLeft :function _trc_Pad_f_getPadLeft(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntL;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getPadRight :function _trc_Pad_getPadRight() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntR;\n    },\n    fiber$getPadRight :function _trc_Pad_f_getPadRight(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntR;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getPadButton :function _trc_Pad_getPadButton(i) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var value;\n      \n      //$LASTPOS=37002940;//kernel.Pad:2940\n      value;\n      //$LASTPOS=37002956;//kernel.Pad:2956\n      if (i==0) {\n        //$LASTPOS=37002968;//kernel.Pad:2968\n        value=_this.keyCnt1;\n      }\n      return value;\n    },\n    fiber$getPadButton :function _trc_Pad_f_getPadButton(_thread,i) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var value;\n      \n      //$LASTPOS=37002940;//kernel.Pad:2940\n      value;\n      //$LASTPOS=37002956;//kernel.Pad:2956\n      if (i==0) {\n        //$LASTPOS=37002968;//kernel.Pad:2968\n        value=_this.keyCnt1;\n      }\n      _thread.retVal=value;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getUp :function _trc_Pad_getUp() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntU;\n    },\n    fiber$getUp :function _trc_Pad_f_getUp(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntU;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getDown :function _trc_Pad_getDown() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntD;\n    },\n    fiber$getDown :function _trc_Pad_f_getDown(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntD;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getLeft :function _trc_Pad_getLeft() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntL;\n    },\n    fiber$getLeft :function _trc_Pad_f_getLeft(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntL;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getRight :function _trc_Pad_getRight() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.keyCntR;\n    },\n    fiber$getRight :function _trc_Pad_f_getRight(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=_this.keyCntR;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    getButton :function _trc_Pad_getButton(i) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var value;\n      \n      //$LASTPOS=37003163;//kernel.Pad:3163\n      value;\n      //$LASTPOS=37003179;//kernel.Pad:3179\n      if (i==0) {\n        //$LASTPOS=37003191;//kernel.Pad:3191\n        value=_this.keyCnt1;\n      }\n      return value;\n    },\n    fiber$getButton :function _trc_Pad_f_getButton(_thread,i) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var value;\n      \n      //$LASTPOS=37003163;//kernel.Pad:3163\n      value;\n      //$LASTPOS=37003179;//kernel.Pad:3179\n      if (i==0) {\n        //$LASTPOS=37003191;//kernel.Pad:3191\n        value=_this.keyCnt1;\n      }\n      _thread.retVal=value;return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    isOnRect :function _trc_Pad_isOnRect(mx,my,rx,ry,rx2,ry2) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return (rx<=mx&&mx<rx2&&ry<=my&&my<ry2);\n    },\n    fiber$isOnRect :function _trc_Pad_f_isOnRect(_thread,mx,my,rx,ry,rx2,ry2) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=(rx<=mx&&mx<rx2&&ry<=my&&my<ry2);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    isOnRectWH :function _trc_Pad_isOnRectWH(mx,my,rx,ry,rw,rh) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return (rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);\n    },\n    fiber$isOnRectWH :function _trc_Pad_f_isOnRectWH(_thread,mx,my,rx,ry,rw,rh) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      _thread.retVal=(rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);return;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"die":{"nowait":true},"padUpdate":{"nowait":false},"getPadUp":{"nowait":false},"getPadDown":{"nowait":false},"getPadLeft":{"nowait":false},"getPadRight":{"nowait":false},"getPadButton":{"nowait":false},"getUp":{"nowait":false},"getDown":{"nowait":false},"getLeft":{"nowait":false},"getRight":{"nowait":false},"getButton":{"nowait":false},"isOnRect":{"nowait":false},"isOnRectWH":{"nowait":false}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.Boot\',\n  shortName: \'Boot\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.Actor,\n  includes: [Tonyu.classes.kernel.T2MediaPlayer],\n  methods: {\n    main :function _trc_Boot_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=38002000;//kernel.Boot:2000\n      Tonyu.globals.$Boot=_this;\n      //$LASTPOS=38002013;//kernel.Boot:2013\n      _this.initSounds();\n      //$LASTPOS=38002028;//kernel.Boot:2028\n      _this.initSprites();\n      //$LASTPOS=38002044;//kernel.Boot:2044\n      Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;\n      //$LASTPOS=38002075;//kernel.Boot:2075\n      Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);\n      //$LASTPOS=38002112;//kernel.Boot:2112\n      _this.initThread();\n      //$LASTPOS=38002129;//kernel.Boot:2129\n      Tonyu.globals.$pat_fruits=30;\n      //$LASTPOS=38002146;//kernel.Boot:2146\n      Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;\n      //$LASTPOS=38002163;//kernel.Boot:2163\n      Tonyu.globals.$Math=Math;\n      //$LASTPOS=38002176;//kernel.Boot:2176\n      Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.Panel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=38002286;//kernel.Boot:2286\n      Tonyu.globals.$consolePrintY=465-15;\n      //$LASTPOS=38002310;//kernel.Boot:2310\n      Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});\n      //$LASTPOS=38002450;//kernel.Boot:2450\n      if (typeof  SplashScreen!="undefined") {\n        //$LASTPOS=38002488;//kernel.Boot:2488\n        SplashScreen.hide();\n      }\n      //$LASTPOS=38002510;//kernel.Boot:2510\n      _this.initFPSParams();\n      //$LASTPOS=38002530;//kernel.Boot:2530\n      Tonyu.globals.$mouseX=Tonyu.globals.$mouseX||0;\n      //$LASTPOS=38002551;//kernel.Boot:2551\n      Tonyu.globals.$mouseY=Tonyu.globals.$mouseY||0;\n      //$LASTPOS=38002572;//kernel.Boot:2572\n      while (true) {\n        //$LASTPOS=38002612;//kernel.Boot:2612\n        _this.scheduler.stepsAll();\n        //$LASTPOS=38002639;//kernel.Boot:2639\n        Tonyu.globals.$Keys.update();\n        //$LASTPOS=38002660;//kernel.Boot:2660\n        Tonyu.globals.$InputDevice.update();\n        //$LASTPOS=38002688;//kernel.Boot:2688\n        Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;\n        //$LASTPOS=38002721;//kernel.Boot:2721\n        Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;\n        //$LASTPOS=38002756;//kernel.Boot:2756\n        _this.doDraw=_this.now()<_this.deadLine;\n        //$LASTPOS=38002784;//kernel.Boot:2784\n        if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {\n          //$LASTPOS=38002838;//kernel.Boot:2838\n          _this.doDraw=true;\n          //$LASTPOS=38002860;//kernel.Boot:2860\n          _this.resetDeadLine();\n          \n        }\n        //$LASTPOS=38002889;//kernel.Boot:2889\n        if (_this.doDraw) {\n          //$LASTPOS=38002932;//kernel.Boot:2932\n          Tonyu.globals.$Screen.fillCanvas(Tonyu.globals.$Screen.buf[0]);\n          //$LASTPOS=38002977;//kernel.Boot:2977\n          Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n          //$LASTPOS=38003017;//kernel.Boot:3017\n          Tonyu.globals.$FrontSprites.draw(Tonyu.globals.$Screen.buf[0]);\n          //$LASTPOS=38003062;//kernel.Boot:3062\n          Tonyu.globals.$Screen.draw();\n          //$LASTPOS=38003087;//kernel.Boot:3087\n          _this.fps_fpsCnt++;\n          //$LASTPOS=38003111;//kernel.Boot:3111\n          _this.frameSkipped=0;\n          \n        } else {\n          //$LASTPOS=38003150;//kernel.Boot:3150\n          _this.frameSkipped++;\n          \n        }\n        //$LASTPOS=38003178;//kernel.Boot:3178\n        Tonyu.globals.$Sprites.checkHit();\n        //$LASTPOS=38003204;//kernel.Boot:3204\n        Tonyu.globals.$Sprites.removeOneframes();\n        //$LASTPOS=38003237;//kernel.Boot:3237\n        _this.fps_rpsCnt++;\n        //$LASTPOS=38003257;//kernel.Boot:3257\n        _this.measureFps();\n        //$LASTPOS=38003276;//kernel.Boot:3276\n        _this.waitFrame();\n        //$LASTPOS=38003303;//kernel.Boot:3303\n        while (_this.paused) {\n          //$LASTPOS=38003328;//kernel.Boot:3328\n          _this.waitFor(Tonyu.timeout(1));\n          //$LASTPOS=38003364;//kernel.Boot:3364\n          if (! _this.paused) {\n            //$LASTPOS=38003377;//kernel.Boot:3377\n            _this.resetDeadLine();\n          }\n          \n        }\n        \n      }\n    },\n    fiber$main :function _trc_Boot_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=38002000;//kernel.Boot:2000\n      Tonyu.globals.$Boot=_this;\n      \n      _thread.enter(function _trc_Boot_ent_main(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=38002013;//kernel.Boot:2013\n            _this.fiber$initSounds(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=38002028;//kernel.Boot:2028\n            _this.fiber$initSprites(_thread);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=38002044;//kernel.Boot:2044\n            Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;\n            //$LASTPOS=38002075;//kernel.Boot:2075\n            Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);\n            //$LASTPOS=38002112;//kernel.Boot:2112\n            _this.fiber$initThread(_thread);\n            __pc=3;return;\n          case 3:\n            \n            //$LASTPOS=38002129;//kernel.Boot:2129\n            Tonyu.globals.$pat_fruits=30;\n            //$LASTPOS=38002146;//kernel.Boot:2146\n            Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;\n            //$LASTPOS=38002163;//kernel.Boot:2163\n            Tonyu.globals.$Math=Math;\n            //$LASTPOS=38002176;//kernel.Boot:2176\n            Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.Panel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});\n            //$LASTPOS=38002286;//kernel.Boot:2286\n            Tonyu.globals.$consolePrintY=465-15;\n            //$LASTPOS=38002310;//kernel.Boot:2310\n            Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});\n            //$LASTPOS=38002450;//kernel.Boot:2450\n            if (typeof  SplashScreen!="undefined") {\n              //$LASTPOS=38002488;//kernel.Boot:2488\n              SplashScreen.hide();\n            }\n            //$LASTPOS=38002510;//kernel.Boot:2510\n            _this.initFPSParams();\n            //$LASTPOS=38002530;//kernel.Boot:2530\n            Tonyu.globals.$mouseX=Tonyu.globals.$mouseX||0;\n            //$LASTPOS=38002551;//kernel.Boot:2551\n            Tonyu.globals.$mouseY=Tonyu.globals.$mouseY||0;\n            //$LASTPOS=38002572;//kernel.Boot:2572\n          case 4:\n            //$LASTPOS=38002612;//kernel.Boot:2612\n            _this.scheduler.stepsAll();\n            //$LASTPOS=38002639;//kernel.Boot:2639\n            Tonyu.globals.$Keys.update();\n            //$LASTPOS=38002660;//kernel.Boot:2660\n            Tonyu.globals.$InputDevice.update();\n            //$LASTPOS=38002688;//kernel.Boot:2688\n            Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;\n            //$LASTPOS=38002721;//kernel.Boot:2721\n            Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;\n            //$LASTPOS=38002756;//kernel.Boot:2756\n            _this.doDraw=_this.now()<_this.deadLine;\n            //$LASTPOS=38002784;//kernel.Boot:2784\n            if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {\n              //$LASTPOS=38002838;//kernel.Boot:2838\n              _this.doDraw=true;\n              //$LASTPOS=38002860;//kernel.Boot:2860\n              _this.resetDeadLine();\n              \n            }\n            //$LASTPOS=38002889;//kernel.Boot:2889\n            if (_this.doDraw) {\n              //$LASTPOS=38002932;//kernel.Boot:2932\n              Tonyu.globals.$Screen.fillCanvas(Tonyu.globals.$Screen.buf[0]);\n              //$LASTPOS=38002977;//kernel.Boot:2977\n              Tonyu.globals.$Sprites.draw(Tonyu.globals.$Screen.buf[0]);\n              //$LASTPOS=38003017;//kernel.Boot:3017\n              Tonyu.globals.$FrontSprites.draw(Tonyu.globals.$Screen.buf[0]);\n              //$LASTPOS=38003062;//kernel.Boot:3062\n              Tonyu.globals.$Screen.draw();\n              //$LASTPOS=38003087;//kernel.Boot:3087\n              _this.fps_fpsCnt++;\n              //$LASTPOS=38003111;//kernel.Boot:3111\n              _this.frameSkipped=0;\n              \n            } else {\n              //$LASTPOS=38003150;//kernel.Boot:3150\n              _this.frameSkipped++;\n              \n            }\n            //$LASTPOS=38003178;//kernel.Boot:3178\n            Tonyu.globals.$Sprites.checkHit();\n            //$LASTPOS=38003204;//kernel.Boot:3204\n            Tonyu.globals.$Sprites.removeOneframes();\n            //$LASTPOS=38003237;//kernel.Boot:3237\n            _this.fps_rpsCnt++;\n            //$LASTPOS=38003257;//kernel.Boot:3257\n            _this.measureFps();\n            //$LASTPOS=38003276;//kernel.Boot:3276\n            _this.fiber$waitFrame(_thread);\n            __pc=5;return;\n          case 5:\n            \n            //$LASTPOS=38003303;//kernel.Boot:3303\n          case 6:\n            if (!(_this.paused)) { __pc=8; break; }\n            //$LASTPOS=38003328;//kernel.Boot:3328\n            _this.fiber$waitFor(_thread, Tonyu.timeout(1));\n            __pc=7;return;\n          case 7:\n            \n            //$LASTPOS=38003364;//kernel.Boot:3364\n            if (! _this.paused) {\n              //$LASTPOS=38003377;//kernel.Boot:3377\n              _this.resetDeadLine();\n            }\n            __pc=6;break;\n          case 8:\n            \n            __pc=4;break;\n          case 9:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    update :function _trc_Boot_update() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=38000204;//kernel.Boot:204\n      _this.waitFor(Tonyu.timeout(50));\n    },\n    fiber$update :function _trc_Boot_f_update(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.enter(function _trc_Boot_ent_update(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=38000204;//kernel.Boot:204\n            _this.fiber$waitFor(_thread, Tonyu.timeout(50));\n            __pc=1;return;\n          case 1:\n            \n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initSprites :function _trc_Boot_initSprites() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var a;\n      var rs;\n      var r;\n      var name;\n      var val;\n      var _it_282;\n      \n      //$LASTPOS=38000285;//kernel.Boot:285\n      Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites();\n      //$LASTPOS=38000314;//kernel.Boot:314\n      Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites();\n      //$LASTPOS=38000348;//kernel.Boot:348\n      _this.print("Loading plugins..");\n      //$LASTPOS=38000382;//kernel.Boot:382\n      a = _this.asyncResult();\n      //$LASTPOS=38000408;//kernel.Boot:408\n      Tonyu.globals.$currentProject.loadPlugins(a.receiver);\n      //$LASTPOS=38000454;//kernel.Boot:454\n      _this.waitFor(a);\n      //$LASTPOS=38000471;//kernel.Boot:471\n      _this.print("Loading pats..");\n      //$LASTPOS=38000502;//kernel.Boot:502\n      rs = Tonyu.globals.$currentProject.getResource();\n      //$LASTPOS=38000545;//kernel.Boot:545\n      a=_this.asyncResult();\n      //$LASTPOS=38000567;//kernel.Boot:567\n      ImageList.load(rs.images,a.receiver,{baseDir: Tonyu.globals.$currentProject.getDir()});\n      //$LASTPOS=38000652;//kernel.Boot:652\n      _this.waitFor(a);\n      //$LASTPOS=38000669;//kernel.Boot:669\n      r = a[0];\n      //$LASTPOS=38000686;//kernel.Boot:686\n      Tonyu.globals.$Sprites.setImageList(r);\n      //$LASTPOS=38000717;//kernel.Boot:717\n      _it_282=Tonyu.iterator(r.names,2);\n      while(_it_282.next()) {\n        name=_it_282[0];\n        val=_it_282[1];\n        \n        //$LASTPOS=38000758;//kernel.Boot:758\n        Tonyu.setGlobal(name,val);\n        \n      }\n      //$LASTPOS=38000798;//kernel.Boot:798\n      _this.print("Loading pats done.");\n      //$LASTPOS=38000833;//kernel.Boot:833\n      _this.cvj=$("canvas");\n      //$LASTPOS=38000855;//kernel.Boot:855\n      if (Tonyu.noviceMode) {\n        //$LASTPOS=38000888;//kernel.Boot:888\n        Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 600,height: 300});\n        \n      } else {\n        //$LASTPOS=38000972;//kernel.Boot:972\n        Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 465,height: 465});\n        \n      }\n    },\n    fiber$initSprites :function _trc_Boot_f_initSprites(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var a;\n      var rs;\n      var r;\n      var name;\n      var val;\n      var _it_282;\n      \n      //$LASTPOS=38000285;//kernel.Boot:285\n      Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites();\n      //$LASTPOS=38000314;//kernel.Boot:314\n      Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites();\n      //$LASTPOS=38000348;//kernel.Boot:348\n      _this.print("Loading plugins..");\n      //$LASTPOS=38000382;//kernel.Boot:382\n      a = _this.asyncResult();\n      //$LASTPOS=38000408;//kernel.Boot:408\n      Tonyu.globals.$currentProject.loadPlugins(a.receiver);\n      \n      _thread.enter(function _trc_Boot_ent_initSprites(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=38000454;//kernel.Boot:454\n            _this.fiber$waitFor(_thread, a);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=38000471;//kernel.Boot:471\n            _this.print("Loading pats..");\n            //$LASTPOS=38000502;//kernel.Boot:502\n            rs = Tonyu.globals.$currentProject.getResource();\n            //$LASTPOS=38000545;//kernel.Boot:545\n            a=_this.asyncResult();\n            //$LASTPOS=38000567;//kernel.Boot:567\n            ImageList.load(rs.images,a.receiver,{baseDir: Tonyu.globals.$currentProject.getDir()});\n            //$LASTPOS=38000652;//kernel.Boot:652\n            _this.fiber$waitFor(_thread, a);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=38000669;//kernel.Boot:669\n            r = a[0];\n            //$LASTPOS=38000686;//kernel.Boot:686\n            Tonyu.globals.$Sprites.setImageList(r);\n            //$LASTPOS=38000717;//kernel.Boot:717\n            _it_282=Tonyu.iterator(r.names,2);\n            while(_it_282.next()) {\n              name=_it_282[0];\n              val=_it_282[1];\n              \n              //$LASTPOS=38000758;//kernel.Boot:758\n              Tonyu.setGlobal(name,val);\n              \n            }\n            //$LASTPOS=38000798;//kernel.Boot:798\n            _this.print("Loading pats done.");\n            //$LASTPOS=38000833;//kernel.Boot:833\n            _this.cvj=$("canvas");\n            //$LASTPOS=38000855;//kernel.Boot:855\n            if (Tonyu.noviceMode) {\n              //$LASTPOS=38000888;//kernel.Boot:888\n              Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 600,height: 300});\n              \n            } else {\n              //$LASTPOS=38000972;//kernel.Boot:972\n              Tonyu.globals.$Screen=new Tonyu.classes.kernel.ScaledCanvas({canvas: _this.cvj,width: 465,height: 465});\n              \n            }\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initSounds :function _trc_Boot_initSounds() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=38001065;//kernel.Boot:1065\n      _this.print("Loading sounds...");\n      //$LASTPOS=38001099;//kernel.Boot:1099\n      _this.initT2MediaPlayer();\n      //$LASTPOS=38001125;//kernel.Boot:1125\n      _this.loadFromProject(Tonyu.globals.$currentProject);\n      //$LASTPOS=38001164;//kernel.Boot:1164\n      _this.print("Loading sounds done.");\n      //$LASTPOS=38001201;//kernel.Boot:1201\n      _this.on("stop",(function anonymous_1211() {\n        \n        //$LASTPOS=38001223;//kernel.Boot:1223\n        _this.clearSEData();\n      }));\n      //$LASTPOS=38001251;//kernel.Boot:1251\n      Tonyu.globals.$sound=_this;\n    },\n    fiber$initSounds :function _trc_Boot_f_initSounds(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=38001065;//kernel.Boot:1065\n      _this.print("Loading sounds...");\n      \n      _thread.enter(function _trc_Boot_ent_initSounds(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=38001099;//kernel.Boot:1099\n            _this.fiber$initT2MediaPlayer(_thread);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=38001125;//kernel.Boot:1125\n            _this.fiber$loadFromProject(_thread, Tonyu.globals.$currentProject);\n            __pc=2;return;\n          case 2:\n            \n            //$LASTPOS=38001164;//kernel.Boot:1164\n            _this.print("Loading sounds done.");\n            //$LASTPOS=38001201;//kernel.Boot:1201\n            _this.on("stop",(function anonymous_1211() {\n              \n              //$LASTPOS=38001223;//kernel.Boot:1223\n              _this.clearSEData();\n            }));\n            //$LASTPOS=38001251;//kernel.Boot:1251\n            Tonyu.globals.$sound=_this;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    hide :function _trc_Boot_hide() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    initThread :function _trc_Boot_initThread() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var o;\n      var mainClassName;\n      \n      //$LASTPOS=38001354;//kernel.Boot:1354\n      o = Tonyu.currentProject.getOptions();\n      //$LASTPOS=38001400;//kernel.Boot:1400\n      mainClassName = o.run.mainClass;\n      //$LASTPOS=38001440;//kernel.Boot:1440\n      _this.print("MainClass= "+mainClassName);\n      //$LASTPOS=38001481;//kernel.Boot:1481\n      _this.mainClass=Tonyu.getClass(mainClassName);\n      //$LASTPOS=38001527;//kernel.Boot:1527\n      if (! _this.mainClass) {\n        //$LASTPOS=38001554;//kernel.Boot:1554\n        TError(mainClassName+" というクラスはありません","不明",0).raise();\n        \n      }\n      //$LASTPOS=38001632;//kernel.Boot:1632\n      Tonyu.runMode=true;\n      //$LASTPOS=38001689;//kernel.Boot:1689\n      _this.scheduler=Tonyu.globals.$Scheduler=new Tonyu.classes.kernel.Scheduler;\n      //$LASTPOS=38001730;//kernel.Boot:1730\n      new _this.mainClass();\n    },\n    fiber$initThread :function _trc_Boot_f_initThread(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var o;\n      var mainClassName;\n      \n      //$LASTPOS=38001354;//kernel.Boot:1354\n      o = Tonyu.currentProject.getOptions();\n      //$LASTPOS=38001400;//kernel.Boot:1400\n      mainClassName = o.run.mainClass;\n      //$LASTPOS=38001440;//kernel.Boot:1440\n      _this.print("MainClass= "+mainClassName);\n      //$LASTPOS=38001481;//kernel.Boot:1481\n      _this.mainClass=Tonyu.getClass(mainClassName);\n      //$LASTPOS=38001527;//kernel.Boot:1527\n      if (! _this.mainClass) {\n        //$LASTPOS=38001554;//kernel.Boot:1554\n        TError(mainClassName+" というクラスはありません","不明",0).raise();\n        \n      }\n      //$LASTPOS=38001632;//kernel.Boot:1632\n      Tonyu.runMode=true;\n      //$LASTPOS=38001689;//kernel.Boot:1689\n      _this.scheduler=Tonyu.globals.$Scheduler=new Tonyu.classes.kernel.Scheduler;\n      //$LASTPOS=38001730;//kernel.Boot:1730\n      new _this.mainClass();\n      \n      _thread.retVal=_this;return;\n    },\n    stop :function _trc_Boot_stop() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=38001766;//kernel.Boot:1766\n      _this.fireEvent("stop");\n      //$LASTPOS=38001790;//kernel.Boot:1790\n      _this.die();\n    },\n    fiber$stop :function _trc_Boot_f_stop(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      //$LASTPOS=38001766;//kernel.Boot:1766\n      _this.fireEvent("stop");\n      //$LASTPOS=38001790;//kernel.Boot:1790\n      _this.die();\n      \n      _thread.retVal=_this;return;\n    },\n    schedule :function _trc_Boot_schedule(obj,method,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var th;\n      \n      //$LASTPOS=38001835;//kernel.Boot:1835\n      method=method||"main";\n      //$LASTPOS=38001863;//kernel.Boot:1863\n      args=args||[];\n      //$LASTPOS=38001883;//kernel.Boot:1883\n      th = _this.scheduler.newThread(obj,method,args);\n      //$LASTPOS=38001935;//kernel.Boot:1935\n      _this.addThreadGroup(obj);\n      //$LASTPOS=38001961;//kernel.Boot:1961\n      obj.addThread(th);\n      return th;\n    },\n    fiber$schedule :function _trc_Boot_f_schedule(_thread,obj,method,args) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var th;\n      \n      //$LASTPOS=38001835;//kernel.Boot:1835\n      method=method||"main";\n      //$LASTPOS=38001863;//kernel.Boot:1863\n      args=args||[];\n      //$LASTPOS=38001883;//kernel.Boot:1883\n      th = _this.scheduler.newThread(obj,method,args);\n      \n      _thread.enter(function _trc_Boot_ent_schedule(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=38001935;//kernel.Boot:1935\n            _this.fiber$addThreadGroup(_thread, obj);\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=38001961;//kernel.Boot:1961\n            obj.addThread(th);\n            _thread.exit(th);return;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    initFPSParams :function _trc_Boot_initFPSParams() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=38003457;//kernel.Boot:3457\n      _this._fps=30;\n      //$LASTPOS=38003473;//kernel.Boot:3473\n      _this.maxframeSkip=5;\n      //$LASTPOS=38003523;//kernel.Boot:3523\n      _this.frameCnt=0;\n      //$LASTPOS=38003542;//kernel.Boot:3542\n      _this.resetDeadLine();\n      //$LASTPOS=38003564;//kernel.Boot:3564\n      _this.lastMeasured=_this.now();\n      //$LASTPOS=38003589;//kernel.Boot:3589\n      _this.fps_fps=_this.fps_rps=_this.fps_fpsCnt=_this.fps_rpsCnt=0;\n    },\n    now :function _trc_Boot_now() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return new Date().getTime();\n    },\n    resetDeadLine :function _trc_Boot_resetDeadLine() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=38003719;//kernel.Boot:3719\n      _this.deadLine=_this.now()+1000/_this._fps;\n      //$LASTPOS=38003750;//kernel.Boot:3750\n      _this.frameSkipped=0;\n    },\n    waitFrame :function _trc_Boot_waitFrame() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      var wt;\n      \n      //$LASTPOS=38003794;//kernel.Boot:3794\n      wt = _this.deadLine-_this.now();\n      //$LASTPOS=38003822;//kernel.Boot:3822\n      if (wt<1) {\n        //$LASTPOS=38003843;//kernel.Boot:3843\n        if (wt<- 1000) {\n          //$LASTPOS=38003857;//kernel.Boot:3857\n          _this.resetDeadLine();\n        }\n        //$LASTPOS=38003883;//kernel.Boot:3883\n        wt=1;\n        \n      }\n      //$LASTPOS=38003901;//kernel.Boot:3901\n      wt=_this.floor(wt);\n      //$LASTPOS=38003920;//kernel.Boot:3920\n      _this.waitFor(Tonyu.timeout(wt));\n      //$LASTPOS=38003953;//kernel.Boot:3953\n      _this.deadLine+=1000/_this._fps;\n    },\n    fiber$waitFrame :function _trc_Boot_f_waitFrame(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      var wt;\n      \n      //$LASTPOS=38003794;//kernel.Boot:3794\n      wt = _this.deadLine-_this.now();\n      //$LASTPOS=38003822;//kernel.Boot:3822\n      if (wt<1) {\n        //$LASTPOS=38003843;//kernel.Boot:3843\n        if (wt<- 1000) {\n          //$LASTPOS=38003857;//kernel.Boot:3857\n          _this.resetDeadLine();\n        }\n        //$LASTPOS=38003883;//kernel.Boot:3883\n        wt=1;\n        \n      }\n      //$LASTPOS=38003901;//kernel.Boot:3901\n      wt=_this.floor(wt);\n      \n      _thread.enter(function _trc_Boot_ent_waitFrame(_thread) {\n        if (_thread.lastEx) __pc=_thread.catchPC;\n        for(var __cnt=100 ; __cnt--;) {\n          switch (__pc) {\n          case 0:\n            //$LASTPOS=38003920;//kernel.Boot:3920\n            _this.fiber$waitFor(_thread, Tonyu.timeout(wt));\n            __pc=1;return;\n          case 1:\n            \n            //$LASTPOS=38003953;//kernel.Boot:3953\n            _this.deadLine+=1000/_this._fps;\n            _thread.exit(_this);return;\n          }\n        }\n      });\n    },\n    getFrameRate :function _trc_Boot_getFrameRate() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this._fps;\n    },\n    setFrameRate :function _trc_Boot_setFrameRate(fps,maxFrameSkip) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=38004113;//kernel.Boot:4113\n      _this._fps=fps;\n      //$LASTPOS=38004130;//kernel.Boot:4130\n      if (typeof  maxFrameSkip!="number") {\n        //$LASTPOS=38004165;//kernel.Boot:4165\n        maxFrameSkip=5;\n      }\n      //$LASTPOS=38004186;//kernel.Boot:4186\n      _this.maxFrameSkip=maxFrameSkip;\n      //$LASTPOS=38004225;//kernel.Boot:4225\n      _this.resetDeadLine();\n    },\n    getMeasuredFps :function _trc_Boot_getMeasuredFps() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.fps_fps;\n    },\n    getMeasuredRps :function _trc_Boot_getMeasuredRps() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      return _this.fps_rps;\n    },\n    measureFps :function _trc_Boot_measureFps() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=38004436;//kernel.Boot:4436\n      if (_this.now()>_this.lastMeasured+1000) {\n        //$LASTPOS=38004476;//kernel.Boot:4476\n        _this.fps_fps=_this.fps_fpsCnt;\n        //$LASTPOS=38004505;//kernel.Boot:4505\n        _this.fps_rps=_this.fps_rpsCnt;\n        //$LASTPOS=38004534;//kernel.Boot:4534\n        _this.fps_fpsCnt=0;\n        //$LASTPOS=38004557;//kernel.Boot:4557\n        _this.fps_rpsCnt=0;\n        //$LASTPOS=38004580;//kernel.Boot:4580\n        _this.lastMeasured=_this.now();\n        \n      }\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"update":{"nowait":false},"initSprites":{"nowait":false},"initSounds":{"nowait":false},"hide":{"nowait":true},"initThread":{"nowait":false},"stop":{"nowait":false},"schedule":{"nowait":false},"initFPSParams":{"nowait":true},"now":{"nowait":true},"resetDeadLine":{"nowait":true},"waitFrame":{"nowait":false},"getFrameRate":{"nowait":true},"setFrameRate":{"nowait":true},"getMeasuredFps":{"nowait":true},"getMeasuredRps":{"nowait":true},"measureFps":{"nowait":true}}}\n});\nTonyu.klass.define({\n  fullName: \'kernel.DxChar\',\n  shortName: \'DxChar\',\n  namespace: \'kernel\',\n  superclass: Tonyu.classes.kernel.SpriteChar,\n  includes: [],\n  methods: {\n    main :function _trc_DxChar_main() {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n    },\n    fiber$main :function _trc_DxChar_f_main(_thread) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      //var _arguments=Tonyu.A(arguments);\n      var __pc=0;\n      \n      \n      _thread.retVal=_this;return;\n    },\n    initialize :function _trc_DxChar_initialize(xx,yy,pp,ff,sz,rt,al) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=39000057;//kernel.DxChar:57\n      Tonyu.classes.kernel.SpriteChar.apply( _this, [xx,yy,pp,ff]);\n      //$LASTPOS=39000082;//kernel.DxChar:82\n      _this.scaleX=1;\n      //$LASTPOS=39000097;//kernel.DxChar:97\n      if (sz) {\n        //$LASTPOS=39000105;//kernel.DxChar:105\n        _this.scaleX=sz;\n      }\n      //$LASTPOS=39000121;//kernel.DxChar:121\n      _this.angle=0;\n      //$LASTPOS=39000135;//kernel.DxChar:135\n      if (rt) {\n        //$LASTPOS=39000143;//kernel.DxChar:143\n        _this.angle=rt;\n      }\n      //$LASTPOS=39000158;//kernel.DxChar:158\n      _this.alpha=255;\n      //$LASTPOS=39000174;//kernel.DxChar:174\n      if (al) {\n        //$LASTPOS=39000182;//kernel.DxChar:182\n        _this.alpha=al;\n      }\n    },\n    draw :function _trc_DxChar_draw(c) {\n      var _this=this.isTonyuObject?this:Tonyu.not_a_tonyu_object(this);\n      \n      //$LASTPOS=39000212;//kernel.DxChar:212\n      _this.rotation=_this.angle;\n      //$LASTPOS=39000233;//kernel.DxChar:233\n      Tonyu.classes.kernel.SpriteChar.prototype.draw.apply( _this, [c]);\n    },\n    __dummy: false\n  },\n  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}}}\n});\n',
      'js/index.html': '<script src="concat.js"></script>\n',
      'options.json': '{\n    "compiler":{\n        "namespace": "kernel",\n        "commentLastPos": true,\n        "outputFile": "js/concat.js"\n    }\n}\n',
      'physics/': '{"BodyActor.tonyu":{"lastUpdate":1431660674619},"T2Body.tonyu":{"lastUpdate":1425264703379},"T2Mod.tonyu":{"lastUpdate":1431610155789},"T2World.tonyu":{"lastUpdate":1431611371521}}',
      'physics/BodyActor.tonyu': 'extends Actor;\nincludes T2Mod;\nnative Box2D;\n\n\\getWorld() {\n    if ($t2World) return $t2World;\n    $t2World=new T2World;\n    return $t2World;\n}\n\\onAppear() {\n    var wworld=getWorld();\n    world=wworld.world;\n    scale=wworld.scale;\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var b2BodyDef = Box2D.Dynamics.b2BodyDef;\n    var b2Body = Box2D.Dynamics.b2Body;\n    var b2FixtureDef = Box2D.Dynamics.b2FixtureDef;\n    var b2Fixture = Box2D.Dynamics.b2Fixture;\n    var b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;\n    var b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;\n    \n    var fixDef = new b2FixtureDef;\n    fixDef.density = defv(density, 1.0);\n    fixDef.friction = defv(friction, 0.5);\n    fixDef.restitution = defv(restitution, 0.2);\n    \n    var bodyDef = new b2BodyDef;\n    bodyDef.type = isStatic ? b2Body.b2_staticBody :\n    b2Body.b2_dynamicBody;\n    \n    bodyDef.position.x = x /scale;\n    bodyDef.position.y = y /scale;\n    shape=shape || (radius ? "circle" : "box");\n    var w=width,h=height;\n    if (!w) {\n        detectShape();\n        w=width*(scaleX||1);\n        h=height*(scaleY||scaleX||1);\n    }\n    if (shape=="box") {\n        if (!h) h=w;\n        fixDef.shape = new b2PolygonShape;\n        fixDef.shape.SetAsOrientedBox(w/2/scale, h/2/scale,\n        new b2Vec2(0,0),0);\n    } else {\n        radius=radius || w/2 || 16;\n        fixDef.shape = new b2CircleShape(\n        radius/scale\n        );\n        width=height=radius*2;\n    } \n    var fps=wworld.fps;\n    var r=rotation,ve=bvec(defv(vx*fps ,0),defv(vy*fps,0)),vr=defv(vrotation,0);\n    body=world.CreateBody(bodyDef);\n    body.CreateFixture(fixDef);\n    body.SetUserData(this);\n    body.SetLinearVelocity(ve);\n    rotation=r;\n    vrotation=vr;\n}\n\\allContact(klass) {\n    var res=[];\n    for (var c=world.GetContactList();c;c=c.GetNext()) {\n        if (c.IsTouching()) {\n            var a=c.GetFixtureA().GetBody().GetUserData();\n            var b=c.GetFixtureB().GetBody().GetUserData();\n            if (a===this) {\n                if (!klass || b===klass || b instanceof klass) {\n                    res.push(b);\n                }\n            } else if (b===this) {\n                if (!klass || a===klass || a instanceof klass) {\n                    res.push(a);\n                }\n            }\n        }\n    }\n    return res;\n}\n\\applyForce(fx,fy,px,py) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var scale=getWorld().scale;\n    var fps=60;\n    body.ApplyForce(new b2Vec2(fx ,fy),body.GetPosition());\n}\n\\applyImpulse(fx,fy,px,py) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    var scale=getWorld().scale;\n    var fps=60;\n    body.ApplyImpulse(new b2Vec2(fx ,fy),body.GetPosition());\n}\n\n\\applyTorque(a) {\n    body.ApplyTorque(a);\n}\n\\moveBy(dx,dy) {\n    var pos=body.GetPosition();\n    pos.x+=dx/scale;\n    pos.y+=dy/scale;\n    body.SetPosition(pos);\n}\n\\contactTo(t) {\n    return allContact(t)[0];\n}\n\\die() {\n    super.die();\n    world.DestroyBody(body);\n}\n\\addRevoluteJoint(params) {\n    // params:{x?,y?,other?}\n    params=params||{};\n    var px=params.x||x;\n    var py=params.y||y;\n    var wworld=getWorld();//wraped_world\n    var scale=wworld.scale;\n    var world=wworld.world;\n    var b2BodyDef = Box2D.Dynamics.b2BodyDef;\n    var b2Body = Box2D.Dynamics.b2Body;\n    var JDC=Box2D.Dynamics.Joints.b2RevoluteJointDef;\n    var jd=new JDC;\n    var bodyDef = new b2BodyDef;\n    bodyDef.type = b2Body.b2_staticBody;\n    bodyDef.position.x = px /scale;\n    bodyDef.position.y = py /scale;\n    var bodyB=world.CreateBody(bodyDef);\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    jd.Initialize(body,bodyB,new b2Vec2(px/scale, py/scale));\n    if (params.lowerAngle && params.upperAngle) {\n       jd.lowerAngle = rad(params.lowerAngle);\n       jd.upperAngle = rad(params.upperAngle);\n       jd.enableLimit = true;\n    }\n    world.CreateJoint(jd);    \n}\n\\rotation {\n    if (!body || manualRotation) return _rotation;\n    return deg(body.GetAngle());\n}\n\\rotation=r {\n    r=r||0;\n    if (!body || manualRotation) return _rotation=r;\n    body.SetAngle(rad(r));\n} \n\n\\updatePos() {\n/*    if (!body) return;\n    var scale=getWorld().scale;\n    var pos=body.GetPosition();\n    x=pos.x*scale;\n    y=pos.y*scale;*/\n}\n\n\\x {\n    if (!body) return _x;\n    var pos=body.GetPosition();\n    return pos.x*scale;\n}\n\\x=v {\n    if (!body) return _x=v;\n    v=v||0;\n    var pos=body.GetPosition();\n    pos.x=v/scale;\n    body.SetPosition(pos);\n}\n\\y {\n    if (!body) return _y;\n    var pos=body.GetPosition();\n    return pos.y*scale;\n}\n\\y=v {\n    if (!body) return _y=v;\n    v=v||0;\n    var pos=body.GetPosition();\n    pos.y=v/scale;\n    body.SetPosition(pos);\n}\n\n\\vx {\n    if (!body) return _vx;\n    var v=body.GetLinearVelocity();\n    return v.x*scale/getWorld().fps;\n}\n\\vx=v {\n    if (!body) return _vx=v;\n    v=v||0;\n    var ve=body.GetLinearVelocity();\n    ve.x=v/scale*getWorld().fps;\n    if (v) body.SetAwake(true);\n    body.SetLinearVelocity(ve);\n}\n\n\\vy {\n    if (!body) return _vy;\n    var v=body.GetLinearVelocity();\n    return v.y*scale/getWorld().fps;\n}\n\\vy=v {\n    if (!body) return _vy=v;\n    var ve=body.GetLinearVelocity();\n    ve.y=v/scale*getWorld().fps;\n    if (v) body.SetAwake(true);\n    body.SetLinearVelocity(ve);\n}\n\\vrotation {\n    if (!body) return _vr;\n    return deg(body.GetAngularVelocity()/getWorld().fps);\n}\n\\vrotation=v {\n    if (!body) return _vr=v;\n    v=v||0;\n    if (v) body.SetAwake(true);\n    body.SetAngularVelocity(rad(v*getWorld().fps));\n}\n\n',
      'physics/T2Body.tonyu': 'extends BodyActor;\n',
      'physics/T2Mod.tonyu': 'native Box2D;\n\n\\bvec(tx,ty) {\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    return new b2Vec2(tx/scale,ty/scale);  \n}\n\n\\defv(t,d) {\n    return ( t===t && (typeof t)==="number") ? t : d;\n}\n\n',
      'physics/T2World.tonyu': 'extends Actor;\n\nincludes T2Mod;\n\nnative Box2D;\nnative Tonyu;\n\\onAppear() {\n    $currentProject.requestPlugin("box2d");  \n    initWorld();\n}\nloop();\n\n\n\\initWorld() {\n    gravity=defv(gravity, 9.8);\n    gravityX=defv(gravityX, 0);\n    fps=$Boot.getFrameRate();\n    var b2World = Box2D.Dynamics.b2World;\n    var b2Vec2 = Box2D.Common.Math.b2Vec2;\n    scale=scale || 32;\n    world = new b2World(\n    new b2Vec2(gravityX, gravity)    //gravity\n    ,  true                 //allow sleep\n    );\n    $t2World=this;\n    $Boot.on("stop",releaseWorld);\n    on("die",releaseWorld);\n}\n\\releaseWorld() {\n    if ($t2World===this) $t2World=null;\n}\n\n\\loop() {\n    while(true) {\n        fps=$Boot.getFrameRate();\n        world.Step(\n        1 / fps  //frame-rate\n        ,  10       //velocity iterations\n        ,  10       //position iterations\n        );\n        //world.DrawDebugData();\n        world.ClearForces();\n        //updatePos();\n        update();\n    }\n}\n\\updatePos() {\n    for (var b=world.GetBodyList();b;b=b.GetNext()) {\n        var d=b.GetUserData();\n        if(d) d.updatePos();\n    }\n}\n',
      'sound/': '{"MediaPlayer.tonyu":{"lastUpdate":1421384204625},"MML.tonyu":{"lastUpdate":1424849946399},"PlayMod.tonyu":{"lastUpdate":1425018365373},"T2MediaPlayer.tonyu":{"lastUpdate":1432606533205},"WaveTable.tonyu":{"lastUpdate":1412697666000}}',
      'sound/MML.tonyu': 'extends TObject;\nincludes MathMod;\nnative T;\n\nmmlBuf=[];\n\\play(mmls) {\n    mmlBuf.push(mmls);\n    if (!isPlaying()) {\n        playNext();\n    }\n}\n\\playNext() {\n    //print("play!", id(), bufferCount());\n    if (cTimeBase==null) cTimeBase=0;\n    if (m) {\n        cTimeBase+=m.currentTime;\n        //print(m.currentTime);\n    }\n    var mml=mmlBuf.shift();\n    if (!mml) {\n        m=null;\n        cTimeBase=0;\n        return;\n    }\n    mwav=$WaveTable.get(0,0).play();\n    m=T("mml", {mml}, mwav);\n    m.on("ended", playNext);\n    m.start();\n    $MMLS[id()]=this;\n}\n\\id() {\n    if (!_id) _id=rnd()+"";\n    return _id;\n}\n\\bufferCount() {\n    return mmlBuf.length;\n}\n\\isPlaying() {\n    return m;\n}\n\\currentTime() {\n    if (m) return m.currentTime+cTimeBase;\n    return -1;\n}\n\\stop() {\n    if (m) {\n        if (mwav) {\n            mwav.pause();\n            mwav.stop();\n        }\n        m.pause();\n        m.stop();\n        m=null;\n        mmlBuf=[];\n        //print("stop!", id(), bufferCount());\n        delete $MMLS[id()];\n    }\n}\n',
      'sound/MediaPlayer.tonyu': '\n\\play() {\n    \n}\n\\stop() {\n    \n}\n\\playSE() {\n    \n}\n\\setDelay(){\n    \n}\n\\setVolume(){\n    \n}',
      'sound/PlayMod.tonyu': 'extends BaseActor;\nnowait \\initMML() {\n    if (mmlInited) return;\n    mmlInited=true;\n    $currentProject.requestPlugin("timbre");\n    if (!$MMLS) {\n       $MMLS={};\n       $WaveTable=new WaveTable;\n       $Boot.on("stop", releaseMML);\n    }\n    on("die") \\() { play().stop(); };\n}\nnowait \\releaseMML() {\n    if ($MMLS) {\n       for (var k,v in $MMLS) {\n          v.stop();\n       }\n       $MMLS=null;\n    } \n    if ($WaveTable) {\n       $WaveTable.stop();\n       $WaveTable=null;\n    }\n}\n\\play() {\n    initMML();\n    if (!_mml) _mml=new MML;\n    if (isDead() || arguments.length==0) return _mml;\n    var mmls=[];\n    for (var i=0; i<arguments.length; i++) {\n        mmls.push(arguments[i]);\n    }\n    _mml.play(mmls);\n    while (_mml.bufferCount()>2) {\n        update();\n    }\n    return _mml;\n}\nnowait \\playSE() {\n    initMML();\n    var mml=new MML;\n    var mmls=[];\n    for (var i=0; i<arguments.length; i++) {\n        mmls.push(arguments[i]);\n    }\n    mml.play(mmls);\n    return mml;\n}\n',
      'sound/T2MediaPlayer.tonyu': 'extends Actor;\n\nnative T2MediaLib;\nnative Tonyu;\n\n\\new() {\n    initT2MediaPlayer();\n}\n\n\\initT2MediaPlayer() {\n    if (T2MediaLib.inited) return;\n    T2MediaLib.init();\n    T2MediaLib.inited=true;\n    bgmPlayerMax = T2MediaLib.bgmPlayerMax;\n}\n\n\\clearSEData() {\n    T2MediaLib.allStopBGM();\n    T2MediaLib.allClearData();\n}\n\n\\clearBGMData() {\n    clearSEData();\n}\n\n\\deleteSEData(idx) {\n    T2MediaLib.clearData(idx);\n}\n\n// SE //\n\\loadSE(idx, src) {//@hoge1e3\n    // 非同期呼び出し\n    runAsync \\(succ,err) {\n       // 読み込み完了するまでブロッキング\n       T2MediaLib.loadSE(idx, src) {succ,err};\n    };\n    var data = T2MediaLib.getSEData(idx);\n    /*\n    while (data == null) {\n        update();\n        data = T2MediaLib.getSEData(idx);\n    }*/\n    return data;\n}\n\n\\available {\n    return !!T2MediaLib.context;\n}\n//@hoge1e3\n\\loadFromProject(prj) {\n    if (!available) return;\n    var r=prj.getResource();\n    if (!r || !r.sounds) return;\n    for (var s in r.sounds) {\n         var name=s.name, url=Tonyu.Assets.resolve(s.url, prj.getDir());\n         Tonyu.setGlobal(name, name);\n         try {\n            print("Loading Sound: "+name);\n            loadSE(name, url);\n         } catch(e) {\n            print("Fail");\n            Tonyu.setGlobal(name, "ERROR");\n         }\n    }\n}\n\n\n// vol:0-128\n\\playSE(idx, vol, rate, offset, loop, loopStart, loopEnd) {\n    if (mute) return;\n    // vol : Tonyu1のように0～128の範囲にする\n    if (vol == null) vol = 128;\n    // vol はgainで実装しているため絶対値の大きい値を入れると危険\n    // そのため0.0～1.0の範囲になるようにする\n    if      (vol <   0) vol =   0;\n    else if (vol > 128) vol = 128;\n    return T2MediaLib.playSE(idx, vol / 128, rate, offset, loop, loopStart, loopEnd);\n}\n\n\\stopSE(sourceObj) {\n    return T2MediaLib.stopSE(sourceObj);\n}\n\n\\getSEData(idx) {\n    return T2MediaLib.getSEData(idx);\n}\n\n\n// BGM //\n\\loadBGM(idx, src) {\n    // 非同期呼び出し\n    T2MediaLib.loadBGM(idx, src);\n    // 読み込み完了するまでブロッキング\n    var data = T2MediaLib.getBGMData(idx);\n    while (data == null) {\n        update();\n        data = T2MediaLib.getBGMData(idx);\n    }\n    return data;\n}\n\n\\playBGM(idx, loop, offset, loopStart, loopEnd) {\n    if (mute) return;\n    if (loop === null) loop = false;\n    if (offset === null) offset = 0;\n    return T2MediaLib.playBGM(0, idx, loop, offset, loopStart, loopEnd);\n}\n\n\\stopBGM() {\n    return T2MediaLib.stopBGM(0);\n}\n\n\\pauseBGM() {\n    return T2MediaLib.pauseBGM(0);\n}\n\n\\resumeBGM() {\n    return T2MediaLib.resumeBGM(0);\n}\n\n\\setBGMVolume(vol) {\n    vol = vol / 128;\n    // vol はgainで実装しているため絶対値の大きい値を入れると危険\n    // そのため0.0～1.0の範囲になるようにする\n    if      (vol > 1.0) vol = 1.0;\n    else if (vol < 0.0) vol = 0.0;\n    return T2MediaLib.setBGMVolume(0, vol);\n}\n\n\\setBGMTempo(tempo) {\n    //if      (tempo > 4.0) tempo = 4.0;\n    //else if (tempo < 0.5) tempo = 0.5;\n    return T2MediaLib.setBGMTempo(0, tempo);\n}\n\n\\getBGMCurrentTime() {\n    return T2MediaLib.getBGMCurrentTime(0);\n}\n\n\\getBGMLength() {\n    return T2MediaLib.getBGMLength(0);\n}\n\n\\getBGMData(idx) {\n    return T2MediaLib.getBGMData(idx);\n}\n\n\n\n// BGM ID指定 //\n\\playBGMID(id, idx, loop, offset, loopStart, loopEnd) {\n    if (loop === null) loop = false;\n    if (offset === null) offset = 0;\n    return T2MediaLib.playBGM(id, idx, loop, offset, loopStart, loopEnd);\n}\n\n\\stopBGMID(id) {\n    return T2MediaLib.stopBGM(id);\n}\n\n\\pauseBGMID(id) {\n    return T2MediaLib.pauseBGM(id);\n}\n\n\\resumeBGMID(id) {\n    return T2MediaLib.resumeBGM(id);\n}\n\n\\setBGMVolumeID(id, vol) {\n    vol = vol / 128;\n    // vol はgainで実装しているため絶対値の大きい値を入れると危険\n    // そのため0.0～1.0の範囲になるようにする\n    if      (vol > 1.0) vol = 1.0;\n    else if (vol < 0.0) vol = 0.0;\n    return T2MediaLib.setBGMVolume(id, vol);\n}\n\n\\setBGMTempoID(id, tempo) {\n    //if      (tempo > 4.0) tempo = 4.0;\n    //else if (tempo < 0.5) tempo = 0.5;\n    return T2MediaLib.setBGMTempo(id, tempo);\n}\n\n\\getBGMCurrentTimeID(id) {\n    return T2MediaLib.getBGMCurrentTime(id);\n}\n\n\\getBGMLengthID(id) {\n    return T2MediaLib.getBGMLength(id);\n}\n\n\\sizeBGMID() {\n    return T2MediaLib.getBGMPlayerMax();\n}\n\n\\allStopBGM() {\n    T2MediaLib.allStopBGM();\n}\n\n\n\n\\loadAudio(idx, src) {\n    // 非同期呼び出し\n    T2MediaLib.loadAudio(idx, src);\n    // 読み込み完了するまでブロッキング\n    while (T2MediaLib.getAudioData(idx) == null) update();\n}\n\n\\playAudio(idx, loop, startTime) {\n    if (loop === null) loop = false;\n    if (startTime === null) startTime = 0;\n    return T2MediaLib.playAudio(idx, loop, startTime);\n}\n\n\\stopAudio() {\n    return T2MediaLib.stopAudio();\n}\n\n\\pauseAudio() {\n    return T2MediaLib.pauseAudio();\n}\n\n\\resumeAudio() {\n    return T2MediaLib.resumeAudio();\n}\n\n\\setAudioVolume(vol) {\n    vol = vol / 128;\n    if      (vol > 1.0) vol = 1.0;\n    else if (vol < 0.0) vol = 0.0;\n    return T2MediaLib.setAudioVolume(vol);\n}\n\n\\setAudioTempo(tempo) {\n    if      (tempo > 4.0) tempo = 4.0;\n    else if (tempo < 0.5) tempo = 0.5;\n    return T2MediaLib.setAudioTempo(tempo);\n}\n\n\\setAudioPosition(time) {\n    return T2MediaLib.setAudioPosition(time);\n}\n\n\\getAudioCurrentTime() {\n    return T2MediaLib.getAudioCurrentTime();\n}\n\n\\getAudioLength() {\n    return T2MediaLib.getAudioLength();\n}\n\n\\getAudioData(idx) {\n    return T2MediaLib.getAudioData(idx);\n}\n',
      'sound/WaveTable.tonyu': 'extends TObject;\nnative T;\n\nwav={};\nenv={};\n\\setWav(num, synth) {\n    wav[num]=synth;\n}\n\\setEnv(num, synth) {\n    env[num]=synth;\n}\n\\get(w,e) {\n    var synth=T("OscGen") {osc:wav[w], env:env[e], mul:0.25};\n    return synth;\n}\n\\stop() {\n    /*for (var k,v in tbl) {\n        v.pause();\n        v.stop();\n    }*/\n}\n\nif (typeof T!=="undefined") {\n    //env=T("adsr", {a:0,d:200,s:0.5,r:10});\n    env = T("env",{table:[1, [0.6, 50], [0, 100]], releaseNode:2});\n    setEnv(0, env);\n    setWav(0, T("pulse"));\n    //    synth=T("OscGen") {wave:"pulse", env, mul:0.25};\n    //set(0,synth);    \n}\n',
      't1/': '{"DxChar.tonyu":{"lastUpdate":1421384204610},"PlainChar.tonyu":{"lastUpdate":1429593897129},"SecretChar.tonyu":{"lastUpdate":1421384204695},"SpriteChar.tonyu":{"lastUpdate":1421384204710},"T1Line.tonyu":{"lastUpdate":1427965036844},"T1Map.tonyu":{"lastUpdate":1421384204728},"T1Page.tonyu":{"lastUpdate":1421384204737},"T1Text.tonyu":{"lastUpdate":1427965019581},"TextChar.tonyu":{"lastUpdate":1429503038967}}',
      't1/DxChar.tonyu': 'extends SpriteChar;\n\n\\new (xx,yy,pp,ff,sz,rt,al){\n    super(xx,yy,pp,ff);\n    scaleX=1;\n    if (sz) scaleX=sz;\n    angle=0;\n    if (rt) angle=rt;\n    alpha=255;\n    if (al) alpha=al;\n}\n\\draw(c) {\n    rotation=angle;\n    super.draw(c);\n}\n',
      't1/PlainChar.tonyu': 'extends Actor;\n\nnative Tonyu;\nnative Math;\n\\new(x,y,p) {\n    if (Tonyu.runMode) {\n        /*if ($Scheduler) {\n            _th=$Scheduler.newThread(this, "tMain", []);\n        } else {\n            var thg=currentThreadGroup();\n            if (thg) _th=thg.addObj(this,"tMain");\n        }*/\n        _th=$Boot.schedule(this,"tMain",[]);\n        initSprite();\n    }\n    if (typeof x=="object") Tonyu.extend(this,x);\n    else if (typeof x=="number") {\n        this.x=x;\n        this.y=y;\n        this.p=p;\n    }\n}\n\\draw(c) {\n    onDraw();\n    if (_isInvisible) return;\n    super.draw(c);\n}\n\\setVisible(v) {\n    _isInvisible=!v;\n}\n\\onDraw() {\n\n}\n\\update() {\n    onUpdate();\n    super.update();\n}\n\\onUpdate() {\n\n}\n\\initSprite() {\n    if(layer && typeof layer.add=="function"){\n        layer.add(this);\n    }else{\n        $Sprites.add(this);\n    }\n    onAppear();\n}\n\\tMain() {\n    main();\n    die();\n}\n/*\\color(r,g,b) {\n    return "rgb("+[r,g,b].join(",")+")";\n}\n\n\\drawText(x,y,text,col,size) {\n    if ($debug) return;\n    if (!size) size=15;\n    if (!col) col="cyan";\n    var tp=all(T1Text).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,text,fillStyle:col, size,hidden:false};\n    }else {\n        new T1Text{x,y,text,fillStyle:col, size};\n    }\n}\n\\drawLine(x,y,tx,ty,col) {\n    if (!col) col="white";\n    var tp=all(T1Line).find \\(t) {return t.hidden;};\n    if (tp.length>0) {\n        tp[0].extend{x,y,tx,ty,col};\n    }else {\n        new T1Line{x,y,tx,ty,col};\n    }\n}*/\n\\appear(t) {\n    return t;\n}\n\\trunc(f) {\n    return Math.trunc(f);\n}\n\\loadPage(page,arg){\n    all().die();\n    new page(arg);\n    die();\n}',
      't1/SecretChar.tonyu': 'extends PlainChar;\n\n\\draw(c) {\n    \n}',
      't1/SpriteChar.tonyu': 'extends PlainChar;\n\n\\new(x,y,p,f) {\n    super(x,y,p);\n    this.f=f;\n    if (!this.x) this.x=0;\n    if (!this.y) this.y=0;\n    if (!this.p) this.p=0;\n}\n\\draw(c) {\n    if (f) {\n        if (!scaleY) scaleY=scaleX;\n        scaleX*=-1;\n    }\n    super.draw(c);\n    if (f) scaleX*=-1;\n}',
      't1/T1Line.tonyu': 'extends Actor;\n\\draw(ctx) {\n    if (hidden) return;\n    \n    ctx.strokeStyle=col;\n    ctx.beginPath();\n    ctx.moveTo(x,y);\n    ctx.lineTo(tx,ty);\n    ctx.stroke();\n    hidden=true;\n}\n',
      't1/T1Map.tonyu': 'extends Map;\nnative Tonyu;\nnative $;\n\n\\setBGColor(c) {\n    $Screen.setBGColor(c);\n}\n\\load(fileName) {\n    /*\n    o={\n        "chipWidth":"32","chipHeight":"32",\n        "pTable":[{name:"$pat_aaa", p:10}, {name:"$pat_bbb","p":25} ],\n        "baseData":[\n        [//map\n        [0,6],[0,5],[1,3],\n        [1,3],[1,2],[0,5]\n        ],\n        [//mapOn\n        [-1,-1],[1,4],[0,2],\n        [-1,-1],[-1,-1],[1,8]\n        ]\n        ]\n    }\n    */\n    var f=file("../maps/").rel(fileName);\n    var o=f.obj();\n    chipWidth=o.chipWidth;\n    chipHeight=o.chipHeight;\n    baseData=o.baseData;\n    mapTable=conv(baseData[0],o.pTable);\n    mapData=mapTable;\n    row=mapTable.length;\n    col=mapTable[0].length;\n    mapOnTable=conv(baseData[1],o.pTable);\n    mapOnData=mapOnTable;\n    \n    buf=$("<canvas>").attr{width:col*chipWidth,height:row*chipHeight};\n    initMap();   \n}\n\\conv(mat, tbl) {\n    var res=[];\n    mat.forEach \\(row) {\n        var rrow=[];\n        res.push(rrow);\n        row.forEach \\(dat) {// dat:[0,20]\n            var t=tbl[dat[0]];\n            if (t) rrow.push(Tonyu.globals[t.name]+dat[1]);\n            else rrow.push(dat[1]);\n        };\n    };\n    return res;\n}',
      't1/T1Page.tonyu': 'extends PlainChar;\n\n\\initGlobals() {\n    $chars=$Sprites.sprites;\n    $Boot.setFrameRate(60);\n    $clBlack=color(0,0,0);\n    $clRed=color(255,0,0);\n    $clGreen=color(0,255,0);\n    $clYellow=color(255,255,0);\n    $clBlue=color(0,0,255);\n    $clPink=color(255,0,255);\n    $clAqua=color(0,255,255);\n    $clWhite=color(255,255,255);\n    $mplayer=new MediaPlayer;\n}',
      't1/T1Text.tonyu': 'extends Actor;\n\\draw(c) {\n    if (hidden) return;\n    c.font=size+"px \'ＭＳ Ｐゴシック\'";\n    \n    super.draw(c);\n    hidden=true;\n}\n',
      't1/TextChar.tonyu': 'extends PlainChar;\nincludes TextRectMod;\n\n\\new (xx,yy,t,c,s){\n    super(xx,yy);\n    text="";\n    col=$clWhite;\n    size=20;\n    if (!this.x) this.x=0;\n    if (!this.y) this.y=0;\n    if (t) text=t;\n    if (c) fillStyle=c;\n    if (s) size=s;\n}\n\\draw(ctx) {\n    if (!size) size=15;\n    if (!align) align="left";\n    if (!fillStyle) fillStyle="white";\n    ctx.fillStyle=fillStyle;\n    ctx.globalAlpha=this.alpha/255;\n    ctx.font=size+"px \'ＭＳ Ｐゴシック\'";\n    var rect=drawTextRect(ctx, text, x, y, size, align , "fill");\n    width=rect.w;\n    height=rect.h;\n    \n    //    fillStyle=col;\n    //super.draw(ctx);\n}',
      'thread/': '{"ParallelMod.tonyu":{"lastUpdate":1429593932153},"Scheduler.tonyu":{"lastUpdate":1431159537947},"ThreadGroupMod.tonyu":{"lastUpdate":1430106770277}}',
      'thread/ParallelMod.tonyu': 'extends BaseActor;\nnative Tonyu;\n\nnowait \\parallel() {\n     var args=[];\n     for (var i=1; i<arguments.length; i++) {\n         args.push(arguments[i]);\n     }\n     var name=arguments[0];\n     var th;\n     /*if ($Scheduler) {\n         th=$Scheduler.newThread(this,name,args);\n     } else {\n         var thg=$currentThreadGroup;\n         if (thg) th=thg.addObj(this, name, args);\n     }*/\n     th=$Boot.schedule(this,name,args);\n     //on("die") \\{th.kill();};\n     return th;\n}\n\n',
      'thread/Scheduler.tonyu': 'extends TObject;\nnative Tonyu;\nnative console;\ncur=[];\nnext=[];\n\\addObj(obj,name,args) {\n    return newThread(obj, name, args);\n}\n\\newThread(obj, name, args, options) { //options:{pOrder, threadGroup}\n    name=name||"main";\n    args=args||[];\n    var th=Tonyu.thread();\n    th.apply(obj,name,args);\n    addToCur(th);\n    return th;\n}\n\\addToCur(th) {\n    cur.push(th);\n}\n\\addToNext(th) {\n    next.push(th);\n}\n\\stepsAll() {\n    for (var t in cur) {\n        t.steps();\n        if (t.preempted) {\n            //console.log("Preempted: ",t);\n            next.push(t);\n        }\n    }\n    cur=next;\n    next=[];\n}',
      'thread/ThreadGroupMod.tonyu': 'extends null;\n\n\\addThread(t) {\n    threads=threads||[];\n    threads.push(t);\n}\n\\addThreadGroup(tg) {\n    threadGroups=threadGroups||[];\n    threadGroups.push(tg);\n}\n\\killThreadGroup() {\n    if (threads) {\n        for (var thread in threads) {\n            thread.kill();\n        }\n    }\n    if (threadGroups) {\n        for (var threadGroup in threadGroups) {\n            threadGroup.killThreadGroup();\n        }\n    }\n}',
      'ui/': '{"GameConsole.tonyu":{"lastUpdate":1430361767671},"InputDevice.tonyu":{"lastUpdate":1416890086000},"Keys.tonyu":{"lastUpdate":1412697666000},"MapEditor.tonyu":{"lastUpdate":1421122943503},"Pad.tonyu":{"lastUpdate":1421122943510}}',
      'ui/GameConsole.tonyu': 'extends Actor;\nnative Math;\n\n\\new (opt) {\n    //opt{ canvas:$("canvas")  }\n    extend(opt);\n    cw=canvas.width();\n    ch=canvas.height();\n    $Sprites=new Sprites;\n    $Screen=gameScreen=new GameScreen{width:465, height:465, sprites:$Sprites};\n    $FrontSprites=sprites=new Sprites;\n    sprites.add(gameScreen);\n    cctx=canvas[0].getContext("2d");    \n}\n\\shouldDraw1x1(srcw,srch,dstw,dsth) {\n    // srcw=465 -> dstw=460...665\n    var larger=200;\n    var smaller=5;\n    return srcw-smaller<=dstw && dstw<=srcw+larger &&\n    srch-smaller<=dsth && dsth<=srch+larger;\n}\n\\layout() {\n    cw=canvas.width();\n    ch=canvas.height();\n    var width=gameScreen.width;\n    var height=gameScreen.height;\n    var calcw=ch/height*width; // calch=ch\n    var calch=cw/width*height; // calcw=cw\n    if (calch>ch) calch=ch;\n    if (calcw>cw) calcw=cw;\n    if (shouldDraw1x1(width,height,calcw,calch)) {\n        calcw=width;calch=height;\n    }\n    var marginw=Math.floor((cw-calcw)/2);\n    var marginh=Math.floor((ch-calch)/2);\n    gameScreen.setBounds{left:marginw,top:marginh, width: calcw, height:calch};\n}\n\\draw() {\n    layout();\n    sprites.draw(canvas[0]);\n}\n',
      'ui/InputDevice.tonyu': 'extends null;\nnative $;\nnative window;\nnative Tonyu;\n\\new() {\n    listeners=[];\n    touchEmu=true;\n}\n\\handleListeners() {\n    var l=listeners;\n    listeners=[];\n    while (l.length>0) { (l.shift())(); }\n}\n\\addOnetimeListener(l){\n    listeners.push(l);\n}\n\\initCanvasEvents(cvj) {\n    var cv=cvj[0];\n    $handleMouse=\\(e) {\n        var p=cvj.offset();\n        var mp={x:e.clientX-p.left, y:e.clientY-p.top};\n        mp=$Screen.canvas2buf(mp);\n        $mouseX=mp.x;\n        $mouseY=mp.y;\n        if (touchEmu) {\n            $touches[0].x=mp.x;\n            $touches[0].y=mp.y;\n        }\n        handleListeners();\n    };\n    $touches=[{},{},{},{},{}];\n    $touches.findById=\\(id) {\n        for (var j=0 ; j<$touches.length ; j++) {\n            if ($touches[j].identifier==id) {\n                return $touches[j];\n            }\n        }\n    };\n    $handleTouch=\\(e) {\n        touchEmu=false;\n        var p=cvj.offset();\n        e.preventDefault();\n        var ts=e.originalEvent.changedTouches;\n        for (var i =0 ; i<ts.length ; i++) {\n            var src=ts[i];\n            var dst=$touches.findById(src.identifier);\n            if (!dst) {\n                for (var j=0 ; j<$touches.length ; j++) {\n                    if (!$touches[j].touched) {\n                        dst=$touches[j];\n                        dst.identifier=src.identifier;\n                        break;\n                    }\n                }\n            }\n            if (dst) {\n                mp={x:src.pageX-p.left, y:src.pageY-p.top};\n                mp=$Screen.canvas2buf(mp);\n                dst.x=mp.x;\n                dst.y=mp.y;\n                if(!dst.touched) dst.touched=1;\n            }\n        }\n        $mouseX=$touches[0].x;\n        $mouseY=$touches[0].y;\n        handleListeners();\n    };\n    $handleTouchEnd=\\(e) {\n        var ts=e.originalEvent.changedTouches;\n        for (var i =0 ; i<ts.length ; i++) {\n            var src=ts[i];\n            var dst=$touches.findById(src.identifier);\n            if (dst) {\n                dst.touched=0;\n                dst.identifier=-1;\n            }\n        }\n        handleListeners();\n    };\n    var handleMouse=\\(e){$handleMouse(e);};\n    var handleTouch=\\(e){$handleTouch(e);};\n    var handleTouchEnd=\\(e){$handleTouchEnd(e);};\n    var d=$.data(cv,"events");\n    if (!d) {\n        $.data(cv,"events","true");\n        cvj.mousedown(handleMouse);\n        cvj.mousemove(handleMouse);\n        cvj.on("touchstart",handleTouch);\n        cvj.on("touchmove",handleTouch);\n        cvj.on("touchend",handleTouchEnd);\n    }\n}\n\n\\update() {\n    for (var i in $touches) {\n        if (i.touched>0) {i.touched++;}\n        if (i.touched==-1) i.touched=1;\n    }\n}',
      'ui/Keys.tonyu': 'extends TObject;\nnative String;\nnative $;\nnative document;\n//\\new () {this.main();}\nstats={};\ncodes={\n    left: 37 , up:38 , right: 39, down:40, space:32, enter:13,\n    shift:16, ctrl:17, alt:18, mouseleft: 1\n};\nfor (var i=65 ; i<65+26; i++) {\n    codes[String.fromCharCode(i).toLowerCase()]=i;\n}\nfor (var i=48 ; i<58; i++) {\n    codes[String.fromCharCode(i)]=i;\n}\nif (!$.data(document,"key_event")) {\n    $.data(document,"key_event",true);\n    $(document).keydown \\(e) {$Keys.keydown(e);};\n    $(document).keyup \\(e) {$Keys.keyup(e);};\n    $(document).mousedown \\(e) {\n        if ($InputDevice.touchEmu) {\n            $touches[0].touched=1;\n        }\n        $Keys.keydown{keyCode:1};\n    };\n    $(document).mouseup \\(e) {\n        if ($InputDevice.touchEmu) {\n            $touches[0].touched=0;\n        }\n        $Keys.keyup{keyCode:1};\n    };\n}\nfunction getkey(code) {\n    if (typeof code=="string") {\n        code=codes[code.toLowerCase()];\n    }\n    if (!code) return 0;\n    if (stats[code]==-1) return 0;\n    if (!stats[code]) stats[code]=0;\n    return stats[code];\n}\nfunction update() {\n    for (var i in stats) {\n        if (stats[i]>0) {stats[i]++;}\n        if (stats[i]==-1) stats[i]=1;\n    }\n}\n\\keydown(e) {\n    var s=stats[e.keyCode];\n    if (!s) {\n        stats[e.keyCode]=1;\n    }\n    $InputDevice.handleListeners();\n}\n\\keyup(e) {\n    stats[e.keyCode]=0;\n    $InputDevice.handleListeners();\n}',
      'ui/MapEditor.tonyu': 'extends Actor;\nnative prompt;\nloadMode=false;\nprint("Load Data?: Y or N");\nwhile(true){\n    if(getkey("y")>0){\n        loadMode=true;\n        break;\n    }\n    if(getkey("n")>0){\n        loadMode=false;\n        break;\n    }\n    update();\n}\nif(loadMode){\n    fileName=prompt("Input json file (*.json)","map.json");\n    if(fileName){\n        mapDataFile=file("../maps/").rel(fileName);\n    }\n    if(mapDataFile.obj()){\n        baseData=mapDataFile.obj();\n    }else{\n        mapDataFile=file(fileName);\n        if(mapDataFile.obj()){\n            baseData=mapDataFile.obj();\n        }\n    }\n    if(baseData==undefined){\n        print("Load failed");\n        loadMode=false;\n    }else if(baseData[0] && baseData[1]){\n        mapData=baseData[0];\n        mapOnData=baseData[1];\n    }\n}\nupdate();\n//if(mapData){\n    /*\n    print("Load Data?: Y or N");\n    while(true){\n        if(getkey("y")==1){\n            loadMode=true;\n            break;\n        }\n        if(getkey("n")==1){\n            loadMode=false;\n            break;\n        }\n    }*/\n//}\nif(!loadMode){\n    row=prompt("input row");\n    update();\n    col=prompt("input col");\n    panel=new Panel{width:col*32,height:row*32};\n    panel.x=panel.width/2+10;\n    panel.y=panel.height/2;\n    panel.setFillStyle("cyan");\n    panel.fillRect(0,0,panel.width,panel.height);\n    $map=new Map{row,col,chipWidth:32,chipHeight:32};\n}else{\n    if(!mapOnData){\n        $map=new Map{row:mapData.length,col:mapData[0].length,chipWidth:32,chipHeight:32,mapData};\n    }else{\n        $map=new Map{row:mapData.length,col:mapData[0].length,chipWidth:32,chipHeight:32,mapData,mapOnData};\n    }\n    panel=new Panel{width:$map.col*32,height:$map.row*32,zOrder:100};\n    panel.x=panel.width/2;\n    panel.y=panel.height/2;\n    panel.setFillStyle("cyan");\n    panel.fillRect(0,0,panel.width,panel.height);\n}\n$mp=new Map{row:16,col:8,chipWidth:32,chipHeight:32};\ncounter=0;\nfor(var i=0;i<16;i++){\n    for(var j=0;j<8;j++){\n        $mp.set(j,i,$pat_mapchip+counter);\n        counter++;\n    }\n}\nmode="get";\nprevMode="set";\nmapp=0;\nmx=0;\nmy=0;\nchipX=0;\nchipY=0;\nx=$screenWidth-16;\ny=$screenHeight-16;\nwhile(true){\n    p=mapp;\n    if(getkey("e")==1){\n        $mp.scrollTo(1000,1000);\n        mode="erase";\n        print(mode+" mode");\n    }\n    if(getkey("s")==1){\n        $mp.scrollTo(1000,1000);\n        if(mode=="set"){\n            mode="setOn";\n        }else{\n            mode="set";\n        }\n        print(mode+" mode");\n    }\n    if(getkey("o")==1){\n        $mp.scrollTo(1000,1000);\n        mode="setOn";\n    }\n    if(getkey("g")==1){\n        if(mode!="get"){\n            prevMode=mode;\n            $mp.scrollTo(0,0);\n            mode="get";\n            chipX=0;\n            chipY=0;\n        }else{\n            $mp.scrollTo(1000,1000);\n            mode=prevMode;\n        }\n        print(mode+" mode");\n    }\n    if(getkey("p")==1){\n        //add\n        saveFileName=prompt("input json file(*.json)","map.json");\n        /*print("mapTable=[");\n        data="[";\n        for(var i=0;i<$map.row-1;i++){\n            var tmp=[];\n            tmp=$map.mapTable[i].concat(tmp);\n            print("["+tmp+"],");\n            data+="["+tmp+"],";\n        }\n        var tmp=[];\n        tmp=$map.mapTable[i].concat(tmp);\n        print("["+tmp+"]");\n        data+="["+tmp+"]";\n        print("];");\n        data+="]";*/\n        //add\n        saveDataFile=file("../maps/").rel(saveFileName);\n        data=[$map.mapTable,$map.mapOnTable];\n        //comment\n        //mapDataFile.obj(data);\n        //add\n        saveDataFile.obj(data);\n        print(saveFileName+" Saved");\n        //mapDataFile.obj.push($map.mapOnTable);\n    }\n    if(getkey("c")==1){\n        $mp.scrollTo(1000,1000);\n        mode="spuit";\n        print(mode+" mode");\n    }\n    if(mode!="get"){\n        if(getkey("left")>0) mx=mx+8;\n        if(getkey("right")>0) mx=mx-8;\n        if(getkey("up")>0) my=my+8;\n        if(getkey("down")>0) my=my-8;\n        $map.scrollTo(mx,my);\n    }else{\n        if(getkey("left")>0) chipX=chipX+8;\n        if(getkey("right")>0) chipX=chipX-8;\n        if(getkey("up")>0) chipY=chipY+8;\n        if(getkey("down")>0) chipY=chipY-8;\n        $mp.scrollTo(chipX,chipY);\n    }\n    panel.x=panel.width/2-mx;\n    panel.y=panel.height/2-my;\n    if(mode=="set" && getkey(1)>0){\n        $map.setAt($mouseX+mx,$mouseY+my,mapp);\n        $map.setOnAt($mouseX+mx,$mouseY+my,-1);\n    }else if(mode=="erase" && getkey(1)>0){\n        $map.setAt($mouseX+mx,$mouseY+my,-1);\n    }else if(mode=="get" && getkey(1)>0){\n        mapp=$mp.getAt($mouseX+chipX,$mouseY+chipY);\n        mode=prevMode;\n        $mp.scrollTo(1000,1000);\n        print(mode+" mode");\n        updateEx(10);\n    }else if(mode=="setOn" && getkey(1)>0){\n        $map.setOnAt($mouseX+mx,$mouseY+my,mapp);\n    }else if(mode=="spuit" && getkey(1)>0){\n        mapp=$map.getAt($mouseX+mx,$mouseY+my);\n        mode="set";\n        print(mode+" mode");\n        updateEx(10);\n    }\n    update();\n}',
      'ui/Pad.tonyu': 'extends Actor;\n\\new(opt) {\n    super(opt);\n    padImageP = $pat_inputPad;\n    jujiKey = new Actor{x:96+1, y:$screenHeight-96-1, p:padImageP+0,zOrder:-9,layer:$FrontSprites};\n    no1Key = new Actor{x:$screenWidth-96, y:$screenHeight-96, p:padImageP+1,zOrder:-9,layer:$FrontSprites};\n    jujiKey.show();\n    no1Key.show();\n    \n    jujiKeyPushU = new Actor{x:jujiKey.x, y:jujiKey.y-60, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushL = new Actor{x:jujiKey.x-60, y:jujiKey.y, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushR = new Actor{x:jujiKey.x+60, y:jujiKey.y, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushD = new Actor{x:jujiKey.x, y:jujiKey.y+60, p:padImageP+2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPush1 = new Actor{x:no1Key.x, y:no1Key.y, p:padImageP+2, scaleX:2, zOrder:-10,layer:$FrontSprites};\n    jujiKeyPushU.hide();\n    jujiKeyPushL.hide();\n    jujiKeyPushR.hide();\n    jujiKeyPushD.hide();\n    jujiKeyPush1.hide();\n}\n\\die(){\n    jujiKey.die();\n    no1Key.die();\n    jujiKeyPushU.die();\n    jujiKeyPushL.die();\n    jujiKeyPushR.die();\n    jujiKeyPushD.die();\n    jujiKeyPush1.die();\n    super.die();\n}\nAPAD_DIAG_SIZE = 96;\n\\padUpdate() {\n    // 操作 //\n    keyPushL = 0;\n    keyPushR = 0;\n    keyPushU = 0;\n    keyPushD = 0;\n    keyPush1 = 0;\n    \n    padKeyNotapCnt ++;\n    for (var i=0; i<5; i++) { // タップ判定・マウス判定 //\n        var t = $touches[i];\n        if (t.touched) {\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-APAD_DIAG_SIZE/2, jujiKey.y-32-64, 64+APAD_DIAG_SIZE, 64)) keyPushU = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-APAD_DIAG_SIZE/2, jujiKey.y-32+64, 64+APAD_DIAG_SIZE, 64)) keyPushD = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32-64, jujiKey.y-32-APAD_DIAG_SIZE/2, 64, 64+APAD_DIAG_SIZE)) keyPushL = 1;\n            if (isOnRectWH(t.x, t.y, jujiKey.x-32+64, jujiKey.y-32-APAD_DIAG_SIZE/2, 64, 64+APAD_DIAG_SIZE)) keyPushR = 1;\n            if (isOnRectWH(t.x, t.y, no1Key.x-64, no1Key.y-64, 128, 128)) keyPush1 = 1;\n            padKeySW = 1;\n            padKeyNotapCnt = 0;\n        }\n    }\n    \n    // カウントアップ\n    if (keyPushL) keyCntL ++; else keyCntL = 0;\n    if (keyPushR) keyCntR ++; else keyCntR = 0;\n    if (keyPushU) keyCntU ++; else keyCntU = 0;\n    if (keyPushD) keyCntD ++; else keyCntD = 0;\n    if (keyPush1) keyCnt1 ++; else keyCnt1 = 0;\n    \n    // 表示\n    if (keyPushL) jujiKeyPushL.show(); else jujiKeyPushL.hide();\n    if (keyPushR) jujiKeyPushR.show(); else jujiKeyPushR.hide();\n    if (keyPushU) jujiKeyPushU.show(); else jujiKeyPushU.hide();\n    if (keyPushD) jujiKeyPushD.show(); else jujiKeyPushD.hide();\n    if (keyPush1) jujiKeyPush1.show(); else jujiKeyPush1.hide();\n    \n}\n\n\\getPadUp()    { return keyCntU; }\n\\getPadDown()  { return keyCntD; }\n\\getPadLeft()  { return keyCntL; }\n\\getPadRight() { return keyCntR; }\n\\getPadButton(i) {\n    var value;\n    if (i == 0) value = keyCnt1;\n    return value;\n}\n\n\\getUp()    { return keyCntU; }\n\\getDown()  { return keyCntD; }\n\\getLeft()  { return keyCntL; }\n\\getRight() { return keyCntR; }\n\\getButton(i) {\n    var value;\n    if (i == 0) value = keyCnt1;\n    return value;\n}\n\n// 範囲 //\n\\isOnRect(mx, my, rx, ry, rx2, ry2) {\n    return (rx <= mx && mx < rx2 && ry <= my && my < ry2);\n}\n\n// 範囲 //\n\\isOnRectWH(mx, my, rx, ry, rw, rh) {\n    return (rx <= mx && mx < rx+rw && ry <= my && my < ry+rh);\n}\n\nwhile(true) {\n    padUpdate();\n    update();\n}'
    }
  };
  if (WebSite.devMode || WebSite.disableROM['ROM_k.js'] || WebSite.isNW) {
    rom.base='/ROM'+rom.base;
  } else {
    FS.mountROM(rom);
  }
})();