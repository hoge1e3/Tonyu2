{"version":3,"sources":["/prj/user/Main.tonyu","/prj/user/Player.tonyu"],"names":[],"mappings":"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","sourcesContent":["// ゲームパッドの判定にはJavaScriptのGamepad APIを利用しています\n\n// Gamepad APIに対応している環境は\n// コントローラー４台接続まで対応している模様\n// ５台目は無視するブラウザが多い（PC版Firefoxでは５台目も取得できた）\n\n$Screen.resize(640, 480); // 画面サイズ変更\n\n// Playerを16人用意\nfor (var i=0; i<16; i++) {\n    new Player {\n        playerNo : i, // コントローラ番号を渡す\n        x : (i%4+1)/5*$screenWidth,\n        y : (trunc(i/4)+1)/5*$screenHeight,\n        p : $pat_base+i\n    };\n}\n\nx = 0;\ny = 0;\nalign = \"left\";\nwhile (true) {\n    if ($GamePad.available) {\n        // 接続中のコントローラの数\n        text = \"padsCount : \"+$GamePad.padsCount();\n    } else {\n        text = \"このデバイス・ブラウザはGamepad APIに対応していません\";\n    }\n    update();\n}\n\n","// １つのキャラごとに１つのコントローラを担当する\n\nalpha = 0; // 最初は非表示\nNEUTRAL_AXIS = 0.15; // 軸が傾いても中立として扱う角度(0.0～1.0)\n\n// playerNo : この値のコントローラ番号を監視する\ngamePad = $GamePad.get(playerNo);\n\nanalogMode = true;\nwhile (true) {\n    scaleX = 1;\n    scaleY = 1;\n    \n    // コントローラが接続されているかチェック\n    connected = gamePad.isConnected();\n    \n    if (connected) { // 接続されている\n        \n        // ボタンが押されているか取得 //\n        // コントローラの0,1,2,3番目のボタン\n        if (gamePad.getButton(0)) {scaleX = 1.5; scaleY = 1.5;}\n        if (gamePad.getButton(1)) alpha = 127;\n        if (gamePad.getButton(2)) analogMode = true;\n        if (gamePad.getButton(3)) analogMode = false;\n        // コントローラの6,7番目のボタン(アナログ値取得)\n        rotation -= 5 * gamePad.getButtonValue(6);\n        rotation += 5 * gamePad.getButtonValue(7);\n        \n        if (analogMode) {\n            // アナログ移動\n            // コントローラの0,1番目の軸（横軸・縦軸）\n            vx = gamePad.getAxis(0);\n            vy = gamePad.getAxis(1);\n            // アナログスティックは中立でも少し傾いているのである程度傾けると動くようにする\n            if (dist(vx,vy) >= NEUTRAL_AXIS) {\n                // 斜め移動のとき移動が速くならないようにする\n                var ang = atanxy(vx, vy);\n                var maxvx = cos(ang);\n                var maxvy = sin(ang);\n                vx = clamp(vx, -maxvx, maxvx);\n                vy = clamp(vy, -maxvy, maxvy);\n                x += vx * 3;\n                y += vy * 3;\n            }\n        } else {\n            // 単純な移動（デジタル移動）\n            // コントローラの左キー or 14番目のボタン\n            if (gamePad.getLeft() || gamePad.getButton(14)) x -= 3;\n            // コントローラの右キー or 15番目のボタン\n            if (gamePad.getRight() || gamePad.getButton(15)) x += 3;\n            // コントローラの上キー or 12番目のボタン\n            if (gamePad.getUp() || gamePad.getButton(12)) y -= 3;\n            // コントローラの下キー or 13番目のボタン\n            if (gamePad.getDown() || gamePad.getButton(13)) y += 3;\n        }\n        \n        // 画面外出ないように制限\n        x = clamp(x, 16, $screenWidth-16);\n        y = clamp(y, 16, $screenHeight-16);\n        \n        alpha += 5;\n        \n    } else { // 接続されていない\n        alpha -= 1/2;\n    }\n    \n    alpha = clamp(alpha, 50, 255); // alphaが10～255を超えないように制限\n    drawStatus(); // ボタン・軸の状態などを表示\n    \n    update();\n}\n\n// ボタン・軸の状態などを表示\n\\drawStatus() {\n    if (alpha <= 50) return; // 接続されていないとき表示しない\n    \n    var tx = x - 30;\n    var ty = y - 40;\n    var tSize = 12;\n    var tColor = \"white\";\n    var textA = analogMode ? \"(アナログ移動)\" : \"(デジタル移動)\";\n    \n    // コントローラ番号を表示 //\n    drawText(tx, ty, (playerNo+1)+\"P \"+textA, tColor, tSize); ty += 60;\n    // id：コントローラの識別名\n    drawText(tx, ty, \"id :\"+gamePad.getPadId(), tColor, tSize); ty += tSize;\n    // マッピング：\"standard\"なら標準ゲームパッド、それ以外は\"\"(空文字)\n    drawText(tx, ty, \"mapping :\"+gamePad.getMapping(), tColor, tSize); ty += tSize;\n    \n    buttonCnt = gamePad.getButtonCount(); // ボタン数\n    for (var i=0; i<buttonCnt; i++) {\n        // ボタンを押した時間(フレーム単位)\n        var b = gamePad.getButton(i);\n        // ボタンを押した深さ(0.0～1.0)\n        var v = gamePad.getButtonValue(i);\n        drawText(tx, ty, \"b[\"+i+\"]:\"+b+\" v:\"+v, tColor, tSize); ty += tSize;\n    }\n    \n    axisCnt = gamePad.getAxisCount(); // 軸の数\n    for (var i=0; i<axisCnt; i++) {\n        // 軸の傾き(-1.0～1.0)\n        var a = gamePad.getAxis(i);\n        drawText(tx, ty, \"a[\"+i+\"]:\"+a, tColor, tSize); ty += tSize;\n    }\n    \n    // 上下左右キーを押した時間(フレーム単位)\n    drawText(tx, ty, \"left :\"+gamePad.getLeft(), tColor, tSize); ty += tSize;\n    drawText(tx, ty, \"right:\"+gamePad.getRight(), tColor, tSize); ty += tSize;\n    drawText(tx, ty, \"up   :\"+gamePad.getUp(), tColor, tSize); ty += tSize;\n    drawText(tx, ty, \"down :\"+gamePad.getDown(), tColor, tSize);\n}\n"]}