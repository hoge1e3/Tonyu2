<html><head><meta charset="utf-8"/>
<meta http-equiv="Content-type" content="text/html; charset=utf8"/>
<title>classDef</title>
</head><body><link rel='stylesheet' href='../../css/bootstrap.css'/>
<link rel='stylesheet' href='../../css/tonyu.css'/>
<style>body{padding-top:20px; margin-left: 20px; margin-right:20px; font-family:"MS UI Gothic",sans-serif;}</style>
<button onclick='javascript:history.back();'>←Back</button><br/>
<div><a id="line_marker_-0" name="line_marker_-0"></a><a href="lang.html">lang</a><span>
</span><a id="line_marker_-1" name="line_marker_-1"></a><p></p><h1><a id="line_marker_-2" name="line_marker_-2"></a><span>クラス定義</span></h1><a id="line_marker_-3" name="line_marker_-3"></a><p></p><a id="line_marker_-4" name="line_marker_-4"></a><span>Tonyu2では，1つの</span><a href="fs.html">ファイル</a><span>に1つのクラスを定義します．</span><span>
</span><a id="line_marker_-5" name="line_marker_-5"></a><p></p><a id="line_marker_-16" name="line_marker_-16"></a><ul><li><a id="line_marker_-6" name="line_marker_-6"></a><span>ファイル名は &lt;&lt;クラス名&gt;&gt;.tonyu という形式になります．</span><span>
</span></li><a id="line_marker_-8" name="line_marker_-8"></a><ul><li><a id="line_marker_-7" name="line_marker_-7"></a><span> 例えば，Hello.tonyu という名前のファイルは，Hello という名前のクラスを定義します．</span><span>
</span></li></ul><li><span>クラスを定義するための構文（例えば，Javaの</span><code><span>class クラス名 {...  }</span></code><span>など）はありません．</span><span>
</span></li><li><a id="line_marker_-9" name="line_marker_-9"></a><span> ファイルには，次のいずれかを複数記述できます．</span><span>
</span></li><a id="line_marker_-15" name="line_marker_-15"></a><ul><li><a id="line_marker_-10" name="line_marker_-10"></a><span>継承宣言</span><span>
</span></li><li><a id="line_marker_-11" name="line_marker_-11"></a><span>組み込み宣言</span><span>
</span></li><li><a id="line_marker_-12" name="line_marker_-12"></a><span>native宣言</span><span>
</span></li><li><a id="line_marker_-13" name="line_marker_-13"></a><span>mainメソッドの処理内容</span><span>
</span></li><li><a id="line_marker_-14" name="line_marker_-14"></a><span>非mainメソッドの定義</span><span>
</span></li></ul><li><span> 定義された(Tonyu2の)クラスは，Javascriptのいわゆる「クラス」(function+prototypeによるメソッド定義）として機能します．</span><span>
</span></li></ul><p></p><h2><a id="line_marker_-17" name="line_marker_-17"></a><span>継承宣言</span></h2><a id="line_marker_-18" name="line_marker_-18"></a><p></p><a id="line_marker_-19" name="line_marker_-19"></a><span>このクラスの親クラスを設定します．ファイルの先頭に次のように宣言します</span><span>
</span><a id="line_marker_-20" name="line_marker_-20"></a><p></p><a id="line_marker_-21" name="line_marker_-21"></a><div class="plist">継承宣言の書式</div><a id="line_marker_-23" name="line_marker_-23"></a><pre><a id="line_marker_-22" name="line_marker_-22"></a><span>extends 親クラス名;</span><span>
</span></pre><a id="line_marker_-24" name="line_marker_-24"></a><p></p><a id="line_marker_-28" name="line_marker_-28"></a><ul><li><a id="line_marker_-25" name="line_marker_-25"></a><span>継承宣言を省略すると，</span><a href="options.html">プロジェクト設定</a><span>によって設定されている親クラスを自動的に継承します．</span><span>
</span></li><li><a id="line_marker_-26" name="line_marker_-26"></a><span>親クラス名 に </span><code><span>null</span></code><span>を設定すると，親クラスがないクラスになります．</span><span>
</span></li><li><a id="line_marker_-27" name="line_marker_-27"></a><span>継承は，JavaScriptの一般的な継承の方法（このクラスを表す関数オブジェクトのprototypeが，親クラスのオブジェクトになる）で行われます．</span><span>
</span></li></ul><p></p><h2><a id="line_marker_-29" name="line_marker_-29"></a><span>組み込み宣言</span></h2><a id="line_marker_-30" name="line_marker_-30"></a><p></p><a id="line_marker_-31" name="line_marker_-31"></a><span>このクラスに組み込むクラス（モジュールクラス）を設定します．ファイルの先頭，または継承宣言続いて次のように宣言します</span><span>
</span><a id="line_marker_-32" name="line_marker_-32"></a><p></p><a id="line_marker_-33" name="line_marker_-33"></a><div class="plist">継承宣言の書式</div><a id="line_marker_-35" name="line_marker_-35"></a><pre><a id="line_marker_-34" name="line_marker_-34"></a><span>includes モジュールクラス名[, モジュールクラス名...];</span><span>
</span></pre><a id="line_marker_-36" name="line_marker_-36"></a><p></p><a id="line_marker_-43" name="line_marker_-43"></a><ul><li><a id="line_marker_-37" name="line_marker_-37"></a><span>このクラスでは，組み込んだモジュールクラスがもつメソッドを利用できます．</span><span>
</span></li><li><a id="line_marker_-38" name="line_marker_-38"></a><span>組み込みは継承とは異なり，複数のクラスを組み込むことができます</span><span>
</span></li><li><a id="line_marker_-39" name="line_marker_-39"></a><span>モジュールクラスの実体は通常のクラスと同じ方法で作成します．</span><span>
</span></li><li><a id="line_marker_-40" name="line_marker_-40"></a><span>モジュールクラスが他のモジュールクラスを組み込んでいる場合，組み込んだ先のクラスでもそれらのモジュールクラスのメソッドが組み込まれます．</span><span>
</span></li><li><a id="line_marker_-41" name="line_marker_-41"></a><span>モジュールクラスが他のクラスを継承している場合，組み込んだ先のクラスもそのモジュールの親クラスを継承している必要があります．</span><span>
</span></li><li><a id="line_marker_-42" name="line_marker_-42"></a><span>組み込みは，モジュールクラスがもつメソッドの一覧を，このクラスの関数オブジェクトのprototypeオブジェクトに追記する方式で行われます．継承とは異なり，</span><code><span>instanceof</span></code><span>演算子によって検査されるオブジェクトのクラスが，特定のモジュールクラスを組み込んでいるかどうかは判定できません．</span><span>
</span></li></ul><p></p><h2><a id="line_marker_-44" name="line_marker_-44"></a><span>native宣言</span></h2><a id="line_marker_-45" name="line_marker_-45"></a><p></p><a id="line_marker_-46" name="line_marker_-46"></a><span>native宣言は，Tonyu2のプログラムからJavascriptのネイティブオブジェクトにアクセスするために用います．ファイル中で次のように宣言します．</span><span>
</span><a id="line_marker_-47" name="line_marker_-47"></a><p></p><a id="line_marker_-48" name="line_marker_-48"></a><div class="plist">native宣言の書式</div><a id="line_marker_-50" name="line_marker_-50"></a><pre><a id="line_marker_-49" name="line_marker_-49"></a><span>native 変数名;</span><span>
</span></pre><a id="line_marker_-51" name="line_marker_-51"></a><p></p><a id="line_marker_-54" name="line_marker_-54"></a><ul><li><a id="line_marker_-52" name="line_marker_-52"></a><span> 指定された変数名を，このファイル中ではJavascriptのトップレベルスコープ（一般的にはwindowオブジェクト）に定義されている変数の値として扱います．</span><span>
</span></li><li><a id="line_marker_-53" name="line_marker_-53"></a><span> 親クラスに書いてあるnative宣言は子クラスには適用されません．必要に応じて子クラスにも同じnative宣言を書く必要があります．</span><span>
</span></li></ul><p></p><h2><a id="line_marker_-55" name="line_marker_-55"></a><span>mainメソッドの処理内容</span></h2><a id="line_marker_-56" name="line_marker_-56"></a><p></p><a id="line_marker_-57" name="line_marker_-57"></a><span>mainメソッドは，mainという名前をもつメソッドです．</span><a href="Actor.html">Actor</a><span>クラスなどでは，オブジェクトが出現してから停止するまでの動作を記述するのに用いられます．</span><span>
</span><a id="line_marker_-58" name="line_marker_-58"></a><p></p><a id="line_marker_-59" name="line_marker_-59"></a><span>ファイルのトップレベル（メソッド定義に囲まれていない部分）に書かれた文はmainメソッドの内容として定義されます．</span><span>
</span><a id="line_marker_-60" name="line_marker_-60"></a><p></p><a id="line_marker_-61" name="line_marker_-61"></a><span>mainメソッドは引数を受け取ることはできません．</span><span>
</span><a id="line_marker_-62" name="line_marker_-62"></a><p></p><h2><a id="line_marker_-63" name="line_marker_-63"></a><span>非mainメソッドの定義</span></h2><a id="line_marker_-64" name="line_marker_-64"></a><p></p><a id="line_marker_-65" name="line_marker_-65"></a><span>名前がmainでないメソッドは非mainメソッドです．</span><span>
</span><a id="line_marker_-66" name="line_marker_-66"></a><p></p><a id="line_marker_-67" name="line_marker_-67"></a><span>ファイルのトップレベルにおいて次の形式で定義します．</span><span>
</span><a id="line_marker_-68" name="line_marker_-68"></a><p></p><a id="line_marker_-69" name="line_marker_-69"></a><div class="plist">リスト1 メソッド定義</div><a id="line_marker_-73" name="line_marker_-73"></a><pre><a id="line_marker_-70" name="line_marker_-70"></a><span>function メソッド名(引数リスト) {</span><span>
</span><a id="line_marker_-71" name="line_marker_-71"></a><span>   処理内容</span><span>
</span><a id="line_marker_-72" name="line_marker_-72"></a><span>}</span><span>
</span></pre><a id="line_marker_-74" name="line_marker_-74"></a><span>※function の代わりに \ が使用可能です（</span><a href="sugar.html">拡張構文</a><span>参照)</span><span>
</span><a id="line_marker_-75" name="line_marker_-75"></a><p></p><h2><a id="line_marker_-76" name="line_marker_-76"></a><span>プロパティの定義</span></h2><a id="line_marker_-77" name="line_marker_-77"></a><p></p><a id="line_marker_-78" name="line_marker_-78"></a><span>プロパティ（getter/setter）は次の書式で定義します</span><span>
</span><a id="line_marker_-79" name="line_marker_-79"></a><p></p><a id="line_marker_-89" name="line_marker_-89"></a><pre><a id="line_marker_-81" name="line_marker_-81"></a><span>//getter</span><span>
</span><a id="line_marker_-82" name="line_marker_-82"></a><span>\プロパティ名 {</span><span>
</span><a id="line_marker_-83" name="line_marker_-83"></a><span>  処理内容</span><span>
</span><a id="line_marker_-84" name="line_marker_-84"></a><span>}</span><span>
</span><a id="line_marker_-85" name="line_marker_-85"></a><span>//setter</span><span>
</span><a id="line_marker_-86" name="line_marker_-86"></a><span>\プロパティ名=値 {</span><span>
</span><a id="line_marker_-87" name="line_marker_-87"></a><span>  処理内容</span><span>
</span><a id="line_marker_-88" name="line_marker_-88"></a><span>}</span><span>
</span></pre><a id="line_marker_-90" name="line_marker_-90"></a><p></p><a id="line_marker_-91" name="line_marker_-91"></a><span>例</span><span>
</span><a id="line_marker_-104" name="line_marker_-104"></a><pre><a id="line_marker_-93" name="line_marker_-93"></a><span>\myProp {</span><span>
</span><a id="line_marker_-94" name="line_marker_-94"></a><span>   print("Get myProp="+_myp);</span><span>
</span><a id="line_marker_-95" name="line_marker_-95"></a><span>   return _myp;</span><span>
</span><a id="line_marker_-96" name="line_marker_-96"></a><span>}</span><span>
</span><a id="line_marker_-97" name="line_marker_-97"></a><span>\myProp=value {</span><span>
</span><a id="line_marker_-98" name="line_marker_-98"></a><span>   print("Set myProp to "+value);</span><span>
</span><a id="line_marker_-99" name="line_marker_-99"></a><span>   _myp=value;</span><span>
</span><a id="line_marker_-100" name="line_marker_-100"></a><span>}</span><span>
</span><a id="line_marker_-101" name="line_marker_-101"></a><span>myProp=10; //  Set myProp to 10</span><span>
</span><a id="line_marker_-102" name="line_marker_-102"></a><span>x=myProp;  //  Get myProp=10</span><span>
</span><a id="line_marker_-103" name="line_marker_-103"></a><p></p></pre><a id="line_marker_-105" name="line_marker_-105"></a><p></p><a id="line_marker_-106" name="line_marker_-106"></a><p></p><h1><a id="line_marker_-107" name="line_marker_-107"></a><span>変数の種類</span></h1><a id="line_marker_-108" name="line_marker_-108"></a><p></p><ul><li><a id="line_marker_-109" name="line_marker_-109"></a><span>引数</span><span>
</span></li><a id="line_marker_-111" name="line_marker_-111"></a><ul><li><a id="line_marker_-110" name="line_marker_-110"></a><span>１つのメソッドに渡される値です．メソッド宣言の引数リストに記述されます．１回のメソッド呼び出しが終わると破棄されます．</span><span>
</span></li></ul><li><span>ローカル変数</span><span>
</span></li><a id="line_marker_-113" name="line_marker_-113"></a><ul><li><a id="line_marker_-112" name="line_marker_-112"></a><span>メソッド宣言の処理中でvar で宣言されます．１回のメソッド呼び出しが終わると破棄されます．</span><span>
</span></li></ul><li><span>グローバル変数</span><span>
</span></li><a id="line_marker_-116" name="line_marker_-116"></a><ul><li><a id="line_marker_-114" name="line_marker_-114"></a><span>名前が$で始まる変数はグローバル変数です．すべてのTonyu2オブジェクトから直接参照できます．</span><span>
</span></li><li><a id="line_marker_-115" name="line_marker_-115"></a><span>Javascriptからは</span><code><span>Tonyu.globals.グローバル変数名</span></code><span>で参照できます．</span><span>
</span></li></ul><li><span>クラス変数</span><span>
</span></li><a id="line_marker_-119" name="line_marker_-119"></a><ul><li><a id="line_marker_-117" name="line_marker_-117"></a><span>現在のプロジェクトおよび</span><a href="api.html">標準ライブラリ</a><span>で定義されているクラス名と同じ名前の変数はクラス変数です．そのクラスをあらわす関数オブジェクトを参照します．</span><span>
</span></li><li><a id="line_marker_-118" name="line_marker_-118"></a><span>Javascriptからは</span><code><span>Tonyu.classes.クラス変数名</span></code><span>で参照できます．</span><span>
</span></li></ul><li><span>native変数</span><span>
</span></li><a id="line_marker_-121" name="line_marker_-121"></a><ul><li><a id="line_marker_-120" name="line_marker_-120"></a><span>native宣言によって宣言された名前の変数です．Javascriptのトップレベルスコープにおける同名の変数を参照します．</span><span>
</span></li></ul><li><span>束縛されたメソッド</span><span>
</span></li><a id="line_marker_-124" name="line_marker_-124"></a><ul><li><a id="line_marker_-122" name="line_marker_-122"></a><span>このオブジェクトがもつメソッドと同じ名前の変数で、後ろに引数リスト</span><code><span>()</span></code><span>を伴わない場合、この変数はこのオブジェクトに束縛されたメソッドになります。この値は関数オブジェクトであり、呼び出し方にかかわらずこのオブジェクトを</span><code><span>this</span></code><span>として呼び出します。</span><span>
</span></li><li><a id="line_marker_-123" name="line_marker_-123"></a><span>後ろに引数リストを伴う場合、束縛を行わず即時にこのオブジェクトの同名のメソッドを呼び出します。</span><span>
</span></li></ul><li><span>フィールド</span><span>
</span></li><a id="line_marker_-127" name="line_marker_-127"></a><ul><li><a id="line_marker_-125" name="line_marker_-125"></a><span>そのクラスのオブジェクトがもつ値です．上のどれにもあてはまらない変数はフィールドとして解釈されます．</span><span>
</span></li><li><a id="line_marker_-126" name="line_marker_-126"></a><span>Javascriptではいわゆる</span><code><span>this.x</span></code><span>という形式で参照されるものです．Tonyu2でもこの方式でも参照できます．</span><span>
</span></li></ul></ul><p></p><h1><a id="line_marker_-128" name="line_marker_-128"></a><span>例</span></h1><a id="line_marker_-129" name="line_marker_-129"></a><p></p><a id="line_marker_-130" name="line_marker_-130"></a><div class="plist">リスト2 MyClass.tonyu</div><a id="line_marker_-143" name="line_marker_-143"></a><pre><a id="line_marker_-131" name="line_marker_-131"></a><span>extends Actor;</span><span>
</span><a id="line_marker_-132" name="line_marker_-132"></a><span>native alert;</span><span>
</span><a id="line_marker_-133" name="line_marker_-133"></a><span>// main関数</span><span>
</span><a id="line_marker_-134" name="line_marker_-134"></a><span>x=3;</span><span>
</span><a id="line_marker_-135" name="line_marker_-135"></a><span>rate=5;</span><span>
</span><a id="line_marker_-136" name="line_marker_-136"></a><span>y=mult(x);</span><span>
</span><a id="line_marker_-137" name="line_marker_-137"></a><span>alert(y); // 15</span><span>
</span><a id="line_marker_-138" name="line_marker_-138"></a><span>// main関数終わり</span><span>
</span><a id="line_marker_-139" name="line_marker_-139"></a><span>\mult(a) {</span><span>
</span><a id="line_marker_-140" name="line_marker_-140"></a><span>  var res=a*rate;</span><span>
</span><a id="line_marker_-141" name="line_marker_-141"></a><span>  return res;</span><span>
</span><a id="line_marker_-142" name="line_marker_-142"></a><span>}</span><span>
</span></pre><a id="line_marker_-144" name="line_marker_-144"></a><p></p></div><div style="height: 100px;"></div><br/><button onclick='javascript:history.back();'>←Back</button>
</body></html>