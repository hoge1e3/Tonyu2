<html>
<meta http-equiv="Content-type" content="text/html; charset=utf8">
<title>posttest</title>
<script src="../../js/lib/jquery-1.10.1.js" type="text/javascript"></script>

<script language="javascript">
$(function () {
    function s(e) {
        e.stopPropagation();
        e.preventDefault();

    }
    function upload(file, user, project, options) {
        var fd = new FormData(document.getElementById("fileinfo"));
        fd.append("theFile", file);
        fd.append("user",user);
        fd.append("project",project);
        fd.append("fileName",file.name);
        $.ajax({
            type : "get",
            url : "../../edit/blobURL",
            success : function(url) {
                $.ajax({
                    url : url,
                    type : "POST",
                    data : fd,
                    processData : false, // jQuery がデータを処理しないよう指定
                    contentType : false, // jQuery が contentType を設定しないよう指定
                    success : function(res) {
                        console.log("Res = " + res);
                        options.success(res);// $("#drag").append(res);
                    }
                });
            }
        });
    }
    function drop(e) {
            eo = e.originalEvent;
            var file = eo.dataTransfer.files[0];
            console.log(file);
            upload(file, "root", "test", {
                success: function (res) {
                    $("#drag").append(res);
                }
            });
            /*if(!file.type.match(/image\/(png|gif|jpe?g)/)[1]) {
                e.stopPropagation();
                e.preventDefault();
                return false;
            }
             */
            /*var reader = new FileReader();
            reader.onload = function(e) {
                var fileContent = reader.result;
                v.url.val(fileContent);
            }
            reader.readAsDataURL(file);
             */
            e.stopPropagation();
            e.preventDefault();
            return false;
        }
        $("#drag").on("dragover", s).on("dragenter", s).on("drop", drop);

    });
</script>
<div id="drag"> Drag File Here </div>
<!--
<form id="theForm" method="POST" enctype="multipart/form-data" >
<input type="file" name="theFile">
<input type="submit">
</form>
 -->
</html>
