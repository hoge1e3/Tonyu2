!function(){var e,t,n;!function(r){var i,o,s,a,u={},c={},l={},f={},p=Object.prototype.hasOwnProperty,h=[].slice,d=/\.js$/;function g(e,t){return p.call(e,t)}function m(e,t){var n,r,i,o,s,a,u,c,f,p,h,g=t&&t.split("/"),m=l.map,v=m&&m["*"]||{};if(e){for(s=(e=e.split("/")).length-1,l.nodeIdCompat&&d.test(e[s])&&(e[s]=e[s].replace(d,"")),"."===e[0].charAt(0)&&g&&(e=g.slice(0,g.length-1).concat(e)),f=0;f<e.length;f++)if("."===(h=e[f]))e.splice(f,1),f-=1;else if(".."===h){if(0===f||1===f&&".."===e[2]||".."===e[f-1])continue;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}if((g||v)&&m){for(f=(n=e.split("/")).length;f>0;f-=1){if(r=n.slice(0,f).join("/"),g)for(p=g.length;p>0;p-=1)if((i=m[g.slice(0,p).join("/")])&&(i=i[r])){o=i,a=f;break}if(o)break;!u&&v&&v[r]&&(u=v[r],c=f)}!o&&u&&(o=u,a=c),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function v(e,t){return function(){var n=h.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),o.apply(r,n.concat([e,t]))}}function y(e){return function(t){u[e]=t}}function b(e){if(g(c,e)){var t=c[e];delete c[e],f[e]=!0,i.apply(r,t)}if(!g(u,e)&&!g(f,e))throw new Error("No "+e);return u[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function x(e){return e?w(e):[]}s=function(e,t){var n,r,i=w(e),o=i[0],s=t[1];return e=i[1],o&&(n=b(o=m(o,s))),o?e=n&&n.normalize?n.normalize(e,(r=s,function(e){return m(e,r)})):m(e,s):(o=(i=w(e=m(e,s)))[0],e=i[1],o&&(n=b(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},a={require:function(e){return v(e)},exports:function(e){var t=u[e];return void 0!==t?t:u[e]={}},module:function(e){return{id:e,uri:"",exports:u[e],config:function(e){return function(){return l&&l.config&&l.config[e]||{}}}(e)}}},i=function(e,t,n,i){var o,l,p,h,d,m,w,S=[],_=typeof n;if(m=x(i=i||e),"undefined"===_||"function"===_){for(t=!t.length&&n.length?["require","exports","module"]:t,d=0;d<t.length;d+=1)if("require"===(l=(h=s(t[d],m)).f))S[d]=a.require(e);else if("exports"===l)S[d]=a.exports(e),w=!0;else if("module"===l)o=S[d]=a.module(e);else if(g(u,l)||g(c,l)||g(f,l))S[d]=b(l);else{if(!h.p)throw new Error(e+" missing "+l);h.p.load(h.n,v(i,!0),y(l),{}),S[d]=u[l]}p=n?n.apply(u[e],S):void 0,e&&(o&&o.exports!==r&&o.exports!==u[e]?u[e]=o.exports:p===r&&w||(u[e]=p))}else e&&(u[e]=n)},e=t=o=function(e,t,n,u,c){if("string"==typeof e)return a[e]?a[e](t):b(s(e,x(t)).f);if(!e.splice){if((l=e).deps&&o(l.deps,l.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=u,u=c),u?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),o},o.config=function(e){return o(e)},e._defined=u,(n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),g(u,e)||g(c,e)||(c[e]=[e,t,n])}).amd={jQuery:!0}}(),n("js/almond",function(){}),Util=function(){function e(){return"undefined"!=typeof Buffer}function t(t){return e()&&t instanceof Buffer}return{getQueryString:function(e,t){null==t&&(t=""),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n,r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null==r?t:(n=r[1],decodeURIComponent(n.replace(/\+/g,"%20")))},endsWith:function(e,t){return e.substring(e.length-t.length)===t},startsWith:function(e,t){return e.substring(0,t.length)===t},Base64_To_ArrayBuffer:function(e){e=e.replace(/[\n=]/g,"");var t=new Object;t[65]=0,t[66]=1,t[67]=2,t[68]=3,t[69]=4,t[70]=5,t[71]=6,t[72]=7,t[73]=8,t[74]=9,t[75]=10,t[76]=11,t[77]=12,t[78]=13,t[79]=14,t[80]=15,t[81]=16,t[82]=17,t[83]=18,t[84]=19,t[85]=20,t[86]=21,t[87]=22,t[88]=23,t[89]=24,t[90]=25,t[97]=26,t[98]=27,t[99]=28,t[100]=29,t[101]=30,t[102]=31,t[103]=32,t[104]=33,t[105]=34,t[106]=35,t[107]=36,t[108]=37,t[109]=38,t[110]=39,t[111]=40,t[112]=41,t[113]=42,t[114]=43,t[115]=44,t[116]=45,t[117]=46,t[118]=47,t[119]=48,t[120]=49,t[121]=50,t[122]=51,t[48]=52,t[49]=53,t[50]=54,t[51]=55,t[52]=56,t[53]=57,t[54]=58,t[55]=59,t[56]=60,t[57]=61,t[43]=62,t[47]=63;var n,r=e.length,i=0,o=0;if(!r)return new ArrayBuffer(0);n=Math.floor(r/4*3),"="==e.charAt(r-1)&&(n-=1),"="==e.charAt(r-2)&&(n-=1);for(var s=new ArrayBuffer(n),a=new Uint8Array(s),u=0,c=0;c<n&&(void 0===(o=t[e.charCodeAt(u)])&&l("Invalid letter: "+e.charCodeAt(u)),i=o<<2,u++,void 0===(o=t[e.charCodeAt(u)])&&l("Invalid letter: "+e.charCodeAt(u)),a[c]=i|o>>4&3,i=(15&o)<<4,u++,!(++c>=n))&&(void 0===(o=t[e.charCodeAt(u)])&&l("Invalid letter: "+e.charCodeAt(u)),a[c]=i|o>>2&15,i=(3&o)<<6,u++,!(++c>=n));)void 0===(o=t[e.charCodeAt(u)])&&l("Invalid letter: "+e.charCodeAt(u)),a[c]=i|o,u++,c++;function l(t){throw console.log(t),console.log(e,u),new Error(t)}return s},Base64_From_ArrayBuffer:function(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(e),i=r.length,o=0,s=0,a=0;a<i&&(n+=t[(s=r[a])>>2],o=(3&s)<<4,!(++a>=i))&&(n+=t[o|(s=r[a])>>4],o=(15&s)<<2,!(++a>=i));)n+=t[o|(s=r[a])>>6],n+=t[63&s],a++;var u=i%3;return u&&(n+=t[o]),1==u?n+="==":2==u&&(n+="="),n},utf8bytes2str:function(e){for(var t=[],n=0;n<e.length;n++)t.push("%"+("0"+e[n].toString(16)).slice(-2));try{return decodeURIComponent(t.join(""))}catch(e){throw console.log(t.join("")),e}},str2utf8bytes:function(e,t){for(var n=encodeURIComponent(e),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&t===Buffer?new Buffer(i):new Uint8Array(i).buffer},privatize:function(e){if(e.__privatized)return e;var t={__privatized:!0};for(var n in e)!function(n){var r=e[n];n.match(/^_/)||"function"==typeof r&&(t[n]=function(){return r.apply(e,arguments)})}(n);return t},hasNodeBuffer:e,isNodeBuffer:t,isBuffer:function(e){return e instanceof ArrayBuffer||t(e)}}}(),n("Util",function(e){return function(){return e.Util}}(this)),function(){return function e(n,r,i){function o(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof t&&t;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[a]={exports:{}};n[a][0].call(f.exports,function(e){return o(n[a][1][e]||e)},f,f.exports,e,n,r,i)}return r[a].exports}for(var s="function"==typeof t&&t,a=0;a<i.length;a++)o(i[a]);return o}}()({1:[function(e,t,n){const r=function(e){this.failMesg=a(e||"Assertion failed: ")};var i;r.prototype={_regedType:{},registerType:function(e,t){this._regedType[e]=t},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var e=i(arguments),t=e.shift();if(e=a(e),e=this.failMesg.concat(t).concat(e).concat(["mode",this._mode]),console.log.apply(console,e),this.isDefensive())return t;if(this.isBool())return!1;throw new Error(e.join(" "))},subAssertion:function(){var e=i(arguments);return e=a(e),new r(this.failMesg.concat(e))},assert:function(e,t){return e||this.fail(e,t)},eq:function(e,t){return e!==t?this.fail(e,"!==",t):!!this.isBool()||e},ne:function(e,t){return e===t?this.fail(e,"===",t):!!this.isBool()||e},isset:function(e,t){return null==e?this.fail(e,(t||"")+" is null/undef"):!!this.isBool()||e},is:function(e,t){var n=t,r=e;if(null==n)return this.fail(e,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),!!this.isBool()||e;if(this.assert(null!=e,[e,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!e||"number"!=typeof e.length)return this.fail(e,"should be array:");for(var i=0;i<n.length;i++){let t=this.subAssertion("failed at ",e,"[",i,"]: ");null==n[i]&&console.log("WOW!7",r[i],n[i]),t.is(r[i],n[i])}return!!this.isBool()||e}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),!!this.isBool()||e;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),!!this.isBool()||e;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),!!this.isBool()||e;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),!!this.isBool()||e;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),!!this.isBool()||e;if(n&&"object"==typeof n){for(var o in n){this.subAssertion("failed at ",e,".",o,":").is(e[o],n[o])}return!!this.isBool()||e}if("string"==typeof n){var s=this._regedType[n];return s?this.is(e,s):!!this.isBool()||e}return this.fail(e,"Invaild type: ",n)},ensureError:function(e,t){try{e()}catch(n){return"string"==typeof t&&s(n+""===t,e+" thrown an error "+n+" but expected:"+t),void console.log("Error thrown successfully: ",n.message)}this.fail(e,"should throw an error",t)},setMode:function(e){this._mode=e},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},i=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t};var o=new r,s=function(){try{return o.assert.apply(o,arguments)}catch(e){throw new Error(e.message)}};function a(e){if(e instanceof Array){var t=[];return e.forEach(function(e){t=t.concat(a(e))}),t}return[e]}["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(e){s[e]=function(){try{return o[e].apply(o,arguments)}catch(e){throw console.log(e.stack),new Error(e.message)}}}),s.fail=o.fail.bind(o),s.MODE_STRICT=o.MODE_STRICT,s.MODE_DEFENSIVE=o.MODE_DEFENSIVE,s.MODE_BOOL=o.MODE_BOOL,s.f=function(e){return{_assert_func:e}},s.opt=function(e){return s.f(function(t){return null==t||t instanceof e})},s.and=function(){var e=i(arguments);return s(e instanceof Array),s.f(function(t){for(var n=0;n<e.length;n++)this.is(t,e[n])})},t.exports=s},{}],2:[function(e,t,n){t.exports="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()},{}],3:[function(e,t,n){var r=e("../lib/assert"),i=e("../lib/root"),o=e("./TonyuThread"),s=e("./tonyuIterator");t.exports=function(){i.performance||(i.performance={}),i.performance.now||(i.performance.now=function(){return Date.now()});var e,t,n={};function a(t){if(!e.onRuntimeError)throw i.alert&&i.alert("エラー! メッセージ  : "+t),console.log(t.stack),t;e.onRuntimeError(t)}function u(e,t){return r.is(arguments,[String,Object]),l(n.getMeta(e),t)}function c(e,t){return l(e?Object.create(e.prototype):{},t)}function l(e,t){if(t&&"object"==typeof t)for(var n in t)e[n]=t[n];return e}n.addMeta=u,n.removeMeta=function(e){delete h[e]},n.getMeta=function(e){if("function"==typeof e)return e.meta;if("string"==typeof e){var t=h[e];return t||(h[e]=t={}),t}},n.ensureNamespace=function(e,t){var n,r=t.split("."),i=e;for(n=0;n<r.length;n++){var o=r[n];i[o]||(i[o]={}),i=i[o]}return i},n.propReg=/^__([gs]et)ter__(.*)$/,n.define=function(t){var r=t.superclass,i=t.includes,o=t.fullName,s=t.shortName,a=t.namespace,f=t.methods,p=t.decls,h=n.ensureNamespace(e.classes,a);function d(e,t){if(!e.prototype.hasOwnProperty("getClassInfo"))throw new Error("NO");if(!e.meta)throw console.log("metanotfound",e),new Error("meta not found");return function e(t,n){if((n=n||{}).isShim)return t;if(n.path=n.path||[],n.path.push(t),t.isShim)throw console.log("chkmeta::ctx",n),new Error("Shim found "+t.extenderFullName);if(t.superclass&&e(t.superclass,n),!t.includes)throw console.log("chkmeta::ctx",n),new Error("includes not found");return t.includes.forEach(function(t){e(t,n)}),n.path.pop(),t}(e.meta,t),e}function m(e,t){var r=!t.init,h=t.includesRec;if(h[o])return e;h[o]=!0,i.forEach(function(n){e=n.extendFrom(e,l(t,{init:!1}))});var m,v="function"==typeof f?f(e):f,y=v.initialize;delete v.initialize,(m=y?function(){this instanceof m||g(o),y.apply(this,arguments)}:e?function(){this instanceof m||g(o),e.apply(this,arguments)}:function(){this instanceof m||g(o)}).prototype=c(e,{constructor:m}),m.meta=r?{isShim:!0,extenderFullName:o}:u(o,{fullName:o,shortName:s,namespace:a,decls:p,superclass:t.nonShimParent?t.nonShimParent.meta:null,includesRec:h,includes:i.map(function(e){return e.meta})}),m.meta.func=m,m.methods=v;var b,w=m.prototype,x={},S=n.propReg;for(b in v)if(!b.match(/^fiber\$/)){w[b]=v[b];var _="fiber$"+b;if(v[_]&&(w[_]=v[_],w[_].methodInfo=w[_].methodInfo||{name:b,klass:m,fiber:!0},w[b].fiber=w[_]),"__dummy"!==b&&!w[b])throw console.log("WHY!",w[b],w,b),new Error("WHY!"+b);w[b].methodInfo=w[b].methodInfo||{name:b,klass:m};var E=S.exec(b);E&&(x[E[2]]=x[E[2]]||{},x[E[2]][E[1]]=w[b])}for(b in w.isTonyuObject=!0,x)Object.defineProperty(w,b,x[b]);return w.getClassInfo=function(){return m.meta},d(m,{isShim:r})}var v=m(r,{init:!0,initFullName:o,includesRec:r?l({},r.meta.includesRec):{},nonShimParent:r});return v.extendFrom=m,h[s]=v,v,d(v,{isShim:!1})},n.isSourceChanged=function(e){return!(!(e=e.meta||e).src||!e.src.tonyu)&&(!e.nodeTimestamp||e.src.tonyu.lastUpdate()>e.nodeTimestamp)},n.shouldCompile=function(e){if((e=e.meta||e).hasSemanticError)return!0;if(n.isSourceChanged(e))return!0;for(var t=n.getDependingClasses(e),r=0;r<t.length;r++)if(n.shouldCompile(t[r]))return!0},n.getDependingClasses=function(e){var t=[];return(e=e.meta||e).superclass&&(t=[e.superclass]),e.includes&&(t=t.concat(e.includes)),t};var f={},p={},h={};function d(e){var t,n=e.split("."),r=p;if(n.forEach(function(e){r&&(r=r[e])}),!r&&1==n.length)for(var i in p){var o=p[i][e];if(o){if(r)throw new Error("曖昧なクラス名： "+i+"."+e+", "+t);r=o,t=i+"."+e}}return r}function g(e){throw new Error("クラス名"+e+"はnewをつけて呼び出して下さい。")}var m=i.performance.now();function v(e){m=i.performance.now()+(e||0)}if(e={thread:function(){var e=new t;return e.handleEx=a,e},klass:n,bless:c,extend:l,globals:f,classes:p,classMetas:h,setGlobal:function(e,t){f[e]=t},getGlobal:function(e){return f[e]},getClass:d,timeout:function(e){return new Promise(function(t){setTimeout(t,e)})},bindFunc:function(t,n){if("function"!=typeof n)return n;var r=function(){return n.apply(t,arguments)};return r.methodInfo=e.extend({thiz:t},n.methodInfo||{}),n.fiber&&((r.fiber=function(){return n.fiber.apply(t,arguments)}).methodInfo=e.extend({thiz:t},n.fiber.methodInfo||{})),r},not_a_tonyu_object:function(e){throw console.log("Not a tonyu object: ",e),new Error(e+" is not a tonyu object")},is:function(e,t){return!!e&&(e instanceof t||!("function"!=typeof e.getClassInfo||!t.meta)&&e.getClassInfo().includesRec[t.meta.fullName])},hasKey:function(e,t){return e in t},invokeMethod:function(e,t,n,r){if(!e)throw new Error(r+"(="+e+")のメソッド "+t+"を呼び出せません");var i=e[t];if("function"!=typeof i)throw new Error(("this"==r?"":r+".")+t+"(="+i+")はメソッドではありません");return i.apply(e,n)},callFunc:function(e,t,n){if("function"!=typeof e)throw new Error(n+"は関数ではありません");return e.apply({},t)},checkNonNull:function(e,t){if(e!=e||null==e)throw new Error(t+"(="+e+")は初期化されていません");return e},iterator:s,run:function(t){var n=d(t);if(!n)throw new Error(t+" というクラスはありません");e.runMode=!0;var r=new n,i=e.currentProject;i&&(i.runningObj=r)},checkLoop:function(){var e=i.performance.now();if(e-m>1e3)throw v(1e4),new Error("無限ループをストップしました。\n   プロジェクト オプションで無限ループチェックの有無を設定できます。\n   [参考]https://edit.tonyu.jp/doc/options.html\n");e},resetLoopCheck:v,VERSION:1560828115159,A:function(e){for(var t=[],n=1;n<e.length;n++)t[n-1]=e[n];return t},ID:Math.random()},t=o(e),i.Tonyu)throw console.error("Tonyu called twice!"),new Error("Tonyu called twice!");return i.Tonyu=e,e}()},{"../lib/assert":1,"../lib/root":2,"./TonyuThread":4,"./tonyuIterator":5}],4:[function(e,t,n){t.exports=function(e){var t=1;class n{constructor(){this.frame=null,this._isDead=!1,this.cnt=0,this._isWaiting=!1,this.fSuspended=!1,this.tryStack=[],this.preemptionTime=60,this.onEndHandlers=[],this.onTerminateHandlers=[],this.id=t++,this.age=0}isAlive(){return!this.isDead()}isDead(){return this._isDead=this._isDead||null==this.frame||this._threadGroup&&(this._threadGroup.objectPoolAge!=this.tGrpObjectPoolAge||this._threadGroup.isDeadThreadGroup()),this._isDead}setThreadGroup(e){this._threadGroup=e,this.tGrpObjectPoolAge=e.objectPoolAge}isWaiting(){return this._isWaiting}suspend(){this.fSuspended=!0,this.cnt=0}enter(e){this.frame={prev:this.frame,func:e}}apply(e,t,n){var r;if(n||(n=[]),"string"==typeof t&&!(r=e["fiber$"+t]))throw new Error("メソッド"+t+"が見つかりません");if("function"==typeof t&&!(r=t.fiber)){var i=t.methodInfo?t.methodInfo.name:t.name;throw new Error("メソッド"+i+"は待機可能メソッドではありません")}n=[this].concat(n);var o=0;return this.enter(function(t){switch(o){case 0:r.apply(e,n),o=1;break;case 1:t.termStatus="success",t.notifyEnd(t.retVal),n[0].exit(),o=2}})}notifyEnd(e){this.onEndHandlers.forEach(function(t){t(e)}),this.notifyTermination({status:"success",value:e})}notifyTermination(e){this.onTerminateHandlers.forEach(function(t){t(e)})}on(e,t){"end"!==e&&"success"!==e||this.onEndHandlers.push(t),"terminate"===e&&(this.onTerminateHandlers.push(t),this.handleEx&&delete this.handleEx)}promise(){var e=this;return new Promise(function(t,n){e.on("terminate",function(e){"success"===e.status?t(e.value):"exception"===e.status?n(e.exception):n(new Error(e.status))})})}then(e,t){return t?this.promise().then(e,t):this.promise().then(e)}fail(e){return this.promise().then(e=>e,e)}gotoCatch(e){var t=this;if(0==t.tryStack.length)return t.termStatus="exception",t.kill(),void(t.handleEx?t.handleEx(e):t.notifyTermination({status:"exception",exception:e}));t.lastEx=e;for(var n=t.tryStack.pop();t.frame;){if(n.frame===t.frame){t.catchPC=n.catchPC;break}t.frame=t.frame.prev}}startCatch(){var e=this.lastEx;return this.lastEx=null,e}exit(e){this.frame=this.frame?this.frame.prev:null,this.retVal=e}enterTry(e){this.tryStack.push({frame:this.frame,catchPC:e})}exitTry(){this.tryStack.pop()}waitEvent(e,t){var n,r=this;(r.suspend(),e.on)&&(t=t.concat(function(){r.lastEvent=arguments,r.retVal=arguments[0],n.remove(),r.steps()}),n=e.on.apply(e,t))}runAsync(e){var t=this,n=function(){t.retVal=arguments,t.steps()},r=function(){for(var e="",n=0;n<arguments.length;n++)e+=arguments[n]+",";0==e.length&&(e="Async fail");var r=new Error(e);r.args=arguments,t.gotoCatch(r),t.steps()};t.suspend(),setTimeout(function(){e(n,r)},0)}waitFor(e){var t=this;return t._isWaiting=!0,t.suspend(),e instanceof n&&(e=e.promise()),Promise.resolve(e).then(function(e){t.retVal=e,t.stepsLoop()}).then(e=>e,function(e){t.gotoCatch(t.wrapError(e)),t.stepsLoop()})}wrapError(e){if(e instanceof Error)return e;var t=new Error(e);return t.original=e,t}resume(e){this.retVal=e,this.steps()}steps(){var t=this;if(!t.isDead()){var n=e.currentThread;for(e.currentThread=t,t.cnt=t.preemptionTime,t.preempted=!1,t.fSuspended=!1;t.cnt>0&&t.frame;)try{for(;t.cnt-- >0&&t.frame;)t.frame.func(t);t.preempted=!t.fSuspended&&t.isAlive()}catch(e){t.gotoCatch(e)}e.currentThread=n}}stepsLoop(){var e=this;e.steps(),e.preempted&&setTimeout(function(){e.stepsLoop()},0)}kill(){var e=this;e._isDead=!0,e.frame=null,e.termStatus||(e.termStatus="killed",e.notifyTermination({status:"killed"}))}clearFrame(){this.frame=null,this.tryStack=[]}}return n}},{}],5:[function(e,t,n){class r{constructor(e){this.set=e,this.i=0}next(){return!(this.i>=this.set.length)&&(this[0]=this.set[this.i],this.i++,!0)}}class i{constructor(e){this.set=e,this.i=0}next(){return!(this.i>=this.set.length)&&(this[0]=this.i,this[1]=this.set[this.i],this.i++,!0)}}class o{constructor(e){for(var t in this.elems=[],e)this.elems.push(t);this.i=0}next(){return!(this.i>=this.elems.length)&&(this[0]=this.elems[this.i],this.i++,!0)}}class s{constructor(e){for(var t in this.elems=[],e)this.elems.push([t,e[t]]);this.i=0}next(){return!(this.i>=this.elems.length)&&(this[0]=this.elems[this.i][0],this[1]=this.elems[this.i][1],this.i++,!0)}}t.exports=function(e,t){if(e.tonyuIterator)return e.tonyuIterator(t);if(e instanceof Array)return 1==t?new r(e):new i(e);if(e instanceof Object)return 1==t?new o(e):new s(e);throw console.log(e),new Error(e+" is not iterable")}},{}]},{},[3]),n("Tonyu",function(e){return function(){return e.Tonyu}}(this)),n("FS",[],function(){var e,t,n,r={},i=0;return r.def=function(e,t,n){var i=r.getModuleInfo(e);"function"==typeof t?(n=t,t=r.reqsFromFunc(n),r.setReqs(i,t),i.func=function(){var e={exports:{}};return n(r.doLoad,e,e.exports)||e.exports}):(r.setReqs(i,t),i.func=function(){return n.apply(this,r.getObjs(t))}),r.loadIfAvailable(i)},(e=function(e,t,n){r.def(e,t,n)}).amd={},t=function(e,t){r.def("REQJS_"+i++,e,t)},r.setReqs=function(e,t){t.forEach(function(t){var n=r.getModuleInfo(t);n.loaded||(e.reqs[t]=n,n.revReqs[e.name]=e)})},r.getModuleInfo=function(e){var t=r.modules;return t[e]=t[e]||{name:e,reqs:{},revReqs:{}}},r.doLoad=function(e){var t=r.getModuleInfo(e);if(t.loaded)return t.obj;t.loaded=!0;var n=t.func();for(var i in null!=n||e.match(/^REQJS_/)||console.log("Warning: No obj for "+e),t.obj=n,t.revReqs)r.notifyLoaded(t.revReqs[i],t.name);return n},r.notifyLoaded=function(e,t){delete e.reqs[t],r.loadIfAvailable(e)},r.loadIfAvailable=function(e){for(var t in e.reqs)return;r.doLoad(e.name)},r.getObjs=function(e){var t=[];return e.forEach(function(e){var n=r.doLoad(e);t.push(n)}),t},r.reqsFromFunc=function(e){var t=[];return(e+"").replace(/require\s*\(\s*["']([^"']+)["']\s*\)/g,function(e,n){t.push(n)}),t},r.modules={},e("extend",[],function(){return function(e,t){for(var n in t)e[n]=t[n];return e}}),e("assert",[],function(){var e,t=function(e){this.failMesg=i(e||"Assertion failed: ")};t.prototype={_regedType:{},registerType:function(e,t){this._regedType[e]=t},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var t=e(arguments),n=t.shift();if(t=i(t),t=this.failMesg.concat(n).concat(t),console.log.apply(console,t),this.isDefensive())return n;if(this.isBool())return!1;throw new Error(t.join(" "))},subAssertion:function(){var n=e(arguments);return n=i(n),new t(this.failMesg.concat(n))},assert:function(e,t){return e||this.fail(e,t)},eq:function(e,t){return e!==t?this.fail(e,"!==",t):!!this.isBool()||e},ne:function(e,t){return e===t?this.fail(e,"===",t):!!this.isBool()||e},isset:function(e,t){return null==e?this.fail(e,(t||"")+" is null/undef"):!!this.isBool()||e},is:function(e,t){var n=t,r=e;if(null==n)return this.fail(e,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),!!this.isBool()||e;if(this.assert(null!=e,[e,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!e||"number"!=typeof e.length)return this.fail(e,"should be array:");for(var i=0;i<n.length;i++){var o=this.subAssertion("failed at ",e,"[",i,"]: ");null==n[i]&&console.log("WOW!7",r[i],n[i]),o.is(r[i],n[i])}return!!this.isBool()||e}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),!!this.isBool()||e;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),!!this.isBool()||e;if(n===Boolean||"boolean"==n)return this.assert("boolean"==typeof r,[r,"should be a boolean"]),!!this.isBool()||e;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),!!this.isBool()||e;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),!!this.isBool()||e;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),!!this.isBool()||e;if(n&&"object"==typeof n){for(var s in n){(o=this.subAssertion("failed at ",e,".",s,":")).is(e[s],n[s])}return!!this.isBool()||e}if("string"==typeof n){var a=this._regedType[n];return a?this.is(e,a):!!this.isBool()||e}return this.fail(e,"Invaild type: ",n)},ensureError:function(e,t){try{e()}catch(n){return"string"==typeof t&&r(n+""===t,e+" thrown an error "+n+" but expected:"+t),void console.log("Error thrown successfully: ",n.message)}this.fail(e,"should throw an error",t)},setMode:function(e){this._mode=e},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},e=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t};var n=new t,r=function(){try{return n.assert.apply(n,arguments)}catch(e){throw new Error(e.stack)}};function i(e){if(e instanceof Array){var t=[];return e.forEach(function(e){t=t.concat(i(e))}),t}return[e]}return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(e){r[e]=function(){try{return n[e].apply(n,arguments)}catch(e){throw console.log(e.stack),new Error(e.message)}}}),r.fail=n.fail.bind(n),r.MODE_STRICT=n.MODE_STRICT,r.MODE_DEFENSIVE=n.MODE_DEFENSIVE,r.MODE_BOOL=n.MODE_BOOL,r.f=function(e){return{_assert_func:e}},r.opt=function(e){return r.f(function(t){return null==t||t instanceof e})},r.and=function(){var t=e(arguments);return r(t instanceof Array),r.f(function(e){for(var n=0;n<t.length;n++)this.is(e,t[n])})},r}),e("PathUtil",["assert"],function(e){function t(t,n){return e.is(arguments,[String,String]),t.substring(t.length-n.length)===n}var n,r=/^([a-zA-Z]):/,i=/^([a-z\-]+):\/\/\/?([^\/]+)\//,o=e.f(function(e){this.is(e,String),this.assert(n.isPath(e),[e," is not a path"])}),s=e.f(function(e){this.is(e,String),this.assert(n.isAbsolutePath(e),[e," is not a absolute path"])}),a=e.f(function(e){this.is(e,String),this.assert(!n.isAbsolutePath(e),[e," is not a relative path"])}),u=e.f(function(e){this.is(e,o),this.assert(n.isDir(e),[e," is not a directory path"])}),c=e.and(u,s),l=e.f(function(e){this.is(e,o),this.assert(!n.isDir(e),[e," is not a file path"])});return n={Path:o,Absolute:s,Relative:a,Dir:u,File:l,AbsDir:c,SEP:"/",endsWith:t,startsWith:function(t,n){return e.is(arguments,[String,String]),t.substring(0,n.length)===n},isChildOf:function(e,t){return this.startsWith(this.normalize(e),this.normalize(t))},normalize:function(e){return this.fixSep(e,"/").replace(/\/+$/,"/")},hasDriveLetter:function(e){return r.exec(e)},isURL:function(e){var t=i.exec(e);if(t)return{protocol:t[1],hostPort:t[2],path:"/"+e.substring(t[0].length)}},isPath:function(t){return e.is(arguments,[String]),!0},isRelativePath:function(t){return e.is(arguments,[String]),n.isPath(t)&&!n.isAbsolutePath(t)},isAbsolutePath:function(t){return e.is(arguments,[String]),n.isPath(t)&&(n.startsWith(t,"/")||n.hasDriveLetter(t)||n.isURL(t))},isDir:function(r){return r=n.fixSep(r),e.is(arguments,[o]),t(r,"/")},hasBackslashSep:function(e){return e.indexOf("\\")>=0},fixSep:function(t,n){return n=n||"/",e.is(arguments,[String]),e.is(t.replace(/[\\\/]/g,n),o)},directorify:function(t){return n.isDir(t)?t:e.is(t+"/",u)},filify:function(t){return n.isDir(t)?e.is(t.substring(0,t.length-1),l):t},splitPath:function(t){var n;if(e.is(arguments,[o]),n=this.isURL(t)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}var i=(t=t.replace(/\/+/g,"/")).split("/");return""==i[i.length-1]&&(i[i.length-2]+="/",i.pop()),i},name:function(t){return e.is(arguments,[String]),n.splitPath(t).pop()},ext:function(t){e.is(arguments,[String]);var r=n.name(t),i=/\.[a-zA-Z0-9]+$/.exec(r);return i?i[0]:null},truncExt:function(t,r){e.is(t,String);var i=n.name(t);return r=r||n.ext(t),e.is(r,String),i.substring(0,i.length-r.length)},truncSEP:function(t){return e.is(arguments,[o]),n.isDir(t)?t.substring(0,t.length-1):t},endsWith:function(r,i){return e.is(arguments,[String,String]),t(n.name(r),i)},parent:function(t){return e.is(arguments,[String]),n.up(t)},rel:function(t,r){if(""==r)return t;e.is(arguments,[c,a]);var i=n.splitPath(r),o=t;o=o.replace(/\/$/,"");var s=n;return i.forEach(function(e){".."==e||"../"==e?o=s.up(o):(o=o.replace(/\/$/,""),o+="/"+("."==e||"./"==e?"":e))}),o},relPath:function(t,r){return e.is(arguments,[s,s]),t.substring(0,r.length)!=r?"../"+n.relPath(t,this.up(r)):t.substring(r.length)},up:function(e){if("/"==e)return null;var t=n.splitPath(e);return t.pop(),t.join("/")+"/"}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(e){var t=n[e];n[e]=function(){var e=!1,r=Array.prototype.slice.call(arguments).map(function(t){return n.hasBackslashSep(t)?(e=!0,n.fixSep(t)):t}),i=t.apply(n,r);return e?n.fixSep(i,"\\"):i}}),n.isAbsolute=n.isAbsolutePath,n.isRelative=n.isRelativePath,"object"==typeof window&&(window.PathUtil=n),n}),e("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".wav":"audio/x-wav",".mp3":"audio/mp3",".ogg":"audio/ogg",".midi":"audio/midi",".mid":"audio/midi",".mzo":"audio/mzo",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu",".c":"text/c",".dtl":"text/dolittle"}}),e("DeferredUtil",[],function(){var e,t="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:null,n=function(e){this.res=e};function r(e){return e}return(e={isNativePromise:function(e){return e&&"function"==typeof e.then&&"function"!=typeof e.promise&&"function"==typeof e.catch},isJQPromise:function(e){return e&&"function"==typeof e.then&&"function"==typeof e.promise&&"function"==typeof e.fail},isPromise:function(e){return e&&"function"==typeof e.then&&("function"==typeof e.promise||"function"==typeof e.catch)},all:function(t){return e.promise(function(n,r){var i=[],o=t.length;t.forEach(function(t,s){e.resolve(t).then(function(e){i[s]=e,0===--o&&n(i)},r)})})},resolve:function(t){return e.config.useJQ&&e.isJQPromise(t)?t:!e.config.useJQ&&e.isNativePromise(t)?t:e.promise(function(n,r){e.isPromise(t)?t.then(n,r):n(t)})},throwNowIfRejected:function(t){var n,r,i=t.then(function(e){return n||(n="resolved"),e},function(t){if(n)return e.reject(t);n="rejected",r=t});if(n||(n="notyet"),"rejected"===n)throw r;return i},assertResolved:function(e){var t,n;if(e.then(function(e){t=e,n=!0}),!n)throw new Error("Promise not resolved");return t},ensureDefer:function(t){return e.promise(function(n,i){var o;e.resolve(t).then(function(e){o?n(e):setTimeout(function(){n(e)},0)}).then(r,function(e){o?i(e):setTimeout(function(){i(e)},0)}),o=!0})},directPromise:function(t){return e.timeout(t,0)},then:function(t){return e.directPromise().then(t)},timeout:function(t,n){return e.promise(function(e){setTimeout(function(){e(n)},t||0)})},funcPromise:function(t){if(e.config.useJQ){var n=new $.Deferred;try{t(function(e){n.resolve(e)},function(e){n.reject(e)})}catch(e){n.reject(e)}return n.promise()}if(e.external.Promise)return new e.external.Promise(function(e,n){try{t(e,n)}catch(e){n(e)}});throw new Error("promise is not found")},reject:function(t){if(e.config.useJQ){var n=new $.Deferred;return n.reject(t),n.promise()}return new e.external.Promise(function(e,n){n(t)})},throwPromise:function(t){if(e.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(t)},0),n.promise()}return new e.external.Promise(function(e,n){n(t)})},throwF:function(t){return function(){try{return t.apply(this,arguments)}catch(t){return console.log(t,t.stack),e.throwPromise(t)}}},each:function(t,n){if(t instanceof Array)return e.loop(function(r){return r>=t.length?e.brk():e.resolve(n(t[r],r)).then(function(){return r+1})},0);var r=[];for(var i in t)r.push({k:i,v:t[i]});return e.each(r,function(e){return n(e.k,e.v)})},loop:function(t,i){try{for(var o;;){if(i instanceof n)return e.when1(i.res);var s=!0,a=!1,u=t(i),c=e.resolve(u).then(function(r){return s=!1,(i=r)instanceof n?i.res:a?e.loop(t,i):void 0}).then(r,function(e){s=!1,o=e});if(o)throw o;if(a=!0,s)return c}}catch(t){return e.reject(t)}},brk:function(e){return new n(e)},tryLoop:function(t,n){return e.loop(e.tr(t),n)},tryEach:function(t,n){return e.loop(t,e.tr(n))},documentReady:function(){return e.callbackToPromise(function(e){$(e)})},requirejs:function(n){if(!t.requirejs)throw new Error("requirejs is not loaded");return e.callbackToPromise(function(e){t.requirejs(n,e)})}}).NOP=function(e){return e},e.E=function(){console.log("DUE",arguments),e.errorHandler.apply(e,arguments)},e.errorHandler=function(e){console.error.apply(console,arguments),alert(e)},e.setE=function(t){e.errorHandler=t},e.begin=e.try=e.tr=e.throwF,e.promise=e.callbackToPromise=e.funcPromise,e.when1=e.resolve,e.config={},t.$&&t.$.Deferred&&(e.config.useJQ=!0),e.external={Promise:t.Promise},t.DeferredUtil||(t.DeferredUtil=e),e}),e("FSClass",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(e,t,n,r,i){var o=function(){},s={};function a(e){throw new Error(e+" is STUB!")}return o.addFSType=function(e,t){s[e]=t},o.availFSTypes=function(){return s},e(o.prototype,{err:function(e,t){throw new Error(e+": "+t)},fstype:function(){return"Unknown"},isReadOnly:function(e,t){a("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(e,t){return r(this.getRootFS()!==this),this.getRootFS().resolveFS(e)},mounted:function(e,t){this.rootFS=e,this.mountPoint=t},inMyFS:function(e){return!this.mountPoint||t.startsWith(e,this.mountPoint)},getRootFS:function(){return r(this.rootFS,"rootFS is not set")},getReturnTypes:function(e,t){a("")},getContent:function(e,t){a("getContent")},size:function(e){return this.getContent(e,{type:ArrayBuffer}).toBin().byteLength},getContentAsync:function(e,t){return this.supportsSync()||a("getContentAsync"),i.resolve(this.getContent.apply(this,arguments))},setContent:function(e,t,n){a("")},setContentAsync:function(e,t,n){var r=this;return r.supportsSync()||a("setContentAsync"),i.resolve(t).then(function(t){return i.resolve(r.setContent(e,t,n))})},appendContent:function(e,t,n){a("")},appendContentAsync:function(e,t,n){var r=this;return r.supportsSync()||a("appendContentAsync"),i.resolve(t).then(function(t){return i.resolve(r.appendContent(e,t,n))})},getMetaInfo:function(e,t){a("")},setMetaInfo:function(e,t,n){a("")},mkdir:function(e,t){a("mkdir")},touch:function(e){a("touch")},exists:function(e,t){a("exists")},opendir:function(e,t){a("opendir")},opendirAsync:function(e,t){return this.supportsSync()||a("opendirAsync"),i.resolve(this.opendir.apply(this,arguments))},cp:function(e,n,i){r.is(arguments,[t.Absolute,t.Absolute]),this.assertExist(e),i=i||{};var o=this.isDir(e),s=this.getRootFS().resolveFS(n),a=s.isDir(n);if(o||a)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(e),c=s.setContent(n,u);return i.a&&s.setMetaInfo(n,this.getMetaInfo(e)),c}return s.setContentAsync(n,this.getContentAsync(e)).then(function(t){return i.a?s.setMetaInfo(n,this.getMetaInfo(e)):t})},mv:function(e,t,n){return this.cp(e,t,n),this.rm(e,{r:!0})},rm:function(e,t){a("")},link:function(e,t,n){throw new Error("ln "+t+" "+e+" : This FS not support link.")},getURL:function(e){a("")},onAddObserver:function(e){}}),o.delegateMethods=function(e,n){for(var i in n)!function(i){r.ne(i,"inMyFS"),e[i]=function(){var e=arguments[0];r.is(e,t.Absolute);var o=this.resolveFS(e);return o!==this?(console.log("Invoked for other fs",this.mountPoint,o.mountPoint),o[i].apply(o,arguments)):n[i].apply(this,arguments)}}(i)},o.delegateMethods(o.prototype,{assertWriteable:function(e){this.isReadOnly(e)&&this.err(e,"read only.")},getContentType:function(e,r){var i=(t.ext(e)+"").toLowerCase();return n[i]||(r||{}).def||"application/octet-stream"},getBlob:function(e,t){var n=this.getContent(e);return(t=t||{}).blobType=t.blobType||Blob,t.binType=t.binType||ArrayBuffer,n.hasPlainText()?new t.blobType([n.toPlainText()],this.getContentType(e)):new t.blobType([n.toBin(t.binType)],this.getContentType(e))},isText:function(e){var n=this.getContentType(e);return t.startsWith(n,"text")},assertExist:function(e,n){this.exists(e,n)||this.err(e,": No such "+(t.isDir(e)?"directory":"file"))},isDir:function(e,n){return t.isDir(e)},find:function(e,n){r.is(arguments,[t.Absolute]);var i=this.opendir(e,n),o=this,s=[e];return i.forEach(function(r){var i=t.rel(e,r);if(t.isDir(i)){var a=o.resolveFS(i);s=s.concat(a.find(i,n))}else s.push(i)}),s},resolveLink:function(e){r.is(e,t.Absolute);for(var n=e;n;n=t.up(n)){r(!this.mountPoint||t.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+e);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var o=t.rel(i,t.relPath(e,n));return r(o!=e,"np==path=="+o),r.is(this.getRootFS().resolveFS(o).resolveLink(o),t.Absolute)}if(this.exists(n))return e}return e},isLink:function(e){return null},opendirEx:function(e,n){r.is(e,t.AbsDir);var i=this,o={};return this.opendir(e).forEach(function(n){var r=t.rel(e,n);o[n]=i.getMetaInfo(r)}),o},getDirTree:function(e,n){var i=(n=n||{}).dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],r.is(n.excludes,Array),n.base||(n.base=e),r.is(e,t.AbsDir);var o=this.opendirEx(e,n);if("no-recursive"==n.style)return o;var s=this;for(var a in o){var u=o[a],c=t.rel(e,a),l=t.relPath(c,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(l)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(c)>=0)continue}if(s.isDir(c))switch(n.style){case"flat-absolute":case"flat-relative":s.getDirTree(c,n);break;case"hierarchical":n.dest={},i[a]=s.getDirTree(c,n)}else switch(n.style){case"flat-absolute":i[c]=u;break;case"flat-relative":i[l]=u;break;case"hierarchical":i[a]=u}}return i}}),o}),e("Util",[],function(){return{getQueryString:function(e,t){null==t&&(t=""),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n,r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null==r?t:(n=r[1],decodeURIComponent(n.replace(/\+/g,"%20")))},endsWith:function(e,t){return e.substring(e.length-t.length)===t},startsWith:function(e,t){return e.substring(0,t.length)===t},privatize:function(e){if(e.__privatized)return e;var t={__privatized:!0};for(var n in e)!function(n){var r=e[n];n.match(/^_/)||"function"==typeof r&&(t[n]=function(){return r.apply(e,arguments)})}(n);return t},extend:function(e,t){for(var n in t||{})e[n]=t[n];return e}}}),e("FileSaver",[],function(){var e="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:this;function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){i(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),t.status>=200&&t.status<=299}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var i=e.saveAs||"object"!=typeof window||window!==e?function(){}:"download"in HTMLAnchorElement.prototype?function(i,o,s){var a=e.URL||e.webkitURL,u=document.createElement("a");o=o||i.name||"download",u.download=o,u.rel="noopener","string"==typeof i?(u.href=i,u.origin!==location.origin?n(u.href)?t(i,o,s):r(u,u.target="_blank"):r(u)):(u.href=a.createObjectURL(i),setTimeout(function(){a.revokeObjectURL(u.href)},4e4),setTimeout(function(){r(u)},0))}:"msSaveOrOpenBlob"in navigator?function(e,i,o){if(i=i||e.name||"download","string"==typeof e)if(n(e))t(e,i,o);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout(function(){r(s)})}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Depricated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,o),i)}:function(n,r,i,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof n)return t(n,r,i);var s="application/octet-stream"===n.type,a=/constructor/i.test(e.HTMLElement)||e.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||s&&a)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},c.readAsDataURL(n)}else{var l=e.URL||e.webkitURL,f=l.createObjectURL(n);o?o.location=f:location.href=f,o=null,setTimeout(function(){l.revokeObjectURL(f)},4e4)}};return e.saveAs=i.saveAs=i,"undefined"!=typeof module&&(module.exports=i),i}),e("Content",["assert","Util","FileSaver"],function(e,t,n){var r=function(){},i=t.extend;r.plainText=function(e,t){var n=new r;return n.contentType=t||"text/plain",n.plain=e,n},r.url=function(e){var t=new r;return t.url=e,t},r.buffer2ArrayBuffer=function(t){if(r.isBuffer(t)){var n=new Uint8Array(t),i=n.buffer;if(i instanceof ArrayBuffer)return i;var o=Array.prototype.slice.call(n);return e(new Uint8Array(o).buffer,"n2a: buf is not set")}return e(t,"n2a: a is not set")},r.arrayBuffer2Buffer=function(t){return t instanceof ArrayBuffer?new Buffer(new Uint8Array(t)):e(t,"a2n: a is not set")},r.bin=function(t,n){e(n,"contentType should be set");var i=new r;if(r.isNodeBuffer(t))i.bufType="node",i.nodeBuffer=t;else if(t instanceof ArrayBuffer)i.bufType="array2",i.arrayBuffer=t;else{if(!t||!r.isBuffer(t.buffer))throw new Error(t+" is not a bin");i.bufType="array1",i.arrayBuffer=t.buffer}return i.contentType=n,i},r.looksLikeDataURL=function(e){return e.match(/^data:/)},r.download=n;var o=r.prototype;o.toBin=function(e){if(e=e||(r.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return e===Buffer?this.nodeBuffer:this.arrayBuffer=r.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return e===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=r.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var t=new a(this.url,e);return this.setBuffer(t.buffer)}if(null!=this.plain)return this.setBuffer(r.str2utf8bytes(this.plain,e));throw new Error("No data")},o.setBuffer=function(t){return e(t,"b is not set"),r.isNodeBuffer(t)?this.nodeBuffer=t:this.arrayBuffer=t},o.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},o.toNodeBuffer=function(){return this.toBin(Buffer)},o.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=r.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var e=new a(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=e.url}throw new Error("No data")},o.toPlainText=function(){if(this.hasPlainText())return this.plain;if(this.url&&!this.hasBin()){var e=new a(this.url,ArrayBuffer);this.arrayBuffer=e.buffer}if(this.hasBin())return this.plain=r.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},o.hasURL=function(){return this.url},o.hasPlainText=function(){return null!=this.plain},o.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},o.hasNodeBuffer=function(){return this.nodeBuffer},o.hasArrayBuffer=function(){return this.arrayBuffer},o.toBlob=function(){return new Blob([this.toBin(ArrayBuffer)],{type:this.contentType})},o.download=function(e){r.download(this.toBlob(),e)},r.Base64_To_ArrayBuffer=function(e,t){var n=t||ArrayBuffer;e=e.replace(/[\n=]/g,"");var i=new Object;i[65]=0,i[66]=1,i[67]=2,i[68]=3,i[69]=4,i[70]=5,i[71]=6,i[72]=7,i[73]=8,i[74]=9,i[75]=10,i[76]=11,i[77]=12,i[78]=13,i[79]=14,i[80]=15,i[81]=16,i[82]=17,i[83]=18,i[84]=19,i[85]=20,i[86]=21,i[87]=22,i[88]=23,i[89]=24,i[90]=25,i[97]=26,i[98]=27,i[99]=28,i[100]=29,i[101]=30,i[102]=31,i[103]=32,i[104]=33,i[105]=34,i[106]=35,i[107]=36,i[108]=37,i[109]=38,i[110]=39,i[111]=40,i[112]=41,i[113]=42,i[114]=43,i[115]=44,i[116]=45,i[117]=46,i[118]=47,i[119]=48,i[120]=49,i[121]=50,i[122]=51,i[48]=52,i[49]=53,i[50]=54,i[51]=55,i[52]=56,i[53]=57,i[54]=58,i[55]=59,i[56]=60,i[57]=61,i[43]=62,i[47]=63;var o,s=e.length,a=0,u=0;if(!s)return new n(0);o=Math.floor(s/4*3),"="==e.charAt(s-1)&&(o-=1),"="==e.charAt(s-2)&&(o-=1);for(var c=new n(o),l=r.isNodeBuffer(c)?c:new Uint8Array(c),f=0,p=0;p<o&&(void 0===(u=i[e.charCodeAt(f)])&&h("Invalid letter: "+e.charCodeAt(f)),a=u<<2,f++,void 0===(u=i[e.charCodeAt(f)])&&h("Invalid letter: "+e.charCodeAt(f)),l[p]=a|u>>4&3,a=(15&u)<<4,f++,!(++p>=o))&&(void 0===(u=i[e.charCodeAt(f)])&&h("Invalid letter: "+e.charCodeAt(f)),l[p]=a|u>>2&15,a=(3&u)<<6,f++,!(++p>=o));)void 0===(u=i[e.charCodeAt(f)])&&h("Invalid letter: "+e.charCodeAt(f)),l[p]=a|u,f++,p++;function h(t){throw console.log(t),console.log(e,f),new Error(t)}return c},r.Base64_From_ArrayBuffer=function(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(e),i=r.length,o=0,s=0,a=0;a<i&&(n+=t[(s=r[a])>>2],o=(3&s)<<4,!(++a>=i))&&(n+=t[o|(s=r[a])>>4],o=(15&s)<<2,!(++a>=i));)n+=t[o|(s=r[a])>>6],n+=t[63&s],a++;var u=i%3;return u&&(n+=t[o]),1==u?n+="==":2==u&&(n+="="),n},r.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},r.isNodeBuffer=function(e){return r.hasNodeBuffer()&&e instanceof Buffer},r.isBuffer=function(e){return e instanceof ArrayBuffer||r.isNodeBuffer(e)},r.utf8bytes2str=function(e){for(var t=[],n=0;n<e.length;n++)t.push("%"+("0"+e[n].toString(16)).slice(-2));return decodeURIComponent(t.join(""))},r.str2utf8bytes=function(e,t){for(var n=encodeURIComponent(e),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&t===Buffer?new Buffer(i):new Uint8Array(i).buffer};var s=r.hasNodeBuffer()?Buffer:ArrayBuffer,a=function(t,n){"string"==typeof t?(this.url=t,this.binType=n||s,this.dataURL2bin(t)):t&&r.isBuffer(t.buffer)?(this.buffer=t.buffer,e.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):r.isBuffer(t)?(this.buffer=t,e.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),e.fail("Invalid args: ",arguments))};return r.DataURL=a,i(a.prototype,{bin2dataURL:function(t,n){e(r.isBuffer(t)),e.is(n,String);var i=this.dataHeader(n),o=r.Base64_From_ArrayBuffer(t);return e.is(o,String),this.url=i+o},dataURL2bin:function(t){e.is(arguments,[String]);var n=/^data:([^;]+);base64,/i.exec(t);return e(n,["malformed dataURL:",t]),this.contentType=n[1],this.buffer=r.Base64_To_ArrayBuffer(t.substring(n[0].length),this.binType),e.is(this.buffer,this.binType)},dataHeader:function(t){return e.is(arguments,[String]),"data:"+t+";base64,"},toString:function(){return e.is(this.url,String)}}),r}),e("NativeFS",["FSClass","assert","PathUtil","extend","Content"],function(e,t,n,r,i){var o,s=t;try{(o=global.require("fs")).existsSync("test.txt")}catch(e){return function(){throw new Error("This system not support native FS")}}var a=function(e){e&&(t.is(e,n.AbsDir),this.rootPoint=e)},u=n.hasDriveLetter(process.cwd());a.available=!0;var c=n.SEP,l=a.prototype=new e;function f(e){return e}return l.toNativePath=function(e){return this.rootPoint?(t.is(e,n.Absolute),t(this.inMyFS(e),e+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(e,this.mountPoint||n.SEP))):e},l.arrayBuffer2Buffer=function(e){return e instanceof ArrayBuffer?new Buffer(new Uint8Array(e)):e},e.addFSType("NativeFS",function(e,t){return new a(t.r)}),a.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},a.prototype.inMyFS=function(e){return this.mountPoint?n.startsWith(e,this.mountPoint):!(!!u^!!n.hasDriveLetter(e))},e.delegateMethods(a.prototype,{getReturnTypes:function(e,t){return f(e),s.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(e,r){r=r||{},t.is(e,n.Absolute);var s=this.toNativePath(e);return this.assertExist(e),i.bin(o.readFileSync(s),this.getContentType(e))},size:function(e){var t=this.toNativePath(e);return o.statSync(t).size},setContent:function(e,r){t.is(arguments,[n.Absolute,i]);var s=n.up(e);s&&this.getRootFS().resolveFS(s).mkdir(s);var a=this.toNativePath(e);r.hasBin()||!r.hasPlainText()?o.writeFileSync(a,r.toNodeBuffer()):o.writeFileSync(a,r.toPlainText())},appendContent:function(e,r){t.is(arguments,[n.Absolute,i]);var s=n.up(e);s&&this.getRootFS().resolveFS(s).mkdir(s);var a=this.toNativePath(e);r.hasBin()||!r.hasPlainText()?o.appendFileSync(a,r.toNodeBuffer()):o.appendFileSync(a,r.toPlainText())},getMetaInfo:function(e,t){this.assertExist(e,t);var n=this.stat(e);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(e,t,n){f(e)},isReadOnly:function(e){return f(e),!1},stat:function(e){t.is(e,n.Absolute);var r=this.toNativePath(e);return o.statSync(r)},mkdir:function(e,t){if(t=t||{},s.is(arguments,[n.Absolute]),this.exists(e)){if(this.isDir(e))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(e);var r=n.up(e);r&&this.getRootFS().resolveFS(r).mkdir(r);var i=this.toNativePath(e);return o.mkdirSync(i),this.assertExist(i)},opendir:function(e,t){s.is(arguments,[String]),t=t||{};var r=this.toNativePath(e),i=n.truncSEP(r),a=o.readdirSync(r);t.nosep||(a=a.map(function(e){return e+(o.statSync(i+c+e).isDirectory()?c:"")}));return s.is([].concat(a),Array)},rm:function(e,t){s.is(arguments,[n.Absolute]),t=t||{},this.assertExist(e);var r=this.toNativePath(e);return this.isDir(e)?o.rmdirSync(r):o.unlinkSync(r)},exists:function(e,t){t=t||{};var n=this.toNativePath(e);return o.existsSync(n)},isDir:function(e){return this.exists(e)?this.stat(e).isDirectory():n.isDir(e)},touch:function(e){!this.exists(e)&&this.isDir(e)?this.mkdir(e):this.exists(e)&&o.utimesSync(e,Date.now()/1e3,Date.now()/1e3)},getURL:function(e){return"file:///"+e.replace(/\\/g,"/")},onAddObserver:function(e,t){var i=this,s=i.getRootFS();t=t||{};var a=this.isDir(e),u=o.watch(e,t,function(t,o){var u,c=a?n.rel(e,o):e;u=i.exists(c)?r({eventType:t},i.getMetaInfo(c)):{eventType:t},s.notifyChanged(c,u)});return{remove:function(){u.close()}}}}),a}),e("LSFS",["FSClass","PathUtil","extend","assert","Util","Content"],function(e,t,n,r,i,o){var s=function(e,t){r(e," new LSFS fail: no storage"),this.storage=e,this.options=t||{},this.options.useDirCache&&(this.dirCache={})},a=t.isDir.bind(t),u=t.up.bind(t),c=t.endsWith.bind(t),l=t.Absolute,f=t.SEP;function p(){return(new Date).getTime()}return s.ramDisk=function(e){var n={};return n[t.SEP]="{}","useDirCache"in(e=e||{})||(e.useDirCache=!0),new s(n,e)},e.addFSType("localStorage",function(e,t){return new s(localStorage,t)}),e.addFSType("ram",function(e,t){return s.ramDisk(t)}),s.now=p,(s.prototype=new e).resolveKey=function(e){return r.is(e,t.Absolute),this.mountPoint?t.SEP+t.relPath(e,this.mountPoint):e},s.prototype.getItem=function(e){r.is(e,t.Absolute);var n=this.resolveKey(e);return this.storage[n]},s.prototype.setItem=function(e,n){r.is(e,t.Absolute);var i=this.resolveKey(e);r(i.indexOf("..")<0),r(t.startsWith(i,t.SEP)),this.storage[i]=n},s.prototype.removeItem=function(e){r.is(e,t.Absolute);var n=this.resolveKey(e);delete this.storage[n]},s.prototype.itemExists=function(e){r.is(e,t.Absolute);var n=this.resolveKey(e);return r(this.storage,"No storage"),n in this.storage},s.prototype.getDirInfo=function(e){if(r.is(arguments,[t.AbsDir]),null==e)throw new Error("getDir: Null path");if(c(e,f)||(e+=f),r(this.inMyFS(e)),this.dirCache&&this.dirCache[e])return this.dirCache[e];var n,i={};try{(n=this.getItem(e))&&(i=JSON.parse(n))}catch(t){console.log("dinfo err : ",e,n)}return this.dirCache&&(this.dirCache[e]=i),i},s.prototype.putDirInfo=function(e,n,i){if(r.is(arguments,[t.AbsDir,Object]),!a(e))throw new Error("Not a directory : "+e);r(this.inMyFS(e)),this.dirCache&&(this.dirCache[e]=n),this.setItem(e,JSON.stringify(n));var o=u(e);if(null!=o&&this.inMyFS(o)){var s=this.getDirInfo(o);this._touch(s,o,t.name(e),i)}},s.prototype._touch=function(e,i,o,s){r.is(arguments,[Object,String,String]),r(this.inMyFS(i));var a="change";e[o]||(a="create",e[o]={},s&&(e[o].trashed=!0)),s||delete e[o].trashed,e[o].lastUpdate=p();var u=n({eventType:a},e[o]);this.getRootFS().notifyChanged(t.rel(i,o),u),this.putDirInfo(i,e,s)},s.prototype.removeEntry=function(e,n,i){r.is(arguments,[Object,String,String]),e[i]&&(e[i]={lastUpdate:p(),trashed:!0},this.getRootFS().notifyChanged(t.rel(n,i),{eventType:"trash"}),this.putDirInfo(n,e,!0))},s.prototype.removeEntryWithoutTrash=function(e,n,i){r.is(arguments,[Object,String,String]),e[i]&&(delete e[i],this.getRootFS().notifyChanged(t.rel(n,i),{eventType:"delete"}),this.putDirInfo(n,e,!0))},s.prototype.isRAM=function(){return this.storage!==localStorage},s.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},s.getUsage=function(){var e=0;for(var t in localStorage)"string"==typeof localStorage[t]&&(e+=localStorage[t].length);return e},s.getCapacity=function(){var e=0,t="a",n="___checkls___",r=0,i=Math.pow(2,25);try{for(var o=0;o<10;o++)t+=t;for(var o in localStorage)o.substring(0,n.length)==n?delete localStorage[o]:"string"==typeof localStorage[o]&&(r+=localStorage[o].length);for(var s=r;a()&&t.length<i;)t+=t;for(;t.length>1024;)t=t.substring(t.length/2),a();return{using:s,max:r}}finally{for(o=0;o<e;o++)delete localStorage[n+o]}function a(){try{return localStorage[n+e]=t,e++,r+=t.length,!0}catch(t){return delete localStorage[n+e],!1}}},e.delegateMethods(s.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(e,t){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(e,t){r.is(arguments,[l]),this.assertExist(e);var n=this.getItem(e);return o.looksLikeDataURL(n)?o.url(n):o.plainText(n)},setContent:function(e,t,n){r.is(arguments,[l,o]),this.assertWriteable(e);var i=null;t.hasPlainText()&&(i=t.toPlainText(),o.looksLikeDataURL(i)&&(i=null)),null!=i?this.setItem(e,i):this.setItem(e,t.toURL()),this.touch(e)},getMetaInfo:function(e,n){if(this.assertExist(e,{includeTrashed:!0}),r.is(arguments,[l]),e==t.SEP)return{};var i=r(t.up(e));if(!this.inMyFS(i))return{};var o=t.name(e);r.is(i,t.AbsDir);var s=this.getDirInfo(i);return r(s[o])},setMetaInfo:function(e,n,i){r.is(arguments,[String,Object]),this.assertWriteable(e);var o=r(t.up(e));if(this.inMyFS(o)){var s=this.getDirInfo(o),a=t.name(e);s[a]=n,this.putDirInfo(o,s,s[a].trashed)}},mkdir:function(e,t){r.is(arguments,[l]),this.assertWriteable(e),this.touch(e)},opendir:function(e,t){r.is(arguments,[String]),t=t||{};var n=this.getDirInfo(e),i=[];for(var o in n)r(n[o]),n[o].trashed&&!t.includeTrashed||i.push(o);return r.is(i,Array)},rm:function(e,n){r.is(arguments,[l]),n=n||{},this.assertWriteable(e);var i=t.up(e);if(null==i||!this.inMyFS(i))throw new Error(e+": cannot remove. It is root of this FS.");(this.assertExist(e,{includeTrashed:n.noTrash}),t.isDir(e))?(this.opendir(e).length>0&&this.err(e,"Directory not empty"),n.noTrash&&this.removeItem(e)):this.removeItem(e);var o=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(o,i,t.name(e)):this.removeEntry(o,i,t.name(e))},exists:function(e,n){r.is(arguments,[l]),n=n||{};var i=t.name(e),o=t.up(e);if(null==o||!this.inMyFS(o))return!0;var s=this.getDirInfo(o)[i];return s&&s.trashed&&this.itemExists(e)&&this.isDir(e),!s&&this.itemExists(e),s&&!s.trashed&&!s.link&&this.itemExists(e),s&&!n.includeTrashed&&(s=!s.trashed),!!s},link:function(e,n,i){r.is(arguments,[t.Absolute,t.Absolute]),this.assertWriteable(e),this.exists(e)&&this.err(e,"file exists"),t.isDir(e)&&!t.isDir(n)&&this.err(e," can not link to file "+n),!t.isDir(e)&&t.isDir(n)&&this.err(e," can not link to directory "+n);var o={};o.link=n,o.lastUpdate=p(),this.setMetaInfo(e,o),r(this.exists(e)),r(this.isLink(e))},isLink:function(e){return r.is(arguments,[t.Absolute]),this.exists(e)?r(this.getMetaInfo(e)).link:null},touch:function(e){r.is(arguments,[l]),this.assertWriteable(e),this.itemExists(e)||(t.isDir(e)?(this.dirCache&&(this.dirCache[e]={}),this.setItem(e,"{}")):this.setItem(e,""));var n=u(e);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,t.name(e),!1)}else r(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(e){return this.getContent(e).toURL()},opendirEx:function(e,n){r.is(e,t.AbsDir),n=n||{};var i={},o=this.getDirInfo(e);if(n.includeTrashed)return o;for(var s in o)o[s].trashed||(i[s]=o[s]);return i}}),s}),"undefined"!=typeof $&&$.ajaxTransport("+binary",function(e,t,n){if(window.FormData&&(e.dataType&&"binary"==e.dataType||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob)))return{send:function(t,n){var r=new XMLHttpRequest,i=e.url,o=e.type,s=e.async||!0,a=e.responseType||"blob",u=e.data||null,c=e.username||null,l=e.password||null;for(var f in r.addEventListener("load",function(){var t={};t[e.dataType]=r.response,n(r.status,r.statusText,t,r.getAllResponseHeaders())}),r.open(o,i,s,c,l),t)r.setRequestHeader(f,t[f]);r.responseType=a,r.send(u)},abort:function(){n.abort()}}}),e("jquery.binarytransport",function(){}),e("WebFS",["FSClass","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(e,t,n,r,i){var o=function(){},s=o.prototype=new e;return e.addFSType("web",function(){return new o}),s.fstype=function(){return"Web"},s.supportsSync=function(){return!1},s.inMyFS=function(e){return i.isURL(e)},e.delegateMethods(s,{exists:function(){return!0},getContentAsync:function(e){var t=this;return n.promise(function(n,i){$.get(e,function(i){var o=new FileReader;o.addEventListener("loadend",function(){n(r.bin(o.result,t.getContentType(e)))}),o.readAsArrayBuffer(i)},"binary").fail(i)})},getURL:function(e){return e}}),o}),e("Env",["assert","PathUtil"],function(e,t){var n=function(e){this.value=e};return n.prototype={expand:function(t){e.is(t,String);var n=this;return t.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,t){return n.get(t)})},expandPath:function(n){return e.is(n,String),n=(n=(n=this.expand(n)).replace(/\/+/g,"/")).replace(/^[a-z][a-z]+:\//,function(e){return e+"/"}),e.is(n,t.Path)},get:function(e){return this.value[e]},set:function(e,t){this.value[e]=t}},n}),e("SFile",["extend","assert","PathUtil","Util","Content","FSClass","FileSaver","DeferredUtil"],function(e,t,n,r,i,o,s,a){var u=function(e,r){t.is(r,n.Absolute),this._path=r,this.rootFS=e,this.fs=e.resolveFS(r),this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return u.is=function(e){return e&&"function"==typeof e.isSFile&&e.isSFile()},u.prototype={isSFile:function(){return!0},setPolicy:function(e){if(this.policy)throw new Error("policy already set");return this.policy=e,this._clone()},getPolicy:function(e){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(e,i){var o;if(i=i||{},u.is(e))o=e;else{var s;t.is(e,n.Absolute);var a=i.policy||this.policy;if(a&&(s=a.topDir)&&(s.path&&(s=s.path()),!n.startsWith(e,s)))throw new Error(e+": cannot access. Restricted to "+s);(o=new u(this.rootFS,e)).policy=a}return o.policy?r.privatize(o):o},contains:function(e){return t(u.is(e),e+" shoud be a SFile object."),!!this.isDir()&&n.startsWith(e.path(),this.path())},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(e){return n.truncExt(this.path(),e)},ext:function(){return n.ext(this.path())},relPath:function(e){var r=e.path?e.path():e;return n.relPath(this.path(),t.is(r,n.Absolute))},up:function(){var e=this.path(),t=n.up(e);return null==t?null:this._resolve(t)},rel:function(e){t.is(e,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,e))},sibling:function(e){return this.up().rel(e)},startsWith:function(e){return n.startsWith(this.name(),e)},endsWith:function(e){return n.endsWith(this.name(),e)},equals:function(e){return e&&"function"==typeof e.path&&e.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var e=this.metaInfo();return!!e&&e.trashed},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(e){return this.act.fs.getMetaInfo(this.act.path,e)},setMetaInfo:function(e,t){return this.act.fs.setMetaInfo(this.act.path,e,t)},getDirTree:function(e){return this.act.fs.getDirTree(this.act.path,e)},assertExists:function(){t(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(e){var t=Array.prototype.slice.call(arguments);if("function"==typeof t[0]){var n=t.shift();return a.resolve(this.exists.apply(this,t)).then(n)}e=e||{};var r=this.fs.exists(this.path(),e);return r||e.noFollowLink?r:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(e){var t=this;return e=e||{},this.isLink()?a.resolve(this.fs.rm(this.path(),e)):(this.isDir()&&(e.recursive||e.r)?this.each(function(t){return t.rm(e)}):a.resolve()).then(function(){return t.act.fs.rm(t.act.path,e)})},removeWithoutTrash:function(e){(e=e||{}).noTrash=!0,this.rm(e)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(e){return"function"==typeof e?this.getText(e):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(e){if(t.is(e,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());var n=this.contentType({def:null});return null!==n&&!n.match(/^text/)&&i.looksLikeDataURL(e)?a.throwNowIfRejected(this.setContent(i.url(e))):a.throwNowIfRejected(this.setContent(i.plainText(e)))},appendText:function(e){return t.is(e,String),this.act.fs.appendContent(this.act.path,i.plainText(e))},getContent:function(e){return"function"==typeof e?this.act.fs.getContentAsync(this.act.path).then(e):this.act.fs.getContent(this.act.path)},setContent:function(e){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,e)},getText:function(e){if("function"==typeof e){return this.getContent(t).then(e)}return t(this.act.fs.getContent(this.act.path));function t(e){try{return e.toPlainText()}catch(t){return e.toURL()}}},getDataURL:function(e){return"function"==typeof e?this.getContent(function(e){return e.toURL()}):this.getContent().toURL()},setDataURL:function(e){return this.setContent(i.url(e))},dataURL:function(e){return"string"==typeof e?this.setDataURL(e):"function"==typeof e?this.getDataURL(e):this.getDataURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(e){return this.act.fs.getContentType(this.act.path,e)},bytes:function(e){return i.isBuffer(e)?this.setBytes(e):this.getBytes()},setBytes:function(e){return this.act.fs.setContent(this.act.path,i.bin(e,this.contentType()))},getBytes:function(e){return e=e||{},this.act.fs.getContent(this.act.path).toBin(e.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(e){return e instanceof Array?this.text(e.join("\n")):"function"==typeof e?this.text(function(t){return e(t.replace(/\r/g,"").split("\n"))}):this.text().replace(/\r/g,"").split("\n")},obj:function(){if(0==arguments.length){var e=this.text();return e?JSON.parse(e):null}this.text(JSON.stringify(t.is(arguments[0],Object)))},copyFrom:function(e,t){return e.copyTo(this,t)},copyTo:function(e,n){t(e&&e.isSFile(),e+" is not a file");var r=this,i=(n=n||{},r.isDir()),o=e.isDir();if(!i&&o&&(e=e.rel(r.name()),t(!e.isDir(),e+" is a directory."),o=!1),!i||o){if(i||o)return t(i&&o,"Both src and dst should be dir"),r.each(function(t){var r,i=e.rel(t.name());return n.progress&&(r=n.progress(i,{src:t,dst:i})),a.resolve(r).then(function(){return i.copyFrom(t,n)})});n.echo&&n.echo(r+" -> "+e);var s=this.act.fs.cp(this.act.path,e.getResolvedLinkPath(),n);return s=a.resolve(s),n.a?s.then(function(){return e.setMetaInfo(r.getMetaInfo())}):s}this.err("Cannot move dir "+r.path()+" to file "+e.path())},moveFrom:function(e,t){var n=this;return n.exists(function(r){return n.copyFrom(e,t).then(function(){return e.rm({recursive:!0})},function(e){if(!r)return n.exists(function(e){if(e)return n.rm({recursive:!0})}).then(function(){throw e});throw e})})},moveTo:function(e,t){return e.moveFrom(this,t)},assertDir:function(){return t.is(this.path(),n.Dir),this},each:function(e,t){return this.assertDir().listFilesAsync(t).then(function(t){return a.each(t,e)})},eachrev:function(e,t){return this.assertDir().listFilesAsync(t).then(function(t){return a.each(t.reverse(),e)})},recursive:function(e,t){var n=this.assertDir();return t=n.convertOptions(t),n.each(function(n){return n.isDir()?n.recursive(e,t):e(n)},t)},_listFiles:function(e,n){t(null==e||"object"==typeof e);var r,i=this.assertDir();this.path();return e=i.convertOptions(e),r||(r=e.order),n?this.act.fs.opendirAsync(this.act.path,e).then(o):o(this.act.fs.opendir(this.act.path,e));function o(t){for(var n=[],o=0;o<t.length;o++){var s=t[o],a=i.rel(s);e.excludesF(a)||n.push(a)}return"function"==typeof r&&n.sort&&n.sort(r),n}},listFilesAsync:function(e){return this._listFiles(e,!0)},listFiles:function(e){return this._listFiles(e,!1)},ls:function(e){t(null==e||"object"==typeof e);var n=this.assertDir();return e?n.listFiles(e).map(function(e){return e.name()}):this.act.fs.opendir(this.act.path,e)},convertOptions:function(e){var i=r.extend({},e),o=(this.assertDir(),this.path()),s=i.excludes||{};if("function"==typeof s)i.excludesF=s;else if("object"==typeof s){if(s instanceof Array){var a={};s.forEach(function(e){n.startsWith(e,"/")?a[e]=1:a[o+e]=1}),s=a}i.excludesF=function(e){return s[e.path()]}}return t.is(i,{excludesF:Function})},mkdir:function(){return this.touch()},link:function(e,t){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,e.path(),t)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(e){return this.getFS().getRootFS().addObserver(this.path(),e)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},setBlob:function(e){var t=this;return a.promise(function(n,r){var i=new FileReader;i.addEventListener("loadend",function(){a.resolve(t.setBytes(i.result)).then(n)}),i.readAsArrayBuffer(e)})},size:function(e){if(!e){if(this.isDir()){var t=0;return this.each(function(e){t+=e.size()}),t}return this.act.fs.size(this.act.path)}},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use 'zip' instead.");s(this.getBlob(),this.name())},err:function(){var e=Array.prototype.slice.call(arguments);throw console.log.apply(console,e),new Error(e.join(""))},exportAsObject:function(e){var t=this,n={};return this.recursive(function(e){n[e.relPath(t)]=e.text()},e),{base:t.path(),data:n}},importFromObject:function(e,t){"string"==typeof e&&(e=JSON.parse(e));e=e.data;for(var n in e)this.rel(n).text(e[n])},watch:function(e,t){var n=function(){};"function"==typeof e&&(n=e),"function"==typeof t&&(n=t);var r=this.getFS().getRootFS();r.addObserver(this.path(),function(e,t){n(t.eventType,r.get(e),t)})}},Object.defineProperty(u.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),t.is(this._act,{fs:o,path:n.Absolute}),this._act)}}),u}),e("RootFS",["assert","FSClass","PathUtil","SFile"],function(e,t,n,r){var i=function(n){e.is(n,t),this.mount(null,n)},o=i.prototype,s={err:function(e,t){throw new Error(e+": "+t)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(t,r){e.is(arguments,[n.AbsDir]);var i=this.fstab();console.log(i);for(var o=0;o<i.length;o++)if(i[o].mountPoint==t)return i.splice(o,1),!0;return!1},availFSTypes:function(){return t.availFSTypes()},mount:function(n,r,i){"string"==typeof r&&(r=e(t.availFSTypes()[r],"fstype "+r+" is undefined.")(n,i||{}));e.is(r,t),r.mounted(this,n),this.fstab().unshift(r)},resolveFS:function(r,i){var o;return e.is(r,n.Absolute),this.fstab().forEach(function(e){o||e.inMyFS(r)&&(o=e)}),o||this.err(r,"Cannot resolve"),e.is(o,t)},get:function(t){return e.is(t,n.Absolute),new r(this.resolveFS(t),t)},addObserver:function(t,n,r){this.observers=this.observers||[];var i,o,s={};"string"==typeof t&&(i=t),"string"==typeof n&&(i=n),"string"==typeof r&&(i=r),"object"==typeof t&&(s=t),"object"==typeof n&&(s=n),"object"==typeof r&&(s=r),"function"==typeof t&&(o=t),"function"==typeof n&&(o=n),"function"==typeof r&&(o=r),e.is(i,String),e.is(o,Function);var a=this.resolveFS(i).onAddObserver(i,s),u=this.observers,c={path:i,handler:o,remove:function(){var e=u.indexOf(this);u.splice(e,1),a&&a.remove()}};return this.observers.push(c),c},notifyChanged:function(e,t){this.observers&&this.observers.forEach(function(r){n.isChildOf(e,r.path)&&r.handler(e,t)})},getRootFS:function(){return this}};for(var a in s)o[a]=s[a];return i}),e("zip",["SFile","FileSaver","Util","DeferredUtil"],function(e,t,n,r){var i={setJSZip:function(e){i.JSZip=e,r.external.Promise||(r.external.Promise=e.external.Promise)}};return"undefined"!=typeof JSZip&&i.setJSZip(JSZip),i.zip=function(t,n,o){e.is(n)||(o=n),o=o||{};var s=new i.JSZip;return function e(t,n){return n.each(function(n){var i=r.resolve();return o.progress&&(i=o.progress(n)),i.then(function(){return n.isDir()?e(t.folder(n.name().replace(/[\/\\]$/,"")),n):n.getContent(function(e){t.file(n.name(),e.toArrayBuffer())})})})}(s,t).then(function(){return r.resolve(s.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(r){if(e.is(n))return n.setBytes(r);saveAs(new Blob([r],{type:"application/zip"}),t.name().replace(/[\/\\]$/,"")+".zip")})},i.unzip=function(t,n,o){var s={};o=o||{},e.is(t)&&(t=t.getContent().toArrayBuffer()),o.onCheckFile||(o.onCheckFile=function(e){return o.overwrite?e:!e.exists()&&e});var a=new i.JSZip;return r.resolve(a.loadAsync(t)).then(function(){return r.each(a.files,function(t,i){var a,u;return r.resolve(i.async("arraybuffer")).then(function(e){if(a=e,u=n.rel(i.name),o.progress)return r.resolve(o.progress(u))}).then(function(){if(console.log("Inflating",i.name),!u.isDir()){var t={file:u,status:"uploaded"};s[u.path()]=t;var n=FS.Content.bin(a,u.contentType()),r=o.onCheckFile(u,n);return!1===r&&(t.status="cancelled",u=null),e.is(r)&&(u.path()!==r.path()&&(t.redirectedTo=r),u=r),u?u.setContent(n):void 0}})})}).then(function(){return console.log("unzip done",s),s})},i}),e("promise",[],function(){setTimeout;function e(e){return Boolean(e&&void 0!==e.length)}function t(){}function n(e){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],a(e,this)}function r(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,n._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var r;try{r=n(e._value)}catch(e){return void o(t.promise,e)}i(t.promise,r)}else(1===e._state?i:o)(t.promise,e._value)})):e._deferreds.push(t)}function i(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof n)return e._state=3,e._value=t,void s(e);if("function"==typeof r)return void a((i=r,u=t,function(){i.apply(u,arguments)}),e)}e._state=1,e._value=t,s(e)}catch(t){o(e,t)}var i,u}function o(e,t){e._state=2,e._value=t,s(e)}function s(e){2===e._state&&0===e._deferreds.length&&n._immediateFn(function(){e._handled||n._unhandledRejectionFn(e._value)});for(var t=0,i=e._deferreds.length;t<i;t++)r(e,e._deferreds[t]);e._deferreds=null}function a(e,t){var n=!1;try{e(function(e){n||(n=!0,i(t,e))},function(e){n||(n=!0,o(t,e))})}catch(e){if(n)return;n=!0,o(t,e)}}return n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,n){var i=new this.constructor(t);return r(this,new function(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}(e,n,i)),i},n.prototype.finally=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})},n.all=function(t){return new n(function(n,r){if(!e(t))return r(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(t);if(0===i.length)return n([]);var o=i.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var a=t.then;if("function"==typeof a)return void a.call(t,function(t){s(e,t)},r)}i[e]=t,0==--o&&n(i)}catch(e){r(e)}}for(var a=0;a<i.length;a++)s(a,i[a])})},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,n){n(e)})},n.race=function(t){return new n(function(r,i){if(!e(t))return i(new TypeError("Promise.race accepts an array"));for(var o=0,s=t.length;o<s;o++)n.resolve(t[o]).then(r,i)})},n._immediateFn=function(e){e()},n._unhandledRejectionFn=function(){"undefined"!=typeof console&&console},n}),e("FS",["FSClass","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil","promise"],function(e,t,n,r,i,o,s,a,u,c,l,f,p){var h,d={};d.assert=s,d.Content=c,d.Class=e,d.DeferredUtil=f,f.config.useJQ||(f.external.Promise=p),d.Env=o,d.LSFS=n,d.NativeFS=t,d.PathUtil=i,d.RootFS=u,d.SFile=a,d.WebFS=r,d.zip=l,"object"==typeof window&&(window.FS=d);var g=new o({});return d.addFSType=e.addFSType,d.availFSTypes=e.availFSTypes,d.setEnvProvider=function(e){g=e},d.getEnvProvider=function(){return g},d.setEnv=function(e,t){if("object"==typeof e)for(var n in e)g.set(n,e[n]);else g.set(e,t)},d.getEnv=function(e){return"string"==typeof e?g.get(e):g.value},d.init=function(e){h||(e||(t.available?e=new t:"object"==typeof localStorage?e=new n(localStorage):"function"==typeof importScripts&&(self.addEventListener("message",function(e){var t=e.data;switch("string"==typeof t&&(t=JSON.parse(t)),t.type){case"upload":d.get(t.base).importFromObject(t.data);break;case"observe":h.observe(t.path,function(e,t){self.postMessage(JSON.stringify({type:"changed",path:e,content:d.get(e).text(),meta:t}))})}}),e=n.ramDisk())),h=new u(e))},d.getRootFS=function(){return d.init(),h},d.get=function(){return d.init(),h.get.apply(h,arguments)},d.expandPath=function(){return g.expandPath.apply(g,arguments)},d.resolve=function(e,t){return d.init(),a.is(e)?e:(e=g.expandPath(e),t&&!i.isAbsolutePath(e)?(t=g.expandPath(t),d.get(t).rel(e)):d.get(e))},d.mount=function(){return d.init(),h.mount.apply(h,arguments)},d.unmount=function(){return d.init(),h.unmount.apply(h,arguments)},d.isFile=function(e){return a.is(e)},d}),t(["FS"],function(e){n=e}),"undefined"!=typeof window&&void 0===window.FS&&(window.FS=n),"undefined"!=typeof module&&(module=n),n}),n("PathUtil",["FS"],function(e){return e.PathUtil}),n("FileList",["require","exports","module","FS"],function(e,t,n){const r=e("FS");n.exports=function(e,t){var n=null,i=null,o=!1,s="select"==e[0].tagName.toLowerCase();t||(t={});var a={select:f,ls:p,on:t.on?t.on:{},curFile:function(){return i},curDir:function(){return n},setModified:function(e){if(!i)return;o=e,l(i).text(h(i,e))},isModified:function(){return o}},u=$("<div>"),c=$("<div>");function l(e){var t=$();if(!e)return t;var n=e.path();return c.find(s?"option":"span").each(function(){var e=$(this);e.data("filename")==n&&(t=e)}),t}function f(e){if((!a.on.select||!a.on.select(e))&&e)if(o=!1,e.isDir())p(e);else{var t=e.up();n.path()!=t.path()?(i=e,p(t)):(l(i).removeClass("selected"),l(i=e).addClass("selected"))}}function p(o){if("string"==typeof o&&(o=r.get(o)),o&&(n=o,u.text(o.name()).attr({title:o.path()})),n&&n.isDir()){c.empty();var a=$("<div>").text("Wait..");c.append(a),s&&(e.empty(),e.append($("<option>").text("Select...")));var l=n.up();l&&!n.equals(t.topDir)&&(s?e.append($("<option>").attr("value",l.path()).text("[Up]")):$(s?"<option>":"<li>").append($("<span>").addClass("fileItem").text("[Up]")).appendTo(c).click(function(){f(l)})),i&&!i.exists()&&(i=null);var p=0,g=n.listFiles();g.length>0?setTimeout(function t(){0==p&&a.remove();var n=g[p++];p<g.length&&setTimeout(t,0);var r=d(n);if(!r)return;var o=i&&i.path()==n.path();if(s)e.append($("<option>").attr("value",n.path()).text(h(n)));else{var u=$("<span>").addClass("fileItem").text(h(n)).data("filename",n.path());o&&u.addClass("selected"),$("<li>").append(u).appendTo(c).click(function(){f(n)})}},0):a.remove()}}function h(e,t){return(t?"*":"")+(e.isReadOnly()?"[RO]":"")+d(e)}function d(e){return a.on.displayName?a.on.displayName.apply(a,arguments):e.name()}return s?e.change(function(){this.value&&f(r.get(this.value))}):e.append(u).append(c),a}}),n("exceptionCatcher",[],function(){var e={f:function(t){if("function"==typeof t){if(t.isTrcf)return t;var n=function(){if(!e.handleException||e.enter)return t.apply(this,arguments);try{return e.enter=!0,t.apply(this,arguments)}catch(t){e.handleException(t)}finally{e.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof t){for(var r in t)t[r]=e.f(t[r]);return t}}};return e}),n("UI",["Util","exceptionCatcher"],function(e,t){var n={},r=t.f;return(n=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=[],s={},a=[],u=c(t);return u.$edits=a,u.$vars=s,$.data(u,"edits",a),$.data(u,"vars",s),a.load=function(e){a.model=e,a.forEach(function(e){a.writeToJq(e.params.$edit,e.jq)}),a.validator.on.validate.call(a.validator,a.model)},a.writeToJq=function(e,t){var n=a.model;if(n){for(var r=e.name.split("."),i=0;i<r.length;i++)n=n[r[i]];n=e.type.toVal(n),"checkbox"==t.attr("type")?t.prop("checked",!!n):t.val(n)}},a.validator={errors:{},show:function(){if(s.validationMessage)for(var e in s.validationMessage.empty(),this.errors)s.validationMessage.append(n("div",this.errors[e].mesg));if(s.OKButton){var t=!0;for(var e in this.errors)t=!1;s.OKButton.attr("disabled",!t)}},on:{validate:function(){}},addError:function(e,t,n){this.errors[e]={mesg:t,jq:n},this.show()},removeError:function(e){delete this.errors[e],this.show()},allOK:function(){for(var e in this.errors)delete this.errors[e];this.show()},isValid:function(){var e=!0;for(var t in this.errors)e=!1;return e}},a.writeToModel=function(e,t,n){var r=a.model;if(r){var i=e.name;try{t=e.type.fromVal(t)}catch(e){return void a.validator.addError(i,e,n)}a.validator.removeError(i);for(var o=i.split("."),s=0;s<o.length;s++)s==o.length-1?a.on.writeToModel(i,t)||(r[o[s]]=t):r=r[o[s]];a.validator.on.validate.call(a.validator,a.model)}},a.on={},a.on.writeToModel=function(e,t){},o.length>0&&setTimeout(r(function e(){o.forEach(function(e){e()});setTimeout(r(e),50)}),50),u;function c(t){return t instanceof Array?function(t){var i=t[0],u=1,l=$("<"+i+">");"object"!=typeof t[u]||t[u]instanceof Array||t[u]instanceof $||(!function(t,i,u){i.$var&&(s[i.$var]=t);i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(e){a.writeToModel(i.$edit,e,t)}),s[i.$edit.name]||(s[i.$edit.name]=t),a.push({jq:t,params:i}));for(var c in i)if("on"==c)for(var l in i.on)f(l,i.on[l]);else"css"==c&&null!=i[c]?t.css(i[c]):e.startsWith(c,"$")||null==i[c]||t.attr(c,i[c]);function f(e,n){if(n)if("enterkey"==e)t.on("keypress",r(function(e){13==e.which&&n.apply(t,arguments)}));else if("realtimechange"==e){var s,a=!0;o.push(function(){var e;e="checkbox"==i.type?!!t.prop("checked"):t.val(),(a||s!=e)&&(n.apply(t,[e,s]),s=e),a=!1})}else t.on(e,r(n))}}(l,t[u]),u++);for(;u<t.length;)l.append(c(t[u])),u++;return l}(t):"string"==typeof t?(i=t,$(document.createTextNode(i))):t;var i}}).types={String:{toVal:function(e){return e},fromVal:function(e){return e}},Number:{toVal:function(e){return e+""},fromVal:function(e){return parseFloat(e)}}},n}),n("DeferredUtil",["FS"],function(e){return e.DeferredUtil}),n("FileMenu",["UI","FS","DeferredUtil"],function(e,t,n){return function(){var t={on:{}};return t.on.validateName=function(e,n){return e?{ok:!0,file:t.on.getCurDir().rel(e)}:{ok:!1,reason:"ファイル名を入力してください"}},t.on.displayName=function(e){return e.name()},t.on.close=function(){},t.on.open=function(e){"object"==typeof t.fileList&&t.fileList.select(e)},t.on.ls=function(){"object"==typeof t.fileList&&t.fileList.ls()},t.on.getCurFile=function(){if("object"==typeof t.fileList)return t.fileList.curFile();throw"on.getCurFile is missing"},t.on.getCurDir=function(){if("object"==typeof t.fileList)return t.fileList.curDir();throw"on.getCurDir is missing"},t.on.createContent=function(e){return e.text("")},t.onMenuStart=function(){},t.dialog=function(e,n,r){return t.dialogOpt({title:e,name:n,onend:r})},t.dialogOpt=function(n){var r=n.title,i=n.name||"",o=n.onend||function(){};t.d||(t.d=e(["div"],{title:r},"ファイル名を入力してください",["br"],["input",{$var:"name",on:{enterkey:function(){t.d.$vars.done()},realtimechange:function(e){t.d.$vars.chg(e)}}}],["br"],["div",{$var:"extra"}],["div",{$var:"msg"}],["button",{$var:"b",on:{click:function(){t.d.$vars.done()}}},"OK"])),t.d.attr({title:r});var s=t.d.$vars;s.name.val(i),t.d.dialog({title:r});var a=null;s.done=function(){a&&a.ok&&(o(a.file),t.d.dialog("close"))},s.chg=function(e){(a=t.on.validateName(e,n)).ok&&a.file.exists()&&(a={ok:!1,reason:e+"は存在します"}),a.ok?(s.msg.css({color:"blue"}),s.msg.text(a.note||""),s.b.removeAttr("disabled")):(s.msg.css({color:"red"}),s.msg.text(a.reason),s.b.attr("disabled",!0))},s.extra.empty(),n.extraUI&&n.extraUI(s.extra)},t.create=function(){t.onMenuStart("create"),t.dialogOpt({title:"新規作成",action:"create",onend:function(e){e.exists()||(t.on.createContent(e),t.on.ls(),t.on.open(e))}})},t.mv=function(){t.onMenuStart("mv");var e=t.on.getCurFile();if(e){var n=t.on.displayName(e);t.dialogOpt({title:"名前変更",name:n,action:"mv",extraUI:t.on.mvExtraUI,onend:async function(n){if(!n)return;let r;if(t.on.mv&&(r=await t.on.mv(e,n)),!1!==r){var i=e.text();e.rm(),t.on.close(e),e=n,n.text(i),t.on.ls(),t.on.open(e)}}})}},t.rm=function(){t.onMenuStart("rm");var e=t.on.getCurFile();e&&confirm(e.name()+"を削除しますか？")&&(e.rm(),t.on.ls(),t.on.close(e))},t}}),n("ErrorDialog",["require","exports","module","FS","UI"],function(e,t,n){const r=e("FS"),i=e("UI");n.exports=class{constructor(e){this.ide=e,this.pluginAdded={}}showErrorPos(e,t){function n(){$.data(e,"opened")&&(e.dialog("close"),$.data(e,"opened",!1))}const i=this.ide;let o,s,a,u,c=t.message;if(!t)return void n();if(t.isTError?(o=t.src,s=t.pos,a=t.row,u=t.col):(o={name:function(){return"不明"},text:()=>null},s=0),t.stack&&t.stack.length>0&&t.stack[0].fileName){const e=i.project.compiler;for(let{columnNumber:n,lineNumber:i,fileName:a}of t.stack)if(console.log(n,i,a),a&&"number"==typeof n&&"number"==typeof i&&!(a=e.convertFromWorkerPath(a)).match(/^http/))try{if(o=r.get(a),s={row:i,col:n},o.exists())break}catch(e){console.log("ErrorDialog","stack",e)}}"object"==typeof s&&(a=s.row,u=s.col),e.empty();const l=$("<div>").text(c+" 場所："+o.name()+("number"==typeof a?":"+a+":"+u:""));"number"==typeof a&&"number"==typeof u&&l.append($("<button>").text("エラー箇所に移動").click(function(){i.jump(o,a,u),n()})),e.append(l),e.append($("<div>").attr("class","quickFix")),console.log("src.name",o.name());const f=o.text();if(f&&"object"==typeof s){let e=0;const t=f.split("\n");for(let n=0;n<t.length&&n+1<s.row;n++)e+=t[n].length+1;s=e+=s.col}if(f){const t=$("<pre>");t.append($("<span>").text(f.substring(0,s))),t.append($("<img>").attr("src",r.expandPath("${sampleImg}/ecl.png"))),t.append($("<span>").text(f.substring(s))),e.append(t)}return e.attr("title","エラー"),e.dialog({width:600,height:400}),$.data(e,"opened",!0),e}show(e){window.shownError=e,console.log("ErrorDialog","show",e),console.error(e);const t=this.ide,n=this.pluginAdded;if(e.pluginName&&!n[e.pluginName])return n[e.pluginName]=!0,void t.restart();e.pluginName?alert(e.message):(this.showErrorPos($("#errorPos"),e),t.displayMode("runtime_error"),$("#errorPos").find(".quickFix").append(i("button",{on:{click:function(){const t="string"==typeof e.stack?e.stack:"function"==typeof e.stack.join?e.stack.join("\n"):e+"",n=i("pre",t),r=n.html().replace(/_trc_([\w]*)/g,function(e){return"<strong>"+e+"</strong>"});n.html(r),$("#errorPos").find(".quickFix").append(n)}}},"トレース表示"))),t.stop()}}}),n("parser",["require","exports","module"],function(e,t,n){n.exports=function(){function e(e,t){var n;for(n in t)e[n]=t[n];return e}var t={consoleBuffer:"",options:{traceTap:!1,optimizeFirst:!0,profile:!1,verboseFirst:!1,traceFirstTbl:!1},Parser:n,StringParser:o,nc:r};function n(e){t.options.traceTap?this.parse=function(t){console.log("tap: name="+this.name+"  pos="+(t?t.pos:"?"));var n=e.apply(this,[t]),r="NOIMG";return n.src&&n.src.str&&(r=n.src.str.substring(n.pos-3,n.pos)+"^"+n.src.str.substring(n.pos,n.pos+3)),n.src&&n.src.tokens&&(r=n.src.tokens[n.pos-1]+"["+n.src.tokens[n.pos]+"]"+n.src.tokens[n.pos+1]),console.log("/tap: name="+this.name+" pos="+(t?t.pos:"?")+"->"+(n?n.pos:"?")+" "+r+" res="+(n?n.success:"?")),n}:this.parse=e}function r(e,t){if(null==e)throw t+" is null!";return e}function i(e,t){null!=e&&(this.src={maxPos:0,global:t},"string"==typeof e&&(this.src.str=e),e instanceof Array&&(this.src.tokens=e),this.pos=0,this.result=[],this.success=!0)}t.dispTbl=function(e){var t="",n={};if(!e)return t;for(var r in e){const t=e[r].name;n[t]||(n[t]=""),n[t]+=r}for(let e in n)t+=n[e]+"->"+e+",";return t},n.create=function(e){return new n(e)},t.create=n.create,e(n.prototype,{except:function(e){return this.ret(n.create(function(t){return e.apply({},t.result)&&(t.success=!1),t}).setName("(except "+this.name+")"))},noFollow:function(e){return r(e,"p"),this.ret(n.create(function(t){var n=e.parse(t);return t.success=!n.success,t}).setName("("+this.name+" noFollow "+e.name+")"))},andNoUnify:function(e){r(e,"next");var t=this;return n.create(function(n){var r=t.parse(n);if(!r.success)return r;var i=e.parse(r);return i.success&&(i.result=r.result.concat(i.result)),i}).setName("("+this.name+" "+e.name+")")},and:function(e){var r=this.andNoUnify(e);if(!this._first)return r;var i=this._first.tbl,o={};for(var s in i)o[s]=i[s].andNoUnify(e);return(r=n.fromFirst(this._first.space,o)).setName("("+this.name+" >> "+e.name+")"),t.options.verboseFirst&&console.log("Created aunify name="+r.name+" tbl="+t.dispTbl(o)),r},retNoUnify:function(e){var t,r=this;return t="function"==typeof e?n.create(function(t){var n=t.clone();return n.result=[e.apply({},t.result)],n}).setName("retfunc"):e,n.create(function(e){var n=r.parse(e);return n.success?t.parse(n):n}).setName("("+this.name+" >= "+t.name+")")},ret:function(e){if(!this._first)return this.retNoUnify(e);var r=this._first.tbl,i={};for(var o in r)i[o]=r[o].retNoUnify(e);const s=n.fromFirst(this._first.space,i);return s.setName("("+this.name+" >>= "+e.name+")"),t.options.verboseFirst&&console.log("Created runify name="+s.name+" tbl="+t.dispTbl(i)),s},first:function(e,r){if(!t.options.optimizeFirst)return this;if(null==e)throw"Space is null2!";if("string"==typeof r){for(var i={},o=0;o<r.length;o++)i[r.substring(o,o+1)]=this;return n.fromFirst(e,i).setName("(fst "+this.name+")")}if(null==r)return n.fromFirst(e,{ALL:this}).setName("(fst "+this.name+")");if("object"==typeof r)throw"this._first={space: space, tbl:ct}";return this},firstTokens:function(e){if(!t.options.optimizeFirst)return this;"string"==typeof e&&(e=[e]);var r={};if(e){var i=this;e.forEach(function(e){r[e]=i})}else r.ALL=this;return n.fromFirstTokens(r).setName("(fstT "+this.name+")")},unifyFirst:function(r){function i(e,t){return e?t?e.orNoUnify(t).checkTbl():e:t}var o={};this.checkTbl(),r.checkTbl(),e(o,this._first.tbl),function(){var e=r._first.tbl,t={};for(let e in o)t[e]=1;for(let n in e)t[n]=1;delete t.ALL,(o.ALL||e.ALL)&&(o.ALL=i(o.ALL,e.ALL));for(let n in t)o[n]&&e[n]?o[n]=i(o[n],e[n]):o[n]&&!e[n]?o[n]=i(o[n],e.ALL):!o[n]&&e[n]&&(o[n]=i(o.ALL,e[n]))}();var s=n.fromFirst(this._first.space,o).setName("("+this.name+")U("+r.name+")");return t.options.verboseFirst&&console.log("Created unify name="+s.name+" tbl="+t.dispTbl(o)),s},or:function(e){return r(e,"other"),this._first&&e._first&&this._first.space&&this._first.space===e._first.space?this.unifyFirst(e):(t.options.verboseFirst&&console.log("Cannot unify"+this.name+" || "+e.name+" "+this._first+" - "+e._first),this.orNoUnify(e))},orNoUnify:function(e){var t=this,r=n.create(function(n){var r=t.parse(n);return r.success?r:e.parse(n)});return r.name="("+this.name+")|("+e.name+")",r},setName:function(e){return this.name=e,this._first,this},profile:function(e){return t.options.profile&&(this.parse=this.parse.profile(e||this.name)),this},repN:function(e){var t=this;return e||(e=0),n.create(function(n){for(var r=n,i=[];;){var o,s=t.parse(r);if(!s.success)return i.length>=e?((o=r.clone()).result=[i],o.success=!0,o):((o=n.clone()).success=!1,o);i.push(s.result[0]),r=s}}).setName("("+t.name+" * "+e+")")},rep0:function(){return this.repN(0)},rep1:function(){return this.repN(1)},opt:function(){var e=this;return n.create(function(t){var n=e.parse(t);return n.success?n:((t=t.clone()).success=!0,t.result=[null],t)}).setName("("+e.name+")?")},sep1:function(e,t){r(this,"value"),r(e,"sep");var n=e.and(this).ret(function(e,n){return t?n:{sep:e,value:n}});return this.and(n.rep0()).ret(function(e,n){var r;if(t){var i=[e];for(r in n)i.push(n[r]);return i}return{head:e,tails:n}}).setName("(sep1 "+this.name+"~~"+e.name+")")},sep0:function(e){return this.sep1(e,!0).opt().ret(function(e){return e||[]})},tap:function(e){return this},retN:function(e){return this.ret(function(){return arguments[e]})},parseStr:function(e,t){var n=new i(e,t);return this.parse(n)},checkTbl:function(){if(!this._first)return this;var e=this._first.tbl;for(var t in e)if(!e[t].parse)throw this.name+": tbl."+t+" is not a parser :"+e[t];return this}}),e(i.prototype,{clone:function(){var e=new i;return e.src=this.src,e.pos=this.pos,e.result=this.result.slice(),e.success=this.success,e},updateMaxPos:function(e){e>this.src.maxPos&&(this.src.maxPos=e)},isSuccess:function(){return this.success},getGlobal:function(){return this.src.global||(this.src.global={}),this.src.global}}),n.fromFirst=function(e,r){if("TOKEN"==e)return n.fromFirstTokens(r);var i=n.create(function(n){var i=e.parse(n),o=i.src.str.substring(i.pos,i.pos+1);return t.options.traceFirstTbl&&console.log(this.name+": first="+o+" tbl="+(r[o]?r[o].name:"-")),r[o]?r[o].parse(i):r.ALL?r.ALL.parse(i):(i.success=!1,i)});return i._first={space:e,tbl:r},i.checkTbl(),i},n.fromFirstTokens=function(e){var r=n.create(function(n){var r=n.src.tokens[n.pos],i=r?r.type:null;return t.options.traceFirstTbl&&console.log(this.name+": firstT="+i+" tbl="+(e[i]?e[i].name:"-")),null!=i&&e[i]?e[i].parse(n):e.ALL?e.ALL.parse(n):(n.success=!1,n)});return r._first={space:"TOKEN",tbl:e},r.checkTbl(),r};var o={empty:n.create(function(e){var t=e.clone();return t.success=!0,t.result=[null],t}).setName("E"),fail:n.create(function(e){return e.success=!1,e}).setName("F"),str:function(e){return this.strLike(function(t,n){return t.substring(n,n+e.length)===e?{len:e.length}:null}).setName(e)},reg:function(e){return(e+"").match(/^\/\^/)||console.log("Waring regex should have ^ at the head:"+e),this.strLike(function(t,n){var r=e.exec(t.substring(n));return r?(r.len=r[0].length,r):null}).setName(e+"")},strLike:function(r){return n.create(function(n){var i=n.src.str;if(null==i)throw"strLike: str is null!";var o=n.pos,s=r(i,o,n);if(t.options.traceToken&&console.log("pos="+o+" r="+s),s){t.options.traceToken&&console.log("str:succ"),s.pos=o,s.src=n.src;var a=n.clone();return e(a,{pos:o+s.len,success:!0,result:[s]}),n.updateMaxPos(a.pos),a}return t.options.traceToken&&console.log("str:fail"),n.success=!1,n}).setName("STRLIKE")},parse:function(e,t,n){var r=new i(t,n);return e.parse(r)}};o.eof=o.strLike(function(e,t){return t==e.length?{len:0}:null}).setName("EOF"),t.StringParser=o;var s={token:function(e){return n.create(function(t){var n=t.src.tokens[t.pos];return t.success=!1,n?(n.type==e&&((t=t.clone()).updateMaxPos(t.pos),t.pos++,t.success=!0,t.result=[n]),t):t}).setName(e).firstTokens(e)},parse:function(e,t,n){var r=new i(t,n);return e.parse(r)},eof:n.create(function(e){var t=e.pos>=e.src.tokens.length;return e.success=t,t&&((e=e.clone()).result=[{type:"EOF"}]),e}).setName("EOT")};return t.TokensParser=s,t.lazy=function(e){var t=null;return n.create(function(n){if(t||(t=e()),!t)throw e+" returned null!";return this.name=e.name,t.parse(n)}).setName("LZ")},t.addRange=function(e,t){if(null==t)return e;if("number"!=typeof e.pos)return e.pos=t.pos,e.len=t.len,e;var n=t.pos+t.len,r=e.pos+e.len;return t.pos<e.pos&&(e.pos=t.pos),n>r&&(e.len=n-e.pos),e},t.setRange=function(e){if(null!=e&&"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e){if(null!=t.getRange(e))return e;for(var n in e)if(e.hasOwnProperty(n)){var r=t.setRange(e[n]);t.addRange(e,r)}return e}},t.getRange=function(e){return null==e?null:"number"!=typeof e.pos?null:"number"==typeof e.len?e:null},t}()}),n("tonyu2_token",["require","exports","module","parser"],function(e,t,n){const r=e("parser");n.exports=function(){var e=r.StringParser,t="SAMENAME",n=e.reg(/^(\s*(\/\*\/?([^\/]|[^*]\/|\r|\n)*\*\/)*(\/\/.*\r?\n)*)*/).setName("space");function i(t,r){var i,o;"string"==typeof t?(i=e.str(t),t.length>0&&(o=t.substring(0,1)),r||(r=t)):(i=e.reg(t),r||(r=t+""));var s=n.and(i).ret(function(e,t){var n={};if(n.pos=t.pos,"number"!=typeof n.pos)throw"no pos for "+r+" ";if(n.len=t.len,n.text=t.src.str.substring(n.pos,n.pos+n.len),"string"!=typeof n.text)throw"no text("+n.text+") for "+r+" ";return n.toString=function(){return this.text},n.isToken=!0,n});return o&&(s=s.first(n,o)),s.setName(r)}var o={},s={};function a(e,t,n,r){"string"==typeof n&&(n=i(n)),o[e]=c(o[e],n.ret(function(e){return e.type=t,e}).setName(t))}function u(e,n,r,i){n==t&&(n=r);for(var o=1;o<=e;o*=2)0!=(e&o)&&a(e&o,n,r);s[n]=i}function c(e,t){return e?e.or(t):t}var l=r.create(function(e){for(var t=2,r=[];(e=o[t].parse(e)).success;){var i=e.result[0];t=s[i.type],r.push(i)}return(e=n.parse(e)).success=e.src.maxPos==e.src.str.length,e.result[0]=r,e}),f={function:!0,var:!0,return:!0,typeof:!0,if:!0,__typeof:!0,for:!0,else:!0,super:!0,while:!0,continue:!0,break:!0,do:!0,switch:!0,case:!0,default:!0,try:!0,catch:!0,finally:!0,throw:!0,of:!0,in:!0,fiber:!0,native:!0,instanceof:!0,new:!0,is:!0,true:!0,false:!0,null:!0,this:!0,undefined:!0,usethread:!0,constructor:!0,ifwait:!0,nowait:!0,_thread:!0,arguments:!0,delete:!0,extends:!0,includes:!0},p=i(/^[0-9][xb]?[0-9a-f\.]*/i).ret(function(e){return e.type="number",e.value=e.text-0,e}).first(n,"0123456789"),h=i({exec:function(e){var t=e.substring(0,1);if('"'!==t&&"'"!==t)return!1;for(var n=1;n<e.length;n++){var r=e.substring(n,n+1);if(r===t)return[e.substring(0,n+1)];"\\"===r&&n++}return!1},toString:function(){return"literal"}}).first(n,"\"'"),d=i({exec:function(e){if("/"!==e.substring(0,1))return!1;for(var t=1;t<e.length;t++){var n=e.substring(t,t+1);if("/"===n){var r=/^[ig]*/.exec(e.substring(t+1));return[e.substring(0,t+1+r[0].length)]}if("\n"==n)return!1;"\\"===n&&t++}return!1},toString:function(){return"regex"}}).first(n,"/");u(3,"number",p,1),u(2,"regex",d,1),u(3,"literal",h,1),u(3,t,"++",1),u(3,t,"--",1),u(3,t,"!==",2),u(3,t,"===",2),u(3,t,">>>",2),u(3,t,"+=",2),u(3,t,"-=",2),u(3,t,"*=",2),u(3,t,"/=",2),u(3,t,"%=",2),u(3,t,">=",2),u(3,t,"<=",2),u(3,t,"!=",2),u(3,t,"==",2),u(3,t,">>",2),u(3,t,"<<",2),u(3,t,"&&",2),u(3,t,"||",2),u(3,t,"(",2),u(3,t,")",1),u(3,t,"[",2),u(3,t,"]",1),u(3,t,"{",2),u(3,t,"}",1),u(3,t,">",2),u(3,t,"<",2),u(3,t,"^",2),u(3,t,"+",2),u(3,t,"-",2),u(3,t,".",2),u(3,t,"?",2),u(3,t,"=",2),u(3,t,"*",2),u(3,t,"%",2),u(1,t,"/",2),u(3,t,"^",2),u(3,t,"~",2),u(3,t,"\\",2),u(3,t,":",2),u(3,t,";",2),u(3,t,",",2),u(3,t,"!",2),u(3,t,"&",2),u(3,t,"|",2);var g=i(/^[a-zA-Z_$][a-zA-Z0-9_$]*/,"symresv_reg").ret(function(e){return e.type="constructor"==e.text?"tk_constructor":f.hasOwnProperty(e.text)?e.text:"symbol",e}).first(n);for(var m in f)s[m]=2;return s.tk_constructor=2,s.symbol=1,o[2]=c(o[2],g),o[1]=c(o[1],g),{parse:function(e){var t=r.StringParser.parse(l,e);return t.success||console.log("Stopped at "+e.substring(t.src.maxPos-5,t.src.maxPos+5)),t},extension:"js",reserved:f}}()}),n("IndentFixer",["require","exports","module"],function(e,t,n){n.exports=class{constructor(e){this.tokenizer=e}fix(e,t="    "){const n=[];let r;try{(r=this.tokenizer.parse(e)).forEach(e=>{n[e.row]=n[e.row]||"",this.tokenizer.isOpen(e)&&(n[e.row]+="{"),this.tokenizer.isClose(e)&&(n[e.row]+="}")})}catch(e){console.log("ERR",e)}const i=e.split("\n");let o=0,s=0;const a=[];i.forEach((e,t)=>{let r=0,i=0;e=e.replace(/^\s*/,""),null!=n[s]&&(n[s].match(/^(\}*)/),i=RegExp.$1.length,n[s].match(/(\{*)$/),r=RegExp.$1.length),o-=i,a[s]=o,o+=r,s++}),s=-1;const u=[];for(let e of r)e.row>s&&(u[s]=a[s],s=e.row);return i.map((e,n)=>(function(e,n){if("number"!=typeof n)return e;let r="";for(let e=0;e<n;e++)r+=t;return r+e.replace(/^\s*/,"")})(e,u[n])).join("\n")}}}),n("fixIndent",["require","exports","module","tonyu2_token","IndentFixer"],function(e,t,n){const r=e("tonyu2_token"),i=new(e("IndentFixer"))({parse(e){try{const t=r.parse(e).result[0],n=new class{constructor(e){this.str=e,this.row=0,this.col=0,this.lastPos=0}get(e){if(this.lastPos>e)throw new Error("tokens Must be ordered.");const t=this.str.substring(this.lastPos,e),n=t.split("\n"),r=n.pop();return 0===n.length?this.col+=r.length:(this.row+=n.length,this.col=r.length),this.lastPos=e,{row:this.row,col:this.col}}}(e);return t.map(e=>Object.assign(e,n.get(e.pos)))}catch(e){console.log(e)}},isOpen:e=>"{"===e.type,isClose:e=>"}"===e.type});n.exports=function(e,t){return i.fix(e,t)}}),n("HttpHelper",function(e){return function(){return e.HttpHelper}}(this)),Arrow={show:function(e){if("string"==typeof e&&(e=$(e)),0==e.length)return!1;if("t"!=$.data(e[0],"blinking")){$.data(e[0],"blinking","t");var t=3;n(),e.click(function(){i()})}function n(){e.addClass("tutorial-highlight"),setTimeout(r,200)}function r(){e.removeClass("tutorial-highlight"),t-- >0?setTimeout(n,200):i()}function i(){t=0,$.data(e[0],"blinking","f")}},showOld:function(e){if("string"==typeof e&&(e=$(e)),0==e.length)return!1;var t=e.offset(),n=$("<img>").attr({src:"images/arrow0.png"}).css({font:"40px",position:"absolute",left:t.left,top:t.top+e.height(),color:"red",zIndex:1e3,"z-index":1e3}).appendTo("body"),r=0;return setInterval(function(){n&&(n.attr({src:"images/arrow"+r+".png"}),r=(r+1)%4)},250),e.click(function(){n&&(n.remove(),n=null)}),!0}},n("Arrow",function(e){return function(){return e.Arrow}}(this)),n("Platform",[],function(){var e={},t=window.navigator.userAgent.toLowerCase();return e.tablet=-1!=t.indexOf("windows")&&-1!=t.indexOf("touch")||-1!=t.indexOf("ipad")||-1!=t.indexOf("android")&&-1==t.indexOf("mobile")||-1!=t.indexOf("firefox")&&-1!=t.indexOf("tablet")||-1!=t.indexOf("kindle")||-1!=t.indexOf("silk")||-1!=t.indexOf("playbook"),e.mobile=-1!=t.indexOf("windows")&&-1!=t.indexOf("phone")||-1!=t.indexOf("iphone")||-1!=t.indexOf("ipod")||-1!=t.indexOf("android")&&-1!=t.indexOf("mobile")||-1!=t.indexOf("firefox")&&-1!=t.indexOf("mobile")||-1!=t.indexOf("blackberry"),e}),n("WebSite",["FS","Platform"],function(e,n){var r,i,o=e.PathUtil,s=document.location.href,a=!!s.match(/html\/dev\//)&&!!s.match(/localhost:3/),u=location.protocol;switch(u.match(/^http/)||(u="https:"),window.WebSite_runType){case"IDE":return(r={urlAliases:{},top:".",tablet:n.tablet,mobile:n.mobile}).builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/inputPad.png":1,"images/neko.png":1,"images/mapchip.png":1},r.pluginTop||(r.pluginTop=r.top+"/js/plugins"),r.sampleImg=r.top+"/images",r.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),r.mp4Disabled=r.isNW,r.tonyuHome="/Tonyu/",r.PathSep="/",r.isNW?(r.noconcat=!0,r.PathSep=t("path").sep,r.cwd=o.directorify(process.cwd().replace(/\\/g,"/")),process.env.TONYU_HOME?r.tonyuHome=o.directorify(process.env.TONYU_HOME):r.tonyuHome=o.rel(r.cwd,"fs/Tonyu/"),r.logdir=process.env.TONYU_LOGDIR,r.wwwDir=o.rel(r.cwd,"www/"),r.platform=process.platform,r.ffmpeg=o.rel(r.cwd,"win32"==r.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),r.pkgInfo=t(o.rel(r.cwd,"package.json")),process.env.TONYU_PROJECTS?r.projects=process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(t("path").delimiter):r.pkgInfo&&r.pkgInfo.config&&r.pkgInfo.config.prjDirs?r.projects=r.pkgInfo.config.prjDirs.map(function(e){return e=o.directorify(e),o.isAbsolute(e)?e:o.rel(r.cwd,e)}):r.projects=[o.rel(r.cwd,"Projects/"),o.rel(r.tonyuHome,"Projects/")],r.kernelDir=o.rel(r.wwwDir,"Kernel/")):(s.match(/edit\.tonyu\.jp\/n\//)?r.wwwDir=u+"//"+location.host+"/n/":r.wwwDir=u+"//"+location.host+"/",r.projects=[o.rel(r.tonyuHome,"Projects/")]),r.kernelDir=o.rel(r.wwwDir,"Kernel/"),r.compiledKernel="Kernel/js/concat.js",s.match(/localhost\/tonyu2/)?(r.wwwDir=u+"//"+location.host+"/tonyu2/",r.kernelDir=r.wwwDir+"Kernel/",r.compiledKernel=r.kernelDir+"js/concat.js",r.uploadTmpUrl=u+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",r.newVersionUrl=u+"//localhost/tsite/tonyu/project/newVersion.cgi",r.scriptServer="https://localhost/tonyu2/"):(r.uploadTmpUrl=u+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",r.newVersionUrl=u+"//www.tonyu.jp/project/newVersion.cgi",r.scriptServer="https://edit.tonyu.jp/"),r.version=2,r.hoge="fuga",e.setEnvProvider(new e.Env(r)),window.WebSite=r,r;case"singleHTML":if(r={urlAliases:{},top:".",tablet:n.tablet,mobile:n.mobile},"object"==typeof BuiltinAssets)for(i in BuiltinAssets)r.urlAliases[i]=BuiltinAssets[i];return r.tonyuHome="/Tonyu/",r.projects=[o.rel(r.tonyuHome,"Projects/")],s.match(/localhost\/tonyu2/)?r.scriptServer="http://localhost/tonyu2/":r.scriptServer="https://edit.tonyu.jp/",r.pluginTop=r.scriptServer+"js/plugins",r.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),r.PathSep="/",r.compiledKernel=r.scriptServer+"Kernel/js/concat.js",e.setEnvProvider(new e.Env(r)),window.WebSite=r,r;case"multiHTML":return(r={urlAliases:{},top:".",tablet:n.tablet,mobile:n.mobile}).tonyuHome="/Tonyu/",r.pluginTop=r.top+"/js/plugins",r.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),r.PathSep="/",r.mp4Disabled=r.isNW,r.isNW&&(r.PathSep=t("path").sep,r.cwd=o.directorify(process.cwd().replace(/\\/g,"/")),r.platform=process.platform),e.setEnvProvider(new e.Env(r)),window.WebSite=r,r}if(s.match(/jsrun\.it/))r={urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png"},top:"",devMode:a,pluginTop:"https://edit.tonyu.jp/js/plugins",removeJSOutput:!0};else if(s.match(/tonyuexe\.appspot\.com/)||s.match(/localhost:8887/)||s.match(/\/html\/((dev)|(build))\//))r={urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/sound_ogg.png":"../../images/sound_ogg.png","images/sound_mp3.png":"../../images/sound_mp3.png","images/sound_mp4.png":"../../images/sound_mp4.png","images/sound_m4a.png":"../../images/sound_m4a.png","images/sound_mid.png":"../../images/sound_mid.png","images/sound_wav.png":"../../images/sound_wav.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:a};else if(s.match(/bitarrow/)||s.match(/localhost.*pub/)){var c=r={};r.serverType="BA",c.runtime="../../../runtime/",c.urlAliases={"images/base.png":c.runtime+"images/base.png","images/Sample.png":c.runtime+"images/Sample.png","images/neko.png":c.runtime+"images/neko.png","images/mapchip.png":c.runtime+"images/mapchip.png","images/sound.png":c.runtime+"images/sound.png","images/sound_ogg.png":c.runtime+"images/sound_ogg.png","images/sound_mp3.png":c.runtime+"images/sound_mp3.png","images/sound_mp4.png":c.runtime+"images/sound_mp4.png","images/sound_m4a.png":c.runtime+"images/sound_m4a.png","images/sound_mid.png":c.runtime+"images/sound_mid.png","images/sound_wav.png":c.runtime+"images/sound_wav.png","images/ecl.png":c.runtime+"images/ecl.png"}}else r={urlAliases:{},top:".",devMode:a};if("object"==typeof BuiltinAssets)for(i in BuiltinAssets)r.urlAliases[i]=BuiltinAssets[i];r.builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/neko.png":1,"images/mapchip.png":1};var l=window.navigator.userAgent.toLowerCase();return r.tablet=-1!=l.indexOf("windows")&&-1!=l.indexOf("touch")||-1!=l.indexOf("ipad")||-1!=l.indexOf("android")&&-1==l.indexOf("mobile")||-1!=l.indexOf("firefox")&&-1!=l.indexOf("tablet")||-1!=l.indexOf("kindle")||-1!=l.indexOf("silk")||-1!=l.indexOf("playbook"),r.mobile=-1!=l.indexOf("windows")&&-1!=l.indexOf("phone")||-1!=l.indexOf("iphone")||-1!=l.indexOf("ipod")||-1!=l.indexOf("android")&&-1!=l.indexOf("mobile")||-1!=l.indexOf("firefox")&&-1!=l.indexOf("mobile")||-1!=l.indexOf("blackberry"),r.pluginTop||(r.pluginTop=r.top+"/js/plugins"),r.disableROM={},(s.match(/\.appspot\.com/)||s.match(/localhost:888[87]/))&&(r.serverType="GAE"),s.match(/localhost:3000/)&&(r.serverType="Node"),s.match(/tonyuexe\.appspot\.com/)||s.match(/localhost:8887/)?r.serverTop=r.top+"/exe":r.serverTop=r.top+"/edit",r.sampleImg=r.top+"/images",r.blobPath=r.serverTop+"/serveBlob",r.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),r.mp4Disabled=r.isNW,r.tonyuHome="/Tonyu/",r.url={getDirInfo:r.serverTop+"/getDirInfo",getFiles:r.serverTop+"/File2LSSync",putFiles:r.serverTop+"/LS2FileSync"},r.PathSep="/",r.isNW?(r.PathSep=t("path").sep,r.cwd=o.directorify(process.cwd().replace(/\\/g,"/")),process.env.TONYU_HOME?r.tonyuHome=o.directorify(process.env.TONYU_HOME):r.tonyuHome=o.rel(r.cwd,"fs/Tonyu/"),r.logdir=process.env.TONYU_LOGDIR,r.wwwDir=o.rel(r.cwd,"www/"),r.platform=process.platform,r.ffmpeg=o.rel(r.cwd,"win32"==r.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),r.pkgInfo=t(o.rel(r.cwd,"package.json")),process.env.TONYU_PROJECTS?r.projects=process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(t("path").delimiter):r.pkgInfo&&r.pkgInfo.config&&r.pkgInfo.config.prjDirs?r.projects=r.pkgInfo.config.prjDirs.map(function(e){return e=o.directorify(e),o.isAbsolute(e)?e:o.rel(r.cwd,e)}):r.projects=[o.rel(r.cwd,"Projects/"),o.rel(r.tonyuHome,"Projects/")],r.kernelDir=o.rel(r.wwwDir,"Kernel/")):(r.wwwDir=u+"//"+location.host+"/",r.projects=[o.rel(r.tonyuHome,"Projects/")]),(s.match(/edit\.tonyu\.jp/)||s.match(/tonyuedit\.appspot\.com/)||s.match(/localhost:888/))&&(r.kernelDir=u+"//"+location.host+"/Kernel/"),s.match(/edit\.tonyu\.jp/)||s.match(/tonyuedit\.appspot\.com/)||s.match(/localhost:888/)||r.isNW?r.compiledKernel=r.kernelDir+"js/concat.js":"BA"===r.serverType?r.compiledKernel=r.runtime+"lib/tonyu/kernel.js":r.compiledKernel="https://edit.tonyu.jp/Kernel/js/concat.js",s.match(/localhost\/tonyu2/)?(r.wwwDir=u+"//"+location.host+"/tonyu2/",r.kernelDir=r.wwwDir+"Kernel/",r.compiledKernel=r.kernelDir+"js/concat.js",r.uploadTmpUrl=u+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",r.newVersionUrl=u+"//localhost/tsite/tonyu/project/newVersion.cgi"):(r.uploadTmpUrl=u+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",r.newVersionUrl=u+"//www.tonyu.jp/project/newVersion.cgi"),s.match(/((index)|(project))2/)&&(r.version=2,r.isNW?r.devMode=!0:r.devMode=!1),e.setEnvProvider(new e.Env(r)),window.WebSite=r,r}),n("assert",["FS"],function(e){return e.assert}),n("Shell",["FS","assert"],function(e,n){var r={},i=n(e.PathUtil);function o(t,n){var o=function(t){if("string"!=typeof t)return t;var n=r.cwd;return i.isAbsolutePath(t)?e.resolve(t,n):n.rel(t)}(t);if(e.SFile.is(o)||console.log(o," is not file"),n&&!o.exists())throw new Error(o+": no such file or directory");return o}return r.newCommand=function(e,t){this[e]=t},r.cd=function(e){return r.cwd=o(e,!0),r.pwd()},r.vars=Object.create(e.getEnv()),r.mount=function(t,n){if(t&&t.t)e.mount(n,t.t,t);else{var r=[];for(var i in e.getRootFS().availFSTypes())r.push(i);sh.err("-t=("+r.join("|")+") should be specified.")}},r.unmount=function(t){e.unmount(t)},r.fstab=function(){var t=this;e.getRootFS().fstab().forEach(function(e){t.echo(e.fstype()+"\t"+(e.mountPoint||"<Default>"))})},r.resolve=o,r.pwd=function(){return r.cwd+""},r.ls=function(e){return(e=e?o(e,!0):r.cwd).ls()},r.cp=function(e,t,n){n||(n={}),n.v&&(r.echo("cp",e,t),n.echo=r.echo.bind(r));var i=o(e,!0),s=o(t);return i.copyTo(s,n)},r.ln=function(e,t,n){var r=o(t),i=o(e,!0);if(r.isDir()&&r.exists()&&(r=r.rel(i.name())),r.exists())throw new Error(r+" exists");return r.link(i,n)},r.rm=function(e,t){if(t||(t={}),t.notrash)return(e=o(e,!1)).removeWithoutTrash(),1;if((e=o(e,!0)).isDir()&&t.r){var n=e,i=0;return n.each(function(e){e.exists()&&(i+=r.rm(e,t))}),n.rm(),i+1}return e.rm(),1},r.mkdir=function(e,t){if((e=o(e,!1)).exists())throw new Error(e+" : exists");return e.mkdir()},r.cat=function(e,t){return e=o(e,!0),r.echo(e.getContent(function(t){return e.isText()?t.toPlainText():t.toURL()}))},r.resolve=function(e){return e||(e="."),e=o(e)},r.grep=function(e,t,n){return t=o(t,!0),n||(n={}),n.res||(n.res=[]),t.isDir()?t.each(function(t){r.grep(e,t,n)}):"string"==typeof e&&t.lines().forEach(function(i,o){i.indexOf(e)>=0&&function(e,t,i){n.res&&n.res.push({file:e,lineNo:t,line:i});r.echo(e+"("+t+"): "+i)}(t,o+1,i)}),n.res},r.touch=function(e){return(e=o(e)).text(e.exists()?e.text():""),1},r.setout=function(e){r.outUI=e},r.echo=function(){return $.when.apply($,arguments).then(function(){console.log.apply(console,arguments),r.outUI&&r.outUI.log&&r.outUI.log.apply(r.outUI,arguments)})},r.err=function(e){console.log.apply(console,arguments),e&&e.stack&&console.log(e.stack),r.outUI&&r.outUI.err&&r.outUI.err.apply(r.outUI,arguments)},r.clone=function(){var e=Object.create(this);return e.vars=Object.create(this.vars),e},r.getvar=function(e){return this.vars[e]||process&&process.env[e]},r.get=r.getvar,r.set=function(e,t){return this.vars[e]=t},r.strcat=function(){if(1==arguments.length)return arguments[0];for(var e="",t=0;t<arguments.length;t++)e+=arguments[t];return e},r.exists=function(e){return(e=this.resolve(e)).exists()},r.dl=function(e){return(e=this.resolve(e||".")).download()},r.zip=function(){var t=this,n=Array.prototype.slice.call(arguments).map(function(e){return"string"==typeof e?t.resolve(e):e});return e.zip.zip.apply(e.zip,n)},r.unzip=function(){var t=this,n=Array.prototype.slice.call(arguments).map(function(e){return"string"==typeof e?t.resolve(e):e});return e.zip.unzip.apply(e.zip,n)},r.prompt=function(){},r.ASYNC={r:"SH_ASYNC"},r.help=function(){for(var e in r){var t=r[e];"function"==typeof t&&r.echo(e+(t.description?" - "+t.description:""))}},window.sh||(window.sh=r),"object"==typeof process?(sh.devtool=function(){t("nw.gui").Window.get().showDevTools()},sh.cd(process.cwd().replace(/\\/g,"/"))):sh.cd("/"),r}),n("Log",["FS","WebSite","Shell"],function(e,t,n){var r={},i=t.logdir?e.resolve("${logdir}"):null,o=i&&i.exists();function s(e,t){return(e="00000000000000"+e).substring(e.length-t)}if(r.todayDir=function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();return i.rel(t+"/").rel(n+"/").rel(r+"/")},r.curFile=function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate();return r.todayDir().rel(t+"-"+n+"-"+i+".log")},r.curProject=function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),i=e.getSeconds();return r.todayDir().rel("Project/").rel(s(t,2)+"_"+s(n,2)+"_"+s(i,2)+"/")},r.dumpProject=function(e){if(o){var t=r.curProject();n.cp(e,t),r.append("Dumped project to "+t.path())}},!t.logging&&!t.isNW){var a=e.get("/var/log/");a.exists()&&a.fs.storage===localStorage&&a.removeWithoutTrash({r:!0})}function u(e){return e.replace(/\n/g,"\n|")}return r.append=function(e){if(o){var t=r.curFile(),n=t.exists()?t.text():"";t.text(n+e+"\n")}},r.d=function(e,t){r.append(new Date+": ["+e+"]"+u(t))},r.e=function(e,t){r.append(new Date+": ERROR["+e+"]"+u(t))},r}),n("Wiki",["HttpHelper","Arrow","Util","WebSite","Log","UI","FS"],function(e,t,n,r,i,o,s){return Wiki=function(n,a,u,c){var l,f,p,h={},d={figures:"図",plists:"リスト"},g="line_marker_",m={},v=[];if(u||(u={}),a&&!a.isDir())throw a+": not a dir";return h.on=m,h.cd=function(e){f=(l=e).rel("toc.json")},a&&h.cd(a),h.encodeURL=function(e){return encodeURI(e).replace(/%/g,"")},h.parse=function(n,i,a){var c={},l=e({lineMark:g});c.out=l,c.name=i,c.lines=n.split(/\r?\n/),c.lineNo=0,c.ul=0,c.beginMark="[[",c.endMark="]]",c.blocks=[];var p=_("figures"),m=_("plists"),v=[];f&&f.exists()&&(v=f.obj());var y=v.indexOf(i);if(y>=0){var b="",w=v[y-1];w&&(b+="[[前へ>"+w+"]]");var x=v[y+1];x&&(b+=" - [[次へ>"+x+"]]");var S=v[0];0!=y&&(b+=" - [[目次>"+S+"]]"),c.lines.unshift(b),c.lines.push(b)}function _(e){c[e]={};var t=1;return function(n,r){var i=c[e][n];return i||(i={refs:[]},c[e][n]=i),r&&(i.no=t++,i.name=d[e]+i.no,i.refs.forEach(function(e){e.text(i.name)})),i}}return c.lines.forEach(function(e){function t(e){for(null==e&&(e=0);c.ul>e;)c.ul--,l.exit()}l.lineNo=c.lineNo;var n=0;e.match(/^-+/)&&(n=RegExp.lastMatch.length);if(n>c.ul)for(;n>c.ul;)c.ul++,l.enter("<ul>");else t(n);e=e.substring(n),n>0&&l.enter("<li>");if(e.match(/^\*+/)){var r=RegExp.rightContext,i="h"+RegExp.lastMatch.length;l.enter("<"+i+">"),E(r),l.exit()}else if(e.match(/^$/))t(),l.p($("<p>"));else if(e.match(/^<<toc(.*)/))c.toc=[c.name],c.blocks.push({name:"toc",exit:function(){f&&!f.isReadOnly()&&f.obj(c.toc),c.toc=null}});else if(e.match(/^<<code(.*)/)){var o=RegExp.$1;if((o=o.replace(/^ */,"")).length>0){var s,a,u=o.split(/ /,2);if(2==u.length){a=u[0],s=u[1];var p=m(s,!0);l.p($("<div>").addClass("plist").text(p.name+" "+a))}else l.p($("<div>").addClass("plist").text(u))}l.enter("<pre>"),c.blocks.push({name:"code",exit:function(){l.exit()}})}else if(e.match(/^>>/)){var h=c.blocks.pop();h&&h.exit&&h.exit(c)}else if(e.match(/^@@@@(.*)/)){if(c.pclose)l.exit();else{if(RegExp.$1.length>0){var p=m(RegExp.$1,!0);l.p($("<div>").addClass("plist").text(p.name))}l.enter("<pre>")}c.pclose=!c.pclose}else E(e),l.p("\n");n>0&&l.exit();c.lineNo++}),l.buf;function E(e){("string"==typeof e?function(e,t,n){var r=0;return function i(){var o=[];for(;;){var s=e.indexOf(t,r),a=e.indexOf(n,r);if(a>=0&&(s<0||s>a)){o.push(e.substring(r,a)),r=a;break}if(s<0){o.push(e.substring(r)),r=e.length;break}o.push(e.substring(r,s)),r=s+t.length;var u=i();u.hasBrace=!0,r<e.length&&(r+=n.length),o.push(u)}!function e(r){r.split=function(t,n){if(1==n)return this;var r=[],i=e([]);return this.forEach(function(o){if("string"==typeof o){var s=o.indexOf(t);if(r.length>=n&&(s=-1),s>=0){if(s>0){var a=o.substring(0,s);i.push(a)}if(s+=t.length,1!=i.length?r.push(i):r.push(i[0]),i=e([]),s<o.length){var a=o.substring(s);i.push(a)}}else i.push(o)}else i.push(o)}),1!=i.length?r.push(i):r.push(i[0]),r};r.text=function(e){var r=this.hasBrace&&e?t:"";return this.forEach(function(e){r+="string"==typeof e?e:e.text(!0)}),r+=this.hasBrace&&e?n:""};r.toString=function(){return this.text(!0)};return r}(o);return o}()}(e,c.beginMark,c.endMark):e).forEach(function(e){"string"==typeof e?l.p(e):function(e){var n,i=e.text();if(i.match(/^@blink ([^>]+)>([^\s]+)/)){caption=RegExp.$1;var f=RegExp.$2;n=$("<span>").addClass("clickable").text(caption).hover(function(){var e;parent&&parent.Arrow&&(e=parent.Arrow),t&&(e=t),e&&e.show(f)})}else if(i.match(/^@plistref (.*)/)){var g=RegExp.$1,v=m(g);n=$("<strong>").text(v.name),v.refs.push(n)}else if(i.match(/^@editadd/))l.p($("<img>").attr("src",r.top+"/images/editAdd.png"));else if(i.match(/^@figref (.*)/)){var v=p(RegExp.$1);n=$("<strong>").text(v.name),v.refs.push(n)}else if(i.match(/^@cfrag (.*)/)){var y=RegExp.$1;n=$("<code>"),l.enter(n),E(y),l.exit()}else if(i.match(/^@arg (.*)/)){var b=RegExp.$1;n=$("<i>"),l.enter(n),E(b),l.exit()}else{var w=e.split(">",2);if(2==w.length?(i=w[1]+"",caption=w[0]):caption=i,c.toc&&c.toc.push(i),i.match(/\.(png|jpg|gif)$/)&&!i.match(/^http/)){var v=p(i,!0);n=$("<div>").addClass("figure").append(function(e){var t,n;if(h.builtinImages[e])return $("<div>").append($("<img>").attr("src",r.top+"/doc/images/"+e));t=o("div",{style:"margin:10px; padding:10px; border:solid black 1px;",on:{dragover:a,dragenter:a,drop:function(e){if(!u.editMode)return;var r=e.originalEvent.dataTransfer.files[0];if(!r.type.match(/image\/(png|gif|jpg)/)[1])return e.stopPropagation(),e.preventDefault(),!1;var i=new FileReader;return i.onload=function(e){var r=i.result;n.text(r),t.empty().append(o("img",{src:r}))},i.readAsDataURL(r),e.stopPropagation(),e.preventDefault(),!1}}},"ここに画像ファイル(png/gif/jpg)をドラッグ＆ドロップして追加");var i=s.get(r.tonyuHome);return(n=i.rel("doc/images/").rel(e)).exists()&&t.empty().append(o("img",{src:n.text()})),t;function a(e){e.stopPropagation(),e.preventDefault()}}(i)),l.enter(n),l.enter($("<div>")),l.p(d.figures+v.no+"."),E(caption),l.exit(),l.exit()}else if(i.match(/^https?:\/\//))n=$("<a>").attr({href:i,target:"ext"}).text(caption);else{var x=h.resolveFile(i);if(x.exists()||!x.isReadOnly()&&u.editMode){if(u.useAnchor){var S=x.relPath(a.up()).replace(/\.txt$/,".html");S=h.encodeURL(S),n=$("<a>").attr({href:S}).text(caption)}else n=$("<span>").addClass("clickable").text(caption).click(function(){h.show(x)});x.exists()||n.addClass("notexist")}else n=$("<span>").text(caption)}}l.p(n)}(e)})}},h.resolveFile=function(e){return e.isDir?e:l&&"/"!=e.substring(0,1)?l.rel(e+".txt"):s.get(e)},h.show=function(e){var t=h.resolveFile(e);u.editMode||i.d("wiki","show "+t),h.cd(t.up());var r=t.truncExt(".txt");if(!t.exists()&&!t.isReadOnly()&&u.editMode){var o=v[v.length-1];o?t.text("[["+o.truncExt(".txt")+"]]\n"):t.text("")}if(t.exists()){var s=h.parse(t.text(),r,t);n.empty(),n.scrollTop(0),n.append(s),n.append($("<div>").css({height:"100px"}).text("")),m.show&&m.show.apply(h,[t,r]),v.push(t)}else alert(e+" というページはありません")},h.back=function(){var e=v.pop();e&&show(e)},h.highlightLine=function(e){var t=$("#"+g+"-"+e);if(0!=t.length){p&&p.removeClass("wiki-cur-line"),(p=t.next()).addClass("wiki-cur-line");var r=t.position().top,i=n;r<0&&i.scrollTop(i.scrollTop()+(r-10)/2);var o=i.height()-100;r>o&&i.scrollTop(i.scrollTop()+(r-o+10)/2)}},h.builtinImages={"50_100.png":1,"50_160.png":1,"50_300.png":1,"apple1apple2.png":1,"coords.png":1,"copy60_100.png":1,"firstRunRes.png":1,"firstVarRes.png":1,"itadaki.png":1,"noWaitCat.png":1,"runtimeError.png":1,"sample.png":1,"sayonara.png":1,"syntaxError.png":1},h}}),n("Shell2",["Shell","UI","FS","Util"],function(e,t,n,r){var i={show:function(e){i.embed(e).dialog({width:600,height:500})},embed:function(n){return i.d||(i.d=t("div",{title:"Shell"},["div",{$var:"inner"},"Type 'help' to show commands.",["br"]]),i.inner=i.d.$vars.inner,e.prompt()),i.d}};e.cls=function(){i.d.$vars.inner.empty()},e.prompt=function(){var n=t("div",["input",{$var:"cmd",size:40,on:{keydown:function(n){if(9==n.which)return n.stopPropagation(),n.preventDefault(),function(){var t=o.val().split(" "),n=t.pop(),i=[];if(0==t.length)for(var s in e)"function"==typeof e[s]&&r.startsWith(s,n)&&i.push(s);else{var u=e.resolve(n,!1);if(!u)return;var c=u.isDir()?u:u.up();c.each(function(e){r.startsWith(e.path(),u.path())&&i.push(e.name())})}if(1==i.length){var l=n.split("/");l.pop(),l.push(i[0]),t.push(l.join("/")),o.val(t.join(" ")),a.empty()}else a.text(i.join(", "))}(),!1;13==n.which&&(a.empty(),function(){var n=o.val().replace(/^ */,"").replace(/ *$/,"");if(0==n.length)return;var r=n.split(/ +/),i=r.shift(),a=e[i];if("function"!=typeof a)return s.append(i+": command not found.");try{var u=[],c=null;r.forEach(function(e){var t=/^-([A-Za-z_0-9]+)(=(.*))?/.exec(e);t?(c||(c={}),c[t[1]]=null!=t[3]?t[3]:1):(c&&u.push(c),c=null,u.push(e))}),c&&u.push(c);var l=a.apply(e,u);if(l===e.ASYNC)return;if("object"==typeof l)if(l instanceof Array){var f=t("table"),p=null,h=0;l.forEach(function(e){p||(p=t("tr").appendTo(f)),p.append(t("td",e)),++h%3==0&&(p=null)}),f.appendTo(s)}else s.append(JSON.stringify(l));else s.append(l);e.prompt()}catch(t){e.err(t),e.prompt()}}(o.val()))}}}],["pre",{$var:"out",class:"shell out"},["div",{$var:"cand",class:"shell cand"}]]),o=n.$vars.cmd,s=n.$vars.out,a=n.$vars.cand;return e.setout({log:function(){return $.when.apply($,arguments).then(function(){for(var e=[],n=0;n<arguments.length;n++)e.push(arguments[n]);e[0]instanceof $?s.append(e[0]):s.append(t("span",e.join(" ")+"\n"))})},err:function(e){s.append(t("div",{class:"shell error"},e,["br"],["pre",e.stack]))}}),n.appendTo(i.inner),o.focus(),i.inner.closest(".ui-dialog-content").scrollTop(i.inner.height()),e.ASYNC},e.window=function(){i.show(e.cwd)},e.atest=function(e,t,n){console.log(e,t,n)};var o=e.cat;return e.cat=function(n,r){return(n=e.resolve(n,!0)).contentType().match(/^image\//)?n.getContent(function(n){e.echo(t("img",{src:n.toURL()}))}):o.apply(e,arguments)},i}),n("Klass",["assert"],function(e){var t={};function n(e){var t=/function[^\(]*\(([^\)]*)\)/.exec(e+"");return t?t[1].replace(/\s/g,"").split(","):[]}function r(e){if("object"!=typeof e)return!1;if(!e)return!1;var t={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},n=0;for(var r in e){if(!t[r])return!1;n+=t[r]}return n}return t.define=function(i){var o,s,a,u;i.$parent?(s=i.$parent,(o=Object.create(s.prototype)).super=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return s.prototype[t].apply(this,e)}):o={},i.$this&&(a=i.$this),i.$singleton&&(u=i.$singleton);var c,l,f,p,h=v(i.$)||function(e){if(e&&"object"==typeof e)for(var t in e)this[t]=e[t]};function d(t){i.$fields&&e.is(t,i.$fields)}for(var g in h instanceof Array&&(c=h,h=function(){for(var e=Array.prototype.slice.call(arguments),t=0;t<c.length;t++)e.length>0&&(this[c[t]]=e.shift())}),p=function(){if(!(this instanceof p)){var e=Object.create(o);return h.apply(e,arguments),d(e),e}h.apply(this,arguments),d(this)},s&&(p.super=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift();return s.prototype[n].apply(t,e)}),p.inherit=function(e){return e.$parent=p,t.define(e)},p.prototype=o,i)"$"!=g[0]&&("static$"==g.substring(0,7)?p[g.substring(7)]=m(i[g]):r(i[g])?Object.defineProperty(o,g,v(i[g])):o[g]=v(i[g]));function m(e){return u?n(e)[0]!==u?e:function(){var t=Array.prototype.slice.call(arguments);return t.unshift(p),e.apply(p,t)}:e}function v(e){if(!a)return e;if(r(e)){for(var t in e)e[t]=v(e[t]);return e}if("function"!=typeof e)return e;if(!0!==a){if(n(e)[0]!==a)return f=!0,e;l=!0}return!0,function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),e.apply(this,t)}}if(o.$=h,Object.defineProperty(o,"$bind",{get:function(){return this.__bounded||(this.__bounded=new t.Binder(this)),this.__bounded}}),l){f?console.warn("Use python style in all methods and Use $this:true instead"):console.warn("Use $this:true instead");try{throw new Error("Trace")}catch(e){console.log(e.stack)}}return p},t.Function=function(){throw new Error("Abstract")},t.opt=e.opt,t.Binder=t.define({$this:!0,$:function(e,t){function n(n){"function"==typeof t[n]&&(e[n]=function(){var e=Array.prototype.slice.call(arguments);return t[n].apply(t,e)})}for(var r in t)n(r)}}),t}),n("GlobalDialog",["UI","Klass"],function(e,t){return GlobalDialog=t.define({$this:!0,$:["prj"],show:function(e,t){e.opt=e.prj.getOptions(),e.createDOM(),e.load(),e.dom.dialog({width:800,height:500})},load:function(e){e.opt.run||(e.opt.run={}),e.opt.run.globals||(e.opt.run.globals={});var t=e.opt.run.globals,n=[];for(var r in t)n.push({key:r,value:JSON.stringify(t[r])});e.editor.keyvalueeditor("reset",n)},createDOM:function(t){if(t.dom)return t.dom;t.dom=e("div",{title:"グローバル変数設定"},["ul",["li","実行時に，これらのグローバル変数が指定した値に初期化されます．"],["li","「値」欄には文字列またはJSON形式で記入してください．"]],["div",{$var:"editor",css:{height:"350px","overflow-y":"scroll"}}],["div",["button",{on:{click:t.$bind.save}},"保存"]]),t.vars=$.data(t.dom,"vars"),console.log(t.vars,t.dom.$vars),t.editor=t.vars.editor;return t.editor.keyvalueeditor("init",{placeHolderKey:"グローバル変数名",placeHolderValue:"値",toggleButton:null,deleteButton:'<img class="deleteButton" src="images/delete.png">'}),t.editor.on("change",".keyvalueeditor-key",function(){var e=this.value;e.match(/^[a-zA-Z0-9_$]+$/)?(e.match(/^\$/)||(this.value="$"+this.value),t.getValuesA()):alert("変数名には半角英数字を使ってください")}),t.editor.on("change",".keyvalueeditor-value",function(e){var n=this.value;try{var r=JSON.parse(n);this.value=JSON.stringify(r)}catch(t){var i=JSON.stringify(n);i==='"'+n+'"'?this.value=i:(alert('解釈できない値です．この値をそのまま文字列として登録したい場合，前後をダブルクォーテーションで囲ってください．\nダブルクォーテーション自身を文字列に含める場合は \\" と書いてください．\n\\自身を文字列に含める場合は \\\\ と書いてください．\n'),e.stopPropagation())}t.getValuesA()}),t.dom},save:function(e){var t=e.getValuesA();t&&(e.opt.run.globals=t,e.prj.setOptions(e.opt),e.dom.dialog("close"))},getValuesA:function(e){try{return e.getValues()}catch(e){console.error(e.stack),alert(e)}},getValues:function(e){var t={};return e.editor.keyvalueeditor("getValues").forEach(function(e){if(e.key in t)throw new Error("変数名'"+e.key+"'が重複しています．");if(!e.key.match(/^\$[a-zA-Z0-9_$]*$/))throw new Error("変数名'"+e.key+"'はグローバル変数名として使えません．");try{t[e.key]=JSON.parse(e.value)}catch(n){t[e.key]=e.value}}),t}}),GlobalDialog}),n("ProjectOptionsEditor",["UI","GlobalDialog"],function(e,t){return function(n){var r=n.getOptions();n.odiag||(n.odiag=e("div",{title:"プロジェクト オプション"},["h5","コンパイラ"],["div",["input",{type:"checkbox",$edit:"compiler.diagnose"}],"診断モード(速度が落ちますが，プログラムの不具合を見つけやすくします)"],["div",["input",{type:"checkbox",$edit:"compiler.noLoopCheck"}],"無限ループチェックをしない（チェックすると速度が速くなることがあります）"],["div",["input",{type:"checkbox",$edit:"compiler.field_strict"}],"フィールド宣言を明示的に行う(var n; のような宣言が必要になります)"],["div","デフォルトの親クラス",["input",{$edit:"compiler.defaultSuperClass"}]],["h5","実行"],["div","Main クラス",["input",{$edit:"run.mainClass"}]],["div","Boot クラス",["input",{$edit:"run.bootClass"}]],["div","グローバル変数",["button",{on:{click:function(){i.show()}}},"編集..."]],["h5","開発"],["div",["input",{type:"checkbox",$edit:"kernelEditable"}],"Kernelの開発を行う"],["div",{$var:"validationMessage",css:{color:"red"}}]));var i=new t(n);n.odiag.$edits.load(r),n.odiag.dialog({width:600,buttons:{OK:function(){n.odiag.dialog("close"),n.setOptions(),n.requestRebuild()}}})}}),e(["Shell","FS","WebSite"],function(e,t,n){e.copyToKernel=function(r){var i=t.get(n.tonyuHome).rel("Kernel/");if(r)return e.cp(r,i.rel(r));var o=0;return i.each(function(t){var n=e.cwd.rel(t.name());n.exists()&&(o+=e.cp(n,i))}),o}}),n("copyToKernel",function(){}),n("KeyEventChecker",[],function(){var e={down:function(t,n,r){t instanceof $||(t=$(t)),t.bind("keydown",function(i){if(e.is(i,n))return r.call(t[0],i)})},is:function(e,t){t=t.toLowerCase();var n="";return(e=e.originalEvent||e).altKey&&(n+="alt+"),e.ctrlKey&&(n+="ctrl+"),e.shiftKey&&(n+="shift+"),e.keyCode>=112&&e.keyCode<=123?n+="f"+(e.keyCode-111):n+=String.fromCharCode(e.keyCode),t==(n=n.toLowerCase())}};return e}),n("IFrameDialog",[],function(){var e={create:function(e,t){(t=t||{title:"help",topPage:"index"}).height||(t.height=.7*$(window).height()),t.width||(t.width=500);var n=$("<iframe>").attr({class:"wikiDialog",frameBorder:0,src:e}),r=$("<div>").attr({class:"wikiDialog",title:t.title}).append(n);return{show:function(){r.dialog({width:t.width,height:t.height,resize:function(e,t){}})}}}};return e}),n("PatternParser",["Tonyu"],function(e){var t=function(e,t){this.options=t||{},this.img=e,this.height=e.height,this.width=e.width;var n=this.newImage(e.width,e.height).getContext("2d");n.drawImage(e,0,0),this.ctx=n,this.pixels=this.ctx.getImageData(0,0,e.width,e.height).data,this.base=this.getPixel(0,0)};return e.extend(t.prototype,{newImage:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},getPixel:function(e,t){var n=this.pixels,r=4*(e+t*this.width),i=n[0+r],o=n[1+r],s=n[2+r];return 256*(256*(256*n[3+r]+s)+o)+i},setPixel:function(e,t,n){var r=4*(e+t*this.width);this.pixels[0+r]=255&n,n=(n-(255&n))/256,this.pixels[1+r]=255&n,n=(n-(255&n))/256,this.pixels[2+r]=255&n,n=(n-(255&n))/256,this.pixels[3+r]=255&n},parse:function(){try{for(var e=[],t=0;t<this.height;t++)for(var n=0;n<this.width;n++){this.getPixel(n,t)!=this.base&&e.push(this.parse1Pattern(n,t))}return e}catch(e){if(e.isParseError)return console.log("parse error! "+e),[{image:this.img,x:0,y:0,width:this.width,height:this.height}];throw e}},parse1Pattern:function(e,t){function n(e){return e}for(var r=this.getPixel(e,t),i=e,o=t,s=this.base,a=this.width,u=this.height;i<a;){if(this.getPixel(i,o)!=r)break;i++}if(i>=a||this.getPixel(i,o)!=s)throw _(i,o,n(this.getPixel(i,o))+"!="+n(s));for(i--;o<u&&this.getPixel(i,o)==r;)o++;if(o>=u||this.getPixel(i,o)!=s)throw _(i,o,n(this.getPixel(i,o))+"!="+n(s));var c=e+1,l=t+1,f=i-c,p=--o-l;if(f*p==0)throw _(i,o,"w*h==0");for(var h=this.newImage(f,p),d=h.getContext("2d"),g=d.getImageData(0,0,f,p),m=g.data,v=0,y=l;y<o;y++)for(var b=c;b<i;b++){var w=this.getPixel(b,y);w==r?(m[v++]=0,m[v++]=0,m[v++]=0,m[v++]=0):(m[v++]=255&w,w=(w-(255&w))/256,m[v++]=255&w,w=(w-(255&w))/256,m[v++]=255&w,w=(w-(255&w))/256,m[v++]=255&w)}d.putImageData(g,0,0);for(var x=l-1;x<=o;x++)for(var S=c-1;S<=i;S++)this.setPixel(S,x,s);return this.options.boundsInSrc?{x:c,y:l,width:f,height:p}:{image:h,x:0,y:0,width:f,height:p};function _(e,t,n){return{toString:function(){return"at ("+e+","+t+") :"+n},isParseError:!0}}}}),t}),n("Assets",["WebSite","Util","Tonyu","FS"],function(e,t,n,r){var i={resolve:function(n,i,o){o=o||{};var s=r.isFile(i)?i:i.getDir();if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,n){return e[n]}),e.urlAliases[n]&&(n=e.urlAliases[n]),t.startsWith(n,"ls:")){var a=n.substring("ls:".length);if(!s)throw new Error("Basedir not specified");var u=s.rel(a);if(!u.exists())throw new Error("Resource file not found: "+u);if(e.mp3Disabled&&a.match(/\.(mp3)$/)||e.mp4Disabled&&a.match(/\.(mp4|m4a)$/)){var c=s.rel(a.replace(/\.(mp3|mp4|m4a)$/,".ogg"));c.exists()&&(u=c)}if(n=u.getURL(),o.asFile)return u}return n}};return n.Assets=i,i}),n("ImageList",["PatternParser","Util","Assets","assert"],function(e,t,n,r){var i,o={};return(i=function(t,i,s){s||(s={});var a=[],u=(t=function(e){var t=[];return e.forEach(function(e,n){e&&""!=e.url&&t.push(e)}),t}(t)).length;0==u&&setTimeout(function(){var e=[];e.names={},i(e)},0),t.forEach(function(t,c){console.log("loading",t,c);var l=t.url,f=l;if(o[f])h.apply(o[f],[]);else{l=n.resolve(l,s.prj||s.baseDir);var p=$("<img>");p.load(function(){o[f]=this,h.apply(this,[])}),p.attr("src",l)}function h(){var n,o;if("single"==t.type)a[c]=[{image:this,x:0,y:0,width:this.width,height:this.height}];else if((n=t.pwidth)&&(o=t.pheight)){for(var s=0,l=0,f=this.width,p=this.height,h=[];;){var d=n,g=o;if(s+n>f&&(d=f-s),l+o>p&&(g=p-l),h.push({image:this,x:s,y:l,width:d,height:g}),(s+=n)+n>f&&(s=0,(l+=o)+o>p))break}a[c]=h}else{var m=new e(this);a[c]=m.parse()}if(a[c].name=t.name,r.is(a[c],Array),0==--u){var v=[],y={};a.forEach(function(e){y[e.name]=v.length,v=v.concat(e)}),v.names=y,i(v)}}})}).load=i,i.parse1=function(t,n,i){var o,s,a;if((o=t.pwidth)&&(s=t.pheight)){for(var u=0,c=0,l=n.width,f=n.height,p=[];p.push({image:this,x:u,y:c,width:o,height:s}),!((u+=o)+o>l&&(u=0,(c+=s)+s>f)););a=p}else{a=new e(n,i).parse()}return a.name=t.name,r.is(a,Array)},window.ImageList=i,i});var r=function(){var e=function(e){this.context=null,this.picoAudio=null,this.soundDataAry=[],this.bgmPlayerMax=16,this.bgmPlayerAry=[],this.masterVolume=1,this.seMasterVolume=1,this.bgmMasterVolume=1,this.playingAudio=null,this.audioVolume=1,this.audioTempo=1,this.audioDataAry={data:[]},this.seSources=[],this.init(e)};return e.prototype.init=function(e){if(!this.inited&&(this.inited=!0,!this.disabled&&(e?this.context=e:window.AudioContext?this.context=new AudioContext:window.webkitAudioContext?this.context=new webkitAudioContext:(this.context=null,console.log("Your browser does not support yet Web Audio API")),this.context)))for(var t=0;t<this.bgmPlayerMax;t++)this.bgmPlayerAry[t]=new i(this,t)},e.prototype.allClearSoundData=function(){var e=this.soundDataAry;for(var t in e)delete e[t]},e.prototype.clearSoundData=function(e){delete this.soundDataAry[e]},e.prototype.allRemoveDecodedSoundData=function(){var e=this.soundDataAry;for(var t in e){var n=e[t];null!=n&&((n.isDecodeComplete()||n.isDecoding())&&n.removeDecodedData())}},e.prototype.removeDecodedSoundData=function(e){var t=this.soundDataAry[e];null!=t&&(t.isDecodeComplete()||t.isDecoding())&&t.removeDecodedData()},e.prototype.getMasterVolume=function(){return this.masterVolume},e.prototype.setMasterVolume=function(e){this.masterVolume=e;for(var t=0;t<this.bgmPlayerMax;t++){var n=this.bgmPlayerAry[t];n instanceof i&&n.onChangeBGMMasterVolume()}},e.prototype.createSoundFromArray=function(e,t,n){if(!this.context||this.disabled)return null;this.soundDataAry[e]=new o(e);var r,i=this.context,s=null!=t&&null!=n?2:1,a=i.createBuffer(s,t.length,i.sampleRate),u=a.getChannelData(0),c=null!=n?a.getChannelData(1):null;for(r=0;r<t.length;r++)u[r]=t[r];if(c)for(r=0;r<n.length;r++)c[r]=n[r];this.soundDataAry[e].onDecodeComplete(a)},e.prototype.loadSound=function(e,t,n,r){if(!this.context||this.disabled)return null;this.soundDataAry[e]=new o(e),(t.match(/\.(midi?)$/)||t.match(/^data:audio\/mid/))&&null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context)),"object"==typeof WebSite&&WebSite.mp3Disabled&&(t=t.replace(/\.(mp3)$/,".ogg")),"object"==typeof WebSite&&WebSite.mp4Disabled&&(t=t.replace(/\.(mp4|m4a)$/,".ogg"));var i=this,s=new XMLHttpRequest;if(s.onload=function(){if(200===s.status||0===s.status){var t=s.response;t instanceof ArrayBuffer?(i.soundDataAry[e].onLoadComplete(t),r?i.decodeSound(e,n):n&&n.succ&&n.succ(e)):(i.soundDataAry[e].onError("XHR_RESPONSE_ERROR"),n&&n.err&&n.err(e,i.soundDataAry[e].errorID))}else i.soundDataAry[e].onError("XHR_STATUS_ERROR"),n&&n.err&&n.err(e,i.soundDataAry[e].errorID)},s.onerror=function(t){console.log(t+""),i.soundDataAry[e].onError("XHR_ERROR"),n&&n.err&&n.err(e,i.soundDataAry[e].errorID)},this.soundDataAry[e].onLoad(t),t.match(/^data:/)&&"undefined"!=typeof Util&&Util.Base64_To_ArrayBuffer)(s={onload:s.onload}).response=Util.Base64_To_ArrayBuffer(t.replace(/^data:audio\/[a-zA-Z0-9\-]+;base64,/i,"")),s.status=200,s.onload();else{s.open("GET",t,!0),s.responseType="arraybuffer";try{s.send(null)}catch(t){this.soundDataAry[e].onError("FILE_NOT_FOUND"),n&&n.err&&n.err(e,i.soundDataAry[e].errorID)}}},e.prototype.decodeSound=function(e,t){var n=this.soundDataAry[e];if(null!=n&&null!=n.fileData&&n.isLoadComplete()&&!n.isDecodeComplete()){if(null==n.decodedCallbacksAry&&(n.decodedCallbacksAry=[]),t)if(null!=t.bgmPlayerId)n.decodedCallbacksAry.some(function(e,r){return t.bgmPlayerId==e.bgmPlayerId&&(n.decodedCallbacksAry[r]=t,!0)})||n.decodedCallbacksAry.push(t);else n.decodedCallbacksAry.push(t);if(!n.isDecoding()){n.onDecode();var r=n.fileData.slice(0),i=this;if(n.url.match(/\.(midi?)$/)||n.url.match(/^data:audio\/mid/)){null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context));var o=new Uint8Array(r),s=this.picoAudio.parseSMF(o);"string"==typeof s?(console.log("T2MediaLib: Error parseSMF()",s),this.soundDataAry[e].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(t){"function"==typeof t.err&&t.err(e,this.soundDataAry[e].errorID)}),n.decodedCallbacksAry=null):(this.soundDataAry[e].onDecodeComplete(s),n.decodedCallbacksAry.forEach(function(t){"function"==typeof t.succ&&t.succ(e)}),n.decodedCallbacksAry=null)}else if(n.url.match(/\.mzo$/)||n.url.match(/^data:audio\/mzo/))Mezonet.init().then(function(){var t=Array.prototype.slice.call(new Uint8Array(r));i.soundDataAry[e].onDecodeComplete(new Mezonet.Source(t)),n.decodedCallbacksAry.forEach(function(t){"function"==typeof t.succ&&t.succ(e)}),n.decodedCallbacksAry=null},function(t){t instanceof Error?console.log("T2MediaLib: "+t.message,n.url):console.log("T2MediaLib: Error decodeMZO()",n.url),i.soundDataAry[e].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(t){"function"==typeof t.err&&t.err(e,i.soundDataAry[e].errorID)}),n.decodedCallbacksAry=null});else{if(n.url.match(/\.(ogg?)$/)||n.url.match(/^data:audio\/ogg/)){var a=this.searchOggLoop(r);n.tagLoopStart=a[0],n.tagLoopEnd=a[1]}this.context.decodeAudioData(r,function(t){i.soundDataAry[e].isDecoding()&&(i.soundDataAry[e].onDecodeComplete(t),n.decodedCallbacksAry.forEach(function(t){"function"==typeof t.succ&&t.succ(e)}),n.decodedCallbacksAry=null)},function(t){t instanceof Error?console.log("T2MediaLib: "+t.message,n.url):console.log("T2MediaLib: Error decodeAudioData()",n.url),i.soundDataAry[e].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(t){"function"==typeof t.err&&t.err(e,i.soundDataAry[e].errorID)}),n.decodedCallbacksAry=null})}}}},e.prototype.activate=function(){if(this.init(),this.context){if(!this.isContextResumed&&this.context.resume){var e=this;this.context.resume().then(function(){e.isContextResumed=!0})}if(!this.isActivated){this.isActivated=!0;for(var t=this.context.createBuffer(1,Math.floor(this.context.sampleRate/32),this.context.sampleRate),n=t.getChannelData(0),r=0;r<n.length;r++)n[r]=0;var i=this.context.createBufferSource();i.buffer=t,i.connect(this.context.destination),i.start=i.start||i.noteOn,i.start(0)}}},e.prototype.getSoundFileData=function(e){var t=this.soundDataAry[e];return t?t.fileData:null},e.prototype.getSoundDecodedData=function(e){var t=this.soundDataAry[e];return t?t.decodedData:null},e.prototype.getCurrentTime=function(){return this.context?this.context.currentTime:null},e.prototype.playSE=function(e,t,n,r,i,o,s,a,u,c){if(!this.context)return null;var l,f=this.soundDataAry[e];if(null==f)return null;if(!f.isDecodeComplete()){var p=this,h={succ:function(e){p.playSE(e,t,n,r,i,o,s,a,u,c)},err:function(){}};return this.decodeSound(e,h),null}if(l=f.decodedData,"undefined"!=typeof Mezonet&&l instanceof Mezonet.Source){var d=f.decodedData.playback(this.context);return d.Start(),d}var g=f.decodedData;if(!(g instanceof AudioBuffer))return null;null==t&&(t=1),null==n&&(n=0),r||(r=1),i?i>g.duration?i=g.duration:i<0&&(i=0):i=0;var m=c;c||(m=86400),o||(o=!1),s?s<0?s=0:s>g.duration&&(s=g.duration):s=f.loopStart||0,a?a<0?a=0:a>g.duration&&(a=g.duration):a=g.duration,u=u||0;var v=this.context.createBufferSource();this.context.createGain=this.context.createGain||this.context.createGainNode;var y=this.context.createGain(),b=this.context.createPanner();v.buffer=g,v.loop=o,v.loopStart=s,v.loopEnd=a,v.playbackRate.value=r,v.connect(y),y.connect(b),b.connect(this.context.destination),b.panningModel="equalpower",n<-1?n=-1:n>1&&(n=1);var w,x=90*n,S=Math.sin(x*(Math.PI/180)),_=-Math.cos(x*(Math.PI/180));-1!==n&&1!==n||(_=0),b.positionX?(b.positionX.value=S,b.positionY.value=0,b.positionZ.value=_):b.setPosition(S,0,_),y.gain.value=t*this.seMasterVolume*this.masterVolume,w=o&&a-s>0&&i>a?a:i,v.gainNode=y,v.volumeValue=t,v.panNode=b,v.panValue=n,v.playStartTime=this.context.currentTime+u,v.playOffset=w,v.plusTime=w,v.start=v.start||v.noteOn,v.stop=v.stop||v.noteOff,v.start(u,i,m),o&&null!=c&&v.stop(u+c);var E=this;return E.seSources.push(v),v.onended=function(e){v.onended=null;var t=E.seSources.indexOf(v);t>=0&&E.seSources.splice(t,1)},v},e.prototype.stopSE=function(e){if(!(e instanceof AudioBufferSourceNode))return null;try{e.stop(0)}catch(t){e.gainNode&&(e.gainNode.gain.cancelScheduledValues(this.context.currentTime),e.gainNode.gain.linearRampToValueAtTime(0,this.context.currentTime))}return e},e.prototype.stopAllSE=function(e){var t=this;this.seSources.forEach(function(e){t.stopSE(e)})},e.prototype.getSEMasterVolume=function(){return this.seMasterVolume},e.prototype.setSEMasterVolume=function(e){this.seMasterVolume=e},e.prototype.getSEVolume=function(e){return e instanceof AudioBufferSourceNode?e.volumeValue:null},e.prototype.setSEVolume=function(e,t){return e instanceof AudioBufferSourceNode?(e.gainNode.gain.value=t*this.seMasterVolume*this.masterVolume,e.volumeValue=t,e):null},e.prototype.getSERate=function(e){return e instanceof AudioBufferSourceNode?e.playbackRate.value:null},e.prototype.setSERate=function(e,t){if(!(e instanceof AudioBufferSourceNode))return null;e.playbackRate.value=t},e.prototype.getSEPan=function(e){return e instanceof AudioBufferSourceNode?e.panValue:null},e.prototype.setSEPan=function(e,t){if(!(e instanceof AudioBufferSourceNode))return null;var n=e.panNode;t<-1?t=-1:t>1&&(t=1);var r=90*t,i=Math.sin(r*(Math.PI/180)),o=Math.cos(r*(Math.PI/180));-1!==t&&1!==t||(o=0),n.positionX?(n.positionX.value=i,n.positionY.value=0,n.positionZ.value=o):n.setPosition(i,0,o),e.panValue=t},e.prototype.isSELoop=function(e){return e instanceof AudioBufferSourceNode?e.loop:null},e.prototype.setSELoop=function(e,t){if(!(e instanceof AudioBufferSourceNode))return null;e.loop=t},e.prototype.getSELoopStartTime=function(e){return e instanceof AudioBufferSourceNode?e.loopStart:null},e.prototype.setSELoopStartTime=function(e,t){if(!(e instanceof AudioBufferSourceNode))return null;e.loopStart=t},e.prototype.getSELoopEndTime=function(e){return e instanceof AudioBufferSourceNode?e.loopEnd:null},e.prototype.setSELoopEndTime=function(e,t){if(!(e instanceof AudioBufferSourceNode))return null;e.loopEnd=t},e.prototype.playBGM=function(e,t,n,r,i,o){if(!this.context)return null;var s=this._getBgmPlayer(e);return s?s.playBGM(t,n,r,i,o):null},e.prototype.stopBGM=function(e){var t=this._getBgmPlayer(e);return t?t.stopBGM():null},e.prototype.pauseBGM=function(e){var t=this._getBgmPlayer(e);return t?t.pauseBGM():null},e.prototype.resumeBGM=function(e){var t=this._getBgmPlayer(e);return t?t.resumeBGM():null},e.prototype.getBGMMasterVolume=function(){return this.bgmMasterVolume},e.prototype.setBGMMasterVolume=function(e){this.bgmMasterVolume=e;for(var t=0;t<this.bgmPlayerMax;t++){var n=this.bgmPlayerAry[t];n instanceof i&&n.onChangeBGMMasterVolume()}},e.prototype.getBGMVolume=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMVolume():null},e.prototype.setBGMVolume=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMVolume(t):null},e.prototype.getBGMTempo=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMTempo():null},e.prototype.setBGMTempo=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMTempo(t):null},e.prototype.getBGMPan=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMPan():null},e.prototype.setBGMPan=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMPan(t):null},e.prototype.isBGMLoop=function(e){var t=this._getBgmPlayer(e);return t?t.isBGMLoop():null},e.prototype.setBGMLoop=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMLoop(t):null},e.prototype.getBGMLoopStartTime=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMLoopStartTime():null},e.prototype.setBGMLoopStartTime=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMLoopStartTime(t):null},e.prototype.getBGMLoopEndTime=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMLoopEndTime():null},e.prototype.setBGMLoopEndTime=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMLoopEndTime(t):null},e.prototype.getBGMCurrentTime=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMCurrentTime():null},e.prototype.getBGMLength=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMLength():null},e.prototype.getPlayingBGMName=function(e){var t=this._getBgmPlayer(e);return t?t.getPlayingBGMName():null},e.prototype.setOnBGMEndListener=function(e,t){var n=this._getBgmPlayer(e);return n?n.setOnBGMEndListener(t):null},e.prototype.getPlayingBGMState=function(e){var t=this._getBgmPlayer(e);return t?t.getPlayingBGMState():null},e.prototype.getBGMPicoAudio=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMPicoAudio():null},e.prototype.isTagLoop=function(e){var t=this._getBgmPlayer(e);return t?t.isTagLoop():null},e.prototype.setTagLoop=function(e,t){var n=this._getBgmPlayer(e);return n?n.setTagLoop(t):null},e.prototype.getBGMPlayerMax=function(){return this.bgmPlayerMax},e.prototype.allStopBGM=function(){for(var e=0;e<this.bgmPlayerMax;e++)this.stopBGM(e)},e.prototype.allResetBGM=function(){for(var e=0;e<this.bgmPlayerMax;e++)this.stopBGM(e),this.setBGMVolume(e,1),this.setBGMTempo(e,1),this.setBGMPan(e,0);this.setMasterVolume(1),this.setSEMasterVolume(1),this.setBGMMasterVolume(1)},e.prototype._getBgmPlayer=function(e){if(e<0||this.bgmPlayerMax<=e)return null;var t=this.bgmPlayerAry[e];return t instanceof i?t:null},e.prototype.loadAudio=function(e,t){var n=new Audio(t);n.play(),this.audioDataAry.data[e]=null;var r=this;n.addEventListener("loadstart",function(){if(!r.context)return null;r.context.createMediaElementSource(n).connect(r.context.destination)},!1),n.addEventListener("canplay",function(){this.audioDataAry.data[e]=n},!1),n.load()},e.prototype.playAudio=function(e,t,n){var r=this.audioDataAry.data[e];return r?(n||(n=0),this.playingAudio instanceof Audio&&(this.playingAudio.pause(),this.playingAudio.currentTime=0),this.playingAudio=r,r.loop=t,r.volume=this.audioVolume,r.currentTime=n,r.play(),r):null},e.prototype.stopAudio=function(){var e=this.playingAudio;return e instanceof Audio?(e.pause(),e.currentTime=0,this.playingAudio=null,e):null},e.prototype.pauseAudio=function(){var e=this.playingAudio;return e?(e.pause(),e):null},e.prototype.resumeAudio=function(){var e=this.playingAudio;return e?(e.play(),e):null},e.prototype.setAudioVolume=function(e){this.audioVolume=e,this.playingAudio instanceof Audio&&(this.playingAudio.volume=e)},e.prototype.setAudioTempo=function(e){this.audioTempo=e,this.playingAudio instanceof Audio&&(this.playingAudio.playbackRate=e)},e.prototype.setAudioPosition=function(e){this.playingAudio instanceof Audio&&(this.playingAudio.currentTime=e)},e.prototype.getAudioData=function(e){return this.audioDataAry.data[e]},e.prototype.getAudioCurrentTime=function(){return this.playingAudio instanceof Audio?this.playingAudio.currentTime:null},e.prototype.getAudioLength=function(){return this.playingAudio instanceof Audio?this.playingAudio.duration:null},e.prototype.searchOggLoop=function(e){var t=new Uint8Array(e.slice(0,3e3)),n=String.fromCharCode.apply(null,t);if(-1==n.lastIndexOf("vorbis",34))return[0,0];var r,i,o,s=n.indexOf("LOOPSTART="),a=n.indexOf("LOOPLENGTH="),u=0,c=0,l=t[40]+(t[41]<<8)+(t[42]<<16)+(t[43]<<24);if(-1!=s)for(r=t[s]+(t[s+1]<<8)+(t[s+2]<<16)+(t[s+3]<<24),i=s+10;i<s+r&&!((o=n[i])<"0"||o>"9");i++)u=10*u+(o-"0");if(-1!=a)for(r=t[a]+(t[a+1]<<8)+(t[a+2]<<16)+(t[a+3]<<24),i=a+11;i<a+r&&!((o=n[i])<"0"||o>"9");i++)c=10*c+(o-"0");var f=(u+c)/l;return[u/=l,f]},e}(),i=function(){function e(e){return"undefined"!=typeof PicoAudio&&e instanceof PicoAudio}function t(e){return"undefined"!=typeof Mezonet&&e instanceof Mezonet.Playback}var n=function(e,t){this.t2MediaLib=e,this.id=t,this.playingBGMState="stop",this.playingBGMStatePending=null,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1,this.bgmPan=0,this.picoAudio=null,this.picoAudioSetDataBGMName=null,this.PICO_AUDIO_VOLUME_COEF=1,this.isTagLoop=!0};return n.prototype.playBGM=function(e,t,n,r,i){this.stopBGM();var o=this.t2MediaLib.soundDataAry[e];if(null==o)return null;if(!o.isDecodeComplete()){var s=this,a={};return a.bgmPlayerId=this.id,a.succ=function(){var a=function(){var o=s.playingBGMStatePending;s._setPlayingBGMState("stop",!0),"stop"!=o&&s.playingBGMName==e&&s.playBGM(e,t,n,r,i),"pause"==o&&s.pauseBGM()};o.decodedData instanceof Object?setTimeout(function(){a()},0):a()},a.err=function(){s._setPlayingBGMState("stop",!0)},this.playingBGMName=e,this._setPlayingBGMState("decoding",!0),this._setPlayingBGMState("play"),this.t2MediaLib.decodeSound(e,a),this}var u=o.decodedData;if("undefined"!=typeof Mezonet&&u instanceof Mezonet.Source){var c=u.playback(this.t2MediaLib.context);this.playingBGM=c,c.Start()}else if(u instanceof AudioBuffer)this.isTagLoop&&(r=r||o.tagLoopStart,i=i||o.tagLoopEnd),this.playingBGM=this.t2MediaLib.playSE(e,this.bgmVolume,this.bgmPan,this.bgmTempo,n,t,r,i);else if(u instanceof Object){if(this._initPicoAudio(),e!=this.picoAudioSetDataBGMName?(this.picoAudio.setData(u),this.picoAudioSetDataBGMName=e):this.picoAudio.initStatus(),this.picoAudio.setLoop(t),this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*this.bgmVolume*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),n){var l=this.picoAudio.getTime(Number.MAX_SAFE_INTEGER);n>l?n=l:n<0&&(n=0)}else n=0;this.picoAudio.setStartTime(n),this.picoAudio.play(),this.playingBGM=this.picoAudio}return this.playingBGMName=e,this.bgmPause=0,this._setPlayingBGMState("play"),this},n.prototype.stopBGM=function(){var n=this.playingBGM;if(t(n))n.Stop();else if(e(n))this.picoAudio.stop();else if(n instanceof AudioBufferSourceNode)try{n.stop(0)}catch(e){n.gainNode&&(n.gainNode.gain.cancelScheduledValues(this.t2MediaLib.context.currentTime),n.gainNode.gain.linearRampToValueAtTime(0,this.t2MediaLib.context.currentTime))}return this.playingBGM=null,this.playingBGMName=null,this._setPlayingBGMState("stop"),this},n.prototype.pauseBGM=function(){var n=this.playingBGM;if(t(n))n.pause();else if(e(n))0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseCurrentTime=n.context.currentTime,n.stop(),this.bgmPause=1);else if(n instanceof AudioBufferSourceNode&&0===this.bgmPause){this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=this.t2MediaLib.getSELoopStartTime(n),this.bgmPauseLoopEnd=this.t2MediaLib.getSELoopEndTime(n),this.bgmPauseLoop=this.t2MediaLib.isSELoop(n),this.bgmPauseCurrentTime=n.context.currentTime,this.bgmPauseTempo=this.bgmTempo;try{n.stop(0)}catch(e){n.gainNode&&(n.gainNode.gain.cancelScheduledValues(this.t2MediaLib.context.currentTime),n.gainNode.gain.linearRampToValueAtTime(0,this.t2MediaLib.context.currentTime))}this.bgmPause=1}return"stop"!=this.playingBGMState&&this._setPlayingBGMState("pause"),this},n.prototype.resumeBGM=function(){var n=this.playingBGM;return t(n)?n.resume():e(n)?1===this.bgmPause&&(n.play(),this.bgmPause=0):n instanceof AudioBufferSourceNode&&1===this.bgmPause&&(n=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd)),this},n.prototype.onChangeBGMMasterVolume=function(){this.setBGMVolume(this.getBGMVolume())},n.prototype.getBGMVolume=function(){return this.bgmVolume},n.prototype.setBGMVolume=function(n){var r=this.playingBGM;return this.bgmVolume=n,t(r)?r.setVolume(n):e(r)?this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*n*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume):r instanceof AudioBufferSourceNode&&(r.gainNode.gain.value=n*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),this},n.prototype.getBGMTempo=function(){return this.bgmTempo},n.prototype.setBGMTempo=function(e){var n=this.playingBGM;return(e<=0||isNaN(e))&&(e=1),t(n)?(n.setRate(e),this):(n instanceof AudioBufferSourceNode&&0===this.bgmPause&&(n.plusTime-=(this.t2MediaLib.context.currentTime-n.playStartTime)*(e-this.bgmTempo)),this.bgmTempo=e,this.t2MediaLib.setSERate(n,e),this)},n.prototype.getBGMPan=function(){return this.bgmPan},n.prototype.setBGMPan=function(e){var t=this.playingBGM;return this.bgmPan=e,t instanceof AudioBufferSourceNode&&this.t2MediaLib.setSEPan(t,e),this},n.prototype.isBGMLoop=function(){var t=this.playingBGM;return e(t)?this.picoAudio.isLoop():t instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoop:this.t2MediaLib.isSELoop(t):null},n.prototype.setBGMLoop=function(t){var n=this.playingBGM;return e(n)?this.picoAudio.setLoop(t):n instanceof AudioBufferSourceNode&&(1===this.bgmPause?this.bgmPauseLoop=t:this.t2MediaLib.setSELoop(n,t)),this},n.prototype.getBGMLoopStartTime=function(){var t=this.playingBGM;return e(t)?0:t instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopStart:this.t2MediaLib.getSELoopStartTime(t):null},n.prototype.setBGMLoopStartTime=function(e){var t=this.playingBGM;if(t instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopStartTime(t,e);this.bgmPauseLoopStart=e}return this},n.prototype.getBGMLoopEndTime=function(){var t=this.playingBGM;return e(t)?this.getBGMLength():t instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopEnd:this.t2MediaLib.getSELoopEndTime(t):null},n.prototype.setBGMLoopEndTime=function(e){var t=this.playingBGM;if(t instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopEndTime(t,e);this.bgmPauseLoopEnd=e}return this},n.prototype.getBGMCurrentTime=function(){var n,r,i,o,s,a,u,c=this.playingBGM;return t(c)?c.getTrackTime():e(c)?n=0===this.bgmPause?this.picoAudio.context.currentTime-this.picoAudio.states.startTime:this.bgmPauseTime:c instanceof AudioBufferSourceNode?(0===this.bgmPause?(i=this.t2MediaLib.context.currentTime,o=this.bgmTempo):(i=this.bgmPauseCurrentTime,o=this.bgmPauseTempo),r=(i-c.playStartTime)*o+c.plusTime,c.loop&&(c.loopEnd-c.loopStart>0?r<c.loopStart?(s=0,a=0,u=c.buffer.duration):(s=c.loopStart,a=c.loopStart,u=c.loopEnd-c.loopStart):(u=c.buffer.duration,s=0,a=0)),c.loop?n=(r-a)%u+s:(n=r)>c.buffer.duration&&(n=c.buffer.duration),n):null},n.prototype.getBGMLength=function(){var t=this.playingBGM;return e(t)?this.picoAudio.getTime(Number.MAX_SAFE_INTEGER):t instanceof AudioBufferSourceNode?t.buffer.duration:null},n.prototype.getPlayingBGMName=function(){return this.playingBGMName},n.prototype.setOnBGMEndListener=function(e){null!=this.picoAudio&&this.picoAudio.setOnSongEndListener(e)},n.prototype.getPlayingBGMState=function(){return this.playingBGMState},n.prototype.getBGMPicoAudio=function(){return this._initPicoAudio(),this.picoAudio},n.prototype.isTagLoop=function(){return this.isTagLoop},n.prototype.setTagLoop=function(e){this.isTagLoop=e},n.prototype._setPlayingBGMState=function(e,t){t||"decoding"!=this.playingBGMState?(this.playingBGMState=e,this.playingBGMStatePending=null):this.playingBGMStatePending=e},n.prototype._initPicoAudio=function(){null==this.picoAudio&&(0==this.id&&(this.picoAudio=this.t2MediaLib.picoAudio),null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.t2MediaLib.context,this.t2MediaLib.picoAudio)))},n}(),o=function(){var e=function(e,t){this.idx=e,this.state="none",this.errorID=null,this.url=null,this.fileData=null,this.decodedData=null,this.decodedCallbacksAry=null,this.tagLoopStart=0,this.tagLoopEnd=0};return e.prototype.onLoad=function(e){this.state="loading",this.url=e},e.prototype.onLoadComplete=function(e){this.state="loaded",this.fileData=e},e.prototype.onDecode=function(){this.state="decoding"},e.prototype.onDecodeComplete=function(e){this.state="decoded",this.decodedData=e},e.prototype.onError=function(e){this.state="error",this.errorID=e},e.prototype.isNone=function(){return"none"==this.state},e.prototype.isLoadComplete=function(){switch(this.state){case"loaded":case"decoding":case"decoded":return!0}return!1},e.prototype.isDecoding=function(){return"decoding"==this.state},e.prototype.isDecodeComplete=function(){return"decoded"==this.state},e.prototype.removeDecodedData=function(){this.state="loaded",this.decodedData=null},e}();window.T2MediaLib=r,window.T2MediaLib_BGMPlayer=i,window.T2MediaLib_SoundData=o,n("T2MediaLib",function(e){return function(){return e.T2MediaLib}}(this)),n("UIDiag",["UI"],function(e){var t={};function n(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e}function r(e,t){return null==e&&(e=""),n(e)?{title:t,body:i(e)}:"undefined"!=typeof $&&e instanceof $?{title:e.title||t,body:e}:(n(e.body)&&(e.body=i(e.body)),e)}function i(t){var n=(t+"").split("\n");return 1==n.length?n[0]:e.apply(this,["div"].concat(n.map(function(e){return["div",e]})))}return t.confirm=function(t){t=r(t,"確認");var n=e("div",{title:t.title},["div",t.body],["button",{on:{click:o(!0)}},"OK"],["button",{on:{click:o(!1)}},"キャンセル"]).dialog({width:"auto",close:o(!1)}),i=$.Deferred();function o(e){return function(){i.resolve(e),n.dialog("close"),n.remove()}}return i.promise()},t.alert=function(t){t=r(t,"確認");var n=e("div",{title:t.title},["div",t.body],["button",{on:{click:o(!0)}},"OK"]).dialog({width:"auto",close:o(!1)}),i=$.Deferred();function o(e){return function(){i.resolve(e),n.dialog("close"),n.remove()}}return i.promise()},t.open=function(e,n,r,i,o,s,a){return t.prompt({title:e,body:n},r,{left:i,top:o,width:s,height:a})},t.getStatus=function(){return t.status},t.getText=function(){return t.val?t.val.val():""},t.prompt=function(n,i,o){n=r(n,"入力"),"number"==typeof(o=o||{}).left&&"number"==typeof o.top?position={my:"left top",at:"left+"+o.left+" top+"+o.top,of:"body"}:position={of:"body",at:"center",my:"center"};var s=e("div",{title:n.title},["div",n.body],["input",{on:{enterkey:u},$var:"val",value:i}],["br"],["button",{on:{click:u}},"OK"],["button",{on:{click:function(){t.status=2,s.dialog("close"),s.remove(),a.resolve()}}},"キャンセル"]).dialog({width:o.width||"auto",height:o.height||"auto",position:position,close:function(){s.dialog("close"),a.resolve()}});setTimeout(function(){s.$vars.val.focus()},10),t.status=0,t.val=s.$vars.val;var a=$.Deferred();function u(){t.status=1;var e=s.$vars.val.val();t.resultValue=e,a.resolve(e),s.dialog("close"),s.remove()}return a.promise()},"undefined"!=typeof window&&(window.UIDiag=t),t}),n("runtime",["ImageList","T2MediaLib","UIDiag"],function(e,t,n){return console.log("runtimes loaded",arguments),window.T2MediaLib||(window.T2MediaLib=t),{ImageList:e,T2MediaLib:t,UIDiag:n}}),__whitespace={" ":!0,"\t":!0,"\n":!0,"\f":!0,"\r":!0},difflib={defaultJunkFunction:function(e){return __whitespace.hasOwnProperty(e)},stripLinebreaks:function(e){return e.replace(/^[\n\r]*|[\n\r]*$/g,"")},stringAsLines:function(e){for(var t=e.indexOf("\n"),n=e.indexOf("\r"),r=t>-1&&n>-1||n<0?"\n":"\r",i=e.split(r),o=0;o<i.length;o++)i[o]=difflib.stripLinebreaks(i[o]);return i},__reduce:function(e,t,n){if(null!=n)var r=n,i=0;else{if(!t)return null;r=t[0],i=1}for(;i<t.length;i++)r=e(r,t[i]);return r},__ntuplecomp:function(e,t){for(var n=Math.max(e.length,t.length),r=0;r<n;r++){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return e.length==t.length?0:e.length<t.length?-1:1},__calculate_ratio:function(e,t){return t?2*e/t:1},__isindict:function(e){return function(t){return e.hasOwnProperty(t)}},__dictget:function(e,t,n){return e.hasOwnProperty(t)?e[t]:n},SequenceMatcher:function(e,t,n){this.set_seqs=function(e,t){this.set_seq1(e),this.set_seq2(t)},this.set_seq1=function(e){e!=this.a&&(this.a=e,this.matching_blocks=this.opcodes=null)},this.set_seq2=function(e){e!=this.b&&(this.b=e,this.matching_blocks=this.opcodes=this.fullbcount=null,this.__chain_b())},this.__chain_b=function(){for(var e=this.b,t=e.length,n=this.b2j={},r={},i=0;i<e.length;i++){var o=e[i];if(n.hasOwnProperty(o)){var s=n[o];t>=200&&100*s.length>t?(r[o]=1,delete n[o]):s.push(i)}else n[o]=[i]}for(var o in r)r.hasOwnProperty(o)&&delete n[o];var a=this.isjunk,u={};if(a){for(var o in r)r.hasOwnProperty(o)&&a(o)&&(u[o]=1,delete r[o]);for(var o in n)n.hasOwnProperty(o)&&a(o)&&(u[o]=1,delete n[o])}this.isbjunk=difflib.__isindict(u),this.isbpopular=difflib.__isindict(r)},this.find_longest_match=function(e,t,n,r){for(var i=this.a,o=this.b,s=this.b2j,a=this.isbjunk,u=e,c=n,l=0,f=null,p={},h=[],d=e;d<t;d++){var g={},m=difflib.__dictget(s,i[d],h);for(var v in m)if(m.hasOwnProperty(v)){if((f=m[v])<n)continue;if(f>=r)break;g[f]=k=difflib.__dictget(p,f-1,0)+1,k>l&&(u=d-k+1,c=f-k+1,l=k)}p=g}for(;u>e&&c>n&&!a(o[c-1])&&i[u-1]==o[c-1];)u--,c--,l++;for(;u+l<t&&c+l<r&&!a(o[c+l])&&i[u+l]==o[c+l];)l++;for(;u>e&&c>n&&a(o[c-1])&&i[u-1]==o[c-1];)u--,c--,l++;for(;u+l<t&&c+l<r&&a(o[c+l])&&i[u+l]==o[c+l];)l++;return[u,c,l]},this.get_matching_blocks=function(){if(null!=this.matching_blocks)return this.matching_blocks;for(var e,t,n,r,i,o,s,a,u,c=this.a.length,l=this.b.length,f=[[0,c,0,l]],p=[];f.length;)e=(i=f.pop())[0],t=i[1],n=i[2],r=i[3],o=(u=this.find_longest_match(e,t,n,r))[0],s=u[1],(a=u[2])&&(p.push(u),e<o&&n<s&&f.push([e,o,n,s]),o+a<t&&s+a<r&&f.push([o+a,t,s+a,r]));p.sort(difflib.__ntuplecomp);var h=j1=k1=block=0,d=[];for(var g in p)p.hasOwnProperty(g)&&(block=p[g],i2=block[0],j2=block[1],k2=block[2],h+k1==i2&&j1+k1==j2?k1+=k2:(k1&&d.push([h,j1,k1]),h=i2,j1=j2,k1=k2));return k1&&d.push([h,j1,k1]),d.push([c,l,0]),this.matching_blocks=d,this.matching_blocks},this.get_opcodes=function(){if(null!=this.opcodes)return this.opcodes;var e,t,n,r,i,o=0,s=0,a=[];this.opcodes=a;var u=this.get_matching_blocks();for(var c in u)u.hasOwnProperty(c)&&(t=(e=u[c])[0],n=e[1],r=e[2],i="",o<t&&s<n?i="replace":o<t?i="delete":s<n&&(i="insert"),i&&a.push([i,o,t,s,n]),o=t+r,s=n+r,r&&a.push(["equal",t,o,n,s]));return a},this.get_grouped_opcodes=function(e){e||(e=3);var t,n,r,i,o,s,a=this.get_opcodes();a||(a=[["equal",0,1,0,1]]),"equal"==a[0][0]&&(n=(t=a[0])[0],r=t[1],i=t[2],o=t[3],s=t[4],a[0]=[n,Math.max(r,i-e),i,Math.max(o,s-e),s]),"equal"==a[a.length-1][0]&&(n=(t=a[a.length-1])[0],r=t[1],i=t[2],o=t[3],s=t[4],a[a.length-1]=[n,r,Math.min(i,r+e),o,Math.min(s,o+e)]);var u=e+e,c=[],l=[];for(var f in a)a.hasOwnProperty(f)&&(n=(t=a[f])[0],r=t[1],i=t[2],o=t[3],s=t[4],"equal"==n&&i-r>u&&(c.push([n,r,Math.min(i,r+e),o,Math.min(s,o+e)]),l.push(c),c=[],r=Math.max(r,i-e),o=Math.max(o,s-e)),c.push([n,r,i,o,s]));return!c||1==c.length&&"equal"==c[0][0]||l.push(c),l},this.ratio=function(){return matches=difflib.__reduce(function(e,t){return e+t[t.length-1]},this.get_matching_blocks(),0),difflib.__calculate_ratio(matches,this.a.length+this.b.length)},this.quick_ratio=function(){var e,t;if(null==this.fullbcount){this.fullbcount=e={};for(var n=0;n<this.b.length;n++)e[t=this.b[n]]=difflib.__dictget(e,t,0)+1}e=this.fullbcount;var r={},i=difflib.__isindict(r),o=numb=0;for(n=0;n<this.a.length;n++)i(t=this.a[n])?numb=r[t]:numb=difflib.__dictget(e,t,0),r[t]=numb-1,numb>0&&o++;return difflib.__calculate_ratio(o,this.a.length+this.b.length)},this.real_quick_ratio=function(){var e=this.a.length,t=this.b.length;return _calculate_ratio(Math.min(e,t),e+t)},this.isjunk=n||difflib.defaultJunkFunction,this.a=this.b=null,this.set_seqs(e,t)}},n("difflib",function(e){return function(){return e.difflib}}(this)),diffview={buildView:function(e){var t=e.baseTextLines,n=e.newTextLines,r=e.opcodes,i=e.baseTextName?e.baseTextName:"Base Text",o=e.newTextName?e.newTextName:"New Text",s=e.contextSize,a=0==e.viewType||1==e.viewType?e.viewType:0;if(null==t)throw"Cannot build diff view; baseTextLines is not defined.";if(null==n)throw"Cannot build diff view; newTextLines is not defined.";if(!r)throw"Canno build diff view; opcodes is not defined.";function u(e,t){var n=document.createElement(e);return n.className=t,n}function c(e,t){var n=document.createElement(e);return n.appendChild(document.createTextNode(t)),n}function l(e,t,n){var r=document.createElement(e);return r.className=t,r.appendChild(document.createTextNode(n)),r}var f=document.createElement("thead"),p=document.createElement("tr");f.appendChild(p),a?(p.appendChild(document.createElement("th")),p.appendChild(document.createElement("th")),p.appendChild(l("th","texttitle",i+" vs. "+o))):(p.appendChild(document.createElement("th")),p.appendChild(l("th","texttitle",i)),p.appendChild(document.createElement("th")),p.appendChild(l("th","texttitle",o))),f=[f];var h,d=[];function g(e,t,n,r,i){return t<n?(e.appendChild(c("th",(t+1).toString())),e.appendChild(l("td",i,r[t].replace(/\t/g,"    "))),t+1):(e.appendChild(document.createElement("th")),e.appendChild(u("td","empty")),t)}function m(e,t,n,r,i){e.appendChild(c("th",null==t?"":(t+1).toString())),e.appendChild(c("th",null==n?"":(n+1).toString())),e.appendChild(l("td",i,r[null!=t?t:n].replace(/\t/g,"    ")))}for(var v=0;v<r.length;v++){code=r[v],change=code[0];for(var y=code[1],b=code[2],w=code[3],x=code[4],S=Math.max(b-y,x-w),_=[],E=[],A=0;A<S;A++){if(s&&r.length>1&&(v>0&&A==s||0==v&&0==A)&&"equal"==change){var C=S-(0==v?1:2)*s;if(C>1){if(_.push(p=document.createElement("tr")),y+=C,w+=C,A+=C-1,p.appendChild(c("th","...")),a||p.appendChild(l("td","skip","")),p.appendChild(c("th","...")),p.appendChild(l("td","skip","")),v+1==r.length)break;continue}}_.push(p=document.createElement("tr")),a?"insert"==change?m(p,null,w++,n,change):"replace"==change?(E.push(h=document.createElement("tr")),y<b&&m(p,y++,null,t,"delete"),w<x&&m(h,null,w++,n,"insert")):"delete"==change?m(p,y++,null,t,change):m(p,y++,w++,t,change):(y=g(p,y,b,t,change),w=g(p,w,x,n,change))}for(A=0;A<_.length;A++)d.push(_[A]);for(A=0;A<E.length;A++)d.push(E[A])}for(var v in d.push(p=l("th","author","diff view generated by ")),p.setAttribute("colspan",a?3:4),p.appendChild(h=c("a","jsdifflib")),h.setAttribute("href","http://github.com/cemerick/jsdifflib"),f.push(p=document.createElement("tbody")),d)d.hasOwnProperty(v)&&p.appendChild(d[v]);for(var v in p=u("table","diff"+(a?" inlinediff":"")),f)f.hasOwnProperty(v)&&p.appendChild(f[v]);return p}},n("diffview",function(e){return function(){return e.diffview}}(this)),n("DiffDialog",["UI","difflib","diffview"],function(e,t,n){var r={show:function(e,t,n){r.embed(e,t,n).dialog({width:600,height:500})},embed:function(i,o,s){if(!r.d){var a={fromVal:function(e){return""==e?null:FS.get(e)},toVal:function(e){return e?e.path():""}};r.d=e("div",{title:"比較"},["div",["input",{style:"background-color: #f88;",$edit:{name:"baseFile",type:a},size:60}],["br"],["input",{style:"background-color: #8f8;",$var:"newFile",$edit:{name:"newFile",type:a},size:60}]],["div",{$var:"validationMessage",css:{color:"red"}}],["button",{$var:"OKButton",on:{click:function(){r.done()}}},"比較"],["div",{$var:"diffoutput",css:{height:"350px",overflow:"scroll"}}])}var u=r.d,c={baseFile:i,newFile:o};function l(e){return e&&!e.isDir()&&e.exists()}return u.$edits.load(c),u.$edits.validator.on.validate=function(e){l(e.newFile)?l(e.baseFile)?this.allOK():this.addError("base",i+"は存在しないか，ディレクトリです"):this.addError("new",o+"は存在しないか，ディレクトリです")},r.done=function(){for(var e=t.stringAsLines(c.baseFile.text()),r=t.stringAsLines(c.newFile.text()),i=new t.SequenceMatcher(e,r).get_opcodes(),o=u.$vars.diffoutput[0];o.firstChild;)o.removeChild(o.firstChild);contextSize=null,o.appendChild(n.buildView({baseTextLines:e,newTextLines:r,opcodes:i,baseTextName:c.baseFile+"",newTextName:c.newFile+"",contextSize:contextSize,viewType:1}))},l(c.baseFile)&&l(c.newFile)&&r.done(),u}};return r}),n("KernelDiffDialog",["UI","DiffDialog","Shell"],function(e,t,n){var r={};return r.show=function(e,t,n){r.embed(e,t,n).dialog({width:250,height:400})},r.embed=function(n,i,o){r.d||(r.d=e("div",{title:"Kernel比較"},["div",{$var:"out"}],["button",{$var:"OKButton",on:{click:function(){r.refresh()}}},"更新"]));var s=r.d;return r.refresh=function(){var r=s.$vars.out;r.empty(),i.each(function(o){var s,a,u=n.rel(o.relPath(i));o.endsWith(".tonyu")&&u.exists()&&(o.text()==u.text()?r.append(e("div",o.name(),"(同一)")):r.append(e("div",["a",{href:"javascript:;",on:{click:(s=u,a=o,function(){t.show(s,a)})}},o.name()])))})},r.refresh(),s},r}),n("requestFragment",["WebSite"],function(e){var t={ajax:function(t){var n=t.THRESH||8e5,r=t.data;if("object"!=typeof r)throw"Data should be object: "+r;if(r=JSON.stringify(r),!t.redirectTo&&("GAE"!=e.serverType||r.length<n))return $.ajax(t);for(var i=[],o=Math.random();r.length>0;)i.push(r.substring(0,n)),r=r.substring(n);var s=i.length,a=0,u=1e3;function c(e){return t.redirectTo&&(e.redirectTo=t.redirectTo),e}function l(){$.ajax({type:"post",url:e.serverTop+"/runFragments",data:c({id:o}),success:function(e){if("string"==typeof e&&e.match(/^notCompleted:([\-\d]+)\/([\-\d]+)$/))return console.log("notcomp",e),u*=2,void setTimeout(l,u);t.success(e)},error:t.error,complete:t.complete})}i.forEach(function(n,r){$.ajax({type:"post",url:e.serverTop+"/sendFragment",data:c({id:o,seq:r,len:s,content:n}),success:function(e){console.log("sendFrag",e,r),++a>=s&&setTimeout(l,u)},error:t.error})})}};return t}),n("Sync",["FS","Shell","requestFragment","WebSite"],function(e,t,n,r){var i={};function o(e){return e&&e.isDir}return t.sync=function(){var e,n,r,s=function(){},a=0;return("string"==typeof arguments[a]||o(arguments[a]))&&(e=t.resolve(arguments[a],!0),("string"==typeof arguments[++a]||o(arguments[a]))&&(n=t.resolve(arguments[a],!1),a++)),"object"==typeof arguments[a]&&(r=arguments[a],a++),"function"==typeof arguments[a]&&(s=arguments[a],a++),e||(n=e=t.cwd),r&&r.onend&&(r.onend=u(r.onend)),n||(n=e),t.echo("sync args=",e,n,r,s),i.sync(e,n,r,u(s)),t.ASYNC;function u(e){return function(){e&&e.apply({},arguments),t.prompt()}}},i.sync=function(){var e,i,s,a,u,c=0;if(o(arguments[c])&&(e=arguments[c],o(arguments[++c])&&(i=arguments[c],c++)),"object"==typeof arguments[c]&&(s=arguments[c],c++),"function"==typeof arguments[c]&&(a=arguments[c],c++),!e)throw"Sync.sync: Local dir must be specified as file object";i||(i=e),s||(s={}),!a&&s.onend&&(a=s.onend),s.test&&(s.v=1),h("getDirInfo",u={base:i.path(),excludes:JSON.stringify(s.excludes)}),$.ajax({type:"get",url:r.serverTop+"/getDirInfo",data:u,success:g,error:d});var l={},f=[],p={};function h(e,n){t.echo("Status: "+e+" param:",n),s.onstatus&&s.onstatus(e,n)}function d(){s.onerror&&s.onerror.apply(this,arguments)}function g(n){s.v&&t.echo("getDirInfo",n);var o=e,a=n.data;for(var u in a){var c=o.rel(u);y(c,u,c.exists({includeTrashed:!0})&&c.metaInfo(),a[u])}e.recursive(function(t){var n=t.exists({includeTrashed:!0})&&t.metaInfo(),r=t.relPath(e);y(t,r,n,a[r])},{includeTrashed:!0,excludes:s.excludes}),s.v&&(t.echo("uploads:",l),t.echo("downloads:",f));var p={base:i.path(),paths:JSON.stringify(f)};h("File2LSSync",p),$.ajax({type:"post",url:r.serverTop+"/File2LSSync",data:p,success:m,error:d})}function m(o){t.echo("dlData=",o),s.v&&t.echo("dlData:",o);var a=e;if(!s.test){for(var u in o.data){var c=a.rel(u),f=o.data[u];f.trashed?c.exists()&&c.rm():c.text(f.text),delete f.text,c.metaInfo(f)}var p={base:i.path(),data:JSON.stringify(l),pathInfo:"/LS2FileSync"};h("LS2FileSync",p),n.ajax({type:"post",url:r.serverTop+"/LS2FileSync",data:p,success:v,error:d})}}function v(e){s.v&&t.echo("LS2FileSync res=",e);var n=[];for(var r in l)n.push(r);e={msg:e,uploads:n,downloads:f},"function"==typeof a&&a(e)}function y(e,n,r,i){if(!p[n])if(p[n]=1,i&&(!r||r.lastUpdate<i.lastUpdate))f.push(n),s.v&&t.echo((r?"":"New")+"Download "+e+" trash="+!!i.trashed);else if(r&&(!i||r.lastUpdate>i.lastUpdate)){var o=r.trashed?{}:{text:e.text()},a=e.metaInfo();for(var u in a)o[u]=a[u];l[n]=o,s.v&&t.echo((i?"":"New")+"Upload "+e+" trash="+!!r.trashed)}}},t.rsh=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return $.ajax({url:r.serverTop+"/rsh",data:{args:JSON.stringify(e)},success:function(e){t.echo(e)},error:function(e,n,r){t.err(r)},complete:function(){t.prompt()}}),t.ASYNC},i}),n("searchDialog",["UI","Shell"],function(e,t){var n={show:function(e,t){n.embed(e,t).dialog({width:600})},embed:function(r,i){n.d||(n.d=e("div",{title:"検索"},["div",["span","検索語"],["input",{$edit:"word",on:{enterkey:function(){n.d.start()}}}]],["div",{$var:"validationMessage",css:{color:"red"}}],["button",{$var:"OKButton",on:{click:function(){n.d.start()}}},"検索"],["div",{style:"overflow-y:scroll; height:200px"},["table",{$var:"searchRes"}]]));var o=n.d,s={word:""};return o.$edits.load(s),o.start=function(){o.$vars.searchRes.empty(),t.grep(s.word,r).forEach(function(t){function n(){i&&i(t)}t.file.name().match(/^concat\.js/)||o.$vars.searchRes.append(e("tr",["td",{on:{click:n}},t.file.name()+"("+t.lineNo+")"],["td",{on:{click:n}},t.line]))})},o}};return n}),e(["Shell","FS","WebSite"],function(e,t,n){e.syncWithKernel=function(r){var i=t.get(n.tonyuHome).rel("Kernel/");if(r){var o=e.resolve(r),s=i.rel(r);return o.lastUpdate()>s.lastUpdate()?(e.cp(o,s,{v:1}),1):o.lastUpdate()<s.lastUpdate()?(e.cp(s,o,{v:1}),1):0}var a=0;return i.each(function(t){e.resolve(t.name()).exists()&&(a+=e.syncWithKernel(t.name()))}),a}}),n("syncWithKernel",function(){}),n("Auth",["WebSite"],function(e){var t={currentUser:function(t){$.ajax({type:"get",url:e.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(e){console.log("auth.currentUser",e);var n=(e=JSON.parse(e)).user;"null"==n&&(n=null),console.log("user",n,"csrfToken",e.csrfToken),t(n,e.csrfToken)}})},assertLogin:function(n){t.currentUser(function(t,r){if(t)return n.success(t,r);window.onLoggedIn=n.success,n.showLoginLink(e.serverTop+"/login")})}};return window.Auth=t,t}),n("Blob",["Auth","WebSite","Util"],function(e,t,n){var r={};return r.BLOB_PATH_EXPR="${blobPath}",r.upload=function(e,n,r,i){var o=new FormData(document.getElementById("fileinfo"));i.error&&(i.error=function(e){alert(e)}),o.append("theFile",r),o.append("user",e),o.append("project",n),o.append("fileName",r.name),$.ajax({type:"get",url:t.serverTop+"/blobURL",success:function(e){$.ajax({url:e,type:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("Res = "+e),i.success.apply({},arguments)},error:i.error})}})},r.isBlobURL=function(e){if(n.startsWith(e,"${blobPath}")){var t=e.split("/");return{user:t[1],project:t[2],fileName:t[3]}}},r.url=function(e,n,r){return t.blobPath+e+"/"+n+"/"+r},r.uploadToExe=function(e,n){var r=e.getBlobInfos(),i=r.length;if(console.log("uploadBlobToExe cnt=",i),0==i)return n.success();n.progress||(n.progress=function(e){console.log("uploadBlobToExe cnt=",e)}),r.forEach(function(e){var r={csrfToken:n.csrfToken};for(var o in e)r[o]=e[o];$.ajax({type:"get",url:t.serverTop+"/uploadBlobToExe",data:r,success:function(){if(0==--i)return n.success();n.progress(i)},error:n.error})})},r}),n("ImageRect",[],function(){return function e(t,n){if("string"==typeof t){var r=new Image,i=null,o=null,s=function(e){e&&(o=e),o&&i&&o(i)};return r.onload=function(){i=e(r,n),s()},r.src=t,s}var a=n.width,u=n.height,c=n.getContext("2d"),l=t.width,f=t.height,p=u/f*l,h=a/l*f;h>u&&(h=u),p>a&&(p=a),c.clearRect(0,0,a,u);var d=Math.floor((a-p)/2),g=Math.floor((u-h)/2);return c.drawImage(t,0,0,l,f,d,g,p,h),{left:d,top:g,width:p,height:h,src:t}}}),n("ImageDetailEditor",["UI","ImageList","ImageRect","PatternParser","WebSite","Assets"],function(e,n,r,i,o,s){var a=e("div",{title:"画像詳細"},["div",["div","URL:",["input",{$var:"url",size:40,on:{change:function(){h&&(h.url=b.url.val())}}}],["a",{$var:"openImg",target:"_blank"},"画像を確認..."]],["canvas",{$edit:"cv",width:500,height:250,on:{mousemove:function(e){var t=b.cv[0].getContext("2d"),n=b.cv.offset(),r={x:e.pageX-n.left,y:e.pageY-n.top};if(!v)return void console.log("cvMouse");v.forEach(function(e,n){var i=C(e);if(function(e,t){return t.left<=e.x&&e.x<=t.left+t.width&&t.top<=e.y&&e.y<=t.top+t.height}(r,i)){var o=v[x];if(o){var s=C(o);M(t,s)}x=n,M(t,i,"#ff0")}})},mousedown:function(){if(v[x]){var e=y+"+"+x;b.patName.val(e),function(e){if(!o.isNW)return;t("nw.gui").Clipboard.get().set(e,"text")}(e)}}}}]],["form",{$var:"theForm"},["div",u("single"),"１枚絵"],["div",u("rc"),"分割数指定：",["input",{$var:"cols",size:5,on:{realtimechange:P,focus:S}}],"x",["input",{$var:"rows",size:5,on:{realtimechange:P,focus:S}}]],["div",u("wh"),"1パターンの大きさ指定：",["input",{$var:"pwidth",size:5,on:{realtimechange:O,focus:_}}],"x",["input",{$var:"pheight",size:5,on:{realtimechange:O,focus:_}}]],["div",u("t1"),"Tonyu1互換",["button",{on:{click:function(){if(!h)return!1;delete h.pwidth,delete h.pheight,h.type="t1",b.theForm[0].type.value="t1";try{E()}catch(e){alert(e)}return!1}}},"解析"]],["div","パターン番号:",["input",{$var:"patName"}]],["button",{on:{click:function(){a.dialog("close"),g&&g();return!1}}},"OK"]]);function u(t){return e("input",{type:"radio",name:"type",value:t,on:{click:function(){!function(e){switch(e){case"single":return!!h&&(p=1,f=1,k(),O(),E(),!1);case"rc":return P();case"wh":O()}}(t)}}})}var c,l,f,p,h,d,g,m,v,y,b=a.$vars,w={},x=-1;function S(){b.theForm[0].type.value="rc"}function _(){b.theForm[0].type.value="wh"}function E(){var e=b.cv[0].getContext("2d"),t=m;t&&d&&(e.clearRect(t.left,t.top,t.width,t.height),e.drawImage(d,0,0,c,l,t.left,t.top,t.width,t.height),A())}function A(){var e=n.parse1(h,d,{boundsInSrc:!0}),t=b.cv[0].getContext("2d");e.forEach(function(e){M(t,C(e))}),v=e}function C(e){var t={},n=m.width/c,r=m.height/l;return t.left=m.left+e.x*n,t.top=m.top+e.y*r,t.width=e.width*n,t.height=e.height*r,t}function M(e,t,n){e.strokeStyle=n||"#f0f",e.beginPath(),e.moveTo(t.left,t.top),e.lineTo(t.left+t.width,t.top),e.lineTo(t.left+t.width,t.top+t.height),e.lineTo(t.left,t.top+t.height),e.closePath(),e.stroke()}function T(e,t){return e==e?e:t}function P(){return"rc"==b.theForm[0].type.value&&(!!h&&(p=T(parseInt(b.cols.val()),p),f=T(parseInt(b.rows.val()),f),k(),E(),!1))}function k(){if(!h)return!1;h.type="wh",h.pwidth=T(Math.floor(c/p),c),h.pheight=T(Math.floor(l/f),l),console.log("calcWH",h),b.pwidth.val(h.pwidth),b.pheight.val(h.pheight)}function O(){return"wh"==b.theForm[0].type.value&&(!!h&&(h.type="wh",h.pwidth=T(parseInt(b.pwidth.val()),h.pwidth),h.pheight=T(parseInt(b.pheight.val()),h.pheight),D(),E(),!1))}function D(){if(!h)return!1;p=T(Math.floor(c/h.pwidth),p),f=T(Math.floor(l/h.pheight),f),b.rows.val(f),b.cols.val(p)}return w.show=function(e,t,n,i){i||(i={}),g=i.onclose,h=e,y=n,a.dialog({width:600,height:520}),b.url.val(h.url);var u=s.resolve(h.url,t);if(o.isNW){var f;try{(f={"images/Ball.png":"www/images/Ball.png","images/base.png":"www/images/base.png","images/Sample.png":"www/images/Sample.png","images/neko.png":"www/images/neko.png","images/mapchip.png":"www/images/mapchip.png","images/sound.png":"www/images/sound.png","images/sound_ogg.png":"www/images/sound_ogg.png","images/sound_mp3.png":"www/images/sound_mp3.png","images/sound_mp4.png":"www/images/sound_mp4.png","images/sound_m4a.png":"www/images/sound_m4a.png","images/sound_mid.png":"www/images/sound_mid.png","images/sound_wav.png":"www/images/sound_wav.png","images/ecl.png":"www/images/ecl.png"}[h.url])||(f=u)}catch(e){f=u}var p="javascript:nw.Window.open('"+f+"', {}, function(w) {w.y=20;w.width=700;w.height=600;})";b.openImg.attr("href",p)}else b.openImg.attr("href",u);r(u,b.cv[0])(function(e){m=e,console.log(e),d=e.src,c=d.width,l=d.height,"single"==h.type?b.theForm[0].type.value="single":h.pwidth&&h.pheight?(b.pwidth.val(h.pwidth),b.pheight.val(h.pheight),D(),_()):b.theForm[0].type.value="t1",A()})},w}),n("ResEditor",["FS","Tonyu","UI","ImageList","Blob","Auth","WebSite","ImageDetailEditor","Util","Assets"],function(e,t,n,r,i,o,s,a,u,c){return function(t,r){var l=n("div",{title:r.name+"リスト"});l.css({height:"200px","overflow-v":"scroll"});var f,p=t.getResource(),h=p[r.key],d=h.slice(),g=t.getDir().rel(r.path),m=[];function v(b,w){if("del"==b){var x=$("#"+w);p=t.getResource(),h=p[r.key],d=h.slice(),m.some(function(e,t){if(e[0].id==w)return m.splice(t,1),!0}),x.removeAttr("id"),x.remove()}else if(l.empty(),p=t.getResource(),h=p[r.key],d=h.slice(),m=[],"close"!=b){var S="ここに"+r.name+"ファイル("+r.exts.join("/")+")をドラッグ＆ドロップして追加",_=n("div",{style:"margin:10px; padding:10px; border:solid blue 2px;",on:{dragover:C,dragenter:C,drop:A}},S).appendTo(l),E=n("div").appendTo(l);h.forEach(function(i){var o=function(i){var o=n("div",{style:"float:left;",id:i.name.substring(1)},["canvas",{$var:"c",width:100,height:100,class:"clickable",on:{click:function(){"sounds"!=r.key&&a.show(i,t,i.name,{onclose:function(){t.setResource(p),v()}})}}}],["div",{style:"float:right;"},["button",{on:{click:function(){for(var n=h.length-1;n>=0;n--)if(h[n].name==i.name){try{var r=c.resolve(h[n].url,t,{asFile:1});e.isFile(r)&&g.contains(r)&&(console.log(r.path()," is removed."),r.rm())}catch(e){}h.splice(n,1);break}y("del",i.name.substring(1))}}},"×"],["br"],["button",{on:{click:function(){for(var e=h.length-1;e>=1;e--)if(h[e]===i){h.splice(e,1),h.splice(e-1,0,i);break}y()}}},"←"],["br"],["button",{on:{click:function(){for(var e=h.length-2;e>=0;e--)if(h[e]===i){h.splice(e,1),h.splice(e+1,0,i);break}y()}}},"→"]],["div",["input",{$var:"name",size:12,value:i.name}]]);return function e(t,n){if("string"==typeof t){var r=new Image;return r.onload=function(){e(r,n)},r.src=t,r}var i=n.width,o=n.height,s=n.getContext("2d"),a=t.width,u=t.height,c=o/u*a,l=i/a*u;l>o&&(l=o),c>i&&(c=i),s.clearRect(0,0,i,o);var f=Math.floor((i-c)/2),p=Math.floor((o-l)/2);s.drawImage(t,0,0,a,u,f,p,c,l)}(function(e){function n(e){return s.urlAliases[e]||e}try{return u.endsWith(e,".ogg")?e=n("images/sound_ogg.png"):u.endsWith(e,".mp3")?e=n("images/sound_mp3.png"):u.endsWith(e,".mzo")?e=n("images/sound_mzo.png"):u.endsWith(e,".mp4")?e=n("images/sound_mp4.png"):u.endsWith(e,".m4a")?e=n("images/sound_m4a.png"):u.endsWith(e,".mid")||u.endsWith(e,".midi")?e=n("images/sound_mid.png"):u.endsWith(e,".wav")&&(e=n("images/sound_wav.png")),c.resolve(e,t)}catch(e){return s.urlAliases["images/ecl.png"]}}(i.url),o.$vars.c[0]),o.$vars.data=i,o}(i);m.push(o),o.appendTo(E)}),l.append(n("div",{style:"clear:left;"},["button",{on:{click:function(){M()}}},"追加"],["button",{on:{click:function(){l.dialog("close")}}},"完了"]))}function A(e){e.stopPropagation(),e.preventDefault();for(var a,u=e.originalEvent.dataTransfer.files,c=new Array(u.length),l=u.length,f=[],p=[],m=0,v=0;v<u.length;v++)b(v);function b(e){var a=u[e],v=a.type;a.name.match(/\.mzo$/)&&(v="audio/mzo");var b="GAE"==s.serverType&&a.size>3e5;if(!v.match(r.contentType))return l--,void f.push(a);var w=a.name.replace(r.extPattern,"").replace(/\W/g,"_"),x="";a.name.match(r.extPattern)&&(x=RegExp.lastMatch.toLowerCase());var E,A="ls:"+g.rel(w+x).relPath(t.getDir());if(d.some(function(e){E=e;var t=e.url.replace(r.extPattern,"");return t.substring(t.lastIndexOf("/")+1,t.length)==w}))return l--,a.existsFile=E,void p.push(a);var C=r.newItem(w);if(C.url=A,function(e){for(var t=e.name,n=t,r=1,i=d.length-1;i>=0;i--){var o=d[i];o.name!=n||(n=t+"_"+r,r++,i=d.length)}e.name=n}(C),d.push(C),b)o.assertLogin({showLoginLink:function(e){_.css("border","solid red 2px").empty().append(n("div","大きい"+r.name+"を追加するには，ログインが必要です：",["a",{href:e,target:"login",style:"color: blue;"},"ログインする"]))},success:function(e){_.text("アップロード中...");var n=t.getName();i.upload(e,n,a,{success:function(){_.text(S),C.url="${blobPath}/"+e+"/"+n+"/"+a.name,M(C)}})}});else{var T=new FileReader;T.temp_file=a,T.temp_itemName=w,T.temp_itemExt=x,T.temp_v=C,T.onloadend=function(e){var n=e.target,i=n.result;if(null==n.error&&null!=i){var o=g.rel(n.temp_itemName+n.temp_itemExt);o.setBytes(i),n.temp_v.url="ls:"+o.relPath(t.getDir());for(var s=0;s<u.length;s++)if(u[s]==n.temp_file){c[s]=n.temp_v;break}}++m==l&&(c.forEach(function(e){e&&h.push(e||r.newItem())}),y())},T.readAsArrayBuffer(a)}}return f.length>0&&(a="このファイルは追加できません：\n",f.forEach(function(e){e&&(a+=e.name+"\n")}),alert(a)),p.length>0&&(a="同じ名前のファイルが既に登録されています：\n",p.forEach(function(e){if(e){var t=e.existsFile.url,n=t.substring(t.lastIndexOf("/")+1,t.length);a+=e.name+" ⇒ "+n+"("+e.existsFile.name+") と重複\n"}}),alert(a)),!1}function C(e){e.stopPropagation(),e.preventDefault()}function M(e){h.push(e||r.newItem()),y()}f=A}function y(e,n){m.forEach(function(e){var t=e.$vars;t.data.name=t.name.val()}),console.log(p),t.setResource(p),v(e,n)}return p||t.setResource({images:[],sounds:[]}),{dropAdd:function(e){f(e)},open:function(){v(),l.dialog({modal:!0,width:800,height:500,close:function(){y("close"),"function"==typeof r.close&&r.close({items:h,resourceDir:g,project:t})}})},close:function(){l.dialog("close")}}}}),n("OggConverter",["FS","WebSite"],function(e,n){var r,i={};return n.isNW&&(r=t("child_process").spawn),i.convert=function(t){if(n.isNW){var i=e.get(n.ffmpeg);i.exists()&&(console.log("Convert mpx->ogg ",t.path()),t.each(function(e){if(e.endsWith(".mp4")||e.endsWith(".m4a")){var t;e.endsWith(".mp3")&&(t=".mp3"),e.endsWith(".mp4")&&(t=".mp4"),e.endsWith(".m4a")&&(t=".m4a");var n=e.up().rel(e.truncExt(t)+".ogg");if(!n.exists())console.log("running",i.path(),"-i",e.path(),n.path()),r(i.path(),["-i",e.path(),n.path()]).stdin.end()}}))}},i}),n("ResEditors",["ResEditor","Klass","OggConverter"],function(e,t,n){var r={image:{name:"画像",exts:["png","gif","jpg"],path:"images/",key:"images",extPattern:/\.(png|gif|jpe?g)$/i,contentType:/image\/(png|gif|jpe?g)/,newItem:function(e){var t={type:"single"};return e&&(t.name="$pat_"+e),t}},sound:{name:"音声",exts:["mp3","ogg","mp4","m4a","mid","wav","mzo"],path:"sounds/",key:"sounds",extPattern:/\.(mp3|ogg|mp4|m4a|midi?|wav|mzo)$/i,contentType:/((audio\/(mp3|ogg|x-m4a|midi?|wav|mzo))|(video\/mp4))/,newItem:function(e){var t={};return e&&(t.name="$se_"+e),t},close:function(e){var t=e.project;console.log(e);var r=!1,i=!1;e.items.forEach(function(e){e.url.match(/\.mzo/)&&(r=!0),e.url.match(/\.midi?/)&&(i=!0)}),r?t.addPlugin("Mezonet"):t.removePlugin("Mezonet"),i?t.addPlugin("PicoAudio"):t.removePlugin("PicoAudio");var o=e.resourceDir;o.exists()&&n.convert(o)}}};return t.define({$:function(e){function t(e){e.stopPropagation(),e.preventDefault()}this.prj=e,this.editors={},$("body").on("dragover",t).on("dragenter",t).on("drop",this.dropAndOpen.bind(this))},dropAndOpen:function(e){e.stopPropagation(),e.preventDefault();var t=e.originalEvent,n=Array.prototype.slice.call(t.dataTransfer.files);if(console.log("DROP",e,n),0!=n.length)for(var i in r)r[i].extPattern.exec(n[0].name)&&(this.open(i),this.curResEditor.dropAdd(e))},open:function(t){this.editors[t]=this.editors[t]||e(this.prj,r[t]),this.curResEditor&&this.curResEditor!==this.editors[t]&&this.curResEditor.close(),this.curResEditor=this.editors[t],this.curResEditor.open()}})}),n("MainClassDialog",["UI"],function(e){var t={show:function(e,n){var r=t.embed(e,n);return r.dialog({width:600}),r},embed:function(n,r){r||(r={}),t.d||(t.d=e("div",{title:"実行するクラスを選択"},["div",["select",{$var:"mainClass"}],["div",{$var:"validationMessage",css:{color:"red"}}],["button",{$var:"OKButton",on:{click:function(){t.d.done(!1)}}},"OK"],["button",{$var:"RunButton",on:{click:function(){t.d.done(!0)}}},"実行"]]));var i=t.d,o=t.d.$vars;n.getDir();var s=n.getOptions();return i.done=function(e){s.run.mainClass=o.mainClass.val(),n.setOptions(s),r.on&&r.on.done&&r.on.done(o.mainClass.val(),e),i.dialog("close")},i}};return t}),function(){var e;if("object"!=typeof process)return{};var n=new function(e,n,r){var i=t("nw.gui"),o=new i.Menu,s=new i.MenuItem({label:e||"Cut",click:function(){document.execCommand("cut"),console.log("Menu:","cutted to clipboard")}}),a=new i.MenuItem({label:n||"Copy",click:function(){document.execCommand("copy"),console.log("Menu:","copied to clipboard")}}),u=new i.MenuItem({label:r||"Paste",click:function(){document.execCommand("paste"),console.log("Menu:","pasted to textarea")}});return o.append(s),o.append(a),o.append(u),o};$(document).on("contextmenu",function(t){t.preventDefault();var r={left:0,top:0};e&&(r=parent.$(e).offset(),console.log(r)),n.popup(t.originalEvent.x+Math.floor(r.left),t.originalEvent.y+Math.floor(r.top))});try{var r=t("nw.gui");win=r.Window.get();var i=new r.Menu({type:"menubar"});i.createMacBuiltin("My App"),win.menu=i}catch(e){console.log(e.message)}parent&&parent.$("iframe").each(function(){(this.contentDocument||this.contentWindow.document)===document&&(e=this)})}(),n("NWMenu",function(){}),n("extLink",["WebSite","UI","PathUtil","Util","assert"],function(e,n,r,i,o){var s=e.isNW?t("child_process").exec:function(){};function a(e,t,r){var i=u(e,r=r||{});return n("a",i,t)}function u(t,n){var r=e.platform;(n=n||{}).on=n.on||{};var i=n.on&&n.on.click||function(){};return"win32"==r?(n.href="javascript:;",n.on.click=c("start",t,i)):"darwin"==r?(n.href="javascript:;",n.on.click=c("open",t,i)):(n.href=t,n.on.click=i,n.target="_new"),n}function c(e,t,n){return function(){s(e+" "+t),n&&n()}}return a.all=function(){e.isNW&&$("a").each(function(){location.protocol,location.host;var e=$(this),t=e.attr("href");if(t.match(/^http/)){var n=o.is(u(t),{href:String,on:{click:Function}});e.attr("href",n.href),e.click(n.on.click)}})},a}),n("root",[],function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()}),n("plugins",["WebSite","root"],function(e,t){var n={},r={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/BodyActor/,symbol:"Box2D"},timbre:{src:"timbre.js",symbol:"T"},gif:{src:"gif-concat.js",detection:/GIFWriter/,symbol:"GIF"},Mezonet:{src:"Mezonet.js",symbol:"Mezonet"},PicoAudio:{src:"PicoAudio.min.js",symbol:"PicoAudio"},jquery_ui:{src:"jquery-ui.js",detection:/\$InputBox/,symbol:"$.ui"}};function i(e){return"function"==typeof e&&(e={onload:e}),e||(e={}),e.onload||(e.onload=function(){}),e}return n.installed=r,n.detectNeeded=function(e,t){for(var n in r){var i=r[n].detection;if(i)i.exec(e)&&(t[n]=1)}return t},n.loaded=function(e){var t=r[e];if(!t)throw new Error("plugin not found: "+e);return function(e){var t=window;return e.split(".").forEach(function(e){t&&(t=t[e])}),t}(t.symbol)},n.loadAll=function(e,t){t=i(t);var o=[];for(var s in e)r[s]&&!n.loaded(s)&&o.push(s);var a=0;console.log("loading plugins",o),setTimeout(function e(){a>=o.length?t.onload():n.load(o[a++],e)},0)},n.load=function(n,o){var s=r[n];if(!s)throw new Error("plugin not found: "+n);o=i(o);var a=e.pluginTop+"/"+s.src,u=t.requirejs;if(u)a=a.replace(/\.js$/,""),console.log("Loading plugin via requirejs",a),u([a],function(e){!window[s.symbol]&&e&&(window[s.symbol]=e),o.onload(e)});else{console.log("Loading plugin via <script>",a);var c=document.createElement("script");c.src=a,c.onload=o.onload,document.body.appendChild(c)}},n.request=function(e){n.loaded(e)||(new Error("Plugin "+e+" required").pluginName=e)},n}),n("mkrun",["FS","Util","assert","WebSite","plugins","Shell","Tonyu"],function(e,t,n,r,i,o,s){var a={};return o.mkrun=function(t){return a.run(s.currentProject,e.get(t))},a.run2=function(t,i,o){var s,u;switch(i){case"prj":u=this.tmpDir().rel("prj.zip");case"zip":s=this.tmpDir().rel(t.getDir().name());break;case"dir":s=o.dest}return n(s,"dest is not set"),console.log("mkrun2",s,u),a.run(t,s,o).then(function(){switch(i){case"zip":return e.zip.zip(s,o).finally(function(){return s.rm({r:1})});case"prj":return e.zip.zip(s,u,o).then(function(){return u.getContent(function(e){var t=new FormData,n=r.uploadTmpUrl;return t.append("content",new Blob([e.toBin(ArrayBuffer)],{type:e.contentType}),u.name()),$.ajax({url:n,method:"POST",data:t,processData:!1,contentType:!1})})}).then(function(e){if(console.log(e),!e.match(/^[\w\d\.]+\.zip$/))throw new Error("アップロード失敗: "+e);return{tmpFileName:e}}).finally(function(e){return s.rm({r:1}).then(function(){u.rm()}).then(function(){return e})})}})},a.tmpDir=function(){a.mounted||e.mount("/mkram/",e.LSFS.ramDisk()),a.mounted=!0;var t=e.get("/mkram/");return t.exists()&&t.rm({r:1}),t},a.run=function(n,s,a){a=a||{};var u=n.getDir(),c=n.getResource(),l=n.getOptions(),f="function loadFiles(dir){\n   if (WebSite.isNW) return;\n",p=e.get(r.wwwDir),h=p.rel("js/");const d="runScript2_concat.min.js";return console.log("jsDir",h),a.copySrc&&u.copyTo(s.rel("src/")),$.when(function(){var e={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/sound_ogg.png":"../../images/sound_ogg.png","images/sound_mp3.png":"../../images/sound_mp3.png","images/sound_mp4.png":"../../images/sound_mp4.png","images/sound_m4a.png":"../../images/sound_m4a.png","images/sound_mid.png":"../../images/sound_mid.png","images/sound_wav.png":"../../images/sound_wav.png","images/ecl.png":"../../images/ecl.png"},t=[];for(var n in c.images){var r=c.images[n].url;if(e[r]&&!u.rel(r).exists()){var i=p.rel(r);i.exists()?t.push(i.copyTo(s.rel(r))):o.echo(i+" not exists!")}}return $.when.apply($,t)}(),_(c.images),_(c.sounds),function(){S("res.json",c),S("options.json",l);var e=u.rel("maps/");e.exists()&&e.recursive(function(e){S(e.relPath(u),e.obj())});var t=u.rel("static/");t.exists()&&t.recursive(function(e){S(e.relPath(u))});s.rel("js/files.js").text(f+"}")}(),(m=u.rel("js/concat.js"),v=u.rel("js/concat.js.map"),y=e.get(r.kernelDir).rel("js/concat.js"),b=h.rel(`g2/${d}`),w=h.rel(`g2/${d}.map`),$.when(v.exists()&&v.copyTo(s.rel("js/concat.js.map")),m.copyTo(s.rel("js/concat.js")),y.copyTo(s.rel("js/kernel.js")),b.copyTo(s.rel(`js/${d}`)),w.exists()?w.copyTo(s.rel(`js/${d}.map`)):Promise.resolve())),function(){var e=h.rel("plugins/");if(!l.plugins)return;var t=[];for(var n in l.plugins){var r=e.rel(i.installed[n].src);t.push(r.copyTo(s.rel("js/plugins/")))}return $.when.apply($,t)}(),$.when(h.rel("lib/jquery-1.10.1.js").copyTo(s.rel("js/lib/")),h.rel("lib/require.js").copyTo(s.rel("js/lib/"))),x("images/"),x("sounds/"),(g=p.rel("html/runtimes/index.html")).text(function(e){return e=e.replace(/TONYU_APP_VERSION/g,Math.floor(1e5*Math.random())),s.rel(g.name()).text(e)}),void s.rel("Readme.txt").text("このフォルダは、Webサーバにアップロードしないと正常に動作しない可能性があります。\n詳しくは\nhttps://www.tonyu.jp/tonyu2/runtime.html\nを御覧ください。\n"));var g,m,v,y,b,w;function x(e){var t=u.rel(e);t.exists()&&t.copyTo(s.rel(e))}function S(e,t){var n=u.rel(e);if(n.copyTo(s.rel(e)),null==t){if(".json"!==n.ext())return n.isText()?(t=n.text(),void(f+="\tdir.rel('"+e+"').text("+JSON.stringify(t)+");\n")):(t=n.dataURL(),void(f+="\tdir.rel('"+e+"').dataURL("+JSON.stringify(t)+");\n"));t=n.obj()}f+="\tdir.rel('"+e+"').obj("+JSON.stringify(t)+");\n"}function _(e){for(var n in e){var r=e[n].url;if(t.startsWith(r,"ls:")){var i=r.substring("ls:".length);e[n].url=i}}}},a}),n("zip",["FS"],function(e){return e.zip}),n("mkrunDiag",["UI","extLink","mkrun","Tonyu","zip","DeferredUtil"],function(e,n,r,i,o,s){var a={show:function(e,t,n){a.embed(e,t,n).dialog({width:800,height:400})},embed:function(i,o){var u=(o=o||{}).dest,c=o.onComplete||function(){},l={click:function(){"dir"===h.value?f.dest.prop("disabled",!1):f.dest.prop("disabled",!0)}};a.d||(a.d=e("div",{title:"ランタイム作成"},["form",{action:"javascript:;",$var:"form",name:"mkrunform"},["h1","出力方法"],["div",["input",{type:"radio",name:"outtype",value:"zip",on:l}],["label",{for:"outtype"},"ZIP圧縮したものを保存する"]],["div",["input",{type:"radio",name:"outtype",value:"prj",on:l}],["label",{for:"outtype"},"プロジェクトボードにアップロードする"]],["div",{$var:"folder"},["input",{type:"radio",name:"outtype",value:"dir",on:l}],["label",{for:"dest"},"次のフォルダに出力："],["br"],["input",{$var:"dest",id:"dest",$edit:"dest",size:60}]],["h1","オプション"],["div",["input",{id:"src",$edit:"src",type:"checkbox"}],["label",{for:"src"},"ソースを添付する"],["div",{class:"srcwarn"},"ソースを添付すると，アップロードしたファイルをプロジェクトボード上で直接編集できます．"]],["button",{$var:"OKButton",on:{click:function(){a.run()}}},"作成"],["span",{$var:"progress"}]]));var f=a.d.$vars;f.OKButton.prop("disabled",!1),o.dest?f.folder.show():f.folder.hide();var p={dest:u&&u.path?u.path():u||"",src:!0,zip:!0},h=f.form[0].outtype;return f.dest.prop("disabled",!0),h.value="zip",a.d.$edits.load(p),a.run=function(){var u=h.value;a.d.$vars.OKButton.prop("disabled",!0);var l={copySrc:p.src,progress:function(e){return f.progress.text(e.name()),s.timeout(0)}};return"dir"===u&&(l.dest=FS.get(FS.PathUtil.directorify(p.dest))),r.run2(i,u,l).then(function(t){switch(u){case"dir":UIDiag.alert(e("div",["p",["a",{href:"javascript:;",style:"color: blue;",on:{click:d}},p.dest],"にランタイムを作成しました。"],["p","次のいずれかの方法でWebアプリとして公開することができます。"],["ul",["li","フォルダをお手持ちのWebサーバにアップロードする"],["li","上のフォルダをZIPで圧縮したものを",n("http://www.tonyu.jp/project/","プロジェクトボード",{style:"color: blue;"}),"にアップロードする"]]),{width:"auto"});break;case"zip":UIDiag.alert(e("div",["p","ランタイムを作成しました。"],["p","次のいずれかの方法でWebアプリとして公開することができます。"],["ul",["li","解凍したフォルダをお手持ちのWebサーバにアップロードする"],["li","保存したZIPファイルを",n("http://www.tonyu.jp/project/","プロジェクトボード",{style:"color: blue;"}),"にアップロードする"]]),{width:"auto"});break;case"prj":var r;(r=e("div",["p",["strong","まだアップロードは完了していません"]],["p",n(WebSite.newVersionUrl+"?tmpFile="+t.tmpFileName,"新規バージョンページ",{style:"color: blue;",on:{click:function(){r.$vars.button.prop("disabled",!1)}}}),"に必要事項を記入して，アップロードを完了させてください"],["button",{$var:"button",on:{click:function(){r.dialog("close"),r.remove()}}},"OK"])).$vars.button.prop("disabled",!0),r.dialog()}c({type:u,config:p}),a.d.$vars.OKButton.prop("disabled",!1),a.d.dialog&&a.d.dialog("close"),o.onEnd&&o.onEnd()}).then(function(){},function(e){console.error(e),alert(e)});function d(){var e=FS.get(p.dest);t("nw.gui").Shell.showItemInFolder(e.path().replace(/\//g,"\\"))}},a.d}};return a}),n("LSFS",["FS"],function(e){return e.LSFS}),n("WebFS",["FS"],function(e){return e.WebFS}),n("DiagAdjuster",[],function(){var e=function(e){this.diagElem=e,this.rszt=null,this.margin=30,this.timeout=100};return e.prototype.handleResize=function(){var e=this;this.rszt&&clearTimeout(this.rszt),this.rszt=setTimeout(function(){var t=e.diagElem.closest(".ui-dialog"),n=t.find(".ui-dialog-titlebar"),r=t.width(),i=t.height(),o=n.height(),s=e.margin,a={w:r-s,h:i-o-s};e.diagElem.css({width:a.w,height:a.h}),e.afterResize(e.diagElem)},this.timeout)},e.prototype.handleResizeF=function(){var e=this;return function(){e.handleResize()}},e.prototype.afterResize=function(){},e}),n("exportAsScriptTags",["FS","Util","WebSite"],function(e,t,n){return function(e,t){var r=(t=t||{}).excludes||{},i=t.includeJSScript,o="<!DOCTYPE html>\n<html><head>\n";if(o+='<meta http-equiv="Content-type" content="text/html; charset=utf8"/>\n',o+="<script>WebSite_runType='singleHTML';<\/script>\n",i){var s=e.rel("res.json").obj(),a=n.scriptServer||"https://edit.tonyu.jp/";const t=a+"js/g2/";s.images.forEach(function(e){n.builtinAssetNames[e.url]&&(o+='<script src="'+a+e.url+'.js"><\/script>\n')}),o+='<script src="'+a+'js/lib/jquery-1.10.1.js" type="text/javascript"><\/script>\n',o+='<script src="'+t+'runScript_concat.min.js" type="text/javascript"><\/script>\n'}o+="<div id='splash' style='position:relative; height: 100%;'>\n",o+="\x3c!--ここに，ロード中に表示する内容を記述できます。--\x3e\n",o+="\x3c!--You can write here what you want to show while loading. --\x3e\n",o+="<div class='progress'>\n",o+="\x3c!-- ここにロード中の進捗が表示されます．表示したくない場合はこのdiv要素を削除してください。 --\x3e\n",o+="\x3c!-- This shows progress. If you don't want to shot, remove this element --\x3e\n",o+="</div>\n",o+="</div>\n",o+="\x3c!--\n",o+="Open this site when editing this game:\n",o+="https://edit.tonyu.jp/index.html?importFromHTML=1\n",o+="--\x3e\n";var u=[],c=[];return e.recursive(function(t){var n=t.relPath(e);if(!r[n])if(t.endsWith(".json")&&n.indexOf("maps/")<0)c.push(t);else if(!t.endsWith(".desktop")&&!t.endsWith(".js.map")&&!t.endsWith(".js"))if(t.endsWith(".tonyu")){var i=" data-lastupdate='"+t.lastUpdate()+"' ";o+="<script language='text/tonyu' type='text/tonyu' data-filename='"+n+"'"+i+">",o+=t.text().replace(/&(#?[\w\d]+;)/g,function(e,t){return"&amp;"+t}).replace(/<(\s*)\/(\s*)script(\s*)>/gi,function(e,t,n,r){return"&lt;"+t+"/"+n+"script"+r+"&gt;"}),o+="<\/script>\n\n"}else u.push(t)},{excludes:["files/"]}),c.forEach(function(t){var n=t.relPath(e),r=" data-lastupdate='"+t.lastUpdate()+"' ";o+="<script language='text/tonyu' type='text/tonyu' data-filename='"+n+"'"+r+">\n",o+=function(e){try{var t=JSON.parse(e);return JSON.stringify(t,null,4)}catch(t){return e}}(t.text()),o+="<\/script>\n\n"}),u.forEach(function(t){var n=t.relPath(e),r=" data-lastupdate='"+t.lastUpdate()+"' ";o+="<script language='text/tonyu' type='text/tonyu' data-filename='"+n+"' data-wrap='80'"+r+">",o+=function(e,t){var n="";return e.split("\n").forEach(function(e){for(;;){if(!(e.length>t)){n+=e+"\n";break}n+=e.substring(0,t)+"\\\n",e=e.substring(t)}return n}),n}(t.text(),80),o+="<\/script>\n\n"}),o+="</head><body></body></html>"}}),n("ExportHTMLDialog",["exportAsScriptTags","UI","Klass"],function(e,t,n){return ExportHTMLDialog=n.define({$this:!0,$:["prj"],show:function(t,n){var r=t.prj.getDir();t.createDOM(),t.dom.dialog({width:800,height:400}),setTimeout(function(){var i=e(r,n);t.prog.val(i)},0)},createDOM:function(e){return e.dom?e.dom:(e.dom=t("div",{title:"HTML生成"},["div","このHTMLをcodepenなどのJS共有サイトに張り付けて実行できます．"],["textarea",{$var:"prog",rows:20,cols:60,placeholder:"Please wait..."}]),e.prog=e.dom.$vars.prog,e.dom)}}),ExportHTMLDialog}),n("DebugDialog",["require","exports","module","UI"],function(e,t,n){const r=e("UI");n.exports=class{constructor(e){const t=this;t.param=e;var n=r("div",{id:"runArea",style:"text-align : center ;overflow:hidden;",class:"runArea"},["iframe",{$var:"iframe",id:"iframe",src:"about:blank",width:465,height:465,class:"tonyu-canvas",style:" margin-left : auto ; margin-right : auto ;"}]);t.dom=n,t.iframe=n.$vars.iframe}close(){this.dom.dialog("close")}show(e){const t=this;var n=t.dom,r=t.param,i=r.desktopEnv;e&&(i.runDialog={}),t.size=i.runDialog||(i.runDialog={});var o=t.size;t.iframe=n.$vars.iframe,o.width=o.width||($(window).width()-100)/2-20,o.height=o.height||r.screenH-20,!t.shownOnce||e?(console.log("DIag::show",o),n.dialog({width:o.width,height:o.height,position:o.top?{my:"left top",at:"left+"+o.left+" top+"+o.top}:{my:"right top",at:"right-10 bottom+10",of:$("#navBar")},resize:function(e,r){o.width=n.width(),o.height=n.height(),t.resizeCanvas(n.width(),n.height()),r&&(o.width=r.size.width,o.height=r.size.height,o.left=r.position.left,o.top=r.position.top,t.modified=!0)},drag:function(e,n){n&&(o.left=n.position.left,o.top=n.position.top,t.modified=!0)},close:function(){t.opened=!1,t.param.onClose(),t.iframe.attr("src","about:blank")}}),t.shownOnce=!0):n.dialog(),t.iframe.attr("src","debug.html?prj="+r.prj),t.opened=!0,$(".ui-dialog-titlebar-close").blur(),t.iframe.focus(),t.resizeCanvas(n.width(),n.height()),console.log("Diag",o)}resizeCanvas(e,t){this.iframe.attr("height",t).attr("width",e);try{this.iframe[0].contentWindow.Tonyu.globals.$mainCanvas.attr("height",t).attr("width",e)}catch(e){console.log(e)}}}}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof n&&n.amd)n("BuilderClient4Sys",[],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).TonyuBuilderClient=e()}}(function(){return function(){return function e(n,r,i){function o(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof t&&t;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[a]={exports:{}};n[a][0].call(f.exports,function(e){return o(n[a][1][e]||e)},f,f.exports,e,n,r,i)}return r[a].exports}for(var s="function"==typeof t&&t,a=0;a<i.length;a++)o(i[a]);return o}}()({1:[function(e,t,n){const r=e("../lib/root"),i=r.Worker,o=e("../lib/WorkerServiceB"),s=e("../lang/SourceFiles"),a=e("../lib/FileMap"),u=r.FS;class c{constructor(e,t){this.prj=e;let n=t.worker.url;n.match(/^blob/)||(n+="?"+Math.random()),this.w=new o.Wrapper(new i(n)),this.config=t,this.fileMap=new a}getOutputFile(...e){return this.prj.getOutputFile(...e)}getDir(){return this.prj.getDir()}setDebugger(e){this.debugger=e}exec(e){if(this.debugger)return this.debugger.exec(e)}convertFromWorkerPath(e){return this.fileMap.convert(e,"remote","local")}async init(){if(this.inited)return;const e=this.fileMap,t=this.getDir(),n=t.exportAsObject({excludesF:e=>".tonyu"!==e.ext()&&"options.json"!==e.name()}),r=this.config.worker.ns2depspec,{prjDir:i}=await this.w.run("compiler/init",{namespace:this.prj.getNamespace(),files:n,ns2depspec:r});e.add({local:t,remote:i});const o=this.prj.getDependingProjects();for(let t of o){const n=t.getNamespace();if(!r[n]){const r=t.getDir(),i=r.exportAsObject({excludesF:e=>".tonyu"!==e.ext()&&"options.json"!==e.name()}),{prjDir:o}=await this.w.run("compiler/addDependingProject",{namespace:n,files:i});e.add({local:r,remote:o})}}this.inited=!0}async fullCompile(){try{await this.init();const e=await this.w.run("compiler/fullCompile");console.log(e);const t=s.add(e);return await t.saveAs(this.getOutputFile()),await this.exec(e),e}catch(e){throw this.convertError(e)}}async partialCompile(e){try{const t={};t[e.relPath(this.getDir())]=e.text(),await this.init();const n=await this.w.run("compiler/postChange",{files:t});return console.log(n),await this.exec(n),n}catch(e){throw this.convertError(e)}}async renameClassName(e,t){try{await this.init();let n=await this.w.run("compiler/renameClassName",{from:e,to:t});for(let e in n){let t=n[e];e=this.convertFromWorkerPath(e),null==t?u.get(e).rm():u.get(e).text(t)}return n}catch(e){throw this.convertError(e)}}convertError(e){return e.isTError&&(e.src=u.get(this.convertFromWorkerPath(e.src))),e}async run(){await this.init(),await this.fullCompile(),this.getDir().watch(async(e,t)=>{if(console.log(e,t.path()),".tonyu"===t.ext()){const e=await this.partialCompile(t);this.config.onCompiled&&this.config.onCompiled(e)}})}}c.SourceFiles=s,t.exports=c},{"../lang/SourceFiles":3,"../lib/FileMap":8,"../lib/WorkerServiceB":9,"../lib/root":10}],2:[function(e,t,n){const r=e("./BuilderClient"),i=e("../lang/SourceFiles"),o=e("../project/ProjectFactory"),s=e("../project/CompiledProject"),a=e("../lang/langMod"),u=e("../lang/StackDecoder"),c=e("../lang/source-map");r.SourceFiles=i,r.ProjectFactory=o,r.CompiledProject=s,r.langMod=a,r.StackDecoder=u,r.SourceMap=c,t.exports=r},{"../lang/SourceFiles":3,"../lang/StackDecoder":4,"../lang/langMod":5,"../lang/source-map":6,"../project/CompiledProject":11,"../project/ProjectFactory":12,"./BuilderClient":1}],3:[function(e,t,n){const r=e("../lib/root");let i;"undefined"!=typeof global&&global.require&&(i=global.require("vm"));class o{constructor(e,t){if("object"==typeof e){const n=e;t=n.sourceMap,e=n.text,n.url&&(this.url=n.url)}this.text=e,this.sourceMap=t&&t.toString()}async saveAs(e){const t=e.sibling(e.name()+".map");let n=this.text;this.sourceMap&&(await t.text(this.sourceMap),n+="\n//# sourceMappingURL="+t.name()),await e.text(n)}exec(t){return new Promise((n,o)=>{if(r.window){const e=r.document;let t;if(this.url)t=this.url;else{const e=new r.Blob([this.text],{type:"text/plain"});t=r.URL.createObjectURL(e)}const i=e.createElement("script");console.log("load script",t),i.setAttribute("src",t),i.addEventListener("load",e=>{n(e)}),this.parent.url2SourceFile[t]=this,e.body.appendChild(i)}else if(t&&t.tmpdir){const r=t.tmpdir.rel(Math.random()+".js"),i=r.sibling(r.name()+".map");let o=this.text;o+="\n//# sourceMappingURL="+i.name(),r.text(o),i.text(this.sourceMap),e(r.path()),r.rm(),i.rm(),n()}else if(r.importScripts&&this.url)r.importScripts(this.url),n();else{const e=Function,t=i?i.compileFunction(this.text):new e(this.text);n(t())}})}export(){return{text:this.text,sourceMap:this.sourceMap,functions:this.functions}}}t.exports=new class{constructor(){this.url2SourceFile={}}add(e,t){const n=new o(e,t);return n.parent=this,n}}},{"../lib/root":10}],4:[function(e,t,n){const r=e("./source-map"),i=e("./stacktrace"),o=e("./SourceFiles");t.exports={async decode(e){try{const t=await i.fromError(e,{offline:!0});return t.forEach(e=>{try{const t=o.url2SourceFile[e.fileName];if(console.log("sf",e.fileName,t,o.url2SourceFile),t){const n={line:e.lineNumber,column:e.columnNumber,bias:r.SourceMapConsumer.GREATEST_LOWER_BOUND},i=this.originalPositionFor(t,n);console.log("pos",n,i),i.source&&(e.fileName=i.source),i.line&&(e.lineNumber=i.line),i.column&&(e.columnNumber=i.column)}}catch(e){console.log("Sourcemap error",e)}}),console.log("Converted: ",t),t}catch(t){return console.log("StackTrace error",t),e&&e.stack?e.stack.split("\n"):(console.log("HennaError",e),[])}},originalPositionFor(e,t){const n=this.getSourceMapConsumer(e);return n?n.originalPositionFor(t):t},getSourceMapConsumer:e=>e.sourceMapConsumer?e.sourceMapConsumer:(e.sourceMapConsumer=new r.SourceMapConsumer(JSON.parse(e.sourceMap)),e.sourceMapConsumer)}},{"./SourceFiles":3,"./source-map":6,"./stacktrace":7}],5:[function(e,t,n){t.exports={getNamespace:function(){var e=this.getOptions();if(e.compiler&&e.compiler.namespace)return e.compiler.namespace;throw new Error("Namespace is not set")},async loadDependingClasses(){const e=this.getNamespace();for(let t of this.getDependingProjects())t.getNamespace()!==e&&await t.loadClasses()},getEXT:()=>".tonyu"}},{}],6:[function(e,t,n){var r,i;r=this,i=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){t.SourceMapGenerator=n(1).SourceMapGenerator,t.SourceMapConsumer=n(7).SourceMapConsumer,t.SourceNode=n(10).SourceNode},function(e,t,n){var r=n(2),i=n(4),o=n(5).ArraySet,s=n(6).MappingList;function a(e){e||(e={}),this._file=i.getArg(e,"file",null),this._sourceRoot=i.getArg(e,"sourceRoot",null),this._skipValidation=i.getArg(e,"skipValidation",!1),this._sources=new o,this._names=new o,this._mappings=new s,this._sourcesContents=null}a.prototype._version=3,a.fromSourceMap=function(e){var t=e.sourceRoot,n=new a({file:e.file,sourceRoot:t});return e.eachMapping(function(e){var r={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(r.source=e.source,null!=t&&(r.source=i.relative(t,r.source)),r.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(r.name=e.name)),n.addMapping(r)}),e.sources.forEach(function(t){var r=e.sourceContentFor(t);null!=r&&n.setSourceContent(t,r)}),n},a.prototype.addMapping=function(e){var t=i.getArg(e,"generated"),n=i.getArg(e,"original",null),r=i.getArg(e,"source",null),o=i.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,n,r,o),null!=r&&(r=String(r),this._sources.has(r)||this._sources.add(r)),null!=o&&(o=String(o),this._names.has(o)||this._names.add(o)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:r,name:o})},a.prototype.setSourceContent=function(e,t){var n=e;null!=this._sourceRoot&&(n=i.relative(this._sourceRoot,n)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[i.toSetString(n)]=t):this._sourcesContents&&(delete this._sourcesContents[i.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},a.prototype.applySourceMap=function(e,t,n){var r=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=e.file}var s=this._sourceRoot;null!=s&&(r=i.relative(s,r));var a=new o,u=new o;this._mappings.unsortedForEach(function(t){if(t.source===r&&null!=t.originalLine){var o=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=o.source&&(t.source=o.source,null!=n&&(t.source=i.join(n,t.source)),null!=s&&(t.source=i.relative(s,t.source)),t.originalLine=o.line,t.originalColumn=o.column,null!=o.name&&(t.name=o.name))}var c=t.source;null==c||a.has(c)||a.add(c);var l=t.name;null==l||u.has(l)||u.add(l)},this),this._sources=a,this._names=u,e.sources.forEach(function(t){var r=e.sourceContentFor(t);null!=r&&(null!=n&&(t=i.join(n,t)),null!=s&&(t=i.relative(s,t)),this.setSourceContent(t,r))},this)},a.prototype._validateMapping=function(e,t,n,r){if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||n||r)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:n,original:t,name:r}))},a.prototype._serializeMappings=function(){for(var e,t,n,o,s=0,a=1,u=0,c=0,l=0,f=0,p="",h=this._mappings.toArray(),d=0,g=h.length;d<g;d++){if(e="",(t=h[d]).generatedLine!==a)for(s=0;t.generatedLine!==a;)e+=";",a++;else if(d>0){if(!i.compareByGeneratedPositionsInflated(t,h[d-1]))continue;e+=","}e+=r.encode(t.generatedColumn-s),s=t.generatedColumn,null!=t.source&&(o=this._sources.indexOf(t.source),e+=r.encode(o-f),f=o,e+=r.encode(t.originalLine-1-c),c=t.originalLine-1,e+=r.encode(t.originalColumn-u),u=t.originalColumn,null!=t.name&&(n=this._names.indexOf(t.name),e+=r.encode(n-l),l=n)),p+=e}return p},a.prototype._generateSourcesContent=function(e,t){return e.map(function(e){if(!this._sourcesContents)return null;null!=t&&(e=i.relative(t,e));var n=i.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null},this)},a.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},a.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=a},function(e,t,n){var r=n(3);t.encode=function(e){var t,n="",i=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&i,(i>>>=5)>0&&(t|=32),n+=r.encode(t)}while(i>0);return n},t.decode=function(e,t,n){var i,o,s,a,u=e.length,c=0,l=0;do{if(t>=u)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=r.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));i=!!(32&o),c+=(o&=31)<<l,l+=5}while(i);n.value=(a=(s=c)>>1,1==(1&s)?-a:a),n.rest=t}},function(e,t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},function(e,t){t.getArg=function(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')};var n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,r=/^data:.+\,.+$/;function i(e){var t=e.match(n);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function o(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function s(e){var n=e,r=i(e);if(r){if(!r.path)return e;n=r.path}for(var s,a=t.isAbsolute(n),u=n.split(/\/+/),c=0,l=u.length-1;l>=0;l--)"."===(s=u[l])?u.splice(l,1):".."===s?c++:c>0&&(""===s?(u.splice(l+1,c),c=0):(u.splice(l,2),c--));return""===(n=u.join("/"))&&(n=a?"/":"."),r?(r.path=n,o(r)):n}t.urlParse=i,t.urlGenerate=o,t.normalize=s,t.join=function(e,t){""===e&&(e="."),""===t&&(t=".");var n=i(t),a=i(e);if(a&&(e=a.path||"/"),n&&!n.scheme)return a&&(n.scheme=a.scheme),o(n);if(n||t.match(r))return t;if(a&&!a.host&&!a.path)return a.host=t,o(a);var u="/"===t.charAt(0)?t:s(e.replace(/\/+$/,"")+"/"+t);return a?(a.path=u,o(a)):u},t.isAbsolute=function(e){return"/"===e.charAt(0)||!!e.match(n)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var n=0;0!==t.indexOf(e+"/");){var r=e.lastIndexOf("/");if(r<0)return t;if((e=e.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return t;++n}return Array(n+1).join("../")+t.substr(e.length+1)};var a=!("__proto__"in Object.create(null));function u(e){return e}function c(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var n=t-10;n>=0;n--)if(36!==e.charCodeAt(n))return!1;return!0}function l(e,t){return e===t?0:e>t?1:-1}t.toSetString=a?u:function(e){return c(e)?"$"+e:e},t.fromSetString=a?u:function(e){return c(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,n){var r=e.source-t.source;return 0!==r?r:0!=(r=e.originalLine-t.originalLine)?r:0!=(r=e.originalColumn-t.originalColumn)||n?r:0!=(r=e.generatedColumn-t.generatedColumn)?r:0!=(r=e.generatedLine-t.generatedLine)?r:e.name-t.name},t.compareByGeneratedPositionsDeflated=function(e,t,n){var r=e.generatedLine-t.generatedLine;return 0!==r?r:0!=(r=e.generatedColumn-t.generatedColumn)||n?r:0!=(r=e.source-t.source)?r:0!=(r=e.originalLine-t.originalLine)?r:0!=(r=e.originalColumn-t.originalColumn)?r:e.name-t.name},t.compareByGeneratedPositionsInflated=function(e,t){var n=e.generatedLine-t.generatedLine;return 0!==n?n:0!=(n=e.generatedColumn-t.generatedColumn)?n:0!==(n=l(e.source,t.source))?n:0!=(n=e.originalLine-t.originalLine)?n:0!=(n=e.originalColumn-t.originalColumn)?n:l(e.name,t.name)}},function(e,t,n){var r=n(4),i=Object.prototype.hasOwnProperty;function o(){this._array=[],this._set=Object.create(null)}o.fromArray=function(e,t){for(var n=new o,r=0,i=e.length;r<i;r++)n.add(e[r],t);return n},o.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},o.prototype.add=function(e,t){var n=r.toSetString(e),o=i.call(this._set,n),s=this._array.length;o&&!t||this._array.push(e),o||(this._set[n]=s)},o.prototype.has=function(e){var t=r.toSetString(e);return i.call(this._set,t)},o.prototype.indexOf=function(e){var t=r.toSetString(e);if(i.call(this._set,t))return this._set[t];throw new Error('"'+e+'" is not in the set.')},o.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},o.prototype.toArray=function(){return this._array.slice()},t.ArraySet=o},function(e,t,n){var r=n(4);function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}i.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},i.prototype.add=function(e){var t,n,i,o,s,a;t=this._last,n=e,i=t.generatedLine,o=n.generatedLine,s=t.generatedColumn,a=n.generatedColumn,o>i||o==i&&a>=s||r.compareByGeneratedPositionsInflated(t,n)<=0?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(r.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.MappingList=i},function(e,t,n){var r=n(4),i=n(8),o=n(5).ArraySet,s=n(2),a=n(9).quickSort;function u(e){var t=e;return"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,""))),null!=t.sections?new f(t):new c(t)}function c(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=r.getArg(t,"version"),i=r.getArg(t,"sources"),s=r.getArg(t,"names",[]),a=r.getArg(t,"sourceRoot",null),u=r.getArg(t,"sourcesContent",null),c=r.getArg(t,"mappings"),l=r.getArg(t,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);i=i.map(String).map(r.normalize).map(function(e){return a&&r.isAbsolute(a)&&r.isAbsolute(e)?r.relative(a,e):e}),this._names=o.fromArray(s.map(String),!0),this._sources=o.fromArray(i,!0),this.sourceRoot=a,this.sourcesContent=u,this._mappings=c,this.file=l}function l(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function f(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=r.getArg(t,"version"),i=r.getArg(t,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new o,this._names=new o;var s={line:-1,column:0};this._sections=i.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=r.getArg(e,"offset"),n=r.getArg(t,"line"),i=r.getArg(t,"column");if(n<s.line||n===s.line&&i<s.column)throw new Error("Section offsets must be ordered and non-overlapping.");return s=t,{generatedOffset:{generatedLine:n+1,generatedColumn:i+1},consumer:new u(r.getArg(e,"map"))}})}u.fromSourceMap=function(e){return c.fromSourceMap(e)},u.prototype._version=3,u.prototype.__generatedMappings=null,Object.defineProperty(u.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),u.prototype.__originalMappings=null,Object.defineProperty(u.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),u.prototype._charIsMappingSeparator=function(e,t){var n=e.charAt(t);return";"===n||","===n},u.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},u.GENERATED_ORDER=1,u.ORIGINAL_ORDER=2,u.GREATEST_LOWER_BOUND=1,u.LEAST_UPPER_BOUND=2,u.prototype.eachMapping=function(e,t,n){var i,o=t||null;switch(n||u.GENERATED_ORDER){case u.GENERATED_ORDER:i=this._generatedMappings;break;case u.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var s=this.sourceRoot;i.map(function(e){var t=null===e.source?null:this._sources.at(e.source);return null!=t&&null!=s&&(t=r.join(s,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}},this).forEach(e,o)},u.prototype.allGeneratedPositionsFor=function(e){var t=r.getArg(e,"line"),n={source:r.getArg(e,"source"),originalLine:t,originalColumn:r.getArg(e,"column",0)};if(null!=this.sourceRoot&&(n.source=r.relative(this.sourceRoot,n.source)),!this._sources.has(n.source))return[];n.source=this._sources.indexOf(n.source);var o=[],s=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,i.LEAST_UPPER_BOUND);if(s>=0){var a=this._originalMappings[s];if(void 0===e.column)for(var u=a.originalLine;a&&a.originalLine===u;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s];else for(var c=a.originalColumn;a&&a.originalLine===t&&a.originalColumn==c;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s]}return o},t.SourceMapConsumer=u,c.prototype=Object.create(u.prototype),c.prototype.consumer=u,c.fromSourceMap=function(e){var t=Object.create(c.prototype),n=t._names=o.fromArray(e._names.toArray(),!0),i=t._sources=o.fromArray(e._sources.toArray(),!0);t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file;for(var s=e._mappings.toArray().slice(),u=t.__generatedMappings=[],f=t.__originalMappings=[],p=0,h=s.length;p<h;p++){var d=s[p],g=new l;g.generatedLine=d.generatedLine,g.generatedColumn=d.generatedColumn,d.source&&(g.source=i.indexOf(d.source),g.originalLine=d.originalLine,g.originalColumn=d.originalColumn,d.name&&(g.name=n.indexOf(d.name)),f.push(g)),u.push(g)}return a(t.__originalMappings,r.compareByOriginalPositions),t},c.prototype._version=3,Object.defineProperty(c.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?r.join(this.sourceRoot,e):e},this)}}),c.prototype._parseMappings=function(e,t){for(var n,i,o,u,c,f=1,p=0,h=0,d=0,g=0,m=0,v=e.length,y=0,b={},w={},x=[],S=[];y<v;)if(";"===e.charAt(y))f++,y++,p=0;else if(","===e.charAt(y))y++;else{for((n=new l).generatedLine=f,u=y;u<v&&!this._charIsMappingSeparator(e,u);u++);if(o=b[i=e.slice(y,u)])y+=i.length;else{for(o=[];y<u;)s.decode(e,y,w),c=w.value,y=w.rest,o.push(c);if(2===o.length)throw new Error("Found a source, but no line and column");if(3===o.length)throw new Error("Found a source and line, but no column");b[i]=o}n.generatedColumn=p+o[0],p=n.generatedColumn,o.length>1&&(n.source=g+o[1],g+=o[1],n.originalLine=h+o[2],h=n.originalLine,n.originalLine+=1,n.originalColumn=d+o[3],d=n.originalColumn,o.length>4&&(n.name=m+o[4],m+=o[4])),S.push(n),"number"==typeof n.originalLine&&x.push(n)}a(S,r.compareByGeneratedPositionsDeflated),this.__generatedMappings=S,a(x,r.compareByOriginalPositions),this.__originalMappings=x},c.prototype._findMapping=function(e,t,n,r,o,s){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[r]);return i.search(e,t,o,s)},c.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},c.prototype.originalPositionFor=function(e){var t={generatedLine:r.getArg(e,"line"),generatedColumn:r.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",r.compareByGeneratedPositionsDeflated,r.getArg(e,"bias",u.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===t.generatedLine){var o=r.getArg(i,"source",null);null!==o&&(o=this._sources.at(o),null!=this.sourceRoot&&(o=r.join(this.sourceRoot,o)));var s=r.getArg(i,"name",null);return null!==s&&(s=this._names.at(s)),{source:o,line:r.getArg(i,"originalLine",null),column:r.getArg(i,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}},c.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return null==e}))},c.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=r.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var n;if(null!=this.sourceRoot&&(n=r.urlParse(this.sourceRoot))){var i=e.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(i))return this.sourcesContent[this._sources.indexOf(i)];if((!n.path||"/"==n.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},c.prototype.generatedPositionFor=function(e){var t=r.getArg(e,"source");if(null!=this.sourceRoot&&(t=r.relative(this.sourceRoot,t)),!this._sources.has(t))return{line:null,column:null,lastColumn:null};var n={source:t=this._sources.indexOf(t),originalLine:r.getArg(e,"line"),originalColumn:r.getArg(e,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,r.getArg(e,"bias",u.GREATEST_LOWER_BOUND));if(i>=0){var o=this._originalMappings[i];if(o.source===n.source)return{line:r.getArg(o,"generatedLine",null),column:r.getArg(o,"generatedColumn",null),lastColumn:r.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=c,f.prototype=Object.create(u.prototype),f.prototype.constructor=u,f.prototype._version=3,Object.defineProperty(f.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),f.prototype.originalPositionFor=function(e){var t={generatedLine:r.getArg(e,"line"),generatedColumn:r.getArg(e,"column")},n=i.search(t,this._sections,function(e,t){var n=e.generatedLine-t.generatedOffset.generatedLine;return n||e.generatedColumn-t.generatedOffset.generatedColumn}),o=this._sections[n];return o?o.consumer.originalPositionFor({line:t.generatedLine-(o.generatedOffset.generatedLine-1),column:t.generatedColumn-(o.generatedOffset.generatedLine===t.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},f.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})},f.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},f.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var n=this._sections[t];if(-1!==n.consumer.sources.indexOf(r.getArg(e,"source"))){var i=n.consumer.generatedPositionFor(e);if(i)return{line:i.line+(n.generatedOffset.generatedLine-1),column:i.column+(n.generatedOffset.generatedLine===i.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},f.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var i=this._sections[n],o=i.consumer._generatedMappings,s=0;s<o.length;s++){var u=o[s],c=i.consumer._sources.at(u.source);null!==i.consumer.sourceRoot&&(c=r.join(i.consumer.sourceRoot,c)),this._sources.add(c),c=this._sources.indexOf(c);var l=i.consumer._names.at(u.name);this._names.add(l),l=this._names.indexOf(l);var f={source:c,generatedLine:u.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(i.generatedOffset.generatedLine===u.generatedLine?i.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:l};this.__generatedMappings.push(f),"number"==typeof f.originalLine&&this.__originalMappings.push(f)}a(this.__generatedMappings,r.compareByGeneratedPositionsDeflated),a(this.__originalMappings,r.compareByOriginalPositions)},t.IndexedSourceMapConsumer=f},function(e,t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,n,r,i){if(0===n.length)return-1;var o=function e(n,r,i,o,s,a){var u=Math.floor((r-n)/2)+n,c=s(i,o[u],!0);return 0===c?u:c>0?r-u>1?e(u,r,i,o,s,a):a==t.LEAST_UPPER_BOUND?r<o.length?r:-1:u:u-n>1?e(n,u,i,o,s,a):a==t.LEAST_UPPER_BOUND?u:n<0?-1:n}(-1,n.length,e,n,r,i||t.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===r(n[o],n[o-1],!0);)--o;return o}},function(e,t){function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t,i,o){if(i<o){var s=i-1;n(e,(l=i,f=o,Math.round(l+Math.random()*(f-l))),o);for(var a=e[o],u=i;u<o;u++)t(e[u],a)<=0&&n(e,s+=1,u);n(e,s+1,u);var c=s+1;r(e,t,i,c-1),r(e,t,c+1,o)}var l,f}t.quickSort=function(e,t){r(e,t,0,e.length-1)}},function(e,t,n){var r=n(1).SourceMapGenerator,i=n(4),o=/(\r?\n)/,s="$$$isSourceNode$$$";function a(e,t,n,r,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==n?null:n,this.name=null==i?null:i,this[s]=!0,null!=r&&this.add(r)}a.fromStringWithSourceMap=function(e,t,n){var r=new a,s=e.split(o),u=function(){return s.shift()+(s.shift()||"")},c=1,l=0,f=null;return t.eachMapping(function(e){if(null!==f){if(!(c<e.generatedLine)){var t=(n=s[0]).substr(0,e.generatedColumn-l);return s[0]=n.substr(e.generatedColumn-l),l=e.generatedColumn,p(f,t),void(f=e)}p(f,u()),c++,l=0}for(;c<e.generatedLine;)r.add(u()),c++;if(l<e.generatedColumn){var n=s[0];r.add(n.substr(0,e.generatedColumn)),s[0]=n.substr(e.generatedColumn),l=e.generatedColumn}f=e},this),s.length>0&&(f&&p(f,u()),r.add(s.join(""))),t.sources.forEach(function(e){var o=t.sourceContentFor(e);null!=o&&(null!=n&&(e=i.join(n,e)),r.setSourceContent(e,o))}),r;function p(e,t){if(null===e||void 0===e.source)r.add(t);else{var o=n?i.join(n,e.source):e.source;r.add(new a(e.originalLine,e.originalColumn,o,t,e.name))}}},a.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},a.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},a.prototype.walk=function(e){for(var t,n=0,r=this.children.length;n<r;n++)(t=this.children[n])[s]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},a.prototype.join=function(e){var t,n,r=this.children.length;if(r>0){for(t=[],n=0;n<r-1;n++)t.push(this.children[n]),t.push(e);t.push(this.children[n]),this.children=t}return this},a.prototype.replaceRight=function(e,t){var n=this.children[this.children.length-1];return n[s]?n.replaceRight(e,t):"string"==typeof n?this.children[this.children.length-1]=n.replace(e,t):this.children.push("".replace(e,t)),this},a.prototype.setSourceContent=function(e,t){this.sourceContents[i.toSetString(e)]=t},a.prototype.walkSourceContents=function(e){for(var t=0,n=this.children.length;t<n;t++)this.children[t][s]&&this.children[t].walkSourceContents(e);var r=Object.keys(this.sourceContents);for(t=0,n=r.length;t<n;t++)e(i.fromSetString(r[t]),this.sourceContents[r[t]])},a.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},a.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},n=new r(e),i=!1,o=null,s=null,a=null,u=null;return this.walk(function(e,r){t.code+=e,null!==r.source&&null!==r.line&&null!==r.column?(o===r.source&&s===r.line&&a===r.column&&u===r.name||n.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:t.line,column:t.column},name:r.name}),o=r.source,s=r.line,a=r.column,u=r.name,i=!0):i&&(n.addMapping({generated:{line:t.line,column:t.column}}),o=null,i=!1);for(var c=0,l=e.length;c<l;c++)10===e.charCodeAt(c)?(t.line++,t.column=0,c+1===l?(o=null,i=!1):i&&n.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:t.line,column:t.column},name:r.name})):t.column++}),this.walkSourceContents(function(e,t){n.setSourceContent(e,t)}),{code:t.code,map:n}},t.SourceNode=a}])},"object"==typeof n&&"object"==typeof t?t.exports=i():"object"==typeof n?n.sourceMap=i():r.sourceMap=i()},{}],7:[function(e,t,n){!function(e){"object"==typeof n&&void 0!==t?t.exports=e():("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).StackTrace=e()}(function(){return function t(n,r,i){function o(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof e&&e;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[a]={exports:{}};n[a][0].call(f.exports,function(e){var t=n[a][1][e];return o(t||e)},f,f.exports,t,n,r,i)}return r[a].exports}for(var s="function"==typeof e&&e,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){!function(r,i){"use strict";"object"==typeof n?t.exports=i(e("stackframe")):r.ErrorStackParser=i(r.StackFrame)}(this,function(e){"use strict";var t=/(^|@)\S+\:\d+/,n=/^\s*at .*(\S+\:\d+|\(native\))/m,r=/^(eval@)?(\[native code\])?$/;return{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(n))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(e.replace(/[\(\)]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(t){return t.stack.split("\n").filter(function(e){return!!e.match(n)},this).map(function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var n=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),r=this.extractLocation(n.pop()),i=n.join(" ")||void 0,o=["eval","<anonymous>"].indexOf(r[0])>-1?void 0:r[0];return new e({functionName:i,fileName:o,lineNumber:r[1],columnNumber:r[2],source:t})},this)},parseFFOrSafari:function(t){return t.stack.split("\n").filter(function(e){return!e.match(r)},this).map(function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e({functionName:t});var n=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=t.match(n),i=r&&r[1]?r[1]:void 0,o=this.extractLocation(t.replace(n,""));return new e({functionName:i,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:t})},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,r=t.message.split("\n"),i=[],o=2,s=r.length;o<s;o+=2){var a=n.exec(r[o]);a&&i.push(new e({fileName:a[2],lineNumber:a[1],source:r[o]}))}return i},parseOpera10:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=t.stacktrace.split("\n"),i=[],o=0,s=r.length;o<s;o+=2){var a=n.exec(r[o]);a&&i.push(new e({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:r[o]}))}return i},parseOpera11:function(n){return n.stack.split("\n").filter(function(e){return!!e.match(t)&&!e.match(/^Error created at/)},this).map(function(t){var n,r=t.split("@"),i=this.extractLocation(r.pop()),o=r.shift()||"",s=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;o.match(/\(([^\)]*)\)/)&&(n=o.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var a=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new e({functionName:s,args:a,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:t})},this)}}})},{stackframe:3}],2:[function(e,t,n){!function(r,i){"use strict";"object"==typeof n?t.exports=i(e("stackframe")):r.StackGenerator=i(r.StackFrame)}(this,function(e){return{backtrace:function(t){var n=[],r=10;"object"==typeof t&&"number"==typeof t.maxStackSize&&(r=t.maxStackSize);for(var i=arguments.callee;i&&n.length<r&&i.arguments;){for(var o=new Array(i.arguments.length),s=0;s<o.length;++s)o[s]=i.arguments[s];/function(?:\s+([\w$]+))+\s*\(/.test(i.toString())?n.push(new e({functionName:RegExp.$1||void 0,args:o})):n.push(new e({args:o}));try{i=i.caller}catch(e){break}}return n}}})},{stackframe:3}],3:[function(e,t,n){!function(e,r){"use strict";"object"==typeof n?t.exports=r():e.StackFrame=r()}(this,function(){"use strict";function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}function t(e){return e.charAt(0).toUpperCase()+e.substring(1)}function n(e){return function(){return this[e]}}function r(e){if(e instanceof Object)for(var n=0;n<a.length;n++)e.hasOwnProperty(a[n])&&void 0!==e[a[n]]&&this["set"+t(a[n])](e[a[n]])}var i=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],s=["fileName","functionName","source"],a=i.concat(o,s,["args"]);r.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof r)this.evalOrigin=e;else{if(!(e instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new r(e)}},toString:function(){return(this.getFunctionName()||"{anonymous}")+("("+(this.getArgs()||[]).join(",")+")")+(this.getFileName()?"@"+this.getFileName():"")+(e(this.getLineNumber())?":"+this.getLineNumber():"")+(e(this.getColumnNumber())?":"+this.getColumnNumber():"")}};for(var u=0;u<i.length;u++)r.prototype["get"+t(i[u])]=n(i[u]),r.prototype["set"+t(i[u])]=function(e){return function(t){this[e]=Boolean(t)}}(i[u]);for(var c=0;c<o.length;c++)r.prototype["get"+t(o[c])]=n(o[c]),r.prototype["set"+t(o[c])]=function(t){return function(n){if(!e(n))throw new TypeError(t+" must be a Number");this[t]=Number(n)}}(o[c]);for(var l=0;l<s.length;l++)r.prototype["get"+t(s[l])]=n(s[l]),r.prototype["set"+t(s[l])]=function(e){return function(t){this[e]=String(t)}}(s[l]);return r})},{}],4:[function(e,t,n){function r(){this._array=[],this._set=Object.create(null)}var i=e("./util"),o=Object.prototype.hasOwnProperty;r.fromArray=function(e,t){for(var n=new r,i=0,o=e.length;i<o;i++)n.add(e[i],t);return n},r.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},r.prototype.add=function(e,t){var n=i.toSetString(e),r=o.call(this._set,n),s=this._array.length;r&&!t||this._array.push(e),r||(this._set[n]=s)},r.prototype.has=function(e){var t=i.toSetString(e);return o.call(this._set,t)},r.prototype.indexOf=function(e){var t=i.toSetString(e);if(o.call(this._set,t))return this._set[t];throw new Error('"'+e+'" is not in the set.')},r.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},r.prototype.toArray=function(){return this._array.slice()},n.ArraySet=r},{"./util":10}],5:[function(e,t,n){var r=e("./base64");n.encode=function(e){var t,n="",i=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&i,(i>>>=5)>0&&(t|=32),n+=r.encode(t)}while(i>0);return n},n.decode=function(e,t,n){var i,o,s=e.length,a=0,u=0;do{if(t>=s)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=r.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));i=!!(32&o),a+=(o&=31)<<u,u+=5}while(i);n.value=function(e){var t=e>>1;return 1==(1&e)?-t:t}(a),n.rest=t}},{"./base64":6}],6:[function(e,t,n){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");n.encode=function(e){if(0<=e&&e<r.length)return r[e];throw new TypeError("Must be between 0 and 63: "+e)},n.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},{}],7:[function(e,t,n){n.GREATEST_LOWER_BOUND=1,n.LEAST_UPPER_BOUND=2,n.search=function(e,t,r,i){if(0===t.length)return-1;var o=function e(t,r,i,o,s,a){var u=Math.floor((r-t)/2)+t,c=s(i,o[u],!0);return 0===c?u:c>0?r-u>1?e(u,r,i,o,s,a):a==n.LEAST_UPPER_BOUND?r<o.length?r:-1:u:u-t>1?e(t,u,i,o,s,a):a==n.LEAST_UPPER_BOUND?u:t<0?-1:t}(-1,t.length,e,t,r,i||n.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===r(t[o],t[o-1],!0);)--o;return o}},{}],8:[function(e,t,n){function r(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function i(e,t,n,o){if(n<o){var s=n-1;r(e,function(e,t){return Math.round(e+Math.random()*(t-e))}(n,o),o);for(var a=e[o],u=n;u<o;u++)t(e[u],a)<=0&&r(e,s+=1,u);r(e,s+1,u);var c=s+1;i(e,t,n,c-1),i(e,t,c+1,o)}}n.quickSort=function(e,t){i(e,t,0,e.length-1)}},{}],9:[function(e,t,n){function r(e){var t=e;return"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,""))),null!=t.sections?new s(t):new i(t)}function i(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=a.getArg(t,"version"),r=a.getArg(t,"sources"),i=a.getArg(t,"names",[]),o=a.getArg(t,"sourceRoot",null),s=a.getArg(t,"sourcesContent",null),u=a.getArg(t,"mappings"),l=a.getArg(t,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);r=r.map(String).map(a.normalize).map(function(e){return o&&a.isAbsolute(o)&&a.isAbsolute(e)?a.relative(o,e):e}),this._names=c.fromArray(i.map(String),!0),this._sources=c.fromArray(r,!0),this.sourceRoot=o,this.sourcesContent=s,this._mappings=u,this.file=l}function o(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function s(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=a.getArg(t,"version"),i=a.getArg(t,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new c,this._names=new c;var o={line:-1,column:0};this._sections=i.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=a.getArg(e,"offset"),n=a.getArg(t,"line"),i=a.getArg(t,"column");if(n<o.line||n===o.line&&i<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=t,{generatedOffset:{generatedLine:n+1,generatedColumn:i+1},consumer:new r(a.getArg(e,"map"))}})}var a=e("./util"),u=e("./binary-search"),c=e("./array-set").ArraySet,l=e("./base64-vlq"),f=e("./quick-sort").quickSort;r.fromSourceMap=function(e){return i.fromSourceMap(e)},r.prototype._version=3,r.prototype.__generatedMappings=null,Object.defineProperty(r.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),r.prototype.__originalMappings=null,Object.defineProperty(r.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),r.prototype._charIsMappingSeparator=function(e,t){var n=e.charAt(t);return";"===n||","===n},r.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},r.GENERATED_ORDER=1,r.ORIGINAL_ORDER=2,r.GREATEST_LOWER_BOUND=1,r.LEAST_UPPER_BOUND=2,r.prototype.eachMapping=function(e,t,n){var i,o=t||null;switch(n||r.GENERATED_ORDER){case r.GENERATED_ORDER:i=this._generatedMappings;break;case r.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var s=this.sourceRoot;i.map(function(e){var t=null===e.source?null:this._sources.at(e.source);return null!=t&&null!=s&&(t=a.join(s,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}},this).forEach(e,o)},r.prototype.allGeneratedPositionsFor=function(e){var t=a.getArg(e,"line"),n={source:a.getArg(e,"source"),originalLine:t,originalColumn:a.getArg(e,"column",0)};if(null!=this.sourceRoot&&(n.source=a.relative(this.sourceRoot,n.source)),!this._sources.has(n.source))return[];n.source=this._sources.indexOf(n.source);var r=[],i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,u.LEAST_UPPER_BOUND);if(i>=0){var o=this._originalMappings[i];if(void 0===e.column)for(var s=o.originalLine;o&&o.originalLine===s;)r.push({line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++i];else for(var c=o.originalColumn;o&&o.originalLine===t&&o.originalColumn==c;)r.push({line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++i]}return r},n.SourceMapConsumer=r,i.prototype=Object.create(r.prototype),i.prototype.consumer=r,i.fromSourceMap=function(e){var t=Object.create(i.prototype),n=t._names=c.fromArray(e._names.toArray(),!0),r=t._sources=c.fromArray(e._sources.toArray(),!0);t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file;for(var s=e._mappings.toArray().slice(),u=t.__generatedMappings=[],l=t.__originalMappings=[],p=0,h=s.length;p<h;p++){var d=s[p],g=new o;g.generatedLine=d.generatedLine,g.generatedColumn=d.generatedColumn,d.source&&(g.source=r.indexOf(d.source),g.originalLine=d.originalLine,g.originalColumn=d.originalColumn,d.name&&(g.name=n.indexOf(d.name)),l.push(g)),u.push(g)}return f(t.__originalMappings,a.compareByOriginalPositions),t},i.prototype._version=3,Object.defineProperty(i.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?a.join(this.sourceRoot,e):e},this)}}),i.prototype._parseMappings=function(e,t){for(var n,r,i,s,u,c=1,p=0,h=0,d=0,g=0,m=0,v=e.length,y=0,b={},w={},x=[],S=[];y<v;)if(";"===e.charAt(y))c++,y++,p=0;else if(","===e.charAt(y))y++;else{for((n=new o).generatedLine=c,s=y;s<v&&!this._charIsMappingSeparator(e,s);s++);if(i=b[r=e.slice(y,s)])y+=r.length;else{for(i=[];y<s;)l.decode(e,y,w),u=w.value,y=w.rest,i.push(u);if(2===i.length)throw new Error("Found a source, but no line and column");if(3===i.length)throw new Error("Found a source and line, but no column");b[r]=i}n.generatedColumn=p+i[0],p=n.generatedColumn,i.length>1&&(n.source=g+i[1],g+=i[1],n.originalLine=h+i[2],h=n.originalLine,n.originalLine+=1,n.originalColumn=d+i[3],d=n.originalColumn,i.length>4&&(n.name=m+i[4],m+=i[4])),S.push(n),"number"==typeof n.originalLine&&x.push(n)}f(S,a.compareByGeneratedPositionsDeflated),this.__generatedMappings=S,f(x,a.compareByOriginalPositions),this.__originalMappings=x},i.prototype._findMapping=function(e,t,n,r,i,o){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[r]);return u.search(e,t,i,o)},i.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},i.prototype.originalPositionFor=function(e){var t={generatedLine:a.getArg(e,"line"),generatedColumn:a.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",a.compareByGeneratedPositionsDeflated,a.getArg(e,"bias",r.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===t.generatedLine){var o=a.getArg(i,"source",null);null!==o&&(o=this._sources.at(o),null!=this.sourceRoot&&(o=a.join(this.sourceRoot,o)));var s=a.getArg(i,"name",null);return null!==s&&(s=this._names.at(s)),{source:o,line:a.getArg(i,"originalLine",null),column:a.getArg(i,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}},i.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return null==e})},i.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=a.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var n;if(null!=this.sourceRoot&&(n=a.urlParse(this.sourceRoot))){var r=e.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(r))return this.sourcesContent[this._sources.indexOf(r)];if((!n.path||"/"==n.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},i.prototype.generatedPositionFor=function(e){var t=a.getArg(e,"source");if(null!=this.sourceRoot&&(t=a.relative(this.sourceRoot,t)),!this._sources.has(t))return{line:null,column:null,lastColumn:null};var n={source:t=this._sources.indexOf(t),originalLine:a.getArg(e,"line"),originalColumn:a.getArg(e,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,a.getArg(e,"bias",r.GREATEST_LOWER_BOUND));if(i>=0){var o=this._originalMappings[i];if(o.source===n.source)return{line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},n.BasicSourceMapConsumer=i,s.prototype=Object.create(r.prototype),s.prototype.constructor=r,s.prototype._version=3,Object.defineProperty(s.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),s.prototype.originalPositionFor=function(e){var t={generatedLine:a.getArg(e,"line"),generatedColumn:a.getArg(e,"column")},n=u.search(t,this._sections,function(e,t){var n=e.generatedLine-t.generatedOffset.generatedLine;return n||e.generatedColumn-t.generatedOffset.generatedColumn}),r=this._sections[n];return r?r.consumer.originalPositionFor({line:t.generatedLine-(r.generatedOffset.generatedLine-1),column:t.generatedColumn-(r.generatedOffset.generatedLine===t.generatedLine?r.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},s.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})},s.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},s.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var n=this._sections[t];if(-1!==n.consumer.sources.indexOf(a.getArg(e,"source"))){var r=n.consumer.generatedPositionFor(e);if(r)return{line:r.line+(n.generatedOffset.generatedLine-1),column:r.column+(n.generatedOffset.generatedLine===r.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},s.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var r=this._sections[n],i=r.consumer._generatedMappings,o=0;o<i.length;o++){var s=i[o],u=r.consumer._sources.at(s.source);null!==r.consumer.sourceRoot&&(u=a.join(r.consumer.sourceRoot,u)),this._sources.add(u),u=this._sources.indexOf(u);var c=r.consumer._names.at(s.name);this._names.add(c),c=this._names.indexOf(c);var l={source:u,generatedLine:s.generatedLine+(r.generatedOffset.generatedLine-1),generatedColumn:s.generatedColumn+(r.generatedOffset.generatedLine===s.generatedLine?r.generatedOffset.generatedColumn-1:0),originalLine:s.originalLine,originalColumn:s.originalColumn,name:c};this.__generatedMappings.push(l),"number"==typeof l.originalLine&&this.__originalMappings.push(l)}f(this.__generatedMappings,a.compareByGeneratedPositionsDeflated),f(this.__originalMappings,a.compareByOriginalPositions)},n.IndexedSourceMapConsumer=s},{"./array-set":4,"./base64-vlq":5,"./binary-search":7,"./quick-sort":8,"./util":10}],10:[function(e,t,n){function r(e){var t=e.match(c);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function o(e){var t=e,o=r(e);if(o){if(!o.path)return e;t=o.path}for(var s,a=n.isAbsolute(t),u=t.split(/\/+/),c=0,l=u.length-1;l>=0;l--)"."===(s=u[l])?u.splice(l,1):".."===s?c++:c>0&&(""===s?(u.splice(l+1,c),c=0):(u.splice(l,2),c--));return""===(t=u.join("/"))&&(t=a?"/":"."),o?(o.path=t,i(o)):t}function s(e){return e}function a(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var n=t-10;n>=0;n--)if(36!==e.charCodeAt(n))return!1;return!0}function u(e,t){return e===t?0:e>t?1:-1}n.getArg=function(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')};var c=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,l=/^data:.+\,.+$/;n.urlParse=r,n.urlGenerate=i,n.normalize=o,n.join=function(e,t){""===e&&(e="."),""===t&&(t=".");var n=r(t),s=r(e);if(s&&(e=s.path||"/"),n&&!n.scheme)return s&&(n.scheme=s.scheme),i(n);if(n||t.match(l))return t;if(s&&!s.host&&!s.path)return s.host=t,i(s);var a="/"===t.charAt(0)?t:o(e.replace(/\/+$/,"")+"/"+t);return s?(s.path=a,i(s)):a},n.isAbsolute=function(e){return"/"===e.charAt(0)||!!e.match(c)},n.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var n=0;0!==t.indexOf(e+"/");){var r=e.lastIndexOf("/");if(r<0)return t;if((e=e.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return t;++n}return Array(n+1).join("../")+t.substr(e.length+1)};var f=!("__proto__"in Object.create(null));n.toSetString=f?s:function(e){return a(e)?"$"+e:e},n.fromSetString=f?s:function(e){return a(e)?e.slice(1):e},n.compareByOriginalPositions=function(e,t,n){var r=e.source-t.source;return 0!==r?r:0!=(r=e.originalLine-t.originalLine)?r:0!=(r=e.originalColumn-t.originalColumn)||n?r:0!=(r=e.generatedColumn-t.generatedColumn)?r:0!=(r=e.generatedLine-t.generatedLine)?r:e.name-t.name},n.compareByGeneratedPositionsDeflated=function(e,t,n){var r=e.generatedLine-t.generatedLine;return 0!==r?r:0!=(r=e.generatedColumn-t.generatedColumn)||n?r:0!=(r=e.source-t.source)?r:0!=(r=e.originalLine-t.originalLine)?r:0!=(r=e.originalColumn-t.originalColumn)?r:e.name-t.name},n.compareByGeneratedPositionsInflated=function(e,t){var n=e.generatedLine-t.generatedLine;return 0!==n?n:0!=(n=e.generatedColumn-t.generatedColumn)?n:0!==(n=u(e.source,t.source))?n:0!=(n=e.originalLine-t.originalLine)?n:0!=(n=e.originalColumn-t.originalColumn)?n:u(e.name,t.name)}},{}],11:[function(e,t,n){!function(r,i){"use strict";"object"==typeof n?t.exports=i(e("source-map/lib/source-map-consumer"),e("stackframe")):r.StackTraceGPS=i(r.SourceMap||r.sourceMap,r.StackFrame)}(this,function(e,t){"use strict";function n(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("get",e),r.onerror=n,r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300||"file://"===e.substr(0,7)&&r.responseText?t(r.responseText):n(new Error("HTTP status: "+r.status+" retrieving "+e)))},r.send()})}function r(e){if("undefined"!=typeof window&&window.atob)return window.atob(e);throw new Error("You must supply a polyfill for window.atob in this environment")}function i(e){if("object"!=typeof e)throw new TypeError("Given StackFrame is not an object");if("string"!=typeof e.fileName)throw new TypeError("Given file name is not a String");if("number"!=typeof e.lineNumber||e.lineNumber%1!=0||e.lineNumber<1)throw new TypeError("Given line number must be a positive integer");if("number"!=typeof e.columnNumber||e.columnNumber%1!=0||e.columnNumber<0)throw new TypeError("Given column number must be a non-negative integer");return!0}function o(e,n,r){return new Promise(function(i,o){var s=n.originalPositionFor({line:e.lineNumber,column:e.columnNumber});if(s.source){var a=n.sourceContentFor(s.source);a&&(r[s.source]=a),i(new t({functionName:s.name||e.functionName,args:e.args,fileName:s.source,lineNumber:s.line,columnNumber:s.column}))}else o(new Error("Could not get original source for given stackframe and source map"))})}return function s(a){return this instanceof s?(a=a||{},this.sourceCache=a.sourceCache||{},this.sourceMapConsumerCache=a.sourceMapConsumerCache||{},this.ajax=a.ajax||n,this._atob=a.atob||r,this._get=function(e){return new Promise(function(t,n){var r="data:"===e.substr(0,5);if(this.sourceCache[e])t(this.sourceCache[e]);else if(a.offline&&!r)n(new Error("Cannot make network requests in offline mode"));else if(r){var i=e.match(/^data:application\/json;([\w=:"-]+;)*base64,/);if(i){var o=i[0].length,s=e.substr(o),u=this._atob(s);this.sourceCache[e]=u,t(u)}else n(new Error("The encoding of the inline sourcemap is not supported"))}else{var c=this.ajax(e,{method:"get"});this.sourceCache[e]=c,c.then(t,n)}}.bind(this))},this._getSourceMapConsumer=function(t,n){return new Promise(function(r,i){if(this.sourceMapConsumerCache[t])r(this.sourceMapConsumerCache[t]);else{var o=new Promise(function(r,i){return this._get(t).then(function(t){"string"==typeof t&&(t=function(e){if("undefined"!=typeof JSON&&JSON.parse)return JSON.parse(e);throw new Error("You must supply a polyfill for JSON.parse in this environment")}(t.replace(/^\)\]\}'/,""))),void 0===t.sourceRoot&&(t.sourceRoot=n),r(new e.SourceMapConsumer(t))},i)}.bind(this));this.sourceMapConsumerCache[t]=o,r(o)}}.bind(this))},this.pinpoint=function(e){return new Promise(function(t,n){this.getMappedLocation(e).then(function(e){function n(){t(e)}this.findFunctionName(e).then(t,n).catch(n)}.bind(this),n)}.bind(this))},this.findFunctionName=function(e){return new Promise(function(n,r){i(e),this._get(e.fileName).then(function(r){var i=e.lineNumber,o=e.columnNumber,s=function(e,t){for(var n=[/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,/function\s+([^('"`]*?)\s*\(([^)]*)\)/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,/\b(?!(?:if|for|switch|while|with|catch)\b)(?:(?:static)\s+)?(\S+)\s*\(.*?\)\s*\{/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*\(.*?\)\s*=>/],r=e.split("\n"),i="",o=Math.min(t,20),s=0;s<o;++s){var a=r[t-s-1],u=a.indexOf("//");if(u>=0&&(a=a.substr(0,u)),a){i=a+i;for(var c=n.length,l=0;l<c;l++){var f=n[l].exec(i);if(f&&f[1])return f[1]}}}}(r,i);n(s?new t({functionName:s,args:e.args,fileName:e.fileName,lineNumber:i,columnNumber:o}):e)},r).catch(r)}.bind(this))},void(this.getMappedLocation=function(e){return new Promise(function(t,n){(function(){if("function"!=typeof Object.defineProperty||"function"!=typeof Object.create)throw new Error("Unable to consume source maps in older browsers")})(),i(e);var r=this.sourceCache,s=e.fileName;this._get(s).then(function(n){var i=function(e){for(var t,n,r=/\/\/[#@] ?sourceMappingURL=([^\s'"]+)\s*$/gm;n=r.exec(e);)t=n[1];if(t)return t;throw new Error("sourceMappingURL not found")}(n),a="data:"===i.substr(0,5),u=s.substring(0,s.lastIndexOf("/")+1);return"/"===i[0]||a||/^https?:\/\/|^\/\//i.test(i)||(i=u+i),this._getSourceMapConsumer(i,u).then(function(n){return o(e,n,r).then(t).catch(function(){t(e)})})}.bind(this),n).catch(n)}.bind(this))})):new s(a)}})},{"source-map/lib/source-map-consumer":9,stackframe:3}],12:[function(e,t,n){!function(r,i){"use strict";"object"==typeof n?t.exports=i(e("error-stack-parser"),e("stack-generator"),e("stacktrace-gps")):r.StackTrace=i(r.ErrorStackParser,r.StackGenerator,r.StackTraceGPS)}(this,function(e,t,n){function r(e,t){var n={};return[e,t].forEach(function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}),n}function i(e){return e.stack||e["opera#sourceloc"]}function o(e,t){return"function"==typeof t?e.filter(t):e}var s={filter:function(e){return-1===(e.functionName||"").indexOf("StackTrace$$")&&-1===(e.functionName||"").indexOf("ErrorStackParser$$")&&-1===(e.functionName||"").indexOf("StackTraceGPS$$")&&-1===(e.functionName||"").indexOf("StackGenerator$$")},sourceCache:{}},a=function(){try{throw new Error}catch(e){return e}};return{get:function(e){var t=a();return i(t)?this.fromError(t,e):this.generateArtificially(e)},getSync:function(n){n=r(s,n);var u=a();return o(i(u)?e.parse(u):t.backtrace(n),n.filter)},fromError:function(t,i){i=r(s,i);var a=new n(i);return new Promise(function(n){var r=o(e.parse(t),i.filter);n(Promise.all(r.map(function(e){return new Promise(function(t){function n(){t(e)}a.pinpoint(e).then(t,n).catch(n)})})))}.bind(this))},generateArtificially:function(e){e=r(s,e);var n=t.backtrace(e);return"function"==typeof e.filter&&(n=n.filter(e.filter)),Promise.resolve(n)},instrument:function(e,t,n,r){if("function"!=typeof e)throw new Error("Cannot instrument non-function object");if("function"==typeof e.__stacktraceOriginalFn)return e;var o=function(){try{return this.get().then(t,n).catch(n),e.apply(r||this,arguments)}catch(e){throw i(e)&&this.fromError(e).then(t,n).catch(n),e}}.bind(this);return o.__stacktraceOriginalFn=e,o},deinstrument:function(e){if("function"!=typeof e)throw new Error("Cannot de-instrument non-function object");return"function"==typeof e.__stacktraceOriginalFn?e.__stacktraceOriginalFn:e},report:function(e,t,n,r){return new Promise(function(i,o){var s=new XMLHttpRequest;if(s.onerror=o,s.onreadystatechange=function(){4===s.readyState&&(s.status>=200&&s.status<400?i(s.responseText):o(new Error("POST to "+t+" failed with status: "+s.status)))},s.open("post",t),s.setRequestHeader("Content-Type","application/json"),r&&"object"==typeof r.headers){var a=r.headers;for(var u in a)a.hasOwnProperty(u)&&s.setRequestHeader(u,a[u])}var c={stack:e};void 0!==n&&null!==n&&(c.message=n),s.send(JSON.stringify(c))})}}})},{"error-stack-parser":1,"stack-generator":2,"stacktrace-gps":11}]},{},[12])(12)})},{}],8:[function(e,t,n){t.exports=class{constructor(){this.sidesList=[]}add(e){this.sidesList.push(e)}convert(e,t,n){for(let r of this.sidesList)if(e.startsWith(r[t]))return r[n]+e.substring(r[t].length);return e}}},{}],9:[function(e,t,n){class r{constructor(e){const t=this;t.idseq=1,t.queue={},t.worker=e,t.readyQueue=[],e.addEventListener("message",function(e){var n=e.data;n.reverse?t.procReverse(e):n.ready?t.ready():n.id&&(t.queue[n.id](n),delete t.queue[n.id])}),t.run("WorkerService/isReady").then(function(e){e&&t.ready()})}procReverse(e){const t=this;var n=e.data,r=n.id,o=n.path,s=n.params;try{Promise.resolve(i[o](s)).then(function(e){t.worker.postMessage({reverse:!0,status:"ok",id:r,result:e})},a)}catch(e){a(e)}function a(e){e=Object.assign({name:e.name,message:e.message,stack:e.stack},e||{});try{const t=JSON.stringify(e);e=JSON.parse(t)}catch(t){e=e?e.message||e+"":"unknown",console.log("WorkerServiceW",t,e)}t.worker.postMessage({reverse:!0,id:r,error:e,status:"error"})}}ready(){const e=this;e.isReady||(e.isReady=!0,console.log("Worker is ready!"),e.readyQueue.forEach(function(e){e()}))}readyPromise(){const e=this;return new Promise(function(t){if(e.isReady)return t();e.readyQueue.push(t)})}run(e,t){const n=this;return n.readyPromise().then(function(){return new Promise(function(r,i){var o=n.idseq++;n.queue[o]=function(e){"ok"==e.status?r(e.result):i(e.error)},n.worker.postMessage({id:o,path:e,params:t})})})}terminate(){this.worker.terminate()}}var i={};const o={Wrapper:r,load:function(e){var t=new Worker(e);return new r(t)},install:function(e,t){i[e]=t},serv:function(e,t){this.install(e,t)}};o.serv("console/log",function(e){console.log.apply(console,e)}),t.exports=o},{}],10:[function(e,t,n){t.exports="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()},{}],11:[function(e,t,n){const r=e("./ProjectFactory"),i=(e("../lib/root"),e("../lang/SourceFiles")),o=e("../lang/langMod");var s;r.addType("compiled",e=>{if(e.namespace&&e.url)return function(e){const t=e.namespace,n=e.url;return r.createCore().include(o).include({getNamespace:function(){return t},loadClasses:async function(e){console.log("Loading compiled classes ns=",t,"url=",n),await this.loadDependingClasses();const r=i.add({url:n});await r.exec(),console.log("Loaded compiled classes ns=",t,"url=",n)}})}(e);if(e.dir)return e=e,r.createDirBasedCore(e).include(o).include({loadClasses:async function(t){console.log("Loading compiled classes params=",e),await this.loadDependingClasses();const n=this.getOutputFile(),r=n.sibling(n.name()+".map"),o=i.add({text:n.text(),sourceMap:r.exists()&&r.text()});await o.exec(),console.log("Loaded compiled classes params=",e)}});throw console.error("Invalid compiled project",e),new Error("Invalid compiled project")}),n.create=(e=>r.create("compiled",e)),r.addDependencyResolver((e,t)=>t.dir&&e.resolve?r.create("compiled",{dir:e.resolve(t.dir)}):t.namespace&&t.url?r.create("compiled",t):void 0)},{"../lang/SourceFiles":3,"../lang/langMod":5,"../lib/root":10,"./ProjectFactory":12}],12:[function(e,t,n){const r=[],i={};n.addDependencyResolver=(e=>{r.push(e)}),n.addType=((e,t)=>{i[e]=t}),n.fromDependencySpec=function(e,t){if("string"==typeof t){var n=e.resolve(t);return this.fromDir(n)}for(let n of r){const r=n(e,t);if(r)return r}throw console.error("Invalid dep spec",t),new Error("Invalid dep spec",t)},n.create=function(e,t){if(!i[e])throw new Error(`Invalid type ${e}`);return i[e](t)};class o{getPublishedURL(){}getOptions(e){return{}}getName(){return this.dir.name().replace(/\/$/,"")}getDependingProjects(){var e=this.getOptions();return(e.compiler&&e.compiler.dependingProjects||[]).map(e=>o.factory.fromDependencySpec(this,e))}include(e){for(let t of Object.getOwnPropertyNames(e))"function"==typeof e[t]&&(this[t]=e[t]);return this}delegate(e){if(e.constructor.prototype){const t=t=>{"function"==typeof e[t]&&(this[t]=((...n)=>e[t](...n)))};for(let n of Object.getOwnPropertyNames(e.constructor.prototype))t(n)}return this}}o.factory=n,n.createCore=(()=>new o);const s={getDir(){return this.dir},resolve(e){if(e instanceof Array){var t=[];return e.forEach(function(e){t.push(this.resolve(e))}),t}if("string"==typeof e)return"undefined"!=typeof FS?FS.resolve(e,this.getDir().path()):this.getDir().rel(e);if(!e||!e.isDir)throw new Error("Cannot TPR.resolve: "+e);return e},getOptions(e){return this.getOptionsFile().obj()},getOptionsFile(){return this.dir.rel("options.json")},setOptions(e){return this.getOptionsFile().obj(e)},getOutputFile(e){var t=this.getOptions(),n=this.resolve(t.compiler.outputFile||"js/concat.js");if(n.isDir())throw new Error("out: directory style not supported");return n},removeOutputFile(){this.getOutputFile().rm()},path(){return this.dir.path()},getEXT(){throw new Error("getEXT must be overriden.")},sourceFiles(){const e={},t=this.getEXT();return this.dir.recursive(function(n){if(n.endsWith(t)){var r=n.truncExt(t);e[r]=n}}),e}};n.createDirBasedCore=function(e){const t=this.createCore();return t.dir=e.dir,t.include(s)}},{}]},{},[2])(2)}),n("ProjectFactory",["require","exports","module","BuilderClient4Sys"],function(e,t,n){const r=e("BuilderClient4Sys");n.exports=r.ProjectFactory}),n("BuilderClient",["require","exports","module","BuilderClient4Sys"],function(e,t,n){const r=e("BuilderClient4Sys");n.exports=r}),n("Content",["FS"],function(e){return e.Content}),n("thumbnail",["ImageRect","Content"],function(e,t){var n={},r="$icon_thumbnail",i=200;return HEIGHT=200,n.set=function(t,o){setTimeout(function(){!function(t){try{var o=Tonyu.globals.$Screen.buf[0],s=$("<canvas>").attr({width:i,height:HEIGHT});e(o,s[0]);var a=s[0].toDataURL(),u=t.getResource(),c=t.getDir(),l=n.file(t);l.text(a);for(var f={name:r,pwidth:i,pheight:HEIGHT,url:"ls:"+l.relPath(c)},p=u.images,h=!1,d=0;d<p.length;d++)p[d].name==r&&(p[d]=f,h=!0);h||p.push(f),t.setResource(u),console.log("setRSRC",u)}catch(e){console.log("Create thumbnail failed",e),console.log(e.stack)}}(t)},o)},n.get=function(e){var t=n.file(e);return t.exists()?t.text():null},n.file=function(e){return e.getDir().rel("images/").rel("icon_thumbnail.png")},n}),n("sysMod",["Tonyu","FS","ImageList","Blob","thumbnail","WebSite","plugins","DeferredUtil"],function(e,t,n,r,i,o,s,a){return{rawRun:function(e){if(o.removeJSOutput){var t=this.getOutputFile();t.exists()&&t.rm()}return this.loadClasses().then(()=>{this.detectPlugins(),this.fixBootRunClasses(),this.runScriptMode||i.set(this,2e3),this.rawBoot(e)})},getResourceFile:function(){return this.getDir().rel("res.json")},getResource:function(){var t=this.getResourceFile();if(t.exists()){var n=t.obj(),r=!1;for(var i in n)for(var o=n[i],s=o.length-1;s>=0;s--)o[s].url||(o.splice(s,1),r=!0);return r&&this.setResource(n),n}return e.defaultResource},hasSoundResource:function(){var e=this.getResource();return e&&e.sounds&&e.sounds.length>0},setResource:function(e){this.getResourceFile().obj(e)},getThumbnail:function(){return i.get(this)},convertBlobInfos:function(e){var t=this.getResource(),n=this.getName();!function t(i){if("object"==typeof i)for(var o in i)if(i.hasOwnProperty(o)){var s=i[o];if("url"==o){var a=r.isBlobURL(s);a&&(i[o]=[r.BLOB_PATH_EXPR,e,n,a.fileName].join("/"))}t(s)}}(t),this.setResource(t)},getBlobInfos:function(){var e=[];return function t(n){if("object"==typeof n)for(var i in n)if(n.hasOwnProperty(i)){var o=n[i];if("url"==i){var s=r.isBlobURL(o);s&&e.push(s)}t(o)}}(this.getResource()),e},loadResource:function(t){var r=this.getResource();n(r.images,function(n){var r=e.getGlobal("$Sprites");for(var i in r&&r.setImageList(n),n.names)e.setGlobal(i,n.names[i]);t&&t()})},detectPlugins:function(){var e=this.getOptions(),t=e.plugins=e.plugins||{};if(!t.Mezonet||!t.PicoAudio){var n=this.getResource(),r=!1,i=!1;n.sounds&&n.sounds.forEach(function(e){e.url.match(/\.mzo/)&&(r=!0),e.url.match(/\.midi?/)&&(i=!0)}),r?this.addPlugin("Mezonet"):this.removePlugin("Mezonet"),i?this.addPlugin("PicoAudio"):this.removePlugin("PicoAudio")}},addPlugin:function(e){var t=this.getOptions();t.plugins[e]||(t.plugins[e]=1,this.setOptions(t))},removePlugin:function(e){var t=this.getOptions();t.plugins[e]&&(delete t.plugins[e],this.setOptions(t))},requestPlugin:function(e){if(this.addPlugin(e),!s.loaded(e)){var t=new Error("必要なプラグイン"+e+"を追加しました。もう一度実行してください");throw t.pluginName=e,t}},loadPlugins:function(e){var t=this.getOptions();return s.loadAll(t.plugins,e)},fixBootRunClasses:function(){var e=this.getOptions();if(e.run){var t=this.fixClassName(e.run.mainClass),n=this.fixClassName(e.run.bootClass);t==e.run.mainClass&&n==e.run.bootClass||(e.run.mainClass=t,e.run.bootClass=n,this.setOptions(e))}},fixClassName:function(t){if(e.classMetas[t])return t;const n=this.getNamespace();console.log("NS",n);let r=e.classes[n][t];if(r)return`${n}.${t}`;for(var i in e.classes)if(r=e.classes[i][t])return`${i}.${t}`;throw new Error(`Cannot fix className ${t}`)},rawBoot:function(t){this.showProgress("Running "+t),this.initCanvas(),e.run(t)},initCanvas:function(){e.globals.$mainCanvas=$("canvas")},showProgress:function(e){return console.log("PROGRESS",e),"undefined"!=typeof SplashScreen&&SplashScreen.progress(e),a.promise(function(e){setTimeout(e,0)})}}}),n("CompiledProject",["require","exports","module","BuilderClient4Sys"],function(e,t,n){const r=e("BuilderClient4Sys");n.exports=r.CompiledProject}),n("IDEProject",["require","exports","module","ProjectFactory","BuilderClient","root","sysMod","CompiledProject","WebSite"],function(e,t,n){const r=e("ProjectFactory"),i=e("BuilderClient"),o=e("root"),s=e("sysMod"),a=e("CompiledProject"),u=e("WebSite"),c=i.langMod;r.addType("IDE",e=>{const t=e.ide,n=r.createDirBasedCore(e),l={kernel:{namespace:"kernel",url:u.compiledKernel}},f=new i(n,{worker:{ns2depspec:l,url:"BuilderWorker.js"}});let p;return r.addDependencyResolver((e,t)=>{if(l[t.namespace])return a.create(l[t.namespace])}),f.onCompiled=function(e){console.log("Sending src",e);const t=n.getIframeProject();t&&t.exec(e).catch(e=>console.error(e))},o.onTonyuDebuggerReady=(e=>{e.on("runtimeError",e=>{console.log("runt",e.stack.map(e=>e+"").join("\n")),t.showError(e)}),p=e,f.setDebugger(e)}),n.setDebugger=(e=>f.setDebugger(e)),n.compiler=f,n.getIframeProject=(()=>{const e=o.document.querySelector("iframe");if(e)return e.contentWindow.Project}),n.disconnectDebugger=(()=>f.setDebugger()),n.fullCompile=f.fullCompile.bind(f),n.partialCompile=f.partialCompile.bind(f),n.renameClassName=f.renameClassName.bind(f),n.include(s).include(c),n.stop=(()=>{try{p&&p.stop()}catch(e){console.error(e)}}),console.log("res.loadClasses",n.loadClasses),n}),t.create=(e=>r.create("IDE",e))}),n("optionFixer",["Tonyu"],function(e){const t={compiler:{namespace:"user",defaultSuperClass:"kernel.Actor",dependingProjects:[{namespace:"kernel"}]},run:{mainClass:"user.Main",bootClass:"kernel.Boot",globals:{$defaultFPS:60,$imageSmoothingDisabled:!0,$soundLoadAndDecode:!1}},kernelEditable:!1,language:"tonyu",version:e.VERSION};return e.defaultOptions=t,{fixFile:function(e){if(!e.exists())return void e.obj(t);const n=e.text(),r=JSON.parse(n),i=this.fixObject(r),o=JSON.stringify(i);n!==o&&e.text(o)},fixObject:function(e){return this.fixOptions(e),this.fixBootRunClasses(e),e},fixOptions:function(e){e.compiler||(e.compiler={}),e.plugins||(e.plugins={}),e.compiler.dependingProjects=e.compiler.dependingProjects||[{namespace:"kernel"}],e.compiler.namespace=e.compiler.namespace||"user",e.run=e.run||{},e.language="tonyu"},fixBootRunClasses:function(e){if(e.run){var t=this.fixClassName(e.run.mainClass),n=this.fixClassName(e.run.bootClass);t==e.run.mainClass&&n==e.run.bootClass||(e.run.mainClass=t,e.run.bootClass=n)}},fixClassName:function(t){if(e.getClass(t))return t;var n,r=t.split(".").pop();return n="user."+r,e.getClass(n)?n:(n="kernel."+r,e.getClass(n)?n:t)}}}),n("SourceFiles",["require","exports","module","BuilderClient4Sys"],function(e,t,n){const r=e("BuilderClient4Sys");n.exports=r.SourceFiles}),e(["Util","Tonyu","FS","PathUtil","FileList","FileMenu","ErrorDialog","fixIndent","Wiki","Shell","Shell2","ProjectOptionsEditor","copyToKernel","KeyEventChecker","IFrameDialog","runtime","KernelDiffDialog","Sync","searchDialog","syncWithKernel","UI","ResEditors","WebSite","exceptionCatcher","Log","MainClassDialog","DeferredUtil","NWMenu","mkrunDiag","zip","LSFS","WebFS","extLink","DiagAdjuster","ExportHTMLDialog","DebugDialog","GlobalDialog","root","IDEProject","optionFixer","SourceFiles"],function(e,n,r,i,o,s,a,u,c,l,f,p,h,d,g,m,v,y,b,w,x,S,_,E,A,C,M,T,P,k,O,D,L,B,j,F,N,R,I,U,G){$(function(){_.isNW||r.mount(location.protocol+"//"+location.host+"/",new D),"projectBoard"===_.serverType&&$.ajax("../../../a.php?Test/test").then(function(e){console.log("Session",e)}),$.get("https://edit.tonyu.jp/doc/welcome_edit.html?a").then(function(e){$("#welcome").append(e)});var i=E.f;R.$LASTPOS=0;var c=_.mobile||r.get(_.tonyuHome).rel("mobile.txt").exists();c&&($("#fileViewer").hide(),$("#runAreaParent").hide(),$("#mainArea").attr("class","col-xs-12"),$("#fileSel").show());r.get(_.tonyuHome);var f=e.getQueryString("dir","/Tonyu/Projects/SandBox/"),h=r.get(f);const m=h.rel("options.json");U.fixFile(m);const v={restart:function(){oe(),ne.close(),setTimeout(se,100)},stop:oe,displayMode:re,jump:function(e,t,n){K.select(e),Q()&&setTimeout(function(){var e=ee();e&&e.gotoLine(t,n)},50)}},y=I.create({dir:h,ide:v});v.project=y;const w=y.getNamespace();R.curPrj=y;var M=new S(y);n.globals.$currentProject=y,n.currentProject=y;var T=y.getEXT(),k=function(){var e,t=h.rel(".desktop");e=t.exists()?t.obj():{};e.runMenuOrd||(e.runMenuOrd=[]);return k=e,e}(),O=k.runMenuOrd,B=new j(y);n.defaultResource={images:[{name:"$pat_base",url:"images/base.png",pwidth:32,pheight:32},{name:"$pat_sample",url:"images/Sample.png"},{name:"$pat_neko",url:"images/neko.png",pwidth:32,pheight:32},{name:"$pat_mapchip",url:"images/mapchip.png",pwidth:32,pheight:32}],sounds:[]};const N=y.getResourceFile();var W,z;N.exists()||N.obj(n.defaultResource),W=!1,(z=y.getOptions()).compiler.diagnose!=W&&(z.compiler.diagnose=W,y.setOptions(z));var V={screenH:200,onClose:oe,desktopEnv:k,prj:h.path()};function q(){var e=$(window).height()-$("#navBar").height();e-=20,V.screenH=e,$("#progs pre").css("height",e+"px"),$("#fileItemList").height(e)}q();var H={};d.down(document,"F9",i(se)),d.down(document,"F2",i(oe)),d.down(document,"ctrl+s",i(function(e){return le(),e.stopPropagation(),e.preventDefault(),!1})),$(window).resize(i(q)),$("body")[0].spellcheck=!1,l.cd(h);var J,K=o($(c?"#fileSel":"#fileItemList"),{topDir:h,on:{select:i(function(e){if(e.isDir())return;$("#welcome").hide(),le(),fe&&fe.hide();var t=H[e.path()];if(t)t.lastTimeStamp<t.file.lastUpdate()&&(t.editor.setValue(t.file.text()),t.editor.clearSelection(),t.lastTimeStamp=t.file.lastUpdate()),t.dom.show(),t.editor.focus(),fe=t.dom;else{var n=$("<pre>").css("height",V.screenH+"px").text(e.text()).appendTo("#progs"),r=R.ace.edit(n[0]);window.lastEditor=r,"number"==typeof k.editorFontSize?r.setFontSize(k.editorFontSize):r.setFontSize(16),r.setTheme("ace/theme/eclipse"),r.getSession().setMode("ace/mode/tonyu"),t=H[e.path()]={file:e,editor:r,dom:n},n.click(i(function(){re("edit")})),r.setReadOnly(!1),r.clearSelection(),r.focus();try{r.commands.removeCommand("toggleFoldWidget"),r.setOptions({fixedWidthGutter:!0})}catch(e){}fe=n}t.lastTimeStamp=t.file.lastUpdate()}),displayName:X}}),Z=s();function Y(){var e;for(h.each(function(e){if(e.endsWith(T)){var t=e.truncExt(T);O.indexOf(t)<0&&O.push(t)}}),e=O.length-1;e>=0;e--){h.rel(O[e]+T).exists()||O.splice(e,1)}$("#runMenu").empty(),e=0,O.forEach(function(t){var n=e;"string"!=typeof t&&(console.log(t),alert("not a string: "+t)),n>=15||($("#runMenu").append($("<li>").append($("<a>").attr("href","#").text(t+"を実行"+(0==e?"(F9)":"")).click(i(function(){"string"!=typeof t&&(console.log(t),alert("not a string2: "+t)),se(`${w}.${t}`),n>0&&(O.splice(n,1),O.unshift(t),Y(),pe())})))),e++)}),$("#runMenu").append($("<li>").append($("<a>").attr("href","#").text("停止(F2)").click(i(function(){oe()})))),$("#runMenu").append($("<li>").append($("<a>").attr("href","#").text("実行するファイルを選択...").click(i(function(){var e=C.show(y,{on:{done:function(e,t){var n=O.indexOf(e);n>0&&(O.splice(n,1),O.unshift(e),Y(),pe()),t&&se(e)}}});e.$vars.mainClass.empty(),O.forEach(function(t){e.$vars.mainClass.append(x("option",{value:t},t))})})))),$("#exportToJsdoit").attr("href","javascriptoo".replace("oo",":;")).click(function(){B.show({excludes:{"js/concat.js":1,"js/concat.js.map":1},includeJSScript:!0})}),$("#exportToExe").attr("href","exportToExe.html?dir="+h.path())}function X(e){var t=e.name();return e.isDir()?t:e.endsWith(T)?e.truncExt(T):null}function Q(){var e=K.curFile();return e?H[e.path()]:null}function ee(){var e=Q();return e?e.editor:null}Z.fileList=K,$("#newFile").click(i(Z.create)),$("#mvFile").click(i(Z.mv)),$("#rmFile").click(i(Z.rm)),$("#closeFile").click(i(function(){var e=Q();e&&ce(e.file)})),$("#runDialog").click(i(function(){ne.show(!0)})),Z.on.close=ce,Z.on.ls=function(){K.ls(h),Y()},Z.on.validateName=function(e,t){var n=!1;e.match(/^[a-z]/)&&(e=e.substring(0,1).toUpperCase()+e.substring(1),n=!0);if(e.match(/^[A-Z_][a-zA-Z0-9_]*$/)){var r=K.curDir();return{files:1,static:1,maps:1}[r.relPath(h).replace(/\/*/,"")]?{ok:!1,reason:r.name()+"はシステムで利用されているフォルダなので使用できません"}:n?{ok:!0,file:r.rel(e+T),note:"先頭を大文字("+e+") にして作成します．"}:{ok:!0,file:r.rel(e+T)}}return{ok:!1,reason:"名前は，半角英数字とアンダースコア(_)のみが使えます．先頭は英大文字にしてください．"}},Z.on.createContent=function(e){e.text("")},Z.on.displayName=function(e){var t=X(e);return t||e.name()},Z.on.mvExtraUI=function(e){J=x("div",["input",{type:"checkbox",$var:"chk",checked:"true",value:"chked"}],"プログラム中のクラス名も変更する"),e.append(J)},Z.on.mv=async function(e,t){if(!J)return;const n=J.$vars.chk.prop("checked");if(await le(),n){var r=e.truncExt(T),i=t.truncExt(T);try{const e=await y.renameClassName(r,i);console.log("REN",e),Z.on.ls(),Z.on.open(t)}catch(e){alert("プログラム内にエラーがあります．エラーを修正するか，「プログラム中のクラス名も変更する」のチェックを外してもう一度やり直してください．"),console.error(e),console.log(e)}}else!function(){for(var e in H){var t=H[e],n=t.file,r=t.editor;n.exists()&&r&&(r.setValue(n.text()),r.clearSelection())}}();return J=null,R.SplashScreen&&R.SplashScreen.hide(),console.log("REN2",!n),!n},i(Z.on),K.ls(h),Y();var te,ne=new F(V);function re(e,t){var n=ee();switch(e){case"run":n&&n.blur(),ae.close(),c&&($("#runAreaParent").show().attr("class","col-xs-12"),$("#mainArea").hide(),q()),ne.opened||ne.show();break;case"compile_error":case"runtime_error":R.SplashScreen&&R.SplashScreen.hide();break;case"edit":ne.modified&&(delete ne.modified,pe()),c&&($("#runAreaParent").hide(),$("#mainArea").show())}}function ie(e){if(!e||!te)return te=e,e;alert("他のコマンド("+te+")が実行されているのでお待ちください．\nしばらくたってもこのメッセージが出る場合，一旦Homeに戻ってください．")}function oe(){if(ie("stop"))return $.when(y.stop()).then(function(){y.disconnectDebugger(),re("edit"),console.log("Boot stopped")}).finally(function(){ie()})}function se(e){if(ie("run"))return $.when(y.stop()).then(function(){return function(e){if("string"!=typeof e){if(0==O.length)return void alert("ファイルを作成してください");e=`${w}.${O[0]}`}le(),y.initCanvas=function(){re("run"),n.globals.$mainCanvas=ne.canvas},A.dumpProject(h),R.SplashScreen&&R.SplashScreen.show();var t=y.getOptions();t.run.mainClass!=e&&(t.run.mainClass=e,y.setOptions(t));return h.touch(),y.fullCompile().then(async e=>{await G.add(e).saveAs(y.getOutputFile()),ne.show()},ue).finally(function(){R.SplashScreen&&R.SplashScreen.hide()})}(e)}).catch(n.onRuntimeError).finally(function(){ie()})}const ae=new a(v);function ue(e){try{ae.show(e)}catch(e){console.log(e),oe()}}function ce(e){var t=H[e.path()];if(t){var n;for(var r in t.editor.destroy(),t.dom.remove(),delete H[e.path()],H)n=!0;n||$("#welcome").show()}}function le(){var e=Q();if(e){var t=e.file,r=e.editor;if(t&&r&&!t.isReadOnly()){!function(e){var t=e.getCursorPosition(),n=e.getValue(),r=u(n);n!=r&&(e.setValue(r),e.clearSelection(),e.moveCursorTo(t.row,t.column))}(r);var i=t.text(),o=r.getValue();i!=o&&(t.text(o),y.partialCompile(t).catch(n.onRunTimeError),e.lastTimeStamp=t.lastUpdate())}K.setModified(!1)}}var fe;function pe(){h.rel(".desktop").obj(k)}window.onerror=E.handleException=n.onRuntimeError=v.showError=ue,$("#mapEditor").click(i(function(){console.log("run map"),se("kernel.MapEditor")})),$("#search").click(i(function(){console.log("src diag"),b.show(h,function(e){K.select(e.file),setTimeout(function(){var t=ee();t&&t.gotoLine(e.lineNo)},50)})})),setInterval(function(){var e=Q();e&&e.file.exists()&&(e.lastTimeStamp<e.file.lastUpdate()&&(e.editor.setValue(e.file.text()),e.editor.clearSelection(),e.lastTimeStamp=e.file.lastUpdate()),K.setModified(e.file.text()!=e.editor.getValue()))},1e3),$("#mkrun").click(i(function(){var e;_.isNW?(e=k&&k.runtimeConfig?k.runtimeConfig.dest:r.get(_.cwd).rel("Runtimes/").rel(h.name()),P.show(y,{dest:e,onComplete:function(e){"dir"===e.type&&k&&(k.runtimeConfig=e.config,pe())}})):P.show(y,{hiddenFolder:!0,onEnd:function(){}})})),$("#imgResEditor").click(i(function(){M.open("image")})),$("#soundResEditor").click(i(function(){M.open("sound")})),$("#prjOptEditor").click(i(function(){p(y)}));var he=null;$("#refHelp").click(i(function(){he||(he=g.create(_.top+"/doc/index.html")),he.show()})),window.startTutorial=i(function(){he||(he=g.create(_.top+"/doc/tutorial.html")),he.show()}),$("#rmPRJ").click(i(function(){"DELETE"==prompt(h+"内のファイルをすべて削除しますか？削除する場合はDELETE と入力してください．","")&&(l.rm(h,{r:1}),document.location.href="index.html")})),$("#mvPRJ").click(i(function(){var e=prompt("新しいプロジェクトの名前を入れてください",h.name().replace(/\//g,""));if(e&&""!=e){e.match(/\/$/)||(e+="/");var t=h.up().rel(e);t.exists()?alert(t+" はすでに存在します"):(l.cp(h,t),l.rm(h,{r:1}),document.location.href="project.html?dir="+t)}})),$("#editorEditor").click(i(function(){var e=ee(),t=prompt("エディタの文字の大きさ",k.editorFontSize||16);k.editorFontSize=parseInt(t),e&&e.setFontSize(k.editorFontSize||16),pe()})),$("#openFolder").click(i(function(){var e=h;t("nw.gui").Shell.showItemInFolder(e.path().replace(/\//g,t("path").sep))})),l.curFile=function(){return K.curFile()},Z.onMenuStart=le,R.SplashScreen&&R.SplashScreen.hide(),L.all()})}),n("ide/editor",function(){})}();
//# sourceMappingURL=editor_concat.min.js.map