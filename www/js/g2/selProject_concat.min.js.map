{"version":3,"sources":["selProject_concat.js"],"names":["define","requirejs","resMod","R","reqjsSeq","def","name","reqs","func","m","getModuleInfo","reqsFromFunc","setReqs","module","exports","doLoad","apply","this","getObjs","loadIfAvailable","amd","forEach","req","reqm","loaded","revReqs","ms","modules","obj","res","i","match","console","log","notifyLoaded","dependingMod","loadedModuleName","ary","n","cur","push","f","replace","a","d","s","$a","Assertion","failMesg","flatten","prototype","_regedType","registerType","t","MODE_STRICT","MODE_DEFENSIVE","MODE_BOOL","fail","arguments","value","shift","concat","isDefensive","isBool","Error","join","subAssertion","assert","eq","b","ne","isset","is","type","v","_assert_func","Array","global","length","na","String","Number","Boolean","RegExp","exec","Function","k","ty","ensureError","action","err","e","message","setMode","mode","_mode","isStrict","args","top","stack","bind","opt","and","types","endsWith","str","postfix","substring","PathUtil","driveLetter","url","Path","isPath","Absolute","isAbsolutePath","Relative","Dir","isDir","AbsDir","File","SEP","startsWith","prefix","isChildOf","child","parent","normalize","path","fixSep","hasDriveLetter","isURL","r","protocol","hostPort","isRelativePath","hasBackslashSep","indexOf","to","directorify","filify","splitPath","u","p","split","pop","ext","truncExt","truncSEP","up","rel","relPath","paths","resPath","base","ps","old","backslashifyAfter","slice","call","map","isAbsolute","isRelative","window",".png",".gif",".jpeg",".jpg",".ico",".wav",".mp3",".ogg",".midi",".mid",".mzo",".txt",".html",".htm",".css",".js",".json",".zip",".swf",".pdf",".doc",".xls",".ppt",".docx",".docm",".dotx",".dotm",".xlsx",".xlsm",".xltx",".xltm",".xlsb",".xlam",".pptx",".pptm",".potx",".potm",".ppsx",".ppsm",".ppam",".tonyu",".c",".dtl","DU","root","self","DUBRK","same","isNativePromise","then","promise","catch","isJQPromise","isPromise","all","succ","rest","resolve","config","useJQ","throwNowIfRejected","state","reject","assertResolved","resolved","ensureDefer","isDeferred","setTimeout","directPromise","timeout","funcPromise","$","Deferred","external","Promise","rej","throwPromise","throwF","each","set","loop","brk","objs","when1","deff1","deff2","r1","dr","r2","tryLoop","tr","tryEach","documentReady","callbackToPromise","NOP","E","errorHandler","error","alert","setE","begin","try","DeferredUtil","extend","P","M","FS","fstypes","stub","addFSType","fsgen","availFSTypes","mesg","fstype","isReadOnly","options","supportsSync","resolveFS","getRootFS","mounted","rootFS","mountPoint","inMyFS","getReturnTypes","getContent","size","ArrayBuffer","toBin","byteLength","getContentAsync","setContent","content","setContentAsync","appendContent","appendContentAsync","getMetaInfo","setMetaInfo","info","mkdir","touch","exists","opendir","opendirAsync","cp","dst","assertExist","srcIsDir","dstfs","dstIsDir","cont","mv","rm","link","getURL","onAddObserver","delegateMethods","methods","fs","assertWriteable","getContentType","toLowerCase","getBlob","c","blobType","Blob","binType","hasPlainText","toPlainText","isText","find","ls","ep","resolveLink","l","isLink","np","opendirEx","dest","getDirTree","style","excludes","meta","relP","getQueryString","key","default_","qs","location","href","decodeURIComponent","privatize","o","__privatized","_global","download","opts","xhr","XMLHttpRequest","open","responseType","onload","saveAs","response","onerror","send","corsEnabled","status","click","node","dispatchEvent","MouseEvent","evt","document","createEvent","initMouseEvent","HTMLAnchorElement","blob","URL","webkitURL","createElement","origin","target","createObjectURL","revokeObjectURL","navigator","msSaveOrOpenBlob","autoBom","warn","test","fromCharCode","bom","popup","title","body","innerText","force","isSafari","HTMLElement","safari","isChromeIOS","userAgent","FileReader","reader","onloadend","result","readAsDataURL","Util","Content","plainText","contentType","plain","buffer2ArrayBuffer","isBuffer","Uint8Array","buffer","arrayBuffer2Buffer","Buffer","bin","isNodeBuffer","bufType","nodeBuffer","arrayBuffer","looksLikeDataURL","text","hasNodeBuffer","DataURL","setBuffer","str2utf8bytes","toArrayBuffer","toNodeBuffer","toURL","hasBin","utf8bytes2str","hasURL","hasArrayBuffer","toBlob","Base64_To_ArrayBuffer","base64","A","dic","Object","num","Math","floor","charAt","ary_buffer","ary_u8","undefined","charCodeAt","Base64_From_ArrayBuffer","data","bytes","toString","encodeURIComponent","parseInt","dataURL2bin","bin2dataURL","head","dataHeader","dataURL","ctype","require","existsSync","NativeFS","rootPoint","process","cwd","available","Pro","toNativePath","readFileSync","statSync","pa","writeFileSync","appendFileSync","stat","lastUpdate","mtime","getTime","mkdirSync","ts","readdirSync","nosep","isDirectory","rmdirSync","unlinkSync","utimesSync","Date","now","apath","rfs","w","watch","rpath","fpath","eventType","notifyChanged","remove","close","LSFS","storage","useDirCache","dirCache","ramDisk","localStorage","resolveKey","getItem","setItem","removeItem","itemExists","getDirInfo","dinfos","dinfo","JSON","parse","putDirInfo","trashed","stringify","ppath","pdinfo","_touch","removeEntry","removeEntryWithoutTrash","isRAM","getUsage","using","getCapacity","seq","KEY","lim","pow","ru","add","max","readOnly","cs","includeTrashed","pinfo","inf","noTrash","ajaxTransport","originalOptions","jqXHR","FormData","dataType","headers","callback","async","username","password","addEventListener","statusText","getAllResponseHeaders","setRequestHeader","abort","j","WebFS","get","readAsArrayBuffer","Env","expand","expandPath","FSClass","SFile","_path","isSFile","setPolicy","policy","_clone","getPolicy","_resolve","topdir","topDir","contains","file","bp","pathR","assertDir","sibling","pre","post","equals","act","isTrashed","metaInfo","assertExists","noFollowLink","recursive","removeWithoutTrash","getText","setText","ct","appendText","forceText","getDataURL","setDataURL","setBytes","getBytes","lines","copyFrom","src","copyTo","dstf","progress","echo","getResolvedLinkPath","moveFrom","ex","moveTo","listFilesAsync","eachrev","reverse","fun","dir","convertOptions","_listFiles","ord","order","cvt","di","excludesF","sort","listFiles","nex","getFS","observe","h","addObserver","setBlob","sum","exportAsObject","importFromObject","_1","_2","handler","defineProperty","_act","RootFS","defaultFS","mount","fstab","_fstab","unmount","splice","fact","unshift","_3","observers","remover","observer","ob","fsv","zip","setJSZip","JSZip","dstZip","jszip","folder","generateAsync","compression","unzip","arrayBuf","destDir","onCheckFile","overwrite","loadAsync","files","zipEntry","buf","_buf","redirectedTo","isArray","x","noop","fn","TypeError","_state","_handled","_value","_deferreds","doResolve","handle","deferred","_immediateFn","cb","onFulfilled","onRejected","ret","newValue","finale","thisArg","_unhandledRejectionFn","len","done","reason","prom","constructor","arr","remaining","val","race","PR","Class","env","setEnvProvider","getEnvProvider","setEnv","getEnv","init","importScripts","postMessage","isFile","HttpHelper","Arrow","show","cnt","on","clear","addClass","off","removeClass","showOld","offset","arrow","attr","css","font","position","left","height","color","zIndex","z-index","appendTo","setInterval","er","WebSite","tablet","mobile","Platform","loc","devMode","prot","WebSite_runType","urlAliases","builtinAssetNames","images/Ball.png","images/base.png","images/Sample.png","images/inputPad.png","images/neko.png","images/mapchip.png","pluginTop","sampleImg","isNW","__node_webkit","__nwjs","mp4Disabled","tonyuHome","PathSep","noconcat","sep","TONYU_HOME","logdir","TONYU_LOGDIR","wwwDir","platform","ffmpeg","pkgInfo","TONYU_PROJECTS","projects","delimiter","prjDirs","kernelDir","host","compiledKernel","uploadTmpUrl","newVersionUrl","scriptServer","version","hoge","BuiltinAssets","removeJSOutput","images/sound.png","images/sound_ogg.png","images/sound_mp3.png","images/sound_mp4.png","images/sound_m4a.png","images/sound_mid.png","images/sound_wav.png","images/ecl.png","WS","serverType","runtime","disableROM","serverTop","blobPath","getFiles","putFiles","Shell","mustExist","resolve2","newCommand","cd","pwd","vars","create","fst","sh","from","ln","notrash","cat","grep","pattern","line","lineNo","report","setout","ui","outUI","when","clone","getvar","strcat","dl","prompt","ASYNC","help","description","devtool","Window","showDevTools","Log","logHome","doLog","digit","zs","todayDir","y","getFullYear","getMonth","da","getDate","curFile","curProject","getHours","getMinutes","getSeconds","dumpProject","out","append","logging","varlog","mul","con","tag","isTrcf","handleException","enter","EC","UI","F","expr","listeners","$vars","$edits","load","model","edit","writeToJq","params","$edit","jq","validator","validate","toVal","prop","errors","validationMessage","empty","OKButton","ok","addError","removeError","allOK","isValid","writeToModel","fromVal","li","$var","realtimechange","eType","ev","which","prev","first","parseAttr","parseArray","createTextNode","parseFloat","Wiki","placeHolder","home","plugins","tocFile","curLined","W","refers","figures","plists","LINEMARK","history","encodeURL","encodeURI","ctx","$h","lineMark","ul","beginMark","endMark","blocks","figInfo","refInfo","plistInfo","toc","idx","navBar","next","register","fi","refs","no","unul","exit","uld","lastMatch","rightContext","parseLink","$1","label","ss","pi","pclose","end","we","hasBrace","bless","sp","includeBrace","WikiBraces","caption","$2","hover","code","varn","cn","imfile","builtinImages","dragover","dragenter","drop","editMode","originalEvent","dataTransfer","stopPropagation","preventDefault","fileContent","thome","imageHolder","resolveFile","useAnchor","ahref","procLink","nameOrFile","ht","scrollTop","back","highlightLine","row","area","50_100.png","50_160.png","50_300.png","apple1apple2.png","coords.png","copy60_100.png","firstRunRes.png","firstVarRes.png","itadaki.png","noWaitCat.png","runtimeError.png","sample.png","sayonara.png","syntaxError.png","embed","dialog","width","inner","cls","keydown","cmd","canda","fns","cand","comp","ce","sres","table","class","focus","closest","atest","oldcat","prjDir","onOK","FType","ren","defName","enterkey","parentDir","dstDir","FR","ajax","THRESH","redirectTo","frags","id","random","sent","waitTime","addRedir","runFrag","success","complete","frag","rf","Sync","sync","local","remote","onend","promptAfter","n1","onError","uploads","downloads","visited","param","onstatus","cmp","lcm","n2","dlData","dlf","pathInfo","n3","upds","msg","rmm","rsh","auth","currentUser","withCsrfToken","user","csrfToken","assertLogin","onLoggedIn","showLoginLink","Auth","extLink","getOpt","afterClick","Klass","getArgs","isPropDesc","pk","configurable","enumerable","writable","pd","thisName","singletonName","$parent","super","$this","$singleton","fldinit","wrapCancelled","klass","wrap","checkSchema","$fields","inherit","wrapStatic","__bounded","Binder","addMethod","DragDrop","readFile","accept","dom","fdst","draggingClass","entc","eo","innerHTML","actFile","itemName","itemFile","cr","onComplete","DD","tmpDir","elem","prepareDragDrop","showDialog","imported","acceptDrag","closeDialog","dialogOpened","modal","zipexdir","traverse","importFrom","dstParent","nameT","prjID","optobj","checkFromPrjB","fromPrjB","fileName","tmp","S","HNOP","ProjectItem","projectDir","prjList","tn","hide","submenuExpr","$bind","openSubmenu","data-path","rename","openFolder","closeSubmenu","rmd","checked","for","npd","gui","execPath","showItemInFolder","addMenuHandler","showingSubMenu","static$closeSubmenu","static$addMenuHandler","menuHandlerAdded","hasClass","splashElement","includeJSScript","resObj","genPath","IE","images","im","binary","json","lu","_","s1","s2","s3","beautifyJSON","cols","STF","toObj","div","textContent","unwrap","toByteArray","east","NPD","ImportHTMLDialog","createDOM","selDir","rows","placeholder","display","confirm","prog","html","sh2","requestFragment","ZipImporter","capacity","search","prevKW","kw","nd","zipchecked","dols2","curDir","prj1dirList","it","showAll","zi","dols","SplashScreen","importHTMLDialog","reload","importFromHTML","wikiEditor"],"mappings":"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","sourcesContent":["(function (){\r\n// This is kowareta! because r.js does not generate module name:\r\n//   define(\"FSLib\",[], function () { ...\r\n//(function (global) {\r\n//var useGlobal=(typeof global.define!=\"function\");\r\n//var define=(useGlobal ? define=function(_,f){f();} : global.define);\r\ndefine('FS',[],function () {\r\n    var define,requirejs;\r\n\tvar R={};\r\n\tvar REQJS=\"REQJS_\";\r\n\tvar reqjsSeq=0;\r\n\tR.def=function (name, reqs,func) {\r\n\t\tvar m=R.getModuleInfo(name);\r\n\t\tif (typeof reqs==\"function\") {\r\n\t\t    func=reqs;\r\n\t\t    reqs=R.reqsFromFunc(func);\r\n    \t\tR.setReqs( m, reqs);\r\n    \t\tm.func=function () {\r\n    \t\t    var module={exports:{}};\r\n    \t\t\tvar res=func(R.doLoad,module,module.exports);\r\n    \t\t\treturn res || module.exports;\r\n    \t\t};\r\n\t\t} else {\r\n    \t\tR.setReqs( m, reqs);\r\n    \t\tm.func=function () {\r\n    \t\t\treturn func.apply(this, R.getObjs(reqs));\r\n    \t\t};\r\n\t\t}\r\n\t\tR.loadIfAvailable(m);\r\n\t};\r\n\tdefine=function (name,reqs,func) {\r\n\t\tR.def(name, reqs,func);\r\n\t};\r\n\tdefine.amd={};\r\n\trequirejs=function (reqs,func) {\r\n\t\tR.def(REQJS+(reqjsSeq++),reqs,func);\r\n\t};\r\n\tR.setReqs=function (m, reqs) {\r\n\t\treqs.forEach(function (req) {\r\n\t\t\tvar reqm=R.getModuleInfo(req);\r\n\t\t\tif (!reqm.loaded) {\r\n\t\t\t\tm.reqs[req]=reqm;\r\n\t\t\t\treqm.revReqs[m.name]=m;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tR.getModuleInfo=function (name) {\r\n\t\tvar ms=R.modules;\r\n\t\treturn ms[name]=ms[name]||{name:name,reqs:{},revReqs:{}};\r\n\t};\r\n\tR.doLoad=function (name) {\r\n\t\tvar m=R.getModuleInfo(name);\r\n\t\tif (m.loaded) return m.obj;\r\n\t\tm.loaded=true;\r\n\t\tvar res=m.func();\r\n\t    if ( res==null && !name.match(/^REQJS_/)) console.log(\"Warning: No obj for \"+name);\r\n\t\tm.obj=res;\r\n\t\tfor (var i in m.revReqs) {\r\n\t\t\tR.notifyLoaded(m.revReqs[i], m.name);\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\tR.notifyLoaded=function (dependingMod, loadedModuleName) {\r\n\t    // depengindMod depends on loadedModule\r\n\t\tdelete dependingMod.reqs[loadedModuleName];\r\n\t\tR.loadIfAvailable(dependingMod);\r\n\t};\r\n\tR.loadIfAvailable=function (m) {\r\n\t\tfor (var i in m.reqs) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tR.doLoad(m.name);\r\n\t};\r\n\tR.getObjs=function (ary) {\r\n\t\tvar res=[];\r\n\t\tary.forEach(function (n) {\r\n\t\t\tvar cur=R.doLoad(n);\r\n\t\t\tres.push(cur);\r\n\t\t});\r\n\t\treturn res;\r\n\t};\r\n\tR.reqsFromFunc=function (f) {\r\n\t    var str=f+\"\";\r\n\t    var res=[];\r\n\t    str.replace(/require\\s*\\(\\s*[\"']([^\"']+)[\"']\\s*\\)/g,function (m,a) {\r\n\t       res.push(a);\r\n\t    });\r\n\t    return res;\r\n\t};\r\n\tR.modules={};\r\n\t//requireSimulator=R;\r\n//----------\r\ndefine('extend',[],function (){\r\n   return function extend(d,s) {\r\n      for (var i in s) {d[i]=s[i];}\r\n      return d;\r\n   };\r\n});\r\n\r\ndefine('assert',[],function () {\r\n    var Assertion=function(failMesg) {\r\n        this.failMesg=flatten(failMesg || \"Assertion failed: \");\r\n    };\r\n    var $a;\r\n    Assertion.prototype={\r\n        _regedType:{},\r\n        registerType: function (name,t) {\r\n            this._regedType[name]=t;\r\n        },\r\n        MODE_STRICT:\"strict\",\r\n        MODE_DEFENSIVE:\"defensive\",\r\n        MODE_BOOL:\"bool\",\r\n        fail:function () {\r\n            var a=$a(arguments);\r\n            var value=a.shift();\r\n            a=flatten(a);\r\n            a=this.failMesg.concat(value).concat(a);//.concat([\"(mode:\",this._mode,\")\"]);\r\n            console.log.apply(console,a);\r\n            if (this.isDefensive()) return value;\r\n            if (this.isBool()) return false;\r\n            throw new Error(a.join(\" \"));\r\n        },\r\n        subAssertion: function () {\r\n            var a=$a(arguments);\r\n            a=flatten(a);\r\n            return new Assertion(this.failMesg.concat(a));\r\n        },\r\n        assert: function (t,failMesg) {\r\n            if (!t) return this.fail(t,failMesg);\r\n            return t;\r\n        },\r\n        eq: function (a,b) {\r\n            if (a!==b) return this.fail(a,\"!==\",b);\r\n            return this.isBool()?true:a;\r\n        },\r\n        ne: function (a,b) {\r\n            if (a===b) return this.fail(a,\"===\",b);\r\n            return this.isBool()?true:a;\r\n        },\r\n        isset: function (a, n) {\r\n            if (a==null) return this.fail(a, (n||\"\")+\" is null/undef\");\r\n            return this.isBool()?true:a;\r\n        },\r\n        is: function (value,type) {\r\n            var t=type,v=value;\r\n            if (t==null) {\r\n                return this.fail(value, \"assert.is: type must be set\");\r\n                // return t; Why!!!!???? because is(args,[String,Number])\r\n            }\r\n            if (t._assert_func) {\r\n                t._assert_func.apply(this,[v]);\r\n                return this.isBool()?true:value;\r\n            }\r\n            this.assert(value!=null,[value, \"should be \",t]);\r\n            if (t instanceof Array || (typeof global==\"object\" && typeof global.Array==\"function\" && t instanceof global.Array) ) {\r\n                if (!value || typeof value.length!=\"number\") {\r\n                    return this.fail(value, \"should be array:\");\r\n                }\r\n                var self=this;\r\n                for (var i=0 ;i<t.length; i++) {\r\n                    var na=self.subAssertion(\"failed at \",value,\"[\",i,\"]: \");\r\n                    if (t[i]==null) {\r\n                        console.log(\"WOW!7\", v[i],t[i]);\r\n                    }\r\n                    na.is(v[i],t[i]);\r\n                }\r\n                return this.isBool()?true:value;\r\n            }\r\n            if (t===String || t==\"string\") {\r\n                this.assert(typeof(v)==\"string\",[v,\"should be a string \"]);\r\n                return this.isBool()?true:value;\r\n            }\r\n            if (t===Number || t==\"number\") {\r\n                this.assert(typeof(v)==\"number\",[v,\"should be a number\"]);\r\n                return this.isBool()?true:value;\r\n            }\r\n            if (t===Boolean || t==\"boolean\") {\r\n                this.assert(typeof(v)==\"boolean\",[v,\"should be a boolean\"]);\r\n                return this.isBool()?true:value;\r\n            }\r\n            if (t instanceof RegExp || (typeof global==\"object\" && typeof global.RegExp==\"function\" && t instanceof global.RegExp)) {\r\n                this.is(v,String);\r\n                this.assert(t.exec(v),[v,\"does not match to\",t]);\r\n                return this.isBool()?true:value;\r\n            }\r\n            if (t===Function) {\r\n                this.assert(typeof v==\"function\",[v,\"should be a function\"]);\r\n                return this.isBool()?true:value;\r\n            }\r\n            if (typeof t==\"function\") {\r\n                this.assert((v instanceof t),[v, \"should be \",t]);\r\n                return this.isBool()?true:value;\r\n            }\r\n            if (t && typeof t==\"object\") {\r\n                for (var k in t) {\r\n                    var na=this.subAssertion(\"failed at \",value,\".\",k,\":\");\r\n                    na.is(value[k],t[k]);\r\n                }\r\n                return this.isBool()?true:value;\r\n            }\r\n            if (typeof t==\"string\") {\r\n                var ty=this._regedType[t];\r\n                if (ty) return this.is(value,ty);\r\n                //console.log(\"assertion Warning:\",\"unregistered type:\", t, \"value:\",value);\r\n                return this.isBool()?true:value;\r\n            }\r\n            return this.fail(value, \"Invaild type: \",t);\r\n        },\r\n        ensureError: function (action, err) {\r\n            try {\r\n                action();\r\n            } catch(e) {\r\n                if(typeof err==\"string\") {\r\n                    assert(e+\"\"===err,action+\" thrown an error \"+e+\" but expected:\"+err);\r\n                }\r\n                console.log(\"Error thrown successfully: \",e.message);\r\n                return;\r\n            }\r\n            this.fail(action,\"should throw an error\",err);\r\n        },\r\n        setMode:function (mode) {\r\n            this._mode=mode;\r\n        },\r\n        isDefensive:function () {\r\n            return this._mode===this.MODE_DEFENSIVE;\r\n        },\r\n        isBool:function () {\r\n            return this._mode===this.MODE_BOOL;\r\n        },\r\n        isStrict:function () {\r\n            return !this.isDefensive() && !this.isBool();\r\n        }\r\n    };\r\n    $a=function (args) {\r\n        var a=[];\r\n        for (var i=0; i<args.length ;i++) a.push(args[i]);\r\n        return a;\r\n    };\r\n    var top=new Assertion();\r\n    var assert=function () {\r\n        try {\r\n            return top.assert.apply(top,arguments);\r\n        } catch(e) {\r\n            throw new Error(e.stack);\r\n        }\r\n    };\r\n    [\"setMode\",\"isDefensive\",\"is\",\"isset\",\"ne\",\"eq\",\"ensureError\"].forEach(function (m) {\r\n        assert[m]=function () {\r\n            try {\r\n                return top[m].apply(top,arguments);\r\n            } catch(e) {\r\n                console.log(e.stack);\r\n                //if (top.isDefensive()) return arguments[0];\r\n                //if (top.isBool()) return false;\r\n                throw new Error(e.message);\r\n            }\r\n        };\r\n    });\r\n    assert.fail=top.fail.bind(top);\r\n    assert.MODE_STRICT=top.MODE_STRICT;\r\n    assert.MODE_DEFENSIVE=top.MODE_DEFENSIVE;\r\n    assert.MODE_BOOL=top.MODE_BOOL;\r\n    assert.f=function (f) {\r\n        return {\r\n            _assert_func: f\r\n        };\r\n    };\r\n    assert.opt=function (t) {\r\n        return assert.f(function (v) {\r\n            return v==null || v instanceof t;\r\n        });\r\n    };\r\n    assert.and=function () {\r\n        var types=$a(arguments);\r\n        assert(types instanceof Array);\r\n        return assert.f(function (value) {\r\n            var t=this;\r\n            for (var i=0; i<types.length; i++) {\r\n                t.is(value,types[i]);\r\n            }\r\n        });\r\n    };\r\n    function flatten(a) {\r\n        if (a instanceof Array) {\r\n            var res=[];\r\n            a.forEach(function (e) {\r\n                res=res.concat(flatten(e));\r\n            });\r\n            return res;\r\n        }\r\n        return [a];\r\n    }\r\n    function isArg(a) {\r\n        return \"length\" in a && \"caller\" in a && \"callee\" in a;\r\n    };\r\n    return assert;\r\n});\r\n\r\ndefine('PathUtil',[\"assert\"],function (assert) {\r\nfunction endsWith(str,postfix) {\r\n    assert.is(arguments,[String,String]);\r\n    return str.substring(str.length-postfix.length)===postfix;\r\n}\r\nfunction startsWith(str,prefix) {\r\n    assert.is(arguments,[String,String]);\r\n    return str.substring(0, prefix.length)===prefix;\r\n}\r\nvar driveLetter=/^([a-zA-Z]):/;\r\n// hyphen on protocol -> chrome-extension://....\r\nvar url=/^([a-z\\-]+):\\/\\/\\/?([^\\/]+)\\//;\r\nvar PathUtil;\r\nvar Path=assert.f(function (s) {\r\n    this.is(s,String);\r\n    this.assert( PathUtil.isPath(s) , [s, \" is not a path\"]);\r\n});\r\nvar Absolute=assert.f(function (s) {\r\n    this.is(s,String);\r\n    this.assert( PathUtil.isAbsolutePath(s) , [s, \" is not a absolute path\"]);\r\n});\r\nvar Relative=assert.f(function (s) {\r\n    this.is(s,String);\r\n    this.assert( !PathUtil.isAbsolutePath(s) , [s, \" is not a relative path\"]);\r\n});\r\n\r\nvar Dir=assert.f(function (s) {\r\n    this.is(s,Path);\r\n    this.assert( PathUtil.isDir(s) , [s, \" is not a directory path\"]);\r\n});\r\nvar AbsDir=assert.and(Dir,Absolute);\r\nvar File=assert.f(function (s) {\r\n    this.is(s,Path);\r\n    this.assert( !PathUtil.isDir(s) , [s, \" is not a file path\"]);\r\n});\r\n\r\nvar SEP=\"/\";\r\nPathUtil={\r\n    Path: Path,Absolute:Absolute, Relative:Relative, Dir:Dir,File:File,\r\n    AbsDir:AbsDir,\r\n    SEP: SEP,\r\n    endsWith: endsWith, startsWith:startsWith,\r\n    isChildOf: function(child, parent) {\r\n        return this.startsWith( this.normalize(child), this.normalize(parent));\r\n    },\r\n    normalize: function (path) {\r\n        return this.fixSep(path,\"/\").replace(/\\/+$/,\"/\");\r\n    },\r\n    hasDriveLetter: function (path) {\r\n        return driveLetter.exec(path);\r\n    },\r\n    isURL: function (path) {\r\n        var r=url.exec(path);\r\n        if (!r) return;\r\n        return {protocol:r[1], hostPort:r[2], path:SEP+path.substring(r[0].length)  };\r\n    },\r\n    isPath: function (path) {\r\n    \tassert.is(arguments,[String]);\r\n\t\treturn true;//!path.match(/\\/\\//);\r\n    },\r\n    isRelativePath: function (path) {\r\n\t\tassert.is(arguments,[String]);\r\n\t\treturn PathUtil.isPath(path) && !PathUtil.isAbsolutePath(path);\r\n    },\r\n    isAbsolutePath: function (path) {\r\n\t\tassert.is(arguments,[String]);\r\n\t\treturn PathUtil.isPath(path) &&\r\n\t\t(PathUtil.startsWith(path,SEP) || PathUtil.hasDriveLetter(path) ||  PathUtil.isURL(path));\r\n    },\r\n    isDir: function (path) {\r\n        path=PathUtil.fixSep(path);\r\n\t\tassert.is(arguments,[Path]);\r\n        return endsWith(path,SEP);\r\n    },\r\n    hasBackslashSep:function (path) {\r\n        return path.indexOf(\"\\\\\")>=0;\r\n    },\r\n    fixSep: function (path,to) {\r\n        to=to||\"/\";\r\n        assert.is(arguments,[String]);\r\n        return assert.is( path.replace(/[\\\\\\/]/g,to), Path);\r\n    },\r\n    directorify: function (path) {\r\n        //path=PathUtil.fixSep(path);\r\n        if (PathUtil.isDir(path)) return path;\r\n        return assert.is(path+SEP, Dir);\r\n    },\r\n    filify: function (path) {\r\n        //path=PathUtil.fixSep(path);\r\n        if (!PathUtil.isDir(path)) return path;\r\n        return assert.is(path.substring(0,path.length-1),File);\r\n    },\r\n\tsplitPath: function (path) {\r\n\t\tassert.is(arguments,[Path]);\r\n\t\tvar u;\r\n\t\tif (u=this.isURL(path)) {\r\n\t\t    var p=this.splitPath(u.path);\r\n\t\t    p[0]=u.protocol+\"://\"+u.hostPort;\r\n\t\t    return p;\r\n\t\t}\r\n\t\tpath=path.replace(/\\/+/g,SEP);\r\n\t    var res=path.split(SEP);\r\n        if (res[res.length-1]==\"\") {\r\n            res[res.length-2]+=SEP;\r\n            res.pop();\r\n        }\r\n        return res;\r\n    },\r\n    name: function(path) {\r\n\t\tassert.is(arguments,[String]);\r\n        return PathUtil.splitPath(path).pop();\r\n    },\r\n    ext: function(path) {\r\n\t\tassert.is(arguments,[String]);\r\n        var n = PathUtil.name(path);\r\n        var r = (/\\.[a-zA-Z0-9]+$/).exec(n);\r\n        if (r) return r[0];\r\n        return null;\r\n    },\r\n    truncExt: function(path, ext) {\r\n\t\tassert.is(path,String);\r\n        var name = PathUtil.name(path);\r\n        ext=ext || PathUtil.ext(path);\r\n        assert.is(ext,String);\r\n        return name.substring(0, name.length - ext.length);\r\n    },\r\n    truncSEP: function (path) {\r\n\t\tassert.is(arguments,[Path]);\r\n\t\tif (!PathUtil.isDir(path)) return path;\r\n\t\treturn path.substring(0,path.length-1);\r\n    },\r\n    endsWith: function(path, postfix) {\r\n\t\tassert.is(arguments,[String,String]);\r\n        return endsWith(PathUtil.name(path), postfix);\r\n    },\r\n    parent: function(path) {\r\n\t\tassert.is(arguments,[String]);\r\n        return PathUtil.up(path);\r\n    },\r\n    rel: function(path,relPath) {\r\n        if (relPath==\"\") return path;\r\n\t\tassert.is(arguments,[AbsDir, Relative]);\r\n    \tvar paths=PathUtil.splitPath(relPath);\r\n        var resPath=path;\r\n        resPath=resPath.replace(/\\/$/,\"\");\r\n        var t=PathUtil;\r\n        paths.forEach(function (n) {\r\n             if (n==\"..\" || n==\"../\") resPath=t.up(resPath);\r\n             else {\r\n                 resPath=resPath.replace(/\\/$/,\"\");\r\n                 resPath+=SEP+(n==\".\"||n==\"./\" ? \"\": n);\r\n             }\r\n        });\r\n        return resPath;\r\n    },\r\n    relPath: function(path,base) {\r\n\t\tassert.is(arguments,[Absolute,Absolute]);\r\n        if (path.substring(0,base.length)!=base) {\r\n            return \"../\"+PathUtil.relPath(path, this.up(base));\r\n        }\r\n        return path.substring(base.length);\r\n    },\r\n    up: function(path) {\r\n        //path=PathUtil.fixSep(path);\r\n        if (path==SEP) return null;\r\n        var ps=PathUtil.splitPath(path);\r\n        ps.pop();\r\n        return ps.join(SEP)+SEP;\r\n    }\r\n};\r\n[\"directorify\", \"filify\", \"splitPath\", \"name\", \"rel\", \"relPath\", \"up\"].forEach(function (k) {\r\n    var old=PathUtil[k];\r\n    PathUtil[k]=function () {\r\n        var backslashifyAfter=false;\r\n        var a=Array.prototype.slice.call(arguments).map(function (e) {\r\n            if (PathUtil.hasBackslashSep(e)) {\r\n                backslashifyAfter=true;\r\n                return PathUtil.fixSep(e);\r\n            } else {\r\n                return e;\r\n            }\r\n        });\r\n        var res=old.apply(PathUtil,a);\r\n        if (backslashifyAfter) {\r\n            return PathUtil.fixSep(res,\"\\\\\");\r\n        } else {\r\n            return res;\r\n        }\r\n    };\r\n});\r\n\r\nPathUtil.isAbsolute=PathUtil.isAbsolutePath;\r\nPathUtil.isRelative=PathUtil.isRelativePath;\r\nif (typeof window==\"object\") window.PathUtil=PathUtil;\r\nreturn PathUtil;\r\n});\r\n\r\ndefine('MIMETypes',[], function () {\r\n   return {\r\n      \".png\":\"image/png\",\r\n      \".gif\":\"image/gif\",\r\n      \".jpeg\":\"image/jpeg\",\r\n      \".jpg\":\"image/jpeg\",\r\n      \".ico\":\"image/icon\",\r\n      \".wav\":\"audio/x-wav\",\r\n      \".mp3\":\"audio/mp3\",\r\n      \".ogg\":\"audio/ogg\",\r\n      \".midi\":\"audio/midi\",\r\n      \".mid\":\"audio/midi\",\r\n      \".mzo\":\"audio/mzo\",\r\n      \".txt\":\"text/plain\",\r\n      \".html\":\"text/html\",\r\n      \".htm\":\"text/html\",\r\n      \".css\":\"text/css\",\r\n      \".js\":\"text/javascript\",\r\n      \".json\":\"text/json\",\r\n      \".zip\":\"application/zip\",\r\n      \".swf\":\"application/x-shockwave-flash\",\r\n      \".pdf\":\"application/pdf\",\r\n      \".doc\":\"application/word\",\r\n      \".xls\":\"application/excel\",\r\n      \".ppt\":\"application/powerpoint\",\r\n      '.docx':'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n      '.docm':'application/vnd.ms-word.document.macroEnabled.12',\r\n      '.dotx':'application/vnd.openxmlformats-officedocument.wordprocessingml.template',\r\n      '.dotm':'application/vnd.ms-word.template.macroEnabled.12',\r\n      '.xlsx':'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n      '.xlsm':'application/vnd.ms-excel.sheet.macroEnabled.12',\r\n      '.xltx':'application/vnd.openxmlformats-officedocument.spreadsheetml.template',\r\n      '.xltm':'application/vnd.ms-excel.template.macroEnabled.12',\r\n      '.xlsb':'application/vnd.ms-excel.sheet.binary.macroEnabled.12',\r\n      '.xlam':'application/vnd.ms-excel.addin.macroEnabled.12',\r\n      '.pptx':'application/vnd.openxmlformats-officedocument.presentationml.presentation',\r\n      '.pptm':'application/vnd.ms-powerpoint.presentation.macroEnabled.12',\r\n      '.potx':'application/vnd.openxmlformats-officedocument.presentationml.template',\r\n      '.potm':'application/vnd.ms-powerpoint.template.macroEnabled.12',\r\n      '.ppsx':'application/vnd.openxmlformats-officedocument.presentationml.slideshow',\r\n      '.ppsm':'application/vnd.ms-powerpoint.slideshow.macroEnabled.12',\r\n      '.ppam':'application/vnd.ms-powerpoint.addin.macroEnabled.12',\r\n      \".tonyu\":\"text/tonyu\",\r\n      \".c\":\"text/c\",\r\n      \".dtl\":\"text/dolittle\"\r\n   };\r\n});\r\n\r\ndefine('DeferredUtil',[], function () {\r\n    var root=(\r\n        typeof window!==\"undefined\" ? window :\r\n        typeof self!==\"undefined\" ? self :\r\n        typeof global!==\"undefined\" ? global : null\r\n    );\r\n    //  promise.then(S,F)  and promise.then(S).fail(F) is not same!\r\n    //  ->  when fail on S,  F is executed?\r\n    //   same is promise.then(S).then(same,F)\r\n    var DU;\r\n    var DUBRK=function(r){this.res=r;};\r\n    function same(e){return e;}\r\n    DU={\r\n        isNativePromise: function (p) {\r\n            return p && (typeof p.then===\"function\") &&\r\n            (typeof p.promise!==\"function\") && (typeof p.catch===\"function\") ;\r\n        },\r\n        isJQPromise: function (p) {\r\n            return p && (typeof p.then===\"function\") &&\r\n            (typeof p.promise===\"function\") &&(typeof p.fail===\"function\") ;\r\n        },\r\n        isPromise: function (p) {\r\n            return p && (typeof p.then===\"function\") &&\r\n            ((typeof p.promise===\"function\") || (typeof p.catch===\"function\")) ;\r\n        },\r\n        all: function (a) {\r\n            //var a=Array.prototype.slice.call(arguments);\r\n            return DU.promise(function (succ,fail) {\r\n                var res=[],rest=a.length;\r\n                a.forEach(function (p, i) {\r\n                    DU.resolve(p).then(function (r) {\r\n                        res[i]=r;\r\n                        rest--;\r\n                        if (rest===0) {\r\n                            succ(res);\r\n                        }\r\n                    },fail);\r\n                });\r\n            });\r\n        },\r\n        resolve: function (p) {\r\n            if (DU.config.useJQ && DU.isJQPromise(p)) return p;\r\n            if (!DU.config.useJQ && DU.isNativePromise(p)) return p;\r\n            return DU.promise(function (succ,fail) {\r\n                if (DU.isPromise(p)) {\r\n                    p.then(succ,fail);\r\n                } else {\r\n                    succ(p);\r\n                }\r\n            });\r\n            /*if (DU.isPromise(p)) { // NO! it returns Promise when using JQPromise and vise versa.\r\n                return f;\r\n            }\r\n            if (DU.confing.useJQ) {\r\n                return $.when(p);\r\n            }*/\r\n        },\r\n        throwNowIfRejected: function (p) {\r\n            // If Promise p has already rejected, throws the rejeceted reason immediately.\r\n            var state;\r\n            var err;\r\n            var res=p.then(function (r) {\r\n                if (!state) {\r\n                    state=\"resolved\";\r\n                }\r\n                return r;\r\n            },function (e) {\r\n                if (!state) {\r\n                    state=\"rejected\";\r\n                    err=e;\r\n                } else {\r\n                    return DU.reject(e);\r\n                }\r\n            });\r\n            if (!state) state=\"notyet\";\r\n            if (state===\"rejected\") throw err;\r\n            return res;\r\n        },\r\n        assertResolved: function (p) {\r\n            var res,resolved;\r\n            p.then(function (r) {\r\n                res=r;\r\n                resolved=true;\r\n            });\r\n            if (!resolved) {\r\n                throw new Error(\"Promise not resolved\");\r\n            }\r\n            return res;\r\n        },\r\n        /*toJQPromise: function (p) {// From native Promise\r\n            if (!p) return $.when(p);\r\n            if ($.isFunction(p.promise)) return p;\r\n            if (!$.isFunction(p.then) || !$.isFunction(p.catch)) return $.when(p);\r\n            var d=new $.Deferred();\r\n            p.then(function (r) {\r\n                d.resolve(r);\r\n            }).catch(function (r) {\r\n                d.reject(r);\r\n            });\r\n            return d.promise();\r\n        },*/\r\n        ensureDefer: function (v) {\r\n            return DU.promise(function (resolve,reject) {\r\n                var isDeferred;\r\n                DU.resolve(v).then(function (r) {\r\n                    if (!isDeferred) {\r\n                        setTimeout(function () {\r\n                            resolve(r);\r\n                        },0);\r\n                    } else {\r\n                        resolve(r);\r\n                    }\r\n                }).then(same,function (r) {\r\n                    if (!isDeferred) {\r\n                        setTimeout(function () {\r\n                            reject(r);\r\n                        },0);\r\n                    } else {\r\n                        reject(r);\r\n                    }\r\n                });\r\n                isDeferred=true;\r\n            });\r\n        },\r\n        directPromise:function (v) {\r\n            return DU.timeout(v,0);\r\n        },\r\n        then: function (f) {\r\n            return DU.directPromise().then(f);\r\n        },\r\n        timeout:function (timeout,value) {\r\n            return DU.promise(function (resolve) {\r\n                setTimeout(function () {resolve(value);},timeout||0);\r\n            });\r\n        },\r\n        funcPromise:function (f) {\r\n            if (DU.config.useJQ) {\r\n                var d=new $.Deferred();\r\n                try {\r\n                    f(function (v) {\r\n                        d.resolve(v);\r\n                    },function (e) {\r\n                        d.reject(e);\r\n                    });\r\n                }catch(e) {\r\n                    d.reject(e);\r\n                }\r\n                return d.promise();\r\n            } else if (DU.external.Promise) {\r\n                return new DU.external.Promise(function (resolve,reject) {\r\n                    try {\r\n                        f(resolve,reject);\r\n                    }catch(e) {\r\n                        reject(e);\r\n                    }\r\n                });\r\n            } else {\r\n                throw new Error(\"promise is not found\");\r\n            }\r\n        },\r\n        reject: function (e) {\r\n            if (DU.config.useJQ) {\r\n                var d=new $.Deferred();\r\n                d.reject(e);\r\n                return d.promise();\r\n            } else {\r\n                return new DU.external.Promise(function (s,rej) {\r\n                    rej(e);\r\n                });\r\n            }\r\n        },\r\n        throwPromise:function (e) {\r\n            if (DU.config.useJQ) {\r\n                var d=new $.Deferred();\r\n                setTimeout(function () {\r\n                    d.reject(e);\r\n                }, 0);\r\n                return d.promise();\r\n            } else {\r\n                return new DU.external.Promise(function (s,rej) {\r\n                    rej(e);\r\n                });\r\n            }\r\n        },\r\n        throwF: function (f) {\r\n            return function () {\r\n                try {\r\n                    return f.apply(this,arguments);\r\n                } catch(e) {\r\n                    console.log(e,e.stack);\r\n                    return DU.throwPromise(e);\r\n                }\r\n            };\r\n        },\r\n        each: function (set,f) {\r\n            if (set instanceof Array) {\r\n                return DU.loop(function (i) {\r\n                    if (i>=set.length) return DU.brk();\r\n                    return DU.resolve(f(set[i],i)).then(function () {\r\n                        return i+1;\r\n                    });\r\n                },0);\r\n            } else {\r\n                var objs=[];\r\n                for (var i in set) {\r\n                    objs.push({k:i,v:set[i]});\r\n                }\r\n                return DU.each(objs,function (e) {\r\n                    return f(e.k, e.v);\r\n                });\r\n            }\r\n        },\r\n        loop: function (f,r) {\r\n            try {\r\n                var err;\r\n                while(true) {\r\n                    if (r instanceof DUBRK) return DU.when1(r.res);\r\n                    var deff1=true, deff2=false;\r\n                    //  not deffered    deferred\r\n                    var r1=f(r);\r\n                    var dr=DU.resolve(r1).then(function (r2) {\r\n                        r=r2;\r\n                        deff1=false;\r\n                        if (r instanceof DUBRK) return r.res;\r\n                        if (deff2) return DU.loop(f,r); //\r\n                    }).then(same,function (e) {\r\n                        deff1=false;\r\n                        err=e;\r\n                    });\r\n                    if (err) throw err;\r\n                    deff2=true;\r\n                    if (deff1) return dr;//\r\n                    //\r\n                }\r\n            }catch (e) {\r\n                return DU.reject(e);\r\n            }\r\n        },\r\n        brk: function (res) {\r\n            return new DUBRK(res);\r\n        },\r\n        tryLoop: function (f,r) {\r\n            return DU.loop(DU.tr(f),r);\r\n        },\r\n        tryEach: function (s,f) {\r\n            return DU.loop(s,DU.tr(f));\r\n        },\r\n        documentReady:function () {\r\n            return DU.callbackToPromise(function (s) {$(s);});\r\n        },\r\n        requirejs:function (modules) {\r\n            if (!root.requirejs) throw new Error(\"requirejs is not loaded\");\r\n            return DU.callbackToPromise(function (s) {\r\n                root.requirejs(modules,s);\r\n            });\r\n        }\r\n    };\r\n    DU.NOP=function (r) {return r;};\r\n    DU.E=function () {\r\n        console.log(\"DUE\",arguments);\r\n        DU.errorHandler.apply(DU,arguments);\r\n    };\r\n    DU.errorHandler=function (e) {\r\n        console.error.apply(console,arguments);\r\n        alert(e);\r\n    };\r\n    DU.setE=function (f) {\r\n        DU.errorHandler=f;\r\n    };\r\n    DU.begin=DU.try=DU.tr=DU.throwF;\r\n    DU.promise=DU.callbackToPromise=DU.funcPromise;\r\n    DU.when1=DU.resolve;\r\n    DU.config={};\r\n    if (root.$ && root.$.Deferred) {\r\n        DU.config.useJQ=true;\r\n    }\r\n    DU.external={Promise:root.Promise};\r\n    if (!root.DeferredUtil) root.DeferredUtil=DU;\r\n    return DU;\r\n});\r\n\r\ndefine('FSClass',[\"extend\",\"PathUtil\",\"MIMETypes\",\"assert\",\"DeferredUtil\"],\r\nfunction (extend, P, M,assert,DU){\r\n    var FS=function () {\r\n    };\r\n    var fstypes={};\r\n    FS.addFSType=function (name,fsgen) {\r\n        fstypes[name]=fsgen;\r\n    };\r\n    FS.availFSTypes=function () {\r\n        return fstypes;\r\n    };\r\n    function stub(n) {\r\n        throw new Error (n+\" is STUB!\");\r\n    }\r\n    extend(FS.prototype, {\r\n        err: function (path, mesg) {\r\n            throw new Error(path+\": \"+mesg);\r\n        },\r\n        fstype:function () {\r\n            return \"Unknown\";\r\n        },\r\n        isReadOnly: function (path, options) {// mainly for check ENTIRELY read only\r\n            stub(\"isReadOnly\");\r\n        },\r\n        supportsSync: function () {\r\n            return true;\r\n        },\r\n        resolveFS:function (path, options) {\r\n            assert(this.getRootFS()!==this);\r\n            return this.getRootFS().resolveFS(path);\r\n        },\r\n        mounted: function (rootFS, mountPoint ) {\r\n            //assert.is(arguments,[FS,P.AbsDir]);\r\n            this.rootFS=rootFS;\r\n            this.mountPoint=mountPoint;\r\n        },\r\n        inMyFS:function (path) {\r\n            return !this.mountPoint || P.startsWith(path, this.mountPoint);\r\n        },\r\n        /*dirFromFstab: function (path, options) {\r\n            assert.is(path, P.AbsDir);\r\n            var res=(options||{}).res || [];\r\n            this.fstab().forEach(function (tb) {\r\n                if (P.up( tb.path )==path) res.push(P.name(tb.path));\r\n            });\r\n            return res;\r\n        },*/\r\n        getRootFS: function () {\r\n            return assert( this.rootFS, \"rootFS is not set\" );\r\n        },\r\n        //-------- end of mouting\r\n        //-------- spec\r\n        getReturnTypes: function (path, options) {\r\n            //{getContent:String|DataURL|ArrayBuffer|OutputStream|Writer\r\n            //   ,opendir:Array|...}\r\n            stub(\"\");\r\n        },\r\n        //-------  for file\r\n        getContent: function (path, options) {\r\n            // options:{type:String|DataURL|ArrayBuffer|OutputStream|Writer}\r\n            // succ : [type],\r\n            stub(\"getContent\");\r\n        },\r\n        size: function (path) {\r\n            var c=this.getContent(path,{type:ArrayBuffer});\r\n            var l=c.toBin().byteLength;\r\n            return l;\r\n        },\r\n        getContentAsync: function (path, options) {\r\n            if (!this.supportsSync()) stub(\"getContentAsync\");\r\n            return DU.resolve(this.getContent.apply(this,arguments));\r\n        },\r\n        setContent: function (path, content, options) {\r\n            // content: String|ArrayBuffer|InputStream|Reader\r\n            stub(\"\");\r\n        },\r\n        setContentAsync: function (path, content, options) {\r\n            var t=this;\r\n            if (!t.supportsSync()) stub(\"setContentAsync\");\r\n            return DU.resolve(content).then(function (content) {\r\n                return DU.resolve(t.setContent(path,content,options));\r\n            });\r\n        },\r\n        appendContent: function (path, content, options) {\r\n            //var nc=this.getContent(path,options).toPlainText()+content.toPlainText();\r\n            //return this.setContent(path, Content.fromPlainText(nc) , options);\r\n            stub(\"\");\r\n        },\r\n        appendContentAsync: function (path, content, options) {\r\n            var t=this;\r\n            if (!t.supportsSync()) stub(\"appendContentAsync\");\r\n            return DU.resolve(content).then(function (content) {\r\n                return DU.resolve(t.appendContent(path,content,options));\r\n            });\r\n        },\r\n        getMetaInfo: function (path, options) {\r\n            stub(\"\");\r\n        },\r\n        setMetaInfo: function (path, info, options) {\r\n            stub(\"\");\r\n        },\r\n        mkdir: function (path, options) {\r\n            stub(\"mkdir\");\r\n        },\r\n        touch: function (path) {\r\n            stub(\"touch\");\r\n        },\r\n        exists: function (path, options) {\r\n            // exists return false if path is existent by follwing symlink\r\n            stub(\"exists\");\r\n        },\r\n        opendir: function (path, options) {\r\n            //ret: [String] || Stream<string> // https://nodejs.org/api/stream.html#stream_class_stream_readable\r\n            stub(\"opendir\");\r\n        },\r\n        opendirAsync: function (path, options) {\r\n            if (!this.supportsSync()) stub(\"opendirAsync\");\r\n            return DU.resolve(this.opendir.apply(this,arguments));\r\n        },\r\n        cp: function(path, dst, options) {\r\n            assert.is(arguments,[P.Absolute,P.Absolute]);\r\n            this.assertExist(path);\r\n            options=options||{};\r\n            var srcIsDir=this.isDir(path);\r\n            var dstfs=this.getRootFS().resolveFS(dst);\r\n            var dstIsDir=dstfs.isDir(dst);\r\n            if (!srcIsDir && !dstIsDir) {\r\n                if (this.supportsSync() && dstfs.supportsSync()) {\r\n                    var cont=this.getContent(path);\r\n                    var res=dstfs.setContent(dst,cont);\r\n                    if (options.a) {\r\n                        dstfs.setMetaInfo(dst, this.getMetaInfo(path));\r\n                    }\r\n                    return res;\r\n                } else {\r\n                    return dstfs.setContentAsync(\r\n                            dst,\r\n                            this.getContentAsync(path)\r\n                    ).then(function (res) {\r\n                        if (options.a) {\r\n                            return dstfs.setMetaInfo(dst, this.getMetaInfo(path));\r\n                        }\r\n                        return res;\r\n                    });\r\n                }\r\n            } else {\r\n                throw new Error(\"only file to file supports\");\r\n            }\r\n        },\r\n        mv: function (path,to,options) {\r\n            this.cp(path,to,options);\r\n            return this.rm(path,{r:true});\r\n        },\r\n        rm:function (path, options) {\r\n            stub(\"\");\r\n        },\r\n        link: function (path, to, options) {\r\n            throw new Error(\"ln \"+to+\" \"+path+\" : This FS not support link.\");\r\n        },\r\n        getURL: function (path) {\r\n            stub(\"\");\r\n        },\r\n        onAddObserver: function (path) {\r\n        }\r\n    });\r\n    //res=[]; for (var k in a) { res.push(k); } res;\r\n    FS.delegateMethods=function (prototype,  methods) {\r\n        for (var n in methods) {\r\n            (function (n){\r\n                assert.ne(n,\"inMyFS\");\r\n                prototype[n]=function () {\r\n                    var path=arguments[0];\r\n                    assert.is(path,P.Absolute);\r\n                    var fs=this.resolveFS(path);\r\n                    //console.log(n, f.fs===this  ,f.fs, this);\r\n                    if (fs!==this) {\r\n                        console.log(\"Invoked for other fs\",this.mountPoint, fs.mountPoint)\r\n                        //arguments[0]=f.path;\r\n                        return fs[n].apply(fs, arguments);\r\n                    } else {\r\n                        return methods[n].apply(this, arguments);\r\n                    }\r\n                };\r\n            })(n);\r\n        }\r\n    };\r\n    FS.delegateMethods(FS.prototype, {\r\n        assertWriteable: function (path) {\r\n            if (this.isReadOnly(path)) this.err(path, \"read only.\");\r\n        },\r\n        getContentType: function (path, options) {\r\n            var e=(P.ext(path)+\"\").toLowerCase();\r\n            return M[e] || (options||{}).def || \"application/octet-stream\";\r\n        },\r\n        getBlob: function (path, options) {\r\n            var c=this.getContent(path);\r\n            options=options||{};\r\n            options.blobType=options.blobType||Blob;\r\n            options.binType=options.binType||ArrayBuffer;\r\n            if (c.hasPlainText()) {\r\n                return new options.blobType([c.toPlainText()],this.getContentType(path));\r\n            } else {\r\n                return new options.blobType([c.toBin(options.binType)],this.getContentType(path));\r\n            }\r\n        },\r\n        isText:function (path) {\r\n            var m=this.getContentType(path);\r\n            return P.startsWith( m, \"text\");\r\n        },\r\n        assertExist: function (path, options) {\r\n            if (!this.exists(path, options)) {\r\n                this.err(path, \": No such \"+(P.isDir(path)?\"directory\":\"file\"));\r\n            }\r\n        },\r\n        isDir: function (path,options) {\r\n            return P.isDir(path);\r\n        },\r\n        find: function (path, options) {\r\n            assert.is(arguments,[P.Absolute]);\r\n            var ls=this.opendir(path, options);\r\n            var t=this;\r\n            var res=[path];\r\n            ls.forEach(function (e) {\r\n                var ep=P.rel(path, e);\r\n                if (P.isDir(ep)) {\r\n                    var fs=t.resolveFS(ep);\r\n                    res=res.concat(\r\n                            fs.find( ep ,options)\r\n                    );\r\n                } else {\r\n                    res.push( ep );//getPathFromRootFS\r\n                }\r\n            });\r\n            return res;\r\n        },\r\n        resolveLink: function (path) {\r\n            assert.is(path,P.Absolute);\r\n            // returns non-link path\r\n            // ln -s /a/b/ /c/d/\r\n            // resolveLink /a/b/    ->  /a/b/\r\n            // resolveLink /c/d/e/f -> /a/b/e/f\r\n            // resolveLink /c/d/non_existent -> /a/b/non_existent\r\n            // isLink      /c/d/    -> /a/b/\r\n            // isLink      /c/d/e/f -> null\r\n            // ln /testdir/ /ram/files/\r\n            // resolveLink /ram/files/sub/test2.txt -> /testdir/sub/test2.txt\r\n            // path=/ram/files/test.txt\r\n            for (var p=path ; p ; p=P.up(p)) {\r\n                assert(!this.mountPoint || P.startsWith(p, this.mountPoint), p+\" is out of mountPoint. path=\"+path);\r\n                var l=this.isLink(p);  // p=/ram/files/ l=/testdir/\r\n                if (l) {\r\n                    assert(l!=p,\"l==p==\"+l);\r\n                    //        /testdir/    test.txt\r\n                    var np=P.rel(l,P.relPath(path, p));  //   /testdir/test.txt\r\n                    assert(np!=path,\"np==path==\"+np);\r\n                    return assert.is(this.getRootFS().resolveFS(np).resolveLink(np),P.Absolute)  ;\r\n                }\r\n                if (this.exists(p)) return path;\r\n            }\r\n            return path;\r\n        },\r\n        isLink: function (path) {\r\n            return null;\r\n        },\r\n        opendirEx: function (path, options) {\r\n            assert.is(path, P.AbsDir);\r\n            var ls=this.opendir(path);\r\n            var t=this;\r\n            var dest={};\r\n            ls.forEach(function (f) {\r\n                var p=P.rel(path,f);\r\n                dest[f]=t.getMetaInfo(p);\r\n            });\r\n            return dest;\r\n        },\r\n        getDirTree: function (path, options) {\r\n            options=options||{};\r\n            var dest=options.dest=options.dest||{};\r\n            options.style=options.style||\"flat-absolute\";\r\n            options.excludes=options.excludes||[];\r\n            assert.is(options.excludes,Array);\r\n            if (!options.base) {\r\n                options.base=path;\r\n            }\r\n            assert.is(path, P.AbsDir);\r\n            var tr=this.opendirEx(path,options);\r\n            if (options.style==\"no-recursive\") return tr;\r\n            var t=this;\r\n            for (var f in tr) {\r\n                var meta=tr[f];\r\n                var p=P.rel(path,f);\r\n                var relP=P.relPath(p,options.base);\r\n                switch(options.style) {\r\n                    case \"flat-relative\":\r\n                    case \"hierarchical\":\r\n                        if (options.excludes.indexOf(relP)>=0) {\r\n                            continue;\r\n                        }\r\n                        break;\r\n                    case \"flat-absolute\":\r\n                        if (options.excludes.indexOf(p)>=0) {\r\n                            continue;\r\n                        }\r\n                        break;\r\n                }\r\n                if (t.isDir(p)) {\r\n                    switch(options.style) {\r\n                    case \"flat-absolute\":\r\n                    case \"flat-relative\":\r\n                        t.getDirTree(p,options);\r\n                        break;\r\n                    case \"hierarchical\":\r\n                        options.dest={};\r\n                        dest[f]=t.getDirTree(p,options);\r\n                        break;\r\n                    }\r\n                } else {\r\n                    switch(options.style) {\r\n                    case \"flat-absolute\":\r\n                        dest[p]=meta;\r\n                        break;\r\n                    case \"flat-relative\":\r\n                        dest[relP]=meta;\r\n                        break;\r\n                    case \"hierarchical\":\r\n                        dest[f]=meta;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return dest;\r\n        }\r\n        /*get: function (path) {\r\n            assert.eq(this.resolveFS(path), this);\r\n            return new SFile(this, path);\r\n            //var r=this.resolveFS(path);\r\n            //return new SFile(r.fs, r.path);\r\n        }*/\r\n\r\n    });\r\n    return FS;\r\n});\r\n\r\ndefine('Util',[],function () {\r\nfunction getQueryString(key, default_)\r\n{\r\n   if (default_==null) default_=\"\";\r\n   key = key.replace(/[\\[]/,\"\\\\\\[\").replace(/[\\]]/,\"\\\\\\]\");\r\n   var regex = new RegExp(\"[\\\\?&]\"+key+\"=([^&#]*)\");\r\n   var qs = regex.exec(window.location.href);\r\n   if(qs == null)\r\n    return default_;\r\n   else\r\n    return decodeURLComponentEx(qs[1]);\r\n}\r\nfunction decodeURLComponentEx(s){\r\n    return decodeURIComponent(s.replace(/\\+/g, '%20'));\r\n}\r\nfunction endsWith(str,postfix) {\r\n    return str.substring(str.length-postfix.length)===postfix;\r\n}\r\nfunction startsWith(str,prefix) {\r\n    return str.substring(0, prefix.length)===prefix;\r\n}\r\nfunction privatize(o){\r\n    if (o.__privatized) return o;\r\n    var res={__privatized:true};\r\n    for (var n in o) {\r\n        (function (n) {\r\n            var m=o[n];\r\n            if (n.match(/^_/)) return;\r\n            if (typeof m!=\"function\") return;\r\n            res[n]=function () {\r\n                var r=m.apply(o,arguments);\r\n                return r;\r\n            };\r\n        })(n);\r\n    }\r\n    return res;\r\n}\r\nfunction extend(d,s) {\r\n    for (var i in (s||{})) {d[i]=s[i];} \r\n    return d;\r\n}\r\nreturn {\r\n    getQueryString:getQueryString,\r\n    endsWith: endsWith, startsWith: startsWith,\r\n    privatize: privatize,extend:extend\r\n};\r\n});\r\n\r\n/*\r\n* FileSaver.js\r\n* A saveAs() FileSaver implementation.\r\n*\r\n* By Eli Grey, http://eligrey.com\r\n*\r\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\r\n* source  : http://purl.eligrey.com/github/FileSaver.js\r\n*/\r\ndefine('FileSaver',[],function (){\r\n\r\n// The one and only way of getting global scope in all environments\r\n// https://stackoverflow.com/q/3277182/1008999\r\nvar _global = typeof window === 'object' && window.window === window\r\n  ? window : typeof self === 'object' && self.self === self\r\n  ? self : typeof global === 'object' && global.global === global\r\n  ? global\r\n  : this\r\n\r\nfunction bom (blob, opts) {\r\n  if (typeof opts === 'undefined') opts = { autoBom: false }\r\n  else if (typeof opts !== 'object') {\r\n    console.warn('Depricated: Expected third argument to be a object')\r\n    opts = { autoBom: !opts }\r\n  }\r\n\r\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\r\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\r\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\r\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\r\n  }\r\n  return blob\r\n}\r\n\r\nfunction download (url, name, opts) {\r\n  var xhr = new XMLHttpRequest()\r\n  xhr.open('GET', url)\r\n  xhr.responseType = 'blob'\r\n  xhr.onload = function () {\r\n    saveAs(xhr.response, name, opts)\r\n  }\r\n  xhr.onerror = function () {\r\n    console.error('could not download file')\r\n  }\r\n  xhr.send()\r\n}\r\n\r\nfunction corsEnabled (url) {\r\n  var xhr = new XMLHttpRequest()\r\n  // use sync to avoid popup blocker\r\n  xhr.open('HEAD', url, false)\r\n  xhr.send()\r\n  return xhr.status >= 200 && xhr.status <= 299\r\n}\r\n\r\n// `a.click()` doesn't work for all browsers (#465)\r\nfunction click(node) {\r\n  try {\r\n    node.dispatchEvent(new MouseEvent('click'))\r\n  } catch (e) {\r\n    var evt = document.createEvent('MouseEvents')\r\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\r\n                          20, false, false, false, false, 0, null)\r\n    node.dispatchEvent(evt)\r\n  }\r\n}\r\n\r\nvar saveAs = _global.saveAs ||\r\n// probably in some web worker\r\n(typeof window !== 'object' || window !== _global)\r\n  ? function saveAs () { /* noop */ }\r\n\r\n// Use download attribute first if possible (#193 Lumia mobile)\r\n: 'download' in HTMLAnchorElement.prototype\r\n? function saveAs (blob, name, opts) {\r\n  var URL = _global.URL || _global.webkitURL\r\n  var a = document.createElement('a')\r\n  name = name || blob.name || 'download'\r\n\r\n  a.download = name\r\n  a.rel = 'noopener' // tabnabbing\r\n\r\n  // TODO: detect chrome extensions & packaged apps\r\n  // a.target = '_blank'\r\n\r\n  if (typeof blob === 'string') {\r\n    // Support regular links\r\n    a.href = blob\r\n    if (a.origin !== location.origin) {\r\n      corsEnabled(a.href)\r\n        ? download(blob, name, opts)\r\n        : click(a, a.target = '_blank')\r\n    } else {\r\n      click(a)\r\n    }\r\n  } else {\r\n    // Support blobs\r\n    a.href = URL.createObjectURL(blob)\r\n    setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\r\n    setTimeout(function () { click(a) }, 0)\r\n  }\r\n}\r\n\r\n// Use msSaveOrOpenBlob as a second approach\r\n: 'msSaveOrOpenBlob' in navigator\r\n? function saveAs (blob, name, opts) {\r\n  name = name || blob.name || 'download'\r\n\r\n  if (typeof blob === 'string') {\r\n    if (corsEnabled(blob)) {\r\n      download(blob, name, opts)\r\n    } else {\r\n      var a = document.createElement('a')\r\n      a.href = blob\r\n      a.target = '_blank'\r\n      setTimeout(function () { click(a) })\r\n    }\r\n  } else {\r\n    navigator.msSaveOrOpenBlob(bom(blob, opts), name)\r\n  }\r\n}\r\n\r\n// Fallback to using FileReader and a popup\r\n: function saveAs (blob, name, opts, popup) {\r\n  // Open a popup immediately do go around popup blocker\r\n  // Mostly only avalible on user interaction and the fileReader is async so...\r\n  popup = popup || open('', '_blank')\r\n  if (popup) {\r\n    popup.document.title =\r\n    popup.document.body.innerText = 'downloading...'\r\n  }\r\n\r\n  if (typeof blob === 'string') return download(blob, name, opts)\r\n\r\n  var force = blob.type === 'application/octet-stream'\r\n  var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\r\n  var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\r\n\r\n  if ((isChromeIOS || (force && isSafari)) && typeof FileReader === 'object') {\r\n    // Safari doesn't allow downloading of blob urls\r\n    var reader = new FileReader()\r\n    reader.onloadend = function () {\r\n      var url = reader.result\r\n      url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\r\n      if (popup) popup.location.href = url\r\n      else location = url\r\n      popup = null // reverse-tabnabbing #460\r\n    }\r\n    reader.readAsDataURL(blob)\r\n  } else {\r\n    var URL = _global.URL || _global.webkitURL\r\n    var url = URL.createObjectURL(blob)\r\n    if (popup) popup.location = url\r\n    else location.href = url\r\n    popup = null // reverse-tabnabbing #460\r\n    setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\r\n  }\r\n}\r\n\r\n_global.saveAs = saveAs.saveAs = saveAs\r\n\r\nif (typeof module !== 'undefined') {\r\n  module.exports = saveAs;\r\n}\r\nreturn saveAs;\r\n});\r\n\r\ndefine('Content',[\"assert\",\"Util\",\"FileSaver\"],function (assert,Util,saveAs) {\r\n    var Content=function () {};\r\n    var extend=Util.extend;\r\n    // ------ constructor\r\n    Content.plainText=function (s,contentType){\r\n        var b=new Content;\r\n        b.contentType=contentType||\"text/plain\";\r\n        b.plain=s;\r\n        return b;\r\n    };\r\n    Content.url=function (s) {\r\n        var b=new Content;\r\n        b.url=s;\r\n        return b;\r\n    };\r\n    Content.buffer2ArrayBuffer = function (a) {\r\n        if (Content.isBuffer(a)) {\r\n            var u=new Uint8Array(a);\r\n            var r=u.buffer;\r\n            if (r instanceof ArrayBuffer) return r;\r\n            var ary=Array.prototype.slice.call(u);\r\n            return assert(new Uint8Array(ary).buffer,\"n2a: buf is not set\");\r\n        }\r\n        return assert(a,\"n2a: a is not set\");\r\n    };\r\n    Content.arrayBuffer2Buffer= function (a) {\r\n        if (a instanceof ArrayBuffer) {\r\n            var b=new Buffer(new Uint8Array(a));\r\n            return b;\r\n        }\r\n        return assert(a,\"a2n: a is not set\");\r\n    };\r\n\r\n    Content.bin=function (bin, contentType) {\r\n        assert(contentType, \"contentType should be set\");\r\n        var b=new Content;\r\n        if (Content.isNodeBuffer(bin)) {\r\n            b.bufType=\"node\";\r\n            b.nodeBuffer=bin;\r\n        } else if (bin instanceof ArrayBuffer) {\r\n            b.bufType=\"array2\";\r\n            b.arrayBuffer=bin;\r\n        } else if (bin && Content.isBuffer(bin.buffer)) {\r\n            // in node.js v8.9.1 ,\r\n            ///  bin is Buffer, bin.buffer is ArrayBuffer\r\n            //   and bin.buffer is content of different file(memory leak?) \r\n            b.bufType=\"array1\";\r\n            b.arrayBuffer=bin.buffer;\r\n        } else {\r\n            throw new Error(bin+\" is not a bin\");\r\n        }\r\n        b.contentType=contentType;\r\n        return b;\r\n    };\r\n    Content.looksLikeDataURL=function (text) {\r\n        return text.match(/^data:/);\r\n    };\r\n    Content.download=saveAs;\r\n    // why blob is not here... because blob content requires FileReader (cannot read instantly!)\r\n    //------- methods\r\n    var p=Content.prototype;\r\n    p.toBin = function (binType) {\r\n        binType=binType || (Content.hasNodeBuffer() ? Buffer: ArrayBuffer);\r\n        if (this.nodeBuffer) {\r\n            if (binType===Buffer) {\r\n                return this.nodeBuffer;\r\n            } else {\r\n                return this.arrayBuffer=( Content.buffer2ArrayBuffer(this.nodeBuffer) );\r\n            }\r\n        } else if (this.arrayBuffer) {\r\n            if (binType===ArrayBuffer) {\r\n                return this.arrayBuffer;\r\n            } else {\r\n                return this.nodeBuffer=( Content.arrayBuffer2Buffer(this.arrayBuffer) );\r\n            }\r\n        } else if (this.url) {\r\n            var d=new DataURL(this.url, binType);\r\n            return this.setBuffer(d.buffer);\r\n        } else if (this.plain!=null) {\r\n            return this.setBuffer( Content.str2utf8bytes(this.plain, binType) );\r\n        }\r\n        throw new Error(\"No data\");\r\n    };\r\n    p.setBuffer=function (b) {\r\n        assert(b,\"b is not set\");\r\n        if (Content.isNodeBuffer(b)) {\r\n            return this.nodeBuffer=b;\r\n        } else {\r\n            return this.arrayBuffer=b;\r\n        }\r\n    };\r\n    p.toArrayBuffer=function () {\r\n        return this.toBin(ArrayBuffer);\r\n    };\r\n    p.toNodeBuffer=function () {\r\n        return this.toBin(Buffer);\r\n    };\r\n    p.toURL=function () {\r\n        if (this.url) {\r\n            return this.url;\r\n        } else {\r\n            if (!this.arrayBuffer && this.plain!=null) {\r\n                this.arrayBuffer=Content.str2utf8bytes(this.plain,ArrayBuffer);\r\n            }\r\n            if (this.arrayBuffer || this.nodeBuffer) {\r\n                var d=new DataURL(this.arrayBuffer || this.nodeBuffer,this.contentType);\r\n                return this.url=d.url;\r\n            }\r\n        }\r\n        throw new Error(\"No data\");\r\n    };\r\n    p.toPlainText=function () {\r\n        if (this.hasPlainText()) {\r\n            return this.plain;\r\n        } else {\r\n            if (this.url && !this.hasBin() ) {\r\n                var d=new DataURL(this.url,ArrayBuffer);\r\n                this.arrayBuffer=d.buffer;\r\n            }\r\n            if (this.hasBin()) {\r\n                return this.plain=Content.utf8bytes2str(\r\n                        this.nodeBuffer || new Uint8Array(this.arrayBuffer)\r\n                );\r\n            }\r\n        }\r\n        throw new Error(\"No data\");\r\n    };\r\n    p.hasURL=function (){return this.url;};\r\n    p.hasPlainText=function (){return this.plain!=null;};\r\n    p.hasBin=function (){return this.nodeBuffer || this.arrayBuffer;};\r\n    p.hasNodeBuffer= function () {return this.nodeBuffer;};\r\n    p.hasArrayBuffer= function () {return this.arrayBuffer;};\r\n    p.toBlob=function () {\r\n        return new Blob([this.toBin(ArrayBuffer)],{type:this.contentType});\r\n    };\r\n    p.download=function (name) {\r\n        Content.download(this.toBlob(),name);\r\n    };\r\n    //--------Util funcs\r\n    // From http://hakuhin.jp/js/base64.html#BASE64_DECODE_ARRAY_BUFFER\r\n    Content.Base64_To_ArrayBuffer=function (base64,binType){\r\n\t    var A=binType||ArrayBuffer;\r\n        base64=base64.replace(/[\\n=]/g,\"\");\r\n        var dic = new Object();\r\n        dic[0x41]= 0; dic[0x42]= 1; dic[0x43]= 2; dic[0x44]= 3; dic[0x45]= 4; dic[0x46]= 5; dic[0x47]= 6; dic[0x48]= 7; dic[0x49]= 8; dic[0x4a]= 9; dic[0x4b]=10; dic[0x4c]=11; dic[0x4d]=12; dic[0x4e]=13; dic[0x4f]=14; dic[0x50]=15;\r\n        dic[0x51]=16; dic[0x52]=17; dic[0x53]=18; dic[0x54]=19; dic[0x55]=20; dic[0x56]=21; dic[0x57]=22; dic[0x58]=23; dic[0x59]=24; dic[0x5a]=25; dic[0x61]=26; dic[0x62]=27; dic[0x63]=28; dic[0x64]=29; dic[0x65]=30; dic[0x66]=31;\r\n        dic[0x67]=32; dic[0x68]=33; dic[0x69]=34; dic[0x6a]=35; dic[0x6b]=36; dic[0x6c]=37; dic[0x6d]=38; dic[0x6e]=39; dic[0x6f]=40; dic[0x70]=41; dic[0x71]=42; dic[0x72]=43; dic[0x73]=44; dic[0x74]=45; dic[0x75]=46; dic[0x76]=47;\r\n        dic[0x77]=48; dic[0x78]=49; dic[0x79]=50; dic[0x7a]=51; dic[0x30]=52; dic[0x31]=53; dic[0x32]=54; dic[0x33]=55; dic[0x34]=56; dic[0x35]=57; dic[0x36]=58; dic[0x37]=59; dic[0x38]=60; dic[0x39]=61; dic[0x2b]=62; dic[0x2f]=63;\r\n        var num = base64.length;\r\n        var n = 0;\r\n        var b = 0;\r\n        var e;\r\n\r\n        if(!num) return (new A(0));\r\n        //if(num < 4) return null;\r\n        //if(num % 4) return null;\r\n\r\n        // AA     12    1\r\n        // AAA    18    2\r\n        // AAAA   24    3\r\n        // AAAAA  30    3\r\n        // AAAAAA 36    4\r\n        // num*6/8\r\n        e = Math.floor(num / 4 * 3);\r\n        if(base64.charAt(num - 1) == '=') e -= 1;\r\n        if(base64.charAt(num - 2) == '=') e -= 1;\r\n\r\n        var ary_buffer = new A( e );\r\n        var ary_u8 = (Content.isNodeBuffer(ary_buffer) ? ary_buffer : new Uint8Array( ary_buffer ));//new Uint8Array( ary_buffer );\r\n        var i = 0;\r\n        var p = 0;\r\n        while(p < e){\r\n            b = dic[base64.charCodeAt(i)];\r\n            if(b === undefined) fail(\"Invalid letter: \"+base64.charCodeAt(i));//return null;\r\n            n = (b << 2);\r\n            i ++;\r\n\r\n            b = dic[base64.charCodeAt(i)];\r\n            if(b === undefined) fail(\"Invalid letter: \"+base64.charCodeAt(i))\r\n            ary_u8[p] = n | ((b >> 4) & 0x3);\r\n            n = (b & 0x0f) << 4;\r\n            i ++;\r\n            p ++;\r\n            if(p >= e) break;\r\n\r\n            b = dic[base64.charCodeAt(i)];\r\n            if(b === undefined) fail(\"Invalid letter: \"+base64.charCodeAt(i))\r\n            ary_u8[p] = n | ((b >> 2) & 0xf);\r\n            n = (b & 0x03) << 6;\r\n            i ++;\r\n            p ++;\r\n            if(p >= e) break;\r\n\r\n            b = dic[base64.charCodeAt(i)];\r\n            if(b === undefined) fail(\"Invalid letter: \"+base64.charCodeAt(i))\r\n            ary_u8[p] = n | b;\r\n            i ++;\r\n            p ++;\r\n        }\r\n        function fail(m) {\r\n            console.log(m);\r\n            console.log(base64,i);\r\n            throw new Error(m);\r\n        }\r\n        return ary_buffer;\r\n    };\r\n\r\n    Content.Base64_From_ArrayBuffer=function (ary_buffer){\r\n        var dic = [\r\n            'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P',\r\n            'Q','R','S','T','U','V','W','X','Y','Z','a','b','c','d','e','f',\r\n            'g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',\r\n            'w','x','y','z','0','1','2','3','4','5','6','7','8','9','+','/'\r\n        ];\r\n        var base64 = \"\";\r\n        var ary_u8 = new Uint8Array( ary_buffer );\r\n        var num = ary_u8.length;\r\n        var n = 0;\r\n        var b = 0;\r\n\r\n        var i = 0;\r\n        while(i < num){\r\n            b = ary_u8[i];\r\n            base64 += dic[(b >> 2)];\r\n            n = (b & 0x03) << 4;\r\n            i ++;\r\n            if(i >= num) break;\r\n\r\n            b = ary_u8[i];\r\n            base64 += dic[n | (b >> 4)];\r\n            n = (b & 0x0f) << 2;\r\n            i ++;\r\n            if(i >= num) break;\r\n\r\n            b = ary_u8[i];\r\n            base64 += dic[n | (b >> 6)];\r\n            base64 += dic[(b & 0x3f)];\r\n            i ++;\r\n        }\r\n\r\n        var m = num % 3;\r\n        if(m){\r\n            base64 += dic[n];\r\n        }\r\n        if(m == 1){\r\n            base64 += \"==\";\r\n        }else if(m == 2){\r\n            base64 += \"=\";\r\n        }\r\n        return base64;\r\n    };\r\n\r\n    Content.hasNodeBuffer=function () {\r\n        return typeof Buffer!=\"undefined\";\r\n    };\r\n    Content.isNodeBuffer=function (data) {\r\n        return (Content.hasNodeBuffer() && data instanceof Buffer);\r\n    };\r\n    Content.isBuffer=function (data) {\r\n        return data instanceof ArrayBuffer || Content.isNodeBuffer(data);\r\n    };\r\n    Content.utf8bytes2str=function (bytes) {\r\n        var e=[];\r\n        for (var i=0 ; i<bytes.length ; i++) {\r\n             e.push(\"%\"+(\"0\"+bytes[i].toString(16)).slice(-2));\r\n        }\r\n        //try {\r\n            return decodeURIComponent(e.join(\"\"));\r\n        /*} catch (er) {\r\n            console.log(e.join(\"\"));\r\n            throw er;\r\n        }*/\r\n    };\r\n    Content.str2utf8bytes=function (str, binType) {\r\n        var e=encodeURIComponent(str);\r\n        var r=/^%(..)/;\r\n        var a=[];\r\n        var ad=0;\r\n        for (var i=0 ; i<e.length; i++) {\r\n            var m=r.exec( e.substring(i));\r\n            if (m) {\r\n                a.push(parseInt(\"0x\"+m[1]));\r\n                i+=m[0].length-1;\r\n            } else a.push(e.charCodeAt(i));\r\n        }\r\n        return (typeof Buffer!=\"undefined\" && binType===Buffer ? new Buffer(a) : new Uint8Array(a).buffer);\r\n    };\r\n    //-------- DataURL\r\n    var A=Content.hasNodeBuffer() ? Buffer :ArrayBuffer;\r\n    //var isBuffer=Util.isBuffer;\r\n    var DataURL=function (data, contentType){\r\n      // data: String/Array/ArrayBuffer\r\n      if (typeof data==\"string\") {\r\n          this.url=data;\r\n          this.binType=contentType || A;\r\n          this.dataURL2bin(data);\r\n      } else if (data && Content.isBuffer(data.buffer)) {\r\n          this.buffer=data.buffer;\r\n          assert.is(contentType,String);\r\n          this.contentType=contentType;\r\n          this.bin2dataURL(this.buffer, this.contentType);\r\n      } else if (Content.isBuffer(data)) {\r\n          this.buffer=data;\r\n          assert.is(contentType,String);\r\n          this.contentType=contentType;\r\n          this.bin2dataURL(this.buffer, this.contentType);\r\n      } else {\r\n          console.log(arguments);\r\n          assert.fail(\"Invalid args: \",arguments);\r\n      }\r\n   };\r\n   Content.DataURL=DataURL;\r\n   extend(DataURL.prototype,{\r\n      bin2dataURL: function (b, contentType) {\r\n          assert(Content.isBuffer(b));\r\n          assert.is(contentType,String);\r\n  \t     var head=this.dataHeader(contentType);\r\n\t     var base64=Content.Base64_From_ArrayBuffer(b);\r\n\t     assert.is(base64,String);\r\n\t     return this.url=head+base64;\r\n\t  },\r\n\t  dataURL2bin: function (dataURL) {\r\n          assert.is(arguments,[String]);\r\n\t      var reg=/^data:([^;]+);base64,/i;\r\n\t      var r=reg.exec(dataURL);\r\n\t      assert(r, [\"malformed dataURL:\", dataURL] );\r\n\t      this.contentType=r[1];\r\n\t      this.buffer=Content.Base64_To_ArrayBuffer(dataURL.substring(r[0].length) , this.binType);\r\n          return assert.is(this.buffer , this.binType);\r\n  \t  },\r\n  \t  dataHeader: function (ctype) {\r\n\t      assert.is(arguments,[String]);\r\n\t      return \"data:\"+ctype+\";base64,\";\r\n   \t  },\r\n   \t  toString: function () {return assert.is(this.url,String);}\r\n   });\r\n\r\n    return Content;\r\n});\r\n\r\n/*global process, global, Buffer*/\r\ndefine('NativeFS',[\"FSClass\",\"assert\",\"PathUtil\",\"extend\",\"Content\"],\r\n        function (FS,A,P,extend,Content) {\r\n    var assert=A,fs;\r\n    try {\r\n        fs=global.require(\"fs\");\r\n        fs.existsSync('test.txt');\r\n    }catch(e){\r\n        return function () {\r\n            throw new Error(\"This system not support native FS\");\r\n        };\r\n    }\r\n    var NativeFS=function (rootPoint) {\r\n        if (rootPoint) {\r\n            A.is(rootPoint, P.AbsDir);\r\n            this.rootPoint=rootPoint;\r\n        }\r\n    };\r\n    var hasDriveLetter=P.hasDriveLetter(process.cwd());\r\n    NativeFS.available=true;\r\n    var SEP=P.SEP;\r\n    //var json=JSON; // JSON changes when page changes, if this is node module, JSON is original JSON\r\n    var Pro=NativeFS.prototype=new FS();\r\n    Pro.toNativePath = function (path) {\r\n        // rootPoint: on NativePath   C:/jail/\r\n        // mountPoint: on VirtualFS   /mnt/natfs/\r\n        if (!this.rootPoint) return path;\r\n        A.is(path, P.Absolute);\r\n        A(this.inMyFS(path),path+\" is not fs of \"+this);\r\n        //console.log(\"tonat:MP\",P.rel( this.rootPoint, P.relPath(path, this.mountPoint || P.SEP)));\r\n        return P.rel( this.rootPoint, P.relPath(path, this.mountPoint || P.SEP));\r\n    };\r\n    Pro.arrayBuffer2Buffer= function (a) {\r\n        if (a instanceof ArrayBuffer) {\r\n            var b=new Buffer(new Uint8Array(a));\r\n            return b;\r\n        }\r\n        return a;\r\n    };\r\n\r\n    FS.addFSType(\"NativeFS\",function (path, options) {\r\n            return new NativeFS(options.r);\r\n    });\r\n    NativeFS.prototype.fstype=function () {\r\n        return \"Native\"+(this.rootPoint?\"(\"+this.rootPoint+\")\":\"\");\r\n    };\r\n    NativeFS.prototype.inMyFS=function (path) {\r\n        //console.log(\"inmyfs\",path);\r\n        if (this.mountPoint) {\r\n            return P.startsWith(path, this.mountPoint);\r\n        } else {\r\n//            console.log(path, hasDriveLetter , P.hasDriveLetter(path));\r\n            return !( !!hasDriveLetter ^ !!P.hasDriveLetter(path));\r\n        }\r\n    };\r\n    function E(r){return r;}\r\n    FS.delegateMethods(NativeFS.prototype, {\r\n        getReturnTypes: function(path, options) {\r\n            E(path,options);\r\n            assert.is(arguments,[String]);\r\n            return {\r\n                getContent: ArrayBuffer, opendir:[String]\r\n            };\r\n        },\r\n        getContent: function (path, options) {\r\n            options=options||{};\r\n            A.is(path,P.Absolute);\r\n            var np=this.toNativePath(path);\r\n            this.assertExist(path);\r\n            /*if (this.isText(path)) {\r\n                return Content.plainText( fs.readFileSync(np, {encoding:\"utf8\"}) );\r\n            } else {*/\r\n                return Content.bin( fs.readFileSync(np) , this.getContentType(path));\r\n            //}\r\n        },\r\n        size: function(path) {\r\n            var np=this.toNativePath(path);\r\n            var st=fs.statSync(np);\r\n            return st.size;\r\n        },\r\n        setContent: function (path,content) {\r\n            A.is(arguments,[P.Absolute,Content]);\r\n            var pa=P.up(path);\r\n            if (pa) this.getRootFS().resolveFS(pa).mkdir(pa);\r\n            var np=this.toNativePath(path);\r\n            if (content.hasBin() || !content.hasPlainText() ) {\r\n                fs.writeFileSync(np, content.toNodeBuffer() );\r\n            } else {\r\n                // !hasBin && hasText\r\n                fs.writeFileSync(np, content.toPlainText());\r\n            }\r\n        },\r\n        appendContent: function (path,content) {\r\n            A.is(arguments,[P.Absolute,Content]);\r\n            var pa=P.up(path);\r\n            if (pa) this.getRootFS().resolveFS(pa).mkdir(pa);\r\n            var np=this.toNativePath(path);\r\n            if (content.hasBin() || !content.hasPlainText() ) {\r\n                fs.appendFileSync(np, content.toNodeBuffer() );\r\n            } else {\r\n                // !hasBin && hasText\r\n                fs.appendFileSync(np, content.toPlainText());\r\n            }\r\n        },\r\n        getMetaInfo: function(path, options) {\r\n            this.assertExist(path, options);\r\n            var s=this.stat(path);\r\n            s.lastUpdate=s.mtime.getTime();\r\n            return s;\r\n        },\r\n        setMetaInfo: function(path, info, options) {\r\n            E(path, info, options);\r\n            //options.lastUpdate\r\n\r\n            //TODO:\r\n        },\r\n        isReadOnly: function (path) {\r\n            E(path);\r\n            // TODO:\r\n            return false;\r\n        },\r\n        stat: function (path) {\r\n            A.is(path,P.Absolute);\r\n            var np=this.toNativePath(path);\r\n            return fs.statSync(np);\r\n        },\r\n        mkdir: function(path, options) {\r\n            options=options||{};\r\n            assert.is(arguments,[P.Absolute]);\r\n            if (this.exists(path)){\r\n                if (this.isDir(path)) {\r\n                    return;\r\n                } else {\r\n                    throw new Error(this+\" is a file. not a dir.\");\r\n                }\r\n            }\r\n            this.assertWriteable(path);\r\n            var pa=P.up(path);\r\n            if (pa) this.getRootFS().resolveFS(pa).mkdir(pa);\r\n            var np=this.toNativePath(path);\r\n            fs.mkdirSync(np);\r\n            return this.assertExist(np);\r\n        },\r\n        opendir: function (path, options) {\r\n            assert.is(arguments,[String]);\r\n            options=options||{};\r\n            var np=this.toNativePath(path);\r\n            var ts=P.truncSEP(np);\r\n            var r=fs.readdirSync(np);\r\n            if (!options.nosep) {\r\n                r=r.map(function (e) {\r\n                    var s=fs.statSync(ts+SEP+e);\r\n                    var ss=s.isDirectory()?SEP:\"\";\r\n                    return e+ss;\r\n                });\r\n            }\r\n            var res=[]; //this.dirFromFstab(path);\r\n            return assert.is(res.concat(r),Array);\r\n        },\r\n        rm: function(path, options) {\r\n            assert.is(arguments,[P.Absolute]);\r\n            options=options||{};\r\n            this.assertExist(path);\r\n            var np=this.toNativePath(path);\r\n            if (this.isDir(path)) {\r\n                return fs.rmdirSync(np);\r\n            } else {\r\n                return fs.unlinkSync(np);\r\n            }\r\n        },\r\n        // mv: is Difficult, should check dst.fs==src.fs\r\n        //     and both have not subFileSystems\r\n        exists: function (path, options) {\r\n            options=options||{};\r\n            var np=this.toNativePath(path);\r\n            return fs.existsSync(np);\r\n        },\r\n        isDir: function (path) {\r\n            if (!this.exists(path)) {\r\n                return P.isDir(path);\r\n            }\r\n            return this.stat(path).isDirectory();\r\n        },\r\n        /*link: function(path, to, options) {\r\n        }//TODO\r\n        isLink:\r\n        */\r\n        touch: function (path) {\r\n            if (!this.exists(path) && this.isDir(path)) {\r\n                this.mkdir(path);\r\n            } else if (this.exists(path) /*&& !this.isDir(path)*/ ) {\r\n                // TODO(setlastupdate)\r\n                fs.utimesSync(path,Date.now()/1000,Date.now()/1000);\r\n            }\r\n        },\r\n        getURL:function (path) {\r\n            return \"file:///\"+path.replace(/\\\\/g,\"/\");\r\n        },\r\n        onAddObserver: function (apath,options) {\r\n            var t=this;\r\n            var rfs=t.getRootFS();\r\n            options=options||{};\r\n            var isDir=this.isDir(apath);\r\n            //console.log(\"Invoke oao\",options);\r\n            var w=fs.watch(apath, options, function (evt,rpath) {\r\n                //console.log(path);\r\n                var fpath=isDir ? P.rel(apath,rpath) : apath;\r\n                var meta;\r\n                if (t.exists(fpath)) {\r\n                    meta=extend({eventType:evt},t.getMetaInfo(fpath));\r\n                } else {\r\n                    meta={eventType:evt};\r\n                }\r\n                rfs.notifyChanged(fpath,meta);\r\n            });\r\n            return {\r\n                remove: function () {\r\n                    w.close();\r\n                }\r\n            };\r\n        }\r\n    });\r\n    return NativeFS;\r\n});\r\n\r\ndefine('LSFS',[\"FSClass\",\"PathUtil\",\"extend\",\"assert\",\"Util\",\"Content\"],\r\n        function(FS,P,extend,assert,Util,Content) {\r\n    var LSFS = function(storage,options) {\r\n        assert(storage,\" new LSFS fail: no storage\");\r\n    \tthis.storage=storage;\r\n    \tthis.options=options||{};\r\n    \tif (this.options.useDirCache) this.dirCache={};\r\n    };\r\n    var isDir = P.isDir.bind(P);\r\n    var up = P.up.bind(P);\r\n    var endsWith= P.endsWith.bind(P);\r\n    //var getName = P.name.bind(P);\r\n    //var Path=P.Path;\r\n    var Absolute=P.Absolute;\r\n    var SEP= P.SEP;\r\n    function now(){\r\n        return new Date().getTime();\r\n    }\r\n    LSFS.ramDisk=function (options) {\r\n        var s={};\r\n        s[P.SEP]=\"{}\";\r\n        options=options||{};\r\n        if (!(\"useDirCache\" in options)) options.useDirCache=true;\r\n        return new LSFS(s,options);\r\n    };\r\n    FS.addFSType(\"localStorage\",function (path, options) {\r\n        return new LSFS(localStorage,options);\r\n    });\r\n    FS.addFSType(\"ram\",function (path, options) {\r\n        return LSFS.ramDisk(options);\r\n    });\r\n\r\n    LSFS.now=now;\r\n    LSFS.prototype=new FS();\r\n    //private methods\r\n    LSFS.prototype.resolveKey=function (path) {\r\n        assert.is(path,P.Absolute);\r\n        if (this.mountPoint) {\r\n            return P.SEP+P.relPath(path,this.mountPoint);//FromMountPoint(path);\r\n        } else {\r\n            return path;\r\n        }\r\n    };\r\n    LSFS.prototype.getItem=function (path) {\r\n        assert.is(path,P.Absolute);\r\n        var key=this.resolveKey(path);\r\n        return this.storage[key];\r\n    };\r\n    LSFS.prototype.setItem=function (path, value) {\r\n        assert.is(path,P.Absolute);\r\n        var key=this.resolveKey(path);\r\n        /*if (key.indexOf(\"..\")>=0) {\r\n            console.log(path,key,value);\r\n        }*/\r\n        assert(key.indexOf(\"..\")<0);\r\n        assert(P.startsWith(key,P.SEP));\r\n        this.storage[key]=value;\r\n    };\r\n    LSFS.prototype.removeItem=function (path) {\r\n        assert.is(path,P.Absolute);\r\n        var key=this.resolveKey(path);\r\n        delete this.storage[key];\r\n    };\r\n    LSFS.prototype.itemExists=function (path) {\r\n        assert.is(path,P.Absolute);\r\n        var key=this.resolveKey(path);\r\n        assert(this.storage,\"No storage\");\r\n        return key in this.storage;\r\n    };\r\n    /*LSFS.prototype.inMyFS=function (path){\r\n        return !this.mountPoint || P.startsWith(path, this.mountPoint);\r\n    };*/\r\n    LSFS.prototype.getDirInfo=function getDirInfo(path) {\r\n        assert.is(arguments,[P.AbsDir]);\r\n        if (path == null) throw new Error(\"getDir: Null path\");\r\n        if (!endsWith(path, SEP)) path += SEP;\r\n        assert(this.inMyFS(path));\r\n        if (this.dirCache && this.dirCache[path]) return this.dirCache[path];\r\n        var dinfo =  {},dinfos;\r\n        try {\r\n            dinfos = this.getItem(path);\r\n            if (dinfos) {\r\n                dinfo = JSON.parse(dinfos);\r\n            }\r\n        } catch (e) {\r\n            console.log(\"dinfo err : \" , path , dinfos);\r\n        }\r\n        if (this.dirCache) this.dirCache[path]=dinfo;\r\n        return dinfo;\r\n    };\r\n    LSFS.prototype.putDirInfo=function putDirInfo(path, dinfo, trashed) {\r\n  \t    assert.is(arguments,[P.AbsDir, Object]);\r\n  \t    if (!isDir(path)) throw new Error(\"Not a directory : \" + path);\r\n  \t    assert(this.inMyFS(path));\r\n  \t    if (this.dirCache) this.dirCache[path] = dinfo;\r\n  \t    this.setItem(path, JSON.stringify(dinfo));\r\n        var ppath = up(path);\r\n        if (ppath == null) return;\r\n        if (!this.inMyFS(ppath)) {\r\n            //assert(this.getRootFS()!==this);\r\n            //this.getRootFS().resolveFS(ppath).touch(ppath);\r\n            return;\r\n        }\r\n        var pdinfo = this.getDirInfo(ppath);\r\n        this._touch(pdinfo, ppath, P.name(path), trashed);\r\n    };\r\n    LSFS.prototype._touch=function _touch(dinfo, path, name, trashed) {\r\n        // path:path of dinfo\r\n        // trashed: this touch is caused by trashing the file/dir.\r\n        assert.is(arguments,[Object, String, String]);\r\n        assert(this.inMyFS(path));\r\n        var eventType=\"change\";\r\n        if (!dinfo[name]) {\r\n            eventType=\"create\";\r\n            dinfo[name] = {};\r\n            if (trashed) dinfo[name].trashed = true;\r\n        }\r\n        if (!trashed) delete dinfo[name].trashed;\r\n        dinfo[name].lastUpdate = now();\r\n        var meta=extend({eventType:eventType},dinfo[name]);\r\n        this.getRootFS().notifyChanged(P.rel(path,name), meta);\r\n        this.putDirInfo(path, dinfo, trashed);\r\n    };\r\n    LSFS.prototype.removeEntry=function removeEntry(dinfo, path, name) { // path:path of dinfo\r\n        assert.is(arguments,[Object, String, String]);\r\n        if (dinfo[name]) {\r\n            dinfo[name] = {\r\n                lastUpdate: now(),\r\n                trashed: true\r\n            };\r\n            this.getRootFS().notifyChanged(P.rel(path,name), {eventType:\"trash\"});\r\n            this.putDirInfo(path, dinfo, true);\r\n        }\r\n    };\r\n    LSFS.prototype.removeEntryWithoutTrash=function (dinfo, path, name) { // path:path of dinfo\r\n        assert.is(arguments,[Object, String, String]);\r\n        if (dinfo[name]) {\r\n            delete dinfo[name];\r\n            this.getRootFS().notifyChanged(P.rel(path,name), {eventType:\"delete\"});\r\n            this.putDirInfo(path, dinfo, true);\r\n        }\r\n    };\r\n    LSFS.prototype.isRAM=function (){\r\n        return this.storage!==localStorage;\r\n    };\r\n    LSFS.prototype.fstype=function () {\r\n        return (this.isRAM() ? \"ramDisk\" : \"localStorage\" );\r\n    };\r\n    LSFS.getUsage=function () {\r\n        var using=0;\r\n        for (var i in localStorage) {\r\n            if (typeof localStorage[i]==\"string\"){\r\n                using+=localStorage[i].length;\r\n            }\r\n        }\r\n        return using;\r\n    };\r\n    LSFS.getCapacity=function () {\r\n        var seq=0;\r\n        var str=\"a\";\r\n        var KEY=\"___checkls___\";\r\n        var using=0;\r\n        var lim=Math.pow(2,25);//32MB?\r\n        try {\r\n            // make 1KB str\r\n            for (var i=0; i<10 ;i++) {\r\n                str+=str;\r\n            }\r\n            for (var i in localStorage) {\r\n                if (i.substring(0,KEY.length)==KEY) delete localStorage[i];\r\n                else if (typeof localStorage[i]==\"string\"){\r\n                    using+=localStorage[i].length;\r\n                }\r\n            }\r\n            var ru=using;\r\n            while (add()) {\r\n                if (str.length<lim) {\r\n                    str+=str;\r\n                } else break;\r\n            }\r\n            while(str.length>1024) {\r\n                str=str.substring(str.length/2);\r\n                add();\r\n            }\r\n            return {using:ru, max:using};\r\n        } finally {\r\n            for (var i=0; i<seq; i++) {\r\n                 delete localStorage[KEY+i];\r\n            }\r\n        }\r\n        function add() {\r\n            try {\r\n                localStorage[KEY+seq]=str;\r\n                seq++;\r\n                using+=str.length;\r\n                //console.log(\"Added \"+str.length, str.length, using);\r\n                return true;\r\n            } catch(e) {\r\n                delete localStorage[KEY+seq];\r\n                //console.log(\"Add Fail \"+str.length);\r\n                return false;\r\n            }\r\n        }\r\n    };\r\n\r\n    // public methods (with resolve fs)\r\n    FS.delegateMethods(LSFS.prototype, {\r\n        isReadOnly: function () {return this.options.readOnly;},\r\n        getReturnTypes: function(path, options) {\r\n            assert.is(arguments,[String]);\r\n            return {\r\n                getContent: String, opendir:[String]\r\n            };\r\n        },\r\n        getContent: function(path, options) {\r\n            assert.is(arguments,[Absolute]);\r\n            this.assertExist(path); // Do not use this??( because it does not follow symlinks)\r\n            var c;\r\n            var cs=this.getItem(path);\r\n            if (Content.looksLikeDataURL(cs)) {\r\n                c=Content.url(cs);\r\n            } else {\r\n                c=Content.plainText(cs);\r\n            }\r\n            return c;\r\n        },\r\n        setContent: function(path, content, options) {\r\n            assert.is(arguments,[Absolute,Content]);\r\n            this.assertWriteable(path);\r\n            var t=null;\r\n            if (content.hasPlainText()) {\r\n                t=content.toPlainText();\r\n                if (Content.looksLikeDataURL(t)) t=null;\r\n            }\r\n            if (t!=null) {\r\n                this.setItem(path, t);\r\n            } else {\r\n                this.setItem(path, content.toURL());\r\n            }\r\n            this.touch(path);\r\n        },\r\n        getMetaInfo: function(path, options) {\r\n            this.assertExist(path, {includeTrashed:true});\r\n            assert.is(arguments,[Absolute]);\r\n            if (path==P.SEP) {\r\n                return {};\r\n            }\r\n            var parent=assert(P.up(path));\r\n            if (!this.inMyFS(parent)) {\r\n                return {};\r\n            }\r\n            var name=P.name(path);\r\n            assert.is(parent,P.AbsDir);\r\n            var pinfo=this.getDirInfo(parent);\r\n            return assert(pinfo[name]);\r\n        },\r\n        setMetaInfo: function(path, info, options) {\r\n            assert.is(arguments,[String,Object]);\r\n            this.assertWriteable(path);\r\n            var parent=assert(P.up(path));\r\n            if (!this.inMyFS(parent)) {\r\n                return;\r\n            }\r\n            var pinfo=this.getDirInfo(parent);\r\n            var name=P.name(path);\r\n            pinfo[name]=info;\r\n            this.putDirInfo(parent, pinfo, pinfo[name].trashed);\r\n        },\r\n        mkdir: function(path, options) {\r\n            assert.is(arguments,[Absolute]);\r\n            this.assertWriteable(path);\r\n\t\t\tthis.touch(path);\r\n        },\r\n        opendir: function(path, options) {\r\n            assert.is(arguments,[String]);\r\n            //succ: iterator<string> // next()\r\n            // options: {includeTrashed:Boolean}\r\n            options=options||{};\r\n            var inf=this.getDirInfo(path);\r\n            var res=[]; //this.dirFromFstab(path);\r\n            for (var i in inf) {\r\n                assert(inf[i]);\r\n                if (!inf[i].trashed || options.includeTrashed) res.push(i);\r\n            }\r\n            return assert.is(res,Array);\r\n        },\r\n        rm: function(path, options) {\r\n            assert.is(arguments,[Absolute]);\r\n            options=options||{};\r\n            this.assertWriteable(path);\r\n            var parent=P.up(path);\r\n            if (parent==null || !this.inMyFS(parent)) {\r\n                throw new Error(path+\": cannot remove. It is root of this FS.\");\r\n            }\r\n            this.assertExist(path,{includeTrashed:options.noTrash });\r\n            if (P.isDir(path)) {\r\n                var lis=this.opendir(path);\r\n                if (lis.length>0) {\r\n                    this.err(path,\"Directory not empty\");\r\n                }\r\n                if (options.noTrash) {\r\n                    this.removeItem(path);\r\n                }\r\n            } else {\r\n                this.removeItem(path);\r\n            }\r\n            var pinfo=this.getDirInfo(parent);\r\n            if (options.noTrash) {\r\n                this.removeEntryWithoutTrash(pinfo, parent, P.name(path) );\r\n            } else {\r\n                this.removeEntry(pinfo, parent, P.name(path) );\r\n            }\r\n        },\r\n        exists: function (path,options) {\r\n            assert.is(arguments,[Absolute]);\r\n            options=options||{};\r\n            var name=P.name(path);\r\n            var parent=P.up(path);\r\n            if (parent==null || !this.inMyFS(parent)) return true;\r\n            var pinfo=this.getDirInfo(parent);\r\n            var res=pinfo[name];\r\n            if (res && res.trashed && this.itemExists(path)) {\r\n                if (this.isDir(path)) {\r\n\r\n                } else {\r\n                    //assert.fail(\"Inconsistent \"+path+\": trashed, but remains in storage\");\r\n                }\r\n            }\r\n            if (!res && this.itemExists(path)) {\r\n                //assert.fail(\"Inconsistent \"+path+\": not exists in metadata, but remains in storage\");\r\n            }\r\n            if (res && !res.trashed && !res.link && !this.itemExists(path)) {\r\n                //assert.fail(\"Inconsistent \"+path+\": exists in metadata, but not in storage\");\r\n            }\r\n            if (res && !options.includeTrashed) {\r\n                res=!res.trashed;\r\n            }\r\n            return !!res;\r\n        },\r\n        link: function(path, to, options) {\r\n            assert.is(arguments,[P.Absolute,P.Absolute]);\r\n            this.assertWriteable(path);\r\n            if (this.exists(path)) this.err(path,\"file exists\");\r\n            if (P.isDir(path) && !P.isDir(to)) {\r\n                this.err(path,\" can not link to file \"+to);\r\n            }\r\n            if (!P.isDir(path) && P.isDir(to)) {\r\n                this.err(path,\" can not link to directory \"+to);\r\n            }\r\n            var m={};//assert(this.getMetaInfo(path));\r\n            m.link=to;\r\n            m.lastUpdate=now();\r\n            this.setMetaInfo(path, m);\r\n            //console.log(this.getMetaInfo(path));\r\n            //console.log(this.storage);\r\n            //console.log(this.getMetaInfo(P.up(path)));\r\n            assert(this.exists(path));\r\n            assert(this.isLink(path));\r\n        },\r\n        isLink: function (path) {\r\n            assert.is(arguments,[P.Absolute]);\r\n            if (!this.exists(path)) return null;\r\n            var m=assert(this.getMetaInfo(path));\r\n            return m.link;\r\n        },\r\n        touch: function (path) {\r\n            assert.is(arguments,[Absolute]);\r\n            this.assertWriteable(path);\r\n            if (!this.itemExists(path)) {\r\n                if (P.isDir(path)) {\r\n                    if (this.dirCache) this.dirCache[path]={};\r\n                    this.setItem(path,\"{}\");\r\n                } else {\r\n                    this.setItem(path,\"\");\r\n                }\r\n            }\r\n            var parent=up(path);\r\n            if (parent!=null) {\r\n                if (this.inMyFS(parent)) {\r\n                    var pinfo=this.getDirInfo(parent);\r\n                    this._touch(pinfo, parent , P.name(path), false);\r\n                } else {\r\n                    assert(this.getRootFS()!==this);\r\n                    this.getRootFS().resolveFS(parent).touch(parent);\r\n                }\r\n            }\r\n        },\r\n        getURL: function (path) {\r\n            return this.getContent(path).toURL();\r\n        },\r\n        opendirEx: function (path,options) {\r\n            assert.is(path,P.AbsDir);\r\n            options=options||{};\r\n            var res={};\r\n            var d=this.getDirInfo(path);\r\n            if (options.includeTrashed) {\r\n                //console.log(\"INCLTR\",d);\r\n                return d;\r\n            }\r\n            for (var k in d) {\r\n                if (d[k].trashed) continue;\r\n                res[k]=d[k];\r\n            }\r\n            return res;\r\n        }\r\n    });\r\n    return LSFS;\r\n\r\n});\r\n\r\n/**\r\n *\r\n * jquery.binarytransport.js\r\n *\r\n * @description. jQuery ajax transport for making binary data type requests.\r\n * @version 1.0\r\n * @author Henry Algus <henryalgus@gmail.com>\r\n *\r\n */\r\n\r\n// use this transport for \"binary\" data type\r\nif (typeof $!==\"undefined\")\r\n$.ajaxTransport(\"+binary\", function(options, originalOptions, jqXHR){\r\n    // check for conditions and support for blob / arraybuffer response type\r\n    if (window.FormData && ((options.dataType && (options.dataType == 'binary')) || (options.data && ((window.ArrayBuffer && options.data instanceof ArrayBuffer) || (window.Blob && options.data instanceof Blob)))))\r\n    {\r\n        return {\r\n            // create new XMLHttpRequest\r\n            send: function(headers, callback){\r\n                // setup all variables\r\n                var xhr = new XMLHttpRequest(),\r\n                url = options.url,\r\n                type = options.type,\r\n                async = options.async || true,\r\n                // blob or arraybuffer. Default is blob\r\n                dataType = options.responseType || \"blob\",\r\n                data = options.data || null,\r\n                username = options.username || null,\r\n                password = options.password || null;\r\n\r\n                xhr.addEventListener('load', function(){\r\n                    var data = {};\r\n                    data[options.dataType] = xhr.response;\r\n                    // make callback and send data\r\n                    callback(xhr.status, xhr.statusText, data, xhr.getAllResponseHeaders());\r\n                });\r\n\r\n                xhr.open(type, url, async, username, password);\r\n\r\n                // setup custom headers\r\n                for (var i in headers ) {\r\n                    xhr.setRequestHeader(i, headers[i] );\r\n                }\r\n\r\n                xhr.responseType = dataType;\r\n                xhr.send(data);\r\n            },\r\n            abort: function(){\r\n                jqXHR.abort();\r\n            }\r\n        };\r\n    }\r\n});\r\n\r\ndefine(\"jquery.binarytransport\", function(){});\r\n\r\ndefine('WebFS',[\"FSClass\",\"jquery.binarytransport\",\"DeferredUtil\",\"Content\",\"PathUtil\"],\r\n        function (FS,j,DU,Content,P) {\r\n    // FS.mount(location.protocol+\"//\"+location.host+\"/\", \"web\");\r\n    var WebFS=function (){};\r\n    var p=WebFS.prototype=new FS;\r\n    FS.addFSType(\"web\", function () {\r\n        return new WebFS;\r\n    });\r\n    p.fstype=function () {return \"Web\";};\r\n    p.supportsSync=function () {return false;};\r\n    p.inMyFS=function (path) {\r\n        return P.isURL(path);\r\n    };\r\n    FS.delegateMethods(p, {\r\n        exists: function () {return true;},\r\n        getContentAsync: function (path){\r\n            var t=this;\r\n            return DU.promise(function (succ,err) {\r\n                $.get(path,function (blob) {\r\n                    var reader = new FileReader();\r\n                    reader.addEventListener(\"loadend\", function() {\r\n                        succ(Content.bin(reader.result, t.getContentType(path)));\r\n                    });\r\n                    reader.readAsArrayBuffer(blob);\r\n                },\"binary\").fail(err);\r\n            });\r\n        },\r\n        /*setContentAsync: function (path){\r\n\r\n        },*/\r\n        getURL: function (path) {\r\n            return path;\r\n        }\r\n    });\r\n\r\n    return WebFS;\r\n\r\n});\r\ndefine('Env',[\"assert\",\"PathUtil\"],function (A,P) {\r\n    var Env=function (value) {\r\n        this.value=value;\r\n    };\r\n    Env.prototype={\r\n            expand:function (str) {\r\n                A.is(str,String);\r\n                var t=this;\r\n                return str.replace(/\\$\\{([a-zA-Z0-9_]+)\\}/g, function (a,key) {\r\n                    return t.get(key);\r\n                });\r\n            },\r\n            expandPath:function (path) {\r\n                A.is(path,String);\r\n                path=this.expand(path);\r\n                path=path.replace(/\\/+/g,\"/\");\r\n                path=path.replace(/^[a-z][a-z]+:\\//, function (r) { return r+\"/\"; } );\r\n                return A.is(path,P.Path);\r\n            },\r\n            get: function (key) {\r\n                return this.value[key];\r\n            },\r\n            set: function (key, value) {\r\n                this.value[key]=value;\r\n            }\r\n    };\r\n    return Env;\r\n});\r\ndefine('SFile',[\"extend\",\"assert\",\"PathUtil\",\"Util\",\"Content\",\"FSClass\",\"FileSaver\",\"DeferredUtil\"],\r\nfunction (extend,A,P,Util,Content,FSClass,saveAs,DU) {\r\n\r\nvar SFile=function (rootFS, path) {\r\n    A.is(path, P.Absolute);\r\n    //A(fs && fs.getReturnTypes, fs);\r\n    this._path=path;\r\n    this.rootFS=rootFS;\r\n    this.fs=rootFS.resolveFS(path);\r\n    /*this.act={};// path/fs after follwed symlink\r\n    this.act.path=this.fs.resolveLink(path);\r\n    this.act.fs=rootFS.resolveFS(this.act.path);\r\n    A.is(this.act, {fs:FSClass, path:P.Absolute});*/\r\n    if (this.isDir() && !P.isDir(path)) {\r\n        this._path+=P.SEP;\r\n    }\r\n};\r\nSFile.is=function (path) {\r\n    return path && typeof (path.isSFile)==\"function\" && path.isSFile();\r\n};\r\nfunction getPath(f) {\r\n    if (SFile.is(f)) {\r\n        return f.path();\r\n    } else {\r\n        A.is(f,P.Absolute);\r\n        return f;\r\n    }\r\n}\r\nSFile.prototype={\r\n    isSFile: function (){return true;},\r\n    setPolicy: function (p) {\r\n        if (this.policy) throw new Error(\"policy already set\");\r\n        this.policy=p;\r\n        return this._clone();\r\n    },\r\n    getPolicy: function (p) {\r\n        return this.policy;\r\n    },\r\n    _clone: function (){\r\n        return this._resolve(this.path());\r\n    },\r\n    _resolve: function (path, options) {\r\n        var res;\r\n        options=options||{};\r\n        if (SFile.is(path)) {\r\n            res=path;\r\n        } else {\r\n            A.is(path,P.Absolute);\r\n            var topdir;\r\n            var policy=options.policy || this.policy;\r\n            if (policy && (topdir=policy.topDir)) {\r\n                if (topdir.path) topdir=topdir.path();\r\n                if (!P.startsWith(path, topdir)) {\r\n                    throw new Error(path+\": cannot access. Restricted to \"+topdir);\r\n                }\r\n            }\r\n            res=new SFile(this.rootFS, path);\r\n            res.policy=policy;\r\n        }\r\n        if (res.policy) {\r\n            return Util.privatize(res);\r\n        } else {\r\n            return res;\r\n        }\r\n    },\r\n    contains: function (file) {\r\n        A(SFile.is(file),file+\" shoud be a SFile object.\");\r\n        if (!this.isDir()) return false;\r\n        return P.startsWith( file.path(), this.path());\r\n    },\r\n    path: function () {\r\n        return this._path;\r\n    },\r\n    name: function () {\r\n        return P.name(this.path());\r\n    },\r\n    truncExt: function (ext) {\r\n        return P.truncExt(this.path(),ext);\r\n    },\r\n    ext: function () {\r\n        return P.ext(this.path());\r\n    },\r\n    relPath: function (base) {\r\n        // base should be SFile or Path from rootFS\r\n        var bp=(base.path ?\r\n                base.path() :\r\n                base );\r\n        return P.relPath(this.path(), A.is(bp,P.Absolute) );\r\n    },\r\n    up: function () {\r\n        var pathR=this.path();\r\n        var pa=P.up(pathR);\r\n        if (pa==null) return null;\r\n        return this._resolve(pa);\r\n    },\r\n    rel: function (relPath) {\r\n        A.is(relPath, P.Relative);\r\n        this.assertDir();\r\n        var pathR=this.path();\r\n        return this._resolve(P.rel(pathR, relPath));\r\n    },\r\n    sibling: function (n) {\r\n        return this.up().rel(n);\r\n    },\r\n    startsWith: function (pre) {\r\n        return P.startsWith(this.name(),pre);\r\n    },\r\n    endsWith: function (post) {\r\n        return P.endsWith(this.name(),post);\r\n    },\r\n    equals:function (o) {\r\n        return (o && typeof o.path==\"function\" && o.path()==this.path());\r\n    },\r\n    toString:function (){\r\n        return this.path();\r\n    },\r\n    //Common\r\n    touch: function () {\r\n        return this.act.fs.touch(this.act.path);\r\n    },\r\n    isReadOnly: function () {\r\n        return this.act.fs.isReadOnly(this.act.path);\r\n    },\r\n    isTrashed:function () {\r\n        var m=this.metaInfo();\r\n        if (!m) return false;\r\n        return m.trashed;\r\n    },\r\n    metaInfo: function () {\r\n        if (arguments.length==0) {\r\n            return this.getMetaInfo.apply(this,arguments);\r\n        } else {\r\n            return this.setMetaInfo.apply(this,arguments);\r\n        }\r\n    },\r\n    getMetaInfo: function (options) {\r\n        return this.act.fs.getMetaInfo(this.act.path,options);\r\n    },\r\n    setMetaInfo: function (info, options) {\r\n        return this.act.fs.setMetaInfo(this.act.path,info, options);\r\n    },\r\n    getDirTree: function (options) {\r\n        return this.act.fs.getDirTree(this.act.path, options);\r\n    },\r\n    assertExists: function () {\r\n        A(this.exists(),this.path()+\" does not exist.\");\r\n    },\r\n    lastUpdate:function () {\r\n        this.assertExists();\r\n        return this.metaInfo().lastUpdate;\r\n    },\r\n    exists: function (options) {\r\n        var args=Array.prototype.slice.call(arguments);\r\n        if (typeof args[0]===\"function\") {\r\n            var f=args.shift();\r\n            return DU.resolve(this.exists.apply(this,args)).then(f);\r\n        }\r\n        options=options||{};\r\n        var p=this.fs.exists(this.path(),options);\r\n        if (p || options.noFollowLink) {\r\n            return p;\r\n        } else {\r\n            return this.act.fs.exists(this.act.path,{noFollowLink:true});\r\n        }\r\n    },\r\n    rm: function (options) {\r\n        //   ln /test/c /a/b/\r\n        //   rm a/b/c/\r\n        //   rm a/b/c/d\r\n        var t=this;\r\n        options=options||{};\r\n        if (this.isLink()) {\r\n            return DU.resolve(this.fs.rm(this.path(),options));\r\n        }\r\n        /*if (!this.exists({noFollowLink:true})) {\r\n            return this.act.fs.rm(this.act.path, options);\r\n        }*/\r\n        var a;\r\n        if (this.isDir() && (options.recursive||options.r)) {\r\n            a=this.each(function (f) {\r\n                return f.rm(options);\r\n            });\r\n        } else {\r\n            a=DU.resolve();\r\n        }\r\n        return a.then(function () {\r\n            return t.act.fs.rm(t.act.path, options);\r\n        });\r\n        //var pathT=this.path();\r\n        //this.fs.rm(pathT, options);\r\n    },\r\n    removeWithoutTrash: function (options) {\r\n        options=options||{};\r\n        options.noTrash=true;\r\n        this.rm(options);\r\n    },\r\n    isDir: function () {\r\n        return this.act.fs.isDir(this.act.path);\r\n    },\r\n    // File\r\n    text:function (f) {\r\n    \tif (typeof f===\"function\") {\r\n\t\t\treturn this.getText(f);\r\n\t\t}\r\n        if (arguments.length>0) {\r\n            return this.setText(arguments[0]);\r\n        } else {\r\n            return this.getText();\r\n        }\r\n    },\r\n    setText:function (t) {\r\n        A.is(t,String);\r\n        if (this.isDir()) {\r\n            throw new Error(\"Cannot write to directory: \"+this.path());\r\n        }\r\n        var ct=this.contentType({def:null});\r\n        //if (this.isText()) {\r\n        if (ct!==null && !ct.match(/^text/) && Content.looksLikeDataURL(t)) {\r\n            // bad knowhow: if this is a binary file apparently, convert to URL\r\n            return DU.throwNowIfRejected(this.setContent(Content.url(t)));\r\n            return DU.resolve(this.act.fs.setContent(this.act.path, Content.url(t)));\r\n        } else {\r\n            // if use fs.setContentAsync, the error should be handled by .fail\r\n            // setText should throw error immediately (Why? maybe old style of text(\"foo\") did it so...)\r\n            return DU.throwNowIfRejected(this.setContent(Content.plainText(t)));\r\n            return DU.resolve(this.act.fs.setContent(this.act.path, Content.plainText(t)));\r\n        }\r\n    },\r\n    appendText:function (t) {\r\n        A.is(t,String);\r\n        //if (this.isText()) {\r\n        return this.act.fs.appendContent(this.act.path, Content.plainText(t));\r\n        /*} else {\r\n            throw new Error(\"append only for text file\");\r\n        }*/\r\n    },\r\n    getContent: function (f) {\r\n        if (typeof f==\"function\") {\r\n            return this.act.fs.getContentAsync(this.act.path).then(f);\r\n        }\r\n        return this.act.fs.getContent(this.act.path);\r\n    },\r\n    setContent: function (c) {\r\n        if (this.isDir()) {\r\n            throw new Error(\"Cannot write to directory: \"+this.path());\r\n        }\r\n        // why setContentAsync? AsyncDU.resolvesyncsync...PromiseJQ\r\n        // fs2/promise.js\r\n        return this.act.fs.setContentAsync(this.act.path,c);\r\n    },\r\n\r\n    getText:function (f) {\r\n    \tif (typeof f===\"function\") {\r\n    \t\tvar t=this;\r\n    \t    return this.getContent(forceText).then(f);\r\n    \t}\r\n        return forceText(this.act.fs.getContent(this.act.path));\r\n        /*if (this.isText()) {\r\n            return this.act.fs.getContent(this.act.path).toPlainText();\r\n        } else {\r\n            return this.act.fs.getContent(this.act.path).toURL();\r\n        }*/\r\n        function forceText(c) {\r\n\t    \t//if (t.isText()) {\r\n            try {\r\n                return c.toPlainText();\r\n            } catch(e) {\r\n    \t    \treturn c.toURL();\r\n    \t    }\r\n        }\r\n    },\r\n    getDataURL: function (f) {\r\n        if (typeof f===\"function\") {\r\n            return this.getContent(function (c) {\r\n                return c.toURL();\r\n            });\r\n        }\r\n        return this.getContent().toURL();\r\n    },\r\n    setDataURL: function (u) {\r\n        return this.setContent(Content.url(u));\r\n    },\r\n    dataURL:function (d) {\r\n        if (typeof d===\"string\") return this.setDataURL(d);\r\n        if (typeof d===\"function\") return this.getDataURL(d);\r\n        return this.getDataURL();\r\n    },\r\n    isText: function () {\r\n        return this.act.fs.isText(this.act.path);\r\n    },\r\n    contentType: function (options) {\r\n        return this.act.fs.getContentType(this.act.path,options);\r\n    },\r\n    bytes: function (b) {\r\n        if (Content.isBuffer(b)) return this.setBytes(b);\r\n        return this.getBytes();\r\n    },\r\n    setBytes:function (b) {\r\n        return this.act.fs.setContent(this.act.path, Content.bin(b,this.contentType()));\r\n    },\r\n    getBytes:function (options) {\r\n        options=options||{};\r\n        return this.act.fs.getContent(this.act.path).toBin(options.binType);\r\n    },\r\n    getURL: function () {\r\n        return this.act.fs.getURL(this.act.path);\r\n    },\r\n    lines:function (lines) {\r\n        if (lines instanceof Array) {//WRITE\r\n            return this.text(lines.join(\"\\n\"));\r\n        } else if (typeof lines===\"function\") {//READ async\r\n            return this.text(function (r) {\r\n                return lines(r.replace(/\\r/g,\"\").split(\"\\n\"));\r\n            });\r\n        }\r\n        return this.text().replace(/\\r/g,\"\").split(\"\\n\");\r\n    },\r\n    obj: function () {\r\n        var file=this;\r\n        if (arguments.length==0) {\r\n            var t=file.text();\r\n            if (!t) return null;\r\n            return JSON.parse(t);\r\n        } else {\r\n            file.text(JSON.stringify(A.is(arguments[0],Object) ));\r\n        }\r\n    },\r\n    copyFrom: function (src, options) {\r\n        return src.copyTo(this,options);\r\n    },\r\n    copyTo: function (dst, options) {\r\n        A(dst && dst.isSFile(),dst+\" is not a file\");\r\n        var src=this;\r\n        var options=options||{};\r\n        var srcIsDir=src.isDir();\r\n        var dstIsDir=dst.isDir();\r\n        if (!srcIsDir && dstIsDir) {\r\n            dst=dst.rel(src.name());\r\n            A(!dst.isDir(), dst+\" is a directory.\");\r\n            dstIsDir=false;\r\n        }\r\n        if (srcIsDir && !dstIsDir) {\r\n           this.err(\"Cannot move dir \"+src.path()+\" to file \"+dst.path());\r\n        } else if (!srcIsDir && !dstIsDir) {\r\n            if (options.echo) options.echo(src+\" -> \"+dst);\r\n            var res=this.act.fs.cp(this.act.path, dst.getResolvedLinkPath(),options);\r\n            res=DU.resolve(res);\r\n            if (options.a) {\r\n                return res.then(function () {\r\n                    return dst.setMetaInfo(src.getMetaInfo());\r\n                });\r\n            }\r\n            return res;\r\n        } else {\r\n            A(srcIsDir && dstIsDir,\"Both src and dst should be dir\");\r\n            return src.each(function (s) {\r\n                var r;\r\n                var dstf=dst.rel(s.name());\r\n                if (options.progress) {\r\n                    r=options.progress(dstf,{src:s,dst:dstf});\r\n                }\r\n                return DU.resolve(r).then(function () {\r\n                    return dstf.copyFrom(s, options);\r\n                });\r\n            });\r\n        }\r\n        //file.text(src.text());\r\n        //if (options.a) file.metaInfo(src.metaInfo());\r\n    },\r\n    moveFrom: function (src, options) {\r\n        var t=this;\r\n        return t.exists(function (ex) {\r\n            return t.copyFrom(src,options).then(function () {\r\n                return src.rm({recursive:true});\r\n            },function (e) {\r\n                // rollback\r\n                if (!ex) return t.exists(function (ex) {\r\n                    if (ex) return t.rm({recursive:true});\r\n                }).then(function () {throw e;});\r\n                throw e;\r\n            });\r\n        });\r\n    },\r\n    moveTo: function (dst, options) {\r\n        return dst.moveFrom(this,options);\r\n    },\r\n    // Dir\r\n    assertDir:function () {\r\n        A.is(this.path(),P.Dir);\r\n        return this;\r\n    },\r\n    /*files:function (f,options) {\r\n        var dir=this.assertDir();\r\n        var res=[];\r\n        this.each(function (f) {\r\n            res.add(f);\r\n        },options);\r\n        return res;\r\n    },*/\r\n    each:function (f,options) {\r\n        var dir=this.assertDir();\r\n        return dir.listFilesAsync(options).then(function (ls) {\r\n            return DU.each(ls,f);// ls.forEach(f)\r\n        });\r\n    },\r\n    eachrev:function (f,options) {\r\n        var dir=this.assertDir();\r\n        return dir.listFilesAsync(options).then(function (ls) {\r\n            return DU.each(ls.reverse(),f);// ls.forEach(f)\r\n        });\r\n    },\r\n    recursive:function (fun,options) {\r\n        var dir=this.assertDir();\r\n        options=dir.convertOptions(options);\r\n        return dir.each(function (f) {\r\n            if (f.isDir()) return f.recursive(fun,options);\r\n            else return fun(f);\r\n        },options);\r\n    },\r\n    _listFiles:function (options,async) {\r\n        A(options==null || typeof options==\"object\");\r\n        var dir=this.assertDir();\r\n        var path=this.path();\r\n        var ord;\r\n        options=dir.convertOptions(options);\r\n        if (!ord) ord=options.order;\r\n        if (async) {\r\n            return this.act.fs.opendirAsync(this.act.path, options).\r\n            then(cvt);\r\n        } else {\r\n            return cvt( this.act.fs.opendir(this.act.path, options));\r\n        }\r\n        function cvt(di) {\r\n            var res=[];\r\n            for (var i=0;i<di.length; i++) {\r\n                var name=di[i];\r\n                //if (!options.includeTrashed && dinfo[i].trashed) continue;\r\n                var f=dir.rel(name);\r\n                if (options.excludesF(f) ) continue;\r\n                res.push(f);\r\n            }\r\n            if (typeof ord==\"function\" && res.sort) res.sort(ord);\r\n            return res;\r\n        }\r\n    },\r\n    listFilesAsync:function (options) {\r\n        return this._listFiles(options,true);\r\n        /*\r\n        A(options==null || typeof options==\"object\");\r\n        var dir=this.assertDir();\r\n        var path=this.path();\r\n        var ord;\r\n        options=dir.convertOptions(options);\r\n        if (!ord) ord=options.order;\r\n        return this.act.fs.opendirAsync(this.act.path, options).\r\n        then(function (di) {\r\n            var res=[];\r\n            for (var i=0;i<di.length; i++) {\r\n                var name=di[i];\r\n                //if (!options.includeTrashed && dinfo[i].trashed) continue;\r\n                var f=dir.rel(name);\r\n                if (options.excludesF(f) ) continue;\r\n                res.push(f);\r\n            }\r\n            if (typeof ord==\"function\" && res.sort) res.sort(ord);\r\n            return res;\r\n        });*/\r\n    },\r\n    listFiles:function (options) {\r\n        return this._listFiles(options,false);\r\n        /*var args=Array.prototype.slice.call(arguments);\r\n        return DU.assertResolved(this.listFilesAsync.apply(this,args));*/\r\n    },\r\n    ls:function (options) {\r\n        A(options==null || typeof options==\"object\");\r\n        var dir=this.assertDir();\r\n        if (!options) {\r\n            return this.act.fs.opendir(this.act.path, options);\r\n        }\r\n        var res=dir.listFiles(options);\r\n        return res.map(function (f) {\r\n            return f.name();\r\n        });\r\n    },\r\n    convertOptions:function(o) {\r\n        var options=Util.extend({},o);\r\n        var dir=this.assertDir();\r\n        var pathR=this.path();\r\n        var excludes=options.excludes || {};\r\n        if (typeof excludes===\"function\") {\r\n            options.excludesF=excludes;\r\n        } else if (typeof excludes===\"object\") {\r\n            if (excludes instanceof Array) {\r\n                var nex={};\r\n                excludes.forEach(function (e) {\r\n                    if (P.startsWith(e,\"/\")) {\r\n                        nex[e]=1;\r\n                    } else {\r\n                        nex[pathR+e]=1;\r\n                    }\r\n                });\r\n                excludes=nex;\r\n            }\r\n            options.excludesF=function (f) {\r\n                return excludes[f.path()];\r\n            };\r\n        }\r\n        return A.is(options,{excludesF:Function});\r\n    },\r\n    mkdir: function () {\r\n        return this.touch();\r\n    },\r\n    link: function (to,options) {// % ln to path\r\n        if (this.exists()) throw new Error(this.path()+\": exists.\");\r\n        return this.act.fs.link(this.act.path,to.path(),options);\r\n    },\r\n    resolveLink:function () {\r\n        return this._resolve(this.act.path);\r\n    },\r\n    isLink: function () {\r\n        return this.fs.isLink(this.path());\r\n    },\r\n    getResolvedLinkPath: function () {\r\n        return this.act.path;\r\n    },\r\n    getFS:function () {\r\n        return this.act.fs;\r\n    },\r\n    observe: function (h) {\r\n        return this.getFS().getRootFS().addObserver(this.path(),h);\r\n    },\r\n    getBlob: function () {\r\n        return new Blob([this.bytes()],{type:this.contentType()});\r\n    },\r\n    setBlob: function (blob) {\r\n        var t=this;\r\n        return DU.promise(function (succ,err) {\r\n            var reader = new FileReader();\r\n            reader.addEventListener(\"loadend\", function() {\r\n                // reader.result contains the contents of blob as a typed array\r\n                DU.resolve(t.setBytes(reader.result)).then(succ);\r\n            });\r\n            reader.readAsArrayBuffer(blob);\r\n        });\r\n    },\r\n    size: function (f) {\r\n        if (!f) {\r\n            if (!this.isDir()) {\r\n                return this.act.fs.size(this.act.path);\r\n                //return this.getBytes().byteLength;\r\n            } else {\r\n                var sum=0;\r\n                this.each(function (f) {\r\n                    sum+=f.size();\r\n                });\r\n                return sum;\r\n            }\r\n        } else {\r\n            //TODO: async\r\n        }\r\n    },\r\n    download: function () {\r\n        if (this.isDir()) throw new Error(this+\": Download dir is not support yet. Use 'zip' instead.\");\r\n        saveAs(this.getBlob(),this.name());;\r\n    },\r\n    err: function () {\r\n        var a=Array.prototype.slice.call(arguments);\r\n        console.log.apply(console,a);\r\n        throw new Error(a.join(\"\"));\r\n    },\r\n    exportAsObject: function (options) {\r\n        var base=this;\r\n        var data={};\r\n        this.recursive(function (f) {\r\n            data[f.relPath(base)]=f.text();\r\n        },options);\r\n        var req={base:base.path(),data:data};\r\n        return req;\r\n    },\r\n    importFromObject: function (data, options) {\r\n        if (typeof data===\"string\") data=JSON.parse(data);\r\n        var data=data.data;\r\n        for (var k in data) {\r\n            this.rel(k).text(data[k]);\r\n        }\r\n    },\r\n    watch: function (_1,_2) {\r\n        var options={},handler=function(){};\r\n        if (typeof _1===\"object\") options=_1;\r\n        if (typeof _2===\"object\") options=_2;\r\n        if (typeof _1===\"function\") handler=_1;\r\n        if (typeof _2===\"function\") handler=_2;\r\n        var rfs=this.getFS().getRootFS();\r\n        //var t=this;\r\n        rfs.addObserver(this.path(),function (path, meta) {\r\n            handler(meta.eventType, rfs.get(path),meta );\r\n        });\r\n    }\r\n};\r\nObject.defineProperty(SFile.prototype,\"act\",{\r\n    get: function () {\r\n        if (this._act) return this._act;\r\n        this._act={};// path/fs after follwed symlink\r\n        this._act.path=this.fs.resolveLink(this._path);\r\n        this._act.fs=this.rootFS.resolveFS(this._act.path);\r\n        A.is(this._act, {fs:FSClass, path:P.Absolute});\r\n        return this._act;\r\n    }\r\n});\r\n\r\nreturn SFile;\r\n});\r\n\r\ndefine('RootFS',[\"assert\",\"FSClass\",\"PathUtil\",\"SFile\"], function (assert,FS,P,SFile) {\r\n    var RootFS=function (defaultFS){\r\n        assert.is(defaultFS,FS);\r\n        this.mount(null, defaultFS);\r\n    };\r\n    var dst=RootFS.prototype;\r\n    var p={\r\n            err: function (path, mesg) {\r\n                throw new Error(path+\": \"+mesg);\r\n            },\r\n            // mounting\r\n            fstab: function () {\r\n                return this._fstab=this._fstab||[];//[{fs:this, path:P.SEP}];\r\n            },\r\n            unmount: function (path, options) {\r\n                assert.is(arguments,[P.AbsDir] );\r\n                var t=this.fstab();\r\n                console.log(t);\r\n                for (var i=0; i<t.length; i++) {\r\n                    if (t[i].mountPoint==path) {\r\n                        t.splice(i,1);\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            },\r\n            availFSTypes:function (){\r\n                return FS.availFSTypes();\r\n            },\r\n            mount: function (path, fs, options) {\r\n                if (typeof fs==\"string\") {\r\n                    var fact=assert( FS.availFSTypes()[fs] ,\"fstype \"+fs+\" is undefined.\");\r\n                    fs=fact(path, options||{});\r\n                }\r\n                assert.is(fs,FS);\r\n                fs.mounted(this, path);\r\n                this.fstab().unshift(fs);\r\n            },\r\n            resolveFS:function (path, options) {\r\n                assert.is(path,P.Absolute);\r\n                var res;\r\n                this.fstab().forEach(function (fs) {\r\n                    if (res) return;\r\n                    if (fs.inMyFS(path)) {\r\n                        res=fs;\r\n                    }\r\n                });\r\n                if (!res) this.err(path,\"Cannot resolve\");\r\n                return assert.is(res,FS);\r\n            },\r\n            get: function (path) {\r\n                assert.is(path,P.Absolute);\r\n                return new SFile(this.resolveFS(path), path);\r\n            },\r\n            addObserver: function (_1,_2,_3) {\r\n                this.observers=this.observers||[];\r\n                var options={},path,f;\r\n                if (typeof _1===\"string\") path=_1;\r\n                if (typeof _2===\"string\") path=_2;\r\n                if (typeof _3===\"string\") path=_3;\r\n                if (typeof _1===\"object\") options=_1;\r\n                if (typeof _2===\"object\") options=_2;\r\n                if (typeof _3===\"object\") options=_3;\r\n                if (typeof _1===\"function\") f=_1;\r\n                if (typeof _2===\"function\") f=_2;\r\n                if (typeof _3===\"function\") f=_3;\r\n                assert.is(path,String);\r\n                assert.is(f,Function);\r\n                var fs=this.resolveFS(path);\r\n                var remover=fs.onAddObserver(path,options);\r\n                var observers=this.observers;\r\n                var observer={\r\n                    path:path,\r\n                    handler:f,\r\n                    remove: function () {\r\n                        var i=observers.indexOf(this);\r\n                        observers.splice(i,1);\r\n                        if (remover) remover.remove();\r\n                    }\r\n                };\r\n                this.observers.push(observer);\r\n                return observer;\r\n            },\r\n            notifyChanged: function (path,metaInfo) {\r\n                if (!this.observers) return;\r\n                this.observers.forEach(function (ob) {\r\n                    if (P.isChildOf(path,ob.path)) {\r\n                        ob.handler(path,metaInfo);\r\n                    }\r\n                });\r\n            },\r\n            getRootFS:function () {\r\n                return this;\r\n            }\r\n    };\r\n    for (var i in p) {\r\n        dst[i]=p[i];\r\n    }\r\n    return RootFS;\r\n});\r\n\r\ndefine('zip',[\"SFile\",/*\"jszip\",*/\"FileSaver\",\"Util\",\"DeferredUtil\"],\r\nfunction (SFile,/*JSZip,*/fsv,Util,DU) {\r\n    var zip={};\r\n    zip.setJSZip=function (JSZip) {\r\n        zip.JSZip=JSZip;\r\n        if (!DU.external.Promise) {\r\n            DU.external.Promise=JSZip.external.Promise;\r\n        }\r\n    };\r\n    if (typeof JSZip!==\"undefined\") zip.setJSZip(JSZip);\r\n    zip.zip=function (dir,dstZip,options) {\r\n        if (!SFile.is(dstZip)) options=dstZip;\r\n        options=options||{};\r\n        var jszip = new zip.JSZip();\r\n        function loop(dst, dir) {\r\n            return dir.each(function (f) {\r\n                var r=DU.resolve();\r\n                if (options.progress) {\r\n                    r=options.progress(f);\r\n                }\r\n                return r.then(function () {\r\n                    if (f.isDir()) {\r\n                        var sf=dst.folder(f.name().replace(/[\\/\\\\]$/,\"\"));\r\n                        return loop(sf, f);\r\n                    } else {\r\n                        return f.getContent(function (c) {\r\n                            dst.file(f.name(),c.toArrayBuffer());\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        return loop(jszip, dir).then(function () {\r\n            return DU.resolve(jszip.generateAsync({\r\n                type:\"arraybuffer\",\r\n                compression:\"DEFLATE\"\r\n            }));\r\n        }).then(function (content) {\r\n            //console.log(\"zip.con\",content);\r\n            if (SFile.is(dstZip)) {\r\n                return dstZip.setBytes(content);\r\n            } else {\r\n                saveAs(\r\n                    new Blob([content],{type:\"application/zip\"}),\r\n                    dir.name().replace(/[\\/\\\\]$/,\"\")+\".zip\"\r\n                );\r\n            }\r\n        });\r\n    };\r\n    zip.unzip=function (arrayBuf,destDir,options) {\r\n        var c;\r\n        var status={};\r\n        options=options||{};\r\n        if (SFile.is(arrayBuf)) {\r\n        \tc=arrayBuf.getContent();\r\n        \tarrayBuf=c.toArrayBuffer();\r\n        }\r\n        if (!options.onCheckFile) {\r\n            options.onCheckFile=function (f) {\r\n                if (options.overwrite) {\r\n                    return f;\r\n                } else {\r\n                    if (f.exists()) {\r\n                        return false;\r\n                    }\r\n                    return f;\r\n                }\r\n            };\r\n        }\r\n        var jszip=new zip.JSZip();\r\n        return DU.resolve(jszip.loadAsync(arrayBuf)).then(function () {\r\n            return DU.each(jszip.files,function (key,zipEntry) {\r\n                //var zipEntry=jszip.files[i];\r\n                var buf,dest;\r\n                return DU.resolve(zipEntry.async(\"arraybuffer\")).then(function (_buf) {\r\n                    buf=_buf;\r\n                    dest=destDir.rel(zipEntry.name);\r\n                    if (options.progress) {\r\n                        return DU.resolve(options.progress(dest));\r\n                    }\r\n                }).then(function () {\r\n                    console.log(\"Inflating\",zipEntry.name);\r\n                    if (dest.isDir()) return;\r\n                    var s={\r\n                        file:dest,\r\n                        status:\"uploaded\"\r\n                    };\r\n                    status[dest.path()]=s;\r\n                    var c=FS.Content.bin( buf, dest.contentType() );\r\n                    var res=options.onCheckFile(dest,c);\r\n                    if (res===false) {\r\n                        s.status=\"cancelled\";\r\n                        dest=null;\r\n                    }\r\n                    if (SFile.is(res)) {\r\n                        if (dest.path()!==res.path()) s.redirectedTo=res;\r\n                        dest=res;\r\n                    }\r\n                    if (dest) return dest.setContent(c);\r\n                });\r\n            });\r\n        }).then(function () {\r\n            console.log(\"unzip done\",status);\r\n            return status;\r\n        });\r\n    };\r\n    return zip;\r\n});\r\n\r\n/*(function (global, factory) {\r\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory() :\r\n\ttypeof define === 'function' && define.amd ? define(factory) :\r\n\t(factory());\r\n}(this, (function () { 'use strict';*/\r\n// modified from https://github.com/taylorhakes/promise-polyfill/blob/master/dist/polyfill.js\r\n// if promise resolved immediately, it will run f of then(f)\r\n// P.resolve(5).then(e=>console.log(e)); console.log(3)  ->  show 5 3, while original is 3 5\r\ndefine('promise',[], function() {\r\n\r\n/**\r\n * @this {Promise}\r\n */\r\nfunction finallyConstructor(callback) {\r\n  var constructor = this.constructor;\r\n  return this.then(\r\n    function(value) {\r\n      // @ts-ignore\r\n      return constructor.resolve(callback()).then(function() {\r\n        return value;\r\n      });\r\n    },\r\n    function(reason) {\r\n      // @ts-ignore\r\n      return constructor.resolve(callback()).then(function() {\r\n        // @ts-ignore\r\n        return constructor.reject(reason);\r\n      });\r\n    }\r\n  );\r\n}\r\n\r\n// Store setTimeout reference so promise-polyfill will be unaffected by\r\n// other code modifying setTimeout (like sinon.useFakeTimers())\r\nvar setTimeoutFunc = setTimeout;\r\n\r\nfunction isArray(x) {\r\n  return Boolean(x && typeof x.length !== 'undefined');\r\n}\r\n\r\nfunction noop() {}\r\n\r\n// Polyfill for Function.prototype.bind\r\nfunction bind(fn, thisArg) {\r\n  return function() {\r\n    fn.apply(thisArg, arguments);\r\n  };\r\n}\r\n\r\n/**\r\n * @constructor\r\n * @param {Function} fn\r\n */\r\nfunction Promise(fn) {\r\n  if (!(this instanceof Promise))\r\n    throw new TypeError('Promises must be constructed via new');\r\n  if (typeof fn !== 'function') throw new TypeError('not a function');\r\n  /** @type {!number} */\r\n  this._state = 0;\r\n  /** @type {!boolean} */\r\n  this._handled = false;\r\n  /** @type {Promise|undefined} */\r\n  this._value = undefined;\r\n  /** @type {!Array<!Function>} */\r\n  this._deferreds = [];\r\n\r\n  doResolve(fn, this);\r\n}\r\n\r\nfunction handle(self, deferred) {\r\n  while (self._state === 3) {\r\n    self = self._value;\r\n  }\r\n  if (self._state === 0) {\r\n    self._deferreds.push(deferred);\r\n    return;\r\n  }\r\n  self._handled = true;\r\n  Promise._immediateFn(function() {\r\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\r\n    if (cb === null) {\r\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\r\n      return;\r\n    }\r\n    var ret;\r\n    try {\r\n      ret = cb(self._value);\r\n    } catch (e) {\r\n      reject(deferred.promise, e);\r\n      return;\r\n    }\r\n    resolve(deferred.promise, ret);\r\n  });\r\n}\r\n\r\nfunction resolve(self, newValue) {\r\n  try {\r\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\r\n    if (newValue === self)\r\n      throw new TypeError('A promise cannot be resolved with itself.');\r\n    if (\r\n      newValue &&\r\n      (typeof newValue === 'object' || typeof newValue === 'function')\r\n    ) {\r\n      var then = newValue.then;\r\n      if (newValue instanceof Promise) {\r\n        self._state = 3;\r\n        self._value = newValue;\r\n        finale(self);\r\n        return;\r\n      } else if (typeof then === 'function') {\r\n        doResolve(bind(then, newValue), self);\r\n        return;\r\n      }\r\n    }\r\n    self._state = 1;\r\n    self._value = newValue;\r\n    finale(self);\r\n  } catch (e) {\r\n    reject(self, e);\r\n  }\r\n}\r\n\r\nfunction reject(self, newValue) {\r\n  self._state = 2;\r\n  self._value = newValue;\r\n  finale(self);\r\n}\r\n\r\nfunction finale(self) {\r\n  if (self._state === 2 && self._deferreds.length === 0) {\r\n    Promise._immediateFn(function() {\r\n      if (!self._handled) {\r\n        Promise._unhandledRejectionFn(self._value);\r\n      }\r\n    });\r\n  }\r\n\r\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\r\n    handle(self, self._deferreds[i]);\r\n  }\r\n  self._deferreds = null;\r\n}\r\n\r\n/**\r\n * @constructor\r\n */\r\nfunction Handler(onFulfilled, onRejected, promise) {\r\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\r\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\r\n  this.promise = promise;\r\n}\r\n\r\n/**\r\n * Take a potentially misbehaving resolver function and make sure\r\n * onFulfilled and onRejected are only called once.\r\n *\r\n * Makes no guarantees about asynchrony.\r\n */\r\nfunction doResolve(fn, self) {\r\n  var done = false;\r\n  try {\r\n    fn(\r\n      function(value) {\r\n        if (done) return;\r\n        done = true;\r\n        resolve(self, value);\r\n      },\r\n      function(reason) {\r\n        if (done) return;\r\n        done = true;\r\n        reject(self, reason);\r\n      }\r\n    );\r\n  } catch (ex) {\r\n    if (done) return;\r\n    done = true;\r\n    reject(self, ex);\r\n  }\r\n}\r\n\r\nPromise.prototype['catch'] = function(onRejected) {\r\n  return this.then(null, onRejected);\r\n};\r\n\r\nPromise.prototype.then = function(onFulfilled, onRejected) {\r\n  // @ts-ignore\r\n  var prom = new this.constructor(noop);\r\n\r\n  handle(this, new Handler(onFulfilled, onRejected, prom));\r\n  return prom;\r\n};\r\n\r\nPromise.prototype['finally'] = finallyConstructor;\r\n\r\nPromise.all = function(arr) {\r\n  return new Promise(function(resolve, reject) {\r\n    if (!isArray(arr)) {\r\n      return reject(new TypeError('Promise.all accepts an array'));\r\n    }\r\n\r\n    var args = Array.prototype.slice.call(arr);\r\n    if (args.length === 0) return resolve([]);\r\n    var remaining = args.length;\r\n\r\n    function res(i, val) {\r\n      try {\r\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\r\n          var then = val.then;\r\n          if (typeof then === 'function') {\r\n            then.call(\r\n              val,\r\n              function(val) {\r\n                res(i, val);\r\n              },\r\n              reject\r\n            );\r\n            return;\r\n          }\r\n        }\r\n        args[i] = val;\r\n        if (--remaining === 0) {\r\n          resolve(args);\r\n        }\r\n      } catch (ex) {\r\n        reject(ex);\r\n      }\r\n    }\r\n\r\n    for (var i = 0; i < args.length; i++) {\r\n      res(i, args[i]);\r\n    }\r\n  });\r\n};\r\n\r\nPromise.resolve = function(value) {\r\n  if (value && typeof value === 'object' && value.constructor === Promise) {\r\n    return value;\r\n  }\r\n\r\n  return new Promise(function(resolve) {\r\n    resolve(value);\r\n  });\r\n};\r\n\r\nPromise.reject = function(value) {\r\n  return new Promise(function(resolve, reject) {\r\n    reject(value);\r\n  });\r\n};\r\n\r\nPromise.race = function(arr) {\r\n  return new Promise(function(resolve, reject) {\r\n    if (!isArray(arr)) {\r\n      return reject(new TypeError('Promise.race accepts an array'));\r\n    }\r\n\r\n    for (var i = 0, len = arr.length; i < len; i++) {\r\n      Promise.resolve(arr[i]).then(resolve, reject);\r\n    }\r\n  });\r\n};\r\n\r\n// Use polyfill for setImmediate for performance gains\r\nPromise._immediateFn = function (fn) {fn();};/*\r\n  // @ts-ignore\r\n  (typeof setImmediate === 'function' &&\r\n    function(fn) {\r\n      // @ts-ignore\r\n      setImmediate(fn);\r\n    }) ||\r\n  function(fn) {\r\n    setTimeoutFunc(fn, 0);\r\n  };\r\n*/\r\n\r\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(/*err*/) {\r\n  if (typeof console !== 'undefined' && console) {\r\n    //console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\r\n  }\r\n};\r\n/** @suppress {undefinedVars} */\r\n/*\r\nvar globalNS = (function() {\r\n  // the only reliable means to get the global object is\r\n  // `Function('return this')()`\r\n  // However, this causes CSP violations in Chrome apps.\r\n  if (typeof self !== 'undefined') {\r\n    return self;\r\n  }\r\n  if (typeof window !== 'undefined') {\r\n    return window;\r\n  }\r\n  if (typeof global !== 'undefined') {\r\n    return global;\r\n  }\r\n  throw new Error('unable to locate global object');\r\n})();\r\n\r\nif (!('Promise' in globalNS)) {\r\n  globalNS['Promise'] = Promise;\r\n} else if (!globalNS.Promise.prototype['finally']) {\r\n  globalNS.Promise.prototype['finally'] = finallyConstructor;\r\n}*/\r\nreturn Promise;\r\n});\r\n\r\ndefine('FS',[\"FSClass\",\"NativeFS\",\"LSFS\", \"WebFS\", \"PathUtil\",\"Env\",\"assert\",\"SFile\",\"RootFS\",\"Content\",\"zip\",\"DeferredUtil\",\"promise\"],\r\n        function (FSClass,NativeFS,LSFS,WebFS, P,Env,A,SFile,RootFS,Content,zip,DU,PR) {\r\n    var FS={};\r\n    FS.assert=A;\r\n    FS.Content=Content;\r\n    FS.Class=FSClass;\r\n    FS.DeferredUtil=DU;\r\n    if (!DU.config.useJQ) {\r\n        DU.external.Promise=PR;\r\n    }\r\n    FS.Env=Env;\r\n    FS.LSFS=LSFS;\r\n    FS.NativeFS=NativeFS;\r\n    FS.PathUtil=P;\r\n    FS.RootFS=RootFS;\r\n    FS.SFile=SFile;\r\n    FS.WebFS=WebFS;\r\n    FS.zip=zip;\r\n    //if (zip.JSZip) DU.external.Promise=zip.JSZip.external.Promise;\r\n    if (typeof window==\"object\") window.FS=FS;\r\n    var rootFS;\r\n    var env=new Env({});\r\n    FS.addFSType=FSClass.addFSType;\r\n    FS.availFSTypes=FSClass.availFSTypes;\r\n\r\n    FS.setEnvProvider=function (e) {\r\n        env=e;\r\n    };\r\n    FS.getEnvProvider=function () {\r\n        return env;\r\n    };\r\n    FS.setEnv=function (key, value) {\r\n        if (typeof key==\"object\") {\r\n            for (var k in key) {\r\n                env.set(k,key[k]);\r\n            }\r\n        }else {\r\n            env.set(key,value);\r\n        }\r\n    };\r\n    FS.getEnv=function (key) {\r\n        if (typeof key==\"string\") {\r\n            return env.get(key);\r\n        }else {\r\n            return env.value;\r\n        }\r\n    };\r\n    FS.init=function (fs) {\r\n        if (rootFS) return;\r\n        if (!fs) {\r\n            if (NativeFS.available) {\r\n                fs=new NativeFS();\r\n            } else if (typeof localStorage===\"object\") {\r\n                fs=new LSFS(localStorage);\r\n            } else if (typeof importScripts===\"function\") {\r\n                // Worker\r\n                /* global self*/\r\n                self.addEventListener(\"message\", function (e) {\r\n                    var data=e.data;\r\n                    if (typeof data===\"string\") {\r\n                        data=JSON.parse(data);\r\n                    }\r\n                    switch(data.type) {\r\n                    case \"upload\":\r\n                        FS.get(data.base).importFromObject(data.data);\r\n                        break;\r\n                    case \"observe\":\r\n                        rootFS.observe(data.path, function (path,meta) {\r\n                            self.postMessage(JSON.stringify({\r\n                                type: \"changed\",\r\n                                path: path,\r\n                                content: FS.get(path).text(),\r\n                                meta: meta\r\n                            }));\r\n                        });\r\n                        break;\r\n                    }\r\n                });\r\n                fs=LSFS.ramDisk();\r\n            }\r\n        }\r\n        rootFS=new RootFS(fs);\r\n    };\r\n    FS.getRootFS=function () {\r\n        FS.init();\r\n        return rootFS;\r\n    };\r\n    FS.get=function () {\r\n        FS.init();\r\n        return rootFS.get.apply(rootFS,arguments);\r\n    };\r\n    FS.expandPath=function () {\r\n        return env.expandPath.apply(env,arguments);\r\n    };\r\n    FS.resolve=function (path, base) {\r\n        FS.init();\r\n        if (SFile.is(path)) return path;\r\n        path=env.expandPath(path);\r\n        if (base && !P.isAbsolutePath(path)) {\r\n            base=env.expandPath(base);\r\n            return FS.get(base).rel(path);\r\n        }\r\n        return FS.get(path);\r\n    };\r\n    FS.mount=function () {\r\n        FS.init();\r\n        return rootFS.mount.apply(rootFS,arguments);\r\n    };\r\n    FS.unmount=function () {\r\n        FS.init();\r\n        return rootFS.unmount.apply(rootFS,arguments);\r\n    };\r\n    FS.isFile=function (f) {\r\n        return SFile.is(f);\r\n    };\r\n    return FS;\r\n});\r\n\r\n//-----------\r\n\tvar resMod;\r\n\trequirejs([\"FS\"], function (r) {\r\n\t  resMod=r;\r\n\t});\r\n\tif (typeof window!==\"undefined\" && window.FS===undefined) window.FS=resMod;\r\n\tif (typeof module!==\"undefined\") module=resMod;\r\n\treturn resMod;\r\n});\r\n//})(window);\r\n\nfunction HttpHelper(options) {\r\n    var $h={};\r\n    var lineMark=options.lineMark;\r\n    $h.buf=$(\"<div>\");\r\n    $h.bufs=[$h.buf];\r\n    $h.maxLineNo=-1;\r\n    $h.cur=function () {\r\n        return $h.bufs[$h.bufs.length-1];\r\n    };\r\n    function mon(s) {\r\n        if (typeof s==\"string\") return s;\r\n        if (!s[0]) throw s+ \" is not jquery obj\";\r\n        return \"<\"+s[0].tagName+\">\"+s.html()+\"</\"+s[0].tagName+\">\";\r\n    }\r\n    $h.p=function (s) {\r\n        if (typeof s==\"string\") {\r\n            if (s.length>0) {\r\n                s=$(\"<span>\").text(s);\r\n            } else {\r\n                s=null;\r\n            }\r\n        }\r\n        //console.log(\"Append - \"+mon(s)+\" to \"+mon($h.cur()));\r\n        if ($h.cur()) {\r\n            if ($h.lineNo>$h.maxLineNo) {\r\n                $h.maxLineNo=$h.lineNo;\r\n                $h.cur().append($(\"<a>\").attr({id:lineMark+\"-\"+$h.lineNo, name:lineMark+\"-\"+$h.lineNo}));\r\n            }\r\n            if (s) $h.cur().append(s);\r\n        } else {\r\n            console.log(\"Warning - Stack underflow\");\r\n        }\r\n    };\r\n    $h.enter=function (s) {\r\n        //console.log(\"Enter - \"+s+\"  size=\"+$h.bufs.length);\r\n        if (typeof s==\"string\") s=$(s);\r\n        $h.bufs.push(s);\r\n    };\r\n    $h.exit=function () {\r\n        var s=$h.bufs.pop();\r\n        $h.p(s);\r\n        //console.log(\"Exit - \"+s.html()+\"  size=\"+$h.bufs.length);\r\n    };\r\n    $h.h=function (s) {\r\n        return s.replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\");\r\n    };\r\n    return $h;\r\n};\ndefine(\"HttpHelper\", (function (global) {\n    return function () {\n        var ret, fn;\n        return ret || global.HttpHelper;\n    };\n}(this)));\n\nArrow=function () {\r\n    var A={};\r\n    A.show=function (t) {\r\n        if (typeof t==\"string\") t=$(t);\r\n        if (t.length==0) return false;\r\n        var b=$.data(t[0],\"blinking\");\r\n        if (b==\"t\") return;\r\n        $.data(t[0],\"blinking\",\"t\");\r\n        var cnt=3;\r\n        function on() {\r\n            t.addClass(\"tutorial-highlight\");\r\n            setTimeout(off,200);\r\n        }\r\n        function off() {\r\n            t.removeClass(\"tutorial-highlight\");\r\n            if (cnt-->0) setTimeout(on,200);\r\n            else clear();\r\n        }\r\n        on();\r\n        function clear() {\r\n            cnt=0;\r\n            $.data(t[0],\"blinking\",\"f\");\r\n        }\r\n        t.click(function () {\r\n            clear();\r\n        });\r\n    };\r\n    A.showOld=function (t) {\r\n        if (typeof t==\"string\") t=$(t);\r\n        if (t.length==0) return false;\r\n        var p=t.offset();\r\n        var arrow=$(\"<img>\").attr({src:\"images/arrow0.png\"}).css(\r\n                {font: \"40px\", position: \"absolute\", left:p.left, top:p.top+t.height(), color:\"red\", zIndex:1000,\r\n                    \"z-index\":1000}).\r\n                appendTo(\"body\");\r\n        var cnt=0;\r\n        function up() {\r\n            if (!arrow) return;\r\n            arrow.attr({ src:\"images/arrow\"+cnt+\".png\" });\r\n            cnt=(cnt+1)%4;\r\n        }\r\n        setInterval(up,250);\r\n        t.click(function () {\r\n           if (!arrow) return;\r\n           arrow.remove();\r\n           arrow=null;\r\n        });\r\n        return true;\r\n    };\r\n    return A;\r\n}();\ndefine(\"Arrow\", (function (global) {\n    return function () {\n        var ret, fn;\n        return ret || global.Arrow;\n    };\n}(this)));\n\nUtil=(function () {\r\n\r\nfunction getQueryString(key, default_)\r\n{\r\n   if (default_==null) default_=\"\";\r\n   key = key.replace(/[\\[]/,\"\\\\\\[\").replace(/[\\]]/,\"\\\\\\]\");\r\n   var regex = new RegExp(\"[\\\\?&]\"+key+\"=([^&#]*)\");\r\n   var qs = regex.exec(window.location.href);\r\n   if(qs == null)\r\n    return default_;\r\n   else\r\n    return decodeURLComponentEx(qs[1]);\r\n}\r\nfunction decodeURLComponentEx(s){\r\n    return decodeURIComponent(s.replace(/\\+/g, '%20'));\r\n}\r\nfunction endsWith(str,postfix) {\r\n    return str.substring(str.length-postfix.length)===postfix;\r\n}\r\nfunction startsWith(str,prefix) {\r\n    return str.substring(0, prefix.length)===prefix;\r\n}\r\n// From http://hakuhin.jp/js/base64.html#BASE64_DECODE_ARRAY_BUFFER\r\nfunction Base64_To_ArrayBuffer(base64){\r\n    base64=base64.replace(/[\\n=]/g,\"\");\r\n    var dic = new Object();\r\n    dic[0x41]= 0; dic[0x42]= 1; dic[0x43]= 2; dic[0x44]= 3; dic[0x45]= 4; dic[0x46]= 5; dic[0x47]= 6; dic[0x48]= 7; dic[0x49]= 8; dic[0x4a]= 9; dic[0x4b]=10; dic[0x4c]=11; dic[0x4d]=12; dic[0x4e]=13; dic[0x4f]=14; dic[0x50]=15;\r\n    dic[0x51]=16; dic[0x52]=17; dic[0x53]=18; dic[0x54]=19; dic[0x55]=20; dic[0x56]=21; dic[0x57]=22; dic[0x58]=23; dic[0x59]=24; dic[0x5a]=25; dic[0x61]=26; dic[0x62]=27; dic[0x63]=28; dic[0x64]=29; dic[0x65]=30; dic[0x66]=31;\r\n    dic[0x67]=32; dic[0x68]=33; dic[0x69]=34; dic[0x6a]=35; dic[0x6b]=36; dic[0x6c]=37; dic[0x6d]=38; dic[0x6e]=39; dic[0x6f]=40; dic[0x70]=41; dic[0x71]=42; dic[0x72]=43; dic[0x73]=44; dic[0x74]=45; dic[0x75]=46; dic[0x76]=47;\r\n    dic[0x77]=48; dic[0x78]=49; dic[0x79]=50; dic[0x7a]=51; dic[0x30]=52; dic[0x31]=53; dic[0x32]=54; dic[0x33]=55; dic[0x34]=56; dic[0x35]=57; dic[0x36]=58; dic[0x37]=59; dic[0x38]=60; dic[0x39]=61; dic[0x2b]=62; dic[0x2f]=63;\r\n    var num = base64.length;\r\n    var n = 0;\r\n    var b = 0;\r\n    var e;\r\n\r\n    if(!num) return (new ArrayBuffer(0));\r\n    //if(num < 4) return null;\r\n    //if(num % 4) return null;\r\n\r\n    // AA     12    1\r\n    // AAA    18    2\r\n    // AAAA   24    3\r\n    // AAAAA  30    3\r\n    // AAAAAA 36    4\r\n    // num*6/8\r\n    e = Math.floor(num / 4 * 3);\r\n    if(base64.charAt(num - 1) == '=') e -= 1;\r\n    if(base64.charAt(num - 2) == '=') e -= 1;\r\n\r\n    var ary_buffer = new ArrayBuffer( e );\r\n    var ary_u8 = new Uint8Array( ary_buffer );\r\n    var i = 0;\r\n    var p = 0;\r\n    while(p < e){\r\n        b = dic[base64.charCodeAt(i)];\r\n        if(b === undefined) fail(\"Invalid letter: \"+base64.charCodeAt(i));//return null;\r\n        n = (b << 2);\r\n        i ++;\r\n\r\n        b = dic[base64.charCodeAt(i)];\r\n        if(b === undefined) fail(\"Invalid letter: \"+base64.charCodeAt(i))\r\n        ary_u8[p] = n | ((b >> 4) & 0x3);\r\n        n = (b & 0x0f) << 4;\r\n        i ++;\r\n        p ++;\r\n        if(p >= e) break;\r\n\r\n        b = dic[base64.charCodeAt(i)];\r\n        if(b === undefined) fail(\"Invalid letter: \"+base64.charCodeAt(i))\r\n        ary_u8[p] = n | ((b >> 2) & 0xf);\r\n        n = (b & 0x03) << 6;\r\n        i ++;\r\n        p ++;\r\n        if(p >= e) break;\r\n\r\n        b = dic[base64.charCodeAt(i)];\r\n        if(b === undefined) fail(\"Invalid letter: \"+base64.charCodeAt(i))\r\n        ary_u8[p] = n | b;\r\n        i ++;\r\n        p ++;\r\n    }\r\n    function fail(m) {\r\n        console.log(m);\r\n        console.log(base64,i);\r\n        throw new Error(m);\r\n    }\r\n    return ary_buffer;\r\n}\r\n\r\nfunction Base64_From_ArrayBuffer(ary_buffer){\r\n    var dic = [\r\n        'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P',\r\n        'Q','R','S','T','U','V','W','X','Y','Z','a','b','c','d','e','f',\r\n        'g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',\r\n        'w','x','y','z','0','1','2','3','4','5','6','7','8','9','+','/'\r\n    ];\r\n    var base64 = \"\";\r\n    var ary_u8 = new Uint8Array( ary_buffer );\r\n    var num = ary_u8.length;\r\n    var n = 0;\r\n    var b = 0;\r\n\r\n    var i = 0;\r\n    while(i < num){\r\n        b = ary_u8[i];\r\n        base64 += dic[(b >> 2)];\r\n        n = (b & 0x03) << 4;\r\n        i ++;\r\n        if(i >= num) break;\r\n\r\n        b = ary_u8[i];\r\n        base64 += dic[n | (b >> 4)];\r\n        n = (b & 0x0f) << 2;\r\n        i ++;\r\n        if(i >= num) break;\r\n\r\n        b = ary_u8[i];\r\n        base64 += dic[n | (b >> 6)];\r\n        base64 += dic[(b & 0x3f)];\r\n        i ++;\r\n    }\r\n\r\n    var m = num % 3;\r\n    if(m){\r\n        base64 += dic[n];\r\n    }\r\n    if(m == 1){\r\n        base64 += \"==\";\r\n    }else if(m == 2){\r\n        base64 += \"=\";\r\n    }\r\n    return base64;\r\n}\r\n\r\nfunction privatize(o){\r\n    if (o.__privatized) return o;\r\n    var res={__privatized:true};\r\n    for (var n in o) {\r\n        (function (n) {\r\n            var m=o[n];\r\n            if (n.match(/^_/)) return;\r\n            if (typeof m!=\"function\") return;\r\n            res[n]=function () {\r\n                var r=m.apply(o,arguments);\r\n                return r;\r\n            };\r\n        })(n);\r\n    }\r\n    return res;\r\n}\r\nfunction hasNodeBuffer() {\r\n    return typeof Buffer!=\"undefined\";\r\n}\r\nfunction isNodeBuffer(data) {\r\n    return (hasNodeBuffer() && data instanceof Buffer);\r\n}\r\nfunction isBuffer(data) {\r\n    return data instanceof ArrayBuffer || isNodeBuffer(data);\r\n}\r\nfunction utf8bytes2str(bytes) {\r\n    var e=[];\r\n    for (var i=0 ; i<bytes.length ; i++) {\r\n         e.push(\"%\"+(\"0\"+bytes[i].toString(16)).slice(-2));\r\n    }\r\n    try {\r\n        return decodeURIComponent(e.join(\"\"));\r\n    } catch (er) {\r\n        console.log(e.join(\"\"));\r\n        throw er;\r\n    }\r\n}\r\nfunction str2utf8bytes(str, binType) {\r\n    var e=encodeURIComponent(str);\r\n    var r=/^%(..)/;\r\n    var a=[];\r\n    var ad=0;\r\n    for (var i=0 ; i<e.length; i++) {\r\n        var m=r.exec( e.substring(i));\r\n        if (m) {\r\n            a.push(parseInt(\"0x\"+m[1]));\r\n            i+=m[0].length-1;\r\n        } else a.push(e.charCodeAt(i));\r\n    }\r\n    return (typeof Buffer!=\"undefined\" && binType===Buffer ? new Buffer(a) : new Uint8Array(a).buffer);\r\n}\r\n\r\nreturn {\r\n    getQueryString:getQueryString,\r\n    endsWith: endsWith, startsWith: startsWith,\r\n    Base64_To_ArrayBuffer:Base64_To_ArrayBuffer,\r\n    Base64_From_ArrayBuffer:Base64_From_ArrayBuffer,\r\n    utf8bytes2str: utf8bytes2str,\r\n    str2utf8bytes: str2utf8bytes,\r\n    privatize: privatize,\r\n    hasNodeBuffer:hasNodeBuffer,\r\n    isNodeBuffer: isNodeBuffer,\r\n    isBuffer: isBuffer\r\n};\r\n})();\r\n\ndefine(\"Util\", (function (global) {\n    return function () {\n        var ret, fn;\n        return ret || global.Util;\n    };\n}(this)));\n\ndefine('Platform',[],function () {\r\n    var WebSite={};\r\n    // from https://w3g.jp/blog/js_browser_sniffing2015\r\n    var u=window.navigator.userAgent.toLowerCase();\r\n    WebSite.tablet=(u.indexOf(\"windows\") != -1 && u.indexOf(\"touch\") != -1)\r\n    || u.indexOf(\"ipad\") != -1\r\n    || (u.indexOf(\"android\") != -1 && u.indexOf(\"mobile\") == -1)\r\n    || (u.indexOf(\"firefox\") != -1 && u.indexOf(\"tablet\") != -1)\r\n    || u.indexOf(\"kindle\") != -1\r\n    || u.indexOf(\"silk\") != -1\r\n    || u.indexOf(\"playbook\") != -1;\r\n    WebSite.mobile=(u.indexOf(\"windows\") != -1 && u.indexOf(\"phone\") != -1)\r\n    || u.indexOf(\"iphone\") != -1\r\n    || u.indexOf(\"ipod\") != -1\r\n    || (u.indexOf(\"android\") != -1 && u.indexOf(\"mobile\") != -1)\r\n    || (u.indexOf(\"firefox\") != -1 && u.indexOf(\"mobile\") != -1)\r\n    || u.indexOf(\"blackberry\") != -1;\r\n    return WebSite;\r\n});\r\n\n/*global process, require, BuiltinAssets */\r\ndefine('WebSite',[\"FS\",\"Platform\"], function (FS,Platform) {\r\n\tvar P=FS.PathUtil;\r\n\tvar loc=document.location.href;\r\n\tvar devMode=!!loc.match(/html\\/dev\\//) && !!loc.match(/localhost:3/);\r\n\tvar WebSite;\r\n\tvar prot=location.protocol;\r\n\tvar k;\r\n\tif (!prot.match(/^http/)) prot=\"https:\";\r\n\tswitch(window.WebSite_runType) {\r\n\tcase \"IDE\":\r\n\t\tWebSite={\r\n\t\t\turlAliases: {}, top: \".\",\r\n\t\t\ttablet:Platform.tablet,\r\n\t\t\tmobile:Platform.mobile\r\n\t\t};\r\n\t\tWebSite.builtinAssetNames={\r\n\t\t\t\"images/Ball.png\":1,\r\n\t\t\t\"images/base.png\":1,\r\n\t\t\t\"images/Sample.png\":1,\r\n\t\t\t\"images/inputPad.png\":1,\r\n\t\t\t\"images/neko.png\":1,\r\n\t\t\t\"images/mapchip.png\":1\r\n\t\t};\r\n\t\tif (!WebSite.pluginTop) {\r\n\t\t\tWebSite.pluginTop=WebSite.top+\"/js/plugins\";\r\n\t\t}\r\n\t\tWebSite.sampleImg=WebSite.top+\"/images\";\r\n\t\tWebSite.isNW=(typeof process==\"object\" && (process.__node_webkit||process.__nwjs));\r\n\t\tWebSite.mp4Disabled=WebSite.isNW;\r\n\t\tWebSite.tonyuHome=\"/Tonyu/\";\r\n\t\tWebSite.PathSep=\"/\";\r\n\t\tif (WebSite.isNW) {\r\n\t\t\tWebSite.noconcat=true;\r\n\t\t\tWebSite.PathSep=require(\"path\").sep;\r\n\t\t\tWebSite.cwd=P.directorify(process.cwd().replace(/\\\\/g,\"/\"));\r\n\t\t\t//WebSite.exeDir=WebSite.execDir=P.up(P.fixSep(process.execPath)); not suitable when mac\r\n\t\t\tif (process.env.TONYU_HOME) {\r\n\t\t\t\tWebSite.tonyuHome=P.directorify(process.env.TONYU_HOME);\r\n\t\t\t} else {\r\n\t\t\t\tWebSite.tonyuHome=P.rel(WebSite.cwd,\"fs/Tonyu/\");\r\n\t\t\t}\r\n\t\t\tWebSite.logdir=process.env.TONYU_LOGDIR;//\"C:/var/log/Tonyu/\";\r\n\t\t\tWebSite.wwwDir=P.rel(WebSite.cwd,\"www/\");\r\n\t\t\tWebSite.platform=process.platform;\r\n\t\t\tWebSite.ffmpeg=P.rel(WebSite.cwd,(WebSite.platform==\"win32\"?\r\n\t\t\t\t\t\"ffmpeg/bin/ffmpeg.exe\":\"ffmpeg/bin/ffmpeg\"));\r\n\t\t\tWebSite.pkgInfo=require(P.rel(WebSite.cwd, \"package.json\"));\r\n\t\t\tif (process.env.TONYU_PROJECTS) {\r\n\t\t\t\tWebSite.projects=process.env.TONYU_PROJECTS.replace(/\\\\/g,\"/\").split(require('path').delimiter);\r\n\t\t\t} else if ( WebSite.pkgInfo && WebSite.pkgInfo.config && WebSite.pkgInfo.config.prjDirs ){\r\n\t\t\t\tWebSite.projects=WebSite.pkgInfo.config.prjDirs.map(function (d) {\r\n\t\t\t\t\td=P.directorify(d);\r\n\t\t\t\t\tif (P.isAbsolute(d)) return d;\r\n\t\t\t\t\treturn P.rel(WebSite.cwd,d);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tWebSite.projects=[P.rel(WebSite.cwd,\"Projects/\"),\r\n\t\t\t\t\tP.rel(WebSite.tonyuHome,\"Projects/\")];\r\n\t\t\t}\r\n\t\t\tWebSite.kernelDir=P.rel(WebSite.wwwDir,\"Kernel/\");\r\n\t\t} else {\r\n\t\t\tif (loc.match(/edit\\.tonyu\\.jp\\/n\\//)) {\r\n\t\t\t\tWebSite.wwwDir=prot+\"//\"+location.host+\"/n/\";\r\n\t\t\t} else {\r\n\t\t\t\t// Why?\r\n\t\t\t\tWebSite.wwwDir=prot+\"//\"+location.host+\"/\";\r\n\t\t\t}\r\n\t\t\tWebSite.projects=[P.rel(WebSite.tonyuHome,\"Projects/\")];\r\n\t\t}\r\n\t\t//WebSite.kernelDir=WebSite.top+\"/Kernel/\";\r\n\t\t// kernelDir must be absolute\r\n\t\tWebSite.kernelDir=P.rel(WebSite.wwwDir,\"Kernel/\");\r\n\t\t// compiledKernel is URL , not file path.\r\n\t\t// It is correct as long as the html pages in www/ (not html/build|dev )\r\n\t\tWebSite.compiledKernel=\"Kernel/js/concat.js\";   //P.rel(WebSite.kernelDir,\"js/concat.js\");\r\n\t\tif (loc.match(/localhost\\/tonyu2/)) {\r\n\t\t\tWebSite.wwwDir=prot+\"//\"+location.host+\"/tonyu2/\";\r\n\t\t\tWebSite.kernelDir=WebSite.wwwDir+\"Kernel/\";\r\n\t\t\tWebSite.compiledKernel=WebSite.kernelDir+\"js/concat.js\";\r\n\t\t\tWebSite.uploadTmpUrl=prot+\"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi\";\r\n\t\t\tWebSite.newVersionUrl=prot+\"//localhost/tsite/tonyu/project/newVersion.cgi\";\r\n\t\t\tWebSite.scriptServer=\"https://localhost/tonyu2/\";\r\n\t\t} else {\r\n\t\t\tWebSite.uploadTmpUrl=prot+\"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi\";\r\n\t\t\tWebSite.newVersionUrl=prot+\"//www.tonyu.jp/project/newVersion.cgi\";\r\n\t\t\tWebSite.scriptServer=\"https://edit.tonyu.jp/\";\r\n\t\t}\r\n\t\tWebSite.version=2;\r\n\t\tWebSite.hoge=\"fuga\";\r\n\t\tFS.setEnvProvider(new FS.Env(WebSite));\r\n\t\twindow.WebSite=WebSite;\r\n\t\treturn WebSite;\r\n\tcase \"singleHTML\":\r\n\t\tWebSite={\r\n\t\t\turlAliases: {}, top: \".\",\r\n\t\t\ttablet:Platform.tablet,\r\n\t\t\tmobile:Platform.mobile\r\n\t\t};\r\n\t\tif (typeof BuiltinAssets===\"object\") {\r\n\t\t\tfor (k in BuiltinAssets) {\r\n\t\t\t\tWebSite.urlAliases[k]=BuiltinAssets[k];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tWebSite.tonyuHome=\"/Tonyu/\";\r\n\t\tWebSite.projects=[P.rel(WebSite.tonyuHome,\"Projects/\")];\r\n\t\tif (loc.match(/localhost\\/tonyu2/)) {\r\n\t\t\tWebSite.scriptServer=\"http://localhost/tonyu2/\";\r\n\t\t} else {\r\n\t\t\tWebSite.scriptServer=\"https://edit.tonyu.jp/\";\r\n\t\t}\r\n\t\tWebSite.pluginTop=WebSite.scriptServer+\"js/plugins\";\r\n\t\tWebSite.isNW=(typeof process==\"object\" && (process.__node_webkit||process.__nwjs));\r\n\t\tWebSite.PathSep=\"/\";\r\n\t\tWebSite.compiledKernel=WebSite.scriptServer+\"Kernel/js/concat.js\";\r\n\t\tFS.setEnvProvider(new FS.Env(WebSite));\r\n\t\twindow.WebSite=WebSite;\r\n\t\treturn WebSite;\r\n\tcase \"multiHTML\":\r\n\t\tWebSite={\r\n\t\t\turlAliases: {}, top: \".\",\r\n\t\t\ttablet:Platform.tablet,\r\n\t\t\tmobile:Platform.mobile\r\n\t\t};\r\n\t\tWebSite.tonyuHome=\"/Tonyu/\";\r\n\t\tWebSite.pluginTop=WebSite.top+\"/js/plugins\";\r\n\t\tWebSite.isNW=(typeof process==\"object\" && (process.__node_webkit||process.__nwjs));\r\n\t\tWebSite.PathSep=\"/\";\r\n\t\tWebSite.mp4Disabled=WebSite.isNW;\r\n\t\tif (WebSite.isNW) {\r\n\t\t\tWebSite.PathSep=require(\"path\").sep;\r\n\t\t\tWebSite.cwd=P.directorify(process.cwd().replace(/\\\\/g,\"/\"));\r\n\t\t\tWebSite.platform=process.platform;\r\n\t\t}\r\n\t\t// this sets at runScript2.js\r\n\t\t//WebSite.compiledKernel=WebSite.top+\"/js/kernel.js\";\r\n\t\t//-------------\r\n\t\tFS.setEnvProvider(new FS.Env(WebSite));\r\n\t\twindow.WebSite=WebSite;\r\n\t\treturn WebSite;\r\n\t}\r\n\r\n\tif (loc.match(/jsrun\\.it/)) {\r\n\t\tWebSite={\r\n\t\t\turlAliases: {\r\n\t\t\t\t\"images/Ball.png\":\"http:\"+\"//jsrun.it/assets/9/X/T/b/9XTbt.png\",\r\n\t\t\t\t\"images/base.png\":\"http:\"+\"//jsrun.it/assets/6/F/y/3/6Fy3B.png\",\r\n\t\t\t\t\"images/Sample.png\":\"http:\"+\"//jsrun.it/assets/s/V/S/l/sVSlZ.png\",\r\n\t\t\t\t\"images/neko.png\":\"http:\"+\"//jsrun.it/assets/f/D/z/z/fDzze.png\",\r\n\t\t\t\t\"images/mapchip.png\":\"http:\"+\"//jsrun.it/assets/f/u/N/v/fuNvz.png\"\r\n\t\t\t},top:\"\",devMode:devMode,\r\n\t\t\tpluginTop: \"https://edit.tonyu.jp/js/plugins\",\r\n\t\t\tremoveJSOutput:true\r\n\t\t};\r\n\t} else if (\r\n\t\tloc.match(/tonyuexe\\.appspot\\.com/) ||\r\n\t\tloc.match(/localhost:8887/) ||\r\n\t\t(\r\n\t\t/*(\r\n\t\t\tloc.match(/^chrome-extension:/) ||\r\n\t\t\tloc.match(/localhost/) ||\r\n\t\t\tloc.match(/tonyuedit\\.appspot\\.com/)\r\n\t\t) &&*/\r\n\t\tloc.match(/\\/html\\/((dev)|(build))\\//)\r\n\t\t)\r\n\t) {\r\n\t\tWebSite={\r\n\t\t\turlAliases: {\r\n\t\t\t\t\"images/Ball.png\":\"../../images/Ball.png\",\r\n\t\t\t\t\"images/base.png\":\"../../images/base.png\",\r\n\t\t\t\t\"images/Sample.png\":\"../../images/Sample.png\",\r\n\t\t\t\t\"images/neko.png\":\"../../images/neko.png\",\r\n\t\t\t\t\"images/mapchip.png\":\"../../images/mapchip.png\",\r\n\t\t\t\t\"images/sound.png\":\"../../images/sound.png\",\r\n\t\t\t\t\"images/sound_ogg.png\":\"../../images/sound_ogg.png\",\r\n\t\t\t\t\"images/sound_mp3.png\":\"../../images/sound_mp3.png\",\r\n\t\t\t\t\"images/sound_mp4.png\":\"../../images/sound_mp4.png\",\r\n\t\t\t\t\"images/sound_m4a.png\":\"../../images/sound_m4a.png\",\r\n\t\t\t\t\"images/sound_mid.png\":\"../../images/sound_mid.png\",\r\n\t\t\t\t\"images/sound_wav.png\":\"../../images/sound_wav.png\",\r\n\t\t\t\t\t\"images/ecl.png\":\"../../images/ecl.png\"\r\n\t\t\t},top:\"../..\",devMode:devMode\r\n\t\t};\r\n\t} else if (\r\n\t\tloc.match(/bitarrow/) ||\r\n\t\tloc.match(/localhost.*pub/))  {\r\n\t\tWebSite={};\r\n\t\tvar WS=WebSite;\r\n\t\tWebSite.serverType=\"BA\";\r\n\t\tWS.runtime=\"../../../runtime/\";\r\n\t\tWS.urlAliases= {\r\n\t\t\t\t\"images/base.png\":WS.runtime+\"images/base.png\",\r\n\t\t\t\t\"images/Sample.png\":WS.runtime+\"images/Sample.png\",\r\n\t\t\t\t\"images/neko.png\":WS.runtime+\"images/neko.png\",\r\n\t\t\t\t\"images/mapchip.png\":WS.runtime+\"images/mapchip.png\",\r\n\t\t\t\t\"images/sound.png\":WS.runtime+\"images/sound.png\",\r\n\t\t\t\t\"images/sound_ogg.png\":WS.runtime+\"images/sound_ogg.png\",\r\n\t\t\t\t\"images/sound_mp3.png\":WS.runtime+\"images/sound_mp3.png\",\r\n\t\t\t\t\"images/sound_mp4.png\":WS.runtime+\"images/sound_mp4.png\",\r\n\t\t\t\t\"images/sound_m4a.png\":WS.runtime+\"images/sound_m4a.png\",\r\n\t\t\t\t\"images/sound_mid.png\":WS.runtime+\"images/sound_mid.png\",\r\n\t\t\t\t\"images/sound_wav.png\":WS.runtime+\"images/sound_wav.png\",\r\n\t\t\t\t\"images/ecl.png\":WS.runtime+\"images/ecl.png\"\r\n\t\t};\r\n\t} else {\r\n\t\tWebSite={\r\n\t\t\turlAliases: {}, top: \".\",devMode:devMode\r\n\t\t};\r\n\t}\r\n\tif (typeof BuiltinAssets===\"object\") {\r\n\t\tfor (k in BuiltinAssets) {\r\n\t\t\tWebSite.urlAliases[k]=BuiltinAssets[k];\r\n\t\t}\r\n\t}\r\n\tWebSite.builtinAssetNames={\r\n\t\t\"images/Ball.png\":1,\r\n\t\t\"images/base.png\":1,\r\n\t\t\"images/Sample.png\":1,\r\n\t\t\"images/neko.png\":1,\r\n\t\t\"images/mapchip.png\":1\r\n\t};\r\n\t// from https://w3g.jp/blog/js_browser_sniffing2015\r\n\tvar u=window.navigator.userAgent.toLowerCase();\r\n\tWebSite.tablet=(u.indexOf(\"windows\") != -1 && u.indexOf(\"touch\") != -1) ||\r\n\tu.indexOf(\"ipad\") != -1 ||\r\n\t(u.indexOf(\"android\") != -1 && u.indexOf(\"mobile\") == -1) ||\r\n\t(u.indexOf(\"firefox\") != -1 && u.indexOf(\"tablet\") != -1) ||\r\n\tu.indexOf(\"kindle\") != -1 ||\r\n\tu.indexOf(\"silk\") != -1 ||\r\n\tu.indexOf(\"playbook\") != -1;\r\n\tWebSite.mobile=(u.indexOf(\"windows\") != -1 && u.indexOf(\"phone\") != -1) ||\r\n\tu.indexOf(\"iphone\") != -1 ||\r\n\tu.indexOf(\"ipod\") != -1 ||\r\n\t(u.indexOf(\"android\") != -1 && u.indexOf(\"mobile\") != -1) ||\r\n\t(u.indexOf(\"firefox\") != -1 && u.indexOf(\"mobile\") != -1) ||\r\n\tu.indexOf(\"blackberry\") != -1;\r\n\r\n\tif (!WebSite.pluginTop) {\r\n\t\tWebSite.pluginTop=WebSite.top+\"/js/plugins\";\r\n\t}\r\n\tWebSite.disableROM={};\r\n\t/*if (loc.match(/tonyuedit\\.appspot\\.com/) || loc.match(/localhost:8888/) ) {\r\n\t\t//WebSite.disableROM={\"ROM_d.js\":true};\r\n\t}*/\r\n\tif (loc.match(/\\.appspot\\.com/) ||  loc.match(/localhost:888[87]/)) {\r\n\t\tWebSite.serverType=\"GAE\";\r\n\t}\r\n\tif (loc.match(/localhost:3000/) ) {\r\n\t\tWebSite.serverType=\"Node\";\r\n\t}\r\n\tif (loc.match(/tonyuexe\\.appspot\\.com/) ||\r\n\t\tloc.match(/localhost:8887/)) {\r\n\t\tWebSite.serverTop=WebSite.top+\"/exe\"; // Fix NetModule.tonyu!!\r\n\t} else {\r\n\t\tWebSite.serverTop=WebSite.top+\"/edit\";// Fix NetModule.tonyu!!\r\n\t}\r\n\tWebSite.sampleImg=WebSite.top+\"/images\";\r\n\tWebSite.blobPath=WebSite.serverTop+\"/serveBlob\";        //TODO: urlchange!\r\n\tWebSite.isNW=(typeof process==\"object\" && (process.__node_webkit||process.__nwjs));\r\n\tWebSite.mp4Disabled=WebSite.isNW;\r\n\tWebSite.tonyuHome=\"/Tonyu/\";\r\n\tWebSite.url={\r\n\t\tgetDirInfo:WebSite.serverTop+\"/getDirInfo\",\r\n\t\tgetFiles:WebSite.serverTop+\"/File2LSSync\",\r\n\t\tputFiles:WebSite.serverTop+\"/LS2FileSync\"\r\n\t};\r\n\tWebSite.PathSep=\"/\";\r\n\tif (WebSite.isNW) {\r\n\t\tWebSite.PathSep=require(\"path\").sep;\r\n\t\tWebSite.cwd=P.directorify(process.cwd().replace(/\\\\/g,\"/\"));\r\n\t\t//WebSite.exeDir=WebSite.execDir=P.up(P.fixSep(process.execPath)); not suitable when mac\r\n\t\tif (process.env.TONYU_HOME) {\r\n\t\t\tWebSite.tonyuHome=P.directorify(process.env.TONYU_HOME);\r\n\t\t} else {\r\n\t\t\tWebSite.tonyuHome=P.rel(WebSite.cwd,\"fs/Tonyu/\");\r\n\t\t}\r\n\t\tWebSite.logdir=process.env.TONYU_LOGDIR;//\"C:/var/log/Tonyu/\";\r\n\t\tWebSite.wwwDir=P.rel(WebSite.cwd,\"www/\");\r\n\t\tWebSite.platform=process.platform;\r\n\t\tWebSite.ffmpeg=P.rel(WebSite.cwd,(WebSite.platform==\"win32\"?\r\n\t\t\t\t\"ffmpeg/bin/ffmpeg.exe\":\"ffmpeg/bin/ffmpeg\"));\r\n\t\tWebSite.pkgInfo=require(P.rel(WebSite.cwd, \"package.json\"));\r\n\t\tif (process.env.TONYU_PROJECTS) {\r\n\t\t\tWebSite.projects=process.env.TONYU_PROJECTS.replace(/\\\\/g,\"/\").split(require('path').delimiter);\r\n\t\t} else if ( WebSite.pkgInfo && WebSite.pkgInfo.config && WebSite.pkgInfo.config.prjDirs ){\r\n\t\t\tWebSite.projects=WebSite.pkgInfo.config.prjDirs.map(function (d) {\r\n\t\t\t\td=P.directorify(d);\r\n\t\t\t\tif (P.isAbsolute(d)) return d;\r\n\t\t\t\treturn P.rel(WebSite.cwd,d);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tWebSite.projects=[P.rel(WebSite.cwd,\"Projects/\"),\r\n\t\t\t\t\t\t\t\tP.rel(WebSite.tonyuHome,\"Projects/\")];\r\n\t\t}\r\n\t\tWebSite.kernelDir=P.rel(WebSite.wwwDir,\"Kernel/\");\r\n\t} else {\r\n\t\tWebSite.wwwDir=prot+\"//\"+location.host+\"/\";\r\n\t\tWebSite.projects=[P.rel(WebSite.tonyuHome,\"Projects/\")];\r\n\t}\r\n\tif (loc.match(/edit\\.tonyu\\.jp/) ||\r\n\t\tloc.match(/tonyuedit\\.appspot\\.com/) ||\r\n\t\tloc.match(/localhost:888/)) {\r\n\t\t//WebSite.kernelDir=WebSite.top+\"/Kernel/\";\r\n\t\t// kernelDir must be absolute\r\n\t\tWebSite.kernelDir=prot+\"//\"+location.host+\"/Kernel/\";\r\n\t}\r\n\tif (loc.match(/edit\\.tonyu\\.jp/) ||\r\n\t\tloc.match(/tonyuedit\\.appspot\\.com/) ||\r\n\t\tloc.match(/localhost:888/) ||\r\n\t\tWebSite.isNW) {\r\n\t\tWebSite.compiledKernel=WebSite.kernelDir+\"js/concat.js\";\r\n\t} else if (WebSite.serverType===\"BA\") {\r\n\t\tWebSite.compiledKernel=WebSite.runtime+\"lib/tonyu/kernel.js\";\r\n\t} else {\r\n\t\tWebSite.compiledKernel=\"https://edit.tonyu.jp/Kernel/js/concat.js\";\r\n\t\t//WebSite.compiledKernel=prot+\"//tonyuexe.appspot.com/Kernel/js/concat.js\";\r\n\t}\r\n\tif (loc.match(/localhost\\/tonyu2/)) {\r\n\t\tWebSite.wwwDir=prot+\"//\"+location.host+\"/tonyu2/\";\r\n\t\tWebSite.kernelDir=WebSite.wwwDir+\"Kernel/\";\r\n\t\tWebSite.compiledKernel=WebSite.kernelDir+\"js/concat.js\";\r\n\t\tWebSite.uploadTmpUrl=prot+\"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi\";\r\n\t\tWebSite.newVersionUrl=prot+\"//localhost/tsite/tonyu/project/newVersion.cgi\";\r\n\t} else {\r\n\t\tWebSite.uploadTmpUrl=prot+\"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi\";\r\n\t\tWebSite.newVersionUrl=prot+\"//www.tonyu.jp/project/newVersion.cgi\";\r\n\t}\r\n\r\n\tif (loc.match(/((index)|(project))2/)) {\r\n\t\tWebSite.version=2;\r\n\t\tif (WebSite.isNW) {\r\n\t\t\tWebSite.devMode=true;\r\n\t\t} else {\r\n\t\t\tWebSite.devMode=false;\r\n\t\t}\r\n\t}\r\n\tFS.setEnvProvider(new FS.Env(WebSite));\r\n\twindow.WebSite=WebSite;\r\n\treturn WebSite;\r\n});\r\n\ndefine('assert',[\"FS\"],function (FS){return FS.assert;});\r\n\ndefine('Shell',[\"FS\",\"assert\"],\r\n        function (FS,assert) {\r\n    var Shell={};\r\n    var PathUtil=assert(FS.PathUtil);\r\n    Shell.newCommand=function (name,func) {\r\n        this[name]=func;\r\n    };\r\n    Shell.cd=function (dir) {\r\n        Shell.cwd=resolve(dir,true);\r\n        return Shell.pwd();\r\n    };\r\n    Shell.vars=Object.create(FS.getEnv());\r\n    Shell.mount=function (options, path) {\r\n        //var r=resolve(path);\r\n        if (!options || !options.t) {\r\n            var fst=[];\r\n            for (var k in FS.getRootFS().availFSTypes()) {\r\n                fst.push(k);\r\n            }\r\n            sh.err(\"-t=(\"+fst.join(\"|\")+\") should be specified.\");\r\n            return;\r\n        }\r\n        FS.mount(path,options.t, options);\r\n    };\r\n    Shell.unmount=function (path) {\r\n        FS.unmount(path);\r\n    };\r\n    Shell.fstab=function () {\r\n        var rfs=FS.getRootFS();\r\n        var t=rfs.fstab();\r\n        var sh=this;\r\n        //sh.echo(rfs.fstype()+\"\\t\"+\"<Root>\");\r\n        t.forEach(function (fs) {\r\n            sh.echo(fs.fstype()+\"\\t\"+(fs.mountPoint||\"<Default>\"));\r\n        });\r\n    }\r\n    Shell.resolve=resolve;\r\n    function resolve(v, mustExist) {\r\n        var r=resolve2(v);\r\n        if (!FS.SFile.is(r)) {console.log(r,\" is not file\");}\r\n        if (mustExist && !r.exists()) throw new Error(r+\": no such file or directory\");\r\n        return r;\r\n    }\r\n    function resolve2(v) {\r\n        if (typeof v!=\"string\") return v;\r\n        var c=Shell.cwd;\r\n        if (PathUtil.isAbsolutePath(v)) return FS.resolve(v,c);\r\n        return c.rel(v);\r\n    }\r\n    Shell.pwd=function () {\r\n        return Shell.cwd+\"\";\r\n    };\r\n    Shell.ls=function (dir){\r\n    \tif (!dir) dir=Shell.cwd;\r\n    \telse dir=resolve(dir, true);\r\n        return dir.ls();\r\n    };\r\n    Shell.cp=function (from ,to ,options) {\r\n        if (!options) options={};\r\n        if (options.v) {\r\n            Shell.echo(\"cp\", from ,to);\r\n            options.echo=Shell.echo.bind(Shell);\r\n        }\r\n        var f=resolve(from, true);\r\n        var t=resolve(to);\r\n        return f.copyTo(t,options);\r\n    };\r\n    Shell.ln=function (to , from ,options) {\r\n        var f=resolve(from);\r\n        var t=resolve(to, true);\r\n        if (f.isDir() && f.exists()) {\r\n            f=f.rel(t.name());\r\n        }\r\n        if (f.exists()) {\r\n            throw new Error(f+\" exists\");\r\n        }\r\n        return f.link(t,options);\r\n    };\r\n    Shell.rm=function (file, options) {\r\n        if (!options) options={};\r\n        if (options.notrash) {\r\n            file=resolve(file, false);\r\n            file.removeWithoutTrash();\r\n            return 1;\r\n        }\r\n        file=resolve(file, true);\r\n        if (file.isDir() && options.r) {\r\n            var dir=file;\r\n            var sum=0;\r\n            dir.each(function (f) {\r\n                if (f.exists()) {\r\n                    sum+=Shell.rm(f, options);\r\n                }\r\n            });\r\n            dir.rm();\r\n            return sum+1;\r\n        } else {\r\n            file.rm();\r\n            return 1;\r\n        }\r\n    };\r\n    Shell.mkdir=function (file,options) {\r\n        file=resolve(file, false);\r\n        if (file.exists()) throw new Error(file+\" : exists\");\r\n        return file.mkdir();\r\n\r\n    };\r\n    Shell.cat=function (file,options) {\r\n        file=resolve(file, true);\r\n        return Shell.echo(file.getContent(function (c) {\r\n            if (file.isText()) {\r\n                return c.toPlainText();\r\n            } else {\r\n                return c.toURL();\r\n            }\r\n        }));\r\n    };\r\n    Shell.resolve=function (file) {\r\n        if (!file) file=\".\";\r\n        file=resolve(file);\r\n        return file;\r\n    };\r\n    Shell.grep=function (pattern, file, options) {\r\n        file=resolve(file, true);\r\n        if (!options) options={};\r\n        if (!options.res) options.res=[];\r\n        if (file.isDir()) {\r\n            file.each(function (e) {\r\n                Shell.grep(pattern, e, options);\r\n            });\r\n        } else {\r\n            if (typeof pattern==\"string\") {\r\n                file.lines().forEach(function (line, i) {\r\n                    if (line.indexOf(pattern)>=0) {\r\n                        report(file, i+1, line);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        return options.res;\r\n        function report(file, lineNo, line) {\r\n            if (options.res) {\r\n                options.res.push({file:file, lineNo:lineNo,line:line});\r\n            }\r\n            Shell.echo(file+\"(\"+lineNo+\"): \"+line);\r\n\r\n        }\r\n    };\r\n    Shell.touch=function (f) {\r\n    \tf=resolve(f);\r\n    \tf.text(f.exists() ? f.text() : \"\");\r\n    \treturn 1;\r\n    };\r\n    Shell.setout=function (ui) {\r\n        Shell.outUI=ui;\r\n    };\r\n    Shell.echo=function () {\r\n        return $.when.apply($,arguments).then(function () {\r\n            console.log.apply(console,arguments);\r\n            if (Shell.outUI && Shell.outUI.log) Shell.outUI.log.apply(Shell.outUI,arguments);\r\n        });\r\n    };\r\n    Shell.err=function (e) {\r\n        console.log.apply(console,arguments);\r\n        if (e && e.stack) console.log(e.stack);\r\n        if (Shell.outUI && Shell.outUI.err) Shell.outUI.err.apply(Shell.outUI,arguments);\r\n    };\r\n    Shell.clone= function () {\r\n        var r=Object.create(this);\r\n        r.vars=Object.create(this.vars);\r\n        return r;\r\n    };\r\n    Shell.getvar=function (k) {\r\n        return this.vars[k] || (process && process.env[k]);\r\n    };\r\n    Shell.get=Shell.getvar;\r\n    Shell.set=function (k,v) {\r\n        return this.vars[k]=v;\r\n    };\r\n    Shell.strcat=function () {\r\n        if (arguments.length==1) return arguments[0];\r\n        var s=\"\";\r\n        for (var i=0;i<arguments.length;i++) s+=arguments[i];\r\n        return s;\r\n    };\r\n    Shell.exists=function (f) {\r\n        f=this.resolve(f);\r\n        return f.exists();\r\n    };\r\n    Shell.dl=function (f) {\r\n        f=this.resolve(f||\".\");\r\n        return f.download();\r\n    };\r\n    Shell.zip=function () {\r\n        var t=this;\r\n        var a=Array.prototype.slice.call(arguments).map(function (e) {\r\n            if (typeof e===\"string\") return t.resolve(e);\r\n            return e;\r\n        });\r\n        return FS.zip.zip.apply(FS.zip,a);\r\n    };\r\n    Shell.unzip=function () {\r\n        var t=this;\r\n        var a=Array.prototype.slice.call(arguments).map(function (e) {\r\n            if (typeof e===\"string\") return t.resolve(e);\r\n            return e;\r\n        });\r\n        return FS.zip.unzip.apply(FS.zip,a);\r\n    };\r\n\r\n    Shell.prompt=function () {};\r\n    Shell.ASYNC={r:\"SH_ASYNC\"};\r\n    Shell.help=function () {\r\n        for (var k in Shell) {\r\n            var c=Shell[k];\r\n            if (typeof c==\"function\") {\r\n                Shell.echo(k+(c.description?\" - \"+c.description:\"\"));\r\n            }\r\n        }\r\n    };\r\n    if (!window.sh) window.sh=Shell;\r\n    if (typeof process==\"object\") {\r\n        sh.devtool=function () { require('nw.gui').Window.get().showDevTools();}\r\n        sh.cd(process.cwd().replace(/\\\\/g,\"/\"));\r\n    } else {\r\n        sh.cd(\"/\");\r\n    }\r\n    return Shell;\r\n});\r\n\ndefine('Log',[\"FS\",\"WebSite\",\"Shell\"], function (FS,WebSite,sh) {\r\n    var Log={};\r\n    var logHome=WebSite.logdir ? FS.resolve(\"${logdir}\") : null;\r\n    var doLog=logHome && logHome.exists();\r\n    Log.todayDir=function () {\r\n        var d=new Date();\r\n        var y=d.getFullYear();\r\n        var m=d.getMonth()+1;\r\n        var da=d.getDate();\r\n        return logHome.rel(y+\"/\").rel(m+\"/\").rel(da+\"/\");\r\n    };\r\n    Log.curFile=function () {\r\n        var d=new Date();\r\n        var y=d.getFullYear();\r\n        var m=d.getMonth()+1;\r\n        var da=d.getDate();\r\n        return Log.todayDir().rel(y+\"-\"+m+\"-\"+da+\".log\");\r\n    };\r\n    Log.curProject=function () {\r\n        var d=new Date();\r\n        var h=d.getHours();\r\n        var m=d.getMinutes();\r\n        var s=d.getSeconds();\r\n        return Log.todayDir().rel(\"Project/\").rel(digit(h,2)+\"_\"+digit(m,2)+\"_\"+digit(s,2)+\"/\");\r\n    };\r\n    function digit(n,zs) {\r\n        n=\"00000000000000\"+n;\r\n        return n.substring(n.length-zs);\r\n    }\r\n    Log.dumpProject=function (dir) {\r\n        if (!doLog) return;\r\n        var out=Log.curProject();\r\n        sh.cp(dir, out);\r\n        Log.append(\"Dumped project to \"+out.path());\r\n    };\r\n    if (!WebSite.logging && !WebSite.isNW) {\r\n        var varlog=FS.get(\"/var/log/\");\r\n        if (varlog.exists() && varlog.fs.storage===localStorage) {\r\n            varlog.removeWithoutTrash({r:true});\r\n        }\r\n    }\r\n    Log.append=function (line) {\r\n        if (!doLog) return;\r\n        //if (WebSite.isNW) return;\r\n        var f=Log.curFile();\r\n        //console.log(Log, \"append \"+f);\r\n        var t=(f.exists()?f.text():\"\");\r\n        f.text(t+line+\"\\n\");\r\n    };\r\n    function mul(con) {\r\n        return con.replace(/\\n/g,\"\\n|\");\r\n    }\r\n    Log.d=function (tag,con) {\r\n        Log.append(new Date()+\": [\"+tag+\"]\"+mul(con));\r\n    };\r\n    Log.e=function (tag,con) {\r\n        Log.append(new Date()+\": ERROR[\"+tag+\"]\"+mul(con));\r\n    };\r\n    return Log;\r\n});\ndefine('exceptionCatcher',[], function () {\r\n    var res={};\r\n    res.f=function (f) {\r\n        if (typeof f==\"function\") {\r\n            if (f.isTrcf) return f;\r\n            var r=function () {\r\n                if (res.handleException && !res.enter) {\r\n                    try {\r\n                        res.enter=true;\r\n                        return f.apply(this,arguments);\r\n                    } catch (e) {\r\n                        res.handleException(e);\r\n                    } finally {\r\n                        res.enter=false;\r\n                    }\r\n                } else {\r\n                    return f.apply(this,arguments);\r\n                }\r\n            };\r\n            r.isTrcf=true;\r\n            return r;\r\n        } else if(typeof f==\"object\") {\r\n            for (var k in f) {\r\n                f[k]=res.f(f[k]);\r\n            }\r\n            return f;\r\n        }\r\n    };\r\n    //res.handleException=function (){};\r\n    return res;\r\n});\ndefine('UI',[\"Util\",\"exceptionCatcher\"],function (Util, EC) {\r\n    var UI={};\r\n    var F=EC.f;\r\n    UI=function () {\r\n        var expr=[];\r\n        for (var i=0 ; i<arguments.length ; i++) {\r\n            expr[i]=arguments[i];\r\n        }\r\n        var listeners=[];\r\n        var $vars={};\r\n        var $edits=[];\r\n        var res=parse(expr);\r\n        res.$edits=$edits;\r\n        res.$vars=$vars;\r\n        $.data(res,\"edits\",$edits);\r\n        $.data(res,\"vars\",$vars);\r\n        $edits.load=function (model) {\r\n            $edits.model=model;\r\n            $edits.forEach(function (edit) {\r\n                $edits.writeToJq(edit.params.$edit, edit.jq);\r\n            });\r\n            $edits.validator.on.validate.call($edits.validator, $edits.model);\r\n        };\r\n        $edits.writeToJq=function ($edit, jq) {\r\n        \tvar m=$edits.model;\r\n            if (!m) return;\r\n            var name = $edit.name;\r\n            var a=name.split(\".\");\r\n            for (var i=0 ; i<a.length ;i++) {\r\n                m=m[a[i]];\r\n            }\r\n            m=$edit.type.toVal(m);\r\n            if (jq.attr(\"type\")==\"checkbox\") {\r\n                jq.prop(\"checked\",!!m);\r\n            } else {\r\n                jq.val(m);\r\n            }\r\n        };\r\n        $edits.validator={\r\n       \t\terrors:{},\r\n       \t\tshow: function () {\r\n       \t\t\tif ($vars.validationMessage) {\r\n       \t\t\t\t$vars.validationMessage.empty();\r\n       \t\t\t\tfor (var name in this.errors) {\r\n       \t\t\t\t\t$vars.validationMessage.append(UI(\"div\", this.errors[name].mesg));\r\n       \t\t\t\t}\r\n       \t\t\t}\r\n       \t\t\tif ($vars.OKButton) {\r\n       \t\t\t\tvar ok=true;\r\n       \t\t\t\tfor (var name in this.errors) {\r\n       \t\t\t\t\tok=false;\r\n       \t\t\t\t}\r\n       \t\t\t\t$vars.OKButton.attr(\"disabled\", !ok);\r\n       \t\t\t}\r\n       \t\t},\r\n       \t\ton: {\r\n       \t\t\tvalidate: function () {}\r\n       \t\t},\r\n       \t\taddError: function (name, mesg, jq) {\r\n       \t\t\tthis.errors[name]={mesg:mesg, jq:jq};\r\n       \t\t\tthis.show();\r\n       \t\t},\r\n       \t\tremoveError: function (name) {\r\n       \t\t\tdelete this.errors[name];\r\n       \t\t\tthis.show();\r\n       \t\t},\r\n       \t\tallOK: function () {\r\n       \t\t\tfor (var i in this.errors) {\r\n       \t\t\t\tdelete this.errors[i];\r\n       \t\t\t}\r\n       \t\t\tthis.show();\r\n       \t\t},\r\n       \t\tisValid: function () {\r\n       \t\t    var res=true;\r\n       \t\t    for (var i in this.errors) res=false;\r\n       \t\t    return res;\r\n       \t\t}\r\n        };\r\n        $edits.writeToModel=function ($edit, val ,jq) {\r\n            var m=$edits.model;\r\n        \t//console.log($edit, m);\r\n            if (!m) return;\r\n            var name = $edit.name;\r\n            try {\r\n                val=$edit.type.fromVal(val);\r\n            } catch (e) {\r\n            \t$edits.validator.addError(name, e, jq);\r\n            \t//$edits.validator.errors[name]={mesg:e, jq:jq};\r\n                //$edits.validator.change(name, e, jq);\r\n                return;\r\n            }\r\n            $edits.validator.removeError(name);\r\n            /*\r\n            if ($edits.validator.errors[name]) {\r\n                delete $edits.validator.errors[name];\r\n                $edits.validator.change(name, null, jq);\r\n            }*/\r\n            var a=name.split(\".\");\r\n            for (var i=0 ; i<a.length ;i++) {\r\n                if (i==a.length-1) {\r\n                    if ($edits.on.writeToModel(name,val)) {\r\n\r\n                    } else {\r\n                        m[a[i]]=val;\r\n                    }\r\n                } else {\r\n                    m=m[a[i]];\r\n                }\r\n            }\r\n            $edits.validator.on.validate.call($edits.validator, $edits.model);\r\n        };\r\n        $edits.on={};\r\n        $edits.on.writeToModel= function (name, val) {};\r\n\r\n        if (listeners.length>0) {\r\n            setTimeout(F(l),50);\r\n        }\r\n        function l() {\r\n            listeners.forEach(function (li) {\r\n                li();\r\n            });\r\n            setTimeout(F(l),50);\r\n        }\r\n        return res;\r\n        function parse(expr) {\r\n            if (expr instanceof Array) return parseArray(expr);\r\n            else if (typeof expr==\"string\") return parseString(expr);\r\n            else return expr;\r\n        }\r\n        function parseArray(a) {\r\n            var tag=a[0];\r\n            var i=1;\r\n            var res=$(\"<\"+tag+\">\");\r\n            if (typeof a[i]==\"object\" && !(a[i] instanceof Array) && !(a[i] instanceof $) ) {\r\n                parseAttr(res, a[i],tag);\r\n                i++;\r\n            }\r\n            while (i<a.length) {\r\n                res.append(parse(a[i]));\r\n                i++;\r\n            }\r\n            return res;\r\n        }\r\n        function parseAttr(jq, o, tag) {\r\n            if (o.$var) {\r\n                $vars[o.$var]=jq;\r\n            }\r\n            if (o.$edit) {\r\n                if (typeof o.$edit==\"string\") {\r\n                    o.$edit={name: o.$edit, type: UI.types.String};\r\n                }\r\n                if (!o.on) o.on={};\r\n                o.on.realtimechange=F(function (val) {\r\n                    $edits.writeToModel(o.$edit, val, jq);\r\n                });\r\n                if (!$vars[o.$edit.name]) $vars[o.$edit.name]=jq;\r\n                $edits.push({jq:jq,params:o});\r\n            }\r\n            for (var k in o) {\r\n                if (k==\"on\") {\r\n                    for (var e in o.on) on(e, o.on[e]);\r\n                } else if (k==\"css\" && o[k]!=null) {//ADDJSL\r\n                    jq.css(o[k]);\r\n                } else if (!Util.startsWith(k,\"$\") && o[k]!=null) {//ADDJSL\r\n                    jq.attr(k,o[k]);\r\n                }\r\n            }\r\n            function on(eType, li) {\r\n                if (!li) return; //ADDJSL\r\n                if (eType==\"enterkey\") {\r\n                    jq.on(\"keypress\",F(function (ev) {\r\n                        if (ev.which==13) li.apply(jq,arguments);\r\n                    }));\r\n                } else if (eType==\"realtimechange\") {\r\n                    var first=true, prev;\r\n                    listeners.push(function () {\r\n                        var cur;\r\n                        if (o.type==\"checkbox\") {\r\n                            cur=!!jq.prop(\"checked\");\r\n                        } else {\r\n                            cur=jq.val();\r\n                        }\r\n                        if (first || prev!=cur) {\r\n                            li.apply(jq,[cur,prev]);\r\n                            prev=cur;\r\n                        }\r\n                        first=false;\r\n                    });\r\n                } else {\r\n                    jq.on(eType, F(li));\r\n                }\r\n            }\r\n        }\r\n        function parseString(str) {\r\n            return $(document.createTextNode(str));\r\n            //return $(\"<span>\").text(str);\r\n        }\r\n    };\r\n    UI.types={\r\n       String: {\r\n           toVal: function (val) {\r\n               return val;\r\n           },\r\n           fromVal: function (val) {\r\n               return val;\r\n           }\r\n       },\r\n       Number: {\r\n           toVal: function (val) {\r\n               return val+\"\";\r\n           },\r\n           fromVal: function (val) {\r\n               return parseFloat(val);\r\n           }\r\n       }\r\n   };\r\n    return UI;\r\n});\r\n\ndefine('Wiki',[\"HttpHelper\", \"Arrow\", \"Util\",\"WebSite\",\"Log\",\"UI\",\"FS\"],\r\nfunction (HttpHelper, Arrow, Util, WebSite,Log,UI,FS) {\r\n// MD https://qiita.com/tbpgr/items/989c6badefff69377da7\r\nreturn Wiki=function (placeHolder, home, options, plugins) {\r\n    var W={};\r\n    var refers={figures:\"\", plists: \"\"};\r\n    var SEQ=\"__seq__\";\r\n    var LINEMARK=\"line_marker_\";//+Math.floor(Math.random()*100000);\r\n    var on={};\r\n    var history=[];\r\n    var EXT=\".txt\";\r\n    if (!options) options={};\r\n    if (home && !home.isDir()) throw home+\": not a dir\";\r\n    var cwd,tocFile;\r\n    W.on=on;\r\n    W.cd=function (dir) {\r\n    \tcwd=dir;\r\n    \ttocFile=cwd.rel(\"toc.json\");\r\n    };\r\n    if (home) W.cd(home);\r\n    W.encodeURL=function (name) {\r\n        return encodeURI(name).replace(/%/g,\"\");\r\n    };\r\n    W.parse=function (body,name,file) {\r\n        var ctx={};\r\n        var $h=HttpHelper({lineMark:LINEMARK});\r\n        ctx.out=$h;\r\n        ctx.name=name;\r\n        ctx.lines=body.split(/\\r?\\n/);\r\n        ctx.lineNo=0;\r\n        ctx.ul=0;\r\n        ctx.beginMark=\"[[\";\r\n        ctx.endMark=\"]]\";\r\n        ctx.blocks=[];\r\n        var figInfo=refInfo(\"figures\");\r\n        var plistInfo=refInfo(\"plists\");\r\n        //ctx.figures={};\r\n        //ctx.figseq=1;\r\n        var toc=[];\r\n        if (tocFile && tocFile.exists()) toc=tocFile.obj();\r\n        var idx=toc.indexOf(name);\r\n        if (idx>=0) {\r\n            var navBar=\"\";\r\n            var prev=toc[idx-1];\r\n            if (prev) navBar+=\"[[>\"+prev+\"]]\";\r\n            var next=toc[idx+1];\r\n            if (next) navBar+=\" - [[>\"+next+\"]]\";\r\n            var top=toc[0];\r\n            if (idx!=0) navBar+=\" - [[>\"+top+\"]]\";\r\n            ctx.lines.unshift(navBar);\r\n            ctx.lines.push(navBar);\r\n        }\r\n        ctx.lines.forEach(parseLine);\r\n        function refInfo(type) {// figures / plists\r\n            ctx[type]={};\r\n            var seq=1;\r\n            var res=function (name, register) {\r\n                var fi=ctx[type][name];\r\n                if (!fi) {\r\n                    fi={\r\n                        refs:[]\r\n                    };\r\n                    //console.log(\"reg \"+type+\" \"+name);\r\n                    ctx[type][name]=fi;\r\n                }\r\n                if (register) {\r\n                    fi.no=seq++;\r\n                    fi.name=refers[type]+fi.no;//  / \r\n                    fi.refs.forEach(function (e) {\r\n                        e.text(fi.name);\r\n                    });\r\n                }\r\n                return fi;\r\n            };\r\n            return res;\r\n        }\r\n\r\n        return $h.buf;\r\n        function parseLine(line) {\r\n            $h.lineNo=ctx.lineNo;\r\n            function unul(to) {\r\n                if (to==null) to=0;\r\n                while (ctx.ul>to) {\r\n                    ctx.ul--;\r\n                    $h.exit();//$.p(\"</ul>\");\r\n                }\r\n            }\r\n            var uld=0;\r\n            if (line.match(/^-+/)) {\r\n                /*MD\r\n- 1\r\n    -  1_1\r\n        -  1_1_1\r\n        -  1_1_2\r\n    -  1_2\r\n- 2\r\n- 3\r\n                */\r\n                uld=RegExp.lastMatch.length;\r\n            }\r\n            if (uld>ctx.ul) {\r\n                while(uld>ctx.ul) {\r\n                    ctx.ul++;\r\n                    $h.enter(\"<ul>\");\r\n                }\r\n            } else unul(uld);\r\n            line=line.substring(uld);\r\n            if (uld>0) $h.enter(\"<li>\");\r\n            if (line.match(/^\\*+/)) {// MD  #\r\n                var r=RegExp.rightContext;\r\n                //unul();\r\n                var h=\"h\"+RegExp.lastMatch.length;\r\n                $h.enter(\"<\"+h+\">\");//$.p(\"<\"+h+\">\");\r\n                parseLink(r);\r\n                $h.exit();// $.p(\"</\"+h+\">\\n\");\r\n            } else if (line.match(/^$/)) {\r\n                unul();\r\n                $h.p($(\"<p>\")); //$.p(\"<p>\\n\");\r\n            } else if (line.match(/^<<toc(.*)/)) {\r\n                ctx.toc=[ctx.name];\r\n                ctx.blocks.push({name: \"toc\", exit: function () {\r\n                    if (tocFile && !tocFile.isReadOnly()) tocFile.obj(ctx.toc);\r\n                    ctx.toc=null;\r\n                }});\r\n            } else if (line.match(/^<<code(.*)/)) {\r\n/*\r\nMD 4pre\r\n    # Tab\r\n    class Hoge\r\n        def hoge\r\n            print 'hoge'\r\n        end\r\n    end\r\n*/\r\n                var s=RegExp.$1;\r\n                s=s.replace(/^ */,\"\");\r\n                if (s.length>0) {\r\n                    var ss=s.split(/ /,2);\r\n                    var label, fn;\r\n                    if (ss.length==2) {\r\n                        fn=ss[0];\r\n                        label=ss[1];\r\n                        var pi=plistInfo(label, true);\r\n                        $h.p($(\"<div>\").addClass(\"plist\").text(pi.name+\" \"+fn));\r\n                    } else {\r\n                        $h.p($(\"<div>\").addClass(\"plist\").text(ss));\r\n                    }\r\n                }\r\n                $h.enter(\"<pre>\");\r\n                ctx.blocks.push({name: \"code\", exit: function () {$h.exit();}});\r\n            } else if (line.match(/^>>/)) {\r\n                var b=ctx.blocks.pop();\r\n                if (b && b.exit) b.exit(ctx);\r\n            } else if (line.match(/^@@@@(.*)/)) {\r\n                //unul();\r\n                if (ctx.pclose) $h.exit();//$.p(\"</pre>\");\r\n                else {\r\n                    if (RegExp.$1.length>0) {\r\n                        var pi=plistInfo(RegExp.$1, true);\r\n                        $h.p($(\"<div>\").addClass(\"plist\").text(pi.name));\r\n                    }\r\n                    $h.enter(\"<pre>\");\r\n                }\r\n                ctx.pclose=!ctx.pclose;\r\n            } else {\r\n                //unul();\r\n                parseLink(line);\r\n                $h.p(\"\\n\");\r\n            }\r\n            if (uld>0) $h.exit();\r\n            ctx.lineNo++;\r\n        }\r\n        function parseLink(line) {\r\n            var w=(typeof line==\"string\"?\r\n                    WikiBraces(line, ctx.beginMark,ctx.endMark)\r\n                    : line);\r\n            w.forEach(function (e) {\r\n                if (typeof e==\"string\") {\r\n                    $h.p(e);\r\n                } else {\r\n                    procLink(e);\r\n                }\r\n            });\r\n            function procLink(e) {\r\n                var name=e.text();\r\n                var a;\r\n                if (name.match(/^@blink ([^>]+)>([^\\s]+)/)) {\r\n                    caption=RegExp.$1;\r\n                    var target=RegExp.$2;\r\n                    a=$(\"<span>\").addClass(\"clickable\").text(caption).hover(function () {\r\n                        var a;\r\n                        if (parent && parent.Arrow) a=parent.Arrow;\r\n                        if (Arrow) a=Arrow;\r\n                        if (a) a.show( target );\r\n                    });\r\n                } else if (name.match(/^@plistref (.*)/)) {\r\n                    var label=RegExp.$1;\r\n                    //console.log(\"fi.l =\"+label);\r\n                    var fi=plistInfo(label);\r\n                    //console.log(\"fi = \"+fi.name);\r\n                    a=$(\"<strong>\").text(fi.name);\r\n                    fi.refs.push(a);\r\n                } else if (name.match(/^@editadd/)) {\r\n                    $h.p($(\"<img>\").attr(\"src\",WebSite.top+\"/images/editAdd.png\"));\r\n                } else if (name.match(/^@figref (.*)/)) {\r\n                    var fi=figInfo(RegExp.$1);\r\n                    a=$(\"<strong>\").text(fi.name);\r\n                    fi.refs.push(a);\r\n                } else if (name.match(/^@cfrag (.*)/)) {\r\n                    // MD `code`\r\n                    var code=RegExp.$1\r\n                    a=$(\"<code>\");\r\n                    $h.enter(a);\r\n                    parseLink(code);\r\n                    $h.exit();\r\n                } else if (name.match(/^@arg (.*)/)) {\r\n                    // MD *code*\r\n                    var varn=RegExp.$1\r\n                    a=$(\"<i>\");\r\n                    $h.enter(a);\r\n                    parseLink(varn);\r\n                    $h.exit();\r\n                } else {\r\n                    // MD [](URL)\r\n                    // MD ![](URL \"\")\r\n                    var cn=e.split(\">\",2);\r\n                    if (cn.length==2) {\r\n                        name=cn[1]+\"\";\r\n                        caption=cn[0];\r\n                    } else caption=name;\r\n                    if (ctx.toc) ctx.toc.push(name);\r\n                    if (name.match(/\\.(png|jpg|gif)$/) && !name.match(/^http/)) {\r\n                        var fi=figInfo(name, true);\r\n                        a=$(\"<div>\").addClass(\"figure\").append(\r\n                                  imageHolder(name)\r\n                           );\r\n                        $h.enter(a);\r\n                        $h.enter($(\"<div>\"));\r\n                        $h.p(refers.figures+fi.no+\".\");\r\n                        parseLink(caption); //$h.p(caption);\r\n                        $h.exit();\r\n                        $h.exit();\r\n                    } else {\r\n                    \tif (name.match(/^https?:\\/\\//)) {\r\n                    \t\ta=$(\"<a>\").attr({href:name,target:\"ext\"}).text(caption);\r\n                    \t} else {\r\n                    \t\tvar f=W.resolveFile(name);\r\n                    \t\tif (!f.exists() && (f.isReadOnly() || !options.editMode)) {\r\n                    \t\t\ta=$(\"<span>\").text(caption);\r\n                    \t\t} else {\r\n                    \t\t    if (options.useAnchor) {\r\n                    \t\t       // a=$(\"<a>\").attr({href:\"wiki.html?file=\"+f.path()}).text(caption);\r\n                    \t\t        var ahref=f.relPath(file.up()).replace(/\\.txt$/,\".html\");\r\n                                    ahref=W.encodeURL(ahref);// encodeURI(ahref).replace(/%/g,\"_\");\r\n                                    a=$(\"<a>\").attr({href:ahref}).text(caption);\r\n                                    //a=$(\"<a>\").attr({href:\"?file=\"+f.path()}).text(caption);\r\n                    \t\t    } else {\r\n                                    a=$(\"<span>\").addClass(\"clickable\").text(caption).click(function () {\r\n                                        W.show(f);\r\n                                    });\r\n                    \t\t    }\r\n                    \t\t\tif (!f.exists()) a.addClass(\"notexist\");\r\n                    \t\t}\r\n                    \t}\r\n                    }\r\n                }\r\n                $h.p(a);\r\n            }\r\n        }\r\n    };\r\n    function imageHolder(name) {\r\n        var res,imfile;\r\n        if (W.builtinImages[name]) {\r\n            return $(\"<div>\").append( $(\"<img>\").attr(\"src\", WebSite.top+\"/doc/images/\"+name) );\r\n        } else {\r\n            res=UI(\"div\", {style:\"margin:10px; padding:10px; border:solid black 1px;\",\r\n                on:{dragover: s, dragenter: s, drop:dropAdd}},\r\n                    \"(png/gif/jpg)\"\r\n            );\r\n            var thome=FS.get(WebSite.tonyuHome);\r\n            imfile=thome.rel(\"doc/images/\").rel(name);\r\n            if (imfile.exists()) {\r\n                res.empty().append(UI(\"img\",{src:imfile.text() }));\r\n            }\r\n            return res;\r\n        }\r\n        function s(e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n        }\r\n        function dropAdd(e) {\r\n            if (!options.editMode) return;\r\n            var eo=e.originalEvent;\r\n            var file = eo.dataTransfer.files[0];\r\n            if(!file.type.match(/image\\/(png|gif|jpg)/)[1]) {\r\n                e.stopPropagation();\r\n                e.preventDefault();\r\n                return false;\r\n            }\r\n            var reader = new FileReader();\r\n            reader.onload = function(e) {\r\n                var fileContent = reader.result;\r\n                imfile.text(fileContent);\r\n                res.empty().append(UI(\"img\",{src:fileContent}));\r\n            };\r\n            reader.readAsDataURL(file);\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            return false;\r\n        }\r\n    }\r\n    W.resolveFile=function (name) {\r\n        var f;\r\n        if (name.isDir) f=name;\r\n        else if (cwd && name.substring(0,1)!=\"/\") f=cwd.rel(name+EXT);\r\n        else f=FS.get(name);\r\n        return f;\r\n    };\r\n    W.show=function (nameOrFile) {\r\n        var f=W.resolveFile(nameOrFile);\r\n        if (!options.editMode) Log.d(\"wiki\",\"show \"+f);\r\n    \tW.cd(f.up());\r\n\t\tvar fn=f.truncExt(EXT);\r\n    \tif (!f.exists() && !f.isReadOnly() && options.editMode) {\r\n    \t\tvar p=history[history.length-1];\r\n    \t\tif (p) f.text(\"[[\"+p.truncExt(EXT)+\"]]\\n\");\r\n    \t\telse f.text(\"\");\r\n    \t}\r\n    \tif ( f.exists()) {\r\n    \t\tvar ht=W.parse(f.text(), fn, f);\r\n    \t\tplaceHolder.empty();\r\n    \t\tplaceHolder.scrollTop(0);\r\n    \t\tplaceHolder.append(ht);\r\n    \t\tplaceHolder.append($(\"<div>\").css({height:\"100px\"}).text(\"\"));\r\n    \t\t//console.log(\"wikijs.on.show\",f+\"\");\r\n    \t\tif (on.show) on.show.apply(W, [f,fn]);\r\n    \t\thistory.push(f);\r\n    \t} else {\r\n    \t\talert(nameOrFile+\" \");\r\n    \t\t//placeHolder.text(name+\" not found.\");\r\n    \t}\r\n    \treturn;\r\n    };\r\n    W.back=function () {\r\n        var f=history.pop();\r\n        if (f) show(f);\r\n    };\r\n    var curLined;\r\n    W.highlightLine=function (row) { // row:0 origin\r\n        var e=$(\"#\"+LINEMARK+\"-\"+row);\r\n        if (e.length==0) return;\r\n        if (curLined) {\r\n            curLined.removeClass(\"wiki-cur-line\");\r\n        }\r\n        curLined=e.next();\r\n        curLined.addClass(\"wiki-cur-line\");\r\n        var t=e.position().top;\r\n        var area=placeHolder;\r\n        if (t<0) {\r\n            area.scrollTop(area.scrollTop()+(t-10)/2);\r\n        }\r\n        var h=area.height()-100;\r\n        if (t>h) {\r\n            area.scrollTop(area.scrollTop()+(t-h+10)/2);\r\n        }\r\n        function mark(startElem) {\r\n            var e=startElem.next();\r\n            while (e.length>0) {\r\n                if (Util.startsWith( e.attr(\"id\"), LINEMARK)) break;\r\n\r\n            }\r\n        }\r\n    };\r\n    W.builtinImages={\r\n            \"50_100.png\":1,\r\n            \"50_160.png\":1,\r\n            \"50_300.png\":1,\r\n            \"apple1apple2.png\":1,\r\n            \"coords.png\":1,\r\n            \"copy60_100.png\":1,\r\n            \"firstRunRes.png\":1,\r\n            \"firstVarRes.png\":1,\r\n            \"itadaki.png\":1,\r\n            \"noWaitCat.png\":1,\r\n            \"runtimeError.png\":1,\r\n            \"sample.png\":1,\r\n            \"sayonara.png\":1,\r\n            \"syntaxError.png\":1\r\n    };\r\n    return W;\r\n    function WikiBraces(str, begin ,end) {\r\n        var c=0;\r\n        function init() {\r\n            var w=[];\r\n            while(true) {\r\n                var i=str.indexOf(begin,c);\r\n                var j=str.indexOf(end,c);\r\n                if (j>=0 && (i<0 || i>j)) {  // ]]\r\n                    w.push(str.substring(c,j));\r\n                    c=j;  // ]] \r\n                    break;\r\n                }\r\n                if (i<0) {  // [[ ]] \r\n                    w.push(str.substring(c));\r\n                    c=str.length;\r\n                    break;\r\n                }\r\n                // [[\r\n                w.push(str.substring(c,i));\r\n                c=i+begin.length;\r\n                var we=init();\r\n                we.hasBrace=true;\r\n                if (c<str.length) {  // ]] \r\n                    c+=end.length;\r\n                }\r\n                w.push(we);\r\n            }\r\n            bless(w);\r\n            return w;\r\n        }\r\n        function bless(w) {\r\n            w.split=function (sp, lim) {\r\n                if (lim==1) return this;\r\n                var res=[], cur=bless([]);\r\n                this.forEach(function (e) {\r\n                    if (typeof e==\"string\") {\r\n                        var i =e.indexOf(sp);\r\n                        if (res.length>=lim) i=-1;\r\n                        if (i>=0) {  //  ,bbb   aaa,bbb\r\n                            if (i>0) {  //   aaa,bbb\r\n                                var s=e.substring(0,i); // aaa\r\n                                cur.push(s);\r\n                            }\r\n                            i+=sp.length;   //  bbb  bbb\r\n                            if (cur.length!=1) res.push(cur);\r\n                            else res.push(cur[0]);\r\n                            cur=bless([]);\r\n                            if (i<e.length) {  // ,bbb\r\n                                var s=e.substring(i) ;\r\n                                cur.push(s);\r\n                            }\r\n                        } else {  //aaabbb\r\n                            cur.push(e);\r\n                        }\r\n                    } else {\r\n                        cur.push(e);\r\n                    }\r\n                });\r\n                if (cur.length!=1) res.push(cur);\r\n                else res.push(cur[0]);\r\n                return res;\r\n            };\r\n            w.text=function (includeBrace) {\r\n               var res=(this.hasBrace && includeBrace ? begin :\"\");\r\n               this.forEach(function (e) {\r\n                   if (typeof e==\"string\") {\r\n                       res+=e;\r\n                   } else {\r\n                       res+=e.text(true);\r\n                   }\r\n               });\r\n               res+=(this.hasBrace && includeBrace ? end :\"\");\r\n               return res;\r\n            };\r\n            w.toString=function () {\r\n                return this.text(true);\r\n            };\r\n            return w;\r\n        }\r\n        return init(0);\r\n    };\r\n};\r\n});\r\n\ndefine('Shell2',[\"Shell\",\"UI\",\"FS\",\"Util\"], function (sh,UI,FS,Util) {\r\n    var res={};\r\n    res.show=function (dir) {\r\n        var d=res.embed(dir);\r\n        d.dialog({width:600,height:500});\r\n    };\r\n    res.embed=function (dir) {\r\n        if (!res.d) {\r\n            res.d=UI(\"div\",{title:\"Shell\"},[\"div\",{$var:\"inner\"},\"Type 'help' to show commands.\",[\"br\"]]);\r\n            res.inner=res.d.$vars.inner;\r\n            sh.prompt();\r\n        }\r\n        var d=res.d;\r\n        return d;\r\n    };\r\n    sh.cls=function () {\r\n        res.d.$vars.inner.empty();\r\n    };\r\n    sh.prompt=function () {\r\n        var line=UI(\"div\",\r\n            [\"input\",{$var:\"cmd\",size:40,on:{keydown: kd}}],\r\n            [\"pre\",{$var:\"out\",\"class\":\"shell out\"},[\"div\",{$var:\"cand\",\"class\":\"shell cand\"}]]\r\n        );\r\n        var cmd=line.$vars.cmd;\r\n        var out=line.$vars.out;\r\n        var cand=line.$vars.cand;\r\n        sh.setout({log:function () {\r\n            return $.when.apply($,arguments).then(function () {\r\n                var a=[];\r\n                for (var i=0; i<arguments.length; i++) {\r\n                    a.push(arguments[i]);\r\n                }\r\n                if (a[0] instanceof $) {\r\n                    out.append(a[0]);\r\n                } else {\r\n                    out.append(UI(\"span\",a.join(\" \")+\"\\n\"));\r\n                }\r\n            });\r\n        },err:function (e) {\r\n            out.append(UI(\"div\",{\"class\": \"shell error\"},e,[\"br\"],[\"pre\",e.stack]));\r\n        }});\r\n        line.appendTo(res.inner);\r\n        cmd.focus();\r\n        res.inner.closest(\".ui-dialog-content\").scrollTop(res.inner.height());\r\n        return sh.ASYNC;\r\n        function kd(e) {\r\n            //var eo=e.originalEvent();\r\n            //console.log(e.which);\r\n            if (e.which==9) {\r\n                e.stopPropagation();\r\n                e.preventDefault();\r\n                comp();\r\n                return false;\r\n            }\r\n            if (e.which==13) {\r\n                cand.empty();\r\n                exec(cmd.val());\r\n            }\r\n        }\r\n        function exec() {\r\n            var c=cmd.val().replace(/^ */,\"\").replace(/ *$/,\"\");\r\n            if (c.length==0) return;\r\n            var cs=c.split(/ +/);\r\n            var cn=cs.shift();\r\n            var f=sh[cn];\r\n            if (typeof f!=\"function\") return out.append(cn+\": command not found.\");\r\n            try {\r\n                var args=[],options=null;\r\n                cs.forEach(function (ce) {\r\n                    var opt=/^-([A-Za-z_0-9]+)(=(.*))?/.exec(ce);\r\n                    if (opt) {\r\n                        if (!options) options={};\r\n                        options[opt[1]]=opt[3]!=null ? opt[3] : 1;\r\n                    } else {\r\n                        if (options) args.push(options);\r\n                        options=null;\r\n                        args.push(ce);\r\n                    }\r\n                });\r\n                if (options) args.push(options);\r\n                var sres=f.apply(sh, args);\r\n                if (sres===sh.ASYNC) return;\r\n                if (typeof sres==\"object\") {\r\n                    if (sres instanceof Array) {\r\n                        var table=UI(\"table\");\r\n                        var tr=null;\r\n                        var cnt=0;\r\n                        sres.forEach(function (r) {\r\n                            if (!tr) tr=UI(\"tr\").appendTo(table);\r\n                            tr.append(UI(\"td\",r));\r\n                            cnt++;if(cnt%3==0) tr=null;\r\n                        });\r\n                        table.appendTo(out);\r\n                    } else {\r\n                        out.append(JSON.stringify(sres));\r\n                    }\r\n                } else {\r\n                    out.append(sres);\r\n                }\r\n                sh.prompt();\r\n            } catch(e) {\r\n                sh.err(e);\r\n                //out.append(UI(\"div\",{\"class\": \"shell error\"},e,[\"br\"],[\"pre\",e.stack]));\r\n                sh.prompt();\r\n            }\r\n        }\r\n        function comp(){\r\n            var c=cmd.val();\r\n            var cs=c.split(\" \");\r\n            var fn=cs.pop();\r\n            var canda=[];\r\n            if (cs.length==0) {\r\n                for (var k in sh) {\r\n                    if (typeof sh[k]==\"function\" && Util.startsWith(k, fn)) {\r\n                        canda.push(k);\r\n                    }\r\n                }\r\n            } else {\r\n                var f=sh.resolve(fn,false);\r\n                //console.log(fn,f);\r\n                if (!f) return;\r\n                var d=(f.isDir() ? f : f.up());\r\n                d.each(function (e) {\r\n                    if ( Util.startsWith(e.path(), f.path()) ) {\r\n                        canda.push(e.name());\r\n                    }\r\n                });\r\n            }\r\n            if (canda.length==1) {\r\n                var fns=fn.split(\"/\");\r\n                fns.pop();\r\n                fns.push(canda[0]);\r\n                cs.push(fns.join(\"/\"));\r\n                cmd.val(cs.join(\" \"));\r\n                cand.empty();\r\n            } else {\r\n                cand.text(canda.join(\", \"));\r\n            }\r\n            //console.log(canda);\r\n            //cmd.val(cmd.val()+\"hokan\");\r\n        }\r\n    };\r\n    sh.window=function () {\r\n        res.show(sh.cwd);\r\n    };\r\n    sh.atest=function (a,b,options) {\r\n        console.log(a,b,options);\r\n    };\r\n    var oldcat=sh.cat;\r\n    sh.cat=function (file,options) {\r\n        file=sh.resolve(file, true);\r\n        if (file.contentType().match(/^image\\//)) {\r\n            return file.getContent(function (c) {\r\n                sh.echo(UI(\"img\",{src:c.toURL()}));\r\n            });\r\n        } else {\r\n            return oldcat.apply(sh,arguments);\r\n        }\r\n    };\r\n    return res;\r\n});\ndefine('NewProjectDialog',[\"UI\"], function (UI) {\r\n    var res={};\r\n\tres.show=function (prjDir, onOK,options) {\r\n    \tvar d=res.embed(prjDir,onOK,options);\r\n    \td.dialog({width:600});\r\n\t};\r\n\tres.embed=function (prjDir, onOK, options) {\r\n        res.onOK=onOK;\r\n\t    if (!options) options={};\r\n        if (!res.d) {\r\n            var FType={\r\n                    fromVal: function (val){\r\n                        return val==\"\" ? null : FS.get(val);\r\n                    },\r\n                    toVal: function (v){ return v ? v.path() : \"\";}\r\n            };\r\n        \tres.d=UI(\"div\",{title:(options.ren?\"\":\"\")},\r\n        \t\t\t[\"div\",\r\n        \t\t\t [\"span\",\"\"],\r\n        \t\t\t [\"input\",{$edit:\"name\",value:options.defName||\"\",\r\n        \t\t\t     on:{enterkey:function () {\r\n                \t\t     res.d.done();\r\n\t\t\t\t }}}]],\r\n         \t\t\t[\"div\",\r\n        \t\t\t [\"span\",\"\"],\r\n        \t\t\t [\"input\",{$edit:{name:\"parentDir\",type:FType}}]],\r\n        \t\t\t [\"div\",\r\n        \t\t\t   [\"span\",\"\"],\r\n        \t\t\t   [\"span\",{$var:\"dstDir\"}]\r\n        \t\t\t  ],\r\n                 [\"div\", {$var:\"validationMessage\", css:{color:\"red\"}}],\r\n                 [\"button\", {$var:\"OKButton\", on:{click: function () {\r\n                \t res.d.done();\r\n                 }}}, \"OK\"]\r\n            );\r\n        }\r\n        var d=res.d;\r\n        var model={name:options.defName||\"\", parentDir:prjDir};\r\n        d.$edits.load(model);\r\n    \td.$edits.validator.on.validate=function (model) {\r\n    \t\tif (model.name==\"\") {\r\n    \t\t\tthis.addError(\"name\",\"\");\r\n    \t\t\treturn;\r\n    \t\t}\r\n    \t\tmodel.dstDir=model.parentDir.rel(model.name+\"/\");\r\n            if (model.dstDir.exists()) {\r\n                this.addError(\"name\",\"\");\r\n                return;\r\n            }\r\n    \t\tthis.allOK();\r\n    \t\td.$vars.dstDir.text(model.dstDir+\"\");\r\n    \t};\r\n    \td.done=function () {\r\n    \t    if (d.$edits.validator.isValid()) {\r\n                res.onOK(model.dstDir);\r\n                if ($.data(d[0],\"ui-dialog\")) d.dialog(\"close\");// not exists when embed\r\n    \t    }\r\n    \t};\r\n    \treturn d;\r\n    };\r\n    return res;\r\n});\r\n\ndefine('requestFragment',[\"WebSite\"],function (WebSite) {\r\n    var FR={};\r\n    FR.ajax=function (options) {\r\n        var THRESH=options.THRESH || 1000*800;\r\n        var d=options.data;\r\n        if (typeof d!=\"object\") throw \"Data should be object: \"+d;\r\n        d=JSON.stringify(d);\r\n        if (!options.redirectTo && (WebSite.serverType!=\"GAE\" || d.length<THRESH)) return $.ajax(options);\r\n        var frags=[];\r\n        var cnt=0;\r\n        var id=Math.random();\r\n        while (d.length>0) {\r\n            frags.push(d.substring(0,THRESH));\r\n            d=d.substring(THRESH);\r\n\r\n        }\r\n        var len=frags.length;\r\n        var sent=0;\r\n        var waitTime=1000;\r\n        function addRedir(p) {\r\n            if (options.redirectTo) p.redirectTo=options.redirectTo;\r\n            return p;\r\n        }\r\n        frags.forEach(function (frag,i) {\r\n          //TODO: urlchange!\r\n            $.ajax({type:\"post\",url:WebSite.serverTop+\"/sendFragment\",data:addRedir({\r\n                id:id, seq:i, len:len, content:frag\r\n            }),success: function (res) {\r\n                console.log(\"sendFrag\",res,i);//,frag);\r\n                sent++;\r\n                if (sent>=len) setTimeout(runFrag,waitTime);\r\n            }, error: options.error\r\n            });\r\n        });\r\n        function runFrag() {\r\n          //TODO: urlchange!\r\n            $.ajax({type:\"post\",url:WebSite.serverTop+\"/runFragments\",data:addRedir({id:id}),\r\n                success: function (res) {\r\n                    //console.log(\"runFrag res1=\",res,arguments.length);\r\n                    if (typeof res==\"string\") {\r\n                        if (res.match(/^notCompleted:([\\-\\d]+)\\/([\\-\\d]+)$/)) {\r\n                            console.log(\"notcomp\",res);\r\n                            waitTime*=2;\r\n                            setTimeout(runFrag,waitTime);\r\n                            return;\r\n                        }\r\n                    }\r\n                    options.success(res);\r\n                },\r\n                error: options.error,\r\n                complete: options.complete\r\n            });\r\n        }\r\n\r\n    };\r\n\r\n    return FR;\r\n});\ndefine('Sync',[\"FS\",\"Shell\",\"requestFragment\",\"WebSite\"],function (FS,sh,rf,WebSite) {\r\n    var Sync={};\r\n    sh.sync=function () {\r\n        // sync options:o onend:f     local=remote=cwd\r\n        // sync dir:s|file options:o onend:f  local=remote=dir\r\n        // sync local:s|file remote:s|file options:o onend:f\r\n        var local,remote,options,onend=function(){};\r\n        var i=0;\r\n        if (typeof arguments[i]==\"string\" || isFile(arguments[i])) {\r\n            local=sh.resolve(arguments[i], true);\r\n            i++;\r\n            if (typeof arguments[i]==\"string\" || isFile(arguments[i])) {\r\n                remote=sh.resolve(arguments[i], false);\r\n                i++;\r\n            }\r\n        }\r\n        if (typeof arguments[i]==\"object\") { options=arguments[i]; i++;}\r\n        if (typeof arguments[i]==\"function\") { onend=arguments[i]; i++;}\r\n        if (!local) remote=local=sh.cwd;\r\n        if (options && options.onend) options.onend=promptAfter(options.onend);\r\n        if (!remote) remote=local;\r\n        sh.echo(\"sync args=\",local,remote,options,onend);\r\n        Sync.sync(local,remote,options,promptAfter(onend));\r\n        return sh.ASYNC;\r\n        function promptAfter(f) {\r\n            return function () {\r\n                //alert(\"pro\");\r\n                if (f) f.apply({},arguments);\r\n                sh.prompt();\r\n            };\r\n        }\r\n    };\r\n    function isFile(v) {\r\n        return v && v.isDir;\r\n    }\r\n    Sync.sync=function () {\r\n        // sync dir:file options:o onend:f  local=remote=dir\r\n        // sync local:file remote:file options:o onend:f\r\n        var local,remote,options,onend;\r\n        var i=0;\r\n        if (isFile(arguments[i])) {\r\n            local=arguments[i];\r\n            i++;\r\n            if (isFile(arguments[i])) {\r\n                remote=arguments[i];\r\n                i++;\r\n            }\r\n        }\r\n        if (typeof arguments[i]==\"object\") { options=arguments[i]; i++;}\r\n        if (typeof arguments[i]==\"function\") { onend=arguments[i]; i++;}\r\n\r\n        if (!local) throw \"Sync.sync: Local dir must be specified as file object\";\r\n        if (!remote) remote=local;\r\n        if (!options) options={};\r\n        if (!onend && options.onend) onend=options.onend;\r\n        if (options.test) options.v=1;\r\n        n0();\r\n        var uploads={},downloads=[],visited={};\r\n        function status(name, param) {\r\n            sh.echo(\"Status: \"+name+\" param:\",param);\r\n            if (options.onstatus) {\r\n                options.onstatus(name, param);\r\n            }\r\n        }\r\n        function onError() {\r\n            if (options.onerror) {\r\n                options.onerror.apply(this, arguments);\r\n            }\r\n        }\r\n        function n0() {\r\n            var req={base:remote.path(),excludes:JSON.stringify(options.excludes)};\r\n            status(\"getDirInfo\", req);\r\n          //TODO: urlchange!\r\n            $.ajax({\r\n                type:\"get\",\r\n                url:WebSite.serverTop+\"/getDirInfo\",\r\n                data:req,\r\n                success:n1,\r\n                error:onError\r\n            });\r\n        }\r\n        function n1(info) {\r\n            //info=JSON.parse(info);\r\n            if (options.v) sh.echo(\"getDirInfo\",info);\r\n            var base=local;//FS.get(info.base);\r\n            var data=info.data;\r\n            for (var rel in data) {\r\n                var file=base.rel(rel);\r\n                var lcm=file.exists({includeTrashed:true}) && file.metaInfo();\r\n                var rmm=data[rel];\r\n                cmp(file,rel,lcm,rmm);\r\n            }\r\n            local.recursive(function (file) {\r\n                var lcm=file.exists({includeTrashed:true}) && file.metaInfo();\r\n                var rel=file.relPath(local);\r\n                var rmm=data[rel];\r\n                cmp(file,rel,lcm,rmm);\r\n            },{includeTrashed:true, excludes:options.excludes});\r\n            if (options.v) {\r\n                sh.echo(\"uploads:\",uploads);\r\n                sh.echo(\"downloads:\",downloads);\r\n            }\r\n\r\n            var req={base:remote.path(),paths:JSON.stringify(downloads)};\r\n            status(\"File2LSSync\", req);\r\n          //TODO: urlchange!\r\n            $.ajax({\r\n                type:\"post\",\r\n                url:WebSite.serverTop+\"/File2LSSync\",\r\n                data:req,\r\n                success:n2,\r\n                error:onError\r\n            });\r\n        }\r\n        function n2(dlData) {\r\n            sh.echo(\"dlData=\",dlData);\r\n            //dlData=JSON.parse(dlData);\r\n            if (options.v) sh.echo(\"dlData:\",dlData);\r\n            var base=local;//FS.get(dlData.base);\r\n            if (options.test) return;\r\n            for (var rel in dlData.data) {\r\n                var dlf=base.rel(rel);\r\n                var d=dlData.data[rel];\r\n                //if (options.v) sh.echo(dlf.path(), d);\r\n                if (d.trashed) {\r\n                    if (dlf.exists()) dlf.rm();\r\n                } else {\r\n                    dlf.text(d.text);\r\n                }\r\n                delete d.text;\r\n                dlf.metaInfo(d);\r\n            }\r\n            var req={base:remote.path(),data:JSON.stringify(uploads)};\r\n            req.pathInfo=\"/LS2FileSync\";//TODO: urlchange!\r\n            status(\"LS2FileSync\", req);\r\n          //TODO: urlchange!\r\n            rf.ajax({\r\n                type:\"post\",\r\n                url:WebSite.serverTop+\"/LS2FileSync\",\r\n                data:req,\r\n                success:n3,\r\n                error:onError\r\n            });\r\n        }\r\n        function n3(res){\r\n            if (options.v) sh.echo(\"LS2FileSync res=\",res);\r\n            var upds=[];\r\n            for (var i in uploads) upds.push(i);\r\n            res={msg:res,uploads:upds,downloads: downloads};\r\n            //if (options.v) sh.echo(\"onend\",onend);\r\n            if (typeof onend==\"function\") onend(res);\r\n        }\r\n        function cmp(f,rel,lcm,rmm) {// f:localFile\r\n            if (visited[rel]) return ;\r\n            visited[rel]=1;\r\n            if (rmm && (!lcm || lcm.lastUpdate<rmm.lastUpdate)) {\r\n                downloads.push(rel);\r\n                if (options.v)\r\n                    sh.echo((!lcm?\"New\":\"\")+\r\n                            \"Download \"+f+\r\n                            \" trash=\"+!!rmm.trashed);\r\n            } else if (lcm && (!rmm || lcm.lastUpdate>rmm.lastUpdate)) {\r\n                var o=lcm.trashed ? {} : {text:f.text()};\r\n                var m=f.metaInfo();\r\n                for (var i in m) o[i]=m[i];\r\n                uploads[rel]=o;\r\n                if (options.v)\r\n                    sh.echo((!rmm?\"New\":\"\")+\r\n                            \"Upload \"+f+\r\n                            \" trash=\"+!!lcm.trashed);\r\n            }\r\n\r\n        }\r\n    };\r\n    sh.rsh=function () {\r\n        var a=[];\r\n        for (var i=0; i<arguments.length; i++) a[i]=arguments[i];\r\n      //TODO: urlchange!\r\n        $.ajax({\r\n            url:WebSite.serverTop+\"/rsh\",\r\n            data:{args:JSON.stringify(a)},\r\n            success:function (r) {\r\n                sh.echo(r);\r\n            },error:function (req,e,mesg) {\r\n                sh.err(mesg);\r\n            },complete:function (){\r\n                sh.prompt();\r\n            }\r\n        });\r\n        return sh.ASYNC;\r\n    };\r\n    return Sync;\r\n});\r\n\ndefine('Auth',[\"WebSite\"],function (WebSite) {\r\n    var auth={};\r\n    auth.currentUser=function (onend) {\r\n        //TODO: urlchange!\r\n        $.ajax({type:\"get\",url:WebSite.serverTop+\"/currentUser\",data:{withCsrfToken:true},\r\n            success:function (res) {\r\n                console.log(\"auth.currentUser\",res);\r\n                res=JSON.parse(res);\r\n                var u=res.user;\r\n                if (u==\"null\") u=null;\r\n                console.log(\"user\", u, \"csrfToken\",res.csrfToken);\r\n                onend(u,res.csrfToken);\r\n            }\r\n        });\r\n    };\r\n    auth.assertLogin=function (options) {\r\n        /*if (typeof options==\"function\") options={complete:options};\r\n        if (!options.confirm) options.confirm=\"\";\r\n        if (typeof options.confirm==\"string\") {\r\n            var mesg=options.confirm;\r\n            options.confirm=function () {\r\n                return confirm(mesg);\r\n            };\r\n        }*/\r\n        auth.currentUser(function (user,csrfToken) {\r\n            if (user) {\r\n                return options.success(user,csrfToken);\r\n            }\r\n            window.onLoggedIn=options.success;\r\n            //TODO: urlchange!\r\n            options.showLoginLink(WebSite.serverTop+\"/login\");\r\n        });\r\n    };\r\n    window.Auth=auth;\r\n    return auth;\r\n});\ndefine('zip',[\"FS\"],function (FS){return FS.zip;});\r\n\ndefine('PathUtil',[\"FS\"],function (FS){return FS.PathUtil;});\r\n\ndefine('extLink',[\"WebSite\",\"UI\",\"PathUtil\",\"Util\",\"assert\"],\r\n        function (WebSite,UI,PathUtil,Util,assert) {\r\n    var exec = (WebSite.isNW? require('child_process').exec : function (){});\r\n    function extLink(href,caption,options) {\r\n        options=options||{};\r\n        var opt=getOpt(href,options);\r\n        //for (var k in options) opt[k]=options[k];\r\n        return UI(\"a\",opt,caption);\r\n    };\r\n    function getOpt(href,options) {\r\n        var p=WebSite.platform;\r\n        options=options||{};\r\n        options.on=options.on||{};\r\n        var afterClick=(options.on && options.on.click) || function(){};\r\n        if (p==\"win32\") {\r\n            options.href=\"javascript:;\";\r\n            options.on.click=ext(\"start\",href,afterClick);\r\n        } else if (p==\"darwin\") {\r\n            options.href=\"javascript:;\";\r\n            options.on.click=ext(\"open\",href,afterClick);\r\n        } else {\r\n            options.href=href;\r\n            options.on.click=afterClick;\r\n            options.target=\"_new\";\r\n        }\r\n        return options;\r\n    }\r\n    function ext(cmd, href,afterClick) {\r\n        return function () {\r\n            exec(cmd+\" \"+href);\r\n            if (afterClick) afterClick();\r\n        };\r\n    }\r\n    extLink.all=function () {\r\n        if (!WebSite.isNW) return;\r\n        $(\"a\").each(function () {\r\n            var head=location.protocol+\"//\"+location.host+\"/\";\r\n            var a=$(this);\r\n            var href=a.attr(\"href\");\r\n            //console.log(\"href\",href);\r\n            if (href.match(/^http/) ) {\r\n                var opt=assert.is( getOpt(href),\r\n                        {href:String,on:{click:Function}} );\r\n                a.attr(\"href\",opt.href);\r\n                a.click(opt.on.click);\r\n            }\r\n        });\r\n    };\r\n    return extLink;\r\n});\r\n\ndefine('DeferredUtil',[\"FS\"],function (FS){return FS.DeferredUtil;});\r\n\ndefine('Klass',[\"assert\"],function (A) {\r\n    var Klass={};\r\n    Klass.define=function (pd) {\r\n        var p,parent;\r\n        if (pd.$parent) {\r\n            parent=pd.$parent;\r\n            p=Object.create(parent.prototype);\r\n            p.super=function () {\r\n                var a=Array.prototype.slice.call(arguments);\r\n                var n=a.shift();\r\n                return parent.prototype[n].apply(this,a);\r\n            };\r\n        } else {\r\n            p={};\r\n        }\r\n        var thisName,singletonName;\r\n        if (pd.$this) {\r\n            thisName=pd.$this;\r\n        }\r\n        if (pd.$singleton) {\r\n            singletonName=pd.$singleton;\r\n        }\r\n        var init=wrap(pd.$) || function (e) {\r\n            if (e && typeof e==\"object\") {\r\n                for (var k in e) {\r\n                    this[k]=e[k];\r\n                }\r\n            }\r\n        };\r\n        var fldinit;\r\n        var warn,wrapped,wrapCancelled;\r\n        //var check;\r\n        if (init instanceof Array) {\r\n            fldinit=init;\r\n            init=function () {\r\n                var a=Array.prototype.slice.call(arguments);\r\n                for (var i=0;i<fldinit.length;i++) {\r\n                    if (a.length>0) this[fldinit[i]]=a.shift();\r\n                }\r\n            };\r\n        }\r\n        var klass;\r\n        function checkSchema(self) {\r\n            if (pd.$fields) {\r\n                //console.log(\"Checking schema\",self,pd.$fields);\r\n                A.is(self,pd.$fields);\r\n            }\r\n        }\r\n        klass=function () {\r\n            if (! (this instanceof klass)) {\r\n                var res=Object.create(p);\r\n                init.apply(res,arguments);\r\n                checkSchema(res);\r\n                return res;\r\n            }\r\n            init.apply(this,arguments);\r\n            checkSchema(this);\r\n        };\r\n        if (parent) {\r\n            klass.super=function () {\r\n                var a=Array.prototype.slice.call(arguments);\r\n                var t=a.shift();\r\n                var n=a.shift();\r\n                return parent.prototype[n].apply(t,a);\r\n            };\r\n        }\r\n        klass.inherit=function (pd) {\r\n            pd.$parent=klass;\r\n            return Klass.define(pd);\r\n        };\r\n        klass.prototype=p;\r\n        for (var name in pd) {\r\n            if (name[0]==\"$\") continue;\r\n            if (name.substring(0,7)==\"static$\") {\r\n                klass[name.substring(7)]=wrapStatic(pd[name]);\r\n            } else {\r\n                if (isPropDesc(pd[name])) {\r\n                    Object.defineProperty(p,name,wrap(pd[name]));\r\n                } else {\r\n                    p[name]=wrap(pd[name]);\r\n                }\r\n            }\r\n        }\r\n        function wrapStatic(m) {\r\n            if (!singletonName) return m;\r\n            var args=getArgs(m);\r\n            if (args[0]!==singletonName) return m;\r\n            return (function () {\r\n                var a=Array.prototype.slice.call(arguments);\r\n                a.unshift(klass);\r\n                return m.apply(klass,a);\r\n            });\r\n        }\r\n        function wrap(m) {\r\n            if (!thisName) return m;\r\n            if (isPropDesc(m)) {\r\n                for (var k in m) {\r\n                    m[k]=wrap(m[k]);\r\n                }\r\n                return m;\r\n            }\r\n            if (typeof m!==\"function\") return m;\r\n            if (thisName!==true) {\r\n                var args=getArgs(m);\r\n                if (args[0]!==thisName) {\r\n                    wrapCancelled=true;\r\n                    return m;\r\n                }\r\n                warn=true;\r\n            }\r\n            wrapped=true;\r\n            return (function () {\r\n                var a=Array.prototype.slice.call(arguments);\r\n                a.unshift(this);\r\n                return m.apply(this,a);\r\n            });\r\n        }\r\n        p.$=init;\r\n        Object.defineProperty(p,\"$bind\",{\r\n            get: function () {\r\n                if (!this.__bounded) {\r\n                    this.__bounded=new Klass.Binder(this);\r\n                }\r\n                return this.__bounded;\r\n            }\r\n        });\r\n        if (warn) {\r\n            //console.warn(\"This declaration style may malfunction when minified\");\r\n            if (!wrapCancelled) {\r\n                console.warn(\"Use $this:true instead\");\r\n            } else {\r\n                console.warn(\"Use python style in all methods and Use $this:true instead\");\r\n            }\r\n            try{throw new Error(\"Trace\");}\r\n            catch(e) {console.log(e.stack);}\r\n        }\r\n        return klass;\r\n    };\r\n    function getArgs(f) {\r\n        var fpat=/function[^\\(]*\\(([^\\)]*)\\)/;\r\n        var r=fpat.exec(f+\"\");\r\n        if (r) {\r\n            return r[1].replace(/\\s/g,\"\").split(\",\");\r\n        }\r\n        return [];\r\n    }\r\n    function isPropDesc(o) {\r\n        if (typeof o!==\"object\") return false;\r\n        if (!o) return false;\r\n        var pk={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1};\r\n        var c=0;\r\n        for (var k in o) {\r\n            if (!pk[k]) return false;\r\n            c+=pk[k];\r\n        }\r\n        return c;\r\n    }\r\n    Klass.Function=function () {throw new Error(\"Abstract\");};\r\n    Klass.opt=A.opt;\r\n    Klass.Binder=Klass.define({\r\n        $this:true,\r\n        $:function (t,target) {\r\n            function addMethod(k){\r\n                if (typeof target[k]!==\"function\") return;\r\n                t[k]=function () {\r\n                    var a=Array.prototype.slice.call(arguments);\r\n                    //console.log(this, this.__target);\r\n                    //A(this.__target,\"target is not set\");\r\n                    return target[k].apply(target,a);\r\n                };\r\n            }\r\n            for (var k in target) addMethod(k);\r\n        }\r\n    });\r\n    return Klass;\r\n});\r\n/*\r\nrequirejs([\"Klass\"],function (k) {\r\n  P=k.define ({\r\n     $:[\"x\",\"y\"]\r\n  });\r\n  p=P(2,3);\r\n  console.log(p.x,p.y);\r\n});\r\n*/\r\n;\ndefine('DragDrop',[\"FS\"],function (FS) {\r\n    var DU=FS.DeferredUtil;\r\n    var SFile=FS.SFile;\r\n    DragDrop={};\r\n    DragDrop.readFile=function (file) {\r\n        return DU.promise(function (succ) {\r\n            var reader = new FileReader();\r\n            reader.onload = function(e) {\r\n                //var fileContent = reader.result;\r\n                //console.log(\"SUCC\",reader);\r\n                succ(reader);\r\n            };\r\n            reader.readAsArrayBuffer(file);\r\n        });\r\n    };\r\n    DragDrop.accept=function (dom, fdst,options) {\r\n        options=options||{};\r\n        options.draggingClass=options.draggingClass||\"dragging\";\r\n        dom.on(\"dragover\",over);\r\n        dom.on(\"dragenter\",enter);\r\n        dom.on(\"dragleave\",leave);\r\n        dom.on(\"drop\",dropAdd);\r\n        if (!options.onCheckFile) {\r\n            options.onCheckFile=function (f) {\r\n                if (options.overwrite) {\r\n                    return f;\r\n                } else {\r\n                    if (f.exists()) return false;\r\n                    return f;\r\n                }\r\n            };\r\n        }\r\n        if (!options.onError) {\r\n            options.onError=function (e) {\r\n                console.error(e);\r\n            };\r\n        }\r\n        function dropAdd(e) {\r\n            var dst=fdst;\r\n            if (typeof dst===\"function\") dst=dst();\r\n            dom.removeClass(options.draggingClass);\r\n            var status={};\r\n            var eo=e.originalEvent;\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            var files = Array.prototype.slice.call(eo.dataTransfer.files);\r\n            var added=[],cnt=files.length;\r\n            DU.each(files,function (file) {\r\n                var itemName=file.name;\r\n                var itemFile=dst.rel(itemName),actFile;\r\n                return DU.resolve(\r\n                    options.onCheckFile(itemFile,file)\r\n                ).then(function (cr) {\r\n                    if (cr===false) {\r\n                        status[itemFile.path()]={\r\n                            file:itemFile,\r\n                            status:\"cancelled\"\r\n                        };\r\n                        return;\r\n                    }\r\n                    if (SFile.is(cr)) actFile=cr;\r\n                    else actFile=itemFile;\r\n                    return DragDrop.readFile(file).then(function (reader) {\r\n                        var fileContent=reader.result;\r\n                        actFile.setBytes(fileContent);\r\n                        status[itemFile.path()]={\r\n                            file:itemFile,\r\n                            status:\"uploaded\"\r\n                        };\r\n                        if (actFile.path()!==itemFile.path()) {\r\n                            status[itemFile.path()].redirectedTo=actFile;\r\n                        }\r\n                    });\r\n                });\r\n            }).then(function () {\r\n                if (options.onComplete) options.onComplete(status);\r\n            }).fail(function (e) {\r\n                //console.log(e);\r\n                options.onError(e);\r\n            });\r\n            return false;\r\n        }\r\n        function over(e) {\r\n            //console.log(\"over\",e);\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n        }\r\n        var entc=0;\r\n        function enter(e) {\r\n            var eo=e.originalEvent;\r\n            //console.log(\"enter\",eo.target.innerHTML,e);\r\n            entc++;\r\n            /*if (dom[0]===eo.relatedTarget) {\r\n                dom.addClass(options.draggingClass);\r\n            }*/\r\n            //if (eo.target===dom[0]) {\r\n            dom.addClass(options.draggingClass);\r\n            //}\r\n                //$(eo.target).addClass(options.draggingClass);\r\n            //e.stopPropagation();\r\n            //e.preventDefault();\r\n        }\r\n        function leave(e) {\r\n            var eo=e.originalEvent;\r\n            //dom.removeClass(options.draggingClass);\r\n            console.log(\"leave\",eo.target.innerHTML,e);\r\n            entc--;\r\n            /*if (dom[0]===eo.relatedTarget) {\r\n                dom.removeClass(options.draggingClass);\r\n            }*/\r\n            //if (eo.target===dom[0]) {\r\n            if (entc<=0) dom.removeClass(options.draggingClass);\r\n            //}\r\n            //$(eo.target).removeClass(options.draggingClass);\r\n            //e.stopPropagation();\r\n            //e.preventDefault();\r\n        }\r\n    };\r\n    return DragDrop;\r\n});\r\n\ndefine('ZipImporter',[\"Klass\",\"FS\",\"Util\",\"DragDrop\",\"DeferredUtil\",\"UI\"],\r\nfunction (Klass,FS,Util,DD,DU,UI) {\r\n    FS.mount(\"/ram/\",\"ram\");\r\n    var zip=FS.zip;\r\n    var tmpDir=FS.get(\"/ram/\");\r\n    var ZipImporter=Klass.define({\r\n        $: function (dir, elem, options) {\r\n            var t=this;\r\n            t.elem=elem;\r\n            t.dir=dir;\r\n            t.tmpDir=tmpDir.rel(dir.name());\r\n            options=options||{};\r\n            t.onComplete=options.onComplete;\r\n            if (t.elem) t.prepareDragDrop();\r\n        },\r\n        prepareDragDrop: function () {\r\n            var t=this;\r\n            DD.accept(t.elem, t.tmpDir, {\r\n                onComplete: function (status) {\r\n                    t.showDialog();\r\n                    var ctx={imported:0, from:\"dragDrop\"};\r\n                    t.acceptDrag(status,ctx).then(function () {\r\n                        t.closeDialog();\r\n                        if (t.onComplete) t.onComplete(ctx);\r\n                    },function (e) {\r\n                        t.closeDialog();\r\n                        console.error(e);\r\n                        alert(e);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        acceptDrag: function (status,ctx) {\r\n            var t=this;\r\n            return DU.each(status,function(k,s) {\r\n                //s.file;\r\n                //s.status;\r\n                if (s.status===\"uploaded\" && s.file.ext()===\".zip\") {\r\n                    return t.unzip(s.file,ctx);\r\n                }\r\n            });\r\n        },\r\n        showDialog: function (mesg) {\r\n            var t=this;\r\n            mesg=mesg||\"ZIP...\";\r\n            if (!t.dialog) {\r\n                t.dialog=UI(\"div\",{title:\"Zip\"},\r\n                    [\"span\",{$var:\"mesg\"}, mesg]\r\n                );\r\n                t.mesg=t.dialog.$vars.mesg;\r\n            } else {\r\n                t.mesg.text(mesg);\r\n            }\r\n            if (!t.dialogOpened) {\r\n                t.dialog.dialog({modal:true});\r\n            }\r\n            t.dialogOpened=true;\r\n        },\r\n        closeDialog: function () {\r\n            var t=this;\r\n            if (t.dialog) {\r\n                t.dialog.dialog(\"close\");\r\n                t.dialogOpened=false;\r\n            }\r\n        },\r\n        unzip: function (file,ctx) {\r\n            // ctx.dstDir is set when fromPrjB, /Tonyu/Project/prjfile_0.00/\r\n            var t=this;\r\n            t.showDialog(file.name()+\"...\");\r\n            var zipexdir=t.tmpDir.rel(file.truncExt()+\"/\");\r\n            var opt={\r\n                progress: function (file) {\r\n                    t.showDialog(file.name()+\"...\");\r\n                    return DU.timeout(0);\r\n                }\r\n            };\r\n            return FS.zip.unzip(file, zipexdir,opt ).then(function () {\r\n                if (ctx.rel) {\r\n                    zipexdir=zipexdir.rel(ctx.rel);\r\n                    if (!zipexdir.exists()) {\r\n                        return ctx;\r\n                    }\r\n                }\r\n                return t.traverse(zipexdir,ctx);\r\n            }).then(function (ctx) {\r\n                if (ctx.from===\"prjB\" && ctx.imported===0) throw new Error(\r\n                    file.name()+\r\n                    \"Tonyu2.\");\r\n            });\r\n        },\r\n        traverse: function (zipexdir,ctx) {\r\n            var t=this;\r\n            var ctx=ctx||{};\r\n            ctx.imported=ctx.imported||0;\r\n            return zipexdir.each(function (f) {\r\n                t.showDialog(f.name()+\"...\");\r\n                console.log(\"traverse\",f.path());\r\n                if (f.isDir()) {\r\n                    return t.traverse(f,ctx);\r\n                } else if (f.name()===\"options.json\") {\r\n                    ctx.imported++;\r\n                    return t.importFrom(f.up(),ctx);\r\n                }\r\n            }).then(function (){\r\n                return ctx;\r\n            });\r\n        },\r\n        importFrom: function (src,ctx) {\r\n            var t=this;\r\n            var dst;\r\n            if (ctx.dstDir) {\r\n                dst=ctx.dstDir;\r\n            } else {\r\n                var dstParent=t.dir;\r\n                var nameT=FS.PathUtil.truncSEP(src.name());\r\n                if (nameT===\"src\") {\r\n                    nameT=FS.PathUtil.truncSEP(src.up().name());\r\n                }\r\n                var name=nameT+\"/\";\r\n                dst=dstParent.rel(name);\r\n                var i=2;\r\n                while (dst.exists()) {\r\n                    name=nameT+i+\"/\";\r\n                    i++;\r\n                    dst=dstParent.rel(name);\r\n                }\r\n            }\r\n            t.showDialog(src.name()+ \"\"+ dst.name()+\"\");\r\n            console.log(\"importFrom\",src.path(), \"to\", dst.path());\r\n            return src.copyTo(dst).then(function () {\r\n                if (t.prjID) {\r\n                    var options=dst.rel(\"options.json\");\r\n                    if (options.exists()) {\r\n                        var optobj=options.obj();\r\n                        optobj.info=optobj.info||{};\r\n                        optobj.info.prjID=t.prjID;\r\n                        options.obj(optobj);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        checkFromPrjB: function () {\r\n            var t=this;\r\n            var file=Util.getQueryString(\"fromPrjB\");\r\n            var prjID=Util.getQueryString(\"prjID\");\r\n            t.prjID=prjID;\r\n            console.log(\"checkFromPrjB\",file);\r\n            if (file) {\r\n                var dstDir=t.dir.rel(file.replace(/\\.zip$/i,\"/\"));\r\n                if (dstDir.exists() ){\r\n                    console.log(dstDir+\" already exists \");\r\n                    return 0;\r\n                }\r\n                FS.mount(\"https://edit.tonyu.jp/\",\"web\");\r\n                var ctx={from:\"prjB\", imported:0, dstDir:dstDir, rel:\"src/\"};\r\n                return t.fromPrjB(file,ctx).then(function (r) {\r\n                    t.closeDialog();\r\n                    if (t.onComplete) t.onComplete(ctx);\r\n                    return r;\r\n                },function (e) {\r\n                    t.closeDialog();\r\n                    alert(e);\r\n                    console.error(e);\r\n                });\r\n            }\r\n        },\r\n        fromPrjB: function (fileName,ctx) {\r\n            var t=this;\r\n            var f=FS.get(\"https://edit.tonyu.jp/cgi-bin/dl.cgi?file=\"+fileName);\r\n            var tmp=FS.get(\"/ram/\").rel(fileName);\r\n            t.showDialog(\"\"+fileName+\"....\");\r\n            return f.copyTo(tmp).then(function (r) {\r\n                return t.unzip(tmp,ctx);\r\n            });\r\n        }\r\n    });\r\n    return ZipImporter;\r\n});\r\n\ndefine('ProjectItem',[\"Klass\",\"UI\",\"FS\",\"DeferredUtil\",\"WebSite\"],\r\nfunction (Klass,UI,FS,DU,WebSite) {\r\n    var HNOP=\"javascript:;\";\r\n    var S;\r\n    ProjectItem=S=Klass.define({\r\n//----METHODS\r\n$this:true,\r\n$:function (t,projectDir,prjList) {\r\n    var f=projectDir;\r\n    var name=FS.PathUtil.truncSEP(f.name());\r\n    t.prjList=prjList;\r\n    t.projectDir=projectDir;\r\n    t.name=name;\r\n    var u=t.dom(f);\r\n    t.u=u;\r\n    u.appendTo(t.prjList);\r\n    setTimeout(function () {\r\n        var tn=f.rel(\"images/\").rel(\"icon_thumbnail.png\");\r\n        if (tn.exists()) {\r\n            u.$vars.t.attr(\"src\",tn.getURL());\r\n        }\r\n    },10);\r\n},\r\nhide: function (t) {\r\n    if (t.u) t.u.hide();\r\n},\r\nshow: function (t) {\r\n    if (t.u) t.u.show();\r\n},\r\nurl: {\r\n    get: function (t) {\r\n        var f=t.projectDir;\r\n        // temporaly\r\n        if (WebSite.version==2) {\r\n            return \"project2.html?dir=\"+f.path();\r\n        }\r\n        return \"project.html?dir=\"+f.path();\r\n    }\r\n},\r\ndom: function (t) {\r\n    var url=t.url;\r\n    var name=t.name;\r\n    return UI(\"div\", {\"class\":\"project existentproject\"},\r\n        [\"a\", {href:url,\"class\":\"projectLink\"},\r\n             [\"img\",{width:100,$var:\"t\",src:WebSite.top+\"/images/nowprint.png\"}]],\r\n        [\"div\",\r\n            [\"a\", {href:url,\"class\":\"projectLink projectName\"},name],\r\n            t.submenuExpr()\r\n        ]\r\n    );\r\n},\r\nsubmenuExpr:function submenuExpr(t) {\r\n    var f=t.projectDir;\r\n    return [\"span\",{class:\"dropdown\"},\r\n        [\"button\",{\r\n            //href:HNOP,\r\n            class:\"submenu prjMenuButton\",\r\n            on:{click:t.$bind.openSubmenu},\"data-path\":f.path() },\" \"],\r\n        [\"span\",{class:\"dropdown-content\"},\r\n            [\"a\",{href:HNOP,class:\"submenu\",on:{click:t.$bind.rename}},\"\"],\r\n            [\"a\",{href:HNOP,class:\"submenu\",on:{click:t.$bind.download}},\"ZIP\"],\r\n            [\"a\",{href:HNOP,class:\"submenu nwmenu\",on:{click:t.$bind.openFolder}},\"\"],\r\n            [\"a\",{href:HNOP,class:\"submenu\",on:{click:t.$bind.remove}},\"\"]\r\n        ]\r\n    ];\r\n},\r\ndownload: function (t) {\r\n    S.closeSubmenu();\r\n    return FS.zip.zip(t.projectDir).catch(DU.E);\r\n},\r\nremove: function (t) {\r\n    S.closeSubmenu();\r\n    if (!t.rmd) t.rmd=UI(\"div\",{title:\"\"},\r\n        [\"div\",\"\",t.name,\"\"],\r\n        [\"div\",\r\n            [\"input\",{$var:\"dl\",type:\"checkbox\",checked:true}],\r\n            [\"label\",{for:\"dl\"},\"ZIP\"]\r\n        ],\r\n        [\"div\",\r\n            [\"button\",{on:{click:doRemove}},\"\"],\r\n            [\"button\",{on:{click:cancel}},\"\"]\r\n        ]\r\n    );\r\n    t.rmd.$vars.dl.prop(\"checked\",true);\r\n    t.rmd.dialog();\r\n    //console.log(\"t.rmd.data\",$.data(t.rmd[0],\"ui-dialog\"));\r\n    function doRemove() {\r\n        var dl=t.rmd.$vars.dl.prop(\"checked\");\r\n        return (dl?t.download():DU.resolve()).then(function () {\r\n            t.projectDir.rm({r:1});\r\n            t.u.remove();\r\n            t.rmd.dialog(\"close\");\r\n        }).catch(DU.E);\r\n    }\r\n    function cancel() {\r\n        //console.log(\"t.rmd.data.cancel\",$.data(t.rmd[0],\"ui-dialog\"));\r\n        t.rmd.dialog(\"close\");\r\n    }\r\n    //t.projectDir.rm({r:1});\r\n},\r\nrename: function (t) {\r\n    S.closeSubmenu();\r\n    var np=prompt(\"\",\r\n    t.name);\r\n    if (!np || np==\"\") return;\r\n    np=FS.PathUtil.truncSEP(np);\r\n    var npd=t.projectDir.sibling(np+\"/\");\r\n    return npd.exists(function (e) {\r\n        if (e) {\r\n            alert(np+\" \");\r\n            return;\r\n        }\r\n        //link.attr(\"href\",HNOP).text(\"Wait...\");\r\n        return t.projectDir.moveTo(npd).then(function () {\r\n            t.projectDir=npd;\r\n            t.name=npd;\r\n            t.u.find(\".projectName\").text(np);\r\n            t.u.find(\".projectLink\").attr(\"href\",t.url);\r\n            //console.log(\"Renamed\",t.url);\r\n            S.closeSubmenu();\r\n        }).catch(DU.E);\r\n    });\r\n},\r\nopenFolder: function (t){\r\n    var gui = require(\"nw.gui\");//(global.nwDispatcher||global.nw).requireNwGui();\r\n    var SEP = process.execPath;\r\n    gui.Shell.showItemInFolder(t.projectDir.path().replace(/\\//g,require(\"path\").sep));\r\n    S.closeSubmenu();\r\n},\r\nopenSubmenu: function openSubmenu(t) {\r\n    S.addMenuHandler();\r\n    S.closeSubmenu();\r\n    S.showingSubMenu=t.u.find(\".dropdown-content\");\r\n    S.showingSubMenu.addClass(\"show\");\r\n    if (!WebSite.isNW) S.showingSubMenu.find(\".nwmenu\").hide();\r\n},\r\nstatic$closeSubmenu: function () {\r\n    if (S.showingSubMenu) {\r\n        S.showingSubMenu.removeClass(\"show\");\r\n        S.showingSubMenu=null;\r\n    }\r\n},\r\nstatic$addMenuHandler: function () {\r\n    if (S.menuHandlerAdded) return;\r\n    S.menuHandlerAdded=true;\r\n    $('html').click(function(e) {\r\n        if(!$(e.target).hasClass('submenu')) {\r\n            S.closeSubmenu();\r\n        }\r\n    });\r\n}\r\n//----END OF METHODS\r\n    });// end of klass\r\n    return S;\r\n});\r\n\ndefine('splashElement',['require','exports','module'],function (require,exports,module) {//---\r\nreturn `<div id='splash' style='position:relative; height: 100%;'>\r\n    <!---->\r\n    <!--You can write here what you want to show while loading. -->\r\n    <div class='progress'>\r\n        <!-- div -->\r\n        <!-- This shows progress. If you don't want to show, remove this element. -->\r\n    </div>\r\n    <div class='unsupported' style=\"display:none;\">\r\n        <!-- div -->\r\n        <!-- This shows message for unsupported browsers. If you don't want to show, remove this element. -->\r\n        <p></p>\r\n        <p>The program does not run in this browser. Try another browser.</p>\r\n    </div>\r\n</div>\r\n<!--\r\nOpen this site when editing this game:\r\nhttps://edit.tonyu.jp/index.html?importFromHTML=1\r\n-->`;\r\n});//---of define\r\n;\ndefine('exportAsScriptTags',[\"FS\",\"Util\",\"WebSite\",\"splashElement\"], function (FS,Util,WebSite,splashElement) {\r\n    var east=function (dir,options) {\r\n        options=options||{};\r\n        var excludes=options.excludes||{};\r\n        var includeJSScript=options.includeJSScript;\r\n        var buf=\"<!DOCTYPE html>\\n<html><head>\\n\";\r\n        buf+='<meta http-equiv=\"Content-type\" content=\"text/html; charset=utf-8\"/>\\n';\r\n        buf+=\"<script>WebSite_runType='singleHTML';</script>\\n\";\r\n        if (includeJSScript) {\r\n            var resFile=dir.rel(\"res.json\");\r\n            var resObj=resFile.obj();\r\n            var scriptServer=WebSite.scriptServer||\"https://edit.tonyu.jp/\";\r\n            const genPath=scriptServer+\"js/\"+(options.IE?\"gen\":\"g2\")+\"/\";\r\n            resObj.images.forEach(function (im) {\r\n                if (WebSite.builtinAssetNames[im.url]) {\r\n                    buf+='<script src=\"'+scriptServer+im.url+'.js\"></script>\\n';\r\n                }\r\n            });\r\n            buf+='<script src=\"'+scriptServer+'js/lib/jquery-1.10.1.js\" type=\"text/javascript\"></script>\\n';\r\n            buf+='<script src=\"'+genPath+'runScript_concat.min.js\" type=\"text/javascript\"></script>\\n';\r\n            if (!options.IE) {\r\n                buf+=`<script src=\"${scriptServer}js/runtime/detectUnsupported.js\"></script>`;\r\n            }\r\n        }\r\n        var binary=[],json=[];\r\n        //dir=FS.get(dir);\r\n        dir.recursive(function (f) {\r\n            var rel=f.relPath(dir);\r\n            if (excludes[rel]) return;\r\n            if (f.endsWith(\".json\") && rel.indexOf(\"maps/\")<0) {\r\n                json.push(f);\r\n                return;\r\n            } else if (f.endsWith(\".desktop\")) {\r\n                return;\r\n            } else if (f.endsWith(\".js.map\")) {\r\n                return;\r\n            } else if (f.endsWith(\".js\")) {\r\n                return;\r\n            } else if (!f.endsWith(\".tonyu\")) {\r\n                binary.push(f);\r\n                return;\r\n            }\r\n            //var name=f.truncExt(\".tonyu\");\r\n            var m=\"\";//(name==main?\" data-main='true'\":\"\");\r\n            var lu=\" data-lastupdate='\"+f.lastUpdate()+\"' \";\r\n            buf+=\"<script language='text/tonyu' type='text/tonyu' data-filename='\"+rel+\"'\"+lu+\">\";\r\n            buf+=escapeLoosely(f.text());\r\n            buf+=\"</script>\\n\\n\";\r\n        },{excludes:[\"files/\"]});\r\n        json.forEach(function (f) {\r\n            var rel=f.relPath(dir);\r\n            var lu=\" data-lastupdate='\"+f.lastUpdate()+\"' \";\r\n            buf+=\"<script language='text/tonyu' type='text/tonyu' data-filename='\"+rel+\"'\"+lu+\">\\n\";\r\n            buf+=beautifyJSON(f.text());\r\n            buf+=\"</script>\\n\\n\";\r\n        });\r\n        binary.forEach(function (f) {\r\n            var rel=f.relPath(dir);\r\n            var lu=\" data-lastupdate='\"+f.lastUpdate()+\"' \";\r\n            buf+=\"<script language='text/tonyu' type='text/tonyu' data-filename='\"+rel+\"' data-wrap='80'\"+lu+\">\";\r\n            buf+=wrap(f.text(),80);\r\n            buf+=\"</script>\\n\\n\";\r\n        });\r\n        buf+=\"</head><body>\"+(options.splashElement||splashElement)+\"</body></html>\";\r\n        return buf;\r\n        function wrap(str, cols) {\r\n            var lines=str.split(\"\\n\");\r\n            var buf=\"\";\r\n            lines.forEach(function (line) {\r\n                while (true) {\r\n                    if (line.length>cols) {\r\n                        buf+=line.substring(0,cols)+\"\\\\\\n\";\r\n                        line=line.substring(cols);\r\n                    } else {\r\n                        buf+=line+\"\\n\";\r\n                        break;\r\n                    }\r\n                }\r\n                return buf;\r\n            });\r\n            return buf;\r\n        }\r\n        function beautifyJSON(str) {\r\n            try {\r\n                var o=JSON.parse(str);\r\n                return JSON.stringify(o,null,4);\r\n            }catch(e) {\r\n                return str;\r\n            }\r\n        }\r\n    };\r\n    function escapeLoosely(text) {\r\n        text=text.replace(/&(#?[\\w\\d]+;)/g, function (_,a){\r\n            return \"&amp;\"+a;\r\n        });\r\n        text=text.replace(/<(\\s*)\\/(\\s*)script(\\s*)>/ig,function (_,s1,s2,s3) {\r\n            return \"&lt;\"+s1+\"/\"+s2+\"script\"+s3+\"&gt;\" ;\r\n        });\r\n        return text;\r\n    }\r\n    return east;\r\n});\r\n\ndefine('Content',[\"FS\"],function (FS){return FS.Content;});\r\n\ndefine('ScriptTagFS',[\"Content\"],function (Content) {\r\n\tvar STF={};\r\n\tSTF.toObj=function () {\r\n\t    var scrs=$(\"script\");\r\n\t    var res={};\r\n\t    scrs.each(function (){\r\n\t        var s=this;\r\n\t        if (s.type==\"text/tonyu\") {\r\n\t            var fn=$(s).data(\"filename\");\r\n\t            if (fn) {\r\n\t                var l=parseInt($(s).data(\"lastupdate\"));\r\n\t                var w=$(s).data(\"wrap\");\r\n\t\t\t\t\tvar src=unescapeHTML(s.innerHTML);\r\n\t                if (w) {\r\n\t                    w=parseInt(w);\r\n\t                    res[fn]={lastUpdate:l, text:unwrap(src, w)};\r\n\t                } else {\r\n\t                    res[fn]={lastUpdate:l, text:src};\r\n\t                }\r\n\t            }\r\n\t        }\r\n\t    });\r\n\t    return res;\r\n\t    function unwrap(str, cols) {\r\n\t        var lines=str.split(\"\\n\");\r\n\t        var buf=\"\";\r\n\t        lines.forEach(function (line) {\r\n\t            if (line.length>cols) {\r\n\t                buf+=line.substring(0,cols);\r\n\t            } else {\r\n\t                buf+=line+\"\\n\";\r\n\t            }\r\n\t        });\r\n\t        return buf;\r\n\t    }\r\n\t};\r\n\tSTF.copyTo=function (dir) {\r\n\t    var o=STF.toObj();\r\n\t    for (var fn in o) {\r\n            var f=dir.rel(fn);\r\n            if (f.isText()) {\r\n                f.text(o[fn].text);\r\n            } else {\r\n                f.setBytes(Content.url(o[fn].text).toByteArray() );\r\n            }\r\n        }\r\n\t};\r\n\tfunction unescapeHTML(str) {\r\n\t\tvar div = document.createElement(\"div\");\r\n\t\tdiv.innerHTML = str.replace(/</g,\"&lt;\")\r\n\t\t\t\t\t\t\t .replace(/>/g,\"&gt;\")\r\n\t\t\t\t\t\t\t .replace(/ /g, \"&#32;\")\r\n\t\t\t\t\t\t\t .replace(/\\r/g, \"&#13;\")\r\n\t\t\t\t\t\t\t .replace(/\\n/g, \"&#10;\");\r\n\t\treturn div.textContent || div.innerText;\r\n\t}\r\n\treturn STF;\r\n});\r\n\ndefine('ImportHTMLDialog',[\"exportAsScriptTags\",\"UI\",\"Klass\",\"NewProjectDialog\",\"ScriptTagFS\"],\r\nfunction (east,UI,Klass,NPD,STF) {\r\n    ImportHTMLDialog=Klass.define({\r\n        $this:true,\r\n        show: function (t,options) {\r\n            t.createDOM();\r\n            t.dom.dialog({width:800,height:600});\r\n            //console.log(\"imp.dom.data\",$.data(t.dom[0],\"ui-dialog\"));\r\n            t.mode(\"src\");\r\n        },\r\n        createDOM:function (t) {\r\n            if (t.dom) return t.dom;\r\n            t.dom=UI(\"div\",{title:\"HTML\"},\r\n                [\"div\",{$var:\"src\"},\r\n                    [\"div\",\"HTML\"],\r\n                    [\"div\",[\"button\",{on:{click:t.$bind.selDir}},\"Next->\"]],\r\n                    [\"div\",\r\n                        [\"textarea\",{\r\n                            $var:\"prog\",rows:20,cols:60,\r\n                            placeholder:\"Paste HTML Here\"\r\n                        }]\r\n                    ],\r\n                    [\"div\",[\"button\",{on:{click:t.$bind.selDir}},\"Next->\"]]\r\n                ],\r\n                [\"div\",{$var:\"selDir\"}],\r\n                [\"div\",{$var:\"confirm\"}],\r\n                [\"div\",{$var:\"complete\"}],\r\n                [\"div\",{$var:\"files\",css:{display:\"none\"}}]\r\n            );\r\n            //t.dom.__ID=Math.random();\r\n            //console.log(\"createDOM\",t.dom);\r\n            t.vars=t.dom.$vars;\r\n            return t.dom;\r\n        },\r\n        selDir: function (t) {\r\n            t.vars.selDir.empty();\r\n            t.vars.selDir.append($(\"<h1>\").text(\"\"));\r\n            t.vars.selDir.append( NPD.embed(\r\n                t.prjDirs[0],t.$bind.confirm,{}\r\n            ));\r\n            t.mode(\"selDir\");\r\n        },\r\n        confirm: function confirm(t,dir) {\r\n            t.dst=dir;\r\n            var s=t.vars.prog.val();\r\n            var buf=\"\";\r\n            s.split(\"\\n\").forEach(function (l) {\r\n                if (!l.match(/<script[^>]*src[^>]*javascript/)) {\r\n                    buf+=l+\"\\n\";\r\n                }\r\n            });\r\n            t.vars.files.html(buf);\r\n            t.mode(\"confirm\");\r\n            t.vars.confirm.empty();\r\n            t.vars.confirm.append(UI(\"div\",[\"button\",{on:{click:t.$bind.complete}},\"\"]));\r\n            var o=STF.toObj();\r\n            for (var fn in o) {\r\n                var f=dir.rel(fn);\r\n                var ex=f.exists()?\"\":\"\";\r\n                t.vars.confirm.append(UI(\"div\",\"[\", ex,\"]\", f.path()));\r\n            }\r\n        },\r\n        complete: function run(t) {\r\n            var dir=t.dst;\r\n            t.mode(\"complete\");\r\n            var o=STF.toObj();\r\n            for (var fn in o) {\r\n                var f=dir.rel(fn);\r\n                f.text(o[fn].text);\r\n            }\r\n            t.vars.complete.empty();\r\n            t.vars.complete.append(UI(\"h1\",\"\"));\r\n            /*t.vars.complete.append(UI(\"div\",\r\n                [\"a\",{href:\"project.html?dir=\"+dst.path()},\r\n                dst.path()+\"\"]\r\n            ));*/\r\n            //console.log(\"close\",t.dom);\r\n            //console.log(\"imp.dom.data2\",$.data(t.dom[0],\"ui-dialog\"));\r\n            t.dom.dialog(\"close\");\r\n            t.onComplete();\r\n        },\r\n        mode:function mode(t,n) {\r\n            [\"src\",\"selDir\",\"confirm\",\"complete\"].forEach(function (k) {\r\n                t.vars[k].hide();\r\n            });\r\n            t.vars[n].show();\r\n        }\r\n    });\r\n    return ImportHTMLDialog;\r\n});\r\n\n/*global requirejs*/\r\nrequirejs([\"FS\",\"Wiki\",\"Shell\",\"Shell2\",\r\n           /*\"copySample\",*/\"NewProjectDialog\",\"UI\",\"Sync\",\"Auth\",\r\n           \"zip\",\"requestFragment\",\"WebSite\",\"extLink\",\"DeferredUtil\",\r\n       \"ZipImporter\",\"ProjectItem\",\"ImportHTMLDialog\"],\r\n  function (FS, Wiki,   sh,sh2,\r\n            /*copySample,  */NPD,           UI, Sync, Auth,\r\n            zip,requestFragment,WebSite,extLink,DU,\r\n        ZipImporter,ProjectItem,ImportHTMLDialog) {\r\n$(function () {\r\n    var HNOP=\"javascript_:;\".replace(/_/,\"\");\r\n    //copySample();\r\n    //var home=FS.get(WebSite.tonyuHome);\r\n    //var projects=FS.get(WebSite.projects[0]);//home.rel(\"Projects/\");\r\n    if (!FS.NativeFS.available) {\r\n        var capacity=FS.LSFS.getCapacity();\r\n        $(\"#ls\").text(Math.floor(capacity.max/1024)+\"KB\"+Math.floor(capacity.using/1024)+\"KB\");\r\n    }\r\n\r\n    $.get(\"https://edit.tonyu.jp/doc/welcome_sel.html\").then(function (t) {\r\n        $(\"#welcome\").append(t);\r\n    });\r\n    $(\"#prjItemList\").empty();\r\n    var search, prevKW=\"\",kw=\"\";\r\n    $(\"#prjItemList\").append(search=UI(\"div\",\r\n            [\"input\",{$var:\"kw\",placeholder:\"Search..\",value:kw}]));\r\n    setInterval(function () {\r\n        kw=search.$vars.kw.val().toLowerCase();\r\n        if (kw!=prevKW) {\r\n            $(\".project\").each(function () {\r\n                var p=$(this);\r\n                var nd=p.find(\".projectName\");\r\n                if (kw==\"\" || nd[0] && nd.text().toLowerCase().indexOf(kw)>=0 ) {\r\n                    p.show();\r\n                } else{\r\n                    p.hide();\r\n                }\r\n            });\r\n            prevKW=kw;\r\n        }\r\n    },1000);\r\n    var prjDirs=WebSite.projects.map(function (e) {return FS.get(e);});\r\n    prjDirs.forEach(ls);\r\n    if (WebSite.isNW) {\r\n        $(\"#loginGrp\").hide();\r\n    }\r\n    function ls(curDir,i) {\r\n        if (!curDir.exists()) {\r\n            if (i==0) {\r\n                curDir.mkdir();\r\n                //console.log(curDir.path(), curDir.exists());\r\n            } else return;\r\n        }\r\n        var prj1dirList=$(\"<section>\");\r\n        $(\"#prjItemList\").append(prj1dirList);\r\n        prj1dirList.append(UI(\"h2\",{\"class\":\"prjDirHeader\"},curDir.path()));\r\n        var u=UI(\"div\", {\"class\":\"project newprj\"},\r\n            [\"a\", {href:HNOP, on:{click:newDiag}},\r\n            [\"img\",{$var:\"t\",src:WebSite.top+\"/images/tonew.png\"}],\r\n            [\"div\", \"\"]\r\n        ]);\r\n        u.appendTo(prj1dirList);\r\n        function newDiag() {\r\n            NPD.show(curDir, function (prjDir) {\r\n                prjDir.mkdir();\r\n                // temporaly\r\n                if (WebSite.version==2) {\r\n                    location.href=\"project2.html?dir=\"+prjDir.path();\r\n                } else {\r\n                    location.href=\"project.html?dir=\"+prjDir.path();\r\n                }\r\n            });\r\n        }\r\n        var showAll;\r\n        showAll=UI(\"div\",{\"style\":\"display: inline-block;\"},\r\n                //[\"div\",{style:\"height:120px;\"},\" \"],\r\n                [\"button\",{\"class\":\"showAll\",on:{\r\n            click:function () {\r\n                showAll.remove();\r\n                dols(curDir,prj1dirList);\r\n            }\r\n        }},\"...\"]);\r\n        prj1dirList.append(showAll);\r\n        //$(\"#prjItemList\").append(UI(\"div\",[\"h2\",{\"class\":\"prjDirHeader\"},\"----\"]));\r\n    }\r\n    var zipchecked;\r\n    function dols(curDir,prj1dirList) {\r\n        var zi=new ZipImporter(curDir,prj1dirList,{\r\n            onComplete: refresh\r\n        });\r\n        if (!zipchecked) {\r\n            zipchecked=true;\r\n            zi.checkFromPrjB();\r\n        }\r\n        function refresh(e) {\r\n            if (e.from===\"prjB\") {\r\n                location.href=location.href.replace(/\\?.*/,\"\");\r\n            } else {\r\n                prj1dirList.find(\".existentproject\").remove();\r\n                dols2(curDir,prj1dirList);\r\n            }\r\n        }\r\n        return dols2(curDir,prj1dirList);\r\n    }\r\n    function dols2(curDir,prj1dirList) {\r\n        var d=[];\r\n        curDir.each(function (f) {\r\n            if (!f.isDir()) return;\r\n            var l=f.lastUpdate();\r\n            /*var r=f.rel(\"options.json\");\r\n            if (r.exists()) {\r\n                l=r.lastUpdate();\r\n            }*/\r\n            d.push([f,l]);\r\n        });\r\n        d=d.sort(function (a,b) {\r\n            return b[1]-a[1];\r\n        });\r\n        return DU.each(d,function (e) {\r\n            var f=e[0];\r\n            if (!f.isDir()) return;\r\n            var it=new ProjectItem(f,prj1dirList);\r\n            if (kw!=\"\" && it.name.toLowerCase().indexOf(kw)<0) it.hide();\r\n            return DU.timeout(10);\r\n        });\r\n    }\r\n    /*Auth.currentUser(function (r){\r\n        if (r) {\r\n            $(\".while-logged-out\").hide();\r\n            $(\"#login\").text(r);\r\n        } else {\r\n            $(\".while-logged-in\").hide();\r\n        }\r\n    });*/\r\n    /*var help=$(\"<iframe>\").attr(\"src\",WebSite.top+\"/doc/index.html\");\r\n    help.height($(window).height()-$(\"#navBar\").height());\r\n    $(\"#wikiViewArea\").append(help);\r\n*/\r\n\r\n    /*$(\"#newPrj\").click(function (){\r\n    \tNPD.show(FS.get(WebSite.projects[0]), function (prjDir) {\r\n            prjDir.mkdir();\r\n            document.location.href=\"project.html?dir=\"+prjDir.path();\r\n    \t});\r\n    })*/;\r\n    SplashScreen.hide();\r\n    /*$(\"body\").on(\"keydown\",function (e) {\r\n        if (e.keyCode==77 && WebSite.devMode) {\r\n            WebSite.mobile=!WebSite.mobile;\r\n            console.log(\"Mobile mode\", WebSite.mobile);\r\n            if (WebSite.mobile) {\r\n                home.rel(\"mobile.txt\").text(\"true\");\r\n            } else {\r\n                home.rel(\"mobile.txt\").rm();\r\n            }\r\n        }\r\n    });*/\r\n    var importHTMLDialog=new ImportHTMLDialog({\r\n        onComplete: function (){\r\n            //prjDirs.forEach(ls);\r\n            location.reload();\r\n        },\r\n        prjDirs:prjDirs\r\n    });\r\n    window.importFromHTML=function () {\r\n        importHTMLDialog.show();\r\n    };\r\n    if (Util.getQueryString(\"importFromHTML\")) {\r\n        importHTMLDialog.show();\r\n    }\r\n    sh.cd(FS.get(WebSite.projects[0]));\r\n    extLink.all();\r\n    sh.wikiEditor=function () {document.location.href=\"wikiEditor.html\";};\r\n    $($(\"button.showAll\").get(0)).click();\r\n});\r\n});\r\n\ndefine(\"selProject\", function(){});\n\n})();\r\n"]}