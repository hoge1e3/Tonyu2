!function(t){var e,n,r;!function(t){var i,o,s,a,u={},c={},l={},f={},p=Object.prototype.hasOwnProperty,h=[].slice,d=/\.js$/;function g(t,e){return p.call(t,e)}function m(t,e){var n,r,i,o,s,a,u,c,f,p,h,g=e&&e.split("/"),m=l.map,v=m&&m["*"]||{};if(t){for(s=(t=t.split("/")).length-1,l.nodeIdCompat&&d.test(t[s])&&(t[s]=t[s].replace(d,"")),"."===t[0].charAt(0)&&g&&(t=g.slice(0,g.length-1).concat(t)),f=0;f<t.length;f++)if("."===(h=t[f]))t.splice(f,1),f-=1;else if(".."===h){if(0===f||1===f&&".."===t[2]||".."===t[f-1])continue;f>0&&(t.splice(f-1,2),f-=2)}t=t.join("/")}if((g||v)&&m){for(f=(n=t.split("/")).length;f>0;f-=1){if(r=n.slice(0,f).join("/"),g)for(p=g.length;p>0;p-=1)if((i=m[g.slice(0,p).join("/")])&&(i=i[r])){o=i,a=f;break}if(o)break;!u&&v&&v[r]&&(u=v[r],c=f)}!o&&u&&(o=u,a=c),o&&(n.splice(0,a,o),t=n.join("/"))}return t}function v(e,n){return function(){var r=h.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),o.apply(t,r.concat([e,n]))}}function y(t){return function(e){u[t]=e}}function b(e){if(g(c,e)){var n=c[e];delete c[e],f[e]=!0,i.apply(t,n)}if(!g(u,e)&&!g(f,e))throw new Error("No "+e);return u[e]}function w(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function S(t){return t?w(t):[]}s=function(t,e){var n,r,i=w(t),o=i[0],s=e[1];return t=i[1],o&&(n=b(o=m(o,s))),o?t=n&&n.normalize?n.normalize(t,(r=s,function(t){return m(t,r)})):m(t,s):(o=(i=w(t=m(t,s)))[0],t=i[1],o&&(n=b(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},a={require:function(t){return v(t)},exports:function(t){var e=u[t];return void 0!==e?e:u[t]={}},module:function(t){return{id:t,uri:"",exports:u[t],config:function(t){return function(){return l&&l.config&&l.config[t]||{}}}(t)}}},i=function(e,n,r,i){var o,l,p,h,d,m,w,x=[],_=typeof r;if(m=S(i=i||e),"undefined"===_||"function"===_){for(n=!n.length&&r.length?["require","exports","module"]:n,d=0;d<n.length;d+=1)if("require"===(l=(h=s(n[d],m)).f))x[d]=a.require(e);else if("exports"===l)x[d]=a.exports(e),w=!0;else if("module"===l)o=x[d]=a.module(e);else if(g(u,l)||g(c,l)||g(f,l))x[d]=b(l);else{if(!h.p)throw new Error(e+" missing "+l);h.p.load(h.n,v(i,!0),y(l),{}),x[d]=u[l]}p=r?r.apply(u[e],x):void 0,e&&(o&&o.exports!==t&&o.exports!==u[e]?u[e]=o.exports:p===t&&w||(u[e]=p))}else e&&(u[e]=r)},e=n=o=function(e,n,r,u,c){if("string"==typeof e)return a[e]?a[e](n):b(s(e,S(n)).f);if(!e.splice){if((l=e).deps&&o(l.deps,l.callback),!n)return;n.splice?(e=n,n=r,r=null):e=t}return n=n||function(){},"function"==typeof r&&(r=u,u=c),u?i(t,e,n,r):setTimeout(function(){i(t,e,n,r)},4),o},o.config=function(t){return o(t)},e._defined=u,(r=function(t,e,n){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(n=e,e=[]),g(u,t)||g(c,t)||(c[t]=[t,e,n])}).amd={jQuery:!0}}(),r("js/almond",function(){}),r("FS",[],function(){var t,e,n,r={},i=0;return r.def=function(t,e,n){var i=r.getModuleInfo(t);"function"==typeof e?(n=e,e=r.reqsFromFunc(n),r.setReqs(i,e),i.func=function(){var t={exports:{}};return n(r.doLoad,t,t.exports)||t.exports}):(r.setReqs(i,e),i.func=function(){return n.apply(this,r.getObjs(e))}),r.loadIfAvailable(i)},(t=function(t,e,n){r.def(t,e,n)}).amd={},e=function(t,e){r.def("REQJS_"+i++,t,e)},r.setReqs=function(t,e){e.forEach(function(e){var n=r.getModuleInfo(e);n.loaded||(t.reqs[e]=n,n.revReqs[t.name]=t)})},r.getModuleInfo=function(t){var e=r.modules;return e[t]=e[t]||{name:t,reqs:{},revReqs:{}}},r.doLoad=function(t){var e=r.getModuleInfo(t);if(e.loaded)return e.obj;e.loaded=!0;var n=e.func();for(var i in null!=n||t.match(/^REQJS_/)||console.log("Warning: No obj for "+t),e.obj=n,e.revReqs)r.notifyLoaded(e.revReqs[i],e.name);return n},r.notifyLoaded=function(t,e){delete t.reqs[e],r.loadIfAvailable(t)},r.loadIfAvailable=function(t){for(var e in t.reqs)return;r.doLoad(t.name)},r.getObjs=function(t){var e=[];return t.forEach(function(t){var n=r.doLoad(t);e.push(n)}),e},r.reqsFromFunc=function(t){var e=[];return(t+"").replace(/require\s*\(\s*["']([^"']+)["']\s*\)/g,function(t,n){e.push(n)}),e},r.modules={},t("extend",[],function(){return function(t,e){for(var n in e)t[n]=e[n];return t}}),t("assert",[],function(){var t,e=function(t){this.failMesg=i(t||"Assertion failed: ")};e.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var e=t(arguments),n=e.shift();if(e=i(e),e=this.failMesg.concat(n).concat(e),console.log.apply(console,e),this.isDefensive())return n;if(this.isBool())return!1;throw new Error(e.join(" "))},subAssertion:function(){var n=t(arguments);return n=i(n),new e(this.failMesg.concat(n))},assert:function(t,e){return t||this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):!!this.isBool()||t},ne:function(t,e){return t===e?this.fail(t,"===",e):!!this.isBool()||t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):!!this.isBool()||t},is:function(t,e){var n=e,r=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),!!this.isBool()||t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var i=0;i<n.length;i++){var o=this.subAssertion("failed at ",t,"[",i,"]: ");null==n[i]&&console.log("WOW!7",r[i],n[i]),o.is(r[i],n[i])}return!!this.isBool()||t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),!!this.isBool()||t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),!!this.isBool()||t;if(n===Boolean||"boolean"==n)return this.assert("boolean"==typeof r,[r,"should be a boolean"]),!!this.isBool()||t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),!!this.isBool()||t;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),!!this.isBool()||t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),!!this.isBool()||t;if(n&&"object"==typeof n){for(var s in n){(o=this.subAssertion("failed at ",t,".",s,":")).is(t[s],n[s])}return!!this.isBool()||t}if("string"==typeof n){var a=this._regedType[n];return a?this.is(t,a):!!this.isBool()||t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&r(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},t=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var n=new e,r=function(){try{return n.assert.apply(n,arguments)}catch(t){throw new Error(t.stack)}};function i(t){if(t instanceof Array){var e=[];return t.forEach(function(t){e=e.concat(i(t))}),e}return[t]}return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){r[t]=function(){try{return n[t].apply(n,arguments)}catch(t){throw console.log(t.stack),new Error(t.message)}}}),r.fail=n.fail.bind(n),r.MODE_STRICT=n.MODE_STRICT,r.MODE_DEFENSIVE=n.MODE_DEFENSIVE,r.MODE_BOOL=n.MODE_BOOL,r.f=function(t){return{_assert_func:t}},r.opt=function(t){return r.f(function(e){return null==e||e instanceof t})},r.and=function(){var e=t(arguments);return r(e instanceof Array),r.f(function(t){for(var n=0;n<e.length;n++)this.is(t,e[n])})},r}),t("PathUtil",["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}var n,r=/^([a-zA-Z]):/,i=/^([a-z\-]+):\/\/\/?([^\/]+)\//,o=t.f(function(t){this.is(t,String),this.assert(n.isPath(t),[t," is not a path"])}),s=t.f(function(t){this.is(t,String),this.assert(n.isAbsolutePath(t),[t," is not a absolute path"])}),a=t.f(function(t){this.is(t,String),this.assert(!n.isAbsolutePath(t),[t," is not a relative path"])}),u=t.f(function(t){this.is(t,o),this.assert(n.isDir(t),[t," is not a directory path"])}),c=t.and(u,s),l=t.f(function(t){this.is(t,o),this.assert(!n.isDir(t),[t," is not a file path"])});return n={Path:o,Absolute:s,Relative:a,Dir:u,File:l,AbsDir:c,SEP:"/",endsWith:e,startsWith:function(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n},isChildOf:function(t,e){return this.startsWith(this.normalize(t),this.normalize(e))},normalize:function(t){return this.fixSep(t,"/").replace(/\/+$/,"/")},hasDriveLetter:function(t){return r.exec(t)},isURL:function(t){var e=i.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:"/"+t.substring(e[0].length)}},isPath:function(e){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),n.isPath(e)&&!n.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),n.isPath(e)&&(n.startsWith(e,"/")||n.hasDriveLetter(e)||n.isURL(e))},isDir:function(r){return r=n.fixSep(r),t.is(arguments,[o]),e(r,"/")},hasBackslashSep:function(t){return t.indexOf("\\")>=0},fixSep:function(e,n){return n=n||"/",t.is(arguments,[String]),t.is(e.replace(/[\\\/]/g,n),o)},directorify:function(e){return n.isDir(e)?e:t.is(e+"/",u)},filify:function(e){return n.isDir(e)?t.is(e.substring(0,e.length-1),l):e},splitPath:function(e){var n;if(t.is(arguments,[o]),n=this.isURL(e)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}var i=(e=e.replace(/\/+/g,"/")).split("/");return""==i[i.length-1]&&(i[i.length-2]+="/",i.pop()),i},name:function(e){return t.is(arguments,[String]),n.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var r=n.name(e),i=/\.[a-zA-Z0-9]+$/.exec(r);return i?i[0]:null},truncExt:function(e,r){t.is(e,String);var i=n.name(e);return r=r||n.ext(e),t.is(r,String),i.substring(0,i.length-r.length)},truncSEP:function(e){return t.is(arguments,[o]),n.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(r,i){return t.is(arguments,[String,String]),e(n.name(r),i)},parent:function(e){return t.is(arguments,[String]),n.up(e)},rel:function(e,r){if(""==r)return e;t.is(arguments,[c,a]);var i=n.splitPath(r),o=e;o=o.replace(/\/$/,"");var s=n;return i.forEach(function(t){".."==t||"../"==t?o=s.up(o):(o=o.replace(/\/$/,""),o+="/"+("."==t||"./"==t?"":t))}),o},relPath:function(e,r){return t.is(arguments,[s,s]),e.substring(0,r.length)!=r?"../"+n.relPath(e,this.up(r)):e.substring(r.length)},up:function(t){if("/"==t)return null;var e=n.splitPath(t);return e.pop(),e.join("/")+"/"}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(t){var e=n[t];n[t]=function(){var t=!1,r=Array.prototype.slice.call(arguments).map(function(e){return n.hasBackslashSep(e)?(t=!0,n.fixSep(e)):e}),i=e.apply(n,r);return t?n.fixSep(i,"\\"):i}}),n.isAbsolute=n.isAbsolutePath,n.isRelative=n.isRelativePath,"object"==typeof window&&(window.PathUtil=n),n}),t("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".wav":"audio/x-wav",".mp3":"audio/mp3",".ogg":"audio/ogg",".midi":"audio/midi",".mid":"audio/midi",".mzo":"audio/mzo",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu",".c":"text/c",".dtl":"text/dolittle"}}),t("DeferredUtil",[],function(){var t,e="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:null,n=function(t){this.res=t};function r(t){return t}return(t={isNativePromise:function(t){return t&&"function"==typeof t.then&&"function"!=typeof t.promise&&"function"==typeof t.catch},isJQPromise:function(t){return t&&"function"==typeof t.then&&"function"==typeof t.promise&&"function"==typeof t.fail},isPromise:function(t){return t&&"function"==typeof t.then&&("function"==typeof t.promise||"function"==typeof t.catch)},all:function(e){return t.promise(function(n,r){var i=[],o=e.length;e.forEach(function(e,s){t.resolve(e).then(function(t){i[s]=t,0===--o&&n(i)},r)})})},resolve:function(e){return t.config.useJQ&&t.isJQPromise(e)?e:!t.config.useJQ&&t.isNativePromise(e)?e:t.promise(function(n,r){t.isPromise(e)?e.then(n,r):n(e)})},throwNowIfRejected:function(e){var n,r,i=e.then(function(t){return n||(n="resolved"),t},function(e){if(n)return t.reject(e);n="rejected",r=e});if(n||(n="notyet"),"rejected"===n)throw r;return i},assertResolved:function(t){var e,n;if(t.then(function(t){e=t,n=!0}),!n)throw new Error("Promise not resolved");return e},ensureDefer:function(e){return t.promise(function(n,i){var o;t.resolve(e).then(function(t){o?n(t):setTimeout(function(){n(t)},0)}).then(r,function(t){o?i(t):setTimeout(function(){i(t)},0)}),o=!0})},directPromise:function(e){return t.timeout(e,0)},then:function(e){return t.directPromise().then(e)},timeout:function(e,n){return t.promise(function(t){setTimeout(function(){t(n)},e||0)})},funcPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;try{e(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(t){n.reject(t)}return n.promise()}if(t.external.Promise)return new t.external.Promise(function(t,n){try{e(t,n)}catch(t){n(t)}});throw new Error("promise is not found")},reject:function(e){if(t.config.useJQ){var n=new $.Deferred;return n.reject(e),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(e)},0),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(e){return console.log(e,e.stack),t.throwPromise(e)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(r){return r>=e.length?t.brk():t.resolve(n(e[r],r)).then(function(){return r+1})},0);var r=[];for(var i in e)r.push({k:i,v:e[i]});return t.each(r,function(t){return n(t.k,t.v)})},loop:function(e,i){try{for(var o;;){if(i instanceof n)return t.when1(i.res);var s=!0,a=!1,u=e(i),c=t.resolve(u).then(function(r){return s=!1,(i=r)instanceof n?i.res:a?t.loop(e,i):void 0}).then(r,function(t){s=!1,o=t});if(o)throw o;if(a=!0,s)return c}}catch(e){return t.reject(e)}},brk:function(t){return new n(t)},tryLoop:function(e,n){return t.loop(t.tr(e),n)},tryEach:function(e,n){return t.loop(e,t.tr(n))},documentReady:function(){return t.callbackToPromise(function(t){$(t)})},requirejs:function(n){if(!e.requirejs)throw new Error("requirejs is not loaded");return t.callbackToPromise(function(t){e.requirejs(n,t)})}}).NOP=function(t){return t},t.E=function(){console.log("DUE",arguments),t.errorHandler.apply(t,arguments)},t.errorHandler=function(t){console.error.apply(console,arguments),alert(t)},t.setE=function(e){t.errorHandler=e},t.begin=t.try=t.tr=t.throwF,t.promise=t.callbackToPromise=t.funcPromise,t.when1=t.resolve,t.config={},e.$&&e.$.Deferred&&(t.config.useJQ=!0),t.external={Promise:e.Promise},e.DeferredUtil||(e.DeferredUtil=t),t}),t("FSClass",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(t,e,n,r,i){var o=function(){},s={};function a(t){throw new Error(t+" is STUB!")}return o.addFSType=function(t,e){s[t]=e},o.availFSTypes=function(){return s},t(o.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},isReadOnly:function(t,e){a("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(t,e){return r(this.getRootFS()!==this),this.getRootFS().resolveFS(t)},mounted:function(t,e){this.rootFS=t,this.mountPoint=e},inMyFS:function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},getRootFS:function(){return r(this.rootFS,"rootFS is not set")},getReturnTypes:function(t,e){a("")},getContent:function(t,e){a("getContent")},size:function(t){return this.getContent(t,{type:ArrayBuffer}).toBin().byteLength},getContentAsync:function(t,e){return this.supportsSync()||a("getContentAsync"),i.resolve(this.getContent.apply(this,arguments))},setContent:function(t,e,n){a("")},setContentAsync:function(t,e,n){var r=this;return r.supportsSync()||a("setContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.setContent(t,e,n))})},appendContent:function(t,e,n){a("")},appendContentAsync:function(t,e,n){var r=this;return r.supportsSync()||a("appendContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.appendContent(t,e,n))})},getMetaInfo:function(t,e){a("")},setMetaInfo:function(t,e,n){a("")},mkdir:function(t,e){a("mkdir")},touch:function(t){a("touch")},exists:function(t,e){a("exists")},opendir:function(t,e){a("opendir")},opendirAsync:function(t,e){return this.supportsSync()||a("opendirAsync"),i.resolve(this.opendir.apply(this,arguments))},cp:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),i=i||{};var o=this.isDir(t),s=this.getRootFS().resolveFS(n),a=s.isDir(n);if(o||a)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(t),c=s.setContent(n,u);return i.a&&s.setMetaInfo(n,this.getMetaInfo(t)),c}return s.setContentAsync(n,this.getContentAsync(t)).then(function(e){return i.a?s.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(t,e){a("")},link:function(t,e,n){throw new Error("ln "+e+" "+t+" : This FS not support link.")},getURL:function(t){a("")},onAddObserver:function(t){}}),o.delegateMethods=function(t,n){for(var i in n)!function(i){r.ne(i,"inMyFS"),t[i]=function(){var t=arguments[0];r.is(t,e.Absolute);var o=this.resolveFS(t);return o!==this?(console.log("Invoked for other fs",this.mountPoint,o.mountPoint),o[i].apply(o,arguments)):n[i].apply(this,arguments)}}(i)},o.delegateMethods(o.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},getContentType:function(t,r){var i=(e.ext(t)+"").toLowerCase();return n[i]||(r||{}).def||"application/octet-stream"},getBlob:function(t,e){var n=this.getContent(t);return(e=e||{}).blobType=e.blobType||Blob,e.binType=e.binType||ArrayBuffer,n.hasPlainText()?new e.blobType([n.toPlainText()],this.getContentType(t)):new e.blobType([n.toBin(e.binType)],this.getContentType(t))},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t,n){return e.isDir(t)},find:function(t,n){r.is(arguments,[e.Absolute]);var i=this.opendir(t,n),o=this,s=[t];return i.forEach(function(r){var i=e.rel(t,r);if(e.isDir(i)){var a=o.resolveFS(i);s=s.concat(a.find(i,n))}else s.push(i)}),s},resolveLink:function(t){r.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){r(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var o=e.rel(i,e.relPath(t,n));return r(o!=t,"np==path=="+o),r.is(this.getRootFS().resolveFS(o).resolveLink(o),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(t){return null},opendirEx:function(t,n){r.is(t,e.AbsDir);var i=this,o={};return this.opendir(t).forEach(function(n){var r=e.rel(t,n);o[n]=i.getMetaInfo(r)}),o},getDirTree:function(t,n){var i=(n=n||{}).dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],r.is(n.excludes,Array),n.base||(n.base=t),r.is(t,e.AbsDir);var o=this.opendirEx(t,n);if("no-recursive"==n.style)return o;var s=this;for(var a in o){var u=o[a],c=e.rel(t,a),l=e.relPath(c,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(l)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(c)>=0)continue}if(s.isDir(c))switch(n.style){case"flat-absolute":case"flat-relative":s.getDirTree(c,n);break;case"hierarchical":n.dest={},i[a]=s.getDirTree(c,n)}else switch(n.style){case"flat-absolute":i[c]=u;break;case"flat-relative":i[l]=u;break;case"hierarchical":i[a]=u}}return i}}),o}),t("Util",[],function(){return{getQueryString:function(t,e){null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n,r=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);return null==r?e:(n=r[1],decodeURIComponent(n.replace(/\+/g,"%20")))},endsWith:function(t,e){return t.substring(t.length-e.length)===e},startsWith:function(t,e){return t.substring(0,e.length)===e},privatize:function(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){return r.apply(t,arguments)})}(n);return e},extend:function(t,e){for(var n in e||{})t[n]=e[n];return t}}}),t("FileSaver",[],function(){var t="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:this;function e(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){i(r.response,e,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(t){var e=new XMLHttpRequest;return e.open("HEAD",t,!1),e.send(),e.status>=200&&e.status<=299}function r(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var i=t.saveAs||"object"!=typeof window||window!==t?function(){}:"download"in HTMLAnchorElement.prototype?function(i,o,s){var a=t.URL||t.webkitURL,u=document.createElement("a");o=o||i.name||"download",u.download=o,u.rel="noopener","string"==typeof i?(u.href=i,u.origin!==location.origin?n(u.href)?e(i,o,s):r(u,u.target="_blank"):r(u)):(u.href=a.createObjectURL(i),setTimeout(function(){a.revokeObjectURL(u.href)},4e4),setTimeout(function(){r(u)},0))}:"msSaveOrOpenBlob"in navigator?function(t,i,o){if(i=i||t.name||"download","string"==typeof t)if(n(t))e(t,i,o);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout(function(){r(s)})}else navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Depricated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t}(t,o),i)}:function(n,r,i,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof n)return e(n,r,i);var s="application/octet-stream"===n.type,a=/constructor/i.test(t.HTMLElement)||t.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||s&&a)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var t=c.result;t=u?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=t:location=t,o=null},c.readAsDataURL(n)}else{var l=t.URL||t.webkitURL,f=l.createObjectURL(n);o?o.location=f:location.href=f,o=null,setTimeout(function(){l.revokeObjectURL(f)},4e4)}};return t.saveAs=i.saveAs=i,"undefined"!=typeof module&&(module.exports=i),i}),t("Content",["assert","Util","FileSaver"],function(t,e,n){var r=function(){},i=e.extend;r.plainText=function(t,e){var n=new r;return n.contentType=e||"text/plain",n.plain=t,n},r.url=function(t){var e=new r;return e.url=t,e},r.buffer2ArrayBuffer=function(e){if(r.isBuffer(e)){var n=new Uint8Array(e),i=n.buffer;if(i instanceof ArrayBuffer)return i;var o=Array.prototype.slice.call(n);return t(new Uint8Array(o).buffer,"n2a: buf is not set")}return t(e,"n2a: a is not set")},r.arrayBuffer2Buffer=function(e){return e instanceof ArrayBuffer?new Buffer(new Uint8Array(e)):t(e,"a2n: a is not set")},r.bin=function(e,n){t(n,"contentType should be set");var i=new r;if(r.isNodeBuffer(e))i.bufType="node",i.nodeBuffer=e;else if(e instanceof ArrayBuffer)i.bufType="array2",i.arrayBuffer=e;else{if(!e||!r.isBuffer(e.buffer))throw new Error(e+" is not a bin");i.bufType="array1",i.arrayBuffer=e.buffer}return i.contentType=n,i},r.looksLikeDataURL=function(t){return t.match(/^data:/)},r.download=n;var o=r.prototype;o.toBin=function(t){if(t=t||(r.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return t===Buffer?this.nodeBuffer:this.arrayBuffer=r.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return t===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=r.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var e=new a(this.url,t);return this.setBuffer(e.buffer)}if(null!=this.plain)return this.setBuffer(r.str2utf8bytes(this.plain,t));throw new Error("No data")},o.setBuffer=function(e){return t(e,"b is not set"),r.isNodeBuffer(e)?this.nodeBuffer=e:this.arrayBuffer=e},o.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},o.toNodeBuffer=function(){return this.toBin(Buffer)},o.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=r.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var t=new a(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=t.url}throw new Error("No data")},o.toPlainText=function(){if(this.hasPlainText())return this.plain;if(this.url&&!this.hasBin()){var t=new a(this.url,ArrayBuffer);this.arrayBuffer=t.buffer}if(this.hasBin())return this.plain=r.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},o.hasURL=function(){return this.url},o.hasPlainText=function(){return null!=this.plain},o.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},o.hasNodeBuffer=function(){return this.nodeBuffer},o.hasArrayBuffer=function(){return this.arrayBuffer},o.toBlob=function(){return new Blob([this.toBin(ArrayBuffer)],{type:this.contentType})},o.download=function(t){r.download(this.toBlob(),t)},r.Base64_To_ArrayBuffer=function(t,e){var n=e||ArrayBuffer;t=t.replace(/[\n=]/g,"");var i=new Object;i[65]=0,i[66]=1,i[67]=2,i[68]=3,i[69]=4,i[70]=5,i[71]=6,i[72]=7,i[73]=8,i[74]=9,i[75]=10,i[76]=11,i[77]=12,i[78]=13,i[79]=14,i[80]=15,i[81]=16,i[82]=17,i[83]=18,i[84]=19,i[85]=20,i[86]=21,i[87]=22,i[88]=23,i[89]=24,i[90]=25,i[97]=26,i[98]=27,i[99]=28,i[100]=29,i[101]=30,i[102]=31,i[103]=32,i[104]=33,i[105]=34,i[106]=35,i[107]=36,i[108]=37,i[109]=38,i[110]=39,i[111]=40,i[112]=41,i[113]=42,i[114]=43,i[115]=44,i[116]=45,i[117]=46,i[118]=47,i[119]=48,i[120]=49,i[121]=50,i[122]=51,i[48]=52,i[49]=53,i[50]=54,i[51]=55,i[52]=56,i[53]=57,i[54]=58,i[55]=59,i[56]=60,i[57]=61,i[43]=62,i[47]=63;var o,s=t.length,a=0,u=0;if(!s)return new n(0);o=Math.floor(s/4*3),"="==t.charAt(s-1)&&(o-=1),"="==t.charAt(s-2)&&(o-=1);for(var c=new n(o),l=r.isNodeBuffer(c)?c:new Uint8Array(c),f=0,p=0;p<o&&(void 0===(u=i[t.charCodeAt(f)])&&h("Invalid letter: "+t.charCodeAt(f)),a=u<<2,f++,void 0===(u=i[t.charCodeAt(f)])&&h("Invalid letter: "+t.charCodeAt(f)),l[p]=a|u>>4&3,a=(15&u)<<4,f++,!(++p>=o))&&(void 0===(u=i[t.charCodeAt(f)])&&h("Invalid letter: "+t.charCodeAt(f)),l[p]=a|u>>2&15,a=(3&u)<<6,f++,!(++p>=o));)void 0===(u=i[t.charCodeAt(f)])&&h("Invalid letter: "+t.charCodeAt(f)),l[p]=a|u,f++,p++;function h(e){throw console.log(e),console.log(t,f),new Error(e)}return c},r.Base64_From_ArrayBuffer=function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,s=0,a=0;a<i&&(n+=e[(s=r[a])>>2],o=(3&s)<<4,!(++a>=i))&&(n+=e[o|(s=r[a])>>4],o=(15&s)<<2,!(++a>=i));)n+=e[o|(s=r[a])>>6],n+=e[63&s],a++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n},r.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},r.isNodeBuffer=function(t){return r.hasNodeBuffer()&&t instanceof Buffer},r.isBuffer=function(t){return t instanceof ArrayBuffer||r.isNodeBuffer(t)},r.utf8bytes2str=function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));return decodeURIComponent(e.join(""))},r.str2utf8bytes=function(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer};var s=r.hasNodeBuffer()?Buffer:ArrayBuffer,a=function(e,n){"string"==typeof e?(this.url=e,this.binType=n||s,this.dataURL2bin(e)):e&&r.isBuffer(e.buffer)?(this.buffer=e.buffer,t.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):r.isBuffer(e)?(this.buffer=e,t.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),t.fail("Invalid args: ",arguments))};return r.DataURL=a,i(a.prototype,{bin2dataURL:function(e,n){t(r.isBuffer(e)),t.is(n,String);var i=this.dataHeader(n),o=r.Base64_From_ArrayBuffer(e);return t.is(o,String),this.url=i+o},dataURL2bin:function(e){t.is(arguments,[String]);var n=/^data:([^;]+);base64,/i.exec(e);return t(n,["malformed dataURL:",e]),this.contentType=n[1],this.buffer=r.Base64_To_ArrayBuffer(e.substring(n[0].length),this.binType),t.is(this.buffer,this.binType)},dataHeader:function(e){return t.is(arguments,[String]),"data:"+e+";base64,"},toString:function(){return t.is(this.url,String)}}),r}),t("NativeFS",["FSClass","assert","PathUtil","extend","Content"],function(t,e,n,r,i){var o,s=e;try{(o=global.require("fs")).existsSync("test.txt")}catch(t){return function(){throw new Error("This system not support native FS")}}var a=function(t){t&&(e.is(t,n.AbsDir),this.rootPoint=t)},u=n.hasDriveLetter(process.cwd());a.available=!0;var c=n.SEP,l=a.prototype=new t;function f(t){return t}return l.toNativePath=function(t){return this.rootPoint?(e.is(t,n.Absolute),e(this.inMyFS(t),t+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(t,this.mountPoint||n.SEP))):t},l.arrayBuffer2Buffer=function(t){return t instanceof ArrayBuffer?new Buffer(new Uint8Array(t)):t},t.addFSType("NativeFS",function(t,e){return new a(e.r)}),a.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},a.prototype.inMyFS=function(t){return this.mountPoint?n.startsWith(t,this.mountPoint):!(!!u^!!n.hasDriveLetter(t))},t.delegateMethods(a.prototype,{getReturnTypes:function(t,e){return f(t),s.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,r){r=r||{},e.is(t,n.Absolute);var s=this.toNativePath(t);return this.assertExist(t),i.bin(o.readFileSync(s),this.getContentType(t))},size:function(t){var e=this.toNativePath(t);return o.statSync(e).size},setContent:function(t,r){e.is(arguments,[n.Absolute,i]);var s=n.up(t);s&&this.getRootFS().resolveFS(s).mkdir(s);var a=this.toNativePath(t);r.hasBin()||!r.hasPlainText()?o.writeFileSync(a,r.toNodeBuffer()):o.writeFileSync(a,r.toPlainText())},appendContent:function(t,r){e.is(arguments,[n.Absolute,i]);var s=n.up(t);s&&this.getRootFS().resolveFS(s).mkdir(s);var a=this.toNativePath(t);r.hasBin()||!r.hasPlainText()?o.appendFileSync(a,r.toNodeBuffer()):o.appendFileSync(a,r.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(t,e,n){f(t)},isReadOnly:function(t){return f(t),!1},stat:function(t){e.is(t,n.Absolute);var r=this.toNativePath(t);return o.statSync(r)},mkdir:function(t,e){if(e=e||{},s.is(arguments,[n.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var r=n.up(t);r&&this.getRootFS().resolveFS(r).mkdir(r);var i=this.toNativePath(t);return o.mkdirSync(i),this.assertExist(i)},opendir:function(t,e){s.is(arguments,[String]),e=e||{};var r=this.toNativePath(t),i=n.truncSEP(r),a=o.readdirSync(r);e.nosep||(a=a.map(function(t){return t+(o.statSync(i+c+t).isDirectory()?c:"")}));return s.is([].concat(a),Array)},rm:function(t,e){s.is(arguments,[n.Absolute]),e=e||{},this.assertExist(t);var r=this.toNativePath(t);return this.isDir(t)?o.rmdirSync(r):o.unlinkSync(r)},exists:function(t,e){e=e||{};var n=this.toNativePath(t);return o.existsSync(n)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():n.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&o.utimesSync(t,Date.now()/1e3,Date.now()/1e3)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")},onAddObserver:function(t,e){var i=this,s=i.getRootFS();e=e||{};var a=this.isDir(t),u=o.watch(t,e,function(e,o){var u,c=a?n.rel(t,o):t;u=i.exists(c)?r({eventType:e},i.getMetaInfo(c)):{eventType:e},s.notifyChanged(c,u)});return{remove:function(){u.close()}}}}),a}),t("LSFS",["FSClass","PathUtil","extend","assert","Util","Content"],function(t,e,n,r,i,o){var s=function(t,e){r(t," new LSFS fail: no storage"),this.storage=t,this.options=e||{},this.options.useDirCache&&(this.dirCache={})},a=e.isDir.bind(e),u=e.up.bind(e),c=e.endsWith.bind(e),l=e.Absolute,f=e.SEP;function p(){return(new Date).getTime()}return s.ramDisk=function(t){var n={};return n[e.SEP]="{}","useDirCache"in(t=t||{})||(t.useDirCache=!0),new s(n,t)},t.addFSType("localStorage",function(t,e){return new s(localStorage,e)}),t.addFSType("ram",function(t,e){return s.ramDisk(e)}),s.now=p,(s.prototype=new t).resolveKey=function(t){return r.is(t,e.Absolute),this.mountPoint?e.SEP+e.relPath(t,this.mountPoint):t},s.prototype.getItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},s.prototype.setItem=function(t,n){r.is(t,e.Absolute);var i=this.resolveKey(t);r(i.indexOf("..")<0),r(e.startsWith(i,e.SEP)),this.storage[i]=n},s.prototype.removeItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},s.prototype.itemExists=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return r(this.storage,"No storage"),n in this.storage},s.prototype.getDirInfo=function(t){if(r.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");if(c(t,f)||(t+=f),r(this.inMyFS(t)),this.dirCache&&this.dirCache[t])return this.dirCache[t];var n,i={};try{(n=this.getItem(t))&&(i=JSON.parse(n))}catch(e){console.log("dinfo err : ",t,n)}return this.dirCache&&(this.dirCache[t]=i),i},s.prototype.putDirInfo=function(t,n,i){if(r.is(arguments,[e.AbsDir,Object]),!a(t))throw new Error("Not a directory : "+t);r(this.inMyFS(t)),this.dirCache&&(this.dirCache[t]=n),this.setItem(t,JSON.stringify(n));var o=u(t);if(null!=o&&this.inMyFS(o)){var s=this.getDirInfo(o);this._touch(s,o,e.name(t),i)}},s.prototype._touch=function(t,i,o,s){r.is(arguments,[Object,String,String]),r(this.inMyFS(i));var a="change";t[o]||(a="create",t[o]={},s&&(t[o].trashed=!0)),s||delete t[o].trashed,t[o].lastUpdate=p();var u=n({eventType:a},t[o]);this.getRootFS().notifyChanged(e.rel(i,o),u),this.putDirInfo(i,t,s)},s.prototype.removeEntry=function(t,n,i){r.is(arguments,[Object,String,String]),t[i]&&(t[i]={lastUpdate:p(),trashed:!0},this.getRootFS().notifyChanged(e.rel(n,i),{eventType:"trash"}),this.putDirInfo(n,t,!0))},s.prototype.removeEntryWithoutTrash=function(t,n,i){r.is(arguments,[Object,String,String]),t[i]&&(delete t[i],this.getRootFS().notifyChanged(e.rel(n,i),{eventType:"delete"}),this.putDirInfo(n,t,!0))},s.prototype.isRAM=function(){return this.storage!==localStorage},s.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},s.getUsage=function(){var t=0;for(var e in localStorage)"string"==typeof localStorage[e]&&(t+=localStorage[e].length);return t},s.getCapacity=function(){var t=0,e="a",n="___checkls___",r=0,i=Math.pow(2,25);try{for(var o=0;o<10;o++)e+=e;for(var o in localStorage)o.substring(0,n.length)==n?delete localStorage[o]:"string"==typeof localStorage[o]&&(r+=localStorage[o].length);for(var s=r;a()&&e.length<i;)e+=e;for(;e.length>1024;)e=e.substring(e.length/2),a();return{using:s,max:r}}finally{for(o=0;o<t;o++)delete localStorage[n+o]}function a(){try{return localStorage[n+t]=e,t++,r+=e.length,!0}catch(e){return delete localStorage[n+t],!1}}},t.delegateMethods(s.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(t,e){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t,e){r.is(arguments,[l]),this.assertExist(t);var n=this.getItem(t);return o.looksLikeDataURL(n)?o.url(n):o.plainText(n)},setContent:function(t,e,n){r.is(arguments,[l,o]),this.assertWriteable(t);var i=null;e.hasPlainText()&&(i=e.toPlainText(),o.looksLikeDataURL(i)&&(i=null)),null!=i?this.setItem(t,i):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t,n){if(this.assertExist(t,{includeTrashed:!0}),r.is(arguments,[l]),t==e.SEP)return{};var i=r(e.up(t));if(!this.inMyFS(i))return{};var o=e.name(t);r.is(i,e.AbsDir);var s=this.getDirInfo(i);return r(s[o])},setMetaInfo:function(t,n,i){r.is(arguments,[String,Object]),this.assertWriteable(t);var o=r(e.up(t));if(this.inMyFS(o)){var s=this.getDirInfo(o),a=e.name(t);s[a]=n,this.putDirInfo(o,s,s[a].trashed)}},mkdir:function(t,e){r.is(arguments,[l]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){r.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),i=[];for(var o in n)r(n[o]),n[o].trashed&&!e.includeTrashed||i.push(o);return r.is(i,Array)},rm:function(t,n){r.is(arguments,[l]),n=n||{},this.assertWriteable(t);var i=e.up(t);if(null==i||!this.inMyFS(i))throw new Error(t+": cannot remove. It is root of this FS.");(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t))?(this.opendir(t).length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)):this.removeItem(t);var o=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(o,i,e.name(t)):this.removeEntry(o,i,e.name(t))},exists:function(t,n){r.is(arguments,[l]),n=n||{};var i=e.name(t),o=e.up(t);if(null==o||!this.inMyFS(o))return!0;var s=this.getDirInfo(o)[i];return s&&s.trashed&&this.itemExists(t)&&this.isDir(t),!s&&this.itemExists(t),s&&!s.trashed&&!s.link&&this.itemExists(t),s&&!n.includeTrashed&&(s=!s.trashed),!!s},link:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var o={};o.link=n,o.lastUpdate=p(),this.setMetaInfo(t,o),r(this.exists(t)),r(this.isLink(t))},isLink:function(t){return r.is(arguments,[e.Absolute]),this.exists(t)?r(this.getMetaInfo(t)).link:null},touch:function(t){r.is(arguments,[l]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?(this.dirCache&&(this.dirCache[t]={}),this.setItem(t,"{}")):this.setItem(t,""));var n=u(t);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,e.name(t),!1)}else r(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(t){return this.getContent(t).toURL()},opendirEx:function(t,n){r.is(t,e.AbsDir),n=n||{};var i={},o=this.getDirInfo(t);if(n.includeTrashed)return o;for(var s in o)o[s].trashed||(i[s]=o[s]);return i}}),s}),"undefined"!=typeof $&&$.ajaxTransport("+binary",function(t,e,n){if(window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob)))return{send:function(e,n){var r=new XMLHttpRequest,i=t.url,o=t.type,s=t.async||!0,a=t.responseType||"blob",u=t.data||null,c=t.username||null,l=t.password||null;for(var f in r.addEventListener("load",function(){var e={};e[t.dataType]=r.response,n(r.status,r.statusText,e,r.getAllResponseHeaders())}),r.open(o,i,s,c,l),e)r.setRequestHeader(f,e[f]);r.responseType=a,r.send(u)},abort:function(){n.abort()}}}),t("jquery.binarytransport",function(){}),t("WebFS",["FSClass","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(t,e,n,r,i){var o=function(){},s=o.prototype=new t;return t.addFSType("web",function(){return new o}),s.fstype=function(){return"Web"},s.supportsSync=function(){return!1},s.inMyFS=function(t){return i.isURL(t)},t.delegateMethods(s,{exists:function(){return!0},getContentAsync:function(t){var e=this;return n.promise(function(n,i){$.get(t,function(i){var o=new FileReader;o.addEventListener("loadend",function(){n(r.bin(o.result,e.getContentType(t)))}),o.readAsArrayBuffer(i)},"binary").fail(i)})},getURL:function(t){return t}}),o}),t("Env",["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=(n=(n=this.expand(n)).replace(/\/+/g,"/")).replace(/^[a-z][a-z]+:\//,function(t){return t+"/"}),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n}),t("SFile",["extend","assert","PathUtil","Util","Content","FSClass","FileSaver","DeferredUtil"],function(t,e,n,r,i,o,s,a){var u=function(t,r){e.is(r,n.Absolute),this._path=r,this.rootFS=t,this.fs=t.resolveFS(r),this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return u.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},u.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},getPolicy:function(t){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(t,i){var o;if(i=i||{},u.is(t))o=t;else{var s;e.is(t,n.Absolute);var a=i.policy||this.policy;if(a&&(s=a.topDir)&&(s.path&&(s=s.path()),!n.startsWith(t,s)))throw new Error(t+": cannot access. Restricted to "+s);(o=new u(this.rootFS,t)).policy=a}return o.policy?r.privatize(o):o},contains:function(t){return e(u.is(t),t+" shoud be a SFile object."),!!this.isDir()&&n.startsWith(t.path(),this.path())},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var r=t.path?t.path():t;return n.relPath(this.path(),e.is(r,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,t))},sibling:function(t){return this.up().rel(t)},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var t=this.metaInfo();return!!t&&t.trashed},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.act.fs.getMetaInfo(this.act.path,t)},setMetaInfo:function(t,e){return this.act.fs.setMetaInfo(this.act.path,t,e)},getDirTree:function(t){return this.act.fs.getDirTree(this.act.path,t)},assertExists:function(){e(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(t){var e=Array.prototype.slice.call(arguments);if("function"==typeof e[0]){var n=e.shift();return a.resolve(this.exists.apply(this,e)).then(n)}t=t||{};var r=this.fs.exists(this.path(),t);return r||t.noFollowLink?r:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(t){var e=this;return t=t||{},this.isLink()?a.resolve(this.fs.rm(this.path(),t)):(this.isDir()&&(t.recursive||t.r)?this.each(function(e){return e.rm(t)}):a.resolve()).then(function(){return e.act.fs.rm(e.act.path,t)})},removeWithoutTrash:function(t){(t=t||{}).noTrash=!0,this.rm(t)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(t){return"function"==typeof t?this.getText(t):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(t){if(e.is(t,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());var n=this.contentType({def:null});return null!==n&&!n.match(/^text/)&&i.looksLikeDataURL(t)?a.throwNowIfRejected(this.setContent(i.url(t))):a.throwNowIfRejected(this.setContent(i.plainText(t)))},appendText:function(t){return e.is(t,String),this.act.fs.appendContent(this.act.path,i.plainText(t))},getContent:function(t){return"function"==typeof t?this.act.fs.getContentAsync(this.act.path).then(t):this.act.fs.getContent(this.act.path)},setContent:function(t){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,t)},getText:function(t){if("function"==typeof t){return this.getContent(e).then(t)}return e(this.act.fs.getContent(this.act.path));function e(t){try{return t.toPlainText()}catch(e){return t.toURL()}}},getDataURL:function(t){return"function"==typeof t?this.getContent(function(t){return t.toURL()}):this.getContent().toURL()},setDataURL:function(t){return this.setContent(i.url(t))},dataURL:function(t){return"string"==typeof t?this.setDataURL(t):"function"==typeof t?this.getDataURL(t):this.getDataURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(t){return this.act.fs.getContentType(this.act.path,t)},bytes:function(t){return i.isBuffer(t)?this.setBytes(t):this.getBytes()},setBytes:function(t){return this.act.fs.setContent(this.act.path,i.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.act.fs.getContent(this.act.path).toBin(t.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(t){return t instanceof Array?this.text(t.join("\n")):"function"==typeof t?this.text(function(e){return t(e.replace(/\r/g,"").split("\n"))}):this.text().replace(/\r/g,"").split("\n")},obj:function(){if(0==arguments.length){var t=this.text();return t?JSON.parse(t):null}this.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,n){e(t&&t.isSFile(),t+" is not a file");var r=this,i=(n=n||{},r.isDir()),o=t.isDir();if(!i&&o&&(t=t.rel(r.name()),e(!t.isDir(),t+" is a directory."),o=!1),!i||o){if(i||o)return e(i&&o,"Both src and dst should be dir"),r.each(function(e){var r,i=t.rel(e.name());return n.progress&&(r=n.progress(i,{src:e,dst:i})),a.resolve(r).then(function(){return i.copyFrom(e,n)})});n.echo&&n.echo(r+" -> "+t);var s=this.act.fs.cp(this.act.path,t.getResolvedLinkPath(),n);return s=a.resolve(s),n.a?s.then(function(){return t.setMetaInfo(r.getMetaInfo())}):s}this.err("Cannot move dir "+r.path()+" to file "+t.path())},moveFrom:function(t,e){var n=this;return n.exists(function(r){return n.copyFrom(t,e).then(function(){return t.rm({recursive:!0})},function(t){if(!r)return n.exists(function(t){if(t)return n.rm({recursive:!0})}).then(function(){throw t});throw t})})},moveTo:function(t,e){return t.moveFrom(this,e)},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){return this.assertDir().listFilesAsync(e).then(function(e){return a.each(e,t)})},eachrev:function(t,e){return this.assertDir().listFilesAsync(e).then(function(e){return a.each(e.reverse(),t)})},recursive:function(t,e){var n=this.assertDir();return e=n.convertOptions(e),n.each(function(n){return n.isDir()?n.recursive(t,e):t(n)},e)},_listFiles:function(t,n){e(null==t||"object"==typeof t);var r,i=this.assertDir();this.path();return t=i.convertOptions(t),r||(r=t.order),n?this.act.fs.opendirAsync(this.act.path,t).then(o):o(this.act.fs.opendir(this.act.path,t));function o(e){for(var n=[],o=0;o<e.length;o++){var s=e[o],a=i.rel(s);t.excludesF(a)||n.push(a)}return"function"==typeof r&&n.sort&&n.sort(r),n}},listFilesAsync:function(t){return this._listFiles(t,!0)},listFiles:function(t){return this._listFiles(t,!1)},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir();return t?n.listFiles(t).map(function(t){return t.name()}):this.act.fs.opendir(this.act.path,t)},convertOptions:function(t){var i=r.extend({},t),o=(this.assertDir(),this.path()),s=i.excludes||{};if("function"==typeof s)i.excludesF=s;else if("object"==typeof s){if(s instanceof Array){var a={};s.forEach(function(t){n.startsWith(t,"/")?a[t]=1:a[o+t]=1}),s=a}i.excludesF=function(t){return s[t.path()]}}return e.is(i,{excludesF:Function})},mkdir:function(){return this.touch()},link:function(t,e){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,t.path(),e)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(t){return this.getFS().getRootFS().addObserver(this.path(),t)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},setBlob:function(t){var e=this;return a.promise(function(n,r){var i=new FileReader;i.addEventListener("loadend",function(){a.resolve(e.setBytes(i.result)).then(n)}),i.readAsArrayBuffer(t)})},size:function(t){if(!t){if(this.isDir()){var e=0;return this.each(function(t){e+=t.size()}),e}return this.act.fs.size(this.act.path)}},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use 'zip' instead.");s(this.getBlob(),this.name())},err:function(){var t=Array.prototype.slice.call(arguments);throw console.log.apply(console,t),new Error(t.join(""))},exportAsObject:function(t){var e=this,n={};return this.recursive(function(t){n[t.relPath(e)]=t.text()},t),{base:e.path(),data:n}},importFromObject:function(t,e){"string"==typeof t&&(t=JSON.parse(t));t=t.data;for(var n in t)this.rel(n).text(t[n])},watch:function(t,e){var n=function(){};"function"==typeof t&&(n=t),"function"==typeof e&&(n=e);var r=this.getFS().getRootFS();r.addObserver(this.path(),function(t,e){n(e.eventType,r.get(t),e)})}},Object.defineProperty(u.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),e.is(this._act,{fs:o,path:n.Absolute}),this._act)}}),u}),t("RootFS",["assert","FSClass","PathUtil","SFile"],function(t,e,n,r){var i=function(n){t.is(n,e),this.mount(null,n)},o=i.prototype,s={err:function(t,e){throw new Error(t+": "+e)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(e,r){t.is(arguments,[n.AbsDir]);var i=this.fstab();console.log(i);for(var o=0;o<i.length;o++)if(i[o].mountPoint==e)return i.splice(o,1),!0;return!1},availFSTypes:function(){return e.availFSTypes()},mount:function(n,r,i){"string"==typeof r&&(r=t(e.availFSTypes()[r],"fstype "+r+" is undefined.")(n,i||{}));t.is(r,e),r.mounted(this,n),this.fstab().unshift(r)},resolveFS:function(r,i){var o;return t.is(r,n.Absolute),this.fstab().forEach(function(t){o||t.inMyFS(r)&&(o=t)}),o||this.err(r,"Cannot resolve"),t.is(o,e)},get:function(e){return t.is(e,n.Absolute),new r(this.resolveFS(e),e)},addObserver:function(e,n,r){this.observers=this.observers||[];var i,o,s={};"string"==typeof e&&(i=e),"string"==typeof n&&(i=n),"string"==typeof r&&(i=r),"object"==typeof e&&(s=e),"object"==typeof n&&(s=n),"object"==typeof r&&(s=r),"function"==typeof e&&(o=e),"function"==typeof n&&(o=n),"function"==typeof r&&(o=r),t.is(i,String),t.is(o,Function);var a=this.resolveFS(i).onAddObserver(i,s),u=this.observers,c={path:i,handler:o,remove:function(){var t=u.indexOf(this);u.splice(t,1),a&&a.remove()}};return this.observers.push(c),c},notifyChanged:function(t,e){this.observers&&this.observers.forEach(function(r){n.isChildOf(t,r.path)&&r.handler(t,e)})},getRootFS:function(){return this}};for(var a in s)o[a]=s[a];return i}),t("zip",["SFile","FileSaver","Util","DeferredUtil"],function(t,e,n,r){var i={setJSZip:function(t){i.JSZip=t,r.external.Promise||(r.external.Promise=t.external.Promise)}};return"undefined"!=typeof JSZip&&i.setJSZip(JSZip),i.zip=function(e,n,o){t.is(n)||(o=n),o=o||{};var s=new i.JSZip;return function t(e,n){return n.each(function(n){var i=r.resolve();return o.progress&&(i=o.progress(n)),i.then(function(){return n.isDir()?t(e.folder(n.name().replace(/[\/\\]$/,"")),n):n.getContent(function(t){e.file(n.name(),t.toArrayBuffer())})})})}(s,e).then(function(){return r.resolve(s.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(r){if(t.is(n))return n.setBytes(r);saveAs(new Blob([r],{type:"application/zip"}),e.name().replace(/[\/\\]$/,"")+".zip")})},i.unzip=function(e,n,o){var s={};o=o||{},t.is(e)&&(e=e.getContent().toArrayBuffer()),o.onCheckFile||(o.onCheckFile=function(t){return o.overwrite?t:!t.exists()&&t});var a=new i.JSZip;return r.resolve(a.loadAsync(e)).then(function(){return r.each(a.files,function(e,i){var a,u;return r.resolve(i.async("arraybuffer")).then(function(t){if(a=t,u=n.rel(i.name),o.progress)return r.resolve(o.progress(u))}).then(function(){if(console.log("Inflating",i.name),!u.isDir()){var e={file:u,status:"uploaded"};s[u.path()]=e;var n=FS.Content.bin(a,u.contentType()),r=o.onCheckFile(u,n);return!1===r&&(e.status="cancelled",u=null),t.is(r)&&(u.path()!==r.path()&&(e.redirectedTo=r),u=r),u?u.setContent(n):void 0}})})}).then(function(){return console.log("unzip done",s),s})},i}),t("promise",[],function(){setTimeout;function t(t){return Boolean(t&&void 0!==t.length)}function e(){}function n(t){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],a(t,this)}function r(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,n._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void o(e.promise,t)}i(e.promise,r)}else(1===t._state?i:o)(e.promise,t._value)})):t._deferreds.push(e)}function i(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof n)return t._state=3,t._value=e,void s(t);if("function"==typeof r)return void a((i=r,u=e,function(){i.apply(u,arguments)}),t)}t._state=1,t._value=e,s(t)}catch(e){o(t,e)}var i,u}function o(t,e){t._state=2,t._value=e,s(t)}function s(t){2===t._state&&0===t._deferreds.length&&n._immediateFn(function(){t._handled||n._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)r(t,t._deferreds[e]);t._deferreds=null}function a(t,e){var n=!1;try{t(function(t){n||(n=!0,i(e,t))},function(t){n||(n=!0,o(e,t))})}catch(t){if(n)return;n=!0,o(e,t)}}return n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,n){var i=new this.constructor(e);return r(this,new function(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}(t,n,i)),i},n.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})},n.all=function(e){return new n(function(n,r){if(!t(e))return r(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return n([]);var o=i.length;function s(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var a=e.then;if("function"==typeof a)return void a.call(e,function(e){s(t,e)},r)}i[t]=e,0==--o&&n(i)}catch(t){r(t)}}for(var a=0;a<i.length;a++)s(a,i[a])})},n.resolve=function(t){return t&&"object"==typeof t&&t.constructor===n?t:new n(function(e){e(t)})},n.reject=function(t){return new n(function(e,n){n(t)})},n.race=function(e){return new n(function(r,i){if(!t(e))return i(new TypeError("Promise.race accepts an array"));for(var o=0,s=e.length;o<s;o++)n.resolve(e[o]).then(r,i)})},n._immediateFn=function(t){t()},n._unhandledRejectionFn=function(){"undefined"!=typeof console&&console},n}),t("FS",["FSClass","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil","promise"],function(t,e,n,r,i,o,s,a,u,c,l,f,p){var h,d={};d.assert=s,d.Content=c,d.Class=t,d.DeferredUtil=f,f.config.useJQ||(f.external.Promise=p),d.Env=o,d.LSFS=n,d.NativeFS=e,d.PathUtil=i,d.RootFS=u,d.SFile=a,d.WebFS=r,d.zip=l,"object"==typeof window&&(window.FS=d);var g=new o({});return d.addFSType=t.addFSType,d.availFSTypes=t.availFSTypes,d.setEnvProvider=function(t){g=t},d.getEnvProvider=function(){return g},d.setEnv=function(t,e){if("object"==typeof t)for(var n in t)g.set(n,t[n]);else g.set(t,e)},d.getEnv=function(t){return"string"==typeof t?g.get(t):g.value},d.init=function(t){h||(t||(e.available?t=new e:"object"==typeof localStorage?t=new n(localStorage):"function"==typeof importScripts&&(self.addEventListener("message",function(t){var e=t.data;switch("string"==typeof e&&(e=JSON.parse(e)),e.type){case"upload":d.get(e.base).importFromObject(e.data);break;case"observe":h.observe(e.path,function(t,e){self.postMessage(JSON.stringify({type:"changed",path:t,content:d.get(t).text(),meta:e}))})}}),t=n.ramDisk())),h=new u(t))},d.getRootFS=function(){return d.init(),h},d.get=function(){return d.init(),h.get.apply(h,arguments)},d.expandPath=function(){return g.expandPath.apply(g,arguments)},d.resolve=function(t,e){return d.init(),a.is(t)?t:(t=g.expandPath(t),e&&!i.isAbsolutePath(t)?(e=g.expandPath(e),d.get(e).rel(t)):d.get(t))},d.mount=function(){return d.init(),h.mount.apply(h,arguments)},d.unmount=function(){return d.init(),h.unmount.apply(h,arguments)},d.isFile=function(t){return a.is(t)},d}),e(["FS"],function(t){n=t}),"undefined"!=typeof window&&void 0===window.FS&&(window.FS=n),"undefined"!=typeof module&&(module=n),n}),function(){return function t(e,r,i){function o(a,u){if(!r[a]){if(!e[a]){var c="function"==typeof n&&n;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[a]={exports:{}};e[a][0].call(f.exports,function(t){return o(e[a][1][t]||t)},f,f.exports,t,e,r,i)}return r[a].exports}for(var s="function"==typeof n&&n,a=0;a<i.length;a++)o(i[a]);return o}}()({1:[function(t,e,n){const r=function(t){this.failMesg=a(t||"Assertion failed: ")};var i;r.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var t=i(arguments),e=t.shift();if(t=a(t),t=this.failMesg.concat(e).concat(t).concat(["mode",this._mode]),console.log.apply(console,t),this.isDefensive())return e;if(this.isBool())return!1;throw new Error(t.join(" "))},subAssertion:function(){var t=i(arguments);return t=a(t),new r(this.failMesg.concat(t))},assert:function(t,e){return t||this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):!!this.isBool()||t},ne:function(t,e){return t===e?this.fail(t,"===",e):!!this.isBool()||t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):!!this.isBool()||t},is:function(t,e){var n=e,r=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),!!this.isBool()||t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var i=0;i<n.length;i++){let e=this.subAssertion("failed at ",t,"[",i,"]: ");null==n[i]&&console.log("WOW!7",r[i],n[i]),e.is(r[i],n[i])}return!!this.isBool()||t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),!!this.isBool()||t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),!!this.isBool()||t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),!!this.isBool()||t;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),!!this.isBool()||t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),!!this.isBool()||t;if(n&&"object"==typeof n){for(var o in n){this.subAssertion("failed at ",t,".",o,":").is(t[o],n[o])}return!!this.isBool()||t}if("string"==typeof n){var s=this._regedType[n];return s?this.is(t,s):!!this.isBool()||t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&s(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},i=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var o=new r,s=function(){try{return o.assert.apply(o,arguments)}catch(t){throw new Error(t.message)}};function a(t){if(t instanceof Array){var e=[];return t.forEach(function(t){e=e.concat(a(t))}),e}return[t]}["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){s[t]=function(){try{return o[t].apply(o,arguments)}catch(t){throw console.log(t.stack),new Error(t.message)}}}),s.fail=o.fail.bind(o),s.MODE_STRICT=o.MODE_STRICT,s.MODE_DEFENSIVE=o.MODE_DEFENSIVE,s.MODE_BOOL=o.MODE_BOOL,s.f=function(t){return{_assert_func:t}},s.opt=function(t){return s.f(function(e){return null==e||e instanceof t})},s.and=function(){var t=i(arguments);return s(t instanceof Array),s.f(function(e){for(var n=0;n<t.length;n++)this.is(e,t[n])})},e.exports=s},{}],2:[function(t,e,n){e.exports="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()},{}],3:[function(t,e,n){var r=t("../lib/assert"),i=t("../lib/root"),o=t("./TonyuThread"),s=t("./tonyuIterator");e.exports=function(){i.performance||(i.performance={}),i.performance.now||(i.performance.now=function(){return Date.now()});var t,e,n={};function a(e){if(!t.onRuntimeError)throw i.alert&&i.alert("!   : "+e),console.log(e.stack),e;t.onRuntimeError(e)}function u(t,e){return r.is(arguments,[String,Object]),l(n.getMeta(t),e)}function c(t,e){return l(t?Object.create(t.prototype):{},e)}function l(t,e){if(e&&"object"==typeof e)for(var n in e)t[n]=e[n];return t}n.addMeta=u,n.removeMeta=function(t){delete h[t]},n.removeMetaAll=function(t){t+=".";for(let e in h)e.substring(0,t.length)===t&&delete h[e]},n.getMeta=function(t){if("function"==typeof t)return t.meta;if("string"==typeof t){var e=h[t];return e||(h[t]=e={}),e}},n.ensureNamespace=function(t,e){var n,r=e.split("."),i=t;for(n=0;n<r.length;n++){var o=r[n];i[o]||(i[o]={}),i=i[o]}return i},n.propReg=/^__([gs]et)ter__(.*)$/,n.define=function(e){var r=e.superclass,i=e.includes,o=e.fullName,s=e.shortName,a=e.namespace,f=e.methods,p=e.decls,h=n.ensureNamespace(t.classes,a);function d(t,e){if(!t.prototype.hasOwnProperty("getClassInfo"))throw new Error("NO");if(!t.meta)throw console.log("metanotfound",t),new Error("meta not found");return function t(e,n){if((n=n||{}).isShim)return e;if(n.path=n.path||[],n.path.push(e),e.isShim)throw console.log("chkmeta::ctx",n),new Error("Shim found "+e.extenderFullName);if(e.superclass&&t(e.superclass,n),!e.includes)throw console.log("chkmeta::ctx",n),new Error("includes not found");return e.includes.forEach(function(e){t(e,n)}),n.path.pop(),e}(t.meta,e),t}function m(t,e){var r=!e.init,h=e.includesRec;if(h[o])return t;h[o]=!0,i.forEach(function(n){t=n.extendFrom(t,l(e,{init:!1}))});var m,v="function"==typeof f?f(t):f,y=v.initialize;delete v.initialize,(m=y?function(){this instanceof m||g(o),y.apply(this,arguments)}:t?function(){this instanceof m||g(o),t.apply(this,arguments)}:function(){this instanceof m||g(o)}).prototype=c(t,{constructor:m}),m.meta=r?{isShim:!0,extenderFullName:o}:u(o,{fullName:o,shortName:s,namespace:a,decls:p,superclass:e.nonShimParent?e.nonShimParent.meta:null,includesRec:h,includes:i.map(function(t){return t.meta})}),m.meta.func=m,m.methods=v;var b,w=m.prototype,S={},x=n.propReg;for(b in v)if(!b.match(/^fiber\$/)){w[b]=v[b];var _="fiber$"+b;if(v[_]&&(w[_]=v[_],w[_].methodInfo=w[_].methodInfo||{name:b,klass:m,fiber:!0},w[b].fiber=w[_]),"__dummy"!==b&&!w[b])throw console.log("WHY!",w[b],w,b),new Error("WHY!"+b);w[b].methodInfo=w[b].methodInfo||{name:b,klass:m};var E=x.exec(b);E&&(S[E[2]]=S[E[2]]||{},S[E[2]][E[1]]=w[b])}for(b in w.isTonyuObject=!0,S)Object.defineProperty(w,b,S[b]);return w.getClassInfo=function(){return m.meta},d(m,{isShim:r})}var v=m(r,{init:!0,initFullName:o,includesRec:r?l({},r.meta.includesRec):{},nonShimParent:r});return v.extendFrom=m,h[s]=v,v,d(v,{isShim:!1})},n.isSourceChanged=function(t){return!(!(t=t.meta||t).src||!t.src.tonyu)&&(!t.nodeTimestamp||t.src.tonyu.lastUpdate()>t.nodeTimestamp)},n.shouldCompile=function(t){if((t=t.meta||t).hasSemanticError)return!0;if(n.isSourceChanged(t))return!0;for(var e=n.getDependingClasses(t),r=0;r<e.length;r++)if(n.shouldCompile(e[r]))return!0},n.getDependingClasses=function(t){var e=[];return(t=t.meta||t).superclass&&(e=[t.superclass]),t.includes&&(e=e.concat(t.includes)),e};var f={},p={},h={};function d(t){var e,n=t.split("."),r=p;if(n.forEach(function(t){r&&(r=r[t])}),!r&&1==n.length)for(var i in p){var o=p[i][t];if(o){if(r)throw new Error(" "+i+"."+t+", "+e);r=o,e=i+"."+t}}return r}function g(t){throw new Error(""+t+"new")}var m=i.performance.now();function v(t){m=i.performance.now()+(t||0)}if(t={thread:function(){var t=new e;return t.handleEx=a,t},klass:n,bless:c,extend:l,globals:f,classes:p,classMetas:h,setGlobal:function(t,e){f[t]=e},getGlobal:function(t){return f[t]},getClass:d,timeout:function(t){return new Promise(function(e){setTimeout(e,t)})},bindFunc:function(e,n){if("function"!=typeof n)return n;var r=function(){return n.apply(e,arguments)};return r.methodInfo=t.extend({thiz:e},n.methodInfo||{}),n.fiber&&((r.fiber=function(){return n.fiber.apply(e,arguments)}).methodInfo=t.extend({thiz:e},n.fiber.methodInfo||{})),r},not_a_tonyu_object:function(t){throw console.log("Not a tonyu object: ",t),new Error(t+" is not a tonyu object")},is:function(t,e){return!!t&&(t instanceof e||!("function"!=typeof t.getClassInfo||!e.meta)&&t.getClassInfo().includesRec[e.meta.fullName])},hasKey:function(t,e){return t in e},invokeMethod:function(t,e,n,r){if(!t)throw new Error(r+"(="+t+") "+e+"");var i=t[e];if("function"!=typeof i)throw new Error(("this"==r?"":r+".")+e+"(="+i+")");return i.apply(t,n)},callFunc:function(t,e,n){if("function"!=typeof t)throw new Error(n+"");return t.apply({},e)},checkNonNull:function(t,e){if(t!=t||null==t)throw new Error(e+"(="+t+")");return t},iterator:s,run:function(e){var n=d(e);if(!n)throw new Error(e+" ");t.runMode=!0;var r=new n,i=t.globals.$currentProject||t.currentProject;i&&(i.runningObj=r)},checkLoop:function(){var t=i.performance.now();if(t-m>1e3)throw v(1e4),new Error("\n    \n   []https://edit.tonyu.jp/doc/options.html\n");t},resetLoopCheck:v,VERSION:1560828115159,A:function(t){for(var e=[],n=1;n<t.length;n++)e[n-1]=t[n];return e},ID:Math.random()},e=o(t),i.Tonyu)throw console.error("Tonyu called twice!"),new Error("Tonyu called twice!");return i.Tonyu=t,t}()},{"../lib/assert":1,"../lib/root":2,"./TonyuThread":4,"./tonyuIterator":5}],4:[function(t,e,n){e.exports=function(t){var e=1;class n{constructor(){this.frame=null,this._isDead=!1,this.cnt=0,this._isWaiting=!1,this.fSuspended=!1,this.tryStack=[],this.preemptionTime=60,this.onEndHandlers=[],this.onTerminateHandlers=[],this.id=e++,this.age=0}isAlive(){return!this.isDead()}isDead(){return this._isDead=this._isDead||null==this.frame||this._threadGroup&&(this._threadGroup.objectPoolAge!=this.tGrpObjectPoolAge||this._threadGroup.isDeadThreadGroup()),this._isDead}setThreadGroup(t){this._threadGroup=t,this.tGrpObjectPoolAge=t.objectPoolAge}isWaiting(){return this._isWaiting}suspend(){this.fSuspended=!0,this.cnt=0}enter(t){this.frame={prev:this.frame,func:t}}apply(t,e,n){var r;if(n||(n=[]),"string"==typeof e&&!(r=t["fiber$"+e]))throw new Error(""+e+"");if("function"==typeof e&&!(r=e.fiber)){var i=e.methodInfo?e.methodInfo.name:e.name;throw new Error(""+i+"")}n=[this].concat(n);var o=0;return this.enter(function(e){switch(o){case 0:r.apply(t,n),o=1;break;case 1:e.termStatus="success",e.notifyEnd(e.retVal),n[0].exit(),o=2}})}notifyEnd(t){this.onEndHandlers.forEach(function(e){e(t)}),this.notifyTermination({status:"success",value:t})}notifyTermination(t){this.onTerminateHandlers.forEach(function(e){e(t)})}on(t,e){"end"!==t&&"success"!==t||this.onEndHandlers.push(e),"terminate"===t&&(this.onTerminateHandlers.push(e),this.handleEx&&delete this.handleEx)}promise(){var t=this;return new Promise(function(e,n){t.on("terminate",function(t){"success"===t.status?e(t.value):"exception"===t.status?n(t.exception):n(new Error(t.status))})})}then(t,e){return e?this.promise().then(t,e):this.promise().then(t)}fail(t){return this.promise().then(t=>t,t)}gotoCatch(t){var e=this;if(0==e.tryStack.length)return e.termStatus="exception",e.kill(),void(e.handleEx?e.handleEx(t):e.notifyTermination({status:"exception",exception:t}));e.lastEx=t;for(var n=e.tryStack.pop();e.frame;){if(n.frame===e.frame){e.catchPC=n.catchPC;break}e.frame=e.frame.prev}}startCatch(){var t=this.lastEx;return this.lastEx=null,t}exit(t){this.frame=this.frame?this.frame.prev:null,this.retVal=t}enterTry(t){this.tryStack.push({frame:this.frame,catchPC:t})}exitTry(){this.tryStack.pop()}waitEvent(t,e){var n,r=this;(r.suspend(),t.on)&&(e=e.concat(function(){r.lastEvent=arguments,r.retVal=arguments[0],n.remove(),r.steps()}),n=t.on.apply(t,e))}runAsync(t){var e=this,n=function(){e.retVal=arguments,e.steps()},r=function(){for(var t="",n=0;n<arguments.length;n++)t+=arguments[n]+",";0==t.length&&(t="Async fail");var r=new Error(t);r.args=arguments,e.gotoCatch(r),e.steps()};e.suspend(),setTimeout(function(){t(n,r)},0)}waitFor(t){var e=this;return e._isWaiting=!0,e.suspend(),t instanceof n&&(t=t.promise()),Promise.resolve(t).then(function(t){e.retVal=t,e.stepsLoop()}).then(t=>t,function(t){e.gotoCatch(e.wrapError(t)),e.stepsLoop()})}wrapError(t){if(t instanceof Error)return t;var e=new Error(t);return e.original=t,e}resume(t){this.retVal=t,this.steps()}steps(){var e=this;if(!e.isDead()){var n=t.currentThread;for(t.currentThread=e,e.cnt=e.preemptionTime,e.preempted=!1,e.fSuspended=!1;e.cnt>0&&e.frame;)try{for(;e.cnt-- >0&&e.frame;)e.frame.func(e);e.preempted=!e.fSuspended&&e.isAlive()}catch(t){e.gotoCatch(t)}t.currentThread=n}}stepsLoop(){var t=this;t.steps(),t.preempted&&setTimeout(function(){t.stepsLoop()},0)}kill(){var t=this;t._isDead=!0,t.frame=null,t.termStatus||(t.termStatus="killed",t.notifyTermination({status:"killed"}))}clearFrame(){this.frame=null,this.tryStack=[]}}return n}},{}],5:[function(t,e,n){class r{constructor(t){this.set=t,this.i=0}next(){return!(this.i>=this.set.length)&&(this[0]=this.set[this.i],this.i++,!0)}}class i{constructor(t){this.set=t,this.i=0}next(){return!(this.i>=this.set.length)&&(this[0]=this.i,this[1]=this.set[this.i],this.i++,!0)}}class o{constructor(t){for(var e in this.elems=[],t)this.elems.push(e);this.i=0}next(){return!(this.i>=this.elems.length)&&(this[0]=this.elems[this.i],this.i++,!0)}}class s{constructor(t){for(var e in this.elems=[],t)this.elems.push([e,t[e]]);this.i=0}next(){return!(this.i>=this.elems.length)&&(this[0]=this.elems[this.i][0],this[1]=this.elems[this.i][1],this.i++,!0)}}e.exports=function(t,e){if(t.tonyuIterator)return t.tonyuIterator(e);if(t instanceof Array)return 1==e?new r(t):new i(t);if(t instanceof Object)return 1==e?new o(t):new s(t);throw console.log(t),new Error(t+" is not iterable")}},{}]},{},[3]),r("Tonyu",function(t){return function(){return t.Tonyu}}(this)),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof r&&r.amd)r("BuilderClient4Sys",[],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).TonyuBuilderClient=t()}}(function(){return function(){return function t(e,r,i){function o(a,u){if(!r[a]){if(!e[a]){var c="function"==typeof n&&n;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[a]={exports:{}};e[a][0].call(f.exports,function(t){return o(e[a][1][t]||t)},f,f.exports,t,e,r,i)}return r[a].exports}for(var s="function"==typeof n&&n,a=0;a<i.length;a++)o(i[a]);return o}}()({1:[function(t,e,n){const r=t("../lib/root"),i=r.Worker,o=t("../lib/WorkerServiceB"),s=t("../lang/SourceFiles"),a=t("../lib/FileMap"),u=r.FS;class c{constructor(t,e){this.prj=t;let n=e.worker.url;n.match(/^blob/)||(n+="?"+Math.random()),this.w=new o.Wrapper(new i(n)),this.config=e,this.fileMap=new a}getOutputFile(...t){return this.prj.getOutputFile(...t)}getDir(){return this.prj.getDir()}setDebugger(t){this.debugger=t}exec(t){if(this.debugger)return this.debugger.exec(t)}convertFromWorkerPath(t){return this.fileMap.convert(t,"remote","local")}exportFiles(){const t=this.getDir(),e=this.prj.sourceFiles(),n={base:t.path(),data:{}};for(var r in e){const i=e[r];n.data[i.relPath(t)]=i.text()}const i=this.prj.getOptionsFile();return n.data[i.relPath(t)]=i.text(),console.log("exported",n),n}async init(){if(this.inited)return;const t=this.fileMap,e=this.getDir(),n=this.exportFiles(),r=this.config.worker.ns2depspec,{prjDir:i}=await this.w.run("compiler/init",{namespace:this.prj.getNamespace(),files:n,ns2depspec:r});t.add({local:e,remote:i});const o=this.prj.getDependingProjects();for(let e of o){const n=e.getNamespace();if(!r[n]){const r=e.getDir(),i=r.exportAsObject({excludesF:t=>".tonyu"!==t.ext()&&"options.json"!==t.name()}),{prjDir:o}=await this.w.run("compiler/addDependingProject",{namespace:n,files:i});t.add({local:r,remote:o})}}this.inited=!0}resetFiles(){const t=this.exportFiles();return this.w.run("compiler/resetFiles",{namespace:this.prj.getNamespace(),files:t})}async clean(){return await this.resetFiles(),await this.fullCompile()}async fullCompile(){try{this.partialCompilable=!1,await this.init();const t=await this.w.run("compiler/fullCompile");console.log(t);const e=s.add(t);return await e.saveAs(this.getOutputFile()),await this.exec(t),this.partialCompilable=!0,t}catch(t){throw this.convertError(t)}}async partialCompile(t){if(!this.partialCompilable)return await this.clean();try{const e={};e[t.relPath(this.getDir())]=t.text(),await this.init();const n=await this.w.run("compiler/postChange",{files:e});return console.log(n),await this.exec(n),n}catch(t){throw this.convertError(t)}}async renameClassName(t,e){try{await this.init();let n=await this.w.run("compiler/renameClassName",{from:t,to:e});for(let t in n){let e=n[t];t=this.convertFromWorkerPath(t),null==e?u.get(t).rm():u.get(t).text(e)}return n}catch(t){throw this.convertError(t)}}convertError(t){return t.isTError&&(t.src=u.get(this.convertFromWorkerPath(t.src))),t}async run(){await this.init(),await this.fullCompile(),this.getDir().watch(async(t,e)=>{if(console.log(t,e.path()),".tonyu"===e.ext()){const t=await this.partialCompile(e);this.config.onCompiled&&this.config.onCompiled(t)}})}}c.SourceFiles=s,e.exports=c},{"../lang/SourceFiles":4,"../lib/FileMap":9,"../lib/WorkerServiceB":10,"../lib/root":11}],2:[function(t,e,n){const r=t("./BuilderClient"),i=t("../lang/SourceFiles"),o=t("../project/ProjectFactory"),s=t("../project/CompiledProject"),a=t("../lang/langMod"),u=t("../lang/StackDecoder"),c=t("../lang/source-map"),l=t("../browser/DebuggerCore");r.SourceFiles=i,r.ProjectFactory=o,r.CompiledProject=s,r.langMod=a,r.StackDecoder=u,r.SourceMap=c,r.DebuggerCore=l,e.exports=r},{"../browser/DebuggerCore":3,"../lang/SourceFiles":4,"../lang/StackDecoder":5,"../lang/langMod":6,"../lang/source-map":7,"../project/CompiledProject":12,"../project/ProjectFactory":13,"./BuilderClient":1}],3:[function(t,e,n){const r=t("../lang/SourceFiles"),i=(t("../project/CompiledProject"),t("../lang/langMod"),t("../lang/StackDecoder")),o=t("../lib/root");e.exports=function({Tonyu:t}){if(o.Debugger)return o.Debugger;const e={handlers:{},getHandler(t){return this.handlers[t]=this.handlers[t]||[],this.handlers[t]},fire(e,n){try{this.getHandler(e).forEach(t=>t(n))}catch(e){n&&n.noCatch||t.onRuntimeError(e)}},on(t,...e){const n=e.pop();this.getHandler(t).push(n)}};return o.Debugger={setErrorHandler:function(){t.onRuntimeError=(async t=>{console.error(t);const n=await i.decode(t),r={error:t,message:t.message,stack:n,noCatch:!0};e.fire("runtimeError",r)})},init:async function(e){this.setErrorHandler(),t.globals.$currentProject=e,t.currentProject=e,t.globals.$debugger=o.Debugger,await e.loadClasses(),console.log("Loading classes COMPLETE",t.ID,t.classes)},exec:async function(t){await r.add(t).exec(),e.fire("classChanged")},create:function(e){try{return new(t.getClass(e))}catch(e){t.onRuntimeError(e)}},on:e.on.bind(e)},o.parent&&o.parent.onTonyuDebuggerReady&&o.parent.onTonyuDebuggerReady(o.Debugger),o.Debugger}},{"../lang/SourceFiles":4,"../lang/StackDecoder":5,"../lang/langMod":6,"../lib/root":11,"../project/CompiledProject":12}],4:[function(t,e,n){const r=t("../lib/root");let i;"undefined"!=typeof global&&global.require&&(i=global.require("vm"));class o{constructor(t,e){if("object"==typeof t){const n=t;e=n.sourceMap,t=n.text,n.url&&(this.url=n.url)}this.text=t,this.sourceMap=e&&e.toString()}async saveAs(t){const e=t.sibling(t.name()+".map");let n=this.text;this.sourceMap&&(await e.text(this.sourceMap),n+="\n//# sourceMappingURL="+e.name()),await t.text(n)}exec(e){return new Promise((n,o)=>{if(r.window){const t=r.document;let e;if(this.url)e=this.url;else{const t=new r.Blob([this.text],{type:"text/plain"});e=r.URL.createObjectURL(t)}const i=t.createElement("script");console.log("load script",e),i.setAttribute("src",e),i.addEventListener("load",t=>{n(t)}),this.parent.url2SourceFile[e]=this,t.body.appendChild(i)}else if(e&&e.tmpdir){const r=e.tmpdir.rel(Math.random()+".js"),i=r.sibling(r.name()+".map");let o=this.text;o+="\n//# sourceMappingURL="+i.name(),r.text(o),i.text(this.sourceMap),t(r.path()),r.rm(),i.rm(),n()}else if(r.importScripts&&this.url)r.importScripts(this.url),n();else{const t=Function,e=i?i.compileFunction(this.text):new t(this.text);n(e())}})}export(){return{text:this.text,sourceMap:this.sourceMap,functions:this.functions}}}e.exports=new class{constructor(){this.url2SourceFile={}}add(t,e){const n=new o(t,e);return n.parent=this,n}}},{"../lib/root":11}],5:[function(t,e,n){const r=t("./source-map"),i=t("./stacktrace"),o=t("./SourceFiles");e.exports={async decode(t){try{const e=await i.fromError(t,{offline:!0});return e.forEach(t=>{try{const e=o.url2SourceFile[t.fileName];if(e){const n={line:t.lineNumber,column:t.columnNumber,bias:r.SourceMapConsumer.GREATEST_LOWER_BOUND},i=this.originalPositionFor(e,n);console.log("pos",n,i),i.source&&(t.fileName=i.source),i.line&&(t.lineNumber=i.line),i.column&&(t.columnNumber=i.column)}}catch(t){console.log("Sourcemap error",t)}}),console.log("Converted: ",e),e}catch(e){return console.log("StackTrace error",e),t&&t.stack?t.stack.split("\n"):(console.log("HennaError",t),[])}},originalPositionFor(t,e){const n=this.getSourceMapConsumer(t);return n?n.originalPositionFor(e):e},getSourceMapConsumer:t=>t.sourceMapConsumer?t.sourceMapConsumer:(t.sourceMapConsumer=new r.SourceMapConsumer(JSON.parse(t.sourceMap)),t.sourceMapConsumer)}},{"./SourceFiles":4,"./source-map":7,"./stacktrace":8}],6:[function(t,e,n){e.exports={getNamespace:function(){var t=this.getOptions();if(t.compiler&&t.compiler.namespace)return t.compiler.namespace;throw new Error("Namespace is not set")},async loadDependingClasses(){const t=this.getNamespace();for(let e of this.getDependingProjects())e.getNamespace()!==t&&await e.loadClasses()},getEXT:()=>".tonyu"}},{}],7:[function(t,e,n){var r,i;r=this,i=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=t,n.c=e,n.p="",n(0)}([function(t,e,n){e.SourceMapGenerator=n(1).SourceMapGenerator,e.SourceMapConsumer=n(7).SourceMapConsumer,e.SourceNode=n(10).SourceNode},function(t,e,n){var r=n(2),i=n(4),o=n(5).ArraySet,s=n(6).MappingList;function a(t){t||(t={}),this._file=i.getArg(t,"file",null),this._sourceRoot=i.getArg(t,"sourceRoot",null),this._skipValidation=i.getArg(t,"skipValidation",!1),this._sources=new o,this._names=new o,this._mappings=new s,this._sourcesContents=null}a.prototype._version=3,a.fromSourceMap=function(t){var e=t.sourceRoot,n=new a({file:t.file,sourceRoot:e});return t.eachMapping(function(t){var r={generated:{line:t.generatedLine,column:t.generatedColumn}};null!=t.source&&(r.source=t.source,null!=e&&(r.source=i.relative(e,r.source)),r.original={line:t.originalLine,column:t.originalColumn},null!=t.name&&(r.name=t.name)),n.addMapping(r)}),t.sources.forEach(function(e){var r=t.sourceContentFor(e);null!=r&&n.setSourceContent(e,r)}),n},a.prototype.addMapping=function(t){var e=i.getArg(t,"generated"),n=i.getArg(t,"original",null),r=i.getArg(t,"source",null),o=i.getArg(t,"name",null);this._skipValidation||this._validateMapping(e,n,r,o),null!=r&&(r=String(r),this._sources.has(r)||this._sources.add(r)),null!=o&&(o=String(o),this._names.has(o)||this._names.add(o)),this._mappings.add({generatedLine:e.line,generatedColumn:e.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:r,name:o})},a.prototype.setSourceContent=function(t,e){var n=t;null!=this._sourceRoot&&(n=i.relative(this._sourceRoot,n)),null!=e?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[i.toSetString(n)]=e):this._sourcesContents&&(delete this._sourcesContents[i.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},a.prototype.applySourceMap=function(t,e,n){var r=e;if(null==e){if(null==t.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=t.file}var s=this._sourceRoot;null!=s&&(r=i.relative(s,r));var a=new o,u=new o;this._mappings.unsortedForEach(function(e){if(e.source===r&&null!=e.originalLine){var o=t.originalPositionFor({line:e.originalLine,column:e.originalColumn});null!=o.source&&(e.source=o.source,null!=n&&(e.source=i.join(n,e.source)),null!=s&&(e.source=i.relative(s,e.source)),e.originalLine=o.line,e.originalColumn=o.column,null!=o.name&&(e.name=o.name))}var c=e.source;null==c||a.has(c)||a.add(c);var l=e.name;null==l||u.has(l)||u.add(l)},this),this._sources=a,this._names=u,t.sources.forEach(function(e){var r=t.sourceContentFor(e);null!=r&&(null!=n&&(e=i.join(n,e)),null!=s&&(e=i.relative(s,e)),this.setSourceContent(e,r))},this)},a.prototype._validateMapping=function(t,e,n,r){if((!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0)||e||n||r)&&!(t&&"line"in t&&"column"in t&&e&&"line"in e&&"column"in e&&t.line>0&&t.column>=0&&e.line>0&&e.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:n,original:e,name:r}))},a.prototype._serializeMappings=function(){for(var t,e,n,o,s=0,a=1,u=0,c=0,l=0,f=0,p="",h=this._mappings.toArray(),d=0,g=h.length;d<g;d++){if(t="",(e=h[d]).generatedLine!==a)for(s=0;e.generatedLine!==a;)t+=";",a++;else if(d>0){if(!i.compareByGeneratedPositionsInflated(e,h[d-1]))continue;t+=","}t+=r.encode(e.generatedColumn-s),s=e.generatedColumn,null!=e.source&&(o=this._sources.indexOf(e.source),t+=r.encode(o-f),f=o,t+=r.encode(e.originalLine-1-c),c=e.originalLine-1,t+=r.encode(e.originalColumn-u),u=e.originalColumn,null!=e.name&&(n=this._names.indexOf(e.name),t+=r.encode(n-l),l=n)),p+=t}return p},a.prototype._generateSourcesContent=function(t,e){return t.map(function(t){if(!this._sourcesContents)return null;null!=e&&(t=i.relative(e,t));var n=i.toSetString(t);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null},this)},a.prototype.toJSON=function(){var t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(t.file=this._file),null!=this._sourceRoot&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t},a.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.SourceMapGenerator=a},function(t,e,n){var r=n(3);e.encode=function(t){var e,n="",i=function(t){return t<0?1+(-t<<1):0+(t<<1)}(t);do{e=31&i,(i>>>=5)>0&&(e|=32),n+=r.encode(e)}while(i>0);return n},e.decode=function(t,e,n){var i,o,s,a,u=t.length,c=0,l=0;do{if(e>=u)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=r.decode(t.charCodeAt(e++))))throw new Error("Invalid base64 digit: "+t.charAt(e-1));i=!!(32&o),c+=(o&=31)<<l,l+=5}while(i);n.value=(a=(s=c)>>1,1==(1&s)?-a:a),n.rest=e}},function(t,e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");e.encode=function(t){if(0<=t&&t<n.length)return n[t];throw new TypeError("Must be between 0 and 63: "+t)},e.decode=function(t){return 65<=t&&t<=90?t-65:97<=t&&t<=122?t-97+26:48<=t&&t<=57?t-48+52:43==t?62:47==t?63:-1}},function(t,e){e.getArg=function(t,e,n){if(e in t)return t[e];if(3===arguments.length)return n;throw new Error('"'+e+'" is a required argument.')};var n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,r=/^data:.+\,.+$/;function i(t){var e=t.match(n);return e?{scheme:e[1],auth:e[2],host:e[3],port:e[4],path:e[5]}:null}function o(t){var e="";return t.scheme&&(e+=t.scheme+":"),e+="//",t.auth&&(e+=t.auth+"@"),t.host&&(e+=t.host),t.port&&(e+=":"+t.port),t.path&&(e+=t.path),e}function s(t){var n=t,r=i(t);if(r){if(!r.path)return t;n=r.path}for(var s,a=e.isAbsolute(n),u=n.split(/\/+/),c=0,l=u.length-1;l>=0;l--)"."===(s=u[l])?u.splice(l,1):".."===s?c++:c>0&&(""===s?(u.splice(l+1,c),c=0):(u.splice(l,2),c--));return""===(n=u.join("/"))&&(n=a?"/":"."),r?(r.path=n,o(r)):n}e.urlParse=i,e.urlGenerate=o,e.normalize=s,e.join=function(t,e){""===t&&(t="."),""===e&&(e=".");var n=i(e),a=i(t);if(a&&(t=a.path||"/"),n&&!n.scheme)return a&&(n.scheme=a.scheme),o(n);if(n||e.match(r))return e;if(a&&!a.host&&!a.path)return a.host=e,o(a);var u="/"===e.charAt(0)?e:s(t.replace(/\/+$/,"")+"/"+e);return a?(a.path=u,o(a)):u},e.isAbsolute=function(t){return"/"===t.charAt(0)||!!t.match(n)},e.relative=function(t,e){""===t&&(t="."),t=t.replace(/\/$/,"");for(var n=0;0!==e.indexOf(t+"/");){var r=t.lastIndexOf("/");if(r<0)return e;if((t=t.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return e;++n}return Array(n+1).join("../")+e.substr(t.length+1)};var a=!("__proto__"in Object.create(null));function u(t){return t}function c(t){if(!t)return!1;var e=t.length;if(e<9)return!1;if(95!==t.charCodeAt(e-1)||95!==t.charCodeAt(e-2)||111!==t.charCodeAt(e-3)||116!==t.charCodeAt(e-4)||111!==t.charCodeAt(e-5)||114!==t.charCodeAt(e-6)||112!==t.charCodeAt(e-7)||95!==t.charCodeAt(e-8)||95!==t.charCodeAt(e-9))return!1;for(var n=e-10;n>=0;n--)if(36!==t.charCodeAt(n))return!1;return!0}function l(t,e){return t===e?0:t>e?1:-1}e.toSetString=a?u:function(t){return c(t)?"$"+t:t},e.fromSetString=a?u:function(t){return c(t)?t.slice(1):t},e.compareByOriginalPositions=function(t,e,n){var r=t.source-e.source;return 0!==r?r:0!=(r=t.originalLine-e.originalLine)?r:0!=(r=t.originalColumn-e.originalColumn)||n?r:0!=(r=t.generatedColumn-e.generatedColumn)?r:0!=(r=t.generatedLine-e.generatedLine)?r:t.name-e.name},e.compareByGeneratedPositionsDeflated=function(t,e,n){var r=t.generatedLine-e.generatedLine;return 0!==r?r:0!=(r=t.generatedColumn-e.generatedColumn)||n?r:0!=(r=t.source-e.source)?r:0!=(r=t.originalLine-e.originalLine)?r:0!=(r=t.originalColumn-e.originalColumn)?r:t.name-e.name},e.compareByGeneratedPositionsInflated=function(t,e){var n=t.generatedLine-e.generatedLine;return 0!==n?n:0!=(n=t.generatedColumn-e.generatedColumn)?n:0!==(n=l(t.source,e.source))?n:0!=(n=t.originalLine-e.originalLine)?n:0!=(n=t.originalColumn-e.originalColumn)?n:l(t.name,e.name)}},function(t,e,n){var r=n(4),i=Object.prototype.hasOwnProperty;function o(){this._array=[],this._set=Object.create(null)}o.fromArray=function(t,e){for(var n=new o,r=0,i=t.length;r<i;r++)n.add(t[r],e);return n},o.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},o.prototype.add=function(t,e){var n=r.toSetString(t),o=i.call(this._set,n),s=this._array.length;o&&!e||this._array.push(t),o||(this._set[n]=s)},o.prototype.has=function(t){var e=r.toSetString(t);return i.call(this._set,e)},o.prototype.indexOf=function(t){var e=r.toSetString(t);if(i.call(this._set,e))return this._set[e];throw new Error('"'+t+'" is not in the set.')},o.prototype.at=function(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)},o.prototype.toArray=function(){return this._array.slice()},e.ArraySet=o},function(t,e,n){var r=n(4);function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}i.prototype.unsortedForEach=function(t,e){this._array.forEach(t,e)},i.prototype.add=function(t){var e,n,i,o,s,a;e=this._last,n=t,i=e.generatedLine,o=n.generatedLine,s=e.generatedColumn,a=n.generatedColumn,o>i||o==i&&a>=s||r.compareByGeneratedPositionsInflated(e,n)<=0?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(r.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},e.MappingList=i},function(t,e,n){var r=n(4),i=n(8),o=n(5).ArraySet,s=n(2),a=n(9).quickSort;function u(t){var e=t;return"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,""))),null!=e.sections?new f(e):new c(e)}function c(t){var e=t;"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,"")));var n=r.getArg(e,"version"),i=r.getArg(e,"sources"),s=r.getArg(e,"names",[]),a=r.getArg(e,"sourceRoot",null),u=r.getArg(e,"sourcesContent",null),c=r.getArg(e,"mappings"),l=r.getArg(e,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);i=i.map(String).map(r.normalize).map(function(t){return a&&r.isAbsolute(a)&&r.isAbsolute(t)?r.relative(a,t):t}),this._names=o.fromArray(s.map(String),!0),this._sources=o.fromArray(i,!0),this.sourceRoot=a,this.sourcesContent=u,this._mappings=c,this.file=l}function l(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function f(t){var e=t;"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,"")));var n=r.getArg(e,"version"),i=r.getArg(e,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new o,this._names=new o;var s={line:-1,column:0};this._sections=i.map(function(t){if(t.url)throw new Error("Support for url field in sections not implemented.");var e=r.getArg(t,"offset"),n=r.getArg(e,"line"),i=r.getArg(e,"column");if(n<s.line||n===s.line&&i<s.column)throw new Error("Section offsets must be ordered and non-overlapping.");return s=e,{generatedOffset:{generatedLine:n+1,generatedColumn:i+1},consumer:new u(r.getArg(t,"map"))}})}u.fromSourceMap=function(t){return c.fromSourceMap(t)},u.prototype._version=3,u.prototype.__generatedMappings=null,Object.defineProperty(u.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),u.prototype.__originalMappings=null,Object.defineProperty(u.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),u.prototype._charIsMappingSeparator=function(t,e){var n=t.charAt(e);return";"===n||","===n},u.prototype._parseMappings=function(t,e){throw new Error("Subclasses must implement _parseMappings")},u.GENERATED_ORDER=1,u.ORIGINAL_ORDER=2,u.GREATEST_LOWER_BOUND=1,u.LEAST_UPPER_BOUND=2,u.prototype.eachMapping=function(t,e,n){var i,o=e||null;switch(n||u.GENERATED_ORDER){case u.GENERATED_ORDER:i=this._generatedMappings;break;case u.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var s=this.sourceRoot;i.map(function(t){var e=null===t.source?null:this._sources.at(t.source);return null!=e&&null!=s&&(e=r.join(s,e)),{source:e,generatedLine:t.generatedLine,generatedColumn:t.generatedColumn,originalLine:t.originalLine,originalColumn:t.originalColumn,name:null===t.name?null:this._names.at(t.name)}},this).forEach(t,o)},u.prototype.allGeneratedPositionsFor=function(t){var e=r.getArg(t,"line"),n={source:r.getArg(t,"source"),originalLine:e,originalColumn:r.getArg(t,"column",0)};if(null!=this.sourceRoot&&(n.source=r.relative(this.sourceRoot,n.source)),!this._sources.has(n.source))return[];n.source=this._sources.indexOf(n.source);var o=[],s=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,i.LEAST_UPPER_BOUND);if(s>=0){var a=this._originalMappings[s];if(void 0===t.column)for(var u=a.originalLine;a&&a.originalLine===u;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s];else for(var c=a.originalColumn;a&&a.originalLine===e&&a.originalColumn==c;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s]}return o},e.SourceMapConsumer=u,c.prototype=Object.create(u.prototype),c.prototype.consumer=u,c.fromSourceMap=function(t){var e=Object.create(c.prototype),n=e._names=o.fromArray(t._names.toArray(),!0),i=e._sources=o.fromArray(t._sources.toArray(),!0);e.sourceRoot=t._sourceRoot,e.sourcesContent=t._generateSourcesContent(e._sources.toArray(),e.sourceRoot),e.file=t._file;for(var s=t._mappings.toArray().slice(),u=e.__generatedMappings=[],f=e.__originalMappings=[],p=0,h=s.length;p<h;p++){var d=s[p],g=new l;g.generatedLine=d.generatedLine,g.generatedColumn=d.generatedColumn,d.source&&(g.source=i.indexOf(d.source),g.originalLine=d.originalLine,g.originalColumn=d.originalColumn,d.name&&(g.name=n.indexOf(d.name)),f.push(g)),u.push(g)}return a(e.__originalMappings,r.compareByOriginalPositions),e},c.prototype._version=3,Object.defineProperty(c.prototype,"sources",{get:function(){return this._sources.toArray().map(function(t){return null!=this.sourceRoot?r.join(this.sourceRoot,t):t},this)}}),c.prototype._parseMappings=function(t,e){for(var n,i,o,u,c,f=1,p=0,h=0,d=0,g=0,m=0,v=t.length,y=0,b={},w={},S=[],x=[];y<v;)if(";"===t.charAt(y))f++,y++,p=0;else if(","===t.charAt(y))y++;else{for((n=new l).generatedLine=f,u=y;u<v&&!this._charIsMappingSeparator(t,u);u++);if(o=b[i=t.slice(y,u)])y+=i.length;else{for(o=[];y<u;)s.decode(t,y,w),c=w.value,y=w.rest,o.push(c);if(2===o.length)throw new Error("Found a source, but no line and column");if(3===o.length)throw new Error("Found a source and line, but no column");b[i]=o}n.generatedColumn=p+o[0],p=n.generatedColumn,o.length>1&&(n.source=g+o[1],g+=o[1],n.originalLine=h+o[2],h=n.originalLine,n.originalLine+=1,n.originalColumn=d+o[3],d=n.originalColumn,o.length>4&&(n.name=m+o[4],m+=o[4])),x.push(n),"number"==typeof n.originalLine&&S.push(n)}a(x,r.compareByGeneratedPositionsDeflated),this.__generatedMappings=x,a(S,r.compareByOriginalPositions),this.__originalMappings=S},c.prototype._findMapping=function(t,e,n,r,o,s){if(t[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[n]);if(t[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[r]);return i.search(t,e,o,s)},c.prototype.computeColumnSpans=function(){for(var t=0;t<this._generatedMappings.length;++t){var e=this._generatedMappings[t];if(t+1<this._generatedMappings.length){var n=this._generatedMappings[t+1];if(e.generatedLine===n.generatedLine){e.lastGeneratedColumn=n.generatedColumn-1;continue}}e.lastGeneratedColumn=1/0}},c.prototype.originalPositionFor=function(t){var e={generatedLine:r.getArg(t,"line"),generatedColumn:r.getArg(t,"column")},n=this._findMapping(e,this._generatedMappings,"generatedLine","generatedColumn",r.compareByGeneratedPositionsDeflated,r.getArg(t,"bias",u.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===e.generatedLine){var o=r.getArg(i,"source",null);null!==o&&(o=this._sources.at(o),null!=this.sourceRoot&&(o=r.join(this.sourceRoot,o)));var s=r.getArg(i,"name",null);return null!==s&&(s=this._names.at(s)),{source:o,line:r.getArg(i,"originalLine",null),column:r.getArg(i,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}},c.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return null==t}))},c.prototype.sourceContentFor=function(t,e){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(t=r.relative(this.sourceRoot,t)),this._sources.has(t))return this.sourcesContent[this._sources.indexOf(t)];var n;if(null!=this.sourceRoot&&(n=r.urlParse(this.sourceRoot))){var i=t.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(i))return this.sourcesContent[this._sources.indexOf(i)];if((!n.path||"/"==n.path)&&this._sources.has("/"+t))return this.sourcesContent[this._sources.indexOf("/"+t)]}if(e)return null;throw new Error('"'+t+'" is not in the SourceMap.')},c.prototype.generatedPositionFor=function(t){var e=r.getArg(t,"source");if(null!=this.sourceRoot&&(e=r.relative(this.sourceRoot,e)),!this._sources.has(e))return{line:null,column:null,lastColumn:null};var n={source:e=this._sources.indexOf(e),originalLine:r.getArg(t,"line"),originalColumn:r.getArg(t,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,r.getArg(t,"bias",u.GREATEST_LOWER_BOUND));if(i>=0){var o=this._originalMappings[i];if(o.source===n.source)return{line:r.getArg(o,"generatedLine",null),column:r.getArg(o,"generatedColumn",null),lastColumn:r.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},e.BasicSourceMapConsumer=c,f.prototype=Object.create(u.prototype),f.prototype.constructor=u,f.prototype._version=3,Object.defineProperty(f.prototype,"sources",{get:function(){for(var t=[],e=0;e<this._sections.length;e++)for(var n=0;n<this._sections[e].consumer.sources.length;n++)t.push(this._sections[e].consumer.sources[n]);return t}}),f.prototype.originalPositionFor=function(t){var e={generatedLine:r.getArg(t,"line"),generatedColumn:r.getArg(t,"column")},n=i.search(e,this._sections,function(t,e){var n=t.generatedLine-e.generatedOffset.generatedLine;return n||t.generatedColumn-e.generatedOffset.generatedColumn}),o=this._sections[n];return o?o.consumer.originalPositionFor({line:e.generatedLine-(o.generatedOffset.generatedLine-1),column:e.generatedColumn-(o.generatedOffset.generatedLine===e.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}},f.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})},f.prototype.sourceContentFor=function(t,e){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(t,!0);if(r)return r}if(e)return null;throw new Error('"'+t+'" is not in the SourceMap.')},f.prototype.generatedPositionFor=function(t){for(var e=0;e<this._sections.length;e++){var n=this._sections[e];if(-1!==n.consumer.sources.indexOf(r.getArg(t,"source"))){var i=n.consumer.generatedPositionFor(t);if(i)return{line:i.line+(n.generatedOffset.generatedLine-1),column:i.column+(n.generatedOffset.generatedLine===i.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},f.prototype._parseMappings=function(t,e){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var i=this._sections[n],o=i.consumer._generatedMappings,s=0;s<o.length;s++){var u=o[s],c=i.consumer._sources.at(u.source);null!==i.consumer.sourceRoot&&(c=r.join(i.consumer.sourceRoot,c)),this._sources.add(c),c=this._sources.indexOf(c);var l=i.consumer._names.at(u.name);this._names.add(l),l=this._names.indexOf(l);var f={source:c,generatedLine:u.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(i.generatedOffset.generatedLine===u.generatedLine?i.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:l};this.__generatedMappings.push(f),"number"==typeof f.originalLine&&this.__originalMappings.push(f)}a(this.__generatedMappings,r.compareByGeneratedPositionsDeflated),a(this.__originalMappings,r.compareByOriginalPositions)},e.IndexedSourceMapConsumer=f},function(t,e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(t,n,r,i){if(0===n.length)return-1;var o=function t(n,r,i,o,s,a){var u=Math.floor((r-n)/2)+n,c=s(i,o[u],!0);return 0===c?u:c>0?r-u>1?t(u,r,i,o,s,a):a==e.LEAST_UPPER_BOUND?r<o.length?r:-1:u:u-n>1?t(n,u,i,o,s,a):a==e.LEAST_UPPER_BOUND?u:n<0?-1:n}(-1,n.length,t,n,r,i||e.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===r(n[o],n[o-1],!0);)--o;return o}},function(t,e){function n(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function r(t,e,i,o){if(i<o){var s=i-1;n(t,(l=i,f=o,Math.round(l+Math.random()*(f-l))),o);for(var a=t[o],u=i;u<o;u++)e(t[u],a)<=0&&n(t,s+=1,u);n(t,s+1,u);var c=s+1;r(t,e,i,c-1),r(t,e,c+1,o)}var l,f}e.quickSort=function(t,e){r(t,e,0,t.length-1)}},function(t,e,n){var r=n(1).SourceMapGenerator,i=n(4),o=/(\r?\n)/,s="$$$isSourceNode$$$";function a(t,e,n,r,i){this.children=[],this.sourceContents={},this.line=null==t?null:t,this.column=null==e?null:e,this.source=null==n?null:n,this.name=null==i?null:i,this[s]=!0,null!=r&&this.add(r)}a.fromStringWithSourceMap=function(t,e,n){var r=new a,s=t.split(o),u=function(){return s.shift()+(s.shift()||"")},c=1,l=0,f=null;return e.eachMapping(function(t){if(null!==f){if(!(c<t.generatedLine)){var e=(n=s[0]).substr(0,t.generatedColumn-l);return s[0]=n.substr(t.generatedColumn-l),l=t.generatedColumn,p(f,e),void(f=t)}p(f,u()),c++,l=0}for(;c<t.generatedLine;)r.add(u()),c++;if(l<t.generatedColumn){var n=s[0];r.add(n.substr(0,t.generatedColumn)),s[0]=n.substr(t.generatedColumn),l=t.generatedColumn}f=t},this),s.length>0&&(f&&p(f,u()),r.add(s.join(""))),e.sources.forEach(function(t){var o=e.sourceContentFor(t);null!=o&&(null!=n&&(t=i.join(n,t)),r.setSourceContent(t,o))}),r;function p(t,e){if(null===t||void 0===t.source)r.add(e);else{var o=n?i.join(n,t.source):t.source;r.add(new a(t.originalLine,t.originalColumn,o,e,t.name))}}},a.prototype.add=function(t){if(Array.isArray(t))t.forEach(function(t){this.add(t)},this);else{if(!t[s]&&"string"!=typeof t)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);t&&this.children.push(t)}return this},a.prototype.prepend=function(t){if(Array.isArray(t))for(var e=t.length-1;e>=0;e--)this.prepend(t[e]);else{if(!t[s]&&"string"!=typeof t)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);this.children.unshift(t)}return this},a.prototype.walk=function(t){for(var e,n=0,r=this.children.length;n<r;n++)(e=this.children[n])[s]?e.walk(t):""!==e&&t(e,{source:this.source,line:this.line,column:this.column,name:this.name})},a.prototype.join=function(t){var e,n,r=this.children.length;if(r>0){for(e=[],n=0;n<r-1;n++)e.push(this.children[n]),e.push(t);e.push(this.children[n]),this.children=e}return this},a.prototype.replaceRight=function(t,e){var n=this.children[this.children.length-1];return n[s]?n.replaceRight(t,e):"string"==typeof n?this.children[this.children.length-1]=n.replace(t,e):this.children.push("".replace(t,e)),this},a.prototype.setSourceContent=function(t,e){this.sourceContents[i.toSetString(t)]=e},a.prototype.walkSourceContents=function(t){for(var e=0,n=this.children.length;e<n;e++)this.children[e][s]&&this.children[e].walkSourceContents(t);var r=Object.keys(this.sourceContents);for(e=0,n=r.length;e<n;e++)t(i.fromSetString(r[e]),this.sourceContents[r[e]])},a.prototype.toString=function(){var t="";return this.walk(function(e){t+=e}),t},a.prototype.toStringWithSourceMap=function(t){var e={code:"",line:1,column:0},n=new r(t),i=!1,o=null,s=null,a=null,u=null;return this.walk(function(t,r){e.code+=t,null!==r.source&&null!==r.line&&null!==r.column?(o===r.source&&s===r.line&&a===r.column&&u===r.name||n.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:e.line,column:e.column},name:r.name}),o=r.source,s=r.line,a=r.column,u=r.name,i=!0):i&&(n.addMapping({generated:{line:e.line,column:e.column}}),o=null,i=!1);for(var c=0,l=t.length;c<l;c++)10===t.charCodeAt(c)?(e.line++,e.column=0,c+1===l?(o=null,i=!1):i&&n.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:e.line,column:e.column},name:r.name})):e.column++}),this.walkSourceContents(function(t,e){n.setSourceContent(t,e)}),{code:e.code,map:n}},e.SourceNode=a}])},"object"==typeof n&&"object"==typeof e?e.exports=i():"object"==typeof n?n.sourceMap=i():r.sourceMap=i()},{}],8:[function(t,e,n){!function(t){"object"==typeof n&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).StackTrace=t()}(function(){return function e(n,r,i){function o(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof t&&t;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[a]={exports:{}};n[a][0].call(f.exports,function(t){var e=n[a][1][t];return o(e||t)},f,f.exports,e,n,r,i)}return r[a].exports}for(var s="function"==typeof t&&t,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){!function(r,i){"use strict";"object"==typeof n?e.exports=i(t("stackframe")):r.ErrorStackParser=i(r.StackFrame)}(this,function(t){"use strict";var e=/(^|@)\S+\:\d+/,n=/^\s*at .*(\S+\:\d+|\(native\))/m,r=/^(eval@)?(\[native code\])?$/;return{parse:function(t){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return this.parseOpera(t);if(t.stack&&t.stack.match(n))return this.parseV8OrIE(t);if(t.stack)return this.parseFFOrSafari(t);throw new Error("Cannot parse given Error object")},extractLocation:function(t){if(-1===t.indexOf(":"))return[t];var e=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(t.replace(/[\(\)]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter(function(t){return!!t.match(n)},this).map(function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var n=e.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),r=this.extractLocation(n.pop()),i=n.join(" ")||void 0,o=["eval","<anonymous>"].indexOf(r[0])>-1?void 0:r[0];return new t({functionName:i,fileName:o,lineNumber:r[1],columnNumber:r[2],source:e})},this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter(function(t){return!t.match(r)},this).map(function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new t({functionName:e});var n=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=e.match(n),i=r&&r[1]?r[1]:void 0,o=this.extractLocation(e.replace(n,""));return new t({functionName:i,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:e})},this)},parseOpera:function(t){return!t.stacktrace||t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length?this.parseOpera9(t):t.stack?this.parseOpera11(t):this.parseOpera10(t)},parseOpera9:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),i=[],o=2,s=r.length;o<s;o+=2){var a=n.exec(r[o]);a&&i.push(new t({fileName:a[2],lineNumber:a[1],source:r[o]}))}return i},parseOpera10:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),i=[],o=0,s=r.length;o<s;o+=2){var a=n.exec(r[o]);a&&i.push(new t({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:r[o]}))}return i},parseOpera11:function(n){return n.stack.split("\n").filter(function(t){return!!t.match(e)&&!t.match(/^Error created at/)},this).map(function(e){var n,r=e.split("@"),i=this.extractLocation(r.pop()),o=r.shift()||"",s=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;o.match(/\(([^\)]*)\)/)&&(n=o.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var a=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new t({functionName:s,args:a,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:e})},this)}}})},{stackframe:3}],2:[function(t,e,n){!function(r,i){"use strict";"object"==typeof n?e.exports=i(t("stackframe")):r.StackGenerator=i(r.StackFrame)}(this,function(t){return{backtrace:function(e){var n=[],r=10;"object"==typeof e&&"number"==typeof e.maxStackSize&&(r=e.maxStackSize);for(var i=arguments.callee;i&&n.length<r&&i.arguments;){for(var o=new Array(i.arguments.length),s=0;s<o.length;++s)o[s]=i.arguments[s];/function(?:\s+([\w$]+))+\s*\(/.test(i.toString())?n.push(new t({functionName:RegExp.$1||void 0,args:o})):n.push(new t({args:o}));try{i=i.caller}catch(t){break}}return n}}})},{stackframe:3}],3:[function(t,e,n){!function(t,r){"use strict";"object"==typeof n?e.exports=r():t.StackFrame=r()}(this,function(){"use strict";function t(t){return!isNaN(parseFloat(t))&&isFinite(t)}function e(t){return t.charAt(0).toUpperCase()+t.substring(1)}function n(t){return function(){return this[t]}}function r(t){if(t instanceof Object)for(var n=0;n<a.length;n++)t.hasOwnProperty(a[n])&&void 0!==t[a[n]]&&this["set"+e(a[n])](t[a[n]])}var i=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],s=["fileName","functionName","source"],a=i.concat(o,s,["args"]);r.prototype={getArgs:function(){return this.args},setArgs:function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("Args must be an Array");this.args=t},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(t){if(t instanceof r)this.evalOrigin=t;else{if(!(t instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new r(t)}},toString:function(){return(this.getFunctionName()||"{anonymous}")+("("+(this.getArgs()||[]).join(",")+")")+(this.getFileName()?"@"+this.getFileName():"")+(t(this.getLineNumber())?":"+this.getLineNumber():"")+(t(this.getColumnNumber())?":"+this.getColumnNumber():"")}};for(var u=0;u<i.length;u++)r.prototype["get"+e(i[u])]=n(i[u]),r.prototype["set"+e(i[u])]=function(t){return function(e){this[t]=Boolean(e)}}(i[u]);for(var c=0;c<o.length;c++)r.prototype["get"+e(o[c])]=n(o[c]),r.prototype["set"+e(o[c])]=function(e){return function(n){if(!t(n))throw new TypeError(e+" must be a Number");this[e]=Number(n)}}(o[c]);for(var l=0;l<s.length;l++)r.prototype["get"+e(s[l])]=n(s[l]),r.prototype["set"+e(s[l])]=function(t){return function(e){this[t]=String(e)}}(s[l]);return r})},{}],4:[function(t,e,n){function r(){this._array=[],this._set=Object.create(null)}var i=t("./util"),o=Object.prototype.hasOwnProperty;r.fromArray=function(t,e){for(var n=new r,i=0,o=t.length;i<o;i++)n.add(t[i],e);return n},r.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},r.prototype.add=function(t,e){var n=i.toSetString(t),r=o.call(this._set,n),s=this._array.length;r&&!e||this._array.push(t),r||(this._set[n]=s)},r.prototype.has=function(t){var e=i.toSetString(t);return o.call(this._set,e)},r.prototype.indexOf=function(t){var e=i.toSetString(t);if(o.call(this._set,e))return this._set[e];throw new Error('"'+t+'" is not in the set.')},r.prototype.at=function(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)},r.prototype.toArray=function(){return this._array.slice()},n.ArraySet=r},{"./util":10}],5:[function(t,e,n){var r=t("./base64");n.encode=function(t){var e,n="",i=function(t){return t<0?1+(-t<<1):0+(t<<1)}(t);do{e=31&i,(i>>>=5)>0&&(e|=32),n+=r.encode(e)}while(i>0);return n},n.decode=function(t,e,n){var i,o,s=t.length,a=0,u=0;do{if(e>=s)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=r.decode(t.charCodeAt(e++))))throw new Error("Invalid base64 digit: "+t.charAt(e-1));i=!!(32&o),a+=(o&=31)<<u,u+=5}while(i);n.value=function(t){var e=t>>1;return 1==(1&t)?-e:e}(a),n.rest=e}},{"./base64":6}],6:[function(t,e,n){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");n.encode=function(t){if(0<=t&&t<r.length)return r[t];throw new TypeError("Must be between 0 and 63: "+t)},n.decode=function(t){return 65<=t&&t<=90?t-65:97<=t&&t<=122?t-97+26:48<=t&&t<=57?t-48+52:43==t?62:47==t?63:-1}},{}],7:[function(t,e,n){n.GREATEST_LOWER_BOUND=1,n.LEAST_UPPER_BOUND=2,n.search=function(t,e,r,i){if(0===e.length)return-1;var o=function t(e,r,i,o,s,a){var u=Math.floor((r-e)/2)+e,c=s(i,o[u],!0);return 0===c?u:c>0?r-u>1?t(u,r,i,o,s,a):a==n.LEAST_UPPER_BOUND?r<o.length?r:-1:u:u-e>1?t(e,u,i,o,s,a):a==n.LEAST_UPPER_BOUND?u:e<0?-1:e}(-1,e.length,t,e,r,i||n.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===r(e[o],e[o-1],!0);)--o;return o}},{}],8:[function(t,e,n){function r(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function i(t,e,n,o){if(n<o){var s=n-1;r(t,function(t,e){return Math.round(t+Math.random()*(e-t))}(n,o),o);for(var a=t[o],u=n;u<o;u++)e(t[u],a)<=0&&r(t,s+=1,u);r(t,s+1,u);var c=s+1;i(t,e,n,c-1),i(t,e,c+1,o)}}n.quickSort=function(t,e){i(t,e,0,t.length-1)}},{}],9:[function(t,e,n){function r(t){var e=t;return"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,""))),null!=e.sections?new s(e):new i(e)}function i(t){var e=t;"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,"")));var n=a.getArg(e,"version"),r=a.getArg(e,"sources"),i=a.getArg(e,"names",[]),o=a.getArg(e,"sourceRoot",null),s=a.getArg(e,"sourcesContent",null),u=a.getArg(e,"mappings"),l=a.getArg(e,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);r=r.map(String).map(a.normalize).map(function(t){return o&&a.isAbsolute(o)&&a.isAbsolute(t)?a.relative(o,t):t}),this._names=c.fromArray(i.map(String),!0),this._sources=c.fromArray(r,!0),this.sourceRoot=o,this.sourcesContent=s,this._mappings=u,this.file=l}function o(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function s(t){var e=t;"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,"")));var n=a.getArg(e,"version"),i=a.getArg(e,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new c,this._names=new c;var o={line:-1,column:0};this._sections=i.map(function(t){if(t.url)throw new Error("Support for url field in sections not implemented.");var e=a.getArg(t,"offset"),n=a.getArg(e,"line"),i=a.getArg(e,"column");if(n<o.line||n===o.line&&i<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=e,{generatedOffset:{generatedLine:n+1,generatedColumn:i+1},consumer:new r(a.getArg(t,"map"))}})}var a=t("./util"),u=t("./binary-search"),c=t("./array-set").ArraySet,l=t("./base64-vlq"),f=t("./quick-sort").quickSort;r.fromSourceMap=function(t){return i.fromSourceMap(t)},r.prototype._version=3,r.prototype.__generatedMappings=null,Object.defineProperty(r.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),r.prototype.__originalMappings=null,Object.defineProperty(r.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),r.prototype._charIsMappingSeparator=function(t,e){var n=t.charAt(e);return";"===n||","===n},r.prototype._parseMappings=function(t,e){throw new Error("Subclasses must implement _parseMappings")},r.GENERATED_ORDER=1,r.ORIGINAL_ORDER=2,r.GREATEST_LOWER_BOUND=1,r.LEAST_UPPER_BOUND=2,r.prototype.eachMapping=function(t,e,n){var i,o=e||null;switch(n||r.GENERATED_ORDER){case r.GENERATED_ORDER:i=this._generatedMappings;break;case r.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var s=this.sourceRoot;i.map(function(t){var e=null===t.source?null:this._sources.at(t.source);return null!=e&&null!=s&&(e=a.join(s,e)),{source:e,generatedLine:t.generatedLine,generatedColumn:t.generatedColumn,originalLine:t.originalLine,originalColumn:t.originalColumn,name:null===t.name?null:this._names.at(t.name)}},this).forEach(t,o)},r.prototype.allGeneratedPositionsFor=function(t){var e=a.getArg(t,"line"),n={source:a.getArg(t,"source"),originalLine:e,originalColumn:a.getArg(t,"column",0)};if(null!=this.sourceRoot&&(n.source=a.relative(this.sourceRoot,n.source)),!this._sources.has(n.source))return[];n.source=this._sources.indexOf(n.source);var r=[],i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,u.LEAST_UPPER_BOUND);if(i>=0){var o=this._originalMappings[i];if(void 0===t.column)for(var s=o.originalLine;o&&o.originalLine===s;)r.push({line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++i];else for(var c=o.originalColumn;o&&o.originalLine===e&&o.originalColumn==c;)r.push({line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++i]}return r},n.SourceMapConsumer=r,i.prototype=Object.create(r.prototype),i.prototype.consumer=r,i.fromSourceMap=function(t){var e=Object.create(i.prototype),n=e._names=c.fromArray(t._names.toArray(),!0),r=e._sources=c.fromArray(t._sources.toArray(),!0);e.sourceRoot=t._sourceRoot,e.sourcesContent=t._generateSourcesContent(e._sources.toArray(),e.sourceRoot),e.file=t._file;for(var s=t._mappings.toArray().slice(),u=e.__generatedMappings=[],l=e.__originalMappings=[],p=0,h=s.length;p<h;p++){var d=s[p],g=new o;g.generatedLine=d.generatedLine,g.generatedColumn=d.generatedColumn,d.source&&(g.source=r.indexOf(d.source),g.originalLine=d.originalLine,g.originalColumn=d.originalColumn,d.name&&(g.name=n.indexOf(d.name)),l.push(g)),u.push(g)}return f(e.__originalMappings,a.compareByOriginalPositions),e},i.prototype._version=3,Object.defineProperty(i.prototype,"sources",{get:function(){return this._sources.toArray().map(function(t){return null!=this.sourceRoot?a.join(this.sourceRoot,t):t},this)}}),i.prototype._parseMappings=function(t,e){for(var n,r,i,s,u,c=1,p=0,h=0,d=0,g=0,m=0,v=t.length,y=0,b={},w={},S=[],x=[];y<v;)if(";"===t.charAt(y))c++,y++,p=0;else if(","===t.charAt(y))y++;else{for((n=new o).generatedLine=c,s=y;s<v&&!this._charIsMappingSeparator(t,s);s++);if(i=b[r=t.slice(y,s)])y+=r.length;else{for(i=[];y<s;)l.decode(t,y,w),u=w.value,y=w.rest,i.push(u);if(2===i.length)throw new Error("Found a source, but no line and column");if(3===i.length)throw new Error("Found a source and line, but no column");b[r]=i}n.generatedColumn=p+i[0],p=n.generatedColumn,i.length>1&&(n.source=g+i[1],g+=i[1],n.originalLine=h+i[2],h=n.originalLine,n.originalLine+=1,n.originalColumn=d+i[3],d=n.originalColumn,i.length>4&&(n.name=m+i[4],m+=i[4])),x.push(n),"number"==typeof n.originalLine&&S.push(n)}f(x,a.compareByGeneratedPositionsDeflated),this.__generatedMappings=x,f(S,a.compareByOriginalPositions),this.__originalMappings=S},i.prototype._findMapping=function(t,e,n,r,i,o){if(t[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[n]);if(t[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[r]);return u.search(t,e,i,o)},i.prototype.computeColumnSpans=function(){for(var t=0;t<this._generatedMappings.length;++t){var e=this._generatedMappings[t];if(t+1<this._generatedMappings.length){var n=this._generatedMappings[t+1];if(e.generatedLine===n.generatedLine){e.lastGeneratedColumn=n.generatedColumn-1;continue}}e.lastGeneratedColumn=1/0}},i.prototype.originalPositionFor=function(t){var e={generatedLine:a.getArg(t,"line"),generatedColumn:a.getArg(t,"column")},n=this._findMapping(e,this._generatedMappings,"generatedLine","generatedColumn",a.compareByGeneratedPositionsDeflated,a.getArg(t,"bias",r.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===e.generatedLine){var o=a.getArg(i,"source",null);null!==o&&(o=this._sources.at(o),null!=this.sourceRoot&&(o=a.join(this.sourceRoot,o)));var s=a.getArg(i,"name",null);return null!==s&&(s=this._names.at(s)),{source:o,line:a.getArg(i,"originalLine",null),column:a.getArg(i,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}},i.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return null==t})},i.prototype.sourceContentFor=function(t,e){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(t=a.relative(this.sourceRoot,t)),this._sources.has(t))return this.sourcesContent[this._sources.indexOf(t)];var n;if(null!=this.sourceRoot&&(n=a.urlParse(this.sourceRoot))){var r=t.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(r))return this.sourcesContent[this._sources.indexOf(r)];if((!n.path||"/"==n.path)&&this._sources.has("/"+t))return this.sourcesContent[this._sources.indexOf("/"+t)]}if(e)return null;throw new Error('"'+t+'" is not in the SourceMap.')},i.prototype.generatedPositionFor=function(t){var e=a.getArg(t,"source");if(null!=this.sourceRoot&&(e=a.relative(this.sourceRoot,e)),!this._sources.has(e))return{line:null,column:null,lastColumn:null};var n={source:e=this._sources.indexOf(e),originalLine:a.getArg(t,"line"),originalColumn:a.getArg(t,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,a.getArg(t,"bias",r.GREATEST_LOWER_BOUND));if(i>=0){var o=this._originalMappings[i];if(o.source===n.source)return{line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},n.BasicSourceMapConsumer=i,s.prototype=Object.create(r.prototype),s.prototype.constructor=r,s.prototype._version=3,Object.defineProperty(s.prototype,"sources",{get:function(){for(var t=[],e=0;e<this._sections.length;e++)for(var n=0;n<this._sections[e].consumer.sources.length;n++)t.push(this._sections[e].consumer.sources[n]);return t}}),s.prototype.originalPositionFor=function(t){var e={generatedLine:a.getArg(t,"line"),generatedColumn:a.getArg(t,"column")},n=u.search(e,this._sections,function(t,e){var n=t.generatedLine-e.generatedOffset.generatedLine;return n||t.generatedColumn-e.generatedOffset.generatedColumn}),r=this._sections[n];return r?r.consumer.originalPositionFor({line:e.generatedLine-(r.generatedOffset.generatedLine-1),column:e.generatedColumn-(r.generatedOffset.generatedLine===e.generatedLine?r.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}},s.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})},s.prototype.sourceContentFor=function(t,e){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(t,!0);if(r)return r}if(e)return null;throw new Error('"'+t+'" is not in the SourceMap.')},s.prototype.generatedPositionFor=function(t){for(var e=0;e<this._sections.length;e++){var n=this._sections[e];if(-1!==n.consumer.sources.indexOf(a.getArg(t,"source"))){var r=n.consumer.generatedPositionFor(t);if(r)return{line:r.line+(n.generatedOffset.generatedLine-1),column:r.column+(n.generatedOffset.generatedLine===r.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},s.prototype._parseMappings=function(t,e){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var r=this._sections[n],i=r.consumer._generatedMappings,o=0;o<i.length;o++){var s=i[o],u=r.consumer._sources.at(s.source);null!==r.consumer.sourceRoot&&(u=a.join(r.consumer.sourceRoot,u)),this._sources.add(u),u=this._sources.indexOf(u);var c=r.consumer._names.at(s.name);this._names.add(c),c=this._names.indexOf(c);var l={source:u,generatedLine:s.generatedLine+(r.generatedOffset.generatedLine-1),generatedColumn:s.generatedColumn+(r.generatedOffset.generatedLine===s.generatedLine?r.generatedOffset.generatedColumn-1:0),originalLine:s.originalLine,originalColumn:s.originalColumn,name:c};this.__generatedMappings.push(l),"number"==typeof l.originalLine&&this.__originalMappings.push(l)}f(this.__generatedMappings,a.compareByGeneratedPositionsDeflated),f(this.__originalMappings,a.compareByOriginalPositions)},n.IndexedSourceMapConsumer=s},{"./array-set":4,"./base64-vlq":5,"./binary-search":7,"./quick-sort":8,"./util":10}],10:[function(t,e,n){function r(t){var e=t.match(c);return e?{scheme:e[1],auth:e[2],host:e[3],port:e[4],path:e[5]}:null}function i(t){var e="";return t.scheme&&(e+=t.scheme+":"),e+="//",t.auth&&(e+=t.auth+"@"),t.host&&(e+=t.host),t.port&&(e+=":"+t.port),t.path&&(e+=t.path),e}function o(t){var e=t,o=r(t);if(o){if(!o.path)return t;e=o.path}for(var s,a=n.isAbsolute(e),u=e.split(/\/+/),c=0,l=u.length-1;l>=0;l--)"."===(s=u[l])?u.splice(l,1):".."===s?c++:c>0&&(""===s?(u.splice(l+1,c),c=0):(u.splice(l,2),c--));return""===(e=u.join("/"))&&(e=a?"/":"."),o?(o.path=e,i(o)):e}function s(t){return t}function a(t){if(!t)return!1;var e=t.length;if(e<9)return!1;if(95!==t.charCodeAt(e-1)||95!==t.charCodeAt(e-2)||111!==t.charCodeAt(e-3)||116!==t.charCodeAt(e-4)||111!==t.charCodeAt(e-5)||114!==t.charCodeAt(e-6)||112!==t.charCodeAt(e-7)||95!==t.charCodeAt(e-8)||95!==t.charCodeAt(e-9))return!1;for(var n=e-10;n>=0;n--)if(36!==t.charCodeAt(n))return!1;return!0}function u(t,e){return t===e?0:t>e?1:-1}n.getArg=function(t,e,n){if(e in t)return t[e];if(3===arguments.length)return n;throw new Error('"'+e+'" is a required argument.')};var c=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,l=/^data:.+\,.+$/;n.urlParse=r,n.urlGenerate=i,n.normalize=o,n.join=function(t,e){""===t&&(t="."),""===e&&(e=".");var n=r(e),s=r(t);if(s&&(t=s.path||"/"),n&&!n.scheme)return s&&(n.scheme=s.scheme),i(n);if(n||e.match(l))return e;if(s&&!s.host&&!s.path)return s.host=e,i(s);var a="/"===e.charAt(0)?e:o(t.replace(/\/+$/,"")+"/"+e);return s?(s.path=a,i(s)):a},n.isAbsolute=function(t){return"/"===t.charAt(0)||!!t.match(c)},n.relative=function(t,e){""===t&&(t="."),t=t.replace(/\/$/,"");for(var n=0;0!==e.indexOf(t+"/");){var r=t.lastIndexOf("/");if(r<0)return e;if((t=t.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return e;++n}return Array(n+1).join("../")+e.substr(t.length+1)};var f=!("__proto__"in Object.create(null));n.toSetString=f?s:function(t){return a(t)?"$"+t:t},n.fromSetString=f?s:function(t){return a(t)?t.slice(1):t},n.compareByOriginalPositions=function(t,e,n){var r=t.source-e.source;return 0!==r?r:0!=(r=t.originalLine-e.originalLine)?r:0!=(r=t.originalColumn-e.originalColumn)||n?r:0!=(r=t.generatedColumn-e.generatedColumn)?r:0!=(r=t.generatedLine-e.generatedLine)?r:t.name-e.name},n.compareByGeneratedPositionsDeflated=function(t,e,n){var r=t.generatedLine-e.generatedLine;return 0!==r?r:0!=(r=t.generatedColumn-e.generatedColumn)||n?r:0!=(r=t.source-e.source)?r:0!=(r=t.originalLine-e.originalLine)?r:0!=(r=t.originalColumn-e.originalColumn)?r:t.name-e.name},n.compareByGeneratedPositionsInflated=function(t,e){var n=t.generatedLine-e.generatedLine;return 0!==n?n:0!=(n=t.generatedColumn-e.generatedColumn)?n:0!==(n=u(t.source,e.source))?n:0!=(n=t.originalLine-e.originalLine)?n:0!=(n=t.originalColumn-e.originalColumn)?n:u(t.name,e.name)}},{}],11:[function(t,e,n){!function(r,i){"use strict";"object"==typeof n?e.exports=i(t("source-map/lib/source-map-consumer"),t("stackframe")):r.StackTraceGPS=i(r.SourceMap||r.sourceMap,r.StackFrame)}(this,function(t,e){"use strict";function n(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.open("get",t),r.onerror=n,r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300||"file://"===t.substr(0,7)&&r.responseText?e(r.responseText):n(new Error("HTTP status: "+r.status+" retrieving "+t)))},r.send()})}function r(t){if("undefined"!=typeof window&&window.atob)return window.atob(t);throw new Error("You must supply a polyfill for window.atob in this environment")}function i(t){if("object"!=typeof t)throw new TypeError("Given StackFrame is not an object");if("string"!=typeof t.fileName)throw new TypeError("Given file name is not a String");if("number"!=typeof t.lineNumber||t.lineNumber%1!=0||t.lineNumber<1)throw new TypeError("Given line number must be a positive integer");if("number"!=typeof t.columnNumber||t.columnNumber%1!=0||t.columnNumber<0)throw new TypeError("Given column number must be a non-negative integer");return!0}function o(t,n,r){return new Promise(function(i,o){var s=n.originalPositionFor({line:t.lineNumber,column:t.columnNumber});if(s.source){var a=n.sourceContentFor(s.source);a&&(r[s.source]=a),i(new e({functionName:s.name||t.functionName,args:t.args,fileName:s.source,lineNumber:s.line,columnNumber:s.column}))}else o(new Error("Could not get original source for given stackframe and source map"))})}return function s(a){return this instanceof s?(a=a||{},this.sourceCache=a.sourceCache||{},this.sourceMapConsumerCache=a.sourceMapConsumerCache||{},this.ajax=a.ajax||n,this._atob=a.atob||r,this._get=function(t){return new Promise(function(e,n){var r="data:"===t.substr(0,5);if(this.sourceCache[t])e(this.sourceCache[t]);else if(a.offline&&!r)n(new Error("Cannot make network requests in offline mode"));else if(r){var i=t.match(/^data:application\/json;([\w=:"-]+;)*base64,/);if(i){var o=i[0].length,s=t.substr(o),u=this._atob(s);this.sourceCache[t]=u,e(u)}else n(new Error("The encoding of the inline sourcemap is not supported"))}else{var c=this.ajax(t,{method:"get"});this.sourceCache[t]=c,c.then(e,n)}}.bind(this))},this._getSourceMapConsumer=function(e,n){return new Promise(function(r,i){if(this.sourceMapConsumerCache[e])r(this.sourceMapConsumerCache[e]);else{var o=new Promise(function(r,i){return this._get(e).then(function(e){"string"==typeof e&&(e=function(t){if("undefined"!=typeof JSON&&JSON.parse)return JSON.parse(t);throw new Error("You must supply a polyfill for JSON.parse in this environment")}(e.replace(/^\)\]\}'/,""))),void 0===e.sourceRoot&&(e.sourceRoot=n),r(new t.SourceMapConsumer(e))},i)}.bind(this));this.sourceMapConsumerCache[e]=o,r(o)}}.bind(this))},this.pinpoint=function(t){return new Promise(function(e,n){this.getMappedLocation(t).then(function(t){function n(){e(t)}this.findFunctionName(t).then(e,n).catch(n)}.bind(this),n)}.bind(this))},this.findFunctionName=function(t){return new Promise(function(n,r){i(t),this._get(t.fileName).then(function(r){var i=t.lineNumber,o=t.columnNumber,s=function(t,e){for(var n=[/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,/function\s+([^('"`]*?)\s*\(([^)]*)\)/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,/\b(?!(?:if|for|switch|while|with|catch)\b)(?:(?:static)\s+)?(\S+)\s*\(.*?\)\s*\{/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*\(.*?\)\s*=>/],r=t.split("\n"),i="",o=Math.min(e,20),s=0;s<o;++s){var a=r[e-s-1],u=a.indexOf("//");if(u>=0&&(a=a.substr(0,u)),a){i=a+i;for(var c=n.length,l=0;l<c;l++){var f=n[l].exec(i);if(f&&f[1])return f[1]}}}}(r,i);n(s?new e({functionName:s,args:t.args,fileName:t.fileName,lineNumber:i,columnNumber:o}):t)},r).catch(r)}.bind(this))},void(this.getMappedLocation=function(t){return new Promise(function(e,n){(function(){if("function"!=typeof Object.defineProperty||"function"!=typeof Object.create)throw new Error("Unable to consume source maps in older browsers")})(),i(t);var r=this.sourceCache,s=t.fileName;this._get(s).then(function(n){var i=function(t){for(var e,n,r=/\/\/[#@] ?sourceMappingURL=([^\s'"]+)\s*$/gm;n=r.exec(t);)e=n[1];if(e)return e;throw new Error("sourceMappingURL not found")}(n),a="data:"===i.substr(0,5),u=s.substring(0,s.lastIndexOf("/")+1);return"/"===i[0]||a||/^https?:\/\/|^\/\//i.test(i)||(i=u+i),this._getSourceMapConsumer(i,u).then(function(n){return o(t,n,r).then(e).catch(function(){e(t)})})}.bind(this),n).catch(n)}.bind(this))})):new s(a)}})},{"source-map/lib/source-map-consumer":9,stackframe:3}],12:[function(t,e,n){!function(r,i){"use strict";"object"==typeof n?e.exports=i(t("error-stack-parser"),t("stack-generator"),t("stacktrace-gps")):r.StackTrace=i(r.ErrorStackParser,r.StackGenerator,r.StackTraceGPS)}(this,function(t,e,n){function r(t,e){var n={};return[t,e].forEach(function(t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}),n}function i(t){return t.stack||t["opera#sourceloc"]}function o(t,e){return"function"==typeof e?t.filter(e):t}var s={filter:function(t){return-1===(t.functionName||"").indexOf("StackTrace$$")&&-1===(t.functionName||"").indexOf("ErrorStackParser$$")&&-1===(t.functionName||"").indexOf("StackTraceGPS$$")&&-1===(t.functionName||"").indexOf("StackGenerator$$")},sourceCache:{}},a=function(){try{throw new Error}catch(t){return t}};return{get:function(t){var e=a();return i(e)?this.fromError(e,t):this.generateArtificially(t)},getSync:function(n){n=r(s,n);var u=a();return o(i(u)?t.parse(u):e.backtrace(n),n.filter)},fromError:function(e,i){i=r(s,i);var a=new n(i);return new Promise(function(n){var r=o(t.parse(e),i.filter);n(Promise.all(r.map(function(t){return new Promise(function(e){function n(){e(t)}a.pinpoint(t).then(e,n).catch(n)})})))}.bind(this))},generateArtificially:function(t){t=r(s,t);var n=e.backtrace(t);return"function"==typeof t.filter&&(n=n.filter(t.filter)),Promise.resolve(n)},instrument:function(t,e,n,r){if("function"!=typeof t)throw new Error("Cannot instrument non-function object");if("function"==typeof t.__stacktraceOriginalFn)return t;var o=function(){try{return this.get().then(e,n).catch(n),t.apply(r||this,arguments)}catch(t){throw i(t)&&this.fromError(t).then(e,n).catch(n),t}}.bind(this);return o.__stacktraceOriginalFn=t,o},deinstrument:function(t){if("function"!=typeof t)throw new Error("Cannot de-instrument non-function object");return"function"==typeof t.__stacktraceOriginalFn?t.__stacktraceOriginalFn:t},report:function(t,e,n,r){return new Promise(function(i,o){var s=new XMLHttpRequest;if(s.onerror=o,s.onreadystatechange=function(){4===s.readyState&&(s.status>=200&&s.status<400?i(s.responseText):o(new Error("POST to "+e+" failed with status: "+s.status)))},s.open("post",e),s.setRequestHeader("Content-Type","application/json"),r&&"object"==typeof r.headers){var a=r.headers;for(var u in a)a.hasOwnProperty(u)&&s.setRequestHeader(u,a[u])}var c={stack:t};void 0!==n&&null!==n&&(c.message=n),s.send(JSON.stringify(c))})}}})},{"error-stack-parser":1,"stack-generator":2,"stacktrace-gps":11}]},{},[12])(12)})},{}],9:[function(t,e,n){e.exports=class{constructor(){this.sidesList=[]}add(t){this.sidesList.push(t)}convert(t,e,n){for(let r of this.sidesList)if(t.startsWith(r[e]))return r[n]+t.substring(r[e].length);return t}}},{}],10:[function(t,e,n){class r{constructor(t){const e=this;e.idseq=1,e.queue={},e.worker=t,e.readyQueue=[],t.addEventListener("message",function(t){var n=t.data;n.reverse?e.procReverse(t):n.ready?e.ready():n.id&&(e.queue[n.id](n),delete e.queue[n.id])}),e.run("WorkerService/isReady").then(function(t){t&&e.ready()})}procReverse(t){const e=this;var n=t.data,r=n.id,o=n.path,s=n.params;try{Promise.resolve(i[o](s)).then(function(t){e.worker.postMessage({reverse:!0,status:"ok",id:r,result:t})},a)}catch(t){a(t)}function a(t){t=Object.assign({name:t.name,message:t.message,stack:t.stack},t||{});try{const e=JSON.stringify(t);t=JSON.parse(e)}catch(e){t=t?t.message||t+"":"unknown",console.log("WorkerServiceW",e,t)}e.worker.postMessage({reverse:!0,id:r,error:t,status:"error"})}}ready(){const t=this;t.isReady||(t.isReady=!0,console.log("Worker is ready!"),t.readyQueue.forEach(function(t){t()}))}readyPromise(){const t=this;return new Promise(function(e){if(t.isReady)return e();t.readyQueue.push(e)})}run(t,e){const n=this;return n.readyPromise().then(function(){return new Promise(function(r,i){var o=n.idseq++;n.queue[o]=function(t){"ok"==t.status?r(t.result):i(t.error)},n.worker.postMessage({id:o,path:t,params:e})})})}terminate(){this.worker.terminate()}}var i={};const o={Wrapper:r,load:function(t){var e=new Worker(t);return new r(e)},install:function(t,e){i[t]=e},serv:function(t,e){this.install(t,e)}};o.serv("console/log",function(t){console.log.apply(console,t)}),e.exports=o},{}],11:[function(t,e,n){e.exports="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()},{}],12:[function(t,e,n){const r=t("./ProjectFactory"),i=(t("../lib/root"),t("../lang/SourceFiles")),o=t("../lang/langMod");var s;r.addType("compiled",t=>{if(t.namespace&&t.url)return function(t){const e=t.namespace,n=t.url;return r.createCore().include(o).include({getNamespace:function(){return e},loadClasses:async function(t){console.log("Loading compiled classes ns=",e,"url=",n),await this.loadDependingClasses();const r=i.add({url:n});await r.exec(),console.log("Loaded compiled classes ns=",e,"url=",n)}})}(t);if(t.dir)return t=t,r.createDirBasedCore(t).include(o).include({loadClasses:async function(e){console.log("Loading compiled classes params=",t),await this.loadDependingClasses();const n=this.getOutputFile(),r=n.sibling(n.name()+".map"),o=i.add({text:n.text(),sourceMap:r.exists()&&r.text()});await o.exec(),console.log("Loaded compiled classes params=",t)}});throw console.error("Invalid compiled project",t),new Error("Invalid compiled project")}),n.create=(t=>r.create("compiled",t)),r.addDependencyResolver((t,e)=>e.dir&&t.resolve?r.create("compiled",{dir:t.resolve(e.dir)}):e.namespace&&e.url?r.create("compiled",e):void 0)},{"../lang/SourceFiles":4,"../lang/langMod":6,"../lib/root":11,"./ProjectFactory":13}],13:[function(t,e,n){const r=[],i={};n.addDependencyResolver=(t=>{r.push(t)}),n.addType=((t,e)=>{i[t]=e}),n.fromDependencySpec=function(t,e){if("string"==typeof e){var n=t.resolve(e);return this.fromDir(n)}for(let n of r){const r=n(t,e);if(r)return r}throw console.error("Invalid dep spec",e),new Error("Invalid dep spec",e)},n.create=function(t,e){if(!i[t])throw new Error(`Invalid type ${t}`);return i[t](e)};class o{getPublishedURL(){}getOptions(t){return{}}getName(){return this.dir.name().replace(/\/$/,"")}getDependingProjects(){var t=this.getOptions();return(t.compiler&&t.compiler.dependingProjects||[]).map(t=>o.factory.fromDependencySpec(this,t))}include(t){for(let e of Object.getOwnPropertyNames(t))"function"==typeof t[e]&&(this[e]=t[e]);return this}delegate(t){if(t.constructor.prototype){const e=e=>{"function"==typeof t[e]&&(this[e]=((...n)=>t[e](...n)))};for(let n of Object.getOwnPropertyNames(t.constructor.prototype))e(n)}return this}}o.factory=n,n.createCore=(()=>new o);const s={getDir(){return this.dir},resolve(t){if(t instanceof Array){var e=[];return t.forEach(function(t){e.push(this.resolve(t))}),e}if("string"==typeof t)return"undefined"!=typeof FS?FS.resolve(t,this.getDir().path()):this.getDir().rel(t);if(!t||!t.isDir)throw new Error("Cannot TPR.resolve: "+t);return t},getOptions(t){return this.getOptionsFile().obj()},getOptionsFile(){return this.dir.rel("options.json")},setOptions(t){return this.getOptionsFile().obj(t)},getOutputFile(t){var e=this.getOptions(),n=this.resolve(e.compiler.outputFile||"js/concat.js");if(n.isDir())throw new Error("out: directory style not supported");return n},removeOutputFile(){this.getOutputFile().rm()},path(){return this.dir.path()},getEXT(){throw new Error("getEXT must be overriden.")},sourceFiles(){const t={},e=this.getEXT();return this.dir.recursive(function(n){if(n.endsWith(e)){var r=n.truncExt(e);t[r]=n}}),t}};n.createDirBasedCore=function(t){const e=this.createCore();return e.dir=t.dir,e.include(s)}},{}]},{},[2])(2)}),r("ProjectFactory",["require","exports","module","BuilderClient4Sys"],function(t,e,n){const r=t("BuilderClient4Sys");n.exports=r.ProjectFactory}),r("BuilderClient",["require","exports","module","BuilderClient4Sys"],function(t,e,n){const r=t("BuilderClient4Sys");n.exports=r}),r("root",[],function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()}),r("PatternParser",["Tonyu"],function(t){var e=function(t,e){this.options=e||{},this.img=t,this.height=t.height,this.width=t.width;var n=this.newImage(t.width,t.height).getContext("2d");n.drawImage(t,0,0),this.ctx=n,this.pixels=this.ctx.getImageData(0,0,t.width,t.height).data,this.base=this.getPixel(0,0)};return t.extend(e.prototype,{newImage:function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n},getPixel:function(t,e){var n=this.pixels,r=4*(t+e*this.width),i=n[0+r],o=n[1+r],s=n[2+r];return 256*(256*(256*n[3+r]+s)+o)+i},setPixel:function(t,e,n){var r=4*(t+e*this.width);this.pixels[0+r]=255&n,n=(n-(255&n))/256,this.pixels[1+r]=255&n,n=(n-(255&n))/256,this.pixels[2+r]=255&n,n=(n-(255&n))/256,this.pixels[3+r]=255&n},parse:function(){try{for(var t=[],e=0;e<this.height;e++)for(var n=0;n<this.width;n++){this.getPixel(n,e)!=this.base&&t.push(this.parse1Pattern(n,e))}return t}catch(t){if(t.isParseError)return console.log("parse error! "+t),[{image:this.img,x:0,y:0,width:this.width,height:this.height}];throw t}},parse1Pattern:function(t,e){function n(t){return t}for(var r=this.getPixel(t,e),i=t,o=e,s=this.base,a=this.width,u=this.height;i<a;){if(this.getPixel(i,o)!=r)break;i++}if(i>=a||this.getPixel(i,o)!=s)throw _(i,o,n(this.getPixel(i,o))+"!="+n(s));for(i--;o<u&&this.getPixel(i,o)==r;)o++;if(o>=u||this.getPixel(i,o)!=s)throw _(i,o,n(this.getPixel(i,o))+"!="+n(s));var c=t+1,l=e+1,f=i-c,p=--o-l;if(f*p==0)throw _(i,o,"w*h==0");for(var h=this.newImage(f,p),d=h.getContext("2d"),g=d.getImageData(0,0,f,p),m=g.data,v=0,y=l;y<o;y++)for(var b=c;b<i;b++){var w=this.getPixel(b,y);w==r?(m[v++]=0,m[v++]=0,m[v++]=0,m[v++]=0):(m[v++]=255&w,w=(w-(255&w))/256,m[v++]=255&w,w=(w-(255&w))/256,m[v++]=255&w,w=(w-(255&w))/256,m[v++]=255&w)}d.putImageData(g,0,0);for(var S=l-1;S<=o;S++)for(var x=c-1;x<=i;x++)this.setPixel(x,S,s);return this.options.boundsInSrc?{x:c,y:l,width:f,height:p}:{image:h,x:0,y:0,width:f,height:p};function _(t,e,n){return{toString:function(){return"at ("+t+","+e+") :"+n},isParseError:!0}}}}),e}),Util=function(){function t(){return"undefined"!=typeof Buffer}function e(e){return t()&&e instanceof Buffer}return{getQueryString:function(t,e){null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n,r=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);return null==r?e:(n=r[1],decodeURIComponent(n.replace(/\+/g,"%20")))},endsWith:function(t,e){return t.substring(t.length-e.length)===e},startsWith:function(t,e){return t.substring(0,e.length)===e},Base64_To_ArrayBuffer:function(t){t=t.replace(/[\n=]/g,"");var e=new Object;e[65]=0,e[66]=1,e[67]=2,e[68]=3,e[69]=4,e[70]=5,e[71]=6,e[72]=7,e[73]=8,e[74]=9,e[75]=10,e[76]=11,e[77]=12,e[78]=13,e[79]=14,e[80]=15,e[81]=16,e[82]=17,e[83]=18,e[84]=19,e[85]=20,e[86]=21,e[87]=22,e[88]=23,e[89]=24,e[90]=25,e[97]=26,e[98]=27,e[99]=28,e[100]=29,e[101]=30,e[102]=31,e[103]=32,e[104]=33,e[105]=34,e[106]=35,e[107]=36,e[108]=37,e[109]=38,e[110]=39,e[111]=40,e[112]=41,e[113]=42,e[114]=43,e[115]=44,e[116]=45,e[117]=46,e[118]=47,e[119]=48,e[120]=49,e[121]=50,e[122]=51,e[48]=52,e[49]=53,e[50]=54,e[51]=55,e[52]=56,e[53]=57,e[54]=58,e[55]=59,e[56]=60,e[57]=61,e[43]=62,e[47]=63;var n,r=t.length,i=0,o=0;if(!r)return new ArrayBuffer(0);n=Math.floor(r/4*3),"="==t.charAt(r-1)&&(n-=1),"="==t.charAt(r-2)&&(n-=1);for(var s=new ArrayBuffer(n),a=new Uint8Array(s),u=0,c=0;c<n&&(void 0===(o=e[t.charCodeAt(u)])&&l("Invalid letter: "+t.charCodeAt(u)),i=o<<2,u++,void 0===(o=e[t.charCodeAt(u)])&&l("Invalid letter: "+t.charCodeAt(u)),a[c]=i|o>>4&3,i=(15&o)<<4,u++,!(++c>=n))&&(void 0===(o=e[t.charCodeAt(u)])&&l("Invalid letter: "+t.charCodeAt(u)),a[c]=i|o>>2&15,i=(3&o)<<6,u++,!(++c>=n));)void 0===(o=e[t.charCodeAt(u)])&&l("Invalid letter: "+t.charCodeAt(u)),a[c]=i|o,u++,c++;function l(e){throw console.log(e),console.log(t,u),new Error(e)}return s},Base64_From_ArrayBuffer:function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,s=0,a=0;a<i&&(n+=e[(s=r[a])>>2],o=(3&s)<<4,!(++a>=i))&&(n+=e[o|(s=r[a])>>4],o=(15&s)<<2,!(++a>=i));)n+=e[o|(s=r[a])>>6],n+=e[63&s],a++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n},utf8bytes2str:function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(t){throw console.log(e.join("")),t}},str2utf8bytes:function(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer},privatize:function(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){return r.apply(t,arguments)})}(n);return e},hasNodeBuffer:t,isNodeBuffer:e,isBuffer:function(t){return t instanceof ArrayBuffer||e(t)}}}(),r("Util",function(t){return function(){return t.Util}}(this)),r("Platform",[],function(){var t={},e=window.navigator.userAgent.toLowerCase();return t.tablet=-1!=e.indexOf("windows")&&-1!=e.indexOf("touch")||-1!=e.indexOf("ipad")||-1!=e.indexOf("android")&&-1==e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("tablet")||-1!=e.indexOf("kindle")||-1!=e.indexOf("silk")||-1!=e.indexOf("playbook"),t.mobile=-1!=e.indexOf("windows")&&-1!=e.indexOf("phone")||-1!=e.indexOf("iphone")||-1!=e.indexOf("ipod")||-1!=e.indexOf("android")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("blackberry"),t}),r("WebSite",["FS","Platform"],function(t,e){var r,i,o=t.PathUtil,s=document.location.href,a=!!s.match(/html\/dev\//)&&!!s.match(/localhost:3/),u=location.protocol;switch(u.match(/^http/)||(u="https:"),window.WebSite_runType){case"IDE":return(r={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile}).builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/inputPad.png":1,"images/neko.png":1,"images/mapchip.png":1},r.pluginTop||(r.pluginTop=r.top+"/js/plugins"),r.sampleImg=r.top+"/images",r.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),r.mp4Disabled=r.isNW,r.tonyuHome="/Tonyu/",r.PathSep="/",r.isNW?(r.noconcat=!0,r.PathSep=n("path").sep,r.cwd=o.directorify(process.cwd().replace(/\\/g,"/")),process.env.TONYU_HOME?r.tonyuHome=o.directorify(process.env.TONYU_HOME):r.tonyuHome=o.rel(r.cwd,"fs/Tonyu/"),r.logdir=process.env.TONYU_LOGDIR,r.wwwDir=o.rel(r.cwd,"www/"),r.platform=process.platform,r.ffmpeg=o.rel(r.cwd,"win32"==r.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),r.pkgInfo=n(o.rel(r.cwd,"package.json")),process.env.TONYU_PROJECTS?r.projects=process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(n("path").delimiter):r.pkgInfo&&r.pkgInfo.config&&r.pkgInfo.config.prjDirs?r.projects=r.pkgInfo.config.prjDirs.map(function(t){return t=o.directorify(t),o.isAbsolute(t)?t:o.rel(r.cwd,t)}):r.projects=[o.rel(r.cwd,"Projects/"),o.rel(r.tonyuHome,"Projects/")],r.kernelDir=o.rel(r.wwwDir,"Kernel/")):(s.match(/edit\.tonyu\.jp\/n\//)?r.wwwDir=u+"//"+location.host+"/n/":r.wwwDir=u+"//"+location.host+"/",r.projects=[o.rel(r.tonyuHome,"Projects/")]),r.kernelDir=o.rel(r.wwwDir,"Kernel/"),r.compiledKernel="Kernel/js/concat.js",s.match(/localhost\/tonyu2/)?(r.wwwDir=u+"//"+location.host+"/tonyu2/",r.kernelDir=r.wwwDir+"Kernel/",r.compiledKernel=r.kernelDir+"js/concat.js",r.uploadTmpUrl=u+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",r.newVersionUrl=u+"//localhost/tsite/tonyu/project/newVersion.cgi",r.scriptServer="https://localhost/tonyu2/"):(r.uploadTmpUrl=u+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",r.newVersionUrl=u+"//www.tonyu.jp/project/newVersion.cgi",r.scriptServer="https://edit.tonyu.jp/"),r.version=2,r.hoge="fuga",t.setEnvProvider(new t.Env(r)),window.WebSite=r,r;case"singleHTML":if(r={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},"object"==typeof BuiltinAssets)for(i in BuiltinAssets)r.urlAliases[i]=BuiltinAssets[i];return r.tonyuHome="/Tonyu/",r.projects=[o.rel(r.tonyuHome,"Projects/")],s.match(/localhost\/tonyu2/)?r.scriptServer="http://localhost/tonyu2/":r.scriptServer="https://edit.tonyu.jp/",r.pluginTop=r.scriptServer+"js/plugins",r.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),r.PathSep="/",r.compiledKernel=r.scriptServer+"Kernel/js/concat.js",t.setEnvProvider(new t.Env(r)),window.WebSite=r,r;case"multiHTML":return(r={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile}).tonyuHome="/Tonyu/",r.pluginTop=r.top+"/js/plugins",r.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),r.PathSep="/",r.mp4Disabled=r.isNW,r.isNW&&(r.PathSep=n("path").sep,r.cwd=o.directorify(process.cwd().replace(/\\/g,"/")),r.platform=process.platform),t.setEnvProvider(new t.Env(r)),window.WebSite=r,r}if(s.match(/jsrun\.it/))r={urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png"},top:"",devMode:a,pluginTop:"https://edit.tonyu.jp/js/plugins",removeJSOutput:!0};else if(s.match(/tonyuexe\.appspot\.com/)||s.match(/localhost:8887/)||s.match(/\/html\/((dev)|(build))\//))r={urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/sound_ogg.png":"../../images/sound_ogg.png","images/sound_mp3.png":"../../images/sound_mp3.png","images/sound_mp4.png":"../../images/sound_mp4.png","images/sound_m4a.png":"../../images/sound_m4a.png","images/sound_mid.png":"../../images/sound_mid.png","images/sound_wav.png":"../../images/sound_wav.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:a};else if(s.match(/bitarrow/)||s.match(/localhost.*pub/)){var c=r={};r.serverType="BA",c.runtime="../../../runtime/",c.urlAliases={"images/base.png":c.runtime+"images/base.png","images/Sample.png":c.runtime+"images/Sample.png","images/neko.png":c.runtime+"images/neko.png","images/mapchip.png":c.runtime+"images/mapchip.png","images/sound.png":c.runtime+"images/sound.png","images/sound_ogg.png":c.runtime+"images/sound_ogg.png","images/sound_mp3.png":c.runtime+"images/sound_mp3.png","images/sound_mp4.png":c.runtime+"images/sound_mp4.png","images/sound_m4a.png":c.runtime+"images/sound_m4a.png","images/sound_mid.png":c.runtime+"images/sound_mid.png","images/sound_wav.png":c.runtime+"images/sound_wav.png","images/ecl.png":c.runtime+"images/ecl.png"}}else r={urlAliases:{},top:".",devMode:a};if("object"==typeof BuiltinAssets)for(i in BuiltinAssets)r.urlAliases[i]=BuiltinAssets[i];r.builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/neko.png":1,"images/mapchip.png":1};var l=window.navigator.userAgent.toLowerCase();return r.tablet=-1!=l.indexOf("windows")&&-1!=l.indexOf("touch")||-1!=l.indexOf("ipad")||-1!=l.indexOf("android")&&-1==l.indexOf("mobile")||-1!=l.indexOf("firefox")&&-1!=l.indexOf("tablet")||-1!=l.indexOf("kindle")||-1!=l.indexOf("silk")||-1!=l.indexOf("playbook"),r.mobile=-1!=l.indexOf("windows")&&-1!=l.indexOf("phone")||-1!=l.indexOf("iphone")||-1!=l.indexOf("ipod")||-1!=l.indexOf("android")&&-1!=l.indexOf("mobile")||-1!=l.indexOf("firefox")&&-1!=l.indexOf("mobile")||-1!=l.indexOf("blackberry"),r.pluginTop||(r.pluginTop=r.top+"/js/plugins"),r.disableROM={},(s.match(/\.appspot\.com/)||s.match(/localhost:888[87]/))&&(r.serverType="GAE"),s.match(/localhost:3000/)&&(r.serverType="Node"),s.match(/tonyuexe\.appspot\.com/)||s.match(/localhost:8887/)?r.serverTop=r.top+"/exe":r.serverTop=r.top+"/edit",r.sampleImg=r.top+"/images",r.blobPath=r.serverTop+"/serveBlob",r.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),r.mp4Disabled=r.isNW,r.tonyuHome="/Tonyu/",r.url={getDirInfo:r.serverTop+"/getDirInfo",getFiles:r.serverTop+"/File2LSSync",putFiles:r.serverTop+"/LS2FileSync"},r.PathSep="/",r.isNW?(r.PathSep=n("path").sep,r.cwd=o.directorify(process.cwd().replace(/\\/g,"/")),process.env.TONYU_HOME?r.tonyuHome=o.directorify(process.env.TONYU_HOME):r.tonyuHome=o.rel(r.cwd,"fs/Tonyu/"),r.logdir=process.env.TONYU_LOGDIR,r.wwwDir=o.rel(r.cwd,"www/"),r.platform=process.platform,r.ffmpeg=o.rel(r.cwd,"win32"==r.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),r.pkgInfo=n(o.rel(r.cwd,"package.json")),process.env.TONYU_PROJECTS?r.projects=process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(n("path").delimiter):r.pkgInfo&&r.pkgInfo.config&&r.pkgInfo.config.prjDirs?r.projects=r.pkgInfo.config.prjDirs.map(function(t){return t=o.directorify(t),o.isAbsolute(t)?t:o.rel(r.cwd,t)}):r.projects=[o.rel(r.cwd,"Projects/"),o.rel(r.tonyuHome,"Projects/")],r.kernelDir=o.rel(r.wwwDir,"Kernel/")):(r.wwwDir=u+"//"+location.host+"/",r.projects=[o.rel(r.tonyuHome,"Projects/")]),(s.match(/edit\.tonyu\.jp/)||s.match(/tonyuedit\.appspot\.com/)||s.match(/localhost:888/))&&(r.kernelDir=u+"//"+location.host+"/Kernel/"),s.match(/edit\.tonyu\.jp/)||s.match(/tonyuedit\.appspot\.com/)||s.match(/localhost:888/)||r.isNW?r.compiledKernel=r.kernelDir+"js/concat.js":"BA"===r.serverType?r.compiledKernel=r.runtime+"lib/tonyu/kernel.js":r.compiledKernel="https://edit.tonyu.jp/Kernel/js/concat.js",s.match(/localhost\/tonyu2/)?(r.wwwDir=u+"//"+location.host+"/tonyu2/",r.kernelDir=r.wwwDir+"Kernel/",r.compiledKernel=r.kernelDir+"js/concat.js",r.uploadTmpUrl=u+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",r.newVersionUrl=u+"//localhost/tsite/tonyu/project/newVersion.cgi"):(r.uploadTmpUrl=u+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",r.newVersionUrl=u+"//www.tonyu.jp/project/newVersion.cgi"),s.match(/((index)|(project))2/)&&(r.version=2,r.isNW?r.devMode=!0:r.devMode=!1),t.setEnvProvider(new t.Env(r)),window.WebSite=r,r}),r("Assets",["WebSite","Util","Tonyu","FS"],function(t,e,n,r){var i={resolve:function(n,i,o){o=o||{};var s=r.isFile(i)?i:i.getDir();if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,n){return t[n]}),t.urlAliases[n]&&(n=t.urlAliases[n]),e.startsWith(n,"ls:")){var a=n.substring("ls:".length);if(!s)throw new Error("Basedir not specified");var u=s.rel(a);if(!u.exists())throw new Error("Resource file not found: "+u);if(t.mp3Disabled&&a.match(/\.(mp3)$/)||t.mp4Disabled&&a.match(/\.(mp4|m4a)$/)){var c=s.rel(a.replace(/\.(mp3|mp4|m4a)$/,".ogg"));c.exists()&&(u=c)}if(n=u.getURL(),o.asFile)return u}return n}};return n.Assets=i,i}),r("assert",["FS"],function(t){return t.assert}),r("ImageList",["PatternParser","Util","Assets","assert"],function(t,e,n,r){var i,o={};return(i=function(e,i,s){s||(s={});var a=[],u=(e=function(t){var e=[];return t.forEach(function(t,n){t&&""!=t.url&&e.push(t)}),e}(e)).length;0==u&&setTimeout(function(){var t=[];t.names={},i(t)},0),e.forEach(function(e,c){console.log("loading",e,c);var l=e.url,f=l;if(o[f])h.apply(o[f],[]);else{l=n.resolve(l,s.prj||s.baseDir);var p=$("<img>");p.load(function(){o[f]=this,h.apply(this,[])}),p.attr("src",l)}function h(){var n,o;if("single"==e.type)a[c]=[{image:this,x:0,y:0,width:this.width,height:this.height}];else if((n=e.pwidth)&&(o=e.pheight)){for(var s=0,l=0,f=this.width,p=this.height,h=[];;){var d=n,g=o;if(s+n>f&&(d=f-s),l+o>p&&(g=p-l),h.push({image:this,x:s,y:l,width:d,height:g}),(s+=n)+n>f&&(s=0,(l+=o)+o>p))break}a[c]=h}else{var m=new t(this);a[c]=m.parse()}if(a[c].name=e.name,r.is(a[c],Array),0==--u){var v=[],y={};a.forEach(function(t){y[t.name]=v.length,v=v.concat(t)}),v.names=y,i(v)}}})}).load=i,i.parse1=function(e,n,i){var o,s,a;if((o=e.pwidth)&&(s=e.pheight)){for(var u=0,c=0,l=n.width,f=n.height,p=[];p.push({image:this,x:u,y:c,width:o,height:s}),!((u+=o)+o>l&&(u=0,(c+=s)+s>f)););a=p}else{a=new t(n,i).parse()}return a.name=e.name,r.is(a,Array)},window.ImageList=i,i}),r("Auth",["WebSite"],function(t){var e={currentUser:function(e){$.ajax({type:"get",url:t.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(t){console.log("auth.currentUser",t);var n=(t=JSON.parse(t)).user;"null"==n&&(n=null),console.log("user",n,"csrfToken",t.csrfToken),e(n,t.csrfToken)}})},assertLogin:function(n){e.currentUser(function(e,r){if(e)return n.success(e,r);window.onLoggedIn=n.success,n.showLoginLink(t.serverTop+"/login")})}};return window.Auth=e,e}),r("Blob",["Auth","WebSite","Util"],function(t,e,n){var r={};return r.BLOB_PATH_EXPR="${blobPath}",r.upload=function(t,n,r,i){var o=new FormData(document.getElementById("fileinfo"));i.error&&(i.error=function(t){alert(t)}),o.append("theFile",r),o.append("user",t),o.append("project",n),o.append("fileName",r.name),$.ajax({type:"get",url:e.serverTop+"/blobURL",success:function(t){$.ajax({url:t,type:"POST",data:o,processData:!1,contentType:!1,success:function(t){console.log("Res = "+t),i.success.apply({},arguments)},error:i.error})}})},r.isBlobURL=function(t){if(n.startsWith(t,"${blobPath}")){var e=t.split("/");return{user:e[1],project:e[2],fileName:e[3]}}},r.url=function(t,n,r){return e.blobPath+t+"/"+n+"/"+r},r.uploadToExe=function(t,n){var r=t.getBlobInfos(),i=r.length;if(console.log("uploadBlobToExe cnt=",i),0==i)return n.success();n.progress||(n.progress=function(t){console.log("uploadBlobToExe cnt=",t)}),r.forEach(function(t){var r={csrfToken:n.csrfToken};for(var o in t)r[o]=t[o];$.ajax({type:"get",url:e.serverTop+"/uploadBlobToExe",data:r,success:function(){if(0==--i)return n.success();n.progress(i)},error:n.error})})},r}),r("ImageRect",[],function(){return function t(e,n){if("string"==typeof e){var r=new Image,i=null,o=null,s=function(t){t&&(o=t),o&&i&&o(i)};return r.onload=function(){i=t(r,n),s()},r.src=e,s}var a=n.width,u=n.height,c=n.getContext("2d"),l=e.width,f=e.height,p=u/f*l,h=a/l*f;h>u&&(h=u),p>a&&(p=a),c.clearRect(0,0,a,u);var d=Math.floor((a-p)/2),g=Math.floor((u-h)/2);return c.drawImage(e,0,0,l,f,d,g,p,h),{left:d,top:g,width:p,height:h,src:e}}}),r("Content",["FS"],function(t){return t.Content}),r("thumbnail",["ImageRect","Content","root"],function(t,e,n){var r={},i="$icon_thumbnail",o=200,s=200;return r.set=function(e,a){setTimeout(function(){!function(e){try{var a=n.Tonyu.globals.$Screen.buf[0],u=$("<canvas>").attr({width:o,height:s});t(a,u[0]);var c=u[0].toDataURL(),l=e.getResource(),f=e.getDir(),p=r.file(e);p.text(c);for(var h={name:i,pwidth:o,pheight:s,url:"ls:"+p.relPath(f)},d=l.images,g=!1,m=0;m<d.length;m++)d[m].name==i&&(d[m]=h,g=!0);g||d.push(h),e.setResource(l),console.log("setRSRC",l)}catch(t){console.log("Create thumbnail failed",t),console.log(t.stack)}}(e)},a)},r.get=function(t){var e=r.file(t);return e.exists()?e.text():null},r.file=function(t){return t.getDir().rel("images/").rel("icon_thumbnail.png")},r}),r("plugins",["WebSite","root"],function(t,e){var n={},r={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/BodyActor/,symbol:"Box2D"},timbre:{src:"timbre.js",symbol:"T"},gif:{src:"gif-concat.js",detection:/GIFWriter/,symbol:"GIF"},Mezonet:{src:"Mezonet.js",symbol:"Mezonet"},PicoAudio:{src:"PicoAudio.min.js",symbol:"PicoAudio"},jquery_ui:{src:"jquery-ui.js",detection:/\$InputBox/,symbol:"$.ui"}};function i(t){return"function"==typeof t&&(t={onload:t}),t||(t={}),t.onload||(t.onload=function(){}),t}return n.installed=r,n.detectNeeded=function(t,e){for(var n in r){var i=r[n].detection;if(i)i.exec(t)&&(e[n]=1)}return e},n.loaded=function(t){var e=r[t];if(!e)throw new Error("plugin not found: "+t);return function(t){var e=window;return t.split(".").forEach(function(t){e&&(e=e[t])}),e}(e.symbol)},n.loadAll=function(t,e){e=i(e);var o=[];for(var s in t)r[s]&&!n.loaded(s)&&o.push(s);var a=0;console.log("loading plugins",o),setTimeout(function t(){a>=o.length?e.onload():n.load(o[a++],t)},0)},n.load=function(n,o){var s=r[n];if(!s)throw new Error("plugin not found: "+n);o=i(o);var a=t.pluginTop+"/"+s.src,u=e.requirejs;if(u)a=a.replace(/\.js$/,""),console.log("Loading plugin via requirejs",a),u([a],function(t){!window[s.symbol]&&t&&(window[s.symbol]=t),o.onload(t)});else{console.log("Loading plugin via <script>",a);var c=document.createElement("script");c.src=a,c.onload=o.onload,document.body.appendChild(c)}},n.request=function(t){n.loaded(t)||(new Error("Plugin "+t+" required").pluginName=t)},n}),r("DeferredUtil",["FS"],function(t){return t.DeferredUtil}),r("sysMod",["Tonyu","FS","ImageList","Blob","thumbnail","WebSite","plugins","DeferredUtil"],function(t,e,n,r,i,o,s,a){return{rawRun:function(t){if(o.removeJSOutput){var e=this.getOutputFile();e.exists()&&e.rm()}return this.loadClasses().then(()=>{this.detectPlugins(),this.fixBootRunClasses(),this.runScriptMode||i.set(this,2e3),this.rawBoot(t)})},getResourceFile:function(){return this.getDir().rel("res.json")},getResource:function(){var e=this.getResourceFile();if(e.exists()){var n=e.obj(),r=!1;for(var i in n)for(var o=n[i],s=o.length-1;s>=0;s--)o[s].url||(o.splice(s,1),r=!0);return r&&this.setResource(n),n}return t.defaultResource},hasSoundResource:function(){var t=this.getResource();return t&&t.sounds&&t.sounds.length>0},setResource:function(t){this.getResourceFile().obj(t)},getThumbnail:function(){return i.get(this)},convertBlobInfos:function(t){var e=this.getResource(),n=this.getName();!function e(i){if("object"==typeof i)for(var o in i)if(i.hasOwnProperty(o)){var s=i[o];if("url"==o){var a=r.isBlobURL(s);a&&(i[o]=[r.BLOB_PATH_EXPR,t,n,a.fileName].join("/"))}e(s)}}(e),this.setResource(e)},getBlobInfos:function(){var t=[];return function e(n){if("object"==typeof n)for(var i in n)if(n.hasOwnProperty(i)){var o=n[i];if("url"==i){var s=r.isBlobURL(o);s&&t.push(s)}e(o)}}(this.getResource()),t},loadResource:function(e){var r=this.getResource();n(r.images,function(n){var r=t.getGlobal("$Sprites");for(var i in r&&r.setImageList(n),n.names)t.setGlobal(i,n.names[i]);e&&e()})},detectPlugins:function(){var t=this.getOptions(),e=t.plugins=t.plugins||{};if(!e.Mezonet||!e.PicoAudio){var n=this.getResource(),r=!1,i=!1;n.sounds&&n.sounds.forEach(function(t){t.url.match(/\.mzo/)&&(r=!0),t.url.match(/\.midi?/)&&(i=!0)}),r?this.addPlugin("Mezonet"):this.removePlugin("Mezonet"),i?this.addPlugin("PicoAudio"):this.removePlugin("PicoAudio")}},addPlugin:function(t){var e=this.getOptions();e.plugins=e.plugins||{},e.plugins[t]||(e.plugins[t]=1,this.setOptions(e))},removePlugin:function(t){var e=this.getOptions();e.plugins[t]&&(delete e.plugins[t],this.setOptions(e))},requestPlugin:function(t){if(this.addPlugin(t),!s.loaded(t)){var e=new Error(""+t+"");throw e.pluginName=t,e}},loadPlugins:function(t){var e=this.getOptions();return s.loadAll(e.plugins,t)},fixBootRunClasses:function(){var t=this.getOptions();if(t.run){var e=this.fixClassName(t.run.mainClass),n=this.fixClassName(t.run.bootClass);e==t.run.mainClass&&n==t.run.bootClass||(t.run.mainClass=e,t.run.bootClass=n,this.setOptions(t))}},fixClassName:function(e){if(t.classMetas[e])return e;const n=this.getNamespace();console.log("NS",n);let r=t.classes[n][e];if(r)return`${n}.${e}`;for(var i in t.classes)if(r=t.classes[i][e])return`${i}.${e}`;throw new Error(`Cannot fix className ${e}`)},rawBoot:function(e){this.showProgress("Running "+e),this.initCanvas(),t.run(e)},initCanvas:function(){t.globals.$mainCanvas=$("canvas")},showProgress:function(t){return console.log("PROGRESS",t),"undefined"!=typeof SplashScreen&&SplashScreen.progress(t),a.promise(function(t){setTimeout(t,0)})}}}),r("CompiledProject",["require","exports","module","BuilderClient4Sys"],function(t,e,n){const r=t("BuilderClient4Sys");n.exports=r.CompiledProject}),r("IDEProject",["require","exports","module","ProjectFactory","BuilderClient","root","sysMod","CompiledProject","WebSite"],function(e,n,r){const i=e("ProjectFactory"),o=e("BuilderClient"),s=e("root"),a=e("sysMod"),u=e("CompiledProject"),c=e("WebSite"),l=o.langMod;i.addType("IDE",e=>{const n=e.ide,r=i.createDirBasedCore(e),f={kernel:{namespace:"kernel",url:c.compiledKernel}},p=new o(r,{worker:{ns2depspec:f,url:t}});let h;return i.addDependencyResolver((t,e)=>{if(f[e.namespace])return u.create(f[e.namespace])}),p.onCompiled=function(t){console.log("Sending src",t);const e=r.getIframeProject();e&&e.exec(t).catch(t=>console.error(t))},s.onTonyuDebuggerReady=(t=>{t.on("runtimeError",t=>{console.log("runt",t.stack.map(t=>t+"").join("\n")),n.showError(t)}),h=t,t.requestStop=(t=>n.stop(t)),p.setDebugger(t)}),r.setDebugger=(t=>p.setDebugger(t)),r.compiler=p,r.getIframeProject=(()=>{const t=s.document.querySelector("iframe");if(t)return t.contentWindow.Project}),r.disconnectDebugger=(()=>p.setDebugger()),r.fullCompile=p.fullCompile.bind(p),r.partialCompile=p.partialCompile.bind(p),r.renameClassName=p.renameClassName.bind(p),r.resetFiles=p.resetFiles.bind(p),r.include(a).include(l),r.stop=(()=>{try{if(h)return h.stop()}catch(t){console.error(t)}}),console.log("res.loadClasses",r.loadClasses),r}),n.create=(t=>i.create("IDE",t))}),r("Shell",["FS","assert"],function(t,e){var r={},i=e(t.PathUtil);function o(e,n){var o=function(e){if("string"!=typeof e)return e;var n=r.cwd;return i.isAbsolutePath(e)?t.resolve(e,n):n.rel(e)}(e);if(t.SFile.is(o)||console.log(o," is not file"),n&&!o.exists())throw new Error(o+": no such file or directory");return o}return r.newCommand=function(t,e){this[t]=e},r.cd=function(t){return r.cwd=o(t,!0),r.pwd()},r.vars=Object.create(t.getEnv()),r.mount=function(e,n){if(e&&e.t)t.mount(n,e.t,e);else{var r=[];for(var i in t.getRootFS().availFSTypes())r.push(i);sh.err("-t=("+r.join("|")+") should be specified.")}},r.unmount=function(e){t.unmount(e)},r.fstab=function(){var e=this;t.getRootFS().fstab().forEach(function(t){e.echo(t.fstype()+"\t"+(t.mountPoint||"<Default>"))})},r.resolve=o,r.pwd=function(){return r.cwd+""},r.ls=function(t){return(t=t?o(t,!0):r.cwd).ls()},r.cp=function(t,e,n){n||(n={}),n.v&&(r.echo("cp",t,e),n.echo=r.echo.bind(r));var i=o(t,!0),s=o(e);return i.copyTo(s,n)},r.ln=function(t,e,n){var r=o(e),i=o(t,!0);if(r.isDir()&&r.exists()&&(r=r.rel(i.name())),r.exists())throw new Error(r+" exists");return r.link(i,n)},r.rm=function(t,e){if(e||(e={}),e.notrash)return(t=o(t,!1)).removeWithoutTrash(),1;if((t=o(t,!0)).isDir()&&e.r){var n=t,i=0;return n.each(function(t){t.exists()&&(i+=r.rm(t,e))}),n.rm(),i+1}return t.rm(),1},r.mkdir=function(t,e){if((t=o(t,!1)).exists())throw new Error(t+" : exists");return t.mkdir()},r.cat=function(t,e){return t=o(t,!0),r.echo(t.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}))},r.resolve=function(t){return t||(t="."),t=o(t)},r.grep=function(t,e,n){return e=o(e,!0),n||(n={}),n.res||(n.res=[]),e.isDir()?e.each(function(e){r.grep(t,e,n)}):"string"==typeof t&&e.lines().forEach(function(i,o){i.indexOf(t)>=0&&function(t,e,i){n.res&&n.res.push({file:t,lineNo:e,line:i});r.echo(t+"("+e+"): "+i)}(e,o+1,i)}),n.res},r.touch=function(t){return(t=o(t)).text(t.exists()?t.text():""),1},r.setout=function(t){r.outUI=t},r.echo=function(){return $.when.apply($,arguments).then(function(){console.log.apply(console,arguments),r.outUI&&r.outUI.log&&r.outUI.log.apply(r.outUI,arguments)})},r.err=function(t){console.log.apply(console,arguments),t&&t.stack&&console.log(t.stack),r.outUI&&r.outUI.err&&r.outUI.err.apply(r.outUI,arguments)},r.clone=function(){var t=Object.create(this);return t.vars=Object.create(this.vars),t},r.getvar=function(t){return this.vars[t]||process&&process.env[t]},r.get=r.getvar,r.set=function(t,e){return this.vars[t]=e},r.strcat=function(){if(1==arguments.length)return arguments[0];for(var t="",e=0;e<arguments.length;e++)t+=arguments[e];return t},r.exists=function(t){return(t=this.resolve(t)).exists()},r.dl=function(t){return(t=this.resolve(t||".")).download()},r.zip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.zip.apply(t.zip,n)},r.unzip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.unzip.apply(t.zip,n)},r.prompt=function(){},r.ASYNC={r:"SH_ASYNC"},r.help=function(){for(var t in r){var e=r[t];"function"==typeof e&&r.echo(t+(e.description?" - "+e.description:""))}},window.sh||(window.sh=r),"object"==typeof process?(sh.devtool=function(){n("nw.gui").Window.get().showDevTools()},sh.cd(process.cwd().replace(/\\/g,"/"))):sh.cd("/"),r}),r("ScriptTagFS",["Content"],function(t){var e={};return e.toObj=function(){var t={};return $("script").each(function(){var e,n,r=this;if("text/tonyu"==r.type){var i=$(r).data("filename");if(i){var o=parseInt($(r).data("lastupdate")),s=$(r).data("wrap"),a=(e=r.innerHTML,(n=document.createElement("div")).innerHTML=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&#32;").replace(/\r/g,"&#13;").replace(/\n/g,"&#10;"),n.textContent||n.innerText);s?(s=parseInt(s),t[i]={lastUpdate:o,text:function(t,e){var n="";return t.split("\n").forEach(function(t){t.length>e?n+=t.substring(0,e):n+=t+"\n"}),n}(a,s)}):t[i]={lastUpdate:o,text:a}}}}),t},e.copyTo=function(n){var r=e.toObj();for(var i in r){var o=n.rel(i);o.isText()?o.text(r[i].text):o.setBytes(t.url(r[i].text).toByteArray())}},e});var i=function(){var t=function(t){this.context=null,this.picoAudio=null,this.soundDataAry=[],this.bgmPlayerMax=16,this.bgmPlayerAry=[],this.masterVolume=1,this.seMasterVolume=1,this.bgmMasterVolume=1,this.playingAudio=null,this.audioVolume=1,this.audioTempo=1,this.audioDataAry={data:[]},this.seSources=[],this.init(t)};return t.prototype.init=function(t){if(!this.inited&&(this.inited=!0,!this.disabled&&(t?this.context=t:window.AudioContext?this.context=new AudioContext:window.webkitAudioContext?this.context=new webkitAudioContext:(this.context=null,console.log("Your browser does not support yet Web Audio API")),this.context)))for(var e=0;e<this.bgmPlayerMax;e++)this.bgmPlayerAry[e]=new o(this,e)},t.prototype.allClearSoundData=function(){var t=this.soundDataAry;for(var e in t)delete t[e]},t.prototype.clearSoundData=function(t){delete this.soundDataAry[t]},t.prototype.allRemoveDecodedSoundData=function(){var t=this.soundDataAry;for(var e in t){var n=t[e];null!=n&&((n.isDecodeComplete()||n.isDecoding())&&n.removeDecodedData())}},t.prototype.removeDecodedSoundData=function(t){var e=this.soundDataAry[t];null!=e&&(e.isDecodeComplete()||e.isDecoding())&&e.removeDecodedData()},t.prototype.getMasterVolume=function(){return this.masterVolume},t.prototype.setMasterVolume=function(t){this.masterVolume=t;for(var e=0;e<this.bgmPlayerMax;e++){var n=this.bgmPlayerAry[e];n instanceof o&&n.onChangeBGMMasterVolume()}},t.prototype.createSoundFromArray=function(t,e,n){if(!this.context||this.disabled)return null;this.soundDataAry[t]=new s(t);var r,i=this.context,o=null!=e&&null!=n?2:1,a=i.createBuffer(o,e.length,i.sampleRate),u=a.getChannelData(0),c=null!=n?a.getChannelData(1):null;for(r=0;r<e.length;r++)u[r]=e[r];if(c)for(r=0;r<n.length;r++)c[r]=n[r];this.soundDataAry[t].onDecodeComplete(a)},t.prototype.loadSound=function(t,e,n,r){if(!this.context||this.disabled)return null;this.soundDataAry[t]=new s(t),(e.match(/\.(midi?)$/)||e.match(/^data:audio\/mid/))&&null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context)),"object"==typeof WebSite&&WebSite.mp3Disabled&&(e=e.replace(/\.(mp3)$/,".ogg")),"object"==typeof WebSite&&WebSite.mp4Disabled&&(e=e.replace(/\.(mp4|m4a)$/,".ogg"));var i=this,o=new XMLHttpRequest;if(o.onload=function(){if(200===o.status||0===o.status){var e=o.response;e instanceof ArrayBuffer?(i.soundDataAry[t].onLoadComplete(e),r?i.decodeSound(t,n):n&&n.succ&&n.succ(t)):(i.soundDataAry[t].onError("XHR_RESPONSE_ERROR"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID))}else i.soundDataAry[t].onError("XHR_STATUS_ERROR"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID)},o.onerror=function(e){console.log(e+""),i.soundDataAry[t].onError("XHR_ERROR"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID)},this.soundDataAry[t].onLoad(e),e.match(/^data:/)&&"undefined"!=typeof Util&&Util.Base64_To_ArrayBuffer)(o={onload:o.onload}).response=Util.Base64_To_ArrayBuffer(e.replace(/^data:audio\/[a-zA-Z0-9\-]+;base64,/i,"")),o.status=200,o.onload();else{o.open("GET",e,!0),o.responseType="arraybuffer";try{o.send(null)}catch(e){this.soundDataAry[t].onError("FILE_NOT_FOUND"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID)}}},t.prototype.decodeSound=function(t,e){var n=this.soundDataAry[t];if(null!=n&&null!=n.fileData&&n.isLoadComplete()&&!n.isDecodeComplete()){if(null==n.decodedCallbacksAry&&(n.decodedCallbacksAry=[]),e)if(null!=e.bgmPlayerId)n.decodedCallbacksAry.some(function(t,r){return e.bgmPlayerId==t.bgmPlayerId&&(n.decodedCallbacksAry[r]=e,!0)})||n.decodedCallbacksAry.push(e);else n.decodedCallbacksAry.push(e);if(!n.isDecoding()){n.onDecode();var r=n.fileData.slice(0),i=this;if(n.url.match(/\.(midi?)$/)||n.url.match(/^data:audio\/mid/)){null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context));var o=new Uint8Array(r),s=this.picoAudio.parseSMF(o);"string"==typeof s?(console.log("T2MediaLib: Error parseSMF()",s),this.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,this.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null):(this.soundDataAry[t].onDecodeComplete(s),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)}else if(n.url.match(/\.mzo$/)||n.url.match(/^data:audio\/mzo/))Mezonet.init().then(function(){var e=Array.prototype.slice.call(new Uint8Array(r));i.soundDataAry[t].onDecodeComplete(new Mezonet.Source(e)),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null},function(e){e instanceof Error?console.log("T2MediaLib: "+e.message,n.url):console.log("T2MediaLib: Error decodeMZO()",n.url),i.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,i.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null});else{if(n.url.match(/\.(ogg?)$/)||n.url.match(/^data:audio\/ogg/)){var a=this.searchOggLoop(r);n.tagLoopStart=a[0],n.tagLoopEnd=a[1]}this.context.decodeAudioData(r,function(e){i.soundDataAry[t].isDecoding()&&(i.soundDataAry[t].onDecodeComplete(e),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)},function(e){e instanceof Error?console.log("T2MediaLib: "+e.message,n.url):console.log("T2MediaLib: Error decodeAudioData()",n.url),i.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,i.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null})}}}},t.prototype.activate=function(){if(this.init(),this.context){if(!this.isContextResumed&&this.context.resume){var t=this;this.context.resume().then(function(){t.isContextResumed=!0})}if(!this.isActivated){this.isActivated=!0;for(var e=this.context.createBuffer(1,Math.floor(this.context.sampleRate/32),this.context.sampleRate),n=e.getChannelData(0),r=0;r<n.length;r++)n[r]=0;var i=this.context.createBufferSource();i.buffer=e,i.connect(this.context.destination),i.start=i.start||i.noteOn,i.start(0)}}},t.prototype.getSoundFileData=function(t){var e=this.soundDataAry[t];return e?e.fileData:null},t.prototype.getSoundDecodedData=function(t){var e=this.soundDataAry[t];return e?e.decodedData:null},t.prototype.getCurrentTime=function(){return this.context?this.context.currentTime:null},t.prototype.playSE=function(t,e,n,r,i,o,s,a,u,c){if(!this.context)return null;var l,f=this.soundDataAry[t];if(null==f)return null;if(!f.isDecodeComplete()){var p=this,h={succ:function(t){p.playSE(t,e,n,r,i,o,s,a,u,c)},err:function(){}};return this.decodeSound(t,h),null}if(l=f.decodedData,"undefined"!=typeof Mezonet&&l instanceof Mezonet.Source){var d=f.decodedData.playback(this.context);return d.Start(),d}var g=f.decodedData;if(!(g instanceof AudioBuffer))return null;null==e&&(e=1),null==n&&(n=0),r||(r=1),i?i>g.duration?i=g.duration:i<0&&(i=0):i=0;var m=c;c||(m=86400),o||(o=!1),s?s<0?s=0:s>g.duration&&(s=g.duration):s=f.loopStart||0,a?a<0?a=0:a>g.duration&&(a=g.duration):a=g.duration,u=u||0;var v=this.context.createBufferSource();this.context.createGain=this.context.createGain||this.context.createGainNode;var y=this.context.createGain(),b=this.context.createPanner();v.buffer=g,v.loop=o,v.loopStart=s,v.loopEnd=a,v.playbackRate.value=r,v.connect(y),y.connect(b),b.connect(this.context.destination),b.panningModel="equalpower",n<-1?n=-1:n>1&&(n=1);var w,S=90*n,x=Math.sin(S*(Math.PI/180)),_=-Math.cos(S*(Math.PI/180));-1!==n&&1!==n||(_=0),b.positionX?(b.positionX.value=x,b.positionY.value=0,b.positionZ.value=_):b.setPosition(x,0,_),y.gain.value=e*this.seMasterVolume*this.masterVolume,w=o&&a-s>0&&i>a?a:i,v.gainNode=y,v.volumeValue=e,v.panNode=b,v.panValue=n,v.playStartTime=this.context.currentTime+u,v.playOffset=w,v.plusTime=w,v.start=v.start||v.noteOn,v.stop=v.stop||v.noteOff,v.start(u,i,m),o&&null!=c&&v.stop(u+c);var E=this;return E.seSources.push(v),v.onended=function(t){v.onended=null;var e=E.seSources.indexOf(v);e>=0&&E.seSources.splice(e,1)},v},t.prototype.stopSE=function(t){if(!(t instanceof AudioBufferSourceNode))return null;try{t.stop(0)}catch(e){t.gainNode&&(t.gainNode.gain.cancelScheduledValues(this.context.currentTime),t.gainNode.gain.linearRampToValueAtTime(0,this.context.currentTime))}return t},t.prototype.stopAllSE=function(t){var e=this;this.seSources.forEach(function(t){e.stopSE(t)})},t.prototype.getSEMasterVolume=function(){return this.seMasterVolume},t.prototype.setSEMasterVolume=function(t){this.seMasterVolume=t},t.prototype.getSEVolume=function(t){return t instanceof AudioBufferSourceNode?t.volumeValue:null},t.prototype.setSEVolume=function(t,e){return t instanceof AudioBufferSourceNode?(t.gainNode.gain.value=e*this.seMasterVolume*this.masterVolume,t.volumeValue=e,t):null},t.prototype.getSERate=function(t){return t instanceof AudioBufferSourceNode?t.playbackRate.value:null},t.prototype.setSERate=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;t.playbackRate.value=e},t.prototype.getSEPan=function(t){return t instanceof AudioBufferSourceNode?t.panValue:null},t.prototype.setSEPan=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;var n=t.panNode;e<-1?e=-1:e>1&&(e=1);var r=90*e,i=Math.sin(r*(Math.PI/180)),o=Math.cos(r*(Math.PI/180));-1!==e&&1!==e||(o=0),n.positionX?(n.positionX.value=i,n.positionY.value=0,n.positionZ.value=o):n.setPosition(i,0,o),t.panValue=e},t.prototype.isSELoop=function(t){return t instanceof AudioBufferSourceNode?t.loop:null},t.prototype.setSELoop=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;t.loop=e},t.prototype.getSELoopStartTime=function(t){return t instanceof AudioBufferSourceNode?t.loopStart:null},t.prototype.setSELoopStartTime=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;t.loopStart=e},t.prototype.getSELoopEndTime=function(t){return t instanceof AudioBufferSourceNode?t.loopEnd:null},t.prototype.setSELoopEndTime=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;t.loopEnd=e},t.prototype.playBGM=function(t,e,n,r,i,o){if(!this.context)return null;var s=this._getBgmPlayer(t);return s?s.playBGM(e,n,r,i,o):null},t.prototype.stopBGM=function(t){var e=this._getBgmPlayer(t);return e?e.stopBGM():null},t.prototype.pauseBGM=function(t){var e=this._getBgmPlayer(t);return e?e.pauseBGM():null},t.prototype.resumeBGM=function(t){var e=this._getBgmPlayer(t);return e?e.resumeBGM():null},t.prototype.getBGMMasterVolume=function(){return this.bgmMasterVolume},t.prototype.setBGMMasterVolume=function(t){this.bgmMasterVolume=t;for(var e=0;e<this.bgmPlayerMax;e++){var n=this.bgmPlayerAry[e];n instanceof o&&n.onChangeBGMMasterVolume()}},t.prototype.getBGMVolume=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMVolume():null},t.prototype.setBGMVolume=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMVolume(e):null},t.prototype.getBGMTempo=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMTempo():null},t.prototype.setBGMTempo=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMTempo(e):null},t.prototype.getBGMPan=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMPan():null},t.prototype.setBGMPan=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMPan(e):null},t.prototype.isBGMLoop=function(t){var e=this._getBgmPlayer(t);return e?e.isBGMLoop():null},t.prototype.setBGMLoop=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoop(e):null},t.prototype.getBGMLoopStartTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLoopStartTime():null},t.prototype.setBGMLoopStartTime=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoopStartTime(e):null},t.prototype.getBGMLoopEndTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLoopEndTime():null},t.prototype.setBGMLoopEndTime=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoopEndTime(e):null},t.prototype.getBGMCurrentTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMCurrentTime():null},t.prototype.getBGMLength=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLength():null},t.prototype.getPlayingBGMName=function(t){var e=this._getBgmPlayer(t);return e?e.getPlayingBGMName():null},t.prototype.setOnBGMEndListener=function(t,e){var n=this._getBgmPlayer(t);return n?n.setOnBGMEndListener(e):null},t.prototype.getPlayingBGMState=function(t){var e=this._getBgmPlayer(t);return e?e.getPlayingBGMState():null},t.prototype.getBGMPicoAudio=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMPicoAudio():null},t.prototype.isTagLoop=function(t){var e=this._getBgmPlayer(t);return e?e.isTagLoop():null},t.prototype.setTagLoop=function(t,e){var n=this._getBgmPlayer(t);return n?n.setTagLoop(e):null},t.prototype.getBGMPlayerMax=function(){return this.bgmPlayerMax},t.prototype.allStopBGM=function(){for(var t=0;t<this.bgmPlayerMax;t++)this.stopBGM(t)},t.prototype.allResetBGM=function(){for(var t=0;t<this.bgmPlayerMax;t++)this.stopBGM(t),this.setBGMVolume(t,1),this.setBGMTempo(t,1),this.setBGMPan(t,0);this.setMasterVolume(1),this.setSEMasterVolume(1),this.setBGMMasterVolume(1)},t.prototype._getBgmPlayer=function(t){if(t<0||this.bgmPlayerMax<=t)return null;var e=this.bgmPlayerAry[t];return e instanceof o?e:null},t.prototype.loadAudio=function(t,e){var n=new Audio(e);n.play(),this.audioDataAry.data[t]=null;var r=this;n.addEventListener("loadstart",function(){if(!r.context)return null;r.context.createMediaElementSource(n).connect(r.context.destination)},!1),n.addEventListener("canplay",function(){this.audioDataAry.data[t]=n},!1),n.load()},t.prototype.playAudio=function(t,e,n){var r=this.audioDataAry.data[t];return r?(n||(n=0),this.playingAudio instanceof Audio&&(this.playingAudio.pause(),this.playingAudio.currentTime=0),this.playingAudio=r,r.loop=e,r.volume=this.audioVolume,r.currentTime=n,r.play(),r):null},t.prototype.stopAudio=function(){var t=this.playingAudio;return t instanceof Audio?(t.pause(),t.currentTime=0,this.playingAudio=null,t):null},t.prototype.pauseAudio=function(){var t=this.playingAudio;return t?(t.pause(),t):null},t.prototype.resumeAudio=function(){var t=this.playingAudio;return t?(t.play(),t):null},t.prototype.setAudioVolume=function(t){this.audioVolume=t,this.playingAudio instanceof Audio&&(this.playingAudio.volume=t)},t.prototype.setAudioTempo=function(t){this.audioTempo=t,this.playingAudio instanceof Audio&&(this.playingAudio.playbackRate=t)},t.prototype.setAudioPosition=function(t){this.playingAudio instanceof Audio&&(this.playingAudio.currentTime=t)},t.prototype.getAudioData=function(t){return this.audioDataAry.data[t]},t.prototype.getAudioCurrentTime=function(){return this.playingAudio instanceof Audio?this.playingAudio.currentTime:null},t.prototype.getAudioLength=function(){return this.playingAudio instanceof Audio?this.playingAudio.duration:null},t.prototype.searchOggLoop=function(t){var e=new Uint8Array(t.slice(0,3e3)),n=String.fromCharCode.apply(null,e);if(-1==n.lastIndexOf("vorbis",34))return[0,0];var r,i,o,s=n.indexOf("LOOPSTART="),a=n.indexOf("LOOPLENGTH="),u=0,c=0,l=e[40]+(e[41]<<8)+(e[42]<<16)+(e[43]<<24);if(-1!=s)for(r=e[s]+(e[s+1]<<8)+(e[s+2]<<16)+(e[s+3]<<24),i=s+10;i<s+r&&!((o=n[i])<"0"||o>"9");i++)u=10*u+(o-"0");if(-1!=a)for(r=e[a]+(e[a+1]<<8)+(e[a+2]<<16)+(e[a+3]<<24),i=a+11;i<a+r&&!((o=n[i])<"0"||o>"9");i++)c=10*c+(o-"0");var f=(u+c)/l;return[u/=l,f]},t}(),o=function(){function t(t){return"undefined"!=typeof PicoAudio&&t instanceof PicoAudio}function e(t){return"undefined"!=typeof Mezonet&&t instanceof Mezonet.Playback}var n=function(t,e){this.t2MediaLib=t,this.id=e,this.playingBGMState="stop",this.playingBGMStatePending=null,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1,this.bgmPan=0,this.picoAudio=null,this.picoAudioSetDataBGMName=null,this.PICO_AUDIO_VOLUME_COEF=1,this.isTagLoop=!0};return n.prototype.playBGM=function(t,e,n,r,i){this.stopBGM();var o=this.t2MediaLib.soundDataAry[t];if(null==o)return null;if(!o.isDecodeComplete()){var s=this,a={};return a.bgmPlayerId=this.id,a.succ=function(){var a=function(){var o=s.playingBGMStatePending;s._setPlayingBGMState("stop",!0),"stop"!=o&&s.playingBGMName==t&&s.playBGM(t,e,n,r,i),"pause"==o&&s.pauseBGM()};o.decodedData instanceof Object?setTimeout(function(){a()},0):a()},a.err=function(){s._setPlayingBGMState("stop",!0)},this.playingBGMName=t,this._setPlayingBGMState("decoding",!0),this._setPlayingBGMState("play"),this.t2MediaLib.decodeSound(t,a),this}var u=o.decodedData;if("undefined"!=typeof Mezonet&&u instanceof Mezonet.Source){var c=u.playback(this.t2MediaLib.context);this.playingBGM=c,c.Start()}else if(u instanceof AudioBuffer)this.isTagLoop&&(r=r||o.tagLoopStart,i=i||o.tagLoopEnd),this.playingBGM=this.t2MediaLib.playSE(t,this.bgmVolume,this.bgmPan,this.bgmTempo,n,e,r,i);else if(u instanceof Object){if(this._initPicoAudio(),t!=this.picoAudioSetDataBGMName?(this.picoAudio.setData(u),this.picoAudioSetDataBGMName=t):this.picoAudio.initStatus(),this.picoAudio.setLoop(e),this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*this.bgmVolume*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),n){var l=this.picoAudio.getTime(Number.MAX_SAFE_INTEGER);n>l?n=l:n<0&&(n=0)}else n=0;this.picoAudio.setStartTime(n),this.picoAudio.play(),this.playingBGM=this.picoAudio}return this.playingBGMName=t,this.bgmPause=0,this._setPlayingBGMState("play"),this},n.prototype.stopBGM=function(){var n=this.playingBGM;if(e(n))n.Stop();else if(t(n))this.picoAudio.stop();else if(n instanceof AudioBufferSourceNode)try{n.stop(0)}catch(t){n.gainNode&&(n.gainNode.gain.cancelScheduledValues(this.t2MediaLib.context.currentTime),n.gainNode.gain.linearRampToValueAtTime(0,this.t2MediaLib.context.currentTime))}return this.playingBGM=null,this.playingBGMName=null,this._setPlayingBGMState("stop"),this},n.prototype.pauseBGM=function(){var n=this.playingBGM;if(e(n))n.pause();else if(t(n))0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseCurrentTime=n.context.currentTime,n.stop(),this.bgmPause=1);else if(n instanceof AudioBufferSourceNode&&0===this.bgmPause){this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=this.t2MediaLib.getSELoopStartTime(n),this.bgmPauseLoopEnd=this.t2MediaLib.getSELoopEndTime(n),this.bgmPauseLoop=this.t2MediaLib.isSELoop(n),this.bgmPauseCurrentTime=n.context.currentTime,this.bgmPauseTempo=this.bgmTempo;try{n.stop(0)}catch(t){n.gainNode&&(n.gainNode.gain.cancelScheduledValues(this.t2MediaLib.context.currentTime),n.gainNode.gain.linearRampToValueAtTime(0,this.t2MediaLib.context.currentTime))}this.bgmPause=1}return"stop"!=this.playingBGMState&&this._setPlayingBGMState("pause"),this},n.prototype.resumeBGM=function(){var n=this.playingBGM;return e(n)?n.resume():t(n)?1===this.bgmPause&&(n.play(),this.bgmPause=0):n instanceof AudioBufferSourceNode&&1===this.bgmPause&&(n=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd)),this},n.prototype.onChangeBGMMasterVolume=function(){this.setBGMVolume(this.getBGMVolume())},n.prototype.getBGMVolume=function(){return this.bgmVolume},n.prototype.setBGMVolume=function(n){var r=this.playingBGM;return this.bgmVolume=n,e(r)?r.setVolume(n):t(r)?this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*n*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume):r instanceof AudioBufferSourceNode&&(r.gainNode.gain.value=n*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),this},n.prototype.getBGMTempo=function(){return this.bgmTempo},n.prototype.setBGMTempo=function(t){var n=this.playingBGM;return(t<=0||isNaN(t))&&(t=1),e(n)?(n.setRate(t),this):(n instanceof AudioBufferSourceNode&&0===this.bgmPause&&(n.plusTime-=(this.t2MediaLib.context.currentTime-n.playStartTime)*(t-this.bgmTempo)),this.bgmTempo=t,this.t2MediaLib.setSERate(n,t),this)},n.prototype.getBGMPan=function(){return this.bgmPan},n.prototype.setBGMPan=function(t){var e=this.playingBGM;return this.bgmPan=t,e instanceof AudioBufferSourceNode&&this.t2MediaLib.setSEPan(e,t),this},n.prototype.isBGMLoop=function(){var e=this.playingBGM;return t(e)?this.picoAudio.isLoop():e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoop:this.t2MediaLib.isSELoop(e):null},n.prototype.setBGMLoop=function(e){var n=this.playingBGM;return t(n)?this.picoAudio.setLoop(e):n instanceof AudioBufferSourceNode&&(1===this.bgmPause?this.bgmPauseLoop=e:this.t2MediaLib.setSELoop(n,e)),this},n.prototype.getBGMLoopStartTime=function(){var e=this.playingBGM;return t(e)?0:e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopStart:this.t2MediaLib.getSELoopStartTime(e):null},n.prototype.setBGMLoopStartTime=function(t){var e=this.playingBGM;if(e instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopStartTime(e,t);this.bgmPauseLoopStart=t}return this},n.prototype.getBGMLoopEndTime=function(){var e=this.playingBGM;return t(e)?this.getBGMLength():e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopEnd:this.t2MediaLib.getSELoopEndTime(e):null},n.prototype.setBGMLoopEndTime=function(t){var e=this.playingBGM;if(e instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopEndTime(e,t);this.bgmPauseLoopEnd=t}return this},n.prototype.getBGMCurrentTime=function(){var n,r,i,o,s,a,u,c=this.playingBGM;return e(c)?c.getTrackTime():t(c)?n=0===this.bgmPause?this.picoAudio.context.currentTime-this.picoAudio.states.startTime:this.bgmPauseTime:c instanceof AudioBufferSourceNode?(0===this.bgmPause?(i=this.t2MediaLib.context.currentTime,o=this.bgmTempo):(i=this.bgmPauseCurrentTime,o=this.bgmPauseTempo),r=(i-c.playStartTime)*o+c.plusTime,c.loop&&(c.loopEnd-c.loopStart>0?r<c.loopStart?(s=0,a=0,u=c.buffer.duration):(s=c.loopStart,a=c.loopStart,u=c.loopEnd-c.loopStart):(u=c.buffer.duration,s=0,a=0)),c.loop?n=(r-a)%u+s:(n=r)>c.buffer.duration&&(n=c.buffer.duration),n):null},n.prototype.getBGMLength=function(){var e=this.playingBGM;return t(e)?this.picoAudio.getTime(Number.MAX_SAFE_INTEGER):e instanceof AudioBufferSourceNode?e.buffer.duration:null},n.prototype.getPlayingBGMName=function(){return this.playingBGMName},n.prototype.setOnBGMEndListener=function(t){null!=this.picoAudio&&this.picoAudio.setOnSongEndListener(t)},n.prototype.getPlayingBGMState=function(){return this.playingBGMState},n.prototype.getBGMPicoAudio=function(){return this._initPicoAudio(),this.picoAudio},n.prototype.isTagLoop=function(){return this.isTagLoop},n.prototype.setTagLoop=function(t){this.isTagLoop=t},n.prototype._setPlayingBGMState=function(t,e){e||"decoding"!=this.playingBGMState?(this.playingBGMState=t,this.playingBGMStatePending=null):this.playingBGMStatePending=t},n.prototype._initPicoAudio=function(){null==this.picoAudio&&(0==this.id&&(this.picoAudio=this.t2MediaLib.picoAudio),null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.t2MediaLib.context,this.t2MediaLib.picoAudio)))},n}(),s=function(){var t=function(t,e){this.idx=t,this.state="none",this.errorID=null,this.url=null,this.fileData=null,this.decodedData=null,this.decodedCallbacksAry=null,this.tagLoopStart=0,this.tagLoopEnd=0};return t.prototype.onLoad=function(t){this.state="loading",this.url=t},t.prototype.onLoadComplete=function(t){this.state="loaded",this.fileData=t},t.prototype.onDecode=function(){this.state="decoding"},t.prototype.onDecodeComplete=function(t){this.state="decoded",this.decodedData=t},t.prototype.onError=function(t){this.state="error",this.errorID=t},t.prototype.isNone=function(){return"none"==this.state},t.prototype.isLoadComplete=function(){switch(this.state){case"loaded":case"decoding":case"decoded":return!0}return!1},t.prototype.isDecoding=function(){return"decoding"==this.state},t.prototype.isDecodeComplete=function(){return"decoded"==this.state},t.prototype.removeDecodedData=function(){this.state="loaded",this.decodedData=null},t}();window.T2MediaLib=i,window.T2MediaLib_BGMPlayer=o,window.T2MediaLib_SoundData=s,r("T2MediaLib",function(t){return function(){return t.T2MediaLib}}(this)),r("exceptionCatcher",[],function(){var t={f:function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(e){t.handleException(e)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var r in e)e[r]=t.f(e[r]);return e}}};return t}),r("UI",["Util","exceptionCatcher"],function(t,e){var n={},r=e.f;return(n=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var o=[],s={},a=[],u=c(e);return u.$edits=a,u.$vars=s,$.data(u,"edits",a),$.data(u,"vars",s),a.load=function(t){a.model=t,a.forEach(function(t){a.writeToJq(t.params.$edit,t.jq)}),a.validator.on.validate.call(a.validator,a.model)},a.writeToJq=function(t,e){var n=a.model;if(n){for(var r=t.name.split("."),i=0;i<r.length;i++)n=n[r[i]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},a.validator={errors:{},show:function(){if(s.validationMessage)for(var t in s.validationMessage.empty(),this.errors)s.validationMessage.append(n("div",this.errors[t].mesg));if(s.OKButton){var e=!0;for(var t in this.errors)e=!1;s.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},a.writeToModel=function(t,e,n){var r=a.model;if(r){var i=t.name;try{e=t.type.fromVal(e)}catch(t){return void a.validator.addError(i,t,n)}a.validator.removeError(i);for(var o=i.split("."),s=0;s<o.length;s++)s==o.length-1?a.on.writeToModel(i,e)||(r[o[s]]=e):r=r[o[s]];a.validator.on.validate.call(a.validator,a.model)}},a.on={},a.on.writeToModel=function(t,e){},o.length>0&&setTimeout(r(function t(){o.forEach(function(t){t()});setTimeout(r(t),50)}),50),u;function c(e){return e instanceof Array?function(e){var i=e[0],u=1,l=$("<"+i+">");"object"!=typeof e[u]||e[u]instanceof Array||e[u]instanceof $||(!function(e,i,u){i.$var&&(s[i.$var]=e);i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(t){a.writeToModel(i.$edit,t,e)}),s[i.$edit.name]||(s[i.$edit.name]=e),a.push({jq:e,params:i}));for(var c in i)if("on"==c)for(var l in i.on)f(l,i.on[l]);else"css"==c&&null!=i[c]?e.css(i[c]):t.startsWith(c,"$")||null==i[c]||e.attr(c,i[c]);function f(t,n){if(n)if("enterkey"==t)e.on("keypress",r(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var s,a=!0;o.push(function(){var t;t="checkbox"==i.type?!!e.prop("checked"):e.val(),(a||s!=t)&&(n.apply(e,[t,s]),s=t),a=!1})}else e.on(t,r(n))}}(l,e[u]),u++);for(;u<e.length;)l.append(c(e[u])),u++;return l}(e):"string"==typeof e?(i=e,$(document.createTextNode(i))):e;var i}}).types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),r("UIDiag",["UI"],function(t){var e={};function n(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t}function r(t,e){return null==t&&(t=""),n(t)?{title:e,body:i(t)}:"undefined"!=typeof $&&t instanceof $?{title:t.title||e,body:t}:(n(t.body)&&(t.body=i(t.body)),t)}function i(e){var n=(e+"").split("\n");return 1==n.length?n[0]:t.apply(this,["div"].concat(n.map(function(t){return["div",t]})))}return e.confirm=function(e){e=r(e,"");var n=t("div",{title:e.title},["div",e.body],["button",{on:{click:o(!0)}},"OK"],["button",{on:{click:o(!1)}},""]).dialog({width:"auto",close:o(!1)}),i=$.Deferred();function o(t){return function(){i.resolve(t),n.dialog("close"),n.remove()}}return i.promise()},e.alert=function(e){e=r(e,"");var n=t("div",{title:e.title},["div",e.body],["button",{on:{click:o(!0)}},"OK"]).dialog({width:"auto",close:o(!1)}),i=$.Deferred();function o(t){return function(){i.resolve(t),n.dialog("close"),n.remove()}}return i.promise()},e.open=function(t,n,r,i,o,s,a){return e.prompt({title:t,body:n},r,{left:i,top:o,width:s,height:a})},e.getStatus=function(){return e.status},e.getText=function(){return e.val?e.val.val():""},e.prompt=function(n,i,o){n=r(n,""),"number"==typeof(o=o||{}).left&&"number"==typeof o.top?position={my:"left top",at:"left+"+o.left+" top+"+o.top,of:"body"}:position={of:"body",at:"center",my:"center"};var s=t("div",{title:n.title},["div",n.body],["input",{on:{enterkey:u},$var:"val",value:i}],["br"],["button",{on:{click:u}},"OK"],["button",{on:{click:function(){e.status=2,s.dialog("close"),s.remove(),a.resolve()}}},""]).dialog({width:o.width||"auto",height:o.height||"auto",position:position,close:function(){s.dialog("close"),a.resolve()}});setTimeout(function(){s.$vars.val.focus()},10),e.status=0,e.val=s.$vars.val;var a=$.Deferred();function u(){e.status=1;var t=s.$vars.val.val();e.resultValue=t,a.resolve(t),s.dialog("close"),s.remove()}return a.promise()},"undefined"!=typeof window&&(window.UIDiag=e),e}),r("runtime",["ImageList","T2MediaLib","UIDiag"],function(t,e,n){return console.log("runtimes loaded",arguments),window.T2MediaLib||(window.T2MediaLib=e),{ImageList:t,T2MediaLib:e,UIDiag:n}}),r("runScript_common",["root"],function(t){return t.SplashScreen={hide:function(){$("#splash").hide()},show:function(){},progress:function(t){$("#splash .progress").text(t)}},{initCanvas:function(t){var e=$(window).width(),n=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var r=$("<canvas>").attr({width:e-0,height:n-0,class:"tonyu-canvas"}).appendTo("body"),i=navigator.userAgent.toLowerCase();return null==t&&(t=-1==i.indexOf("iphone")&&-1==i.indexOf("ipad")&&-1==i.indexOf("ipod")&&(!window.parent||window===window.parent)),t&&$(window).resize(function(){var t=0;e=$(window).width(),n=$(window).height(),r.attr({width:e-t,height:n-t})}),r}}}),r("Debugger",["require","exports","module","BuilderClient4Sys","Tonyu"],function(t,e,n){const r=t("BuilderClient4Sys").DebuggerCore,i=t("Tonyu");n.exports=r({Tonyu:i})}),r("SourceFiles",["require","exports","module","BuilderClient4Sys"],function(t,e,n){const r=t("BuilderClient4Sys");n.exports=r.SourceFiles}),e(["FS","Tonyu","IDEProject","Shell","ScriptTagFS","runtime","WebSite","root","runScript_common","Debugger","SourceFiles","sysMod","ProjectFactory","CompiledProject"],function(t,e,n,r,i,o,s,a,u,c,l,f,p,h){$(function(){var o=t.get(s.tonyuHome),a=t.get("/ram/");t.mount(a.path(),t.LSFS.ramDisk()),e.defaultResource={images:[{name:"$pat_base",url:"images/base.png",pwidth:32,pheight:32},{name:"$pat_sample",url:"images/Sample.png"},{name:"$pat_neko",url:"images/neko.png",pwidth:32,pheight:32}],sounds:[]};var l=u.initCanvas(),d=location.href.replace(/\?.*/,"").split(/\//),g=d.pop()||"runscript",m=d.pop()||"nobody",v=a,y=o.rel(m+"/"+g+"/");a.rel("files/").link(y);var b=i.toObj();for(var w in b){var S=v.rel(w);if(!S.isDir()){var x=b[w];S.text(x.text),delete x.text,x.lastUpdate&&S.metaInfo(x)}}r.cd(v),e.defaultOptions={compiler:{defaultSuperClass:"Actor"},run:{mainClass:"Main",bootClass:"Boot"},kernelEditable:!1};const _=t=>t,E=h.create({dir:v});E.include(f),E.initCanvas=function(){e.globals.$mainCanvas=l},p.addDependencyResolver((t,e)=>{if("kernel"===e.namespace&&!e.url&&s.compiledKernel)return p.fromDependencySpec(t,{url:s.compiledKernel,namespace:e.namespace})});const A={restart:_,stop:_,displayMode:_,jump:_};var C=n.create({dir:v,ide:A});e.animationFrame=(()=>new Promise(requestAnimationFrame)),async function(){await C.fullCompile();C.setDebugger(c),await c.init(E),e.globals.$debugger=c,e.currentProject=e.globals.$currentProject=E,E.detectPlugins();var t=E.getOptions();t.compiler&&t.compiler.diagnose&&(t.compiler.diagnose=!1,E.setOptions(t));E.runScriptMode=!0,e.runMode=!0,console.log("RAWBoot"),E.fixBootRunClasses(),E.rawBoot(t.run.bootClass),v.watch((t,e)=>{e.endsWith(".tonyu")&&(console.log("modifai",t,e,arguments),C.partialCompile(e).catch(t=>{console.error(t)}))})}().then(_,t=>console.error(t))})}),r("runScript",function(){})}((()=>{const t=new Blob(['!function(){return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module \'"+s+"\'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){return i(e[s][1][t]||t)},f,f.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}}()({1:[function(t,e,n){},{}],2:[function(t,e,n){t("../runtime/TonyuRuntime");const r=t("../lang/Builder"),i=t("../lib/root"),o=(i.Worker,t("../lib/WorkerServiceW")),s=t("../lib/FS");i.FS=s;const a=t("../project/ProjectFactory"),u=t("../project/CompiledProject");t("../lang/langMod");let c,f;const l={},p=s.get("/prj/");function h(t){return t.isTError&&(t.src=t.src.path()),t}a.addDependencyResolver(function(t,e){if(console.log("RESOLV",e,l),e.namespace&&l[e.namespace])return a.fromDependencySpec(t,l[e.namespace])}),o.serv("compiler/init",t=>{Object.assign(l,t.ns2depspec||{});const e=t.files,n=t.namespace||"user",i=p.rel(n+"/");return i.importFromObject(e),c=u.create({dir:i}),f=new r(c),{prjDir:i.path()}}),o.serv("compiler/resetFiles",t=>{const e=t.files,n=t.namespace||"user",r=p.rel(n+"/");r.recursive(t=>console.log("RM",t.path(),!t.isDir()&&t.rm())),r.importFromObject(e),f.requestRebuild()}),o.serv("compiler/addDependingProject",t=>{const e=t.files,n=p.rel(t.namespace+"/");n.importFromObject(e);u.create({dir:n});return l[t.namespace]={dir:n.path()},{prjDir:n.path()}}),o.serv("compiler/fullCompile",async t=>{try{return(await f.fullCompile({destinations:{memory:1}})).export()}catch(t){throw h(t)}}),o.serv("compiler/postChange",async t=>{try{const e=t.files;let n;for(let t in e){n=t;break}const r=c.getDir().rel(n);return r.text(e[n]),(await f.postChange(r)).export()}catch(t){throw h(t)}}),o.serv("compiler/renameClassName",async t=>{try{const e=await f.renameClassName(t.from,t.to),n={};for(let t of e)t.exists()?n[t.path()]=t.text():n[t.path()]=null;return n}catch(t){throw h(t)}}),o.ready()},{"../lang/Builder":3,"../lang/langMod":15,"../lib/FS":20,"../lib/WorkerServiceW":21,"../lib/root":23,"../project/CompiledProject":24,"../project/ProjectFactory":25,"../runtime/TonyuRuntime":27}],3:[function(t,e,n){const r=t("../runtime/TonyuRuntime"),i=t("./JSGenerator"),o=t("./Semantics"),s=(t("../lib/FS"),t("../lib/assert"),t("./source-map"),t("./TypeChecker"),t("../runtime/TError")),a=t("./IndentBuffer"),u=t("./SourceFiles");function c(t){var e={},n=[],i=0;for(var o in t)e[o]=!1,i++;for(;n.length<i;){var a=n.length;for(let r in t)if(!e[r]){var u=t[r];0==f(u).length&&(n.push(u),e[r]=!0)}if(n.length==a){var c=[];for(let n in t)if(!e[n]){c=l(t[n])||[];break}throw s(": "+c.join("->"),"",0)}}function f(n){let i=r.klass.getDependingClasses(n);return i=i.filter(function(n){return n&&t[n.fullName]&&!n.builtin&&!e[n.fullName]})}function l(t){var e=[],n={};!function t(r){var i;!function(t){if(e.push(t.fullName),n[t.fullName])throw s(": "+e.join("->"),"",0);n[t.fullName]=!0}(r),f(r).forEach(t),i=e.pop(),delete n[i]}(t)}return n}e.exports=class{constructor(t){this.prj=t}getOptions(){return this.prj.getOptions()}getOutputFile(...t){return this.prj.getOutputFile(...t)}getNamespace(){return this.prj.getNamespace()}getDir(){return this.prj.getDir()}getEXT(){return this.prj.getEXT()}sourceFiles(){return this.prj.sourceFiles()}loadDependingClasses(){return this.prj.loadDependingClasses()}getEnv(){return this.env=this.env||{},this.env.options=this.env.options||this.getOptions(),this.env}requestRebuild(){var t=this.getEnv();t.options=this.getOptions();for(let e of this.getMyClasses())delete t.classes[e]}getMyClasses(){var t=this.getEnv(),e=this.getNamespace();const n=[];for(var r in t.classes){var i=t.classes[r];i.namespace==e&&n.push(i)}return n}initCtx(t){var e=this.getEnv();return t||(t={}),t.visited||(t={visited:{},classes:e.classes=e.classes||r.classMetas,options:t}),t}fileToClass(t){const e=t.truncExt(this.getEXT()),n=this.getEnv(),r=n.aliases[e];if(!r)return null;return n.classes[r]}postChange(t){const e=this.fileToClass(t);if(e)return console.log("Ex",e),this.partialCompile(this.reverseDependingClasses(e));{const e=this.addMetaFromFile(t),n={};return n[e.fullName]=e,this.partialCompile(n)}}reverseDependingClasses(t){const e={};let n;e[t.fullName]=t;do{n=!1;for(let t of this.getMyClasses()){if(e[t.fullName])break;for(let i of r.klass.getDependingClasses(t))if(e[i.fullName]){e[t.fullName]=t,n=!0;break}}}while(n);return console.log("revdep",e),e}addMetaFromFile(t){const e=this.getEnv(),n=t.truncExt(this.getEXT()),i=this.getNamespace(),o=i+"."+n;var s=r.klass.getMeta(o);return r.extend(s,{fullName:o,shortName:n,namespace:i}),s.src=s.src||{},s.src.tonyu=t,e.aliases[n]=o,s}fullCompile(t){const e=this.getDir(),n=(t=this.initCtx(t)).options||{};this.showProgress("Compile: "+e.name()),console.log("Compile: "+e.path());var i=this.getNamespace();let o,s,a,u,c;return n.destinations=n.destinations||{memory:!0,file:!0},this.loadDependingClasses(t).then(()=>{for(var e in o=t.classes,(s=this.getEnv()).aliases={},r.klass.removeMetaAll(i),s.classes=o,o){var n=o[e];s.aliases[n.shortName]=n.fullName}return this.showProgress("scan sources")}).then(()=>{for(var t in a={},u=this.sourceFiles(i),console.log("Sourcefiles",u),u){var e=u[t];const n=this.addMetaFromFile(e);a[n.fullName]=o[n.fullName]=n}return this.showProgress("update check")}).then(()=>(c=a,console.log("compilingClasses",c),this.partialCompile(c,n)))}partialCompile(t,e){let n,r,i=this.getEnv();const s=(e=e||{}).destinations||{memory:!0};return Promise.resolve().then(()=>{for(var e in t)console.log("initClassDecl: "+e),o.initClassDecls(t[e],i);return this.showProgress("order")}).then(()=>(n=c(t),console.log("ORD",n.map(t=>t.fullName)),n.forEach(e=>{t[e.fullName]&&(console.log("annotate :"+e.fullName),o.annotate(e,i))}),this.showProgress("genJS"))).then(()=>((r=a({fixLazyLength:6})).traceIndex={},this.genJS(n,{codeBuffer:r,traceIndex:r.traceIndex}))).then(()=>{const t=u.add(r.close(),r.srcmap,r.traceIndex);let e=Promise.resolve();if(s.file){const n=this.getOutputFile();e=t.saveAs(n)}return s.memory&&(e=e.then(e=>t)),e})}genJS(t,e){var n=this.getEnv();for(let r of t)console.log("genJS",r.fullName),i.genJS(r,n,e);return Promise.resolve()}showProgress(t){console.log("Progress:",t)}setAMDPaths(t){this.getEnv().amdPaths=t}renameClassName(t,e){return this.fullCompile().then(()=>{const n=[];let r;var i=this.getEnv().classes;for(var o in i){var s=i[o],a=s.src?s.src.tonyu:null,u=s.annotation,c=[];if(u&&a&&a.exists()){if(s.node){if(s.node.ext){const e=s.node.ext.superclassName;console.log("SPCl",e),e.text===t&&c.push({pos:e.pos,len:e.len})}if(s.node.incl){const e=s.node.incl.includeClassNames;console.log("incl",e);for(let n of e)n.text===t&&c.push({pos:n.pos,len:n.len})}}for(var f in a.truncExt(".tonyu")===t&&(r=a),console.log("Check",o),u)try{var l=u[f],p=l.scopeInfo;if(p&&"class"==p.type&&p.name==t){var h=l.node.pos,d=l.node.len;a.text().substring(h,h+d)==t&&(c.push({pos:h,len:d}),console.log(a.path(),h,d,a.text().substring(h-5,h+d+5),"->",e))}}catch(t){console.log(t)}c=c.sort(function(t,e){return e.pos-t.pos}),console.log(a.path(),c);var m=a.text(),g=m;for(let t of c)m=m.substring(0,t.pos)+e+m.substring(t.pos+t.len);g==m||a.isReadOnly()||(console.log("Refact:",a.path(),m),a.text(m),n.push(a))}else console.log("No Check",o)}if(r){const t=r.sibling(e+".tonyu");r.moveTo(t),n.push(r),n.push(t)}return n})}}},{"../lib/FS":20,"../lib/assert":22,"../runtime/TError":26,"../runtime/TonyuRuntime":27,"./IndentBuffer":6,"./JSGenerator":7,"./Semantics":9,"./SourceFiles":10,"./TypeChecker":11,"./source-map":18}],4:[function(t,e,n){e.exports=function(){const e=t("./parser");var n={};function r(t){var e={},n=t;return e.add=function(t){n=n?n.or(t):t},e.get=function(){return n},e}function i(){var t=r(),n={reg:function(n,r,i){var o=function(t,e){var n={eq:function(n){return t==n.type()&&e==n.prio()},type:function(e){return e?e==t:t},prio:function(){return e},toString:function(){return"["+t+":"+e+"]"}};return n}(n,r);t.add(i.ret(e.create(function(t){return t.opType=o,t})).setName("(opType "+o+" "+i.name+")"))},get:function(){return t.get()},parse:function(t){return n.get().parse(t)}};return n}var o=i(),s=i(),a=r(),u=[];return n.element=function(t){o.reg("element",-1,t),a.add(t)},n.getElement=function(){return a.get()},n.prefix=function(t,e){o.reg("prefix",t,e)},n.postfix=function(t,e){s.reg("postfix",t,e)},n.infixl=function(t,e){s.reg("infixl",t,e)},n.infixr=function(t,e){s.reg("infixr",t,e)},n.infix=function(t,e){s.reg("infix",t,e)},n.trifixr=function(t,e,n){s.reg("trifixr",t,e),u[t]=n},n.custom=function(t,e){},n.mkInfix=function(t){n.mkInfix.def=t},n.mkInfix.def=function(t,n,r){return e.setRange({type:"infix",op:n,left:t,right:r})},n.mkInfixl=function(t){n.mkInfixl.def=t},n.mkInfixl.def=function(t,n,r){return e.setRange({type:"infixl",op:n,left:t,right:r})},n.mkInfixr=function(t){n.mkInfixr.def=t},n.mkInfixr.def=function(t,n,r){return e.setRange({type:"infixr",op:n,left:t,right:r})},n.mkPrefix=function(t){n.mkPrefix.def=t},n.mkPrefix.def=function(t,n){return e.setRange({type:"prefix",op:t,right:n})},n.mkPostfix=function(t){n.mkPostfix.def=t},n.mkPostfix.def=function(t,n){return e.setRange({type:"postfix",left:t,op:n})},n.mkTrifixr=function(t){n.mkTrifixr.def=t},n.mkTrifixr.def=function(t,n,r,i,o){return e.setRange({type:"trifixr",left:t,op1:n,mid:r,op2:i,right:o})},n.build=function(){return n.built=e.create(function(t){return function t(e,r){var i,a=r;r=o.parse(r);if(!r.isSuccess())return r;i=r.opType;if(i.type("prefix")){var c=r.result[0];if(!(r=t(i.prio(),r)).isSuccess())return r;var f=n.mkPrefix.def(c,r.result[0]);if((a=r.clone()).result=[f],!r.nextPostfixOrInfix)return a;r=r.nextPostfixOrInfix}else if(a=r.clone(),!(r=s.parse(r)).isSuccess())return a;for(;;){if((i=r.opType).prio()<e)return a.nextPostfixOrInfix=r,a;if(i.type("postfix")){const t=n.mkPostfix.def(a.result[0],r.result[0]);if((a=r.clone()).result=[t],!(r=s.parse(r)).isSuccess())return a}else if(i.type("infixl")){var l=r.result[0];if(!(r=t(i.prio()+1,r)).isSuccess())return a;const e=n.mkInfixl.def(a.result[0],l,r.result[0]);if((a=r.clone()).result=[e],!r.nextPostfixOrInfix)return a;r=r.nextPostfixOrInfix}else if(i.type("infixr")){const e=r.result[0];if(!(r=t(i.prio(),r)).isSuccess())return a;const o=n.mkInfixr.def(a.result[0],e,r.result[0]);if((a=r.clone()).result=[o],!r.nextPostfixOrInfix)return a;r=r.nextPostfixOrInfix}else if(i.type("trifixr")){var p=a.result[0],h=r.result[0];if(!(r=t(i.prio()+1,r)).isSuccess())return a;var d=r.result[0];if(!(r=u[i.prio()].parse(r)).isSuccess())return a;var m=r.result[0];if(!(r=t(i.prio(),r)).isSuccess())return a;var g=r.result[0];const e=n.mkTrifixr.def(p,h,d,m,g);if((a=r.clone()).result=[e],!r.nextPostfixOrInfix)return a;r=r.nextPostfixOrInfix}else{const e=r.result[0];if(!(r=t(i.prio()+1,r)).isSuccess())return a;const o=n.mkInfix.def(a.result[0],e,r.result[0]);if((a=r.clone()).result=[o],!r.nextPostfixOrInfix)return a;if(r=r.nextPostfixOrInfix,i.prio()==r.opType.prio())return a.success=!1,a}}}(0,t)}).setName("ExpBuilt"),n.built},n.lazy=function(){return e.create(function(t){return n.built.parse(t)})},n}},{"./parser":17}],5:[function(t,e,n){const r=function(){const e=t("./parser");var n=e,i=null;function o(t){return"string"==typeof t?i.get(t):t}return(i=function(t){var n={ands:function(){for(var n=o(arguments[0]),s=1;s<arguments.length;s++)n=n.and(o(arguments[s]));n=n.tap(t),i.defs[t]=n;var a={autoNode:function(){var r=n.ret(function(){for(var n={type:t},r=0;r<arguments.length;r++){var i=arguments[r],o=e.setRange(i);e.addRange(n,o),n["-element"+r]=i}n.toString=function(){return"("+this.type+")"}}).setName(t);return i.defs[t]=r,r},ret:function(o){if(0==arguments.length)return n;if("function"==typeof o)return i.defs[t]=n.ret(o),i.defs[t];for(var s=[],a=function(t){return t},u=0;u<arguments.length;u++){if("function"==typeof arguments[u]){a=arguments[u];break}s[u]=arguments[u]}var c=n.ret(function(){var n={type:t};n[r.SUBELEMENTS]=[];for(var i=0;i<arguments.length;i++){var o=arguments[i],u=e.setRange(o);e.addRange(n,u),s[i]&&(n[s[i]]=o),n[r.SUBELEMENTS].push(o)}return n.toString=function(){return"("+this.type+")"},a(n)}).setName(t);return i.defs[t]=c,c}};return a},ors:function(){for(var e=o(arguments[0]),n=1;n<arguments.length;n++)e=e.or(o(arguments[n]));return i.defs[t]=e.setName(t),i.defs[t]}};return n}).defs={},i.get=function(t){return i.defs[t]?i.defs[t]:n.lazy(function(){var e=i.defs[t];if(!e)throw"grammar named \'"+t+"\' is undefined";return e}).setName("(Lazy of "+t+")")},i};r.SUBELEMENTS=Symbol("[SUBELEMENTS]"),e.exports=r},{"./parser":17}],6:[function(t,e,n){const r=t("../lib/assert"),i=t("./source-map");e.exports=function(t){t=t||{};var e=function(){var t=arguments,n=t[0],r=0;function i(e){var i=t[++r];if(null==i&&!e)throw console.log(t),new Error(r+"th null param: fmt="+n);return i}for(;;){var o=n.indexOf("%");if(o<0){e.print(n);break}e.print(n.substring(0,o)),o++;var s=n.charAt(o);if("s"==s){var a=i();"string"==typeof a||"number"==typeof a||(null==a?a="null":a.text&&(e.addMapping(a),a=a.text)),e.print(a),o++}else if("d"==s){var u=i();if("number"!=typeof u)throw new Error(u+" is not a number: fmt="+n);e.print(u),o++}else if("n"==s)e.ln(),o++;else if("{"==s)e.indent(),o++;else if("}"==s)e.dedent(),o++;else if("%"==s)e.print("%"),o++;else if("f"==s)i()(e),o++;else if("l"==s){var c=i();e.print(e.toLiteral(c)),o++}else if("v"==s){var f=i();if(!f)throw new Error("Null %v");if("object"!=typeof f)throw new Error("nonobject %v:"+f);e.addMapping(f),e.visitor.visit(f),o++}else if("z"==s){var l=i();if("val"in l)return void e.print(l.val);l.inited||e.lazy(l),l.print(),o++}else if("j"==s){var p=i(),h=p[0],d=p[1],m=!1;if(!d||!d.forEach)throw console.log(d),new Error(d+" is not array. cannot join fmt:"+n);for(let t of d)m&&e.printf(h),m=!0,e.visitor.visit(t);o++}else"D"==s?(i(!0),o++):o+=2;n=n.substring(o)}};return e.addTraceIndex=function(t){this.traceIndex||(this.traceIndex={}),this.traceIndex[t]=1},e.addMapping=function(t){var n;e.srcFile&&("number"==typeof t.row&&"number"==typeof t.col?n={row:t.row,col:t.col}:"number"==typeof t.pos&&(n=e.srcRCM.getRC(t.pos)),n&&e.srcmap.addMapping({generated:{line:e.bufRow,column:e.bufCol},source:e.srcFile+"",original:{line:n.row,column:n.col}}))},e.setSrcFile=function(t){e.srcFile=t,e.srcRCM=function(t){var e={},n=[],r=0,i=0;return t.split("\\n").forEach(function(t){n.push(r),r+=t.length+1}),n.push(r),e.getRC=function(t){for(;;){if(i<0)return{row:1,col:1};if(i+1>=n.length)return{row:n.length,col:1};if(t<n[i])i--;else{if(!(n[i+1]<=t))return{row:i+1,col:t-n[i]+1};i++}}},e}(t.text()),e.srcmap.setSourceContent(t.path(),t.text())},e.print=function(t){e.buf+=t;var n=(t+"").split("\\n");n.forEach(function(t,r){r<n.length-1?(e.bufCol+=t.length+1,e.bufRow++,e.bufCol=1):e.bufCol+=t.length})},e.dstFile=t.dstFile,e.mapFile=t.mapFile,e.printf=e,e.buf="",e.bufRow=1,e.bufCol=1,e.srcmap=new i.SourceMapGenerator,e.lazy=function(n){return n||(n={}),t.fixLazyLength?(n.length=n.length||t.fixLazyLength,n.pad=n.pad||" ",n.gen=function(){for(var t="",e=0;e<n.length;e++)t+=n.pad;return t}(),n.puts=[],e.useLengthPlace=!0):(n.gen=("GENERETID"+Math.random()+"DITERENEG").replace(/\\W/g,""),n.reg=new RegExp(n.gen,"g"),r(!e.useLengthPlace,"GENERETID cannot be used")),n.inited=!0,n.put=function(t){if(this.val=t+"",this.puts){for(this.val.length>this.length&&(e.lazyOverflow=!0);this.val.length<this.length;)this.val+=this.pad;var n=this;this.puts.forEach(function(t){var i=e.buf.length;e.buf=e.buf.substring(0,t)+n.val+e.buf.substring(t+n.length),r.eq(i,e.buf.length)})}return this.reg&&(e.buf=e.buf.replace(this.reg,t)),this.val},n.print=function(){this.puts&&this.puts.push(e.buf.length),e.print(this.gen)},n},e.ln=function(){e.print("\\n"+e.indentBuf)},e.indent=function(){e.indentBuf+=e.indentStr,e.print("\\n"+e.indentBuf)},e.dedent=function(){var t=e.indentStr.length;if(!e.buf.substring(e.buf.length-t).match(/^\\s*$/))throw console.log(e.buf),new Error("Non-space truncated ");e.buf=e.buf.substring(0,e.buf.length-t),e.indentBuf=e.indentBuf.substring(0,e.indentBuf.length-t)},e.toLiteral=function(t,e){if(e||(e="\'"),"string"!=typeof t)throw console.log("no literal ",t),new Error("toLiteral:"+t+" is not a literal");return t=(t=(t=t.replace(/\\\\/g,"\\\\\\\\")).replace(/\\r/g,"\\\\r")).replace(/\\n/g,"\\\\n"),e+(t="\'"==e?t.replace(/\'/g,"\\\\\'"):t.replace(/"/g,\'\\\\"\'))+e},e.indentBuf="",e.indentStr="  ",e.close=function(){return e.mapStr=e.srcmap.toString(),e.mapFile&&e.dstFile&&(e.mapFile.text(e.mapStr),e.printf("%n//# sourceMappingURL=%s%n",e.mapFile.relPath(e.dstFile.up()))),e.dstFile&&e.dstFile.text(e.buf),e.buf},e}},{"../lib/assert":22,"./source-map":18}],7:[function(t,e,n){t("../runtime/TonyuRuntime");const r=t("./IndentBuffer"),i=t("./ObjectMatcher"),o=t("../runtime/TError"),s=t("./context"),a=t("./Visitor"),u=t("./compiler"),c=t("../lib/assert");e.exports=u.JSGenerator=function(){var t="_thread",e="_this",n="_arguments",f="fiber$",l="__pc",p="__cnt",h=100,d="Tonyu.bindFunc",m="Tonyu.invokeMethod",g="Tonyu.callFunc",v="Tonyu.checkNonNull",y="Tonyu.classes.",b="Tonyu.globals.",x="this",w=\'"use strict";%n\',S="Tonyu.iterator",E="__superClass",_=u.ScopeTypes,C=u.getScopeType,A=u.annotation;u.getMethod,u.getDependingClasses,u.getParams;return{genJS:function(T,F,D){var R=T.src.tonyu,L=R.text();function k(t){return u.getSource(L,t)}var P=(D=D||{}).codeBuffer||F.codeBuffer||r({fixLazyLength:6}),O=D.traceIndex||{};P.setSrcFile(R);var M=P.printf,N=s(),B=!1,j=i,I=T.decls,U=(I.fields,I.methods),W=(I.natives,_),z=0,G=F.options.compiler.diagnose,q=F.options.compiler.genAMD,J=!F.options.compiler.noLoopCheck;function V(t,e){return A(T.annotation,t,e)}function $(t){return"string"==typeof t?y+(F.aliases[t]||t):t.builtin?t.fullName:y+t.fullName}function H(t,e){return function(n){N.enter(t,function(){K.visit(e)})}}function Q(n,r,i){var o=C(r);if(o==W.THVAR)P.printf("%s",t);else if(o==W.FIELD||o==W.PROP)P.printf("%s.%s",e,n);else if(o==W.METHOD)i&&i.noBind?P.printf("%s.%s",e,n):P.printf("%s(%s,%s.%s)",d,e,e,n);else if(o==W.CLASS)P.printf("%s",$(n));else if(o==W.GLOBAL)P.printf("%s%s",b,n);else{if(o!=W.PARAM&&o!=W.LOCAL&&o!=W.NATIVE&&o!=W.MODULE)throw console.log("Unknown scope type: ",o),new Error("Unknown scope type: "+o);P.printf("%s",n)}return r}function Z(t){return function(){(function(t){"compound"==t.type?N.enter({noWait:!0},function(){P.printf("%j%n",["%n",t.stmts])}):K.visit(t)}).apply(this,[t])}}var X={type:"THNode"};const K=P.visitor=a({THNode:function(e){P.printf(t)},dummy:function(t){P.printf("",t)},literal:function(t){P.printf("%s",t.text)},paramDecl:function(t){P.printf("%v",t.name)},paramDecls:function(t){P.printf("(%j)",[", ",t.params])},funcDeclHead:function(t){P.printf("function %v %v",t.name,t.params)},funcDecl:function(t){},return:function(n){if(N.inTry)throw o("tryreturn",R,n.pos);if(N.noWait)N.threadAvail?n.value?P.printf("%s.retVal=%v;return;%n",t,n.value):P.printf("%s.retVal=%s;return;%n",t,e):n.value?P.printf("return %v;",n.value):P.printf("return %s;",e);else if(n.value){var r=V(n.value).fiberCall;r?P.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{%s.exit(%s.retVal);return;%n",e,f,r.N,[", ",[X].concat(r.A)],l,N.pc,N.pc++,t,t):P.printf("%s.exit(%v);return;",t,n.value)}else P.printf("%s.exit(%s);return;",t,e)},number:function(t){P.printf("%s",t.value)},reservedConst:function(r){"this"==r.text?P.printf("%s",e):"arguments"==r.text&&N.threadAvail?P.printf("%s",n):r.text==t?P.printf("%s",N.threadAvail?t:"null"):P.printf("%s",r.text)},varDecl:function(n){var r=V(n).varInMain?e+".":"";if(n.value){var i=!N.noWait&&V(n).fiberCall;i?(c.is(N.pc,Number),P.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{%s%v=%s.retVal;%n",e,f,i.N,[", ",[X].concat(i.A)],l,N.pc,N.pc++,r,n.name,t)):P.printf("%s%v = %v;%n",r,n.name,n.value)}},varsDecl:function(t){var e=t.decls.filter(function(t){return t.value});e.length>0&&e.forEach(function(t){P.printf("%v",t)})},jsonElem:function(t){t.value?P.printf("%v: %v",t.key,t.value):P.printf("%v: %f",t.key,function(){Q(t.key.text,V(t).scopeInfo,V(t))})},objlit:function(t){P.printf("{%j}",[",",t.elems])},arylit:function(t){P.printf("[%j]",[",",t.elems])},funcExpr:function(t){!function(t){var e=V(t).info;P.printf("(function %s(%j) {%{%f%n%f%}})",e.name,[",",e.params],et(e),function(){N.enter({noWait:!0,threadAvail:!1,finfo:e},function(){t.body.stmts.forEach(function(t){M("%v%n",t)})})})}(t)},parenExpr:function(t){P.printf("(%v)",t.expr)},varAccess:function(t){Q(t.name.text,V(t).scopeInfo,V(t))},exprstmt:function(n){var r={};if(N.noWait||(r=V(n).fiberCall||{}),"noRet"==r.type)P.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{",e,f,r.N,[", ",[X].concat(r.A)],l,N.pc,N.pc++);else if("ret"==r.type)P.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{%v%v%s.retVal;%n",e,f,r.N,[", ",[X].concat(r.A)],l,N.pc,N.pc++,r.L,r.O,t);else if("noRetSuper"==r.type){const t=E;P.printf("%s.prototype.%s%s.apply( %s, [%j]);%n%s=%s;return;%n%}case %d:%{",t,f,r.S.name.text,e,[", ",[X].concat(r.A)],l,N.pc,N.pc++)}else if("retSuper"==r.type){const n=E;P.printf("%s.prototype.%s%s.apply( %s, [%j]);%n%s=%s;return;%n%}case %d:%{%v%v%s.retVal;%n",n,f,r.S.name.text,e,[", ",[X].concat(r.A)],l,N.pc,N.pc++,r.L,r.O,t)}else P.printf("%v;",n.expr)},infix:function(t){var e=t.op.text;if(G){if("+"==e||"-"==e||"*"==e||"/"==e||"%"==e)return void P.printf("%s(%v,%l)%v%s(%v,%l)",v,t.left,k(t.left),t.op,v,t.right,k(t.right));if("+="==e||"-="==e||"*="==e||"/="==e||"%="==e)return void P.printf("%v%v%s(%v,%l)",t.left,t.op,v,t.right,k(t.right))}"is"===t.op.type?P.printf("Tonyu.is(%v,%v)",t.left,t.right):P.printf("%v%v%v",t.left,t.op,t.right)},trifixr:function(t){P.printf("%v%v%v%v%v",t.left,t.op1,t.mid,t.op2,t.right)},prefix:function(t){if("__typeof"!==t.op.text)P.printf("%v %v",t.op,t.right);else{var e=V(t.right);e.vtype?P.printf("%l",e.vtype.name||e.vtype.fullName||"No type name?"):P.printf("%l","Any")}},postfix:function(t){var n=V(t);if(G){if(n.myMethodCall){const o=n.myMethodCall;var r=o.scopeInfo,i=C(r);return void(i==W.FIELD||i==W.PROP||i==W.METHOD?P.printf("%s(%s, %l, [%j], %l )",m,e,o.name,[",",o.args],"this"):P.printf("%s(%v, [%j], %l)",g,t.left,[",",o.args],k(t.left)))}if(n.othersMethodCall){var o=n.othersMethodCall;return void P.printf("%s(%v, %l, [%j], %l )",m,o.target,o.name,[",",o.args],k(o.target))}if(n.memberAccess){var s=n.memberAccess;return void P.printf("%s(%v,%l).%s",v,s.target,k(s.target),s.name)}}else if(n.myMethodCall){const t=n.myMethodCall,r=t.scopeInfo;if(C(r)==W.METHOD)return void P.printf("%s.%s(%j)",e,t.name,[",",t.args])}P.printf("%v%v",t.left,t.op)},break:function(t){if(N.noWait)P.printf("break;%n");else{if(N.inTry&&N.exitTryOnJump)throw o("trybreak;",R,t.pos);if(!N.closestBrk)throw o("break ",R,t.pos);P.printf("%s=%z; break;%n",l,N.closestBrk)}},continue:function(t){if(N.noWait)P.printf("continue;%n");else{if(N.inTry&&N.exitTryOnJump)throw o("trycontinue;",R,t.pos);if("number"==typeof N.closestCnt)P.printf("%s=%s; break;%n",l,N.closestCnt);else{if(!N.closestCnt)throw o("continue ",R,t.pos);P.printf("%s=%z; break;%n",l,N.closestCnt)}}},try:function(e){var n=V(e);if(!N.noWait&&(n.fiberCallRequired||n.hasJump||n.hasReturn)){if(1!=e.catches.length||"catch"!=e.catches[0].type)throw o("catch1",R,e.pos);var r=e.catches[0],i={},s={};P.printf("%s.enterTry(%z);%n",t,i),P.printf("%f",H({inTry:!0,exitTryOnJump:!0},e.stmt)),P.printf("%s.exitTry();%n",t),P.printf("%s=%z;break;%n",l,s),P.printf("%}case %f:%{",function(){P.print(i.put(N.pc++))}),P.printf("%s=%s.startCatch();%n",r.name.text,t),P.printf("%v%n",r.stmt),P.printf("%}case %f:%{",function(){P.print(s.put(N.pc++))})}else N.enter({noWait:!0},function(){P.printf("try {%{%f%n%}} ",Z(e.stmt)),e.catches.forEach(K.visit)})},catch:function(t){P.printf("catch (%s) {%{%f%n%}}",t.name.text,Z(t.stmt))},throw:function(t){P.printf("throw %v;%n",t.ex)},switch:function(t){if(N.noWait)P.printf("switch (%v) {%{%j"+(t.defs?"%n%v":"%D")+"%n%}}",t.value,["%n",t.cases],t.defs);else{var e=t.cases.map(function(t){return P.lazy()});t.defs&&e.push(P.lazy());var n=P.lazy();P.printf("switch (%v) {%{%f%n%}}%nbreak;%n",t.value,function(){var r=0;t.cases.forEach(function(t){P.printf("%}case %v:%{%s=%z;break;%n",t.value,l,e[r]),r++}),t.defs?P.printf("%}default:%{%s=%z;break;%n",l,e[r]):P.printf("%}default:%{%s=%z;break;%n",l,n)}),N.enter({closestBrk:n},function(){var r=0;t.cases.forEach(function(t){P.printf("%}case %f:%{%j%n",function(){P.print(e[r].put(N.pc++))},["%n",t.stmts]),r++}),t.defs&&P.printf("%}case %f:%{%j%n",function(){P.print(e[r].put(N.pc++))},["%n",t.defs.stmts]),P.printf("case %f:%n",function(){P.print(n.put(N.pc++))})})}},case:function(t){P.printf("%}case %v:%{%j",t.value,["%n",t.stmts])},default:function(t){P.printf("%}default:%{%j",["%n",t.stmts])},while:function(t){var e=V(t);if(N.noWait||!e.fiberCallRequired&&!e.hasReturn)N.enter({noWait:!0},function(){P.printf("while (%v) {%{"+(J?"Tonyu.checkLoop();%n":"")+"%f%n%}}",t.cond,Z(t.loop))});else{var n=P.lazy(),r=N.pc++,i="reservedConst"==t.cond.type&&"true"==t.cond.text;P.printf("%}case %d:%{"+(i?"%D%D%D":"if (!(%v)) { %s=%z; break; }%n")+"%f%n%s=%s;break;%n%}case %f:%{",r,t.cond,l,n,H({closestBrk:n,closestCnt:r,exitTryOnJump:!1},t.loop),l,r,function(){P.print(n.put(N.pc++))})}},do:function(t){var e=V(t);if(N.noWait||!e.fiberCallRequired&&!e.hasReturn)N.enter({noWait:!0},function(){P.printf("do {%{"+(J?"Tonyu.checkLoop();%n":"")+"%f%n%}} while (%v);%n",Z(t.loop),t.cond)});else{var n=P.lazy(),r=P.lazy(),i=N.pc++;P.printf("%}case %d:%{%f%n%}case %f:%{if (%v) { %s=%s; break; }%n%}case %f:%{",i,H({closestBrk:n,closestCnt:r,exitTryOnJump:!1},t.loop),function(){P.print(r.put(N.pc++))},t.cond,l,i,function(){P.print(n.put(N.pc++))})}},for:function(t){var e=V(t);if("forin"==t.inFor.type){var n=V(t.inFor).iterName;if(N.noWait||!e.fiberCallRequired&&!e.hasReturn)N.enter({noWait:!0},function(){P.printf("%s=%s(%v,%s);%nwhile(%s.next()) {%{%f%n%f%n%}}",n,S,t.inFor.set,t.inFor.vars.length,n,s(n,t.inFor.isVar,t.inFor.vars),Z(t.loop))});else{var r=P.lazy(),i=N.pc++;P.printf("%s=%s(%v,%s);%n%}case %d:%{if (!(%s.next())) { %s=%z; break; }%n%f%n%f%n%s=%s;break;%n%}case %f:%{",n,S,t.inFor.set,t.inFor.vars.length,i,n,l,r,s(n,t.inFor.isVar,t.inFor.vars),H({closestBrk:r,closestCnt:i,exitTryOnJump:!1},t.loop),l,i,function(t){t.print(r.put(N.pc++))})}}else if(N.noWait||!e.fiberCallRequired&&!e.hasReturn)N.enter({noWait:!0},function(){"varsDecl"==t.inFor.init.type||"exprstmt"==t.inFor.init.type?P.printf("%vfor (; %v ; %v) {%{"+(J?"Tonyu.checkLoop();%n":"")+"%v%n%}}",t.inFor.init,t.inFor.cond,t.inFor.next,t.loop):P.printf("%v%nwhile(%v) {%{"+(J?"Tonyu.checkLoop();%n":"")+"%v%n%v;%n%}}",t.inFor.init,t.inFor.cond,t.loop,t.inFor.next)});else{const e=P.lazy();var o=P.lazy();const n=N.pc++;P.printf("%v%n%}case %d:%{if (!(%v)) { %s=%z; break; }%n%f%n%}case %f:%{%v;%n%s=%s;break;%n%}case %f:%{",t.inFor.init,n,t.inFor.cond,l,e,H({closestBrk:e,closestCnt:o,exitTryOnJump:!1},t.loop),function(t){t.print(o.put(N.pc++))},t.inFor.next,l,n,function(t){t.print(e.put(N.pc++))})}function s(t,e,n){return function(){n.forEach(function(e,n){var r=V(e);Q(e.text,r.scopeInfo,r),P.printf("=%s[%s];%n",t,n)})}}},if:function(t){var e=V(t);if(!N.noWait&&(e.fiberCallRequired||e.hasJump||e.hasReturn)){var n=P.lazy(),r=P.lazy();t._else?P.printf("if (!(%v)) { %s=%z; break; }%n%v%n%s=%z;break;%n%}case %f:%{%v%n%}case %f:%{",t.cond,l,r,t.then,l,n,function(){P.print(r.put(N.pc++))},t._else,function(){P.print(n.put(N.pc++))}):P.printf("if (!(%v)) { %s=%z; break; }%n%v%n%}case %f:%{",t.cond,l,n,t.then,function(){P.print(n.put(N.pc++))})}else N.enter({noWait:!0},function(){t._else?P.printf("if (%v) {%{%f%n%}} else {%{%f%n%}}",t.cond,Z(t.then),Z(t._else)):P.printf("if (%v) {%{%f%n%}}",t.cond,Z(t.then))})},ifWait:function(t){N.noWait?t._else&&P.printf("%v",t._else):P.printf("%v",t.then)},empty:function(t){P.printf(";%n")},call:function(t){P.printf("(%j)",[",",t.args])},objlitArg:function(t){P.printf("%v",t.obj)},argList:function(t){P.printf("%j",[",",t.args])},newExpr:function(t){var e=t.params;e?P.printf("new %v%v",t.klass,e):P.printf("new %v",t.klass)},scall:function(t){P.printf("[%j]",[",",t.args])},superExpr:function(t){var n;t.name?(n=t.name.text,P.printf("%s.prototype.%s.apply( %s, %v)",E,n,e,t.params)):P.printf("%s.apply( %s, %v)",E,e,t.params)},arrayElem:function(t){P.printf("[%v]",t.subscript)},member:function(t){P.printf(".%s",t.name)},symbol:function(t){P.print(t.text)},normalFor:function(t){P.printf("%v; %v; %v",t.init,t.cond,t.next)},compound:function(t){var e=V(t);!N.noWait&&(e.fiberCallRequired||e.hasJump||e.hasReturn)?P.printf("%j",["%n",t.stmts]):N.enter({noWait:!0},function(){P.printf("{%{%j%n%}}",["%n",t.stmts])})},typeof:function(t){P.printf("typeof ")},instanceof:function(t){P.printf(" instanceof ")},is:function(t){P.printf(" instanceof ")},regex:function(t){P.printf("%s",t.text)}});function Y(t,e){e||(e=z+++"");let n="_trc_"+T.shortName+"_"+e;return O[n]=1,n}function tt(t){var e=V(t).info;P.printf("function %s(%j) {%{%f%n%f%}}",e.name,[",",e.params],et(e),function(){N.enter({noWait:!0,threadAvail:!1,finfo:e},function(){t.body.stmts.forEach(function(t){M("%v%n",t)})})})}function et(t){return function(){N.enter({},function(){for(let e in t.locals.varDecls)P.printf("var %s;%n",e);for(let e in t.locals.subFuncDecls)tt(t.locals.subFuncDecls[e])})}}function nt(t){return j.match(t,{ftype:"constructor"})||j.match(t,{name:"new"})}return["++","--","!==","===","+=","-=","*=","/=","%=",">=","<=","!=","==",">>>",">>","<<","&&","||",">","<","+","?","=","*","%","/","^","~","\\\\",":",";",",","!","&","|","-","delete"].forEach(function(t){K.funcs[t]=function(e){P.printf("%s",t)}}),K.def=function(t){throw console.log("Err node="),console.log(t),new Error(t.type+" is not defined in visitor:compiler2")},K.cnt=0,N.enter({},function(){if(q){M("define(function (require) {%{");var r={Tonyu:1};for(var i in T.decls.amds)r[i]=1;if(T.superclass){const t=T.superclass.shortName;r[t]=1}(T.includes||[]).forEach(function(t){var e=t.shortName;r[e]=1});for(let t in T.decls.softRefClasses)r[t]=1;for(let t in r)M("var %s=require(\'%s\');%n",t,t)}var o,s;M((q?"return ":"")+"Tonyu.klass.define({%{"),M("fullName: %l,%n",T.fullName),M("shortName: %l,%n",T.shortName),M("namespace: %l,%n",T.namespace),T.superclass&&M("superclass: %s,%n",$(T.superclass)),M("includes: [%s],%n",(o=T.includes,s=[],o.forEach(function(t){s.push($(t))}),s).join(",")),M("methods: function (%s) {%{",E),M("return {%{");const a=r=>{B&&console.log("method1",r);var i=U[r];i.params||console.log("MYSTERY2",i.params,U,T,F),N.enter({noWait:!0,threadAvail:!1},function(){var t,n;n=nt(t=i)?"initialize":t.name,t.params||console.log("MYSTERY",t.params),M("%s :function %s(%j) {%{"+w+"var %s=%s;%n%f%n%f%}},%n",n,Y(t.pos,n),[",",t.params],e,x,et(t),function(){N.enter({method:t,finfo:t},function(){t.stmts.forEach(function(t){M("%v%n",t)})})})}),B&&console.log("method2",r),i.nowait||N.enter({noWait:!1,threadAvail:!0},function(){!function(r){if(!nt(r)){var i=r.stmts,o=[],s=[],a=o;i.forEach(function(t){V(t).fiberCallRequired&&(a=s),a.push(t)}),M("%s%s :function %s(%j) {%{"+w+"var %s=%s;%n%svar %s=%s;%nvar %s=0;%n%f%n%f%n",f,r.name,Y(r.pos,"f_"+r.name),[",",[X].concat(r.params)],e,x,r.useArgs?"":"//",n,"Tonyu.A(arguments)",l,et(r),function(){N.enter({method:r,noWait:!0,threadAvail:!0},function(){o.forEach(function(t){M("%v%n",t)})})}),s.length>0?M("%s.enter(function %s(%s) {%{if (%s.lastEx) %s=%s.catchPC;%nfor(var %s=%d ; %s--;) {%{switch (%s) {%{%}case 0:%{%f%s.exit(%s);return;%n%}}%n%}}%n%}});%n",t,Y(r.pos,"ent_"+r.name),t,t,l,t,p,h,p,l,function(){N.enter({method:r,finfo:r,pc:1},function(){s.forEach(function(t){M("%v%n",t)})})},t,e):M("%s.retVal=%s;return;%n",t,e),M("%}},%n")}}(i)}),B&&console.log("method3",r)};for(var u in U)a(u);M("__dummy: false%n"),M("%}};%n"),M("%}},%n"),M("decls: %s%n",JSON.stringify(function(t){var e={methods:{},fields:{}};for(let n in t.decls.methods)e.methods[n]={nowait:!!t.decls.methods[n].nowait};for(let i in t.decls.fields){var n=t.decls.fields[i],r={};n.vtype&&("string"==typeof n.vtype?r.vtype=n.vtype:r.vtype=n.vtype.fullName||n.vtype.name),e.fields[i]=r}return e}(T))),M("%}});"),q&&M("%n%}});"),M("%n")}),q?(T.src.js=T.src.tonyu.up().rel(T.src.tonyu.truncExt()+".js"),T.src.js.text(P.buf)):T.src.js=P.buf,delete T.jsNotUpToDate,B&&console.log("method4",P.buf),T.src.map=P.mapStr,P}}}()},{"../lib/assert":22,"../runtime/TError":26,"../runtime/TonyuRuntime":27,"./IndentBuffer":6,"./ObjectMatcher":8,"./Visitor":12,"./compiler":13,"./context":14}],8:[function(t,e,n){e.exports=function(){var t={},e="$var",n="$this";function r(t,r){var i={};return i[e]=t,r&&(i[n]=r),i}t.v=r,t.isVar=function(t){return t&&t[e]};for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=0;o<i.length;o++){var s=i.substring(o,o+1);t[s]=r(s)}return t.match=function(t,r){var i={};return function t(r,i,o){if(r===i)return!0;if(null==r)return!1;if("string"==typeof r&&i instanceof RegExp)return r.match(i);if("function"==typeof i)return i(r,o);if("object"==typeof i){for(var s in i)if(s!=e){var a=s==n?r:r[s],u=i[s];if(!t(a,u,o))return!1}return i[e]&&(o[i[e]]=r),!0}return!1}(t,r,i)?i:null},t}()},{}],9:[function(t,e,n){const r=t("../runtime/TonyuRuntime"),i=t("./parse_tonyu2"),o=(t("./IndentBuffer"),t("./ObjectMatcher")),s=t("../runtime/TError"),a=t("./context"),u=t("./Visitor"),c=t("./compiler"),f=(t("../lib/assert"),t("./Grammar")),l=t("../lib/root");e.exports=c.Semantics=function(){var t=c.ScopeTypes,e=c.newScopeType,n=c.getScopeType,p=c.newScope,h=c.genSym,d=c.annotation,m=c.getMethod,g=c.getDependingClasses,v=c.getParams,y={Array:1,String:1,Boolean:1,Number:1,Void:1,Object:1,RegExp:1,Error:1,Date:1};function b(t){var e=this;if(t&&"object"==typeof t){var n;if(!(n=t instanceof Array?t:t[f.SUBELEMENTS]))for(var r in n=[],t)n.push(t[r]);n.forEach(function(t){e.visit(t)})}}return{initClassDecls:function(t,e){var n,r=t.src.tonyu;t.hasSemanticError=!0,t.src&&t.src.js&&(t.jsNotUpToDate=!0),t.node&&t.nodeTimestamp==r.lastUpdate()&&(n=t.node),n||(console.log("Parse "+r),n=i.parse(r),t.nodeTimestamp=r.lastUpdate());var a={name:"main",stmts:[],pos:0,isMain:!0},c={},f={main:a},l={};t.decls={fields:c,methods:f,natives:l,amds:{},softRefClasses:{}},t.node=n;var p=o;!function(n){var i=e.options.compiler.defaultSuperClass,o=0,h=p.match(n,{ext:{superclassName:{text:p.N,pos:p.P}}});if(h&&(i=h.N,o=h.P,"null"==i&&(i=null)),t.includes=[],(h=p.match(n,{incl:{includeClassNames:p.C}}))&&h.C.forEach(function(n){var i=n.text,o=n.pos,a=e.classes[e.aliases[i]||i];if(!a)throw s(" "+i+"",r,o);t.includes.push(a)}),"Array"==i)t.superclass={name:"Array",fullName:"Array",builtin:!0};else if(i){var d=e.classes[e.aliases[i]||i];if(!d)throw s(" "+i+"",r,o);t.superclass=d}else delete t.superclass;function m(e,n){n=n||e,c[e+""]={node:n,klass:t.fullName,name:e+"",pos:n.pos}}t.directives={};var g=u({varDecl:function(t){m(t.name,t)},nativeDecl:function(t){},funcDecl:function(t){},funcExpr:function(t){},catch:function(t){},exprstmt:function(e){"literal"===e.expr.type&&e.expr.text.match(/^.field strict.$/)&&(t.directives.field_strict=!0)},forin:function(t){t.isVar&&t.vars.forEach(function(t){m(t)})}});g.def=b,g.visit(n.stmts),n.stmts.forEach(function(e){if("funcDecl"==e.type){var n=e.head,r="function";n.ftype&&(r=n.ftype.text);var i=n.name.text,o=n.params?"":n.setter?"__setter__":"__getter__";f[i=o+i]={nowait:!!n.nowait||""!==o,ftype:r,name:i,klass:t.fullName,head:n,pos:n.pos,stmts:e.body.stmts,node:e}}else"nativeDecl"==e.type?l[e.name.text]=e:a.stmts.push(e)})}(n)},annotate:function(i,f){i.hasSemanticError=!0;var x,w,S=i.src.tonyu,E=S.text(),_=o,C=i.decls,A=(C.fields,C.methods),T=(C.natives,C.amds,t),F={},D=a(),R=!1,L={type:"postfix",left:{type:"postfix",left:_.T,op:{type:"member",name:{text:_.N}}},op:{type:"call",args:_.A}},k={type:"postfix",left:_.T,op:{type:"member",name:{text:_.N}}};x=w={type:"postfix",left:{type:"varAccess",name:{text:_.N}},op:{type:"call",args:_.A}};var P={expr:w},O={expr:{type:"infix",op:_.O,left:_.L,right:w}},M={expr:{type:"superExpr",params:{args:_.A},$var:"S"}},N={expr:{type:"infix",op:_.O,left:_.L,right:{type:"superExpr",params:{args:_.A},$var:"S"}}};function B(t,e){return d(i.annotation,t,e)}function j(t){if(!t.builtin){var n,i=F,o=t.decls;for(n in o||console.log("DECLNUL",t),o.fields){const r=o.fields[n];i[n]=e(T.FIELD,{klass:t.fullName,name:n,info:r}),r.node&&B(r.node,{info:r})}for(n in o.methods){const a=o.methods[n];var s=r.klass.propReg.exec(n);s?i[s[2]]=e(T.PROP,{klass:t.fullName,name:s[2],info:a}):i[n]=e(T.METHOD,{klass:t.fullName,name:n,info:a}),a.node&&B(a.node,{info:a})}}}function I(t){return m(i,t)}function U(t){return n(D.scope[t])==T.METHOD&&!I(t).nowait}function W(t){if("varAccess"==t.type||"postfix"==t.type&&("member"==t.op.type||"arrayElem"==t.op.type))return"varAccess"==t.type&&B(t,{noBind:!0}),!0;throw console.log("LVal",t),s("\'"+function(t){return c.getSource(E,t)}(t)+"\'",S,t.pos)}function z(t){var r=t;t+="";var o=D.scope[t],a=n(o);if(!a){if(f.amdPaths&&f.amdPaths[t])a=T.MODULE,i.decls.amds[t]=f.amdPaths[t];else{var u=t.match(/^\\$/);if((f.options.compiler.field_strict||i.directives.field_strict)&&!u)throw new s(t+"",S,r.pos);a=u?T.GLOBAL:T.FIELD}var l={name:t};a==T.FIELD&&(l.klass=i.name,i.decls.fields[t]=i.decls.fields[t]||{},c.extend(i.decls.fields[t],{klass:i.fullName,name:t})),o=F[t]=e(a,l)}return a==T.CLASS&&(i.decls.softRefClasses[t]=o),o}i.annotation={};var G=u({varDecl:function(t){D.isMain?(B(t,{varInMain:!0}),B(t,{declaringClass:i})):(D.locals.varDecls[t.name.text]=t,B(t,{declaringFunc:D.finfo}))},funcDecl:function(t){D.locals.subFuncDecls[t.head.name.text]=t},funcExpr:function(t){},catch:function(t){D.locals.varDecls[t.name.text]=t},exprstmt:function(t){},forin:function(t){var e=t.isVar;t.vars.forEach(function(t){e&&(D.isMain?(B(t,{varInMain:!0}),B(t,{declaringClass:i})):(D.locals.varDecls[t.text]=t,B(t,{declaringFunc:D.finfo})))});var n=h("_it_");B(t,{iterName:n}),D.locals.varDecls[n]=t}});function q(t){var e={varDecls:{},subFuncDecls:{}};return D.enter({locals:e},function(){G.visit(t)}),e}function J(t,e){t.forEach(function(t){B(t,e)})}function V(t){D.method&&(D.method.fiberCallRequired=!0),J(t,{fiberCallRequired:!0})}G.def=b;var $=u({varAccess:function(t){var e=z(t.name);n(e),B(t,{scopeInfo:e})},funcDecl:function(t){},funcExpr:function(t){Y(t)},objlit:function(t){var e=this,n={};t.elems.forEach(function(t){var r;if(r="literal"==t.key.type?t.key.text.substring(1,t.key.text.length-1):t.key.text,n[r])throw s("\'"+r+"\'",S,t.pos);n[r]=1,e.visit(t)})},jsonElem:function(t){if(t.value)this.visit(t.value);else{if("literal"==t.key.type)throw s("",S,t.pos);B(t,{scopeInfo:z(t.key)})}},do:function(t){var e=this;D.enter({brkable:!0,contable:!0},function(){e.def(t)})},switch:function(t){var e=this;D.enter({brkable:!0},function(){e.def(t)})},while:function(t){var e=this;D.enter({brkable:!0,contable:!0},function(){e.def(t)}),V(this.path)},for:function(t){var e=this;D.enter({brkable:!0,contable:!0},function(){e.def(t)})},forin:function(t){t.vars.forEach(function(t){B(t,{scopeInfo:z(t)})}),this.visit(t.set)},ifWait:function(t){var n=this,r=p(D.scope);r._thread=e(T.THVAR),D.enter({scope:r},function(){n.visit(t.then)}),t._else&&n.visit(t._else),V(this.path)},try:function(t){D.finfo.useTry=!0,this.def(t)},return:function(t){var e;D.noWait||((e=_.match(t.value,w))&&U(e.N)&&(B(t.value,{fiberCall:e}),V(this.path)),J(this.path,{hasReturn:!0})),this.visit(t.value)},break:function(t){if(!D.brkable)throw s("break switch.",S,t.pos);D.noWait||J(this.path,{hasJump:!0})},continue:function(t){if(!D.contable)throw s("continue .",S,t.pos);D.noWait||J(this.path,{hasJump:!0})},reservedConst:function(t){"arguments"==t.text&&(D.finfo.useArgs=!0)},postfix:function(t){var e;function n(t,n){return e=_.match(t,n)}if(this.visit(t.left),this.visit(t.op),n(t,x)){var r=B(t.left).scopeInfo;B(t,{myMethodCall:{name:e.N,args:e.A,scopeInfo:r}})}else n(t,L)?B(t,{othersMethodCall:{target:e.T,name:e.N,args:e.A}}):n(t,k)&&B(t,{memberAccess:{target:e.T,name:e.N}})},infix:function(t){var e=t.op.text;"="!=e&&"+="!=e&&"-="!=e&&"*="!=e&&"/="!=e&&"%="!=e||W(t.left),this.def(t)},exprstmt:function(t){var e,n;if("objlit"===t.expr.type)throw s("",S,t.pos);if(!D.noWait&&(e=_.match(t,P))&&U(e.N))e.type="noRet",B(t,{fiberCall:e}),V(this.path);else if(!D.noWait&&(e=_.match(t,O))&&U(e.N))e.type="ret",B(t,{fiberCall:e}),V(this.path);else if(!D.noWait&&(e=_.match(t,M))&&e.S.name){if(!(n=I(e.S.name.text)))throw new Error(""+e.S.name.text+" ");n.nowait||(e.type="noRetSuper",e.superclass=i.superclass,B(t,{fiberCall:e}),V(this.path))}else if(!D.noWait&&(e=_.match(t,N))&&e.S.name){if(!(n=I(e.S.name.text)))throw new Error(""+e.S.name.text+" ");n.nowait||(e.type="retSuper",e.superclass=i.superclass,B(t,{fiberCall:e}),V(this.path))}this.visit(t.expr)},varDecl:function(t){var e;!D.noWait&&(e=_.match(t.value,w))&&U(e.N)&&(e.type="varDecl",B(t,{fiberCall:e}),V(this.path)),this.visit(t.value),this.visit(t.typeDecl)},typeExpr:function(t){H(t)}});function H(t){t.name;var e=z(t.name),r=n(e);r===T.NATIVE?B(t,{resolvedType:e.value}):r===T.CLASS&&B(t,{resolvedType:e.info})}function Q(t,e){D.enter({scope:e},function(){$.visit(t)})}function Z(t,n){var r=t.locals;for(var i in r.varDecls){var o=e(T.LOCAL,{declaringFunc:t});n[i]=o,B(r.varDecls[i],{scopeInfo:o})}for(let i in r.subFuncDecls){const o=e(T.LOCAL,{declaringFunc:t});n[i]=o,B(r.subFuncDecls[i],{scopeInfo:o})}}function X(t){t.forEach(function(t){t.typeDecl&&H(t.typeDecl.vtype)})}function K(t){D.enter({isMain:t.isMain,finfo:t},function(){t.locals=q(t.stmts),t.params=v(t)}),X(t.params)}function Y(t){var n,r,i=t.body,o=t.head.name?t.head.name.text:"anonymous_"+t.pos;n=_.match(t,{head:{params:{params:_.P}}}),r=n?n.P:[];var s={},a=p(D.scope);return D.enter({finfo:s},function(){r.forEach(function(t){var n=e(T.PARAM,{declaringFunc:s});B(t,{scopeInfo:n}),a[t.name.text]=n}),s.locals=q(i),Z(s,a),Q(i,a)}),s.scope=a,s.name=o,s.params=r,X(s.params),B(t,{info:s}),tt(s.locals,a),s}function tt(t,e){D.enter({scope:e},function(){for(var e in t.subFuncDecls)Y(t.subFuncDecls[e])})}function et(t){var n=p(D.scope);return t.params.forEach(function(r,o){var s=e(T.PARAM,{klass:i.name,name:t.name,no:o,declaringFunc:t});n[r.name.text]=s,B(r,{scopeInfo:s,declaringFunc:t})}),Z(t,n),D.enter({method:t,finfo:t,noWait:!1},function(){Q(t.stmts,n)}),t.scope=n,tt(t.locals,n),n}$.def=b,function(){var t=F;g(i).forEach(j);var n=i.decls;for(let r in n.natives)t[r]=e(T.NATIVE,{name:"native::"+r,value:l[r]});for(let n in y)t[n]=e(T.NATIVE,{name:"native::"+n,value:l[n]});for(let n in f.aliases){var r=f.aliases[n];t[n]=e(T.CLASS,{name:n,fullName:r,info:f.classes[r]})}}(),function(){var t=g(i);for(var e in i.decls.methods){var n=i.decls.methods[e];for(let i of t){var r=i.decls.methods[e];r&&r.nowait&&(n.nowait=!0)}}}(),D.enter({scope:F},function(){for(var t in A){R&&console.log("anon method1",t);var e=A[t];K(e),et(e)}}),delete i.hasSemanticError}}}()},{"../lib/assert":22,"../lib/root":23,"../runtime/TError":26,"../runtime/TonyuRuntime":27,"./Grammar":5,"./IndentBuffer":6,"./ObjectMatcher":8,"./Visitor":12,"./compiler":13,"./context":14,"./parse_tonyu2":16}],10:[function(t,e,n){const r=t("../lib/root");let i;"undefined"!=typeof global&&global.require&&(i=global.require("vm"));class o{constructor(t,e){if("object"==typeof t){const n=t;e=n.sourceMap,t=n.text,n.url&&(this.url=n.url)}this.text=t,this.sourceMap=e&&e.toString()}async saveAs(t){const e=t.sibling(t.name()+".map");let n=this.text;this.sourceMap&&(await e.text(this.sourceMap),n+="\\n//# sourceMappingURL="+e.name()),await t.text(n)}exec(e){return new Promise((n,o)=>{if(r.window){const t=r.document;let e;if(this.url)e=this.url;else{const t=new r.Blob([this.text],{type:"text/plain"});e=r.URL.createObjectURL(t)}const i=t.createElement("script");console.log("load script",e),i.setAttribute("src",e),i.addEventListener("load",t=>{n(t)}),this.parent.url2SourceFile[e]=this,t.body.appendChild(i)}else if(e&&e.tmpdir){const r=e.tmpdir.rel(Math.random()+".js"),i=r.sibling(r.name()+".map");let o=this.text;o+="\\n//# sourceMappingURL="+i.name(),r.text(o),i.text(this.sourceMap),t(r.path()),r.rm(),i.rm(),n()}else if(r.importScripts&&this.url)r.importScripts(this.url),n();else{const t=Function,e=i?i.compileFunction(this.text):new t(this.text);n(e())}})}export(){return{text:this.text,sourceMap:this.sourceMap,functions:this.functions}}}e.exports=new class{constructor(){this.url2SourceFile={}}add(t,e){const n=new o(t,e);return n.parent=this,n}}},{"../lib/root":23}],11:[function(t,e,n){const r=t("./Visitor"),i=t("./Grammar"),o=t("./compiler"),s=t("./context");var a=o.ScopeTypes,u=(o.newScopeType,o.getScopeType,o.newScope,o.genSym,o.annotation),c=(o.getMethod,o.getDependingClasses,o.getParams,{});function f(t){var e=this;if(t&&"object"==typeof t){var n;if(!(n=t instanceof Array?t:t[i.SUBELEMENTS]))for(var r in n=[],t)n.push(t[r]);n.forEach(function(t){e.visit(t)})}}c.checkTypeDecl=function(t,e){function n(e,n){return u(t.annotation,e,n)}var i=r({varDecl:function(t){if(t.value&&this.visit(t.value),t.name&&t.typeDecl){var e=n(t.typeDecl.vtype);console.log("var typeis",t.name+"",t.typeDecl.vtype,e.resolvedType);var r=n(t),i=r.scopeInfo,o=r.info;i?(console.log("set var type",t.name+"",e.resolvedType),i.vtype=e.resolvedType):o&&(console.log("set fld type",t.name+"",e.resolvedType),o.vtype=e.resolvedType)}},paramDecl:function(t){if(t.name&&t.typeDecl){console.log("param typeis",t.name+"",t.typeDecl.vtype+"");var e=n(t.typeDecl.vtype),r=n(t).scopeInfo;r&&e.resolvedType&&(console.log("set param type",t.name+"",t.typeDecl.vtype+""),r.vtype=e.resolvedType)}},funcDecl:function(t){var e=t.head,r=n(t).info;e.rtype&&(console.log("ret typeis",e.name+"",e.rtype.vtype+""),r.rtype=e.rtype.vtype),this.visit(e),this.visit(t.body)}});i.def=f,i.visit(t.node)},c.checkExpr=function(t,e){function n(e,n){return u(t.annotation,e,n)}var i=r({number:function(t){n(t,{vtype:Number})},literal:function(t){n(t,{vtype:String})},postfix:function(t){var e=n(t);if(e.memberAccess){var r=e.memberAccess,s=function(t){return i.visit(t),n(t).vtype}(r.target);if(s){var a=o.getField(s,r.name);console.log("GETF",s,r.name,a),a&&a.vtype&&n(t,{vtype:a.vtype})}}else this.visit(t.left),this.visit(t.op)},varAccess:function(e){var r=n(e).scopeInfo;if(r)if(r.vtype)console.log("VA typeof",e.name+":",r.vtype),n(e,{vtype:r.vtype});else if(r.type===a.FIELD){var i;if(!(i=t.decls.fields[e.name+""]))return void console.log("TC Warning: fld not found",t,e.name+"");var o=i.vtype;o?(n(e,{vtype:o}),console.log("VA typeof",e.name+":",o)):console.log("VA vtype not found",e.name+":",i)}else r.type,a.PROP}});s();i.def=f,i.visit(t.node)},e.exports=c},{"./Grammar":5,"./Visitor":12,"./compiler":13,"./context":14}],12:[function(t,e,n){e.exports=function(t){var e={funcs:t,path:[],visit:function(n){try{e.path.push(n),e.debug&&console.log("visit ",n.type,n.pos);var r=n?t[n.type]:null;if(r)return r.call(e,n);if(e.def)return e.def.call(e,n)}finally{e.path.pop()}},replace:function(t){return e.def||(e.def=function(t){if("object"==typeof t)for(var n in t)t[n]&&"object"==typeof t[n]&&(t[n]=e.visit(t[n]));return t}),e.visit(t)}};return e}},{}],13:[function(t,e,n){const r=t("../runtime/TonyuRuntime"),i=(t("./ObjectMatcher"),t("../lib/root"));var o={};r.Compiler=o;o.ScopeTypes={FIELD:"field",METHOD:"method",NATIVE:"native",LOCAL:"local",THVAR:"threadvar",PROP:"property",PARAM:"param",GLOBAL:"global",CLASS:"class",MODULE:"module"};var s=1,a=1;function u(t){return t+(a+++"").replace(/\\./g,"")}function c(t){var e={},n=[];return function r(i){if(!e[i.fullName]){if(e[i.fullName]=!0,i.isShim)throw console.log(t,"contains shim ",i),new Error("Contains shim");n.push(i),i.superclass&&r(i.superclass),i.includes&&i.includes.forEach(r)}}(t),n}o.newScopeType=function(t,e){var n={type:t};if(e)for(var r in e)n[r]=e[r];return n.name||(n.name=u("_"+t+"_")),n},o.getScopeType=function(t){return t?t.type:null},o.newScope=function(t){var e=function(){};return e.prototype=t,new e},o.nullCheck=function(t,e){if(!t)throw e+" is null";return t},o.genSym=u,o.extend=function(t,e){for(var n in e)t[n]=e[n];return t},o.annotation=function(t,e,n){e._id||(e._id=++s);var r=t[e._id];if(r||(r=t[e._id]={node:e}),r.node!==e)throw console.log("NOMATCH",r.node,e),new Error("annotation node not match!");if(n)for(var i in n)r[i]=n[i];return r},o.getSource=function(t,e){return t.substring(e.pos,e.pos+e.len)},o.getField=function(t,e){if(t instanceof Function)return null;var n=null;return c(t).forEach(function(t){n||(n=t.decls.fields[e])}),"string"==typeof n.vtype&&(n.vtype=r.classMetas[n.vtype]||i[n.vtype]),n},o.getMethod=function(t,e){var n=null;return c(t).forEach(function(t){n||(n=t.decls.methods[e])}),n},o.getDependingClasses=c,o.getParams=function(t){var e=[];if(!t.head)return e;t.head.setter&&e.push(t.head.setter.value);var n=t.head.params?t.head.params.params:null;if(n&&!n.forEach)throw new Error(t+" is not array ");return n&&(e=e.concat(n)),e},e.exports=o},{"../lib/root":23,"../runtime/TonyuRuntime":27,"./ObjectMatcher":8}],14:[function(t,e,n){e.exports=function(){var t={ovrFunc:function(t,e){return e.parent=t,e},enter:function(e,n){var r={};for(let n in e)n.match(/^\\$/)?(n=RegExp.rightContext,r[n]=t[n],t[n]=t.ovrFunc(t[n],e[n])):(r[n]=t[n],t[n]=e[n]);var i=n(t);for(let e in r)t[e]=r[e];return i}},e={};for(var n in t.clear=function(){for(var n in t)e[n]||delete t[n]},t)e[n]=!0;return t}},{}],15:[function(t,e,n){e.exports={getNamespace:function(){var t=this.getOptions();if(t.compiler&&t.compiler.namespace)return t.compiler.namespace;throw new Error("Namespace is not set")},async loadDependingClasses(){const t=this.getNamespace();for(let e of this.getDependingProjects())e.getNamespace()!==t&&await e.loadClasses()},getEXT:()=>".tonyu"}},{}],16:[function(t,e,n){const r=t("./Grammar"),i=(t("./IndentBuffer"),t("./tonyu2_token")),o=t("./parser"),s=t("./ExpressionParser2"),a=t("../runtime/TError");e.exports=function(){var t=o,e={},n=r(),u=n.get,c=(t.StringParser,t.TokensParser.token);function f(t){return JSON.stringify(t)}var l=c("number").ret(function(t){if(t.type="number","string"!=typeof t.text)throw new Error("No text for "+f(t));if(t.value=t.text-0,isNaN(t.value))throw new Error("No value for "+f(t));return t}),p=c("symbol"),h=c("symbol");for(var d in i.reserved){var m=c(d);m instanceof o.Parser&&"constructor"!==d&&(h=h.or(m))}var g=c("==="),v=c("!=="),y=c("=="),b=c("!="),x=c(">="),w=c("<="),S=c(">"),E=c("<"),_=c("&&"),C=c("||"),A=c("&"),T=c("|"),F=c("^"),D=c(">>"),R=c("<<"),L=c(">>>"),k=c("-"),P=c("+"),O=c("*"),M=c("/"),N=c("%"),B=c("="),j=c("literal"),I=c("regex");function U(t){return function(){return arguments[t]}}function W(t){return t.sep0(c(","),!0).and(c(",").opt()).ret(function(t,e){return t})}var z=s(),G=n("arrayElem").ands(c("["),z.lazy(),c("]")).ret(null,"subscript"),q=n("argList").ands(c("("),W(z.lazy()),c(")")).ret(null,"args"),J=n("member").ands(c("."),h).ret(null,"name"),V=n("parenExpr").ands(c("("),z.lazy(),c(")")).ret(null,"expr"),$=n("varAccess").ands(p).ret("name"),H=u("funcExpr").firstTokens(["function","\\\\"]),Q=n("funcExprArg").ands(H).ret("obj"),Z=u("objlit").firstTokens("{"),X=n("objlitArg").ands(Z).ret("obj"),K=X.or(Q);function Y(t,e){var n=[];if(t&&!t.args)throw f(t);if(t){var r=o.getRange(t);o.addRange(n,r),t.args.forEach(function(t){n.push(t)})}return e.forEach(function(t){var e=o.getRange(t);o.addRange(n,e),n.push(t.obj)}),n}var tt=q.and(K.rep0()).ret(function(t,e){return Y(t,e)}).or(K.rep1().ret(function(t){return Y(null,t)})),et=(q.or(X),n("call").ands(tt).ret("args")),nt=n("scall").ands(tt).ret("args"),rt=n("newExpr").ands(c("new"),$,et.opt()).ret(null,"klass","params"),it=n("superExpr").ands(c("super"),c(".").and(p).ret(U(1)).opt(),nt).ret(null,"name","params"),ot=c("true").or(c("false")).or(c("null")).or(c("undefined")).or(c("_thread")).or(c("this")).or(c("arguments")).ret(function(t){return t.type="reservedConst",t});z.element(l),z.element(ot),z.element(I),z.element(j),z.element(V),z.element(rt),z.element(it),z.element(H),z.element(Z),z.element(u("arylit").firstTokens("[")),z.element($);var st=0;function at(t,e,n){var r={type:"infix",left:t,op:e,right:n};return o.setRange(r),r.toString=function(){return"("+t+e+n+")"},r}z.infixr(st,B),z.infixr(st,c("+=")),z.infixr(st,c("-=")),z.infixr(st,c("*=")),z.infixr(st,c("/=")),z.infixr(st,c("%=")),z.infixr(st,c("|=")),z.infixr(st,c("&=")),st++,z.trifixr(st,c("?"),c(":")),st++,z.infixl(st,C),st++,z.infixl(st,_),st++,z.infixl(st,T),st++,z.infixl(st,F),st++,z.infixl(st,A),st++,z.infix(st,c("instanceof")),z.infix(st,c("is")),z.infix(st,g),z.infix(st,v),z.infix(st,y),z.infix(st,b),z.infix(st,x),z.infix(st,w),z.infix(st,S),z.infix(st,E),st++,z.infixl(st,L),z.infixl(st,R),z.infixl(st,D),st++,z.postfix(st+3,c("++")),z.postfix(st+3,c("--")),z.infixl(st,k),z.infixl(st,P),st++,z.infixl(st,O),z.infixl(st,M),z.infixl(st,N),st++,z.prefix(st,c("typeof")),z.prefix(st,c("__typeof")),z.prefix(st,c("delete")),z.prefix(st,c("++")),z.prefix(st,c("--")),z.prefix(st,c("+")),z.prefix(st,c("-")),z.prefix(st,c("!")),z.prefix(st,c("~")),st++,st++,z.postfix(st,et),z.postfix(st,J),z.postfix(st,G),z.mkInfixl(at),z.mkInfixr(at);var ut=z.build().setName("expr").profile(),ct=u("stmt").firstTokens();n("exprstmt").ands(ut,c(";")).ret("expr");n("compound").ands(c("{"),ct.rep0(),c("}")).ret(null,"stmts");var ft=c("else").and(ct).ret(U(1)),lt=(n("return").ands(c("return"),ut.opt(),c(";")).ret(null,"value"),n("if").ands(c("if"),c("("),ut,c(")"),ct,ft.opt()).ret(null,null,"cond",null,"then","_else"),n("forin").ands(c("var").opt(),p.sep1(c(","),!0),c("in").or(c("of")),ut).ret("isVar","vars","inof","set")),pt=n("normalFor").ands(ct,ut.opt(),c(";"),ut.opt()).ret("init","cond",null,"next").or(lt),ht=(n("for").ands(c("for"),c("("),pt,c(")"),"stmt").ret(null,null,"inFor",null,"loop"),n("while").ands(c("while"),c("("),ut,c(")"),"stmt").ret(null,null,"cond",null,"loop"),n("do").ands(c("do"),"stmt",c("while"),c("("),ut,c(")"),c(";")).ret(null,"loop",null,null,"cond",null,null),n("case").ands(c("case"),ut,c(":"),ct.rep0()).ret(null,"value",null,"stmts")),dt=n("default").ands(c("default"),c(":"),ct.rep0()).ret(null,null,"stmts"),mt=(n("switch").ands(c("switch"),c("("),ut,c(")"),c("{"),ht.rep1(),dt.opt(),c("}")).ret(null,null,"value",null,null,"cases","defs"),n("break").ands(c("break"),c(";")).ret("brk"),n("continue").ands(c("continue"),c(";")).ret("cont"),n("finally").ands(c("finally"),"stmt").ret(null,"stmt"),n("catch").ands(c("catch"),c("("),p,c(")"),"stmt").ret(null,null,"name",null,"stmt"),n("catches").ors("catch","finally")),gt=(n("try").ands(c("try"),"stmt",mt.rep1()).ret(null,"stmt","catches"),n("throw").ands(c("throw"),ut,c(";")).ret(null,"ex"),n("typeExpr").ands(p).ret("name")),vt=n("typeDecl").ands(c(":"),gt).ret(null,"vtype"),yt=n("varDecl").ands(p,vt.opt(),c("=").and(ut).ret(U(1)).opt()).ret("name","typeDecl","value"),bt=(n("varsDecl").ands(c("var"),yt.sep1(c(","),!0),c(";")).ret(null,"decls"),n("paramDecl").ands(p,vt.opt()).ret("name","typeDecl")),xt=n("paramDecls").ands(c("("),W(bt),c(")")).ret(null,"params"),wt=n("setterDecl").ands(c("="),bt).ret(null,"value");n("funcDeclHead").ands(c("nowait").opt(),c("function").or(c("fiber")).or(c("tk_constructor")).or(c("\\\\")).opt(),p.or(c("new")),wt.opt(),xt.opt(),vt.opt()).ret("nowait","ftype","name","setter","params","rtype");n("funcDecl").ands("funcDeclHead","compound").ret("head","body"),n("nativeDecl").ands(c("native"),p,c(";")).ret(null,"name"),n("ifWait").ands(c("ifwait"),"stmt",ft.opt()).ret(null,"then","_else"),n("empty").ands(c(";")).ret(null);ct=n("stmt").ors("return","if","for","while","do","break","continue","switch","ifWait","try","throw","nativeDecl","funcDecl","compound","exprstmt","varsDecl","empty"),n("funcExprHead").ands(c("function").or(c("\\\\")),p.opt(),xt.opt()).ret(null,"name","params");n("funcExpr").ands("funcExprHead","compound").ret("head","body");var St=n("jsonElem").ands(p.or(j),c(":").or(c("=")).and(ut).ret(function(t,e){return e}).opt()).ret("key","value"),Et=(n("objlit").ands(c("{"),W(St),c("}")).ret(null,"elems"),n("arylit").ands(c("["),W(ut),c("]")).ret(null,"elems"),n("extends").ands(c("extends"),p.or(c("null")),c(";")).ret(null,"superclassName")),_t=n("includes").ands(c("includes"),p.sep1(c(","),!0),c(";")).ret(null,"includeClassNames"),Ct=n("program").ands(Et.opt(),_t.opt(),ct.rep0(),o.TokensParser.eof).ret("ext","incl","stmts");for(var At in n.defs)n.defs[At].profile();return e.parse=function(e){let n;n="string"==typeof e?e:e.text(),n+="\\n";var r=i.parse(n);if(!r.isSuccess())throw a("(Token)",e,r.src.maxPos);var o=r.result[0],s=t.TokensParser.parse(Ct,o);if(s.isSuccess())return s.result[0];var u=o[s.src.maxPos],c=u?u.pos+u.len:n.length;throw a("",e,c)},e.extension="tonyu",e}()},{"../runtime/TError":26,"./ExpressionParser2":4,"./Grammar":5,"./IndentBuffer":6,"./parser":17,"./tonyu2_token":19}],17:[function(t,e,n){e.exports=function(){function t(t,e){var n;for(n in e)t[n]=e[n];return t}var e={consoleBuffer:"",options:{traceTap:!1,optimizeFirst:!0,profile:!1,verboseFirst:!1,traceFirstTbl:!1},Parser:n,StringParser:o,nc:r};function n(t){e.options.traceTap?this.parse=function(e){console.log("tap: name="+this.name+"  pos="+(e?e.pos:"?"));var n=t.apply(this,[e]),r="NOIMG";return n.src&&n.src.str&&(r=n.src.str.substring(n.pos-3,n.pos)+"^"+n.src.str.substring(n.pos,n.pos+3)),n.src&&n.src.tokens&&(r=n.src.tokens[n.pos-1]+"["+n.src.tokens[n.pos]+"]"+n.src.tokens[n.pos+1]),console.log("/tap: name="+this.name+" pos="+(e?e.pos:"?")+"->"+(n?n.pos:"?")+" "+r+" res="+(n?n.success:"?")),n}:this.parse=t}function r(t,e){if(null==t)throw e+" is null!";return t}function i(t,e){null!=t&&(this.src={maxPos:0,global:e},"string"==typeof t&&(this.src.str=t),t instanceof Array&&(this.src.tokens=t),this.pos=0,this.result=[],this.success=!0)}e.dispTbl=function(t){var e="",n={};if(!t)return e;for(var r in t){const e=t[r].name;n[e]||(n[e]=""),n[e]+=r}for(let t in n)e+=n[t]+"->"+t+",";return e},n.create=function(t){return new n(t)},e.create=n.create,t(n.prototype,{except:function(t){return this.ret(n.create(function(e){return t.apply({},e.result)&&(e.success=!1),e}).setName("(except "+this.name+")"))},noFollow:function(t){return r(t,"p"),this.ret(n.create(function(e){var n=t.parse(e);return e.success=!n.success,e}).setName("("+this.name+" noFollow "+t.name+")"))},andNoUnify:function(t){r(t,"next");var e=this;return n.create(function(n){var r=e.parse(n);if(!r.success)return r;var i=t.parse(r);return i.success&&(i.result=r.result.concat(i.result)),i}).setName("("+this.name+" "+t.name+")")},and:function(t){var r=this.andNoUnify(t);if(!this._first)return r;var i=this._first.tbl,o={};for(var s in i)o[s]=i[s].andNoUnify(t);return(r=n.fromFirst(this._first.space,o)).setName("("+this.name+" >> "+t.name+")"),e.options.verboseFirst&&console.log("Created aunify name="+r.name+" tbl="+e.dispTbl(o)),r},retNoUnify:function(t){var e,r=this;return e="function"==typeof t?n.create(function(e){var n=e.clone();return n.result=[t.apply({},e.result)],n}).setName("retfunc"):t,n.create(function(t){var n=r.parse(t);return n.success?e.parse(n):n}).setName("("+this.name+" >= "+e.name+")")},ret:function(t){if(!this._first)return this.retNoUnify(t);var r=this._first.tbl,i={};for(var o in r)i[o]=r[o].retNoUnify(t);const s=n.fromFirst(this._first.space,i);return s.setName("("+this.name+" >>= "+t.name+")"),e.options.verboseFirst&&console.log("Created runify name="+s.name+" tbl="+e.dispTbl(i)),s},first:function(t,r){if(!e.options.optimizeFirst)return this;if(null==t)throw"Space is null2!";if("string"==typeof r){for(var i={},o=0;o<r.length;o++)i[r.substring(o,o+1)]=this;return n.fromFirst(t,i).setName("(fst "+this.name+")")}if(null==r)return n.fromFirst(t,{ALL:this}).setName("(fst "+this.name+")");if("object"==typeof r)throw"this._first={space: space, tbl:ct}";return this},firstTokens:function(t){if(!e.options.optimizeFirst)return this;"string"==typeof t&&(t=[t]);var r={};if(t){var i=this;t.forEach(function(t){r[t]=i})}else r.ALL=this;return n.fromFirstTokens(r).setName("(fstT "+this.name+")")},unifyFirst:function(r){function i(t,e){return t?e?t.orNoUnify(e).checkTbl():t:e}var o={};this.checkTbl(),r.checkTbl(),t(o,this._first.tbl),function(){var t=r._first.tbl,e={};for(let t in o)e[t]=1;for(let n in t)e[n]=1;delete e.ALL,(o.ALL||t.ALL)&&(o.ALL=i(o.ALL,t.ALL));for(let n in e)o[n]&&t[n]?o[n]=i(o[n],t[n]):o[n]&&!t[n]?o[n]=i(o[n],t.ALL):!o[n]&&t[n]&&(o[n]=i(o.ALL,t[n]))}();var s=n.fromFirst(this._first.space,o).setName("("+this.name+")U("+r.name+")");return e.options.verboseFirst&&console.log("Created unify name="+s.name+" tbl="+e.dispTbl(o)),s},or:function(t){return r(t,"other"),this._first&&t._first&&this._first.space&&this._first.space===t._first.space?this.unifyFirst(t):(e.options.verboseFirst&&console.log("Cannot unify"+this.name+" || "+t.name+" "+this._first+" - "+t._first),this.orNoUnify(t))},orNoUnify:function(t){var e=this,r=n.create(function(n){var r=e.parse(n);return r.success?r:t.parse(n)});return r.name="("+this.name+")|("+t.name+")",r},setName:function(t){return this.name=t,this._first,this},profile:function(t){return e.options.profile&&(this.parse=this.parse.profile(t||this.name)),this},repN:function(t){var e=this;return t||(t=0),n.create(function(n){for(var r=n,i=[];;){var o,s=e.parse(r);if(!s.success)return i.length>=t?((o=r.clone()).result=[i],o.success=!0,o):((o=n.clone()).success=!1,o);i.push(s.result[0]),r=s}}).setName("("+e.name+" * "+t+")")},rep0:function(){return this.repN(0)},rep1:function(){return this.repN(1)},opt:function(){var t=this;return n.create(function(e){var n=t.parse(e);return n.success?n:((e=e.clone()).success=!0,e.result=[null],e)}).setName("("+t.name+")?")},sep1:function(t,e){r(this,"value"),r(t,"sep");var n=t.and(this).ret(function(t,n){return e?n:{sep:t,value:n}});return this.and(n.rep0()).ret(function(t,n){var r;if(e){var i=[t];for(r in n)i.push(n[r]);return i}return{head:t,tails:n}}).setName("(sep1 "+this.name+"~~"+t.name+")")},sep0:function(t){return this.sep1(t,!0).opt().ret(function(t){return t||[]})},tap:function(t){return this},retN:function(t){return this.ret(function(){return arguments[t]})},parseStr:function(t,e){var n=new i(t,e);return this.parse(n)},checkTbl:function(){if(!this._first)return this;var t=this._first.tbl;for(var e in t)if(!t[e].parse)throw this.name+": tbl."+e+" is not a parser :"+t[e];return this}}),t(i.prototype,{clone:function(){var t=new i;return t.src=this.src,t.pos=this.pos,t.result=this.result.slice(),t.success=this.success,t},updateMaxPos:function(t){t>this.src.maxPos&&(this.src.maxPos=t)},isSuccess:function(){return this.success},getGlobal:function(){return this.src.global||(this.src.global={}),this.src.global}}),n.fromFirst=function(t,r){if("TOKEN"==t)return n.fromFirstTokens(r);var i=n.create(function(n){var i=t.parse(n),o=i.src.str.substring(i.pos,i.pos+1);return e.options.traceFirstTbl&&console.log(this.name+": first="+o+" tbl="+(r[o]?r[o].name:"-")),r[o]?r[o].parse(i):r.ALL?r.ALL.parse(i):(i.success=!1,i)});return i._first={space:t,tbl:r},i.checkTbl(),i},n.fromFirstTokens=function(t){var r=n.create(function(n){var r=n.src.tokens[n.pos],i=r?r.type:null;return e.options.traceFirstTbl&&console.log(this.name+": firstT="+i+" tbl="+(t[i]?t[i].name:"-")),null!=i&&t[i]?t[i].parse(n):t.ALL?t.ALL.parse(n):(n.success=!1,n)});return r._first={space:"TOKEN",tbl:t},r.checkTbl(),r};var o={empty:n.create(function(t){var e=t.clone();return e.success=!0,e.result=[null],e}).setName("E"),fail:n.create(function(t){return t.success=!1,t}).setName("F"),str:function(t){return this.strLike(function(e,n){return e.substring(n,n+t.length)===t?{len:t.length}:null}).setName(t)},reg:function(t){return(t+"").match(/^\\/\\^/)||console.log("Waring regex should have ^ at the head:"+t),this.strLike(function(e,n){var r=t.exec(e.substring(n));return r?(r.len=r[0].length,r):null}).setName(t+"")},strLike:function(r){return n.create(function(n){var i=n.src.str;if(null==i)throw"strLike: str is null!";var o=n.pos,s=r(i,o,n);if(e.options.traceToken&&console.log("pos="+o+" r="+s),s){e.options.traceToken&&console.log("str:succ"),s.pos=o,s.src=n.src;var a=n.clone();return t(a,{pos:o+s.len,success:!0,result:[s]}),n.updateMaxPos(a.pos),a}return e.options.traceToken&&console.log("str:fail"),n.success=!1,n}).setName("STRLIKE")},parse:function(t,e,n){var r=new i(e,n);return t.parse(r)}};o.eof=o.strLike(function(t,e){return e==t.length?{len:0}:null}).setName("EOF"),e.StringParser=o;var s={token:function(t){return n.create(function(e){var n=e.src.tokens[e.pos];return e.success=!1,n?(n.type==t&&((e=e.clone()).updateMaxPos(e.pos),e.pos++,e.success=!0,e.result=[n]),e):e}).setName(t).firstTokens(t)},parse:function(t,e,n){var r=new i(e,n);return t.parse(r)},eof:n.create(function(t){var e=t.pos>=t.src.tokens.length;return t.success=e,e&&((t=t.clone()).result=[{type:"EOF"}]),t}).setName("EOT")};return e.TokensParser=s,e.lazy=function(t){var e=null;return n.create(function(n){if(e||(e=t()),!e)throw t+" returned null!";return this.name=t.name,e.parse(n)}).setName("LZ")},e.addRange=function(t,e){if(null==e)return t;if("number"!=typeof t.pos)return t.pos=e.pos,t.len=e.len,t;var n=e.pos+e.len,r=t.pos+t.len;return e.pos<t.pos&&(t.pos=e.pos),n>r&&(t.len=n-t.pos),t},e.setRange=function(t){if(null!=t&&"string"!=typeof t&&"number"!=typeof t&&"boolean"!=typeof t){if(null!=e.getRange(t))return t;for(var n in t)if(t.hasOwnProperty(n)){var r=e.setRange(t[n]);e.addRange(t,r)}return t}},e.getRange=function(t){return null==t?null:"number"!=typeof t.pos?null:"number"==typeof t.len?t:null},e}()},{}],18:[function(t,e,n){var r,i;r=this,i=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=t,n.c=e,n.p="",n(0)}([function(t,e,n){e.SourceMapGenerator=n(1).SourceMapGenerator,e.SourceMapConsumer=n(7).SourceMapConsumer,e.SourceNode=n(10).SourceNode},function(t,e,n){var r=n(2),i=n(4),o=n(5).ArraySet,s=n(6).MappingList;function a(t){t||(t={}),this._file=i.getArg(t,"file",null),this._sourceRoot=i.getArg(t,"sourceRoot",null),this._skipValidation=i.getArg(t,"skipValidation",!1),this._sources=new o,this._names=new o,this._mappings=new s,this._sourcesContents=null}a.prototype._version=3,a.fromSourceMap=function(t){var e=t.sourceRoot,n=new a({file:t.file,sourceRoot:e});return t.eachMapping(function(t){var r={generated:{line:t.generatedLine,column:t.generatedColumn}};null!=t.source&&(r.source=t.source,null!=e&&(r.source=i.relative(e,r.source)),r.original={line:t.originalLine,column:t.originalColumn},null!=t.name&&(r.name=t.name)),n.addMapping(r)}),t.sources.forEach(function(e){var r=t.sourceContentFor(e);null!=r&&n.setSourceContent(e,r)}),n},a.prototype.addMapping=function(t){var e=i.getArg(t,"generated"),n=i.getArg(t,"original",null),r=i.getArg(t,"source",null),o=i.getArg(t,"name",null);this._skipValidation||this._validateMapping(e,n,r,o),null!=r&&(r=String(r),this._sources.has(r)||this._sources.add(r)),null!=o&&(o=String(o),this._names.has(o)||this._names.add(o)),this._mappings.add({generatedLine:e.line,generatedColumn:e.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:r,name:o})},a.prototype.setSourceContent=function(t,e){var n=t;null!=this._sourceRoot&&(n=i.relative(this._sourceRoot,n)),null!=e?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[i.toSetString(n)]=e):this._sourcesContents&&(delete this._sourcesContents[i.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},a.prototype.applySourceMap=function(t,e,n){var r=e;if(null==e){if(null==t.file)throw new Error(\'SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\\\'s "file" property. Both were omitted.\');r=t.file}var s=this._sourceRoot;null!=s&&(r=i.relative(s,r));var a=new o,u=new o;this._mappings.unsortedForEach(function(e){if(e.source===r&&null!=e.originalLine){var o=t.originalPositionFor({line:e.originalLine,column:e.originalColumn});null!=o.source&&(e.source=o.source,null!=n&&(e.source=i.join(n,e.source)),null!=s&&(e.source=i.relative(s,e.source)),e.originalLine=o.line,e.originalColumn=o.column,null!=o.name&&(e.name=o.name))}var c=e.source;null==c||a.has(c)||a.add(c);var f=e.name;null==f||u.has(f)||u.add(f)},this),this._sources=a,this._names=u,t.sources.forEach(function(e){var r=t.sourceContentFor(e);null!=r&&(null!=n&&(e=i.join(n,e)),null!=s&&(e=i.relative(s,e)),this.setSourceContent(e,r))},this)},a.prototype._validateMapping=function(t,e,n,r){if((!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0)||e||n||r)&&!(t&&"line"in t&&"column"in t&&e&&"line"in e&&"column"in e&&t.line>0&&t.column>=0&&e.line>0&&e.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:n,original:e,name:r}))},a.prototype._serializeMappings=function(){for(var t,e,n,o,s=0,a=1,u=0,c=0,f=0,l=0,p="",h=this._mappings.toArray(),d=0,m=h.length;d<m;d++){if(t="",(e=h[d]).generatedLine!==a)for(s=0;e.generatedLine!==a;)t+=";",a++;else if(d>0){if(!i.compareByGeneratedPositionsInflated(e,h[d-1]))continue;t+=","}t+=r.encode(e.generatedColumn-s),s=e.generatedColumn,null!=e.source&&(o=this._sources.indexOf(e.source),t+=r.encode(o-l),l=o,t+=r.encode(e.originalLine-1-c),c=e.originalLine-1,t+=r.encode(e.originalColumn-u),u=e.originalColumn,null!=e.name&&(n=this._names.indexOf(e.name),t+=r.encode(n-f),f=n)),p+=t}return p},a.prototype._generateSourcesContent=function(t,e){return t.map(function(t){if(!this._sourcesContents)return null;null!=e&&(t=i.relative(e,t));var n=i.toSetString(t);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null},this)},a.prototype.toJSON=function(){var t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(t.file=this._file),null!=this._sourceRoot&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t},a.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.SourceMapGenerator=a},function(t,e,n){var r=n(3);e.encode=function(t){var e,n="",i=function(t){return t<0?1+(-t<<1):0+(t<<1)}(t);do{e=31&i,(i>>>=5)>0&&(e|=32),n+=r.encode(e)}while(i>0);return n},e.decode=function(t,e,n){var i,o,s,a,u=t.length,c=0,f=0;do{if(e>=u)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=r.decode(t.charCodeAt(e++))))throw new Error("Invalid base64 digit: "+t.charAt(e-1));i=!!(32&o),c+=(o&=31)<<f,f+=5}while(i);n.value=(a=(s=c)>>1,1==(1&s)?-a:a),n.rest=e}},function(t,e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");e.encode=function(t){if(0<=t&&t<n.length)return n[t];throw new TypeError("Must be between 0 and 63: "+t)},e.decode=function(t){return 65<=t&&t<=90?t-65:97<=t&&t<=122?t-97+26:48<=t&&t<=57?t-48+52:43==t?62:47==t?63:-1}},function(t,e){e.getArg=function(t,e,n){if(e in t)return t[e];if(3===arguments.length)return n;throw new Error(\'"\'+e+\'" is a required argument.\')};var n=/^(?:([\\w+\\-.]+):)?\\/\\/(?:(\\w+:\\w+)@)?([\\w.]*)(?::(\\d+))?(\\S*)$/,r=/^data:.+\\,.+$/;function i(t){var e=t.match(n);return e?{scheme:e[1],auth:e[2],host:e[3],port:e[4],path:e[5]}:null}function o(t){var e="";return t.scheme&&(e+=t.scheme+":"),e+="//",t.auth&&(e+=t.auth+"@"),t.host&&(e+=t.host),t.port&&(e+=":"+t.port),t.path&&(e+=t.path),e}function s(t){var n=t,r=i(t);if(r){if(!r.path)return t;n=r.path}for(var s,a=e.isAbsolute(n),u=n.split(/\\/+/),c=0,f=u.length-1;f>=0;f--)"."===(s=u[f])?u.splice(f,1):".."===s?c++:c>0&&(""===s?(u.splice(f+1,c),c=0):(u.splice(f,2),c--));return""===(n=u.join("/"))&&(n=a?"/":"."),r?(r.path=n,o(r)):n}e.urlParse=i,e.urlGenerate=o,e.normalize=s,e.join=function(t,e){""===t&&(t="."),""===e&&(e=".");var n=i(e),a=i(t);if(a&&(t=a.path||"/"),n&&!n.scheme)return a&&(n.scheme=a.scheme),o(n);if(n||e.match(r))return e;if(a&&!a.host&&!a.path)return a.host=e,o(a);var u="/"===e.charAt(0)?e:s(t.replace(/\\/+$/,"")+"/"+e);return a?(a.path=u,o(a)):u},e.isAbsolute=function(t){return"/"===t.charAt(0)||!!t.match(n)},e.relative=function(t,e){""===t&&(t="."),t=t.replace(/\\/$/,"");for(var n=0;0!==e.indexOf(t+"/");){var r=t.lastIndexOf("/");if(r<0)return e;if((t=t.slice(0,r)).match(/^([^\\/]+:\\/)?\\/*$/))return e;++n}return Array(n+1).join("../")+e.substr(t.length+1)};var a=!("__proto__"in Object.create(null));function u(t){return t}function c(t){if(!t)return!1;var e=t.length;if(e<9)return!1;if(95!==t.charCodeAt(e-1)||95!==t.charCodeAt(e-2)||111!==t.charCodeAt(e-3)||116!==t.charCodeAt(e-4)||111!==t.charCodeAt(e-5)||114!==t.charCodeAt(e-6)||112!==t.charCodeAt(e-7)||95!==t.charCodeAt(e-8)||95!==t.charCodeAt(e-9))return!1;for(var n=e-10;n>=0;n--)if(36!==t.charCodeAt(n))return!1;return!0}function f(t,e){return t===e?0:t>e?1:-1}e.toSetString=a?u:function(t){return c(t)?"$"+t:t},e.fromSetString=a?u:function(t){return c(t)?t.slice(1):t},e.compareByOriginalPositions=function(t,e,n){var r=t.source-e.source;return 0!==r?r:0!=(r=t.originalLine-e.originalLine)?r:0!=(r=t.originalColumn-e.originalColumn)||n?r:0!=(r=t.generatedColumn-e.generatedColumn)?r:0!=(r=t.generatedLine-e.generatedLine)?r:t.name-e.name},e.compareByGeneratedPositionsDeflated=function(t,e,n){var r=t.generatedLine-e.generatedLine;return 0!==r?r:0!=(r=t.generatedColumn-e.generatedColumn)||n?r:0!=(r=t.source-e.source)?r:0!=(r=t.originalLine-e.originalLine)?r:0!=(r=t.originalColumn-e.originalColumn)?r:t.name-e.name},e.compareByGeneratedPositionsInflated=function(t,e){var n=t.generatedLine-e.generatedLine;return 0!==n?n:0!=(n=t.generatedColumn-e.generatedColumn)?n:0!==(n=f(t.source,e.source))?n:0!=(n=t.originalLine-e.originalLine)?n:0!=(n=t.originalColumn-e.originalColumn)?n:f(t.name,e.name)}},function(t,e,n){var r=n(4),i=Object.prototype.hasOwnProperty;function o(){this._array=[],this._set=Object.create(null)}o.fromArray=function(t,e){for(var n=new o,r=0,i=t.length;r<i;r++)n.add(t[r],e);return n},o.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},o.prototype.add=function(t,e){var n=r.toSetString(t),o=i.call(this._set,n),s=this._array.length;o&&!e||this._array.push(t),o||(this._set[n]=s)},o.prototype.has=function(t){var e=r.toSetString(t);return i.call(this._set,e)},o.prototype.indexOf=function(t){var e=r.toSetString(t);if(i.call(this._set,e))return this._set[e];throw new Error(\'"\'+t+\'" is not in the set.\')},o.prototype.at=function(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)},o.prototype.toArray=function(){return this._array.slice()},e.ArraySet=o},function(t,e,n){var r=n(4);function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}i.prototype.unsortedForEach=function(t,e){this._array.forEach(t,e)},i.prototype.add=function(t){var e,n,i,o,s,a;e=this._last,n=t,i=e.generatedLine,o=n.generatedLine,s=e.generatedColumn,a=n.generatedColumn,o>i||o==i&&a>=s||r.compareByGeneratedPositionsInflated(e,n)<=0?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(r.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},e.MappingList=i},function(t,e,n){var r=n(4),i=n(8),o=n(5).ArraySet,s=n(2),a=n(9).quickSort;function u(t){var e=t;return"string"==typeof t&&(e=JSON.parse(t.replace(/^\\)\\]\\}\'/,""))),null!=e.sections?new l(e):new c(e)}function c(t){var e=t;"string"==typeof t&&(e=JSON.parse(t.replace(/^\\)\\]\\}\'/,"")));var n=r.getArg(e,"version"),i=r.getArg(e,"sources"),s=r.getArg(e,"names",[]),a=r.getArg(e,"sourceRoot",null),u=r.getArg(e,"sourcesContent",null),c=r.getArg(e,"mappings"),f=r.getArg(e,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);i=i.map(String).map(r.normalize).map(function(t){return a&&r.isAbsolute(a)&&r.isAbsolute(t)?r.relative(a,t):t}),this._names=o.fromArray(s.map(String),!0),this._sources=o.fromArray(i,!0),this.sourceRoot=a,this.sourcesContent=u,this._mappings=c,this.file=f}function f(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function l(t){var e=t;"string"==typeof t&&(e=JSON.parse(t.replace(/^\\)\\]\\}\'/,"")));var n=r.getArg(e,"version"),i=r.getArg(e,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new o,this._names=new o;var s={line:-1,column:0};this._sections=i.map(function(t){if(t.url)throw new Error("Support for url field in sections not implemented.");var e=r.getArg(t,"offset"),n=r.getArg(e,"line"),i=r.getArg(e,"column");if(n<s.line||n===s.line&&i<s.column)throw new Error("Section offsets must be ordered and non-overlapping.");return s=e,{generatedOffset:{generatedLine:n+1,generatedColumn:i+1},consumer:new u(r.getArg(t,"map"))}})}u.fromSourceMap=function(t){return c.fromSourceMap(t)},u.prototype._version=3,u.prototype.__generatedMappings=null,Object.defineProperty(u.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),u.prototype.__originalMappings=null,Object.defineProperty(u.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),u.prototype._charIsMappingSeparator=function(t,e){var n=t.charAt(e);return";"===n||","===n},u.prototype._parseMappings=function(t,e){throw new Error("Subclasses must implement _parseMappings")},u.GENERATED_ORDER=1,u.ORIGINAL_ORDER=2,u.GREATEST_LOWER_BOUND=1,u.LEAST_UPPER_BOUND=2,u.prototype.eachMapping=function(t,e,n){var i,o=e||null;switch(n||u.GENERATED_ORDER){case u.GENERATED_ORDER:i=this._generatedMappings;break;case u.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var s=this.sourceRoot;i.map(function(t){var e=null===t.source?null:this._sources.at(t.source);return null!=e&&null!=s&&(e=r.join(s,e)),{source:e,generatedLine:t.generatedLine,generatedColumn:t.generatedColumn,originalLine:t.originalLine,originalColumn:t.originalColumn,name:null===t.name?null:this._names.at(t.name)}},this).forEach(t,o)},u.prototype.allGeneratedPositionsFor=function(t){var e=r.getArg(t,"line"),n={source:r.getArg(t,"source"),originalLine:e,originalColumn:r.getArg(t,"column",0)};if(null!=this.sourceRoot&&(n.source=r.relative(this.sourceRoot,n.source)),!this._sources.has(n.source))return[];n.source=this._sources.indexOf(n.source);var o=[],s=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,i.LEAST_UPPER_BOUND);if(s>=0){var a=this._originalMappings[s];if(void 0===t.column)for(var u=a.originalLine;a&&a.originalLine===u;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s];else for(var c=a.originalColumn;a&&a.originalLine===e&&a.originalColumn==c;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s]}return o},e.SourceMapConsumer=u,c.prototype=Object.create(u.prototype),c.prototype.consumer=u,c.fromSourceMap=function(t){var e=Object.create(c.prototype),n=e._names=o.fromArray(t._names.toArray(),!0),i=e._sources=o.fromArray(t._sources.toArray(),!0);e.sourceRoot=t._sourceRoot,e.sourcesContent=t._generateSourcesContent(e._sources.toArray(),e.sourceRoot),e.file=t._file;for(var s=t._mappings.toArray().slice(),u=e.__generatedMappings=[],l=e.__originalMappings=[],p=0,h=s.length;p<h;p++){var d=s[p],m=new f;m.generatedLine=d.generatedLine,m.generatedColumn=d.generatedColumn,d.source&&(m.source=i.indexOf(d.source),m.originalLine=d.originalLine,m.originalColumn=d.originalColumn,d.name&&(m.name=n.indexOf(d.name)),l.push(m)),u.push(m)}return a(e.__originalMappings,r.compareByOriginalPositions),e},c.prototype._version=3,Object.defineProperty(c.prototype,"sources",{get:function(){return this._sources.toArray().map(function(t){return null!=this.sourceRoot?r.join(this.sourceRoot,t):t},this)}}),c.prototype._parseMappings=function(t,e){for(var n,i,o,u,c,l=1,p=0,h=0,d=0,m=0,g=0,v=t.length,y=0,b={},x={},w=[],S=[];y<v;)if(";"===t.charAt(y))l++,y++,p=0;else if(","===t.charAt(y))y++;else{for((n=new f).generatedLine=l,u=y;u<v&&!this._charIsMappingSeparator(t,u);u++);if(o=b[i=t.slice(y,u)])y+=i.length;else{for(o=[];y<u;)s.decode(t,y,x),c=x.value,y=x.rest,o.push(c);if(2===o.length)throw new Error("Found a source, but no line and column");if(3===o.length)throw new Error("Found a source and line, but no column");b[i]=o}n.generatedColumn=p+o[0],p=n.generatedColumn,o.length>1&&(n.source=m+o[1],m+=o[1],n.originalLine=h+o[2],h=n.originalLine,n.originalLine+=1,n.originalColumn=d+o[3],d=n.originalColumn,o.length>4&&(n.name=g+o[4],g+=o[4])),S.push(n),"number"==typeof n.originalLine&&w.push(n)}a(S,r.compareByGeneratedPositionsDeflated),this.__generatedMappings=S,a(w,r.compareByOriginalPositions),this.__originalMappings=w},c.prototype._findMapping=function(t,e,n,r,o,s){if(t[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[n]);if(t[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[r]);return i.search(t,e,o,s)},c.prototype.computeColumnSpans=function(){for(var t=0;t<this._generatedMappings.length;++t){var e=this._generatedMappings[t];if(t+1<this._generatedMappings.length){var n=this._generatedMappings[t+1];if(e.generatedLine===n.generatedLine){e.lastGeneratedColumn=n.generatedColumn-1;continue}}e.lastGeneratedColumn=1/0}},c.prototype.originalPositionFor=function(t){var e={generatedLine:r.getArg(t,"line"),generatedColumn:r.getArg(t,"column")},n=this._findMapping(e,this._generatedMappings,"generatedLine","generatedColumn",r.compareByGeneratedPositionsDeflated,r.getArg(t,"bias",u.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===e.generatedLine){var o=r.getArg(i,"source",null);null!==o&&(o=this._sources.at(o),null!=this.sourceRoot&&(o=r.join(this.sourceRoot,o)));var s=r.getArg(i,"name",null);return null!==s&&(s=this._names.at(s)),{source:o,line:r.getArg(i,"originalLine",null),column:r.getArg(i,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}},c.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return null==t}))},c.prototype.sourceContentFor=function(t,e){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(t=r.relative(this.sourceRoot,t)),this._sources.has(t))return this.sourcesContent[this._sources.indexOf(t)];var n;if(null!=this.sourceRoot&&(n=r.urlParse(this.sourceRoot))){var i=t.replace(/^file:\\/\\//,"");if("file"==n.scheme&&this._sources.has(i))return this.sourcesContent[this._sources.indexOf(i)];if((!n.path||"/"==n.path)&&this._sources.has("/"+t))return this.sourcesContent[this._sources.indexOf("/"+t)]}if(e)return null;throw new Error(\'"\'+t+\'" is not in the SourceMap.\')},c.prototype.generatedPositionFor=function(t){var e=r.getArg(t,"source");if(null!=this.sourceRoot&&(e=r.relative(this.sourceRoot,e)),!this._sources.has(e))return{line:null,column:null,lastColumn:null};var n={source:e=this._sources.indexOf(e),originalLine:r.getArg(t,"line"),originalColumn:r.getArg(t,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,r.getArg(t,"bias",u.GREATEST_LOWER_BOUND));if(i>=0){var o=this._originalMappings[i];if(o.source===n.source)return{line:r.getArg(o,"generatedLine",null),column:r.getArg(o,"generatedColumn",null),lastColumn:r.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},e.BasicSourceMapConsumer=c,l.prototype=Object.create(u.prototype),l.prototype.constructor=u,l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){for(var t=[],e=0;e<this._sections.length;e++)for(var n=0;n<this._sections[e].consumer.sources.length;n++)t.push(this._sections[e].consumer.sources[n]);return t}}),l.prototype.originalPositionFor=function(t){var e={generatedLine:r.getArg(t,"line"),generatedColumn:r.getArg(t,"column")},n=i.search(e,this._sections,function(t,e){var n=t.generatedLine-e.generatedOffset.generatedLine;return n||t.generatedColumn-e.generatedOffset.generatedColumn}),o=this._sections[n];return o?o.consumer.originalPositionFor({line:e.generatedLine-(o.generatedOffset.generatedLine-1),column:e.generatedColumn-(o.generatedOffset.generatedLine===e.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})},l.prototype.sourceContentFor=function(t,e){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(t,!0);if(r)return r}if(e)return null;throw new Error(\'"\'+t+\'" is not in the SourceMap.\')},l.prototype.generatedPositionFor=function(t){for(var e=0;e<this._sections.length;e++){var n=this._sections[e];if(-1!==n.consumer.sources.indexOf(r.getArg(t,"source"))){var i=n.consumer.generatedPositionFor(t);if(i)return{line:i.line+(n.generatedOffset.generatedLine-1),column:i.column+(n.generatedOffset.generatedLine===i.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},l.prototype._parseMappings=function(t,e){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var i=this._sections[n],o=i.consumer._generatedMappings,s=0;s<o.length;s++){var u=o[s],c=i.consumer._sources.at(u.source);null!==i.consumer.sourceRoot&&(c=r.join(i.consumer.sourceRoot,c)),this._sources.add(c),c=this._sources.indexOf(c);var f=i.consumer._names.at(u.name);this._names.add(f),f=this._names.indexOf(f);var l={source:c,generatedLine:u.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(i.generatedOffset.generatedLine===u.generatedLine?i.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:f};this.__generatedMappings.push(l),"number"==typeof l.originalLine&&this.__originalMappings.push(l)}a(this.__generatedMappings,r.compareByGeneratedPositionsDeflated),a(this.__originalMappings,r.compareByOriginalPositions)},e.IndexedSourceMapConsumer=l},function(t,e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(t,n,r,i){if(0===n.length)return-1;var o=function t(n,r,i,o,s,a){var u=Math.floor((r-n)/2)+n,c=s(i,o[u],!0);return 0===c?u:c>0?r-u>1?t(u,r,i,o,s,a):a==e.LEAST_UPPER_BOUND?r<o.length?r:-1:u:u-n>1?t(n,u,i,o,s,a):a==e.LEAST_UPPER_BOUND?u:n<0?-1:n}(-1,n.length,t,n,r,i||e.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===r(n[o],n[o-1],!0);)--o;return o}},function(t,e){function n(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function r(t,e,i,o){if(i<o){var s=i-1;n(t,(f=i,l=o,Math.round(f+Math.random()*(l-f))),o);for(var a=t[o],u=i;u<o;u++)e(t[u],a)<=0&&n(t,s+=1,u);n(t,s+1,u);var c=s+1;r(t,e,i,c-1),r(t,e,c+1,o)}var f,l}e.quickSort=function(t,e){r(t,e,0,t.length-1)}},function(t,e,n){var r=n(1).SourceMapGenerator,i=n(4),o=/(\\r?\\n)/,s="$$$isSourceNode$$$";function a(t,e,n,r,i){this.children=[],this.sourceContents={},this.line=null==t?null:t,this.column=null==e?null:e,this.source=null==n?null:n,this.name=null==i?null:i,this[s]=!0,null!=r&&this.add(r)}a.fromStringWithSourceMap=function(t,e,n){var r=new a,s=t.split(o),u=function(){return s.shift()+(s.shift()||"")},c=1,f=0,l=null;return e.eachMapping(function(t){if(null!==l){if(!(c<t.generatedLine)){var e=(n=s[0]).substr(0,t.generatedColumn-f);return s[0]=n.substr(t.generatedColumn-f),f=t.generatedColumn,p(l,e),void(l=t)}p(l,u()),c++,f=0}for(;c<t.generatedLine;)r.add(u()),c++;if(f<t.generatedColumn){var n=s[0];r.add(n.substr(0,t.generatedColumn)),s[0]=n.substr(t.generatedColumn),f=t.generatedColumn}l=t},this),s.length>0&&(l&&p(l,u()),r.add(s.join(""))),e.sources.forEach(function(t){var o=e.sourceContentFor(t);null!=o&&(null!=n&&(t=i.join(n,t)),r.setSourceContent(t,o))}),r;function p(t,e){if(null===t||void 0===t.source)r.add(e);else{var o=n?i.join(n,t.source):t.source;r.add(new a(t.originalLine,t.originalColumn,o,e,t.name))}}},a.prototype.add=function(t){if(Array.isArray(t))t.forEach(function(t){this.add(t)},this);else{if(!t[s]&&"string"!=typeof t)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);t&&this.children.push(t)}return this},a.prototype.prepend=function(t){if(Array.isArray(t))for(var e=t.length-1;e>=0;e--)this.prepend(t[e]);else{if(!t[s]&&"string"!=typeof t)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);this.children.unshift(t)}return this},a.prototype.walk=function(t){for(var e,n=0,r=this.children.length;n<r;n++)(e=this.children[n])[s]?e.walk(t):""!==e&&t(e,{source:this.source,line:this.line,column:this.column,name:this.name})},a.prototype.join=function(t){var e,n,r=this.children.length;if(r>0){for(e=[],n=0;n<r-1;n++)e.push(this.children[n]),e.push(t);e.push(this.children[n]),this.children=e}return this},a.prototype.replaceRight=function(t,e){var n=this.children[this.children.length-1];return n[s]?n.replaceRight(t,e):"string"==typeof n?this.children[this.children.length-1]=n.replace(t,e):this.children.push("".replace(t,e)),this},a.prototype.setSourceContent=function(t,e){this.sourceContents[i.toSetString(t)]=e},a.prototype.walkSourceContents=function(t){for(var e=0,n=this.children.length;e<n;e++)this.children[e][s]&&this.children[e].walkSourceContents(t);var r=Object.keys(this.sourceContents);for(e=0,n=r.length;e<n;e++)t(i.fromSetString(r[e]),this.sourceContents[r[e]])},a.prototype.toString=function(){var t="";return this.walk(function(e){t+=e}),t},a.prototype.toStringWithSourceMap=function(t){var e={code:"",line:1,column:0},n=new r(t),i=!1,o=null,s=null,a=null,u=null;return this.walk(function(t,r){e.code+=t,null!==r.source&&null!==r.line&&null!==r.column?(o===r.source&&s===r.line&&a===r.column&&u===r.name||n.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:e.line,column:e.column},name:r.name}),o=r.source,s=r.line,a=r.column,u=r.name,i=!0):i&&(n.addMapping({generated:{line:e.line,column:e.column}}),o=null,i=!1);for(var c=0,f=t.length;c<f;c++)10===t.charCodeAt(c)?(e.line++,e.column=0,c+1===f?(o=null,i=!1):i&&n.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:e.line,column:e.column},name:r.name})):e.column++}),this.walkSourceContents(function(t,e){n.setSourceContent(t,e)}),{code:e.code,map:n}},e.SourceNode=a}])},"object"==typeof n&&"object"==typeof e?e.exports=i():"function"==typeof define&&define.amd?define("source-map",[],i):"object"==typeof n?n.sourceMap=i():r.sourceMap=i()},{}],19:[function(t,e,n){const r=t("./parser");e.exports=function(){var t=r.StringParser,e="SAMENAME",n=t.reg(/^(\\s*(\\/\\*\\/?([^\\/]|[^*]\\/|\\r|\\n)*\\*\\/)*(\\/\\/.*\\r?\\n)*)*/).setName("space");function i(e,r){var i,o;"string"==typeof e?(i=t.str(e),e.length>0&&(o=e.substring(0,1)),r||(r=e)):(i=t.reg(e),r||(r=e+""));var s=n.and(i).ret(function(t,e){var n={};if(n.pos=e.pos,"number"!=typeof n.pos)throw"no pos for "+r+" ";if(n.len=e.len,n.text=e.src.str.substring(n.pos,n.pos+n.len),"string"!=typeof n.text)throw"no text("+n.text+") for "+r+" ";return n.toString=function(){return this.text},n.isToken=!0,n});return o&&(s=s.first(n,o)),s.setName(r)}var o={},s={};function a(t,e,n,r){"string"==typeof n&&(n=i(n)),o[t]=c(o[t],n.ret(function(t){return t.type=e,t}).setName(e))}function u(t,n,r,i){n==e&&(n=r);for(var o=1;o<=t;o*=2)0!=(t&o)&&a(t&o,n,r);s[n]=i}function c(t,e){return t?t.or(e):e}var f=r.create(function(t){for(var e=2,r=[];(t=o[e].parse(t)).success;){var i=t.result[0];e=s[i.type],r.push(i)}return(t=n.parse(t)).success=t.src.maxPos==t.src.str.length,t.result[0]=r,t}),l={function:!0,var:!0,return:!0,typeof:!0,if:!0,__typeof:!0,for:!0,else:!0,super:!0,while:!0,continue:!0,break:!0,do:!0,switch:!0,case:!0,default:!0,try:!0,catch:!0,finally:!0,throw:!0,of:!0,in:!0,fiber:!0,native:!0,instanceof:!0,new:!0,is:!0,true:!0,false:!0,null:!0,this:!0,undefined:!0,usethread:!0,constructor:!0,ifwait:!0,nowait:!0,_thread:!0,arguments:!0,delete:!0,extends:!0,includes:!0},p=i(/^(?:0x[0-9a-f]+|0b[01]+|(?:[0-9]+(?:\\.[0-9]*)?|\\.[0-9]+)(?:e-?[0-9]+)?)/i).ret(function(t){return t.type="number",t.value=t.text-0,t}).first(n,"0123456789"),h=i({exec:function(t){var e=t.substring(0,1);if(\'"\'!==e&&"\'"!==e)return!1;for(var n=1;n<t.length;n++){var r=t.substring(n,n+1);if(r===e)return[t.substring(0,n+1)];"\\\\"===r&&n++}return!1},toString:function(){return"literal"}}).first(n,"\\"\'"),d=i({exec:function(t){if("/"!==t.substring(0,1))return!1;for(var e=1;e<t.length;e++){var n=t.substring(e,e+1);if("/"===n){var r=/^[ig]*/.exec(t.substring(e+1));return[t.substring(0,e+1+r[0].length)]}if("\\n"==n)return!1;"\\\\"===n&&e++}return!1},toString:function(){return"regex"}}).first(n,"/");u(3,"number",p,1),u(2,"regex",d,1),u(3,"literal",h,1),u(3,e,"++",1),u(3,e,"--",1),u(3,e,"!==",2),u(3,e,"===",2),u(3,e,">>>",2),u(3,e,"+=",2),u(3,e,"-=",2),u(3,e,"*=",2),u(3,e,"/=",2),u(3,e,"%=",2),u(3,e,">=",2),u(3,e,"<=",2),u(3,e,"!=",2),u(3,e,"==",2),u(3,e,">>",2),u(3,e,"<<",2),u(3,e,"&&",2),u(3,e,"||",2),u(3,e,"(",2),u(3,e,")",1),u(3,e,"[",2),u(3,e,"]",1),u(3,e,"{",2),u(3,e,"}",1),u(3,e,">",2),u(3,e,"<",2),u(3,e,"^",2),u(3,e,"+",2),u(3,e,"-",2),u(3,e,".",2),u(3,e,"?",2),u(3,e,"=",2),u(3,e,"*",2),u(3,e,"%",2),u(1,e,"/",2),u(3,e,"^",2),u(3,e,"~",2),u(3,e,"\\\\",2),u(3,e,":",2),u(3,e,";",2),u(3,e,",",2),u(3,e,"!",2),u(3,e,"&",2),u(3,e,"|",2);var m=i(/^[a-zA-Z_$][a-zA-Z0-9_$]*/,"symresv_reg").ret(function(t){return t.type="constructor"==t.text?"tk_constructor":l.hasOwnProperty(t.text)?t.text:"symbol",t}).first(n);for(var g in l)s[g]=2;return s.tk_constructor=2,s.symbol=1,o[2]=c(o[2],m),o[1]=c(o[1],m),{parse:function(t){var e=r.StringParser.parse(f,t);return e.success||console.log("Stopped at "+t.substring(e.src.maxPos-5,e.src.maxPos+5)),e},extension:"js",reserved:l}}()},{"./parser":17}],20:[function(t,e,n){var r,i,o,s,a;e.exports=(a=0,(s={}).def=function(t,e,n){var r=s.getModuleInfo(t);"function"==typeof e?(n=e,e=s.reqsFromFunc(n),s.setReqs(r,e),r.func=function(){var t={exports:{}};return n(s.doLoad,t,t.exports)||t.exports}):(s.setReqs(r,e),r.func=function(){return n.apply(this,s.getObjs(e))}),s.loadIfAvailable(r)},(r=function(t,e,n){s.def(t,e,n)}).amd={},i=function(t,e){s.def("REQJS_"+a++,t,e)},s.setReqs=function(t,e){e.forEach(function(e){var n=s.getModuleInfo(e);n.loaded||(t.reqs[e]=n,n.revReqs[t.name]=t)})},s.getModuleInfo=function(t){var e=s.modules;return e[t]=e[t]||{name:t,reqs:{},revReqs:{}}},s.doLoad=function(t){var e=s.getModuleInfo(t);if(e.loaded)return e.obj;e.loaded=!0;var n=e.func();for(var r in null!=n||t.match(/^REQJS_/)||console.log("Warning: No obj for "+t),e.obj=n,e.revReqs)s.notifyLoaded(e.revReqs[r],e.name);return n},s.notifyLoaded=function(t,e){delete t.reqs[e],s.loadIfAvailable(t)},s.loadIfAvailable=function(t){for(var e in t.reqs)return;s.doLoad(t.name)},s.getObjs=function(t){var e=[];return t.forEach(function(t){var n=s.doLoad(t);e.push(n)}),e},s.reqsFromFunc=function(t){var e=[];return(t+"").replace(/require\\s*\\(\\s*["\']([^"\']+)["\']\\s*\\)/g,function(t,n){e.push(n)}),e},s.modules={},r("extend",[],function(){return function(t,e){for(var n in e)t[n]=e[n];return t}}),r("assert",[],function(){var t,e=function(t){this.failMesg=i(t||"Assertion failed: ")};e.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var e=t(arguments),n=e.shift();if(e=i(e),e=this.failMesg.concat(n).concat(e),console.log.apply(console,e),this.isDefensive())return n;if(this.isBool())return!1;throw new Error(e.join(" "))},subAssertion:function(){var n=t(arguments);return n=i(n),new e(this.failMesg.concat(n))},assert:function(t,e){return t||this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):!!this.isBool()||t},ne:function(t,e){return t===e?this.fail(t,"===",e):!!this.isBool()||t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):!!this.isBool()||t},is:function(t,e){var n=e,r=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),!!this.isBool()||t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var i=0;i<n.length;i++){var o=this.subAssertion("failed at ",t,"[",i,"]: ");null==n[i]&&console.log("WOW!7",r[i],n[i]),o.is(r[i],n[i])}return!!this.isBool()||t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),!!this.isBool()||t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),!!this.isBool()||t;if(n===Boolean||"boolean"==n)return this.assert("boolean"==typeof r,[r,"should be a boolean"]),!!this.isBool()||t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),!!this.isBool()||t;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),!!this.isBool()||t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),!!this.isBool()||t;if(n&&"object"==typeof n){for(var s in n)(o=this.subAssertion("failed at ",t,".",s,":")).is(t[s],n[s]);return!!this.isBool()||t}if("string"==typeof n){var a=this._regedType[n];return a?this.is(t,a):!!this.isBool()||t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&r(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},t=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var n=new e,r=function(){try{return n.assert.apply(n,arguments)}catch(t){throw new Error(t.stack)}};function i(t){if(t instanceof Array){var e=[];return t.forEach(function(t){e=e.concat(i(t))}),e}return[t]}return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){r[t]=function(){try{return n[t].apply(n,arguments)}catch(t){throw console.log(t.stack),new Error(t.message)}}}),r.fail=n.fail.bind(n),r.MODE_STRICT=n.MODE_STRICT,r.MODE_DEFENSIVE=n.MODE_DEFENSIVE,r.MODE_BOOL=n.MODE_BOOL,r.f=function(t){return{_assert_func:t}},r.opt=function(t){return r.f(function(e){return null==e||e instanceof t})},r.and=function(){var e=t(arguments);return r(e instanceof Array),r.f(function(t){for(var n=0;n<e.length;n++)this.is(t,e[n])})},r}),r("PathUtil",["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}var n,r=/^([a-zA-Z]):/,i=/^([a-z\\-]+):\\/\\/\\/?([^\\/]+)\\//,o=t.f(function(t){this.is(t,String),this.assert(n.isPath(t),[t," is not a path"])}),s=t.f(function(t){this.is(t,String),this.assert(n.isAbsolutePath(t),[t," is not a absolute path"])}),a=t.f(function(t){this.is(t,String),this.assert(!n.isAbsolutePath(t),[t," is not a relative path"])}),u=t.f(function(t){this.is(t,o),this.assert(n.isDir(t),[t," is not a directory path"])}),c=t.and(u,s),f=t.f(function(t){this.is(t,o),this.assert(!n.isDir(t),[t," is not a file path"])});return n={Path:o,Absolute:s,Relative:a,Dir:u,File:f,AbsDir:c,SEP:"/",endsWith:e,startsWith:function(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n},isChildOf:function(t,e){return this.startsWith(this.normalize(t),this.normalize(e))},normalize:function(t){return this.fixSep(t,"/").replace(/\\/+$/,"/")},hasDriveLetter:function(t){return r.exec(t)},isURL:function(t){var e=i.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:"/"+t.substring(e[0].length)}},isPath:function(e){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),n.isPath(e)&&!n.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),n.isPath(e)&&(n.startsWith(e,"/")||n.hasDriveLetter(e)||n.isURL(e))},isDir:function(r){return r=n.fixSep(r),t.is(arguments,[o]),e(r,"/")},hasBackslashSep:function(t){return t.indexOf("\\\\")>=0},fixSep:function(e,n){return n=n||"/",t.is(arguments,[String]),t.is(e.replace(/[\\\\\\/]/g,n),o)},directorify:function(e){return n.isDir(e)?e:t.is(e+"/",u)},filify:function(e){return n.isDir(e)?t.is(e.substring(0,e.length-1),f):e},splitPath:function(e){var n;if(t.is(arguments,[o]),n=this.isURL(e)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}var i=(e=e.replace(/\\/+/g,"/")).split("/");return""==i[i.length-1]&&(i[i.length-2]+="/",i.pop()),i},name:function(e){return t.is(arguments,[String]),n.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var r=n.name(e),i=/\\.[a-zA-Z0-9]+$/.exec(r);return i?i[0]:null},truncExt:function(e,r){t.is(e,String);var i=n.name(e);return r=r||n.ext(e),t.is(r,String),i.substring(0,i.length-r.length)},truncSEP:function(e){return t.is(arguments,[o]),n.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(r,i){return t.is(arguments,[String,String]),e(n.name(r),i)},parent:function(e){return t.is(arguments,[String]),n.up(e)},rel:function(e,r){if(""==r)return e;t.is(arguments,[c,a]);var i=n.splitPath(r),o=e;o=o.replace(/\\/$/,"");var s=n;return i.forEach(function(t){".."==t||"../"==t?o=s.up(o):(o=o.replace(/\\/$/,""),o+="/"+("."==t||"./"==t?"":t))}),o},relPath:function(e,r){return t.is(arguments,[s,s]),e.substring(0,r.length)!=r?"../"+n.relPath(e,this.up(r)):e.substring(r.length)},up:function(t){if("/"==t)return null;var e=n.splitPath(t);return e.pop(),e.join("/")+"/"}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(t){var e=n[t];n[t]=function(){var t=!1,r=Array.prototype.slice.call(arguments).map(function(e){return n.hasBackslashSep(e)?(t=!0,n.fixSep(e)):e}),i=e.apply(n,r);return t?n.fixSep(i,"\\\\"):i}}),n.isAbsolute=n.isAbsolutePath,n.isRelative=n.isRelativePath,"object"==typeof window&&(window.PathUtil=n),n}),r("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".wav":"audio/x-wav",".mp3":"audio/mp3",".ogg":"audio/ogg",".midi":"audio/midi",".mid":"audio/midi",".mzo":"audio/mzo",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu",".c":"text/c",".dtl":"text/dolittle"}}),r("DeferredUtil",[],function(){var t,e="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:null,n=function(t){this.res=t};function r(t){return t}return(t={isNativePromise:function(t){return t&&"function"==typeof t.then&&"function"!=typeof t.promise&&"function"==typeof t.catch},isJQPromise:function(t){return t&&"function"==typeof t.then&&"function"==typeof t.promise&&"function"==typeof t.fail},isPromise:function(t){return t&&"function"==typeof t.then&&("function"==typeof t.promise||"function"==typeof t.catch)},all:function(e){return t.promise(function(n,r){var i=[],o=e.length;e.forEach(function(e,s){t.resolve(e).then(function(t){i[s]=t,0==--o&&n(i)},r)})})},resolve:function(e){return t.config.useJQ&&t.isJQPromise(e)?e:!t.config.useJQ&&t.isNativePromise(e)?e:t.promise(function(n,r){t.isPromise(e)?e.then(n,r):n(e)})},throwNowIfRejected:function(e){var n,r,i=e.then(function(t){return n||(n="resolved"),t},function(e){if(n)return t.reject(e);n="rejected",r=e});if(n||(n="notyet"),"rejected"===n)throw r;return i},assertResolved:function(t){var e,n;if(t.then(function(t){e=t,n=!0}),!n)throw new Error("Promise not resolved");return e},ensureDefer:function(e){return t.promise(function(n,i){var o;t.resolve(e).then(function(t){o?n(t):setTimeout(function(){n(t)},0)}).then(r,function(t){o?i(t):setTimeout(function(){i(t)},0)}),o=!0})},directPromise:function(e){return t.timeout(e,0)},then:function(e){return t.directPromise().then(e)},timeout:function(e,n){return t.promise(function(t){setTimeout(function(){t(n)},e||0)})},funcPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;try{e(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(t){n.reject(t)}return n.promise()}if(t.external.Promise)return new t.external.Promise(function(t,n){try{e(t,n)}catch(t){n(t)}});throw new Error("promise is not found")},reject:function(e){if(t.config.useJQ){var n=new $.Deferred;return n.reject(e),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(e)},0),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(e){return console.log(e,e.stack),t.throwPromise(e)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(r){return r>=e.length?t.brk():t.resolve(n(e[r],r)).then(function(){return r+1})},0);var r=[];for(var i in e)r.push({k:i,v:e[i]});return t.each(r,function(t){return n(t.k,t.v)})},loop:function(e,i){try{for(var o;;){if(i instanceof n)return t.when1(i.res);var s=!0,a=!1,u=e(i),c=t.resolve(u).then(function(r){return s=!1,(i=r)instanceof n?i.res:a?t.loop(e,i):void 0}).then(r,function(t){s=!1,o=t});if(o)throw o;if(a=!0,s)return c}}catch(e){return t.reject(e)}},brk:function(t){return new n(t)},tryLoop:function(e,n){return t.loop(t.tr(e),n)},tryEach:function(e,n){return t.loop(e,t.tr(n))},documentReady:function(){return t.callbackToPromise(function(t){$(t)})},requirejs:function(n){if(!e.requirejs)throw new Error("requirejs is not loaded");return t.callbackToPromise(function(t){e.requirejs(n,t)})}}).NOP=function(t){return t},t.E=function(){console.log("DUE",arguments),t.errorHandler.apply(t,arguments)},t.errorHandler=function(t){console.error.apply(console,arguments),alert(t)},t.setE=function(e){t.errorHandler=e},t.begin=t.try=t.tr=t.throwF,t.promise=t.callbackToPromise=t.funcPromise,t.when1=t.resolve,t.config={},e.$&&e.$.Deferred&&(t.config.useJQ=!0),t.external={Promise:e.Promise},e.DeferredUtil||(e.DeferredUtil=t),t}),r("FSClass",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(t,e,n,r,i){var o=function(){},s={};function a(t){throw new Error(t+" is STUB!")}return o.addFSType=function(t,e){s[t]=e},o.availFSTypes=function(){return s},t(o.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},isReadOnly:function(t,e){a("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(t,e){return r(this.getRootFS()!==this),this.getRootFS().resolveFS(t)},mounted:function(t,e){this.rootFS=t,this.mountPoint=e},inMyFS:function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},getRootFS:function(){return r(this.rootFS,"rootFS is not set")},getReturnTypes:function(t,e){a("")},getContent:function(t,e){a("getContent")},size:function(t){return this.getContent(t,{type:ArrayBuffer}).toBin().byteLength},getContentAsync:function(t,e){return this.supportsSync()||a("getContentAsync"),i.resolve(this.getContent.apply(this,arguments))},setContent:function(t,e,n){a("")},setContentAsync:function(t,e,n){var r=this;return r.supportsSync()||a("setContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.setContent(t,e,n))})},appendContent:function(t,e,n){a("")},appendContentAsync:function(t,e,n){var r=this;return r.supportsSync()||a("appendContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.appendContent(t,e,n))})},getMetaInfo:function(t,e){a("")},setMetaInfo:function(t,e,n){a("")},mkdir:function(t,e){a("mkdir")},touch:function(t){a("touch")},exists:function(t,e){a("exists")},opendir:function(t,e){a("opendir")},opendirAsync:function(t,e){return this.supportsSync()||a("opendirAsync"),i.resolve(this.opendir.apply(this,arguments))},cp:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),i=i||{};var o=this.isDir(t),s=this.getRootFS().resolveFS(n),a=s.isDir(n);if(o||a)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(t),c=s.setContent(n,u);return i.a&&s.setMetaInfo(n,this.getMetaInfo(t)),c}return s.setContentAsync(n,this.getContentAsync(t)).then(function(e){return i.a?s.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(t,e){a("")},link:function(t,e,n){throw new Error("ln "+e+" "+t+" : This FS not support link.")},getURL:function(t){a("")},onAddObserver:function(t){}}),o.delegateMethods=function(t,n){for(var i in n)!function(i){r.ne(i,"inMyFS"),t[i]=function(){var t=arguments[0];r.is(t,e.Absolute);var o=this.resolveFS(t);return o!==this?(console.log("Invoked for other fs",this.mountPoint,o.mountPoint),o[i].apply(o,arguments)):n[i].apply(this,arguments)}}(i)},o.delegateMethods(o.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},getContentType:function(t,r){var i=(e.ext(t)+"").toLowerCase();return n[i]||(r||{}).def||"application/octet-stream"},getBlob:function(t,e){var n=this.getContent(t);return(e=e||{}).blobType=e.blobType||Blob,e.binType=e.binType||ArrayBuffer,n.hasPlainText()?new e.blobType([n.toPlainText()],this.getContentType(t)):new e.blobType([n.toBin(e.binType)],this.getContentType(t))},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t,n){return e.isDir(t)},find:function(t,n){r.is(arguments,[e.Absolute]);var i=this.opendir(t,n),o=this,s=[t];return i.forEach(function(r){var i=e.rel(t,r);if(e.isDir(i)){var a=o.resolveFS(i);s=s.concat(a.find(i,n))}else s.push(i)}),s},resolveLink:function(t){r.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){r(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var o=e.rel(i,e.relPath(t,n));return r(o!=t,"np==path=="+o),r.is(this.getRootFS().resolveFS(o).resolveLink(o),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(t){return null},opendirEx:function(t,n){r.is(t,e.AbsDir);var i=this,o={};return this.opendir(t).forEach(function(n){var r=e.rel(t,n);o[n]=i.getMetaInfo(r)}),o},getDirTree:function(t,n){var i=(n=n||{}).dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],r.is(n.excludes,Array),n.base||(n.base=t),r.is(t,e.AbsDir);var o=this.opendirEx(t,n);if("no-recursive"==n.style)return o;var s=this;for(var a in o){var u=o[a],c=e.rel(t,a),f=e.relPath(c,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(f)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(c)>=0)continue}if(s.isDir(c))switch(n.style){case"flat-absolute":case"flat-relative":s.getDirTree(c,n);break;case"hierarchical":n.dest={},i[a]=s.getDirTree(c,n)}else switch(n.style){case"flat-absolute":i[c]=u;break;case"flat-relative":i[f]=u;break;case"hierarchical":i[a]=u}}return i}}),o}),r("Util",[],function(){return{getQueryString:function(t,e){null==e&&(e=""),t=t.replace(/[\\[]/,"\\\\[").replace(/[\\]]/,"\\\\]");var n,r=new RegExp("[\\\\?&]"+t+"=([^&#]*)").exec(window.location.href);return null==r?e:(n=r[1],decodeURIComponent(n.replace(/\\+/g,"%20")))},endsWith:function(t,e){return t.substring(t.length-e.length)===e},startsWith:function(t,e){return t.substring(0,e.length)===e},privatize:function(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){return r.apply(t,arguments)})}(n);return e},extend:function(t,e){for(var n in e||{})t[n]=e[n];return t}}}),r("FileSaver",[],function(){var t="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:this;function n(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){o(r.response,e,n)},r.onerror=function(){console.error("could not download file")},r.send()}function r(t){var e=new XMLHttpRequest;return e.open("HEAD",t,!1),e.send(),e.status>=200&&e.status<=299}function i(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var o=t.saveAs||"object"!=typeof window||window!==t?function(){}:"download"in HTMLAnchorElement.prototype?function(e,o,s){var a=t.URL||t.webkitURL,u=document.createElement("a");o=o||e.name||"download",u.download=o,u.rel="noopener","string"==typeof e?(u.href=e,u.origin!==location.origin?r(u.href)?n(e,o,s):i(u,u.target="_blank"):i(u)):(u.href=a.createObjectURL(e),setTimeout(function(){a.revokeObjectURL(u.href)},4e4),setTimeout(function(){i(u)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,o){if(e=e||t.name||"download","string"==typeof t)if(r(t))n(t,e,o);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout(function(){i(s)})}else navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Depricated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t}(t,o),e)}:function(e,r,i,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return n(e,r,i);var s="application/octet-stream"===e.type,a=/constructor/i.test(t.HTMLElement)||t.safari,u=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((u||s&&a)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var t=c.result;t=u?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=t:location=t,o=null},c.readAsDataURL(e)}else{var f=t.URL||t.webkitURL,l=f.createObjectURL(e);o?o.location=l:location.href=l,o=null,setTimeout(function(){f.revokeObjectURL(l)},4e4)}};return t.saveAs=o.saveAs=o,void 0!==e&&(e.exports=o),o}),r("Content",["assert","Util","FileSaver"],function(t,e,n){var r=function(){},i=e.extend;r.plainText=function(t,e){var n=new r;return n.contentType=e||"text/plain",n.plain=t,n},r.url=function(t){var e=new r;return e.url=t,e},r.buffer2ArrayBuffer=function(e){if(r.isBuffer(e)){var n=new Uint8Array(e),i=n.buffer;if(i instanceof ArrayBuffer)return i;var o=Array.prototype.slice.call(n);return t(new Uint8Array(o).buffer,"n2a: buf is not set")}return t(e,"n2a: a is not set")},r.arrayBuffer2Buffer=function(e){return e instanceof ArrayBuffer?new Buffer(new Uint8Array(e)):t(e,"a2n: a is not set")},r.bin=function(e,n){t(n,"contentType should be set");var i=new r;if(r.isNodeBuffer(e))i.bufType="node",i.nodeBuffer=e;else if(e instanceof ArrayBuffer)i.bufType="array2",i.arrayBuffer=e;else{if(!e||!r.isBuffer(e.buffer))throw new Error(e+" is not a bin");i.bufType="array1",i.arrayBuffer=e.buffer}return i.contentType=n,i},r.looksLikeDataURL=function(t){return t.match(/^data:/)},r.download=n;var o=r.prototype;o.toBin=function(t){if(t=t||(r.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return t===Buffer?this.nodeBuffer:this.arrayBuffer=r.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return t===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=r.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var e=new a(this.url,t);return this.setBuffer(e.buffer)}if(null!=this.plain)return this.setBuffer(r.str2utf8bytes(this.plain,t));throw new Error("No data")},o.setBuffer=function(e){return t(e,"b is not set"),r.isNodeBuffer(e)?this.nodeBuffer=e:this.arrayBuffer=e},o.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},o.toNodeBuffer=function(){return this.toBin(Buffer)},o.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=r.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var t=new a(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=t.url}throw new Error("No data")},o.toPlainText=function(){if(this.hasPlainText())return this.plain;if(this.url&&!this.hasBin()){var t=new a(this.url,ArrayBuffer);this.arrayBuffer=t.buffer}if(this.hasBin())return this.plain=r.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},o.hasURL=function(){return this.url},o.hasPlainText=function(){return null!=this.plain},o.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},o.hasNodeBuffer=function(){return this.nodeBuffer},o.hasArrayBuffer=function(){return this.arrayBuffer},o.toBlob=function(){return new Blob([this.toBin(ArrayBuffer)],{type:this.contentType})},o.download=function(t){r.download(this.toBlob(),t)},r.Base64_To_ArrayBuffer=function(t,e){var n=e||ArrayBuffer;t=t.replace(/[\\n=]/g,"");var i=new Object;i[65]=0,i[66]=1,i[67]=2,i[68]=3,i[69]=4,i[70]=5,i[71]=6,i[72]=7,i[73]=8,i[74]=9,i[75]=10,i[76]=11,i[77]=12,i[78]=13,i[79]=14,i[80]=15,i[81]=16,i[82]=17,i[83]=18,i[84]=19,i[85]=20,i[86]=21,i[87]=22,i[88]=23,i[89]=24,i[90]=25,i[97]=26,i[98]=27,i[99]=28,i[100]=29,i[101]=30,i[102]=31,i[103]=32,i[104]=33,i[105]=34,i[106]=35,i[107]=36,i[108]=37,i[109]=38,i[110]=39,i[111]=40,i[112]=41,i[113]=42,i[114]=43,i[115]=44,i[116]=45,i[117]=46,i[118]=47,i[119]=48,i[120]=49,i[121]=50,i[122]=51,i[48]=52,i[49]=53,i[50]=54,i[51]=55,i[52]=56,i[53]=57,i[54]=58,i[55]=59,i[56]=60,i[57]=61,i[43]=62,i[47]=63;var o,s=t.length,a=0,u=0;if(!s)return new n(0);o=Math.floor(s/4*3),"="==t.charAt(s-1)&&(o-=1),"="==t.charAt(s-2)&&(o-=1);for(var c=new n(o),f=r.isNodeBuffer(c)?c:new Uint8Array(c),l=0,p=0;p<o&&(void 0===(u=i[t.charCodeAt(l)])&&h("Invalid letter: "+t.charCodeAt(l)),a=u<<2,l++,void 0===(u=i[t.charCodeAt(l)])&&h("Invalid letter: "+t.charCodeAt(l)),f[p]=a|u>>4&3,a=(15&u)<<4,l++,!(++p>=o))&&(void 0===(u=i[t.charCodeAt(l)])&&h("Invalid letter: "+t.charCodeAt(l)),f[p]=a|u>>2&15,a=(3&u)<<6,l++,!(++p>=o));)void 0===(u=i[t.charCodeAt(l)])&&h("Invalid letter: "+t.charCodeAt(l)),f[p]=a|u,l++,p++;function h(e){throw console.log(e),console.log(t,l),new Error(e)}return c},r.Base64_From_ArrayBuffer=function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,s=0,a=0;a<i&&(n+=e[(s=r[a])>>2],o=(3&s)<<4,!(++a>=i))&&(n+=e[o|(s=r[a])>>4],o=(15&s)<<2,!(++a>=i));)n+=e[o|(s=r[a])>>6],n+=e[63&s],a++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n},r.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},r.isNodeBuffer=function(t){return r.hasNodeBuffer()&&t instanceof Buffer},r.isBuffer=function(t){return t instanceof ArrayBuffer||r.isNodeBuffer(t)},r.utf8bytes2str=function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));return decodeURIComponent(e.join(""))},r.str2utf8bytes=function(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer};var s=r.hasNodeBuffer()?Buffer:ArrayBuffer,a=function(e,n){"string"==typeof e?(this.url=e,this.binType=n||s,this.dataURL2bin(e)):e&&r.isBuffer(e.buffer)?(this.buffer=e.buffer,t.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):r.isBuffer(e)?(this.buffer=e,t.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),t.fail("Invalid args: ",arguments))};return r.DataURL=a,i(a.prototype,{bin2dataURL:function(e,n){t(r.isBuffer(e)),t.is(n,String);var i=this.dataHeader(n),o=r.Base64_From_ArrayBuffer(e);return t.is(o,String),this.url=i+o},dataURL2bin:function(e){t.is(arguments,[String]);var n=/^data:([^;]+);base64,/i.exec(e);return t(n,["malformed dataURL:",e]),this.contentType=n[1],this.buffer=r.Base64_To_ArrayBuffer(e.substring(n[0].length),this.binType),t.is(this.buffer,this.binType)},dataHeader:function(e){return t.is(arguments,[String]),"data:"+e+";base64,"},toString:function(){return t.is(this.url,String)}}),r}),r("NativeFS",["FSClass","assert","PathUtil","extend","Content"],function(e,n,r,o,s){var a,u=n;const c=[()=>t("fs"),()=>i.nodeRequire("fs"),()=>global.require("fs")];for(let t of c)try{(a=t()).existsSync("test.txt"),process.cwd();break}catch(t){a=null}if(!a)return function(){throw new Error("This system not support native FS")};var f=function(t){t&&(n.is(t,r.AbsDir),this.rootPoint=t)},l=r.hasDriveLetter(process.cwd());f.available=!0;var p=r.SEP,h=f.prototype=new e;function d(t){return t}return h.toNativePath=function(t){return this.rootPoint?(n.is(t,r.Absolute),n(this.inMyFS(t),t+" is not fs of "+this),r.rel(this.rootPoint,r.relPath(t,this.mountPoint||r.SEP))):t},h.arrayBuffer2Buffer=function(t){return t instanceof ArrayBuffer?new Buffer(new Uint8Array(t)):t},e.addFSType("NativeFS",function(t,e){return new f(e.r)}),f.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},f.prototype.inMyFS=function(t){return this.mountPoint?r.startsWith(t,this.mountPoint):!(!!l^!!r.hasDriveLetter(t))},e.delegateMethods(f.prototype,{getReturnTypes:function(t,e){return d(t),u.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,e){e=e||{},n.is(t,r.Absolute);var i=this.toNativePath(t);return this.assertExist(t),s.bin(a.readFileSync(i),this.getContentType(t))},size:function(t){var e=this.toNativePath(t);return a.statSync(e).size},setContent:function(t,e){n.is(arguments,[r.Absolute,s]);var i=r.up(t);i&&this.getRootFS().resolveFS(i).mkdir(i);var o=this.toNativePath(t);e.hasBin()||!e.hasPlainText()?a.writeFileSync(o,e.toNodeBuffer()):a.writeFileSync(o,e.toPlainText())},appendContent:function(t,e){n.is(arguments,[r.Absolute,s]);var i=r.up(t);i&&this.getRootFS().resolveFS(i).mkdir(i);var o=this.toNativePath(t);e.hasBin()||!e.hasPlainText()?a.appendFileSync(o,e.toNodeBuffer()):a.appendFileSync(o,e.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(t,e,n){d(t)},isReadOnly:function(t){return d(t),!1},stat:function(t){n.is(t,r.Absolute);var e=this.toNativePath(t);return a.statSync(e)},mkdir:function(t,e){if(e=e||{},u.is(arguments,[r.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var n=r.up(t);n&&this.getRootFS().resolveFS(n).mkdir(n);var i=this.toNativePath(t);return a.mkdirSync(i),this.assertExist(i)},opendir:function(t,e){u.is(arguments,[String]),e=e||{};var n=this.toNativePath(t),i=r.truncSEP(n),o=a.readdirSync(n);return e.nosep||(o=o.map(function(t){return t+(a.statSync(i+p+t).isDirectory()?p:"")})),u.is([].concat(o),Array)},rm:function(t,e){u.is(arguments,[r.Absolute]),e=e||{},this.assertExist(t);var n=this.toNativePath(t);return this.isDir(t)?a.rmdirSync(n):a.unlinkSync(n)},exists:function(t,e){e=e||{};var n=this.toNativePath(t);return a.existsSync(n)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():r.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&a.utimesSync(t,Date.now()/1e3,Date.now()/1e3)},getURL:function(t){return"file:///"+t.replace(/\\\\/g,"/")},onAddObserver:function(t,e){var n=this,i=n.getRootFS();e=e||{};var s=this.isDir(t),u=a.watch(t,e,function(e,a){var u,c=s?r.rel(t,a):t;u=n.exists(c)?o({eventType:e},n.getMetaInfo(c)):{eventType:e},i.notifyChanged(c,u)});return{remove:function(){u.close()}}}}),f}),r("LSFS",["FSClass","PathUtil","extend","assert","Util","Content"],function(t,e,n,r,i,o){var s=function(t,e){r(t," new LSFS fail: no storage"),this.storage=t,this.options=e||{},this.options.useDirCache&&(this.dirCache={})},a=e.isDir.bind(e),u=e.up.bind(e),c=e.endsWith.bind(e),f=e.Absolute,l=e.SEP;function p(){return(new Date).getTime()}return s.ramDisk=function(t){var n={};return n[e.SEP]="{}","useDirCache"in(t=t||{})||(t.useDirCache=!0),new s(n,t)},t.addFSType("localStorage",function(t,e){return new s(localStorage,e)}),t.addFSType("ram",function(t,e){return s.ramDisk(e)}),s.now=p,(s.prototype=new t).resolveKey=function(t){return r.is(t,e.Absolute),this.mountPoint?e.SEP+e.relPath(t,this.mountPoint):t},s.prototype.getItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},s.prototype.setItem=function(t,n){r.is(t,e.Absolute);var i=this.resolveKey(t);r(i.indexOf("..")<0),r(e.startsWith(i,e.SEP)),this.storage[i]=n},s.prototype.removeItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},s.prototype.itemExists=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return r(this.storage,"No storage"),n in this.storage},s.prototype.getDirInfo=function(t){if(r.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");if(c(t,l)||(t+=l),r(this.inMyFS(t)),this.dirCache&&this.dirCache[t])return this.dirCache[t];var n,i={};try{(n=this.getItem(t))&&(i=JSON.parse(n))}catch(e){console.log("dinfo err : ",t,n)}return this.dirCache&&(this.dirCache[t]=i),i},s.prototype.putDirInfo=function(t,n,i){if(r.is(arguments,[e.AbsDir,Object]),!a(t))throw new Error("Not a directory : "+t);r(this.inMyFS(t)),this.dirCache&&(this.dirCache[t]=n),this.setItem(t,JSON.stringify(n));var o=u(t);if(null!=o&&this.inMyFS(o)){var s=this.getDirInfo(o);this._touch(s,o,e.name(t),i)}},s.prototype._touch=function(t,i,o,s){r.is(arguments,[Object,String,String]),r(this.inMyFS(i));var a="change";t[o]||(a="create",t[o]={},s&&(t[o].trashed=!0)),s||delete t[o].trashed,t[o].lastUpdate=p();var u=n({eventType:a},t[o]);this.getRootFS().notifyChanged(e.rel(i,o),u),this.putDirInfo(i,t,s)},s.prototype.removeEntry=function(t,n,i){r.is(arguments,[Object,String,String]),t[i]&&(t[i]={lastUpdate:p(),trashed:!0},this.getRootFS().notifyChanged(e.rel(n,i),{eventType:"trash"}),this.putDirInfo(n,t,!0))},s.prototype.removeEntryWithoutTrash=function(t,n,i){r.is(arguments,[Object,String,String]),t[i]&&(delete t[i],this.getRootFS().notifyChanged(e.rel(n,i),{eventType:"delete"}),this.putDirInfo(n,t,!0))},s.prototype.isRAM=function(){return this.storage!==localStorage},s.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},s.getUsage=function(){var t=0;for(var e in localStorage)"string"==typeof localStorage[e]&&(t+=localStorage[e].length);return t},s.getCapacity=function(){var t=0,e="a",n="___checkls___",r=0,i=Math.pow(2,25);try{for(var o=0;o<10;o++)e+=e;for(var o in localStorage)o.substring(0,n.length)==n?delete localStorage[o]:"string"==typeof localStorage[o]&&(r+=localStorage[o].length);for(var s=r;a()&&e.length<i;)e+=e;for(;e.length>1024;)e=e.substring(e.length/2),a();return{using:s,max:r}}finally{for(o=0;o<t;o++)delete localStorage[n+o]}function a(){try{return localStorage[n+t]=e,t++,r+=e.length,!0}catch(e){return delete localStorage[n+t],!1}}},t.delegateMethods(s.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(t,e){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t,e){r.is(arguments,[f]),this.assertExist(t);var n=this.getItem(t);return o.looksLikeDataURL(n)?o.url(n):o.plainText(n)},setContent:function(t,e,n){r.is(arguments,[f,o]),this.assertWriteable(t);var i=null;e.hasPlainText()&&(i=e.toPlainText(),o.looksLikeDataURL(i)&&(i=null)),null!=i?this.setItem(t,i):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t,n){if(this.assertExist(t,{includeTrashed:!0}),r.is(arguments,[f]),t==e.SEP)return{};var i=r(e.up(t));if(!this.inMyFS(i))return{};var o=e.name(t);r.is(i,e.AbsDir);var s=this.getDirInfo(i);return r(s[o])},setMetaInfo:function(t,n,i){r.is(arguments,[String,Object]),this.assertWriteable(t);var o=r(e.up(t));if(this.inMyFS(o)){var s=this.getDirInfo(o),a=e.name(t);s[a]=n,this.putDirInfo(o,s,s[a].trashed)}},mkdir:function(t,e){r.is(arguments,[f]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){r.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),i=[];for(var o in n)r(n[o]),n[o].trashed&&!e.includeTrashed||i.push(o);return r.is(i,Array)},rm:function(t,n){r.is(arguments,[f]),n=n||{},this.assertWriteable(t);var i=e.up(t);if(null==i||!this.inMyFS(i))throw new Error(t+": cannot remove. It is root of this FS.");this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t)?(this.opendir(t).length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)):this.removeItem(t);var o=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(o,i,e.name(t)):this.removeEntry(o,i,e.name(t))},exists:function(t,n){r.is(arguments,[f]),n=n||{};var i=e.name(t),o=e.up(t);if(null==o||!this.inMyFS(o))return!0;var s=this.getDirInfo(o)[i];return s&&s.trashed&&this.itemExists(t)&&this.isDir(t),!s&&this.itemExists(t),s&&!s.trashed&&!s.link&&this.itemExists(t),s&&!n.includeTrashed&&(s=!s.trashed),!!s},link:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var o={};o.link=n,o.lastUpdate=p(),this.setMetaInfo(t,o),r(this.exists(t)),r(this.isLink(t))},isLink:function(t){return r.is(arguments,[e.Absolute]),this.exists(t)?r(this.getMetaInfo(t)).link:null},touch:function(t){r.is(arguments,[f]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?(this.dirCache&&(this.dirCache[t]={}),this.setItem(t,"{}")):this.setItem(t,""));var n=u(t);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,e.name(t),!1)}else r(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(t){return this.getContent(t).toURL()},opendirEx:function(t,n){r.is(t,e.AbsDir),n=n||{};var i={},o=this.getDirInfo(t);if(n.includeTrashed)return o;for(var s in o)o[s].trashed||(i[s]=o[s]);return i}}),s}),"undefined"!=typeof $&&$.ajaxTransport("+binary",function(t,e,n){if(window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob)))return{send:function(e,n){var r=new XMLHttpRequest,i=t.url,o=t.type,s=t.async||!0,a=t.responseType||"blob",u=t.data||null,c=t.username||null,f=t.password||null;for(var l in r.addEventListener("load",function(){var e={};e[t.dataType]=r.response,n(r.status,r.statusText,e,r.getAllResponseHeaders())}),r.open(o,i,s,c,f),e)r.setRequestHeader(l,e[l]);r.responseType=a,r.send(u)},abort:function(){n.abort()}}}),r("jquery.binarytransport",function(){}),r("WebFS",["FSClass","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(t,e,n,r,i){var o=function(){},s=o.prototype=new t;return t.addFSType("web",function(){return new o}),s.fstype=function(){return"Web"},s.supportsSync=function(){return!1},s.inMyFS=function(t){return i.isURL(t)},t.delegateMethods(s,{exists:function(){return!0},getContentAsync:function(t){var e=this;return n.promise(function(n,i){$.get(t,function(i){var o=new FileReader;o.addEventListener("loadend",function(){n(r.bin(o.result,e.getContentType(t)))}),o.readAsArrayBuffer(i)},"binary").fail(i)})},getURL:function(t){return t}}),o}),r("Env",["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\\$\\{([a-zA-Z0-9_]+)\\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=(n=(n=this.expand(n)).replace(/\\/+/g,"/")).replace(/^[a-z][a-z]+:\\//,function(t){return t+"/"}),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n}),r("SFile",["extend","assert","PathUtil","Util","Content","FSClass","FileSaver","DeferredUtil"],function(t,e,n,r,i,o,s,a){var u=function(t,r){e.is(r,n.Absolute),this._path=r,this.rootFS=t,this.fs=t.resolveFS(r),this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return u.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},u.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},getPolicy:function(t){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(t,i){var o;if(i=i||{},u.is(t))o=t;else{var s;e.is(t,n.Absolute);var a=i.policy||this.policy;if(a&&(s=a.topDir)&&(s.path&&(s=s.path()),!n.startsWith(t,s)))throw new Error(t+": cannot access. Restricted to "+s);(o=new u(this.rootFS,t)).policy=a}return o.policy?r.privatize(o):o},contains:function(t){return e(u.is(t),t+" shoud be a SFile object."),!!this.isDir()&&n.startsWith(t.path(),this.path())},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var r=t.path?t.path():t;return n.relPath(this.path(),e.is(r,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,t))},sibling:function(t){return this.up().rel(t)},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var t=this.metaInfo();return!!t&&t.trashed},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.act.fs.getMetaInfo(this.act.path,t)},setMetaInfo:function(t,e){return this.act.fs.setMetaInfo(this.act.path,t,e)},getDirTree:function(t){return this.act.fs.getDirTree(this.act.path,t)},assertExists:function(){e(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(t){var e=Array.prototype.slice.call(arguments);if("function"==typeof e[0]){var n=e.shift();return a.resolve(this.exists.apply(this,e)).then(n)}t=t||{};var r=this.fs.exists(this.path(),t);return r||t.noFollowLink?r:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(t){var e=this;return t=t||{},this.isLink()?a.resolve(this.fs.rm(this.path(),t)):(this.isDir()&&(t.recursive||t.r)?this.each(function(e){return e.rm(t)}):a.resolve()).then(function(){return e.act.fs.rm(e.act.path,t)})},removeWithoutTrash:function(t){(t=t||{}).noTrash=!0,this.rm(t)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(t){return"function"==typeof t?this.getText(t):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(t){if(e.is(t,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());var n=this.contentType({def:null});return null!==n&&!n.match(/^text/)&&i.looksLikeDataURL(t)?a.throwNowIfRejected(this.setContent(i.url(t))):a.throwNowIfRejected(this.setContent(i.plainText(t)))},appendText:function(t){return e.is(t,String),this.act.fs.appendContent(this.act.path,i.plainText(t))},getContent:function(t){return"function"==typeof t?this.act.fs.getContentAsync(this.act.path).then(t):this.act.fs.getContent(this.act.path)},setContent:function(t){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,t)},getText:function(t){return"function"==typeof t?this.getContent(e).then(t):e(this.act.fs.getContent(this.act.path));function e(t){try{return t.toPlainText()}catch(e){return t.toURL()}}},getDataURL:function(t){return"function"==typeof t?this.getContent(function(t){return t.toURL()}):this.getContent().toURL()},setDataURL:function(t){return this.setContent(i.url(t))},dataURL:function(t){return"string"==typeof t?this.setDataURL(t):"function"==typeof t?this.getDataURL(t):this.getDataURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(t){return this.act.fs.getContentType(this.act.path,t)},bytes:function(t){return i.isBuffer(t)?this.setBytes(t):this.getBytes()},setBytes:function(t){return this.act.fs.setContent(this.act.path,i.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.act.fs.getContent(this.act.path).toBin(t.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(t){return t instanceof Array?this.text(t.join("\\n")):"function"==typeof t?this.text(function(e){return t(e.replace(/\\r/g,"").split("\\n"))}):this.text().replace(/\\r/g,"").split("\\n")},obj:function(){if(0==arguments.length){var t=this.text();return t?JSON.parse(t):null}this.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,n){e(t&&t.isSFile(),t+" is not a file");var r=this,i=(n=n||{},r.isDir()),o=t.isDir();if(!i&&o&&(t=t.rel(r.name()),e(!t.isDir(),t+" is a directory."),o=!1),!i||o){if(i||o)return e(i&&o,"Both src and dst should be dir"),r.each(function(e){var r,i=t.rel(e.name());return n.progress&&(r=n.progress(i,{src:e,dst:i})),a.resolve(r).then(function(){return i.copyFrom(e,n)})});n.echo&&n.echo(r+" -> "+t);var s=this.act.fs.cp(this.act.path,t.getResolvedLinkPath(),n);return s=a.resolve(s),n.a?s.then(function(){return t.setMetaInfo(r.getMetaInfo())}):s}this.err("Cannot move dir "+r.path()+" to file "+t.path())},moveFrom:function(t,e){var n=this;return n.exists(function(r){return n.copyFrom(t,e).then(function(){return t.rm({recursive:!0})},function(t){if(!r)return n.exists(function(t){if(t)return n.rm({recursive:!0})}).then(function(){throw t});throw t})})},moveTo:function(t,e){return t.moveFrom(this,e)},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){return this.assertDir().listFilesAsync(e).then(function(e){return a.each(e,t)})},eachrev:function(t,e){return this.assertDir().listFilesAsync(e).then(function(e){return a.each(e.reverse(),t)})},recursive:function(t,e){var n=this.assertDir();return e=n.convertOptions(e),n.each(function(n){return n.isDir()?n.recursive(t,e):t(n)},e)},_listFiles:function(t,n){e(null==t||"object"==typeof t);var r,i=this.assertDir();return this.path(),t=i.convertOptions(t),r||(r=t.order),n?this.act.fs.opendirAsync(this.act.path,t).then(o):o(this.act.fs.opendir(this.act.path,t));function o(e){for(var n=[],o=0;o<e.length;o++){var s=e[o],a=i.rel(s);t.excludesF(a)||n.push(a)}return"function"==typeof r&&n.sort&&n.sort(r),n}},listFilesAsync:function(t){return this._listFiles(t,!0)},listFiles:function(t){return this._listFiles(t,!1)},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir();return t?n.listFiles(t).map(function(t){return t.name()}):this.act.fs.opendir(this.act.path,t)},convertOptions:function(t){var i=r.extend({},t),o=(this.assertDir(),this.path()),s=i.excludes||{};if("function"==typeof s)i.excludesF=s;else if("object"==typeof s){if(s instanceof Array){var a={};s.forEach(function(t){n.startsWith(t,"/")?a[t]=1:a[o+t]=1}),s=a}i.excludesF=function(t){return s[t.path()]}}return e.is(i,{excludesF:Function})},mkdir:function(){return this.touch()},link:function(t,e){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,t.path(),e)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(t){return this.getFS().getRootFS().addObserver(this.path(),t)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},setBlob:function(t){var e=this;return a.promise(function(n,r){var i=new FileReader;i.addEventListener("loadend",function(){a.resolve(e.setBytes(i.result)).then(n)}),i.readAsArrayBuffer(t)})},size:function(t){if(!t){if(this.isDir()){var e=0;return this.each(function(t){e+=t.size()}),e}return this.act.fs.size(this.act.path)}},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use \'zip\' instead.");s(this.getBlob(),this.name())},err:function(){var t=Array.prototype.slice.call(arguments);throw console.log.apply(console,t),new Error(t.join(""))},exportAsObject:function(t){var e=this,n={};return this.recursive(function(t){n[t.relPath(e)]=t.text()},t),{base:e.path(),data:n}},importFromObject:function(t,e){for(var n in"string"==typeof t&&(t=JSON.parse(t)),t=t.data)this.rel(n).text(t[n])},watch:function(t,e){var n=function(){};"function"==typeof t&&(n=t),"function"==typeof e&&(n=e);var r=this.getFS().getRootFS();r.addObserver(this.path(),function(t,e){n(e.eventType,r.get(t),e)})}},Object.defineProperty(u.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),e.is(this._act,{fs:o,path:n.Absolute}),this._act)}}),u}),r("RootFS",["assert","FSClass","PathUtil","SFile"],function(t,e,n,r){var i=function(n){t.is(n,e),this.mount(null,n)},o=i.prototype,s={err:function(t,e){throw new Error(t+": "+e)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(e,r){t.is(arguments,[n.AbsDir]);var i=this.fstab();console.log(i);for(var o=0;o<i.length;o++)if(i[o].mountPoint==e)return i.splice(o,1),!0;return!1},availFSTypes:function(){return e.availFSTypes()},mount:function(n,r,i){"string"==typeof r&&(r=t(e.availFSTypes()[r],"fstype "+r+" is undefined.")(n,i||{})),t.is(r,e),r.mounted(this,n),this.fstab().unshift(r)},resolveFS:function(r,i){var o;return t.is(r,n.Absolute),this.fstab().forEach(function(t){o||t.inMyFS(r)&&(o=t)}),o||this.err(r,"Cannot resolve"),t.is(o,e)},get:function(e){return t.is(e,n.Absolute),new r(this.resolveFS(e),e)},addObserver:function(e,n,r){this.observers=this.observers||[];var i,o,s={};"string"==typeof e&&(i=e),"string"==typeof n&&(i=n),"string"==typeof r&&(i=r),"object"==typeof e&&(s=e),"object"==typeof n&&(s=n),"object"==typeof r&&(s=r),"function"==typeof e&&(o=e),"function"==typeof n&&(o=n),"function"==typeof r&&(o=r),t.is(i,String),t.is(o,Function);var a=this.resolveFS(i).onAddObserver(i,s),u=this.observers,c={path:i,handler:o,remove:function(){var t=u.indexOf(this);u.splice(t,1),a&&a.remove()}};return this.observers.push(c),c},notifyChanged:function(t,e){this.observers&&this.observers.forEach(function(r){n.isChildOf(t,r.path)&&r.handler(t,e)})},getRootFS:function(){return this}};for(var a in s)o[a]=s[a];return i}),r("zip",["SFile","FileSaver","Util","DeferredUtil"],function(t,e,n,r){var i={setJSZip:function(t){i.JSZip=t,r.external.Promise||(r.external.Promise=t.external.Promise)}};return"undefined"!=typeof JSZip&&i.setJSZip(JSZip),i.zip=function(e,n,o){t.is(n)||(o=n),o=o||{};var s=new i.JSZip;return function t(e,n){return n.each(function(n){var i=r.resolve();return o.progress&&(i=o.progress(n)),i.then(function(){return n.isDir()?t(e.folder(n.name().replace(/[\\/\\\\]$/,"")),n):n.getContent(function(t){e.file(n.name(),t.toArrayBuffer())})})})}(s,e).then(function(){return r.resolve(s.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(r){if(t.is(n))return n.setBytes(r);saveAs(new Blob([r],{type:"application/zip"}),e.name().replace(/[\\/\\\\]$/,"")+".zip")})},i.unzip=function(e,n,o){var s={};o=o||{},t.is(e)&&(e=e.getContent().toArrayBuffer()),o.onCheckFile||(o.onCheckFile=function(t){return o.overwrite?t:!t.exists()&&t});var a=new i.JSZip;return r.resolve(a.loadAsync(e)).then(function(){return r.each(a.files,function(e,i){var a,u;return r.resolve(i.async("arraybuffer")).then(function(t){if(a=t,u=n.rel(i.name),o.progress)return r.resolve(o.progress(u))}).then(function(){if(console.log("Inflating",i.name),!u.isDir()){var e={file:u,status:"uploaded"};s[u.path()]=e;var n=FS.Content.bin(a,u.contentType()),r=o.onCheckFile(u,n);return!1===r&&(e.status="cancelled",u=null),t.is(r)&&(u.path()!==r.path()&&(e.redirectedTo=r),u=r),u?u.setContent(n):void 0}})})}).then(function(){return console.log("unzip done",s),s})},i}),r("promise",[],function(){function t(t){return Boolean(t&&void 0!==t.length)}function e(){}function n(t){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],a(t,this)}function r(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,n._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void o(e.promise,t)}i(e.promise,r)}else(1===t._state?i:o)(e.promise,t._value)})):t._deferreds.push(e)}function i(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof n)return t._state=3,t._value=e,void s(t);if("function"==typeof r)return void a((i=r,u=e,function(){i.apply(u,arguments)}),t)}t._state=1,t._value=e,s(t)}catch(e){o(t,e)}var i,u}function o(t,e){t._state=2,t._value=e,s(t)}function s(t){2===t._state&&0===t._deferreds.length&&n._immediateFn(function(){t._handled||n._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)r(t,t._deferreds[e]);t._deferreds=null}function a(t,e){var n=!1;try{t(function(t){n||(n=!0,i(e,t))},function(t){n||(n=!0,o(e,t))})}catch(t){if(n)return;n=!0,o(e,t)}}return setTimeout,n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,n){var i=new this.constructor(e);return r(this,new function(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}(t,n,i)),i},n.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})},n.all=function(e){return new n(function(n,r){if(!t(e))return r(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return n([]);var o=i.length;function s(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var a=e.then;if("function"==typeof a)return void a.call(e,function(e){s(t,e)},r)}i[t]=e,0==--o&&n(i)}catch(t){r(t)}}for(var a=0;a<i.length;a++)s(a,i[a])})},n.resolve=function(t){return t&&"object"==typeof t&&t.constructor===n?t:new n(function(e){e(t)})},n.reject=function(t){return new n(function(e,n){n(t)})},n.race=function(e){return new n(function(r,i){if(!t(e))return i(new TypeError("Promise.race accepts an array"));for(var o=0,s=e.length;o<s;o++)n.resolve(e[o]).then(r,i)})},n._immediateFn=function(t){t()},n._unhandledRejectionFn=function(){"undefined"!=typeof console&&console},n}),r("FS",["FSClass","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil","promise"],function(t,e,n,r,i,o,s,a,u,c,f,l,p){var h,d={};d.assert=s,d.Content=c,d.Class=t,d.DeferredUtil=l,l.config.useJQ||(l.external.Promise=p),d.Env=o,d.LSFS=n,d.NativeFS=e,d.PathUtil=i,d.RootFS=u,d.SFile=a,d.WebFS=r,d.zip=f,"object"==typeof window&&(window.FS=d);var m=new o({});return d.addFSType=t.addFSType,d.availFSTypes=t.availFSTypes,d.setEnvProvider=function(t){m=t},d.getEnvProvider=function(){return m},d.setEnv=function(t,e){if("object"==typeof t)for(var n in t)m.set(n,t[n]);else m.set(t,e)},d.getEnv=function(t){return"string"==typeof t?m.get(t):m.value},d.init=function(t){h||(t||(e.available?t=new e:"object"==typeof localStorage?t=new n(localStorage):"function"==typeof importScripts&&(self.addEventListener("message",function(t){var e=t.data;switch("string"==typeof e&&(e=JSON.parse(e)),e.type){case"upload":d.get(e.base).importFromObject(e.data);break;case"observe":h.observe(e.path,function(t,e){self.postMessage(JSON.stringify({type:"changed",path:t,content:d.get(t).text(),meta:e}))})}}),t=n.ramDisk())),h=new u(t))},d.getRootFS=function(){return d.init(),h},d.get=function(){return d.init(),h.get.apply(h,arguments)},d.expandPath=function(){return m.expandPath.apply(m,arguments)},d.resolve=function(t,e){return d.init(),a.is(t)?t:(t=m.expandPath(t),e&&!i.isAbsolutePath(t)?(e=m.expandPath(e),d.get(e).rel(t)):d.get(t))},d.mount=function(){return d.init(),h.mount.apply(h,arguments)},d.unmount=function(){return d.init(),h.unmount.apply(h,arguments)},d.isFile=function(t){return a.is(t)},d}),i(["FS"],function(t){o=t}),"undefined"!=typeof window&&void 0===window.FS&&(window.FS=o),void 0!==e&&(e=o),o)},{fs:1}],21:[function(t,e,n){var r=1,i={},o={},s=self;s.WorkerService={install:function(t,e){i[t]=e},serv:function(t,e){this.install(t,e)},ready:function(){s.WorkerService.isReady=!0,self.postMessage({ready:!0})},reverse:function(t,e){var n=r++;return new Promise(function(r,i){o[n]=function(t){"ok"==t.status?r(t.result):i(t.error)},self.postMessage({reverse:!0,id:n,path:t,params:e})})}},self.addEventListener("message",function(t){var e=t.data,n=e.id,r={id:n};if(e.reverse)return o[e.id](e),void delete o[e.id];try{Promise.resolve(i[e.path](e.params,r)).then(function(t){self.postMessage({id:n,result:t,status:"ok"})},s)}catch(t){s(t)}function s(t){t=Object.assign({name:t.name,message:t.message,stack:t.stack},t||{});try{const e=JSON.stringify(t);t=JSON.parse(e)}catch(e){t=t?t.message||t+"":"unknown",console.log("WorkerServiceW",e,t)}self.postMessage({id:n,error:t,status:"error"})}}),s.WorkerService.install("WorkerService/isReady",function(){return s.WorkerService.isReady}),s.console||(s.console={log:function(){s.WorkerService.reverse("console/log",Array.prototype.slice.call(arguments))}}),e.exports=self.WorkerService},{}],22:[function(t,e,n){const r=function(t){this.failMesg=a(t||"Assertion failed: ")};var i;r.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var t=i(arguments),e=t.shift();if(t=a(t),t=this.failMesg.concat(e).concat(t).concat(["mode",this._mode]),console.log.apply(console,t),this.isDefensive())return e;if(this.isBool())return!1;throw new Error(t.join(" "))},subAssertion:function(){var t=i(arguments);return t=a(t),new r(this.failMesg.concat(t))},assert:function(t,e){return t||this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):!!this.isBool()||t},ne:function(t,e){return t===e?this.fail(t,"===",e):!!this.isBool()||t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):!!this.isBool()||t},is:function(t,e){var n=e,r=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),!!this.isBool()||t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var i=0;i<n.length;i++){let e=this.subAssertion("failed at ",t,"[",i,"]: ");null==n[i]&&console.log("WOW!7",r[i],n[i]),e.is(r[i],n[i])}return!!this.isBool()||t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),!!this.isBool()||t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),!!this.isBool()||t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),!!this.isBool()||t;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),!!this.isBool()||t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),!!this.isBool()||t;if(n&&"object"==typeof n){for(var o in n){this.subAssertion("failed at ",t,".",o,":").is(t[o],n[o])}return!!this.isBool()||t}if("string"==typeof n){var s=this._regedType[n];return s?this.is(t,s):!!this.isBool()||t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&s(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},i=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var o=new r,s=function(){try{return o.assert.apply(o,arguments)}catch(t){throw new Error(t.message)}};function a(t){if(t instanceof Array){var e=[];return t.forEach(function(t){e=e.concat(a(t))}),e}return[t]}["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){s[t]=function(){try{return o[t].apply(o,arguments)}catch(t){throw console.log(t.stack),new Error(t.message)}}}),s.fail=o.fail.bind(o),s.MODE_STRICT=o.MODE_STRICT,s.MODE_DEFENSIVE=o.MODE_DEFENSIVE,s.MODE_BOOL=o.MODE_BOOL,s.f=function(t){return{_assert_func:t}},s.opt=function(t){return s.f(function(e){return null==e||e instanceof t})},s.and=function(){var t=i(arguments);return s(t instanceof Array),s.f(function(e){for(var n=0;n<t.length;n++)this.is(e,t[n])})},e.exports=s},{}],23:[function(t,e,n){e.exports="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()},{}],24:[function(t,e,n){const r=t("./ProjectFactory"),i=(t("../lib/root"),t("../lang/SourceFiles")),o=t("../lang/langMod");var s;r.addType("compiled",t=>{if(t.namespace&&t.url)return function(t){const e=t.namespace,n=t.url;return r.createCore().include(o).include({getNamespace:function(){return e},loadClasses:async function(t){console.log("Loading compiled classes ns=",e,"url=",n),await this.loadDependingClasses();const r=i.add({url:n});await r.exec(),console.log("Loaded compiled classes ns=",e,"url=",n)}})}(t);if(t.dir)return t=t,r.createDirBasedCore(t).include(o).include({loadClasses:async function(e){console.log("Loading compiled classes params=",t),await this.loadDependingClasses();const n=this.getOutputFile(),r=n.sibling(n.name()+".map"),o=i.add({text:n.text(),sourceMap:r.exists()&&r.text()});await o.exec(),console.log("Loaded compiled classes params=",t)}});throw console.error("Invalid compiled project",t),new Error("Invalid compiled project")}),n.create=(t=>r.create("compiled",t)),r.addDependencyResolver((t,e)=>e.dir&&t.resolve?r.create("compiled",{dir:t.resolve(e.dir)}):e.namespace&&e.url?r.create("compiled",e):void 0)},{"../lang/SourceFiles":10,"../lang/langMod":15,"../lib/root":23,"./ProjectFactory":25}],25:[function(t,e,n){const r=[],i={};n.addDependencyResolver=(t=>{r.push(t)}),n.addType=((t,e)=>{i[t]=e}),n.fromDependencySpec=function(t,e){if("string"==typeof e){var n=t.resolve(e);return this.fromDir(n)}for(let n of r){const r=n(t,e);if(r)return r}throw console.error("Invalid dep spec",e),new Error("Invalid dep spec",e)},n.create=function(t,e){if(!i[t])throw new Error(`Invalid type ${t}`);return i[t](e)};class o{getPublishedURL(){}getOptions(t){return{}}getName(){return this.dir.name().replace(/\\/$/,"")}getDependingProjects(){var t=this.getOptions();return(t.compiler&&t.compiler.dependingProjects||[]).map(t=>o.factory.fromDependencySpec(this,t))}include(t){for(let e of Object.getOwnPropertyNames(t))"function"==typeof t[e]&&(this[e]=t[e]);return this}delegate(t){if(t.constructor.prototype){const e=e=>{"function"==typeof t[e]&&(this[e]=((...n)=>t[e](...n)))};for(let n of Object.getOwnPropertyNames(t.constructor.prototype))e(n)}return this}}o.factory=n,n.createCore=(()=>new o);const s={getDir(){return this.dir},resolve(t){if(t instanceof Array){var e=[];return t.forEach(function(t){e.push(this.resolve(t))}),e}if("string"==typeof t)return"undefined"!=typeof FS?FS.resolve(t,this.getDir().path()):this.getDir().rel(t);if(!t||!t.isDir)throw new Error("Cannot TPR.resolve: "+t);return t},getOptions(t){return this.getOptionsFile().obj()},getOptionsFile(){return this.dir.rel("options.json")},setOptions(t){return this.getOptionsFile().obj(t)},getOutputFile(t){var e=this.getOptions(),n=this.resolve(e.compiler.outputFile||"js/concat.js");if(n.isDir())throw new Error("out: directory style not supported");return n},removeOutputFile(){this.getOutputFile().rm()},path(){return this.dir.path()},getEXT(){throw new Error("getEXT must be overriden.")},sourceFiles(){const t={},e=this.getEXT();return this.dir.recursive(function(n){if(n.endsWith(e)){var r=n.truncExt(e);t[r]=n}}),t}};n.createDirBasedCore=function(t){const e=this.createCore();return e.dir=t.dir,e.include(s)}},{}],26:[function(t,e,n){var r=function(t,e,n){let i;if("string"==typeof e)return t+=" at "+(i=r.calcRowCol(e,n)).row+":"+i.col,a(new Error(t),{isTError:!0,src:{path:function(){return"/"},name:function(){return"unknown"},text:function(){return e}},pos:n,row:i.row,col:i.col,raise:function(){throw this}});var o=null;if(e&&e.src&&(e=(o=e).src.tonyu),"function"!=typeof e.name||"function"!=typeof e.text)throw new Error("src="+e+" should be file object");const s=e.text();function a(t,e){for(var n in e)t[n]=e[n];return t}return i=r.calcRowCol(s,n),t+=" at "+e.name()+":"+i.row+":"+i.col,a(new Error(t),{isTError:!0,src:e,pos:n,row:i.row,col:i.col,klass:o,raise:function(){throw this}})};r.calcRowCol=function(t,e){var n,r,i=t.split("\\n"),o=0;for(n=0;n<i.length;n++)if((o+=i[n].length+1)>e){r=e-(o-i[n].length);break}return{row:n+1,col:r+1}},e.exports=r},{}],27:[function(t,e,n){var r=t("../lib/assert"),i=t("../lib/root"),o=t("./TonyuThread"),s=t("./tonyuIterator");e.exports=function(){i.performance||(i.performance={}),i.performance.now||(i.performance.now=function(){return Date.now()});var t,e,n={};function a(e){if(!t.onRuntimeError)throw i.alert&&i.alert("!   : "+e),console.log(e.stack),e;t.onRuntimeError(e)}function u(t,e){return r.is(arguments,[String,Object]),f(n.getMeta(t),e)}function c(t,e){return f(t?Object.create(t.prototype):{},e)}function f(t,e){if(e&&"object"==typeof e)for(var n in e)t[n]=e[n];return t}n.addMeta=u,n.removeMeta=function(t){delete h[t]},n.removeMetaAll=function(t){t+=".";for(let e in h)e.substring(0,t.length)===t&&delete h[e]},n.getMeta=function(t){if("function"==typeof t)return t.meta;if("string"==typeof t){var e=h[t];return e||(h[t]=e={}),e}},n.ensureNamespace=function(t,e){var n,r=e.split("."),i=t;for(n=0;n<r.length;n++){var o=r[n];i[o]||(i[o]={}),i=i[o]}return i},n.propReg=/^__([gs]et)ter__(.*)$/,n.define=function(e){var r=e.superclass,i=e.includes,o=e.fullName,s=e.shortName,a=e.namespace,l=e.methods,p=e.decls,h=n.ensureNamespace(t.classes,a);function d(t,e){if(!t.prototype.hasOwnProperty("getClassInfo"))throw new Error("NO");if(!t.meta)throw console.log("metanotfound",t),new Error("meta not found");return function t(e,n){if((n=n||{}).isShim)return e;if(n.path=n.path||[],n.path.push(e),e.isShim)throw console.log("chkmeta::ctx",n),new Error("Shim found "+e.extenderFullName);if(e.superclass&&t(e.superclass,n),!e.includes)throw console.log("chkmeta::ctx",n),new Error("includes not found");return e.includes.forEach(function(e){t(e,n)}),n.path.pop(),e}(t.meta,e),t}function g(t,e){var r=!e.init,h=e.includesRec;if(h[o])return t;h[o]=!0,i.forEach(function(n){t=n.extendFrom(t,f(e,{init:!1}))});var g,v="function"==typeof l?l(t):l,y=v.initialize;delete v.initialize,(g=y?function(){this instanceof g||m(o),y.apply(this,arguments)}:t?function(){this instanceof g||m(o),t.apply(this,arguments)}:function(){this instanceof g||m(o)}).prototype=c(t,{constructor:g}),g.meta=r?{isShim:!0,extenderFullName:o}:u(o,{fullName:o,shortName:s,namespace:a,decls:p,superclass:e.nonShimParent?e.nonShimParent.meta:null,includesRec:h,includes:i.map(function(t){return t.meta})}),g.meta.func=g,g.methods=v;var b,x=g.prototype,w={},S=n.propReg;for(b in v)if(!b.match(/^fiber\\$/)){x[b]=v[b];var E="fiber$"+b;if(v[E]&&(x[E]=v[E],x[E].methodInfo=x[E].methodInfo||{name:b,klass:g,fiber:!0},x[b].fiber=x[E]),"__dummy"!==b&&!x[b])throw console.log("WHY!",x[b],x,b),new Error("WHY!"+b);x[b].methodInfo=x[b].methodInfo||{name:b,klass:g};var _=S.exec(b);_&&(w[_[2]]=w[_[2]]||{},w[_[2]][_[1]]=x[b])}for(b in x.isTonyuObject=!0,w)Object.defineProperty(x,b,w[b]);return x.getClassInfo=function(){return g.meta},d(g,{isShim:r})}var v=g(r,{init:!0,initFullName:o,includesRec:r?f({},r.meta.includesRec):{},nonShimParent:r});return v.extendFrom=g,h[s]=v,v,d(v,{isShim:!1})},n.isSourceChanged=function(t){return!(!(t=t.meta||t).src||!t.src.tonyu)&&(!t.nodeTimestamp||t.src.tonyu.lastUpdate()>t.nodeTimestamp)},n.shouldCompile=function(t){if((t=t.meta||t).hasSemanticError)return!0;if(n.isSourceChanged(t))return!0;for(var e=n.getDependingClasses(t),r=0;r<e.length;r++)if(n.shouldCompile(e[r]))return!0},n.getDependingClasses=function(t){var e=[];return(t=t.meta||t).superclass&&(e=[t.superclass]),t.includes&&(e=e.concat(t.includes)),e};var l={},p={},h={};function d(t){var e,n=t.split("."),r=p;if(n.forEach(function(t){r&&(r=r[t])}),!r&&1==n.length)for(var i in p){var o=p[i][t];if(o){if(r)throw new Error(" "+i+"."+t+", "+e);r=o,e=i+"."+t}}return r}function m(t){throw new Error(""+t+"new")}var g=i.performance.now();function v(t){g=i.performance.now()+(t||0)}if(t={thread:function(){var t=new e;return t.handleEx=a,t},klass:n,bless:c,extend:f,globals:l,classes:p,classMetas:h,setGlobal:function(t,e){l[t]=e},getGlobal:function(t){return l[t]},getClass:d,timeout:function(t){return new Promise(function(e){setTimeout(e,t)})},bindFunc:function(e,n){if("function"!=typeof n)return n;var r=function(){return n.apply(e,arguments)};return r.methodInfo=t.extend({thiz:e},n.methodInfo||{}),n.fiber&&((r.fiber=function(){return n.fiber.apply(e,arguments)}).methodInfo=t.extend({thiz:e},n.fiber.methodInfo||{})),r},not_a_tonyu_object:function(t){throw console.log("Not a tonyu object: ",t),new Error(t+" is not a tonyu object")},is:function(t,e){return!!t&&(t instanceof e||!("function"!=typeof t.getClassInfo||!e.meta)&&t.getClassInfo().includesRec[e.meta.fullName])},hasKey:function(t,e){return t in e},invokeMethod:function(t,e,n,r){if(!t)throw new Error(r+"(="+t+") "+e+"");var i=t[e];if("function"!=typeof i)throw new Error(("this"==r?"":r+".")+e+"(="+i+")");return i.apply(t,n)},callFunc:function(t,e,n){if("function"!=typeof t)throw new Error(n+"");return t.apply({},e)},checkNonNull:function(t,e){if(t!=t||null==t)throw new Error(e+"(="+t+")");return t},iterator:s,run:function(e){var n=d(e);if(!n)throw new Error(e+" ");t.runMode=!0;var r=new n,i=t.globals.$currentProject||t.currentProject;i&&(i.runningObj=r)},checkLoop:function(){var t=i.performance.now();if(t-g>1e3)throw v(1e4),new Error("\\n    \\n   []https://edit.tonyu.jp/doc/options.html\\n");t},resetLoopCheck:v,VERSION:1560828115159,A:function(t){for(var e=[],n=1;n<t.length;n++)e[n-1]=t[n];return e},ID:Math.random()},e=o(t),i.Tonyu)throw console.error("Tonyu called twice!"),new Error("Tonyu called twice!");return i.Tonyu=t,t}()},{"../lib/assert":22,"../lib/root":23,"./TonyuThread":28,"./tonyuIterator":29}],28:[function(t,e,n){e.exports=function(t){var e=1;class n{constructor(){this.frame=null,this._isDead=!1,this.cnt=0,this._isWaiting=!1,this.fSuspended=!1,this.tryStack=[],this.preemptionTime=60,this.onEndHandlers=[],this.onTerminateHandlers=[],this.id=e++,this.age=0}isAlive(){return!this.isDead()}isDead(){return this._isDead=this._isDead||null==this.frame||this._threadGroup&&(this._threadGroup.objectPoolAge!=this.tGrpObjectPoolAge||this._threadGroup.isDeadThreadGroup()),this._isDead}setThreadGroup(t){this._threadGroup=t,this.tGrpObjectPoolAge=t.objectPoolAge}isWaiting(){return this._isWaiting}suspend(){this.fSuspended=!0,this.cnt=0}enter(t){this.frame={prev:this.frame,func:t}}apply(t,e,n){var r;if(n||(n=[]),"string"==typeof e&&!(r=t["fiber$"+e]))throw new Error(""+e+"");if("function"==typeof e&&!(r=e.fiber)){var i=e.methodInfo?e.methodInfo.name:e.name;throw new Error(""+i+"")}n=[this].concat(n);var o=0;return this.enter(function(e){switch(o){case 0:r.apply(t,n),o=1;break;case 1:e.termStatus="success",e.notifyEnd(e.retVal),n[0].exit(),o=2}})}notifyEnd(t){this.onEndHandlers.forEach(function(e){e(t)}),this.notifyTermination({status:"success",value:t})}notifyTermination(t){this.onTerminateHandlers.forEach(function(e){e(t)})}on(t,e){"end"!==t&&"success"!==t||this.onEndHandlers.push(e),"terminate"===t&&(this.onTerminateHandlers.push(e),this.handleEx&&delete this.handleEx)}promise(){var t=this;return new Promise(function(e,n){t.on("terminate",function(t){"success"===t.status?e(t.value):"exception"===t.status?n(t.exception):n(new Error(t.status))})})}then(t,e){return e?this.promise().then(t,e):this.promise().then(t)}fail(t){return this.promise().then(t=>t,t)}gotoCatch(t){var e=this;if(0==e.tryStack.length)return e.termStatus="exception",e.kill(),void(e.handleEx?e.handleEx(t):e.notifyTermination({status:"exception",exception:t}));e.lastEx=t;for(var n=e.tryStack.pop();e.frame;){if(n.frame===e.frame){e.catchPC=n.catchPC;break}e.frame=e.frame.prev}}startCatch(){var t=this.lastEx;return this.lastEx=null,t}exit(t){this.frame=this.frame?this.frame.prev:null,this.retVal=t}enterTry(t){this.tryStack.push({frame:this.frame,catchPC:t})}exitTry(){this.tryStack.pop()}waitEvent(t,e){var n,r=this;(r.suspend(),t.on)&&(e=e.concat(function(){r.lastEvent=arguments,r.retVal=arguments[0],n.remove(),r.steps()}),n=t.on.apply(t,e))}runAsync(t){var e=this,n=function(){e.retVal=arguments,e.steps()},r=function(){for(var t="",n=0;n<arguments.length;n++)t+=arguments[n]+",";0==t.length&&(t="Async fail");var r=new Error(t);r.args=arguments,e.gotoCatch(r),e.steps()};e.suspend(),setTimeout(function(){t(n,r)},0)}waitFor(t){var e=this;return e._isWaiting=!0,e.suspend(),t instanceof n&&(t=t.promise()),Promise.resolve(t).then(function(t){e.retVal=t,e.stepsLoop()}).then(t=>t,function(t){e.gotoCatch(e.wrapError(t)),e.stepsLoop()})}wrapError(t){if(t instanceof Error)return t;var e=new Error(t);return e.original=t,e}resume(t){this.retVal=t,this.steps()}steps(){var e=this;if(!e.isDead()){var n=t.currentThread;for(t.currentThread=e,e.cnt=e.preemptionTime,e.preempted=!1,e.fSuspended=!1;e.cnt>0&&e.frame;)try{for(;e.cnt-- >0&&e.frame;)e.frame.func(e);e.preempted=!e.fSuspended&&e.isAlive()}catch(t){e.gotoCatch(t)}t.currentThread=n}}stepsLoop(){var t=this;t.steps(),t.preempted&&setTimeout(function(){t.stepsLoop()},0)}kill(){var t=this;t._isDead=!0,t.frame=null,t.termStatus||(t.termStatus="killed",t.notifyTermination({status:"killed"}))}clearFrame(){this.frame=null,this.tryStack=[]}}return n}},{}],29:[function(t,e,n){class r{constructor(t){this.set=t,this.i=0}next(){return!(this.i>=this.set.length)&&(this[0]=this.set[this.i],this.i++,!0)}}class i{constructor(t){this.set=t,this.i=0}next(){return!(this.i>=this.set.length)&&(this[0]=this.i,this[1]=this.set[this.i],this.i++,!0)}}class o{constructor(t){for(var e in this.elems=[],t)this.elems.push(e);this.i=0}next(){return!(this.i>=this.elems.length)&&(this[0]=this.elems[this.i],this.i++,!0)}}class s{constructor(t){for(var e in this.elems=[],t)this.elems.push([e,t[e]]);this.i=0}next(){return!(this.i>=this.elems.length)&&(this[0]=this.elems[this.i][0],this[1]=this.elems[this.i][1],this.i++,!0)}}e.exports=function(t,e){if(t.tonyuIterator)return t.tonyuIterator(e);if(t instanceof Array)return 1==e?new r(t):new i(t);if(t instanceof Object)return 1==e?new o(t):new s(t);throw console.log(t),new Error(t+" is not iterable")}},{}]},{},[2]);'],{type:"text/javscript"});return URL.createObjectURL(t)})());
//# sourceMappingURL=runScript_concat.min.js.map