!function(){define("FS",[],function(){var t,e,n,r={},i=0;return r.def=function(t,e,n){var i=r.getModuleInfo(t);"function"==typeof e?(n=e,e=r.reqsFromFunc(n),r.setReqs(i,e),i.func=function(){var t={exports:{}};return n(r.doLoad,t,t.exports)||t.exports}):(r.setReqs(i,e),i.func=function(){return n.apply(this,r.getObjs(e))}),r.loadIfAvailable(i)},(t=function(t,e,n){r.def(t,e,n)}).amd={},e=function(t,e){r.def("REQJS_"+i++,t,e)},r.setReqs=function(t,e){e.forEach(function(e){var n=r.getModuleInfo(e);n.loaded||(t.reqs[e]=n,n.revReqs[t.name]=t)})},r.getModuleInfo=function(t){var e=r.modules;return e[t]=e[t]||{name:t,reqs:{},revReqs:{}}},r.doLoad=function(t){var e=r.getModuleInfo(t);if(e.loaded)return e.obj;e.loaded=!0;var n=e.func();for(var i in null!=n||t.match(/^REQJS_/)||console.log("Warning: No obj for "+t),e.obj=n,e.revReqs)r.notifyLoaded(e.revReqs[i],e.name);return n},r.notifyLoaded=function(t,e){delete t.reqs[e],r.loadIfAvailable(t)},r.loadIfAvailable=function(t){for(var e in t.reqs)return;r.doLoad(t.name)},r.getObjs=function(t){var e=[];return t.forEach(function(t){var n=r.doLoad(t);e.push(n)}),e},r.reqsFromFunc=function(t){var e=[];return(t+"").replace(/require\s*\(\s*["']([^"']+)["']\s*\)/g,function(t,n){e.push(n)}),e},r.modules={},t("extend",[],function(){return function(t,e){for(var n in e)t[n]=e[n];return t}}),t("assert",[],function(){var t,e=function(t){this.failMesg=i(t||"Assertion failed: ")};e.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var e=t(arguments),n=e.shift();if(e=i(e),e=this.failMesg.concat(n).concat(e),console.log.apply(console,e),this.isDefensive())return n;if(this.isBool())return!1;throw new Error(e.join(" "))},subAssertion:function(){var n=t(arguments);return n=i(n),new e(this.failMesg.concat(n))},assert:function(t,e){return t||this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):!!this.isBool()||t},ne:function(t,e){return t===e?this.fail(t,"===",e):!!this.isBool()||t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):!!this.isBool()||t},is:function(t,e){var n=e,r=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),!!this.isBool()||t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var i=0;i<n.length;i++){var o=this.subAssertion("failed at ",t,"[",i,"]: ");null==n[i]&&console.log("WOW!7",r[i],n[i]),o.is(r[i],n[i])}return!!this.isBool()||t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),!!this.isBool()||t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),!!this.isBool()||t;if(n===Boolean||"boolean"==n)return this.assert("boolean"==typeof r,[r,"should be a boolean"]),!!this.isBool()||t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),!!this.isBool()||t;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),!!this.isBool()||t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),!!this.isBool()||t;if(n&&"object"==typeof n){for(var s in n){(o=this.subAssertion("failed at ",t,".",s,":")).is(t[s],n[s])}return!!this.isBool()||t}if("string"==typeof n){var a=this._regedType[n];return a?this.is(t,a):!!this.isBool()||t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&r(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},t=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var n=new e,r=function(){try{return n.assert.apply(n,arguments)}catch(t){throw new Error(t.stack)}};function i(t){if(t instanceof Array){var e=[];return t.forEach(function(t){e=e.concat(i(t))}),e}return[t]}return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){r[t]=function(){try{return n[t].apply(n,arguments)}catch(t){throw console.log(t.stack),new Error(t.message)}}}),r.fail=n.fail.bind(n),r.MODE_STRICT=n.MODE_STRICT,r.MODE_DEFENSIVE=n.MODE_DEFENSIVE,r.MODE_BOOL=n.MODE_BOOL,r.f=function(t){return{_assert_func:t}},r.opt=function(t){return r.f(function(e){return null==e||e instanceof t})},r.and=function(){var e=t(arguments);return r(e instanceof Array),r.f(function(t){for(var n=0;n<e.length;n++)this.is(t,e[n])})},r}),t("PathUtil",["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}var n,r=/^([a-zA-Z]):/,i=/^([a-z\-]+):\/\/\/?([^\/]+)\//,o=t.f(function(t){this.is(t,String),this.assert(n.isPath(t),[t," is not a path"])}),s=t.f(function(t){this.is(t,String),this.assert(n.isAbsolutePath(t),[t," is not a absolute path"])}),a=t.f(function(t){this.is(t,String),this.assert(!n.isAbsolutePath(t),[t," is not a relative path"])}),u=t.f(function(t){this.is(t,o),this.assert(n.isDir(t),[t," is not a directory path"])}),c=t.and(u,s),f=t.f(function(t){this.is(t,o),this.assert(!n.isDir(t),[t," is not a file path"])});return n={Path:o,Absolute:s,Relative:a,Dir:u,File:f,AbsDir:c,SEP:"/",endsWith:e,startsWith:function(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n},isChildOf:function(t,e){return this.startsWith(this.normalize(t),this.normalize(e))},normalize:function(t){return this.fixSep(t,"/").replace(/\/+$/,"/")},hasDriveLetter:function(t){return r.exec(t)},isURL:function(t){var e=i.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:"/"+t.substring(e[0].length)}},isPath:function(e){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),n.isPath(e)&&!n.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),n.isPath(e)&&(n.startsWith(e,"/")||n.hasDriveLetter(e)||n.isURL(e))},isDir:function(r){return r=n.fixSep(r),t.is(arguments,[o]),e(r,"/")},hasBackslashSep:function(t){return t.indexOf("\\")>=0},fixSep:function(e,n){return n=n||"/",t.is(arguments,[String]),t.is(e.replace(/[\\\/]/g,n),o)},directorify:function(e){return n.isDir(e)?e:t.is(e+"/",u)},filify:function(e){return n.isDir(e)?t.is(e.substring(0,e.length-1),f):e},splitPath:function(e){var n;if(t.is(arguments,[o]),n=this.isURL(e)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}var i=(e=e.replace(/\/+/g,"/")).split("/");return""==i[i.length-1]&&(i[i.length-2]+="/",i.pop()),i},name:function(e){return t.is(arguments,[String]),n.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var r=n.name(e),i=/\.[a-zA-Z0-9]+$/.exec(r);return i?i[0]:null},truncExt:function(e,r){t.is(e,String);var i=n.name(e);return r=r||n.ext(e),t.is(r,String),i.substring(0,i.length-r.length)},truncSEP:function(e){return t.is(arguments,[o]),n.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(r,i){return t.is(arguments,[String,String]),e(n.name(r),i)},parent:function(e){return t.is(arguments,[String]),n.up(e)},rel:function(e,r){if(""==r)return e;t.is(arguments,[c,a]);var i=n.splitPath(r),o=e;o=o.replace(/\/$/,"");var s=n;return i.forEach(function(t){".."==t||"../"==t?o=s.up(o):(o=o.replace(/\/$/,""),o+="/"+("."==t||"./"==t?"":t))}),o},relPath:function(e,r){return t.is(arguments,[s,s]),e.substring(0,r.length)!=r?"../"+n.relPath(e,this.up(r)):e.substring(r.length)},up:function(t){if("/"==t)return null;var e=n.splitPath(t);return e.pop(),e.join("/")+"/"}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(t){var e=n[t];n[t]=function(){var t=!1,r=Array.prototype.slice.call(arguments).map(function(e){return n.hasBackslashSep(e)?(t=!0,n.fixSep(e)):e}),i=e.apply(n,r);return t?n.fixSep(i,"\\"):i}}),n.isAbsolute=n.isAbsolutePath,n.isRelative=n.isRelativePath,"object"==typeof window&&(window.PathUtil=n),n}),t("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".wav":"audio/x-wav",".mp3":"audio/mp3",".ogg":"audio/ogg",".midi":"audio/midi",".mid":"audio/midi",".mzo":"audio/mzo",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu",".c":"text/c",".dtl":"text/dolittle"}}),t("DeferredUtil",[],function(){var t,e="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:null,n=function(t){this.res=t};function r(t){return t}return(t={isNativePromise:function(t){return t&&"function"==typeof t.then&&"function"!=typeof t.promise&&"function"==typeof t.catch},isJQPromise:function(t){return t&&"function"==typeof t.then&&"function"==typeof t.promise&&"function"==typeof t.fail},isPromise:function(t){return t&&"function"==typeof t.then&&("function"==typeof t.promise||"function"==typeof t.catch)},all:function(e){return t.promise(function(n,r){var i=[],o=e.length;e.forEach(function(e,s){t.resolve(e).then(function(t){i[s]=t,0===--o&&n(i)},r)})})},resolve:function(e){return t.config.useJQ&&t.isJQPromise(e)?e:!t.config.useJQ&&t.isNativePromise(e)?e:t.promise(function(n,r){t.isPromise(e)?e.then(n,r):n(e)})},throwNowIfRejected:function(e){var n,r,i=e.then(function(t){return n||(n="resolved"),t},function(e){if(n)return t.reject(e);n="rejected",r=e});if(n||(n="notyet"),"rejected"===n)throw r;return i},assertResolved:function(t){var e,n;if(t.then(function(t){e=t,n=!0}),!n)throw new Error("Promise not resolved");return e},ensureDefer:function(e){return t.promise(function(n,i){var o;t.resolve(e).then(function(t){o?n(t):setTimeout(function(){n(t)},0)}).then(r,function(t){o?i(t):setTimeout(function(){i(t)},0)}),o=!0})},directPromise:function(e){return t.timeout(e,0)},then:function(e){return t.directPromise().then(e)},timeout:function(e,n){return t.promise(function(t){setTimeout(function(){t(n)},e||0)})},funcPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;try{e(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(t){n.reject(t)}return n.promise()}if(t.external.Promise)return new t.external.Promise(function(t,n){try{e(t,n)}catch(t){n(t)}});throw new Error("promise is not found")},reject:function(e){if(t.config.useJQ){var n=new $.Deferred;return n.reject(e),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(e)},0),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(e){return console.log(e,e.stack),t.throwPromise(e)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(r){return r>=e.length?t.brk():t.resolve(n(e[r],r)).then(function(){return r+1})},0);var r=[];for(var i in e)r.push({k:i,v:e[i]});return t.each(r,function(t){return n(t.k,t.v)})},loop:function(e,i){try{for(var o;;){if(i instanceof n)return t.when1(i.res);var s=!0,a=!1,u=e(i),c=t.resolve(u).then(function(r){return s=!1,(i=r)instanceof n?i.res:a?t.loop(e,i):void 0}).then(r,function(t){s=!1,o=t});if(o)throw o;if(a=!0,s)return c}}catch(e){return t.reject(e)}},brk:function(t){return new n(t)},tryLoop:function(e,n){return t.loop(t.tr(e),n)},tryEach:function(e,n){return t.loop(e,t.tr(n))},documentReady:function(){return t.callbackToPromise(function(t){$(t)})},requirejs:function(n){if(!e.requirejs)throw new Error("requirejs is not loaded");return t.callbackToPromise(function(t){e.requirejs(n,t)})}}).NOP=function(t){return t},t.E=function(){console.log("DUE",arguments),t.errorHandler.apply(t,arguments)},t.errorHandler=function(t){console.error.apply(console,arguments),alert(t)},t.setE=function(e){t.errorHandler=e},t.begin=t.try=t.tr=t.throwF,t.promise=t.callbackToPromise=t.funcPromise,t.when1=t.resolve,t.config={},e.$&&e.$.Deferred&&(t.config.useJQ=!0),t.external={Promise:e.Promise},e.DeferredUtil||(e.DeferredUtil=t),t}),t("FSClass",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(t,e,n,r,i){var o=function(){},s={};function a(t){throw new Error(t+" is STUB!")}return o.addFSType=function(t,e){s[t]=e},o.availFSTypes=function(){return s},t(o.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},isReadOnly:function(t,e){a("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(t,e){return r(this.getRootFS()!==this),this.getRootFS().resolveFS(t)},mounted:function(t,e){this.rootFS=t,this.mountPoint=e},inMyFS:function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},getRootFS:function(){return r(this.rootFS,"rootFS is not set")},getReturnTypes:function(t,e){a("")},getContent:function(t,e){a("getContent")},size:function(t){return this.getContent(t,{type:ArrayBuffer}).toBin().byteLength},getContentAsync:function(t,e){return this.supportsSync()||a("getContentAsync"),i.resolve(this.getContent.apply(this,arguments))},setContent:function(t,e,n){a("")},setContentAsync:function(t,e,n){var r=this;return r.supportsSync()||a("setContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.setContent(t,e,n))})},appendContent:function(t,e,n){a("")},appendContentAsync:function(t,e,n){var r=this;return r.supportsSync()||a("appendContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.appendContent(t,e,n))})},getMetaInfo:function(t,e){a("")},setMetaInfo:function(t,e,n){a("")},mkdir:function(t,e){a("mkdir")},touch:function(t){a("touch")},exists:function(t,e){a("exists")},opendir:function(t,e){a("opendir")},opendirAsync:function(t,e){return this.supportsSync()||a("opendirAsync"),i.resolve(this.opendir.apply(this,arguments))},cp:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),i=i||{};var o=this.isDir(t),s=this.getRootFS().resolveFS(n),a=s.isDir(n);if(o||a)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(t),c=s.setContent(n,u);return i.a&&s.setMetaInfo(n,this.getMetaInfo(t)),c}return s.setContentAsync(n,this.getContentAsync(t)).then(function(e){return i.a?s.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(t,e){a("")},link:function(t,e,n){throw new Error("ln "+e+" "+t+" : This FS not support link.")},getURL:function(t){a("")},onAddObserver:function(t){}}),o.delegateMethods=function(t,n){for(var i in n)!function(i){r.ne(i,"inMyFS"),t[i]=function(){var t=arguments[0];r.is(t,e.Absolute);var o=this.resolveFS(t);return o!==this?(console.log("Invoked for other fs",this.mountPoint,o.mountPoint),o[i].apply(o,arguments)):n[i].apply(this,arguments)}}(i)},o.delegateMethods(o.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},getContentType:function(t,r){var i=(e.ext(t)+"").toLowerCase();return n[i]||(r||{}).def||"application/octet-stream"},getBlob:function(t,e){var n=this.getContent(t);return(e=e||{}).blobType=e.blobType||Blob,e.binType=e.binType||ArrayBuffer,n.hasPlainText()?new e.blobType([n.toPlainText()],this.getContentType(t)):new e.blobType([n.toBin(e.binType)],this.getContentType(t))},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t,n){return e.isDir(t)},find:function(t,n){r.is(arguments,[e.Absolute]);var i=this.opendir(t,n),o=this,s=[t];return i.forEach(function(r){var i=e.rel(t,r);if(e.isDir(i)){var a=o.resolveFS(i);s=s.concat(a.find(i,n))}else s.push(i)}),s},resolveLink:function(t){r.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){r(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var o=e.rel(i,e.relPath(t,n));return r(o!=t,"np==path=="+o),r.is(this.getRootFS().resolveFS(o).resolveLink(o),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(t){return null},opendirEx:function(t,n){r.is(t,e.AbsDir);var i=this,o={};return this.opendir(t).forEach(function(n){var r=e.rel(t,n);o[n]=i.getMetaInfo(r)}),o},getDirTree:function(t,n){var i=(n=n||{}).dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],r.is(n.excludes,Array),n.base||(n.base=t),r.is(t,e.AbsDir);var o=this.opendirEx(t,n);if("no-recursive"==n.style)return o;var s=this;for(var a in o){var u=o[a],c=e.rel(t,a),f=e.relPath(c,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(f)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(c)>=0)continue}if(s.isDir(c))switch(n.style){case"flat-absolute":case"flat-relative":s.getDirTree(c,n);break;case"hierarchical":n.dest={},i[a]=s.getDirTree(c,n)}else switch(n.style){case"flat-absolute":i[c]=u;break;case"flat-relative":i[f]=u;break;case"hierarchical":i[a]=u}}return i}}),o}),t("Util",[],function(){return{getQueryString:function(t,e){null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n,r=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);return null==r?e:(n=r[1],decodeURIComponent(n.replace(/\+/g,"%20")))},endsWith:function(t,e){return t.substring(t.length-e.length)===e},startsWith:function(t,e){return t.substring(0,e.length)===e},privatize:function(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){return r.apply(t,arguments)})}(n);return e},extend:function(t,e){for(var n in e||{})t[n]=e[n];return t}}}),t("FileSaver",[],function(){var t="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:this;function e(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){i(r.response,e,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(t){var e=new XMLHttpRequest;return e.open("HEAD",t,!1),e.send(),e.status>=200&&e.status<=299}function r(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var i=t.saveAs||"object"!=typeof window||window!==t?function(){}:"download"in HTMLAnchorElement.prototype?function(i,o,s){var a=t.URL||t.webkitURL,u=document.createElement("a");o=o||i.name||"download",u.download=o,u.rel="noopener","string"==typeof i?(u.href=i,u.origin!==location.origin?n(u.href)?e(i,o,s):r(u,u.target="_blank"):r(u)):(u.href=a.createObjectURL(i),setTimeout(function(){a.revokeObjectURL(u.href)},4e4),setTimeout(function(){r(u)},0))}:"msSaveOrOpenBlob"in navigator?function(t,i,o){if(i=i||t.name||"download","string"==typeof t)if(n(t))e(t,i,o);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout(function(){r(s)})}else navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Depricated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t}(t,o),i)}:function(n,r,i,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof n)return e(n,r,i);var s="application/octet-stream"===n.type,a=/constructor/i.test(t.HTMLElement)||t.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||s&&a)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var t=c.result;t=u?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=t:location=t,o=null},c.readAsDataURL(n)}else{var f=t.URL||t.webkitURL,l=f.createObjectURL(n);o?o.location=l:location.href=l,o=null,setTimeout(function(){f.revokeObjectURL(l)},4e4)}};return t.saveAs=i.saveAs=i,"undefined"!=typeof module&&(module.exports=i),i}),t("Content",["assert","Util","FileSaver"],function(t,e,n){var r=function(){},i=e.extend;r.plainText=function(t,e){var n=new r;return n.contentType=e||"text/plain",n.plain=t,n},r.url=function(t){var e=new r;return e.url=t,e},r.buffer2ArrayBuffer=function(e){if(r.isBuffer(e)){var n=new Uint8Array(e),i=n.buffer;if(i instanceof ArrayBuffer)return i;var o=Array.prototype.slice.call(n);return t(new Uint8Array(o).buffer,"n2a: buf is not set")}return t(e,"n2a: a is not set")},r.arrayBuffer2Buffer=function(e){return e instanceof ArrayBuffer?new Buffer(new Uint8Array(e)):t(e,"a2n: a is not set")},r.bin=function(e,n){t(n,"contentType should be set");var i=new r;if(r.isNodeBuffer(e))i.bufType="node",i.nodeBuffer=e;else if(e instanceof ArrayBuffer)i.bufType="array2",i.arrayBuffer=e;else{if(!e||!r.isBuffer(e.buffer))throw new Error(e+" is not a bin");i.bufType="array1",i.arrayBuffer=e.buffer}return i.contentType=n,i},r.looksLikeDataURL=function(t){return t.match(/^data:/)},r.download=n;var o=r.prototype;o.toBin=function(t){if(t=t||(r.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return t===Buffer?this.nodeBuffer:this.arrayBuffer=r.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return t===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=r.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var e=new a(this.url,t);return this.setBuffer(e.buffer)}if(null!=this.plain)return this.setBuffer(r.str2utf8bytes(this.plain,t));throw new Error("No data")},o.setBuffer=function(e){return t(e,"b is not set"),r.isNodeBuffer(e)?this.nodeBuffer=e:this.arrayBuffer=e},o.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},o.toNodeBuffer=function(){return this.toBin(Buffer)},o.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=r.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var t=new a(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=t.url}throw new Error("No data")},o.toPlainText=function(){if(this.hasPlainText())return this.plain;if(this.url&&!this.hasBin()){var t=new a(this.url,ArrayBuffer);this.arrayBuffer=t.buffer}if(this.hasBin())return this.plain=r.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},o.hasURL=function(){return this.url},o.hasPlainText=function(){return null!=this.plain},o.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},o.hasNodeBuffer=function(){return this.nodeBuffer},o.hasArrayBuffer=function(){return this.arrayBuffer},o.toBlob=function(){return new Blob([this.toBin(ArrayBuffer)],{type:this.contentType})},o.download=function(t){r.download(this.toBlob(),t)},r.Base64_To_ArrayBuffer=function(t,e){var n=e||ArrayBuffer;t=t.replace(/[\n=]/g,"");var i=new Object;i[65]=0,i[66]=1,i[67]=2,i[68]=3,i[69]=4,i[70]=5,i[71]=6,i[72]=7,i[73]=8,i[74]=9,i[75]=10,i[76]=11,i[77]=12,i[78]=13,i[79]=14,i[80]=15,i[81]=16,i[82]=17,i[83]=18,i[84]=19,i[85]=20,i[86]=21,i[87]=22,i[88]=23,i[89]=24,i[90]=25,i[97]=26,i[98]=27,i[99]=28,i[100]=29,i[101]=30,i[102]=31,i[103]=32,i[104]=33,i[105]=34,i[106]=35,i[107]=36,i[108]=37,i[109]=38,i[110]=39,i[111]=40,i[112]=41,i[113]=42,i[114]=43,i[115]=44,i[116]=45,i[117]=46,i[118]=47,i[119]=48,i[120]=49,i[121]=50,i[122]=51,i[48]=52,i[49]=53,i[50]=54,i[51]=55,i[52]=56,i[53]=57,i[54]=58,i[55]=59,i[56]=60,i[57]=61,i[43]=62,i[47]=63;var o,s=t.length,a=0,u=0;if(!s)return new n(0);o=Math.floor(s/4*3),"="==t.charAt(s-1)&&(o-=1),"="==t.charAt(s-2)&&(o-=1);for(var c=new n(o),f=r.isNodeBuffer(c)?c:new Uint8Array(c),l=0,p=0;p<o&&(void 0===(u=i[t.charCodeAt(l)])&&h("Invalid letter: "+t.charCodeAt(l)),a=u<<2,l++,void 0===(u=i[t.charCodeAt(l)])&&h("Invalid letter: "+t.charCodeAt(l)),f[p]=a|u>>4&3,a=(15&u)<<4,l++,!(++p>=o))&&(void 0===(u=i[t.charCodeAt(l)])&&h("Invalid letter: "+t.charCodeAt(l)),f[p]=a|u>>2&15,a=(3&u)<<6,l++,!(++p>=o));)void 0===(u=i[t.charCodeAt(l)])&&h("Invalid letter: "+t.charCodeAt(l)),f[p]=a|u,l++,p++;function h(e){throw console.log(e),console.log(t,l),new Error(e)}return c},r.Base64_From_ArrayBuffer=function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,s=0,a=0;a<i&&(n+=e[(s=r[a])>>2],o=(3&s)<<4,!(++a>=i))&&(n+=e[o|(s=r[a])>>4],o=(15&s)<<2,!(++a>=i));)n+=e[o|(s=r[a])>>6],n+=e[63&s],a++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n},r.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},r.isNodeBuffer=function(t){return r.hasNodeBuffer()&&t instanceof Buffer},r.isBuffer=function(t){return t instanceof ArrayBuffer||r.isNodeBuffer(t)},r.utf8bytes2str=function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));return decodeURIComponent(e.join(""))},r.str2utf8bytes=function(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer};var s=r.hasNodeBuffer()?Buffer:ArrayBuffer,a=function(e,n){"string"==typeof e?(this.url=e,this.binType=n||s,this.dataURL2bin(e)):e&&r.isBuffer(e.buffer)?(this.buffer=e.buffer,t.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):r.isBuffer(e)?(this.buffer=e,t.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),t.fail("Invalid args: ",arguments))};return r.DataURL=a,i(a.prototype,{bin2dataURL:function(e,n){t(r.isBuffer(e)),t.is(n,String);var i=this.dataHeader(n),o=r.Base64_From_ArrayBuffer(e);return t.is(o,String),this.url=i+o},dataURL2bin:function(e){t.is(arguments,[String]);var n=/^data:([^;]+);base64,/i.exec(e);return t(n,["malformed dataURL:",e]),this.contentType=n[1],this.buffer=r.Base64_To_ArrayBuffer(e.substring(n[0].length),this.binType),t.is(this.buffer,this.binType)},dataHeader:function(e){return t.is(arguments,[String]),"data:"+e+";base64,"},toString:function(){return t.is(this.url,String)}}),r}),t("NativeFS",["FSClass","assert","PathUtil","extend","Content"],function(t,e,n,r,i){var o,s=e;try{(o=global.require("fs")).existsSync("test.txt")}catch(t){return function(){throw new Error("This system not support native FS")}}var a=function(t){t&&(e.is(t,n.AbsDir),this.rootPoint=t)},u=n.hasDriveLetter(process.cwd());a.available=!0;var c=n.SEP,f=a.prototype=new t;function l(t){return t}return f.toNativePath=function(t){return this.rootPoint?(e.is(t,n.Absolute),e(this.inMyFS(t),t+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(t,this.mountPoint||n.SEP))):t},f.arrayBuffer2Buffer=function(t){return t instanceof ArrayBuffer?new Buffer(new Uint8Array(t)):t},t.addFSType("NativeFS",function(t,e){return new a(e.r)}),a.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},a.prototype.inMyFS=function(t){return this.mountPoint?n.startsWith(t,this.mountPoint):!(!!u^!!n.hasDriveLetter(t))},t.delegateMethods(a.prototype,{getReturnTypes:function(t,e){return l(t),s.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,r){r=r||{},e.is(t,n.Absolute);var s=this.toNativePath(t);return this.assertExist(t),i.bin(o.readFileSync(s),this.getContentType(t))},size:function(t){var e=this.toNativePath(t);return o.statSync(e).size},setContent:function(t,r){e.is(arguments,[n.Absolute,i]);var s=n.up(t);s&&this.getRootFS().resolveFS(s).mkdir(s);var a=this.toNativePath(t);r.hasBin()||!r.hasPlainText()?o.writeFileSync(a,r.toNodeBuffer()):o.writeFileSync(a,r.toPlainText())},appendContent:function(t,r){e.is(arguments,[n.Absolute,i]);var s=n.up(t);s&&this.getRootFS().resolveFS(s).mkdir(s);var a=this.toNativePath(t);r.hasBin()||!r.hasPlainText()?o.appendFileSync(a,r.toNodeBuffer()):o.appendFileSync(a,r.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(t,e,n){l(t)},isReadOnly:function(t){return l(t),!1},stat:function(t){e.is(t,n.Absolute);var r=this.toNativePath(t);return o.statSync(r)},mkdir:function(t,e){if(e=e||{},s.is(arguments,[n.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var r=n.up(t);r&&this.getRootFS().resolveFS(r).mkdir(r);var i=this.toNativePath(t);return o.mkdirSync(i),this.assertExist(i)},opendir:function(t,e){s.is(arguments,[String]),e=e||{};var r=this.toNativePath(t),i=n.truncSEP(r),a=o.readdirSync(r);e.nosep||(a=a.map(function(t){return t+(o.statSync(i+c+t).isDirectory()?c:"")}));return s.is([].concat(a),Array)},rm:function(t,e){s.is(arguments,[n.Absolute]),e=e||{},this.assertExist(t);var r=this.toNativePath(t);return this.isDir(t)?o.rmdirSync(r):o.unlinkSync(r)},exists:function(t,e){e=e||{};var n=this.toNativePath(t);return o.existsSync(n)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():n.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&o.utimesSync(t,Date.now()/1e3,Date.now()/1e3)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")},onAddObserver:function(t,e){var i=this,s=i.getRootFS();e=e||{};var a=this.isDir(t),u=o.watch(t,e,function(e,o){var u,c=a?n.rel(t,o):t;u=i.exists(c)?r({eventType:e},i.getMetaInfo(c)):{eventType:e},s.notifyChanged(c,u)});return{remove:function(){u.close()}}}}),a}),t("LSFS",["FSClass","PathUtil","extend","assert","Util","Content"],function(t,e,n,r,i,o){var s=function(t,e){r(t," new LSFS fail: no storage"),this.storage=t,this.options=e||{},this.options.useDirCache&&(this.dirCache={})},a=e.isDir.bind(e),u=e.up.bind(e),c=e.endsWith.bind(e),f=e.Absolute,l=e.SEP;function p(){return(new Date).getTime()}return s.ramDisk=function(t){var n={};return n[e.SEP]="{}","useDirCache"in(t=t||{})||(t.useDirCache=!0),new s(n,t)},t.addFSType("localStorage",function(t,e){return new s(localStorage,e)}),t.addFSType("ram",function(t,e){return s.ramDisk(e)}),s.now=p,(s.prototype=new t).resolveKey=function(t){return r.is(t,e.Absolute),this.mountPoint?e.SEP+e.relPath(t,this.mountPoint):t},s.prototype.getItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},s.prototype.setItem=function(t,n){r.is(t,e.Absolute);var i=this.resolveKey(t);r(i.indexOf("..")<0),r(e.startsWith(i,e.SEP)),this.storage[i]=n},s.prototype.removeItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},s.prototype.itemExists=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return r(this.storage,"No storage"),n in this.storage},s.prototype.getDirInfo=function(t){if(r.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");if(c(t,l)||(t+=l),r(this.inMyFS(t)),this.dirCache&&this.dirCache[t])return this.dirCache[t];var n,i={};try{(n=this.getItem(t))&&(i=JSON.parse(n))}catch(e){console.log("dinfo err : ",t,n)}return this.dirCache&&(this.dirCache[t]=i),i},s.prototype.putDirInfo=function(t,n,i){if(r.is(arguments,[e.AbsDir,Object]),!a(t))throw new Error("Not a directory : "+t);r(this.inMyFS(t)),this.dirCache&&(this.dirCache[t]=n),this.setItem(t,JSON.stringify(n));var o=u(t);if(null!=o&&this.inMyFS(o)){var s=this.getDirInfo(o);this._touch(s,o,e.name(t),i)}},s.prototype._touch=function(t,i,o,s){r.is(arguments,[Object,String,String]),r(this.inMyFS(i));var a="change";t[o]||(a="create",t[o]={},s&&(t[o].trashed=!0)),s||delete t[o].trashed,t[o].lastUpdate=p();var u=n({eventType:a},t[o]);this.getRootFS().notifyChanged(e.rel(i,o),u),this.putDirInfo(i,t,s)},s.prototype.removeEntry=function(t,n,i){r.is(arguments,[Object,String,String]),t[i]&&(t[i]={lastUpdate:p(),trashed:!0},this.getRootFS().notifyChanged(e.rel(n,i),{eventType:"trash"}),this.putDirInfo(n,t,!0))},s.prototype.removeEntryWithoutTrash=function(t,n,i){r.is(arguments,[Object,String,String]),t[i]&&(delete t[i],this.getRootFS().notifyChanged(e.rel(n,i),{eventType:"delete"}),this.putDirInfo(n,t,!0))},s.prototype.isRAM=function(){return this.storage!==localStorage},s.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},s.getUsage=function(){var t=0;for(var e in localStorage)"string"==typeof localStorage[e]&&(t+=localStorage[e].length);return t},s.getCapacity=function(){var t=0,e="a",n="___checkls___",r=0,i=Math.pow(2,25);try{for(var o=0;o<10;o++)e+=e;for(var o in localStorage)o.substring(0,n.length)==n?delete localStorage[o]:"string"==typeof localStorage[o]&&(r+=localStorage[o].length);for(var s=r;a()&&e.length<i;)e+=e;for(;e.length>1024;)e=e.substring(e.length/2),a();return{using:s,max:r}}finally{for(o=0;o<t;o++)delete localStorage[n+o]}function a(){try{return localStorage[n+t]=e,t++,r+=e.length,!0}catch(e){return delete localStorage[n+t],!1}}},t.delegateMethods(s.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(t,e){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t,e){r.is(arguments,[f]),this.assertExist(t);var n=this.getItem(t);return o.looksLikeDataURL(n)?o.url(n):o.plainText(n)},setContent:function(t,e,n){r.is(arguments,[f,o]),this.assertWriteable(t);var i=null;e.hasPlainText()&&(i=e.toPlainText(),o.looksLikeDataURL(i)&&(i=null)),null!=i?this.setItem(t,i):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t,n){if(this.assertExist(t,{includeTrashed:!0}),r.is(arguments,[f]),t==e.SEP)return{};var i=r(e.up(t));if(!this.inMyFS(i))return{};var o=e.name(t);r.is(i,e.AbsDir);var s=this.getDirInfo(i);return r(s[o])},setMetaInfo:function(t,n,i){r.is(arguments,[String,Object]),this.assertWriteable(t);var o=r(e.up(t));if(this.inMyFS(o)){var s=this.getDirInfo(o),a=e.name(t);s[a]=n,this.putDirInfo(o,s,s[a].trashed)}},mkdir:function(t,e){r.is(arguments,[f]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){r.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),i=[];for(var o in n)r(n[o]),n[o].trashed&&!e.includeTrashed||i.push(o);return r.is(i,Array)},rm:function(t,n){r.is(arguments,[f]),n=n||{},this.assertWriteable(t);var i=e.up(t);if(null==i||!this.inMyFS(i))throw new Error(t+": cannot remove. It is root of this FS.");(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t))?(this.opendir(t).length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)):this.removeItem(t);var o=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(o,i,e.name(t)):this.removeEntry(o,i,e.name(t))},exists:function(t,n){r.is(arguments,[f]),n=n||{};var i=e.name(t),o=e.up(t);if(null==o||!this.inMyFS(o))return!0;var s=this.getDirInfo(o)[i];return s&&s.trashed&&this.itemExists(t)&&this.isDir(t),!s&&this.itemExists(t),s&&!s.trashed&&!s.link&&this.itemExists(t),s&&!n.includeTrashed&&(s=!s.trashed),!!s},link:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var o={};o.link=n,o.lastUpdate=p(),this.setMetaInfo(t,o),r(this.exists(t)),r(this.isLink(t))},isLink:function(t){return r.is(arguments,[e.Absolute]),this.exists(t)?r(this.getMetaInfo(t)).link:null},touch:function(t){r.is(arguments,[f]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?(this.dirCache&&(this.dirCache[t]={}),this.setItem(t,"{}")):this.setItem(t,""));var n=u(t);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,e.name(t),!1)}else r(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(t){return this.getContent(t).toURL()},opendirEx:function(t,n){r.is(t,e.AbsDir),n=n||{};var i={},o=this.getDirInfo(t);if(n.includeTrashed)return o;for(var s in o)o[s].trashed||(i[s]=o[s]);return i}}),s}),"undefined"!=typeof $&&$.ajaxTransport("+binary",function(t,e,n){if(window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob)))return{send:function(e,n){var r=new XMLHttpRequest,i=t.url,o=t.type,s=t.async||!0,a=t.responseType||"blob",u=t.data||null,c=t.username||null,f=t.password||null;for(var l in r.addEventListener("load",function(){var e={};e[t.dataType]=r.response,n(r.status,r.statusText,e,r.getAllResponseHeaders())}),r.open(o,i,s,c,f),e)r.setRequestHeader(l,e[l]);r.responseType=a,r.send(u)},abort:function(){n.abort()}}}),t("jquery.binarytransport",function(){}),t("WebFS",["FSClass","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(t,e,n,r,i){var o=function(){},s=o.prototype=new t;return t.addFSType("web",function(){return new o}),s.fstype=function(){return"Web"},s.supportsSync=function(){return!1},s.inMyFS=function(t){return i.isURL(t)},t.delegateMethods(s,{exists:function(){return!0},getContentAsync:function(t){var e=this;return n.promise(function(n,i){$.get(t,function(i){var o=new FileReader;o.addEventListener("loadend",function(){n(r.bin(o.result,e.getContentType(t)))}),o.readAsArrayBuffer(i)},"binary").fail(i)})},getURL:function(t){return t}}),o}),t("Env",["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=(n=(n=this.expand(n)).replace(/\/+/g,"/")).replace(/^[a-z][a-z]+:\//,function(t){return t+"/"}),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n}),t("SFile",["extend","assert","PathUtil","Util","Content","FSClass","FileSaver","DeferredUtil"],function(t,e,n,r,i,o,s,a){var u=function(t,r){e.is(r,n.Absolute),this._path=r,this.rootFS=t,this.fs=t.resolveFS(r),this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return u.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},u.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},getPolicy:function(t){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(t,i){var o;if(i=i||{},u.is(t))o=t;else{var s;e.is(t,n.Absolute);var a=i.policy||this.policy;if(a&&(s=a.topDir)&&(s.path&&(s=s.path()),!n.startsWith(t,s)))throw new Error(t+": cannot access. Restricted to "+s);(o=new u(this.rootFS,t)).policy=a}return o.policy?r.privatize(o):o},contains:function(t){return e(u.is(t),t+" shoud be a SFile object."),!!this.isDir()&&n.startsWith(t.path(),this.path())},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var r=t.path?t.path():t;return n.relPath(this.path(),e.is(r,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,t))},sibling:function(t){return this.up().rel(t)},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var t=this.metaInfo();return!!t&&t.trashed},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.act.fs.getMetaInfo(this.act.path,t)},setMetaInfo:function(t,e){return this.act.fs.setMetaInfo(this.act.path,t,e)},getDirTree:function(t){return this.act.fs.getDirTree(this.act.path,t)},assertExists:function(){e(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(t){var e=Array.prototype.slice.call(arguments);if("function"==typeof e[0]){var n=e.shift();return a.resolve(this.exists.apply(this,e)).then(n)}t=t||{};var r=this.fs.exists(this.path(),t);return r||t.noFollowLink?r:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(t){var e=this;return t=t||{},this.isLink()?a.resolve(this.fs.rm(this.path(),t)):(this.isDir()&&(t.recursive||t.r)?this.each(function(e){return e.rm(t)}):a.resolve()).then(function(){return e.act.fs.rm(e.act.path,t)})},removeWithoutTrash:function(t){(t=t||{}).noTrash=!0,this.rm(t)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(t){return"function"==typeof t?this.getText(t):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(t){if(e.is(t,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());var n=this.contentType({def:null});return null!==n&&!n.match(/^text/)&&i.looksLikeDataURL(t)?a.throwNowIfRejected(this.setContent(i.url(t))):a.throwNowIfRejected(this.setContent(i.plainText(t)))},appendText:function(t){return e.is(t,String),this.act.fs.appendContent(this.act.path,i.plainText(t))},getContent:function(t){return"function"==typeof t?this.act.fs.getContentAsync(this.act.path).then(t):this.act.fs.getContent(this.act.path)},setContent:function(t){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,t)},getText:function(t){if("function"==typeof t){return this.getContent(e).then(t)}return e(this.act.fs.getContent(this.act.path));function e(t){try{return t.toPlainText()}catch(e){return t.toURL()}}},getDataURL:function(t){return"function"==typeof t?this.getContent(function(t){return t.toURL()}):this.getContent().toURL()},setDataURL:function(t){return this.setContent(i.url(t))},dataURL:function(t){return"string"==typeof t?this.setDataURL(t):"function"==typeof t?this.getDataURL(t):this.getDataURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(t){return this.act.fs.getContentType(this.act.path,t)},bytes:function(t){return i.isBuffer(t)?this.setBytes(t):this.getBytes()},setBytes:function(t){return this.act.fs.setContent(this.act.path,i.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.act.fs.getContent(this.act.path).toBin(t.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(t){return t instanceof Array?this.text(t.join("\n")):"function"==typeof t?this.text(function(e){return t(e.replace(/\r/g,"").split("\n"))}):this.text().replace(/\r/g,"").split("\n")},obj:function(){if(0==arguments.length){var t=this.text();return t?JSON.parse(t):null}this.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,n){e(t&&t.isSFile(),t+" is not a file");var r=this,i=(n=n||{},r.isDir()),o=t.isDir();if(!i&&o&&(t=t.rel(r.name()),e(!t.isDir(),t+" is a directory."),o=!1),!i||o){if(i||o)return e(i&&o,"Both src and dst should be dir"),r.each(function(e){var r,i=t.rel(e.name());return n.progress&&(r=n.progress(i,{src:e,dst:i})),a.resolve(r).then(function(){return i.copyFrom(e,n)})});n.echo&&n.echo(r+" -> "+t);var s=this.act.fs.cp(this.act.path,t.getResolvedLinkPath(),n);return s=a.resolve(s),n.a?s.then(function(){return t.setMetaInfo(r.getMetaInfo())}):s}this.err("Cannot move dir "+r.path()+" to file "+t.path())},moveFrom:function(t,e){var n=this;return n.exists(function(r){return n.copyFrom(t,e).then(function(){return t.rm({recursive:!0})},function(t){if(!r)return n.exists(function(t){if(t)return n.rm({recursive:!0})}).then(function(){throw t});throw t})})},moveTo:function(t,e){return t.moveFrom(this,e)},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){return this.assertDir().listFilesAsync(e).then(function(e){return a.each(e,t)})},eachrev:function(t,e){return this.assertDir().listFilesAsync(e).then(function(e){return a.each(e.reverse(),t)})},recursive:function(t,e){var n=this.assertDir();return e=n.convertOptions(e),n.each(function(n){return n.isDir()?n.recursive(t,e):t(n)},e)},_listFiles:function(t,n){e(null==t||"object"==typeof t);var r,i=this.assertDir();this.path();return t=i.convertOptions(t),r||(r=t.order),n?this.act.fs.opendirAsync(this.act.path,t).then(o):o(this.act.fs.opendir(this.act.path,t));function o(e){for(var n=[],o=0;o<e.length;o++){var s=e[o],a=i.rel(s);t.excludesF(a)||n.push(a)}return"function"==typeof r&&n.sort&&n.sort(r),n}},listFilesAsync:function(t){return this._listFiles(t,!0)},listFiles:function(t){return this._listFiles(t,!1)},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir();return t?n.listFiles(t).map(function(t){return t.name()}):this.act.fs.opendir(this.act.path,t)},convertOptions:function(t){var i=r.extend({},t),o=(this.assertDir(),this.path()),s=i.excludes||{};if("function"==typeof s)i.excludesF=s;else if("object"==typeof s){if(s instanceof Array){var a={};s.forEach(function(t){n.startsWith(t,"/")?a[t]=1:a[o+t]=1}),s=a}i.excludesF=function(t){return s[t.path()]}}return e.is(i,{excludesF:Function})},mkdir:function(){return this.touch()},link:function(t,e){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,t.path(),e)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(t){return this.getFS().getRootFS().addObserver(this.path(),t)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},setBlob:function(t){var e=this;return a.promise(function(n,r){var i=new FileReader;i.addEventListener("loadend",function(){a.resolve(e.setBytes(i.result)).then(n)}),i.readAsArrayBuffer(t)})},size:function(t){if(!t){if(this.isDir()){var e=0;return this.each(function(t){e+=t.size()}),e}return this.act.fs.size(this.act.path)}},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use 'zip' instead.");s(this.getBlob(),this.name())},err:function(){var t=Array.prototype.slice.call(arguments);throw console.log.apply(console,t),new Error(t.join(""))},exportAsObject:function(t){var e=this,n={};return this.recursive(function(t){n[t.relPath(e)]=t.text()},t),{base:e.path(),data:n}},importFromObject:function(t,e){"string"==typeof t&&(t=JSON.parse(t));t=t.data;for(var n in t)this.rel(n).text(t[n])},watch:function(t,e){var n=function(){};"function"==typeof t&&(n=t),"function"==typeof e&&(n=e);var r=this.getFS().getRootFS();r.addObserver(this.path(),function(t,e){n(e.eventType,r.get(t),e)})}},Object.defineProperty(u.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),e.is(this._act,{fs:o,path:n.Absolute}),this._act)}}),u}),t("RootFS",["assert","FSClass","PathUtil","SFile"],function(t,e,n,r){var i=function(n){t.is(n,e),this.mount(null,n)},o=i.prototype,s={err:function(t,e){throw new Error(t+": "+e)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(e,r){t.is(arguments,[n.AbsDir]);var i=this.fstab();console.log(i);for(var o=0;o<i.length;o++)if(i[o].mountPoint==e)return i.splice(o,1),!0;return!1},availFSTypes:function(){return e.availFSTypes()},mount:function(n,r,i){"string"==typeof r&&(r=t(e.availFSTypes()[r],"fstype "+r+" is undefined.")(n,i||{}));t.is(r,e),r.mounted(this,n),this.fstab().unshift(r)},resolveFS:function(r,i){var o;return t.is(r,n.Absolute),this.fstab().forEach(function(t){o||t.inMyFS(r)&&(o=t)}),o||this.err(r,"Cannot resolve"),t.is(o,e)},get:function(e){return t.is(e,n.Absolute),new r(this.resolveFS(e),e)},addObserver:function(e,n,r){this.observers=this.observers||[];var i,o,s={};"string"==typeof e&&(i=e),"string"==typeof n&&(i=n),"string"==typeof r&&(i=r),"object"==typeof e&&(s=e),"object"==typeof n&&(s=n),"object"==typeof r&&(s=r),"function"==typeof e&&(o=e),"function"==typeof n&&(o=n),"function"==typeof r&&(o=r),t.is(i,String),t.is(o,Function);var a=this.resolveFS(i).onAddObserver(i,s),u=this.observers,c={path:i,handler:o,remove:function(){var t=u.indexOf(this);u.splice(t,1),a&&a.remove()}};return this.observers.push(c),c},notifyChanged:function(t,e){this.observers&&this.observers.forEach(function(r){n.isChildOf(t,r.path)&&r.handler(t,e)})},getRootFS:function(){return this}};for(var a in s)o[a]=s[a];return i}),t("zip",["SFile","FileSaver","Util","DeferredUtil"],function(t,e,n,r){var i={setJSZip:function(t){i.JSZip=t,r.external.Promise||(r.external.Promise=t.external.Promise)}};return"undefined"!=typeof JSZip&&i.setJSZip(JSZip),i.zip=function(e,n,o){t.is(n)||(o=n),o=o||{};var s=new i.JSZip;return function t(e,n){return n.each(function(n){var i=r.resolve();return o.progress&&(i=o.progress(n)),i.then(function(){return n.isDir()?t(e.folder(n.name().replace(/[\/\\]$/,"")),n):n.getContent(function(t){e.file(n.name(),t.toArrayBuffer())})})})}(s,e).then(function(){return r.resolve(s.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(r){if(t.is(n))return n.setBytes(r);saveAs(new Blob([r],{type:"application/zip"}),e.name().replace(/[\/\\]$/,"")+".zip")})},i.unzip=function(e,n,o){var s={};o=o||{},t.is(e)&&(e=e.getContent().toArrayBuffer()),o.onCheckFile||(o.onCheckFile=function(t){return o.overwrite?t:!t.exists()&&t});var a=new i.JSZip;return r.resolve(a.loadAsync(e)).then(function(){return r.each(a.files,function(e,i){var a,u;return r.resolve(i.async("arraybuffer")).then(function(t){if(a=t,u=n.rel(i.name),o.progress)return r.resolve(o.progress(u))}).then(function(){if(console.log("Inflating",i.name),!u.isDir()){var e={file:u,status:"uploaded"};s[u.path()]=e;var n=FS.Content.bin(a,u.contentType()),r=o.onCheckFile(u,n);return!1===r&&(e.status="cancelled",u=null),t.is(r)&&(u.path()!==r.path()&&(e.redirectedTo=r),u=r),u?u.setContent(n):void 0}})})}).then(function(){return console.log("unzip done",s),s})},i}),t("promise",[],function(){setTimeout;function t(t){return Boolean(t&&void 0!==t.length)}function e(){}function n(t){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],a(t,this)}function r(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,n._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void o(e.promise,t)}i(e.promise,r)}else(1===t._state?i:o)(e.promise,t._value)})):t._deferreds.push(e)}function i(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof n)return t._state=3,t._value=e,void s(t);if("function"==typeof r)return void a((i=r,u=e,function(){i.apply(u,arguments)}),t)}t._state=1,t._value=e,s(t)}catch(e){o(t,e)}var i,u}function o(t,e){t._state=2,t._value=e,s(t)}function s(t){2===t._state&&0===t._deferreds.length&&n._immediateFn(function(){t._handled||n._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)r(t,t._deferreds[e]);t._deferreds=null}function a(t,e){var n=!1;try{t(function(t){n||(n=!0,i(e,t))},function(t){n||(n=!0,o(e,t))})}catch(t){if(n)return;n=!0,o(e,t)}}return n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,n){var i=new this.constructor(e);return r(this,new function(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}(t,n,i)),i},n.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})},n.all=function(e){return new n(function(n,r){if(!t(e))return r(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return n([]);var o=i.length;function s(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var a=e.then;if("function"==typeof a)return void a.call(e,function(e){s(t,e)},r)}i[t]=e,0==--o&&n(i)}catch(t){r(t)}}for(var a=0;a<i.length;a++)s(a,i[a])})},n.resolve=function(t){return t&&"object"==typeof t&&t.constructor===n?t:new n(function(e){e(t)})},n.reject=function(t){return new n(function(e,n){n(t)})},n.race=function(e){return new n(function(r,i){if(!t(e))return i(new TypeError("Promise.race accepts an array"));for(var o=0,s=e.length;o<s;o++)n.resolve(e[o]).then(r,i)})},n._immediateFn=function(t){t()},n._unhandledRejectionFn=function(){"undefined"!=typeof console&&console},n}),t("FS",["FSClass","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil","promise"],function(t,e,n,r,i,o,s,a,u,c,f,l,p){var h,d={};d.assert=s,d.Content=c,d.Class=t,d.DeferredUtil=l,l.config.useJQ||(l.external.Promise=p),d.Env=o,d.LSFS=n,d.NativeFS=e,d.PathUtil=i,d.RootFS=u,d.SFile=a,d.WebFS=r,d.zip=f,"object"==typeof window&&(window.FS=d);var g=new o({});return d.addFSType=t.addFSType,d.availFSTypes=t.availFSTypes,d.setEnvProvider=function(t){g=t},d.getEnvProvider=function(){return g},d.setEnv=function(t,e){if("object"==typeof t)for(var n in t)g.set(n,t[n]);else g.set(t,e)},d.getEnv=function(t){return"string"==typeof t?g.get(t):g.value},d.init=function(t){h||(t||(e.available?t=new e:"object"==typeof localStorage?t=new n(localStorage):"function"==typeof importScripts&&(self.addEventListener("message",function(t){var e=t.data;switch("string"==typeof e&&(e=JSON.parse(e)),e.type){case"upload":d.get(e.base).importFromObject(e.data);break;case"observe":h.observe(e.path,function(t,e){self.postMessage(JSON.stringify({type:"changed",path:t,content:d.get(t).text(),meta:e}))})}}),t=n.ramDisk())),h=new u(t))},d.getRootFS=function(){return d.init(),h},d.get=function(){return d.init(),h.get.apply(h,arguments)},d.expandPath=function(){return g.expandPath.apply(g,arguments)},d.resolve=function(t,e){return d.init(),a.is(t)?t:(t=g.expandPath(t),e&&!i.isAbsolutePath(t)?(e=g.expandPath(e),d.get(e).rel(t)):d.get(t))},d.mount=function(){return d.init(),h.mount.apply(h,arguments)},d.unmount=function(){return d.init(),h.unmount.apply(h,arguments)},d.isFile=function(t){return a.is(t)},d}),e(["FS"],function(t){n=t}),"undefined"!=typeof window&&void 0===window.FS&&(window.FS=n),"undefined"!=typeof module&&(module=n),n}),define("HttpHelper",function(t){return function(){return t.HttpHelper}}(this)),Arrow={show:function(t){if("string"==typeof t&&(t=$(t)),0==t.length)return!1;if("t"!=$.data(t[0],"blinking")){$.data(t[0],"blinking","t");var e=3;n(),t.click(function(){i()})}function n(){t.addClass("tutorial-highlight"),setTimeout(r,200)}function r(){t.removeClass("tutorial-highlight"),e-- >0?setTimeout(n,200):i()}function i(){e=0,$.data(t[0],"blinking","f")}},showOld:function(t){if("string"==typeof t&&(t=$(t)),0==t.length)return!1;var e=t.offset(),n=$("<img>").attr({src:"images/arrow0.png"}).css({font:"40px",position:"absolute",left:e.left,top:e.top+t.height(),color:"red",zIndex:1e3,"z-index":1e3}).appendTo("body"),r=0;return setInterval(function(){n&&(n.attr({src:"images/arrow"+r+".png"}),r=(r+1)%4)},250),t.click(function(){n&&(n.remove(),n=null)}),!0}},define("Arrow",function(t){return function(){return t.Arrow}}(this)),Util=function(){function t(){return"undefined"!=typeof Buffer}function e(e){return t()&&e instanceof Buffer}return{getQueryString:function(t,e){null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n,r=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);return null==r?e:(n=r[1],decodeURIComponent(n.replace(/\+/g,"%20")))},endsWith:function(t,e){return t.substring(t.length-e.length)===e},startsWith:function(t,e){return t.substring(0,e.length)===e},Base64_To_ArrayBuffer:function(t){t=t.replace(/[\n=]/g,"");var e=new Object;e[65]=0,e[66]=1,e[67]=2,e[68]=3,e[69]=4,e[70]=5,e[71]=6,e[72]=7,e[73]=8,e[74]=9,e[75]=10,e[76]=11,e[77]=12,e[78]=13,e[79]=14,e[80]=15,e[81]=16,e[82]=17,e[83]=18,e[84]=19,e[85]=20,e[86]=21,e[87]=22,e[88]=23,e[89]=24,e[90]=25,e[97]=26,e[98]=27,e[99]=28,e[100]=29,e[101]=30,e[102]=31,e[103]=32,e[104]=33,e[105]=34,e[106]=35,e[107]=36,e[108]=37,e[109]=38,e[110]=39,e[111]=40,e[112]=41,e[113]=42,e[114]=43,e[115]=44,e[116]=45,e[117]=46,e[118]=47,e[119]=48,e[120]=49,e[121]=50,e[122]=51,e[48]=52,e[49]=53,e[50]=54,e[51]=55,e[52]=56,e[53]=57,e[54]=58,e[55]=59,e[56]=60,e[57]=61,e[43]=62,e[47]=63;var n,r=t.length,i=0,o=0;if(!r)return new ArrayBuffer(0);n=Math.floor(r/4*3),"="==t.charAt(r-1)&&(n-=1),"="==t.charAt(r-2)&&(n-=1);for(var s=new ArrayBuffer(n),a=new Uint8Array(s),u=0,c=0;c<n&&(void 0===(o=e[t.charCodeAt(u)])&&f("Invalid letter: "+t.charCodeAt(u)),i=o<<2,u++,void 0===(o=e[t.charCodeAt(u)])&&f("Invalid letter: "+t.charCodeAt(u)),a[c]=i|o>>4&3,i=(15&o)<<4,u++,!(++c>=n))&&(void 0===(o=e[t.charCodeAt(u)])&&f("Invalid letter: "+t.charCodeAt(u)),a[c]=i|o>>2&15,i=(3&o)<<6,u++,!(++c>=n));)void 0===(o=e[t.charCodeAt(u)])&&f("Invalid letter: "+t.charCodeAt(u)),a[c]=i|o,u++,c++;function f(e){throw console.log(e),console.log(t,u),new Error(e)}return s},Base64_From_ArrayBuffer:function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,s=0,a=0;a<i&&(n+=e[(s=r[a])>>2],o=(3&s)<<4,!(++a>=i))&&(n+=e[o|(s=r[a])>>4],o=(15&s)<<2,!(++a>=i));)n+=e[o|(s=r[a])>>6],n+=e[63&s],a++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n},utf8bytes2str:function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(t){throw console.log(e.join("")),t}},str2utf8bytes:function(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer},privatize:function(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){return r.apply(t,arguments)})}(n);return e},hasNodeBuffer:t,isNodeBuffer:e,isBuffer:function(t){return t instanceof ArrayBuffer||e(t)}}}(),define("Util",function(t){return function(){return t.Util}}(this)),define("Platform",[],function(){var t={},e=window.navigator.userAgent.toLowerCase();return t.tablet=-1!=e.indexOf("windows")&&-1!=e.indexOf("touch")||-1!=e.indexOf("ipad")||-1!=e.indexOf("android")&&-1==e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("tablet")||-1!=e.indexOf("kindle")||-1!=e.indexOf("silk")||-1!=e.indexOf("playbook"),t.mobile=-1!=e.indexOf("windows")&&-1!=e.indexOf("phone")||-1!=e.indexOf("iphone")||-1!=e.indexOf("ipod")||-1!=e.indexOf("android")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("blackberry"),t}),define("WebSite",["FS","Platform"],function(t,e){var n,r,i=t.PathUtil,o=document.location.href,s=!!o.match(/html\/dev\//)&&!!o.match(/localhost:3/),a=location.protocol;switch(a.match(/^http/)||(a="https:"),window.WebSite_runType){case"IDE":return(n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile}).builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/inputPad.png":1,"images/neko.png":1,"images/mapchip.png":1},n.pluginTop||(n.pluginTop=n.top+"/js/plugins"),n.sampleImg=n.top+"/images",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.mp4Disabled=n.isNW,n.tonyuHome="/Tonyu/",n.PathSep="/",n.isNW?(n.noconcat=!0,n.PathSep=require("path").sep,n.cwd=i.directorify(process.cwd().replace(/\\/g,"/")),process.env.TONYU_HOME?n.tonyuHome=i.directorify(process.env.TONYU_HOME):n.tonyuHome=i.rel(n.cwd,"fs/Tonyu/"),n.logdir=process.env.TONYU_LOGDIR,n.wwwDir=i.rel(n.cwd,"www/"),n.platform=process.platform,n.ffmpeg=i.rel(n.cwd,"win32"==n.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),n.pkgInfo=require(i.rel(n.cwd,"package.json")),process.env.TONYU_PROJECTS?n.projects=process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):n.pkgInfo&&n.pkgInfo.config&&n.pkgInfo.config.prjDirs?n.projects=n.pkgInfo.config.prjDirs.map(function(t){return t=i.directorify(t),i.isAbsolute(t)?t:i.rel(n.cwd,t)}):n.projects=[i.rel(n.cwd,"Projects/"),i.rel(n.tonyuHome,"Projects/")],n.kernelDir=i.rel(n.wwwDir,"Kernel/")):(o.match(/edit\.tonyu\.jp\/n\//)?n.wwwDir=a+"//"+location.host+"/n/":n.wwwDir=a+"//"+location.host+"/",n.projects=[i.rel(n.tonyuHome,"Projects/")]),n.kernelDir=i.rel(n.wwwDir,"Kernel/"),n.compiledKernel="Kernel/js/concat.js",o.match(/localhost\/tonyu2/)?(n.wwwDir=a+"//"+location.host+"/tonyu2/",n.kernelDir=n.wwwDir+"Kernel/",n.compiledKernel=n.kernelDir+"js/concat.js",n.uploadTmpUrl=a+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",n.newVersionUrl=a+"//localhost/tsite/tonyu/project/newVersion.cgi",n.scriptServer="https://localhost/tonyu2/"):(n.uploadTmpUrl=a+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",n.newVersionUrl=a+"//www.tonyu.jp/project/newVersion.cgi",n.scriptServer="https://edit.tonyu.jp/"),n.version=2,n.hoge="fuga",t.setEnvProvider(new t.Env(n)),window.WebSite=n,n;case"singleHTML":if(n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},"object"==typeof BuiltinAssets)for(r in BuiltinAssets)n.urlAliases[r]=BuiltinAssets[r];return n.tonyuHome="/Tonyu/",n.projects=[i.rel(n.tonyuHome,"Projects/")],o.match(/localhost\/tonyu2/)?n.scriptServer="http://localhost/tonyu2/":n.scriptServer="https://edit.tonyu.jp/",n.pluginTop=n.scriptServer+"js/plugins",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.PathSep="/",n.compiledKernel=n.scriptServer+"Kernel/js/concat.js",t.setEnvProvider(new t.Env(n)),window.WebSite=n,n;case"multiHTML":return(n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile}).tonyuHome="/Tonyu/",n.pluginTop=n.top+"/js/plugins",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.PathSep="/",n.mp4Disabled=n.isNW,n.isNW&&(n.PathSep=require("path").sep,n.cwd=i.directorify(process.cwd().replace(/\\/g,"/")),n.platform=process.platform),t.setEnvProvider(new t.Env(n)),window.WebSite=n,n}if(o.match(/jsrun\.it/))n={urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png"},top:"",devMode:s,pluginTop:"https://edit.tonyu.jp/js/plugins",removeJSOutput:!0};else if(o.match(/tonyuexe\.appspot\.com/)||o.match(/localhost:8887/)||o.match(/\/html\/((dev)|(build))\//))n={urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/sound_ogg.png":"../../images/sound_ogg.png","images/sound_mp3.png":"../../images/sound_mp3.png","images/sound_mp4.png":"../../images/sound_mp4.png","images/sound_m4a.png":"../../images/sound_m4a.png","images/sound_mid.png":"../../images/sound_mid.png","images/sound_wav.png":"../../images/sound_wav.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:s};else if(o.match(/bitarrow/)||o.match(/localhost.*pub/)){var u=n={};n.serverType="BA",u.runtime="../../../runtime/",u.urlAliases={"images/base.png":u.runtime+"images/base.png","images/Sample.png":u.runtime+"images/Sample.png","images/neko.png":u.runtime+"images/neko.png","images/mapchip.png":u.runtime+"images/mapchip.png","images/sound.png":u.runtime+"images/sound.png","images/sound_ogg.png":u.runtime+"images/sound_ogg.png","images/sound_mp3.png":u.runtime+"images/sound_mp3.png","images/sound_mp4.png":u.runtime+"images/sound_mp4.png","images/sound_m4a.png":u.runtime+"images/sound_m4a.png","images/sound_mid.png":u.runtime+"images/sound_mid.png","images/sound_wav.png":u.runtime+"images/sound_wav.png","images/ecl.png":u.runtime+"images/ecl.png"}}else n={urlAliases:{},top:".",devMode:s};if("object"==typeof BuiltinAssets)for(r in BuiltinAssets)n.urlAliases[r]=BuiltinAssets[r];n.builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/neko.png":1,"images/mapchip.png":1};var c=window.navigator.userAgent.toLowerCase();return n.tablet=-1!=c.indexOf("windows")&&-1!=c.indexOf("touch")||-1!=c.indexOf("ipad")||-1!=c.indexOf("android")&&-1==c.indexOf("mobile")||-1!=c.indexOf("firefox")&&-1!=c.indexOf("tablet")||-1!=c.indexOf("kindle")||-1!=c.indexOf("silk")||-1!=c.indexOf("playbook"),n.mobile=-1!=c.indexOf("windows")&&-1!=c.indexOf("phone")||-1!=c.indexOf("iphone")||-1!=c.indexOf("ipod")||-1!=c.indexOf("android")&&-1!=c.indexOf("mobile")||-1!=c.indexOf("firefox")&&-1!=c.indexOf("mobile")||-1!=c.indexOf("blackberry"),n.pluginTop||(n.pluginTop=n.top+"/js/plugins"),n.disableROM={},(o.match(/\.appspot\.com/)||o.match(/localhost:888[87]/))&&(n.serverType="GAE"),o.match(/localhost:3000/)&&(n.serverType="Node"),o.match(/tonyuexe\.appspot\.com/)||o.match(/localhost:8887/)?n.serverTop=n.top+"/exe":n.serverTop=n.top+"/edit",n.sampleImg=n.top+"/images",n.blobPath=n.serverTop+"/serveBlob",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.mp4Disabled=n.isNW,n.tonyuHome="/Tonyu/",n.url={getDirInfo:n.serverTop+"/getDirInfo",getFiles:n.serverTop+"/File2LSSync",putFiles:n.serverTop+"/LS2FileSync"},n.PathSep="/",n.isNW?(n.PathSep=require("path").sep,n.cwd=i.directorify(process.cwd().replace(/\\/g,"/")),process.env.TONYU_HOME?n.tonyuHome=i.directorify(process.env.TONYU_HOME):n.tonyuHome=i.rel(n.cwd,"fs/Tonyu/"),n.logdir=process.env.TONYU_LOGDIR,n.wwwDir=i.rel(n.cwd,"www/"),n.platform=process.platform,n.ffmpeg=i.rel(n.cwd,"win32"==n.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),n.pkgInfo=require(i.rel(n.cwd,"package.json")),process.env.TONYU_PROJECTS?n.projects=process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):n.pkgInfo&&n.pkgInfo.config&&n.pkgInfo.config.prjDirs?n.projects=n.pkgInfo.config.prjDirs.map(function(t){return t=i.directorify(t),i.isAbsolute(t)?t:i.rel(n.cwd,t)}):n.projects=[i.rel(n.cwd,"Projects/"),i.rel(n.tonyuHome,"Projects/")],n.kernelDir=i.rel(n.wwwDir,"Kernel/")):(n.wwwDir=a+"//"+location.host+"/",n.projects=[i.rel(n.tonyuHome,"Projects/")]),(o.match(/edit\.tonyu\.jp/)||o.match(/tonyuedit\.appspot\.com/)||o.match(/localhost:888/))&&(n.kernelDir=a+"//"+location.host+"/Kernel/"),o.match(/edit\.tonyu\.jp/)||o.match(/tonyuedit\.appspot\.com/)||o.match(/localhost:888/)||n.isNW?n.compiledKernel=n.kernelDir+"js/concat.js":"BA"===n.serverType?n.compiledKernel=n.runtime+"lib/tonyu/kernel.js":n.compiledKernel="https://edit.tonyu.jp/Kernel/js/concat.js",o.match(/localhost\/tonyu2/)?(n.wwwDir=a+"//"+location.host+"/tonyu2/",n.kernelDir=n.wwwDir+"Kernel/",n.compiledKernel=n.kernelDir+"js/concat.js",n.uploadTmpUrl=a+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",n.newVersionUrl=a+"//localhost/tsite/tonyu/project/newVersion.cgi"):(n.uploadTmpUrl=a+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",n.newVersionUrl=a+"//www.tonyu.jp/project/newVersion.cgi"),o.match(/((index)|(project))2/)&&(n.version=2,n.isNW?n.devMode=!0:n.devMode=!1),t.setEnvProvider(new t.Env(n)),window.WebSite=n,n}),define("assert",["FS"],function(t){return t.assert}),define("Shell",["FS","assert"],function(t,e){var n={},r=e(t.PathUtil);function i(e,i){var o=function(e){if("string"!=typeof e)return e;var i=n.cwd;return r.isAbsolutePath(e)?t.resolve(e,i):i.rel(e)}(e);if(t.SFile.is(o)||console.log(o," is not file"),i&&!o.exists())throw new Error(o+": no such file or directory");return o}return n.newCommand=function(t,e){this[t]=e},n.cd=function(t){return n.cwd=i(t,!0),n.pwd()},n.vars=Object.create(t.getEnv()),n.mount=function(e,n){if(e&&e.t)t.mount(n,e.t,e);else{var r=[];for(var i in t.getRootFS().availFSTypes())r.push(i);sh.err("-t=("+r.join("|")+") should be specified.")}},n.unmount=function(e){t.unmount(e)},n.fstab=function(){var e=this;t.getRootFS().fstab().forEach(function(t){e.echo(t.fstype()+"\t"+(t.mountPoint||"<Default>"))})},n.resolve=i,n.pwd=function(){return n.cwd+""},n.ls=function(t){return(t=t?i(t,!0):n.cwd).ls()},n.cp=function(t,e,r){r||(r={}),r.v&&(n.echo("cp",t,e),r.echo=n.echo.bind(n));var o=i(t,!0),s=i(e);return o.copyTo(s,r)},n.ln=function(t,e,n){var r=i(e),o=i(t,!0);if(r.isDir()&&r.exists()&&(r=r.rel(o.name())),r.exists())throw new Error(r+" exists");return r.link(o,n)},n.rm=function(t,e){if(e||(e={}),e.notrash)return(t=i(t,!1)).removeWithoutTrash(),1;if((t=i(t,!0)).isDir()&&e.r){var r=t,o=0;return r.each(function(t){t.exists()&&(o+=n.rm(t,e))}),r.rm(),o+1}return t.rm(),1},n.mkdir=function(t,e){if((t=i(t,!1)).exists())throw new Error(t+" : exists");return t.mkdir()},n.cat=function(t,e){return t=i(t,!0),n.echo(t.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}))},n.resolve=function(t){return t||(t="."),t=i(t)},n.grep=function(t,e,r){return e=i(e,!0),r||(r={}),r.res||(r.res=[]),e.isDir()?e.each(function(e){n.grep(t,e,r)}):"string"==typeof t&&e.lines().forEach(function(i,o){i.indexOf(t)>=0&&function(t,e,i){r.res&&r.res.push({file:t,lineNo:e,line:i});n.echo(t+"("+e+"): "+i)}(e,o+1,i)}),r.res},n.touch=function(t){return(t=i(t)).text(t.exists()?t.text():""),1},n.setout=function(t){n.outUI=t},n.echo=function(){return $.when.apply($,arguments).then(function(){console.log.apply(console,arguments),n.outUI&&n.outUI.log&&n.outUI.log.apply(n.outUI,arguments)})},n.err=function(t){console.log.apply(console,arguments),t&&t.stack&&console.log(t.stack),n.outUI&&n.outUI.err&&n.outUI.err.apply(n.outUI,arguments)},n.clone=function(){var t=Object.create(this);return t.vars=Object.create(this.vars),t},n.getvar=function(t){return this.vars[t]||process&&process.env[t]},n.get=n.getvar,n.set=function(t,e){return this.vars[t]=e},n.strcat=function(){if(1==arguments.length)return arguments[0];for(var t="",e=0;e<arguments.length;e++)t+=arguments[e];return t},n.exists=function(t){return(t=this.resolve(t)).exists()},n.dl=function(t){return(t=this.resolve(t||".")).download()},n.zip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.zip.apply(t.zip,n)},n.unzip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.unzip.apply(t.zip,n)},n.prompt=function(){},n.ASYNC={r:"SH_ASYNC"},n.help=function(){for(var t in n){var e=n[t];"function"==typeof e&&n.echo(t+(e.description?" - "+e.description:""))}},window.sh||(window.sh=n),"object"==typeof process?(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()},sh.cd(process.cwd().replace(/\\/g,"/"))):sh.cd("/"),n}),define("Log",["FS","WebSite","Shell"],function(t,e,n){var r={},i=e.logdir?t.resolve("${logdir}"):null,o=i&&i.exists();function s(t,e){return(t="00000000000000"+t).substring(t.length-e)}if(r.todayDir=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();return i.rel(e+"/").rel(n+"/").rel(r+"/")},r.curFile=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate();return r.todayDir().rel(e+"-"+n+"-"+i+".log")},r.curProject=function(){var t=new Date,e=t.getHours(),n=t.getMinutes(),i=t.getSeconds();return r.todayDir().rel("Project/").rel(s(e,2)+"_"+s(n,2)+"_"+s(i,2)+"/")},r.dumpProject=function(t){if(o){var e=r.curProject();n.cp(t,e),r.append("Dumped project to "+e.path())}},!e.logging&&!e.isNW){var a=t.get("/var/log/");a.exists()&&a.fs.storage===localStorage&&a.removeWithoutTrash({r:!0})}function u(t){return t.replace(/\n/g,"\n|")}return r.append=function(t){if(o){var e=r.curFile(),n=e.exists()?e.text():"";e.text(n+t+"\n")}},r.d=function(t,e){r.append(new Date+": ["+t+"]"+u(e))},r.e=function(t,e){r.append(new Date+": ERROR["+t+"]"+u(e))},r}),define("exceptionCatcher",[],function(){var t={f:function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(e){t.handleException(e)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var r in e)e[r]=t.f(e[r]);return e}}};return t}),define("UI",["Util","exceptionCatcher"],function(t,e){var n={},r=e.f;return(n=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var o=[],s={},a=[],u=c(e);return u.$edits=a,u.$vars=s,$.data(u,"edits",a),$.data(u,"vars",s),a.load=function(t){a.model=t,a.forEach(function(t){a.writeToJq(t.params.$edit,t.jq)}),a.validator.on.validate.call(a.validator,a.model)},a.writeToJq=function(t,e){var n=a.model;if(n){for(var r=t.name.split("."),i=0;i<r.length;i++)n=n[r[i]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},a.validator={errors:{},show:function(){if(s.validationMessage)for(var t in s.validationMessage.empty(),this.errors)s.validationMessage.append(n("div",this.errors[t].mesg));if(s.OKButton){var e=!0;for(var t in this.errors)e=!1;s.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},a.writeToModel=function(t,e,n){var r=a.model;if(r){var i=t.name;try{e=t.type.fromVal(e)}catch(t){return void a.validator.addError(i,t,n)}a.validator.removeError(i);for(var o=i.split("."),s=0;s<o.length;s++)s==o.length-1?a.on.writeToModel(i,e)||(r[o[s]]=e):r=r[o[s]];a.validator.on.validate.call(a.validator,a.model)}},a.on={},a.on.writeToModel=function(t,e){},o.length>0&&setTimeout(r(function t(){o.forEach(function(t){t()});setTimeout(r(t),50)}),50),u;function c(e){return e instanceof Array?function(e){var i=e[0],u=1,f=$("<"+i+">");"object"!=typeof e[u]||e[u]instanceof Array||e[u]instanceof $||(!function(e,i,u){i.$var&&(s[i.$var]=e);i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(t){a.writeToModel(i.$edit,t,e)}),s[i.$edit.name]||(s[i.$edit.name]=e),a.push({jq:e,params:i}));for(var c in i)if("on"==c)for(var f in i.on)l(f,i.on[f]);else"css"==c&&null!=i[c]?e.css(i[c]):t.startsWith(c,"$")||null==i[c]||e.attr(c,i[c]);function l(t,n){if(n)if("enterkey"==t)e.on("keypress",r(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var s,a=!0;o.push(function(){var t;t="checkbox"==i.type?!!e.prop("checked"):e.val(),(a||s!=t)&&(n.apply(e,[t,s]),s=t),a=!1})}else e.on(t,r(n))}}(f,e[u]),u++);for(;u<e.length;)f.append(c(e[u])),u++;return f}(e):"string"==typeof e?(i=e,$(document.createTextNode(i))):e;var i}}).types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),define("Wiki",["HttpHelper","Arrow","Util","WebSite","Log","UI","FS"],function(t,e,n,r,i,o,s){return Wiki=function(n,a,u,c){var f,l,p,h={},d={figures:"図",plists:"リスト"},g="line_marker_",v={},m=[];if(u||(u={}),a&&!a.isDir())throw a+": not a dir";return h.on=v,h.cd=function(t){l=(f=t).rel("toc.json")},a&&h.cd(a),h.encodeURL=function(t){return encodeURI(t).replace(/%/g,"")},h.parse=function(n,i,a){var c={},f=t({lineMark:g});c.out=f,c.name=i,c.lines=n.split(/\r?\n/),c.lineNo=0,c.ul=0,c.beginMark="[[",c.endMark="]]",c.blocks=[];var p=D("figures"),v=D("plists"),m=[];l&&l.exists()&&(m=l.obj());var y=m.indexOf(i);if(y>=0){var b="",w=m[y-1];w&&(b+="[[前へ>"+w+"]]");var x=m[y+1];x&&(b+=" - [[次へ>"+x+"]]");var S=m[0];0!=y&&(b+=" - [[目次>"+S+"]]"),c.lines.unshift(b),c.lines.push(b)}function D(t){c[t]={};var e=1;return function(n,r){var i=c[t][n];return i||(i={refs:[]},c[t][n]=i),r&&(i.no=e++,i.name=d[t]+i.no,i.refs.forEach(function(t){t.text(i.name)})),i}}return c.lines.forEach(function(t){function e(t){for(null==t&&(t=0);c.ul>t;)c.ul--,f.exit()}f.lineNo=c.lineNo;var n=0;t.match(/^-+/)&&(n=RegExp.lastMatch.length);if(n>c.ul)for(;n>c.ul;)c.ul++,f.enter("<ul>");else e(n);t=t.substring(n),n>0&&f.enter("<li>");if(t.match(/^\*+/)){var r=RegExp.rightContext,i="h"+RegExp.lastMatch.length;f.enter("<"+i+">"),T(r),f.exit()}else if(t.match(/^$/))e(),f.p($("<p>"));else if(t.match(/^<<toc(.*)/))c.toc=[c.name],c.blocks.push({name:"toc",exit:function(){l&&!l.isReadOnly()&&l.obj(c.toc),c.toc=null}});else if(t.match(/^<<code(.*)/)){var o=RegExp.$1;if((o=o.replace(/^ */,"")).length>0){var s,a,u=o.split(/ /,2);if(2==u.length){a=u[0],s=u[1];var p=v(s,!0);f.p($("<div>").addClass("plist").text(p.name+" "+a))}else f.p($("<div>").addClass("plist").text(u))}f.enter("<pre>"),c.blocks.push({name:"code",exit:function(){f.exit()}})}else if(t.match(/^>>/)){var h=c.blocks.pop();h&&h.exit&&h.exit(c)}else if(t.match(/^@@@@(.*)/)){if(c.pclose)f.exit();else{if(RegExp.$1.length>0){var p=v(RegExp.$1,!0);f.p($("<div>").addClass("plist").text(p.name))}f.enter("<pre>")}c.pclose=!c.pclose}else T(t),f.p("\n");n>0&&f.exit();c.lineNo++}),f.buf;function T(t){("string"==typeof t?function(t,e,n){var r=0;return function i(){var o=[];for(;;){var s=t.indexOf(e,r),a=t.indexOf(n,r);if(a>=0&&(s<0||s>a)){o.push(t.substring(r,a)),r=a;break}if(s<0){o.push(t.substring(r)),r=t.length;break}o.push(t.substring(r,s)),r=s+e.length;var u=i();u.hasBrace=!0,r<t.length&&(r+=n.length),o.push(u)}!function t(r){r.split=function(e,n){if(1==n)return this;var r=[],i=t([]);return this.forEach(function(o){if("string"==typeof o){var s=o.indexOf(e);if(r.length>=n&&(s=-1),s>=0){if(s>0){var a=o.substring(0,s);i.push(a)}if(s+=e.length,1!=i.length?r.push(i):r.push(i[0]),i=t([]),s<o.length){var a=o.substring(s);i.push(a)}}else i.push(o)}else i.push(o)}),1!=i.length?r.push(i):r.push(i[0]),r};r.text=function(t){var r=this.hasBrace&&t?e:"";return this.forEach(function(t){r+="string"==typeof t?t:t.text(!0)}),r+=this.hasBrace&&t?n:""};r.toString=function(){return this.text(!0)};return r}(o);return o}()}(t,c.beginMark,c.endMark):t).forEach(function(t){"string"==typeof t?f.p(t):function(t){var n,i=t.text();if(i.match(/^@blink ([^>]+)>([^\s]+)/)){caption=RegExp.$1;var l=RegExp.$2;n=$("<span>").addClass("clickable").text(caption).hover(function(){var t;parent&&parent.Arrow&&(t=parent.Arrow),e&&(t=e),t&&t.show(l)})}else if(i.match(/^@plistref (.*)/)){var g=RegExp.$1,m=v(g);n=$("<strong>").text(m.name),m.refs.push(n)}else if(i.match(/^@editadd/))f.p($("<img>").attr("src",r.top+"/images/editAdd.png"));else if(i.match(/^@figref (.*)/)){var m=p(RegExp.$1);n=$("<strong>").text(m.name),m.refs.push(n)}else if(i.match(/^@cfrag (.*)/)){var y=RegExp.$1;n=$("<code>"),f.enter(n),T(y),f.exit()}else if(i.match(/^@arg (.*)/)){var b=RegExp.$1;n=$("<i>"),f.enter(n),T(b),f.exit()}else{var w=t.split(">",2);if(2==w.length?(i=w[1]+"",caption=w[0]):caption=i,c.toc&&c.toc.push(i),i.match(/\.(png|jpg|gif)$/)&&!i.match(/^http/)){var m=p(i,!0);n=$("<div>").addClass("figure").append(function(t){var e,n;if(h.builtinImages[t])return $("<div>").append($("<img>").attr("src",r.top+"/doc/images/"+t));e=o("div",{style:"margin:10px; padding:10px; border:solid black 1px;",on:{dragover:a,dragenter:a,drop:function(t){if(!u.editMode)return;var r=t.originalEvent.dataTransfer.files[0];if(!r.type.match(/image\/(png|gif|jpg)/)[1])return t.stopPropagation(),t.preventDefault(),!1;var i=new FileReader;return i.onload=function(t){var r=i.result;n.text(r),e.empty().append(o("img",{src:r}))},i.readAsDataURL(r),t.stopPropagation(),t.preventDefault(),!1}}},"ここに画像ファイル(png/gif/jpg)をドラッグ＆ドロップして追加");var i=s.get(r.tonyuHome);return(n=i.rel("doc/images/").rel(t)).exists()&&e.empty().append(o("img",{src:n.text()})),e;function a(t){t.stopPropagation(),t.preventDefault()}}(i)),f.enter(n),f.enter($("<div>")),f.p(d.figures+m.no+"."),T(caption),f.exit(),f.exit()}else if(i.match(/^https?:\/\//))n=$("<a>").attr({href:i,target:"ext"}).text(caption);else{var x=h.resolveFile(i);if(x.exists()||!x.isReadOnly()&&u.editMode){if(u.useAnchor){var S=x.relPath(a.up()).replace(/\.txt$/,".html");S=h.encodeURL(S),n=$("<a>").attr({href:S}).text(caption)}else n=$("<span>").addClass("clickable").text(caption).click(function(){h.show(x)});x.exists()||n.addClass("notexist")}else n=$("<span>").text(caption)}}f.p(n)}(t)})}},h.resolveFile=function(t){return t.isDir?t:f&&"/"!=t.substring(0,1)?f.rel(t+".txt"):s.get(t)},h.show=function(t){var e=h.resolveFile(t);u.editMode||i.d("wiki","show "+e),h.cd(e.up());var r=e.truncExt(".txt");if(!e.exists()&&!e.isReadOnly()&&u.editMode){var o=m[m.length-1];o?e.text("[["+o.truncExt(".txt")+"]]\n"):e.text("")}if(e.exists()){var s=h.parse(e.text(),r,e);n.empty(),n.scrollTop(0),n.append(s),n.append($("<div>").css({height:"100px"}).text("")),v.show&&v.show.apply(h,[e,r]),m.push(e)}else alert(t+" というページはありません")},h.back=function(){var t=m.pop();t&&show(t)},h.highlightLine=function(t){var e=$("#"+g+"-"+t);if(0!=e.length){p&&p.removeClass("wiki-cur-line"),(p=e.next()).addClass("wiki-cur-line");var r=e.position().top,i=n;r<0&&i.scrollTop(i.scrollTop()+(r-10)/2);var o=i.height()-100;r>o&&i.scrollTop(i.scrollTop()+(r-o+10)/2)}},h.builtinImages={"50_100.png":1,"50_160.png":1,"50_300.png":1,"apple1apple2.png":1,"coords.png":1,"copy60_100.png":1,"firstRunRes.png":1,"firstVarRes.png":1,"itadaki.png":1,"noWaitCat.png":1,"runtimeError.png":1,"sample.png":1,"sayonara.png":1,"syntaxError.png":1},h}}),define("Shell2",["Shell","UI","FS","Util"],function(t,e,n,r){var i={show:function(t){i.embed(t).dialog({width:600,height:500})},embed:function(n){return i.d||(i.d=e("div",{title:"Shell"},["div",{$var:"inner"},"Type 'help' to show commands.",["br"]]),i.inner=i.d.$vars.inner,t.prompt()),i.d}};t.cls=function(){i.d.$vars.inner.empty()},t.prompt=function(){var n=e("div",["input",{$var:"cmd",size:40,on:{keydown:function(n){if(9==n.which)return n.stopPropagation(),n.preventDefault(),function(){var e=o.val().split(" "),n=e.pop(),i=[];if(0==e.length)for(var s in t)"function"==typeof t[s]&&r.startsWith(s,n)&&i.push(s);else{var u=t.resolve(n,!1);if(!u)return;var c=u.isDir()?u:u.up();c.each(function(t){r.startsWith(t.path(),u.path())&&i.push(t.name())})}if(1==i.length){var f=n.split("/");f.pop(),f.push(i[0]),e.push(f.join("/")),o.val(e.join(" ")),a.empty()}else a.text(i.join(", "))}(),!1;13==n.which&&(a.empty(),function(){var n=o.val().replace(/^ */,"").replace(/ *$/,"");if(0==n.length)return;var r=n.split(/ +/),i=r.shift(),a=t[i];if("function"!=typeof a)return s.append(i+": command not found.");try{var u=[],c=null;r.forEach(function(t){var e=/^-([A-Za-z_0-9]+)(=(.*))?/.exec(t);e?(c||(c={}),c[e[1]]=null!=e[3]?e[3]:1):(c&&u.push(c),c=null,u.push(t))}),c&&u.push(c);var f=a.apply(t,u);if(f===t.ASYNC)return;if("object"==typeof f)if(f instanceof Array){var l=e("table"),p=null,h=0;f.forEach(function(t){p||(p=e("tr").appendTo(l)),p.append(e("td",t)),++h%3==0&&(p=null)}),l.appendTo(s)}else s.append(JSON.stringify(f));else s.append(f);t.prompt()}catch(e){t.err(e),t.prompt()}}(o.val()))}}}],["pre",{$var:"out",class:"shell out"},["div",{$var:"cand",class:"shell cand"}]]),o=n.$vars.cmd,s=n.$vars.out,a=n.$vars.cand;return t.setout({log:function(){return $.when.apply($,arguments).then(function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);t[0]instanceof $?s.append(t[0]):s.append(e("span",t.join(" ")+"\n"))})},err:function(t){s.append(e("div",{class:"shell error"},t,["br"],["pre",t.stack]))}}),n.appendTo(i.inner),o.focus(),i.inner.closest(".ui-dialog-content").scrollTop(i.inner.height()),t.ASYNC},t.window=function(){i.show(t.cwd)},t.atest=function(t,e,n){console.log(t,e,n)};var o=t.cat;return t.cat=function(n,r){return(n=t.resolve(n,!0)).contentType().match(/^image\//)?n.getContent(function(n){t.echo(e("img",{src:n.toURL()}))}):o.apply(t,arguments)},i}),define("NewProjectDialog",["UI"],function(t){var e={show:function(t,n,r){e.embed(t,n,r).dialog({width:600})},embed:function(n,r,i){if(e.onOK=r,i||(i={}),!e.d){var o={fromVal:function(t){return""==t?null:FS.get(t)},toVal:function(t){return t?t.path():""}};e.d=t("div",{title:i.ren?"プロジェクト名の変更":"新規プロジェクト"},["div",["span","プロジェクト名"],["input",{$edit:"name",value:i.defName||"",on:{enterkey:function(){e.d.done()}}}]],["div",["span","親フォルダ"],["input",{$edit:{name:"parentDir",type:o}}]],["div",["span","作成先フォルダ："],["span",{$var:"dstDir"}]],["div",{$var:"validationMessage",css:{color:"red"}}],["button",{$var:"OKButton",on:{click:function(){e.d.done()}}},"OK"])}var s=e.d,a={name:i.defName||"",parentDir:n};return s.$edits.load(a),s.$edits.validator.on.validate=function(t){""!=t.name?(t.dstDir=t.parentDir.rel(t.name+"/"),t.dstDir.exists()?this.addError("name","このフォルダはすでに存在します"):(this.allOK(),s.$vars.dstDir.text(t.dstDir+""))):this.addError("name","名前を入力してください")},s.done=function(){s.$edits.validator.isValid()&&(e.onOK(a.dstDir),$.data(s[0],"ui-dialog")&&s.dialog("close"))},s}};return e}),define("requestFragment",["WebSite"],function(t){var e={ajax:function(e){var n=e.THRESH||8e5,r=e.data;if("object"!=typeof r)throw"Data should be object: "+r;if(r=JSON.stringify(r),!e.redirectTo&&("GAE"!=t.serverType||r.length<n))return $.ajax(e);for(var i=[],o=Math.random();r.length>0;)i.push(r.substring(0,n)),r=r.substring(n);var s=i.length,a=0,u=1e3;function c(t){return e.redirectTo&&(t.redirectTo=e.redirectTo),t}function f(){$.ajax({type:"post",url:t.serverTop+"/runFragments",data:c({id:o}),success:function(t){if("string"==typeof t&&t.match(/^notCompleted:([\-\d]+)\/([\-\d]+)$/))return console.log("notcomp",t),u*=2,void setTimeout(f,u);e.success(t)},error:e.error,complete:e.complete})}i.forEach(function(n,r){$.ajax({type:"post",url:t.serverTop+"/sendFragment",data:c({id:o,seq:r,len:s,content:n}),success:function(t){console.log("sendFrag",t,r),++a>=s&&setTimeout(f,u)},error:e.error})})}};return e}),define("Sync",["FS","Shell","requestFragment","WebSite"],function(t,e,n,r){var i={};function o(t){return t&&t.isDir}return e.sync=function(){var t,n,r,s=function(){},a=0;return("string"==typeof arguments[a]||o(arguments[a]))&&(t=e.resolve(arguments[a],!0),("string"==typeof arguments[++a]||o(arguments[a]))&&(n=e.resolve(arguments[a],!1),a++)),"object"==typeof arguments[a]&&(r=arguments[a],a++),"function"==typeof arguments[a]&&(s=arguments[a],a++),t||(n=t=e.cwd),r&&r.onend&&(r.onend=u(r.onend)),n||(n=t),e.echo("sync args=",t,n,r,s),i.sync(t,n,r,u(s)),e.ASYNC;function u(t){return function(){t&&t.apply({},arguments),e.prompt()}}},i.sync=function(){var t,i,s,a,u,c=0;if(o(arguments[c])&&(t=arguments[c],o(arguments[++c])&&(i=arguments[c],c++)),"object"==typeof arguments[c]&&(s=arguments[c],c++),"function"==typeof arguments[c]&&(a=arguments[c],c++),!t)throw"Sync.sync: Local dir must be specified as file object";i||(i=t),s||(s={}),!a&&s.onend&&(a=s.onend),s.test&&(s.v=1),h("getDirInfo",u={base:i.path(),excludes:JSON.stringify(s.excludes)}),$.ajax({type:"get",url:r.serverTop+"/getDirInfo",data:u,success:g,error:d});var f={},l=[],p={};function h(t,n){e.echo("Status: "+t+" param:",n),s.onstatus&&s.onstatus(t,n)}function d(){s.onerror&&s.onerror.apply(this,arguments)}function g(n){s.v&&e.echo("getDirInfo",n);var o=t,a=n.data;for(var u in a){var c=o.rel(u);y(c,u,c.exists({includeTrashed:!0})&&c.metaInfo(),a[u])}t.recursive(function(e){var n=e.exists({includeTrashed:!0})&&e.metaInfo(),r=e.relPath(t);y(e,r,n,a[r])},{includeTrashed:!0,excludes:s.excludes}),s.v&&(e.echo("uploads:",f),e.echo("downloads:",l));var p={base:i.path(),paths:JSON.stringify(l)};h("File2LSSync",p),$.ajax({type:"post",url:r.serverTop+"/File2LSSync",data:p,success:v,error:d})}function v(o){e.echo("dlData=",o),s.v&&e.echo("dlData:",o);var a=t;if(!s.test){for(var u in o.data){var c=a.rel(u),l=o.data[u];l.trashed?c.exists()&&c.rm():c.text(l.text),delete l.text,c.metaInfo(l)}var p={base:i.path(),data:JSON.stringify(f),pathInfo:"/LS2FileSync"};h("LS2FileSync",p),n.ajax({type:"post",url:r.serverTop+"/LS2FileSync",data:p,success:m,error:d})}}function m(t){s.v&&e.echo("LS2FileSync res=",t);var n=[];for(var r in f)n.push(r);t={msg:t,uploads:n,downloads:l},"function"==typeof a&&a(t)}function y(t,n,r,i){if(!p[n])if(p[n]=1,i&&(!r||r.lastUpdate<i.lastUpdate))l.push(n),s.v&&e.echo((r?"":"New")+"Download "+t+" trash="+!!i.trashed);else if(r&&(!i||r.lastUpdate>i.lastUpdate)){var o=r.trashed?{}:{text:t.text()},a=t.metaInfo();for(var u in a)o[u]=a[u];f[n]=o,s.v&&e.echo((i?"":"New")+"Upload "+t+" trash="+!!r.trashed)}}},e.rsh=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return $.ajax({url:r.serverTop+"/rsh",data:{args:JSON.stringify(t)},success:function(t){e.echo(t)},error:function(t,n,r){e.err(r)},complete:function(){e.prompt()}}),e.ASYNC},i}),define("Auth",["WebSite"],function(t){var e={currentUser:function(e){$.ajax({type:"get",url:t.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(t){console.log("auth.currentUser",t);var n=(t=JSON.parse(t)).user;"null"==n&&(n=null),console.log("user",n,"csrfToken",t.csrfToken),e(n,t.csrfToken)}})},assertLogin:function(n){e.currentUser(function(e,r){if(e)return n.success(e,r);window.onLoggedIn=n.success,n.showLoginLink(t.serverTop+"/login")})}};return window.Auth=e,e}),define("zip",["FS"],function(t){return t.zip}),define("PathUtil",["FS"],function(t){return t.PathUtil}),define("extLink",["WebSite","UI","PathUtil","Util","assert"],function(t,e,n,r,i){var o=t.isNW?require("child_process").exec:function(){};function s(t,n,r){var i=a(t,r=r||{});return e("a",i,n)}function a(e,n){var r=t.platform;(n=n||{}).on=n.on||{};var i=n.on&&n.on.click||function(){};return"win32"==r?(n.href="javascript:;",n.on.click=u("start",e,i)):"darwin"==r?(n.href="javascript:;",n.on.click=u("open",e,i)):(n.href=e,n.on.click=i,n.target="_new"),n}function u(t,e,n){return function(){o(t+" "+e),n&&n()}}return s.all=function(){t.isNW&&$("a").each(function(){location.protocol,location.host;var t=$(this),e=t.attr("href");if(e.match(/^http/)){var n=i.is(a(e),{href:String,on:{click:Function}});t.attr("href",n.href),t.click(n.on.click)}})},s}),define("DeferredUtil",["FS"],function(t){return t.DeferredUtil}),define("Klass",["assert"],function(t){var e={};function n(t){var e=/function[^\(]*\(([^\)]*)\)/.exec(t+"");return e?e[1].replace(/\s/g,"").split(","):[]}function r(t){if("object"!=typeof t)return!1;if(!t)return!1;var e={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},n=0;for(var r in t){if(!e[r])return!1;n+=e[r]}return n}return e.define=function(i){var o,s,a,u;i.$parent?(s=i.$parent,(o=Object.create(s.prototype)).super=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return s.prototype[e].apply(this,t)}):o={},i.$this&&(a=i.$this),i.$singleton&&(u=i.$singleton);var c,f,l,p,h=m(i.$)||function(t){if(t&&"object"==typeof t)for(var e in t)this[e]=t[e]};function d(e){i.$fields&&t.is(e,i.$fields)}for(var g in h instanceof Array&&(c=h,h=function(){for(var t=Array.prototype.slice.call(arguments),e=0;e<c.length;e++)t.length>0&&(this[c[e]]=t.shift())}),p=function(){if(!(this instanceof p)){var t=Object.create(o);return h.apply(t,arguments),d(t),t}h.apply(this,arguments),d(this)},s&&(p.super=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift();return s.prototype[n].apply(e,t)}),p.inherit=function(t){return t.$parent=p,e.define(t)},p.prototype=o,i)"$"!=g[0]&&("static$"==g.substring(0,7)?p[g.substring(7)]=v(i[g]):r(i[g])?Object.defineProperty(o,g,m(i[g])):o[g]=m(i[g]));function v(t){return u?n(t)[0]!==u?t:function(){var e=Array.prototype.slice.call(arguments);return e.unshift(p),t.apply(p,e)}:t}function m(t){if(!a)return t;if(r(t)){for(var e in t)t[e]=m(t[e]);return t}if("function"!=typeof t)return t;if(!0!==a){if(n(t)[0]!==a)return l=!0,t;f=!0}return!0,function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),t.apply(this,e)}}if(o.$=h,Object.defineProperty(o,"$bind",{get:function(){return this.__bounded||(this.__bounded=new e.Binder(this)),this.__bounded}}),f){l?console.warn("Use python style in all methods and Use $this:true instead"):console.warn("Use $this:true instead");try{throw new Error("Trace")}catch(t){console.log(t.stack)}}return p},e.Function=function(){throw new Error("Abstract")},e.opt=t.opt,e.Binder=e.define({$this:!0,$:function(t,e){function n(n){"function"==typeof e[n]&&(t[n]=function(){var t=Array.prototype.slice.call(arguments);return e[n].apply(e,t)})}for(var r in e)n(r)}}),e}),define("DragDrop",["FS"],function(t){var e=t.DeferredUtil,n=t.SFile;return DragDrop={},DragDrop.readFile=function(t){return e.promise(function(e){var n=new FileReader;n.onload=function(t){e(n)},n.readAsArrayBuffer(t)})},DragDrop.accept=function(t,r,i){(i=i||{}).draggingClass=i.draggingClass||"dragging",t.on("dragover",function(t){t.stopPropagation(),t.preventDefault()}),t.on("dragenter",function(e){e.originalEvent;o++,t.addClass(i.draggingClass)}),t.on("dragleave",function(e){var n=e.originalEvent;console.log("leave",n.target.innerHTML,e),--o<=0&&t.removeClass(i.draggingClass)}),t.on("drop",function(o){var s=r;"function"==typeof s&&(s=s());t.removeClass(i.draggingClass);var a={},u=o.originalEvent;o.stopPropagation(),o.preventDefault();var c=Array.prototype.slice.call(u.dataTransfer.files);c.length;return e.each(c,function(t){var r,o=t.name,u=s.rel(o);return e.resolve(i.onCheckFile(u,t)).then(function(e){if(!1!==e)return r=n.is(e)?e:u,DragDrop.readFile(t).then(function(t){var e=t.result;r.setBytes(e),a[u.path()]={file:u,status:"uploaded"},r.path()!==u.path()&&(a[u.path()].redirectedTo=r)});a[u.path()]={file:u,status:"cancelled"}})}).then(function(){i.onComplete&&i.onComplete(a)}).fail(function(t){i.onError(t)}),!1}),i.onCheckFile||(i.onCheckFile=function(t){return i.overwrite?t:!t.exists()&&t}),i.onError||(i.onError=function(t){console.error(t)});var o=0},DragDrop}),define("ZipImporter",["Klass","FS","Util","DragDrop","DeferredUtil","UI"],function(t,e,n,r,i,o){e.mount("/ram/","ram");e.zip;var s=e.get("/ram/");return t.define({$:function(t,e,n){var r=this;r.elem=e,r.dir=t,r.tmpDir=s.rel(t.name()),n=n||{},r.onComplete=n.onComplete,r.elem&&r.prepareDragDrop()},prepareDragDrop:function(){var t=this;r.accept(t.elem,t.tmpDir,{onComplete:function(e){t.showDialog();var n={imported:0,from:"dragDrop"};t.acceptDrag(e,n).then(function(){t.closeDialog(),t.onComplete&&t.onComplete(n)},function(e){t.closeDialog(),console.error(e),alert(e)})}})},acceptDrag:function(t,e){var n=this;return i.each(t,function(t,r){if("uploaded"===r.status&&".zip"===r.file.ext())return n.unzip(r.file,e)})},showDialog:function(t){var e=this;t=t||"ZIPからインポート中です...",e.dialog?e.mesg.text(t):(e.dialog=o("div",{title:"Zipからインポート"},["span",{$var:"mesg"},t]),e.mesg=e.dialog.$vars.mesg),e.dialogOpened||e.dialog.dialog({modal:!0}),e.dialogOpened=!0},closeDialog:function(){var t=this;t.dialog&&(t.dialog.dialog("close"),t.dialogOpened=!1)},unzip:function(t,n){var r=this;r.showDialog(t.name()+"を展開中...");var o=r.tmpDir.rel(t.truncExt()+"/"),s={progress:function(t){return r.showDialog(t.name()+"を展開中..."),i.timeout(0)}};return e.zip.unzip(t,o,s).then(function(){return n.rel&&!(o=o.rel(n.rel)).exists()?n:r.traverse(o,n)}).then(function(e){if("prjB"===e.from&&0===e.imported)throw new Error(t.name()+"にはTonyu2の編集可能なプロジェクトが含まれていません.")})},traverse:function(t,e){var n=this;return(e=e||{}).imported=e.imported||0,t.each(function(t){return n.showDialog(t.name()+"をチェック中..."),console.log("traverse",t.path()),t.isDir()?n.traverse(t,e):"options.json"===t.name()?(e.imported++,n.importFrom(t.up(),e)):void 0}).then(function(){return e})},importFrom:function(t,n){var r,i=this;if(n.dstDir)r=n.dstDir;else{var o=i.dir,s=e.PathUtil.truncSEP(t.name());"src"===s&&(s=e.PathUtil.truncSEP(t.up().name()));var a=s+"/";r=o.rel(a);for(var u=2;r.exists();)a=s+u+"/",u++,r=o.rel(a)}return i.showDialog(t.name()+"から"+r.name()+"にコピー"),console.log("importFrom",t.path(),"to",r.path()),t.copyTo(r).then(function(){if(i.prjID){var t=r.rel("options.json");if(t.exists()){var e=t.obj();e.info=e.info||{},e.info.prjID=i.prjID,t.obj(e)}}})},checkFromPrjB:function(){var t=this,r=n.getQueryString("fromPrjB"),i=n.getQueryString("prjID");if(t.prjID=i,console.log("checkFromPrjB",r),r){var o=t.dir.rel(r.replace(/\.zip$/i,"/"));if(o.exists())return console.log(o+" already exists "),0;e.mount("https://edit.tonyu.jp/","web");var s={from:"prjB",imported:0,dstDir:o,rel:"src/"};return t.fromPrjB(r,s).then(function(e){return t.closeDialog(),t.onComplete&&t.onComplete(s),e},function(e){t.closeDialog(),alert(e),console.error(e)})}},fromPrjB:function(t,n){var r=this,i=e.get("https://edit.tonyu.jp/cgi-bin/dl.cgi?file="+t),o=e.get("/ram/").rel(t);return r.showDialog("プロジェクトボードから"+t+"をダウンロード...."),i.copyTo(o).then(function(t){return r.unzip(o,n)})}})}),define("ProjectItem",["Klass","UI","FS","DeferredUtil","WebSite"],function(t,e,n,r,i){var o,s="javascript:;";return ProjectItem=o=t.define({$this:!0,$:function(t,e,r){var i=e,o=n.PathUtil.truncSEP(i.name());t.prjList=r,t.projectDir=e,t.name=o;var s=t.dom(i);t.u=s,s.appendTo(t.prjList),setTimeout(function(){var t=i.rel("images/").rel("icon_thumbnail.png");t.exists()&&s.$vars.t.attr("src",t.getURL())},10)},hide:function(t){t.u&&t.u.hide()},show:function(t){t.u&&t.u.show()},url:{get:function(t){var e=t.projectDir;return 2==i.version?"project2.html?dir="+e.path():"project.html?dir="+e.path()}},dom:function(t){var n=t.url,r=t.name;return e("div",{class:"project existentproject"},["a",{href:n,class:"projectLink"},["img",{width:100,$var:"t",src:i.top+"/images/nowprint.png"}]],["div",["a",{href:n,class:"projectLink projectName"},r],t.submenuExpr()])},submenuExpr:function(t){var e=t.projectDir;return["span",{class:"dropdown"},["button",{class:"submenu prjMenuButton",on:{click:t.$bind.openSubmenu},"data-path":e.path()}," "],["span",{class:"dropdown-content"},["a",{href:s,class:"submenu",on:{click:t.$bind.rename}},"名前変更"],["a",{href:s,class:"submenu",on:{click:t.$bind.download}},"ZIPダウンロード"],["a",{href:s,class:"submenu nwmenu",on:{click:t.$bind.openFolder}},"フォルダを開く"],["a",{href:s,class:"submenu",on:{click:t.$bind.remove}},"削除"]]]},download:function(t){return o.closeSubmenu(),n.zip.zip(t.projectDir).catch(r.E)},remove:function(t){o.closeSubmenu(),t.rmd||(t.rmd=e("div",{title:"プロジェクトの削除"},["div","プロジェクト",t.name,"を削除しますか？"],["div",["input",{$var:"dl",type:"checkbox",checked:!0}],["label",{for:"dl"},"削除前にZIPでダウンロードする"]],["div",["button",{on:{click:function(){return(t.rmd.$vars.dl.prop("checked")?t.download():r.resolve()).then(function(){t.projectDir.rm({r:1}),t.u.remove(),t.rmd.dialog("close")}).catch(r.E)}}},"はい"],["button",{on:{click:function(){t.rmd.dialog("close")}}},"いいえ"]])),t.rmd.$vars.dl.prop("checked",!0),t.rmd.dialog()},rename:function(t){o.closeSubmenu();var e=prompt("新しいプロジェクトの名前を入れてください",t.name);if(e&&""!=e){e=n.PathUtil.truncSEP(e);var i=t.projectDir.sibling(e+"/");return i.exists(function(n){if(!n)return t.projectDir.moveTo(i).then(function(){t.projectDir=i,t.name=i,t.u.find(".projectName").text(e),t.u.find(".projectLink").attr("href",t.url),o.closeSubmenu()}).catch(r.E);alert(e+" はすでに存在します")})}},openFolder:function(t){var e=require("nw.gui");process.execPath;e.Shell.showItemInFolder(t.projectDir.path().replace(/\//g,require("path").sep)),o.closeSubmenu()},openSubmenu:function(t){o.addMenuHandler(),o.closeSubmenu(),o.showingSubMenu=t.u.find(".dropdown-content"),o.showingSubMenu.addClass("show"),i.isNW||o.showingSubMenu.find(".nwmenu").hide()},static$closeSubmenu:function(){o.showingSubMenu&&(o.showingSubMenu.removeClass("show"),o.showingSubMenu=null)},static$addMenuHandler:function(){o.menuHandlerAdded||(o.menuHandlerAdded=!0,$("html").click(function(t){$(t.target).hasClass("submenu")||o.closeSubmenu()}))}}),o}),define("splashElement",["require","exports","module"],function(t,e,n){return"<div id='splash' style='position:relative; height: 100%;'>\n    \x3c!--ここに，ロード中に表示する内容を記述できます。--\x3e\n    \x3c!--You can write here what you want to show while loading. --\x3e\n    <div class='progress'>\n        \x3c!-- ここにロード中の進捗が表示されます．表示したくない場合はこのdiv要素を削除してください。 --\x3e\n        \x3c!-- This shows progress. If you don't want to show, remove this element. --\x3e\n    </div>\n    <div class='unsupported' style=\"display:none;\">\n        \x3c!-- ここに非対応ブラウザ向けメッセージが表示されます．表示したくない場合はこのdiv要素を削除してください。 --\x3e\n        \x3c!-- This shows message for unsupported browsers. If you don't want to show, remove this element. --\x3e\n        <p>お使いのブラウザではこのプログラムは動作しません．他のブラウザをお試しください．</p>\n        <p>The program does not run in this browser. Try another browser.</p>\n    </div>\n</div>\n\x3c!--\nOpen this site when editing this game:\nhttps://edit.tonyu.jp/index.html?importFromHTML=1\n--\x3e"}),define("exportAsScriptTags",["FS","Util","WebSite","splashElement"],function(t,e,n,r){return function(t,e){e=e||{},console.log("east options",e);var i=e.excludes||{},o=e.includeJSScript,s="<!DOCTYPE html>\n<html><head>\n";if(s+='<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>\n',s+="<script>WebSite_runType='singleHTML';<\/script>\n",o){var a=t.rel("res.json").obj(),u=n.scriptServer||"https://edit.tonyu.jp/";const r=u+"js/"+(e.IE?"gen":"g2")+"/";a.images.forEach(function(t){n.builtinAssetNames[t.url]&&(s+='<script src="'+u+t.url+'.js"><\/script>\n')}),s+='<script src="'+u+'js/lib/jquery-1.10.1.js" type="text/javascript"><\/script>\n',s+='<script src="'+r+'runScript_concat.min.js" type="text/javascript"><\/script>\n',e.IE||(s+=`<script src="${u}js/runtime/detectUnsupported.js"><\/script>`)}var c=[],f=[];return t.recursive(function(e){var n=e.relPath(t);if(!i[n])if(e.endsWith(".json")&&n.indexOf("maps/")<0)f.push(e);else if(!e.endsWith(".desktop")&&!e.endsWith(".js.map")&&!e.endsWith(".js"))if(e.endsWith(".tonyu")){var r=" data-lastupdate='"+e.lastUpdate()+"' ";s+="<script language='text/tonyu' type='text/tonyu' data-filename='"+n+"'"+r+">",s+=e.text().replace(/&(#?[\w\d]+;)/g,function(t,e){return"&amp;"+e}).replace(/<(\s*)\/(\s*)script(\s*)>/gi,function(t,e,n,r){return"&lt;"+e+"/"+n+"script"+r+"&gt;"}),s+="<\/script>\n\n"}else c.push(e)},{excludes:["files/"]}),f.forEach(function(e){var n=e.relPath(t),r=" data-lastupdate='"+e.lastUpdate()+"' ";s+="<script language='text/tonyu' type='text/tonyu' data-filename='"+n+"'"+r+">\n",s+=function(t){try{var e=JSON.parse(t);return JSON.stringify(e,null,4)}catch(e){return t}}(e.text()),s+="<\/script>\n\n"}),c.forEach(function(e){var n=e.relPath(t),r=" data-lastupdate='"+e.lastUpdate()+"' ";s+="<script language='text/tonyu' type='text/tonyu' data-filename='"+n+"' data-wrap='80'"+r+">",s+=function(t,e){var n="";return t.split("\n").forEach(function(t){for(;;){if(!(t.length>e)){n+=t+"\n";break}n+=t.substring(0,e)+"\\\n",t=t.substring(e)}return n}),n}(e.text(),80),s+="<\/script>\n\n"}),s+="</head><body>"+(e.splashElement||r)+"</body></html>"}}),define("Content",["FS"],function(t){return t.Content}),define("ScriptTagFS",["Content"],function(t){var e={};return e.toObj=function(){var t={};return $("script").each(function(){var e,n,r=this;if("text/tonyu"==r.type){var i=$(r).data("filename");if(i){var o=parseInt($(r).data("lastupdate")),s=$(r).data("wrap"),a=(e=r.innerHTML,(n=document.createElement("div")).innerHTML=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&#32;").replace(/\r/g,"&#13;").replace(/\n/g,"&#10;"),n.textContent||n.innerText);s?(s=parseInt(s),t[i]={lastUpdate:o,text:function(t,e){var n="";return t.split("\n").forEach(function(t){t.length>e?n+=t.substring(0,e):n+=t+"\n"}),n}(a,s)}):t[i]={lastUpdate:o,text:a}}}}),t},e.copyTo=function(n){var r=e.toObj();for(var i in r){var o=n.rel(i);o.isText()?o.text(r[i].text):o.setBytes(t.url(r[i].text).toByteArray())}},e}),define("ImportHTMLDialog",["exportAsScriptTags","UI","Klass","NewProjectDialog","ScriptTagFS"],function(t,e,n,r,i){return ImportHTMLDialog=n.define({$this:!0,show:function(t,e){t.createDOM(),t.dom.dialog({width:800,height:600}),t.mode("src")},createDOM:function(t){return t.dom?t.dom:(t.dom=e("div",{title:"HTMLからインポート"},["div",{$var:"src"},["div","ここにHTMLを貼り付けます"],["div",["button",{on:{click:t.$bind.selDir}},"Next->"]],["div",["textarea",{$var:"prog",rows:20,cols:60,placeholder:"Paste HTML Here"}]],["div",["button",{on:{click:t.$bind.selDir}},"Next->"]]],["div",{$var:"selDir"}],["div",{$var:"confirm"}],["div",{$var:"complete"}],["div",{$var:"files",css:{display:"none"}}]),t.vars=t.dom.$vars,t.dom)},selDir:function(t){t.vars.selDir.empty(),t.vars.selDir.append($("<h1>").text("インポート先のフォルダを入力してください")),t.vars.selDir.append(r.embed(t.prjDirs[0],t.$bind.confirm,{})),t.mode("selDir")},confirm:function(t,n){t.dst=n;var r="";t.vars.prog.val().split("\n").forEach(function(t){t.match(/<script[^>]*src[^>]*javascript/)||(r+=t+"\n")}),t.vars.files.html(r),t.mode("confirm"),t.vars.confirm.empty(),t.vars.confirm.append(e("div",["button",{on:{click:t.$bind.complete}},"インポート開始"]));var o=i.toObj();for(var s in o){var a=n.rel(s),u=a.exists()?"上書":"新規";t.vars.confirm.append(e("div","[",u,"]",a.path()))}},complete:function(t){var n=t.dst;t.mode("complete");var r=i.toObj();for(var o in r){n.rel(o).text(r[o].text)}t.vars.complete.empty(),t.vars.complete.append(e("h1","インポート完了")),t.dom.dialog("close"),t.onComplete()},mode:function(t,e){["src","selDir","confirm","complete"].forEach(function(e){t.vars[e].hide()}),t.vars[e].show()}}),ImportHTMLDialog}),requirejs(["FS","Wiki","Shell","Shell2","NewProjectDialog","UI","Sync","Auth","zip","requestFragment","WebSite","extLink","DeferredUtil","ZipImporter","ProjectItem","ImportHTMLDialog"],function(t,e,n,r,i,o,s,a,u,c,f,l,p,h,d,g){$(function(){var e="javascript_:;".replace(/_/,"");if(!t.NativeFS.available){var r=t.LSFS.getCapacity();$("#ls").text(Math.floor(r.max/1024)+"KB中"+Math.floor(r.using/1024)+"KB使用中。")}$.get("https://edit.tonyu.jp/doc/welcome_sel.html").then(function(t){$("#welcome").append(t)}),$("#prjItemList").empty();var s,a="",u="";$("#prjItemList").append(s=o("div",["input",{$var:"kw",placeholder:"Search..",value:u}])),setInterval(function(){(u=s.$vars.kw.val().toLowerCase())!=a&&($(".project").each(function(){var t=$(this),e=t.find(".projectName");""==u||e[0]&&e.text().toLowerCase().indexOf(u)>=0?t.show():t.hide()}),a=u)},1e3);var c,v=f.projects.map(function(e){return t.get(e)});function m(t,e){var n=[];return t.each(function(t){if(t.isDir()){var e=t.lastUpdate();n.push([t,e])}}),n=n.sort(function(t,e){return e[1]-t[1]}),p.each(n,function(t){var n=t[0];if(n.isDir()){var r=new d(n,e);return""!=u&&r.name.toLowerCase().indexOf(u)<0&&r.hide(),p.timeout(10)}})}v.forEach(function(t,n){if(!t.exists()){if(0!=n)return;t.mkdir()}var r,s=$("<section>");$("#prjItemList").append(s),s.append(o("h2",{class:"prjDirHeader"},t.path())),o("div",{class:"project newprj"},["a",{href:e,on:{click:function(){i.show(t,function(t){t.mkdir(),2==f.version?location.href="project2.html?dir="+t.path():location.href="project.html?dir="+t.path()})}}},["img",{$var:"t",src:f.top+"/images/tonew.png"}],["div","新規作成"]]).appendTo(s),r=o("div",{style:"display: inline-block;"},["button",{class:"showAll",on:{click:function(){r.remove(),function(t,e){var n=new h(t,e,{onComplete:function(n){"prjB"===n.from?location.href=location.href.replace(/\?.*/,""):(e.find(".existentproject").remove(),m(t,e))}});c||(c=!0,n.checkFromPrjB());m(t,e)}(t,s)}}},"すべて見る..."]),s.append(r)}),f.isNW&&$("#loginGrp").hide(),SplashScreen.hide();var y=new g({onComplete:function(){location.reload()},prjDirs:v});window.importFromHTML=function(){y.show()},Util.getQueryString("importFromHTML")&&y.show(),n.cd(t.get(f.projects[0])),l.all(),n.wikiEditor=function(){document.location.href="wikiEditor.html"},$($("button.showAll").get(0)).click()})}),define("selProject",function(){})}();
//# sourceMappingURL=selProject_concat.min.js.map