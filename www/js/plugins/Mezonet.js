!function(e,t){e.Mezonet=function(){var e,t,n;!function(r){function i(e,t){return S.call(e,t)}function o(e,t){var n,r,i,o,s,u,a,f,c,l,p,d,h=t&&t.split("/"),y=g.map,m=y&&y["*"]||{};if(e){for(e=e.split("/"),s=e.length-1,g.nodeIdCompat&&k.test(e[s])&&(e[s]=e[s].replace(k,"")),"."===e[0].charAt(0)&&h&&(d=h.slice(0,h.length-1),e=d.concat(e)),c=0;c<e.length;c++)if("."===(p=e[c]))e.splice(c,1),c-=1;else if(".."===p){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((h||m)&&y){for(n=e.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),h)for(l=h.length;l>0;l-=1)if((i=y[h.slice(0,l).join("/")])&&(i=i[r])){o=i,u=c;break}if(o)break;!a&&m&&m[r]&&(a=m[r],f=c)}!o&&a&&(o=a,u=f),o&&(n.splice(0,u,o),e=n.join("/"))}return e}function s(e,t){return function(){var n=x.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),h.apply(r,n.concat([e,t]))}}function u(e){return function(t){return o(t,e)}}function a(e){return function(t){v[e]=t}}function f(e){if(i(w,e)){var t=w[e];delete w[e],b[e]=!0,d.apply(r,t)}if(!i(v,e)&&!i(b,e))throw new Error("No "+e);return v[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return e?c(e):[]}function p(e){return function(){return g&&g.config&&g.config[e]||{}}}var d,h,y,m,v={},w={},g={},b={},S=Object.prototype.hasOwnProperty,x=[].slice,k=/\.js$/;y=function(e,t){var n,r=c(e),i=r[0],s=t[1];return e=r[1],i&&(i=o(i,s),n=f(i)),i?e=n&&n.normalize?n.normalize(e,u(s)):o(e,s):(e=o(e,s),r=c(e),i=r[0],e=r[1],i&&(n=f(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},m={require:function(e){return s(e)},exports:function(e){var t=v[e];return void 0!==t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:p(e)}}},d=function(e,t,n,o){var u,c,p,d,h,g,S,x=[],k=typeof n;if(o=o||e,g=l(o),"undefined"===k||"function"===k){for(t=!t.length&&n.length?["require","exports","module"]:t,h=0;h<t.length;h+=1)if(d=y(t[h],g),"require"===(c=d.f))x[h]=m.require(e);else if("exports"===c)x[h]=m.exports(e),S=!0;else if("module"===c)u=x[h]=m.module(e);else if(i(v,c)||i(w,c)||i(b,c))x[h]=f(c);else{if(!d.p)throw new Error(e+" missing "+c);d.p.load(d.n,s(o,!0),a(c),{}),x[h]=v[c]}p=n?n.apply(v[e],x):void 0,e&&(u&&u.exports!==r&&u.exports!==v[e]?v[e]=u.exports:p===r&&S||(v[e]=p))}else e&&(v[e]=n)},e=t=h=function(e,t,n,i,o){if("string"==typeof e)return m[e]?m[e](t):f(y(e,l(t)).f);if(!e.splice){if(g=e,g.deps&&h(g.deps,g.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=i,i=o),i?d(r,e,t,n):setTimeout(function(){d(r,e,t,n)},4),h},h.config=function(e){return h(e)},e._defined=v,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),i(v,e)||i(w,e)||(w[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("WorkerFactory",[],function(){return{extractSrcFromFunction:function(e,t,n){return t=t||/(.|\s)*WORKER[_]SRC[_]BEGIN\*\//,n=n||/\/\*WORKER[_]SRC[_]END(.|\s)*/,(""+e).replace(t,"").replace(n,"")},createFromFunction:function(e,t,n){var r=this.extractSrcFromFunction(e,t,n);return this.createFromString(r)},urlFromString:function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},createFromString:function(e){var t=this.urlFromString(e);return new Worker(t)},requireUrl:function(e){return"worker.js?main="+e},require:function(e){return new Worker(this.requireUrl(e))},create:function(e){if("string"==typeof e)return this.require(e);if("function"==typeof e)return this.createFromFunction(e);throw new Error("Invaluid src type "+e)}}}),function e(n,r,i){function o(u,a){if(!r[u]){if(!n[u]){var f="function"==typeof t&&t;if(!a&&f)return f(u,!0);if(s)return s(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[u]={exports:{}};n[u][0].call(l.exports,function(e){var t=n[u][1][e];return o(t||e)},l,l.exports,e,n,r,i)}return r[u].exports}for(var s="function"==typeof t&&t,u=0;u<i.length;u++)o(i[u]);return o}({1:[function(e,t,n){function r(){}var i=t.exports={};i.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){n.shift()()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=r,i.addListener=r,i.once=r,i.off=r,i.removeListener=r,i.removeAllListeners=r,i.emit=r,i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],2:[function(e,t,n){"use strict";function r(e){function t(e){if(null===a)return void c.push(e);s(function(){var t=a?e.onFulfilled:e.onRejected;if(null===t)return void(a?e.resolve:e.reject)(f);var n;try{n=t(f)}catch(t){return void e.reject(t)}e.resolve(n)})}function n(e){try{if(e===l)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void o(t.bind(e),n,r)}a=!0,f=e,u()}catch(e){r(e)}}function r(e){a=!1,f=e,u()}function u(){for(var e=0,n=c.length;e<n;e++)t(c[e]);c=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");var a=null,f=null,c=[],l=this;this.then=function(e,n){return new l.constructor(function(r,o){t(new i(e,n,r,o))})},o(e,n,r)}function i(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}function o(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(e){if(r)return;r=!0,n(e)}}var s=e("asap");t.exports=r},{asap:4}],3:[function(e,t,n){"use strict";function r(e){this.then=function(t){return"function"!=typeof t?this:new i(function(n,r){o(function(){try{n(t(e))}catch(e){r(e)}})})}}var i=e("./core.js"),o=e("asap");t.exports=i,r.prototype=i.prototype;var s=new r(!0),u=new r(!1),a=new r(null),f=new r(void 0),c=new r(0),l=new r("");i.resolve=function(e){if(e instanceof i)return e;if(null===e)return a;if(void 0===e)return f;if(!0===e)return s;if(!1===e)return u;if(0===e)return c;if(""===e)return l;if("object"==typeof e||"function"==typeof e)try{var t=e.then;if("function"==typeof t)return new i(t.bind(e))}catch(e){return new i(function(t,n){n(e)})}return new r(e)},i.all=function(e){var t=Array.prototype.slice.call(e);return new i(function(e,n){function r(o,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var u=s.then;if("function"==typeof u)return void u.call(s,function(e){r(o,e)},n)}t[o]=s,0==--i&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var i=t.length,o=0;o<t.length;o++)r(o,t[o])})},i.reject=function(e){return new i(function(t,n){n(e)})},i.race=function(e){return new i(function(t,n){e.forEach(function(e){i.resolve(e).then(t,n)})})},i.prototype.catch=function(e){return this.then(null,e)}},{"./core.js":2,asap:4}],4:[function(e,t,n){(function(e){function n(){for(;i.next;){i=i.next;var e=i.task;i.task=void 0;var t=i.domain;t&&(i.domain=void 0,t.enter());try{e()}catch(e){if(a)throw t&&t.exit(),setTimeout(n,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}s=!1}function r(t){o=o.next={task:t,domain:a&&e.domain,next:null},s||(s=!0,u())}var i={task:void 0,next:null},o=i,s=!1,u=void 0,a=!1;if(void 0!==e&&e.nextTick)a=!0,u=function(){e.nextTick(n)};else if("function"==typeof setImmediate)u="undefined"!=typeof window?setImmediate.bind(window,n):function(){setImmediate(n)};else if("undefined"!=typeof MessageChannel){var f=new MessageChannel;f.port1.onmessage=n,u=function(){f.port2.postMessage(0)}}else u=function(){setTimeout(n,0)};t.exports=r}).call(this,e("_process"))},{_process:1}],5:[function(e,t,n){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(e,t){(arguments.length?this.then.apply(this,arguments):this).then(null,function(e){setTimeout(function(){throw e},0)})})},{}],6:[function(e,t,n){e("asap");"undefined"==typeof Promise&&(Promise=e("./lib/core.js"),e("./lib/es6-extensions.js")),e("./polyfill-done.js")},{"./lib/core.js":2,"./lib/es6-extensions.js":3,"./polyfill-done.js":5,asap:4}]},{},[6]),n("promise",function(){}),n("assert",[],function(){function e(t){if(t instanceof Array){var n=[];return t.forEach(function(t){n=n.concat(e(t))}),n}return[t]}var t,n=function(t){this.failMesg=e(t||"Assertion failed: ")};n.prototype={_regedType:{},registerType:function(e,t){this._regedType[e]=t},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var n=t(arguments),r=n.shift();if(n=e(n),n=this.failMesg.concat(r).concat(n),console.log.apply(console,n),this.isDefensive())return r;if(this.isBool())return!1;throw new Error(n.join(" "))},subAssertion:function(){var r=t(arguments);return r=e(r),new n(this.failMesg.concat(r))},assert:function(e,t){return e||this.fail(e,t)},eq:function(e,t){return e!==t?this.fail(e,"!==",t):!!this.isBool()||e},ne:function(e,t){return e===t?this.fail(e,"===",t):!!this.isBool()||e},isset:function(e,t){return null==e?this.fail(e,(t||"")+" is null/undef"):!!this.isBool()||e},is:function(e,t){var n=t,r=e;if(null==n)return this.fail(e,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),!!this.isBool()||e;if(this.assert(null!=e,[e,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!e||"number"!=typeof e.length)return this.fail(e,"should be array:");for(var i=this,o=0;o<n.length;o++){var s=i.subAssertion("failed at ",e,"[",o,"]: ");null==n[o]&&console.log("WOW!7",r[o],n[o]),s.is(r[o],n[o])}return!!this.isBool()||e}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),!!this.isBool()||e;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),!!this.isBool()||e;if(n===Boolean||"boolean"==n)return this.assert("boolean"==typeof r,[r,"should be a boolean"]),!!this.isBool()||e;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),!!this.isBool()||e;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),!!this.isBool()||e;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),!!this.isBool()||e;if(n&&"object"==typeof n){for(var u in n){var s=this.subAssertion("failed at ",e,".",u,":");s.is(e[u],n[u])}return!!this.isBool()||e}if("string"==typeof n){var a=this._regedType[n];return a?this.is(e,a):!!this.isBool()||e}return this.fail(e,"Invaild type: ",n)},ensureError:function(e,t){try{e()}catch(n){return"string"==typeof t&&i(n+""===t,e+" thrown an error "+n+" but expected:"+t),void console.log("Error thrown successfully: ",n.message)}this.fail(e,"should throw an error",t)},setMode:function(e){this._mode=e},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},t=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t};var r=new n,i=function(){try{return r.assert.apply(r,arguments)}catch(e){throw new Error(e.stack)}};return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(e){i[e]=function(){try{return r[e].apply(r,arguments)}catch(e){throw console.log(e.stack),new Error(e.message)}}}),i.fail=r.fail.bind(r),i.MODE_STRICT=r.MODE_STRICT,i.MODE_DEFENSIVE=r.MODE_DEFENSIVE,i.MODE_BOOL=r.MODE_BOOL,i.f=function(e){return{_assert_func:e}},i.opt=function(e){return i.f(function(t){return null==t||t instanceof e})},i.and=function(){var e=t(arguments);return i(e instanceof Array),i.f(function(t){for(var n=this,r=0;r<e.length;r++)n.is(t,e[r])})},i}),n("Klass",["assert"],function(e){function t(e){var t=/function[^\(]*\(([^\)]*)\)/,n=t.exec(e+"");return n?n[1].replace(/\s/g,"").split(","):[]}function n(e){if("object"!=typeof e)return!1;if(!e)return!1;var t={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},n=0;for(var r in e){if(!t[r])return!1;n+=t[r]}return n}var r={};return r.define=function(i){function o(t){i.$fields&&e.is(t,i.$fields)}function s(e,r){if(!f)return e;if(n(e)){for(var i in e)e[i]=s(e[i]);return e}if("function"!=typeof e)return e;if(!0!==f){if(t(e)[0]!==f)return h=h||[],h.push(r),e;p=!0}return d=!0,function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),e.apply(this,t)}}var u,a;i.$parent?(a=i.$parent,u=Object.create(a.prototype),u.super=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return a.prototype[t].apply(this,e)}):u={};var f,c;i.$this&&(f=i.$this),i.$singleton&&(c=i.$singleton);var l,p,d,h,y=s(i.$)||function(e){if(e&&"object"==typeof e)for(var t in e)this[t]=e[t]};y instanceof Array&&(l=y,y=function(){for(var e=Array.prototype.slice.call(arguments),t=0;t<l.length;t++)e.length>0&&(this[l[t]]=e.shift())});var m;m=function(){if(!(this instanceof m)){var e=Object.create(u);return y.apply(e,arguments),o(e),e}y.apply(this,arguments),o(this)},a&&(m.super=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift();return a.prototype[n].apply(t,e)}),m.inherit=function(e){return e.$parent=m,r.define(e)},m.prototype=u;for(var v in i)"$"!=v[0]&&("static$"==v.substring(0,7)?m[v.substring(7)]=function(e){return c?t(e)[0]!==c?e:function(){var t=Array.prototype.slice.call(arguments);return t.unshift(m),e.apply(m,t)}:e}(i[v]):n(i[v])?Object.defineProperty(u,v,s(i[v],v)):u[v]=s(i[v],v));if(u.$=y,Object.defineProperty(u,"$bind",{get:function(){return this.__bounded||(this.__bounded=new r.Binder(this)),this.__bounded}}),p){h?console.warn("Use python style in all methods and Use $this:true instead",h):console.warn("Use $this:true instead");try{throw new Error("Stakku")}catch(e){console.log(e.stack)}}return m},r.Function=function(){throw new Error("Abstract")},r.opt=e.opt,r.Binder=r.define({$this:!0,$:function(e,t){for(var n in t)!function(n){"function"==typeof t[n]&&(e[n]=function(){var e=Array.prototype.slice.call(arguments);return t[n].apply(t,e)})}(n)}}),r}),n("root",[],function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()});return n("WorkerServiceB",["promise","Klass","root"],function(e,t,n){var r=t.define({$this:!0,$:function(e,t){e.idseq=1,e.queue={},e.worker=t,e.readyQueue=[],t.addEventListener("message",function(t){var n=t.data;n.reverse?e.procReverse(t):n.ready?e.ready():n.id&&(e.queue[n.id](n),delete e.queue[n.id])}),e.run("WorkerService/isReady").then(function(t){t&&e.ready()})},procReverse:function(e,t){function n(t){e.worker.postMessage({reverse:!0,id:o,error:t?t.stack||t+"":"unknown",status:"error"})}var r=t.data,o=r.id,s=r.path,u=r.params;try{Promise.resolve(i[s](u)).then(function(t){e.worker.postMessage({reverse:!0,status:"ok",id:o,result:t})},n)}catch(e){n(e)}},ready:function(e){e.isReady||(e.isReady=!0,console.log("Worker is ready!"),e.readyQueue.forEach(function(e){e()}))},readyPromise:function(e){return new Promise(function(t){if(e.isReady)return t();e.readyQueue.push(t)})},run:function(e,t,n){return e.readyPromise().then(function(){return new Promise(function(r,i){var o=e.idseq++;e.queue[o]=function(e){"ok"==e.status?r(e.result):i(e.error)},e.worker.postMessage({id:o,path:t,params:n})})})},terminate:function(e){e.worker.terminate()}}),i={};return n.WorkerService={Wrapper:r,load:function(e){var t=new Worker(e);return new r(t)},install:function(e,t){i[e]=t},serv:function(e,t){this.install(e,t)}},n.WorkerService.serv("console/log",function(e){console.log.apply(console,e)}),n.WorkerService}),n("MezonetClient",["WorkerFactory","WorkerServiceB","Klass"],function(e,t,n){function r(e,t,n){for(var r=e.createBuffer(1,t.length,n),i=r.getChannelData(0),o=0;o<i.length;o++)i[o]=t[o];return r}function i(e){return new Promise(function(t){setTimeout(t,e)})}var o=e.urlFromString("var requirejs,require,define;!function(n){function e(n,e){return g.call(n,e)}function t(n,e){var t,r,o,i,a,s,u,f,c,l,d,m,p=e&&e.split(\"/\"),Z=h.map,v=Z&&Z[\"*\"]||{};if(n){for(n=n.split(\"/\"),a=n.length-1,h.nodeIdCompat&&y.test(n[a])&&(n[a]=n[a].replace(y,\"\")),\".\"===n[0].charAt(0)&&p&&(m=p.slice(0,p.length-1),n=m.concat(n)),c=0;c<n.length;c++)if(\".\"===(d=n[c]))n.splice(c,1),c-=1;else if(\"..\"===d){if(0===c||1===c&&\"..\"===n[2]||\"..\"===n[c-1])continue;c>0&&(n.splice(c-1,2),c-=2)}n=n.join(\"/\")}if((p||v)&&Z){for(t=n.split(\"/\"),c=t.length;c>0;c-=1){if(r=t.slice(0,c).join(\"/\"),p)for(l=p.length;l>0;l-=1)if((o=Z[p.slice(0,l).join(\"/\")])&&(o=o[r])){i=o,s=c;break}if(i)break;!u&&v&&v[r]&&(u=v[r],f=c)}!i&&u&&(i=u,s=f),i&&(t.splice(0,s,i),n=t.join(\"/\"))}return n}function r(e,t){return function(){var r=w.call(arguments,0);return\"string\"!=typeof r[0]&&1===r.length&&r.push(null),l.apply(n,r.concat([e,t]))}}function o(n){return function(e){return t(e,n)}}function i(n){return function(e){p[n]=e}}function a(t){if(e(Z,t)){var r=Z[t];delete Z[t],v[t]=!0,c.apply(n,r)}if(!e(p,t)&&!e(v,t))throw new Error(\"No \"+t);return p[t]}function s(n){var e,t=n?n.indexOf(\"!\"):-1;return t>-1&&(e=n.substring(0,t),n=n.substring(t+1,n.length)),[e,n]}function u(n){return n?s(n):[]}function f(n){return function(){return h&&h.config&&h.config[n]||{}}}var c,l,d,m,p={},Z={},h={},v={},g=Object.prototype.hasOwnProperty,w=[].slice,y=/\\.js$/;d=function(n,e){var r,i=s(n),u=i[0],f=e[1];return n=i[1],u&&(u=t(u,f),r=a(u)),u?n=r&&r.normalize?r.normalize(n,o(f)):t(n,f):(n=t(n,f),i=s(n),u=i[0],n=i[1],u&&(r=a(u))),{f:u?u+\"!\"+n:n,n:n,pr:u,p:r}},m={require:function(n){return r(n)},exports:function(n){var e=p[n];return void 0!==e?e:p[n]={}},module:function(n){return{id:n,uri:\"\",exports:p[n],config:f(n)}}},c=function(t,o,s,f){var c,l,h,g,w,y,S,M=[],C=typeof s;if(f=f||t,y=u(f),\"undefined\"===C||\"function\"===C){for(o=!o.length&&s.length?[\"require\",\"exports\",\"module\"]:o,w=0;w<o.length;w+=1)if(g=d(o[w],y),\"require\"===(l=g.f))M[w]=m.require(t);else if(\"exports\"===l)M[w]=m.exports(t),S=!0;else if(\"module\"===l)c=M[w]=m.module(t);else if(e(p,l)||e(Z,l)||e(v,l))M[w]=a(l);else{if(!g.p)throw new Error(t+\" missing \"+l);g.p.load(g.n,r(f,!0),i(l),{}),M[w]=p[l]}h=s?s.apply(p[t],M):void 0,t&&(c&&c.exports!==n&&c.exports!==p[t]?p[t]=c.exports:h===n&&S||(p[t]=h))}else t&&(p[t]=s)},requirejs=require=l=function(e,t,r,o,i){if(\"string\"==typeof e)return m[e]?m[e](t):a(d(e,u(t)).f);if(!e.splice){if(h=e,h.deps&&l(h.deps,h.callback),!t)return;t.splice?(e=t,t=r,r=null):e=n}return t=t||function(){},\"function\"==typeof r&&(r=o,o=i),o?c(n,e,t,r):setTimeout(function(){c(n,e,t,r)},4),l},l.config=function(n){return l(n)},requirejs._defined=p,define=function(n,t,r){if(\"string\"!=typeof n)throw new Error(\"See almond README: incorrect module build, no module name\");t.splice||(r=t,t=[]),e(p,n)||e(Z,n)||(Z[n]=[n,t,r])},define.amd={jQuery:!0}}(),define(\"almond\",function(){}),define(\"assert\",[],function(){function n(e){if(e instanceof Array){var t=[];return e.forEach(function(e){t=t.concat(n(e))}),t}return[e]}var e,t=function(e){this.failMesg=n(e||\"Assertion failed: \")};t.prototype={_regedType:{},registerType:function(n,e){this._regedType[n]=e},MODE_STRICT:\"strict\",MODE_DEFENSIVE:\"defensive\",MODE_BOOL:\"bool\",fail:function(){var t=e(arguments),r=t.shift();if(t=n(t),t=this.failMesg.concat(r).concat(t),console.log.apply(console,t),this.isDefensive())return r;if(this.isBool())return!1;throw new Error(t.join(\" \"))},subAssertion:function(){var r=e(arguments);return r=n(r),new t(this.failMesg.concat(r))},assert:function(n,e){return n||this.fail(n,e)},eq:function(n,e){return n!==e?this.fail(n,\"!==\",e):!!this.isBool()||n},ne:function(n,e){return n===e?this.fail(n,\"===\",e):!!this.isBool()||n},isset:function(n,e){return null==n?this.fail(n,(e||\"\")+\" is null/undef\"):!!this.isBool()||n},is:function(n,e){var t=e,r=n;if(null==t)return this.fail(n,\"assert.is: type must be set\");if(t._assert_func)return t._assert_func.apply(this,[r]),!!this.isBool()||n;if(this.assert(null!=n,[n,\"should be \",t]),t instanceof Array||\"object\"==typeof global&&\"function\"==typeof global.Array&&t instanceof global.Array){if(!n||\"number\"!=typeof n.length)return this.fail(n,\"should be array:\");for(var o=this,i=0;i<t.length;i++){var a=o.subAssertion(\"failed at \",n,\"[\",i,\"]: \");null==t[i]&&console.log(\"WOW!7\",r[i],t[i]),a.is(r[i],t[i])}return!!this.isBool()||n}if(t===String||\"string\"==t)return this.assert(\"string\"==typeof r,[r,\"should be a string \"]),!!this.isBool()||n;if(t===Number||\"number\"==t)return this.assert(\"number\"==typeof r,[r,\"should be a number\"]),!!this.isBool()||n;if(t===Boolean||\"boolean\"==t)return this.assert(\"boolean\"==typeof r,[r,\"should be a boolean\"]),!!this.isBool()||n;if(t instanceof RegExp||\"object\"==typeof global&&\"function\"==typeof global.RegExp&&t instanceof global.RegExp)return this.is(r,String),this.assert(t.exec(r),[r,\"does not match to\",t]),!!this.isBool()||n;if(t===Function)return this.assert(\"function\"==typeof r,[r,\"should be a function\"]),!!this.isBool()||n;if(\"function\"==typeof t)return this.assert(r instanceof t,[r,\"should be \",t]),!!this.isBool()||n;if(t&&\"object\"==typeof t){for(var s in t){var a=this.subAssertion(\"failed at \",n,\".\",s,\":\");a.is(n[s],t[s])}return!!this.isBool()||n}if(\"string\"==typeof t){var u=this._regedType[t];return u?this.is(n,u):!!this.isBool()||n}return this.fail(n,\"Invaild type: \",t)},ensureError:function(n,e){try{n()}catch(t){return\"string\"==typeof e&&o(t+\"\"===e,n+\" thrown an error \"+t+\" but expected:\"+e),void console.log(\"Error thrown successfully: \",t.message)}this.fail(n,\"should throw an error\",e)},setMode:function(n){this._mode=n},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},e=function(n){for(var e=[],t=0;t<n.length;t++)e.push(n[t]);return e};var r=new t,o=function(){try{return r.assert.apply(r,arguments)}catch(n){throw new Error(n.stack)}};return[\"setMode\",\"isDefensive\",\"is\",\"isset\",\"ne\",\"eq\",\"ensureError\"].forEach(function(n){o[n]=function(){try{return r[n].apply(r,arguments)}catch(n){throw console.log(n.stack),new Error(n.message)}}}),o.fail=r.fail.bind(r),o.MODE_STRICT=r.MODE_STRICT,o.MODE_DEFENSIVE=r.MODE_DEFENSIVE,o.MODE_BOOL=r.MODE_BOOL,o.f=function(n){return{_assert_func:n}},o.opt=function(n){return o.f(function(e){return null==e||e instanceof n})},o.and=function(){var n=e(arguments);return o(n instanceof Array),o.f(function(e){for(var t=this,r=0;r<n.length;r++)t.is(e,n[r])})},o}),define(\"Klass\",[\"assert\"],function(n){function e(n){var e=/function[^\\(]*\\(([^\\)]*)\\)/,t=e.exec(n+\"\");return t?t[1].replace(/\\s/g,\"\").split(\",\"):[]}function t(n){if(\"object\"!=typeof n)return!1;if(!n)return!1;var e={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},t=0;for(var r in n){if(!e[r])return!1;t+=e[r]}return t}var r={};return r.define=function(o){function i(e){o.$fields&&n.is(e,o.$fields)}function a(n,r){if(!f)return n;if(t(n)){for(var o in n)n[o]=a(n[o]);return n}if(\"function\"!=typeof n)return n;if(!0!==f){if(e(n)[0]!==f)return p=p||[],p.push(r),n;d=!0}return m=!0,function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),n.apply(this,e)}}var s,u;o.$parent?(u=o.$parent,s=Object.create(u.prototype),s.super=function(){var n=Array.prototype.slice.call(arguments),e=n.shift();return u.prototype[e].apply(this,n)}):s={};var f,c;o.$this&&(f=o.$this),o.$singleton&&(c=o.$singleton);var l,d,m,p,Z=a(o.$)||function(n){if(n&&\"object\"==typeof n)for(var e in n)this[e]=n[e]};Z instanceof Array&&(l=Z,Z=function(){for(var n=Array.prototype.slice.call(arguments),e=0;e<l.length;e++)n.length>0&&(this[l[e]]=n.shift())});var h;h=function(){if(!(this instanceof h)){var n=Object.create(s);return Z.apply(n,arguments),i(n),n}Z.apply(this,arguments),i(this)},u&&(h.super=function(){var n=Array.prototype.slice.call(arguments),e=n.shift(),t=n.shift();return u.prototype[t].apply(e,n)}),h.inherit=function(n){return n.$parent=h,r.define(n)},h.prototype=s;for(var v in o)\"$\"!=v[0]&&(\"static$\"==v.substring(0,7)?h[v.substring(7)]=function(n){return c?e(n)[0]!==c?n:function(){var e=Array.prototype.slice.call(arguments);return e.unshift(h),n.apply(h,e)}:n}(o[v]):t(o[v])?Object.defineProperty(s,v,a(o[v],v)):s[v]=a(o[v],v));if(s.$=Z,Object.defineProperty(s,\"$bind\",{get:function(){return this.__bounded||(this.__bounded=new r.Binder(this)),this.__bounded}}),d){p?console.warn(\"Use python style in all methods and Use $this:true instead\",p):console.warn(\"Use $this:true instead\");try{throw new Error(\"Stakku\")}catch(n){console.log(n.stack)}}return h},r.Function=function(){throw new Error(\"Abstract\")},r.opt=n.opt,r.Binder=r.define({$this:!0,$:function(n,e){for(var t in e)!function(t){\"function\"==typeof e[t]&&(n[t]=function(){var n=Array.prototype.slice.call(arguments);return e[t].apply(e,n)})}(t)}}),r}),function n(e,t,r){function o(a,s){if(!t[a]){if(!e[a]){var u=\"function\"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var f=new Error(\"Cannot find module '\"+a+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var c=t[a]={exports:{}};e[a][0].call(c.exports,function(n){var t=e[a][1][n];return o(t||n)},c,c.exports,n,e,t,r)}return t[a].exports}for(var i=\"function\"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(n,e,t){function r(){}var o=e.exports={};o.nextTick=function(){var n=\"undefined\"!=typeof window&&window.setImmediate,e=\"undefined\"!=typeof window&&window.postMessage&&window.addEventListener;if(n)return function(n){return window.setImmediate(n)};if(e){var t=[];return window.addEventListener(\"message\",function(n){var e=n.source;if((e===window||null===e)&&\"process-tick\"===n.data&&(n.stopPropagation(),t.length>0)){t.shift()()}},!0),function(n){t.push(n),window.postMessage(\"process-tick\",\"*\")}}return function(n){setTimeout(n,0)}}(),o.title=\"browser\",o.browser=!0,o.env={},o.argv=[],o.on=r,o.addListener=r,o.once=r,o.off=r,o.removeListener=r,o.removeAllListeners=r,o.emit=r,o.binding=function(n){throw new Error(\"process.binding is not supported\")},o.cwd=function(){return\"/\"},o.chdir=function(n){throw new Error(\"process.chdir is not supported\")}},{}],2:[function(n,e,t){\"use strict\";function r(n){function e(n){if(null===u)return void c.push(n);a(function(){var e=u?n.onFulfilled:n.onRejected;if(null===e)return void(u?n.resolve:n.reject)(f);var t;try{t=e(f)}catch(e){return void n.reject(e)}n.resolve(t)})}function t(n){try{if(n===l)throw new TypeError(\"A promise cannot be resolved with itself.\");if(n&&(\"object\"==typeof n||\"function\"==typeof n)){var e=n.then;if(\"function\"==typeof e)return void i(e.bind(n),t,r)}u=!0,f=n,s()}catch(n){r(n)}}function r(n){u=!1,f=n,s()}function s(){for(var n=0,t=c.length;n<t;n++)e(c[n]);c=null}if(\"object\"!=typeof this)throw new TypeError(\"Promises must be constructed via new\");if(\"function\"!=typeof n)throw new TypeError(\"not a function\");var u=null,f=null,c=[],l=this;this.then=function(n,t){return new l.constructor(function(r,i){e(new o(n,t,r,i))})},i(n,t,r)}function o(n,e,t,r){this.onFulfilled=\"function\"==typeof n?n:null,this.onRejected=\"function\"==typeof e?e:null,this.resolve=t,this.reject=r}function i(n,e,t){var r=!1;try{n(function(n){r||(r=!0,e(n))},function(n){r||(r=!0,t(n))})}catch(n){if(r)return;r=!0,t(n)}}var a=n(\"asap\");e.exports=r},{asap:4}],3:[function(n,e,t){\"use strict\";function r(n){this.then=function(e){return\"function\"!=typeof e?this:new o(function(t,r){i(function(){try{t(e(n))}catch(n){r(n)}})})}}var o=n(\"./core.js\"),i=n(\"asap\");e.exports=o,r.prototype=o.prototype;var a=new r(!0),s=new r(!1),u=new r(null),f=new r(void 0),c=new r(0),l=new r(\"\");o.resolve=function(n){if(n instanceof o)return n;if(null===n)return u;if(void 0===n)return f;if(!0===n)return a;if(!1===n)return s;if(0===n)return c;if(\"\"===n)return l;if(\"object\"==typeof n||\"function\"==typeof n)try{var e=n.then;if(\"function\"==typeof e)return new o(e.bind(n))}catch(n){return new o(function(e,t){t(n)})}return new r(n)},o.all=function(n){var e=Array.prototype.slice.call(n);return new o(function(n,t){function r(i,a){try{if(a&&(\"object\"==typeof a||\"function\"==typeof a)){var s=a.then;if(\"function\"==typeof s)return void s.call(a,function(n){r(i,n)},t)}e[i]=a,0==--o&&n(e)}catch(n){t(n)}}if(0===e.length)return n([]);for(var o=e.length,i=0;i<e.length;i++)r(i,e[i])})},o.reject=function(n){return new o(function(e,t){t(n)})},o.race=function(n){return new o(function(e,t){n.forEach(function(n){o.resolve(n).then(e,t)})})},o.prototype.catch=function(n){return this.then(null,n)}},{\"./core.js\":2,asap:4}],4:[function(n,e,t){(function(n){function t(){for(;o.next;){o=o.next;var n=o.task;o.task=void 0;var e=o.domain;e&&(o.domain=void 0,e.enter());try{n()}catch(n){if(u)throw e&&e.exit(),setTimeout(t,0),e&&e.enter(),n;setTimeout(function(){throw n},0)}e&&e.exit()}a=!1}function r(e){i=i.next={task:e,domain:u&&n.domain,next:null},a||(a=!0,s())}var o={task:void 0,next:null},i=o,a=!1,s=void 0,u=!1;if(void 0!==n&&n.nextTick)u=!0,s=function(){n.nextTick(t)};else if(\"function\"==typeof setImmediate)s=\"undefined\"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if(\"undefined\"!=typeof MessageChannel){var f=new MessageChannel;f.port1.onmessage=t,s=function(){f.port2.postMessage(0)}}else s=function(){setTimeout(t,0)};e.exports=r}).call(this,n(\"_process\"))},{_process:1}],5:[function(n,e,t){\"function\"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(n,e){(arguments.length?this.then.apply(this,arguments):this).then(null,function(n){setTimeout(function(){throw n},0)})})},{}],6:[function(n,e,t){n(\"asap\");\"undefined\"==typeof Promise&&(Promise=n(\"./lib/core.js\"),n(\"./lib/es6-extensions.js\")),n(\"./polyfill-done.js\")},{\"./lib/core.js\":2,\"./lib/es6-extensions.js\":3,\"./polyfill-done.js\":5,asap:4}]},{},[6]),define(\"promise\",function(){}),define(\"SEnv\",[\"Klass\",\"assert\",\"promise\"],function(n,e,t){function r(){return(new Date).getTime()}function o(n){return n/128-1}function i(n,e){a.$fields[e]||null==g[e]&&(g[e]=1)}var a,s=function(n,e){return Math.trunc(n/e)},u=function(n,e){if(n!==n)throw new Error(e+\": Not a number!\");if(\"number\"!=typeof n)throw console.error(n),new Error(e+\": Not a not a number but not a number!\");return n},f=(Math.abs.bind(Math),function(n){return n>=128?n-256:n}),c=function(n,e){for(var t=[],r=e;n[r];r++)t.push(n[r]);return t},l=function(n,e){var t=n[e];return t+=256*n[e+1],t+=65536*n[e+2],t+=16777216*n[e+3],t>=2147483648&&(t-=4294967296),t},d=Number,m=[3421,3228,3047,2876,2715,2562,2419,2283,2155,2034,1920,1812,1711,1614,1524,1438,1358,1281,1210,1142,1078,1017,960,906,855,807,762,719,679,641,605,571,539,509,480,453,428,404,381,360,339,320,302,285,269,254,240,227,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,76,71,67,64,60,57,53,50,48,45,42,40,38,36,34,32,30,28,27,25,24,22,21,20,19,18,17,16,15,14],p=(Math.trunc.bind(),[]),Z=[],h=0,v=n.define(a={$this:!0,$fields:{Pos:d,PrevPos:d,RPos:d,WaveDat:Array,wdata2:Array,BeginPlay:Boolean,SeqTime:d,SeqTime120:d,wavoutContext:Boolean,Fading:d,PCMW:Array,Delay:d,Tempo:d,ComStr:String,WFilename:String,EnvDat:Array,WriteMaxLen:d},load:function(n,e){function t(n){if(0==n.length)throw new Error(\"Out of data\");return n.shift()}function r(n){if(n.length<4)throw new Error(\"Out of data\");var e=n.shift(),t=1;return t<<=8,e+=n.shift()*t,t<<=8,e+=n.shift()*t,t<<=8,e+=n.shift()*t}for(var o=(r(e),t(e)),i=0;i<o;i++){for(var a=[],s=r(e),u=0;u<s;u++)a.push(t(e));n.channels[i].MPoint=a}},setNoiseWDT:function(n){for(var e=0;e<1024;e++)n.WaveDat[95][e]=o(Math.floor(78*Math.random()+90))},loadWDT:function(n,e){return new Promise(function(t,r){try{e||requirejs([\"Tones.wdt\"],function(e){n.loadWDT(e).then(t,r)});var i=new XMLHttpRequest;i.open(\"GET\",e,!0),i.responseType=\"arraybuffer\",i.onload=function(e){var r,a,s=i.response;if(s){var u=new Uint8Array(s);console.log(\"Loading wdt\",u.length);var f=0;for(r=0;r<96;r++)for(a=0;a<32;a++)n.WaveDat[r][a]=o(u[f++]);for(n.setNoiseWDT(),r=0;r<16;r++)for(a=0;a<32;a++)n.EnvDat[r][a]=u[f++];console.log(\"Loading wdt done\"),t()}},i.send(null)}catch(n){r(n)}})},setSound:function(n,e,t,r){var o=n.channels[e];switch(o.soundMode=!0,t){case 1:o.Steps=r;break;case 2:o.EVol=r}},InitSin:function(n){var e;for(e=0;e<2048;e++)Z[e]=Math.trunc(127*Math.sin(6.2831852*e/2048))},InitEnv:function(n){var e,t;for(n.EnvDat=[],e=0;e<16;e++)for(n.EnvDat[e]=[],t=0;t<32;t++)n.EnvDat[e][t]=Math.floor((31-t)/2)},ConvM2T:function(n){var e;for(p=[],e=0;e<96;e++)p[e]=Math.trunc(7330908160/m[e]*65536/n.sampleRate)},InitWave:function(n){var e,t;for(n.WaveDat=[],e=0;e<96;e++)for(n.WaveDat[e]=[],t=0;t<16;t++)n.WaveDat[e][t]=o(103),n.WaveDat[e][t+s(32,2)]=o(153)},$:function(n,e,t){var r;for(t=t||{},n.useScriptProcessor=t.useScriptProcessor,n.useFast=t.useFast,n.resolution=t.resolution||120,n.wavOutSpeed=t.wavOutSpeed||10,n.context=e,n.sampleRate=u(n.context.sampleRate,\"t.context.sampleRate\"),n.Delay=2e3,n.Pos=n.PrevPos=n.RPos=n.SeqTime=n.SeqTime120=0,n.BeginPlay=!1,n.InitWave(),n.InitEnv(),n.InitSin(),n.ConvM2T(),n.wdata2=[],n.PCMW=[],r=0;r<16;r++)n.PCMW[r]=null;for(n.channels=[],r=0;r<10;r++)n.channels.push({});n.resetChannelStates(),n.Fading=256,n.timeLag=2e3,n.WriteMaxLen=2e4,n.wavoutContext=!1,n.WFilename=\"\",n.ComStr=\"\",n.performance={timeForChProc:0,timeForWrtSmpl:0}},resetChannelStates:function(n){for(var e=0;e<10;e++){var t=n.channels[e];t.LfoV=0,t.LfoA=0,t.LfoC=0,t.LfoD=0,t.LfoDC=0,t.LfoSync=0,t.Slur=t.Sync=0,t.PorStart=t.PorEnd=t.PorLen=0,t.ECount=0,t.MCount=0,t.Resting=0,t.Steps=0,t.SccWave=n.WaveDat[0],t.SccCount=0,t.EShape=n.EnvDat[0],t.EVol=0,t.EBaseVol=128,t.MPointC=0,t.ESpeed=5,t.PlayState=\"psStop\",t.Detune=0,t.LfoV=0,n.SelWav(e,0),t.LfoD=0,t.LfoDC=0,t.Oct=4,t.soundMode=!1}n.Tempo=120},Play1Sound:function(n,e,t,r){var o=n.channels[e];if(!o.soundMode)return 99==t?void(o.Resting=!0):void(e<0||e>=10||t<0||t>95||(o.Resting=!1,r||(o.ECount=0,o.Sync&&(o.SccCount=0),0!=o.LfoSync&&(o.LfoC=0)),o.CurWav<96?(o.Steps=p[t]+o.Detune*s(p[t],2048),95===o.CurWav&&(o.Steps>>>=5)):o.L2WL>=2&&(o.Steps=s(1073741824>>>o.L2WL-2,s(p[36],65536))*s(p[t],65536)),o.PorLen=-1))},Play1Por:function(n,e,t,r,o){var i=n.channels[e];e<0||e>=10||r<0||r>95||t<0||t>95||(i.Resting=!1,i.PorStart=p[t]+i.Detune*s(p[t],2048),i.PorEnd=p[r]+i.Detune*s(p[r],2048),95===i.CurWav&&(i.PorStart>>>=5,i.PorEnd>>>=5),o||(i.ECount=0))},StopMML:function(n,e){e<0||e>=10||(n.WaitMML(e),n.channels[e].PlayState=\"psStop\",n.channels[e].MCount=n.SeqTime+1)},allWaiting:function(n){for(var e=0;e<10;e++)if(\"psPlay\"==n.channels[e].PlayState)return!1;return!0},handleAllState:function(n){var e,t=!0,r=!0;for(e=0;e<10;e++)switch(n.channels[e].PlayState){case\"psPlay\":t=!1,r=!1;break;case\"psWait\":r=!1}if(t&&!r)for(e=0;e<10;e++)n.RestartMML(e);return r},allStopped:function(n){for(var e=0;e<10;e++)if(\"psStop\"!=n.channels[e].PlayState)return!1;return!0},RestartMML:function(n,e){if(!(e<0||e>=10)){var t=n.channels[e];\"psWait\"==t.PlayState&&(t.PlayState=\"psPlay\",t.MCount=n.SeqTime+1)}},restartIfAllWaiting:function(n){if(n.allWaiting())for(var e=0;e<10;e++)n.RestartMML(e)},WaitMML:function(n,e){if(!(e<0||e>=10)){var t=n.channels[e];t.PlayState=\"psWait\",t.MCount=n.SeqTime+1}},Rewind:function(n){var e;for(n.resetChannelStates(),n.SeqTime=0,e=0;e<10;e++){n.channels[e].PlayState=\"psPlay\"}},resetWavOut:function(n){n.wavoutContext=!1},wavOut:function(n,e){e=e||{};var t=n.resolution,r=[],o=e.maxSamples;n.wavoutContext||(n.Rewind(),n.wavoutContext={label2Time:[],PC2Time:[],writtenSamples:0,loopStartFrac:null});var i=n.wavoutContext;i.arysrc=r,i.maxSamples=o;var a=(n.wavOutSpeed,0);return new Promise(function(e){for(;;){var s=o&&a>=o-t;if(!s){for(var u=0;u<t;u++)r.push(0);n.refreshPSG(r,r.length-t,t),a+=t}if(n.allStopped()||s)return i.hasNext=s,s||(n.wavoutContext=!1),void e(i)}})},SelWav:function(n,e,t){var r=n.channels[e];r.CurWav=t,t<96?(r.SccWave=n.WaveDat[t],r.L2WL=5,95===t&&(r.L2WL=10),r.Sync=!1):null!=n.PCMW[t-96]&&(r.SccWave=n.PCMW[t-96].Start,r.L2WL=n.PCMW[t-96].Log2Len,r.Sync=!0)},RegPCM:function(n,e,t){console.log(\"[STUB]regpcm\",e.map(function(n){return String.fromCharCode(n)}),t)},refreshPSG:function(n,e,t,r){n.procChannels(r),n.writeSamples(e,t,r)},procChannels:function(n,e){var t,i,a,s,u,d;h++;var m=(n.sampleRate,44100/n.sampleRate);(new Date).getTime();if(!n.allStopped()){var p,Z=n.SeqTime,v=r(),g=n.wavoutContext;for(i=0;i<10;i++)if(p=n.channels[i],null==p.MPoint[p.MPointC]&&n.StopMML(i),\"psPlay\"==p.PlayState)for(d=0;p.MCount<=Z;){var w=p.MPointC;g&&!g.maxSamples&&0==i&&(g.PC2Time[w]=g.writtenSamples),s=p.MPoint[w+1],u=p.MPoint[w+2];var y=p.MPoint[w];if(y>=0&&y<96||99===y)n.Play1Sound(i,y,p.Slur),p.Slur||(p.LfoDC=p.LfoD),p.Slur=!1,p.MCount+=2*(s+256*u),p.MPointC+=3;else switch(y){case 106:n.Play1Por(i,s,u,p.Slur),p.Slur=!1,p.MCount+=2*(p.MPoint[w+3]+256*p.MPoint[w+4]),p.PorLen=p.MCount-Z,p.MPointC+=5;break;case 103:n.Tempo=s+256*u,p.MPointC+=3;break;case 100:p.EVol=s,p.MPointC+=2;break;case 119:p.EBaseVol=s,p.MPointC+=2;break;case 101:p.ESpeed=s,p.MPointC+=2;break;case 102:n.SelWav(i,s),p.MPointC+=2;break;case 113:for(p.MPointC+=34,t=0;t<32;t++)n.WaveDat[s][t]=o(p.MPoint[w+2+t]);break;case 107:p.EShape=n.EnvDat[s],p.MPointC+=2;break;case 114:for(p.MPointC+=34,t=0;t<32;t++)a=p.MPoint[w+2+t],a>15&&(a=15),n.EnvDat[s][t]=a;break;case 104:if(g&&!g.maxSamples){if(0==i){var S=p.MPointC+l(p.MPoint,w+1),M=g.PC2Time[S];\"number\"==typeof M&&M<g.writtenSamples&&(g.loopStartFrac=[M,n.sampleRate],console.log(\"@jump\",\"ofs=\",g.loopStartFrac))}p.MPointC+=5}else p.MPointC+=l(p.MPoint,w+1);d++,d>1&&(console.log(\"Jumpsafe!\"),n.StopMML(i),p.MCount=Z+1);break;case 120:p.MPointC+=2;break;case 105:p.Slur=!0,p.MPointC+=1;break;case 108:n.WaitMML(i),p.MPointC+=1;break;case 109:n.ComStr=c(p.MPoint,w+1),p.MPointC+=n.ComStr.length+2;break;case 111:n.WFilename=c(p.MPoint,w+1),p.MPointC+=n.WFilename.length+2;break;case 112:p.MPointC+=1;break;case 110:p.Detune=f(s),p.MPointC+=2;break;case 115:p.LfoSync=s,p.LfoV=65536*u,p.LfoA=p.MPoint[w+3],p.LfoD=0,p.MPointC+=4;break;case 118:p.LfoD=s*n.sampleRate,p.MPointC+=2;break;case 116:p.Sync=1==s,p.MPointC+=2;break;case 117:var C=c(p.MPoint,w+1);n.RegPCM(C,p.MPoint[w+1+C.length+1]),p.MPointC+=C.length+3;break;case 255:n.StopMML(i);break;default:throw n.StopMML(i),new Error(\"Invalid opcode\"+y)}}g&&(g.writtenSamples+=e),n.handleAllState(),n.SeqTime+=Math.floor(n.Tempo*(e/120)*m),n.performance.timeForChProc+=r()-v}},writeSamples:function(n,e,t,o){var i,a,u,f=0,c=0,l=t+o;for(u=t;u<l;u++)e[u]=0;if(!n.allStopped()){var d=r();for(i=0;i<10;i++)if(a=n.channels[i],\"psPlay\"==a.PlayState&&(a.PorLen>0&&(c=a.MCount-n.SeqTime,a.Steps=s(a.PorStart,a.PorLen)*c+s(a.PorEnd,a.PorLen*(a.PorLen-c))),f=a.soundMode?a.EVol:a.Resting?0:a.EShape[a.ECount>>>11]*a.EVol*a.EBaseVol,n.Fading<256&&(f*=s(n.Fading,256)),a.ECount+a.ESpeed*(o/2)<65536&&(a.ECount+=a.ESpeed*(o/2)),!((f/=524288)<=0))){var m=a.SccCount,p=a.Steps,h=a.SccWave,v=32-a.L2WL;for(0!=a.LfoV&&(a.LfoDC>0?a.LfoDC-=n.Tempo*o:(p+=Z[a.LfoC>>>21]*(p>>9)*a.LfoA>>8,a.LfoC+=a.LfoV/2*o)),u=t;u<l;u++)e[u]+=f*h[m>>>v],m+=p;a.SccCount=m>>>0}n.setNoiseWDT(),n.performance.timeForWrtSmpl+=r()-d}}}),g={};for(var w in a){var y=/\\bt\\s*\\.\\s*([a-zA-Z0-9]+)\\b/g;if(\"function\"==typeof a[w]){var S=a[w]+\"\";S.replace(y,i);g[w]=0}}return console.log(g),v}),define(\"root\",[],function(){return\"undefined\"!=typeof window?window:\"undefined\"!=typeof self?self:\"undefined\"!=typeof global?global:function(){return this}()}),define(\"WorkerServiceW\",[\"promise\",\"root\"],function(n,e){var t=1,r={},o={},i=e;return e.WorkerService={install:function(n,e){r[n]=e},serv:function(n,e){this.install(n,e)},ready:function(){e.WorkerService.isReady=!0,i.postMessage({ready:!0})},reverse:function(n,e){var r=t++;return new Promise(function(t,a){o[r]=function(n){\"ok\"==n.status?t(n.result):a(n.error)},i.postMessage({reverse:!0,id:r,path:n,params:e})})}},i.addEventListener(\"message\",function(n){function e(n){i.postMessage({id:a,error:n?n.stack||n+\"\":\"unknown\",status:\"error\"})}var t=n.data,a=t.id,s={id:a};if(t.reverse)return o[t.id](t),void delete o[t.id];try{Promise.resolve(r[t.path](t.params,s)).then(function(n){i.postMessage({id:a,result:n,status:\"ok\"})},e)}catch(n){e(n)}}),e.WorkerService.install(\"WorkerService/isReady\",function(){return e.WorkerService.isReady}),e.console||(e.console={log:function(){e.WorkerService.reverse(\"console/log\",Array.prototype.slice.call(arguments))}}),e.WorkerService}),define(\"Tones.wdt\",[],function(){return\"data:application/octet-stream;base64,UFBQUFBQUFBQUFBQUFBQULm5ubm5ubm5ubm5ubm5ublnZ2dnZ6einUdETExBTHyao6OZnpNASWqZmJqZMENshm1LOjA6UFZOMys4RVBfZ3iHmKCvwMfUzLGpr8XPxbSSoGdnVUpBQD9BSUpKTlJjfK7BxL+xoHxiVkpPaIGToK1oYVZORkA5NDQ0NjpBSVZgbHuKlaOrrq6tq6Sfk4d8dopORUtVYGJobGdQRTw7RmF4jLO6uK+cmZmZmZqalY6MTkxOS0tLS0tLS0tLS0tLTH2uxc7SzruegVFQUE9PT05GSUdHRkZGRkZGz8/MzMzOz87Oz3dERUVFRUXOztDQSSdPa2xsa2tra2ttbW1ta4yx29rb3MGkim5WQSUlJScnR0lJSUlJSkpKSUlJSUlJSUlKvLy8u7y8u75GRkdHR0fs7OwPSqmfUEtJRTg4ODY2LysrKSkoKh4eHh4eHh4eH05OT09PT09PT09PT09PUFBQUFBQUFBQUFBPT0+4tra2Z2dbOTg7R2eIpK2kmIlsVUxHSlhwhJ+xq6OZmZmZjYiVioFsUS0iICo2TmCClaCzsaVrTEpccZGuurazsK+pop9cY1eRfGtfVUc/dZKecWhtomFjX3aBgXFgVUlAUYeY1ipFVWNseIKMkpmiqK2wubu+wMTFxcbGy8vQ0tHR0tR3iGBXbElAqKuOUk9Yk5OvuLm5ubSgcFZLTGpukpRma2dnZ2dnfpeZl4dwalBOZ2egtbOZeGVmcYKdrbWwrZmZZ2dnZ0c5MzMxMTEzNTk8Z5mZmZmZmcnJx8fGxsXDv7NKQUBUZW1tZV1dY3eUoKqrq5+cnai6xMXAtaWdk4p3YDA8TFZhZ3J8hI6fqrW/z9fs1rypnY2AcWFSRz80LSkgPEFGTlBWV1xdYmhscHN3eHyChoqRlZmeoKKlrbC1usHGv7WupaOak4+IiIR+eXhzbmtnYF1bxsZUUU5JQzs4NmBgYGBhwMC/v7/Dw8PExMPDw2NiZWVlZWVlZWVlYWFlV1dWVlRRVFJSUlTFxcXExMPDw8PDxFBQVFRUVldTVFfHx8fGxcS/v7u5tLCtp6Cal5KOhIB7cm5oYFdOPjgqxauxqZoXipOUZ2eTQ0GIlW2up6+VztDWSXKrpVCoTIOkyz5AQUFBQ0NBP0BGS1FdaHF3goePmaCps7u/xMXFxccjIChdZWBcRx8cGh0rRF11jaW80uBzs6ez29zOqY1qPmxmVjNBPmegtLy1u7iajYyUo6uqpJ+XkY2NjYyKiISZZ2dohIRYW4SEVleUq7q6sI1EREtlkZFbXJOrvr68sZeZmJhnZ2dnZ7a4QUNDP8vR0c/Oy8tFR0eZmZmZmZmZmShmg6q4qYqTpbq7uLWzq6igoJ6Xko2BdmNROC01SkMqAOH3/v/73wDh+v//+eoA6Pj+//nqAOj4///46gDk9vxnZ2dnqKqtgHl1gJSdnZV3cHOCjZyjoJyYl5SUmZmZmUNBRUdLVFhicHt+fn5+fn5+fn5+fn2BiJSns7/ExsbFcHBwcHBtbW1sbGxsbW1sbG1ubXzBw3M1HyApamxtbWzPz8/Oz8nBs5R7Zl1FOTw4RFJgc4mgvsXLy1dSUltix3FwcHBwc3V1dXV1dXNxcXFy1tYgIiJ2dnZ2dnZ1cXFxXDooNVowKDBcMCk1Q1BdeI2kvt3q4Ljd5tyx3+jcqH1mX19mZ2eZmYQ8PkZHSldddYKPlJmZmZmZmZmZmZmTjGdnZ3l4eHl5bFVMSklUgKSxsbawmqqzy76Yk7O+tLCtUTowLVKPsMHS1dHOzMfDtauZgWBFPDEzMTE+XICTjoFnZ2dnW09LXU5FVmNzhJOerrqnj4S/uJmZmZmZmZmZmb5RUElMTrXQ3N3cyYZwbHWOo8HV3dvBnZWOj5mgq7G4fX18gMG/e3h4eXl5fHx8gcG8gjAvLi4uLi4xMTAwL31HxMXGxsbFxcXFxURBPz8/QMPDxMTDw0ZDQ0FGRkdHR5q50OPcv62YhHV2j6u1qo5xVUpUcImKe2dSQCMcL0ZleGtcPDEuJygzYGNjZWZmZ567w8XAqaCOj4+SlJWUlIxlZWVHNjAkJTFQX2BgYGBfYp2qsbGwqJmRjoN8dXJubGdnZ2dUTEtQVFhfZWhxfI2vwMbJyb6qZ1pSRUaZmZmZgIePoLvQ29GwdrDQ3NS+nmFBKyMvT5JPLiQvRF9weH+uvsTEuqBYo7nAwL6vd2FQR0dHandqSklJSUlJSldshv8SfP8NaP7/DAz/B/0DA8T/yw/r++4PbfcSEvX4FBpaUWfJe7Cfqatnq2erqZ9KO5N952qZW4d2c3WGxlCZmdJnZ2dnZ2dnZ2dnZ2dnZ2dnmZmZmZmZmZmZmZmZmZmZmWdnZ2dnZ2dnZ2dnZ2dnZ2eZmZmZmZmZmZmZmZmZmZmZZ2dnZ2dnZ2dnZ2dnZ2dnZ5mZmZmZmZmZmZmZmZmZmZmenJR5d4KSlYRmVlBRUVJnr8fHwbSrpaKelHllZWVugWdnZ2dnZ2dnZ2dnZ2dnZ2eZmZmZmZmZmZmZmZmZmZmZZ2dnZ2dnZ2dnZ2dnZ2dnZ5mZmZmZmZmZmZmZmZmZmZlnZ2dnbmBfYmuOvsC5qJKHhIB+fXx8fXFnVVaan5mZmWdnZ2dnZ2dnZ2dnZ2dnZ2eZmZmZmZmZmZmZmZmZmZmZZ2dnZ2dnZ2dnZ2dnZ2dnZ5mZmZmZmZmZmZmZmZmZmZlnZ2dnZ2dnZ2dnZ2dnZ2dnmZmZmZmZmZmZmZmZmZmZmWdnZ2dhWoGRhltYZXyap6mfc3FmYXycqa6kj4J9fYGMZ2dnZ2dnZ2dnZ2dnZ2dnZ5mZmZmZmZmZmZmZmZmZmZlzdTw6Oz8/Pz9FR0pPV2Fqc36JjZqgqrC2vL+/vnd3c5pROjQxKycrKysuMDAxNj44ODtKk7zL0NS/jK/A0Mm4Z2dnZ2dnZ2dnZ2dnZ2dnZ5KtwdDMwamNZmdnZ2dnZ2eKg2dfaGt5eYS4mnBmY2VnZ2dna4+rq6t+bnZ2oKOnmLCwZ0k8Ozs7PEBLUltsj6q0ury6mX1RSpi5uFBKh6u5S05Ma2trampqTE5OTk5OecnJysvLra+urq60yc7OzspwcHJy1NbX2NjY1tR1cnV1c3Nzubm2tkNBQUNxcHJycaurq2dnZ2dmY2NqxsbExV9fX2HGycbGxkVEPkA8Ozs7Ii5L/+sAGi9FYXecvtXh7PX5/v7+/v7++/Dr3LAoDRMjIiUCIy8rPDRHUU9GHhMZIDUKCkQqGhoKCQwREy88PoSMnIynoLuoz7i8l6eCcnxXZjlOGE9BbmGCopfGp7iZQUNFTHagya6TcEVDQUFBW2iBmai5xc/Gua2VfWtWTkc7Ozs8tLS0trS0Ojo4ODk5uLi4tra2tbW2tra4tbW1tT5WaHFzbF1QODlLbp21w8/Rz8/Pz9DR0dHR0c65h1Y+coOgu8TDuZ13YEA0MDM/VG2Hmaq1wMXGxsO1p5SAc206c3NzlaeooIhYQzpAZnZ1dsPBwMDBwcHBwHV3dnM7O09wlMXav5d2XUs1IjtGXHWPorDF2MOtmYFxW0s6LygkZ2doMzMzMTNlZWhnlZWVlZWV0NDS0NDQ0NDPmJmZmWeYXC8tLS0tLispKTxlfJGcnaq1uriulJK4trWYlbq4qGdnZ2dnZ2dnZ2dnZ2dnZ2eZqL7Hyb+xnJSEfTEpQJyaZ2dnZ2evsLS5Tjw8RU5PZ5mZmZmZmWhdXF+ZmZmZmZlnZ2eAl56VaFJFQ0VKZ2dnmZmZmZmZmZmZmZmZmZmZmWJnZ2dnZ2dnZ2dnZ2dnZ2eZtb6+saOVh3x5cVQ/QUxfNEFOXWVrc36Hj5yjpaijeJejtsDFys/V1tfX1tXV1SuaUTpYVlZ5WlxdXDAwMWA+ODg7SpO5xtDOz6TQ0Mq8rspnUVFMS1ZztsbHvq+djU9PUGF2iZior7i+wMHDxsnKP1BmZWA4NCozO1eInrPBxYaGg7+/moJRQDAkIyMkKTNbWldXV2d2dmc4ODg5OnmvxcTExMSxV1hYWFiImZmZilqCipRyj5uHomxkmX19hY2giWeHZmSMg5RnmIGZpYFmDw4LCgoJCAcHBgYFBQQEAwMDAgICAgICAgICAgICAgAPDgsKCQkJCAgIBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwEODg4ODg4ODg0MDAwMDAwMDAwLCwsLCwsLCwoKCgoKAgUICgsNDg8PDw8PDw8ODg0NDAwLCwsKCgoJCQgICAcPDgwLCgkIBwcGBgYGBQUFBQUEBAMDAgICAgEBAQ8PDw8ODg4ODg4ODg4ODg4ODg0NDAwLCgoJCAgGBQQCAQAAAAUHCQoLCwwMDA0NDQ0ODg4ODg0NDQ0NDAwMDAwMDAwBAQECAgIDAwMDBAQFBAQFBQYHBwgJCQoLCwwNDg4ODg8ODAsKCQgHBwYGBgYFBQUFBQQEAwMCAgICAQEBAQAADw4MCwoJCAcHBgYGBgUFBQUFBAQDAwICAgIBAQEBAAAPDgwLCgkIBwcGBgYGBQUFBQUEBAMDAgICAgEBAQEAAA8ODAsKCQgHBwYGBgYFBQUFBQQEAwMCAgICAQEBAQAADw4MCwoJCAcHBgYGBgUFBQUFBAQDAwICAgIBAQEBAAAPDgwLCgkIBwcGBgYGBQUFBQUEBAMDAgICAgEBAQEAAA8ODAsKCQgHBwYGBgYFBQUFBQQEAwMCAgICAQEBAQAADw4MCwoJCAcHBgcGBgYGBQUFBQYHCAgHCAgBAQEBAAA=\"}),define(\"SEnvWorker\",[\"SEnv\",\"WorkerServiceW\",\"Tones.wdt\",\"promise\"],function(n,e,t,r){function o(e){var r=Promise.resolve();if(!i){var o={sampleRate:e.sampleRate};i=new n(o,{wavOutSpeed:1e4}),r=i.loadWDT(t)}return r.then(function(){i.load(e.mzo)})}var i;e.serv(\"MezonetJS/load\",o),e.serv(\"MezonetJS/wavOut\",function(n){var e=Promise.resolve();return n.mzo&&(e=o(n)),e.then(function(){return i.wavOut({maxSamples:n.maxSamples})}).then(function(n){return delete n.PC2Time,n})}),e.serv(\"test\",function(){return console.log(\"TEST!!\"),\"OK\"}),e.ready()}),require([\"SEnvWorker\"]);"),s=n.define({$this:!0,$:function(e,n,r){var i=n.playbackMode;switch(e.playbackMode=i,i.type){case"Mezonet":i.buffer&&i.worker?(e.buffer=i.buffer,e.w=i.worker,delete i.buffer,delete i.worker):e.w=new t.Wrapper(new Worker(o));break;case"AudioBuffer":e.buffer=i.buffer}e.context=n.context,e.mzo=n.mzo,e.src=n,e.sampleRate=e.context.sampleRate,e.wdataSize=e.src.maxSamples||4*e.sampleRate,e.curRate=1,e.plusTime=0,e.writtenSamples=0},playNode:function(e,t){if(!e.isStopped&&!this.isSrcPlaying){t=t||{};var n=this.context.createBufferSource();n.buffer=e.buffer,this.context.createGain=this.context.createGain||this.context.createGainNode;var r=this.context.createGain();n.connect(r),r.connect(this.context.destination),e.gainNode=r,n.loop="Mezonet"===e.playbackMode.type,this.bufSrc=n,n.start=n.start||n.noteOn;var i=e.context.currentTime,o=t.start||i;o<i&&(o=i),this.playStartTime=o,n.start(o),this.isSrcPlaying=!0;var s=t.rate||1;e.curRate=s,n.playbackRate.value=s;var u=t.volume||1;r.gain.value=u,e.plusTime=0,n.onended=function(){e.isSrcPlaying=!1}}},start:function(e,t){return e.isStopped?Promise.resolve():e.prepareBuffer(t).then(function(){return e.playNode(t),e.startRefreshLoop()})},getCurrentTime:function(e){if(e.isStopped)return 0;if(e.isPaused)return e.isPaused.pausedTimeInTrack;var t=this.context.currentTime-this.playStartTime;return t*=e.curRate,t+=e.plusTime,t<0?0:t},getCurrentSampleInBuffer:function(e){if(e.isStopped)return 0;if(e.isPaused)return e.isPaused.pausedSampleInBuffer;var t=e.getCurrentTime();return Math.floor(t*this.sampleRate)%e.wdataSize},setRate:function(e,t){if((t<=0||isNaN(t))&&(t=1),e.isPaused)return void(e.isPaused.nextRate=t);e.plusTime-=(e.context.currentTime-e.playStartTime)*(t-e.curRate),e.curRate=t,e.bufSrc.playbackRate.value=t},prepareBuffer:function(e){return e.buffer?Promise.resolve(e.buffer):e.w.run("MezonetJS/wavOut",{mzo:e.mzo,sampleRate:e.sampleRate,maxSamples:e.wdataSize}).then(function(t){return e.buffer=r(e.context,t.arysrc,e.sampleRate),e.visualize&&e.visualize(0,t.arysrc,0,t.arysrc.length),e.writtenSamples+=t.arysrc.length,e.buffer})},startRefreshLoop:function(e){function t(){return i(50).then(function(){if(!e.isSrcPlaying)return e.w&&e.w.terminate(),"stopped";var u=e.getCurrentSampleInBuffer(),a=u-o,f=a>=0?a:e.wdataSize+a;if(f-=Math.floor(.05*e.wdataSize),f<0&&(f=0),n){for(var c=o,l=0;l<f;l++)r[o]=0,o=(o+1)%e.wdataSize;return e.visualize&&e.visualize(u,r,c,f),e.writtenSamples+=f,s+=f,s>=e.wdataSize?e.stop():t()}return 0==f?i(50).then(t):e.w.run("MezonetJS/wavOut",{maxSamples:f}).then(function(i){var s,a=i.arysrc,f=o;for(s=0;s<a.length;s++)r[o]=a[s],o=(o+1)%e.wdataSize;return e.visualize&&e.visualize(u,r,f,a.length),e.writtenSamples+=a.length,i.hasNext||(n=!0,e.w.terminate()),t()})})}if("AudioBuffer"===e.playbackMode.type)return"loop not used";var n,r=e.buffer.getChannelData(0),o=0,s=0;return t()},setVolume:function(e,t){t="number"==typeof t?t:1,e.gainNode.gain.value=t},pause:function(e){e.isStopped||e.isSrcPlaying&&(e.isPaused||(e.isPaused={pausedTimeInTrack:e.getCurrentTime(),pausedSampleInBuffer:e.getCurrentSampleInBuffer(),pausedTime:e.context.currentTime},e.bufSrc.stop(),e.bufSrc.disconnect()))},resume:function(e){if(!e.isStopped&&e.isSrcPlaying&&e.isPaused){var t=this.context.createBufferSource();t.buffer=e.buffer,t.connect(e.gainNode),t.loop="Mezonet"===e.playbackMode.type,this.bufSrc=t,e.plusTime-=(e.context.currentTime-e.isPaused.pausedTime)*e.curRate,t.start=t.start||t.noteOn,t.playStartTime=this.context.currentTime,t.start(0,e.isPaused.pausedSampleInBuffer/e.sampleRate),t.onended=function(){e.isSrcPlaying=!1},t.playbackRate.value=e.curRate;var n=e.isPaused.nextRate;delete e.isPaused,n&&e.setRate(n)}},stop:function(e){return e.bufSrc&&e.bufSrc.stop(),e.isSrcPlaying=!1,e.isStopped=!0,"stopped"}}),u=n.define({$this:!0,$:function(e,n,r){e.w=new t.Wrapper(new Worker(o)),e.context=n,e.sampleRate=e.context.sampleRate,e.mzo=r},playAsMezonet:function(e){return new s(this,e)},init:function(e,t){return t=t||{},e.maxSamples=t.maxSamples||4*e.context.sampleRate,e.w.run("MezonetJS/wavOut",{mzo:e.mzo,sampleRate:e.sampleRate,maxSamples:e.maxSamples}).then(function(t){t.loopStartFrac&&(t.loopStart=t.loopStartFrac[0]/t.loopStartFrac[1]);var n=r(e.context,t.arysrc,e.sampleRate);return t.mezonet=e,t.decodedData=n,t.hasNext?e.playbackMode={type:"Mezonet"}:e.playbackMode={type:"AudioBuffer",buffer:n},e.w.terminate(),t.playbackMode=e.playbackMode,console.log(t),t})},terminate:function(e){e.w.terminate()}});return u.Playback=s,u}),t("MezonetClient")}()}(this);