function HttpHelper(t){var e={},n=t.lineMark;return e.buf=$("<div>"),e.bufs=[e.buf],e.maxLineNo=-1,e.cur=function(){return e.bufs[e.bufs.length-1]},e.p=function(t){"string"==typeof t&&(t=t.length>0?$("<span>").text(t):null),e.cur()?(e.lineNo>e.maxLineNo&&(e.maxLineNo=e.lineNo,e.cur().append($("<a>").attr({id:n+"-"+e.lineNo,name:n+"-"+e.lineNo}))),t&&e.cur().append(t)):console.log("Warning - Stack underflow")},e.enter=function(t){"string"==typeof t&&(t=$(t)),e.bufs.push(t)},e.exit=function(){var t=e.bufs.pop();e.p(t)},e.h=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e}!function(){var t={};return t.def=function(e,n,r){var i=t.getModuleInfo(t.curName);i.type=r,t.setReqs(i,e),i.func=function(){return n.apply(this,t.getObjs(e))},t.loadIfAvailable(i)},define=function(){var e=Array.prototype.slice.call(arguments);"string"==typeof e[0]&&(t.curName=e.shift());var n=e.shift(),r=e.shift();t.def(n,r,"define")},define.amd={jQuery:!0},requirejs=function(e,n){t.def(e,n,"require")},t.setReqs=function(e,n){n.forEach(function(n){var r=t.getModuleInfo(n);r.loaded||(e.reqs[n]=r,r.revReqs[e.name]=e)})},t.getModuleInfo=function(e){var n=t.modules;return n[e]||(n[e]={name:e,reqs:{},revReqs:{}}),n[e]},t.doLoad=function(e){var n=t.getModuleInfo(e);if(n.loaded)return n.obj;n.loaded=!0;var r=null;if(n.func)r=n.func();else{var i=e.split(/\./);r=function(){return this}(),i.forEach(function(t){r&&(r=r[t])}),null==r&&console.log("Warning: No obj for "+e)}if("define"==n.type&&null==r)throw"No obj for "+e;n.obj=r;for(var o in n.revReqs)t.notifyLoaded(n.revReqs[o],n.name);return r},t.notifyLoaded=function(e,n){delete e.reqs[n],t.loadIfAvailable(e)},t.loadIfAvailable=function(e){for(var n in e.reqs)return;t.doLoad(e.name)},t.getObjs=function(e){var n=[];return e.forEach(function(e){var r=t.doLoad(e);n.push(r)}),n},t.modules={},t.setName=function(e){t.curName&&(t.getModuleInfo(t.curName).func||t.doLoad(t.curName)),e&&(t.curName=e)},requireSimulator=t,t}(),requireSimulator.setName("FS"),define([],function(){var t,e,n={},i="REQJS_",o=0;n.def=function(t,e,r){var i=n.getModuleInfo(t);"function"==typeof e?(r=e,e=n.reqsFromFunc(r),n.setReqs(i,e),i.func=function(){var t={exports:{}},e=r(n.doLoad,t,t.exports);return e||t.exports}):(n.setReqs(i,e),i.func=function(){return r.apply(this,n.getObjs(e))}),n.loadIfAvailable(i)},t=function(t,e,r){n.def(t,e,r)},t.amd={},e=function(t,e){n.def(i+o++,t,e)},n.setReqs=function(t,e){e.forEach(function(e){var r=n.getModuleInfo(e);r.loaded||(t.reqs[e]=r,r.revReqs[t.name]=t)})},n.getModuleInfo=function(t){var e=n.modules;return e[t]=e[t]||{name:t,reqs:{},revReqs:{}}},n.doLoad=function(t){var e=n.getModuleInfo(t);if(e.loaded)return e.obj;e.loaded=!0;var r=e.func();null!=r||t.match(/^REQJS_/)||console.log("Warning: No obj for "+t),e.obj=r;for(var i in e.revReqs)n.notifyLoaded(e.revReqs[i],e.name);return r},n.notifyLoaded=function(t,e){delete t.reqs[e],n.loadIfAvailable(t)},n.loadIfAvailable=function(t){for(var e in t.reqs)return;n.doLoad(t.name)},n.getObjs=function(t){var e=[];return t.forEach(function(t){var r=n.doLoad(t);e.push(r)}),e},n.reqsFromFunc=function(t){var e=t+"",n=[];return e.replace(/require\s*\(\s*["']([^"']+)["']\s*\)/g,function(t,e){n.push(e)}),n},n.modules={},t("extend",[],function(){return function(t,e){for(var n in e)t[n]=e[n]}}),t("assert",[],function(){function t(e){if(e instanceof Array){var n=[];return e.forEach(function(e){n=n.concat(t(e))}),n}return[e]}var e,n=function(e){this.failMesg=t(e||"Assertion failed: ")};n.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var n=e(arguments),r=n.shift();if(n=t(n),n=this.failMesg.concat(r).concat(n).concat(["mode",this._mode]),console.log.apply(console,n),this.isDefensive())return r;if(this.isBool())return!1;throw new Error(n.join(" "))},subAssertion:function(){var r=e(arguments);return r=t(r),new n(this.failMesg.concat(r))},assert:function(t,e){return t?t:this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):this.isBool()?!0:t},ne:function(t,e){return t===e?this.fail(t,"===",e):this.isBool()?!0:t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):this.isBool()?!0:t},is:function(t,e){var n=e,r=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),this.isBool()?!0:t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var i=this,o=0;o<n.length;o++){var s=i.subAssertion("failed at ",t,"[",o,"]: ");null==n[o]&&console.log("WOW!7",r[o],n[o]),s.is(r[o],n[o])}return this.isBool()?!0:t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),this.isBool()?!0:t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),this.isBool()?!0:t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),this.isBool()?!0:t;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),this.isBool()?!0:t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),this.isBool()?!0:t;if(n&&"object"==typeof n){for(var a in n){var s=this.subAssertion("failed at ",t,".",a,":");s.is(t[a],n[a])}return this.isBool()?!0:t}if("string"==typeof n){var u=this._regedType[n];return u?this.is(t,u):this.isBool()?!0:t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&i(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},e=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var r=new n,i=function(){try{return r.assert.apply(r,arguments)}catch(t){throw new Error(t.stack)}};return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){i[t]=function(){try{return r[t].apply(r,arguments)}catch(e){throw console.log(e.stack),new Error(e.message)}}}),i.fail=r.fail.bind(r),i.MODE_STRICT=r.MODE_STRICT,i.MODE_DEFENSIVE=r.MODE_DEFENSIVE,i.MODE_BOOL=r.MODE_BOOL,i.f=function(t){return{_assert_func:t}},i.opt=function(t){return i.f(function(e){return null==e||e instanceof t})},i.and=function(){var t=e(arguments);return i(t instanceof Array),i.f(function(e){for(var n=this,r=0;r<t.length;r++)n.is(e,t[r])})},i}),t("PathUtil",["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}function n(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n}var r,i=/^([a-zA-Z]):/,o=/^([a-z\-]+):\/\/\/?([^\/]+)\//,s=t.f(function(t){this.is(t,String),this.assert(r.isPath(t),[t," is not a path"])}),a=t.f(function(t){this.is(t,String),this.assert(r.isAbsolutePath(t),[t," is not a absolute path"])}),u=t.f(function(t){this.is(t,String),this.assert(!r.isAbsolutePath(t),[t," is not a relative path"])}),c=t.f(function(t){this.is(t,s),this.assert(r.isDir(t),[t," is not a directory path"])}),f=t.and(c,a),l=t.f(function(t){this.is(t,s),this.assert(!r.isDir(t),[t," is not a file path"])}),p="/";return r={Path:s,Absolute:a,Relative:u,Dir:c,File:l,AbsDir:f,SEP:p,endsWith:e,startsWith:n,hasDriveLetter:function(t){return i.exec(t)},isURL:function(t){var e=o.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:p+t.substring(e[0].length)}},isPath:function(){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&!r.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&(r.startsWith(e,p)||r.hasDriveLetter(e)||r.isURL(e))},isDir:function(n){return n=r.fixSep(n),t.is(arguments,[s]),e(n,p)},hasBackslashSep:function(t){return t.indexOf("\\")>=0},fixSep:function(e,n){return n=n||"/",t.is(arguments,[String]),t.is(e.replace(/[\\\/]/g,n),s)},directorify:function(e){return r.isDir(e)?e:t.is(e+p,c)},filify:function(e){return r.isDir(e)?t.is(e.substring(0,e.length-1),l):e},splitPath:function(e){t.is(arguments,[s]);var n;if(n=this.isURL(e)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}e=e.replace(/\/+/g,p);var i=e.split(p);return""==i[i.length-1]&&(i[i.length-2]+=p,i.pop()),i},name:function(e){return t.is(arguments,[String]),r.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var n=r.name(e),i=/\.[a-zA-Z0-9]+$/.exec(n);return i?i[0]:null},truncExt:function(e,n){t.is(e,String);var i=r.name(e);return n=n||r.ext(e),t.is(n,String),i.substring(0,i.length-n.length)},truncSEP:function(e){return t.is(arguments,[s]),r.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(n,i){return t.is(arguments,[String,String]),e(r.name(n),i)},parent:function(e){return t.is(arguments,[String]),r.up(e)},rel:function(e,n){if(""==n)return e;t.is(arguments,[f,u]);var i=r.splitPath(n),o=e;o=o.replace(/\/$/,"");var s=r;return i.forEach(function(t){".."==t||"../"==t?o=s.up(o):(o=o.replace(/\/$/,""),o+=p+("."==t||"./"==t?"":t))}),o},relPath:function(e,n){return t.is(arguments,[a,a]),e.substring(0,n.length)!=n?"../"+r.relPath(e,this.up(n)):e.substring(n.length)},up:function(t){if(t==p)return null;var e=r.splitPath(t);return e.pop(),e.join(p)+p}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(t){var e=r[t];r[t]=function(){var t=!1,n=Array.prototype.slice.call(arguments).map(function(e){return r.hasBackslashSep(e)?(t=!0,r.fixSep(e)):e}),i=e.apply(r,n);return t?r.fixSep(i,"\\"):i}}),r.isAbsolute=r.isAbsolutePath,r.isRelative=r.isRelativePath,"object"==typeof window&&(window.PathUtil=r),r}),t("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".wav":"audio/x-wav",".mp3":"audio/mp3",".ogg":"audio/ogg",".midi":"audio/midi",".mid":"audio/midi",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu",".c":"text/c",".dtl":"text/dolittle"}}),t("DeferredUtil",[],function(){var t,e="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:null,n=function(t){this.res=t};return t={isNativePromise:function(t){return t&&"function"==typeof t.then&&"function"!=typeof t.promise&&"function"==typeof t.catch},isJQPromise:function(t){return t&&"function"==typeof t.then&&"function"==typeof t.promise&&"function"==typeof t.fail},isPromise:function(t){return t&&"function"==typeof t.then&&("function"==typeof t.promise||"function"==typeof t.catch)},all:function(e){return t.promise(function(n,r){var i=[],o=e.length;e.forEach(function(e,s){t.resolve(e).then(function(t){i[s]=t,o--,0===o&&n(i)},r)})})},resolve:function(e){return t.config.useJQ&&t.isJQPromise(e)?e:!t.config.useJQ&&t.isNativePromise(e)?e:t.promise(function(n,r){t.isPromise(e)?e.then(n,r):n(e)})},throwNowIfRejected:function(e){var n,r,i=e.then(function(t){return n||(n="resolved"),t},function(e){return n?t.reject(e):(n="rejected",void(r=e))});if(n||(n="notyet"),"rejected"===n)throw r;return i},assertResolved:function(t){var e,n;if(t.then(function(t){e=t,n=!0}),!n)throw console.log(r),new Error("Promise not resolved");return e},ensureDefer:function(e){return t.promise(function(n,r){var i;t.resolve(e).then(function(t){i?n(t):setTimeout(function(){n(t)},0)}).fail(function(t){i?r(t):setTimeout(function(){r(t)},0)}),i=!0})},directPromise:function(e){return t.timeout(e,0)},then:function(e){return t.directPromise().then(e)},timeout:function(e,n){return t.promise(function(t){setTimeout(function(){t(n)},e||0)})},funcPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;try{e(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(r){n.reject(r)}return n.promise()}if(t.external.Promise)return new t.external.Promise(function(t,n){try{e(t,n)}catch(r){n(r)}});throw new Error("promise is not found")},reject:function(e){if(t.config.useJQ){var n=new $.Deferred;return n.reject(e),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(e)},0),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(n){return console.log(n,n.stack),t.throwPromise(n)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(r){return r>=e.length?t.brk():t.resolve(n(e[r],r)).then(function(){return r+1})},0);var r=[];for(var i in e)r.push({k:i,v:e[i]});return t.each(r,function(t){return n(t.k,t.v)})},loop:function(e,r){try{for(var i;;){if(r instanceof n)return t.when1(r.res);var o=!0,s=!1,a=e(r),u=t.resolve(a).then(function(i){return r=i,o=!1,r instanceof n?r.res:s?t.loop(e,r):void 0}).fail(function(t){o=!1,i=t});if(i)throw i;if(s=!0,o)return u}}catch(c){return t.reject(c)}},brk:function(t){return new n(t)},tryLoop:function(e,n){return t.loop(t.tr(e),n)},tryEach:function(e,n){return t.loop(e,t.tr(n))},documentReady:function(){return t.callbackToPromise(function(t){$(t)})},requirejs:function(n){if(!e.requirejs)throw new Error("requirejs is not loaded");return t.callbackToPromise(function(t){e.requirejs(n,t)})}},t.NOP=function(t){return t},t.E=function(){console.log("DUE",arguments),t.errorHandler.apply(t,arguments)},t.errorHandler=function(t){console.error.apply(console,arguments),alert(t)},t.setE=function(e){t.errorHandler=e},t.begin=t.try=t.tr=t.throwF,t.promise=t.callbackToPromise=t.funcPromise,t.when1=t.resolve,t.config={},e.$&&e.$.Deferred&&(t.config.useJQ=!0),t.external={Promise:e.Promise},e.DeferredUtil||(e.DeferredUtil=t),t}),t("FSClass",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(t,e,n,r,i){function o(t){throw new Error(t+" is STUB!")}var s=function(){},a={};return s.addFSType=function(t,e){a[t]=e},s.availFSTypes=function(){return a},t(s.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},isReadOnly:function(){o("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(t){return r(this.getRootFS()!==this),this.getRootFS().resolveFS(t)},mounted:function(t,e){this.rootFS=t,this.mountPoint=e},inMyFS:function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},getRootFS:function(){return r(this.rootFS,"rootFS is not set")},getReturnTypes:function(){o("")},getContent:function(){o("getContent")},getContentAsync:function(){return this.supportsSync()||o("getContentAsync"),i.resolve(this.getContent.apply(this,arguments))},setContent:function(){o("")},setContentAsync:function(t,e,n){var r=this;return r.supportsSync()||o("setContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.setContent(t,e,n))})},appendContent:function(){o("")},appendContentAsync:function(t,e,n){var r=this;return r.supportsSync()||o("appendContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.appendContent(t,e,n))})},getMetaInfo:function(){o("")},setMetaInfo:function(){o("")},mkdir:function(){o("mkdir")},touch:function(){o("touch")},exists:function(){o("exists")},opendir:function(){o("opendir")},opendirAsync:function(){return this.supportsSync()||o("opendirAsync"),i.resolve(this.opendir.apply(this,arguments))},cp:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),i=i||{};var o=this.isDir(t),s=this.getRootFS().resolveFS(n),a=s.isDir(n);if(o||a)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(t),c=s.setContent(n,u);return i.a&&s.setMetaInfo(n,this.getMetaInfo(t)),c}return s.setContentAsync(n,this.getContentAsync(t)).then(function(e){return i.a?s.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(){o("")},link:function(t,e){throw new Error("ln "+e+" "+t+" : This FS not support link.")},getURL:function(){o("")}}),s.delegateMethods=function(t,n){for(var i in n)!function(i){r.ne(i,"inMyFS"),t[i]=function(){var t=arguments[0];r.is(t,e.Absolute);var o=this.resolveFS(t);return o!==this?(console.log("Invoked for other fs",this.mountPoint,o.mountPoint),o[i].apply(o,arguments)):n[i].apply(this,arguments)}}(i)},s.delegateMethods(s.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},getContentType:function(t,r){var i=(e.ext(t)+"").toLowerCase();return n[i]||(r||{}).def||"application/octet-stream"},getBlob:function(t,e){var n=this.getContent(t);return e=e||{},e.blobType=e.blobType||Blob,e.binType=e.binType||ArrayBuffer,n.hasPlainText()?new e.blobType([n.toPlainText()],this.getContentType(t)):new e.blobType([n.toBin(e.binType)],this.getContentType(t))},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t){return e.isDir(t)},find:function(t,n){r.is(arguments,[e.Absolute]);var i=this.opendir(t,n),o=this,s=[t];return i.forEach(function(r){var i=e.rel(t,r);if(e.isDir(i)){var a=o.resolveFS(i);s=s.concat(a.find(i,n))}else s.push(i)}),s},resolveLink:function(t){r.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){r(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var o=e.rel(i,e.relPath(t,n));return r(o!=t,"np==path=="+o),r.is(this.getRootFS().resolveFS(o).resolveLink(o),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(){return null},opendirEx:function(t){r.is(t,e.AbsDir);var n=this.opendir(t),i=this,o={};return n.forEach(function(n){var r=e.rel(t,n);o[n]=i.getMetaInfo(r)}),o},getDirTree:function(t,n){n=n||{};var i=n.dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],r.is(n.excludes,Array),n.base||(n.base=t),r.is(t,e.AbsDir);var o=this.opendirEx(t,n);if("no-recursive"==n.style)return o;var s=this;for(var a in o){var u=o[a],c=e.rel(t,a),f=e.relPath(c,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(f)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(c)>=0)continue}if(s.isDir(c))switch(n.style){case"flat-absolute":case"flat-relative":s.getDirTree(c,n);break;case"hierarchical":n.dest={},i[a]=s.getDirTree(c,n)}else switch(n.style){case"flat-absolute":i[c]=u;break;case"flat-relative":i[f]=u;break;case"hierarchical":i[a]=u}}return i}}),s}),t("Util",[],function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:e(i[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function r(t,e){return t.substring(0,e.length)===e}function i(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){var e=r.apply(t,arguments);return e})}(n);return e}function o(t,e){for(var n in e||{})t[n]=e[n];return t}return{getQueryString:t,endsWith:n,startsWith:r,privatize:i,extend:o}}),t("Content",["assert","Util"],function(t,e){var n=function(){},r=e.extend;n.plainText=function(t,e){var r=new n;return r.contentType=e||"text/plain",r.plain=t,r},n.url=function(t){var e=new n;return e.url=t,e},n.buffer2ArrayBuffer=function(e){if(n.isBuffer(e)){var r=new Uint8Array(e),i=r.buffer;if(i instanceof ArrayBuffer)return i;var o=Array.prototype.slice.call(r);return t(new Uint8Array(o).buffer,"n2a: buf is not set")}return t(e,"n2a: a is not set")},n.arrayBuffer2Buffer=function(e){if(e instanceof ArrayBuffer){var n=new Buffer(new Uint8Array(e));return n}return t(e,"a2n: a is not set")},n.bin=function(e,r){t(r,"contentType should be set");var i=new n;if(e&&n.isBuffer(e.buffer))i.arrayBuffer=e.buffer;else if(n.isNodeBuffer(e))i.nodeBuffer=e;else{if(!(e instanceof ArrayBuffer))throw new Error(e+" is not a bin");i.arrayBuffer=e}return i.contentType=r,i},n.looksLikeDataURL=function(t){return t.match(/^data:/)};var i=n.prototype;i.toBin=function(t){if(t=t||(n.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return t===Buffer?this.nodeBuffer:this.arrayBuffer=n.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return t===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=n.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var e=new s(this.url,t);return this.setBuffer(e.buffer)}if(null!=this.plain)return this.setBuffer(n.str2utf8bytes(this.plain,t));throw new Error("No data")},i.setBuffer=function(e){return t(e,"b is not set"),n.isNodeBuffer(e)?this.nodeBuffer=e:this.arrayBuffer=e},i.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},i.toNodeBuffer=function(){return this.toBin(Buffer)},i.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=n.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var t=new s(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=t.url}throw new Error("No data")},i.toPlainText=function(){if(this.hasPlainText())return this.plain;if(this.url&&!this.hasBin()){var t=new s(this.url,ArrayBuffer);this.arrayBuffer=t.buffer}if(this.hasBin())return this.plain=n.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},i.hasURL=function(){return this.url},i.hasPlainText=function(){return null!=this.plain},i.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},i.hasNodeBuffer=function(){return this.nodeBuffer},i.hasArrayBuffer=function(){return this.arrayBuffer},n.Base64_To_ArrayBuffer=function(t,e){function r(e){throw console.log(e),console.log(t,p),new Error(e)}var i=e||ArrayBuffer;t=t.replace(/[\n=]/g,"");var o=new Object;o[65]=0,o[66]=1,o[67]=2,o[68]=3,o[69]=4,o[70]=5,o[71]=6,o[72]=7,o[73]=8,o[74]=9,o[75]=10,o[76]=11,o[77]=12,o[78]=13,o[79]=14,o[80]=15,o[81]=16,o[82]=17,o[83]=18,o[84]=19,o[85]=20,o[86]=21,o[87]=22,o[88]=23,o[89]=24,o[90]=25,o[97]=26,o[98]=27,o[99]=28,o[100]=29,o[101]=30,o[102]=31,o[103]=32,o[104]=33,o[105]=34,o[106]=35,o[107]=36,o[108]=37,o[109]=38,o[110]=39,o[111]=40,o[112]=41,o[113]=42,o[114]=43,o[115]=44,o[116]=45,o[117]=46,o[118]=47,o[119]=48,o[120]=49,o[121]=50,o[122]=51,o[48]=52,o[49]=53,o[50]=54,o[51]=55,o[52]=56,o[53]=57,o[54]=58,o[55]=59,o[56]=60,o[57]=61,o[43]=62,o[47]=63;var s,a=t.length,u=0,c=0;if(!a)return new i(0);s=Math.floor(a/4*3),"="==t.charAt(a-1)&&(s-=1),"="==t.charAt(a-2)&&(s-=1);for(var f=new i(s),l=n.isNodeBuffer(f)?f:new Uint8Array(f),p=0,h=0;s>h&&(c=o[t.charCodeAt(p)],void 0===c&&r("Invalid letter: "+t.charCodeAt(p)),u=c<<2,p++,c=o[t.charCodeAt(p)],void 0===c&&r("Invalid letter: "+t.charCodeAt(p)),l[h]=u|c>>4&3,u=(15&c)<<4,p++,h++,!(h>=s))&&(c=o[t.charCodeAt(p)],void 0===c&&r("Invalid letter: "+t.charCodeAt(p)),l[h]=u|c>>2&15,u=(3&c)<<6,p++,h++,!(h>=s));)c=o[t.charCodeAt(p)],void 0===c&&r("Invalid letter: "+t.charCodeAt(p)),l[h]=u|c,p++,h++;return f},n.Base64_From_ArrayBuffer=function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,s=0,a=0;i>a&&(s=r[a],n+=e[s>>2],o=(3&s)<<4,a++,!(a>=i))&&(s=r[a],n+=e[o|s>>4],o=(15&s)<<2,a++,!(a>=i));)s=r[a],n+=e[o|s>>6],n+=e[63&s],a++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n},n.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},n.isNodeBuffer=function(t){return n.hasNodeBuffer()&&t instanceof Buffer},n.isBuffer=function(t){return t instanceof ArrayBuffer||n.isNodeBuffer(t)},n.utf8bytes2str=function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));return decodeURIComponent(e.join(""))},n.str2utf8bytes=function(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer};var o=n.hasNodeBuffer()?Buffer:ArrayBuffer,s=function(e,r){"string"==typeof e?(this.url=e,this.binType=r||o,this.dataURL2bin(e)):e&&n.isBuffer(e.buffer)?(this.buffer=e.buffer,t.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):n.isBuffer(e)?(this.buffer=e,t.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),t.fail("Invalid args: ",arguments))};return n.DataURL=s,r(s.prototype,{bin2dataURL:function(e,r){t(n.isBuffer(e)),t.is(r,String);var i=this.dataHeader(r),o=n.Base64_From_ArrayBuffer(e);return t.is(o,String),this.url=i+o},dataURL2bin:function(e){t.is(arguments,[String]);var r=/^data:([^;]+);base64,/i,i=r.exec(e);return t(i,["malformed dataURL:",e]),this.contentType=i[1],this.buffer=n.Base64_To_ArrayBuffer(e.substring(i[0].length),this.binType),t.is(this.buffer,this.binType)},dataHeader:function(e){return t.is(arguments,[String]),"data:"+e+";base64,"},toString:function(){return t.is(this.url,String)}}),n}),t("NativeFS",["FSClass","assert","PathUtil","extend","Content"],function(t,e,n,r,i){var o="object"==typeof process;if(!o)return function(){throw new Error("This system not support native FS")};var s=e,a=require("fs"),u=function(t){t&&(e.is(t,n.AbsDir),this.rootPoint=t)},c=n.hasDriveLetter(process.cwd());u.available=!0;var f=n.SEP,l=u.prototype=new t;return l.toNativePath=function(t){return this.rootPoint?(e.is(t,n.Absolute),e(this.inMyFS(t),t+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(t,this.mountPoint||n.SEP))):t},l.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var e=new Buffer(new Uint8Array(t));return e}return t},t.addFSType("NativeFS",function(t,e){return new u(e.r)}),u.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},u.prototype.inMyFS=function(t){return this.mountPoint?n.startsWith(t,this.mountPoint):!(!!c^!!n.hasDriveLetter(t))},t.delegateMethods(u.prototype,{getReturnTypes:function(){return s.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,r){r=r||{},e.is(t,n.Absolute);var o=this.toNativePath(t);return this.assertExist(t),i.bin(a.readFileSync(o),this.getContentType(t))},setContent:function(t,r){e.is(arguments,[n.Absolute,i]);var o=n.up(t);o&&this.getRootFS().resolveFS(o).mkdir(o);var s=this.toNativePath(t);r.hasBin()||!r.hasPlainText()?a.writeFileSync(s,r.toNodeBuffer()):a.writeFileSync(s,r.toPlainText())},appendContent:function(t,r){e.is(arguments,[n.Absolute,i]);var o=n.up(t);o&&this.getRootFS().resolveFS(o).mkdir(o);var s=this.toNativePath(t);r.hasBin()||!r.hasPlainText()?a.appendFileSync(s,r.toNodeBuffer()):a.appendFileSync(s,r.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(){},isReadOnly:function(){return!1},stat:function(t){e.is(t,n.Absolute);var r=this.toNativePath(t);return a.statSync(r)},mkdir:function(t){if(s.is(arguments,[n.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var e=n.up(t);e&&this.getRootFS().resolveFS(e).mkdir(e);var r=this.toNativePath(t);return a.mkdirSync(r),this.assertExist(r)},opendir:function(t,e){s.is(arguments,[String]),e=e||{};var r=this.toNativePath(t),i=n.truncSEP(r),o=a.readdirSync(r);e.nosep||(o=o.map(function(t){var e=a.statSync(i+f+t),n=e.isDirectory()?f:"";return t+n}));var u=[];return s.is(u.concat(o),Array)},rm:function(t,e){s.is(arguments,[n.Absolute]),e=e||{},this.assertExist(t);var r=this.toNativePath(t);return this.isDir(t)?a.rmdirSync(r):a.unlinkSync(r)},exists:function(t){var e=this.toNativePath(t);return a.existsSync(e)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():n.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&a.utimesSync(t,Date.now()/1e3,Date.now()/1e3)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")}}),u}),t("LSFS",["FSClass","PathUtil","extend","assert","Util","Content"],function(t,e,n,r,i,o){function s(){return(new Date).getTime()}var a=function(t,e){r(t," new LSFS fail: no storage"),this.storage=t,this.options=e||{},this.options.useDirCache&&(this.dirCache={})},u=e.isDir.bind(e),c=e.up.bind(e),f=e.endsWith.bind(e),l=(e.Path,e.Absolute),p=e.SEP;return a.ramDisk=function(t){var n={};return n[e.SEP]="{}",t=t||{},"useDirCache"in t||(t.useDirCache=!0),new a(n,t)},t.addFSType("localStorage",function(t,e){return new a(localStorage,e)}),t.addFSType("ram",function(t,e){return a.ramDisk(e)}),a.now=s,a.prototype=new t,a.prototype.resolveKey=function(t){return r.is(t,e.Absolute),this.mountPoint?e.SEP+e.relPath(t,this.mountPoint):t},a.prototype.getItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},a.prototype.setItem=function(t,n){r.is(t,e.Absolute);var i=this.resolveKey(t);r(i.indexOf("..")<0),r(e.startsWith(i,e.SEP)),this.storage[i]=n},a.prototype.removeItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},a.prototype.itemExists=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return r(this.storage,"No storage"),n in this.storage},a.prototype.getDirInfo=function(t){if(r.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");if(f(t,p)||(t+=p),r(this.inMyFS(t)),this.dirCache&&this.dirCache[t])return this.dirCache[t];var n={};try{var i=this.getItem(t);i&&(n=JSON.parse(i))}catch(o){console.log("dinfo err : ",t,i)}return this.dirCache&&(this.dirCache[t]=n),n},a.prototype.putDirInfo=function(t,n,i){if(r.is(arguments,[e.AbsDir,Object]),!u(t))throw new Error("Not a directory : "+t);r(this.inMyFS(t)),this.dirCache&&(this.dirCache[t]=n),this.setItem(t,JSON.stringify(n));var o=c(t);if(null!=o&&this.inMyFS(o)){var s=this.getDirInfo(o);this._touch(s,o,e.name(t),i)}},a.prototype._touch=function(t,n,i,o){r.is(arguments,[Object,String,String]),r(this.inMyFS(n)),t[i]||(t[i]={},o&&(t[i].trashed=!0)),o||delete t[i].trashed,t[i].lastUpdate=s(),this.getRootFS().notifyChanged(e.rel(n,i),t[i]),this.putDirInfo(n,t,o)},a.prototype.removeEntry=function(t,e,n){r.is(arguments,[Object,String,String]),t[n]&&(t[n]={lastUpdate:s(),trashed:!0},this.putDirInfo(e,t,!0))
},a.prototype.removeEntryWithoutTrash=function(t,e,n){r.is(arguments,[Object,String,String]),t[n]&&(delete t[n],this.putDirInfo(e,t,!0))},a.prototype.isRAM=function(){return this.storage!==localStorage},a.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},a.getUsage=function(){var t=0;for(var e in localStorage)"string"==typeof localStorage[e]&&(t+=localStorage[e].length);return t},a.getCapacity=function(){function t(){try{return localStorage[r+e]=n,e++,i+=n.length,!0}catch(t){return delete localStorage[r+e],!1}}var e=0,n="a",r="___checkls___",i=0,o=Math.pow(2,25);try{for(var s=0;10>s;s++)n+=n;for(var s in localStorage)s.substring(0,r.length)==r?delete localStorage[s]:"string"==typeof localStorage[s]&&(i+=localStorage[s].length);for(var a=i;t()&&n.length<o;)n+=n;for(;n.length>1024;)n=n.substring(n.length/2),t();return{using:a,max:i}}finally{for(var s=0;e>s;s++)delete localStorage[r+s]}},t.delegateMethods(a.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t){r.is(arguments,[l]),this.assertExist(t);var e,n=this.getItem(t);return e=o.looksLikeDataURL(n)?o.url(n):o.plainText(n)},setContent:function(t,e){r.is(arguments,[l,o]),this.assertWriteable(t);var n=null;e.hasPlainText()&&(n=e.toPlainText(),o.looksLikeDataURL(n)&&(n=null)),null!=n?this.setItem(t,n):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t){if(this.assertExist(t,{includeTrashed:!0}),r.is(arguments,[l]),t==e.SEP)return{};var n=r(e.up(t));if(!this.inMyFS(n))return{};var i=e.name(t);r.is(n,e.AbsDir);var o=this.getDirInfo(n);return r(o[i])},setMetaInfo:function(t,n){r.is(arguments,[String,Object]),this.assertWriteable(t);var i=r(e.up(t));if(this.inMyFS(i)){var o=this.getDirInfo(i),s=e.name(t);o[s]=n,this.putDirInfo(i,o,o[s].trashed)}},mkdir:function(t){r.is(arguments,[l]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){r.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),i=[];for(var o in n)r(n[o]),(!n[o].trashed||e.includeTrashed)&&i.push(o);return r.is(i,Array)},rm:function(t,n){r.is(arguments,[l]),n=n||{},this.assertWriteable(t);var i=e.up(t);if(null==i||!this.inMyFS(i))throw new Error(t+": cannot remove. It is root of this FS.");if(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t)){var o=this.opendir(t);o.length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)}else this.removeItem(t);var s=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(s,i,e.name(t)):this.removeEntry(s,i,e.name(t))},exists:function(t,n){r.is(arguments,[l]),n=n||{};var i=e.name(t),o=e.up(t);if(null==o||!this.inMyFS(o))return!0;var s=this.getDirInfo(o),a=s[i];return a&&a.trashed&&this.itemExists(t)&&this.isDir(t),!a&&this.itemExists(t),a&&!a.trashed&&!a.link&&!this.itemExists(t),a&&!n.includeTrashed&&(a=!a.trashed),!!a},link:function(t,n){r.is(arguments,[e.Absolute,e.Absolute]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var i={};i.link=n,i.lastUpdate=s(),this.setMetaInfo(t,i),r(this.exists(t)),r(this.isLink(t))},isLink:function(t){if(r.is(arguments,[e.Absolute]),!this.exists(t))return null;var n=r(this.getMetaInfo(t));return n.link},touch:function(t){r.is(arguments,[l]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?(this.dirCache&&(this.dirCache[t]={}),this.setItem(t,"{}")):this.setItem(t,""));var n=c(t);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,e.name(t),!1)}else r(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(t){return this.getContent(t).toURL()},opendirEx:function(t,n){r.is(t,e.AbsDir),n=n||{};var i={},o=this.getDirInfo(t);if(n.includeTrashed)return o;for(var s in o)o[s].trashed||(i[s]=o[s]);return i}}),a}),$.ajaxTransport("+binary",function(t,e,n){return window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob))?{send:function(e,n){var r=new XMLHttpRequest,i=t.url,o=t.type,s=t.async||!0,a=t.responseType||"blob",u=t.data||null,c=t.username||null,f=t.password||null;r.addEventListener("load",function(){var e={};e[t.dataType]=r.response,n(r.status,r.statusText,e,r.getAllResponseHeaders())}),r.open(o,i,s,c,f);for(var l in e)r.setRequestHeader(l,e[l]);r.responseType=a,r.send(u)},abort:function(){n.abort()}}:void 0}),t("jquery.binarytransport",function(){}),t("WebFS",["FSClass","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(t,e,n,r,i){var o=function(){},s=o.prototype=new t;return t.addFSType("web",function(){return new o}),s.fstype=function(){return"Web"},s.supportsSync=function(){return!1},s.inMyFS=function(t){return i.isURL(t)},t.delegateMethods(s,{exists:function(){return!0},getContentAsync:function(t){var e=this;return n.promise(function(n,i){$.get(t,function(i){var o=new FileReader;o.addEventListener("loadend",function(){n(r.bin(o.result,e.getContentType(t)))}),o.readAsArrayBuffer(i)},"binary").fail(i)})},getURL:function(t){return t}}),o}),t("Env",["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),n=n.replace(/^[a-z][a-z]+:\//,function(t){return t+"/"}),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n});var s=s||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,n=e.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in n,i=function(n){var r=e.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},o=t.webkitRequestFileSystem,s=t.requestFileSystem||o||t.mozRequestFileSystem,a=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},u=0,c=function(e){var n=function(){"string"==typeof e?(t.URL||t.webkitURL||t).revokeObjectURL(e):e.remove()};t.chrome?n():setTimeout(n,10)},f=function(t,e,n){e=[].concat(e);for(var r=e.length;r--;){var i=t["on"+e[r]];if("function"==typeof i)try{i.call(t,n||t)}catch(o){a(o)}}},l=function(e,a){var l,p,h,d=this,g=e.type,m=!1,v=function(){f(d,["writestart","progress","write","writeend"])},y=function(){(m||!l)&&(l=(t.URL||t.webkitURL||t).createObjectURL(e)),p?p.location.href=l:void 0==t.open(l,"_blank")&&"undefined"!=typeof safari&&(t.location.href=l),d.readyState=d.DONE,v(),c(l)},b=function(t){return function(){return d.readyState!==d.DONE?t.apply(this,arguments):void 0}},w={create:!0,exclusive:!1};d.readyState=d.INIT,a||(a="download"),r?(l=(t.URL||t.webkitURL||t).createObjectURL(e),n.href=l,n.download=a,i(n),d.readyState=d.DONE,v(),c(l)):(t.chrome&&g&&"application/octet-stream"!==g&&(h=e.slice||e.webkitSlice,e=h.call(e,0,e.size,"application/octet-stream"),m=!0),o&&"download"!==a&&(a+=".download"),("application/octet-stream"===g||o)&&(p=t),s?(u+=e.size,s(t.TEMPORARY,u,b(function(t){t.root.getDirectory("saved",w,b(function(t){var n=function(){t.getFile(a,w,b(function(t){t.createWriter(b(function(n){n.onwriteend=function(e){p.location.href=t.toURL(),d.readyState=d.DONE,f(d,"writeend",e),c(t)},n.onerror=function(){var t=n.error;t.code!==t.ABORT_ERR&&y()},["writestart","progress","write","abort"].forEach(function(t){n["on"+t]=d["on"+t]}),n.write(e),d.abort=function(){n.abort(),d.readyState=d.DONE},d.readyState=d.WRITING}),y)}),y)};t.getFile(a,{create:!1},b(function(t){t.remove(),n()}),b(function(t){t.code===t.NOT_FOUND_ERR?n():y()}))}),y)}),y)):y())},p=l.prototype;return p.abort=function(){this.readyState=this.DONE,f(this,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,function(t,e){return new l(t,e)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=s:"undefined"!=typeof t&&null!==t&&null!=t.amd&&t("FileSaver.min",[],function(){return s}),t("SFile",["extend","assert","PathUtil","Util","Content","FSClass","FileSaver.min","DeferredUtil"],function(t,e,n,r,i,o,a,u){var c=function(t,r){e.is(r,n.Absolute),this._path=r,this.rootFS=t,this.fs=t.resolveFS(r),this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return c.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},c.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},getPolicy:function(){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(t,i){var o;if(i=i||{},c.is(t))o=t;else{e.is(t,n.Absolute);var s,a=i.policy||this.policy;if(a&&(s=a.topDir)&&(s.path&&(s=s.path()),!n.startsWith(t,s)))throw new Error(t+": cannot access. Restricted to "+s);o=new c(this.rootFS,t),o.policy=a}return o.policy?r.privatize(o):o},contains:function(t){return e(c.is(t),t+" shoud be a SFile object."),this.isDir()?n.startsWith(t.path(),this.path()):!1},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var r=t.path?t.path():t;return n.relPath(this.path(),e.is(r,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,t))},sibling:function(t){return this.up().rel(t)},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var t=this.metaInfo();return t?t.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.act.fs.getMetaInfo(this.act.path,t)},setMetaInfo:function(t,e){return this.act.fs.setMetaInfo(this.act.path,t,e)},getDirTree:function(t){return this.act.fs.getDirTree(this.act.path,t)},assertExists:function(){e(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(t){var e=Array.prototype.slice.call(arguments);if("function"==typeof e[0]){var n=e.shift();return u.resolve(this.exists.apply(this,e)).then(n)}t=t||{};var r=this.fs.exists(this.path(),t);return r||t.noFollowLink?r:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(t){var e=this;if(t=t||{},this.isLink())return u.resolve(this.fs.rm(this.path(),t));var n;return n=this.isDir()&&(t.recursive||t.r)?this.each(function(e){return e.rm(t)}):u.resolve(),n.then(function(){return e.act.fs.rm(e.act.path,t)})},removeWithoutTrash:function(t){t=t||{},t.noTrash=!0,this.rm(t)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(t){return"function"==typeof t?this.getText(t):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(t){if(e.is(t,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());var n=this.contentType({def:null});return u.throwNowIfRejected(null!==n&&!n.match(/^text/)&&i.looksLikeDataURL(t)?this.setContent(i.url(t)):this.setContent(i.plainText(t)))},appendText:function(t){return e.is(t,String),this.act.fs.appendContent(this.act.path,i.plainText(t))},getContent:function(t){return"function"==typeof t?this.act.fs.getContentAsync(this.act.path).then(t):this.act.fs.getContent(this.act.path)},setContent:function(t){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,t)},getText:function(t){function e(t){try{return t.toPlainText()}catch(e){return t.toURL()}}if("function"==typeof t){return this.getContent(e).then(t)}return e(this.act.fs.getContent(this.act.path))},getDataURL:function(t){return"function"==typeof t?this.getContent(function(t){return t.toURL()}):this.getContent().toURL()},setDataURL:function(t){return this.setContent(i.url(t))},dataURL:function(t){return"string"==typeof t?this.setDataURL(t):"function"==typeof t?this.getDataURL(t):this.getDataURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(t){return this.act.fs.getContentType(this.act.path,t)},bytes:function(t){return i.isBuffer(t)?this.setBytes(t):this.getBytes()},setBytes:function(t){return this.act.fs.setContent(this.act.path,i.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.act.fs.getContent(this.act.path).toBin(t.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(){return this.text().replace(/\r/g,"").split("\n")},obj:function(){var t=this;if(0==arguments.length){var n=t.text();return n?JSON.parse(n):null}t.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,n){e(t&&t.isSFile(),t+" is not a file");var r=this,n=n||{},i=r.isDir(),o=t.isDir();if(!i&&o&&(t=t.rel(r.name()),e(!t.isDir(),t+" is a directory."),o=!1),!i||o){if(i||o)return e(i&&o,"Both src and dst should be dir"),r.each(function(e){var r,i=t.rel(e.name());return n.progress&&(r=n.progress(i,{src:e,dst:i})),u.resolve(r).then(function(){return i.copyFrom(e,n)})});n.echo&&n.echo(r+" -> "+t);var s=this.act.fs.cp(this.act.path,t.getResolvedLinkPath(),n);return s=u.resolve(s),n.a?s.then(function(){return t.setMetaInfo(r.getMetaInfo())}):s}this.err("Cannot move dir "+r.path()+" to file "+t.path())},moveFrom:function(t,e){var n=this;return n.exists(function(r){return n.copyFrom(t,e).then(function(){return t.rm({recursive:!0})},function(t){if(!r)return n.exists(function(t){return t?n.rm({recursive:!0}):void 0}).then(function(){throw t});throw t})})},moveTo:function(t,e){return t.moveFrom(this,e)},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){var n=this.assertDir();return n.listFilesAsync(e).then(function(e){return u.each(e,t)})},eachrev:function(t,e){var n=this.assertDir();return n.listFilesAsync(e).then(function(e){return u.each(e.reverse(),t)})},recursive:function(t,e){var n=this.assertDir();return n.each(function(e){return e.isDir()?e.recursive(t):t(e)},e)},listFilesAsync:function(t){e(null==t||"object"==typeof t);var n,r=this.assertDir(),i=this.path();return t=r.convertOptions(t),n||(n=t.order),this.act.fs.opendirAsync(this.act.path,t).then(function(e){for(var o=[],s=0;s<e.length;s++){var a=e[s];t.excludes[i+a]||o.push(r.rel(a))}return"function"==typeof n&&o.sort&&o.sort(n),o})},listFiles:function(t){var e=Array.prototype.slice.call(arguments);return u.assertResolved(this.listFilesAsync.apply(this,e))},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir();if(!t)return this.act.fs.opendir(this.act.path,t);var r=n.listFiles(t);return r.map(function(t){return t.name()})},convertOptions:function(t){var i=r.extend({},t),o=(this.assertDir(),this.path());if(i.excludes||(i.excludes={}),i.excludes instanceof Array){var s={};i.excludes.forEach(function(t){n.startsWith(t,"/")?s[t]=1:s[o+t]=1}),i.excludes=s}return e.is(i,{excludes:{}})},mkdir:function(){return this.touch()},link:function(t,e){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,t.path(),e)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(t){return this.getFS().getRootFS().addObserver(this.path(),t)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},setBlob:function(t){var e=this;return u.promise(function(n){var r=new FileReader;r.addEventListener("loadend",function(){u.resolve(e.setBytes(r.result)).then(n)}),r.readAsArrayBuffer(t)})},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use 'zip' instead.");s(this.getBlob(),this.name())},err:function(){var t=Array.prototype.slice.call(arguments);throw console.log.apply(console,t),new Error(t.join(""))}},Object.defineProperty(c.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),e.is(this._act,{fs:o,path:n.Absolute}),this._act)}}),c}),t("RootFS",["assert","FSClass","PathUtil","SFile"],function(t,e,n,r){var i=function(n){t.is(n,e),this.mount(null,n)},o=i.prototype,s={err:function(t,e){throw new Error(t+": "+e)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(e){t.is(arguments,[n.AbsDir]);var r=this.fstab();console.log(r);for(var i=0;i<r.length;i++)if(r[i].mountPoint==e)return r.splice(i,1),!0;return!1},availFSTypes:function(){return e.availFSTypes()},mount:function(n,r,i){if("string"==typeof r){var o=t(e.availFSTypes()[r],"fstype "+r+" is undefined.");r=o(n,i||{})}t.is(r,e),r.mounted(this,n),this.fstab().unshift(r)},resolveFS:function(r){t.is(r,n.Absolute);var i;return this.fstab().forEach(function(t){i||t.inMyFS(r)&&(i=t)}),i||this.err(r,"Cannot resolve"),t.is(i,e)},get:function(e){return t.is(e,n.Absolute),new r(this.resolveFS(e),e)},addObserver:function(){this.observers=this.observers||[];var e,n;if(2==arguments.length)e=arguments[0],n=arguments[1];else{if(1!=arguments.length)throw new Error("Invalid argument spec");e="",n=arguments[0]}t.is(e,String),t.is(n,Function);var r=this.observers,i={path:e,handler:n,remove:function(){var t=r.indexOf(this);r.splice(t,1)}};return this.observers.push(i),i},notifyChanged:function(t,e){this.observers&&this.observers.forEach(function(r){n.startsWith(t,r.path)&&r.handler(t,e)})},getRootFS:function(){return this}};for(var a in s)o[a]=s[a];return i}),t("zip",["SFile","FileSaver.min","Util","DeferredUtil"],function(t,e,n,r){var i={};return i.setJSZip=function(t){i.JSZip=t,r.external.Promise||(r.external.Promise=t.external.Promise)},"undefined"!=typeof JSZip&&i.setJSZip(JSZip),i.zip=function(e,n,o){function a(t,e){return e.each(function(e){var n=r.resolve();return o.progress&&(n=o.progress(e)),n.then(function(){if(e.isDir()){var n=t.folder(e.name().replace(/[\/\\]$/,""));return a(n,e)}return e.getContent(function(n){t.file(e.name(),n.toArrayBuffer())})})})}t.is(n)||(o=n),o=o||{};var u=new i.JSZip;return a(u,e).then(function(){return r.resolve(u.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(r){return t.is(n)?n.setBytes(r):void s(new Blob([r],{type:"application/zip"}),e.name().replace(/[\/\\]$/,"")+".zip")})},i.unzip=function(e,n,o){var s,a={};o=o||{},t.is(e)&&(s=e.getContent(),e=s.toArrayBuffer()),o.onCheckFile||(o.onCheckFile=function(t){return o.overwrite?t:t.exists()?!1:t});var u=new i.JSZip;return r.resolve(u.loadAsync(e)).then(function(){return r.each(u.files,function(e,i){var s,u;return r.resolve(i.async("arraybuffer")).then(function(t){return s=t,u=n.rel(i.name),o.progress?r.resolve(o.progress(u)):void 0}).then(function(){if(console.log("Inflating",i.name),!u.isDir()){var e={file:u,status:"uploaded"};a[u.path()]=e;var n=FS.Content.bin(s,u.contentType()),r=o.onCheckFile(u,n);return r===!1&&(e.status="cancelled",u=null),t.is(r)&&(u.path()!==r.path()&&(e.redirectedTo=r),u=r),u?u.setContent(n):void 0}})})}).then(function(){return console.log("unzip done",a),a})},i}),t("FS",["FSClass","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil"],function(t,e,n,r,i,o,s,a,u,c,f,l){var p={};p.assert=s,p.Content=c,p.Class=t,p.DeferredUtil=l,p.Env=o,p.LSFS=n,p.NativeFS=e,p.PathUtil=i,p.RootFS=u,p.SFile=a,p.WebFS=r,p.zip=f,"object"==typeof window&&(window.FS=p);var h,d=new o({});return p.addFSType=t.addFSType,p.availFSTypes=t.availFSTypes,p.setEnvProvider=function(t){d=t},p.getEnvProvider=function(){return d},p.setEnv=function(t,e){if("object"==typeof t)for(var n in t)d.set(n,t[n]);else d.set(t,e)},p.getEnv=function(t){return"string"==typeof t?d.get(t):d.value},p.init=function(t){h||(t||(t="object"==typeof process?new e:new n(localStorage)),h=new u(t))},p.getRootFS=function(){return p.init(),h},p.get=function(){return p.init(),h.get.apply(h,arguments)},p.expandPath=function(){return d.expandPath.apply(d,arguments)},p.resolve=function(t,e){return p.init(),a.is(t)?t:(t=d.expandPath(t),e&&!i.isAbsolutePath(t)?(e=d.expandPath(e),p.get(e).rel(t)):p.get(t))},p.mount=function(){return p.init(),h.mount.apply(h,arguments)},p.unmount=function(){return p.init(),h.unmount.apply(h,arguments)},p.isFile=function(t){return a.is(t)},p});var a;return e(["FS"],function(t){a=t}),void 0===window.FS&&(window.FS=a),a}),requireSimulator.setName("HttpHelper"),requireSimulator.setName("Arrow"),Arrow=function(){var t={};return t.show=function(t){function e(){t.addClass("tutorial-highlight"),setTimeout(n,200)}function n(){t.removeClass("tutorial-highlight"),o-->0?setTimeout(e,200):r()}function r(){o=0,$.data(t[0],"blinking","f")}if("string"==typeof t&&(t=$(t)),0==t.length)return!1;var i=$.data(t[0],"blinking");if("t"!=i){$.data(t[0],"blinking","t");var o=3;e(),t.click(function(){r()})}},t.showOld=function(t){function e(){r&&(r.attr({src:"images/arrow"+i+".png"}),i=(i+1)%4)}if("string"==typeof t&&(t=$(t)),0==t.length)return!1;var n=t.offset(),r=$("<img>").attr({src:"images/arrow0.png"}).css({font:"40px",position:"absolute",left:n.left,top:n.top+t.height(),color:"red",zIndex:1e3,"z-index":1e3}).appendTo("body"),i=0;return setInterval(e,250),t.click(function(){r&&(r.remove(),r=null)}),!0},t}(),requireSimulator.setName("Util"),Util=function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:e(i[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function r(t,e){return t.substring(0,e.length)===e}function i(t){function e(e){throw console.log(e),console.log(t,c),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var r,i=t.length,o=0,s=0;if(!i)return new ArrayBuffer(0);r=Math.floor(i/4*3),"="==t.charAt(i-1)&&(r-=1),"="==t.charAt(i-2)&&(r-=1);for(var a=new ArrayBuffer(r),u=new Uint8Array(a),c=0,f=0;r>f&&(s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),o=s<<2,c++,s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),u[f]=o|s>>4&3,o=(15&s)<<4,c++,f++,!(f>=r))&&(s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),u[f]=o|s>>2&15,o=(3&s)<<6,c++,f++,!(f>=r));)s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),u[f]=o|s,c++,f++;return a}function o(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,s=0,a=0;i>a&&(s=r[a],n+=e[s>>2],o=(3&s)<<4,a++,!(a>=i))&&(s=r[a],n+=e[o|s>>4],o=(15&s)<<2,a++,!(a>=i));)s=r[a],n+=e[o|s>>6],n+=e[63&s],a++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n}function s(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){var e=r.apply(t,arguments);return e})}(n);return e}function a(){return"undefined"!=typeof Buffer}function u(t){return a()&&t instanceof Buffer}function c(t){return t instanceof ArrayBuffer||u(t)}function f(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(r){throw console.log(e.join("")),r}}function l(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer}return{getQueryString:t,endsWith:n,startsWith:r,Base64_To_ArrayBuffer:i,Base64_From_ArrayBuffer:o,utf8bytes2str:f,str2utf8bytes:l,privatize:s,hasNodeBuffer:a,isNodeBuffer:u,isBuffer:c}}(),requireSimulator.setName("Platform"),define([],function(){var t={},e=window.navigator.userAgent.toLowerCase();return t.tablet=-1!=e.indexOf("windows")&&-1!=e.indexOf("touch")||-1!=e.indexOf("ipad")||-1!=e.indexOf("android")&&-1==e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("tablet")||-1!=e.indexOf("kindle")||-1!=e.indexOf("silk")||-1!=e.indexOf("playbook"),t.mobile=-1!=e.indexOf("windows")&&-1!=e.indexOf("phone")||-1!=e.indexOf("iphone")||-1!=e.indexOf("ipod")||-1!=e.indexOf("android")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("blackberry"),t}),requireSimulator.setName("WebSite"),define(["FS","Platform"],function(t,e){var n,r=t.PathUtil,i=document.location.href,o=!!i.match(/html\/dev\//)&&!!i.match(/localhost:3/),s=location.protocol;switch(s.match(/^http/)||(s="https:"),window.WebSite_runType){case"IDE":return n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},n.builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/neko.png":1,"images/mapchip.png":1,"images/inputPad.png":1},n.pluginTop||(n.pluginTop=n.top+"/js/plugins"),n.sampleImg=n.top+"/images",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.mp3Disabled=n.isNW,n.tonyuHome="/Tonyu/",n.PathSep="/",n.isNW?(n.noconcat=!0,n.PathSep=require("path").sep,n.cwd=r.directorify(process.cwd().replace(/\\/g,"/")),n.tonyuHome=process.env.TONYU_HOME?r.directorify(process.env.TONYU_HOME):r.rel(n.cwd,"fs/Tonyu/"),n.logdir=process.env.TONYU_LOGDIR,n.wwwDir=r.rel(n.cwd,"www/"),n.platform=process.platform,n.ffmpeg=r.rel(n.cwd,"win32"==n.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),n.pkgInfo=require(r.rel(n.cwd,"package.json")),n.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):n.pkgInfo&&n.pkgInfo.config&&n.pkgInfo.config.prjDirs?n.pkgInfo.config.prjDirs.map(function(t){return t=r.directorify(t),r.isAbsolute(t)?t:r.rel(n.cwd,t)}):[r.rel(n.cwd,"Projects/"),r.rel(n.tonyuHome,"Projects/")],n.kernelDir=r.rel(n.wwwDir,"Kernel/")):(n.wwwDir=s+"//"+location.host+"/",n.projects=[r.rel(n.tonyuHome,"Projects/")]),n.kernelDir=r.rel(n.wwwDir,"Kernel/"),n.compiledKernel=r.rel(n.kernelDir,"js/concat.js"),i.match(/localhost\/tonyu2/)?(n.wwwDir=s+"//"+location.host+"/tonyu2/",n.kernelDir=n.wwwDir+"Kernel/",n.compiledKernel=n.kernelDir+"js/concat.js",n.uploadTmpUrl=s+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//localhost/tsite/tonyu/project/newVersion.cgi"):(n.uploadTmpUrl=s+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//www.tonyu.jp/project/newVersion.cgi"),n.version=2,n.hoge="fuga",t.setEnvProvider(new t.Env(n)),window.WebSite=n;case"singleHTML":if(n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},"object"==typeof BuiltinAssets)for(var a in BuiltinAssets)n.urlAliases[a]=BuiltinAssets[a];return n.tonyuHome="/Tonyu/",n.projects=[r.rel(n.tonyuHome,"Projects/")],n.scriptServer="https://edit.tonyu.jp/",n.pluginTop=n.scriptServer+"js/plugins",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.PathSep="/",n.compiledKernel=n.scriptServer+"Kernel/js/concat.js",t.setEnvProvider(new t.Env(n)),window.WebSite=n;case"multiHTML":return n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},n.tonyuHome="/Tonyu/",n.pluginTop=n.top+"/js/plugins",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.PathSep="/",n.mp3Disabled=n.isNW,n.isNW&&(n.PathSep=require("path").sep,n.cwd=r.directorify(process.cwd().replace(/\\/g,"/")),n.platform=process.platform),t.setEnvProvider(new t.Env(n)),window.WebSite=n}if(i.match(/jsrun\.it/))n={urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:o,pluginTop:"https://edit.tonyu.jp/js/plugins",removeJSOutput:!0};else if(i.match(/tonyuexe\.appspot\.com/)||i.match(/localhost:8887/)||i.match(/\/html\/((dev)|(build))\//))n={urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/sound_ogg.png":"../../images/sound_ogg.png","images/sound_mp3.png":"../../images/sound_mp3.png","images/sound_mp4.png":"../../images/sound_mp4.png","images/sound_m4a.png":"../../images/sound_m4a.png","images/sound_mid.png":"../../images/sound_mid.png","images/sound_wav.png":"../../images/sound_wav.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:o};else if(i.match(/bitarrow/)||i.match(/localhost.*pub/)){n={};var u=n;n.serverType="BA",u.runtime="../../../runtime/",u.urlAliases={"images/base.png":u.runtime+"images/base.png","images/Sample.png":u.runtime+"images/Sample.png","images/neko.png":u.runtime+"images/neko.png","images/inputPad.png":u.runtime+"images/inputPad.png","images/mapchip.png":u.runtime+"images/mapchip.png","images/sound.png":u.runtime+"images/sound.png","images/sound_ogg.png":u.runtime+"images/sound_ogg.png","images/sound_mp3.png":u.runtime+"images/sound_mp3.png","images/sound_mp4.png":u.runtime+"images/sound_mp4.png","images/sound_m4a.png":u.runtime+"images/sound_m4a.png","images/sound_mid.png":u.runtime+"images/sound_mid.png","images/sound_wav.png":u.runtime+"images/sound_wav.png","images/ecl.png":u.runtime+"images/ecl.png"}}else n={urlAliases:{},top:".",devMode:o};if("object"==typeof BuiltinAssets)for(var a in BuiltinAssets)n.urlAliases[a]=BuiltinAssets[a];n.builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/neko.png":1,"images/mapchip.png":1,"images/inputPad.png":1};var c=window.navigator.userAgent.toLowerCase();return n.tablet=-1!=c.indexOf("windows")&&-1!=c.indexOf("touch")||-1!=c.indexOf("ipad")||-1!=c.indexOf("android")&&-1==c.indexOf("mobile")||-1!=c.indexOf("firefox")&&-1!=c.indexOf("tablet")||-1!=c.indexOf("kindle")||-1!=c.indexOf("silk")||-1!=c.indexOf("playbook"),n.mobile=-1!=c.indexOf("windows")&&-1!=c.indexOf("phone")||-1!=c.indexOf("iphone")||-1!=c.indexOf("ipod")||-1!=c.indexOf("android")&&-1!=c.indexOf("mobile")||-1!=c.indexOf("firefox")&&-1!=c.indexOf("mobile")||-1!=c.indexOf("blackberry"),n.pluginTop||(n.pluginTop=n.top+"/js/plugins"),n.disableROM={},(i.match(/\.appspot\.com/)||i.match(/localhost:888[87]/))&&(n.serverType="GAE"),i.match(/localhost:3000/)&&(n.serverType="Node"),n.serverTop=i.match(/tonyuexe\.appspot\.com/)||i.match(/localhost:8887/)?n.top+"/exe":n.top+"/edit",n.sampleImg=n.top+"/images",n.blobPath=n.serverTop+"/serveBlob",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.mp3Disabled=n.isNW,n.tonyuHome="/Tonyu/",n.url={getDirInfo:n.serverTop+"/getDirInfo",getFiles:n.serverTop+"/File2LSSync",putFiles:n.serverTop+"/LS2FileSync"},n.PathSep="/",n.isNW?(n.PathSep=require("path").sep,n.cwd=r.directorify(process.cwd().replace(/\\/g,"/")),n.tonyuHome=process.env.TONYU_HOME?r.directorify(process.env.TONYU_HOME):r.rel(n.cwd,"fs/Tonyu/"),n.logdir=process.env.TONYU_LOGDIR,n.wwwDir=r.rel(n.cwd,"www/"),n.platform=process.platform,n.ffmpeg=r.rel(n.cwd,"win32"==n.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),n.pkgInfo=require(r.rel(n.cwd,"package.json")),n.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):n.pkgInfo&&n.pkgInfo.config&&n.pkgInfo.config.prjDirs?n.pkgInfo.config.prjDirs.map(function(t){return t=r.directorify(t),r.isAbsolute(t)?t:r.rel(n.cwd,t)
}):[r.rel(n.cwd,"Projects/"),r.rel(n.tonyuHome,"Projects/")],n.kernelDir=r.rel(n.wwwDir,"Kernel/")):(n.wwwDir=s+"//"+location.host+"/",n.projects=[r.rel(n.tonyuHome,"Projects/")]),(i.match(/edit\.tonyu\.jp/)||i.match(/tonyuedit\.appspot\.com/)||i.match(/localhost:888/))&&(n.kernelDir=s+"//"+location.host+"/Kernel/"),n.compiledKernel=i.match(/edit\.tonyu\.jp/)||i.match(/tonyuedit\.appspot\.com/)||i.match(/localhost:888/)||n.isNW?n.kernelDir+"js/concat.js":"BA"===n.serverType?n.runtime+"lib/tonyu/kernel.js":"https://edit.tonyu.jp/Kernel/js/concat.js",i.match(/localhost\/tonyu2/)?(n.wwwDir=s+"//"+location.host+"/tonyu2/",n.kernelDir=n.wwwDir+"Kernel/",n.compiledKernel=n.kernelDir+"js/concat.js",n.uploadTmpUrl=s+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//localhost/tsite/tonyu/project/newVersion.cgi"):(n.uploadTmpUrl=s+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//www.tonyu.jp/project/newVersion.cgi"),i.match(/((index)|(project))2/)&&(n.version=2,n.devMode=n.isNW?!0:!1),t.setEnvProvider(new t.Env(n)),window.WebSite=n}),requireSimulator.setName("assert"),define(["FS"],function(t){return t.assert}),requireSimulator.setName("Shell"),define(["FS","assert"],function(t,e){function n(e,n){var i=r(e);if(t.SFile.is(i)||console.log(i," is not file"),n&&!i.exists())throw new Error(i+": no such file or directory");return i}function r(e){if("string"!=typeof e)return e;var n=i.cwd;return o.isAbsolutePath(e)?t.resolve(e,n):n.rel(e)}var i={},o=e(t.PathUtil);return i.newCommand=function(t,e){this[t]=e},i.cd=function(t){return i.cwd=n(t,!0),i.pwd()},i.vars=Object.create(t.getEnv()),i.mount=function(e,n){if(!e||!e.t){var r=[];for(var i in t.getRootFS().availFSTypes())r.push(i);return void sh.err("-t=("+r.join("|")+") should be specified.")}t.mount(n,e.t,e)},i.unmount=function(e){t.unmount(e)},i.fstab=function(){var e=t.getRootFS(),n=e.fstab(),r=this;n.forEach(function(t){r.echo(t.fstype()+"	"+(t.mountPoint||"<Default>"))})},i.resolve=n,i.pwd=function(){return i.cwd+""},i.ls=function(t){return t=t?n(t,!0):i.cwd,t.ls()},i.cp=function(t,e,r){r||(r={}),r.v&&(i.echo("cp",t,e),r.echo=i.echo.bind(i));var o=n(t,!0),s=n(e);return o.copyTo(s,r)},i.ln=function(t,e,r){var i=n(e),o=n(t,!0);if(i.isDir()&&i.exists()&&(i=i.rel(o.name())),i.exists())throw new Error(i+" exists");return i.link(o,r)},i.rm=function(t,e){if(e||(e={}),e.notrash)return t=n(t,!1),t.removeWithoutTrash(),1;if(t=n(t,!0),t.isDir()&&e.r){var r=t,o=0;return r.each(function(t){t.exists()&&(o+=i.rm(t,e))}),r.rm(),o+1}return t.rm(),1},i.mkdir=function(t){if(t=n(t,!1),t.exists())throw new Error(t+" : exists");return t.mkdir()},i.cat=function(t){return t=n(t,!0),i.echo(t.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}))},i.resolve=function(t){return t||(t="."),t=n(t)},i.grep=function(t,e,r){function o(t,e,n){r.res&&r.res.push({file:t,lineNo:e,line:n}),i.echo(t+"("+e+"): "+n)}return e=n(e,!0),r||(r={}),r.res||(r.res=[]),e.isDir()?e.each(function(e){i.grep(t,e,r)}):"string"==typeof t&&e.lines().forEach(function(n,r){n.indexOf(t)>=0&&o(e,r+1,n)}),r.res},i.touch=function(t){return t=n(t),t.text(t.exists()?t.text():""),1},i.setout=function(t){i.outUI=t},i.echo=function(){return $.when.apply($,arguments).then(function(){console.log.apply(console,arguments),i.outUI&&i.outUI.log&&i.outUI.log.apply(i.outUI,arguments)})},i.err=function(t){console.log.apply(console,arguments),t&&t.stack&&console.log(t.stack),i.outUI&&i.outUI.err&&i.outUI.err.apply(i.outUI,arguments)},i.clone=function(){var t=Object.create(this);return t.vars=Object.create(this.vars),t},i.getvar=function(t){return this.vars[t]||process&&process.env[t]},i.get=i.getvar,i.set=function(t,e){return this.vars[t]=e},i.strcat=function(){if(1==arguments.length)return arguments[0];for(var t="",e=0;e<arguments.length;e++)t+=arguments[e];return t},i.exists=function(t){return t=this.resolve(t),t.exists()},i.dl=function(t){return t=this.resolve(t||"."),t.download()},i.zip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.zip.apply(t.zip,n)},i.unzip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.unzip.apply(t.zip,n)},i.prompt=function(){},i.ASYNC={r:"SH_ASYNC"},i.help=function(){for(var t in i){var e=i[t];"function"==typeof e&&i.echo(t+(e.description?" - "+e.description:""))}},window.sh||(window.sh=i),"object"==typeof process?(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()},sh.cd(process.cwd().replace(/\\/g,"/"))):sh.cd("/"),i}),requireSimulator.setName("Log"),define(["FS","WebSite","Shell"],function(t,e,n){function r(t,e){return t="00000000000000"+t,t.substring(t.length-e)}function i(t){return t.replace(/\n/g,"\n|")}var o={},s=e.logdir?t.resolve("${logdir}"):null,a=s&&s.exists();if(o.todayDir=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();return s.rel(e+"/").rel(n+"/").rel(r+"/")},o.curFile=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();return o.todayDir().rel(e+"-"+n+"-"+r+".log")},o.curProject=function(){var t=new Date,e=t.getHours(),n=t.getMinutes(),i=t.getSeconds();return o.todayDir().rel("Project/").rel(r(e,2)+"_"+r(n,2)+"_"+r(i,2)+"/")},o.dumpProject=function(t){if(a){var e=o.curProject();n.cp(t,e),o.append("Dumped project to "+e.path())}},!e.logging&&!e.isNW){var u=t.get("/var/log/");u.exists()&&u.fs.storage===localStorage&&u.removeWithoutTrash({r:!0})}return o.append=function(t){if(a){var e=o.curFile(),n=e.exists()?e.text():"";e.text(n+t+"\n")}},o.d=function(t,e){o.append(new Date+": ["+t+"]"+i(e))},o.e=function(t,e){o.append(new Date+": ERROR["+t+"]"+i(e))},o}),requireSimulator.setName("exceptionCatcher"),define([],function(){var t={};return t.f=function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(n){t.handleException(n)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var r in e)e[r]=t.f(e[r]);return e}},t}),requireSimulator.setName("UI"),define(["Util","exceptionCatcher"],function(t,e){var n={},r=e.f;return n=function(){function e(){f.forEach(function(t){t()}),setTimeout(r(e),50)}function i(t){return t instanceof Array?o(t):"string"==typeof t?a(t):t}function o(t){var e=t[0],n=1,r=$("<"+e+">");for("object"!=typeof t[n]||t[n]instanceof Array||t[n]instanceof $||(s(r,t[n],e),n++);n<t.length;)r.append(i(t[n])),n++;return r}function s(e,i){function o(t,n){if(n)if("enterkey"==t)e.on("keypress",r(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var o,s=!0;f.push(function(){var t;t="checkbox"==i.type?!!e.prop("checked"):e.val(),(s||o!=t)&&(n.apply(e,[t,o]),o=t),s=!1})}else e.on(t,r(n))}i.$var&&(l[i.$var]=e),i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(t){p.writeToModel(i.$edit,t,e)}),l[i.$edit.name]||(l[i.$edit.name]=e),p.push({jq:e,params:i}));for(var s in i)if("on"==s)for(var a in i.on)o(a,i.on[a]);else"css"==s&&null!=i[s]?e.css(i[s]):t.startsWith(s,"$")||null==i[s]||e.attr(s,i[s])}function a(t){return $(document.createTextNode(t))}for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];var f=[],l={},p=[],h=i(u);return h.$edits=p,h.$vars=l,$.data(h,"edits",p),$.data(h,"vars",l),p.load=function(t){p.model=t,p.forEach(function(t){p.writeToJq(t.params.$edit,t.jq)}),p.validator.on.validate.call(p.validator,p.model)},p.writeToJq=function(t,e){var n=p.model;if(n){for(var r=t.name,i=r.split("."),o=0;o<i.length;o++)n=n[i[o]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},p.validator={errors:{},show:function(){if(l.validationMessage){l.validationMessage.empty();for(var t in this.errors)l.validationMessage.append(n("div",this.errors[t].mesg))}if(l.OKButton){var e=!0;for(var t in this.errors)e=!1;l.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},p.writeToModel=function(t,e,n){var r=p.model;if(r){var i=t.name;try{e=t.type.fromVal(e)}catch(o){return void p.validator.addError(i,o,n)}p.validator.removeError(i);for(var s=i.split("."),a=0;a<s.length;a++)a==s.length-1?p.on.writeToModel(i,e)||(r[s[a]]=e):r=r[s[a]];p.validator.on.validate.call(p.validator,p.model)}},p.on={},p.on.writeToModel=function(){},f.length>0&&setTimeout(r(e),50),h},n.types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),requireSimulator.setName("Wiki"),define(["HttpHelper","Arrow","Util","WebSite","Log","UI","FS"],function(t,e,n,r,i,o,s){return Wiki=function(n,a,u){function c(t){function e(t){t.stopPropagation(),t.preventDefault()}function n(t){if(u.editMode){var e=t.originalEvent,n=e.dataTransfer.files[0];if(!n.type.match(/image\/(png|gif|jpg)/)[1])return t.stopPropagation(),t.preventDefault(),!1;var r=new FileReader;return r.onload=function(){var t=r.result;a.text(t),i.empty().append(o("img",{src:t}))},r.readAsDataURL(n),t.stopPropagation(),t.preventDefault(),!1}}var i,a;if(l.builtinImages[t])return $("<div>").append($("<img>").attr("src",r.top+"/doc/images/"+t));i=o("div",{style:"margin:10px; padding:10px; border:solid black 1px;",on:{dragover:e,dragenter:e,drop:n}},"ここに画像ファイル(png/gif/jpg)をドラッグ＆ドロップして追加");var c=s.get(r.tonyuHome);return a=c.rel("doc/images/").rel(t),a.exists()&&i.empty().append(o("img",{src:a.text()})),i}function f(t,e,n){function r(){for(var s=[];;){var a=t.indexOf(e,o),u=t.indexOf(n,o);if(u>=0&&(0>a||a>u)){s.push(t.substring(o,u)),o=u;break}if(0>a){s.push(t.substring(o)),o=t.length;break}s.push(t.substring(o,a)),o=a+e.length;var c=r();c.hasBrace=!0,o<t.length&&(o+=n.length),s.push(c)}return i(s),s}function i(t){return t.split=function(t,e){if(1==e)return this;var n=[],r=i([]);return this.forEach(function(o){if("string"==typeof o){var s=o.indexOf(t);if(n.length>=e&&(s=-1),s>=0){if(s>0){var a=o.substring(0,s);r.push(a)}if(s+=t.length,n.push(1!=r.length?r:r[0]),r=i([]),s<o.length){var a=o.substring(s);r.push(a)}}else r.push(o)}else r.push(o)}),n.push(1!=r.length?r:r[0]),n},t.text=function(t){var r=this.hasBrace&&t?e:"";return this.forEach(function(t){r+="string"==typeof t?t:t.text(!0)}),r+=this.hasBrace&&t?n:""},t.toString=function(){return this.text(!0)},t}var o=0;return r(0)}var l={},p={figures:"図",plists:"リスト"},h="line_marker_",d={},g=[],m=".txt";if(u||(u={}),a&&!a.isDir())throw a+": not a dir";var v,y;l.on=d,l.cd=function(t){v=t,y=v.rel("toc.json")},a&&l.cd(a),l.encodeURL=function(t){return encodeURI(t).replace(/%/g,"")},l.parse=function(n,i,o){function s(t){g[t]={};var e=1,n=function(n,r){var i=g[t][n];return i||(i={refs:[]},g[t][n]=i),r&&(i.no=e++,i.name=p[t]+i.no,i.refs.forEach(function(t){t.text(i.name)})),i};return n}function a(t){function e(t){for(null==t&&(t=0);g.ul>t;)g.ul--,m.exit()}m.lineNo=g.lineNo;var n=0;if(t.match(/^-+/)&&(n=RegExp.lastMatch.length),n>g.ul)for(;n>g.ul;)g.ul++,m.enter("<ul>");else e(n);if(t=t.substring(n),n>0&&m.enter("<li>"),t.match(/^\*+/)){var r=RegExp.rightContext,i="h"+RegExp.lastMatch.length;m.enter("<"+i+">"),d(r),m.exit()}else if(t.match(/^$/))e(),m.p($("<p>"));else if(t.match(/^<<toc(.*)/))g.toc=[g.name],g.blocks.push({name:"toc",exit:function(){y&&!y.isReadOnly()&&y.obj(g.toc),g.toc=null}});else if(t.match(/^<<code(.*)/)){var o=RegExp.$1;if(o=o.replace(/^ */,""),o.length>0){var s,a,u=o.split(/ /,2);if(2==u.length){a=u[0],s=u[1];var c=b(s,!0);m.p($("<div>").addClass("plist").text(c.name+" "+a))}else m.p($("<div>").addClass("plist").text(u))}m.enter("<pre>"),g.blocks.push({name:"code",exit:function(){m.exit()}})}else if(t.match(/^>>/)){var f=g.blocks.pop();f&&f.exit&&f.exit(g)}else if(t.match(/^@@@@(.*)/)){if(g.pclose)m.exit();else{if(RegExp.$1.length>0){var c=b(RegExp.$1,!0);m.p($("<div>").addClass("plist").text(c.name))}m.enter("<pre>")}g.pclose=!g.pclose}else d(t),m.p("\n");n>0&&m.exit(),g.lineNo++}function d(t){function n(t){var n,i=t.text();if(i.match(/^@blink ([^>]+)>([^\s]+)/)){caption=RegExp.$1;var s=RegExp.$2;n=$("<span>").addClass("clickable").text(caption).hover(function(){var t;parent&&parent.Arrow&&(t=parent.Arrow),e&&(t=e),t&&t.show(s)})}else if(i.match(/^@plistref (.*)/)){var a=RegExp.$1,f=b(a);n=$("<strong>").text(f.name),f.refs.push(n)}else if(i.match(/^@editadd/))m.p($("<img>").attr("src",r.top+"/images/editAdd.png"));else if(i.match(/^@figref (.*)/)){var f=v(RegExp.$1);n=$("<strong>").text(f.name),f.refs.push(n)}else if(i.match(/^@cfrag (.*)/)){var h=RegExp.$1;n=$("<code>"),m.enter(n),d(h),m.exit()}else if(i.match(/^@arg (.*)/)){var y=RegExp.$1;n=$("<i>"),m.enter(n),d(y),m.exit()}else{var w=t.split(">",2);if(2==w.length?(i=w[1]+"",caption=w[0]):caption=i,g.toc&&g.toc.push(i),i.match(/\.(png|jpg|gif)$/)&&!i.match(/^http/)){var f=v(i,!0);n=$("<div>").addClass("figure").append(c(i)),m.enter(n),m.enter($("<div>")),m.p(p.figures+f.no+"."),d(caption),m.exit(),m.exit()}else if(i.match(/^https?:\/\//))n=$("<a>").attr({href:i,target:"ext"}).text(caption);else{var S=l.resolveFile(i);if(S.exists()||!S.isReadOnly()&&u.editMode){if(u.useAnchor){var x=S.relPath(o.up()).replace(/\.txt$/,".html");x=l.encodeURL(x),n=$("<a>").attr({href:x}).text(caption)}else n=$("<span>").addClass("clickable").text(caption).click(function(){l.show(S)});S.exists()||n.addClass("notexist")}else n=$("<span>").text(caption)}}m.p(n)}var i="string"==typeof t?f(t,g.beginMark,g.endMark):t;i.forEach(function(t){"string"==typeof t?m.p(t):n(t)})}var g={},m=t({lineMark:h});g.out=m,g.name=i,g.lines=n.split(/\r?\n/),g.lineNo=0,g.ul=0,g.beginMark="[[",g.endMark="]]",g.blocks=[];var v=s("figures"),b=s("plists"),w=[];y&&y.exists()&&(w=y.obj());var S=w.indexOf(i);if(S>=0){var x="",D=w[S-1];D&&(x+="[[前へ>"+D+"]]");var T=w[S+1];T&&(x+=" - [[次へ>"+T+"]]");var j=w[0];0!=S&&(x+=" - [[目次>"+j+"]]"),g.lines.unshift(x),g.lines.push(x)}return g.lines.forEach(a),m.buf},l.resolveFile=function(t){var e;return e=t.isDir?t:v&&"/"!=t.substring(0,1)?v.rel(t+m):s.get(t)},l.show=function(t){var e=l.resolveFile(t);u.editMode||i.d("wiki","show "+e),l.cd(e.up());var r=e.truncExt(m);if(!e.exists()&&!e.isReadOnly()&&u.editMode){var o=g[g.length-1];e.text(o?"[["+o.truncExt(m)+"]]\n":"")}if(e.exists()){var s=l.parse(e.text(),r,e);n.empty(),n.scrollTop(0),n.append(s),n.append($("<div>").css({height:"100px"}).text("")),d.show&&d.show.apply(l,[e,r]),g.push(e)}else alert(t+" というページはありません")},l.back=function(){var t=g.pop();t&&show(t)};var b;return l.highlightLine=function(t){var e=$("#"+h+"-"+t);if(0!=e.length){b&&b.removeClass("wiki-cur-line"),b=e.next(),b.addClass("wiki-cur-line");var r=e.position().top,i=n;0>r&&i.scrollTop(i.scrollTop()+(r-10)/2);var o=i.height()-100;r>o&&i.scrollTop(i.scrollTop()+(r-o+10)/2)}},l.builtinImages={"50_100.png":1,"50_160.png":1,"50_300.png":1,"apple1apple2.png":1,"coords.png":1,"copy60_100.png":1,"firstRunRes.png":1,"firstVarRes.png":1,"itadaki.png":1,"noWaitCat.png":1,"runtimeError.png":1,"sample.png":1,"sayonara.png":1,"syntaxError.png":1},l}}),requireSimulator.setName("Shell2"),define(["Shell","UI","FS","Util"],function(t,e,n,r){var i={};i.show=function(t){var e=i.embed(t);e.dialog({width:600,height:500})},i.embed=function(){i.d||(i.d=e("div",{title:"Shell"},["div",{$var:"inner"},"Type 'help' to show commands.",["br"]]),i.inner=i.d.$vars.inner,t.prompt());var n=i.d;return n},t.cls=function(){i.d.$vars.inner.empty()},t.prompt=function(){function n(t){return 9==t.which?(t.stopPropagation(),t.preventDefault(),s(),!1):void(13==t.which&&(f.empty(),o(u.val())))}function o(){var n=u.val().replace(/^ */,"").replace(/ *$/,"");if(0!=n.length){var r=n.split(/ +/),i=r.shift(),o=t[i];if("function"!=typeof o)return c.append(i+": command not found.");try{var s=[],a=null;r.forEach(function(t){var e=/^-([A-Za-z_0-9]+)(=(.*))?/.exec(t);e?(a||(a={}),a[e[1]]=null!=e[3]?e[3]:1):(a&&s.push(a),a=null,s.push(t))}),a&&s.push(a);var f=o.apply(t,s);if(f===t.ASYNC)return;if("object"==typeof f)if(f instanceof Array){var l=e("table"),p=null,h=0;f.forEach(function(t){p||(p=e("tr").appendTo(l)),p.append(e("td",t)),h++,h%3==0&&(p=null)}),l.appendTo(c)}else c.append(JSON.stringify(f));else c.append(f);t.prompt()}catch(d){t.err(d),t.prompt()}}}function s(){var e=u.val(),n=e.split(" "),i=n.pop(),o=[];if(0==n.length)for(var s in t)"function"==typeof t[s]&&r.startsWith(s,i)&&o.push(s);else{var a=t.resolve(i,!1);if(!a)return;var c=a.isDir()?a:a.up();c.each(function(t){r.startsWith(t.path(),a.path())&&o.push(t.name())})}if(1==o.length){var l=i.split("/");l.pop(),l.push(o[0]),n.push(l.join("/")),u.val(n.join(" ")),f.empty()}else f.text(o.join(", "))}var a=e("div",["input",{$var:"cmd",size:40,on:{keydown:n}}],["pre",{$var:"out","class":"shell out"},["div",{$var:"cand","class":"shell cand"}]]),u=a.$vars.cmd,c=a.$vars.out,f=a.$vars.cand;return t.setout({log:function(){return $.when.apply($,arguments).then(function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);c.append(t[0]instanceof $?t[0]:e("span",t.join(" ")+"\n"))})},err:function(t){c.append(e("div",{"class":"shell error"},t,["br"],["pre",t.stack]))}}),a.appendTo(i.inner),u.focus(),i.inner.closest(".ui-dialog-content").scrollTop(i.inner.height()),t.ASYNC},t.window=function(){i.show(t.cwd)},t.atest=function(t,e,n){console.log(t,e,n)};var o=t.cat;return t.cat=function(n){return n=t.resolve(n,!0),n.contentType().match(/^image\//)?n.getContent(function(n){t.echo(e("img",{src:n.toURL()}))}):o.apply(t,arguments)},i}),requireSimulator.setName("NewProjectDialog"),define(["UI"],function(t){var e={};return e.show=function(t,n,r){var i=e.embed(t,n,r);i.dialog({width:600})},e.embed=function(n,r,i){if(e.onOK=r,i||(i={}),!e.d){var o={fromVal:function(t){return""==t?null:FS.get(t)},toVal:function(t){return t?t.path():""}};e.d=t("div",{title:i.ren?"プロジェクト名の変更":"新規プロジェクト"},["div",["span","プロジェクト名"],["input",{$edit:"name",value:i.defName||"",on:{enterkey:function(){e.d.done()}}}]],["div",["span","親フォルダ"],["input",{$edit:{name:"parentDir",type:o}}]],["div",["span","作成先フォルダ："],["span",{$var:"dstDir"}]],["div",{$var:"validationMessage",css:{color:"red"}}],["button",{$var:"OKButton",on:{click:function(){e.d.done()}}},"OK"])}var s=e.d,a={name:i.defName||"",parentDir:n};return s.$edits.load(a),s.$edits.validator.on.validate=function(t){return""==t.name?void this.addError("name","名前を入力してください"):(t.dstDir=t.parentDir.rel(t.name+"/"),t.dstDir.exists()?void this.addError("name","このフォルダはすでに存在します"):(this.allOK(),void s.$vars.dstDir.text(t.dstDir+"")))},s.done=function(){s.$edits.validator.isValid()&&(e.onOK(a.dstDir),$.data(s[0],"ui-dialog")&&s.dialog("close"))},s},e}),requireSimulator.setName("requestFragment"),define(["WebSite"],function(t){var e={};return e.ajax=function(e){function n(t){return e.redirectTo&&(t.redirectTo=e.redirectTo),t}function r(){$.ajax({type:"post",url:t.serverTop+"/runFragments",data:n({id:a}),success:function(t){return"string"==typeof t&&t.match(/^notCompleted:([\-\d]+)\/([\-\d]+)$/)?(console.log("notcomp",t),f*=2,void setTimeout(r,f)):void e.success(t)},error:e.error,complete:e.complete})}var i=e.THRESH||8e5,o=e.data;if("object"!=typeof o)throw"Data should be object: "+o;if(o=JSON.stringify(o),!e.redirectTo&&("GAE"!=t.serverType||o.length<i))return $.ajax(e);for(var s=[],a=Math.random();o.length>0;)s.push(o.substring(0,i)),o=o.substring(i);var u=s.length,c=0,f=1e3;s.forEach(function(i,o){$.ajax({type:"post",url:t.serverTop+"/sendFragment",data:n({id:a,seq:o,len:u,content:i}),success:function(t){console.log("sendFrag",t,o),c++,c>=u&&setTimeout(r,f)},error:e.error})})},e}),requireSimulator.setName("Sync"),define(["FS","Shell","requestFragment","WebSite"],function(t,e,n,r){function i(t){return t&&t.isDir}var o={};return e.sync=function(){function t(t){return function(){t&&t.apply({},arguments),e.prompt()}}var n,r,s,a=function(){},u=0;return("string"==typeof arguments[u]||i(arguments[u]))&&(n=e.resolve(arguments[u],!0),u++,("string"==typeof arguments[u]||i(arguments[u]))&&(r=e.resolve(arguments[u],!1),u++)),"object"==typeof arguments[u]&&(s=arguments[u],u++),"function"==typeof arguments[u]&&(a=arguments[u],u++),n||(r=n=e.cwd),s&&s.onend&&(s.onend=t(s.onend)),r||(r=n),e.echo("sync args=",n,r,s,a),o.sync(n,r,s,t(a)),e.ASYNC},o.sync=function(){function t(t,n){e.echo("Status: "+t+" param:",n),h.onstatus&&h.onstatus(t,n)}function o(){h.onerror&&h.onerror.apply(this,arguments)}function s(){var e={base:p.path(),excludes:JSON.stringify(h.excludes)};t("getDirInfo",e),$.ajax({type:"get",url:r.serverTop+"/getDirInfo",data:e,success:a,error:o})}function a(n){h.v&&e.echo("getDirInfo",n);var i=l,s=n.data;for(var a in s){var c=i.rel(a),d=c.exists({includeTrashed:!0})&&c.metaInfo(),g=s[a];f(c,a,d,g)}l.recursive(function(t){var e=t.exists({includeTrashed:!0})&&t.metaInfo(),n=t.relPath(l),r=s[n];f(t,n,e,r)},{includeTrashed:!0,excludes:h.excludes}),h.v&&(e.echo("uploads:",m),e.echo("downloads:",v));var y={base:p.path(),paths:JSON.stringify(v)};t("File2LSSync",y),$.ajax({type:"post",url:r.serverTop+"/File2LSSync",data:y,success:u,error:o})}function u(i){e.echo("dlData=",i),h.v&&e.echo("dlData:",i);var s=l;if(!h.test){for(var a in i.data){var u=s.rel(a),f=i.data[a];f.trashed?u.exists()&&u.rm():u.text(f.text),delete f.text,u.metaInfo(f)}var d={base:p.path(),data:JSON.stringify(m)};d.pathInfo="/LS2FileSync",t("LS2FileSync",d),n.ajax({type:"post",url:r.serverTop+"/LS2FileSync",data:d,success:c,error:o})}}function c(t){h.v&&e.echo("LS2FileSync res=",t);var n=[];for(var r in m)n.push(r);t={msg:t,uploads:n,downloads:v},"function"==typeof d&&d(t)}function f(t,n,r,i){if(!y[n])if(y[n]=1,i&&(!r||r.lastUpdate<i.lastUpdate))v.push(n),h.v&&e.echo((r?"":"New")+"Download "+t+" trash="+!!i.trashed);else if(r&&(!i||r.lastUpdate>i.lastUpdate)){var o=r.trashed?{}:{text:t.text()},s=t.metaInfo();for(var a in s)o[a]=s[a];m[n]=o,h.v&&e.echo((i?"":"New")+"Upload "+t+" trash="+!!r.trashed)}}var l,p,h,d,g=0;if(i(arguments[g])&&(l=arguments[g],g++,i(arguments[g])&&(p=arguments[g],g++)),"object"==typeof arguments[g]&&(h=arguments[g],g++),"function"==typeof arguments[g]&&(d=arguments[g],g++),!l)throw"Sync.sync: Local dir must be specified as file object";p||(p=l),h||(h={}),!d&&h.onend&&(d=h.onend),h.test&&(h.v=1),s();var m={},v=[],y={}},e.rsh=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return $.ajax({url:r.serverTop+"/rsh",data:{args:JSON.stringify(t)},success:function(t){e.echo(t)},error:function(t,n,r){e.err(r)},complete:function(){e.prompt()}}),e.ASYNC},o}),requireSimulator.setName("Auth"),define(["WebSite"],function(t){var e={};return e.currentUser=function(e){$.ajax({type:"get",url:t.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(t){console.log("auth.currentUser",t),t=JSON.parse(t);var n=t.user;"null"==n&&(n=null),console.log("user",n,"csrfToken",t.csrfToken),e(n,t.csrfToken)}})},e.assertLogin=function(n){e.currentUser(function(e,r){return e?n.success(e,r):(window.onLoggedIn=n.success,void n.showLoginLink(t.serverTop+"/login"))})},window.Auth=e,e}),requireSimulator.setName("zip"),define(["FS"],function(t){return t.zip}),requireSimulator.setName("PathUtil"),define(["FS"],function(t){return t.PathUtil}),requireSimulator.setName("extLink"),define(["WebSite","UI","PathUtil","Util","assert"],function(t,e,n,r,i){function o(t,n,r){r=r||{};var i=s(t,r);return e("a",i,n)}function s(e,n){var r=t.platform;n=n||{},n.on=n.on||{};var i=n.on&&n.on.click||function(){};return"win32"==r?(n.href="javascript:;",n.on.click=a("start",e,i)):"darwin"==r?(n.href="javascript:;",n.on.click=a("open",e,i)):(n.href=e,n.on.click=i,n.target="_new"),n}function a(t,e,n){return function(){u(t+" "+e),n&&n()}}var u=t.isNW?require("child_process").exec:function(){};return o.all=function(){t.isNW&&$("a").each(function(){var t=(location.protocol+"//"+location.host+"/",$(this)),e=t.attr("href");if(e.match(/^http/)){var n=i.is(s(e),{href:String,on:{click:Function}});t.attr("href",n.href),t.click(n.on.click)}})},o}),requireSimulator.setName("DeferredUtil"),define(["FS"],function(t){return t.DeferredUtil}),requireSimulator.setName("Klass"),define(["assert"],function(t){function e(t){var e=/function[^\(]+\(([^\)]*)\)/,n=e.exec(t+"");return n?n[1].replace(/\s/g,"").split(","):[]}function n(t){if("object"!=typeof t)return!1;if(!t)return!1;var e={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},n=0;for(var r in t){if(!e[r])return!1;n+=e[r]}return n}var r={};return r.define=function(i){function o(e){i.$fields&&t.is(e,i.$fields)}function s(t){if(!l)return t;var n=e(t);return n[0]!==l?t:function(){var e=Array.prototype.slice.call(arguments);return e.unshift(d),t.apply(d,e)}}function a(t){if(!f)return t;if(n(t)){for(var r in t)t[r]=a(t[r]);return t}if("function"!=typeof t)return t;var i=e(t);return i[0]!==f?t:function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),t.apply(this,e)}}var u,c;i.$parent?(c=i.$parent,u=Object.create(c.prototype),u.super=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return c.prototype[e].apply(this,t)}):u={};var f,l;i.$this&&(f=i.$this),i.$singleton&&(l=i.$singleton);var p,h=a(i.$)||function(t){if(t&&"object"==typeof t)for(var e in t)this[e]=t[e]};h instanceof Array&&(p=h,h=function(){for(var t=Array.prototype.slice.call(arguments),e=0;e<p.length;e++)t.length>0&&(this[p[e]]=t.shift())});var d;d=function(){if(!(this instanceof d)){var t=Object.create(u);return h.apply(t,arguments),o(t),t}h.apply(this,arguments),o(this)},c&&(d.super=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift();return c.prototype[n].apply(e,t)}),d.inherit=function(t){return t.$parent=d,r.define(t)},d.prototype=u;for(var g in i)"$"!=g[0]&&("static$"==g.substring(0,7)?d[g.substring(7)]=s(i[g]):n(i[g])?Object.defineProperty(u,g,a(i[g])):u[g]=a(i[g]));return u.$=h,Object.defineProperty(u,"$bind",{get:function(){return this.__bounded||(this.__bounded=new r.Binder(this)),this.__bounded}}),d},r.Function=function(){throw new Exception("Abstract")},r.opt=t.opt,r.Binder=r.define({$this:"t",$:function(t,e){for(var n in e)(function(n){"function"==typeof e[n]&&(t[n]=function(){var t=Array.prototype.slice.call(arguments);return e[n].apply(e,t)})})(n)}}),r}),requireSimulator.setName("DragDrop"),define(["FS"],function(t){var e=t.DeferredUtil,n=t.SFile;return DragDrop={},DragDrop.readFile=function(t){return e.promise(function(e){var n=new FileReader;n.onload=function(){e(n)},n.readAsArrayBuffer(t)})},DragDrop.accept=function(t,r,i){function o(o){var s=r;"function"==typeof s&&(s=s()),t.removeClass(i.draggingClass);var a={},u=o.originalEvent;o.stopPropagation(),o.preventDefault();{var c=Array.prototype.slice.call(u.dataTransfer.files);c.length}return e.each(c,function(t){var r,o=t.name,u=s.rel(o);return e.resolve(i.onCheckFile(u,t)).then(function(e){return e===!1?void(a[u.path()]={file:u,status:"cancelled"}):(r=n.is(e)?e:u,DragDrop.readFile(t).then(function(t){var e=t.result;r.setBytes(e),a[u.path()]={file:u,status:"uploaded"},r.path()!==u.path()&&(a[u.path()].redirectedTo=r)}))})}).then(function(){i.onComplete&&i.onComplete(a)}).fail(function(t){i.onError(t)}),!1}function s(t){t.stopPropagation(),t.preventDefault()}function a(e){e.originalEvent;c++,t.addClass(i.draggingClass)}function u(e){var n=e.originalEvent;console.log("leave",n.target.innerHTML,e),c--,0>=c&&t.removeClass(i.draggingClass)}i=i||{},i.draggingClass=i.draggingClass||"dragging",t.on("dragover",s),t.on("dragenter",a),t.on("dragleave",u),t.on("drop",o),i.onCheckFile||(i.onCheckFile=function(t){return i.overwrite?t:t.exists()?!1:t}),i.onError||(i.onError=function(t){console.error(t)});var c=0},DragDrop}),requireSimulator.setName("ZipImporter"),define(["Klass","FS","Util","DragDrop","DeferredUtil","UI"],function(t,e,n,r,i,o){e.mount("/ram/","ram");var s=(e.zip,e.get("/ram/")),a=t.define({$:function(t,e,n){var r=this;r.elem=e,r.dir=t,r.tmpDir=s.rel(t.name()),n=n||{},r.onComplete=n.onComplete,r.elem&&r.prepareDragDrop()},prepareDragDrop:function(){var t=this;r.accept(t.elem,t.tmpDir,{onComplete:function(e){t.showDialog();var n={imported:0,from:"dragDrop"};t.acceptDrag(e,n).then(function(){t.closeDialog(),t.onComplete&&t.onComplete(n)},function(e){t.closeDialog(),console.error(e),alert(e)})}})},acceptDrag:function(t,e){var n=this;return i.each(t,function(t,r){return"uploaded"===r.status&&".zip"===r.file.ext()?n.unzip(r.file,e):void 0})},showDialog:function(t){var e=this;t=t||"ZIPからインポート中です...",e.dialog?e.mesg.text(t):(e.dialog=o("div",{title:"Zipからインポート"},["span",{$var:"mesg"},t]),e.mesg=e.dialog.$vars.mesg),e.dialogOpened||e.dialog.dialog({modal:!0}),e.dialogOpened=!0},closeDialog:function(){var t=this;t.dialog&&(t.dialog.dialog("close"),t.dialogOpened=!1)},unzip:function(t,n){var r=this;r.showDialog(t.name()+"を展開中...");var o=r.tmpDir.rel(t.truncExt()+"/"),s={progress:function(t){return r.showDialog(t.name()+"を展開中..."),i.timeout(0)}};return e.zip.unzip(t,o,s).then(function(){return n.rel&&(o=o.rel(n.rel),!o.exists())?n:r.traverse(o,n)}).then(function(e){if("prjB"===e.from&&0===e.imported)throw new Error(t.name()+"にはTonyu2の編集可能なプロジェクトが含まれていません.")})},traverse:function(t,e){var n=this,e=e||{};return e.imported=e.imported||0,t.each(function(t){return n.showDialog(t.name()+"をチェック中..."),console.log("traverse",t.path()),t.isDir()?n.traverse(t,e):"options.json"===t.name()?(e.imported++,n.importFrom(t.up(),e)):void 0}).then(function(){return e})},importFrom:function(t,n){var r,i=this;if(n.dstDir)r=n.dstDir;else{var o=i.dir,s=e.PathUtil.truncSEP(t.name());"src"===s&&(s=e.PathUtil.truncSEP(t.up().name()));var a=s+"/";r=o.rel(a);for(var u=2;r.exists();)a=s+u+"/",u++,r=o.rel(a)}return i.showDialog(t.name()+"から"+r.name()+"にコピー"),console.log("importFrom",t.path(),"to",r.path()),t.copyTo(r).then(function(){if(i.prjID){var t=r.rel("options.json");if(t.exists()){var e=t.obj();e.info=e.info||{},e.info.prjID=i.prjID,t.obj(e)}}})},checkFromPrjB:function(){var t=this,r=n.getQueryString("fromPrjB"),i=n.getQueryString("prjID");if(t.prjID=i,console.log("checkFromPrjB",r),r){var o=t.dir.rel(r.replace(/\.zip$/i,"/"));if(o.exists())return console.log(o+" already exists "),0;e.mount("https://edit.tonyu.jp/","web");var s={from:"prjB",imported:0,dstDir:o,rel:"src/"};return t.fromPrjB(r,s).then(function(e){return t.closeDialog(),t.onComplete&&t.onComplete(s),e},function(e){t.closeDialog(),alert(e),console.error(e)})}},fromPrjB:function(t,n){var r=this,i=e.get("https://edit.tonyu.jp/cgi-bin/dl.cgi?file="+t),o=e.get("/ram/").rel(t);return r.showDialog("プロジェクトボードから"+t+"をダウンロード...."),i.copyTo(o).then(function(){return r.unzip(o,n)})}});return a}),requireSimulator.setName("ProjectItem"),define(["Klass","UI","FS","DeferredUtil","WebSite"],function(t,e,n,r,i){var o,s="javascript:;";return ProjectItem=o=t.define({$this:"t",$:function(t,e,r){var i=e,o=n.PathUtil.truncSEP(i.name());t.prjList=r,t.projectDir=e,t.name=o;var s=t.dom(i);t.u=s,s.appendTo(t.prjList),setTimeout(function(){var t=i.rel("images/").rel("icon_thumbnail.png");t.exists()&&s.$vars.t.attr("src",t.getURL())},10)},hide:function(t){t.u&&t.u.hide()},show:function(t){t.u&&t.u.show()},url:{get:function(t){var e=t.projectDir;return 2==i.version?"project2.html?dir="+e.path():"project.html?dir="+e.path()}},dom:function(t){var n=t.url,r=t.name;return e("div",{"class":"project existentproject"},["a",{href:n,"class":"projectLink"},["img",{width:100,$var:"t",src:i.top+"/images/nowprint.png"}]],["div",["a",{href:n,"class":"projectLink projectName"},r],t.submenuExpr()])},submenuExpr:function(t){var e=t.projectDir;return["span",{"class":"dropdown"},["button",{"class":"submenu prjMenuButton",on:{click:t.$bind.openSubmenu},"data-path":e.path()}," "],["span",{"class":"dropdown-content"},["a",{href:s,"class":"submenu",on:{click:t.$bind.rename}},"名前変更"],["a",{href:s,"class":"submenu",on:{click:t.$bind.download}},"ZIPダウンロード"],["a",{href:s,"class":"submenu nwmenu",on:{click:t.$bind.openFolder}},"フォルダを開く"],["a",{href:s,"class":"submenu",on:{click:t.$bind.remove}},"削除"]]]
},download:function(t){return o.closeSubmenu(),n.zip.zip(t.projectDir).catch(r.E)},remove:function(t){function n(){var e=t.rmd.$vars.dl.prop("checked");return(e?t.download():r.resolve()).then(function(){t.projectDir.rm({r:1}),t.u.remove(),t.rmd.dialog("close")}).catch(r.E)}function i(){t.rmd.dialog("close")}o.closeSubmenu(),t.rmd||(t.rmd=e("div",{title:"プロジェクトの削除"},["div","プロジェクト",t.name,"を削除しますか？"],["div",["input",{$var:"dl",type:"checkbox",checked:!0}],["label",{"for":"dl"},"削除前にZIPでダウンロードする"]],["div",["button",{on:{click:n}},"はい"],["button",{on:{click:i}},"いいえ"]])),t.rmd.$vars.dl.prop("checked",!0),t.rmd.dialog()},rename:function(t){o.closeSubmenu();var e=prompt("新しいプロジェクトの名前を入れてください",t.name);if(e&&""!=e){e=n.PathUtil.truncSEP(e);var i=t.projectDir.sibling(e+"/");return i.exists(function(n){return n?void alert(e+" はすでに存在します"):t.projectDir.moveTo(i).then(function(){t.projectDir=i,t.name=i,t.u.find(".projectName").text(e),t.u.find(".projectLink").attr("href",t.url),o.closeSubmenu()}).catch(r.E)})}},openFolder:function(t){{var e=require("nw.gui");process.execPath}e.Shell.showItemInFolder(t.projectDir.path().replace(/\//g,require("path").sep)),o.closeSubmenu()},openSubmenu:function(t){o.addMenuHandler(),o.closeSubmenu(),o.showingSubMenu=t.u.find(".dropdown-content"),o.showingSubMenu.addClass("show"),i.isNW||o.showingSubMenu.find(".nwmenu").hide()},static$closeSubmenu:function(){o.showingSubMenu&&(o.showingSubMenu.removeClass("show"),o.showingSubMenu=null)},static$addMenuHandler:function(){o.menuHandlerAdded||(o.menuHandlerAdded=!0,$("html").click(function(t){$(t.target).hasClass("submenu")||o.closeSubmenu()}))}}),o}),requireSimulator.setName("exportAsScriptTags"),define(["FS","Util","WebSite"],function(t,e,n){function r(t){return t=t.replace(/&(#?[\w\d]+;)/g,function(t,e){return"&amp;"+e}),t=t.replace(/<(\s*)\/(\s*)script(\s*)>/gi,function(t,e,n,r){return"&lt;"+e+"/"+n+"script"+r+"&gt;"})}var i=function(t,e){function i(t,e){var n=t.split("\n"),r="";return n.forEach(function(t){for(;;){if(!(t.length>e)){r+=t+"\n";break}r+=t.substring(0,e)+"\\\n",t=t.substring(e)}return r}),r}function o(t){try{var e=JSON.parse(t);return JSON.stringify(e,null,4)}catch(n){return t}}e=e||{};var s=e.excludes||{},a=e.includeJSScript,u="";if(u+="<script>WebSite_runType='singleHTML';</script>\n",a){var c=t.rel("res.json"),f=c.obj(),l="https://edit.tonyu.jp/";f.images.forEach(function(t){n.builtinAssetNames[t.url]&&(u+='<script src="'+l+t.url+'.js"></script>\n')}),u+='<script src="'+l+'js/lib/jquery-1.10.1.js" type="text/javascript"></script>\n',u+='<script src="'+l+'js/gen/runScript_concat.min.js" type="text/javascript"></script>\n'}u+="<div id='splash' style='position:relative'>\n",u+="<!--ここに，ロード中に表示する内容を記述できます。-->\n",u+="<!--You can write here what you want to show while loading. -->\n",u+="<div class='progress'>\n",u+="<!-- ここにロード中の進捗が表示されます．表示したくない場合はこのdiv要素を削除してください。 -->\n",u+="<!-- This shows progress. If you don't want to shot, remove this element -->\n",u+="</div>\n",u+="</div>\n",u+="<!--\n",u+="Open this site when editing this game:\n",u+="https://edit.tonyu.jp/index.html?importFromHTML=1\n",u+="-->\n";var p=[],h=[];return t.recursive(function(e){var n=e.relPath(t);if(!s[n]){if(e.endsWith(".json")&&n.indexOf("maps/")<0)return void h.push(e);if(!e.endsWith(".tonyu"))return void p.push(e);var i=" data-lastupdate='"+e.lastUpdate()+"' ";u+="<script language='text/tonyu' type='text/tonyu' data-filename='"+n+"'"+i+">",u+=r(e.text()),u+="</script>\n\n"}},{excludes:["files/"]}),h.forEach(function(e){var n=e.relPath(t),r=" data-lastupdate='"+e.lastUpdate()+"' ";u+="<script language='text/tonyu' type='text/tonyu' data-filename='"+n+"'"+r+">\n",u+=o(e.text()),u+="</script>\n\n"}),p.forEach(function(e){var n=e.relPath(t),r=" data-lastupdate='"+e.lastUpdate()+"' ";u+="<script language='text/tonyu' type='text/tonyu' data-filename='"+n+"' data-wrap='80'"+r+">",u+=i(e.text(),80),u+="</script>\n\n"}),u};return i}),requireSimulator.setName("Content"),define(["FS"],function(t){return t.Content}),requireSimulator.setName("ScriptTagFS"),define(["Content"],function(t){function e(t){var e=document.createElement("div");return e.innerHTML=t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&#32;").replace(/\r/g,"&#13;").replace(/\n/g,"&#10;"),e.textContent||e.innerText}var n={};return n.toObj=function(){function t(t,e){var n=t.split("\n"),r="";return n.forEach(function(t){r+=t.length>e?t.substring(0,e):t+"\n"}),r}var n=$("script"),r={};return n.each(function(){var n=this;if("text/tonyu"==n.type){var i=$(n).data("filename");if(i){var o=parseInt($(n).data("lastupdate")),s=$(n).data("wrap"),a=e(n.innerHTML);s?(s=parseInt(s),r[i]={lastUpdate:o,text:t(a,s)}):r[i]={lastUpdate:o,text:a}}}}),r},n.copyTo=function(e){var r=n.toObj();for(var i in r){var o=e.rel(i);o.isText()?o.text(r[i].text):o.setBytes(t.url(r[i].text).toByteArray())}},n}),requireSimulator.setName("ImportHTMLDialog"),define(["exportAsScriptTags","UI","Klass","NewProjectDialog","ScriptTagFS"],function(t,e,n,r,i){return ImportHTMLDialog=n.define({$this:"t",show:function(t){t.createDOM(),t.dom.dialog({width:800,height:600}),t.mode("src")},createDOM:function(t){return t.dom?t.dom:(t.dom=e("div",{title:"HTMLからインポート"},["div",{$var:"src"},["div","ここにHTMLを貼り付けます"],["div",["button",{on:{click:t.$bind.selDir}},"Next->"]],["div",["textarea",{$var:"prog",rows:20,cols:60,placeholder:"Paste HTML Here"}]],["div",["button",{on:{click:t.$bind.selDir}},"Next->"]]],["div",{$var:"selDir"}],["div",{$var:"confirm"}],["div",{$var:"complete"}],["div",{$var:"files",css:{display:"none"}}]),t.vars=t.dom.$vars,t.dom)},selDir:function(t){t.vars.selDir.empty(),t.vars.selDir.append($("<h1>").text("インポート先のフォルダを入力してください")),t.vars.selDir.append(r.embed(t.prjDirs[0],t.$bind.confirm,{})),t.mode("selDir")},confirm:function(t,n){t.dst=n;var r=t.vars.prog.val(),o="";r.split("\n").forEach(function(t){t.match(/<script[^>]*src[^>]*javascript/)||(o+=t+"\n")}),t.vars.files.html(o),t.mode("confirm"),t.vars.confirm.empty(),t.vars.confirm.append(e("div",["button",{on:{click:t.$bind.complete}},"インポート開始"]));var s=i.toObj();for(var a in s){var u=n.rel(a),c=u.exists()?"上書":"新規";t.vars.confirm.append(e("div","[",c,"]",u.path()))}},complete:function(t){var n=t.dst;t.mode("complete");var r=i.toObj();for(var o in r){var s=n.rel(o);s.text(r[o].text)}t.vars.complete.empty(),t.vars.complete.append(e("h1","インポート完了")),t.dom.dialog("close"),t.onComplete()},mode:function(t,e){["src","selDir","confirm","complete"].forEach(function(e){t.vars[e].hide()}),t.vars[e].show()}})}),requireSimulator.setName("ide/selProject"),requirejs(["FS","Wiki","Shell","Shell2","NewProjectDialog","UI","Sync","Auth","zip","requestFragment","WebSite","extLink","DeferredUtil","ZipImporter","ProjectItem","ImportHTMLDialog"],function(t,e,n,r,i,o,s,a,u,c,f,l,p,h,d,g){$(function(){function e(t,e){function n(){i.show(t,function(t){t.mkdir(),location.href=2==f.version?"project2.html?dir="+t.path():"project.html?dir="+t.path()})}if(!t.exists()){if(0!=e)return;t.mkdir()}var s=$("<section>");$("#prjItemList").append(s),s.append(o("h2",{"class":"prjDirHeader"},t.path()));var u=o("div",{"class":"project newprj"},["a",{href:a,on:{click:n}},["img",{$var:"t",src:f.top+"/images/tonew.png"}],["div","新規作成"]]);u.appendTo(s);var c;c=o("div",{style:"display: inline-block;"},["button",{"class":"showAll",on:{click:function(){c.remove(),r(t,s)}}},"すべて見る..."]),s.append(c)}function r(t,e){function n(n){"prjB"===n.from?location.href=location.href.replace(/\?.*/,""):(e.find(".existentproject").remove(),s(t,e))}var r=new h(t,e,{onComplete:n});return y||(y=!0,r.checkFromPrjB()),s(t,e)}function s(t,e){var n=[];return t.each(function(t){if(t.isDir()){var e=t.lastUpdate();n.push([t,e])}}),n=n.sort(function(t,e){return e[1]-t[1]}),p.each(n,function(t){var n=t[0];if(n.isDir()){var r=new d(n,e);return""!=m&&r.name.toLowerCase().indexOf(m)<0&&r.hide(),p.timeout(10)}})}var a="javascript:;";$.get("https://edit.tonyu.jp/doc/welcome_sel.html").then(function(t){$("#welcome").append(t)}),$("#prjItemList").empty();var u,c="",m="";$("#prjItemList").append(u=o("div",["input",{$var:"kw",placeholder:"Search..",value:m}])),setInterval(function(){m=u.$vars.kw.val().toLowerCase(),m!=c&&($(".project").each(function(){var t=$(this),e=t.find(".projectName");""==m||e[0]&&e.text().toLowerCase().indexOf(m)>=0?t.show():t.hide()}),c=m)},1e3);var v=f.projects.map(function(e){return t.get(e)});v.forEach(e),f.isNW&&$("#loginGrp").hide();var y;SplashScreen.hide();var b=new g({onComplete:function(){location.reload()},prjDirs:v});window.importFromHTML=function(){b.show()},Util.getQueryString("importFromHTML")&&b.show(),n.cd(t.get(f.projects[0])),l.all(),n.wikiEditor=function(){document.location.href="wikiEditor.html"},$($("button.showAll").get(0)).click()})}),requireSimulator.setName();