function HttpHelper(t){var e={},n=t.lineMark;return e.buf=$("<div>"),e.bufs=[e.buf],e.maxLineNo=-1,e.cur=function(){return e.bufs[e.bufs.length-1]},e.p=function(t){"string"==typeof t&&(t=t.length>0?$("<span>").text(t):null),e.cur()?(e.lineNo>e.maxLineNo&&(e.maxLineNo=e.lineNo,e.cur().append($("<a>").attr({id:n+"-"+e.lineNo,name:n+"-"+e.lineNo}))),t&&e.cur().append(t)):console.log("Warning - Stack underflow")},e.enter=function(t){"string"==typeof t&&(t=$(t)),e.bufs.push(t)},e.exit=function(){var t=e.bufs.pop();e.p(t)},e.h=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e}!function(){var t={};return t.def=function(e,n,r){var i=t.getModuleInfo(t.curName);i.type=r,t.setReqs(i,e),i.func=function(){return n.apply(this,t.getObjs(e))},t.loadIfAvailable(i)},define=function(e,n){t.def(e,n,"define")},requirejs=function(e,n){t.def(e,n,"require")},t.setReqs=function(e,n){n.forEach(function(n){var r=t.getModuleInfo(n);r.loaded||(e.reqs[n]=r,r.revReqs[e.name]=e)})},t.getModuleInfo=function(e){var n=t.modules;return n[e]||(n[e]={name:e,reqs:{},revReqs:{}}),n[e]},t.doLoad=function(e){var n=t.getModuleInfo(e);if(n.loaded)return n.obj;n.loaded=!0;var r=null;if(n.func)r=n.func();else{var i=e.split(/\./);r=function(){return this}(),i.forEach(function(t){r&&(r=r[t])}),null==r&&console.log("Warning: No obj for "+e)}if("define"==n.type&&null==r)throw"No obj for "+e;n.obj=r;for(var o in n.revReqs)t.notifyLoaded(n.revReqs[o],n.name);return r},t.notifyLoaded=function(e,n){delete e.reqs[n],t.loadIfAvailable(e)},t.loadIfAvailable=function(e){for(var n in e.reqs)return;t.doLoad(e.name)},t.getObjs=function(e){var n=[];return e.forEach(function(e){var r=t.doLoad(e);n.push(r)}),n},t.modules={},t.setName=function(e){t.curName&&(t.getModuleInfo(t.curName).func||t.doLoad(t.curName)),e&&(t.curName=e)},requireSimulator=t,t}(),requireSimulator.setName("extend"),define([],function(){return function(t,e){for(var n in e)t[n]=e[n]}}),requireSimulator.setName("assert"),define([],function(){function t(e){if(e instanceof Array){var n=[];return e.forEach(function(e){n=n.concat(t(e))}),n}return[e]}var e,n=function(e){this.failMesg=t(e||"Assertion failed: ")};n.prototype={fail:function(){var n=e(arguments);throw n=t(n),n=this.failMesg.concat(n),console.log.apply(console,n),new Error(n.join(" "))},subAssertion:function(){var r=e(arguments);return r=t(r),new n(this.failMesg.concat(r))},assert:function(t,e){return t||this.fail(e),t},eq:function(t,e){return t!==e&&this.fail(t,"!==",e),t},ne:function(t,e){return t===e&&this.fail(t,"===",e),t},isset:function(t,e){return null==t&&this.fail((e||"")+" is null/undef"),t},is:function(t,e){var n=e,r=t;if(null==n&&this.fail("assert.is: type must be set"),n._assert_func)return n._assert_func.apply(this,[r]),t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){t&&"number"==typeof t.length||this.fail(t,"should be array:");for(var i=this,o=0;o<n.length;o++){var s=i.subAssertion("failed at ",t,"[",o,"]: ");null==n[o]&&console.log("WOW!7",r[o],n[o]),s.is(r[o],n[o])}return t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),t;if(n&&"object"==typeof n){for(var a in n){var s=this.subAssertion("failed at ",t,".",a,":");s.is(t[a],n[a])}return t}this.fail("Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&i(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)}},e=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var r=new n,i=function(){try{return r.assert.apply(r,arguments)}catch(t){throw new Error(t.message)}};return["is","isset","ne","eq","ensureError"].forEach(function(t){i[t]=function(){try{return r[t].apply(r,arguments)}catch(e){throw console.log(e.stack),new Error(e.message)}}}),i.fail=r.fail.bind(r),i.f=function(t){return{_assert_func:t}},i.and=function(){var t=e(arguments);return i(t instanceof Array),i.f(function(e){for(var n=this,r=0;r<t.length;r++)n.is(e,t[r])})},i}),requireSimulator.setName("PathUtil"),define(["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}function n(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n}var r,i=/^([a-zA-Z]):/,o=/^([a-z]+):\/\/\/?([^\/]+)\//,s=t.f(function(t){this.is(t,String),this.assert(r.isPath(t),[t," is not a path"])}),a=t.f(function(t){this.is(t,String),this.assert(r.isAbsolutePath(t),[t," is not a absolute path"])}),u=t.f(function(t){this.is(t,String),this.assert(!r.isAbsolutePath(t),[t," is not a relative path"])}),f=t.f(function(t){this.is(t,s),this.assert(r.isDir(t),[t," is not a directory path"])}),c=t.and(f,a),l=t.f(function(t){this.is(t,s),this.assert(!r.isDir(t),[t," is not a file path"])}),h="/";return r={Path:s,Absolute:a,Relative:u,Dir:f,File:l,AbsDir:c,SEP:h,endsWith:e,startsWith:n,hasDriveLetter:function(t){return i.exec(t)},isURL:function(t){var e=o.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:h+t.substring(e[0].length)}},isPath:function(){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&!r.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&(r.startsWith(e,h)||r.hasDriveLetter(e)||r.isURL(e))},isDir:function(n){return n=r.fixSep(n),t.is(arguments,[s]),e(n,h)},fixSep:function(e){return t.is(arguments,[String]),t.is(e.replace(/\\/g,"/"),s)},directorify:function(e){return e=r.fixSep(e),r.isDir(e)?e:t.is(e+h,f)},filify:function(e){return e=r.fixSep(e),r.isDir(e)?t.is(e.substring(0,e.length-1),l):e},splitPath:function(e){t.is(arguments,[s]);var n;if(n=this.isURL(e)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}e=e.replace(/\/+/g,h);var i=e.split(h);return""==i[i.length-1]&&(i[i.length-2]+=h,i.pop()),i},name:function(e){return t.is(arguments,[String]),r.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var n=r.name(e),i=/\.[a-zA-Z0-9]+$/.exec(n);return i?i[0]:null},truncExt:function(e,n){t.is(e,String);var i=r.name(e);return n=n||r.ext(e),t.is(n,String),i.substring(0,i.length-n.length)},truncSEP:function(e){return t.is(arguments,[s]),r.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(n,i){return t.is(arguments,[String,String]),e(r.name(n),i)},parent:function(e){return t.is(arguments,[String]),r.up(e)},rel:function(e,n){if(""==n)return e;t.is(arguments,[c,u]);var i=r.splitPath(n),o=e;o=o.replace(/\/$/,"");var s=r;return i.forEach(function(t){".."==t||"../"==t?o=s.up(o):(o=o.replace(/\/$/,""),o+=h+("."==t||"./"==t?"":t))}),o},relPath:function(e,n){return t.is(arguments,[a,a]),e.substring(0,n.length)!=n?"../"+r.relPath(e,this.up(n)):e.substring(n.length)},up:function(t){if(t=r.fixSep(t),t==h)return null;var e=r.splitPath(t);return e.pop(),e.join(h)+h}},r.isAbsolute=r.isAbsolutePath,r.isRelative=r.isRelativePath,"object"==typeof window&&(window.PathUtil=r),r}),requireSimulator.setName("MIMETypes"),define([],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".mp3":"audio/mp3",".ogg":"audio/ogg",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu"}}),requireSimulator.setName("FS2"),define(["extend","PathUtil","MIMETypes","assert"],function(t,e,n,r){function i(t){throw new Error(t+" is STUB!")}var o=function(){},s={};return o.addFSType=function(t,e){s[t]=e},o.availFSTypes=function(){return s},t(o.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},isReadOnly:function(){i("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(t){return r(this.getRootFS()!==this),this.getRootFS().resolveFS(t)},mounted:function(t,e){this.rootFS=t,this.mountPoint=e},inMyFS:function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},getRootFS:function(){return r(this.rootFS,"rootFS is not set")},getReturnTypes:function(){i("")},getContent:function(){i("getContent")},getContentAsync:function(){return this.supportsSync()||i("getContentAsync"),$.when(this.getContent.apply(this,arguments))},setContent:function(){i("")},setContentAsync:function(t,e,n){var r=this;return r.supportsSync()||i("setContentAsync"),$.when(e).then(function(e){return $.when(r.setContent(t,e,n))})},getMetaInfo:function(){i("")},setMetaInfo:function(){i("")},mkdir:function(){i("mkdir")},touch:function(){i("touch")},exists:function(){i("exists")},opendir:function(){i("opendir")},cp:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),i=i||{};var o=this.isDir(t),s=this.getRootFS().resolveFS(n),a=s.isDir(n);if(o||a)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(t),f=s.setContent(n,u);return i.a&&s.setMetaInfo(n,this.getMetaInfo(t)),f}return s.setContentAsync(n,this.getContentAsync(t)).then(function(e){return i.a?s.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(){i("")},link:function(t,e){throw new Error("ln "+e+" "+t+" : This FS not support link.")},getURL:function(){i("")}}),o.delegateMethods=function(t,n){for(var i in n)!function(i){r.ne(i,"inMyFS"),t[i]=function(){var t=arguments[0];r.is(t,e.Absolute);var o=this.resolveFS(t);return o!==this?o[i].apply(o,arguments):n[i].apply(this,arguments)}}(i)},o.delegateMethods(o.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},getContentType:function(t,r){var i=(e.ext(t)+"").toLowerCase();return n[i]||(r||{}).def||"text/plain"},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t){return e.isDir(t)},find:function(t,n){r.is(arguments,[e.Absolute]);var i=this.opendir(t,n),o=this,s=[t];return i.forEach(function(r){var i=e.rel(t,r);if(e.isDir(i)){var a=o.resolveFS(i);s=s.concat(a.find(i,n))}else s.push(i)}),s},resolveLink:function(t){r.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){r(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var o=e.rel(i,e.relPath(t,n));return r(o!=t,"np==path=="+o),r.is(this.getRootFS().resolveFS(o).resolveLink(o),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(){return null}}),o}),requireSimulator.setName("WebSite"),define(["PathUtil"],function(t){var e,n=document.location.href,r=!!n.match(/html\/dev\//)&&!!n.match(/localhost:3/);e=n.match(/jsrun\.it/)?{urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:r,pluginTop:"http://tonyuedit.appspot.com/js/plugins",removeJSOutput:!0}:n.match(/tonyuexe\.appspot\.com/)||n.match(/localhost:8887/)||n.match(/\/html\/((dev)|(build))\//)?{urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:r}:{urlAliases:{},top:".",devMode:r};var i=window.navigator.userAgent.toLowerCase();return e.tablet=-1!=i.indexOf("windows")&&-1!=i.indexOf("touch")||-1!=i.indexOf("ipad")||-1!=i.indexOf("android")&&-1==i.indexOf("mobile")||-1!=i.indexOf("firefox")&&-1!=i.indexOf("tablet")||-1!=i.indexOf("kindle")||-1!=i.indexOf("silk")||-1!=i.indexOf("playbook"),e.mobile=-1!=i.indexOf("windows")&&-1!=i.indexOf("phone")||-1!=i.indexOf("iphone")||-1!=i.indexOf("ipod")||-1!=i.indexOf("android")&&-1!=i.indexOf("mobile")||-1!=i.indexOf("firefox")&&-1!=i.indexOf("mobile")||-1!=i.indexOf("blackberry"),e.pluginTop||(e.pluginTop=e.top+"/js/plugins"),e.disableROM={},n.match(/tonyuedit\.appspot\.com/)||n.match(/localhost:8888/),(n.match(/\.appspot\.com/)||n.match(/localhost:888[87]/))&&(e.serverType="GAE"),n.match(/localhost:3000/)&&(e.serverType="Node"),e.serverTop=n.match(/tonyuexe\.appspot\.com/)||n.match(/localhost:8887/)?e.top+"/exe":e.top+"/edit",e.sampleImg=e.top+"/images",e.blobPath=e.serverTop+"/serveBlob",e.isNW="object"==typeof process&&process.__node_webkit,e.mp3Disabled=e.isNW,e.tonyuHome="/Tonyu/",e.url={getDirInfo:e.serverTop+"/getDirInfo",getFiles:e.serverTop+"/File2LSSync",putFiles:e.serverTop+"/LS2FileSync"},e.isNW?(e.cwd=t.directorify(process.cwd()),e.tonyuHome=process.env.TONYU_HOME?t.directorify(process.env.TONYU_HOME):t.rel(e.cwd,"fs/Tonyu/"),e.logdir=process.env.TONYU_LOGDIR,e.wwwDir=t.rel(e.cwd,"www/"),e.platform=process.platform,e.ffmpeg=t.rel(e.cwd,"win32"==e.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),e.pkgInfo=require(t.rel(e.cwd,"package.json")),e.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):e.pkgInfo&&e.pkgInfo.config&&e.pkgInfo.config.prjDirs?e.pkgInfo.config.prjDirs.map(function(n){return n=t.directorify(n),t.isAbsolute(n)?n:t.rel(e.cwd,n)}):[t.rel(e.cwd,"Projects/"),t.rel(e.tonyuHome,"Projects/")],e.kernelDir=t.rel(e.wwwDir,"Kernel/")):(e.wwwDir=location.protocol+"//"+location.host+"/",e.projects=[t.rel(e.tonyuHome,"Projects/")]),n.match(/tonyuedit\.appspot\.com/)||n.match(/localhost:888/)||e.isNW?(e.kernelDir=location.protocol+"//"+location.host+"/Kernel/",e.compiledKernel=e.top+"/Kernel/js/concat.js"):e.compiledKernel="http://tonyuexe.appspot.com/Kernel/js/concat.js",window.WebSite=e}),requireSimulator.setName("Util"),Util=function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:e(i[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function r(t,e){return t.substring(0,e.length)===e}function i(t){function e(e){throw console.log(e),console.log(t,f),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var r,i=t.length,o=0,s=0;if(!i)return new ArrayBuffer(0);r=Math.floor(i/4*3),"="==t.charAt(i-1)&&(r-=1),"="==t.charAt(i-2)&&(r-=1);for(var a=new ArrayBuffer(r),u=new Uint8Array(a),f=0,c=0;r>c&&(s=n[t.charCodeAt(f)],void 0===s&&e("Invalid letter: "+t.charCodeAt(f)),o=s<<2,f++,s=n[t.charCodeAt(f)],void 0===s&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=o|s>>4&3,o=(15&s)<<4,f++,c++,!(c>=r))&&(s=n[t.charCodeAt(f)],void 0===s&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=o|s>>2&15,o=(3&s)<<6,f++,c++,!(c>=r));)s=n[t.charCodeAt(f)],void 0===s&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=o|s,f++,c++;return a}function o(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,s=0,a=0;i>a&&(s=r[a],n+=e[s>>2],o=(3&s)<<4,a++,!(a>=i))&&(s=r[a],n+=e[o|s>>4],o=(15&s)<<2,a++,!(a>=i));)s=r[a],n+=e[o|s>>6],n+=e[63&s],a++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n}function s(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){var e=r.apply(t,arguments);return e})}(n);return e}function a(){return"undefined"!=typeof Buffer}function u(t){return a()&&t instanceof Buffer}function f(t){return t instanceof ArrayBuffer||u(t)}function c(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(r){throw console.log(e.join("")),r}}function l(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer}return{getQueryString:t,endsWith:n,startsWith:r,Base64_To_ArrayBuffer:i,Base64_From_ArrayBuffer:o,utf8bytes2str:c,str2utf8bytes:l,privatize:s,hasNodeBuffer:a,isNodeBuffer:u,isBuffer:f}}(),requireSimulator.setName("DataURL"),define(["extend","assert","Util"],function(t,e,n){function r(t,e){function r(e){throw console.log(e),console.log(t,h),new Error(e)}var i=e;t=t.replace(/[\n=]/g,"");var o=new Object;o[65]=0,o[66]=1,o[67]=2,o[68]=3,o[69]=4,o[70]=5,o[71]=6,o[72]=7,o[73]=8,o[74]=9,o[75]=10,o[76]=11,o[77]=12,o[78]=13,o[79]=14,o[80]=15,o[81]=16,o[82]=17,o[83]=18,o[84]=19,o[85]=20,o[86]=21,o[87]=22,o[88]=23,o[89]=24,o[90]=25,o[97]=26,o[98]=27,o[99]=28,o[100]=29,o[101]=30,o[102]=31,o[103]=32,o[104]=33,o[105]=34,o[106]=35,o[107]=36,o[108]=37,o[109]=38,o[110]=39,o[111]=40,o[112]=41,o[113]=42,o[114]=43,o[115]=44,o[116]=45,o[117]=46,o[118]=47,o[119]=48,o[120]=49,o[121]=50,o[122]=51,o[48]=52,o[49]=53,o[50]=54,o[51]=55,o[52]=56,o[53]=57,o[54]=58,o[55]=59,o[56]=60,o[57]=61,o[43]=62,o[47]=63;var s,a=t.length,u=0,f=0;if(!a)return new i(0);s=Math.floor(a/4*3),"="==t.charAt(a-1)&&(s-=1),"="==t.charAt(a-2)&&(s-=1);for(var c=new i(s),l=n.isNodeBuffer(c)?c:new Uint8Array(c),h=0,p=0;s>p&&(f=o[t.charCodeAt(h)],void 0===f&&r("Invalid letter: "+t.charCodeAt(h)),u=f<<2,h++,f=o[t.charCodeAt(h)],void 0===f&&r("Invalid letter: "+t.charCodeAt(h)),l[p]=u|f>>4&3,u=(15&f)<<4,h++,p++,!(p>=s))&&(f=o[t.charCodeAt(h)],void 0===f&&r("Invalid letter: "+t.charCodeAt(h)),l[p]=u|f>>2&15,u=(3&f)<<6,h++,p++,!(p>=s));)f=o[t.charCodeAt(h)],void 0===f&&r("Invalid letter: "+t.charCodeAt(h)),l[p]=u|f,h++,p++;return e===Uint8Array?l:c}function i(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],r="",i=n.isNodeBuffer(t)?t:new Uint8Array(t),o=i.length,s=0,a=0,u=0;o>u&&(a=i[u],r+=e[a>>2],s=(3&a)<<4,u++,!(u>=o))&&(a=i[u],r+=e[s|a>>4],s=(15&a)<<2,u++,!(u>=o));)a=i[u],r+=e[s|a>>6],r+=e[63&a],u++;var f=o%3;return f&&(r+=e[s]),1==f?r+="==":2==f&&(r+="="),r}var o=n.hasNodeBuffer()?Buffer:ArrayBuffer,s=(n.isNodeBuffer,n.isBuffer),a=function(t,n){"string"==typeof t?(this.url=t,this.binType=n||o,this.dataURL2bin(t)):t&&s(t.buffer)?(this.buffer=t.buffer,e.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):s(t)?(this.buffer=t,e.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),e.fail("Invalid args: ",arguments))};return a.isBuffer=s,t(a.prototype,{bin2dataURL:function(t,n){e(s(t)),e.is(n,String);var r=this.dataHeader(n),o=i(t);return e.is(o,String),this.url=r+o},dataURL2bin:function(t){e.is(arguments,[String]);var n=/^data:([^;]+);base64,/i,i=n.exec(t);return e(i,["malformed dataURL:",t]),this.contentType=i[1],this.buffer=r(t.substring(i[0].length),this.binType),e.is(this.buffer,this.binType)},dataHeader:function(t){return e.is(arguments,[String]),"data:"+t+";base64,"},toString:function(){return e.is(this.url,String)}}),a}),requireSimulator.setName("Content"),define(["DataURL","Util","assert"],function(t,e,n){var r=function(){},i=(e.isNodeBuffer,e.isBuffer);r.plainText=function(t,e){var n=new r;return n.contentType=e||"text/plain",n.plain=t,n},r.url=function(t){var e=new r;return e.url=t,e},r.buffer2ArrayBuffer=function(t){return e.isBuffer(t)?n(new Uint8Array(t).buffer,"n2a: buf is not set"):n(t,"n2a: a is not set")},r.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var e=new Buffer(new Uint8Array(t));return e}return n(t,"a2n: a is not set")},r.bin=function(t,o){n(o,"contentType should be set");var s=new r;if(t&&i(t.buffer))s.arrayBuffer=t.buffer;else if(e.isNodeBuffer(t))s.nodeBuffer=t;else{if(!(t instanceof ArrayBuffer))throw new Error(t+" is not a bin");s.arrayBuffer=t}return s.contentType=o,s};var o=r.prototype;return o.toBin=function(n){if(n=n||(e.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return n===Buffer?this.nodeBuffer:this.arrayBuffer=r.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return n===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=r.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var i=new t(this.url,n);return this.setBuffer(i.buffer)}if(null!=this.plain)return this.setBuffer(e.str2utf8bytes(this.plain,n));throw new Error("No data")},o.setBuffer=function(t){return n(t,"b is not set"),e.isNodeBuffer(t)?this.nodeBuffer=t:this.arrayBuffer=t},o.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},o.toNodeBuffer=function(){return this.toBin(Buffer)},o.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=e.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var n=new t(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=n.url}throw new Error("No data")},o.toPlainText=function(){if(null!=this.plain)return this.plain;if(this.url&&!this.hasBin()){var n=new t(this.url,ArrayBuffer);this.arrayBuffer=n.buffer}if(this.hasBin())return this.plain=e.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},o.hasURL=function(){return this.url},o.hasPlainText=function(){return null!=this.plain},o.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},o.hasNodeBuffer=function(){return this.nodeBuffer},o.hasArrayBuffer=function(){return this.arrayBuffer},r}),requireSimulator.setName("NativeFS"),define(["FS2","assert","PathUtil","extend","MIMETypes","DataURL","Content"],function(t,e,n,r,i,o,s){var a="object"==typeof process&&process.__node_webkit;if(!a)return function(){throw new Error("This system not suppert native FS")};var u=e,f=require("fs"),c=function(t){t&&(e.is(t,n.AbsDir),this.rootPoint=t)},l=n.hasDriveLetter(process.cwd());c.available=!0;var h=n.SEP,p=c.prototype=new t;return p.toNativePath=function(t){return this.rootPoint?(e.is(t,n.Absolute),e(this.inMyFS(t),t+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(t,this.mountPoint||n.SEP))):t},p.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var e=new Buffer(new Uint8Array(t));return e}return t},t.addFSType("NativeFS",function(t,e){return new c(e.r)}),c.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},c.prototype.inMyFS=function(t){return this.mountPoint?n.startsWith(t,this.mountPoint):!(!!l^!!n.hasDriveLetter(t))},t.delegateMethods(c.prototype,{getReturnTypes:function(){return u.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,r){r=r||{},e.is(t,n.Absolute);var i=this.toNativePath(t);return this.assertExist(t),this.isText(t)?s.plainText(f.readFileSync(i,{encoding:"utf8"})):s.bin(f.readFileSync(i),this.getContentType(t))},setContent:function(t,r){e.is(arguments,[n.Absolute,s]);var i=n.up(t);i&&this.getRootFS().resolveFS(i).mkdir(i);var o=this.toNativePath(t);r.hasBin()||!r.hasPlainText()?f.writeFileSync(o,r.toNodeBuffer()):f.writeFileSync(o,r.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(){},isReadOnly:function(){return!1},stat:function(t){e.is(t,n.Absolute);var r=this.toNativePath(t);return f.statSync(r)},mkdir:function(t){if(u.is(arguments,[n.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var e=n.up(t);e&&this.getRootFS().resolveFS(e).mkdir(e);var r=this.toNativePath(t);return f.mkdirSync(r),this.assertExist(r)},opendir:function(t){u.is(arguments,[String]);var e=this.toNativePath(t),r=n.truncSEP(e),i=f.readdirSync(e).map(function(t){var e=f.statSync(r+h+t),n=e.isDirectory()?h:"";return t+n}),o=[];return u.is(o.concat(i),Array)},rm:function(t,e){u.is(arguments,[n.Absolute]),e=e||{},this.assertExist(t);var r=this.toNativePath(t);return this.isDir(t)?f.rmdirSync(r):f.unlinkSync(r)},exists:function(t){var e=this.toNativePath(t);return f.existsSync(e)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():n.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&f.utimesSync(t,Date.now()/1e3,Date.now()/1e3)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")}}),c}),requireSimulator.setName("LSFS"),define(["FS2","PathUtil","extend","assert","Util","Content"],function(t,e,n,r,i,o){function s(){return(new Date).getTime()}var a=function(t,e){this.storage=t,this.options=e||{}},u=e.isDir.bind(e),f=e.up.bind(e),c=e.endsWith.bind(e),l=(e.Path,e.Absolute),h=e.SEP;return a.ramDisk=function(){var t={};return t[e.SEP]="{}",new a(t)},t.addFSType("localStorage",function(){return new a(localStorage)}),t.addFSType("ram",function(){return a.ramDisk()}),a.now=s,a.prototype=new t,a.prototype.resolveKey=function(t){return r.is(t,e.Absolute),this.mountPoint?e.SEP+e.relPath(t,this.mountPoint):t},a.prototype.getItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},a.prototype.setItem=function(t,n){r.is(t,e.Absolute);var i=this.resolveKey(t);r(i.indexOf("..")<0),r(e.startsWith(i,e.SEP)),this.storage[i]=n},a.prototype.removeItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},a.prototype.itemExists=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return n in this.storage},a.prototype.getDirInfo=function(t){if(r.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");c(t,h)||(t+=h),r(this.inMyFS(t));var n={};try{var i=this.getItem(t);i&&(n=JSON.parse(i))}catch(o){console.log("dinfo err : ",t,i)}return n},a.prototype.putDirInfo=function(t,n,i){if(r.is(arguments,[e.AbsDir,Object]),!u(t))throw new Error("Not a directory : "+t);r(this.inMyFS(t)),this.setItem(t,JSON.stringify(n));var o=f(t);if(null!=o&&this.inMyFS(o)){var s=this.getDirInfo(o);this._touch(s,o,e.name(t),i)}},a.prototype._touch=function(t,e,n,i){r.is(arguments,[Object,String,String]),r(this.inMyFS(e)),t[n]||(t[n]={},i&&(t[n].trashed=!0)),i||delete t[n].trashed,t[n].lastUpdate=s(),this.putDirInfo(e,t,i)},a.prototype.removeEntry=function(t,e,n){r.is(arguments,[Object,String,String]),t[n]&&(t[n]={lastUpdate:s(),trashed:!0},this.putDirInfo(e,t,!0))},a.prototype.removeEntryWithoutTrash=function(t,e,n){r.is(arguments,[Object,String,String]),t[n]&&(delete t[n],this.putDirInfo(e,t,!0))},a.prototype.isRAM=function(){return this.storage!==localStorage},a.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},t.delegateMethods(a.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t){r.is(arguments,[l]),this.assertExist(t);var e;return e=this.isText(t)?o.plainText(this.getItem(t)):o.url(this.getItem(t))},setContent:function(t,e){r.is(arguments,[l,o]),this.assertWriteable(t),this.isText(t)?this.setItem(t,e.toPlainText()):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t){if(this.assertExist(t,{includeTrashed:!0}),r.is(arguments,[l]),t==e.SEP)return{};var n=r(e.up(t));if(!this.inMyFS(n))return{};var i=e.name(t);r.is(n,e.AbsDir);var o=this.getDirInfo(n);return r(o[i])},setMetaInfo:function(t,n){r.is(arguments,[String,Object]),this.assertWriteable(t);var i=r(e.up(t));if(this.inMyFS(i)){var o=this.getDirInfo(i),s=e.name(t);o[s]=n,this.putDirInfo(i,o,o[s].trashed)}},mkdir:function(t){r.is(arguments,[l]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){r.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),i=[];for(var o in n)r(n[o]),(!n[o].trashed||e.includeTrashed)&&i.push(o);return r.is(i,Array)},rm:function(t,n){r.is(arguments,[l]),n=n||{},this.assertWriteable(t);var i=e.up(t);if(null==i||!this.inMyFS(i))throw new Error(t+": cannot remove. It is root of this FS.");if(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t)){var o=this.opendir(t);o.length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)}else this.removeItem(t);var s=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(s,i,e.name(t)):this.removeEntry(s,i,e.name(t))},exists:function(t,n){r.is(arguments,[l]),n=n||{};var i=e.name(t),o=e.up(t);if(null==o||!this.inMyFS(o))return!0;var s=this.getDirInfo(o),a=s[i];return a&&a.trashed&&this.itemExists(t)&&this.isDir(t),!a&&this.itemExists(t),a&&!a.trashed&&!a.link&&!this.itemExists(t),a&&!n.includeTrashed&&(a=!a.trashed),!!a},link:function(t,n){r.is(arguments,[e.Absolute,e.Absolute]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var i={};i.link=n,i.lastUpdate=s(),this.setMetaInfo(t,i),r(this.exists(t)),r(this.isLink(t))},isLink:function(t){if(r.is(arguments,[e.Absolute]),!this.exists(t))return null;var n=r(this.getMetaInfo(t));return n.link},touch:function(t){r.is(arguments,[l]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?this.setItem(t,"{}"):this.setItem(t,""));var n=f(t);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,e.name(t),!1)}else r(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)
},getURL:function(t){return this.getContent(t).toURL()}}),a}),requireSimulator.setName("Env"),define(["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),n=n.replace(/^[a-z][a-z]+:\//,function(t){return t+"/"}),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n}),requireSimulator.setName("SFile"),define(["extend","assert","PathUtil","Util","Content","FS2"],function(t,e,n,r,i,o){var s=function(t,r){e.is(r,n.Absolute),this._path=r,this.rootFS=t,this.fs=t.resolveFS(r),this.act={},this.act.path=this.fs.resolveLink(r),this.act.fs=t.resolveFS(this.act.path),e.is(this.act,{fs:o,path:n.Absolute}),this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return s.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},s.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},getPolicy:function(){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(t,i){var o;if(i=i||{},s.is(t))o=t;else{e.is(t,n.Absolute);var a,u=i.policy||this.policy;if(u&&(a=u.topDir)&&(a.path&&(a=a.path()),!n.startsWith(t,a)))throw new Error(t+": cannot access. Restricted to "+a);o=new s(this.rootFS,t),o.policy=u}return o.policy?r.privatize(o):o},contains:function(t){return e(s.is(t),t+" shoud be a SFile object."),this.isDir()?n.startsWith(t.path(),this.path()):!1},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var r=t.path?t.path():t;return n.relPath(this.path(),e.is(r,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,t))},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var t=this.metaInfo();return t?t.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.act.fs.getMetaInfo(this.act.path,t)},setMetaInfo:function(t,e){return this.act.fs.setMetaInfo(this.act.path,t,e)},lastUpdate:function(){return e(this.exists()),this.metaInfo().lastUpdate},exists:function(t){t=t||{};var e=this.fs.exists(this.path(),t);return e||t.noFollowLink?e:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(t){return t=t||{},this.isLink()?this.fs.rm(this.path(),t):(this.isDir()&&(t.recursive||t.r)&&this.each(function(e){e.rm(t)}),this.act.fs.rm(this.act.path,t))},removeWithoutTrash:function(t){t=t||{},t.noTrash=!0,this.rm(t)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(){return arguments.length>0?void this.setText(arguments[0]):this.getText()},setText:function(t){e.is(t,String),this.isText()?this.act.fs.setContent(this.act.path,i.plainText(t)):this.act.fs.setContent(this.act.path,i.url(t))},getContent:function(t){return"function"==typeof t?this.act.fs.getContentAsync(this.act.path).then(t):this.act.fs.getContent(this.act.path)},setContent:function(t){return this.act.fs.setContentAsync(this.act.path,t)},getText:function(){return this.isText()?this.act.fs.getContent(this.act.path).toPlainText():this.act.fs.getContent(this.act.path).toURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(){return this.act.fs.getContentType(this.act.path)},setBytes:function(t){return this.act.fs.setContent(this.act.path,i.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.act.fs.getContent(this.act.path).toBin(t.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(){return this.text().replace(/\r/g,"").split("\n")},obj:function(){var t=this;if(0==arguments.length){var n=t.text();return n?JSON.parse(n):null}t.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,n){e(t&&t.isSFile(),t+" is not a file");var r=this,n=n||{},i=r.isDir(),o=t.isDir();if(!i&&o&&(t=t.rel(r.name()),e(!t.isDir(),t+" is a directory."),o=!1),i&&!o)this.err("Cannot move dir to file");else{if(!i&&!o){n.echo&&n.echo(r+" -> "+t);var s=this.act.fs.cp(this.act.path,t.getResolvedLinkPath(),n);return n.a&&t.setMetaInfo(r.getMetaInfo()),s}e(i&&o),r.each(function(e){t.rel(e.name()).copyFrom(e,n)})}},moveFrom:function(t,e){var n=this.copyFrom(t,e);return t.rm({recursive:!0}),n},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){var n=this.assertDir();n.listFiles(e).forEach(t)},recursive:function(t,e){var n=this.assertDir();n.each(function(e){e.isDir()?e.recursive(t):t(e)},e)},listFiles:function(t){e(null==t||"object"==typeof t);var n,r=this.assertDir(),i=this.path();"function"==typeof t&&(n=t),t=r.convertOptions(t),n||(n=t.order);for(var o=this.act.fs.opendir(this.act.path,t),s=[],a=0;a<o.length;a++){var u=o[a];t.excludes[i+u]||s.push(r.rel(u))}return"function"==typeof n&&s.sort&&s.sort(n),s},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir(),r=n.listFiles(t);return r.map(function(t){return t.name()})},convertOptions:function(t){var r=(this.assertDir(),this.path());if(t||(t={}),t.excludes||(t.excludes={}),t.excludes instanceof Array){var i={};t.excludes.forEach(function(t){n.startsWith(t,"/")?i[t]=1:i[r+t]=1}),t.excludes=i}return e.is(t,{excludes:{}})},mkdir:function(){this.touch()},link:function(t,e){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,t.path(),e)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path}},s}),requireSimulator.setName("RootFS"),define(["assert","FS2","PathUtil","SFile"],function(t,e,n,r){var i=function(n){t.is(n,e),this.mount(null,n)},o=i.prototype,s={err:function(t,e){throw new Error(t+": "+e)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(e){t.is(arguments,[n.AbsDir]);var r=this.fstab();console.log(r);for(var i=0;i<r.length;i++)if(r[i].mountPoint==e)return r.splice(i,1),!0;return!1},availFSTypes:function(){return e.availFSTypes()},mount:function(n,r,i){if("string"==typeof r){var o=t(e.availFSTypes()[r],"fstype "+r+" is undefined.");r=o(n,i||{})}t.is(r,e),r.mounted(this,n),this.fstab().unshift(r)},resolveFS:function(r){t.is(r,n.Absolute);var i;return this.fstab().forEach(function(t){i||t.inMyFS(r)&&(i=t)}),i||this.err(r,"Cannot resolve"),t.is(i,e)},get:function(e){return t.is(e,n.Absolute),new r(this.resolveFS(e),e)}};for(var a in s)o[a]=s[a];return i}),requireSimulator.setName("FS"),define(["FS2","WebSite","NativeFS","LSFS","PathUtil","Env","assert","SFile","RootFS"],function(t,e,n,r,i,o,s,a,u){var t={};"object"==typeof window&&(window.FS=t);var f,c=new o(e);return f=new u(e.isNW?new n:new r(localStorage)),t.getRootFS=function(){return f},t.get=function(){return f.get.apply(f,arguments)},t.expandPath=function(){return c.expandPath.apply(c,arguments)},t.resolve=function(e,n){return a.is(e)?e:(e=c.expandPath(e),n&&!i.isAbsolutePath(e)?(n=c.expandPath(n),t.get(n).rel(e)):t.get(e))},t.mount=function(){return f.mount.apply(f,arguments)},t.unmount=function(){return f.unmount.apply(f,arguments)},t}),requireSimulator.setName("HttpHelper"),requireSimulator.setName("Arrow"),Arrow=function(){var t={};return t.show=function(t){function e(){t.addClass("tutorial-highlight"),setTimeout(n,200)}function n(){t.removeClass("tutorial-highlight"),o-->0?setTimeout(e,200):r()}function r(){o=0,$.data(t[0],"blinking","f")}if("string"==typeof t&&(t=$(t)),0==t.length)return!1;var i=$.data(t[0],"blinking");if("t"!=i){$.data(t[0],"blinking","t");var o=3;e(),t.click(function(){r()})}},t.showOld=function(t){function e(){r&&(r.attr({src:"images/arrow"+i+".png"}),i=(i+1)%4)}if("string"==typeof t&&(t=$(t)),0==t.length)return!1;var n=t.offset(),r=$("<img>").attr({src:"images/arrow0.png"}).css({font:"40px",position:"absolute",left:n.left,top:n.top+t.height(),color:"red",zIndex:1e3,"z-index":1e3}).appendTo("body"),i=0;return setInterval(e,250),t.click(function(){r&&(r.remove(),r=null)}),!0},t}(),requireSimulator.setName("Shell"),define(["FS","Util","WebSite","PathUtil","assert"],function(t,e,n,r){function i(t,e){var n=o(t);if(e&&!n.exists())throw n+": no such file or directory";return n}function o(e){if("string"!=typeof e)return e;if(r.isAbsolutePath(e))return t.get(e);var n=s.cwd;return n.rel(e)}var s={};return s.cd=function(t){return s.cwd=i(t,!0),s.pwd()},s.mount=function(e,n){if(!e||!e.t){var r=[];for(var i in t.getRootFS().availFSTypes())r.push(i);return void sh.err("-t=("+r.join("|")+") should be specified.")}t.mount(n,e.t,e)},s.unmount=function(e){t.unmount(e)},s.fstab=function(){var e=t.getRootFS(),n=e.fstab(),r=this;n.forEach(function(t){r.echo(t.fstype()+"	"+(t.mountPoint||""))})},s.resolve=i,s.pwd=function(){return s.cwd+""},s.ls=function(t){return t=t?i(t,!0):s.cwd,t.ls()},s.cp=function(t,e,n){n||(n={}),n.v&&(s.echo("cp",t,e),n.echo=s.echo.bind(s));var r=i(t,!0),o=i(e);return r.copyTo(o,n)},s.ln=function(t,e,n){var r=i(e),o=i(t,!0);if(r.isDir()&&r.exists()&&(r=r.rel(o.name())),r.exists())throw new Error(r+" exists");return r.link(o,n)},s.rm=function(t,e){if(e||(e={}),e.notrash)return t=i(t,!1),t.removeWithoutTrash(),1;if(t=i(t,!0),t.isDir()&&e.r){var n=t,r=0;return n.each(function(t){t.exists()&&(r+=s.rm(t,e))}),n.rm(),r+1}return t.rm(),1},s.cat=function(t){return t=i(t,!0),s.echo(t.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}))},s.resolve=function(t){return t||(t="."),t=i(t)},s.grep=function(t,e,n){function r(t,e,r){n.res&&n.res.push({file:t,lineNo:e,line:r}),s.echo(t+"("+e+"): "+r)}return e=i(e,!0),n||(n={}),n.res||(n.res=[]),e.isDir()?e.each(function(e){s.grep(t,e,n)}):"string"==typeof t&&e.lines().forEach(function(n,i){n.indexOf(t)>=0&&r(e,i+1,n)}),n.res},s.touch=function(t){return t=i(t),t.text(t.exists()?t.text():""),1},s.setout=function(t){s.outUI=t},s.echo=function(){console.log.apply(console,arguments),s.outUI&&s.outUI.log&&s.outUI.log.apply(s.outUI,arguments)},s.err=function(){console.log.apply(console,arguments),s.outUI&&s.outUI.err&&s.outUI.err.apply(s.outUI,arguments)},s.prompt=function(){},s.ASYNC={r:"SH_ASYNC"},s.help=function(){for(var t in s){var e=s[t];"function"==typeof e&&s.echo(t+(e.description?" - "+e.description:""))}},sh=s,n.isNW&&(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()}),s}),requireSimulator.setName("Log"),define(["FS","WebSite","Shell"],function(t,e,n){function r(t,e){return t="00000000000000"+t,t.substring(t.length-e)}function i(t){return t.replace(/\n/g,"\n|")}var o={},s=e.logdir?t.resolve("${logdir}"):null,a=s&&s.exists();if(o.todayDir=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();return s.rel(e+"/").rel(n+"/").rel(r+"/")},o.curFile=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();return o.todayDir().rel(e+"-"+n+"-"+r+".log")},o.curProject=function(){var t=new Date,e=t.getHours(),n=t.getMinutes(),i=t.getSeconds();return o.todayDir().rel("Project/").rel(r(e,2)+"_"+r(n,2)+"_"+r(i,2)+"/")},o.dumpProject=function(t){if(a){var e=o.curProject();n.cp(t,e),o.append("Dumped project to "+e.path())}},!e.logging&&!e.isNW){var u=t.get("/var/log/");u.exists()&&u.fs.storage===localStorage&&u.removeWithoutTrash({r:!0})}return o.append=function(t){if(a){var e=o.curFile(),n=e.exists()?e.text():"";e.text(n+t+"\n")}},o.d=function(t,e){o.append(new Date+": ["+t+"]"+i(e))},o.e=function(t,e){o.append(new Date+": ERROR["+t+"]"+i(e))},o}),requireSimulator.setName("exceptionCatcher"),define([],function(){var t={};return t.f=function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(n){t.handleException(n)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var r in e)e[r]=t.f(e[r]);return e}},t}),requireSimulator.setName("UI"),define(["Util","exceptionCatcher"],function(t,e){var n={},r=e.f;return n=function(){function e(){c.forEach(function(t){t()}),setTimeout(r(e),50)}function i(t){return t instanceof Array?o(t):"string"==typeof t?a(t):t}function o(t){var e=t[0],n=1,r=$("<"+e+">");for("object"!=typeof t[n]||t[n]instanceof Array||t[n]instanceof $||(s(r,t[n],e),n++);n<t.length;)r.append(i(t[n])),n++;return r}function s(e,i){function o(t,n){if(n)if("enterkey"==t)e.on("keypress",r(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var o,s=!0;c.push(function(){var t;t="checkbox"==i.type?!!e.prop("checked"):e.val(),(s||o!=t)&&(n.apply(e,[t,o]),o=t),s=!1})}else e.on(t,r(n))}i.$var&&(l[i.$var]=e),i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(t){h.writeToModel(i.$edit,t,e)}),l[i.$edit.name]||(l[i.$edit.name]=e),h.push({jq:e,params:i}));for(var s in i)if("on"==s)for(var a in i.on)o(a,i.on[a]);else"css"==s&&null!=i[s]?e.css(i[s]):t.startsWith(s,"$")||null==i[s]||e.attr(s,i[s])}function a(t){return $("<span>").text(t)}for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];var c=[],l={},h=[],p=i(u);return p.$edits=h,p.$vars=l,h.load=function(t){h.model=t,h.forEach(function(t){h.writeToJq(t.params.$edit,t.jq)}),h.validator.on.validate.call(h.validator,h.model)},h.writeToJq=function(t,e){var n=h.model;if(n){for(var r=t.name,i=r.split("."),o=0;o<i.length;o++)n=n[i[o]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},h.validator={errors:{},show:function(){if(l.validationMessage){l.validationMessage.empty();for(var t in this.errors)l.validationMessage.append(n("div",this.errors[t].mesg))}if(l.OKButton){var e=!0;for(var t in this.errors)e=!1;l.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},h.writeToModel=function(t,e,n){var r=h.model;if(r){var i=t.name;try{e=t.type.fromVal(e)}catch(o){return void h.validator.addError(i,o,n)}h.validator.removeError(i);for(var s=i.split("."),a=0;a<s.length;a++)a==s.length-1?h.on.writeToModel(i,e)||(r[s[a]]=e):r=r[s[a]];h.validator.on.validate.call(h.validator,h.model)}},h.on={},h.on.writeToModel=function(){},c.length>0&&setTimeout(r(e),50),p},n.types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),requireSimulator.setName("Wiki"),define(["HttpHelper","Arrow","Util","WebSite","Log","UI","FS"],function(t,e,n,r,i,o,s){return Wiki=function(n,a,u){function f(t){function e(t){t.stopPropagation(),t.preventDefault()}function n(t){if(u.editMode){var e=t.originalEvent,n=e.dataTransfer.files[0];if(!n.type.match(/image\/(png|gif|jpg)/)[1])return t.stopPropagation(),t.preventDefault(),!1;var r=new FileReader;return r.onload=function(){var t=r.result;a.text(t),i.empty().append(o("img",{src:t}))},r.readAsDataURL(n),t.stopPropagation(),t.preventDefault(),!1}}var i,a;if(l.builtinImages[t])return $("<div>").append($("<img>").attr("src",r.top+"/doc/images/"+t));i=o("div",{style:"margin:10px; padding:10px; border:solid black 1px;",on:{dragover:e,dragenter:e,drop:n}},"ここに画像ファイル(png/gif/jpg)をドラッグ＆ドロップして追加");var f=s.get(r.tonyuHome);return a=f.rel("doc/images/").rel(t),a.exists()&&i.empty().append(o("img",{src:a.text()})),i}function c(t,e,n){function r(){for(var s=[];;){var a=t.indexOf(e,o),u=t.indexOf(n,o);if(u>=0&&(0>a||a>u)){s.push(t.substring(o,u)),o=u;break}if(0>a){s.push(t.substring(o)),o=t.length;break}s.push(t.substring(o,a)),o=a+e.length;var f=r();f.hasBrace=!0,o<t.length&&(o+=n.length),s.push(f)}return i(s),s}function i(t){return t.split=function(t,e){if(1==e)return this;var n=[],r=i([]);return this.forEach(function(o){if("string"==typeof o){var s=o.indexOf(t);if(n.length>=e&&(s=-1),s>=0){if(s>0){var a=o.substring(0,s);r.push(a)}if(s+=t.length,n.push(1!=r.length?r:r[0]),r=i([]),s<o.length){var a=o.substring(s);r.push(a)}}else r.push(o)}else r.push(o)}),n.push(1!=r.length?r:r[0]),n},t.text=function(t){var r=this.hasBrace&&t?e:"";return this.forEach(function(t){r+="string"==typeof t?t:t.text(!0)}),r+=this.hasBrace&&t?n:""},t.toString=function(){return this.text(!0)},t}var o=0;return r(0)}var l={},h={figures:"図",plists:"リスト"},p="line_marker_",d={},g=[],m=".txt";if(u||(u={}),a&&!a.isDir())throw a+": not a dir";var v,y;l.on=d,l.cd=function(t){v=t,y=v.rel("toc.json")},a&&l.cd(a),l.encodeURL=function(t){return encodeURI(t).replace(/%/g,"")},l.parse=function(n,i,o){function s(t){g[t]={};var e=1,n=function(n,r){var i=g[t][n];return i||(i={refs:[]},g[t][n]=i),r&&(i.no=e++,i.name=h[t]+i.no,i.refs.forEach(function(t){t.text(i.name)})),i};return n}function a(t){function e(t){for(null==t&&(t=0);g.ul>t;)g.ul--,m.exit()}m.lineNo=g.lineNo;var n=0;if(t.match(/^-+/)&&(n=RegExp.lastMatch.length),n>g.ul)for(;n>g.ul;)g.ul++,m.enter("<ul>");else e(n);if(t=t.substring(n),n>0&&m.enter("<li>"),t.match(/^\*+/)){var r=RegExp.rightContext,i="h"+RegExp.lastMatch.length;m.enter("<"+i+">"),d(r),m.exit()}else if(t.match(/^$/))e(),m.p($("<p>"));else if(t.match(/^<<toc(.*)/))g.toc=[g.name],g.blocks.push({name:"toc",exit:function(){y&&!y.isReadOnly()&&y.obj(g.toc),g.toc=null}});else if(t.match(/^<<code(.*)/)){var o=RegExp.$1;if(o=o.replace(/^ */,""),o.length>0){var s,a,u=o.split(/ /,2);if(2==u.length){a=u[0],s=u[1];var f=x(s,!0);m.p($("<div>").addClass("plist").text(f.name+" "+a))}else m.p($("<div>").addClass("plist").text(u))}m.enter("<pre>"),g.blocks.push({name:"code",exit:function(){m.exit()}})}else if(t.match(/^>>/)){var c=g.blocks.pop();c&&c.exit&&c.exit(g)}else if(t.match(/^@@@@(.*)/)){if(g.pclose)m.exit();else{if(RegExp.$1.length>0){var f=x(RegExp.$1,!0);m.p($("<div>").addClass("plist").text(f.name))}m.enter("<pre>")}g.pclose=!g.pclose}else d(t),m.p("\n");n>0&&m.exit(),g.lineNo++}function d(t){function n(t){var n,i=t.text();if(i.match(/^@blink ([^>]+)>([^\s]+)/)){caption=RegExp.$1;var s=RegExp.$2;n=$("<span>").addClass("clickable").text(caption).hover(function(){var t;parent&&parent.Arrow&&(t=parent.Arrow),e&&(t=e),t&&t.show(s)})}else if(i.match(/^@plistref (.*)/)){var a=RegExp.$1,c=x(a);n=$("<strong>").text(c.name),c.refs.push(n)}else if(i.match(/^@editadd/))m.p($("<img>").attr("src",r.top+"/images/editAdd.png"));else if(i.match(/^@figref (.*)/)){var c=v(RegExp.$1);n=$("<strong>").text(c.name),c.refs.push(n)}else if(i.match(/^@cfrag (.*)/)){var p=RegExp.$1;n=$("<code>"),m.enter(n),d(p),m.exit()}else if(i.match(/^@arg (.*)/)){var y=RegExp.$1;n=$("<i>"),m.enter(n),d(y),m.exit()}else{var b=t.split(">",2);if(2==b.length?(i=b[1]+"",caption=b[0]):caption=i,g.toc&&g.toc.push(i),i.match(/\.(png|jpg|gif)$/)&&!i.match(/^http/)){var c=v(i,!0);n=$("<div>").addClass("figure").append(f(i)),m.enter(n),m.enter($("<div>")),m.p(h.figures+c.no+"."),d(caption),m.exit(),m.exit()}else if(i.match(/^https?:\/\//))n=$("<a>").attr({href:i,target:"ext"}).text(caption);else{var S=l.resolveFile(i);if(S.exists()||!S.isReadOnly()&&u.editMode){if(u.useAnchor){var w=S.relPath(o.up()).replace(/\.txt$/,".html");w=l.encodeURL(w),n=$("<a>").attr({href:w}).text(caption)}else n=$("<span>").addClass("clickable").text(caption).click(function(){l.show(S)});S.exists()||n.addClass("notexist")}else n=$("<span>").text(caption)}}m.p(n)}var i="string"==typeof t?c(t,g.beginMark,g.endMark):t;i.forEach(function(t){"string"==typeof t?m.p(t):n(t)})}var g={},m=t({lineMark:p});g.out=m,g.name=i,g.lines=n.split(/\r?\n/),g.lineNo=0,g.ul=0,g.beginMark="[[",g.endMark="]]",g.blocks=[];var v=s("figures"),x=s("plists"),b=[];y&&y.exists()&&(b=y.obj());var S=b.indexOf(i);if(S>=0){var w="",T=b[S-1];T&&(w+="[[前へ>"+T+"]]");var A=b[S+1];A&&(w+=" - [[次へ>"+A+"]]");var D=b[0];0!=S&&(w+=" - [[目次>"+D+"]]"),g.lines.unshift(w),g.lines.push(w)}return g.lines.forEach(a),m.buf},l.resolveFile=function(t){var e;return e=t.isDir?t:v&&"/"!=t.substring(0,1)?v.rel(t+m):s.get(t)},l.show=function(t){var e=l.resolveFile(t);u.editMode||i.d("wiki","show "+e),l.cd(e.up());var r=e.truncExt(m);if(!e.exists()&&!e.isReadOnly()&&u.editMode){var o=g[g.length-1];e.text(o?"[["+o.truncExt(m)+"]]\n":"")}if(e.exists()){var s=l.parse(e.text(),r,e);n.empty(),n.scrollTop(0),n.append(s),n.append($("<div>").css({height:"100px"}).text("")),d.show&&d.show.apply(l,[e,r]),g.push(e)}else alert(t+" というページはありません")},l.back=function(){var t=g.pop();t&&show(t)};var x;return l.highlightLine=function(t){var e=$("#"+p+"-"+t);if(0!=e.length){x&&x.removeClass("wiki-cur-line"),x=e.next(),x.addClass("wiki-cur-line");var r=e.position().top,i=n;0>r&&i.scrollTop(i.scrollTop()+(r-10)/2);var o=i.height()-100;r>o&&i.scrollTop(i.scrollTop()+(r-o+10)/2)}},l.builtinImages={"50_100.png":1,"50_160.png":1,"50_300.png":1,"apple1apple2.png":1,"coords.png":1,"copy60_100.png":1,"firstRunRes.png":1,"firstVarRes.png":1,"itadaki.png":1,"noWaitCat.png":1,"runtimeError.png":1,"sample.png":1,"sayonara.png":1,"syntaxError.png":1},l}}),requireSimulator.setName("Shell2"),define(["Shell","UI","FS","Util"],function(t,e,n,r){var i={};i.show=function(t){var e=i.embed(t);e.dialog({width:600,height:500})},i.embed=function(){i.d||(i.d=e("div",{title:"Shell"},["div",{$var:"inner"},"Type 'help' to show commands.",["br"]]),i.inner=i.d.$vars.inner,t.prompt());var n=i.d;return n},t.cls=function(){i.d.$vars.inner.empty()},t.prompt=function(){function n(t){return 9==t.which?(t.stopPropagation(),t.preventDefault(),s(),!1):void(13==t.which&&(c.empty(),o(u.val())))}function o(){var n=u.val().replace(/^ */,"").replace(/ *$/,"");if(0!=n.length){var r=n.split(/ +/),i=r.shift(),o=t[i];if("function"!=typeof o)return f.append(i+": command not found.");try{var s=[],a=null;r.forEach(function(t){var e=/^-([A-Za-z_0-9]+)(=(.*))?/.exec(t);e?(a||(a={}),a[e[1]]=null!=e[3]?e[3]:1):(a&&s.push(a),a=null,s.push(t))}),a&&s.push(a);var c=o.apply(t,s);if(c===t.ASYNC)return;if("object"==typeof c)if(c instanceof Array){var l=e("table"),h=null,p=0;c.forEach(function(t){h||(h=e("tr").appendTo(l)),h.append(e("td",t)),p++,p%3==0&&(h=null)}),l.appendTo(f)}else f.append(JSON.stringify(c));else f.append(c);t.prompt()}catch(d){t.err(d),t.prompt()}}}function s(){var e=u.val(),n=e.split(" "),i=n.pop(),o=[];if(0==n.length)for(var s in t)"function"==typeof t[s]&&r.startsWith(s,i)&&o.push(s);else{var a=t.resolve(i,!1);if(!a)return;var f=a.isDir()?a:a.up();f.each(function(t){r.startsWith(t.path(),a.path())&&o.push(t.name())})}if(1==o.length){var l=i.split("/");l.pop(),l.push(o[0]),n.push(l.join("/")),u.val(n.join(" ")),c.empty()}else c.text(o.join(", "))}var a=e("div",["input",{$var:"cmd",size:40,on:{keydown:n}}],["pre",{$var:"out","class":"shell out"},["div",{$var:"cand","class":"shell cand"}]]),u=a.$vars.cmd,f=a.$vars.out,c=a.$vars.cand;return t.setout({log:function(){return $.when.apply($,arguments).then(function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);f.append(t[0]instanceof $?t[0]:e("span",t.join(" ")+"\n"))})},err:function(t){f.append(e("div",{"class":"shell error"},t,["br"],["pre",t.stack]))}}),a.appendTo(i.inner),u.focus(),i.inner.closest(".ui-dialog-content").scrollTop(i.inner.height()),t.ASYNC},t.window=function(){i.show(t.cwd)},t.atest=function(t,e,n){console.log(t,e,n)};var o=t.cat;return t.cat=function(n){return n=t.resolve(n,!0),n.contentType().match(/^image\//)?n.getContent(function(n){t.echo(e("img",{src:n.toURL()}))}):o.apply(t,arguments)},i}),requireSimulator.setName("NewProjectDialog"),define(["UI"],function(t){var e={};return e.show=function(t,n,r){var i=e.embed(t,n,r);i.dialog({width:600})},e.embed=function(n,r,i){if(i||(i={}),!e.d){var o={fromVal:function(t){return""==t?null:FS.get(t)},toVal:function(t){return t?t.path():""}};e.d=t("div",{title:i.ren?"プロジェクト名の変更":"新規プロジェクト"},["div",["span","プロジェクト名"],["input",{$edit:"name",value:i.defName||"",on:{enterkey:function(){e.d.done()}}}]],["div",["span","親フォルダ"],["input",{$edit:{name:"parentDir",type:o}}]],["div",["span","作成先フォルダ："],["span",{$var:"dstDir"}]],["div",{$var:"validationMessage",css:{color:"red"}}],["button",{$var:"OKButton",on:{click:function(){e.d.done()}}},"OK"])}var s=e.d,a={name:i.defName||"",parentDir:n};return s.$edits.load(a),s.$edits.validator.on.validate=function(t){return""==t.name?void this.addError("name","名前を入力してください"):(t.dstDir=t.parentDir.rel(t.name+"/"),t.dstDir.exists()?void this.addError("name","このフォルダはすでに存在します"):(this.allOK(),void s.$vars.dstDir.text(t.dstDir+"")))},s.done=function(){s.$edits.validator.isValid()&&(r(a.dstDir),s.dialog&&s.dialog("close"))},s},e}),requireSimulator.setName("requestFragment"),define(["WebSite"],function(t){var e={};return e.ajax=function(e){function n(t){return e.redirectTo&&(t.redirectTo=e.redirectTo),t}function r(){$.ajax({type:"post",url:t.serverTop+"/runFragments",data:n({id:a}),success:function(t){return"string"==typeof t&&t.match(/^notCompleted:([\-\d]+)\/([\-\d]+)$/)?(console.log("notcomp",t),c*=2,void setTimeout(r,c)):void e.success(t)},error:e.error,complete:e.complete})}var i=e.THRESH||8e5,o=e.data;if("object"!=typeof o)throw"Data should be object: "+o;if(o=JSON.stringify(o),!e.redirectTo&&("GAE"!=t.serverType||o.length<i))return $.ajax(e);for(var s=[],a=Math.random();o.length>0;)s.push(o.substring(0,i)),o=o.substring(i);var u=s.length,f=0,c=1e3;s.forEach(function(i,o){$.ajax({type:"post",url:t.serverTop+"/sendFragment",data:n({id:a,seq:o,len:u,content:i}),success:function(t){console.log("sendFrag",t,o),f++,f>=u&&setTimeout(r,c)},error:e.error})})},e}),requireSimulator.setName("Sync"),define(["FS","Shell","requestFragment","WebSite"],function(t,e,n,r){function i(t){return t&&t.isDir}var o={};return e.sync=function(){function t(t){return function(){t&&t.apply({},arguments),e.prompt()}}var n,r,s,a=function(){},u=0;return("string"==typeof arguments[u]||i(arguments[u]))&&(n=e.resolve(arguments[u],!0),u++,("string"==typeof arguments[u]||i(arguments[u]))&&(r=e.resolve(arguments[u],!1),u++)),"object"==typeof arguments[u]&&(s=arguments[u],u++),"function"==typeof arguments[u]&&(a=arguments[u],u++),n||(r=n=e.cwd),s&&s.onend&&(s.onend=t(s.onend)),r||(r=n),e.echo("sync args=",n,r,s,a),o.sync(n,r,s,t(a)),e.ASYNC},o.sync=function(){function t(t,n){e.echo("Status: "+t+" param:",n),p.onstatus&&p.onstatus(t,n)}function o(){p.onerror&&p.onerror.apply(this,arguments)}function s(){var e={base:h.path(),excludes:JSON.stringify(p.excludes)};t("getDirInfo",e),$.ajax({type:"get",url:r.serverTop+"/getDirInfo",data:e,success:a,error:o})}function a(n){p.v&&e.echo("getDirInfo",n);var i=l,s=n.data;for(var a in s){var f=i.rel(a),d=f.exists({includeTrashed:!0})&&f.metaInfo(),g=s[a];c(f,a,d,g)}l.recursive(function(t){var e=t.exists({includeTrashed:!0})&&t.metaInfo(),n=t.relPath(l),r=s[n];c(t,n,e,r)},{includeTrashed:!0,excludes:p.excludes}),p.v&&(e.echo("uploads:",m),e.echo("downloads:",v));var y={base:h.path(),paths:JSON.stringify(v)};t("File2LSSync",y),$.ajax({type:"post",url:r.serverTop+"/File2LSSync",data:y,success:u,error:o})}function u(i){e.echo("dlData=",i),p.v&&e.echo("dlData:",i);var s=l;if(!p.test){for(var a in i.data){var u=s.rel(a),c=i.data[a];c.trashed?u.exists()&&u.rm():u.text(c.text),delete c.text,u.metaInfo(c)}var d={base:h.path(),data:JSON.stringify(m)};d.pathInfo="/LS2FileSync",t("LS2FileSync",d),n.ajax({type:"post",url:r.serverTop+"/LS2FileSync",data:d,success:f,error:o})}}function f(t){p.v&&e.echo("LS2FileSync res=",t);var n=[];for(var r in m)n.push(r);t={msg:t,uploads:n,downloads:v},"function"==typeof d&&d(t)}function c(t,n,r,i){if(!y[n])if(y[n]=1,i&&(!r||r.lastUpdate<i.lastUpdate))v.push(n),p.v&&e.echo((r?"":"New")+"Download "+t+" trash="+!!i.trashed);else if(r&&(!i||r.lastUpdate>i.lastUpdate)){var o=r.trashed?{}:{text:t.text()},s=t.metaInfo();for(var a in s)o[a]=s[a];m[n]=o,p.v&&e.echo((i?"":"New")+"Upload "+t+" trash="+!!r.trashed)}}var l,h,p,d,g=0;if(i(arguments[g])&&(l=arguments[g],g++,i(arguments[g])&&(h=arguments[g],g++)),"object"==typeof arguments[g]&&(p=arguments[g],g++),"function"==typeof arguments[g]&&(d=arguments[g],g++),!l)throw"Sync.sync: Local dir must be specified as file object";h||(h=l),p||(p={}),!d&&p.onend&&(d=p.onend),p.test&&(p.v=1),s();var m={},v=[],y={}},e.rsh=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return $.ajax({url:r.serverTop+"/rsh",data:{args:JSON.stringify(t)},success:function(t){e.echo(t)},error:function(t,n,r){e.err(r)},complete:function(){e.prompt()}}),e.ASYNC},o}),requireSimulator.setName("Auth"),define(["WebSite"],function(t){var e={};return e.currentUser=function(e){$.ajax({type:"get",url:t.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(t){console.log("auth.currentUser",t),t=JSON.parse(t);var n=t.user;"null"==n&&(n=null),console.log("user",n,"csrfToken",t.csrfToken),e(n,t.csrfToken)}})},e.assertLogin=function(n){e.currentUser(function(e,r){return e?n.success(e,r):(window.onLoggedIn=n.success,void n.showLoginLink(t.serverTop+"/login"))})},window.Auth=e,e}),requireSimulator.setName("zip"),define(["FS","Shell","Util"],function(t,e,n){if("undefined"==typeof JSZip)return{};var r={};r.zip=function(t){function e(t,n){n.each(function(n){if(n.isDir()){var r=t.folder(n.name());e(r,n)}else n.isText()?t.file(n.name(),n.text()):t.file(n.name(),n.getBytes({binType:ArrayBuffer}))})}var n=new JSZip;e(n,t);var r=n.generate({type:"blob"});return r},"undefined"!=typeof saveAs&&(r.dlzip=function(t){var e=r.zip(t);saveAs(e,t.name().replace(/\/$/,"")+".zip")},e.dlzip=function(t){t=e.resolve(t||"."),r.dlzip(t)});var i={".png":"image/png",".jpg":"image/jpg",".gif":"image/gif",".jpeg":"image/jpg",".mp3":"audio/mp3",".ogg":"audio/ogg"};return r.unzip=function(t,e){var r=new JSZip(t);for(var o in r.files){var s=r.files[o],a=e.rel(s.name);for(var u in i){var f;if(a.endsWith(u)){var c=i[u];f="data:"+c+";base64,"+n.Base64_From_ArrayBuffer(s.asArrayBuffer())}else f=s.asText();a.text(f)}console.log(s.name)}},r}),requireSimulator.setName("extLink"),define(["WebSite","UI","PathUtil","Util","assert"],function(t,e,n,r,i){function o(t,n,r){var i=s(t);if(r)for(var o in r)i[o]=r[o];return e("a",i,n)}function s(e){var n,r=t.platform;return n="win32"==r?{href:"javascript:;",on:{click:a("start",e)}}:"darwin"==r?{href:"javascript:;",on:{click:a("open",e)}}:{href:e,target:"_new"}}function a(t,e){return function(){u(t+" "+e)}}var u=t.isNW?require("child_process").exec:function(){};return o.all=function(){t.isNW&&$("a").each(function(){var t=(location.protocol+"//"+location.host+"/",$(this)),e=t.attr("href");if(e.match(/^http/)){var n=i.is(s(e),{href:String,on:{click:Function}});t.attr("href",n.href),t.click(n.on.click)}})},o}),requireSimulator.setName("DeferredUtil"),define([],function(){var t;return t={ensureDefer:function(t){var e,n=new $.Deferred;return $.when(t).then(function(t){e?n.resolve(t):setTimeout(function(){n.resolve(t)},0)}).fail(function(t){e?n.reject(t):setTimeout(function(){n.reject(t)},0)}),e=!0,n.promise()},directPromise:function(t){var e=new $.Deferred;return setTimeout(function(){e.resolve(t)},0),e.promise()},then:function(e){return t.directPromise().then(e)},timeout:function(t){var e=new $.Deferred;return setTimeout(function(){e.resolve()},t),e.promise()},funcPromise:function(t){var e=new $.Deferred;return t(function(t){e.resolve(t)
},function(t){e.reject(t)}),e.promise()},throwPromise:function(t){var e=new $.Deferred;return setTimeout(function(){e.reject(t)},0),e.promise()},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(n){return console.log(n,n.stack),t.throwPromise(n)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(r){return r>=e.length?t.brk():$.when(n(e[r],r)).then(function(){return r+1})},0);var r=[];for(var i in e)r.push({k:i,v:e[i]});return t.each(r,function(t){return n(t.k,t.v)})},loop:function(e,n){return t.directPromise(n).then(t.throwF(function(){var n=e.apply(this,arguments);return n.DU_BRK?n.res:$.when(n).then(function(n){return t.loop(e,n)})}))},brk:function(t){return{DU_BRK:!0,res:t}}}}),requireSimulator.setName("ide/selProject"),requirejs(["FS","Wiki","Shell","Shell2","NewProjectDialog","UI","Sync","Auth","zip","requestFragment","WebSite","extLink","DeferredUtil"],function(t,e,n,r,i,o,s,a,u,f,c,l,h){$(function(){function e(t,e){function n(){i.show(t,function(t){t.mkdir(),document.location.href="project.html?dir="+t.path()})}if(!t.exists()){if(0!=e)return;t.mkdir()}var s=$("<section>");$("#prjItemList").append(s),s.append(o("h2",{"class":"prjDirHeader"},t.path()));var a=o("div",{"class":"project"},["a",{href:"javascript:;",on:{click:n}},["img",{$var:"t",src:"../../images/tonew.png"}],["div","新規作成"]]);a.appendTo(s);var u;u=o("div",{style:"display: inline-block;"},["button",{"class":"showAll",on:{click:function(){u.remove(),r(t,s)}}},"すべて見る..."]),s.append(u)}function r(t,e){var n=[];return t.each(function(t){if(t.isDir()){var e=t.lastUpdate();n.push([t,e])}}),n=n.sort(function(t,e){return e[1]-t[1]}),h.each(n,function(t){var n=t[0],r=n.name();if(n.isDir()){var i=o("div",{"class":"project"},["a",{href:"project.html?dir="+n.path()},["img",{$var:"t",src:"../../images/nowprint.png"}],["div",{"class":"projectName"},r]]);return i.appendTo(e),""!=f&&r.toLowerCase().indexOf(f)<0&&i.hide(),setTimeout(function(){var t=n.rel("images/").rel("icon_thumbnail.png");t.exists()&&i.$vars.t.attr("src",t.getURL())},10),h.timeout(10)}}).then(function(){})}$("#prjItemList").empty();var s,u="",f="";$("#prjItemList").append(s=o("div",["input",{$var:"kw",placeholder:"Search..",value:f}])),setInterval(function(){f=s.$vars.kw.val().toLowerCase(),f!=u&&($(".project").each(function(){var t=$(this),e=t.find(".projectName");""==f||e[0]&&e.text().toLowerCase().indexOf(f)>=0?t.show():t.hide()}),u=f)},1e3);var p=c.projects.map(function(e){return t.get(e)});p.forEach(e),c.isNW&&$("#loginGrp").hide(),a.currentUser(function(t){t?($(".while-logged-out").hide(),$("#login").text(t)):$(".while-logged-in").hide()});var d=$("<iframe>").attr("src",c.top+"/doc/index.html");d.height($(window).height()-$("#navBar").height()),$("#wikiViewArea").append(d),$("#newPrj").click(function(){i.show(t.get(c.projects[0]),function(t){t.mkdir(),document.location.href="project.html?dir="+t.path()})}),SplashScreen.hide(),n.cd(t.get(c.projects[0])),l.all(),n.wikiEditor=function(){document.location.href="wikiEditor.html"},$($("button.showAll").get(0)).click()})}),requireSimulator.setName();