function HttpHelper(t){var e={},n=t.lineMark;return e.buf=$("<div>"),e.bufs=[e.buf],e.maxLineNo=-1,e.cur=function(){return e.bufs[e.bufs.length-1]},e.p=function(t){"string"==typeof t&&(t=t.length>0?$("<span>").text(t):null),e.cur()?(e.lineNo>e.maxLineNo&&(e.maxLineNo=e.lineNo,e.cur().append($("<a>").attr({id:n+"-"+e.lineNo,name:n+"-"+e.lineNo}))),t&&e.cur().append(t)):console.log("Warning - Stack underflow")},e.enter=function(t){"string"==typeof t&&(t=$(t)),e.bufs.push(t)},e.exit=function(){var t=e.bufs.pop();e.p(t)},e.h=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e}!function(){var t={};return t.def=function(e,n,r){var i=t.getModuleInfo(t.curName);i.type=r,t.setReqs(i,e),i.func=function(){return n.apply(this,t.getObjs(e))},t.loadIfAvailable(i)},define=function(e,n){t.def(e,n,"define")},require=requirejs=function(e,n){t.def(e,n,"require")},t.setReqs=function(e,n){n.forEach(function(n){var r=t.getModuleInfo(n);r.loaded||(e.reqs[n]=r,r.revReqs[e.name]=e)})},t.getModuleInfo=function(e){var n=t.modules;return n[e]||(n[e]={name:e,reqs:{},revReqs:{}}),n[e]},t.doLoad=function(e){var n=t.getModuleInfo(e);if(n.loaded)return n.obj;n.loaded=!0;var r=null;if(n.func)r=n.func();else{var i=e.split(/\./);r=function(){return this}(),i.forEach(function(t){r&&(r=r[t])}),null==r&&console.log("Warning: No obj for "+e)}if("define"==n.type&&null==r)throw"No obj for "+e;n.obj=r;for(var o in n.revReqs)t.notifyLoaded(n.revReqs[o],n.name);return r},t.notifyLoaded=function(e,n){delete e.reqs[n],t.loadIfAvailable(e)},t.loadIfAvailable=function(e){for(var n in e.reqs)return;t.doLoad(e.name)},t.getObjs=function(e){var n=[];return e.forEach(function(e){var r=t.doLoad(e);n.push(r)}),n},t.modules={},t.setName=function(e){t.curName&&(t.getModuleInfo(t.curName).func||t.doLoad(t.curName)),e&&(t.curName=e)},requireSimulator=t,t}(),requireSimulator.setName("WebSite"),define([],function(){var t=document.location.href,e=!!t.match(/html\/dev\//)&&!!t.match(/localhost:3/);window.WebSite=t.match(/jsrun\.it/)?{urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:e,pluginTop:"http://tonyuedit.appspot.com/js/plugins",removeJSOutput:!0}:t.match(/tonyuexe\.appspot\.com/)||t.match(/localhost:8887/)||t.match(/\/html\/((dev)|(build))\//)?{urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:e}:{urlAliases:{},top:"../..",devMode:e};var n=window.navigator.userAgent.toLowerCase();return window.WebSite.tablet=-1!=n.indexOf("windows")&&-1!=n.indexOf("touch")||-1!=n.indexOf("ipad")||-1!=n.indexOf("android")&&-1==n.indexOf("mobile")||-1!=n.indexOf("firefox")&&-1!=n.indexOf("tablet")||-1!=n.indexOf("kindle")||-1!=n.indexOf("silk")||-1!=n.indexOf("playbook"),window.WebSite.mobile=-1!=n.indexOf("windows")&&-1!=n.indexOf("phone")||-1!=n.indexOf("iphone")||-1!=n.indexOf("ipod")||-1!=n.indexOf("android")&&-1!=n.indexOf("mobile")||-1!=n.indexOf("firefox")&&-1!=n.indexOf("mobile")||-1!=n.indexOf("blackberry"),window.WebSite.pluginTop||(window.WebSite.pluginTop=window.WebSite.top+"/js/plugins"),window.WebSite.disableROM={},t.match(/tonyuedit\.appspot\.com/)||t.match(/localhost:8888/),(t.match(/\.appspot\.com/)||t.match(/localhost:888[87]/))&&(window.WebSite.serverType="GAE"),t.match(/localhost:3000/)&&(window.WebSite.serverType="Node"),window.WebSite.serverTop=t.match(/tonyuexe\.appspot\.com/)||t.match(/localhost:8887/)?window.WebSite.top+"/exe":window.WebSite.top+"/edit",window.WebSite.sampleImg=window.WebSite.top+"/images",window.WebSite.blobPath=window.WebSite.serverTop+"/serveBlob",window.WebSite.isNW="object"==typeof process&&process.__node_webkit,window.WebSite.tonyuHome="/Tonyu/",window.WebSite.url={getDirInfo:WebSite.serverTop+"/getDirInfo",getFiles:WebSite.serverTop+"/File2LSSync",putFiles:WebSite.serverTop+"/LS2FileSync"},window.WebSite.isNW&&(window.WebSite.cwd=process.cwd().replace(/\\/g,"/").replace(/\/?$/,"/"),window.WebSite.tonyuHome=process.env.TONYU_HOME?process.env.TONYU_HOME.replace(/\\/g,"/").replace(/\/?$/,"/"):window.WebSite.cwd+"fs/Tonyu/",window.WebSite.logdir="/var/log/Tonyu/",window.WebSite.kernelDir=window.WebSite.cwd+"www/Kernel/"),window.WebSite.compiledKernel=window.WebSite.top+"/Kernel/js/concat.js",window.WebSite}),requireSimulator.setName("assert"),define([],function(){function t(e){if(e instanceof Array){var n=[];return e.forEach(function(e){n=n.concat(t(e))}),n}return[e]}var e=function(e){this.failMesg=t(e||"Assertion failed: ")};e.prototype={fail:function(){var e=$a(arguments);throw e=t(e),e=this.failMesg.concat(e),console.log.apply(console,e),new Error(e.join(" "))},subAssertion:function(){var n=$a(arguments);return n=t(n),new e(this.failMesg.concat(n))},assert:function(t,e){return t||this.fail(e),t},eq:function(t,e){return t!==e&&this.fail(t,"!==",e),t},is:function(t,e){var n=e,r=t;if(null==n)return n;if(n._assert_func)return n._assert_func.apply(this,[r]),t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){t&&"number"==typeof t.length||this.fail(t,"should be array:");for(var i=this,o=0;o<n.length;o++){var a=i.subAssertion("failed at ",t,"[",o,"]: ");a.is(r[o],n[o])}return t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),t;if(n&&"object"==typeof n){for(var s in n){var a=this.subAssertion("failed at ",t,".",s,":");a.is(t[s],n[s])}return t}this.fail("Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&r(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)}},$a=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var n=new e,r=function(){try{return n.assert.apply(n,arguments)}catch(t){throw new Error(t.message)}};return r.is=function(){try{return n.is.apply(n,arguments)}catch(t){throw new Error(t.message)}},r.eq=function(){try{return n.eq.apply(n,arguments)}catch(t){throw new Error(t.message)}},r.ensureError=function(){try{return n.ensureError.apply(n,arguments)}catch(t){throw new Error(t.message)}},r.fail=n.fail.bind(n),r.f=function(t){return{_assert_func:t}},r.and=function(){var t=$a(arguments);return r(t instanceof Array),r.f(function(e){for(var n=this,r=0;r<t.length;r++)n.is(e,t[r])})},r}),requireSimulator.setName("PathUtil"),define(["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}function n(t,e){return t.substring(0,e.length)===e}var r,i=/^([a-zA-Z]):/,o=t.f(function(t){this.is(t,String),this.assert(r.isPath(t),[t," is not a path"])}),a=t.f(function(t){this.is(t,String),this.assert(r.isAbsolutePath(t),[t," is not a absolute path"])}),s=t.f(function(t){this.is(t,String),this.assert(!r.isAbsolutePath(t),[t," is not a relative path"])}),u=t.and(f,a),f=t.f(function(t){this.is(t,o),this.assert(r.isDir(t),[t," is not a directory path"])}),c=t.f(function(t){this.is(t,o),this.assert(!r.isDir(t),[t," is not a file path"])}),l="/";return r={Path:o,Absolute:a,Relative:s,Dir:f,File:c,AbsDir:u,SEP:l,endsWith:e,startsWith:n,hasDriveLetter:function(t){return i.exec(t)},isPath:function(e){return t.is(arguments,[String]),!e.match(/\/\//)},isRelativePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&!r.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&(r.startsWith(e,l)||r.hasDriveLetter(e))},isDir:function(n){return t.is(arguments,[o]),e(n,l)},splitPath:function(e){t.is(arguments,[o]);var n=e.split(l);return""==n[n.length-1]&&(n[n.length-2]+=l,n.pop()),n},name:function(e){return t.is(arguments,[String]),r.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var n=r.name(e),i=/\.[a-zA-Z0-9]+$/.exec(n);return i?i[0]:null},truncExt:function(e,n){t.is(e,String);var i=r.name(e);return n=n||r.ext(e),t.is(n,String),i.substring(0,i.length-n.length)},truncSEP:function(e){return t.is(arguments,[o]),r.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(n,i){return t.is(arguments,[String,String]),e(r.name(n),i)},parent:function(e){return t.is(arguments,[String]),r.up(e)},rel:function(e,n){t.is(arguments,[u,s]);var i=r.splitPath(n),o=e;o=o.replace(/\/$/,"");var a=r;return i.forEach(function(t){".."==t||"../"==t?o=a.up(o):(o=o.replace(/\/$/,""),o+=l+("."==t||"./"==t?"":t))}),o},relPath:function(e,n){return t.is(arguments,[u,u]),e.substring(0,n.length)!=n?"../"+r.relPath(e,this.up(n)):e.substring(n.length)},up:function(e){if(t.is(arguments,[o]),e==l)return null;var n=r.splitPath(e);return n.pop(),n.join(l)+l}}}),requireSimulator.setName("Env"),define(["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n}),requireSimulator.setName("SFileNW"),define(["WebSite","Env"],function(t,e){function n(t){this._path=u(t)}function r(t,e){for(var n in e)t[n]=e[n]}function i(t,e){return t.substring(t.length-e.length)===e}function o(t,e){return t.substring(0,e.length)===e}function a(t){return!g&&o(t,h)||g&&t.match(d)}function s(t){return i(t,h)?t.substring(0,t.length-1):t}function u(t,e){if(e=e||process.cwd(),e=e.replace(/\\/g,h),t=t.replace(/\\/g,h),g&&o(t,h)){var n=e,r=d.exec(n);if(!r)throw new Error(e+" : should have drive letter");t=r[0]+t}else a(t)||(t=s(e)+h+t);var u=t.split(h),f=[];u.forEach(function(t){return""!=t&&"."!=t?".."==t?void f.pop():void f.push(t):void 0});var c=f.join(h);if(g||(c=h+c),!a(c))throw new Error(c+": is not absolute. hasDriverLetter="+g);return c=s(c),i(t,h)&&(c+=h),c}var f={};if(!t.isNW)return{};var c=require("fs"),l=new e(t),h="/",p=JSON,d=/^([a-zA-Z]):/,g=d.exec(process.cwd()),v={".png":"image/png",".jpg":"image/jpg",".gif":"image/gif",".jpeg":"image/jpg",".mp3":"audio/mp3",".ogg":"audio/ogg"};f.resolve=function(t,e){return t=l.expandPath(t),f.get(u(t,e))},f.expandPath=function(){return l.expandPath.apply(l,arguments)},r(n.prototype,{isSFile:function(){return!0},text:function(){if(0==arguments.length)return this.isDir()?p.stringify(this.metaInfo()):this.isBinary()?this.readDataURLFromBin():c.readFileSync(this.path(),{encoding:"utf8"});var t=this.up();t&&t.mkdir(),this.isBinary()?this.writeBinFromDataURL(arguments[0]):c.writeFileSync(this.path(),arguments[0])},lines:function(){return this.text().split("\n")},readDataURLFromBin:function(){var t=this.dataHeader();if(b=c.readFileSync(this.path()),b[0]==t.charCodeAt(0)&&b[1]==t.charCodeAt(1)&&b[2]==t.charCodeAt(2)&&b[3]==t.charCodeAt(3)&&b[4]==t.charCodeAt(4))return b.toString("utf8");var e=b.toString("base64");return t+e},writeBinFromDataURL:function(t){var e=this.dataHeader(),n=t.substring(e.length),r=new Buffer(n,"base64"),i=c.createWriteStream(this.path());i.write(r),i.end()},isBinary:function(){return v[this.ext()]},dataHeader:function(){var t=this.isBinary();return"data:"+t+";base64,"},obj:function(){return 0==arguments.length?p.parse(this.text()):void this.text(p.stringify(arguments[0]))},isReadOnly:function(){return!1},rm:function(){return this.isDir()?c.rmdirSync(this.path()):c.unlinkSync(this.path())},path:function(){return this._path},pathTS:function(){return s(this.path())},name:function(){var t=this.pathTS(),e="";return i(this.path(),h)&&(e=h),t.split(h).pop()+e},ext:function(){var t=this.name(),e=/\.[a-zA-Z0-9]+$/.exec(t);return e?e[0]:null},truncExt:function(t){var e=this.name();return e.substring(0,e.length-t.length)},endsWith:function(t){return i(this.name(),t)},exists:function(){return c.existsSync(this.path())},each:function(t,e){if(e||(e={}),!this.isDir())throw new Error(this+" cannot each. not a dir.");if(this.exists()){var n=this.pathTS(),r=c.readdirSync(this.path()),i=this;r.forEach(function(r){if(".dirinfo"!=r||e.includeDirInfo){var o=c.statSync(n+h+r),a=o.isDirectory()?h:"",s=i.rel(r+a);t(s)}})}},ls:function(){var t=[];return this.each(function(e){t.push(e.name())}),t},parent:function(){return this.up()},recursive:function(t){this.each(function(e){e.isDir()?e.recursive(t):t(e)})},toString:function(){return this.path()},rel:function(t){return new n(this.pathTS()+h+t)},mkdir:function(){if(this.exists()){if(this.isDir())return;throw new Error(this+" is a file. not a dir.")}var t=this.up();t&&t.mkdir(),c.mkdirSync(this.path())},relPath:function(t){var e=t.path?t.path():t;if(e.substring(e.length-1)!=h)throw new Error(e+" is not a directory.");return this.path().substring(0,e.length)!=e?"../"+this.relPath(t.up()):this.path().substring(e.length)},equals:function(t){return t instanceof n&&t.path()==this.path()},lastModified:function(){return this.stat().mtime.getTime()},lastUpdate:function(){return this.lastModified()},up:function(){var t=this.pathTS(),e=t.split(h);return e.pop(),t=e.join(h),""==t?null:new n(t+h)},copyFrom:function(t,e){this.isDir()||(this.text(t.text()),e.a&&file.metaInfo(t.metaInfo()))},isDir:function(){return this.exists()?this.stat().isDirectory():i(this.path(),h)},stat:function(){return c.statSync(this.path())},metaInfo:function(){if(this.isDir()){var t={};return this.each(function(e){t[e.name()]=e.metaInfo()}),t}return{lastUpdate:this.lastUpdate()}}}),f.get=function(t){if(null==t)throw new Error("FS.get: null path");return t instanceof n?t:new n(t)};var m="DONOTEXPORT";return f.exportDir=function(t,e){function n(r){var o=r.relPath(t);if(i[o]=r.text(),e.keepCR||(i[o]=i[o].replace(/\r/g,"")),r.isDir()){if(r.rel(m).exists())return;r.each(n)}}e||(e={}),"string"==typeof t&&(t=f.get(t));var r={base:t.path()},i=r.data={};return n(t),r},f}),requireSimulator.setName("extend"),define([],function(){return function(t,e){for(var n in e)t[n]=e[n]}}),requireSimulator.setName("DataURL"),define(["extend","assert"],function(t,e){function n(t){return t instanceof ArrayBuffer||"undefined"!=typeof Buffer&&t instanceof Buffer}function r(t){function e(e){throw console.log(e),console.log(t,c),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var r,i=t.length,a=0,s=0;if(!i)return new o(0);r=Math.floor(i/4*3),"="==t.charAt(i-1)&&(r-=1),"="==t.charAt(i-2)&&(r-=1);for(var u=new o(r),f="undefined"!=typeof Buffer?u:new Uint8Array(u),c=0,l=0;r>l&&(s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),a=s<<2,c++,s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),f[l]=a|s>>4&3,a=(15&s)<<4,c++,l++,!(l>=r))&&(s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),f[l]=a|s>>2&15,a=(3&s)<<6,c++,l++,!(l>=r));)s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),f[l]=a|s,c++,l++;return u}function i(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,a=0,s=0;i>s&&(a=r[s],n+=e[a>>2],o=(3&a)<<4,s++,!(s>=i))&&(a=r[s],n+=e[o|a>>4],o=(15&a)<<2,s++,!(s>=i));)a=r[s],n+=e[o|a>>6],n+=e[63&a],s++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n}var o="undefined"!=typeof Buffer?Buffer:ArrayBuffer,a=function(t,r){"string"==typeof t?(this.url=t,this.dataURL2bin(t)):t&&n(t.buffer)?(this.buffer=t.buffer,e.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):n(t)?(this.buffer=t,e.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):e.fail("Invalid args: ",arguments)};return t(a.prototype,{bin2dataURL:function(t,r){e(n(t)),e.is(r,String);var o=this.dataHeader(r),a=i(t);return e.is(a,String),this.url=o+a},dataURL2bin:function(t){e.is(arguments,[String]);var n=/data:([^;]+);base64,(.*)$/i,i=n.exec(t);return e(i,["malformed dataURL:",t]),this.contentType=i[1],this.buffer=r(i[2]),e.is(this.buffer,o)},dataHeader:function(t){return e.is(arguments,[String]),"data:"+t+";base64,"},toString:function(){return e.is(this.url,String)}}),a}),requireSimulator.setName("Contents"),define(["DataURL"],function(t){var e={convert:function(e,n){var r;if("string"==typeof e&&(r=String),e instanceof t&&(r=t),e instanceof ArrayBuffer&&(r=ArrayBuffer),r==n)return e;throw new Error("Cannot convert from "+r+" to "+n)}};return e}),requireSimulator.setName("SFile"),define(["Contents","extend","assert","PathUtil"],function(t,e,n,r){var i=function(t,e){n.is(e,r.Absolute),n(t&&t.getReturnTypes),this._path=e,this.fs=t,this.isDir()&&!r.isDir(e)&&(this._path+=r.SEP)};return i.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},i.prototype={isSFile:function(){return!0},_clone:function(){return this.fs.getRootFS().get(this.path())},_resolve:function(t){var e;return i.is(t)?e=t:(n.is(t,r.Absolute),e=this.fs.getRootFS().get(t)),this.wrapper?this.wrapper.wrap(e):e},contains:function(t){return n(i.is(t),t+" shoud be a SFile object."),this.isDir()?r.startsWith(t.path(),this.path()):!1},path:function(){return this._path},name:function(){return r.name(this.path())},truncExt:function(t){return r.truncExt(this.path(),t)},ext:function(){return r.ext(this.path())},relPath:function(t){var e=t.path?t.path():t;return r.relPath(this.path(),n.is(e,r.Absolute))},up:function(){var t=this.path(),e=r.up(t);return null==e?null:this._resolve(e)},rel:function(t){n.is(t,r.Relative),this.assertDir();var e=this.path();return this._resolve(r.rel(e,t))},startsWith:function(t){return r.startsWith(this.name(),t)},endsWith:function(t){return r.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){this.fs.touch(this.path())},isReadOnly:function(){this.fs.isReadOnly(this.path())},isTrashed:function(){var t=this.metaInfo();return t?t.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.fs.getMetaInfo(this.path(),t)},setMetaInfo:function(t,e){return this.fs.setMetaInfo(this.path(),t,e)},lastUpdate:function(){return n(this.exists()),this.metaInfo().lastUpdate},exists:function(t){t=t||{};var e=this.fs.exists(this.path(),t);return e||t.noFollowLink?e:this.resolveLink().exists({noFollowLink:!0})},rm:function(t){if(t=t||{},!this.exists({noFollowLink:!0})){var e=this.resolveLink();if(!this.equals(e))return e.rm(t)}this.isDir()&&(t.recursive||t.r)&&this.each(function(e){e.rm(t)});var n=this.path();this.fs.rm(n,t)},removeWithoutTrash:function(t){t=t||{},t.noTrash=!0,this.rm(t)},isDir:function(){return this.fs.isDir(this.path())},text:function(){var t=this.resolveLink();return this.equals(t)?arguments.length>0?void this.setText(arguments[0]):this.getText():t.text.apply(t,arguments)},setText:function(t){n.is(t,String),this.fs.setContent(this.path(),t)},getText:function(){return this.fs.getContent(this.path(),{type:String})},lines:function(){return this.text().split("\n")},obj:function(){var t=this;if(0==arguments.length){var e=t.text();return e?JSON.parse(e):null}t.text(JSON.stringify(n.is(arguments[0],Object)))},copyFrom:function(t,e){var r=this,e=e||{},i=t.isDir(),o=r.isDir();if(!i&&o&&(r=r.rel(t.name()),assert(!r.isDir(),r+" exists as an directory."),o=!1),i&&!o)this.err("Cannot move dir to file");else{if(!i&&!o){var a=t.getText(),s=r.setText(a);return e.a&&r.setMetaInfo(t.getMetaInfo()),s}n(i&&o);t.each(function(t){r.rel(t.name()).copyFrom(t,e)})}},moveFrom:function(t,e){var n=this.copyFrom(t,e);return t.rm({recursive:!0}),n},assertDir:function(){return n.is(this.path(),r.Dir),this},each:function(t,e){var n=this.assertDir();n.listFiles(e).forEach(t)},recursive:function(t,e){var n=this.assertDir();n.each(function(e){e.isDir()?e.recursive(t):t(e)},e)},listFiles:function(t){n(null==t||"object"==typeof t);var e=this.assertDir(),r=this.resolveLink();if(!this.equals(r))return r.listFiles.apply(r,arguments);var i,o=this.path();"function"==typeof t&&(i=t),t=e.convertOptions(t),i||(i=t.order);for(var a=this.fs.opendir(o,t),s=[],u=0;u<a.length;u++){var f=a[u];t.excludes[o+f]||s.push(e.rel(f))}return"function"==typeof i&&s.sort&&s.sort(i),s},ls:function(t){n(null==t||"object"==typeof t);var e=this.assertDir(),r=e.listFiles(t);return r.map(function(t){return t.name()})},convertOptions:function(t){var e=(this.assertDir(),this.path());if(t||(t={}),t.excludes||(t.excludes={}),t.excludes instanceof Array){var i={};t.excludes.forEach(function(t){r.startsWith(t,"/")?i[t]=1:i[e+t]=1}),t.excludes=i}return n.is(t,{excludes:{}})},mkdir:function(){this.touch()},link:function(t,e){t=this._resolve(n(t)),this.fs.link(this.path(),t.path(),e)},resolveLink:function(){var t=this.fs.resolveLink(this.path());return n.is(t,r.Absolute),this._resolve(t)},isLink:function(){return this.fs.isLink(this.path())}},i}),requireSimulator.setName("FS"),define(["WebSite","SFileNW","Env","PathUtil","assert","SFile"],function(t,e,n,r,i,o){function a(t,e){if(e)for(var n in e)t[n]=e[n]}function s(t,e){return t.substring(t.length-e.length)===e}function u(t,e){return t.substring(0,e.length)===e}function f(){return(new Date).getTime()}function c(t){var e=t.split(I);return""==e[e.length-1]&&(e[e.length-2]+=I,e.pop()),e}function l(t){for(var e in O){var n=t.substring(0,e.length),r=t.substring(e.length);if(n==e)return{rom:O[e],rel:r}}return null}function h(t){return v(t)?j:localStorage}function p(t,e){var n=h(t),r=l(t);if(2!=arguments.length)return r?r.rom[r.rel]:n[t];if(r)throw new Error(t+" is Read only.");return null!=e?n[t]=e:void delete n[t]}function d(t){var e=h(t),n=l(t);return n?n.rel in n.rom:t in e}function g(t,e,n,r){if(null==t)throw new Error("putDir: Null path");if(!D(t))throw new Error("Not a directory : "+t);r==E?j[t]=e:p(t,JSON.stringify(e));var i=b(t);if(null!=i){var o=m(i,r);y(o,i,T(t),n,r)}}function v(t){return"ALL"==k?!0:"object"==typeof k&&k?t in k:!1}function m(t,e){if(null==t)throw new Error("getDir: Null path");s(t,I)||(t+=I);var n={},r={};if(e&E&&(r=j[t]||{}),e&A)try{var i=p(t);i&&(n=JSON.parse(i))}catch(o){console.log("dinfo err : "+t+" - "+n)}a(n,r),a(n,F[t]);for(var u in n)"number"==typeof n[u]&&(n[u]={lastUpdate:n[u]});return n}function y(t,e,n,r,i){t[n]||(t[n]={},r&&(t[n].trashed=!0)),r||delete t[n].trashed,t[n].lastUpdate=f(),g(e,t,r,i)}function w(t,e,n,r){t[n]&&(t[n]={lastUpdate:f(),trashed:!0},g(e,t,!0,r))}function x(t,e,n,r){t[n]&&(delete t[n],g(e,t,!0,r))}function b(t){if(t==I)return null;var e=c(t);return e[e.length-1]="",e.join(I)}function S(t){return u(t,I)}function D(t){return s(t,I)}function T(t){var e=c(t);return e[e.length-1]}if(e&&e.get)return"object"==typeof window&&(window.FS=e),e;var $=new n(t),E=1,A=2,N=3,j={},k=null;("undefined"==typeof localStorage||null==localStorage)&&(console.log("FS: Using RAMDisk"),k="ALL");var W={};"object"==typeof window&&(window.FS=W),W.ramDisk=j,W.ramDiskUsage=k;var O={},F={},I="/";W.roms=O,W.romParents=F,W.endsWith=s,W.splitPath=c,W.orderByNewest=function(t,e){if(!(t&&e&&t.lastUpdate&&e.lastUpdate))return 0;var n=t.lastUpdate(),r=e.lastUpdate();return r>n?1:n>r?-1:0},W.orderByName=function(t,e){return t.name&&e.name&&(t=t.name(),e=e.name()),t>e?1:e>t?-1:0},W.orderByNumberedName=function(t,e){function n(t){for(var e=[],n=/^[0-9]*/,r=/^[^0-9]*/;t&&(t.match(r),e.push(RegExp.lastMatch),t=t.replace(r,""));){t.match(n);var i=parseInt(RegExp.lastMatch);e.push(i),t=t.replace(n,"")}return e}t.name&&e.name&&(t=t.name(),e=e.name());var r,i=n(t),o=n(e);for(r=0;r<i.length;r++){if(r>=o.length)return 1;if(i[r]>o[r])return 1;if(i[r]<o[r])return-1}return r<o.length?-1:0},W.importDir=function(t){var e=W.get(t.base);t.confirm||e.mkdir();var n=t.data,r=[];for(var i in n){var o=e.path()+i,a=W.get(o);if(r.push("["+(a.isReadOnly()?"ro":a.exists()?"exists":"new")+"]"+o),!a.isReadOnly()&&!t.confirm)if(a.isDir()){var s=m(o,A),u=JSON.parse(n[i]);for(var f in u)s[f]=u[f];g(o,s,!1,A)}else p(o,n[i])}return r},W.mountROM=function(t){console.log("ROM mouted on ",t.base),O[t.base]=t.data;var e=c(t.base),n=e.pop(),r=e.join(I)+I;F[r]||(F[r]={}),F[r][n]={lastUpdate:(new Date).getTime()}};var U="DONOTEXPORT";return W.exportDir=function(t,e){function n(r){var o=r.relPath(t);if(i[o]=r.text(),e.keepCR||(i[o]=i[o].replace(/\r/g,"")),r.isDir()){if(r.rel(U).exists())return;r.each(n)}}e||(e={}),"string"==typeof t&&(t=W.get(t));var r={base:t.path()},i=r.data={};return n(t),r},W.expandPath=function(){return $.expandPath.apply($,arguments)},W.resolve=function(t,e){return o.is(t)?t:(t=$.expandPath(t),e&&!r.isAbsolutePath(t)?(e=$.expandPath(e),W.get(e).rel(t)):W.get(t))},W.get=function(t,e){if(e||(e={}),null==t)throw new Error("FS.get: Null path");if(t.isDir)return t;if(e.topDir&&!u(t,e.topDir))throw new Error(t+" is out of securtyDomain");if(!S(t))throw new Error(t+": Path must starts with '/'");var n,r=b(t),i=T(t);if(D(t)){var o=n={};o.files=function(t,e){var n=[];return o.each(function(t){n.add(t)},e),n},o.each=function(t,e){o.ls(e).forEach(function(e){var n=o.rel(e);t(n)})},o.recursive=function(t,e){o.each(function(e){e.isDir()?e.recursive(t):t(e)},e)},o.listFiles=function(e){var n;"function"==typeof e&&(n=e),e=o.convertOptions(e),n||(n=e.order);var r=m(t,N),i=[];for(var a in r)(e.includeTrashed||!r[a].trashed)&&(e.excludes[t+a]||i.push(o.rel(a)));return"function"==typeof n&&i.sort&&i.sort(n),i},o.ls=function(t){var e=o.listFiles(t),n=[];return e.forEach(function(t){n.push(t.name())}),n},o.convertOptions=function(e){if(e||(e={}),e.excludes||(e.excludes={}),e.excludes instanceof Array){var n={};e.excludes.forEach(function(e){u(e,"/")?n[e]=1:n[t+e]=1}),e.excludes=n}return e},o.isDir=function(){return!0},o.rel=function(t){var n=c(t),r=o.path();return r=r.replace(/\/$/,""),n.forEach(function(t){".."==t||"../"==t?r=b(r):(r=r.replace(/\/$/,""),r+=I+("."==t||"./"==t?"":t))}),W.get(r,e)},o.rm=function(){if(!o.exists())throw new Error(t+": No such dir.");var e=o.ls();if(e.length>0)throw new Error(t+": Directory not empty");if(null!=r){var n=o.mediaType(),a=m(r,n);w(a,r,i,n)}},o.removeWithoutTrash=function(){var e=o.mediaType();if(o.each(function(t){t.removeWithoutTrash()},{includeTrashed:!0}),p(t,null),null!=r){var n=m(r,e);x(n,r,i,e)}},o.mkdir=function(){o.touch()},o.text=function(){return p(t)},o.obj=function(){return JSON.parse(o.text())},o.exists=function(){if("/"==t)return!0;var e=m(r,N);return e&&e[i]&&!e[i].trashed},o.mediaType=function(){return j[t]&&!localStorage[t]?E:A}}else{var a=n={};a.isDir=function(){return!1},a.rm=function(){if(!a.exists())throw new Error(t+": No such file.");if(p(t,null),null!=r){var e=a.mediaType(),n=m(r,e);w(n,r,i,e)}},a.removeWithoutTrash=function(){if(!a.exists()&&!a.isTrashed())throw new Error(t+": No such file.");if(p(t,null),null!=r){var e=a.mediaType(),n=m(r,e);x(n,r,i,e)}},a.text=function(){return 0==arguments.length?p(t):(p(t,arguments[0]),void a.touch())},a.lines=function(){return a.text().split("\n")},a.obj=function(){if(0==arguments.length){var t=a.text();return t?JSON.parse(t):null}a.text(JSON.stringify(arguments[0]))},a.copyFrom=function(t,e){a.text(t.text()),e.a&&a.metaInfo(t.metaInfo())},a.exists=function(){return d(t)},a.useRAMDisk=function(){return"ALL"==k?a:(k=k||{},k[t]=!0,a)},a.mediaType=function(){return v(t)?E:A}}return n.relPath=function(e){var r=e.path?e.path():e;if(r.substring(r.length-1)!=I)throw new Error(r+" is not a directory.");return t.substring(0,r.length)!=r?"../"+n.relPath(e.up()):t.substring(r.length)},n.isTrashed=function(){var t=n.metaInfo();return t?t.trashed:!1},n.metaInfo=function(){if(null!=r){var t;if(0==arguments.length)return t=m(r,N),t[i];var e=n.mediaType();t=m(r,e),t[i]=arguments[0],g(r,t,t[i].trashed,e)}return{}},n.lastUpdate=function(){return n.metaInfo().lastUpdate},n.up=function(){return null==r?null:W.get(r,e)},n.path=function(){return t},n.name=function(){return i},n.truncExt=function(t){return i.substring(0,i.length-t.length)},n.touch=function(){if(null!=r){var t=n.mediaType(),e=m(r,t);y(e,r,i,!1,t)}},n.isReadOnly=function(){var e=l(t);return!!e},n.startsWith=function(t){return u(i,t)},n.endsWith=function(t){return s(i,t)},n.equals=function(e){return e&&"function"==typeof e.path&&e.path()==t},n.toString=function(){return t},n.isSFile=function(){return!0},n},W.scan=function(){for(var t in localStorage)if(S(t)){var e=b(t);if(null!=e){var n=m(e,A),r=T(t);y(n,e,r,n[r]&&n[r].trashed,A)}}},W.dump=function(){for(var t in localStorage)console.log(t)},W.ls=function(t){return W.get(t).ls()},W}),requireSimulator.setName("HttpHelper"),requireSimulator.setName("Arrow"),Arrow=function(){var t={};return t.show=function(t){function e(){t.addClass("tutorial-highlight"),setTimeout(n,200)}function n(){t.removeClass("tutorial-highlight"),o-->0?setTimeout(e,200):r()}function r(){o=0,$.data(t[0],"blinking","f")}if("string"==typeof t&&(t=$(t)),0==t.length)return!1;var i=$.data(t[0],"blinking");if("t"!=i){$.data(t[0],"blinking","t");var o=3;e(),t.click(function(){r()})}},t.showOld=function(t){function e(){r&&(r.attr({src:"images/arrow"+i+".png"}),i=(i+1)%4)}if("string"==typeof t&&(t=$(t)),0==t.length)return!1;var n=t.offset(),r=$("<img>").attr({src:"images/arrow0.png"}).css({font:"40px",position:"absolute",left:n.left,top:n.top+t.height(),color:"red",zIndex:1e3,"z-index":1e3}).appendTo("body"),i=0;return setInterval(e,250),t.click(function(){r&&(r.remove(),r=null)}),!0},t}(),requireSimulator.setName("Util"),Util=function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:e(i[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function r(t,e){return t.substring(0,e.length)===e}function i(t){function e(e){throw console.log(e),console.log(t,f),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;
var r,i=t.length,o=0,a=0;if(!i)return new ArrayBuffer(0);r=Math.floor(i/4*3),"="==t.charAt(i-1)&&(r-=1),"="==t.charAt(i-2)&&(r-=1);for(var s=new ArrayBuffer(r),u=new Uint8Array(s),f=0,c=0;r>c&&(a=n[t.charCodeAt(f)],void 0===a&&e("Invalid letter: "+t.charCodeAt(f)),o=a<<2,f++,a=n[t.charCodeAt(f)],void 0===a&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=o|a>>4&3,o=(15&a)<<4,f++,c++,!(c>=r))&&(a=n[t.charCodeAt(f)],void 0===a&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=o|a>>2&15,o=(3&a)<<6,f++,c++,!(c>=r));)a=n[t.charCodeAt(f)],void 0===a&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=o|a,f++,c++;return s}function o(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,a=0,s=0;i>s&&(a=r[s],n+=e[a>>2],o=(3&a)<<4,s++,!(s>=i))&&(a=r[s],n+=e[o|a>>4],o=(15&a)<<2,s++,!(s>=i));)a=r[s],n+=e[o|a>>6],n+=e[63&a],s++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n}return{getQueryString:t,endsWith:n,startsWith:r,Base64_To_ArrayBuffer:i,Base64_From_ArrayBuffer:o}}(),requireSimulator.setName("Shell"),define(["FS","Util","WebSite"],function(t,e,n){function r(t,e){var n=i(t);if(e&&!n.exists())throw n+": no such file or directory";return n}function i(n){if("string"!=typeof n)return n;if(e.startsWith(n,"/"))return t.get(n);var r=o.cwd;return r.rel(n)}var o={cwd:t.get("/")};return o.cd=function(t){return o.cwd=r(t,!0),o.pwd()},o.resolve=r,o.pwd=function(){return o.cwd+""},o.ls=function(t){return t=t?r(t,!0):o.cwd,t.ls()},o.cp=function(t,e,n){n||(n={}),n.v&&o.echo("cp",t,e);var i=r(t,!0),a=r(e);if(i.isDir()&&a.isDir()){var s=0;return i.recursive(function(t){var e=t.relPath(i),r=a.rel(e);(n.test||n.v)&&o.echo((r.exists()?"[ovr]":"[new]")+r+"<-"+t),n.test||r.copyFrom(t,n),s++}),s}if(i.isDir()||a.isDir()){if(!i.isDir()&&a.isDir())return a.rel(i.name()).text(i.text()),1;throw"Cannot copy directory "+i+" to file "+a}return a.text(i.text()),1},o.rm=function(t,e){if(e||(e={}),e.notrash)return t=r(t,!1),t.removeWithoutTrash(),1;if(t=r(t,!0),t.isDir()&&e.r){var n=t,i=0;return n.each(function(t){t.exists()&&(i+=o.rm(t,e))}),n.rm(),i+1}return t.rm(),1},o.cat=function(t){t=r(t,!0),o.echo(t.text())},o.resolve=function(t){return t||(t="."),t=r(t)},o.grep=function(t,e,n){function i(t,e,r){n.res&&n.res.push({file:t,lineNo:e,line:r}),o.echo(t+"("+e+"): "+r)}return e=r(e,!0),n||(n={}),n.res||(n.res=[]),e.isDir()?e.each(function(e){o.grep(t,e,n)}):"string"==typeof t&&e.lines().forEach(function(n,r){n.indexOf(t)>=0&&i(e,r+1,n)}),n.res},o.touch=function(t){return t=r(t),t.text(t.exists()?t.text():""),1},o.setout=function(t){o.outUI=t},o.echo=function(){console.log.apply(console,arguments),o.outUI&&o.outUI.log&&o.outUI.log.apply(o.outUI,arguments)},o.err=function(){console.log.apply(console,arguments),o.outUI&&o.outUI.err&&o.outUI.err.apply(o.outUI,arguments)},o.prompt=function(){},o.ASYNC={r:"SH_ASYNC"},o.help=function(){for(var t in o){var e=o[t];"function"==typeof e&&o.echo(t+(e.description?" - "+e.description:""))}},sh=o,n.isNW&&(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()}),o}),requireSimulator.setName("Log"),define(["FS","WebSite","Shell"],function(t,e,n){function r(t,e){return t="00000000000000"+t,t.substring(t.length-e)}function i(t){return t.replace(/\n/g,"\n|")}var o={},a=e.logdir?t.resolve("${logdir}"):null,s=a&&a.exists();if(o.todayDir=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();return a.rel(e+"/").rel(n+"/").rel(r+"/")},o.curFile=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();return o.todayDir().rel(e+"-"+n+"-"+r+".log")},o.curProject=function(){var t=new Date,e=t.getHours(),n=t.getMinutes(),i=t.getSeconds();return o.todayDir().rel("Project/").rel(r(e,2)+"_"+r(n,2)+"_"+r(i,2)+"/")},o.dumpProject=function(t){if(s){var e=o.curProject();n.cp(t,e),o.append("Dumped project to "+e.path())}},!e.logging&&!e.isNW){var u=t.get("/var/log/");u.exists()&&u.removeWithoutTrash()}return o.append=function(t){if(s){var e=o.curFile(),n=e.exists()?e.text():"";e.text(n+t+"\n")}},o.d=function(t,e){o.append(new Date+": ["+t+"]"+i(e))},o.e=function(t,e){o.append(new Date+": ERROR["+t+"]"+i(e))},o}),requireSimulator.setName("exceptionCatcher"),define([],function(){var t={};return t.f=function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(n){t.handleException(n)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var r in e)e[r]=t.f(e[r]);return e}},t}),requireSimulator.setName("UI"),define(["Util","exceptionCatcher"],function(t,e){var n={},r=e.f;return n=function(){function e(){c.forEach(function(t){t()}),setTimeout(r(e),10)}function i(t){return t instanceof Array?o(t):"string"==typeof t?s(t):t}function o(t){var e=t[0],n=1,r=$("<"+e+">");for("object"!=typeof t[n]||t[n]instanceof Array||t[n]instanceof $||(a(r,t[n],e),n++);n<t.length;)r.append(i(t[n])),n++;return r}function a(e,i){function o(t,n){if(n)if("enterkey"==t)e.on("keypress",r(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var o,a=!0;c.push(function(){var t;t="checkbox"==i.type?!!e.prop("checked"):e.val(),(a||o!=t)&&(n.apply(e,[t,o]),o=t),a=!1})}else e.on(t,r(n))}i.$var&&(l[i.$var]=e),i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(t){h.writeToModel(i.$edit,t,e)}),l[i.$edit.name]||(l[i.$edit.name]=e),h.push({jq:e,params:i}));for(var a in i)if("on"==a)for(var s in i.on)o(s,i.on[s]);else"css"==a&&null!=i[a]?e.css(i[a]):t.startsWith(a,"$")||null==i[a]||e.attr(a,i[a])}function s(t){return $("<span>").text(t)}for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];var c=[],l={},h=[],p=i(u);return p.$edits=h,p.$vars=l,h.load=function(t){h.model=t,h.forEach(function(t){h.writeToJq(t.params.$edit,t.jq)})},h.writeToJq=function(t,e){var n=h.model;if(n){for(var r=t.name,i=r.split("."),o=0;o<i.length;o++)n=n[i[o]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},h.validator={errors:{},show:function(){if(l.validationMessage){l.validationMessage.empty();for(var t in this.errors)l.validationMessage.append(n("div",this.errors[t].mesg))}if(l.OKButton){var e=!0;for(var t in this.errors)e=!1;l.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},h.writeToModel=function(t,e,n){var r=h.model;if(r){var i=t.name;try{e=t.type.fromVal(e)}catch(o){return void h.validator.addError(i,o,n)}h.validator.removeError(i);for(var a=i.split("."),s=0;s<a.length;s++)s==a.length-1?h.on.writeToModel(i,e)||(r[a[s]]=e):r=r[a[s]];h.validator.on.validate.call(h.validator,h.model)}},h.on={},h.on.writeToModel=function(){},c.length>0&&setTimeout(r(e),10),p},n.types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),requireSimulator.setName("Wiki"),define(["HttpHelper","Arrow","Util","WebSite","Log","UI","FS"],function(t,e,n,r,i,o,a){return Wiki=function(n,s,u){function f(t){function e(t){t.stopPropagation(),t.preventDefault()}function n(t){if(u.editMode){var e=t.originalEvent,n=e.dataTransfer.files[0];if(!n.type.match(/image\/(png|gif|jpg)/)[1])return t.stopPropagation(),t.preventDefault(),!1;var r=new FileReader;return r.onload=function(){var t=r.result;s.text(t),i.empty().append(o("img",{src:t}))},r.readAsDataURL(n),t.stopPropagation(),t.preventDefault(),!1}}var i,s;if(l.builtinImages[t])return $("<div>").append($("<img>").attr("src",r.top+"/doc/images/"+t));i=o("div",{style:"margin:10px; padding:10px; border:solid black 1px;",on:{dragover:e,dragenter:e,drop:n}},"ここに画像ファイル(png/gif/jpg)をドラッグ＆ドロップして追加");var f=a.get(r.tonyuHome);return s=f.rel("doc/images/").rel(t),s.exists()&&i.empty().append(o("img",{src:s.text()})),i}function c(t,e,n){function r(){for(var a=[];;){var s=t.indexOf(e,o),u=t.indexOf(n,o);if(u>=0&&(0>s||s>u)){a.push(t.substring(o,u)),o=u;break}if(0>s){a.push(t.substring(o)),o=t.length;break}a.push(t.substring(o,s)),o=s+e.length;var f=r();f.hasBrace=!0,o<t.length&&(o+=n.length),a.push(f)}return i(a),a}function i(t){return t.split=function(t,e){if(1==e)return this;var n=[],r=i([]);return this.forEach(function(o){if("string"==typeof o){var a=o.indexOf(t);if(n.length>=e&&(a=-1),a>=0){if(a>0){var s=o.substring(0,a);r.push(s)}if(a+=t.length,n.push(1!=r.length?r:r[0]),r=i([]),a<o.length){var s=o.substring(a);r.push(s)}}else r.push(o)}else r.push(o)}),n.push(1!=r.length?r:r[0]),n},t.text=function(t){var r=this.hasBrace&&t?e:"";return this.forEach(function(t){r+="string"==typeof t?t:t.text(!0)}),r+=this.hasBrace&&t?n:""},t.toString=function(){return this.text(!0)},t}var o=0;return r(0)}var l={},h={figures:"図",plists:"リスト"},p="line_marker_",d={},g=[],v=".txt";if(u||(u={}),s&&!s.isDir())throw s+": not a dir";var m,y;l.on=d,l.cd=function(t){m=t,y=m.rel("toc.json")},s&&l.cd(s),l.parse=function(n,i,o){function a(t){g[t]={};var e=1,n=function(n,r){var i=g[t][n];return i||(i={refs:[]},g[t][n]=i),r&&(i.no=e++,i.name=h[t]+i.no,i.refs.forEach(function(t){t.text(i.name)})),i};return n}function s(t){function e(t){for(null==t&&(t=0);g.ul>t;)g.ul--,v.exit()}v.lineNo=g.lineNo;var n=0;if(t.match(/^-+/)&&(n=RegExp.lastMatch.length),n>g.ul)for(;n>g.ul;)g.ul++,v.enter("<ul>");else e(n);if(t=t.substring(n),n>0&&v.enter("<li>"),t.match(/^\*+/)){var r=RegExp.rightContext,i="h"+RegExp.lastMatch.length;v.enter("<"+i+">"),d(r),v.exit()}else if(t.match(/^$/))e(),v.p($("<p>"));else if(t.match(/^<<toc(.*)/))g.toc=[g.name],g.blocks.push({name:"toc",exit:function(){y&&!y.isReadOnly()&&y.obj(g.toc),g.toc=null}});else if(t.match(/^<<code(.*)/)){var o=RegExp.$1;if(o=o.replace(/^ */,""),o.length>0){var a,s,u=o.split(/ /,2);if(2==u.length){s=u[0],a=u[1];var f=w(a,!0);v.p($("<div>").addClass("plist").text(f.name+" "+s))}else v.p($("<div>").addClass("plist").text(u))}v.enter("<pre>"),g.blocks.push({name:"code",exit:function(){v.exit()}})}else if(t.match(/^>>/)){var c=g.blocks.pop();c&&c.exit&&c.exit(g)}else if(t.match(/^@@@@(.*)/)){if(g.pclose)v.exit();else{if(RegExp.$1.length>0){var f=w(RegExp.$1,!0);v.p($("<div>").addClass("plist").text(f.name))}v.enter("<pre>")}g.pclose=!g.pclose}else d(t),v.p("\n");n>0&&v.exit(),g.lineNo++}function d(t){function n(t){var n,i=t.text();if(i.match(/^@blink ([^>]+)>([^\s]+)/)){caption=RegExp.$1;var a=RegExp.$2;n=$("<span>").addClass("clickable").text(caption).hover(function(){var t;parent&&parent.Arrow&&(t=parent.Arrow),e&&(t=e),t&&t.show(a)})}else if(i.match(/^@plistref (.*)/)){var s=RegExp.$1,c=w(s);n=$("<strong>").text(c.name),c.refs.push(n)}else if(i.match(/^@editadd/))v.p($("<img>").attr("src",r.top+"/images/editAdd.png"));else if(i.match(/^@figref (.*)/)){var c=m(RegExp.$1);n=$("<strong>").text(c.name),c.refs.push(n)}else if(i.match(/^@cfrag (.*)/)){var p=RegExp.$1;n=$("<code>"),v.enter(n),d(p),v.exit()}else if(i.match(/^@arg (.*)/)){var y=RegExp.$1;n=$("<i>"),v.enter(n),d(y),v.exit()}else{var x=t.split(">",2);if(2==x.length?(i=x[1]+"",caption=x[0]):caption=i,g.toc&&g.toc.push(i),i.match(/\.(png|jpg|gif)$/)&&!i.match(/^http/)){var c=m(i,!0);n=$("<div>").addClass("figure").append(f(i)),v.enter(n),v.enter($("<div>")),v.p(h.figures+c.no+"."),d(caption),v.exit(),v.exit()}else if(i.match(/^https?:\/\//))n=$("<a>").attr({href:i,target:"ext"}).text(caption);else{var b=l.resolveFile(i);if(b.exists()||!b.isReadOnly()&&u.editMode){if(u.useAnchor){var S=b.relPath(o.up()).replace(/\.txt$/,".html");S=encodeURI(S).replace(/%/g,"_"),n=$("<a>").attr({href:S}).text(caption)}else n=$("<span>").addClass("clickable").text(caption).click(function(){l.show(b)});b.exists()||n.addClass("notexist")}else n=$("<span>").text(caption)}}v.p(n)}var i="string"==typeof t?c(t,g.beginMark,g.endMark):t;i.forEach(function(t){"string"==typeof t?v.p(t):n(t)})}var g={},v=t({lineMark:p});g.out=v,g.name=i,g.lines=n.split(/\r?\n/),g.lineNo=0,g.ul=0,g.beginMark="[[",g.endMark="]]",g.blocks=[];var m=a("figures"),w=a("plists"),x=[];y&&y.exists()&&(x=y.obj());var b=x.indexOf(i);if(b>=0){var S="",D=x[b-1];D&&(S+="[[前へ>"+D+"]]");var T=x[b+1];T&&(S+=" - [[次へ>"+T+"]]");var E=x[0];0!=b&&(S+=" - [[目次>"+E+"]]"),g.lines.unshift(S),g.lines.push(S)}return g.lines.forEach(s),v.buf},l.resolveFile=function(t){var e;return e=t.isDir?t:m&&"/"!=t.substring(0,1)?m.rel(t+v):a.get(t)},l.show=function(t){var e=l.resolveFile(t);u.editMode||i.d("wiki","show "+e),l.cd(e.up());var r=e.truncExt(v);if(!e.exists()&&!e.isReadOnly()&&u.editMode){var o=g[g.length-1];e.text(o?"[["+o.truncExt(v)+"]]\n":"")}if(e.exists()){var a=l.parse(e.text(),r,e);n.empty(),n.scrollTop(0),n.append(a),n.append($("<div>").css({height:"100px"}).text("")),d.show&&d.show.apply(l,[e,r]),g.push(e)}else alert(t+" というページはありません")},l.back=function(){var t=g.pop();t&&show(t)};var w;return l.highlightLine=function(t){var e=$("#"+p+"-"+t);if(0!=e.length){w&&w.removeClass("wiki-cur-line"),w=e.next(),w.addClass("wiki-cur-line");var r=e.position().top,i=n;0>r&&i.scrollTop(i.scrollTop()+(r-10)/2);var o=i.height()-100;r>o&&i.scrollTop(i.scrollTop()+(r-o+10)/2)}},l.builtinImages={"50_100.png":1,"50_160.png":1,"50_300.png":1,"apple1apple2.png":1,"coords.png":1,"copy60_100.png":1,"firstRunRes.png":1,"firstVarRes.png":1,"itadaki.png":1,"noWaitCat.png":1,"runtimeError.png":1,"sample.png":1,"sayonara.png":1,"syntaxError.png":1},l}}),requireSimulator.setName("Shell2"),define(["Shell","UI","FS","Util"],function(t,e,n,r){var i={};return i.show=function(t){var e=i.embed(t);e.dialog({width:600,height:500})},i.embed=function(){i.d||(i.d=e("div",{title:"Shell"},["div",{$var:"inner"},"Type 'help' to show commands.",["br"]]),i.inner=i.d.$vars.inner,t.prompt());var n=i.d;return n},t.cls=function(){i.d.$vars.inner.empty()},t.prompt=function(){function n(t){return 9==t.which?(t.stopPropagation(),t.preventDefault(),a(),!1):void(13==t.which&&(c.empty(),o(u.val())))}function o(){var n=u.val().replace(/^ */,"").replace(/ *$/,"");if(0!=n.length){var r=n.split(/ +/),i=r.shift(),o=t[i];if("function"!=typeof o)return f.append(i+": command not found.");try{var a=[],s=null;r.forEach(function(t){var e=/^-([A-Za-z_0-9]+)(=(.*))?/.exec(t);e?(s||(s={}),s[e[1]]=null!=e[3]?e[3]:1):a.push(t)}),s&&a.push(s);var c=o.apply(t,a);if(c===t.ASYNC)return;if("object"==typeof c)if(c instanceof Array){var l=e("table"),h=null,p=0;c.forEach(function(t){h||(h=e("tr").appendTo(l)),h.append(e("td",t)),p++,p%3==0&&(h=null)}),l.appendTo(f)}else f.append(JSON.stringify(c));else f.append(c);t.prompt()}catch(d){t.err(d),t.prompt()}}}function a(){var e=u.val(),n=e.split(" "),i=n.pop(),o=[];if(0==n.length)for(var a in t)"function"==typeof t[a]&&r.startsWith(a,i)&&o.push(a);else{var s=t.resolve(i,!1);if(!s)return;var f=s.isDir()?s:s.up();f.each(function(t){r.startsWith(t.path(),s.path())&&o.push(t.name())})}if(1==o.length){var l=i.split("/");l.pop(),l.push(o[0]),n.push(l.join("/")),u.val(n.join(" ")),c.empty()}else c.text(o.join(", "))}var s=e("div",["input",{$var:"cmd",size:40,on:{keydown:n}}],["pre",{$var:"out","class":"shell out"},["div",{$var:"cand","class":"shell cand"}]]),u=s.$vars.cmd,f=s.$vars.out,c=s.$vars.cand;return t.setout({log:function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);f.append(t.join(" ")+"\n")},err:function(t){f.append(e("div",{"class":"shell error"},t,["br"],["pre",t.stack]))}}),s.appendTo(i.inner),u.focus(),i.inner.closest(".ui-dialog-content").scrollTop(i.inner.height()),t.ASYNC},t.window=function(){i.show(t.cwd)},t.atest=function(t,e,n){console.log(t,e,n)},i}),requireSimulator.setName("NewProjectDialog"),define(["UI"],function(t){var e={};return e.show=function(t,n,r){var i=e.embed(t,n,r);i.dialog({width:600})},e.embed=function(n,r,i){if(i||(i={}),!e.d){var o={fromVal:function(t){return""==t?null:FS.get(t)},toVal:function(t){return t?t.path():""}};e.d=t("div",{title:i.ren?"プロジェクト名の変更":"新規プロジェクト"},["div",["span","プロジェクト名"],["input",{$edit:"name",value:i.defName||"",on:{enterkey:function(){e.d.done()}}}]],["div",["span","親フォルダ"],["input",{$edit:{name:"parentDir",type:o}}]],["div",["span","作成先フォルダ："],["span",{$var:"dstDir"}]],["div",{$var:"validationMessage",css:{color:"red"}}],["button",{$var:"OKButton",on:{click:function(){e.d.done()}}},"OK"])}var a=e.d,s={name:i.defName||"",parentDir:n};return a.$edits.load(s),a.$edits.validator.on.validate=function(t){return""==t.name?void this.addError("name","名前を入力してください"):(t.dstDir=t.parentDir.rel(t.name+"/"),t.dstDir.exists()?void this.addError("name","このフォルダはすでに存在します"):(this.allOK(),void a.$vars.dstDir.text(t.dstDir+"")))},a.done=function(){a.$edits.validator.isValid()&&(r(s.dstDir),a.dialog&&a.dialog("close"))},a},e}),requireSimulator.setName("requestFragment"),define(["WebSite"],function(t){var e={};return e.ajax=function(e){function n(t){return e.redirectTo&&(t.redirectTo=e.redirectTo),t}function r(){$.ajax({type:"post",url:t.serverTop+"/runFragments",data:n({id:s}),success:function(t){return"string"==typeof t&&t.match(/^notCompleted:([\-\d]+)\/([\-\d]+)$/)?(console.log("notcomp",t),c*=2,void setTimeout(r,c)):void e.success(t)},error:e.error,complete:e.complete})}var i=e.THRESH||8e5,o=e.data;if("object"!=typeof o)throw"Data should be object: "+o;if(o=JSON.stringify(o),!e.redirectTo&&("GAE"!=t.serverType||o.length<i))return $.ajax(e);for(var a=[],s=Math.random();o.length>0;)a.push(o.substring(0,i)),o=o.substring(i);var u=a.length,f=0,c=1e3;a.forEach(function(i,o){$.ajax({type:"post",url:t.serverTop+"/sendFragment",data:n({id:s,seq:o,len:u,content:i}),success:function(t){console.log("sendFrag",t,o),f++,f>=u&&setTimeout(r,c)},error:e.error})})},e}),requireSimulator.setName("Sync"),define(["FS","Shell","requestFragment","WebSite"],function(t,e,n,r){function i(t){return t&&t.isDir}var o={};return e.sync=function(){function t(t){return function(){t&&t.apply({},arguments),e.prompt()}}var n,r,a,s=function(){},u=0;return("string"==typeof arguments[u]||i(arguments[u]))&&(n=e.resolve(arguments[u],!0),u++,("string"==typeof arguments[u]||i(arguments[u]))&&(r=e.resolve(arguments[u],!1),u++)),"object"==typeof arguments[u]&&(a=arguments[u],u++),"function"==typeof arguments[u]&&(s=arguments[u],u++),n||(r=n=e.cwd),a&&a.onend&&(a.onend=t(a.onend)),r||(r=n),e.echo("sync args=",n,r,a,s),o.sync(n,r,a,t(s)),e.ASYNC},o.sync=function(){function t(t,n){e.echo("Status: "+t+" param:",n),p.onstatus&&p.onstatus(t,n)}function o(){p.onerror&&p.onerror.apply(this,arguments)}function a(){var e={base:h.path(),excludes:JSON.stringify(p.excludes)};t("getDirInfo",e),$.ajax({type:"get",url:r.serverTop+"/getDirInfo",data:e,success:s,error:o})}function s(n){p.v&&e.echo("getDirInfo",n);var i=l,a=n.data;for(var s in a){var f=i.rel(s),d=f.metaInfo(),g=a[s];c(f,s,d,g)}l.recursive(function(t){var e=t.metaInfo(),n=t.relPath(l),r=a[n];c(t,n,e,r)},{includeTrashed:!0,excludes:p.excludes}),p.v&&(e.echo("uploads:",v),e.echo("downloads:",m));var y={base:h.path(),paths:JSON.stringify(m)};t("File2LSSync",y),$.ajax({type:"post",url:r.serverTop+"/File2LSSync",data:y,success:u,error:o})}function u(i){e.echo("dlData=",i),p.v&&e.echo("dlData:",i);var a=l;if(!p.test){for(var s in i.data){var u=a.rel(s),c=i.data[s];c.trashed?u.exists()&&u.rm():u.text(c.text),delete c.text,u.metaInfo(c)}var d={base:h.path(),data:JSON.stringify(v)};d.pathInfo="/LS2FileSync",t("LS2FileSync",d),n.ajax({type:"post",url:r.serverTop+"/LS2FileSync",data:d,success:f,error:o})}}function f(t){p.v&&e.echo("LS2FileSync res=",t);var n=[];for(var r in v)n.push(r);t={msg:t,uploads:n,downloads:m},"function"==typeof d&&d(t)}function c(t,n,r,i){if(!y[n])if(y[n]=1,i&&(!r||r.lastUpdate<i.lastUpdate))m.push(n),p.v&&e.echo((r?"":"New")+"Download "+t+" trash="+!!i.trashed);else if(r&&(!i||r.lastUpdate>i.lastUpdate)){var o={text:t.text()},a=t.metaInfo();for(var s in a)o[s]=a[s];v[n]=o,p.v&&e.echo((i?"":"New")+"Upload "+t+" trash="+!!r.trashed)}}var l,h,p,d,g=0;if(i(arguments[g])&&(l=arguments[g],g++,i(arguments[g])&&(h=arguments[g],g++)),"object"==typeof arguments[g]&&(p=arguments[g],g++),"function"==typeof arguments[g]&&(d=arguments[g],g++),!l)throw"Sync.sync: Local dir must be specified as file object";h||(h=l),p||(p={}),!d&&p.onend&&(d=p.onend),p.test&&(p.v=1),a();var v={},m=[],y={}},e.rsh=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return $.ajax({url:r.serverTop+"/rsh",data:{args:JSON.stringify(t)},success:function(t){e.echo(t)},error:function(t,n,r){e.err(r)},complete:function(){e.prompt()}}),e.ASYNC},o}),requireSimulator.setName("Auth"),define(["WebSite"],function(t){var e={};return e.currentUser=function(e){$.ajax({type:"get",url:t.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(t){console.log("auth.currentUser",t),t=JSON.parse(t);var n=t.user;"null"==n&&(n=null),console.log("user",n,"csrfToken",t.csrfToken),e(n,t.csrfToken)}})},e.assertLogin=function(n){e.currentUser(function(e,r){return e?n.success(e,r):(window.onLoggedIn=n.success,void n.showLoginLink(t.serverTop+"/login"))})},window.Auth=e,e}),requireSimulator.setName("zip"),define(["FS","Shell","Util"],function(t,e,n){if("undefined"==typeof JSZip)return{};var r={};r.zip=function(t){function e(t,n){n.each(function(n){if(n.isDir()){var r=t.folder(n.name());e(r,n)}else t.file(n.name(),n.text())})}var n=new JSZip;e(n,t);var r=n.generate({type:"blob"});return r},"undefined"!=typeof saveAs&&(e.dlzip=function(t){t=e.resolve(t);var n=r.zip(t);saveAs(n,t.name().replace(/\//g,"")+".zip")});var i={".png":"image/png",".jpg":"image/jpg",".gif":"image/gif",".jpeg":"image/jpg",".mp3":"audio/mp3",".ogg":"audio/ogg"};return r.unzip=function(t,e){var r=new JSZip(t);for(var o in r.files){var a=r.files[o],s=e.rel(a.name);for(var u in i){var f;if(s.endsWith(u)){var c=i[u];f="data:"+c+";base64,"+n.Base64_From_ArrayBuffer(a.asArrayBuffer())}else f=a.asText();s.text(f)}console.log(a.name)}},r}),requireSimulator.setName("ide/selProject"),requirejs(["FS","Wiki","Shell","Shell2","NewProjectDialog","UI","Sync","Auth","zip","requestFragment","WebSite"],function(t,e,n,r,i,o,a,s,u,f,c){$(function(){function e(){$("#prjItemList").empty();var t=[];u.each(function(e){if(e.isDir()){var n=e.lastUpdate(),r=e.rel("options.json");r.exists()&&(n=r.lastUpdate()),t.push([e,n])}}),t=t.sort(function(t,e){return e[1]-t[1]}),t.forEach(function(t){var e=t[0],n=e.name();if(e.isDir()){var r=o("div",{"class":"project"},["a",{href:"project.html?dir="+e.path()},["img",{$var:"t",src:"../../images/nowprint.png"}],["div",n]]);r.appendTo("#prjItemList"),setTimeout(function(){var t=e.rel("images/").rel("icon_thumbnail.png");t.exists()&&r.$vars.t.attr("src",t.text())},10)}})}var r=t.get(c.tonyuHome),a=r.rel("Projects/");a.exists()||a.mkdir(),n.cd(a);var u=a;s.currentUser(function(t){t?($(".while-logged-out").hide(),$("#login").text(t)):$(".while-logged-in").hide()});var f=$("<iframe>").attr("src",c.top+"/doc/index.html");f.height($(window).height()-$("#navBar").height()),$("#wikiViewArea").append(f),$("#newPrj").click(function(){i.show(a,function(t){t.mkdir(),document.location.href="project.html?dir="+t.path()})}),e(),SplashScreen.hide(),$("body").on("keydown",function(t){77==t.keyCode&&c.devMode&&(c.mobile=!c.mobile,console.log("Mobile mode",c.mobile),c.mobile?r.rel("mobile.txt").text("true"):r.rel("mobile.txt").rm())}),n.wikiEditor=function(){document.location.href="wikiEditor.html"}})}),requireSimulator.setName();