function HttpHelper(t){var e={},n=t.lineMark;return e.buf=$("<div>"),e.bufs=[e.buf],e.maxLineNo=-1,e.cur=function(){return e.bufs[e.bufs.length-1]},e.p=function(t){"string"==typeof t&&(t=t.length>0?$("<span>").text(t):null),e.cur()?(e.lineNo>e.maxLineNo&&(e.maxLineNo=e.lineNo,e.cur().append($("<a>").attr({id:n+"-"+e.lineNo,name:n+"-"+e.lineNo}))),t&&e.cur().append(t)):console.log("Warning - Stack underflow")},e.enter=function(t){"string"==typeof t&&(t=$(t)),e.bufs.push(t)},e.exit=function(){var t=e.bufs.pop();e.p(t)},e.h=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e}!function(){var t={};return t.def=function(e,n,r){var i=t.getModuleInfo(t.curName);i.type=r,t.setReqs(i,e),i.func=function(){return n.apply(this,t.getObjs(e))},t.loadIfAvailable(i)},define=function(e,n){t.def(e,n,"define")},requirejs=function(e,n){t.def(e,n,"require")},t.setReqs=function(e,n){n.forEach(function(n){var r=t.getModuleInfo(n);r.loaded||(e.reqs[n]=r,r.revReqs[e.name]=e)})},t.getModuleInfo=function(e){var n=t.modules;return n[e]||(n[e]={name:e,reqs:{},revReqs:{}}),n[e]},t.doLoad=function(e){var n=t.getModuleInfo(e);if(n.loaded)return n.obj;n.loaded=!0;var r=null;if(n.func)r=n.func();else{var i=e.split(/\./);r=function(){return this}(),i.forEach(function(t){r&&(r=r[t])}),null==r&&console.log("Warning: No obj for "+e)}if("define"==n.type&&null==r)throw"No obj for "+e;n.obj=r;for(var s in n.revReqs)t.notifyLoaded(n.revReqs[s],n.name);return r},t.notifyLoaded=function(e,n){delete e.reqs[n],t.loadIfAvailable(e)},t.loadIfAvailable=function(e){for(var n in e.reqs)return;t.doLoad(e.name)},t.getObjs=function(e){var n=[];return e.forEach(function(e){var r=t.doLoad(e);n.push(r)}),n},t.modules={},t.setName=function(e){t.curName&&(t.getModuleInfo(t.curName).func||t.doLoad(t.curName)),e&&(t.curName=e)},requireSimulator=t,t}(),requireSimulator.setName("extend"),define([],function(){return function(t,e){for(var n in e)t[n]=e[n]}}),requireSimulator.setName("assert"),define([],function(){function t(e){if(e instanceof Array){var n=[];return e.forEach(function(e){n=n.concat(t(e))}),n}return[e]}var e=function(e){this.failMesg=t(e||"Assertion failed: ")};e.prototype={fail:function(){var e=$a(arguments);throw e=t(e),e=this.failMesg.concat(e),console.log.apply(console,e),new Error(e.join(" "))},subAssertion:function(){var n=$a(arguments);return n=t(n),new e(this.failMesg.concat(n))},assert:function(t,e){return t||this.fail(e),t},eq:function(t,e){return t!==e&&this.fail(t,"!==",e),t},isset:function(t,e){return null==t&&this.fail((e||"")+" is null/undef"),t},is:function(t,e){var n=e,r=t;if(null==n)return n;if(n._assert_func)return n._assert_func.apply(this,[r]),t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){t&&"number"==typeof t.length||this.fail(t,"should be array:");for(var i=this,s=0;s<n.length;s++){var o=i.subAssertion("failed at ",t,"[",s,"]: ");o.is(r[s],n[s])}return t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),t;if(n&&"object"==typeof n){for(var a in n){var o=this.subAssertion("failed at ",t,".",a,":");o.is(t[a],n[a])}return t}this.fail("Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&r(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)}},$a=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var n=new e,r=function(){try{return n.assert.apply(n,arguments)}catch(t){throw new Error(t.message)}};return r.is=function(){try{return n.is.apply(n,arguments)}catch(t){throw new Error(t.message)}},r.isset=function(){try{return n.isset.apply(n,arguments)}catch(t){throw new Error(t.message)}},r.eq=function(){try{return n.eq.apply(n,arguments)}catch(t){throw new Error(t.message)}},r.ensureError=function(){try{return n.ensureError.apply(n,arguments)}catch(t){throw new Error(t.message)}},r.fail=n.fail.bind(n),r.f=function(t){return{_assert_func:t}},r.and=function(){var t=$a(arguments);return r(t instanceof Array),r.f(function(e){for(var n=this,r=0;r<t.length;r++)n.is(e,t[r])})},r}),requireSimulator.setName("PathUtil"),define(["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}function n(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n}var r,i=/^([a-zA-Z]):/,s=/^([a-z]+):\/\/([^\/]+)\//,o=t.f(function(t){this.is(t,String),this.assert(r.isPath(t),[t," is not a path"])}),a=t.f(function(t){this.is(t,String),this.assert(r.isAbsolutePath(t),[t," is not a absolute path"])}),u=t.f(function(t){this.is(t,String),this.assert(!r.isAbsolutePath(t),[t," is not a relative path"])}),f=t.and(c,a),c=t.f(function(t){this.is(t,o),this.assert(r.isDir(t),[t," is not a directory path"])}),l=t.f(function(t){this.is(t,o),this.assert(!r.isDir(t),[t," is not a file path"])}),h="/";return r={Path:o,Absolute:a,Relative:u,Dir:c,File:l,AbsDir:f,SEP:h,endsWith:e,startsWith:n,hasDriveLetter:function(t){return i.exec(t)},isURL:function(t){var e=s.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:h+t.substring(e[0].length)}},isPath:function(){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&!r.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&(r.startsWith(e,h)||r.hasDriveLetter(e)||r.isURL(e))},isDir:function(n){return t.is(arguments,[o]),e(n,h)},splitPath:function(e){t.is(arguments,[o]);var n;if(n=this.isURL(e)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}e=e.replace(/\/+/g,h);var i=e.split(h);return""==i[i.length-1]&&(i[i.length-2]+=h,i.pop()),i},name:function(e){return t.is(arguments,[String]),r.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var n=r.name(e),i=/\.[a-zA-Z0-9]+$/.exec(n);return i?i[0]:null},truncExt:function(e,n){t.is(e,String);var i=r.name(e);return n=n||r.ext(e),t.is(n,String),i.substring(0,i.length-n.length)},truncSEP:function(e){return t.is(arguments,[o]),r.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(n,i){return t.is(arguments,[String,String]),e(r.name(n),i)},parent:function(e){return t.is(arguments,[String]),r.up(e)},rel:function(e,n){if(""==n)return e;t.is(arguments,[f,u]);var i=r.splitPath(n),s=e;s=s.replace(/\/$/,"");var o=r;return i.forEach(function(t){".."==t||"../"==t?s=o.up(s):(s=s.replace(/\/$/,""),s+=h+("."==t||"./"==t?"":t))}),s},relPath:function(e,n){return t.is(arguments,[f,f]),e.substring(0,n.length)!=n?"../"+r.relPath(e,this.up(n)):e.substring(n.length)},up:function(e){if(t.is(arguments,[o]),e==h)return null;var n=r.splitPath(e);return n.pop(),n.join(h)+h}}}),requireSimulator.setName("MIMETypes"),define([],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".mp3":"audio/mp3",".ogg":"audio/ogg",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu"}}),requireSimulator.setName("Util"),Util=function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:e(i[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function r(t,e){return t.substring(0,e.length)===e}function i(t){function e(e){throw console.log(e),console.log(t,f),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var r,i=t.length,s=0,o=0;if(!i)return new ArrayBuffer(0);r=Math.floor(i/4*3),"="==t.charAt(i-1)&&(r-=1),"="==t.charAt(i-2)&&(r-=1);for(var a=new ArrayBuffer(r),u=new Uint8Array(a),f=0,c=0;r>c&&(o=n[t.charCodeAt(f)],void 0===o&&e("Invalid letter: "+t.charCodeAt(f)),s=o<<2,f++,o=n[t.charCodeAt(f)],void 0===o&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=s|o>>4&3,s=(15&o)<<4,f++,c++,!(c>=r))&&(o=n[t.charCodeAt(f)],void 0===o&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=s|o>>2&15,s=(3&o)<<6,f++,c++,!(c>=r));)o=n[t.charCodeAt(f)],void 0===o&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=s|o,f++,c++;return a}function s(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,s=0,o=0,a=0;i>a&&(o=r[a],n+=e[o>>2],s=(3&o)<<4,a++,!(a>=i))&&(o=r[a],n+=e[s|o>>4],s=(15&o)<<2,a++,!(a>=i));)o=r[a],n+=e[s|o>>6],n+=e[63&o],a++;var u=i%3;return u&&(n+=e[s]),1==u?n+="==":2==u&&(n+="="),n}function o(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){var e=r.apply(t,arguments);return e})}(n);return e}function a(){return"undefined"!=typeof Buffer}function u(t){return a()&&t instanceof Buffer}function f(t){return t instanceof ArrayBuffer||u(t)}function c(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(r){throw console.log(e.join("")),r}}function l(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],s=0;s<n.length;s++){var o=r.exec(n.substring(s));o?(i.push(parseInt("0x"+o[1])),s+=o[0].length-1):i.push(n.charCodeAt(s))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer}return{getQueryString:t,endsWith:n,startsWith:r,Base64_To_ArrayBuffer:i,Base64_From_ArrayBuffer:s,utf8bytes2str:c,str2utf8bytes:l,privatize:o,hasNodeBuffer:a,isNodeBuffer:u,isBuffer:f}}(),requireSimulator.setName("DataURL"),define(["extend","assert","Util"],function(t,e,n){function r(t,e){function r(e){throw console.log(e),console.log(t,h),new Error(e)}var i=e;t=t.replace(/[\n=]/g,"");var s=new Object;s[65]=0,s[66]=1,s[67]=2,s[68]=3,s[69]=4,s[70]=5,s[71]=6,s[72]=7,s[73]=8,s[74]=9,s[75]=10,s[76]=11,s[77]=12,s[78]=13,s[79]=14,s[80]=15,s[81]=16,s[82]=17,s[83]=18,s[84]=19,s[85]=20,s[86]=21,s[87]=22,s[88]=23,s[89]=24,s[90]=25,s[97]=26,s[98]=27,s[99]=28,s[100]=29,s[101]=30,s[102]=31,s[103]=32,s[104]=33,s[105]=34,s[106]=35,s[107]=36,s[108]=37,s[109]=38,s[110]=39,s[111]=40,s[112]=41,s[113]=42,s[114]=43,s[115]=44,s[116]=45,s[117]=46,s[118]=47,s[119]=48,s[120]=49,s[121]=50,s[122]=51,s[48]=52,s[49]=53,s[50]=54,s[51]=55,s[52]=56,s[53]=57,s[54]=58,s[55]=59,s[56]=60,s[57]=61,s[43]=62,s[47]=63;var o,a=t.length,u=0,f=0;if(!a)return new i(0);o=Math.floor(a/4*3),"="==t.charAt(a-1)&&(o-=1),"="==t.charAt(a-2)&&(o-=1);for(var c=new i(o),l=n.isNodeBuffer(c)?c:new Uint8Array(c),h=0,p=0;o>p&&(f=s[t.charCodeAt(h)],void 0===f&&r("Invalid letter: "+t.charCodeAt(h)),u=f<<2,h++,f=s[t.charCodeAt(h)],void 0===f&&r("Invalid letter: "+t.charCodeAt(h)),l[p]=u|f>>4&3,u=(15&f)<<4,h++,p++,!(p>=o))&&(f=s[t.charCodeAt(h)],void 0===f&&r("Invalid letter: "+t.charCodeAt(h)),l[p]=u|f>>2&15,u=(3&f)<<6,h++,p++,!(p>=o));)f=s[t.charCodeAt(h)],void 0===f&&r("Invalid letter: "+t.charCodeAt(h)),l[p]=u|f,h++,p++;return e===Uint8Array?l:c}function i(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],r="",i=n.isNodeBuffer(t)?t:new Uint8Array(t),s=i.length,o=0,a=0,u=0;s>u&&(a=i[u],r+=e[a>>2],o=(3&a)<<4,u++,!(u>=s))&&(a=i[u],r+=e[o|a>>4],o=(15&a)<<2,u++,!(u>=s));)a=i[u],r+=e[o|a>>6],r+=e[63&a],u++;var f=s%3;return f&&(r+=e[o]),1==f?r+="==":2==f&&(r+="="),r}var s=n.hasNodeBuffer()?Buffer:ArrayBuffer,o=(n.isNodeBuffer,n.isBuffer),a=function(t,n){"string"==typeof t?(this.url=t,this.binType=n||s,this.dataURL2bin(t)):t&&o(t.buffer)?(this.buffer=t.buffer,e.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):o(t)?(this.buffer=t,e.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),e.fail("Invalid args: ",arguments))};return a.isBuffer=o,t(a.prototype,{bin2dataURL:function(t,n){e(o(t)),e.is(n,String);var r=this.dataHeader(n),s=i(t);return e.is(s,String),this.url=r+s},dataURL2bin:function(t){e.is(arguments,[String]);var n=/^data:([^;]+);base64,/i,i=n.exec(t);return e(i,["malformed dataURL:",t]),this.contentType=i[1],this.buffer=r(t.substring(i[0].length),this.binType),e.is(this.buffer,this.binType)},dataHeader:function(t){return e.is(arguments,[String]),"data:"+t+";base64,"},toString:function(){return e.is(this.url,String)}}),a}),requireSimulator.setName("Content"),define(["DataURL","Util","assert"],function(t,e,n){var r=function(){},i=(e.isNodeBuffer,e.isBuffer);r.plainText=function(t,e){var n=new r;return n.contentType=e||"text/plain",n.plain=t,n},r.url=function(t){var e=new r;return e.url=t,e},r.buffer2ArrayBuffer=function(t){return e.isBuffer(t)?n(new Uint8Array(t).buffer,"n2a: buf is not set"):n(t,"n2a: a is not set")},r.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var e=new Buffer(new Uint8Array(t));return e}return n(t,"a2n: a is not set")},r.bin=function(t,s){n(s,"contentType should be set");var o=new r;if(t&&i(t.buffer))o.arrayBuffer=t.buffer;else if(e.isNodeBuffer(t))o.nodeBuffer=t;else{if(!(t instanceof ArrayBuffer))throw new Error(t+" is not a bin");o.arrayBuffer=t}return o.contentType=s,o};var s=r.prototype;return s.toBin=function(n){if(n=n||(e.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return n===Buffer?this.nodeBuffer:this.arrayBuffer=r.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return n===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=r.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var i=new t(this.url,n);return this.setBuffer(i.buffer)}if(null!=this.plain)return this.setBuffer(e.str2utf8bytes(this.plain,n));throw new Error("No data")},s.setBuffer=function(t){return n(t,"b is not set"),e.isNodeBuffer(t)?this.nodeBuffer=t:this.arrayBuffer=t},s.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},s.toNodeBuffer=function(){return this.toBin(Buffer)},s.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=e.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var n=new t(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=n.url}throw new Error("No data")},s.toPlainText=function(){if(null!=this.plain)return this.plain;if(this.url&&!this.hasBin()){var n=new t(this.url,ArrayBuffer);this.arrayBuffer=n.buffer}if(this.hasBin())return this.plain=e.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},s.hasURL=function(){return this.url},s.hasPlainText=function(){return null!=this.plain},s.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},s.hasNodeBuffer=function(){return this.nodeBuffer},s.hasArrayBuffer=function(){return this.arrayBuffer},r}),requireSimulator.setName("SFile"),define(["extend","assert","PathUtil","Util","Content"],function(t,e,n,r,i){var s=function(t,r){e.is(r,n.Absolute),e(t&&t.getReturnTypes),this._path=r,this.fs=t,this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return s.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},s.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},_clone:function(){return this._resolve(this.path())},_resolve:function(t,i){var o;if(i=i||{},s.is(t))o=t;else{e.is(t,n.Absolute);var a,u=i.policy||this.policy;if(u&&(a=u.topDir)&&(a.path&&(a=a.path()),!n.startsWith(t,a)))throw new Error(t+": cannot access. Restricted to "+a);o=this.fs.getRootFS().get(t),o.policy=u}return o.policy?r.privatize(o):o},contains:function(t){return e(s.is(t),t+" shoud be a SFile object."),this.isDir()?n.startsWith(t.path(),this.path()):!1},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var r=t.path?t.path():t;return n.relPath(this.path(),e.is(r,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,t))},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){this.fs.touch(this.path())},isReadOnly:function(){this.fs.isReadOnly(this.path())},isTrashed:function(){var t=this.metaInfo();return t?t.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.fs.getMetaInfo(this.path(),t)},setMetaInfo:function(t,e){return this.fs.setMetaInfo(this.path(),t,e)},lastUpdate:function(){return e(this.exists()),this.metaInfo().lastUpdate},exists:function(t){t=t||{};var e=this.fs.exists(this.path(),t);return e||t.noFollowLink?e:this._resolveLinkNoPolicy().exists({noFollowLink:!0})},rm:function(t){if(t=t||{},!this.exists({noFollowLink:!0})){var e=this._resolveLinkNoPolicy();if(!this.equals(e))return e.rm(t)}this.isDir()&&(t.recursive||t.r)&&this.each(function(e){e.rm(t)});var n=this.path();this.fs.rm(n,t)},removeWithoutTrash:function(t){t=t||{},t.noTrash=!0,this.rm(t)},isDir:function(){return this.fs.isDir(this.path())},text:function(){var t=this._resolveLinkNoPolicy();return this.equals(t)?arguments.length>0?void this.setText(arguments[0]):this.getText():t.text.apply(t,arguments)},setText:function(t){e.is(t,String),this.isText()?this.fs.setContent(this.path(),i.plainText(t)):this.fs.setContent(this.path(),i.url(t))},getContent:function(t){return"function"==typeof t?this.fs.getContentAsync(this.path()).then(t):this.fs.getContent(this.path())},setContent:function(t){return this.fs.setContentAsync(this.path(),t)},getText:function(){return this.isText()?this.fs.getContent(this.path()).toPlainText():this.fs.getContent(this.path()).toURL()},isText:function(){return this.fs.isText(this.path())},contentType:function(){return this.fs.getContentType(this.path())},setBytes:function(t){return this.fs.setContent(this.path(),i.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.fs.getContent(this.path()).toBin(t.binType)},getURL:function(){return this.fs.getURL(this.path())},lines:function(){return this.text().split("\n")},obj:function(){var t=this;if(0==arguments.length){var n=t.text();return n?JSON.parse(n):null}t.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,r){var i=this,r=r||{},s=i.isDir(),o=t.isDir();if(!s&&o&&(t=t.rel(i.name()),e(!t.isDir(),t+" is a directory."),o=!1),s&&!o)this.err("Cannot move dir to file");else{if(!s&&!o)return r.echo&&r.echo(i+" -> "+t),this.fs.cp(e.is(i.path(),n.Absolute),t.path(),r);e(s&&o),i.each(function(e){t.rel(e.name()).copyFrom(e,r)})}},moveFrom:function(t,e){var n=this.copyFrom(t,e);return t.rm({recursive:!0}),n},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){var n=this.assertDir();n.listFiles(e).forEach(t)},recursive:function(t,e){var n=this.assertDir();n.each(function(e){e.isDir()?e.recursive(t):t(e)},e)},listFiles:function(t){e(null==t||"object"==typeof t);var n=this.assertDir(),r=this._resolveLinkNoPolicy();if(!this.equals(r))return r.listFiles.apply(r,arguments).map(function(t){return n.rel(t.name())});var i,s=this.path();"function"==typeof t&&(i=t),t=n.convertOptions(t),i||(i=t.order);for(var o=this.fs.opendir(s,t),a=[],u=0;u<o.length;u++){var f=o[u];t.excludes[s+f]||a.push(n.rel(f))}return"function"==typeof i&&a.sort&&a.sort(i),a},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir(),r=n.listFiles(t);return r.map(function(t){return t.name()})},convertOptions:function(t){var r=(this.assertDir(),this.path());if(t||(t={}),t.excludes||(t.excludes={}),t.excludes instanceof Array){var i={};t.excludes.forEach(function(t){n.startsWith(t,"/")?i[t]=1:i[r+t]=1}),t.excludes=i}return e.is(t,{excludes:{}})},mkdir:function(){this.touch()},link:function(t,n){t=this._resolve(e(t)),this.fs.link(this.path(),t.path(),n)},_resolveLinkOpt:function(t){var r=this.fs.resolveLink(this.path());return e.is(r,n.Absolute),this._resolve(r,t)},_resolveLinkNoPolicy:function(){return this._resolveLinkOpt({policy:{}})},resolveLink:function(){return this._resolveLinkOpt()},isLink:function(){return this.fs.isLink(this.path())}},s}),requireSimulator.setName("FS2"),define(["extend","PathUtil","MIMETypes","assert","SFile"],function(t,e,n,r,i){function s(t){throw new Error(t+" is STUB!")}var o=function(){},a={};return o.addFSType=function(t,e){a[t]=e},t(o.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(t){r.is(arguments,[e.AbsDir]);var n=this.fstab();console.log(n);for(var i=0;i<n.length;i++)if(console.log(n[i].path,t),n[i].path==t)return n.splice(i,1),!0;return!1},resolveFS:function(t){r.is(t,e.Absolute);var n;return this.fstab().forEach(function(r){n||e.startsWith(t,r.path)&&(n=r.fs)}),n||(n=this),r.is(n,o)},isReadOnly:function(){s("isReadOnly")},supportsSync:function(){return!0},mounted:function(t,n){r.is(arguments,[o,e.AbsDir]),this.parentFS=t,this.mountPoint=n},relFromMountPoint:function(t){return r.is(t,e.Absolute),this.parentFS?(r.is(this.mountPoint,e.AbsDir),e.relPath(t,this.mountPoint)):e.relPath(t,e.SEP)},dirFromFstab:function(t,n){r.is(t,e.AbsDir);var i=(n||{}).res||[];return this.fstab().forEach(function(n){e.up(n.path)==t&&i.push(e.name(n.path))}),i},getRootFS:function(){for(var t,e=this;e;e=e.parentFS)t=e;return r.is(t,o)},getReturnTypes:function(){s("")},getContent:function(){s("getContent")},getContentAsync:function(){return this.supportsSync()||s("getContentAsync"),$.when(this.getContent.apply(this,arguments))},setContent:function(){s("")},setContentAsync:function(t,e,n){var r=this;return r.supportsSync()||s("setContentAsync"),$.when(e).then(function(e){return $.when(r.setContent(t,e,n))})},getMetaInfo:function(){s("")},setMetaInfo:function(){s("")},mkdir:function(){s("mkdir")},touch:function(){s("touch")},exists:function(){s("exists")},opendir:function(){s("opendir")},cp:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),i=i||{};var s=this.isDir(t),o=this.getRootFS().resolveFS(n),a=o.isDir(n);if(s||a)throw new Error("only file to file supports");if(this.supportsSync()&&o.supportsSync()){var u=this.getContent(t),f=o.setContent(n,u);return i.a&&o.setMetaInfo(n,this.getMetaInfo(t)),f}return o.setContentAsync(n,this.getContentAsync(t)).then(function(e){return i.a?o.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(){s("")},link:function(){throw new Error("This FS not support link.")},getURL:function(){s("")}}),o.delegateMethods=function(t,n){for(var i in n)!function(i){t[i]=function(){var t=arguments[0];r.is(t,e.Absolute);var s=this.resolveFS(t);return s!==this?s[i].apply(s,arguments):n[i].apply(this,arguments)}}(i)},o.delegateMethods(o.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},mount:function(t,n,i){if(r.is(arguments,[e.AbsDir]),"string"==typeof n){var s=r(a[n],"fstype "+n+" is undefined.");n=s(t,i||{})}if(r.is(n,o),!e.isURL(t)&&this.exists(t))throw new Error(t+": Directory exists");var u=e.up(t);if(null==u)throw new Error("Cannot mount on root");if(!this.exists(u))throw new Error(t+": Parent Directory not exist");n.mounted(this,t),this.fstab().unshift({path:t,fs:n})},getContentType:function(t,r){var i=e.ext(t);return n[i]||(r||{}).def||"text/plain"},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t){return e.isDir(t)},find:function(t,n){r.is(arguments,[e.Absolute]);var i=this.opendir(t,n),s=this,o=[t];return i.forEach(function(r){var i=e.rel(t,r);if(e.isDir(i)){var a=s.resolveFS(i);o=o.concat(a.find(i,n))}else o.push(i)}),o},resolveLink:function(t){r.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){r(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var s=e.rel(i,e.relPath(t,n));return r(s!=t,"np==path=="+s),r.is(this.getRootFS().resolveFS(s).resolveLink(s),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(){return null},get:function(t){return r.eq(this.resolveFS(t),this),new i(this,t)}}),o}),requireSimulator.setName("WebSite"),define([],function(){var t,e=document.location.href,n=!!e.match(/html\/dev\//)&&!!e.match(/localhost:3/);t=e.match(/jsrun\.it/)?{urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:n,pluginTop:"http://tonyuedit.appspot.com/js/plugins",removeJSOutput:!0}:e.match(/tonyuexe\.appspot\.com/)||e.match(/localhost:8887/)||e.match(/\/html\/((dev)|(build))\//)?{urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:n}:{urlAliases:{},top:".",devMode:n};var r=window.navigator.userAgent.toLowerCase();return t.tablet=-1!=r.indexOf("windows")&&-1!=r.indexOf("touch")||-1!=r.indexOf("ipad")||-1!=r.indexOf("android")&&-1==r.indexOf("mobile")||-1!=r.indexOf("firefox")&&-1!=r.indexOf("tablet")||-1!=r.indexOf("kindle")||-1!=r.indexOf("silk")||-1!=r.indexOf("playbook"),t.mobile=-1!=r.indexOf("windows")&&-1!=r.indexOf("phone")||-1!=r.indexOf("iphone")||-1!=r.indexOf("ipod")||-1!=r.indexOf("android")&&-1!=r.indexOf("mobile")||-1!=r.indexOf("firefox")&&-1!=r.indexOf("mobile")||-1!=r.indexOf("blackberry"),t.pluginTop||(t.pluginTop=t.top+"/js/plugins"),t.disableROM={},e.match(/tonyuedit\.appspot\.com/)||e.match(/localhost:8888/),(e.match(/\.appspot\.com/)||e.match(/localhost:888[87]/))&&(t.serverType="GAE"),e.match(/localhost:3000/)&&(t.serverType="Node"),t.serverTop=e.match(/tonyuexe\.appspot\.com/)||e.match(/localhost:8887/)?t.top+"/exe":t.top+"/edit",t.sampleImg=t.top+"/images",t.blobPath=t.serverTop+"/serveBlob",t.isNW="object"==typeof process&&process.__node_webkit,t.mp3Disabled=t.isNW,t.tonyuHome="/Tonyu/",t.url={getDirInfo:t.serverTop+"/getDirInfo",getFiles:t.serverTop+"/File2LSSync",putFiles:t.serverTop+"/LS2FileSync"},t.isNW?(t.cwd=process.cwd().replace(/\\/g,"/").replace(/\/?$/,"/"),t.tonyuHome=process.env.TONYU_HOME?process.env.TONYU_HOME.replace(/\\/g,"/").replace(/\/?$/,"/"):t.cwd+"fs/Tonyu/",t.logdir="/var/log/Tonyu/",t.wwwDir=t.cwd+"www/",t.platform=process.platform,t.ffmpeg=t.cwd+("win32"==t.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg")):t.wwwDir=location.protocol+"//"+location.host+"/",t.kernelDir=t.wwwDir+"Kernel/",t.compiledKernel=e.match(/tonyuedit\.appspot\.com/)||e.match(/localhost:888/)||t.isNW?t.top+"/Kernel/js/concat.js":"http://tonyuexe.appspot.com/Kernel/js/concat.js",window.WebSite=t}),requireSimulator.setName("NativeFS"),define(["FS2","assert","PathUtil","extend","MIMETypes","DataURL","Content"],function(t,e,n,r,i,s,o){var a="object"==typeof process&&process.__node_webkit;if(!a)return function(){throw new Error("This system not suppert native FS")};var u=e,f=require("fs"),c=function(t){t&&(e.is(t,n.AbsDir),this.rootPoint=t)};c.available=!0;var l=n.SEP,h=c.prototype=new t;return h.toNativePath=function(t){return this.rootPoint?(e.is(t,n.Absolute),n.rel(this.rootPoint,this.relFromMountPoint(t))):t},h.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){console.log("WOW3!",t[0]);var e=new Buffer(new Uint8Array(t));return console.log("WOW4!",e[0]),e}return t},t.addFSType("NativeFS",function(t,e){return new c(e.r)}),c.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},t.delegateMethods(c.prototype,{getReturnTypes:function(){return u.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,r){r=r||{},e.is(t,n.Absolute);var i=this.toNativePath(t);return this.assertExist(t),this.isText(t)?o.plainText(f.readFileSync(i,{encoding:"utf8"})):o.bin(f.readFileSync(i),this.getContentType(t))},setContent:function(t,r){e.is(arguments,[n.Absolute,o]);var i=n.up(t);i&&this.getRootFS().mkdir(i);var s=this.toNativePath(t);r.hasBin()||!r.hasPlainText()?f.writeFileSync(s,r.toNodeBuffer()):f.writeFileSync(s,r.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(){},isReadOnly:function(){return!1},stat:function(t){e.is(t,n.Absolute);var r=this.toNativePath(t);return f.statSync(r)},mkdir:function(t){if(u.is(arguments,[n.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var e=n.up(t);e&&this.getRootFS().mkdir(e);
var r=this.toNativePath(t);return f.mkdirSync(r)},opendir:function(t){u.is(arguments,[String]);var e=this.toNativePath(t),r=n.truncSEP(e),i=f.readdirSync(e).map(function(t){var e=f.statSync(r+l+t),n=e.isDirectory()?l:"";return t+n}),s=this.dirFromFstab(t);return u.is(s.concat(i),Array)},rm:function(t,e){u.is(arguments,[n.Absolute]),e=e||{},this.assertExist(t);var r=this.toNativePath(t);return this.isDir(t)?f.rmdirSync(r):f.unlinkSync(r)},exists:function(t){var e=this.toNativePath(t);return f.existsSync(e)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():n.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&!this.isDir(t)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")}}),c}),requireSimulator.setName("LSFS"),define(["FS2","PathUtil","extend","assert","Util","Content"],function(t,e,n,r,i,s){function o(){return(new Date).getTime()}var a=function(t,e){this.storage=t,this.options=e||{}},u=e.isDir.bind(e),f=e.up.bind(e),c=e.endsWith.bind(e),l=(e.Path,e.Absolute),h=e.SEP;return a.ramDisk=function(){var t={};return t[e.SEP]="{}",new a(t)},t.addFSType("localStorage",function(){return new a(localStorage)}),t.addFSType("ramDisk",function(){return a.ramDisk()}),a.now=o,a.prototype=new t,a.prototype.resolveKey=function(t){return r.is(t,e.Absolute),e.SEP+this.relFromMountPoint(t)},a.prototype.getItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},a.prototype.setItem=function(t,n){r.is(t,e.Absolute);var i=this.resolveKey(t);r(i.indexOf("..")<0),r(e.startsWith(i,e.SEP)),this.storage[i]=n},a.prototype.removeItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},a.prototype.itemExists=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return n in this.storage},a.prototype.inMyFS=function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},a.prototype.getDirInfo=function(t){if(r.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");c(t,h)||(t+=h),r(this.inMyFS(t));var n={};try{var i=this.getItem(t);i&&(n=JSON.parse(i))}catch(s){console.log("dinfo err : ",t,i)}return n},a.prototype.putDirInfo=function(t,n,i){if(r.is(arguments,[e.AbsDir,Object]),!u(t))throw new Error("Not a directory : "+t);r(this.inMyFS(t)),this.setItem(t,JSON.stringify(n));var s=f(t);if(null!=s){if(!this.inMyFS(s))return r(this.getRootFS()!==this),void this.getRootFS().touch(s);var o=this.getDirInfo(s);this._touch(o,s,e.name(t),i)}},a.prototype._touch=function(t,e,n,i){r.is(arguments,[Object,String,String]),r(this.inMyFS(e)),t[n]||(t[n]={},i&&(t[n].trashed=!0)),i||delete t[n].trashed,t[n].lastUpdate=o(),this.putDirInfo(e,t,i)},a.prototype.removeEntry=function(t,e,n){r.is(arguments,[Object,String,String]),t[n]&&(t[n]={lastUpdate:o(),trashed:!0},this.putDirInfo(e,t,!0))},a.prototype.removeEntryWithoutTrash=function(t,e,n){r.is(arguments,[Object,String,String]),t[n]&&(delete t[n],this.putDirInfo(e,t,!0))},a.prototype.isRAM=function(){return this.storage!==localStorage},a.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},t.delegateMethods(a.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t){r.is(arguments,[l]),this.assertExist(t);var e;return e=this.isText(t)?s.plainText(this.getItem(t)):s.url(this.getItem(t))},setContent:function(t,e){r.is(arguments,[l,s]),this.assertWriteable(t),this.isText(t)?this.setItem(t,e.toPlainText()):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t){if(this.assertExist(t,{includeTrashed:!0}),r.is(arguments,[l]),t==e.SEP)return{};var n=r(e.up(t));if(!this.inMyFS(n))return{};var i=e.name(t);r.is(n,e.AbsDir);var s=this.getDirInfo(n);return r(s[i])},setMetaInfo:function(t,n){r.is(arguments,[String,Object]),this.assertWriteable(t);var i=r(e.up(t));if(this.inMyFS(i)){var s=this.getDirInfo(i),o=e.name(t);s[o]=n,this.putDirInfo(i,s,s[o].trashed)}},mkdir:function(t){r.is(arguments,[l]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){r.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),i=this.dirFromFstab(t);for(var s in n)r(n[s]),(!n[s].trashed||e.includeTrashed)&&i.push(s);return r.is(i,Array)},rm:function(t,n){r.is(arguments,[l]),n=n||{},this.assertWriteable(t);var i=e.up(t);if(null==i||!this.inMyFS(i))throw new Error(t+": cannot remove. It is root of this FS.");if(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t)){var s=this.opendir(t);s.length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)}else this.removeItem(t);var o=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(o,i,e.name(t)):this.removeEntry(o,i,e.name(t))},exists:function(t,n){r.is(arguments,[l]),n=n||{};var i=e.name(t),s=e.up(t);if(null==s||!this.inMyFS(s))return!0;var o=this.getDirInfo(s),a=o[i];return a&&a.trashed&&this.itemExists(t)&&(this.isDir(t)||r.fail("Inconsistent "+t+": trashed, but remains in storage")),!a&&this.itemExists(t)&&r.fail("Inconsistent "+t+": not exists in metadata, but remains in storage"),!a||a.trashed||a.link||this.itemExists(t)||r.fail("Inconsistent "+t+": exists in metadata, but not in storage"),a&&!n.includeTrashed&&(a=!a.trashed),!!a},link:function(t,n){r.is(arguments,[e.AbsDir,e.AbsDir]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var i={};i.link=n,i.lastUpdate=o(),this.setMetaInfo(t,i),console.log(this.storage),r(this.exists(t)),r(this.isLink(t))},isLink:function(t){if(r.is(arguments,[e.AbsDir]),!this.exists(t))return null;var n=r(this.getMetaInfo(t));return n.link},touch:function(t){r.is(arguments,[l]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?this.setItem(t,"{}"):this.setItem(t,""));var n=f(t);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,e.name(t),!1)}else r(this.getRootFS()!==this),this.getRootFS().touch(n)},getURL:function(t){return this.getContent(t).toURL()}}),a}),requireSimulator.setName("Env"),define(["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n}),requireSimulator.setName("FS"),define(["FS2","WebSite","NativeFS","LSFS","PathUtil","Env","assert","SFile"],function(t,e,n,r,i,s,o,a){var t={};"object"==typeof window&&(window.FS=t);var u,f=new s(e);return u=e.isNW?new n:new r(localStorage),t.getRootFS=function(){return u},t.get=function(){return u.get.apply(u,arguments)},t.expandPath=function(){return f.expandPath.apply(f,arguments)},t.resolve=function(e,n){return a.is(e)?e:(e=f.expandPath(e),n&&!i.isAbsolutePath(e)?(n=f.expandPath(n),t.get(n).rel(e)):t.get(e))},t.mount=function(){return u.mount.apply(u,arguments)},t.unmount=function(){return u.unmount.apply(u,arguments)},t}),requireSimulator.setName("HttpHelper"),requireSimulator.setName("Arrow"),Arrow=function(){var t={};return t.show=function(t){function e(){t.addClass("tutorial-highlight"),setTimeout(n,200)}function n(){t.removeClass("tutorial-highlight"),s-->0?setTimeout(e,200):r()}function r(){s=0,$.data(t[0],"blinking","f")}if("string"==typeof t&&(t=$(t)),0==t.length)return!1;var i=$.data(t[0],"blinking");if("t"!=i){$.data(t[0],"blinking","t");var s=3;e(),t.click(function(){r()})}},t.showOld=function(t){function e(){r&&(r.attr({src:"images/arrow"+i+".png"}),i=(i+1)%4)}if("string"==typeof t&&(t=$(t)),0==t.length)return!1;var n=t.offset(),r=$("<img>").attr({src:"images/arrow0.png"}).css({font:"40px",position:"absolute",left:n.left,top:n.top+t.height(),color:"red",zIndex:1e3,"z-index":1e3}).appendTo("body"),i=0;return setInterval(e,250),t.click(function(){r&&(r.remove(),r=null)}),!0},t}(),requireSimulator.setName("Shell"),define(["FS","Util","WebSite","PathUtil","assert"],function(t,e,n,r){function i(t,e){var n=s(t);if(e&&!n.exists())throw n+": no such file or directory";return n}function s(e){if("string"!=typeof e)return e;if(r.isAbsolutePath(e))return t.get(e);var n=o.cwd;return n.rel(e)}var o={cwd:t.get("/")};return o.cd=function(t){return o.cwd=i(t,!0),o.pwd()},o.mount=function(e,n){return n&&n.t?void t.mount(e,n.t,n):void sh.err("-t=[fstype] should be specified.")},o.unmount=function(e){t.unmount(e)},o.fstab=function(){var e=t.getRootFS(),n=e.fstab(),r=this;r.echo(e.fstype()+"	<Root>"),n.forEach(function(t){r.echo(t.fs.fstype()+"	"+t.path)})},o.resolve=i,o.pwd=function(){return o.cwd+""},o.ls=function(t){return t=t?i(t,!0):o.cwd,t.ls()},o.cp=function(t,e,n){n||(n={}),n.v&&(o.echo("cp",t,e),n.echo=o.echo.bind(o));var r=i(t,!0),s=i(e);return r.copyTo(s,n)},o.rm=function(t,e){if(e||(e={}),e.notrash)return t=i(t,!1),t.removeWithoutTrash(),1;if(t=i(t,!0),t.isDir()&&e.r){var n=t,r=0;return n.each(function(t){t.exists()&&(r+=o.rm(t,e))}),n.rm(),r+1}return t.rm(),1},o.cat=function(t){t=i(t,!0),o.echo(t.text())},o.resolve=function(t){return t||(t="."),t=i(t)},o.grep=function(t,e,n){function r(t,e,r){n.res&&n.res.push({file:t,lineNo:e,line:r}),o.echo(t+"("+e+"): "+r)}return e=i(e,!0),n||(n={}),n.res||(n.res=[]),e.isDir()?e.each(function(e){o.grep(t,e,n)}):"string"==typeof t&&e.lines().forEach(function(n,i){n.indexOf(t)>=0&&r(e,i+1,n)}),n.res},o.touch=function(t){return t=i(t),t.text(t.exists()?t.text():""),1},o.setout=function(t){o.outUI=t},o.echo=function(){console.log.apply(console,arguments),o.outUI&&o.outUI.log&&o.outUI.log.apply(o.outUI,arguments)},o.err=function(){console.log.apply(console,arguments),o.outUI&&o.outUI.err&&o.outUI.err.apply(o.outUI,arguments)},o.prompt=function(){},o.ASYNC={r:"SH_ASYNC"},o.help=function(){for(var t in o){var e=o[t];"function"==typeof e&&o.echo(t+(e.description?" - "+e.description:""))}},sh=o,n.isNW&&(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()}),o}),requireSimulator.setName("Log"),define(["FS","WebSite","Shell"],function(t,e,n){function r(t,e){return t="00000000000000"+t,t.substring(t.length-e)}function i(t){return t.replace(/\n/g,"\n|")}var s={},o=e.logdir?t.resolve("${logdir}"):null,a=o&&o.exists();if(s.todayDir=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();return o.rel(e+"/").rel(n+"/").rel(r+"/")},s.curFile=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();return s.todayDir().rel(e+"-"+n+"-"+r+".log")},s.curProject=function(){var t=new Date,e=t.getHours(),n=t.getMinutes(),i=t.getSeconds();return s.todayDir().rel("Project/").rel(r(e,2)+"_"+r(n,2)+"_"+r(i,2)+"/")},s.dumpProject=function(t){if(a){var e=s.curProject();n.cp(t,e),s.append("Dumped project to "+e.path())}},!e.logging&&!e.isNW){var u=t.get("/var/log/");u.exists()&&u.fs.storage===localStorage&&u.removeWithoutTrash({r:!0})}return s.append=function(t){if(a){var e=s.curFile(),n=e.exists()?e.text():"";e.text(n+t+"\n")}},s.d=function(t,e){s.append(new Date+": ["+t+"]"+i(e))},s.e=function(t,e){s.append(new Date+": ERROR["+t+"]"+i(e))},s}),requireSimulator.setName("exceptionCatcher"),define([],function(){var t={};return t.f=function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(n){t.handleException(n)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var r in e)e[r]=t.f(e[r]);return e}},t}),requireSimulator.setName("UI"),define(["Util","exceptionCatcher"],function(t,e){var n={},r=e.f;return n=function(){function e(){c.forEach(function(t){t()}),setTimeout(r(e),10)}function i(t){return t instanceof Array?s(t):"string"==typeof t?a(t):t}function s(t){var e=t[0],n=1,r=$("<"+e+">");for("object"!=typeof t[n]||t[n]instanceof Array||t[n]instanceof $||(o(r,t[n],e),n++);n<t.length;)r.append(i(t[n])),n++;return r}function o(e,i){function s(t,n){if(n)if("enterkey"==t)e.on("keypress",r(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var s,o=!0;c.push(function(){var t;t="checkbox"==i.type?!!e.prop("checked"):e.val(),(o||s!=t)&&(n.apply(e,[t,s]),s=t),o=!1})}else e.on(t,r(n))}i.$var&&(l[i.$var]=e),i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(t){h.writeToModel(i.$edit,t,e)}),l[i.$edit.name]||(l[i.$edit.name]=e),h.push({jq:e,params:i}));for(var o in i)if("on"==o)for(var a in i.on)s(a,i.on[a]);else"css"==o&&null!=i[o]?e.css(i[o]):t.startsWith(o,"$")||null==i[o]||e.attr(o,i[o])}function a(t){return $("<span>").text(t)}for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];var c=[],l={},h=[],p=i(u);return p.$edits=h,p.$vars=l,h.load=function(t){h.model=t,h.forEach(function(t){h.writeToJq(t.params.$edit,t.jq)})},h.writeToJq=function(t,e){var n=h.model;if(n){for(var r=t.name,i=r.split("."),s=0;s<i.length;s++)n=n[i[s]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},h.validator={errors:{},show:function(){if(l.validationMessage){l.validationMessage.empty();for(var t in this.errors)l.validationMessage.append(n("div",this.errors[t].mesg))}if(l.OKButton){var e=!0;for(var t in this.errors)e=!1;l.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},h.writeToModel=function(t,e,n){var r=h.model;if(r){var i=t.name;try{e=t.type.fromVal(e)}catch(s){return void h.validator.addError(i,s,n)}h.validator.removeError(i);for(var o=i.split("."),a=0;a<o.length;a++)a==o.length-1?h.on.writeToModel(i,e)||(r[o[a]]=e):r=r[o[a]];h.validator.on.validate.call(h.validator,h.model)}},h.on={},h.on.writeToModel=function(){},c.length>0&&setTimeout(r(e),10),p},n.types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),requireSimulator.setName("Wiki"),define(["HttpHelper","Arrow","Util","WebSite","Log","UI","FS"],function(t,e,n,r,i,s,o){return Wiki=function(n,a,u){function f(t){function e(t){t.stopPropagation(),t.preventDefault()}function n(t){if(u.editMode){var e=t.originalEvent,n=e.dataTransfer.files[0];if(!n.type.match(/image\/(png|gif|jpg)/)[1])return t.stopPropagation(),t.preventDefault(),!1;var r=new FileReader;return r.onload=function(){var t=r.result;a.text(t),i.empty().append(s("img",{src:t}))},r.readAsDataURL(n),t.stopPropagation(),t.preventDefault(),!1}}var i,a;if(l.builtinImages[t])return $("<div>").append($("<img>").attr("src",r.top+"/doc/images/"+t));i=s("div",{style:"margin:10px; padding:10px; border:solid black 1px;",on:{dragover:e,dragenter:e,drop:n}},"ここに画像ファイル(png/gif/jpg)をドラッグ＆ドロップして追加");var f=o.get(r.tonyuHome);return a=f.rel("doc/images/").rel(t),a.exists()&&i.empty().append(s("img",{src:a.text()})),i}function c(t,e,n){function r(){for(var o=[];;){var a=t.indexOf(e,s),u=t.indexOf(n,s);if(u>=0&&(0>a||a>u)){o.push(t.substring(s,u)),s=u;break}if(0>a){o.push(t.substring(s)),s=t.length;break}o.push(t.substring(s,a)),s=a+e.length;var f=r();f.hasBrace=!0,s<t.length&&(s+=n.length),o.push(f)}return i(o),o}function i(t){return t.split=function(t,e){if(1==e)return this;var n=[],r=i([]);return this.forEach(function(s){if("string"==typeof s){var o=s.indexOf(t);if(n.length>=e&&(o=-1),o>=0){if(o>0){var a=s.substring(0,o);r.push(a)}if(o+=t.length,n.push(1!=r.length?r:r[0]),r=i([]),o<s.length){var a=s.substring(o);r.push(a)}}else r.push(s)}else r.push(s)}),n.push(1!=r.length?r:r[0]),n},t.text=function(t){var r=this.hasBrace&&t?e:"";return this.forEach(function(t){r+="string"==typeof t?t:t.text(!0)}),r+=this.hasBrace&&t?n:""},t.toString=function(){return this.text(!0)},t}var s=0;return r(0)}var l={},h={figures:"図",plists:"リスト"},p="line_marker_",d={},g=[],m=".txt";if(u||(u={}),a&&!a.isDir())throw a+": not a dir";var v,y;l.on=d,l.cd=function(t){v=t,y=v.rel("toc.json")},a&&l.cd(a),l.encodeURL=function(t){return encodeURI(t).replace(/%/g,"")},l.parse=function(n,i,s){function o(t){g[t]={};var e=1,n=function(n,r){var i=g[t][n];return i||(i={refs:[]},g[t][n]=i),r&&(i.no=e++,i.name=h[t]+i.no,i.refs.forEach(function(t){t.text(i.name)})),i};return n}function a(t){function e(t){for(null==t&&(t=0);g.ul>t;)g.ul--,m.exit()}m.lineNo=g.lineNo;var n=0;if(t.match(/^-+/)&&(n=RegExp.lastMatch.length),n>g.ul)for(;n>g.ul;)g.ul++,m.enter("<ul>");else e(n);if(t=t.substring(n),n>0&&m.enter("<li>"),t.match(/^\*+/)){var r=RegExp.rightContext,i="h"+RegExp.lastMatch.length;m.enter("<"+i+">"),d(r),m.exit()}else if(t.match(/^$/))e(),m.p($("<p>"));else if(t.match(/^<<toc(.*)/))g.toc=[g.name],g.blocks.push({name:"toc",exit:function(){y&&!y.isReadOnly()&&y.obj(g.toc),g.toc=null}});else if(t.match(/^<<code(.*)/)){var s=RegExp.$1;if(s=s.replace(/^ */,""),s.length>0){var o,a,u=s.split(/ /,2);if(2==u.length){a=u[0],o=u[1];var f=x(o,!0);m.p($("<div>").addClass("plist").text(f.name+" "+a))}else m.p($("<div>").addClass("plist").text(u))}m.enter("<pre>"),g.blocks.push({name:"code",exit:function(){m.exit()}})}else if(t.match(/^>>/)){var c=g.blocks.pop();c&&c.exit&&c.exit(g)}else if(t.match(/^@@@@(.*)/)){if(g.pclose)m.exit();else{if(RegExp.$1.length>0){var f=x(RegExp.$1,!0);m.p($("<div>").addClass("plist").text(f.name))}m.enter("<pre>")}g.pclose=!g.pclose}else d(t),m.p("\n");n>0&&m.exit(),g.lineNo++}function d(t){function n(t){var n,i=t.text();if(i.match(/^@blink ([^>]+)>([^\s]+)/)){caption=RegExp.$1;var o=RegExp.$2;n=$("<span>").addClass("clickable").text(caption).hover(function(){var t;parent&&parent.Arrow&&(t=parent.Arrow),e&&(t=e),t&&t.show(o)})}else if(i.match(/^@plistref (.*)/)){var a=RegExp.$1,c=x(a);n=$("<strong>").text(c.name),c.refs.push(n)}else if(i.match(/^@editadd/))m.p($("<img>").attr("src",r.top+"/images/editAdd.png"));else if(i.match(/^@figref (.*)/)){var c=v(RegExp.$1);n=$("<strong>").text(c.name),c.refs.push(n)}else if(i.match(/^@cfrag (.*)/)){var p=RegExp.$1;n=$("<code>"),m.enter(n),d(p),m.exit()}else if(i.match(/^@arg (.*)/)){var y=RegExp.$1;n=$("<i>"),m.enter(n),d(y),m.exit()}else{var b=t.split(">",2);if(2==b.length?(i=b[1]+"",caption=b[0]):caption=i,g.toc&&g.toc.push(i),i.match(/\.(png|jpg|gif)$/)&&!i.match(/^http/)){var c=v(i,!0);n=$("<div>").addClass("figure").append(f(i)),m.enter(n),m.enter($("<div>")),m.p(h.figures+c.no+"."),d(caption),m.exit(),m.exit()}else if(i.match(/^https?:\/\//))n=$("<a>").attr({href:i,target:"ext"}).text(caption);else{var S=l.resolveFile(i);if(S.exists()||!S.isReadOnly()&&u.editMode){if(u.useAnchor){var w=S.relPath(s.up()).replace(/\.txt$/,".html");w=l.encodeURL(w),n=$("<a>").attr({href:w}).text(caption)}else n=$("<span>").addClass("clickable").text(caption).click(function(){l.show(S)});S.exists()||n.addClass("notexist")}else n=$("<span>").text(caption)}}m.p(n)}var i="string"==typeof t?c(t,g.beginMark,g.endMark):t;i.forEach(function(t){"string"==typeof t?m.p(t):n(t)})}var g={},m=t({lineMark:p});g.out=m,g.name=i,g.lines=n.split(/\r?\n/),g.lineNo=0,g.ul=0,g.beginMark="[[",g.endMark="]]",g.blocks=[];var v=o("figures"),x=o("plists"),b=[];y&&y.exists()&&(b=y.obj());var S=b.indexOf(i);if(S>=0){var w="",A=b[S-1];A&&(w+="[[前へ>"+A+"]]");var T=b[S+1];T&&(w+=" - [[次へ>"+T+"]]");var D=b[0];0!=S&&(w+=" - [[目次>"+D+"]]"),g.lines.unshift(w),g.lines.push(w)}return g.lines.forEach(a),m.buf},l.resolveFile=function(t){var e;return e=t.isDir?t:v&&"/"!=t.substring(0,1)?v.rel(t+m):o.get(t)},l.show=function(t){var e=l.resolveFile(t);u.editMode||i.d("wiki","show "+e),l.cd(e.up());var r=e.truncExt(m);if(!e.exists()&&!e.isReadOnly()&&u.editMode){var s=g[g.length-1];e.text(s?"[["+s.truncExt(m)+"]]\n":"")}if(e.exists()){var o=l.parse(e.text(),r,e);n.empty(),n.scrollTop(0),n.append(o),n.append($("<div>").css({height:"100px"}).text("")),d.show&&d.show.apply(l,[e,r]),g.push(e)}else alert(t+" というページはありません")},l.back=function(){var t=g.pop();t&&show(t)};var x;return l.highlightLine=function(t){var e=$("#"+p+"-"+t);if(0!=e.length){x&&x.removeClass("wiki-cur-line"),x=e.next(),x.addClass("wiki-cur-line");var r=e.position().top,i=n;0>r&&i.scrollTop(i.scrollTop()+(r-10)/2);var s=i.height()-100;r>s&&i.scrollTop(i.scrollTop()+(r-s+10)/2)}},l.builtinImages={"50_100.png":1,"50_160.png":1,"50_300.png":1,"apple1apple2.png":1,"coords.png":1,"copy60_100.png":1,"firstRunRes.png":1,"firstVarRes.png":1,"itadaki.png":1,"noWaitCat.png":1,"runtimeError.png":1,"sample.png":1,"sayonara.png":1,"syntaxError.png":1},l}}),requireSimulator.setName("Shell2"),define(["Shell","UI","FS","Util"],function(t,e,n,r){var i={};return i.show=function(t){var e=i.embed(t);e.dialog({width:600,height:500})},i.embed=function(){i.d||(i.d=e("div",{title:"Shell"},["div",{$var:"inner"},"Type 'help' to show commands.",["br"]]),i.inner=i.d.$vars.inner,t.prompt());var n=i.d;return n},t.cls=function(){i.d.$vars.inner.empty()},t.prompt=function(){function n(t){return 9==t.which?(t.stopPropagation(),t.preventDefault(),o(),!1):void(13==t.which&&(c.empty(),s(u.val())))}function s(){var n=u.val().replace(/^ */,"").replace(/ *$/,"");if(0!=n.length){var r=n.split(/ +/),i=r.shift(),s=t[i];if("function"!=typeof s)return f.append(i+": command not found.");try{var o=[],a=null;r.forEach(function(t){var e=/^-([A-Za-z_0-9]+)(=(.*))?/.exec(t);e?(a||(a={}),a[e[1]]=null!=e[3]?e[3]:1):o.push(t)}),a&&o.push(a);var c=s.apply(t,o);if(c===t.ASYNC)return;if("object"==typeof c)if(c instanceof Array){var l=e("table"),h=null,p=0;c.forEach(function(t){h||(h=e("tr").appendTo(l)),h.append(e("td",t)),p++,p%3==0&&(h=null)}),l.appendTo(f)}else f.append(JSON.stringify(c));else f.append(c);t.prompt()}catch(d){t.err(d),t.prompt()}}}function o(){var e=u.val(),n=e.split(" "),i=n.pop(),s=[];if(0==n.length)for(var o in t)"function"==typeof t[o]&&r.startsWith(o,i)&&s.push(o);else{var a=t.resolve(i,!1);if(!a)return;var f=a.isDir()?a:a.up();f.each(function(t){r.startsWith(t.path(),a.path())&&s.push(t.name())})}if(1==s.length){var l=i.split("/");l.pop(),l.push(s[0]),n.push(l.join("/")),u.val(n.join(" ")),c.empty()}else c.text(s.join(", "))}var a=e("div",["input",{$var:"cmd",size:40,on:{keydown:n}}],["pre",{$var:"out","class":"shell out"},["div",{$var:"cand","class":"shell cand"}]]),u=a.$vars.cmd,f=a.$vars.out,c=a.$vars.cand;return t.setout({log:function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);f.append(e("span",t.join(" ")+"\n"))},err:function(t){f.append(e("div",{"class":"shell error"},t,["br"],["pre",t.stack]))}}),a.appendTo(i.inner),u.focus(),i.inner.closest(".ui-dialog-content").scrollTop(i.inner.height()),t.ASYNC},t.window=function(){i.show(t.cwd)},t.atest=function(t,e,n){console.log(t,e,n)},i}),requireSimulator.setName("NewProjectDialog"),define(["UI"],function(t){var e={};return e.show=function(t,n,r){var i=e.embed(t,n,r);i.dialog({width:600})},e.embed=function(n,r,i){if(i||(i={}),!e.d){var s={fromVal:function(t){return""==t?null:FS.get(t)},toVal:function(t){return t?t.path():""}};e.d=t("div",{title:i.ren?"プロジェクト名の変更":"新規プロジェクト"},["div",["span","プロジェクト名"],["input",{$edit:"name",value:i.defName||"",on:{enterkey:function(){e.d.done()}}}]],["div",["span","親フォルダ"],["input",{$edit:{name:"parentDir",type:s}}]],["div",["span","作成先フォルダ："],["span",{$var:"dstDir"}]],["div",{$var:"validationMessage",css:{color:"red"}}],["button",{$var:"OKButton",on:{click:function(){e.d.done()}}},"OK"])}var o=e.d,a={name:i.defName||"",parentDir:n};return o.$edits.load(a),o.$edits.validator.on.validate=function(t){return""==t.name?void this.addError("name","名前を入力してください"):(t.dstDir=t.parentDir.rel(t.name+"/"),t.dstDir.exists()?void this.addError("name","このフォルダはすでに存在します"):(this.allOK(),void o.$vars.dstDir.text(t.dstDir+"")))},o.done=function(){o.$edits.validator.isValid()&&(r(a.dstDir),o.dialog&&o.dialog("close"))},o},e}),requireSimulator.setName("requestFragment"),define(["WebSite"],function(t){var e={};return e.ajax=function(e){function n(t){return e.redirectTo&&(t.redirectTo=e.redirectTo),t}function r(){$.ajax({type:"post",url:t.serverTop+"/runFragments",data:n({id:a}),success:function(t){return"string"==typeof t&&t.match(/^notCompleted:([\-\d]+)\/([\-\d]+)$/)?(console.log("notcomp",t),c*=2,void setTimeout(r,c)):void e.success(t)},error:e.error,complete:e.complete})}var i=e.THRESH||8e5,s=e.data;if("object"!=typeof s)throw"Data should be object: "+s;if(s=JSON.stringify(s),!e.redirectTo&&("GAE"!=t.serverType||s.length<i))return $.ajax(e);for(var o=[],a=Math.random();s.length>0;)o.push(s.substring(0,i)),s=s.substring(i);var u=o.length,f=0,c=1e3;o.forEach(function(i,s){$.ajax({type:"post",url:t.serverTop+"/sendFragment",data:n({id:a,seq:s,len:u,content:i}),success:function(t){console.log("sendFrag",t,s),f++,f>=u&&setTimeout(r,c)},error:e.error})})},e}),requireSimulator.setName("Sync"),define(["FS","Shell","requestFragment","WebSite"],function(t,e,n,r){function i(t){return t&&t.isDir}var s={};return e.sync=function(){function t(t){return function(){t&&t.apply({},arguments),e.prompt()}}var n,r,o,a=function(){},u=0;return("string"==typeof arguments[u]||i(arguments[u]))&&(n=e.resolve(arguments[u],!0),u++,("string"==typeof arguments[u]||i(arguments[u]))&&(r=e.resolve(arguments[u],!1),u++)),"object"==typeof arguments[u]&&(o=arguments[u],u++),"function"==typeof arguments[u]&&(a=arguments[u],u++),n||(r=n=e.cwd),o&&o.onend&&(o.onend=t(o.onend)),r||(r=n),e.echo("sync args=",n,r,o,a),s.sync(n,r,o,t(a)),e.ASYNC},s.sync=function(){function t(t,n){e.echo("Status: "+t+" param:",n),p.onstatus&&p.onstatus(t,n)}function s(){p.onerror&&p.onerror.apply(this,arguments)}function o(){var e={base:h.path(),excludes:JSON.stringify(p.excludes)};t("getDirInfo",e),$.ajax({type:"get",url:r.serverTop+"/getDirInfo",data:e,success:a,error:s})}function a(n){p.v&&e.echo("getDirInfo",n);var i=l,o=n.data;for(var a in o){var f=i.rel(a),d=f.exists({includeTrashed:!0})&&f.metaInfo(),g=o[a];c(f,a,d,g)}l.recursive(function(t){var e=t.exists({includeTrashed:!0})&&t.metaInfo(),n=t.relPath(l),r=o[n];c(t,n,e,r)},{includeTrashed:!0,excludes:p.excludes}),p.v&&(e.echo("uploads:",m),e.echo("downloads:",v));var y={base:h.path(),paths:JSON.stringify(v)};t("File2LSSync",y),$.ajax({type:"post",url:r.serverTop+"/File2LSSync",data:y,success:u,error:s})}function u(i){e.echo("dlData=",i),p.v&&e.echo("dlData:",i);var o=l;if(!p.test){for(var a in i.data){var u=o.rel(a),c=i.data[a];c.trashed?u.exists()&&u.rm():u.text(c.text),delete c.text,u.metaInfo(c)}var d={base:h.path(),data:JSON.stringify(m)};d.pathInfo="/LS2FileSync",t("LS2FileSync",d),n.ajax({type:"post",url:r.serverTop+"/LS2FileSync",data:d,success:f,error:s})}}function f(t){p.v&&e.echo("LS2FileSync res=",t);var n=[];for(var r in m)n.push(r);t={msg:t,uploads:n,downloads:v},"function"==typeof d&&d(t)}function c(t,n,r,i){if(!y[n])if(y[n]=1,i&&(!r||r.lastUpdate<i.lastUpdate))v.push(n),p.v&&e.echo((r?"":"New")+"Download "+t+" trash="+!!i.trashed);else if(r&&(!i||r.lastUpdate>i.lastUpdate)){var s=r.trashed?{}:{text:t.text()},o=t.metaInfo();for(var a in o)s[a]=o[a];m[n]=s,p.v&&e.echo((i?"":"New")+"Upload "+t+" trash="+!!r.trashed)}}var l,h,p,d,g=0;if(i(arguments[g])&&(l=arguments[g],g++,i(arguments[g])&&(h=arguments[g],g++)),"object"==typeof arguments[g]&&(p=arguments[g],g++),"function"==typeof arguments[g]&&(d=arguments[g],g++),!l)throw"Sync.sync: Local dir must be specified as file object";h||(h=l),p||(p={}),!d&&p.onend&&(d=p.onend),p.test&&(p.v=1),o();var m={},v=[],y={}},e.rsh=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return $.ajax({url:r.serverTop+"/rsh",data:{args:JSON.stringify(t)},success:function(t){e.echo(t)},error:function(t,n,r){e.err(r)},complete:function(){e.prompt()}}),e.ASYNC},s}),requireSimulator.setName("Auth"),define(["WebSite"],function(t){var e={};return e.currentUser=function(e){$.ajax({type:"get",url:t.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(t){console.log("auth.currentUser",t),t=JSON.parse(t);var n=t.user;"null"==n&&(n=null),console.log("user",n,"csrfToken",t.csrfToken),e(n,t.csrfToken)}})},e.assertLogin=function(n){e.currentUser(function(e,r){return e?n.success(e,r):(window.onLoggedIn=n.success,void n.showLoginLink(t.serverTop+"/login"))})},window.Auth=e,e}),requireSimulator.setName("zip"),define(["FS","Shell","Util"],function(t,e,n){if("undefined"==typeof JSZip)return{};var r={};r.zip=function(t){function e(t,n){n.each(function(n){if(n.isDir()){var r=t.folder(n.name());e(r,n)}else n.isText()?t.file(n.name(),n.text()):t.file(n.name(),n.getBytes({binType:ArrayBuffer}))})}var n=new JSZip;e(n,t);var r=n.generate({type:"blob"});return r},"undefined"!=typeof saveAs&&(r.dlzip=function(t){var e=r.zip(t);saveAs(e,t.name().replace(/\/$/,"")+".zip")},e.dlzip=function(t){t=e.resolve(t||"."),r.dlzip(t)});var i={".png":"image/png",".jpg":"image/jpg",".gif":"image/gif",".jpeg":"image/jpg",".mp3":"audio/mp3",".ogg":"audio/ogg"};return r.unzip=function(t,e){var r=new JSZip(t);for(var s in r.files){var o=r.files[s],a=e.rel(o.name);for(var u in i){var f;if(a.endsWith(u)){var c=i[u];f="data:"+c+";base64,"+n.Base64_From_ArrayBuffer(o.asArrayBuffer())}else f=o.asText();a.text(f)}console.log(o.name)}},r}),requireSimulator.setName("ide/selProject"),requirejs(["FS","Wiki","Shell","Shell2","NewProjectDialog","UI","Sync","Auth","zip","requestFragment","WebSite"],function(t,e,n,r,i,s,o,a,u,f,c){$(function(){function e(){$("#prjItemList").empty();var t=[];u.each(function(e){if(e.isDir()){var n=e.lastUpdate(),r=e.rel("options.json");r.exists()&&(n=r.lastUpdate()),t.push([e,n])}}),t=t.sort(function(t,e){return e[1]-t[1]}),t.forEach(function(t){var e=t[0],n=e.name();if(e.isDir()){var r=s("div",{"class":"project"},["a",{href:"project.html?dir="+e.path()},["img",{$var:"t",src:"../../images/nowprint.png"}],["div",n]]);r.appendTo("#prjItemList"),setTimeout(function(){var t=e.rel("images/").rel("icon_thumbnail.png");t.exists()&&r.$vars.t.attr("src",t.getURL())},10)}})}var r=t.get(c.tonyuHome),o=r.rel("Projects/");o.exists()||o.mkdir(),n.cd(o);var u=o;c.isNW&&$("#loginGrp").hide(),a.currentUser(function(t){t?($(".while-logged-out").hide(),$("#login").text(t)):$(".while-logged-in").hide()});var f=$("<iframe>").attr("src",c.top+"/doc/index.html");f.height($(window).height()-$("#navBar").height()),$("#wikiViewArea").append(f),$("#newPrj").click(function(){i.show(o,function(t){t.mkdir(),document.location.href="project.html?dir="+t.path()})}),e(),SplashScreen.hide(),$("body").on("keydown",function(t){77==t.keyCode&&c.devMode&&(c.mobile=!c.mobile,console.log("Mobile mode",c.mobile),c.mobile?r.rel("mobile.txt").text("true"):r.rel("mobile.txt").rm())}),n.wikiEditor=function(){document.location.href="wikiEditor.html"}})}),requireSimulator.setName();