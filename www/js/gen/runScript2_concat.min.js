!function(){var t={};return t.def=function(e,n,i){var r=t.getModuleInfo(t.curName);r.type=i,t.setReqs(r,e),r.func=function(){return n.apply(this,t.getObjs(e))},t.loadIfAvailable(r)},define=function(e,n){t.def(e,n,"define")},requirejs=function(e,n){t.def(e,n,"require")},t.setReqs=function(e,n){n.forEach(function(n){var i=t.getModuleInfo(n);i.loaded||(e.reqs[n]=i,i.revReqs[e.name]=e)})},t.getModuleInfo=function(e){var n=t.modules;return n[e]||(n[e]={name:e,reqs:{},revReqs:{}}),n[e]},t.doLoad=function(e){var n=t.getModuleInfo(e);if(n.loaded)return n.obj;n.loaded=!0;var i=null;if(n.func)i=n.func();else{var r=e.split(/\./);i=function(){return this}(),r.forEach(function(t){i&&(i=i[t])}),null==i&&console.log("Warning: No obj for "+e)}if("define"==n.type&&null==i)throw"No obj for "+e;n.obj=i;for(var o in n.revReqs)t.notifyLoaded(n.revReqs[o],n.name);return i},t.notifyLoaded=function(e,n){delete e.reqs[n],t.loadIfAvailable(e)},t.loadIfAvailable=function(e){for(var n in e.reqs)return;t.doLoad(e.name)},t.getObjs=function(e){var n=[];return e.forEach(function(e){var i=t.doLoad(e);n.push(i)}),n},t.modules={},t.setName=function(e){t.curName&&(t.getModuleInfo(t.curName).func||t.doLoad(t.curName)),e&&(t.curName=e)},requireSimulator=t,t}(),requireSimulator.setName("extend"),define([],function(){return function(t,e){for(var n in e)t[n]=e[n]}}),requireSimulator.setName("assert"),define([],function(){function t(e){if(e instanceof Array){var n=[];return e.forEach(function(e){n=n.concat(t(e))}),n}return[e]}var e=function(e){this.failMesg=t(e||"Assertion failed: ")};e.prototype={fail:function(){var e=$a(arguments);throw e=t(e),e=this.failMesg.concat(e),console.log.apply(console,e),new Error(e.join(" "))},subAssertion:function(){var n=$a(arguments);return n=t(n),new e(this.failMesg.concat(n))},assert:function(t,e){return t||this.fail(e),t},eq:function(t,e){return t!==e&&this.fail(t,"!==",e),t},isset:function(t,e){return null==t&&this.fail((e||"")+" is null/undef"),t},is:function(t,e){var n=e,i=t;if(null==n)return n;if(n._assert_func)return n._assert_func.apply(this,[i]),t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){t&&"number"==typeof t.length||this.fail(t,"should be array:");for(var r=this,o=0;o<n.length;o++){var a=r.subAssertion("failed at ",t,"[",o,"]: ");a.is(i[o],n[o])}return t}if(n===String||"string"==n)return this.assert("string"==typeof i,[i,"should be a string "]),t;if(n===Number||"number"==n)return this.assert("number"==typeof i,[i,"should be a number"]),t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(i,String),this.assert(n.exec(i),[i,"does not match to",n]),t;if("function"==typeof n)return this.assert(i instanceof n,[i,"should be ",n]),t;if(n&&"object"==typeof n){for(var s in n){var a=this.subAssertion("failed at ",t,".",s,":");a.is(t[s],n[s])}return t}this.fail("Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&i(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)}},$a=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var n=new e,i=function(){try{return n.assert.apply(n,arguments)}catch(t){throw new Error(t.message)}};return i.is=function(){try{return n.is.apply(n,arguments)}catch(t){throw new Error(t.message)}},i.isset=function(){try{return n.isset.apply(n,arguments)}catch(t){throw new Error(t.message)}},i.eq=function(){try{return n.eq.apply(n,arguments)}catch(t){throw new Error(t.message)}},i.ensureError=function(){try{return n.ensureError.apply(n,arguments)}catch(t){throw new Error(t.message)}},i.fail=n.fail.bind(n),i.f=function(t){return{_assert_func:t}},i.and=function(){var t=$a(arguments);return i(t instanceof Array),i.f(function(e){for(var n=this,i=0;i<t.length;i++)n.is(e,t[i])})},i}),requireSimulator.setName("PathUtil"),define(["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}function n(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n}var i,r=/^([a-zA-Z]):/,o=/^([a-z]+):\/\/([^\/]+)\//,a=t.f(function(t){this.is(t,String),this.assert(i.isPath(t),[t," is not a path"])}),s=t.f(function(t){this.is(t,String),this.assert(i.isAbsolutePath(t),[t," is not a absolute path"])}),u=t.f(function(t){this.is(t,String),this.assert(!i.isAbsolutePath(t),[t," is not a relative path"])}),l=t.and(f,s),f=t.f(function(t){this.is(t,a),this.assert(i.isDir(t),[t," is not a directory path"])}),c=t.f(function(t){this.is(t,a),this.assert(!i.isDir(t),[t," is not a file path"])}),h="/";return i={Path:a,Absolute:s,Relative:u,Dir:f,File:c,AbsDir:l,SEP:h,endsWith:e,startsWith:n,hasDriveLetter:function(t){return r.exec(t)},isURL:function(t){var e=o.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:h+t.substring(e[0].length)}},isPath:function(){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),i.isPath(e)&&!i.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),i.isPath(e)&&(i.startsWith(e,h)||i.hasDriveLetter(e)||i.isURL(e))},isDir:function(n){return t.is(arguments,[a]),e(n,h)},splitPath:function(e){t.is(arguments,[a]);var n;if(n=this.isURL(e)){var i=this.splitPath(n.path);return i[0]=n.protocol+"://"+n.hostPort,i}e=e.replace(/\/+/g,h);var r=e.split(h);return""==r[r.length-1]&&(r[r.length-2]+=h,r.pop()),r},name:function(e){return t.is(arguments,[String]),i.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var n=i.name(e),r=/\.[a-zA-Z0-9]+$/.exec(n);return r?r[0]:null},truncExt:function(e,n){t.is(e,String);var r=i.name(e);return n=n||i.ext(e),t.is(n,String),r.substring(0,r.length-n.length)},truncSEP:function(e){return t.is(arguments,[a]),i.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(n,r){return t.is(arguments,[String,String]),e(i.name(n),r)},parent:function(e){return t.is(arguments,[String]),i.up(e)},rel:function(e,n){if(""==n)return e;t.is(arguments,[l,u]);var r=i.splitPath(n),o=e;o=o.replace(/\/$/,"");var a=i;return r.forEach(function(t){".."==t||"../"==t?o=a.up(o):(o=o.replace(/\/$/,""),o+=h+("."==t||"./"==t?"":t))}),o},relPath:function(e,n){return t.is(arguments,[l,l]),e.substring(0,n.length)!=n?"../"+i.relPath(e,this.up(n)):e.substring(n.length)},up:function(e){if(t.is(arguments,[a]),e==h)return null;var n=i.splitPath(e);return n.pop(),n.join(h)+h}}}),requireSimulator.setName("MIMETypes"),define([],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".mp3":"audio/mp3",".ogg":"audio/ogg",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu"}}),requireSimulator.setName("Util"),Util=function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=i.exec(window.location.href);return null==r?n:e(r[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function i(t,e){return t.substring(0,e.length)===e}function r(t){function e(e){throw console.log(e),console.log(t,l),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var i,r=t.length,o=0,a=0;if(!r)return new ArrayBuffer(0);i=Math.floor(r/4*3),"="==t.charAt(r-1)&&(i-=1),"="==t.charAt(r-2)&&(i-=1);for(var s=new ArrayBuffer(i),u=new Uint8Array(s),l=0,f=0;i>f&&(a=n[t.charCodeAt(l)],void 0===a&&e("Invalid letter: "+t.charCodeAt(l)),o=a<<2,l++,a=n[t.charCodeAt(l)],void 0===a&&e("Invalid letter: "+t.charCodeAt(l)),u[f]=o|a>>4&3,o=(15&a)<<4,l++,f++,!(f>=i))&&(a=n[t.charCodeAt(l)],void 0===a&&e("Invalid letter: "+t.charCodeAt(l)),u[f]=o|a>>2&15,o=(3&a)<<6,l++,f++,!(f>=i));)a=n[t.charCodeAt(l)],void 0===a&&e("Invalid letter: "+t.charCodeAt(l)),u[f]=o|a,l++,f++;return s}function o(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",i=new Uint8Array(t),r=i.length,o=0,a=0,s=0;r>s&&(a=i[s],n+=e[a>>2],o=(3&a)<<4,s++,!(s>=r))&&(a=i[s],n+=e[o|a>>4],o=(15&a)<<2,s++,!(s>=r));)a=i[s],n+=e[o|a>>6],n+=e[63&a],s++;var u=r%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n}function a(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var i=t[n];n.match(/^_/)||"function"==typeof i&&(e[n]=function(){var e=i.apply(t,arguments);return e})}(n);return e}function s(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(i){throw console.log(e.join("")),i}}function u(t){for(var e=encodeURIComponent(t),n=/^%(..)/,i=[],r=0;r<e.length;r++){var o=n.exec(e.substring(r));o?(i.push(parseInt("0x"+o[1])),r+=o[0].length-1):i.push(e.charCodeAt(r))}return new Uint8Array(i)}return{getQueryString:t,endsWith:n,startsWith:i,Base64_To_ArrayBuffer:r,Base64_From_ArrayBuffer:o,utf8bytes2str:s,str2utf8bytes:u,privatize:a}}(),requireSimulator.setName("SFile"),define(["extend","assert","PathUtil","Util"],function(t,e,n,i){var r=function(t,i){e.is(i,n.Absolute),e(t&&t.getReturnTypes),this._path=i,this.fs=t,this.isDir()&&!n.isDir(i)&&(this._path+=n.SEP)};return r.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},r.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},_clone:function(){return this._resolve(this.path())},_resolve:function(t,o){var a;if(o=o||{},r.is(t))a=t;else{e.is(t,n.Absolute);var s,u=o.policy||this.policy;if(u&&(s=u.topDir)&&(s.path&&(s=s.path()),!n.startsWith(t,s)))throw new Error(t+": cannot access. Restricted to "+s);a=this.fs.getRootFS().get(t),a.policy=u}return a.policy?i.privatize(a):a},contains:function(t){return e(r.is(t),t+" shoud be a SFile object."),this.isDir()?n.startsWith(t.path(),this.path()):!1},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var i=t.path?t.path():t;return n.relPath(this.path(),e.is(i,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var i=this.path();return this._resolve(n.rel(i,t))},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){this.fs.touch(this.path())},isReadOnly:function(){this.fs.isReadOnly(this.path())},isTrashed:function(){var t=this.metaInfo();return t?t.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.fs.getMetaInfo(this.path(),t)},setMetaInfo:function(t,e){return this.fs.setMetaInfo(this.path(),t,e)},lastUpdate:function(){return e(this.exists()),this.metaInfo().lastUpdate},exists:function(t){t=t||{};var e=this.fs.exists(this.path(),t);return e||t.noFollowLink?e:this._resolveLinkNoPolicy().exists({noFollowLink:!0})},rm:function(t){if(t=t||{},!this.exists({noFollowLink:!0})){var e=this._resolveLinkNoPolicy();if(!this.equals(e))return e.rm(t)}this.isDir()&&(t.recursive||t.r)&&this.each(function(e){e.rm(t)});var n=this.path();this.fs.rm(n,t)},removeWithoutTrash:function(t){t=t||{},t.noTrash=!0,this.rm(t)},isDir:function(){return this.fs.isDir(this.path())},text:function(){var t=this._resolveLinkNoPolicy();return this.equals(t)?arguments.length>0?void this.setText(arguments[0]):this.getText():t.text.apply(t,arguments)},setText:function(t){e.is(t,String),this.fs.setContent(this.path(),t)},getText:function(){return this.fs.getContent(this.path(),{type:String})},isText:function(){return this.fs.isText(this.path())},setBytes:function(t){return e.is(t,ArrayBuffer),this.fs.setContent(this.path(),t)},getBytes:function(){return this.fs.getContent(this.path(),{type:ArrayBuffer})},getURL:function(){return this.fs.getURL(this.path())},lines:function(){return this.text().split("\n")},obj:function(){var t=this;if(0==arguments.length){var n=t.text();return n?JSON.parse(n):null}t.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,i){var r=this,i=i||{},o=r.isDir(),a=t.isDir();if(!o&&a&&(t=t.rel(r.name()),e(!t.isDir(),t+" is a directory."),a=!1),o&&!a)this.err("Cannot move dir to file");else{if(!o&&!a)return i.echo&&i.echo(r+" -> "+t),this.fs.cp(e.is(r.path(),n.Absolute),t.path(),i);e(o&&a),r.each(function(e){t.rel(e.name()).copyFrom(e,i)})}},moveFrom:function(t,e){var n=this.copyFrom(t,e);return t.rm({recursive:!0}),n},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){var n=this.assertDir();n.listFiles(e).forEach(t)},recursive:function(t,e){var n=this.assertDir();n.each(function(e){e.isDir()?e.recursive(t):t(e)},e)},listFiles:function(t){e(null==t||"object"==typeof t);var n=this.assertDir(),i=this._resolveLinkNoPolicy();if(!this.equals(i))return i.listFiles.apply(i,arguments).map(function(t){return n.rel(t.name())});var r,o=this.path();"function"==typeof t&&(r=t),t=n.convertOptions(t),r||(r=t.order);for(var a=this.fs.opendir(o,t),s=[],u=0;u<a.length;u++){var l=a[u];t.excludes[o+l]||s.push(n.rel(l))}return"function"==typeof r&&s.sort&&s.sort(r),s},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir(),i=n.listFiles(t);return i.map(function(t){return t.name()})},convertOptions:function(t){var i=(this.assertDir(),this.path());if(t||(t={}),t.excludes||(t.excludes={}),t.excludes instanceof Array){var r={};t.excludes.forEach(function(t){n.startsWith(t,"/")?r[t]=1:r[i+t]=1}),t.excludes=r}return e.is(t,{excludes:{}})},mkdir:function(){this.touch()},link:function(t,n){t=this._resolve(e(t)),this.fs.link(this.path(),t.path(),n)},_resolveLinkOpt:function(t){var i=this.fs.resolveLink(this.path());return e.is(i,n.Absolute),this._resolve(i,t)},_resolveLinkNoPolicy:function(){return this._resolveLinkOpt({policy:{}})},resolveLink:function(){return this._resolveLinkOpt()},isLink:function(){return this.fs.isLink(this.path())}},r}),requireSimulator.setName("FS2"),define(["extend","PathUtil","MIMETypes","assert","SFile"],function(t,e,n,i,r){function o(t){throw new Error(t+" is STUB!")}var a=function(){},s={};return a.addFSType=function(t,e){s[t]=e},t(a.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(t){i.is(arguments,[e.AbsDir]);var n=this.fstab();console.log(n);for(var r=0;r<n.length;r++)if(console.log(n[r].path,t),n[r].path==t)return n.splice(r,1),!0;return!1},resolveFS:function(t){i.is(t,e.Absolute);var n;return this.fstab().forEach(function(i){n||e.startsWith(t,i.path)&&(n=i.fs)}),n||(n=this),i.is(n,a)},isReadOnly:function(){o("isReadOnly")},mounted:function(t,n){i.is(arguments,[a,e.AbsDir]),this.parentFS=t,this.mountPoint=n},relFromMountPoint:function(t){return i.is(t,e.Absolute),this.parentFS?(i.is(this.mountPoint,e.AbsDir),e.relPath(t,this.mountPoint)):e.relPath(t,e.SEP)},dirFromFstab:function(t,n){i.is(t,e.AbsDir);var r=(n||{}).res||[];return this.fstab().forEach(function(n){e.up(n.path)==t&&r.push(e.name(n.path))}),r},getRootFS:function(){for(var t,e=this;e;e=e.parentFS)t=e;return i.is(t,a)},getReturnTypes:function(){o("")},getContent:function(){o("")},setContent:function(){o("")},getMetaInfo:function(){o("")},setMetaInfo:function(){o("")},mkdir:function(){o("mkdir")},touch:function(){o("touch")},exists:function(){o("exists")},opendir:function(){o("opendir")},cp:function(t,n,r){i.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),r=r||{};var o=this.isDir(t),a=this.resolveFS(n).isDir(n);if(o||a)throw new Error("only file to file supports");var s=this.getContent(t),u=this.resolveFS(n).setContent(n,s);return r.a&&this.setMetaInfo(n,this.getMetaInfo(t)),u},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(){o("")},link:function(){throw new Error("This FS not support link.")},getURL:function(){o("")}}),a.delegateMethods=function(t,n){for(var r in n)!function(r){t[r]=function(){var t=arguments[0];i.is(t,e.Absolute);var o=this.resolveFS(t);return o!==this?o[r].apply(o,arguments):n[r].apply(this,arguments)}}(r)},a.delegateMethods(a.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},mount:function(t,n,r){if(i.is(arguments,[e.AbsDir]),"string"==typeof n){var o=i(s[n],"fstype "+n+" is undefined.");n=o(t,r||{})}if(i.is(n,a),this.exists(t))throw new Error(t+": Directory exists");var u=e.up(t);if(null==u)throw new Error("Cannot mount on root");if(!this.exists(u))throw new Error(t+": Parent Directory not exist");n.mounted(this,t),this.fstab().unshift({path:t,fs:n})},getContentType:function(t,i){var r=e.ext(t);return n[r]||(i||{}).def||"text/plain"},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t){return e.isDir(t)},find:function(t,n){i.is(arguments,[e.Absolute]);var r=this.opendir(t,n),o=this,a=[t];return r.forEach(function(i){var r=e.rel(t,i);if(e.isDir(r)){var s=o.resolveFS(r);a=a.concat(s.find(r,n))}else a.push(r)}),a},resolveLink:function(t){i.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){i(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var r=this.isLink(n);if(r){i(r!=n,"l==p=="+r);var o=e.rel(r,e.relPath(t,n));return i(o!=t,"np==path=="+o),i.is(this.getRootFS().resolveFS(o).resolveLink(o),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(){return null},get:function(t){return i.eq(this.resolveFS(t),this),new r(this,t)}}),a}),requireSimulator.setName("WebSite"),define([],function(){var t,e=document.location.href,n=!!e.match(/html\/dev\//)&&!!e.match(/localhost:3/);t=e.match(/jsrun\.it/)?{urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:n,pluginTop:"http://tonyuedit.appspot.com/js/plugins",removeJSOutput:!0}:e.match(/tonyuexe\.appspot\.com/)||e.match(/localhost:8887/)||e.match(/\/html\/((dev)|(build))\//)?{urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:n}:{urlAliases:{},top:".",devMode:n};var i=window.navigator.userAgent.toLowerCase();return t.tablet=-1!=i.indexOf("windows")&&-1!=i.indexOf("touch")||-1!=i.indexOf("ipad")||-1!=i.indexOf("android")&&-1==i.indexOf("mobile")||-1!=i.indexOf("firefox")&&-1!=i.indexOf("tablet")||-1!=i.indexOf("kindle")||-1!=i.indexOf("silk")||-1!=i.indexOf("playbook"),t.mobile=-1!=i.indexOf("windows")&&-1!=i.indexOf("phone")||-1!=i.indexOf("iphone")||-1!=i.indexOf("ipod")||-1!=i.indexOf("android")&&-1!=i.indexOf("mobile")||-1!=i.indexOf("firefox")&&-1!=i.indexOf("mobile")||-1!=i.indexOf("blackberry"),t.pluginTop||(t.pluginTop=t.top+"/js/plugins"),t.disableROM={},e.match(/tonyuedit\.appspot\.com/)||e.match(/localhost:8888/),(e.match(/\.appspot\.com/)||e.match(/localhost:888[87]/))&&(t.serverType="GAE"),e.match(/localhost:3000/)&&(t.serverType="Node"),t.serverTop=e.match(/tonyuexe\.appspot\.com/)||e.match(/localhost:8887/)?t.top+"/exe":t.top+"/edit",t.sampleImg=t.top+"/images",t.blobPath=t.serverTop+"/serveBlob",t.isNW="object"==typeof process&&process.__node_webkit,t.mp3Disabled=t.isNW,t.tonyuHome="/Tonyu/",t.url={getDirInfo:t.serverTop+"/getDirInfo",getFiles:t.serverTop+"/File2LSSync",putFiles:t.serverTop+"/LS2FileSync"},t.isNW&&(t.cwd=process.cwd().replace(/\\/g,"/").replace(/\/?$/,"/"),t.tonyuHome=process.env.TONYU_HOME?process.env.TONYU_HOME.replace(/\\/g,"/").replace(/\/?$/,"/"):t.cwd+"fs/Tonyu/",t.logdir="/var/log/Tonyu/",t.wwwDir=t.cwd+"www/",t.kernelDir=t.wwwDir+"Kernel/",t.platform=process.platform,t.ffmpeg=t.cwd+("win32"==t.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg")),t.compiledKernel=e.match(/tonyuedit\.appspot\.com/)||e.match(/localhost:888/)||t.isNW?t.top+"/Kernel/js/concat.js":"http://tonyuexe.appspot.com/Kernel/js/concat.js",window.WebSite=t}),requireSimulator.setName("DataURL"),define(["extend","assert"],function(t,e){function n(t){return t instanceof ArrayBuffer||"undefined"!=typeof Buffer&&t instanceof Buffer}function i(t){function e(e){throw console.log(e),console.log(t,f),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var i,r=t.length,a=0,s=0;if(!r)return new o(0);i=Math.floor(r/4*3),"="==t.charAt(r-1)&&(i-=1),"="==t.charAt(r-2)&&(i-=1);for(var u=new o(i),l="undefined"!=typeof Buffer?u:new Uint8Array(u),f=0,c=0;i>c&&(s=n[t.charCodeAt(f)],void 0===s&&e("Invalid letter: "+t.charCodeAt(f)),a=s<<2,f++,s=n[t.charCodeAt(f)],void 0===s&&e("Invalid letter: "+t.charCodeAt(f)),l[c]=a|s>>4&3,a=(15&s)<<4,f++,c++,!(c>=i))&&(s=n[t.charCodeAt(f)],void 0===s&&e("Invalid letter: "+t.charCodeAt(f)),l[c]=a|s>>2&15,a=(3&s)<<6,f++,c++,!(c>=i));)s=n[t.charCodeAt(f)],void 0===s&&e("Invalid letter: "+t.charCodeAt(f)),l[c]=a|s,f++,c++;return u}function r(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",i=new Uint8Array(t),r=i.length,o=0,a=0,s=0;r>s&&(a=i[s],n+=e[a>>2],o=(3&a)<<4,s++,!(s>=r))&&(a=i[s],n+=e[o|a>>4],o=(15&a)<<2,s++,!(s>=r));)a=i[s],n+=e[o|a>>6],n+=e[63&a],s++;var u=r%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n}var o="undefined"!=typeof Buffer?Buffer:ArrayBuffer,a=function(t,i){"string"==typeof t?(this.url=t,this.dataURL2bin(t)):t&&n(t.buffer)?(this.buffer=t.buffer,e.is(i,String),this.contentType=i,this.bin2dataURL(this.buffer,this.contentType)):n(t)?(this.buffer=t,e.is(i,String),this.contentType=i,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),e.fail("Invalid args: ",arguments))};return a.isBuffer=n,t(a.prototype,{bin2dataURL:function(t,i){e(n(t)),e.is(i,String);var o=this.dataHeader(i),a=r(t);return e.is(a,String),this.url=o+a},dataURL2bin:function(t){e.is(arguments,[String]);var n=/^data:([^;]+);base64,/i,r=n.exec(t);return e(r,["malformed dataURL:",t]),this.contentType=r[1],this.buffer=i(t.substring(r[0].length)),e.is(this.buffer,o)},dataHeader:function(t){return e.is(arguments,[String]),"data:"+t+";base64,"},toString:function(){return e.is(this.url,String)}}),a}),requireSimulator.setName("NativeFS"),define(["FS2","assert","PathUtil","extend","MIMETypes","DataURL"],function(t,e,n,i,r,o){var a="object"==typeof process&&process.__node_webkit;if(!a)return function(){throw new Error("This system not suppert native FS")};var s=e,u=require("fs"),l=function(t){t&&(e.is(t,n.AbsDir),this.rootPoint=t)};l.available=!0;var f=n.SEP,c=l.prototype=new t;return c.toNativePath=function(t){return this.rootPoint?(e.is(t,n.Absolute),n.rel(this.rootPoint,this.relFromMountPoint(t))):t},c.arrayBuffer2Buffer=function(t){return t instanceof ArrayBuffer?new Buffer(new Uint8Array(t)):t},t.addFSType("NativeFS",function(t,e){return new l(e.r)}),l.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},t.delegateMethods(l.prototype,{getReturnTypes:function(){return s.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,i){i=i||{},e.is(t,n.Absolute);var r=this.toNativePath(t),a=i.type;if(this.assertExist(t),this.isText(t))return a===String?e.isset(u.readFileSync(r,{encoding:"utf8"}),t):e.isset(u.readFileSync(r),t);if(a===String){var s=u.readFileSync(r),l=new o(s,this.getContentType(t));return e.isset(l.url,t)}return e.isset(u.readFileSync(r),t)},setContent:function(t,i){i=this.arrayBuffer2Buffer(i),e.is(t,n.Absolute);var r=n.up(t);r&&this.getRootFS().mkdir(r);var a=this.toNativePath(t),s="string"==typeof i;if(!this.isText(t)){if(s){var l=new o(i);return u.writeFileSync(a,l.buffer)}return u.writeFileSync(a,i)}u.writeFileSync(a,i)},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(){},isReadOnly:function(){return!1},stat:function(t){e.is(t,n.Absolute);var i=this.toNativePath(t);return u.statSync(i)},mkdir:function(t){if(s.is(arguments,[n.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var e=n.up(t);e&&this.getRootFS().mkdir(e);var i=this.toNativePath(t);return u.mkdirSync(i)},opendir:function(t){s.is(arguments,[String]);var e=this.toNativePath(t),i=n.truncSEP(e),r=u.readdirSync(e).map(function(t){var e=u.statSync(i+f+t),n=e.isDirectory()?f:"";return t+n}),o=this.dirFromFstab(t);return s.is(o.concat(r),Array)},rm:function(t,e){s.is(arguments,[n.Absolute]),e=e||{},this.assertExist(t);var i=this.toNativePath(t);return this.isDir(t)?u.rmdirSync(i):u.unlinkSync(i)},exists:function(t){var e=this.toNativePath(t);return u.existsSync(e)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():n.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&!this.isDir(t)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")}}),l}),requireSimulator.setName("Content"),define(["DataURL","Util","assert"],function(t,e,n){function i(t){return t instanceof ArrayBuffer||"undefined"!=typeof Buffer&&t instanceof Buffer}var r=function(){};r.plainText=function(t,e){var n=new r;return n.contentType=e||"text/plain",n.plain=t,n},r.url=function(t){var e=new r;return e.url=t,e},r.bin=function(t,e){n(e,"contentType should be set");var o=new r;if(t&&i(t.buffer))o.bin=t.buffer;else if(i(t))o.bin=t;else{if(!(t instanceof Array))throw new Error(t+" is not a buffer");o.bin=new Uint8Array(t).buffer}return o.contentType=e,o};var o=r.prototype;return o.toUint8Array=function(){return new Uint8Array(this.toArrayBuffer())},o.toArrayBuffer=function(){if(this.bin)return this.bin;if(this.url){var n=new t(this.url);return this.bin=n.buffer}if(null!=this.plain)return this.bin=e.str2utf8bytes(this.plain).buffer;throw new Error("No data")},o.toURL=function(){if(this.url)return this.url;if(this.bin||null==this.plain||(this.bin=e.str2utf8bytes(this.plain)),this.bin){var n=new t(this.bin,this.contentType);return this.url=n.url}throw new Error("No data")},o.toPlainText=function(){if(null!=this.plain)return this.plain;if(this.url&&!this.bin){var n=new t(this.url);this.bin=n.buffer}if(this.bin)return this.plain=e.utf8bytes2str(new Uint8Array(this.bin));throw new Error("No data")},o.hasURL=function(){return this.url},o.hasPlainText=function(){return null!=this.plain},o.hasBin=function(){return this.bin},r}),requireSimulator.setName("LSFS"),define(["FS2","PathUtil","extend","assert","Util","Content"],function(t,e,n,i,r,o){function a(){return(new Date).getTime()}var s=function(t,e){this.storage=t,this.options=e||{}},u=e.isDir.bind(e),l=e.up.bind(e),f=e.endsWith.bind(e),c=(e.Path,e.Absolute),h=e.SEP;return s.ramDisk=function(){var t={};return t[e.SEP]="{}",new s(t)},t.addFSType("localStorage",function(){return new s(localStorage)}),t.addFSType("ramDisk",function(){return s.ramDisk()}),s.now=a,s.prototype=new t,s.prototype.resolveKey=function(t){return i.is(t,e.Absolute),e.SEP+this.relFromMountPoint(t)},s.prototype.getItem=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},s.prototype.setItem=function(t,n){i.is(t,e.Absolute);var r=this.resolveKey(t);i(r.indexOf("..")<0),i(e.startsWith(r,e.SEP)),this.storage[r]=n},s.prototype.removeItem=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},s.prototype.itemExists=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);return n in this.storage},s.prototype.inMyFS=function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},s.prototype.getDirInfo=function(t){if(i.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");f(t,h)||(t+=h),i(this.inMyFS(t));var n={};try{var r=this.getItem(t);r&&(n=JSON.parse(r))}catch(o){console.log("dinfo err : ",t,r)}return n},s.prototype.putDirInfo=function(t,n,r){if(i.is(arguments,[e.AbsDir,Object]),!u(t))throw new Error("Not a directory : "+t);i(this.inMyFS(t)),this.setItem(t,JSON.stringify(n));var o=l(t);if(null!=o){if(!this.inMyFS(o))return i(this.getRootFS()!==this),void this.getRootFS().touch(o);var a=this.getDirInfo(o);this._touch(a,o,e.name(t),r)}},s.prototype._touch=function(t,e,n,r){i.is(arguments,[Object,String,String]),i(this.inMyFS(e)),t[n]||(t[n]={},r&&(t[n].trashed=!0)),r||delete t[n].trashed,t[n].lastUpdate=a(),this.putDirInfo(e,t,r)
},s.prototype.removeEntry=function(t,e,n){i.is(arguments,[Object,String,String]),t[n]&&(t[n]={lastUpdate:a(),trashed:!0},this.putDirInfo(e,t,!0))},s.prototype.removeEntryWithoutTrash=function(t,e,n){i.is(arguments,[Object,String,String]),t[n]&&(delete t[n],this.putDirInfo(e,t,!0))},s.prototype.isRAM=function(){return this.storage!==localStorage},s.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},t.delegateMethods(s.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(){return i.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t,e){i.is(arguments,[c]),this.assertExist(t);var n;return n=this.isText(t)?o.plainText(this.getItem(t)):o.url(this.getItem(t)),e&&e.type==ArrayBuffer?i.isset(n.toArrayBuffer(),t):i.isset(n.toPlainText(),t)},setContent:function(t,e){i.is(t,c),this.assertWriteable(t);var n;n="string"==typeof e?o.plainText(e):o.bin(e,this.getContentType(t)),this.isText(t)?this.setItem(t,n.toPlainText()):this.setItem(t,n.toURL()),this.touch(t)},getMetaInfo:function(t){if(this.assertExist(t,{includeTrashed:!0}),i.is(arguments,[c]),t==e.SEP)return{};var n=i(e.up(t));if(!this.inMyFS(n))return{};var r=e.name(t);i.is(n,e.AbsDir);var o=this.getDirInfo(n);return i(o[r])},setMetaInfo:function(t,n){i.is(arguments,[String,Object]),this.assertWriteable(t);var r=i(e.up(t));if(this.inMyFS(r)){var o=this.getDirInfo(r),a=e.name(t);o[a]=n,this.putDirInfo(r,o,o[a].trashed)}},mkdir:function(t){i.is(arguments,[c]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){i.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),r=this.dirFromFstab(t);for(var o in n)i(n[o]),(!n[o].trashed||e.includeTrashed)&&r.push(o);return i.is(r,Array)},rm:function(t,n){i.is(arguments,[c]),n=n||{},this.assertWriteable(t);var r=e.up(t);if(null==r||!this.inMyFS(r))throw new Error(t+": cannot remove. It is root of this FS.");if(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t)){var o=this.opendir(t);o.length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)}else this.removeItem(t);var a=this.getDirInfo(r);n.noTrash?this.removeEntryWithoutTrash(a,r,e.name(t)):this.removeEntry(a,r,e.name(t))},exists:function(t,n){i.is(arguments,[c]),n=n||{};var r=e.name(t),o=e.up(t);if(null==o||!this.inMyFS(o))return!0;var a=this.getDirInfo(o),s=a[r];return s&&s.trashed&&this.itemExists(t)&&(this.isDir(t)||i.fail("Inconsistent "+t+": trashed, but remains in storage")),!s&&this.itemExists(t)&&i.fail("Inconsistent "+t+": not exists in metadata, but remains in storage"),!s||s.trashed||s.link||this.itemExists(t)||i.fail("Inconsistent "+t+": exists in metadata, but not in storage"),s&&!n.includeTrashed&&(s=!s.trashed),!!s},link:function(t,n){i.is(arguments,[e.AbsDir,e.AbsDir]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var r={};r.link=n,r.lastUpdate=a(),this.setMetaInfo(t,r),console.log(this.storage),i(this.exists(t)),i(this.isLink(t))},isLink:function(t){if(i.is(arguments,[e.AbsDir]),!this.exists(t))return null;var n=i(this.getMetaInfo(t));return n.link},touch:function(t){i.is(arguments,[c]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?this.setItem(t,"{}"):this.setItem(t,""));var n=l(t);if(null!=n)if(this.inMyFS(n)){var r=this.getDirInfo(n);this._touch(r,n,e.name(t),!1)}else i(this.getRootFS()!==this),this.getRootFS().touch(n)},getURL:function(t){return o.bin(this.getContent(t,{type:ArrayBuffer}),this.getContentType(t)).toURL()}}),s}),requireSimulator.setName("Env"),define(["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n}),requireSimulator.setName("FS"),define(["FS2","WebSite","NativeFS","LSFS","PathUtil","Env","assert","SFile"],function(t,e,n,i,r,o,a,s){var t={};"object"==typeof window&&(window.FS=t);var u,l=new o(e);return u=e.isNW?new n:new i(localStorage),t.getRootFS=function(){return u},t.get=function(){return u.get.apply(u,arguments)},t.expandPath=function(){return l.expandPath.apply(l,arguments)},t.resolve=function(e,n){return s.is(e)?e:(e=l.expandPath(e),n&&!r.isAbsolutePath(e)?(n=l.expandPath(n),t.get(n).rel(e)):t.get(e))},t.mount=function(){return u.mount.apply(u,arguments)},t.unmount=function(){return u.unmount.apply(u,arguments)},t}),requireSimulator.setName("plugins"),define(["WebSite"],function(t){function e(t){return"function"==typeof t&&(t={onload:t}),t||(t={}),t.onload||(t.onload=function(){}),t}var n={},i={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/BodyActor/,symbol:"Box2D"},timbre:{src:"timbre.js",detection:/\bplay(SE)?\b/,symbol:"T"}};return n.installed=i,n.detectNeeded=function(t,e){for(var n in i){var r=i[n].detection.exec(t);r&&(e[n]=1)}return e},n.loaded=function(t){var e=i[t];if(!e)throw new Error("plugin not found: "+t);return window[e.symbol]},n.loadAll=function(t,r){function o(){u>=a.length?r.onload():n.load(a[u++],o)}r=e(r);var a=[];for(var s in t)i[s]&&!n.loaded(s)&&a.push(s);var u=0;console.log("loading plugins",a),o()},n.load=function(n,r){var o=i[n];if(!o)throw new Error("plugin not found: "+n);r=e(r);var a=t.pluginTop+"/"+o.src;location.href.match(/^file:/)?($("<script>").attr("src",a).appendTo("body"),setTimeout(r.onload,500)):$.getScript(a,r.onload)},n.request=function(t){if(!n.loaded(t)){var e=new Error("Plugin "+t+" required");e.pluginName=t}},n}),requireSimulator.setName("DeferredUtil"),define([],function(){var t;return t={directPromise:function(t){var e=new $.Deferred;return setTimeout(function(){e.resolve(t)},0),e.promise()},throwPromise:function(t){return d=new $.Deferred,setTimeout(function(){d.reject(t)},0),d.promise()},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(n){return console.log(n.stack),t.throwPromise(n)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(i){return i>=e.length?t.brk():$.when(n(e[i])).then(function(){return i+1})},0);var i=[];for(var r in e)i.push({k:r,v:e[r]});return t.each(i,function(t){n(t.k,t.v)})},loop:function(e,n){t.directPromise(n).then(t.throwF(function(){var n=e.apply(this,arguments);return n.DU_BRK?n.res:$.when(n).then(function(n){return t.loop(e,n)})}))},brk:function(t){return{DU_BRK:!0,res:t}}}}),requireSimulator.setName("compiledProject"),define(["DeferredUtil"],function(t){var e=function(e,n){return{getNamespace:function(){return e},sourceDir:function(){return null},getDependingProjects:function(){return[]},loadDependingClasses:function(e){var n=t.directPromise(),i=this.getNamespace();return this.getDependingProjects().forEach(function(t){t.getNamespace()!=i&&(n=n.then(function(){return t.loadClasses(e)}))}),n},loadClasses:function(t){console.log("Load compiled classes ns=",e,"url=",n);var i=new $.Deferred,r=document.getElementsByTagName("head")[0]||document.documentElement,o=document.createElement("script");o.src=n;var a=!1;return o.onload=o.onreadystatechange=function(){a||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(a=!0,o.onload=o.onreadystatechange=null,r&&o.parentNode&&r.removeChild(o),console.log("Done Load compiled classes ns=",e,"url=",n,Tonyu.classes),i.resolve())},this.loadDependingClasses(t).then(function(){r.insertBefore(o,r.firstChild)}),i.promise()}}};return e}),requireSimulator.setName("compiledTonyuProject"),define(["plugins","compiledProject"],function(t,e){var n=function(n,i,r){var o=e(n,i),a=e("kernel",WebSite.compiledKernel),s={getDir:function(){return r},getDependingProjects:function(){return[a]},getOptions:function(){var t=this.getDir().rel("options.json");return t.obj()},getResource:function(){var t=this.getDir().rel("res.json");return t.obj()},loadPlugins:function(e){var n=this.getOptions();return t.loadAll(n.plugins,e)},requestPlugin:function(){},run:function(t){var e={classes:Tonyu.classMetas};this.loadClasses(e).then(function(){Tonyu.run(t)})}};for(var u in s)o[u]=s[u];return o};return n}),requireSimulator.setName("Shell"),define(["FS","Util","WebSite","PathUtil","assert"],function(t,e,n,i){function r(t,e){var n=o(t);if(e&&!n.exists())throw n+": no such file or directory";return n}function o(e){if("string"!=typeof e)return e;if(i.isAbsolutePath(e))return t.get(e);var n=a.cwd;return n.rel(e)}var a={cwd:t.get("/")};return a.cd=function(t){return a.cwd=r(t,!0),a.pwd()},a.mount=function(e,n){return n&&n.t?void t.mount(e,n.t,n):void sh.err("-t=[fstype] should be specified.")},a.unmount=function(e){t.unmount(e)},a.fstab=function(){var e=t.getRootFS(),n=e.fstab(),i=this;i.echo(e.fstype()+"	<Root>"),n.forEach(function(t){i.echo(t.fs.fstype()+"	"+t.path)})},a.resolve=r,a.pwd=function(){return a.cwd+""},a.ls=function(t){return t=t?r(t,!0):a.cwd,t.ls()},a.cp=function(t,e,n){n||(n={}),n.v&&(a.echo("cp",t,e),n.echo=a.echo.bind(a));var i=r(t,!0),o=r(e);return i.copyTo(o,n)},a.rm=function(t,e){if(e||(e={}),e.notrash)return t=r(t,!1),t.removeWithoutTrash(),1;if(t=r(t,!0),t.isDir()&&e.r){var n=t,i=0;return n.each(function(t){t.exists()&&(i+=a.rm(t,e))}),n.rm(),i+1}return t.rm(),1},a.cat=function(t){t=r(t,!0),a.echo(t.text())},a.resolve=function(t){return t||(t="."),t=r(t)},a.grep=function(t,e,n){function i(t,e,i){n.res&&n.res.push({file:t,lineNo:e,line:i}),a.echo(t+"("+e+"): "+i)}return e=r(e,!0),n||(n={}),n.res||(n.res=[]),e.isDir()?e.each(function(e){a.grep(t,e,n)}):"string"==typeof t&&e.lines().forEach(function(n,r){n.indexOf(t)>=0&&i(e,r+1,n)}),n.res},a.touch=function(t){return t=r(t),t.text(t.exists()?t.text():""),1},a.setout=function(t){a.outUI=t},a.echo=function(){console.log.apply(console,arguments),a.outUI&&a.outUI.log&&a.outUI.log.apply(a.outUI,arguments)},a.err=function(){console.log.apply(console,arguments),a.outUI&&a.outUI.err&&a.outUI.err.apply(a.outUI,arguments)},a.prompt=function(){},a.ASYNC={r:"SH_ASYNC"},a.help=function(){for(var t in a){var e=a[t];"function"==typeof e&&a.echo(t+(e.description?" - "+e.description:""))}},sh=a,n.isNW&&(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()}),a}),requireSimulator.setName("Tonyu"),"function"!=typeof define&&(define=require("requirejs").define),define(["assert"],function(t){return Tonyu=function(){function e(){function t(){return null!=T&&w}function e(){return S}function n(){A=!0,x=0}function i(t){T={prev:T,func:t}}function r(t,e,n){n||(n=[]);var r;"string"==typeof e&&(r=t["fiber$"+e]),"function"==typeof e&&(r=e.fiber),n=[b].concat(n);var o=0;i(function(){switch(o){case 0:r.apply(t,n),o=1;break;case 1:l(),o=2}})}function o(){if(T)try{T.func(b)}catch(t){s(t)}}function s(t){if(0==b.tryStack.length)return v(),void a(t);b.lastEx=t;for(var e=b.tryStack.pop();T;){if(e.frame===T){b.catchPC=e.catchPC;break}T=T.prev}}function u(){var t=b.lastEx;return b.lastEx=null,t}function l(t){T=T?T.prev:null,b.retVal=t}function f(t){b.tryStack.push({frame:T,catchPC:t})}function c(){b.tryStack.pop()}function h(t,e){if(n(),t.on){var i;e=e.concat(function(){b.lastEvent=arguments,b.retVal=arguments[0],i.remove(),g()}),i=t.on.apply(t,e)}}function p(t){var e=function(){b.retVal=arguments,g()},i=function(){for(var t="",e=0;e<arguments.length;e++)t+=arguments[e]+",";0==t.length&&(t="Async fail");var n=new Error(t);n.args=arguments,s(n),g()};t(e,i),n()}function d(e){S=!0,n(),e&&(e.addTerminatedListener?e.addTerminatedListener(function(){if(S=!1,b.group)b.group.notifyResume();else if(t())try{b.steps()}catch(e){a(e)}}):e.then&&e.fail&&(e.then(function(t){b.retVal=t,g()}),e.fail(function(t){if(t instanceof Error)s(t);else{var e=new Error(t);e.original=t,s(e)}g()})))}function m(t){b.group=t,t&&t.add(b)}function g(){var e=Tonyu.currentThread;for(Tonyu.currentThread=b,x=M,b.preempted=!1,A=!1;x-->0&&T;)o();b.preempted=!A&&t(),Tonyu.currentThread=e}function v(){w=!1,T=null}function y(){T=null,tryStack=[]}var b={enter:i,apply:r,exit:l,steps:g,step:o,isAlive:t,isWaiting:e,suspend:n,retVal:0,tryStack:[],kill:v,waitFor:d,setGroup:m,enterTry:f,exitTry:c,startCatch:u,waitEvent:h,runAsync:p,clearFrame:y},T=null,w=!0,x=0,S=!1,A=!1;return b}function n(t){var e={},n=[];return e.addTerminatedListener=function(t){n.push(t)},setTimeout(function(){n.forEach(function(t){t()})},t),e}function i(){var t={},e=[];return t.addTerminatedListener=function(t){e.push(t)},requestAnimationFrame(function(){e.forEach(function(t){t()})}),t}function r(){var t=[],e=[],n=!1;return t.addTerminatedListener=function(t){n?setTimeout(t,0):e.push(t)},t.receiver=function(){n=!0;for(var e=0;e<arguments.length;e++)t[e]=arguments[e];t.notify()},t.notify=function(){e.forEach(function(t){t()})},t}function o(){function t(t){t.group=u,h?h.push(t):l.push(t)}function n(n,i,r){i||(i="main");var o=e();return o.apply(n,i,r),t(o),o}function i(){try{r()}catch(t){a(t)}}function r(){function t(t){t.isWaiting()||(c=!1,t.steps())}for(var e=l.length-1;e>=0;e--){var n=l[e];n.isAlive()&&n.group===u||l.splice(e,1)}for(c=!0,h=[],l.forEach(t);h.length>0;)w=h,h=[],w.forEach(function(e){l.push(e),t(e)});h=null}function o(){f=!1}function s(){}var u,l=[],f=!0,c=!1,h=null;return u={add:t,addObj:n,steps:i,kill:o,notifyResume:s,threads:l}}function a(t){if(!Tonyu.onRuntimeError)throw alert("エラー! at "+$LASTPOS+" メッセージ  : "+t),t;Tonyu.onRuntimeError(t)}function s(t){if(t===Function)return null;if("function"==typeof t)t.constructor=null;else if("object"==typeof t)for(var e in t)t[e]=s(t[e]);return t}function u(e,n){return t.is(arguments,[String,Object]),f(klass.getMeta(e),n)}function l(t,e){return t?f(new t,e):e}function f(t,e){if(e&&"object"==typeof e)for(var n in e)t[n]=e[n];return t}function c(t,e){A[t]=e}function h(t){return A[t]}function p(t){var e=t.split("."),n=P;if(e.forEach(function(t){n&&(n=n[t])}),!n&&1==e.length){var i;for(var r in P){var o=P[r][t];if(o){if(n)throw new Error("曖昧なクラス名： "+r+"."+t+", "+i);n=o,i=r+"."+t}}}return n}function d(t,e){var n=function(){return e.apply(t,arguments)};return n.methodInfo=Tonyu.extend({thiz:t},e.methodInfo||{}),e.fiber&&(n.fiber=function(){return e.fiber.apply(t,arguments)},n.fiber.methodInfo=Tonyu.extend({thiz:t},e.fiber.methodInfo||{})),n}function m(t,e,n,i){if(!t)throw new Error(i+"(="+t+")のメソッド "+e+"を呼び出せません");var r=t[e];if("function"!=typeof r)throw new Error(("this"==i?"":i+".")+e+"(="+r+")はメソッドではありません");return r.apply(t,n)}function g(t,e,n){if("function"!=typeof t)throw new Error(n+"は関数ではありません");return t.apply({},e)}function v(t,e){if(t!=t||null==t)throw new Error(e+"(="+t+")は初期化されていません");return t}function y(t){for(var e=[],n=1;n<t.length;n++)e[n-1]=t[n];return e}function b(t){throw new Error("クラス名"+t+"はnewをつけて呼び出して下さい。")}function T(t){throw console.log("Not a tonyu object: ",t),new Error(t+" is not a tonyu object")}function x(t,e){return t in e}function S(t){var n=p(t);if(!n)throw new Error(t+" というクラスはありません");Tonyu.runMode=!0;var i=new n,r=e();r.apply(i,"main");var o;(o=Tonyu.currentProject)&&(o.runningThread=r,o.runningObj=i),$LASTPOS=0,r.steps()}var M=60;klass=function(){throw alert("この関数は古くなりました。コンパイルをやり直してください。 Deprecated. compile again."),new Error("この関数は古くなりました。コンパイルをやり直してください。 Deprecated. compile again.")},klass.addMeta=u,klass.getMeta=function(t){if("function"==typeof t)return t.meta;if("string"==typeof t){var e=L[t];return e||(L[t]=e={}),e}},klass.ensureNamespace=function(t,e){var n,i=e.split("."),r=t;for(n=0;n<i.length;n++){var o=i[n];r[o]||(r[o]={}),r=r[o]}return r},klass.define=function(t){var e=t.superclass,n=t.includes,i=t.fullName,r=t.shortName,o=t.namespace,a=t.methods,f=t.decls,c=klass.ensureNamespace(Tonyu.classes,o),h=s(a),p=h.initialize;delete h.initialize;var d;d=p?e?function(){this instanceof d||b(i),Tonyu.runMode?p.apply(this,arguments):e.apply(this,arguments)}:function(){this instanceof d||b(i),Tonyu.runMode&&p.apply(this,arguments)}:e?function(){this instanceof d||b(i),e.apply(this,arguments)}:function(){this instanceof d||b(i)},c[r]=d,d.methods=h,n.forEach(function(t){if(!t.methods)throw t+" Does not have methods";for(var e in t.methods)e in h||(h[e]=t.methods[e])});var m={},g=/^__([gs]et)ter__(.*)$/;for(var v in h)if(!v.match(/^fiber\$/)){h["fiber$"+v]&&(h[v].fiber=h["fiber$"+v],h[v].fiber.methodInfo={name:v,klass:d,fiber:!0}),h[v].methodInfo={name:v,klass:d};var y=g.exec(v);y&&(m[y[2]]=m[y[2]]||{},m[y[2]][y[1]]=h[v])}d.prototype=l(e,h),d.prototype.isTonyuObject=!0;for(var v in m)Object.defineProperty(d.prototype,v,m[v]);d.meta=u(i,{fullName:i,shortName:r,namepsace:o,decls:f,superclass:e?e.meta:null,func:d,includes:n.map(function(t){return t.meta})});var T=klass.getMeta(d);return d.prototype.getClassInfo=function(){return T},d};var A={},P={},L={};return Tonyu={thread:e,threadGroup:o,klass:klass,bless:l,extend:f,globals:A,classes:P,classMetas:L,setGlobal:c,getGlobal:h,getClass:p,timeout:n,animationFrame:i,asyncResult:r,bindFunc:d,not_a_tonyu_object:T,hasKey:x,invokeMethod:m,callFunc:g,checkNonNull:v,run:S,VERSION:1449122222857,A:y}}()}),requireSimulator.setName("PatternParser"),define(["Tonyu"],function(t){var e=function(t,e){this.options=e||{},this.img=t,this.height=t.height,this.width=t.width;var n=this.newImage(t.width,t.height),i=n.getContext("2d");i.drawImage(t,0,0),this.ctx=i,this.pixels=this.ctx.getImageData(0,0,t.width,t.height).data,this.base=this.getPixel(0,0)};return t.extend(e.prototype,{newImage:function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n},getPixel:function(t,e){var n=this.pixels,i=4*(t+e*this.width),r=n[0+i],o=n[1+i],a=n[2+i],s=n[3+i];return 256*(256*(256*s+a)+o)+r},setPixel:function(t,e,n){var i=4*(t+e*this.width);this.pixels[0+i]=255&n,n=(n-(255&n))/256,this.pixels[1+i]=255&n,n=(n-(255&n))/256,this.pixels[2+i]=255&n,n=(n-(255&n))/256,this.pixels[3+i]=255&n},parse:function(){try{for(var t=[],e=0;e<this.height;e++)for(var n=0;n<this.width;n++){var i=this.getPixel(n,e);i!=this.base&&t.push(this.parse1Pattern(n,e))}return t}catch(r){if(r.isParseError)return console.log("parse error! "+r),{image:this.img,x:0,y:0,width:this.width,height:this.height};throw r}},parse1Pattern:function(t,e){function n(t){return t}function i(t,e,n){return{toString:function(){return"at ("+t+","+e+") :"+n},isParseError:!0}}for(var r=this.getPixel(t,e),o=t,a=e,s=this.base,u=this.width,l=this.height;u>o;){var f=this.getPixel(o,a);if(f!=r)break;o++}if(o>=u||this.getPixel(o,a)!=s)throw i(o,a,n(this.getPixel(o,a))+"!="+n(s));for(o--;l>a&&this.getPixel(o,a)==r;)a++;if(a>=l||this.getPixel(o,a)!=s)throw i(o,a,n(this.getPixel(o,a))+"!="+n(s));a--;var c=t+1,h=e+1,p=o-c,d=a-h;if(console.log("PP",c,h,p,d,o,a),p*d==0)throw i(o,a,"w*h==0");for(var m=this.newImage(p,d),g=m.getContext("2d"),v=g.getImageData(0,0,p,d),y=v.data,b=0,T=h;a>T;T++)for(var w=c;o>w;w++){var x=this.getPixel(w,T);x==r?(y[b++]=0,y[b++]=0,y[b++]=0,y[b++]=0):(y[b++]=255&x,x=(x-(255&x))/256,y[b++]=255&x,x=(x-(255&x))/256,y[b++]=255&x,x=(x-(255&x))/256,y[b++]=255&x)}g.putImageData(v,0,0);for(var S=h-1;a>=S;S++)for(var M=c-1;o>=M;M++)this.setPixel(M,S,s);return this.options.boundsInSrc?{x:c,y:h,width:p,height:d}:{image:m,x:0,y:0,width:p,height:d}}}),e}),requireSimulator.setName("Assets"),define(["WebSite","Util","Tonyu"],function(t,e,n){var i={};return i.resolve=function(n,i){if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,n){return t[n]}),t.urlAliases[n]&&(n=t.urlAliases[n]),e.startsWith(n,"ls:")){var r=n.substring("ls:".length);if(!i)throw new Error("Basedir not specified");var o=i.rel(r);if(!o.exists())throw new Error("Resource file not found: "+o);if(t.mp3Disabled&&r.match(/\.mp3$/)){var a=i.rel(r.replace(/\.mp3$/,".ogg"));a.exists()&&(o=a)}n=o.getURL()}return n},n.Assets=i,i}),requireSimulator.setName("ImageList"),define(["PatternParser","Util","Assets"],function(t,e,n){function i(t){var e=[];return t.forEach(function(t){t&&""!=t.url&&e.push(t)}),e}var r,o={};return r=function(e,n,a){a||(a={}),e=i(e);var s=[],u=e.length;e.forEach(function(e,i){function l(){var r,o;if((r=e.pwidth)&&(o=e.pheight)){for(var a=0,l=0,f=this.width,c=this.height,h=[];;){var p=r,d=o;if(a+r>f&&(p=f-a),l+o>c&&(d=c-l),h.push({image:this,x:a,y:l,width:p,height:d}),a+=r,a+r>f&&(a=0,l+=o,l+o>c))break}s[i]=h}else{var m=new t(this);s[i]=m.parse()}if(s[i].name=e.name,u--,0==u){var g=[],v={};s.forEach(function(t){v[t.name]=g.length,g=g.concat(t)}),g.names=v,n(g)}}console.log("loading",e,i);var f=e.url,c=f;if(o[c])return void l.apply(o[c],[]);f=r.convURL(f,a.baseDir);var h=$("<img>");h.load(function(){o[c]=this,l.apply(this,[])}),h.attr("src",f)})},r.load=r,r.parse1=function(e,n,i){var r,o,a;if((r=e.pwidth)&&(o=e.pheight)){for(var s=0,u=0,l=n.width,f=n.height,c=[];;)if(c.push({image:this,x:s,y:u,width:r,height:o}),s+=r,s+r>l&&(s=0,u+=o,u+o>f))break;a=c}else{var h=new t(n,i);a=h.parse()}return a.name=e.name,a},r.convURL=function(t,e){return n.resolve(t,e)},window.ImageList=r,r}),requireSimulator.setName("T2MediaLib");var T2MediaLib_BGMPlayer=function(t){this.id=t,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1};T2MediaLib_BGMPlayer.prototype.playBGM=function(t,e,n,i,r){if(!T2MediaLib.context)return null;var o=this.playingBGM;return o instanceof AudioBufferSourceNode&&o.stop(0),this.playingBGM=T2MediaLib.playSE(t,this.bgmVolume,this.bgmTempo,n,e,i,r),this.playingBGMName=t,this.bgmPause=0,this.playingBGM},T2MediaLib_BGMPlayer.prototype.stopBGM=function(){var t=this.playingBGM;return t instanceof AudioBufferSourceNode?(t.stop(0),this.playingBGM=null,t):null},T2MediaLib_BGMPlayer.prototype.pauseBGM=function(){var t=this.playingBGM;return t instanceof AudioBufferSourceNode?(0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=t.loopStart,this.bgmPauseLoopEnd=t.loopEnd,this.bgmPauseLoop=t.loop,this.bgmPauseCurrentTime=t.context.currentTime,this.bgmPauseTempo=T2MediaLib.bgmTempo,t.stop(0),this.bgmPause=1),t):null},T2MediaLib_BGMPlayer.prototype.resumeBGM=function(){var t=this.playingBGM;return t instanceof AudioBufferSourceNode?(1===this.bgmPause&&(t=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd),this.bgmPause=0),t):null},T2MediaLib_BGMPlayer.prototype.setBGMVolume=function(t){var e=this.playingBGM;return e instanceof AudioBufferSourceNode?(this.bgmVolume=t,void T2MediaLib.setSEVolume(e,t)):null},T2MediaLib_BGMPlayer.prototype.setBGMTempo=function(t){var e=this.playingBGM;return e instanceof AudioBufferSourceNode?(0===this.bgmPause&&(e.plusTime-=(T2MediaLib.context.currentTime-e.playStartTime)*(t-this.bgmTempo)),this.bgmTempo=t,void T2MediaLib.setSERate(e,t)):null},T2MediaLib_BGMPlayer.prototype.getBGMCurrentTime=function(){var t=this.playingBGM;if(!(t instanceof AudioBufferSourceNode))return null;var e,n,i,r,o,a,s;return 0===this.bgmPause?(i=T2MediaLib.context.currentTime,r=this.bgmTempo):(i=this.bgmPauseCurrentTime,r=this.bgmPauseTempo),n=(i-t.playStartTime)*r+t.plusTime,t.loop&&(t.loopEnd-t.loopStart>0?n<t.loopStart?(o=0,a=0,s=t.buffer.duration):(o=t.loopStart,a=t.loopStart,s=t.loopEnd-t.loopStart):(s=t.buffer.duration,o=0,a=0)),t.loop?e=(n-a)%s+o:(e=n,e>t.buffer.duration&&(e=t.buffer.duration)),e},T2MediaLib_BGMPlayer.prototype.getBGMLength=function(){var t=this.playingBGM;return t instanceof AudioBufferSourceNode?t.buffer.duration:null};var T2MediaLib={context:null,seDataAry:{data:[]},bgmPlayerMax:16,bgmPlayerAry:[],playingBGM:null,playingBGMName:null,bgmPause:0,bgmPauseTime:0,bgmPauseCurrentTime:0,bgmPauseTempo:0,bgmPauseLoop:!1,bgmPauseLoopStart:0,bgmPauseLoopEnd:0,bgmVolume:1,bgmTempo:1,playingAudio:null,audioVolume:1,audioTempo:1,audioDataAry:{data:[]},init:function(){if(!this.inited&&(this.inited=!0,!this.disabled&&(window.AudioContext?T2MediaLib.context=new AudioContext:window.webkitAudioContext?T2MediaLib.context=new webkitAudioContext:(T2MediaLib.context=null,console.log("Your browser does not support yet Web Audio API")),T2MediaLib.context)))for(var t=0;t<T2MediaLib.bgmPlayerMax;t++)T2MediaLib.bgmPlayerAry[t]=new T2MediaLib_BGMPlayer(t)},allClearData:function(){var t=T2MediaLib.seDataAry.data;for(var e in t)delete t[e]},clearData:function(t){var e=T2MediaLib.seDataAry.data;delete e[t]},loadSEFromArray:function(t,e){for(var n=T2MediaLib.context,i=n.createBuffer(1,e.length,n.sampleRate),r=i.getChannelData(0),o=0;o<e.length;o++)r[o]=e[o];T2MediaLib.seDataAry.data[t]=i},loadSE:function(t,e,n){if(!T2MediaLib.context||T2MediaLib.disabled)return T2MediaLib.seDataAry.data[t]=-1,null;"object"==typeof WebSite&&WebSite.mp3Disabled&&(e=e.replace(/\.mp3$/,".ogg"));var i=new XMLHttpRequest;i.onload=function(){if(200===i.status||0===i.status){var r=i.response;if(r instanceof ArrayBuffer){var o=function(e){T2MediaLib.seDataAry.data[t]=e,n&&n.succ&&n.succ(t)},a=function(i){i instanceof Error?console.log("T2MediaLib: "+i.message,e):console.log("T2MediaLib: Error decodeAudioData()",e),T2MediaLib.seDataAry.data[t]=-4,n&&n.err&&n.err(t,T2MediaLib.seDataAry.data[t])};T2MediaLib.context.decodeAudioData(r,o,a)}else T2MediaLib.seDataAry.data[t]=-3,n&&n.err&&n.err(t,T2MediaLib.seDataAry.data[t])}else T2MediaLib.seDataAry.data[t]=-2,n&&n.err&&n.err(t,T2MediaLib.seDataAry.data[t])},i.onerror=function(e){n&&n.err&&n.err(t,e+"")},T2MediaLib.seDataAry.data[t]=null,e.match(/^data:/)&&Util&&Util.Base64_To_ArrayBuffer?(i={onload:i.onload},i.response=Util.Base64_To_ArrayBuffer(e.replace(/^data:audio\/[a-zA-Z0-9]+;base64,/i,"")),i.status=200,i.onload()):(i.open("GET",e,!0),i.responseType="arraybuffer",i.send(null))},activate:function(){if(this.init(),!this.isActivated){this.isActivated=!0;for(var t=T2MediaLib.context,e=t.createBuffer(1,Math.floor(t.sampleRate/32),t.sampleRate),n=e.getChannelData(0),i=Math.floor(t.sampleRate/860),r=0;r<n.length;r++)n[r]=(i/2>r%i?.1:-.1)*(i>r?2:1);var o=t.createBufferSource();o.buffer=e,o.connect(t.destination),o.noteOn?o.noteOn(0):o.start&&o.start(0)}},playSE:function(t,e,n,i,r,o,a){if(!T2MediaLib.context)return null;var s=T2MediaLib.seDataAry.data[t];if(!(s instanceof AudioBuffer))return null;null===e&&(e=1),n||(n=1),i?i>s.duration?i=s.duration:0>i&&(i=0):i=0,r||(r=!1),o?0>o?o=0:o>s.duration&&(o=s.duration):o=0,a?0>a?a=0:a>s.duration&&(a=s.duration):a=s.duration;var u=T2MediaLib.context.createBufferSource();T2MediaLib.context.createGain=T2MediaLib.context.createGain||T2MediaLib.context.createGainNode;var l=T2MediaLib.context.createGain();u.buffer=s,u.loop=r,u.loopStart=o,u.loopEnd=a,u.playbackRate.value=n,u.connect(l),l.connect(T2MediaLib.context.destination);var f;return f=r&&a-o>0&&i>a?a:i,u.gainNode=l,u.playStartTime=T2MediaLib.context.currentTime,u.playOffset=f,u.plusTime=f,u.start=u.start||u.noteOn,u.stop=u.stop||u.noteOff,l.gain.value=e*e,i?r?u.start(0,i,86400):u.start(0,i):u.start(0),u.onended=function(){delete u.gainNode,u.onended=null},u},stopSE:function(t){return t instanceof AudioBufferSourceNode?(t.stop(0),t):null},setSEVolume:function(t,e){return t instanceof AudioBufferSourceNode?void(t.gainNode.gain.value=e*e):null},setSERate:function(t,e){return t instanceof AudioBufferSourceNode?void(t.playbackRate.value=e):null},getSEData:function(t){return T2MediaLib.seDataAry.data[t]},loadBGM:function(t,e,n){return T2MediaLib.loadSE(t,e,n)},playBGM:function(t,e,n,i,r,o){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var a=T2MediaLib.bgmPlayerAry[t];return a instanceof T2MediaLib_BGMPlayer?a.playBGM(e,n,i,r,o):null},stopBGM:function(t){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var e=T2MediaLib.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e.stopBGM():null},pauseBGM:function(t){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var e=T2MediaLib.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e.pauseBGM():null},resumeBGM:function(t){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var e=T2MediaLib.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e.resumeBGM():null},setBGMVolume:function(t,e){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var n=T2MediaLib.bgmPlayerAry[t];return n instanceof T2MediaLib_BGMPlayer?n.setBGMVolume(e):null},setBGMTempo:function(t,e){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var n=T2MediaLib.bgmPlayerAry[t];return n instanceof T2MediaLib_BGMPlayer?n.setBGMTempo(e):null},getBGMCurrentTime:function(t){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var e=T2MediaLib.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e.getBGMCurrentTime():null},getBGMLength:function(t){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var e=T2MediaLib.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e.getBGMLength():null},getBGMData:function(t){return T2MediaLib.getSEData(t)},getBGMPlayerMax:function(){return T2MediaLib.bgmPlayerMax},allStopBGM:function(){for(var t=0;t<T2MediaLib.bgmPlayerMax;t++)T2MediaLib.stopBGM(t)},loadAudio:function(t,e){var n=new Audio(e);n.play(),T2MediaLib.audioDataAry.data[t]=null,n.addEventListener("loadstart",function(){if(!T2MediaLib.context)return null;var t=T2MediaLib.context.createMediaElementSource(n);t.connect(T2MediaLib.context.destination)},!1),n.addEventListener("canplay",function(){T2MediaLib.audioDataAry.data[t]=n},!1),n.load()},playAudio:function(t,e,n){var i=T2MediaLib.audioDataAry.data[t];return i?(n||(n=0),T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.pause(),T2MediaLib.playingAudio.currentTime=0),T2MediaLib.playingAudio=i,i.loop=e,i.volume=T2MediaLib.audioVolume,i.currentTime=n,i.play(),i):null},stopAudio:function(){var t=T2MediaLib.playingAudio;return t instanceof Audio?(t.pause(),t.currentTime=0,T2MediaLib.playingAudio=null,t):null},pauseAudio:function(){var t=T2MediaLib.playingAudio;return t?(t.pause(),t):null},resumeAudio:function(){var t=T2MediaLib.playingAudio;return t?(t.play(),t):null},setAudioVolume:function(t){T2MediaLib.audioVolume=t,T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.volume=t)},setAudioTempo:function(t){T2MediaLib.audioTempo=t,T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.playbackRate=t)},setAudioPosition:function(t){T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.currentTime=t)},getAudioData:function(t){return T2MediaLib.audioDataAry.data[t]},getAudioCurrentTime:function(){return T2MediaLib.playingAudio instanceof Audio?T2MediaLib.playingAudio.currentTime:null},getAudioLength:function(){return T2MediaLib.playingAudio instanceof Audio?T2MediaLib.playingAudio.duration:null}};requireSimulator.setName("Tonyu.Iterator"),define(["Tonyu"],function(){function t(t,e){var n={};if(t.tonyuIterator)return t.tonyuIterator(e);if(t instanceof Array)n.i=0,n.next=1==e?function(){return n.i>=t.length?!1:(this[0]=t[n.i],n.i++,!0)}:function(){return n.i>=t.length?!1:(this[0]=n.i,this[1]=t[n.i],n.i++,!0)};else{if(!(t instanceof Object))throw console.log(t),new Error(t+" is not iterable");n.i=0;var i=[];if(1==e){for(var r in t)i.push(r);n.next=function(){return n.i>=i.length?!1:(this[0]=i[n.i],n.i++,!0)}}else{for(var r in t)i.push([r,t[r]]);n.next=function(){return n.i>=i.length?!1:(this[0]=i[n.i][0],this[1]=i[n.i][1],n.i++,!0)}}}return n}return Tonyu.iterator=t,t}),requireSimulator.setName("exceptionCatcher"),define([],function(){var t={};return t.f=function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(n){t.handleException(n)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var i in e)e[i]=t.f(e[i]);return e}},t}),requireSimulator.setName("UI"),define(["Util","exceptionCatcher"],function(t,e){var n={},i=e.f;return n=function(){function e(){f.forEach(function(t){t()}),setTimeout(i(e),10)}function r(t){return t instanceof Array?o(t):"string"==typeof t?s(t):t
}function o(t){var e=t[0],n=1,i=$("<"+e+">");for("object"!=typeof t[n]||t[n]instanceof Array||t[n]instanceof $||(a(i,t[n],e),n++);n<t.length;)i.append(r(t[n])),n++;return i}function a(e,r){function o(t,n){if(n)if("enterkey"==t)e.on("keypress",i(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var o,a=!0;f.push(function(){var t;t="checkbox"==r.type?!!e.prop("checked"):e.val(),(a||o!=t)&&(n.apply(e,[t,o]),o=t),a=!1})}else e.on(t,i(n))}r.$var&&(c[r.$var]=e),r.$edit&&("string"==typeof r.$edit&&(r.$edit={name:r.$edit,type:n.types.String}),r.on||(r.on={}),r.on.realtimechange=i(function(t){h.writeToModel(r.$edit,t,e)}),c[r.$edit.name]||(c[r.$edit.name]=e),h.push({jq:e,params:r}));for(var a in r)if("on"==a)for(var s in r.on)o(s,r.on[s]);else"css"==a&&null!=r[a]?e.css(r[a]):t.startsWith(a,"$")||null==r[a]||e.attr(a,r[a])}function s(t){return $("<span>").text(t)}for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];var f=[],c={},h=[],p=r(u);return p.$edits=h,p.$vars=c,h.load=function(t){h.model=t,h.forEach(function(t){h.writeToJq(t.params.$edit,t.jq)})},h.writeToJq=function(t,e){var n=h.model;if(n){for(var i=t.name,r=i.split("."),o=0;o<r.length;o++)n=n[r[o]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},h.validator={errors:{},show:function(){if(c.validationMessage){c.validationMessage.empty();for(var t in this.errors)c.validationMessage.append(n("div",this.errors[t].mesg))}if(c.OKButton){var e=!0;for(var t in this.errors)e=!1;c.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},h.writeToModel=function(t,e,n){var i=h.model;if(i){var r=t.name;try{e=t.type.fromVal(e)}catch(o){return void h.validator.addError(r,o,n)}h.validator.removeError(r);for(var a=r.split("."),s=0;s<a.length;s++)s==a.length-1?h.on.writeToModel(r,e)||(i[a[s]]=e):i=i[a[s]];h.validator.on.validate.call(h.validator,h.model)}},h.on={},h.on.writeToModel=function(){},f.length>0&&setTimeout(i(e),10),p},n.types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),requireSimulator.setName("UIDiag"),define(["UI"],function(t){var e={};return e.confirm=function(e){function n(t){return function(){r.resolve(t),i.dialog("close"),i.remove()}}var i=t("div",{title:"確認"},["div",e],["button",{on:{click:n(!0)}},"OK"],["button",{on:{click:n(!1)}},"キャンセル"]).dialog({width:"auto",close:n(!1)}),r=$.Deferred();return r.promise()},e.alert=function(e){function n(t){return function(){r.resolve(t),i.dialog("close"),i.remove()}}var i=t("div",{title:"確認"},["div",e],["button",{on:{click:n(!0)}},"OK"]).dialog({width:"auto",close:n(!1)}),r=$.Deferred();return r.promise()},e.prompt=function(e,n){function i(){var t=o.$vars.val.val();a.resolve(t),o.dialog("close"),o.remove()}function r(){o.dialog("close"),o.remove(),a.resolve()}var o=t("div",{title:"入力"},["div",e],["input",{on:{enterkey:i},$var:"val",value:n}],["br"],["button",{on:{click:i}},"OK"],["button",{on:{click:r}},"キャンセル"]).dialog({width:"auto",close:function(){o.dialog("close"),a.resolve()}}),a=$.Deferred();return a.promise()},"undefined"!=typeof window&&(window.UIDiag=e),e}),requireSimulator.setName("runtime"),requirejs(["ImageList","T2MediaLib","Tonyu","Tonyu.Iterator","UIDiag"],function(){}),requireSimulator.setName("runScript2"),requirejs(["FS","compiledTonyuProject","Shell","runtime","WebSite","LSFS","Tonyu","NativeFS"],function(t,e,n,i,r,o,a){$(function(){function i(){u=$(window).width(),l=$(window).height(),f.attr({width:u-10,height:l-10})}function s(){a.currentProject=a.globals.$currentProject=y;var t=y.getOptions();y.runScriptMode=!0,y.run(t.run.bootClass)}SplashScreen={hide:function(){$("#splash").hide()},show:function(){}};var u=$(window).width(),l=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var f=$("<canvas>").attr({width:u-10,height:l-10}).appendTo("body");$(window).resize(i);var c;if(r.isNW){var h=location.href.replace(/^file:\/\//,"");h.match(/^\/[a-z]:/i)&&(h=h.replace(/^\//,"")),h=t.get(h),h.isDir()||(h=h.up()),c=h.rel("data/")}else{var p=location.href.replace(/\?.*/,"").split(/\//),d=p.pop()||"runscript",m=p.pop()||"nobody",h=t.get(r.tonyuHome),g=t.get("/ram/");t.mount(g.path(),o.ramDisk()),c=g;var v=h.rel(m+"/"+d+"/");g.rel("files/").link(v)}loadFiles(c),n.cd(c),r.compiledKernel="js/kernel.js";var y=e("user","js/concat.js",c);s()})}),requireSimulator.setName();