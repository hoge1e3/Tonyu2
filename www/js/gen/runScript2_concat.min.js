!function(t){t("function"==typeof define&&define.amd&&"function"==typeof requirejs?{requirejs:requirejs,define:define}:{})}(function(t){var e={};e.def=function(t,n,r){var i=e.getModuleInfo(e.curName);i.type=r,e.setReqs(i,t),i.func=function(){return n.apply(this,e.getObjs(t))},e.loadIfAvailable(i)};var n=function(){var t=Array.prototype.slice.call(arguments);"string"==typeof t[0]&&(e.curName=t.shift());var n=t.shift(),r=t.shift();e.def(n,r,"define")};n.amd={jQuery:!0};var r=function(t,n){e.def(t,n,"require")};r.isRequireSimulator=!0,e.setReqs=function(t,n){n.forEach(function(n){var r=e.getModuleInfo(n);r.loaded||(t.reqs[n]=r,r.revReqs[t.name]=t)})},e.getModuleInfo=function(t){var n=e.modules;return n[t]||(n[t]={name:t,reqs:{},revReqs:{}}),n[t]},e.doLoad=function(t){var n=e.getModuleInfo(t);if(n.loaded)return n.obj;n.loaded=!0;var r=null;if(n.func)r=n.func();else{var i=t.split(/\./);r=function(){return this}(),i.forEach(function(t){r&&(r=r[t])}),null==r&&console.log("Warning: No obj for "+t)}if("define"==n.type&&null==r)throw"No obj for "+t;n.obj=r;for(var o in n.revReqs)e.notifyLoaded(n.revReqs[o],n.name);return r},e.notifyLoaded=function(t,n){delete t.reqs[n],e.loadIfAvailable(t)},e.loadIfAvailable=function(t){for(var n in t.reqs)return;e.doLoad(t.name)},e.getObjs=function(t){var n=[];return t.forEach(function(t){var r=e.doLoad(t);n.push(r)}),n},e.modules={},e.setName=function(t){e.curName&&(e.getModuleInfo(e.curName).func||e.doLoad(e.curName)),t&&(e.curName=t)},e.real=t;var i=e;i.setName("FS"),n([],function(){var t,e,n={},r="REQJS_",i=0;n.def=function(t,e,r){var i=n.getModuleInfo(t);"function"==typeof e?(r=e,e=n.reqsFromFunc(r),n.setReqs(i,e),i.func=function(){var t={exports:{}},e=r(n.doLoad,t,t.exports);return e||t.exports}):(n.setReqs(i,e),i.func=function(){return r.apply(this,n.getObjs(e))}),n.loadIfAvailable(i)},t=function(t,e,r){n.def(t,e,r)},t.amd={},e=function(t,e){n.def(r+i++,t,e)},n.setReqs=function(t,e){e.forEach(function(e){var r=n.getModuleInfo(e);r.loaded||(t.reqs[e]=r,r.revReqs[t.name]=t)})},n.getModuleInfo=function(t){var e=n.modules;return e[t]=e[t]||{name:t,reqs:{},revReqs:{}}},n.doLoad=function(t){var e=n.getModuleInfo(t);if(e.loaded)return e.obj;e.loaded=!0;var r=e.func();null!=r||t.match(/^REQJS_/)||console.log("Warning: No obj for "+t),e.obj=r;for(var i in e.revReqs)n.notifyLoaded(e.revReqs[i],e.name);return r},n.notifyLoaded=function(t,e){delete t.reqs[e],n.loadIfAvailable(t)},n.loadIfAvailable=function(t){for(var e in t.reqs)return;n.doLoad(t.name)},n.getObjs=function(t){var e=[];return t.forEach(function(t){var r=n.doLoad(t);e.push(r)}),e},n.reqsFromFunc=function(t){var e=t+"",n=[];return e.replace(/require\s*\(\s*["']([^"']+)["']\s*\)/g,function(t,e){n.push(e)}),n},n.modules={},t("extend",[],function(){return function(t,e){for(var n in e)t[n]=e[n];return t}}),t("assert",[],function(){function t(e){if(e instanceof Array){var n=[];return e.forEach(function(e){n=n.concat(t(e))}),n}return[e]}var e,n=function(e){this.failMesg=t(e||"Assertion failed: ")};n.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var n=e(arguments),r=n.shift();if(n=t(n),n=this.failMesg.concat(r).concat(n),console.log.apply(console,n),this.isDefensive())return r;if(this.isBool())return!1;throw new Error(n.join(" "))},subAssertion:function(){var r=e(arguments);return r=t(r),new n(this.failMesg.concat(r))},assert:function(t,e){return t?t:this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):this.isBool()?!0:t},ne:function(t,e){return t===e?this.fail(t,"===",e):this.isBool()?!0:t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):this.isBool()?!0:t},is:function(t,e){var n=e,r=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),this.isBool()?!0:t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var i=this,o=0;o<n.length;o++){var s=i.subAssertion("failed at ",t,"[",o,"]: ");null==n[o]&&console.log("WOW!7",r[o],n[o]),s.is(r[o],n[o])}return this.isBool()?!0:t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),this.isBool()?!0:t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),this.isBool()?!0:t;if(n===Boolean||"boolean"==n)return this.assert("boolean"==typeof r,[r,"should be a boolean"]),this.isBool()?!0:t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),this.isBool()?!0:t;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),this.isBool()?!0:t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),this.isBool()?!0:t;if(n&&"object"==typeof n){for(var a in n){var s=this.subAssertion("failed at ",t,".",a,":");s.is(t[a],n[a])}return this.isBool()?!0:t}if("string"==typeof n){var u=this._regedType[n];return u?this.is(t,u):this.isBool()?!0:t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&i(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},e=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var r=new n,i=function(){try{return r.assert.apply(r,arguments)}catch(t){throw new Error(t.stack)}};return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){i[t]=function(){try{return r[t].apply(r,arguments)}catch(e){throw console.log(e.stack),new Error(e.message)}}}),i.fail=r.fail.bind(r),i.MODE_STRICT=r.MODE_STRICT,i.MODE_DEFENSIVE=r.MODE_DEFENSIVE,i.MODE_BOOL=r.MODE_BOOL,i.f=function(t){return{_assert_func:t}},i.opt=function(t){return i.f(function(e){return null==e||e instanceof t})},i.and=function(){var t=e(arguments);return i(t instanceof Array),i.f(function(e){for(var n=this,r=0;r<t.length;r++)n.is(e,t[r])})},i}),t("PathUtil",["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}function n(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n}var r,i=/^([a-zA-Z]):/,o=/^([a-z\-]+):\/\/\/?([^\/]+)\//,s=t.f(function(t){this.is(t,String),this.assert(r.isPath(t),[t," is not a path"])}),a=t.f(function(t){this.is(t,String),this.assert(r.isAbsolutePath(t),[t," is not a absolute path"])}),u=t.f(function(t){this.is(t,String),this.assert(!r.isAbsolutePath(t),[t," is not a relative path"])}),c=t.f(function(t){this.is(t,s),this.assert(r.isDir(t),[t," is not a directory path"])}),f=t.and(c,a),l=t.f(function(t){this.is(t,s),this.assert(!r.isDir(t),[t," is not a file path"])}),h="/";return r={Path:s,Absolute:a,Relative:u,Dir:c,File:l,AbsDir:f,SEP:h,endsWith:e,startsWith:n,hasDriveLetter:function(t){return i.exec(t)},isURL:function(t){var e=o.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:h+t.substring(e[0].length)}},isPath:function(){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&!r.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&(r.startsWith(e,h)||r.hasDriveLetter(e)||r.isURL(e))},isDir:function(n){return n=r.fixSep(n),t.is(arguments,[s]),e(n,h)},hasBackslashSep:function(t){return t.indexOf("\\")>=0},fixSep:function(e,n){return n=n||"/",t.is(arguments,[String]),t.is(e.replace(/[\\\/]/g,n),s)},directorify:function(e){return r.isDir(e)?e:t.is(e+h,c)},filify:function(e){return r.isDir(e)?t.is(e.substring(0,e.length-1),l):e},splitPath:function(e){t.is(arguments,[s]);var n;if(n=this.isURL(e)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}e=e.replace(/\/+/g,h);var i=e.split(h);return""==i[i.length-1]&&(i[i.length-2]+=h,i.pop()),i},name:function(e){return t.is(arguments,[String]),r.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var n=r.name(e),i=/\.[a-zA-Z0-9]+$/.exec(n);return i?i[0]:null},truncExt:function(e,n){t.is(e,String);var i=r.name(e);return n=n||r.ext(e),t.is(n,String),i.substring(0,i.length-n.length)},truncSEP:function(e){return t.is(arguments,[s]),r.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(n,i){return t.is(arguments,[String,String]),e(r.name(n),i)},parent:function(e){return t.is(arguments,[String]),r.up(e)},rel:function(e,n){if(""==n)return e;t.is(arguments,[f,u]);var i=r.splitPath(n),o=e;o=o.replace(/\/$/,"");var s=r;return i.forEach(function(t){".."==t||"../"==t?o=s.up(o):(o=o.replace(/\/$/,""),o+=h+("."==t||"./"==t?"":t))}),o},relPath:function(e,n){return t.is(arguments,[a,a]),e.substring(0,n.length)!=n?"../"+r.relPath(e,this.up(n)):e.substring(n.length)},up:function(t){if(t==h)return null;var e=r.splitPath(t);return e.pop(),e.join(h)+h}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(t){var e=r[t];r[t]=function(){var t=!1,n=Array.prototype.slice.call(arguments).map(function(e){return r.hasBackslashSep(e)?(t=!0,r.fixSep(e)):e}),i=e.apply(r,n);return t?r.fixSep(i,"\\"):i}}),r.isAbsolute=r.isAbsolutePath,r.isRelative=r.isRelativePath,"object"==typeof window&&(window.PathUtil=r),r}),t("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".wav":"audio/x-wav",".mp3":"audio/mp3",".ogg":"audio/ogg",".midi":"audio/midi",".mid":"audio/midi",".mzo":"audio/mzo",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu",".c":"text/c",".dtl":"text/dolittle"}}),t("DeferredUtil",[],function(){function t(t){return t}var e,n="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:null,r=function(t){this.res=t};return e={isNativePromise:function(t){return t&&"function"==typeof t.then&&"function"!=typeof t.promise&&"function"==typeof t.catch},isJQPromise:function(t){return t&&"function"==typeof t.then&&"function"==typeof t.promise&&"function"==typeof t.fail},isPromise:function(t){return t&&"function"==typeof t.then&&("function"==typeof t.promise||"function"==typeof t.catch)},all:function(t){return e.promise(function(n,r){var i=[],o=t.length;t.forEach(function(t,s){e.resolve(t).then(function(t){i[s]=t,o--,0===o&&n(i)},r)})})},resolve:function(t){return e.config.useJQ&&e.isJQPromise(t)?t:!e.config.useJQ&&e.isNativePromise(t)?t:e.promise(function(n,r){e.isPromise(t)?t.then(n,r):n(t)})},throwNowIfRejected:function(t){var n,r,i=t.then(function(t){return n||(n="resolved"),t},function(t){return n?e.reject(t):(n="rejected",void(r=t))});if(n||(n="notyet"),"rejected"===n)throw r;return i},assertResolved:function(t){var e,n;if(t.then(function(t){e=t,n=!0}),!n)throw new Error("Promise not resolved");return e},ensureDefer:function(n){return e.promise(function(r,i){var o;e.resolve(n).then(function(t){o?r(t):setTimeout(function(){r(t)},0)}).then(t,function(t){o?i(t):setTimeout(function(){i(t)},0)}),o=!0})},directPromise:function(t){return e.timeout(t,0)},then:function(t){return e.directPromise().then(t)},timeout:function(t,n){return e.promise(function(e){setTimeout(function(){e(n)},t||0)})},funcPromise:function(t){if(e.config.useJQ){var n=new $.Deferred;try{t(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(r){n.reject(r)}return n.promise()}if(e.external.Promise)return new e.external.Promise(function(e,n){try{t(e,n)}catch(r){n(r)}});throw new Error("promise is not found")},reject:function(t){if(e.config.useJQ){var n=new $.Deferred;return n.reject(t),n.promise()}return new e.external.Promise(function(e,n){n(t)})},throwPromise:function(t){if(e.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(t)},0),n.promise()}return new e.external.Promise(function(e,n){n(t)})},throwF:function(t){return function(){try{return t.apply(this,arguments)}catch(n){return console.log(n,n.stack),e.throwPromise(n)}}},each:function(t,n){if(t instanceof Array)return e.loop(function(r){return r>=t.length?e.brk():e.resolve(n(t[r],r)).then(function(){return r+1})},0);var r=[];for(var i in t)r.push({k:i,v:t[i]});return e.each(r,function(t){return n(t.k,t.v)})},loop:function(n,i){try{for(var o;;){if(i instanceof r)return e.when1(i.res);var s=!0,a=!1,u=n(i),c=e.resolve(u).then(function(t){return i=t,s=!1,i instanceof r?i.res:a?e.loop(n,i):void 0}).then(t,function(t){s=!1,o=t});if(o)throw o;if(a=!0,s)return c}}catch(f){return e.reject(f)}},brk:function(t){return new r(t)},tryLoop:function(t,n){return e.loop(e.tr(t),n)},tryEach:function(t,n){return e.loop(t,e.tr(n))},documentReady:function(){return e.callbackToPromise(function(t){$(t)})},requirejs:function(t){if(!n.requirejs)throw new Error("requirejs is not loaded");return e.callbackToPromise(function(e){n.requirejs(t,e)})}},e.NOP=function(t){return t},e.E=function(){console.log("DUE",arguments),e.errorHandler.apply(e,arguments)},e.errorHandler=function(t){console.error.apply(console,arguments),alert(t)},e.setE=function(t){e.errorHandler=t},e.begin=e.try=e.tr=e.throwF,e.promise=e.callbackToPromise=e.funcPromise,e.when1=e.resolve,e.config={},n.$&&n.$.Deferred&&(e.config.useJQ=!0),e.external={Promise:n.Promise},n.DeferredUtil||(n.DeferredUtil=e),e}),t("FSClass",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(t,e,n,r,i){function o(t){throw new Error(t+" is STUB!")}var s=function(){},a={};return s.addFSType=function(t,e){a[t]=e},s.availFSTypes=function(){return a},t(s.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},isReadOnly:function(){o("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(t){return r(this.getRootFS()!==this),this.getRootFS().resolveFS(t)},mounted:function(t,e){this.rootFS=t,this.mountPoint=e},inMyFS:function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},getRootFS:function(){return r(this.rootFS,"rootFS is not set")},getReturnTypes:function(){o("")},getContent:function(){o("getContent")},getContentAsync:function(){return this.supportsSync()||o("getContentAsync"),i.resolve(this.getContent.apply(this,arguments))},setContent:function(){o("")},setContentAsync:function(t,e,n){var r=this;return r.supportsSync()||o("setContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.setContent(t,e,n))})},appendContent:function(){o("")},appendContentAsync:function(t,e,n){var r=this;return r.supportsSync()||o("appendContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.appendContent(t,e,n))})},getMetaInfo:function(){o("")},setMetaInfo:function(){o("")},mkdir:function(){o("mkdir")},touch:function(){o("touch")},exists:function(){o("exists")},opendir:function(){o("opendir")},opendirAsync:function(){return this.supportsSync()||o("opendirAsync"),i.resolve(this.opendir.apply(this,arguments))},cp:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),i=i||{};var o=this.isDir(t),s=this.getRootFS().resolveFS(n),a=s.isDir(n);if(o||a)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(t),c=s.setContent(n,u);return i.a&&s.setMetaInfo(n,this.getMetaInfo(t)),c}return s.setContentAsync(n,this.getContentAsync(t)).then(function(e){return i.a?s.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(){o("")},link:function(t,e){throw new Error("ln "+e+" "+t+" : This FS not support link.")},getURL:function(){o("")},onAddObserver:function(){}}),s.delegateMethods=function(t,n){for(var i in n)!function(i){r.ne(i,"inMyFS"),t[i]=function(){var t=arguments[0];r.is(t,e.Absolute);var o=this.resolveFS(t);return o!==this?(console.log("Invoked for other fs",this.mountPoint,o.mountPoint),o[i].apply(o,arguments)):n[i].apply(this,arguments)}}(i)},s.delegateMethods(s.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},getContentType:function(t,r){var i=(e.ext(t)+"").toLowerCase();return n[i]||(r||{}).def||"application/octet-stream"},getBlob:function(t,e){var n=this.getContent(t);return e=e||{},e.blobType=e.blobType||Blob,e.binType=e.binType||ArrayBuffer,n.hasPlainText()?new e.blobType([n.toPlainText()],this.getContentType(t)):new e.blobType([n.toBin(e.binType)],this.getContentType(t))},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t){return e.isDir(t)},find:function(t,n){r.is(arguments,[e.Absolute]);var i=this.opendir(t,n),o=this,s=[t];return i.forEach(function(r){var i=e.rel(t,r);if(e.isDir(i)){var a=o.resolveFS(i);s=s.concat(a.find(i,n))}else s.push(i)}),s},resolveLink:function(t){r.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){r(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var o=e.rel(i,e.relPath(t,n));return r(o!=t,"np==path=="+o),r.is(this.getRootFS().resolveFS(o).resolveLink(o),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(){return null},opendirEx:function(t){r.is(t,e.AbsDir);var n=this.opendir(t),i=this,o={};return n.forEach(function(n){var r=e.rel(t,n);o[n]=i.getMetaInfo(r)}),o},getDirTree:function(t,n){n=n||{};var i=n.dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],r.is(n.excludes,Array),n.base||(n.base=t),r.is(t,e.AbsDir);var o=this.opendirEx(t,n);if("no-recursive"==n.style)return o;var s=this;for(var a in o){var u=o[a],c=e.rel(t,a),f=e.relPath(c,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(f)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(c)>=0)continue}if(s.isDir(c))switch(n.style){case"flat-absolute":case"flat-relative":s.getDirTree(c,n);break;case"hierarchical":n.dest={},i[a]=s.getDirTree(c,n)}else switch(n.style){case"flat-absolute":i[c]=u;break;case"flat-relative":i[f]=u;break;case"hierarchical":i[a]=u}}return i}}),s}),t("Util",[],function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:e(i[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function r(t,e){return t.substring(0,e.length)===e}function i(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){var e=r.apply(t,arguments);return e})}(n);return e}function o(t,e){for(var n in e||{})t[n]=e[n];return t}return{getQueryString:t,endsWith:n,startsWith:r,privatize:i,extend:o}}),t("FileSaver",[],function(){function t(t,e){return"undefined"==typeof e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Depricated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t}function e(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){o(r.response,e,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(t){var e=new XMLHttpRequest;return e.open("HEAD",t,!1),e.send(),e.status>=200&&e.status<=299}function r(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:this,o=i.saveAs||"object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype?function(t,o,s){var a=i.URL||i.webkitURL,u=document.createElement("a");o=o||t.name||"download",u.download=o,u.rel="noopener","string"==typeof t?(u.href=t,u.origin!==location.origin?n(u.href)?e(t,o,s):r(u,u.target="_blank"):r(u)):(u.href=a.createObjectURL(t),setTimeout(function(){a.revokeObjectURL(u.href)},4e4),setTimeout(function(){r(u)},0))}:"msSaveOrOpenBlob"in navigator?function(i,o,s){if(o=o||i.name||"download","string"==typeof i)if(n(i))e(i,o,s);else{var a=document.createElement("a");a.href=i,a.target="_blank",setTimeout(function(){r(a)})}else navigator.msSaveOrOpenBlob(t(i,s),o)}:function(t,n,r,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof t)return e(t,n,r);var s="application/octet-stream"===t.type,a=/constructor/i.test(i.HTMLElement)||i.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||s&&a)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var t=c.result;t=u?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=t:location=t,o=null},c.readAsDataURL(t)}else{var f=i.URL||i.webkitURL,l=f.createObjectURL(t);o?o.location=l:location.href=l,o=null,setTimeout(function(){f.revokeObjectURL(l)},4e4)}};return i.saveAs=o.saveAs=o,"undefined"!=typeof module&&(module.exports=o),o}),t("Content",["assert","Util","FileSaver"],function(t,e,n){var r=function(){},i=e.extend;r.plainText=function(t,e){var n=new r;return n.contentType=e||"text/plain",n.plain=t,n},r.url=function(t){var e=new r;return e.url=t,e},r.buffer2ArrayBuffer=function(e){if(r.isBuffer(e)){var n=new Uint8Array(e),i=n.buffer;if(i instanceof ArrayBuffer)return i;var o=Array.prototype.slice.call(n);return t(new Uint8Array(o).buffer,"n2a: buf is not set")}return t(e,"n2a: a is not set")},r.arrayBuffer2Buffer=function(e){if(e instanceof ArrayBuffer){var n=new Buffer(new Uint8Array(e));return n}return t(e,"a2n: a is not set")},r.bin=function(e,n){t(n,"contentType should be set");var i=new r;if(r.isNodeBuffer(e))i.bufType="node",i.nodeBuffer=e;else if(e instanceof ArrayBuffer)i.bufType="array2",i.arrayBuffer=e;else{if(!e||!r.isBuffer(e.buffer))throw new Error(e+" is not a bin");i.bufType="array1",i.arrayBuffer=e.buffer}return i.contentType=n,i},r.looksLikeDataURL=function(t){return t.match(/^data:/)},r.download=n;var o=r.prototype;o.toBin=function(t){if(t=t||(r.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return t===Buffer?this.nodeBuffer:this.arrayBuffer=r.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return t===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=r.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var e=new a(this.url,t);return this.setBuffer(e.buffer)}if(null!=this.plain)return this.setBuffer(r.str2utf8bytes(this.plain,t));throw new Error("No data")},o.setBuffer=function(e){return t(e,"b is not set"),r.isNodeBuffer(e)?this.nodeBuffer=e:this.arrayBuffer=e},o.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},o.toNodeBuffer=function(){return this.toBin(Buffer)},o.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=r.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var t=new a(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=t.url}throw new Error("No data")},o.toPlainText=function(){if(this.hasPlainText())return this.plain;if(this.url&&!this.hasBin()){var t=new a(this.url,ArrayBuffer);this.arrayBuffer=t.buffer}if(this.hasBin())return this.plain=r.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},o.hasURL=function(){return this.url},o.hasPlainText=function(){return null!=this.plain},o.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},o.hasNodeBuffer=function(){return this.nodeBuffer},o.hasArrayBuffer=function(){return this.arrayBuffer},o.toBlob=function(){return new Blob([this.toBin(ArrayBuffer)],{type:this.contentType})},o.download=function(t){r.download(this.toBlob(),t)},r.Base64_To_ArrayBuffer=function(t,e){function n(e){throw console.log(e),console.log(t,h),new Error(e)}var i=e||ArrayBuffer;t=t.replace(/[\n=]/g,"");var o=new Object;o[65]=0,o[66]=1,o[67]=2,o[68]=3,o[69]=4,o[70]=5,o[71]=6,o[72]=7,o[73]=8,o[74]=9,o[75]=10,o[76]=11,o[77]=12,o[78]=13,o[79]=14,o[80]=15,o[81]=16,o[82]=17,o[83]=18,o[84]=19,o[85]=20,o[86]=21,o[87]=22,o[88]=23,o[89]=24,o[90]=25,o[97]=26,o[98]=27,o[99]=28,o[100]=29,o[101]=30,o[102]=31,o[103]=32,o[104]=33,o[105]=34,o[106]=35,o[107]=36,o[108]=37,o[109]=38,o[110]=39,o[111]=40,o[112]=41,o[113]=42,o[114]=43,o[115]=44,o[116]=45,o[117]=46,o[118]=47,o[119]=48,o[120]=49,o[121]=50,o[122]=51,o[48]=52,o[49]=53,o[50]=54,o[51]=55,o[52]=56,o[53]=57,o[54]=58,o[55]=59,o[56]=60,o[57]=61,o[43]=62,o[47]=63;var s,a=t.length,u=0,c=0;if(!a)return new i(0);s=Math.floor(a/4*3),"="==t.charAt(a-1)&&(s-=1),"="==t.charAt(a-2)&&(s-=1);for(var f=new i(s),l=r.isNodeBuffer(f)?f:new Uint8Array(f),h=0,p=0;s>p&&(c=o[t.charCodeAt(h)],void 0===c&&n("Invalid letter: "+t.charCodeAt(h)),u=c<<2,h++,c=o[t.charCodeAt(h)],void 0===c&&n("Invalid letter: "+t.charCodeAt(h)),l[p]=u|c>>4&3,u=(15&c)<<4,h++,p++,!(p>=s))&&(c=o[t.charCodeAt(h)],void 0===c&&n("Invalid letter: "+t.charCodeAt(h)),l[p]=u|c>>2&15,u=(3&c)<<6,h++,p++,!(p>=s));)c=o[t.charCodeAt(h)],void 0===c&&n("Invalid letter: "+t.charCodeAt(h)),l[p]=u|c,h++,p++;return f},r.Base64_From_ArrayBuffer=function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,s=0,a=0;i>a&&(s=r[a],n+=e[s>>2],o=(3&s)<<4,a++,!(a>=i))&&(s=r[a],n+=e[o|s>>4],o=(15&s)<<2,a++,!(a>=i));)s=r[a],n+=e[o|s>>6],n+=e[63&s],a++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n},r.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},r.isNodeBuffer=function(t){return r.hasNodeBuffer()&&t instanceof Buffer},r.isBuffer=function(t){return t instanceof ArrayBuffer||r.isNodeBuffer(t)},r.utf8bytes2str=function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));return decodeURIComponent(e.join(""))},r.str2utf8bytes=function(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer};var s=r.hasNodeBuffer()?Buffer:ArrayBuffer,a=function(e,n){"string"==typeof e?(this.url=e,this.binType=n||s,this.dataURL2bin(e)):e&&r.isBuffer(e.buffer)?(this.buffer=e.buffer,t.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):r.isBuffer(e)?(this.buffer=e,t.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),t.fail("Invalid args: ",arguments))};return r.DataURL=a,i(a.prototype,{bin2dataURL:function(e,n){t(r.isBuffer(e)),t.is(n,String);var i=this.dataHeader(n),o=r.Base64_From_ArrayBuffer(e);return t.is(o,String),this.url=i+o},dataURL2bin:function(e){t.is(arguments,[String]);var n=/^data:([^;]+);base64,/i,i=n.exec(e);return t(i,["malformed dataURL:",e]),this.contentType=i[1],this.buffer=r.Base64_To_ArrayBuffer(e.substring(i[0].length),this.binType),t.is(this.buffer,this.binType)},dataHeader:function(e){return t.is(arguments,[String]),"data:"+e+";base64,"},toString:function(){return t.is(this.url,String)}}),r}),t("NativeFS",["FSClass","assert","PathUtil","extend","Content"],function(t,n,r,i,o){function s(t){return t}var a="object"==typeof process;if(!a)return function(){throw new Error("This system not support native FS")};var u=n,c=require("fs");c||(c=e.nodeRequire("fs"));var f=function(t){t&&(n.is(t,r.AbsDir),this.rootPoint=t)},l=r.hasDriveLetter(process.cwd());f.available=!0;var h=r.SEP,p=f.prototype=new t;return p.toNativePath=function(t){return this.rootPoint?(n.is(t,r.Absolute),n(this.inMyFS(t),t+" is not fs of "+this),r.rel(this.rootPoint,r.relPath(t,this.mountPoint||r.SEP))):t},p.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var e=new Buffer(new Uint8Array(t));return e}return t},t.addFSType("NativeFS",function(t,e){return new f(e.r)}),f.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},f.prototype.inMyFS=function(t){return this.mountPoint?r.startsWith(t,this.mountPoint):!(!!l^!!r.hasDriveLetter(t))},t.delegateMethods(f.prototype,{getReturnTypes:function(t,e){return s(t,e),u.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,e){e=e||{},n.is(t,r.Absolute);var i=this.toNativePath(t);return this.assertExist(t),o.bin(c.readFileSync(i),this.getContentType(t))},setContent:function(t,e){n.is(arguments,[r.Absolute,o]);var i=r.up(t);i&&this.getRootFS().resolveFS(i).mkdir(i);var s=this.toNativePath(t);e.hasBin()||!e.hasPlainText()?c.writeFileSync(s,e.toNodeBuffer()):c.writeFileSync(s,e.toPlainText())},appendContent:function(t,e){n.is(arguments,[r.Absolute,o]);var i=r.up(t);i&&this.getRootFS().resolveFS(i).mkdir(i);var s=this.toNativePath(t);e.hasBin()||!e.hasPlainText()?c.appendFileSync(s,e.toNodeBuffer()):c.appendFileSync(s,e.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(t,e,n){s(t,e,n)},isReadOnly:function(t){return s(t),!1},stat:function(t){n.is(t,r.Absolute);var e=this.toNativePath(t);return c.statSync(e)},mkdir:function(t,e){if(e=e||{},u.is(arguments,[r.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var n=r.up(t);n&&this.getRootFS().resolveFS(n).mkdir(n);var i=this.toNativePath(t);return c.mkdirSync(i),this.assertExist(i)},opendir:function(t,e){u.is(arguments,[String]),e=e||{};var n=this.toNativePath(t),i=r.truncSEP(n),o=c.readdirSync(n);e.nosep||(o=o.map(function(t){var e=c.statSync(i+h+t),n=e.isDirectory()?h:"";return t+n}));var s=[];return u.is(s.concat(o),Array)},rm:function(t,e){u.is(arguments,[r.Absolute]),e=e||{},this.assertExist(t);var n=this.toNativePath(t);return this.isDir(t)?c.rmdirSync(n):c.unlinkSync(n)},exists:function(t,e){e=e||{};var n=this.toNativePath(t);return c.existsSync(n)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():r.isDir(t)
},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&c.utimesSync(t,Date.now()/1e3,Date.now()/1e3)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")},onAddObserver:function(t,e){var n=this,o=n.getRootFS();e=e||{};var s=this.isDir(t),a=c.watch(t,e,function(e,a){var u,c=s?r.rel(t,a):t;u=n.exists(c)?i({eventType:e},n.getMetaInfo(c)):{eventType:e},o.notifyChanged(c,u)});return{remove:function(){a.close()}}}}),f}),t("LSFS",["FSClass","PathUtil","extend","assert","Util","Content"],function(t,e,n,r,i,o){function s(){return(new Date).getTime()}var a=function(t,e){r(t," new LSFS fail: no storage"),this.storage=t,this.options=e||{},this.options.useDirCache&&(this.dirCache={})},u=e.isDir.bind(e),c=e.up.bind(e),f=e.endsWith.bind(e),l=e.Absolute,h=e.SEP;return a.ramDisk=function(t){var n={};return n[e.SEP]="{}",t=t||{},"useDirCache"in t||(t.useDirCache=!0),new a(n,t)},t.addFSType("localStorage",function(t,e){return new a(localStorage,e)}),t.addFSType("ram",function(t,e){return a.ramDisk(e)}),a.now=s,a.prototype=new t,a.prototype.resolveKey=function(t){return r.is(t,e.Absolute),this.mountPoint?e.SEP+e.relPath(t,this.mountPoint):t},a.prototype.getItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},a.prototype.setItem=function(t,n){r.is(t,e.Absolute);var i=this.resolveKey(t);r(i.indexOf("..")<0),r(e.startsWith(i,e.SEP)),this.storage[i]=n},a.prototype.removeItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},a.prototype.itemExists=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return r(this.storage,"No storage"),n in this.storage},a.prototype.getDirInfo=function(t){if(r.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");if(f(t,h)||(t+=h),r(this.inMyFS(t)),this.dirCache&&this.dirCache[t])return this.dirCache[t];var n,i={};try{n=this.getItem(t),n&&(i=JSON.parse(n))}catch(o){console.log("dinfo err : ",t,n)}return this.dirCache&&(this.dirCache[t]=i),i},a.prototype.putDirInfo=function(t,n,i){if(r.is(arguments,[e.AbsDir,Object]),!u(t))throw new Error("Not a directory : "+t);r(this.inMyFS(t)),this.dirCache&&(this.dirCache[t]=n),this.setItem(t,JSON.stringify(n));var o=c(t);if(null!=o&&this.inMyFS(o)){var s=this.getDirInfo(o);this._touch(s,o,e.name(t),i)}},a.prototype._touch=function(t,i,o,a){r.is(arguments,[Object,String,String]),r(this.inMyFS(i));var u="change";t[o]||(u="create",t[o]={},a&&(t[o].trashed=!0)),a||delete t[o].trashed,t[o].lastUpdate=s();var c=n({eventType:u},t[o]);this.getRootFS().notifyChanged(e.rel(i,o),c),this.putDirInfo(i,t,a)},a.prototype.removeEntry=function(t,n,i){r.is(arguments,[Object,String,String]),t[i]&&(t[i]={lastUpdate:s(),trashed:!0},this.getRootFS().notifyChanged(e.rel(n,i),{eventType:"trash"}),this.putDirInfo(n,t,!0))},a.prototype.removeEntryWithoutTrash=function(t,n,i){r.is(arguments,[Object,String,String]),t[i]&&(delete t[i],this.getRootFS().notifyChanged(e.rel(n,i),{eventType:"delete"}),this.putDirInfo(n,t,!0))},a.prototype.isRAM=function(){return this.storage!==localStorage},a.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},a.getUsage=function(){var t=0;for(var e in localStorage)"string"==typeof localStorage[e]&&(t+=localStorage[e].length);return t},a.getCapacity=function(){function t(){try{return localStorage[r+e]=n,e++,i+=n.length,!0}catch(t){return delete localStorage[r+e],!1}}var e=0,n="a",r="___checkls___",i=0,o=Math.pow(2,25);try{for(var s=0;10>s;s++)n+=n;for(var s in localStorage)s.substring(0,r.length)==r?delete localStorage[s]:"string"==typeof localStorage[s]&&(i+=localStorage[s].length);for(var a=i;t()&&n.length<o;)n+=n;for(;n.length>1024;)n=n.substring(n.length/2),t();return{using:a,max:i}}finally{for(var s=0;e>s;s++)delete localStorage[r+s]}},t.delegateMethods(a.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t){r.is(arguments,[l]),this.assertExist(t);var e,n=this.getItem(t);return e=o.looksLikeDataURL(n)?o.url(n):o.plainText(n)},setContent:function(t,e){r.is(arguments,[l,o]),this.assertWriteable(t);var n=null;e.hasPlainText()&&(n=e.toPlainText(),o.looksLikeDataURL(n)&&(n=null)),null!=n?this.setItem(t,n):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t){if(this.assertExist(t,{includeTrashed:!0}),r.is(arguments,[l]),t==e.SEP)return{};var n=r(e.up(t));if(!this.inMyFS(n))return{};var i=e.name(t);r.is(n,e.AbsDir);var o=this.getDirInfo(n);return r(o[i])},setMetaInfo:function(t,n){r.is(arguments,[String,Object]),this.assertWriteable(t);var i=r(e.up(t));if(this.inMyFS(i)){var o=this.getDirInfo(i),s=e.name(t);o[s]=n,this.putDirInfo(i,o,o[s].trashed)}},mkdir:function(t){r.is(arguments,[l]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){r.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),i=[];for(var o in n)r(n[o]),(!n[o].trashed||e.includeTrashed)&&i.push(o);return r.is(i,Array)},rm:function(t,n){r.is(arguments,[l]),n=n||{},this.assertWriteable(t);var i=e.up(t);if(null==i||!this.inMyFS(i))throw new Error(t+": cannot remove. It is root of this FS.");if(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t)){var o=this.opendir(t);o.length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)}else this.removeItem(t);var s=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(s,i,e.name(t)):this.removeEntry(s,i,e.name(t))},exists:function(t,n){r.is(arguments,[l]),n=n||{};var i=e.name(t),o=e.up(t);if(null==o||!this.inMyFS(o))return!0;var s=this.getDirInfo(o),a=s[i];return a&&a.trashed&&this.itemExists(t)&&this.isDir(t),!a&&this.itemExists(t),a&&!a.trashed&&!a.link&&!this.itemExists(t),a&&!n.includeTrashed&&(a=!a.trashed),!!a},link:function(t,n){r.is(arguments,[e.Absolute,e.Absolute]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var i={};i.link=n,i.lastUpdate=s(),this.setMetaInfo(t,i),r(this.exists(t)),r(this.isLink(t))},isLink:function(t){if(r.is(arguments,[e.Absolute]),!this.exists(t))return null;var n=r(this.getMetaInfo(t));return n.link},touch:function(t){r.is(arguments,[l]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?(this.dirCache&&(this.dirCache[t]={}),this.setItem(t,"{}")):this.setItem(t,""));var n=c(t);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,e.name(t),!1)}else r(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(t){return this.getContent(t).toURL()},opendirEx:function(t,n){r.is(t,e.AbsDir),n=n||{};var i={},o=this.getDirInfo(t);if(n.includeTrashed)return o;for(var s in o)o[s].trashed||(i[s]=o[s]);return i}}),a}),"undefined"!=typeof $&&$.ajaxTransport("+binary",function(t,e,n){return window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob))?{send:function(e,n){var r=new XMLHttpRequest,i=t.url,o=t.type,s=t.async||!0,a=t.responseType||"blob",u=t.data||null,c=t.username||null,f=t.password||null;r.addEventListener("load",function(){var e={};e[t.dataType]=r.response,n(r.status,r.statusText,e,r.getAllResponseHeaders())}),r.open(o,i,s,c,f);for(var l in e)r.setRequestHeader(l,e[l]);r.responseType=a,r.send(u)},abort:function(){n.abort()}}:void 0}),t("jquery.binarytransport",function(){}),t("WebFS",["FSClass","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(t,e,n,r,i){var o=function(){},s=o.prototype=new t;return t.addFSType("web",function(){return new o}),s.fstype=function(){return"Web"},s.supportsSync=function(){return!1},s.inMyFS=function(t){return i.isURL(t)},t.delegateMethods(s,{exists:function(){return!0},getContentAsync:function(t){var e=this;return n.promise(function(n,i){$.get(t,function(i){var o=new FileReader;o.addEventListener("loadend",function(){n(r.bin(o.result,e.getContentType(t)))}),o.readAsArrayBuffer(i)},"binary").fail(i)})},getURL:function(t){return t}}),o}),t("Env",["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),n=n.replace(/^[a-z][a-z]+:\//,function(t){return t+"/"}),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n}),t("SFile",["extend","assert","PathUtil","Util","Content","FSClass","FileSaver","DeferredUtil"],function(t,e,n,r,i,o,s,a){var u=function(t,r){e.is(r,n.Absolute),this._path=r,this.rootFS=t,this.fs=t.resolveFS(r),this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return u.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},u.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},getPolicy:function(){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(t,i){var o;if(i=i||{},u.is(t))o=t;else{e.is(t,n.Absolute);var s,a=i.policy||this.policy;if(a&&(s=a.topDir)&&(s.path&&(s=s.path()),!n.startsWith(t,s)))throw new Error(t+": cannot access. Restricted to "+s);o=new u(this.rootFS,t),o.policy=a}return o.policy?r.privatize(o):o},contains:function(t){return e(u.is(t),t+" shoud be a SFile object."),this.isDir()?n.startsWith(t.path(),this.path()):!1},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var r=t.path?t.path():t;return n.relPath(this.path(),e.is(r,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,t))},sibling:function(t){return this.up().rel(t)},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var t=this.metaInfo();return t?t.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.act.fs.getMetaInfo(this.act.path,t)},setMetaInfo:function(t,e){return this.act.fs.setMetaInfo(this.act.path,t,e)},getDirTree:function(t){return this.act.fs.getDirTree(this.act.path,t)},assertExists:function(){e(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(t){var e=Array.prototype.slice.call(arguments);if("function"==typeof e[0]){var n=e.shift();return a.resolve(this.exists.apply(this,e)).then(n)}t=t||{};var r=this.fs.exists(this.path(),t);return r||t.noFollowLink?r:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(t){var e=this;if(t=t||{},this.isLink())return a.resolve(this.fs.rm(this.path(),t));var n;return n=this.isDir()&&(t.recursive||t.r)?this.each(function(e){return e.rm(t)}):a.resolve(),n.then(function(){return e.act.fs.rm(e.act.path,t)})},removeWithoutTrash:function(t){t=t||{},t.noTrash=!0,this.rm(t)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(t){return"function"==typeof t?this.getText(t):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(t){if(e.is(t,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());var n=this.contentType({def:null});return a.throwNowIfRejected(null!==n&&!n.match(/^text/)&&i.looksLikeDataURL(t)?this.setContent(i.url(t)):this.setContent(i.plainText(t)))},appendText:function(t){return e.is(t,String),this.act.fs.appendContent(this.act.path,i.plainText(t))},getContent:function(t){return"function"==typeof t?this.act.fs.getContentAsync(this.act.path).then(t):this.act.fs.getContent(this.act.path)},setContent:function(t){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,t)},getText:function(t){function e(t){try{return t.toPlainText()}catch(e){return t.toURL()}}if("function"==typeof t){return this.getContent(e).then(t)}return e(this.act.fs.getContent(this.act.path))},getDataURL:function(t){return"function"==typeof t?this.getContent(function(t){return t.toURL()}):this.getContent().toURL()},setDataURL:function(t){return this.setContent(i.url(t))},dataURL:function(t){return"string"==typeof t?this.setDataURL(t):"function"==typeof t?this.getDataURL(t):this.getDataURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(t){return this.act.fs.getContentType(this.act.path,t)},bytes:function(t){return i.isBuffer(t)?this.setBytes(t):this.getBytes()},setBytes:function(t){return this.act.fs.setContent(this.act.path,i.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.act.fs.getContent(this.act.path).toBin(t.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(t){return t instanceof Array?this.text(t.join("\n")):"function"==typeof t?this.text(function(e){return t(e.replace(/\r/g,"").split("\n"))}):this.text().replace(/\r/g,"").split("\n")},obj:function(){var t=this;if(0==arguments.length){var n=t.text();return n?JSON.parse(n):null}t.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,n){e(t&&t.isSFile(),t+" is not a file");var r=this,n=n||{},i=r.isDir(),o=t.isDir();if(!i&&o&&(t=t.rel(r.name()),e(!t.isDir(),t+" is a directory."),o=!1),!i||o){if(i||o)return e(i&&o,"Both src and dst should be dir"),r.each(function(e){var r,i=t.rel(e.name());return n.progress&&(r=n.progress(i,{src:e,dst:i})),a.resolve(r).then(function(){return i.copyFrom(e,n)})});n.echo&&n.echo(r+" -> "+t);var s=this.act.fs.cp(this.act.path,t.getResolvedLinkPath(),n);return s=a.resolve(s),n.a?s.then(function(){return t.setMetaInfo(r.getMetaInfo())}):s}this.err("Cannot move dir "+r.path()+" to file "+t.path())},moveFrom:function(t,e){var n=this;return n.exists(function(r){return n.copyFrom(t,e).then(function(){return t.rm({recursive:!0})},function(t){if(!r)return n.exists(function(t){return t?n.rm({recursive:!0}):void 0}).then(function(){throw t});throw t})})},moveTo:function(t,e){return t.moveFrom(this,e)},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){var n=this.assertDir();return n.listFilesAsync(e).then(function(e){return a.each(e,t)})},eachrev:function(t,e){var n=this.assertDir();return n.listFilesAsync(e).then(function(e){return a.each(e.reverse(),t)})},recursive:function(t,e){var n=this.assertDir();return e=n.convertOptions(e),n.each(function(n){return n.isDir()?n.recursive(t,e):t(n)},e)},_listFiles:function(t,n){function r(e){for(var n=[],r=0;r<e.length;r++){var s=e[r],a=o.rel(s);t.excludesF(a)||n.push(a)}return"function"==typeof i&&n.sort&&n.sort(i),n}e(null==t||"object"==typeof t);{var i,o=this.assertDir();this.path()}return t=o.convertOptions(t),i||(i=t.order),n?this.act.fs.opendirAsync(this.act.path,t).then(r):r(this.act.fs.opendir(this.act.path,t))},listFilesAsync:function(t){return this._listFiles(t,!0)},listFiles:function(t){return this._listFiles(t,!1)},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir();if(!t)return this.act.fs.opendir(this.act.path,t);var r=n.listFiles(t);return r.map(function(t){return t.name()})},convertOptions:function(t){var i=r.extend({},t),o=(this.assertDir(),this.path()),s=i.excludes||{};if("function"==typeof s)i.excludesF=s;else if("object"==typeof s){if(s instanceof Array){var a={};s.forEach(function(t){n.startsWith(t,"/")?a[t]=1:a[o+t]=1}),s=a}i.excludesF=function(t){return s[t.path()]}}return e.is(i,{excludesF:Function})},mkdir:function(){return this.touch()},link:function(t,e){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,t.path(),e)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(t){return this.getFS().getRootFS().addObserver(this.path(),t)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},setBlob:function(t){var e=this;return a.promise(function(n){var r=new FileReader;r.addEventListener("loadend",function(){a.resolve(e.setBytes(r.result)).then(n)}),r.readAsArrayBuffer(t)})},size:function(t){if(!t){if(this.isDir()){var e=0;return this.each(function(t){e+=t.size()}),e}return this.getBytes().byteLength}},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use 'zip' instead.");s(this.getBlob(),this.name())},err:function(){var t=Array.prototype.slice.call(arguments);throw console.log.apply(console,t),new Error(t.join(""))},exportAsObject:function(t){var e=this,n={};this.recursive(function(t){n[t.relPath(e)]=t.text()},t);var r={base:e.path(),data:n};return r},importFromObject:function(t){"string"==typeof t&&(t=JSON.parse(t));var t=t.data;for(var e in t)this.rel(e).text(t[e])},watch:function(t,e){var n={},r=function(){};"object"==typeof t&&(n=t),"object"==typeof e&&(n=e),"function"==typeof t&&(r=t),"function"==typeof e&&(r=e);var i=this.getFS().getRootFS();i.addObserver(this.path(),function(t,e){r(e.eventType,i.get(t),e)})}},Object.defineProperty(u.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),e.is(this._act,{fs:o,path:n.Absolute}),this._act)}}),u}),t("RootFS",["assert","FSClass","PathUtil","SFile"],function(t,e,n,r){var i=function(n){t.is(n,e),this.mount(null,n)},o=i.prototype,s={err:function(t,e){throw new Error(t+": "+e)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(e){t.is(arguments,[n.AbsDir]);var r=this.fstab();console.log(r);for(var i=0;i<r.length;i++)if(r[i].mountPoint==e)return r.splice(i,1),!0;return!1},availFSTypes:function(){return e.availFSTypes()},mount:function(n,r,i){if("string"==typeof r){var o=t(e.availFSTypes()[r],"fstype "+r+" is undefined.");r=o(n,i||{})}t.is(r,e),r.mounted(this,n),this.fstab().unshift(r)},resolveFS:function(r){t.is(r,n.Absolute);var i;return this.fstab().forEach(function(t){i||t.inMyFS(r)&&(i=t)}),i||this.err(r,"Cannot resolve"),t.is(i,e)},get:function(e){return t.is(e,n.Absolute),new r(this.resolveFS(e),e)},addObserver:function(e,n,r){this.observers=this.observers||[];var i,o,s={};"string"==typeof e&&(i=e),"string"==typeof n&&(i=n),"string"==typeof r&&(i=r),"object"==typeof e&&(s=e),"object"==typeof n&&(s=n),"object"==typeof r&&(s=r),"function"==typeof e&&(o=e),"function"==typeof n&&(o=n),"function"==typeof r&&(o=r),t.is(i,String),t.is(o,Function);var a=this.resolveFS(i),u=a.onAddObserver(i,s),c=this.observers,f={path:i,handler:o,remove:function(){var t=c.indexOf(this);c.splice(t,1),u&&u.remove()}};return this.observers.push(f),f},notifyChanged:function(t,e){this.observers&&this.observers.forEach(function(r){n.startsWith(t,r.path)&&r.handler(t,e)})},getRootFS:function(){return this}};for(var a in s)o[a]=s[a];return i}),t("zip",["SFile","FileSaver","Util","DeferredUtil"],function(t,e,n,r){var i={};return i.setJSZip=function(t){i.JSZip=t,r.external.Promise||(r.external.Promise=t.external.Promise)},"undefined"!=typeof JSZip&&i.setJSZip(JSZip),i.zip=function(e,n,o){function s(t,e){return e.each(function(e){var n=r.resolve();return o.progress&&(n=o.progress(e)),n.then(function(){if(e.isDir()){var n=t.folder(e.name().replace(/[\/\\]$/,""));return s(n,e)}return e.getContent(function(n){t.file(e.name(),n.toArrayBuffer())})})})}t.is(n)||(o=n),o=o||{};var a=new i.JSZip;return s(a,e).then(function(){return r.resolve(a.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(r){return t.is(n)?n.setBytes(r):void saveAs(new Blob([r],{type:"application/zip"}),e.name().replace(/[\/\\]$/,"")+".zip")})},i.unzip=function(e,n,o){var s,a={};o=o||{},t.is(e)&&(s=e.getContent(),e=s.toArrayBuffer()),o.onCheckFile||(o.onCheckFile=function(t){return o.overwrite?t:t.exists()?!1:t});var u=new i.JSZip;return r.resolve(u.loadAsync(e)).then(function(){return r.each(u.files,function(e,i){var s,u;return r.resolve(i.async("arraybuffer")).then(function(t){return s=t,u=n.rel(i.name),o.progress?r.resolve(o.progress(u)):void 0}).then(function(){if(console.log("Inflating",i.name),!u.isDir()){var e={file:u,status:"uploaded"};a[u.path()]=e;var n=FS.Content.bin(s,u.contentType()),r=o.onCheckFile(u,n);return r===!1&&(e.status="cancelled",u=null),t.is(r)&&(u.path()!==r.path()&&(e.redirectedTo=r),u=r),u?u.setContent(n):void 0}})})}).then(function(){return console.log("unzip done",a),a})},i}),t("promise",[],function(){function t(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})}function e(t){return Boolean(t&&"undefined"!=typeof t.length)}function n(){}function r(t,e){return function(){t.apply(e,arguments)}}function i(t){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function o(t,e){for(;3===t._state;)t=t._value;return 0===t._state?void t._deferreds.push(e):(t._handled=!0,void i._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null===n)return void(1===t._state?s:a)(e.promise,t._value);var r;try{r=n(t._value)}catch(i){return void a(e.promise,i)}s(e.promise,r)}))}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof i)return t._state=3,t._value=e,void u(t);if("function"==typeof n)return void f(r(n,e),t)}t._state=1,t._value=e,u(t)}catch(o){a(t,o)}}function a(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&i._immediateFn(function(){t._handled||i._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;n>e;e++)o(t,t._deferreds[e]);t._deferreds=null}function c(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,a(e,t))})}catch(r){if(n)return;n=!0,a(e,r)}}return i.prototype["catch"]=function(t){return this.then(null,t)},i.prototype.then=function(t,e){var r=new this.constructor(n);return o(this,new c(t,e,r)),r},i.prototype["finally"]=t,i.all=function(t){return new i(function(n,r){function i(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var a=e.then;if("function"==typeof a)return void a.call(e,function(e){i(t,e)},r)}o[t]=e,0===--s&&n(o)}catch(u){r(u)}}if(!e(t))return r(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(t);if(0===o.length)return n([]);for(var s=o.length,a=0;a<o.length;a++)i(a,o[a])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(t){return new i(function(e,n){n(t)})},i.race=function(t){return new i(function(n,r){if(!e(t))return r(new TypeError("Promise.race accepts an array"));for(var o=0,s=t.length;s>o;o++)i.resolve(t[o]).then(n,r)})},i._immediateFn=function(t){t()},i._unhandledRejectionFn=function(){},i}),t("FS",["FSClass","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil","promise"],function(t,e,n,r,i,o,s,a,u,c,f,l,h){var p={};p.assert=s,p.Content=c,p.Class=t,p.DeferredUtil=l,l.config.useJQ||(l.external.Promise=h),p.Env=o,p.LSFS=n,p.NativeFS=e,p.PathUtil=i,p.RootFS=u,p.SFile=a,p.WebFS=r,p.zip=f,"object"==typeof window&&(window.FS=p);var d,g=new o({});return p.addFSType=t.addFSType,p.availFSTypes=t.availFSTypes,p.setEnvProvider=function(t){g=t},p.getEnvProvider=function(){return g},p.setEnv=function(t,e){if("object"==typeof t)for(var n in t)g.set(n,t[n]);else g.set(t,e)},p.getEnv=function(t){return"string"==typeof t?g.get(t):g.value},p.init=function(t){d||(t||("object"==typeof process?t=new e:"object"==typeof localStorage?t=new n(localStorage):"function"==typeof importScripts&&(self.addEventListener("message",function(t){var e=t.data;switch("string"==typeof e&&(e=JSON.parse(e)),e.type){case"upload":p.get(e.base).importFromObject(e.data);break;case"observe":d.observe(e.path,function(t,e){self.postMessage(JSON.stringify({type:"changed",path:t,content:p.get(t).text(),meta:e}))})}}),t=n.ramDisk())),d=new u(t))},p.getRootFS=function(){return p.init(),d},p.get=function(){return p.init(),d.get.apply(d,arguments)},p.expandPath=function(){return g.expandPath.apply(g,arguments)},p.resolve=function(t,e){return p.init(),a.is(t)?t:(t=g.expandPath(t),e&&!i.isAbsolutePath(t)?(e=g.expandPath(e),p.get(e).rel(t)):p.get(t))},p.mount=function(){return p.init(),d.mount.apply(d,arguments)},p.unmount=function(){return p.init(),d.unmount.apply(d,arguments)},p.isFile=function(t){return a.is(t)},p});var o;return e(["FS"],function(t){o=t}),"undefined"!=typeof window&&void 0===window.FS&&(window.FS=o),"undefined"!=typeof module&&(module=o),o}),i.setName("Platform"),n([],function(){var t={},e=window.navigator.userAgent.toLowerCase();return t.tablet=-1!=e.indexOf("windows")&&-1!=e.indexOf("touch")||-1!=e.indexOf("ipad")||-1!=e.indexOf("android")&&-1==e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("tablet")||-1!=e.indexOf("kindle")||-1!=e.indexOf("silk")||-1!=e.indexOf("playbook"),t.mobile=-1!=e.indexOf("windows")&&-1!=e.indexOf("phone")||-1!=e.indexOf("iphone")||-1!=e.indexOf("ipod")||-1!=e.indexOf("android")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("blackberry"),t}),i.setName("WebSite"),n(["FS","Platform"],function(t,e){var n,r=t.PathUtil,i=document.location.href,o=!!i.match(/html\/dev\//)&&!!i.match(/localhost:3/),s=location.protocol;switch(s.match(/^http/)||(s="https:"),window.WebSite_runType){case"IDE":return n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},n.builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/inputPad.png":1,"images/neko.png":1,"images/mapchip.png":1},n.pluginTop||(n.pluginTop=n.top+"/js/plugins"),n.sampleImg=n.top+"/images",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.mp4Disabled=n.isNW,n.tonyuHome="/Tonyu/",n.PathSep="/",n.isNW?(n.noconcat=!0,n.PathSep=require("path").sep,n.cwd=r.directorify(process.cwd().replace(/\\/g,"/")),n.tonyuHome=process.env.TONYU_HOME?r.directorify(process.env.TONYU_HOME):r.rel(n.cwd,"fs/Tonyu/"),n.logdir=process.env.TONYU_LOGDIR,n.wwwDir=r.rel(n.cwd,"www/"),n.platform=process.platform,n.ffmpeg=r.rel(n.cwd,"win32"==n.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),n.pkgInfo=require(r.rel(n.cwd,"package.json")),n.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):n.pkgInfo&&n.pkgInfo.config&&n.pkgInfo.config.prjDirs?n.pkgInfo.config.prjDirs.map(function(t){return t=r.directorify(t),r.isAbsolute(t)?t:r.rel(n.cwd,t)}):[r.rel(n.cwd,"Projects/"),r.rel(n.tonyuHome,"Projects/")],n.kernelDir=r.rel(n.wwwDir,"Kernel/")):(n.wwwDir=i.match(/edit\.tonyu\.jp\/n\//)?s+"//"+location.host+"/n/":s+"//"+location.host+"/",n.projects=[r.rel(n.tonyuHome,"Projects/")]),n.kernelDir=r.rel(n.wwwDir,"Kernel/"),n.compiledKernel="Kernel/js/concat.js",i.match(/localhost\/tonyu2/)?(n.wwwDir=s+"//"+location.host+"/tonyu2/",n.kernelDir=n.wwwDir+"Kernel/",n.compiledKernel=n.kernelDir+"js/concat.js",n.uploadTmpUrl=s+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//localhost/tsite/tonyu/project/newVersion.cgi"):(n.uploadTmpUrl=s+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//www.tonyu.jp/project/newVersion.cgi"),n.version=2,n.hoge="fuga",t.setEnvProvider(new t.Env(n)),window.WebSite=n;case"singleHTML":if(n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},"object"==typeof BuiltinAssets)for(var a in BuiltinAssets)n.urlAliases[a]=BuiltinAssets[a];return n.tonyuHome="/Tonyu/",n.projects=[r.rel(n.tonyuHome,"Projects/")],n.scriptServer=i.match(/localhost\/tonyu2/)?"http://localhost/tonyu2/":"https://edit.tonyu.jp/",n.pluginTop=n.scriptServer+"js/plugins",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.PathSep="/",n.compiledKernel=n.scriptServer+"Kernel/js/concat.js",t.setEnvProvider(new t.Env(n)),window.WebSite=n;case"multiHTML":return n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},n.tonyuHome="/Tonyu/",n.pluginTop=n.top+"/js/plugins",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.PathSep="/",n.mp4Disabled=n.isNW,n.isNW&&(n.PathSep=require("path").sep,n.cwd=r.directorify(process.cwd().replace(/\\/g,"/")),n.platform=process.platform),t.setEnvProvider(new t.Env(n)),window.WebSite=n}if(i.match(/jsrun\.it/))n={urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png"},top:"",devMode:o,pluginTop:"https://edit.tonyu.jp/js/plugins",removeJSOutput:!0};else if(i.match(/tonyuexe\.appspot\.com/)||i.match(/localhost:8887/)||i.match(/\/html\/((dev)|(build))\//))n={urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/sound_ogg.png":"../../images/sound_ogg.png","images/sound_mp3.png":"../../images/sound_mp3.png","images/sound_mp4.png":"../../images/sound_mp4.png","images/sound_m4a.png":"../../images/sound_m4a.png","images/sound_mid.png":"../../images/sound_mid.png","images/sound_wav.png":"../../images/sound_wav.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:o};else if(i.match(/bitarrow/)||i.match(/localhost.*pub/)){n={};var u=n;n.serverType="BA",u.runtime="../../../runtime/",u.urlAliases={"images/base.png":u.runtime+"images/base.png","images/Sample.png":u.runtime+"images/Sample.png","images/neko.png":u.runtime+"images/neko.png","images/mapchip.png":u.runtime+"images/mapchip.png","images/sound.png":u.runtime+"images/sound.png","images/sound_ogg.png":u.runtime+"images/sound_ogg.png","images/sound_mp3.png":u.runtime+"images/sound_mp3.png","images/sound_mp4.png":u.runtime+"images/sound_mp4.png","images/sound_m4a.png":u.runtime+"images/sound_m4a.png","images/sound_mid.png":u.runtime+"images/sound_mid.png","images/sound_wav.png":u.runtime+"images/sound_wav.png","images/ecl.png":u.runtime+"images/ecl.png"}}else n={urlAliases:{},top:".",devMode:o};if("object"==typeof BuiltinAssets)for(var a in BuiltinAssets)n.urlAliases[a]=BuiltinAssets[a];n.builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/neko.png":1,"images/mapchip.png":1};var c=window.navigator.userAgent.toLowerCase();return n.tablet=-1!=c.indexOf("windows")&&-1!=c.indexOf("touch")||-1!=c.indexOf("ipad")||-1!=c.indexOf("android")&&-1==c.indexOf("mobile")||-1!=c.indexOf("firefox")&&-1!=c.indexOf("tablet")||-1!=c.indexOf("kindle")||-1!=c.indexOf("silk")||-1!=c.indexOf("playbook"),n.mobile=-1!=c.indexOf("windows")&&-1!=c.indexOf("phone")||-1!=c.indexOf("iphone")||-1!=c.indexOf("ipod")||-1!=c.indexOf("android")&&-1!=c.indexOf("mobile")||-1!=c.indexOf("firefox")&&-1!=c.indexOf("mobile")||-1!=c.indexOf("blackberry"),n.pluginTop||(n.pluginTop=n.top+"/js/plugins"),n.disableROM={},(i.match(/\.appspot\.com/)||i.match(/localhost:888[87]/))&&(n.serverType="GAE"),i.match(/localhost:3000/)&&(n.serverType="Node"),n.serverTop=i.match(/tonyuexe\.appspot\.com/)||i.match(/localhost:8887/)?n.top+"/exe":n.top+"/edit",n.sampleImg=n.top+"/images",n.blobPath=n.serverTop+"/serveBlob",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.mp4Disabled=n.isNW,n.tonyuHome="/Tonyu/",n.url={getDirInfo:n.serverTop+"/getDirInfo",getFiles:n.serverTop+"/File2LSSync",putFiles:n.serverTop+"/LS2FileSync"},n.PathSep="/",n.isNW?(n.PathSep=require("path").sep,n.cwd=r.directorify(process.cwd().replace(/\\/g,"/")),n.tonyuHome=process.env.TONYU_HOME?r.directorify(process.env.TONYU_HOME):r.rel(n.cwd,"fs/Tonyu/"),n.logdir=process.env.TONYU_LOGDIR,n.wwwDir=r.rel(n.cwd,"www/"),n.platform=process.platform,n.ffmpeg=r.rel(n.cwd,"win32"==n.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),n.pkgInfo=require(r.rel(n.cwd,"package.json")),n.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):n.pkgInfo&&n.pkgInfo.config&&n.pkgInfo.config.prjDirs?n.pkgInfo.config.prjDirs.map(function(t){return t=r.directorify(t),r.isAbsolute(t)?t:r.rel(n.cwd,t)
}):[r.rel(n.cwd,"Projects/"),r.rel(n.tonyuHome,"Projects/")],n.kernelDir=r.rel(n.wwwDir,"Kernel/")):(n.wwwDir=s+"//"+location.host+"/",n.projects=[r.rel(n.tonyuHome,"Projects/")]),(i.match(/edit\.tonyu\.jp/)||i.match(/tonyuedit\.appspot\.com/)||i.match(/localhost:888/))&&(n.kernelDir=s+"//"+location.host+"/Kernel/"),n.compiledKernel=i.match(/edit\.tonyu\.jp/)||i.match(/tonyuedit\.appspot\.com/)||i.match(/localhost:888/)||n.isNW?n.kernelDir+"js/concat.js":"BA"===n.serverType?n.runtime+"lib/tonyu/kernel.js":"https://edit.tonyu.jp/Kernel/js/concat.js",i.match(/localhost\/tonyu2/)?(n.wwwDir=s+"//"+location.host+"/tonyu2/",n.kernelDir=n.wwwDir+"Kernel/",n.compiledKernel=n.kernelDir+"js/concat.js",n.uploadTmpUrl=s+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//localhost/tsite/tonyu/project/newVersion.cgi"):(n.uploadTmpUrl=s+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//www.tonyu.jp/project/newVersion.cgi"),i.match(/((index)|(project))2/)&&(n.version=2,n.devMode=n.isNW?!0:!1),t.setEnvProvider(new t.Env(n)),window.WebSite=n}),i.setName("plugins"),n(["WebSite"],function(t){function e(t){var e=window;return t.split(".").forEach(function(t){e&&(e=e[t])}),e}function n(t){return"function"==typeof t&&(t={onload:t}),t||(t={}),t.onload||(t.onload=function(){}),t}var o={},s={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/BodyActor/,symbol:"Box2D"},timbre:{src:"timbre.js",symbol:"T"},gif:{src:"gif-concat.js",detection:/GIFWriter/,symbol:"GIF"},Mezonet:{src:"Mezonet.js",symbol:"Mezonet"},PicoAudio:{src:"PicoAudio.min.js",symbol:"PicoAudio"},jquery_ui:{src:"jquery-ui.js",detection:/\$InputBox/,symbol:"$.ui"}};return o.installed=s,o.detectNeeded=function(t,e){for(var n in s){var r=s[n].detection;if(r){var i=r.exec(t);i&&(e[n]=1)}}return e},o.loaded=function(t){var n=s[t];if(!n)throw new Error("plugin not found: "+t);return e(n.symbol)},o.loadAll=function(t,e){function r(){u>=i.length?e.onload():o.load(i[u++],r)}e=n(e);var i=[];for(var a in t)s[a]&&!o.loaded(a)&&i.push(a);var u=0;console.log("loading plugins",i),setTimeout(r,0)},o.load=function(e,o){var a=s[e];if(!a)throw new Error("plugin not found: "+e);o=n(o);var u,c=t.pluginTop+"/"+a.src;if("undefined"==typeof i?"function"==typeof r&&(u=r):i.real&&(u=i.real.requirejs),u)c=c.replace(/\.js$/,""),console.log("Loading plugin via requirejs",c),u([c],function(t){!window[a.symbol]&&t&&(window[a.symbol]=t),o.onload(t)});else{console.log("Loading plugin via <script>",c);var f=document.createElement("script");f.src=c,f.onload=o.onload,document.body.appendChild(f)}},o.request=function(t){if(!o.loaded(t)){var e=new Error("Plugin "+t+" required");e.pluginName=t}},o}),i.setName("DeferredUtil"),n(["FS"],function(t){return t.DeferredUtil}),i.setName("assert"),n(["FS"],function(t){return t.assert}),i.setName("compiledProject"),n(["DeferredUtil","WebSite","assert"],function(t,e,n){var r=function(r,i){return n.is(arguments,[String,String]),{getNamespace:function(){return r},sourceDir:function(){return null},getDependingProjects:function(){return[]},loadDependingClasses:function(e){var n=t.directPromise(),r=this.getNamespace();return this.getDependingProjects().forEach(function(t){t.getNamespace()!=r&&(n=n.then(function(){return t.loadClasses(e)}))}),n},loadClasses:function(t){console.log("Loading compiled classes ns=",r,"url=",i);var n=i+("BA"===e.serverType?"?"+Math.random():""),o=(window.navigator.userAgent.toLowerCase(),this);return this.loadDependingClasses(t).then(function(){return o.requirejs(n)}).then(function(){console.log("Done Loading compiled classes ns=",r,"url=",n,Tonyu.classes)})},requirejs:function(e){return t.promise(function(t){var n=document.getElementsByTagName("head")[0]||document.documentElement,r=document.createElement("script");"string"==typeof tonyu_app_version&&(e+="?"+tonyu_app_version),r.src=e;var i=!1;r.onload=r.onreadystatechange=function(){i||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i=!0,console.log("Done load ",e),r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r),t())},n.insertBefore(r,n.firstChild)})},loadClassesOLD:function(t){console.log("Load compiled classes ns=",r,"url=",i);var n=new $.Deferred,o=document.getElementsByTagName("head")[0]||document.documentElement,s=document.createElement("script");s.src=i+("BA"===e.serverType?"?"+Math.random():"");var a=!1;return s.onload=s.onreadystatechange=function(){a||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(a=!0,s.onload=s.onreadystatechange=null,o&&s.parentNode&&o.removeChild(s),console.log("Done Load compiled classes ns=",r,"url=",i,Tonyu.classes),n.resolve())},this.loadDependingClasses(t).then(function(){o.insertBefore(s,o.firstChild)}),n.promise()}}};return r}),i.setName("compiledTonyuProject"),n(["plugins","compiledProject"],function(t,e){var n=function(n,r,i){var o=e(n,r),s=e("kernel",WebSite.compiledKernel),a={getDir:function(){return i},getDependingProjects:function(){return[s]},getOptions:function(){var t=this.getDir().rel("options.json");return t.obj()},getResource:function(){var t=this.getDir().rel("res.json");return t.obj()},loadPlugins:function(e){var n=this.getOptions();return t.loadAll(n.plugins,e)},requestPlugin:function(){},run:function(t){var e={classes:Tonyu.classMetas};this.loadClasses(e).then(function(){Tonyu.run(t)})}};for(var u in a)o[u]=a[u];return o};return n}),i.setName("Shell"),n(["FS","assert"],function(t,e){function n(e,n){var i=r(e);if(t.SFile.is(i)||console.log(i," is not file"),n&&!i.exists())throw new Error(i+": no such file or directory");return i}function r(e){if("string"!=typeof e)return e;var n=i.cwd;return o.isAbsolutePath(e)?t.resolve(e,n):n.rel(e)}var i={},o=e(t.PathUtil);return i.newCommand=function(t,e){this[t]=e},i.cd=function(t){return i.cwd=n(t,!0),i.pwd()},i.vars=Object.create(t.getEnv()),i.mount=function(e,n){if(!e||!e.t){var r=[];for(var i in t.getRootFS().availFSTypes())r.push(i);return void sh.err("-t=("+r.join("|")+") should be specified.")}t.mount(n,e.t,e)},i.unmount=function(e){t.unmount(e)},i.fstab=function(){var e=t.getRootFS(),n=e.fstab(),r=this;n.forEach(function(t){r.echo(t.fstype()+"	"+(t.mountPoint||"<Default>"))})},i.resolve=n,i.pwd=function(){return i.cwd+""},i.ls=function(t){return t=t?n(t,!0):i.cwd,t.ls()},i.cp=function(t,e,r){r||(r={}),r.v&&(i.echo("cp",t,e),r.echo=i.echo.bind(i));var o=n(t,!0),s=n(e);return o.copyTo(s,r)},i.ln=function(t,e,r){var i=n(e),o=n(t,!0);if(i.isDir()&&i.exists()&&(i=i.rel(o.name())),i.exists())throw new Error(i+" exists");return i.link(o,r)},i.rm=function(t,e){if(e||(e={}),e.notrash)return t=n(t,!1),t.removeWithoutTrash(),1;if(t=n(t,!0),t.isDir()&&e.r){var r=t,o=0;return r.each(function(t){t.exists()&&(o+=i.rm(t,e))}),r.rm(),o+1}return t.rm(),1},i.mkdir=function(t){if(t=n(t,!1),t.exists())throw new Error(t+" : exists");return t.mkdir()},i.cat=function(t){return t=n(t,!0),i.echo(t.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}))},i.resolve=function(t){return t||(t="."),t=n(t)},i.grep=function(t,e,r){function o(t,e,n){r.res&&r.res.push({file:t,lineNo:e,line:n}),i.echo(t+"("+e+"): "+n)}return e=n(e,!0),r||(r={}),r.res||(r.res=[]),e.isDir()?e.each(function(e){i.grep(t,e,r)}):"string"==typeof t&&e.lines().forEach(function(n,r){n.indexOf(t)>=0&&o(e,r+1,n)}),r.res},i.touch=function(t){return t=n(t),t.text(t.exists()?t.text():""),1},i.setout=function(t){i.outUI=t},i.echo=function(){return $.when.apply($,arguments).then(function(){console.log.apply(console,arguments),i.outUI&&i.outUI.log&&i.outUI.log.apply(i.outUI,arguments)})},i.err=function(t){console.log.apply(console,arguments),t&&t.stack&&console.log(t.stack),i.outUI&&i.outUI.err&&i.outUI.err.apply(i.outUI,arguments)},i.clone=function(){var t=Object.create(this);return t.vars=Object.create(this.vars),t},i.getvar=function(t){return this.vars[t]||process&&process.env[t]},i.get=i.getvar,i.set=function(t,e){return this.vars[t]=e},i.strcat=function(){if(1==arguments.length)return arguments[0];for(var t="",e=0;e<arguments.length;e++)t+=arguments[e];return t},i.exists=function(t){return t=this.resolve(t),t.exists()},i.dl=function(t){return t=this.resolve(t||"."),t.download()},i.zip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.zip.apply(t.zip,n)},i.unzip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.unzip.apply(t.zip,n)},i.prompt=function(){},i.ASYNC={r:"SH_ASYNC"},i.help=function(){for(var t in i){var e=i[t];"function"==typeof e&&i.echo(t+(e.description?" - "+e.description:""))}},window.sh||(window.sh=i),"object"==typeof process?(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()},sh.cd(process.cwd().replace(/\\/g,"/"))):sh.cd("/"),i}),i.setName("Klass"),n(["assert"],function(t){function e(t){var e=/function[^\(]*\(([^\)]*)\)/,n=e.exec(t+"");return n?n[1].replace(/\s/g,"").split(","):[]}function n(t){if("object"!=typeof t)return!1;if(!t)return!1;var e={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},n=0;for(var r in t){if(!e[r])return!1;n+=e[r]}return n}var r={};return r.define=function(i){function o(e){i.$fields&&t.is(e,i.$fields)}function s(t){if(!l)return t;var n=e(t);return n[0]!==l?t:function(){var e=Array.prototype.slice.call(arguments);return e.unshift(y),t.apply(y,e)}}function a(t){if(!f)return t;if(n(t)){for(var r in t)t[r]=a(t[r]);return t}if("function"!=typeof t)return t;if(f!==!0){var i=e(t);if(i[0]!==f)return g=!0,t;p=!0}return d=!0,function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),t.apply(this,e)}}var u,c;i.$parent?(c=i.$parent,u=Object.create(c.prototype),u.super=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return c.prototype[e].apply(this,t)}):u={};var f,l;i.$this&&(f=i.$this),i.$singleton&&(l=i.$singleton);var h,p,d,g,m=a(i.$)||function(t){if(t&&"object"==typeof t)for(var e in t)this[e]=t[e]};m instanceof Array&&(h=m,m=function(){for(var t=Array.prototype.slice.call(arguments),e=0;e<h.length;e++)t.length>0&&(this[h[e]]=t.shift())});var y;y=function(){if(!(this instanceof y)){var t=Object.create(u);return m.apply(t,arguments),o(t),t}m.apply(this,arguments),o(this)},c&&(y.super=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift();return c.prototype[n].apply(e,t)}),y.inherit=function(t){return t.$parent=y,r.define(t)},y.prototype=u;for(var v in i)"$"!=v[0]&&("static$"==v.substring(0,7)?y[v.substring(7)]=s(i[v]):n(i[v])?Object.defineProperty(u,v,a(i[v])):u[v]=a(i[v]));if(u.$=m,Object.defineProperty(u,"$bind",{get:function(){return this.__bounded||(this.__bounded=new r.Binder(this)),this.__bounded}}),p){console.warn(g?"Use python style in all methods and Use $this:true instead":"Use $this:true instead");try{throw new Error("Trace")}catch(b){console.log(b.stack)}}return y},r.Function=function(){throw new Error("Abstract")},r.opt=t.opt,r.Binder=r.define({$this:!0,$:function(t,e){function n(n){"function"==typeof e[n]&&(t[n]=function(){var t=Array.prototype.slice.call(arguments);return e[n].apply(e,t)})}for(var r in e)n(r)}}),r}),i.setName("Tonyu.Thread"),n(["DeferredUtil","Klass"],function(t,e){var n={enterC:{},exitC:0},r=1;try{window.cnts=n}catch(i){}var o=e.define({$:function(){this.frame=null,this._isDead=!1,this.cnt=0,this._isWaiting=!1,this.fSuspended=!1,this.tryStack=[],this.preemptionTime=60,this.onEndHandlers=[],this.onTerminateHandlers=[],this.id=r++,this.age=0},isAlive:function(){return!this.isDead()},isDead:function(){return this._isDead=this._isDead||null==this.frame||this._threadGroup&&(this._threadGroup.objectPoolAge!=this.tGrpObjectPoolAge||this._threadGroup.isDeadThreadGroup())},setThreadGroup:function(t){this._threadGroup=t,this.tGrpObjectPoolAge=t.objectPoolAge},isWaiting:function(){return this._isWaiting},suspend:function(){this.fSuspended=!0,this.cnt=0},enter:function(t){this.frame={prev:this.frame,func:t}},apply:function(t,e,n){n||(n=[]);var r;if("string"==typeof e&&(r=t["fiber$"+e],!r))throw new Error(""+e+"");if("function"==typeof e&&(r=e.fiber,!r)){var i=e.methodInfo?e.methodInfo.name:e.name;throw new Error(""+i+"")}n=[this].concat(n);var o=0;return this.enter(function(e){switch(o){case 0:r.apply(t,n),o=1;break;case 1:e.termStatus="success",e.notifyEnd(e.retVal),n[0].exit(),o=2}})},notifyEnd:function(t){this.onEndHandlers.forEach(function(e){e(t)}),this.notifyTermination({status:"success",value:t})},notifyTermination:function(t){this.onTerminateHandlers.forEach(function(e){e(t)})},on:function(t,e){("end"===t||"success"===t)&&this.onEndHandlers.push(e),"terminate"===t&&(this.onTerminateHandlers.push(e),this.handleEx&&delete this.handleEx)},promise:function(){var e=this;return t.funcPromise(function(t,n){e.on("terminate",function(e){"success"===e.status?t(e.value):n("exception"===e.status?e.exception:new Error(e.status))})})},then:function(t,e){return e?this.proimse().then(t,e):this.proimse().then(t)},fail:function(t){return this.promise().fail(t)},gotoCatch:function(t){var e=this;if(0==e.tryStack.length)return e.termStatus="exception",e.kill(),void(e.handleEx?e.handleEx(t):e.notifyTermination({status:"exception",exception:t}));e.lastEx=t;for(var n=e.tryStack.pop();e.frame;){if(n.frame===e.frame){e.catchPC=n.catchPC;break}e.frame=e.frame.prev}},startCatch:function(){var t=this,e=t.lastEx;return t.lastEx=null,e},exit:function(t){this.frame=this.frame?this.frame.prev:null,this.retVal=t},enterTry:function(t){var e=this;e.tryStack.push({frame:e.frame,catchPC:t})},exitTry:function(){var t=this;t.tryStack.pop()},waitEvent:function(t,e){var n=this;if(n.suspend(),t.on){var r;e=e.concat(function(){n.lastEvent=arguments,n.retVal=arguments[0],r.remove(),n.steps()}),r=t.on.apply(t,e)}},runAsync:function(t){var e=this,n=function(){e.retVal=arguments,e.steps()},r=function(){for(var t="",n=0;n<arguments.length;n++)t+=arguments[n]+",";0==t.length&&(t="Async fail");var r=new Error(t);r.args=arguments,e.gotoCatch(r),e.steps()};e.suspend(),setTimeout(function(){t(n,r)},0)},waitFor:function(e){var n=this;return n._isWaiting=!0,n.suspend(),e instanceof o&&(e=e.promise()),t.ensureDefer(e).then(function(t){n.retVal=t,n.stepsLoop()}).fail(function(t){n.gotoCatch(n.wrapError(t)),n.stepsLoop()})},wrapError:function(t){if(t instanceof Error)return t;var e=new Error(t);return e.original=t,e},resume:function(t){this.retVal=t,this.steps()},steps:function(){var t=this;if(!t.isDead()){var e=Tonyu.currentThread;for(Tonyu.currentThread=t,t.cnt=t.preemptionTime,t.preempted=!1,t.fSuspended=!1;t.cnt>0&&t.frame;)try{for(;t.cnt-->0&&t.frame;)t.frame.func(t);t.preempted=!t.fSuspended&&t.isAlive()}catch(n){t.gotoCatch(n)}Tonyu.currentThread=e}},stepsLoop:function(){var t=this;t.steps(),t.preempted&&setTimeout(function(){t.stepsLoop()},0)},kill:function(){var t=this;t._isDead=!0,t.frame=null,t.termStatus||(t.termStatus="killed",t.notifyTermination({status:"killed"}))},clearFrame:function(){this.frame=null,this.tryStack=[]}});return o}),i.setName("Tonyu.Iterator"),n(["Klass"],function(t){function e(t,e){if(t.tonyuIterator)return t.tonyuIterator(e);if(t instanceof Array)return 1==e?new n(t):new r(t);if(t instanceof Object)return 1==e?new i(t):new o(t);throw console.log(t),new Error(t+" is not iterable")}var n=t.define({$:function(t){this.set=t,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.set[this.i],this.i++,!0)}}),r=t.define({$:function(t){this.set=t,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.i,this[1]=this.set[this.i],this.i++,!0)}}),i=t.define({$:function(t){this.elems=[];for(var e in t)this.elems.push(e);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i],this.i++,!0)}}),o=t.define({$:function(t){this.elems=[];for(var e in t)this.elems.push([e,t[e]]);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i][0],this[1]=this.elems[this.i][1],this.i++,!0)}});return e}),i.setName("Tonyu"),"function"!=typeof n&&(n=require("requirejs").define),n(["assert","Tonyu.Thread","Tonyu.Iterator","DeferredUtil"],function(t,e,n,r){return Tonyu=function(){function i(){var t=new e;return t.handleEx=a,t}function o(t){return r.funcPromise(function(e){setTimeout(e,t)})}function s(){return r.funcPromise(function(t){requestAnimationFrame(t)})}function a(t){if(!Tonyu.onRuntimeError)throw"undefined"==typeof $LASTPOS&&($LASTPOS=0),alert("! at "+$LASTPOS+"   : "+t),console.log(t.stack),t;Tonyu.onRuntimeError(t)}function u(e,n){return t.is(arguments,[String,Object]),f(klass.getMeta(e),n)}function c(t,e){return t?f(Object.create(t.prototype),e):f({},e)}function f(t,e){if(e&&"object"==typeof e)for(var n in e)t[n]=e[n];return t}function l(t,e){P[t]=e}function h(t){return P[t]}function p(t){var e=t.split("."),n=D;if(e.forEach(function(t){n&&(n=n[t])}),!n&&1==e.length){var r;for(var i in D){var o=D[i][t];if(o){if(n)throw new Error(" "+i+"."+t+", "+r);n=o,r=i+"."+t}}}return n}function d(t,e){if("function"!=typeof e)return e;var n=function(){return e.apply(t,arguments)};return n.methodInfo=Tonyu.extend({thiz:t},e.methodInfo||{}),e.fiber&&(n.fiber=function(){return e.fiber.apply(t,arguments)},n.fiber.methodInfo=Tonyu.extend({thiz:t},e.fiber.methodInfo||{})),n}function g(t,e,n,r){if(!t)throw new Error(r+"(="+t+") "+e+"");var i=t[e];if("function"!=typeof i)throw new Error(("this"==r?"":r+".")+e+"(="+i+")");return i.apply(t,n)}function m(t,e,n){if("function"!=typeof t)throw new Error(n+"");return t.apply({},e)}function y(t,e){if(t!=t||null==t)throw new Error(e+"(="+t+")");return t}function v(t){for(var e=[],n=1;n<t.length;n++)e[n-1]=t[n];return e}function b(t){throw new Error(""+t+"new")}function w(t){throw console.log("Not a tonyu object: ",t),new Error(t+" is not a tonyu object")}function S(t,e){return t in e}function A(t){var e=p(t);if(!e)throw new Error(t+" ");Tonyu.runMode=!0;var n,r=new e;(n=Tonyu.currentProject)&&(n.runningObj=r),$LASTPOS=0}function x(){var t=performance.now();if(t-L>1e3)throw T(1e4),new Error("\n    \n   []https://edit.tonyu.jp/doc/options.html\n");E=t}function T(t){L=performance.now()+(t||0)}function B(t,e){return t?t instanceof e?!0:"function"==typeof t.getClassInfo&&e.meta?t.getClassInfo().includesRec[e.meta.fullName]:!1:!1}"undefined"==typeof performance&&(window.performance={}),performance.now||(performance.now=function(){return Date.now()});klass=function(){throw alert(" Deprecated. compile again."),new Error(" Deprecated. compile again.")},klass.addMeta=u,klass.removeMeta=function(t){delete M[t]},klass.getMeta=function(t){if("function"==typeof t)return t.meta;if("string"==typeof t){var e=M[t];return e||(M[t]=e={}),e}},klass.ensureNamespace=function(t,e){var n,r=e.split("."),i=t;for(n=0;n<r.length;n++){var o=r[n];i[o]||(i[o]={}),i=i[o]}return i},Function.prototype.constructor=function(){throw new Error("This method should not be called")},klass.propReg=/^__([gs]et)ter__(.*)$/,klass.define=function(t){function e(t,n){if(n=n||{},n.isShim)return t;if(n.path=n.path||[],n.path.push(t),t.isShim)throw console.log("chkmeta::ctx",n),new Error("Shim found "+t.extenderFullName);if(t.superclass&&e(t.superclass,n),!t.includes)throw console.log("chkmeta::ctx",n),new Error("includes not found");return t.includes.forEach(function(t){e(t,n)}),n.path.pop(),t}function n(t,n){if(!t.prototype.hasOwnProperty("getClassInfo"))throw new Error("NO");if(!t.meta)throw console.log("metanotfound",t),new Error("meta not found");return e(t.meta,n),t}function r(t,e){var r=!e.init,i=e.includesRec;if(i[a])return t;i[a]=!0,s.forEach(function(n){t=n.extendFrom(t,f(e,{init:!1}))});var o="function"==typeof p?p(t):p;"undefined"!=typeof Profiler&&Profiler.profile(o,a);var g=o.initialize;delete o.initialize;var m;m=g?function(){this instanceof m||b(a),g.apply(this,arguments)}:t?function(){this instanceof m||b(a),t.apply(this,arguments)}:function(){this instanceof m||b(a)},m.prototype=c(t,{constructor:m}),m.meta=r?{isShim:!0,extenderFullName:a}:u(a,{fullName:a,shortName:l,namespace:h,decls:d,superclass:e.nonShimParent?e.nonShimParent.meta:null,includesRec:i,includes:s.map(function(t){return t.meta})}),m.meta.func=m,m.methods=o;var y=m.prototype,v={},w=klass.propReg;for(var S in o)if(!S.match(/^fiber\$/)){y[S]=o[S];var A="fiber$"+S;if(o[A]&&(y[A]=o[A],y[A].methodInfo=y[A].methodInfo||{name:S,klass:m,fiber:!0},y[S].fiber=y[A]),"__dummy"!==S&&!y[S])throw console.log("WHY!",y[S],y,S),new Error("WHY!"+S);y[S].methodInfo=y[S].methodInfo||{name:S,klass:m};var x=w.exec(S);x&&(v[x[2]]=v[x[2]]||{},v[x[2]][x[1]]=y[S])}y.isTonyuObject=!0;for(var S in v)Object.defineProperty(y,S,v[S]);return y.getClassInfo=function(){return m.meta},n(m,{isShim:r})}var i,o=t.superclass,s=t.includes,a=t.fullName,l=t.shortName,h=t.namespace,p=t.methods,d=t.decls,g=klass.ensureNamespace(Tonyu.classes,h),m=r(o,{init:!0,initFullName:a,includesRec:o?f({},o.meta.includesRec):{},nonShimParent:o});return m.extendFrom=r,g[l]=m,i=m,n(m,{isShim:!1})},klass.isSourceChanged=function(t){return t=t.meta||t,t.src&&t.src.tonyu?t.nodeTimestamp?t.src.tonyu.lastUpdate()>t.nodeTimestamp:!0:!1},klass.shouldCompile=function(t){if(t=t.meta||t,t.hasSemanticError)return!0;if(klass.isSourceChanged(t))return!0;for(var e=klass.getDependingClasses(t),n=0;n<e.length;n++)if(klass.shouldCompile(e[n]))return!0},klass.getDependingClasses=function(t){t=t.meta||t;var e=[];return t.superclass&&(e=[t.superclass]),t.includes&&(e=e.concat(t.includes)),e};var E,P={},D={},M={},L=performance.now();return setInterval(T,16),Tonyu={thread:i,klass:klass,bless:c,extend:f,globals:P,classes:D,classMetas:M,setGlobal:l,getGlobal:h,getClass:p,timeout:o,animationFrame:s,bindFunc:d,not_a_tonyu_object:w,is:B,hasKey:S,invokeMethod:g,callFunc:m,checkNonNull:y,run:A,iterator:n,checkLoop:x,resetLoopCheck:T,DeferredUtil:r,VERSION:1561952367866,A:v}}()}),i.setName("PatternParser"),n(["Tonyu"],function(t){var e=function(t,e){this.options=e||{},this.img=t,this.height=t.height,this.width=t.width;var n=this.newImage(t.width,t.height),r=n.getContext("2d");r.drawImage(t,0,0),this.ctx=r,this.pixels=this.ctx.getImageData(0,0,t.width,t.height).data,this.base=this.getPixel(0,0)};return t.extend(e.prototype,{newImage:function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n},getPixel:function(t,e){var n=this.pixels,r=4*(t+e*this.width),i=n[0+r],o=n[1+r],s=n[2+r],a=n[3+r];return 256*(256*(256*a+s)+o)+i},setPixel:function(t,e,n){var r=4*(t+e*this.width);this.pixels[0+r]=255&n,n=(n-(255&n))/256,this.pixels[1+r]=255&n,n=(n-(255&n))/256,this.pixels[2+r]=255&n,n=(n-(255&n))/256,this.pixels[3+r]=255&n},parse:function(){try{for(var t=[],e=0;e<this.height;e++)for(var n=0;n<this.width;n++){var r=this.getPixel(n,e);r!=this.base&&t.push(this.parse1Pattern(n,e))}return t}catch(i){if(i.isParseError)return console.log("parse error! "+i),[{image:this.img,x:0,y:0,width:this.width,height:this.height}];throw i}},parse1Pattern:function(t,e){function n(t){return t}function r(t,e,n){return{toString:function(){return"at ("+t+","+e+") :"+n},isParseError:!0}}for(var i=this.getPixel(t,e),o=t,s=e,a=this.base,u=this.width,c=this.height;u>o;){var f=this.getPixel(o,s);if(f!=i)break;o++}if(o>=u||this.getPixel(o,s)!=a)throw r(o,s,n(this.getPixel(o,s))+"!="+n(a));for(o--;c>s&&this.getPixel(o,s)==i;)s++;if(s>=c||this.getPixel(o,s)!=a)throw r(o,s,n(this.getPixel(o,s))+"!="+n(a));s--;var l=t+1,h=e+1,p=o-l,d=s-h;if(p*d==0)throw r(o,s,"w*h==0");for(var g=this.newImage(p,d),m=g.getContext("2d"),y=m.getImageData(0,0,p,d),v=y.data,b=0,w=h;s>w;w++)for(var S=l;o>S;S++){var A=this.getPixel(S,w);A==i?(v[b++]=0,v[b++]=0,v[b++]=0,v[b++]=0):(v[b++]=255&A,A=(A-(255&A))/256,v[b++]=255&A,A=(A-(255&A))/256,v[b++]=255&A,A=(A-(255&A))/256,v[b++]=255&A)}m.putImageData(y,0,0);for(var x=h-1;s>=x;x++)for(var T=l-1;o>=T;T++)this.setPixel(T,x,a);return this.options.boundsInSrc?{x:l,y:h,width:p,height:d}:{image:g,x:0,y:0,width:p,height:d}}}),e}),i.setName("Util"),Util=function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:e(i[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function r(t,e){return t.substring(0,e.length)===e}function i(t){function e(e){throw console.log(e),console.log(t,c),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var r,i=t.length,o=0,s=0;if(!i)return new ArrayBuffer(0);r=Math.floor(i/4*3),"="==t.charAt(i-1)&&(r-=1),"="==t.charAt(i-2)&&(r-=1);for(var a=new ArrayBuffer(r),u=new Uint8Array(a),c=0,f=0;r>f&&(s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),o=s<<2,c++,s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),u[f]=o|s>>4&3,o=(15&s)<<4,c++,f++,!(f>=r))&&(s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),u[f]=o|s>>2&15,o=(3&s)<<6,c++,f++,!(f>=r));)s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),u[f]=o|s,c++,f++;return a}function o(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,o=0,s=0,a=0;i>a&&(s=r[a],n+=e[s>>2],o=(3&s)<<4,a++,!(a>=i))&&(s=r[a],n+=e[o|s>>4],o=(15&s)<<2,a++,!(a>=i));)s=r[a],n+=e[o|s>>6],n+=e[63&s],a++;var u=i%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n}function s(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){var e=r.apply(t,arguments);return e})}(n);return e}function a(){return"undefined"!=typeof Buffer}function u(t){return a()&&t instanceof Buffer}function c(t){return t instanceof ArrayBuffer||u(t)}function f(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(r){throw console.log(e.join("")),r}}function l(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer}return{getQueryString:t,endsWith:n,startsWith:r,Base64_To_ArrayBuffer:i,Base64_From_ArrayBuffer:o,utf8bytes2str:f,str2utf8bytes:l,privatize:s,hasNodeBuffer:a,isNodeBuffer:u,isBuffer:c}}(),n("Util",[],function(){return Util}),i.setName("Assets"),n(["WebSite","Util","Tonyu","FS"],function(t,e,n,r){var i={};return i.resolve=function(n,i,o){o=o||{};var s=r.isFile(i)?i:i.getDir();if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,n){return t[n]}),t.urlAliases[n]&&(n=t.urlAliases[n]),e.startsWith(n,"ls:")){var a=n.substring("ls:".length);if(!s)throw new Error("Basedir not specified");var u=s.rel(a);if(!u.exists())throw new Error("Resource file not found: "+u);if(t.mp3Disabled&&a.match(/\.(mp3)$/)||t.mp4Disabled&&a.match(/\.(mp4|m4a)$/)){var c=s.rel(a.replace(/\.(mp3|mp4|m4a)$/,".ogg"));c.exists()&&(u=c)}if(n=u.getURL(),o.asFile)return u}return n},n.Assets=i,i}),i.setName("ImageList"),n(["PatternParser","Util","Assets","assert"],function(t,e,n,r){function i(t){var e=[];return t.forEach(function(t){t&&""!=t.url&&e.push(t)}),e}var o,s={};return o=function(e,o,a){a||(a={}),e=i(e);var u=[],c=e.length;0==c&&setTimeout(function(){var t=[];t.names={},o(t)},0),e.forEach(function(e,i){function f(){var n,s;if("single"==e.type)u[i]=[{image:this,x:0,y:0,width:this.width,height:this.height}];else if((n=e.pwidth)&&(s=e.pheight)){for(var a=0,f=0,l=this.width,h=this.height,p=[];;){var d=n,g=s;if(a+n>l&&(d=l-a),f+s>h&&(g=h-f),p.push({image:this,x:a,y:f,width:d,height:g}),a+=n,a+n>l&&(a=0,f+=s,f+s>h))break}u[i]=p}else{var m=new t(this);u[i]=m.parse()}if(u[i].name=e.name,r.is(u[i],Array),c--,0==c){var y=[],v={};u.forEach(function(t){v[t.name]=y.length,y=y.concat(t)}),y.names=v,o(y)}}console.log("loading",e,i);var l=e.url,h=l;if(s[h])return void f.apply(s[h],[]);l=n.resolve(l,a.prj||a.baseDir);var p=$("<img>");p.load(function(){s[h]=this,f.apply(this,[])}),p.attr("src",l)})},o.load=o,o.parse1=function(e,n,i){var o,s,a;if((o=e.pwidth)&&(s=e.pheight)){for(var u=0,c=0,f=n.width,l=n.height,h=[];;)if(h.push({image:this,x:u,y:c,width:o,height:s}),u+=o,u+o>f&&(u=0,c+=s,c+s>l))break;a=h}else{var p=new t(n,i);a=p.parse()}return a.name=e.name,r.is(a,Array)},window.ImageList=o,o}),i.setName("T2MediaLib");var o=function(){var t=function(t){this.context=null,this.picoAudio=null,this.soundDataAry=[],this.bgmPlayerMax=16,this.bgmPlayerAry=[],this.masterVolume=1,this.seMasterVolume=1,this.bgmMasterVolume=1,this.playingAudio=null,this.audioVolume=1,this.audioTempo=1,this.audioDataAry={data:[]},this.seSources=[],this.init(t)};return t.prototype.init=function(t){if(!this.inited&&(this.inited=!0,!this.disabled&&(t?this.context=t:window.AudioContext?this.context=new AudioContext:window.webkitAudioContext?this.context=new webkitAudioContext:(this.context=null,console.log("Your browser does not support yet Web Audio API")),this.context)))for(var e=0;e<this.bgmPlayerMax;e++)this.bgmPlayerAry[e]=new s(this,e)},t.prototype.allClearSoundData=function(){var t=this.soundDataAry;for(var e in t)delete t[e]},t.prototype.clearSoundData=function(t){var e=this.soundDataAry;delete e[t]},t.prototype.allRemoveDecodedSoundData=function(){var t=this.soundDataAry;for(var e in t){var n=t[e];null!=n&&(n.isDecodeComplete()||n.isDecoding())&&n.removeDecodedData()}},t.prototype.removeDecodedSoundData=function(t){var e=this.soundDataAry[t];null!=e&&(e.isDecodeComplete()||e.isDecoding())&&e.removeDecodedData()},t.prototype.getMasterVolume=function(){return this.masterVolume},t.prototype.setMasterVolume=function(t){this.masterVolume=t;for(var e=0;e<this.bgmPlayerMax;e++){var n=this.bgmPlayerAry[e];n instanceof s&&n.onChangeBGMMasterVolume()}},t.prototype.createSoundFromArray=function(t,e,n){if(!this.context||this.disabled)return null;this.soundDataAry[t]=new a(t);for(var r=this.context,i=null!=e&&null!=n?2:1,o=r.createBuffer(i,array.length,r.sampleRate),s=o.getChannelData(0),u=null!=n?o.getChannelData(1):null,c=0;c<array.length;c++)s[c]=e[c];if(u)for(var c=0;c<array.length;c++)u[c]=n[c];this.soundDataAry[t].onDecodeComplete(o)},t.prototype.loadSound=function(t,e,n,r){if(!this.context||this.disabled)return null;this.soundDataAry[t]=new a(t),(e.match(/\.(midi?)$/)||e.match(/^data:audio\/mid/))&&null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context)),"object"==typeof WebSite&&WebSite.mp3Disabled&&(e=e.replace(/\.(mp3)$/,".ogg")),"object"==typeof WebSite&&WebSite.mp4Disabled&&(e=e.replace(/\.(mp4|m4a)$/,".ogg"));var i=this,o=new XMLHttpRequest;if(o.onload=function(){if(200===o.status||0===o.status){var e=o.response;e instanceof ArrayBuffer?(i.soundDataAry[t].onLoadComplete(e),r?i.decodeSound(t,n):n&&n.succ&&n.succ(t)):(i.soundDataAry[t].onError("XHR_RESPONSE_ERROR"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID))}else i.soundDataAry[t].onError("XHR_STATUS_ERROR"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID)
},o.onerror=function(e){console.log(e+""),i.soundDataAry[t].onError("XHR_ERROR"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID)},this.soundDataAry[t].onLoad(e),e.match(/^data:/)&&Util&&Util.Base64_To_ArrayBuffer)o={onload:o.onload},o.response=Util.Base64_To_ArrayBuffer(e.replace(/^data:audio\/[a-zA-Z0-9\-]+;base64,/i,"")),o.status=200,o.onload();else{o.open("GET",e,!0),o.responseType="arraybuffer";try{o.send(null)}catch(s){this.soundDataAry[t].onError("FILE_NOT_FOUND"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID)}}},t.prototype.decodeSound=function(t,e){var n=this.soundDataAry[t];if(null!=n&&null!=n.fileData&&n.isLoadComplete()&&!n.isDecodeComplete()){if(null==n.decodedCallbacksAry&&(n.decodedCallbacksAry=[]),e)if(null!=e.bgmPlayerId){var r=n.decodedCallbacksAry.some(function(t,r){return e.bgmPlayerId==t.bgmPlayerId?(n.decodedCallbacksAry[r]=e,!0):!1});r||n.decodedCallbacksAry.push(e)}else n.decodedCallbacksAry.push(e);if(!n.isDecoding()){n.onDecode();var i=n.fileData.slice(0);if(n.url.match(/\.(midi?)$/)||n.url.match(/^data:audio\/mid/)){null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context));var o=new Uint8Array(i),s=this.picoAudio.parseSMF(o);"string"==typeof s?(console.log("T2MediaLib: Error parseSMF()",s),this.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,this.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null):(this.soundDataAry[t].onDecodeComplete(s),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)}else if(n.url.match(/\.mzo$/)||n.url.match(/^data:audio\/mzo/)){console.log("Loading mzo");var a=this,u=Array.prototype.slice.call(new Uint8Array(i)),c=new Mezonet(this.context,u);c.toAudioBuffer(u).then(function(e){console.log("MZO loaded",e),a.soundDataAry[t].isDecoding()&&(a.soundDataAry[t].onDecodeComplete(e.decodedData),a.soundDataAry[t].loopStart=e.loopStart,a.soundDataAry[t].mezonet=e.mezonet,n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)},function(e){e instanceof Error?console.log("T2MediaLib: "+e.message,n.url):console.log("T2MediaLib: Error decodeMZO()",n.url),a.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,a.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null}).finally(function(){c.terminate()})}else{var a=this;if(n.url.match(/\.(ogg?)$/)||n.url.match(/^data:audio\/ogg/)){var f=this.searchOggLoop(i);n.tagLoopStart=f[0],n.tagLoopEnd=f[1]}var l=function(e){a.soundDataAry[t].isDecoding()&&(a.soundDataAry[t].onDecodeComplete(e),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)},h=function(e){e instanceof Error?console.log("T2MediaLib: "+e.message,n.url):console.log("T2MediaLib: Error decodeAudioData()",n.url),a.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,a.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null};this.context.decodeAudioData(i,l,h)}}}},t.prototype.activate=function(){if(this.init(),this.context){if(!this.isContextResumed&&this.context.resume){var t=this;this.context.resume().then(function(){t.isContextResumed=!0})}if(!this.isActivated){this.isActivated=!0;for(var e=this.context.createBuffer(1,Math.floor(this.context.sampleRate/32),this.context.sampleRate),n=e.getChannelData(0),r=0;r<n.length;r++)n[r]=0;var i=this.context.createBufferSource();i.buffer=e,i.connect(this.context.destination),i.start=i.start||i.noteOn,i.start(0)}}},t.prototype.getSoundFileData=function(t){var e=this.soundDataAry[t];return e?e.fileData:null},t.prototype.getSoundDecodedData=function(t){var e=this.soundDataAry[t];return e?e.decodedData:null},t.prototype.getCurrentTime=function(){return this.context?this.context.currentTime:null},t.prototype.playSE=function(t,e,n,r,i,o,s,a,u,c){if(!this.context)return null;var f=this.soundDataAry[t];if(null==f)return null;if(!f.isDecodeComplete()){var l=this,h={};return h.succ=function(t){l.playSE(t,e,n,r,i,o,s,a,u,c)},h.err=function(){},this.decodeSound(t,h),null}var p=f.decodedData;if(!(p instanceof AudioBuffer))return null;null==e&&(e=1),null==n&&(n=0),r||(r=1),i?i>p.duration?i=p.duration:0>i&&(i=0):i=0,durationStart=c,c||(durationStart=86400),o||(o=!1),s?0>s?s=0:s>p.duration&&(s=p.duration):s=f.loopStart||0,a?0>a?a=0:a>p.duration&&(a=p.duration):a=p.duration,u=u||0;var d=this.context.createBufferSource();this.context.createGain=this.context.createGain||this.context.createGainNode;var g=this.context.createGain(),m=this.context.createPanner();d.buffer=p,d.loop=o,d.loopStart=s,d.loopEnd=a,d.playbackRate.value=r,d.connect(g),g.connect(m),m.connect(this.context.destination),m.panningModel="equalpower",-1>n?n=-1:n>1&&(n=1);var y=90*n,v=Math.sin(y*(Math.PI/180)),b=-Math.cos(y*(Math.PI/180));(-1===n||1===n)&&(b=0),m.positionX?(m.positionX.value=v,m.positionY.value=0,m.positionZ.value=b):m.setPosition(v,0,b),g.gain.value=e*this.seMasterVolume*this.masterVolume;var w;w=o&&a-s>0&&i>a?a:i,d.gainNode=g,d.volumeValue=e,d.panNode=m,d.panValue=n,d.playStartTime=this.context.currentTime+u,d.playOffset=w,d.plusTime=w,d.start=d.start||d.noteOn,d.stop=d.stop||d.noteOff,d.start(u,i,durationStart),o&&null!=c&&d.stop(u+c);var S=this;return S.seSources.push(d),d.onended=function(){d.onended=null;var t=S.seSources.indexOf(d);t>=0&&S.seSources.splice(t,1)},d},t.prototype.stopSE=function(t){if(!(t instanceof AudioBufferSourceNode))return null;try{t.stop(0)}catch(e){t.gainNode&&(t.gainNode.gain.cancelScheduledValues(this.context.currentTime),t.gainNode.gain.linearRampToValueAtTime(0,this.context.currentTime))}return t},t.prototype.stopAllSE=function(){var t=this;this.seSources.forEach(function(e){t.stopSE(e)})},t.prototype.getSEMasterVolume=function(){return this.seMasterVolume},t.prototype.setSEMasterVolume=function(t){this.seMasterVolume=t},t.prototype.getSEVolume=function(t){return t instanceof AudioBufferSourceNode?source.volumeValue:null},t.prototype.setSEVolume=function(t,e){return t instanceof AudioBufferSourceNode?(t.gainNode.gain.value=e*this.seMasterVolume*this.masterVolume,source.volumeValue=e,t):null},t.prototype.getSERate=function(t){return t instanceof AudioBufferSourceNode?t.playbackRate.value:null},t.prototype.setSERate=function(t,e){return t instanceof AudioBufferSourceNode?void(t.playbackRate.value=e):null},t.prototype.getSEPan=function(t){return t instanceof AudioBufferSourceNode?t.panValue:null},t.prototype.setSEPan=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;var n=t.panNode;-1>e?e=-1:e>1&&(e=1);var r=90*e,i=Math.sin(r*(Math.PI/180)),o=Math.cos(r*(Math.PI/180));(-1===e||1===e)&&(o=0),n.positionX?(n.positionX.value=i,n.positionY.value=0,n.positionZ.value=o):n.setPosition(i,0,o),t.panValue=e},t.prototype.isSELoop=function(t){return t instanceof AudioBufferSourceNode?t.loop:null},t.prototype.setSELoop=function(t,e){return t instanceof AudioBufferSourceNode?void(t.loop=e):null},t.prototype.getSELoopStartTime=function(t){return t instanceof AudioBufferSourceNode?t.loopStart:null},t.prototype.setSELoopStartTime=function(t,e){return t instanceof AudioBufferSourceNode?void(t.loopStart=e):null},t.prototype.getSELoopEndTime=function(t){return t instanceof AudioBufferSourceNode?t.loopEnd:null},t.prototype.setSELoopEndTime=function(t,e){return t instanceof AudioBufferSourceNode?void(t.loopEnd=e):null},t.prototype.playBGM=function(t,e,n,r,i,o){if(!this.context)return null;var s=this._getBgmPlayer(t);return s?s.playBGM(e,n,r,i,o):null},t.prototype.stopBGM=function(t){var e=this._getBgmPlayer(t);return e?e.stopBGM():null},t.prototype.pauseBGM=function(t){var e=this._getBgmPlayer(t);return e?e.pauseBGM():null},t.prototype.resumeBGM=function(t){var e=this._getBgmPlayer(t);return e?e.resumeBGM():null},t.prototype.getBGMMasterVolume=function(){return this.bgmMasterVolume},t.prototype.setBGMMasterVolume=function(t){this.bgmMasterVolume=t;for(var e=0;e<this.bgmPlayerMax;e++){var n=this.bgmPlayerAry[e];n instanceof s&&n.onChangeBGMMasterVolume()}},t.prototype.getBGMVolume=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMVolume():null},t.prototype.setBGMVolume=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMVolume(e):null},t.prototype.getBGMTempo=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMTempo():null},t.prototype.setBGMTempo=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMTempo(e):null},t.prototype.getBGMPan=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMPan():null},t.prototype.setBGMPan=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMPan(e):null},t.prototype.isBGMLoop=function(t){var e=this._getBgmPlayer(t);return e?e.isBGMLoop():null},t.prototype.setBGMLoop=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoop(e):null},t.prototype.getBGMLoopStartTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLoopStartTime():null},t.prototype.setBGMLoopStartTime=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoopStartTime(e):null},t.prototype.getBGMLoopEndTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLoopEndTime():null},t.prototype.setBGMLoopEndTime=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoopEndTime(e):null},t.prototype.getBGMCurrentTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMCurrentTime():null},t.prototype.getBGMLength=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLength():null},t.prototype.getPlayingBGMName=function(t){var e=this._getBgmPlayer(t);return e?e.getPlayingBGMName():null},t.prototype.setOnBGMEndListener=function(t,e){var n=this._getBgmPlayer(t);return n?n.setOnBGMEndListener(e):null},t.prototype.getPlayingBGMState=function(t){var e=this._getBgmPlayer(t);return e?e.getPlayingBGMState():null},t.prototype.getBGMPicoAudio=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMPicoAudio():null},t.prototype.isTagLoop=function(t){var e=this._getBgmPlayer(t);return e?e.isTagLoop():null},t.prototype.setTagLoop=function(t,e){var n=this._getBgmPlayer(t);return n?n.setTagLoop(e):null},t.prototype.getBGMPlayerMax=function(){return this.bgmPlayerMax},t.prototype.allStopBGM=function(){for(var t=0;t<this.bgmPlayerMax;t++)this.stopBGM(t)},t.prototype.allResetBGM=function(){for(var t=0;t<this.bgmPlayerMax;t++)this.stopBGM(t),this.setBGMVolume(t,1),this.setBGMTempo(t,1),this.setBGMPan(t,0);this.setMasterVolume(1),this.setSEMasterVolume(1),this.setBGMMasterVolume(1)},t.prototype._getBgmPlayer=function(t){if(0>t||this.bgmPlayerMax<=t)return null;var e=this.bgmPlayerAry[t];return e instanceof s?e:null},t.prototype.loadAudio=function(t,e){var n=new Audio(e);n.play(),this.audioDataAry.data[t]=null;var r=this;n.addEventListener("loadstart",function(){if(!r.context)return null;var t=r.context.createMediaElementSource(n);t.connect(r.context.destination)},!1),n.addEventListener("canplay",function(){this.audioDataAry.data[t]=n},!1),n.load()},t.prototype.playAudio=function(t,e,n){var r=this.audioDataAry.data[t];return r?(n||(n=0),this.playingAudio instanceof Audio&&(this.playingAudio.pause(),this.playingAudio.currentTime=0),this.playingAudio=r,r.loop=e,r.volume=this.audioVolume,r.currentTime=n,r.play(),r):null},t.prototype.stopAudio=function(){var t=this.playingAudio;return t instanceof Audio?(t.pause(),t.currentTime=0,this.playingAudio=null,t):null},t.prototype.pauseAudio=function(){var t=this.playingAudio;return t?(t.pause(),t):null},t.prototype.resumeAudio=function(){var t=this.playingAudio;return t?(t.play(),t):null},t.prototype.setAudioVolume=function(t){this.audioVolume=t,this.playingAudio instanceof Audio&&(this.playingAudio.volume=t)},t.prototype.setAudioTempo=function(t){this.audioTempo=t,this.playingAudio instanceof Audio&&(this.playingAudio.playbackRate=t)},t.prototype.setAudioPosition=function(t){this.playingAudio instanceof Audio&&(this.playingAudio.currentTime=t)},t.prototype.getAudioData=function(t){return this.audioDataAry.data[t]},t.prototype.getAudioCurrentTime=function(){return this.playingAudio instanceof Audio?this.playingAudio.currentTime:null},t.prototype.getAudioLength=function(){return this.playingAudio instanceof Audio?this.playingAudio.duration:null},t.prototype.searchOggLoop=function(t){var e=new Uint8Array(t.slice(0,3e3)),n=String.fromCharCode.apply(null,e),r=n.lastIndexOf("vorbis",34);if(-1==r)return[0,0];var i=n.indexOf("LOOPSTART="),o=n.indexOf("LOOPLENGTH="),s=0,a=0,u=e[40]+(e[41]<<8)+(e[42]<<16)+(e[43]<<24);if(-1!=i)for(var c=e[i]+(e[i+1]<<8)+(e[i+2]<<16)+(e[i+3]<<24),f=i+10;i+c>f;f++){var l=n[f];if("0">l||l>"9")break;s=10*s+(l-"0")}if(-1!=o)for(var c=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+(e[o+3]<<24),f=o+11;o+c>f;f++){var l=n[f];if("0">l||l>"9")break;a=10*a+(l-"0")}var h=(s+a)/u;return s/=u,[s,h]},t}(),s=function(){function t(t){return"undefined"!=typeof PicoAudio&&t instanceof PicoAudio}var e=function(t,e){this.t2MediaLib=t,this.id=e,this.playingBGMState="stop",this.playingBGMStatePending=null,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1,this.bgmPan=0,this.picoAudio=null,this.picoAudioSetDataBGMName=null,this.PICO_AUDIO_VOLUME_COEF=1,this.isTagLoop=!0};return e.prototype.playBGM=function(t,e,n,r,i){this.stopBGM();var o=this.t2MediaLib.soundDataAry[t];if(null==o)return null;if(!o.isDecodeComplete()){var s=this,a={};return a.bgmPlayerId=this.id,a.succ=function(){var a=function(){var o=s.playingBGMStatePending;s._setPlayingBGMState("stop",!0),"stop"!=o&&s.playingBGMName==t&&s.playBGM(t,e,n,r,i),"pause"==o&&s.pauseBGM()},u=o.decodedData;u instanceof Object?setTimeout(function(){a()},0):a()},a.err=function(){s._setPlayingBGMState("stop",!0)},this.playingBGMName=t,this._setPlayingBGMState("decoding",!0),this._setPlayingBGMState("play"),this.t2MediaLib.decodeSound(t,a),this}var u=o.decodedData;if(u instanceof AudioBuffer)this.isTagLoop&&(r=r||o.tagLoopStart,i=i||o.tagLoopEnd),this.playingBGM=this.t2MediaLib.playSE(t,this.bgmVolume,this.bgmPan,this.bgmTempo,n,e,r,i);else if(u instanceof Object){if(this._initPicoAudio(),t!=this.picoAudioSetDataBGMName?(this.picoAudio.setData(u),this.picoAudioSetDataBGMName=t):this.picoAudio.initStatus(),this.picoAudio.setLoop(e),this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*this.bgmVolume*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),n){var c=this.picoAudio.getTime(Number.MAX_SAFE_INTEGER);n>c?n=c:0>n&&(n=0)}else n=0;this.picoAudio.setStartTime(n),this.picoAudio.play(),this.playingBGM=this.picoAudio}return this.playingBGMName=t,this.bgmPause=0,this._setPlayingBGMState("play"),this},e.prototype.stopBGM=function(){var e=this.playingBGM;if(t(e))this.picoAudio.stop();else if(e instanceof AudioBufferSourceNode)try{e.stop(0)}catch(n){e.gainNode&&(e.gainNode.gain.cancelScheduledValues(this.t2MediaLib.context.currentTime),e.gainNode.gain.linearRampToValueAtTime(0,this.t2MediaLib.context.currentTime))}return this.playingBGM=null,this.playingBGMName=null,this._setPlayingBGMState("stop"),this},e.prototype.pauseBGM=function(){var e=this.playingBGM;if(t(e))0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseCurrentTime=e.context.currentTime,e.stop(),this.bgmPause=1);else if(e instanceof AudioBufferSourceNode&&0===this.bgmPause){this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=this.t2MediaLib.getSELoopStartTime(e),this.bgmPauseLoopEnd=this.t2MediaLib.getSELoopEndTime(e),this.bgmPauseLoop=this.t2MediaLib.isSELoop(e),this.bgmPauseCurrentTime=e.context.currentTime,this.bgmPauseTempo=this.bgmTempo;try{e.stop(0)}catch(n){e.gainNode&&(e.gainNode.gain.cancelScheduledValues(this.t2MediaLib.context.currentTime),e.gainNode.gain.linearRampToValueAtTime(0,this.t2MediaLib.context.currentTime))}this.bgmPause=1}return"stop"!=this.playingBGMState&&this._setPlayingBGMState("pause"),this},e.prototype.resumeBGM=function(){var e=this.playingBGM;return t(e)?1===this.bgmPause&&(e.play(),this.bgmPause=0):e instanceof AudioBufferSourceNode&&1===this.bgmPause&&(e=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd)),this},e.prototype.onChangeBGMMasterVolume=function(){this.setBGMVolume(this.getBGMVolume())},e.prototype.getBGMVolume=function(){return this.bgmVolume},e.prototype.setBGMVolume=function(e){var n=this.playingBGM;return this.bgmVolume=e,t(n)?this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*e*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume):n instanceof AudioBufferSourceNode&&(n.gainNode.gain.value=e*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),this},e.prototype.getBGMTempo=function(){return this.bgmTempo},e.prototype.setBGMTempo=function(t){var e=this.playingBGM;return(0>=t||isNaN(t))&&(t=1),e instanceof AudioBufferSourceNode&&0===this.bgmPause&&(e.plusTime-=(this.t2MediaLib.context.currentTime-e.playStartTime)*(t-this.bgmTempo)),this.bgmTempo=t,this.t2MediaLib.setSERate(e,t),this},e.prototype.getBGMPan=function(){return this.bgmPan},e.prototype.setBGMPan=function(t){var e=this.playingBGM;return this.bgmPan=t,e instanceof AudioBufferSourceNode&&this.t2MediaLib.setSEPan(e,t),this},e.prototype.isBGMLoop=function(){var e=this.playingBGM;return t(e)?this.picoAudio.isLoop():e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoop:this.t2MediaLib.isSELoop(e):null},e.prototype.setBGMLoop=function(e){var n=this.playingBGM;return t(n)?this.picoAudio.setLoop(e):n instanceof AudioBufferSourceNode&&(1===this.bgmPause?this.bgmPauseLoop=e:this.t2MediaLib.setSELoop(n,e)),this},e.prototype.getBGMLoopStartTime=function(){var e=this.playingBGM;return t(e)?0:e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopStart:this.t2MediaLib.getSELoopStartTime(e):null},e.prototype.setBGMLoopStartTime=function(t){var e=this.playingBGM;if(e instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopStartTime(e,t);this.bgmPauseLoopStart=t}return this},e.prototype.getBGMLoopEndTime=function(){var e=this.playingBGM;return t(e)?this.getBGMLength():e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopEnd:this.t2MediaLib.getSELoopEndTime(e):null},e.prototype.setBGMLoopEndTime=function(t){var e=this.playingBGM;if(e instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopEndTime(e,t);this.bgmPauseLoopEnd=t}return this},e.prototype.getBGMCurrentTime=function(){var e=this.playingBGM;if(t(e)){var n;return n=0===this.bgmPause?this.picoAudio.context.currentTime-this.picoAudio.states.startTime:this.bgmPauseTime}if(e instanceof AudioBufferSourceNode){var n,r,i,o,s,a,u;return 0===this.bgmPause?(i=this.t2MediaLib.context.currentTime,o=this.bgmTempo):(i=this.bgmPauseCurrentTime,o=this.bgmPauseTempo),r=(i-e.playStartTime)*o+e.plusTime,e.loop&&(e.loopEnd-e.loopStart>0?r<e.loopStart?(s=0,a=0,u=e.buffer.duration):(s=e.loopStart,a=e.loopStart,u=e.loopEnd-e.loopStart):(u=e.buffer.duration,s=0,a=0)),e.loop?n=(r-a)%u+s:(n=r,n>e.buffer.duration&&(n=e.buffer.duration)),n}return null},e.prototype.getBGMLength=function(){var e=this.playingBGM;return t(e)?this.picoAudio.getTime(Number.MAX_SAFE_INTEGER):e instanceof AudioBufferSourceNode?e.buffer.duration:null},e.prototype.getPlayingBGMName=function(){return this.playingBGMName},e.prototype.setOnBGMEndListener=function(t){null!=this.picoAudio&&this.picoAudio.setOnSongEndListener(t)},e.prototype.getPlayingBGMState=function(){return this.playingBGMState},e.prototype.getBGMPicoAudio=function(){return this._initPicoAudio(),this.picoAudio},e.prototype.isTagLoop=function(){return this.isTagLoop},e.prototype.setTagLoop=function(t){this.isTagLoop=t},e.prototype._setPlayingBGMState=function(t,e){e||"decoding"!=this.playingBGMState?(this.playingBGMState=t,this.playingBGMStatePending=null):this.playingBGMStatePending=t},e.prototype._initPicoAudio=function(){null==this.picoAudio&&(0==this.id&&(this.picoAudio=this.t2MediaLib.picoAudio),null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.t2MediaLib.context,this.t2MediaLib.picoAudio)))},e}(),a=function(){var t=function(t){this.idx=t,this.state="none",this.errorID=null,this.url=null,this.fileData=null,this.decodedData=null,this.decodedCallbacksAry=null,this.tagLoopStart=0,this.tagLoopEnd=0};return t.prototype.onLoad=function(t){this.state="loading",this.url=t},t.prototype.onLoadComplete=function(t){this.state="loaded",this.fileData=t},t.prototype.onDecode=function(){this.state="decoding"},t.prototype.onDecodeComplete=function(t){this.state="decoded",this.decodedData=t},t.prototype.onError=function(t){this.state="error",this.errorID=t},t.prototype.isNone=function(){return"none"==this.state},t.prototype.isLoadComplete=function(){switch(this.state){case"loaded":case"decoding":case"decoded":return!0}return!1},t.prototype.isDecoding=function(){return"decoding"==this.state},t.prototype.isDecodeComplete=function(){return"decoded"==this.state},t.prototype.removeDecodedData=function(){this.state="loaded",this.decodedData=null},t}();n("T2MediaLib",[],function(){return o}),i.setName("exceptionCatcher"),n([],function(){var t={};return t.f=function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(n){t.handleException(n)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var r in e)e[r]=t.f(e[r]);return e}},t}),i.setName("UI"),n(["Util","exceptionCatcher"],function(t,e){var n={},r=e.f;return n=function(){function e(){f.forEach(function(t){t()}),setTimeout(r(e),50)}function i(t){return t instanceof Array?o(t):"string"==typeof t?a(t):t}function o(t){var e=t[0],n=1,r=$("<"+e+">");for("object"!=typeof t[n]||t[n]instanceof Array||t[n]instanceof $||(s(r,t[n],e),n++);n<t.length;)r.append(i(t[n])),n++;return r}function s(e,i){function o(t,n){if(n)if("enterkey"==t)e.on("keypress",r(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var o,s=!0;f.push(function(){var t;t="checkbox"==i.type?!!e.prop("checked"):e.val(),(s||o!=t)&&(n.apply(e,[t,o]),o=t),s=!1})}else e.on(t,r(n))}i.$var&&(l[i.$var]=e),i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(t){h.writeToModel(i.$edit,t,e)}),l[i.$edit.name]||(l[i.$edit.name]=e),h.push({jq:e,params:i}));for(var s in i)if("on"==s)for(var a in i.on)o(a,i.on[a]);else"css"==s&&null!=i[s]?e.css(i[s]):t.startsWith(s,"$")||null==i[s]||e.attr(s,i[s])}function a(t){return $(document.createTextNode(t))}for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];var f=[],l={},h=[],p=i(u);return p.$edits=h,p.$vars=l,$.data(p,"edits",h),$.data(p,"vars",l),h.load=function(t){h.model=t,h.forEach(function(t){h.writeToJq(t.params.$edit,t.jq)}),h.validator.on.validate.call(h.validator,h.model)},h.writeToJq=function(t,e){var n=h.model;if(n){for(var r=t.name,i=r.split("."),o=0;o<i.length;o++)n=n[i[o]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},h.validator={errors:{},show:function(){if(l.validationMessage){l.validationMessage.empty();for(var t in this.errors)l.validationMessage.append(n("div",this.errors[t].mesg))}if(l.OKButton){var e=!0;for(var t in this.errors)e=!1;l.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},h.writeToModel=function(t,e,n){var r=h.model;if(r){var i=t.name;try{e=t.type.fromVal(e)}catch(o){return void h.validator.addError(i,o,n)}h.validator.removeError(i);for(var s=i.split("."),a=0;a<s.length;a++)a==s.length-1?h.on.writeToModel(i,e)||(r[s[a]]=e):r=r[s[a]];h.validator.on.validate.call(h.validator,h.model)}},h.on={},h.on.writeToModel=function(){},f.length>0&&setTimeout(r(e),50),p},n.types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),i.setName("UIDiag"),n(["UI"],function(t){function e(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t}function n(t,n){return null==t&&(t=""),e(t)?{title:n,body:r(t)}:"undefined"!=typeof $&&t instanceof $?{title:t.title||n,body:t}:(e(t.body)&&(t.body=r(t.body)),t)}function r(e){var n=(e+"").split("\n");return 1==n.length?n[0]:t.apply(this,["div"].concat(n.map(function(t){return["div",t]})))}var i={};return i.confirm=function(e){function r(t){return function(){o.resolve(t),i.dialog("close"),i.remove()}}e=n(e,"");var i=t("div",{title:e.title},["div",e.body],["button",{on:{click:r(!0)}},"OK"],["button",{on:{click:r(!1)}},""]).dialog({width:"auto",close:r(!1)}),o=$.Deferred();return o.promise()},i.alert=function(e){function r(t){return function(){o.resolve(t),i.dialog("close"),i.remove()}}e=n(e,"");var i=t("div",{title:e.title},["div",e.body],["button",{on:{click:r(!0)}},"OK"]).dialog({width:"auto",close:r(!1)}),o=$.Deferred();return o.promise()},i.open=function(t,e,n,r,o,s,a){return i.prompt({title:t,body:e},n,{left:r,top:o,width:s,height:a})},i.getStatus=function(){return i.status},i.getText=function(){return i.val?i.val.val():""},i.prompt=function(e,r,o){function s(){i.status=1;var t=u.$vars.val.val();i.resultValue=t,c.resolve(t),u.dialog("close"),u.remove()}function a(){i.status=2,u.dialog("close"),u.remove(),c.resolve()}e=n(e,""),o=o||{},position="number"==typeof o.left&&"number"==typeof o.top?{my:"left top",at:"left+"+o.left+" top+"+o.top,of:"body"}:{of:"body",at:"center",my:"center"};var u=t("div",{title:e.title},["div",e.body],["input",{on:{enterkey:s},$var:"val",value:r}],["br"],["button",{on:{click:s}},"OK"],["button",{on:{click:a}},""]).dialog({width:o.width||"auto",height:o.height||"auto",position:position,close:function(){u.dialog("close"),c.resolve()}});setTimeout(function(){u.$vars.val.focus()},10),i.status=0,i.val=u.$vars.val;var c=$.Deferred();return c.promise()},"undefined"!=typeof window&&(window.UIDiag=i),i}),i.setName("runtime"),r(["ImageList","T2MediaLib","Tonyu","UIDiag"],function(t,e){console.log("runtimes loaded",arguments),window.T2MediaLib||(window.T2MediaLib=e)}),i.setName("LSFS"),n(["FS"],function(t){return t.LSFS}),i.setName("NativeFS"),n(["FS"],function(t){return t.NativeFS}),i.setName("runScript2"),r(["FS","compiledTonyuProject","Shell","runtime","WebSite","LSFS","Tonyu","NativeFS"],function(t,e,n,r,i,o,s){$(function(){function r(){return 0}function a(){var t=r();f=$(window).width(),l=$(window).height(),h.attr({width:f-t,height:l-t})}function u(){s.currentProject=s.globals.$currentProject=A;var t=A.getOptions();A.runScriptMode=!0,A.run(t.run.bootClass)}SplashScreen={hide:function(){$("#splash").hide()},show:function(){},progress:function(t){$("#splash").text(t)}};var c=r(),f=$(window).width(),l=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var h=$("<canvas>").attr({width:f-c,height:l-c,"class":"tonyu-canvas"}).appendTo("body");s.globals.$mainCanvas=h;var p=navigator.userAgent.toLowerCase();-1!=p.indexOf("iphone")||-1!=p.indexOf("ipad")||-1!=p.indexOf("ipod")||window.parent&&window!==window.parent||$(window).resize(a);var d;if(i.isNW){var g=process.cwd().replace(/\\/g,"/"),m=location.href.replace(/^chrome-extension:\/\/\w*/,"");b=t.get(g+m),b.isDir()||(b=b.up()),d=b}else{var y=location.href.replace(/\?.*/,"").split(/\//),m=y.pop()||"runscript",v=y.pop()||"nobody",b=t.get(i.tonyuHome),w=t.get("/ram/");t.mount(w.path(),o.ramDisk()),d=w;var S=b.rel(v+"/"+m+"/");w.rel("files/").link(S)}loadFiles(d),n.cd(d),i.compiledKernel="js/kernel.js","BA"===i.serverType&&window.runtimePath&&(i.compiledKernel=window.runtimePath+"lib/tonyu/kernel.js");var A=e("user","js/concat.js",d);u()})}),i.setName()});