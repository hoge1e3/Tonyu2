!function(){var t={};return t.def=function(e,n,i){var r=t.getModuleInfo(t.curName);r.type=i,t.setReqs(r,e),r.func=function(){return n.apply(this,t.getObjs(e))},t.loadIfAvailable(r)},define=function(e,n){t.def(e,n,"define")},requirejs=function(e,n){t.def(e,n,"require")},t.setReqs=function(e,n){n.forEach(function(n){var i=t.getModuleInfo(n);i.loaded||(e.reqs[n]=i,i.revReqs[e.name]=e)})},t.getModuleInfo=function(e){var n=t.modules;return n[e]||(n[e]={name:e,reqs:{},revReqs:{}}),n[e]},t.doLoad=function(e){var n=t.getModuleInfo(e);if(n.loaded)return n.obj;n.loaded=!0;var i=null;if(n.func)i=n.func();else{var r=e.split(/\./);i=function(){return this}(),r.forEach(function(t){i&&(i=i[t])}),null==i&&console.log("Warning: No obj for "+e)}if("define"==n.type&&null==i)throw"No obj for "+e;n.obj=i;for(var o in n.revReqs)t.notifyLoaded(n.revReqs[o],n.name);return i},t.notifyLoaded=function(e,n){delete e.reqs[n],t.loadIfAvailable(e)},t.loadIfAvailable=function(e){for(var n in e.reqs)return;t.doLoad(e.name)},t.getObjs=function(e){var n=[];return e.forEach(function(e){var i=t.doLoad(e);n.push(i)}),n},t.modules={},t.setName=function(e){t.curName&&(t.getModuleInfo(t.curName).func||t.doLoad(t.curName)),e&&(t.curName=e)},requireSimulator=t,t}(),requireSimulator.setName("extend"),define([],function(){return function(t,e){for(var n in e)t[n]=e[n]}}),requireSimulator.setName("assert"),define([],function(){function t(e){if(e instanceof Array){var n=[];return e.forEach(function(e){n=n.concat(t(e))}),n}return[e]}var e=function(e){this.failMesg=t(e||"Assertion failed: ")};e.prototype={fail:function(){var e=$a(arguments);throw e=t(e),e=this.failMesg.concat(e),console.log.apply(console,e),new Error(e.join(" "))},subAssertion:function(){var n=$a(arguments);return n=t(n),new e(this.failMesg.concat(n))},assert:function(t,e){return t||this.fail(e),t},eq:function(t,e){return t!==e&&this.fail(t,"!==",e),t},ne:function(t,e){return t===e&&this.fail(t,"===",e),t},isset:function(t,e){return null==t&&this.fail((e||"")+" is null/undef"),t},is:function(t,e){var n=e,i=t;if(null==n&&this.fail("assert.is: type must be set"),n._assert_func)return n._assert_func.apply(this,[i]),t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){t&&"number"==typeof t.length||this.fail(t,"should be array:");for(var r=this,o=0;o<n.length;o++){var a=r.subAssertion("failed at ",t,"[",o,"]: ");null==n[o]&&console.log("WOW!7",i[o],n[o]),a.is(i[o],n[o])}return t}if(n===String||"string"==n)return this.assert("string"==typeof i,[i,"should be a string "]),t;if(n===Number||"number"==n)return this.assert("number"==typeof i,[i,"should be a number"]),t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(i,String),this.assert(n.exec(i),[i,"does not match to",n]),t;if("function"==typeof n)return this.assert(i instanceof n,[i,"should be ",n]),t;if(n&&"object"==typeof n){for(var s in n){var a=this.subAssertion("failed at ",t,".",s,":");a.is(t[s],n[s])}return t}this.fail("Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&i(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)}},$a=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var n=new e,i=function(){try{return n.assert.apply(n,arguments)}catch(t){throw new Error(t.message)}};return i.is=function(){try{return n.is.apply(n,arguments)}catch(t){throw console.log(t.stack),new Error(t.message)}},i.isset=function(){try{return n.isset.apply(n,arguments)}catch(t){throw new Error(t.message)}},i.ne=function(){try{return n.ne.apply(n,arguments)}catch(t){throw new Error(t.message)}},i.eq=function(){try{return n.eq.apply(n,arguments)}catch(t){throw new Error(t.message)}},i.ensureError=function(){try{return n.ensureError.apply(n,arguments)}catch(t){throw new Error(t.message)}},i.fail=n.fail.bind(n),i.f=function(t){return{_assert_func:t}},i.and=function(){var t=$a(arguments);return i(t instanceof Array),i.f(function(e){for(var n=this,i=0;i<t.length;i++)n.is(e,t[i])})},i}),requireSimulator.setName("PathUtil"),define(["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}function n(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n}var i,r=/^([a-zA-Z]):/,o=/^([a-z]+):\/\/([^\/]+)\//,a=t.f(function(t){this.is(t,String),this.assert(i.isPath(t),[t," is not a path"])}),s=t.f(function(t){this.is(t,String),this.assert(i.isAbsolutePath(t),[t," is not a absolute path"])}),u=t.f(function(t){this.is(t,String),this.assert(!i.isAbsolutePath(t),[t," is not a relative path"])}),f=t.f(function(t){this.is(t,a),this.assert(i.isDir(t),[t," is not a directory path"])}),c=t.and(f,s),l=t.f(function(t){this.is(t,a),this.assert(!i.isDir(t),[t," is not a file path"])}),h="/";return i={Path:a,Absolute:s,Relative:u,Dir:f,File:l,AbsDir:c,SEP:h,endsWith:e,startsWith:n,hasDriveLetter:function(t){return r.exec(t)},isURL:function(t){var e=o.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:h+t.substring(e[0].length)}},isPath:function(){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),i.isPath(e)&&!i.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),i.isPath(e)&&(i.startsWith(e,h)||i.hasDriveLetter(e)||i.isURL(e))},isDir:function(n){return n=i.fixSep(n),t.is(arguments,[a]),e(n,h)},fixSep:function(e){return t.is(arguments,[String]),t.is(e.replace(/\\/g,"/"),a)},directorify:function(e){return e=i.fixSep(e),i.isDir(e)?e:t.is(e+h,f)},filify:function(e){return e=i.fixSep(e),i.isDir(e)?t.is(e.substring(0,e.length-1),l):e},splitPath:function(e){t.is(arguments,[a]);var n;if(n=this.isURL(e)){var i=this.splitPath(n.path);return i[0]=n.protocol+"://"+n.hostPort,i}e=e.replace(/\/+/g,h);var r=e.split(h);return""==r[r.length-1]&&(r[r.length-2]+=h,r.pop()),r},name:function(e){return t.is(arguments,[String]),i.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var n=i.name(e),r=/\.[a-zA-Z0-9]+$/.exec(n);return r?r[0]:null},truncExt:function(e,n){t.is(e,String);var r=i.name(e);return n=n||i.ext(e),t.is(n,String),r.substring(0,r.length-n.length)},truncSEP:function(e){return t.is(arguments,[a]),i.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(n,r){return t.is(arguments,[String,String]),e(i.name(n),r)},parent:function(e){return t.is(arguments,[String]),i.up(e)},rel:function(e,n){if(""==n)return e;t.is(arguments,[c,u]);var r=i.splitPath(n),o=e;o=o.replace(/\/$/,"");var a=i;return r.forEach(function(t){".."==t||"../"==t?o=a.up(o):(o=o.replace(/\/$/,""),o+=h+("."==t||"./"==t?"":t))}),o},relPath:function(e,n){return t.is(arguments,[s,c]),e.substring(0,n.length)!=n?"../"+i.relPath(e,this.up(n)):e.substring(n.length)},up:function(t){if(t=i.fixSep(t),t==h)return null;var e=i.splitPath(t);return e.pop(),e.join(h)+h}},i.isAbsolute=i.isAbsolutePath,i.isRelative=i.isRelativePath,"object"==typeof window&&(window.PathUtil=i),i}),requireSimulator.setName("MIMETypes"),define([],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".mp3":"audio/mp3",".ogg":"audio/ogg",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu"}}),requireSimulator.setName("FS2"),define(["extend","PathUtil","MIMETypes","assert"],function(t,e,n,i){function r(t){throw new Error(t+" is STUB!")}var o=function(){},a={};return o.addFSType=function(t,e){a[t]=e},o.availFSTypes=function(){return a},t(o.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},isReadOnly:function(){r("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(t){return i(this.getRootFS()!==this),this.getRootFS().resolveFS(t)},mounted:function(t,e){this.rootFS=t,this.mountPoint=e},inMyFS:function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},getRootFS:function(){return i(this.rootFS,"rootFS is not set")},getReturnTypes:function(){r("")},getContent:function(){r("getContent")},getContentAsync:function(){return this.supportsSync()||r("getContentAsync"),$.when(this.getContent.apply(this,arguments))},setContent:function(){r("")},setContentAsync:function(t,e,n){var i=this;return i.supportsSync()||r("setContentAsync"),$.when(e).then(function(e){return $.when(i.setContent(t,e,n))})},getMetaInfo:function(){r("")},setMetaInfo:function(){r("")},mkdir:function(){r("mkdir")},touch:function(){r("touch")},exists:function(){r("exists")},opendir:function(){r("opendir")},cp:function(t,n,r){i.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),r=r||{};var o=this.isDir(t),a=this.getRootFS().resolveFS(n),s=a.isDir(n);if(o||s)throw new Error("only file to file supports");if(this.supportsSync()&&a.supportsSync()){var u=this.getContent(t),f=a.setContent(n,u);return r.a&&a.setMetaInfo(n,this.getMetaInfo(t)),f}return a.setContentAsync(n,this.getContentAsync(t)).then(function(e){return r.a?a.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(){r("")},link:function(t,e){throw new Error("ln "+e+" "+t+" : This FS not support link.")},getURL:function(){r("")}}),o.delegateMethods=function(t,n){for(var r in n)!function(r){i.ne(r,"inMyFS"),t[r]=function(){var t=arguments[0];i.is(t,e.Absolute);var o=this.resolveFS(t);return o!==this?o[r].apply(o,arguments):n[r].apply(this,arguments)}}(r)},o.delegateMethods(o.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},getContentType:function(t,i){var r=e.ext(t);return n[r]||(i||{}).def||"text/plain"},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t){return e.isDir(t)},find:function(t,n){i.is(arguments,[e.Absolute]);var r=this.opendir(t,n),o=this,a=[t];return r.forEach(function(i){var r=e.rel(t,i);if(e.isDir(r)){var s=o.resolveFS(r);a=a.concat(s.find(r,n))}else a.push(r)}),a},resolveLink:function(t){i.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){i(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var r=this.isLink(n);if(r){i(r!=n,"l==p=="+r);var o=e.rel(r,e.relPath(t,n));return i(o!=t,"np==path=="+o),i.is(this.getRootFS().resolveFS(o).resolveLink(o),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(){return null}}),o}),requireSimulator.setName("WebSite"),define(["PathUtil"],function(t){var e,n=document.location.href,i=!!n.match(/html\/dev\//)&&!!n.match(/localhost:3/);e=n.match(/jsrun\.it/)?{urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:i,pluginTop:"http://tonyuedit.appspot.com/js/plugins",removeJSOutput:!0}:n.match(/tonyuexe\.appspot\.com/)||n.match(/localhost:8887/)||n.match(/\/html\/((dev)|(build))\//)?{urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:i}:{urlAliases:{},top:".",devMode:i};var r=window.navigator.userAgent.toLowerCase();return e.tablet=-1!=r.indexOf("windows")&&-1!=r.indexOf("touch")||-1!=r.indexOf("ipad")||-1!=r.indexOf("android")&&-1==r.indexOf("mobile")||-1!=r.indexOf("firefox")&&-1!=r.indexOf("tablet")||-1!=r.indexOf("kindle")||-1!=r.indexOf("silk")||-1!=r.indexOf("playbook"),e.mobile=-1!=r.indexOf("windows")&&-1!=r.indexOf("phone")||-1!=r.indexOf("iphone")||-1!=r.indexOf("ipod")||-1!=r.indexOf("android")&&-1!=r.indexOf("mobile")||-1!=r.indexOf("firefox")&&-1!=r.indexOf("mobile")||-1!=r.indexOf("blackberry"),e.pluginTop||(e.pluginTop=e.top+"/js/plugins"),e.disableROM={},n.match(/tonyuedit\.appspot\.com/)||n.match(/localhost:8888/),(n.match(/\.appspot\.com/)||n.match(/localhost:888[87]/))&&(e.serverType="GAE"),n.match(/localhost:3000/)&&(e.serverType="Node"),e.serverTop=n.match(/tonyuexe\.appspot\.com/)||n.match(/localhost:8887/)?e.top+"/exe":e.top+"/edit",e.sampleImg=e.top+"/images",e.blobPath=e.serverTop+"/serveBlob",e.isNW="object"==typeof process&&process.__node_webkit,e.mp3Disabled=e.isNW,e.tonyuHome="/Tonyu/",e.url={getDirInfo:e.serverTop+"/getDirInfo",getFiles:e.serverTop+"/File2LSSync",putFiles:e.serverTop+"/LS2FileSync"},e.isNW?(e.cwd=t.directorify(process.cwd()),e.tonyuHome=process.env.TONYU_HOME?t.directorify(process.env.TONYU_HOME):t.rel(e.cwd,"fs/Tonyu/"),e.logdir=process.env.TONYU_LOGDIR,e.wwwDir=t.rel(e.cwd,"www/"),e.platform=process.platform,e.ffmpeg=t.rel(e.cwd,"win32"==e.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),e.pkgInfo=require(t.rel(e.cwd,"package.json")),e.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):e.pkgInfo&&e.pkgInfo.config&&e.pkgInfo.config.prjDirs?e.pkgInfo.config.prjDirs.map(function(n){return n=t.directorify(n),t.isAbsolute(n)?n:t.rel(e.cwd,n)}):[t.rel(e.cwd,"Projects/"),t.rel(e.tonyuHome,"Projects/")]):(e.wwwDir=location.protocol+"//"+location.host+"/",e.projects=[t.rel(e.tonyuHome,"Projects/")]),e.kernelDir=t.rel(e.wwwDir,"Kernel/"),e.compiledKernel=n.match(/tonyuedit\.appspot\.com/)||n.match(/localhost:888/)||e.isNW?e.top+"/Kernel/js/concat.js":"http://tonyuexe.appspot.com/Kernel/js/concat.js",window.WebSite=e}),requireSimulator.setName("Util"),Util=function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=i.exec(window.location.href);return null==r?n:e(r[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function i(t,e){return t.substring(0,e.length)===e}function r(t){function e(e){throw console.log(e),console.log(t,f),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var i,r=t.length,o=0,a=0;if(!r)return new ArrayBuffer(0);i=Math.floor(r/4*3),"="==t.charAt(r-1)&&(i-=1),"="==t.charAt(r-2)&&(i-=1);for(var s=new ArrayBuffer(i),u=new Uint8Array(s),f=0,c=0;i>c&&(a=n[t.charCodeAt(f)],void 0===a&&e("Invalid letter: "+t.charCodeAt(f)),o=a<<2,f++,a=n[t.charCodeAt(f)],void 0===a&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=o|a>>4&3,o=(15&a)<<4,f++,c++,!(c>=i))&&(a=n[t.charCodeAt(f)],void 0===a&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=o|a>>2&15,o=(3&a)<<6,f++,c++,!(c>=i));)a=n[t.charCodeAt(f)],void 0===a&&e("Invalid letter: "+t.charCodeAt(f)),u[c]=o|a,f++,c++;return s}function o(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",i=new Uint8Array(t),r=i.length,o=0,a=0,s=0;r>s&&(a=i[s],n+=e[a>>2],o=(3&a)<<4,s++,!(s>=r))&&(a=i[s],n+=e[o|a>>4],o=(15&a)<<2,s++,!(s>=r));)a=i[s],n+=e[o|a>>6],n+=e[63&a],s++;var u=r%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n}function a(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var i=t[n];n.match(/^_/)||"function"==typeof i&&(e[n]=function(){var e=i.apply(t,arguments);return e})}(n);return e}function s(){return"undefined"!=typeof Buffer}function u(t){return s()&&t instanceof Buffer}function f(t){return t instanceof ArrayBuffer||u(t)}function c(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(i){throw console.log(e.join("")),i}}function l(t,e){for(var n=encodeURIComponent(t),i=/^%(..)/,r=[],o=0;o<n.length;o++){var a=i.exec(n.substring(o));a?(r.push(parseInt("0x"+a[1])),o+=a[0].length-1):r.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(r):new Uint8Array(r).buffer}return{getQueryString:t,endsWith:n,startsWith:i,Base64_To_ArrayBuffer:r,Base64_From_ArrayBuffer:o,utf8bytes2str:c,str2utf8bytes:l,privatize:a,hasNodeBuffer:s,isNodeBuffer:u,isBuffer:f}}(),requireSimulator.setName("DataURL"),define(["extend","assert","Util"],function(t,e,n){function i(t,e){function i(e){throw console.log(e),console.log(t,h),new Error(e)}var r=e;t=t.replace(/[\n=]/g,"");var o=new Object;o[65]=0,o[66]=1,o[67]=2,o[68]=3,o[69]=4,o[70]=5,o[71]=6,o[72]=7,o[73]=8,o[74]=9,o[75]=10,o[76]=11,o[77]=12,o[78]=13,o[79]=14,o[80]=15,o[81]=16,o[82]=17,o[83]=18,o[84]=19,o[85]=20,o[86]=21,o[87]=22,o[88]=23,o[89]=24,o[90]=25,o[97]=26,o[98]=27,o[99]=28,o[100]=29,o[101]=30,o[102]=31,o[103]=32,o[104]=33,o[105]=34,o[106]=35,o[107]=36,o[108]=37,o[109]=38,o[110]=39,o[111]=40,o[112]=41,o[113]=42,o[114]=43,o[115]=44,o[116]=45,o[117]=46,o[118]=47,o[119]=48,o[120]=49,o[121]=50,o[122]=51,o[48]=52,o[49]=53,o[50]=54,o[51]=55,o[52]=56,o[53]=57,o[54]=58,o[55]=59,o[56]=60,o[57]=61,o[43]=62,o[47]=63;var a,s=t.length,u=0,f=0;if(!s)return new r(0);a=Math.floor(s/4*3),"="==t.charAt(s-1)&&(a-=1),"="==t.charAt(s-2)&&(a-=1);for(var c=new r(a),l=n.isNodeBuffer(c)?c:new Uint8Array(c),h=0,p=0;a>p&&(f=o[t.charCodeAt(h)],void 0===f&&i("Invalid letter: "+t.charCodeAt(h)),u=f<<2,h++,f=o[t.charCodeAt(h)],void 0===f&&i("Invalid letter: "+t.charCodeAt(h)),l[p]=u|f>>4&3,u=(15&f)<<4,h++,p++,!(p>=a))&&(f=o[t.charCodeAt(h)],void 0===f&&i("Invalid letter: "+t.charCodeAt(h)),l[p]=u|f>>2&15,u=(3&f)<<6,h++,p++,!(p>=a));)f=o[t.charCodeAt(h)],void 0===f&&i("Invalid letter: "+t.charCodeAt(h)),l[p]=u|f,h++,p++;return e===Uint8Array?l:c}function r(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],i="",r=n.isNodeBuffer(t)?t:new Uint8Array(t),o=r.length,a=0,s=0,u=0;o>u&&(s=r[u],i+=e[s>>2],a=(3&s)<<4,u++,!(u>=o))&&(s=r[u],i+=e[a|s>>4],a=(15&s)<<2,u++,!(u>=o));)s=r[u],i+=e[a|s>>6],i+=e[63&s],u++;var f=o%3;return f&&(i+=e[a]),1==f?i+="==":2==f&&(i+="="),i}var o=n.hasNodeBuffer()?Buffer:ArrayBuffer,a=(n.isNodeBuffer,n.isBuffer),s=function(t,n){"string"==typeof t?(this.url=t,this.binType=n||o,this.dataURL2bin(t)):t&&a(t.buffer)?(this.buffer=t.buffer,e.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):a(t)?(this.buffer=t,e.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),e.fail("Invalid args: ",arguments))};return s.isBuffer=a,t(s.prototype,{bin2dataURL:function(t,n){e(a(t)),e.is(n,String);var i=this.dataHeader(n),o=r(t);return e.is(o,String),this.url=i+o},dataURL2bin:function(t){e.is(arguments,[String]);var n=/^data:([^;]+);base64,/i,r=n.exec(t);return e(r,["malformed dataURL:",t]),this.contentType=r[1],this.buffer=i(t.substring(r[0].length),this.binType),e.is(this.buffer,this.binType)},dataHeader:function(t){return e.is(arguments,[String]),"data:"+t+";base64,"},toString:function(){return e.is(this.url,String)}}),s}),requireSimulator.setName("Content"),define(["DataURL","Util","assert"],function(t,e,n){var i=function(){},r=(e.isNodeBuffer,e.isBuffer);i.plainText=function(t,e){var n=new i;return n.contentType=e||"text/plain",n.plain=t,n},i.url=function(t){var e=new i;return e.url=t,e},i.buffer2ArrayBuffer=function(t){return e.isBuffer(t)?n(new Uint8Array(t).buffer,"n2a: buf is not set"):n(t,"n2a: a is not set")},i.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var e=new Buffer(new Uint8Array(t));return e}return n(t,"a2n: a is not set")},i.bin=function(t,o){n(o,"contentType should be set");var a=new i;if(t&&r(t.buffer))a.arrayBuffer=t.buffer;else if(e.isNodeBuffer(t))a.nodeBuffer=t;else{if(!(t instanceof ArrayBuffer))throw new Error(t+" is not a bin");a.arrayBuffer=t}return a.contentType=o,a};var o=i.prototype;return o.toBin=function(n){if(n=n||(e.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return n===Buffer?this.nodeBuffer:this.arrayBuffer=i.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return n===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=i.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var r=new t(this.url,n);return this.setBuffer(r.buffer)}if(null!=this.plain)return this.setBuffer(e.str2utf8bytes(this.plain,n));throw new Error("No data")},o.setBuffer=function(t){return n(t,"b is not set"),e.isNodeBuffer(t)?this.nodeBuffer=t:this.arrayBuffer=t},o.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},o.toNodeBuffer=function(){return this.toBin(Buffer)},o.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=e.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var n=new t(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=n.url}throw new Error("No data")},o.toPlainText=function(){if(null!=this.plain)return this.plain;if(this.url&&!this.hasBin()){var n=new t(this.url,ArrayBuffer);this.arrayBuffer=n.buffer}if(this.hasBin())return this.plain=e.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},o.hasURL=function(){return this.url},o.hasPlainText=function(){return null!=this.plain},o.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},o.hasNodeBuffer=function(){return this.nodeBuffer},o.hasArrayBuffer=function(){return this.arrayBuffer},i}),requireSimulator.setName("NativeFS"),define(["FS2","assert","PathUtil","extend","MIMETypes","DataURL","Content"],function(t,e,n,i,r,o,a){var s="object"==typeof process&&process.__node_webkit;if(!s)return function(){throw new Error("This system not suppert native FS")};var u=e,f=require("fs"),c=function(t){t&&(e.is(t,n.AbsDir),this.rootPoint=t)},l=n.hasDriveLetter(process.cwd());c.available=!0;var h=n.SEP,p=c.prototype=new t;return p.toNativePath=function(t){return this.rootPoint?(e.is(t,n.Absolute),e(this.inMyFS(t),t+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(t,this.mountPoint||n.SEP))):t},p.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var e=new Buffer(new Uint8Array(t));return e}return t},t.addFSType("NativeFS",function(t,e){return new c(e.r)}),c.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},c.prototype.inMyFS=function(t){return this.mountPoint?n.startsWith(t,this.mountPoint):!(!!l^!!n.hasDriveLetter(t))},t.delegateMethods(c.prototype,{getReturnTypes:function(){return u.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,i){i=i||{},e.is(t,n.Absolute);var r=this.toNativePath(t);return this.assertExist(t),this.isText(t)?a.plainText(f.readFileSync(r,{encoding:"utf8"})):a.bin(f.readFileSync(r),this.getContentType(t))},setContent:function(t,i){e.is(arguments,[n.Absolute,a]);var r=n.up(t);r&&this.getRootFS().resolveFS(r).mkdir(r);var o=this.toNativePath(t);i.hasBin()||!i.hasPlainText()?f.writeFileSync(o,i.toNodeBuffer()):f.writeFileSync(o,i.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(){},isReadOnly:function(){return!1},stat:function(t){e.is(t,n.Absolute);var i=this.toNativePath(t);return f.statSync(i)},mkdir:function(t){if(u.is(arguments,[n.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var e=n.up(t);e&&this.getRootFS().resolveFS(e).mkdir(e);var i=this.toNativePath(t);return f.mkdirSync(i),this.assertExist(i)},opendir:function(t){u.is(arguments,[String]);var e=this.toNativePath(t),i=n.truncSEP(e),r=f.readdirSync(e).map(function(t){var e=f.statSync(i+h+t),n=e.isDirectory()?h:"";return t+n}),o=[];return u.is(o.concat(r),Array)},rm:function(t,e){u.is(arguments,[n.Absolute]),e=e||{},this.assertExist(t);var i=this.toNativePath(t);return this.isDir(t)?f.rmdirSync(i):f.unlinkSync(i)},exists:function(t){var e=this.toNativePath(t);return f.existsSync(e)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():n.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&f.utimesSync(t,Date.now()/1e3,Date.now()/1e3)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")}}),c}),requireSimulator.setName("LSFS"),define(["FS2","PathUtil","extend","assert","Util","Content"],function(t,e,n,i,r,o){function a(){return(new Date).getTime()}var s=function(t,e){this.storage=t,this.options=e||{}},u=e.isDir.bind(e),f=e.up.bind(e),c=e.endsWith.bind(e),l=(e.Path,e.Absolute),h=e.SEP;return s.ramDisk=function(){var t={};return t[e.SEP]="{}",new s(t)},t.addFSType("localStorage",function(){return new s(localStorage)}),t.addFSType("ram",function(){return s.ramDisk()}),s.now=a,s.prototype=new t,s.prototype.resolveKey=function(t){return i.is(t,e.Absolute),this.mountPoint?e.SEP+e.relPath(t,this.mountPoint):t},s.prototype.getItem=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},s.prototype.setItem=function(t,n){i.is(t,e.Absolute);var r=this.resolveKey(t);i(r.indexOf("..")<0),i(e.startsWith(r,e.SEP)),this.storage[r]=n},s.prototype.removeItem=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},s.prototype.itemExists=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);return n in this.storage},s.prototype.getDirInfo=function(t){if(i.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");c(t,h)||(t+=h),i(this.inMyFS(t));var n={};try{var r=this.getItem(t);r&&(n=JSON.parse(r))}catch(o){console.log("dinfo err : ",t,r)}return n},s.prototype.putDirInfo=function(t,n,r){if(i.is(arguments,[e.AbsDir,Object]),!u(t))throw new Error("Not a directory : "+t);i(this.inMyFS(t)),this.setItem(t,JSON.stringify(n));var o=f(t);if(null!=o&&this.inMyFS(o)){var a=this.getDirInfo(o);this._touch(a,o,e.name(t),r)}},s.prototype._touch=function(t,e,n,r){i.is(arguments,[Object,String,String]),i(this.inMyFS(e)),t[n]||(t[n]={},r&&(t[n].trashed=!0)),r||delete t[n].trashed,t[n].lastUpdate=a(),this.putDirInfo(e,t,r)},s.prototype.removeEntry=function(t,e,n){i.is(arguments,[Object,String,String]),t[n]&&(t[n]={lastUpdate:a(),trashed:!0},this.putDirInfo(e,t,!0))},s.prototype.removeEntryWithoutTrash=function(t,e,n){i.is(arguments,[Object,String,String]),t[n]&&(delete t[n],this.putDirInfo(e,t,!0))},s.prototype.isRAM=function(){return this.storage!==localStorage},s.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},t.delegateMethods(s.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(){return i.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t){i.is(arguments,[l]),this.assertExist(t);var e;return e=this.isText(t)?o.plainText(this.getItem(t)):o.url(this.getItem(t))},setContent:function(t,e){i.is(arguments,[l,o]),this.assertWriteable(t),this.isText(t)?this.setItem(t,e.toPlainText()):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t){if(this.assertExist(t,{includeTrashed:!0}),i.is(arguments,[l]),t==e.SEP)return{};var n=i(e.up(t));if(!this.inMyFS(n))return{};var r=e.name(t);i.is(n,e.AbsDir);var o=this.getDirInfo(n);return i(o[r])},setMetaInfo:function(t,n){i.is(arguments,[String,Object]),this.assertWriteable(t);var r=i(e.up(t));if(this.inMyFS(r)){var o=this.getDirInfo(r),a=e.name(t);o[a]=n,this.putDirInfo(r,o,o[a].trashed)}},mkdir:function(t){i.is(arguments,[l]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){i.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),r=[];for(var o in n)i(n[o]),(!n[o].trashed||e.includeTrashed)&&r.push(o);return i.is(r,Array)},rm:function(t,n){i.is(arguments,[l]),n=n||{},this.assertWriteable(t);var r=e.up(t);if(null==r||!this.inMyFS(r))throw new Error(t+": cannot remove. It is root of this FS.");if(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t)){var o=this.opendir(t);o.length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)}else this.removeItem(t);var a=this.getDirInfo(r);n.noTrash?this.removeEntryWithoutTrash(a,r,e.name(t)):this.removeEntry(a,r,e.name(t))},exists:function(t,n){i.is(arguments,[l]),n=n||{};var r=e.name(t),o=e.up(t);if(null==o||!this.inMyFS(o))return!0;var a=this.getDirInfo(o),s=a[r];return s&&s.trashed&&this.itemExists(t)&&this.isDir(t),!s&&this.itemExists(t),s&&!s.trashed&&!s.link&&!this.itemExists(t),s&&!n.includeTrashed&&(s=!s.trashed),!!s},link:function(t,n){i.is(arguments,[e.Absolute,e.Absolute]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var r={};r.link=n,r.lastUpdate=a(),this.setMetaInfo(t,r),i(this.exists(t)),i(this.isLink(t))},isLink:function(t){if(i.is(arguments,[e.Absolute]),!this.exists(t))return null;var n=i(this.getMetaInfo(t));return n.link},touch:function(t){i.is(arguments,[l]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?this.setItem(t,"{}"):this.setItem(t,""));var n=f(t);if(null!=n)if(this.inMyFS(n)){var r=this.getDirInfo(n);this._touch(r,n,e.name(t),!1)}else i(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(t){return this.getContent(t).toURL()}}),s}),requireSimulator.setName("Env"),define(["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),n=n.replace(/^[a-z][a-z]+:\//,function(t){return t+"/"
}),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n}),requireSimulator.setName("SFile"),define(["extend","assert","PathUtil","Util","Content","FS2"],function(t,e,n,i,r,o){var a=function(t,i){e.is(i,n.Absolute),this._path=i,this.rootFS=t,this.fs=t.resolveFS(i),this.act={},this.act.path=this.fs.resolveLink(i),this.act.fs=t.resolveFS(this.act.path),e.is(this.act,{fs:o,path:n.Absolute}),this.isDir()&&!n.isDir(i)&&(this._path+=n.SEP)};return a.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},a.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},getPolicy:function(){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(t,r){var o;if(r=r||{},a.is(t))o=t;else{e.is(t,n.Absolute);var s,u=r.policy||this.policy;if(u&&(s=u.topDir)&&(s.path&&(s=s.path()),!n.startsWith(t,s)))throw new Error(t+": cannot access. Restricted to "+s);o=new a(this.rootFS,t),o.policy=u}return o.policy?i.privatize(o):o},contains:function(t){return e(a.is(t),t+" shoud be a SFile object."),this.isDir()?n.startsWith(t.path(),this.path()):!1},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var i=t.path?t.path():t;return n.relPath(this.path(),e.is(i,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var i=this.path();return this._resolve(n.rel(i,t))},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var t=this.metaInfo();return t?t.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.act.fs.getMetaInfo(this.act.path,t)},setMetaInfo:function(t,e){return this.act.fs.setMetaInfo(this.act.path,t,e)},lastUpdate:function(){return e(this.exists()),this.metaInfo().lastUpdate},exists:function(t){t=t||{};var e=this.fs.exists(this.path(),t);return e||t.noFollowLink?e:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(t){return t=t||{},this.isLink()?this.fs.rm(this.path(),t):(this.isDir()&&(t.recursive||t.r)&&this.each(function(e){e.rm(t)}),this.act.fs.rm(this.act.path,t))},removeWithoutTrash:function(t){t=t||{},t.noTrash=!0,this.rm(t)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(){return arguments.length>0?void this.setText(arguments[0]):this.getText()},setText:function(t){e.is(t,String),this.isText()?this.act.fs.setContent(this.act.path,r.plainText(t)):this.act.fs.setContent(this.act.path,r.url(t))},getContent:function(t){return"function"==typeof t?this.act.fs.getContentAsync(this.act.path).then(t):this.act.fs.getContent(this.act.path)},setContent:function(t){return this.act.fs.setContentAsync(this.act.path,t)},getText:function(){return this.isText()?this.act.fs.getContent(this.act.path).toPlainText():this.act.fs.getContent(this.act.path).toURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(){return this.act.fs.getContentType(this.act.path)},setBytes:function(t){return this.act.fs.setContent(this.act.path,r.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.act.fs.getContent(this.act.path).toBin(t.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(){return this.text().replace(/\r/g,"").split("\n")},obj:function(){var t=this;if(0==arguments.length){var n=t.text();return n?JSON.parse(n):null}t.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,n){e(t&&t.isSFile(),t+" is not a file");var i=this,n=n||{},r=i.isDir(),o=t.isDir();if(!r&&o&&(t=t.rel(i.name()),e(!t.isDir(),t+" is a directory."),o=!1),r&&!o)this.err("Cannot move dir to file");else{if(!r&&!o){n.echo&&n.echo(i+" -> "+t);var a=this.act.fs.cp(this.act.path,t.getResolvedLinkPath(),n);return n.a&&t.setMetaInfo(i.getMetaInfo()),a}e(r&&o),i.each(function(e){t.rel(e.name()).copyFrom(e,n)})}},moveFrom:function(t,e){var n=this.copyFrom(t,e);return t.rm({recursive:!0}),n},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){var n=this.assertDir();n.listFiles(e).forEach(t)},recursive:function(t,e){var n=this.assertDir();n.each(function(e){e.isDir()?e.recursive(t):t(e)},e)},listFiles:function(t){e(null==t||"object"==typeof t);var n,i=this.assertDir(),r=this.path();"function"==typeof t&&(n=t),t=i.convertOptions(t),n||(n=t.order);for(var o=this.act.fs.opendir(this.act.path,t),a=[],s=0;s<o.length;s++){var u=o[s];t.excludes[r+u]||a.push(i.rel(u))}return"function"==typeof n&&a.sort&&a.sort(n),a},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir(),i=n.listFiles(t);return i.map(function(t){return t.name()})},convertOptions:function(t){var i=(this.assertDir(),this.path());if(t||(t={}),t.excludes||(t.excludes={}),t.excludes instanceof Array){var r={};t.excludes.forEach(function(t){n.startsWith(t,"/")?r[t]=1:r[i+t]=1}),t.excludes=r}return e.is(t,{excludes:{}})},mkdir:function(){this.touch()},link:function(t,e){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,t.path(),e)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path}},a}),requireSimulator.setName("RootFS"),define(["assert","FS2","PathUtil","SFile"],function(t,e,n,i){var r=function(n){t.is(n,e),this.mount(null,n)},o=r.prototype,a={err:function(t,e){throw new Error(t+": "+e)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(e){t.is(arguments,[n.AbsDir]);var i=this.fstab();console.log(i);for(var r=0;r<i.length;r++)if(i[r].mountPoint==e)return i.splice(r,1),!0;return!1},availFSTypes:function(){return e.availFSTypes()},mount:function(n,i,r){if("string"==typeof i){var o=t(e.availFSTypes()[i],"fstype "+i+" is undefined.");i=o(n,r||{})}t.is(i,e),i.mounted(this,n),this.fstab().unshift(i)},resolveFS:function(i){t.is(i,n.Absolute);var r;return this.fstab().forEach(function(t){r||t.inMyFS(i)&&(r=t)}),r||this.err(i,"Cannot resolve"),t.is(r,e)},get:function(e){return t.is(e,n.Absolute),new i(this.resolveFS(e),e)}};for(var s in a)o[s]=a[s];return r}),requireSimulator.setName("FS"),define(["FS2","WebSite","NativeFS","LSFS","PathUtil","Env","assert","SFile","RootFS"],function(t,e,n,i,r,o,a,s,u){var t={};"object"==typeof window&&(window.FS=t);var f,c=new o(e);return f=new u(e.isNW?new n:new i(localStorage)),t.getRootFS=function(){return f},t.get=function(){return f.get.apply(f,arguments)},t.expandPath=function(){return c.expandPath.apply(c,arguments)},t.resolve=function(e,n){return s.is(e)?e:(e=c.expandPath(e),n&&!r.isAbsolutePath(e)?(n=c.expandPath(n),t.get(n).rel(e)):t.get(e))},t.mount=function(){return f.mount.apply(f,arguments)},t.unmount=function(){return f.unmount.apply(f,arguments)},t}),requireSimulator.setName("plugins"),define(["WebSite"],function(t){function e(t){return"function"==typeof t&&(t={onload:t}),t||(t={}),t.onload||(t.onload=function(){}),t}var n={},i={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/BodyActor/,symbol:"Box2D"},timbre:{src:"timbre.js",detection:/\bplay(SE)?\b/,symbol:"T"}};return n.installed=i,n.detectNeeded=function(t,e){for(var n in i){var r=i[n].detection.exec(t);r&&(e[n]=1)}return e},n.loaded=function(t){var e=i[t];if(!e)throw new Error("plugin not found: "+t);return window[e.symbol]},n.loadAll=function(t,r){function o(){u>=a.length?r.onload():n.load(a[u++],o)}r=e(r);var a=[];for(var s in t)i[s]&&!n.loaded(s)&&a.push(s);var u=0;console.log("loading plugins",a),setTimeout(o,0)},n.load=function(n,r){var o=i[n];if(!o)throw new Error("plugin not found: "+n);r=e(r);var a=t.pluginTop+"/"+o.src;location.href.match(/^file:/)?($("<script>").attr("src",a).appendTo("body"),setTimeout(r.onload,500)):$.getScript(a,r.onload)},n.request=function(t){if(!n.loaded(t)){var e=new Error("Plugin "+t+" required");e.pluginName=t}},n}),requireSimulator.setName("DeferredUtil"),define([],function(){var t;return t={ensureDefer:function(t){var e,n=new $.Deferred;return $.when(t).then(function(t){e?n.resolve(t):setTimeout(function(){n.resolve(t)},0)}).fail(function(t){e?n.reject(t):setTimeout(function(){n.reject(t)},0)}),e=!0,n.promise()},directPromise:function(t){var e=new $.Deferred;return setTimeout(function(){e.resolve(t)},0),e.promise()},then:function(e){return t.directPromise().then(e)},timeout:function(t){var e=new $.Deferred;return setTimeout(function(){e.resolve()},t),e.promise()},funcPromise:function(t){var e=new $.Deferred;return t(function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise()},throwPromise:function(t){var e=new $.Deferred;return setTimeout(function(){e.reject(t)},0),e.promise()},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(n){return console.log(n,n.stack),t.throwPromise(n)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(i){return i>=e.length?t.brk():$.when(n(e[i],i)).then(function(){return i+1})},0);var i=[];for(var r in e)i.push({k:r,v:e[r]});return t.each(i,function(t){return n(t.k,t.v)})},loop:function(e,n){return t.directPromise(n).then(t.throwF(function(){var n=e.apply(this,arguments);return n.DU_BRK?n.res:$.when(n).then(function(n){return t.loop(e,n)})}))},brk:function(t){return{DU_BRK:!0,res:t}}}}),requireSimulator.setName("compiledProject"),define(["DeferredUtil"],function(t){var e=function(e,n){return{getNamespace:function(){return e},sourceDir:function(){return null},getDependingProjects:function(){return[]},loadDependingClasses:function(e){var n=t.directPromise(),i=this.getNamespace();return this.getDependingProjects().forEach(function(t){t.getNamespace()!=i&&(n=n.then(function(){return t.loadClasses(e)}))}),n},loadClasses:function(t){console.log("Load compiled classes ns=",e,"url=",n);var i=new $.Deferred,r=document.getElementsByTagName("head")[0]||document.documentElement,o=document.createElement("script");o.src=n;var a=!1;return o.onload=o.onreadystatechange=function(){a||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(a=!0,o.onload=o.onreadystatechange=null,r&&o.parentNode&&r.removeChild(o),console.log("Done Load compiled classes ns=",e,"url=",n,Tonyu.classes),i.resolve())},this.loadDependingClasses(t).then(function(){r.insertBefore(o,r.firstChild)}),i.promise()}}};return e}),requireSimulator.setName("compiledTonyuProject"),define(["plugins","compiledProject"],function(t,e){var n=function(n,i,r){var o=e(n,i),a=e("kernel",WebSite.compiledKernel),s={getDir:function(){return r},getDependingProjects:function(){return[a]},getOptions:function(){var t=this.getDir().rel("options.json");return t.obj()},getResource:function(){var t=this.getDir().rel("res.json");return t.obj()},loadPlugins:function(e){var n=this.getOptions();return t.loadAll(n.plugins,e)},requestPlugin:function(){},run:function(t){var e={classes:Tonyu.classMetas};this.loadClasses(e).then(function(){Tonyu.run(t)})}};for(var u in s)o[u]=s[u];return o};return n}),requireSimulator.setName("Shell"),define(["FS","Util","WebSite","PathUtil","assert"],function(t,e,n,i){function r(t,e){var n=o(t);if(e&&!n.exists())throw n+": no such file or directory";return n}function o(e){if("string"!=typeof e)return e;if(i.isAbsolutePath(e))return t.get(e);var n=a.cwd;return n.rel(e)}var a={};return a.cd=function(t){return a.cwd=r(t,!0),a.pwd()},a.mount=function(e,n){if(!e||!e.t){var i=[];for(var r in t.getRootFS().availFSTypes())i.push(r);return void sh.err("-t=("+i.join("|")+") should be specified.")}t.mount(n,e.t,e)},a.unmount=function(e){t.unmount(e)},a.fstab=function(){var e=t.getRootFS(),n=e.fstab(),i=this;n.forEach(function(t){i.echo(t.fstype()+"	"+(t.mountPoint||""))})},a.resolve=r,a.pwd=function(){return a.cwd+""},a.ls=function(t){return t=t?r(t,!0):a.cwd,t.ls()},a.cp=function(t,e,n){n||(n={}),n.v&&(a.echo("cp",t,e),n.echo=a.echo.bind(a));var i=r(t,!0),o=r(e);return i.copyTo(o,n)},a.ln=function(t,e,n){var i=r(e),o=r(t,!0);if(i.isDir()&&i.exists()&&(i=i.rel(o.name())),i.exists())throw new Error(i+" exists");return i.link(o,n)},a.rm=function(t,e){if(e||(e={}),e.notrash)return t=r(t,!1),t.removeWithoutTrash(),1;if(t=r(t,!0),t.isDir()&&e.r){var n=t,i=0;return n.each(function(t){t.exists()&&(i+=a.rm(t,e))}),n.rm(),i+1}return t.rm(),1},a.cat=function(t){return t=r(t,!0),a.echo(t.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}))},a.resolve=function(t){return t||(t="."),t=r(t)},a.grep=function(t,e,n){function i(t,e,i){n.res&&n.res.push({file:t,lineNo:e,line:i}),a.echo(t+"("+e+"): "+i)}return e=r(e,!0),n||(n={}),n.res||(n.res=[]),e.isDir()?e.each(function(e){a.grep(t,e,n)}):"string"==typeof t&&e.lines().forEach(function(n,r){n.indexOf(t)>=0&&i(e,r+1,n)}),n.res},a.touch=function(t){return t=r(t),t.text(t.exists()?t.text():""),1},a.setout=function(t){a.outUI=t},a.echo=function(){console.log.apply(console,arguments),a.outUI&&a.outUI.log&&a.outUI.log.apply(a.outUI,arguments)},a.err=function(){console.log.apply(console,arguments),a.outUI&&a.outUI.err&&a.outUI.err.apply(a.outUI,arguments)},a.prompt=function(){},a.ASYNC={r:"SH_ASYNC"},a.help=function(){for(var t in a){var e=a[t];"function"==typeof e&&a.echo(t+(e.description?" - "+e.description:""))}},sh=a,n.isNW&&(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()}),a}),requireSimulator.setName("Class"),define(["assert"],function(t){function e(){var e,n;2==arguments.length?(e=t.is(arguments[0],Function),n=t.is(arguments[1],Object)):1==arguments.length&&(e=Object,n=t.is(arguments[0],Object));var i=n.initialize||function(){},r=i.prototype;for(var o in n)r[o]=n[o];return r.callSuper=function(){for(var n=[],i=0;arguments.length;i++)n.push(arguments[i]);var r=t.is(n.shift(),String),o=t.is(e.prototype[r],Function);return o.apply(this,n)},i}return e}),requireSimulator.setName("Tonyu.Thread"),define(["DeferredUtil","Class"],function(t,e){var n={enterC:{},exitC:0};try{window.cnts=n}catch(i){}var r=e({initialize:function(){this.frame=null,this._isDead=!1,this.cnt=0,this._isWaiting=!1,this.fSuspended=!1,this.tryStack=[],this.preemptionTime=60,this.age=0},isAlive:function(){return!this.isDead()},isDead:function(){return this._isDead=this._isDead||null==this.frame||this._threadGroup&&(this._threadGroup.objectPoolAge!=this.tGrpObjectPoolAge||this._threadGroup.isDeadThreadGroup())},setThreadGroup:function(t){this._threadGroup=t,this.tGrpObjectPoolAge=t.objectPoolAge},isWaiting:function(){return this._isWaiting},suspend:function(){this.fSuspended=!0,this.cnt=0},enter:function(t){this.frame={prev:this.frame,func:t}},apply:function(t,e,n){n||(n=[]);var i;"string"==typeof e&&(i=t["fiber$"+e]),"function"==typeof e&&(i=e.fiber),n=[this].concat(n);var r=0;return this.enter(function(){switch(r){case 0:i.apply(t,n),r=1;break;case 1:n[0].exit(),r=2}})},gotoCatch:function(t){var e=this;if(0==e.tryStack.length)return e.kill(),void e.handleEx(t);e.lastEx=t;for(var n=e.tryStack.pop();e.frame;){if(n.frame===e.frame){e.catchPC=n.catchPC;break}e.frame=e.frame.prev}},startCatch:function(){var t=this,e=t.lastEx;return t.lastEx=null,e},exit:function(t){this.frame=this.frame?this.frame.prev:null,this.retVal=t},enterTry:function(t){var e=this;e.tryStack.push({frame:e.frame,catchPC:t})},exitTry:function(){var t=this;t.tryStack.pop()},waitEvent:function(t,e){var n=this;if(n.suspend(),t.on){var i;e=e.concat(function(){n.lastEvent=arguments,n.retVal=arguments[0],i.remove(),n.steps()}),i=t.on.apply(t,e)}},runAsync:function(t){var e=this,n=function(){e.retVal=arguments,e.steps()},i=function(){for(var t="",n=0;n<arguments.length;n++)t+=arguments[n]+",";0==t.length&&(t="Async fail");var i=new Error(t);i.args=arguments,e.gotoCatch(i),e.steps()};e.suspend(),setTimeout(function(){t(n,i)},0)},waitFor:function(e){var n=this;return n._isWaiting=!0,n.suspend(),t.ensureDefer(e).then(function(t){n.retVal=t,n.steps()}).fail(function(t){if(t instanceof Error)n.gotoCatch(t);else{var e=new Error(t);e.original=t,n.gotoCatch(e)}n.steps()})},resume:function(t){this.retVal=t,this.steps()},steps:function(){var t=this;if(!t.isDead()){var e=Tonyu.currentThread;for(Tonyu.currentThread=t,t.cnt=t.preemptionTime,t.preempted=!1,t.fSuspended=!1;t.cnt>0&&t.frame;)try{for(;t.cnt-->0&&t.frame;)t.frame.func(t);t.preempted=!t.fSuspended&&t.isAlive()}catch(n){t.gotoCatch(n)}Tonyu.currentThread=e}},kill:function(){var t=this;t._isDead=!0,t.frame=null},clearFrame:function(){this.frame=null,this.tryStack=[]}});return r}),requireSimulator.setName("Tonyu.Iterator"),define(["Class"],function(t){function e(t,e){if(t.tonyuIterator)return t.tonyuIterator(e);if(t instanceof Array)return 1==e?new n(t):new i(t);if(t instanceof Object)return 1==e?new r(t):new o(t);throw console.log(t),new Error(t+" is not iterable")}var n=t({initialize:function(t){this.set=t,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.set[this.i],this.i++,!0)}}),i=t({initialize:function(t){this.set=t,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.i,this[1]=this.set[this.i],this.i++,!0)}}),r=t({initialize:function(t){this.elems=[];for(var e in t)this.elems.push(e);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i],this.i++,!0)}}),o=t({initialize:function(t){this.elems=[];for(var e in t)this.elems.push([e,t[e]]);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i][0],this[1]=this.elems[this.i][1],this.i++,!0)}});return e}),requireSimulator.setName("Tonyu"),"function"!=typeof define&&(define=require("requirejs").define),define(["assert","Tonyu.Thread","Tonyu.Iterator","DeferredUtil"],function(t,e,n,i){return Tonyu=function(){function r(){var t=new e;return t.handleEx=s,t}function o(t){return i.funcPromise(function(e){setTimeout(e,t)})}function a(){return i.funcPromise(function(t){requestAnimationFrame(t)})}function s(t){if(!Tonyu.onRuntimeError)throw"undefined"==typeof $LASTPOS&&($LASTPOS=0),alert("! at "+$LASTPOS+"   : "+t),console.log(t.stack),t;Tonyu.onRuntimeError(t)}function u(e,n){return t.is(arguments,[String,Object]),c(klass.getMeta(e),n)}function f(t,e){return t?c(Object.create(t.prototype),e):e}function c(t,e){if(e&&"object"==typeof e)for(var n in e)t[n]=e[n];return t}function l(t,e){x[t]=e}function h(t){return x[t]}function p(t){var e=t.split("."),n=M;if(e.forEach(function(t){n&&(n=n[t])}),!n&&1==e.length){var i;for(var r in M){var o=M[r][t];if(o){if(n)throw new Error(" "+r+"."+t+", "+i);n=o,i=r+"."+t}}}return n}function d(t,e){var n=function(){return e.apply(t,arguments)};return n.methodInfo=Tonyu.extend({thiz:t},e.methodInfo||{}),e.fiber&&(n.fiber=function(){return e.fiber.apply(t,arguments)},n.fiber.methodInfo=Tonyu.extend({thiz:t},e.fiber.methodInfo||{})),n}function m(t,e,n,i){if(!t)throw new Error(i+"(="+t+") "+e+"");var r=t[e];if("function"!=typeof r)throw new Error(("this"==i?"":i+".")+e+"(="+r+")");return r.apply(t,n)}function g(t,e,n){if("function"!=typeof t)throw new Error(n+"");return t.apply({},e)}function v(t,e){if(t!=t||null==t)throw new Error(e+"(="+t+")");return t}function y(t){for(var e=[],n=1;n<t.length;n++)e[n-1]=t[n];return e}function b(t){throw new Error(""+t+"new")}function T(t){throw console.log("Not a tonyu object: ",t),new Error(t+" is not a tonyu object")}function S(t,e){return t in e}function w(t){var e=p(t);if(!e)throw new Error(t+" ");Tonyu.runMode=!0;var n=new e,i=r();i.apply(n,"main");var o;(o=Tonyu.currentProject)&&(o.runningThread=i,o.runningObj=n),$LASTPOS=0,i.steps()}klass=function(){throw alert(" Deprecated. compile again."),new Error(" Deprecated. compile again.")},klass.addMeta=u,klass.removeMeta=function(t){delete A[t]},klass.getMeta=function(t){if("function"==typeof t)return t.meta;if("string"==typeof t){var e=A[t];return e||(A[t]=e={}),e}},klass.ensureNamespace=function(t,e){var n,i=e.split("."),r=t;for(n=0;n<i.length;n++){var o=i[n];r[o]||(r[o]={}),r=r[o]}return r},Function.prototype.constructor=function(){throw new Error("This method should not be called")},klass.define=function(t){var e=t.superclass,n=t.includes,i=t.fullName,r=t.shortName,o=t.namespace,a=t.methods,s=t.decls,c=klass.ensureNamespace(Tonyu.classes,o),l=a,h=l.initialize;delete l.initialize;var p;p=h?function(){this instanceof p||b(i),h.apply(this,arguments)}:e?function(){this instanceof p||b(i),e.apply(this,arguments)}:function(){this instanceof p||b(i)},c[r]=p,p.methods=l,n.forEach(function(t){if(!t.methods)throw t+" Does not have methods";for(var e in t.methods)e in l||(l[e]=t.methods[e])});var d={},m=/^__([gs]et)ter__(.*)$/;for(var g in l)if(!g.match(/^fiber\$/)){l["fiber$"+g]&&(l[g].fiber=l["fiber$"+g],l[g].fiber.methodInfo={name:g,klass:p,fiber:!0}),l[g].methodInfo={name:g,klass:p};var v=m.exec(g);v&&(d[v[2]]=d[v[2]]||{},d[v[2]][v[1]]=l[g])}p.prototype=f(e,l),p.prototype.isTonyuObject=!0;for(var g in d)Object.defineProperty(p.prototype,g,d[g]);p.meta=u(i,{fullName:i,shortName:r,namepsace:o,decls:s,superclass:e?e.meta:null,func:p,includes:n.map(function(t){return t.meta})});var y=klass.getMeta(p);return p.prototype.getClassInfo=function(){return y},p},klass.isSourceChanged=function(t){return t=t.meta||t,t.src&&t.src.tonyu?t.nodeTimestamp?t.src.tonyu.lastUpdate()>t.nodeTimestamp:!0:!1},klass.shouldCompile=function(t){if(t=t.meta||t,klass.isSourceChanged(t))return!0;for(var e=klass.getDependingClasses(t),n=0;n<e.length;n++)if(klass.shouldCompile(e[n]))return!0},klass.getDependingClasses=function(t){t=t.meta||t;var e=[];return t.superclass&&(e=[t.superclass]),t.includes&&(e=e.concat(t.includes)),e};var x={},M={},A={};return Tonyu={thread:r,klass:klass,bless:f,extend:c,globals:x,classes:M,classMetas:A,setGlobal:l,getGlobal:h,getClass:p,timeout:o,animationFrame:a,bindFunc:d,not_a_tonyu_object:T,hasKey:S,invokeMethod:m,callFunc:g,checkNonNull:v,run:w,iterator:n,VERSION:1456127034661,A:y}}()}),requireSimulator.setName("PatternParser"),define(["Tonyu"],function(t){var e=function(t,e){this.options=e||{},this.img=t,this.height=t.height,this.width=t.width;var n=this.newImage(t.width,t.height),i=n.getContext("2d");i.drawImage(t,0,0),this.ctx=i,this.pixels=this.ctx.getImageData(0,0,t.width,t.height).data,this.base=this.getPixel(0,0)};return t.extend(e.prototype,{newImage:function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n},getPixel:function(t,e){var n=this.pixels,i=4*(t+e*this.width),r=n[0+i],o=n[1+i],a=n[2+i],s=n[3+i];return 256*(256*(256*s+a)+o)+r},setPixel:function(t,e,n){var i=4*(t+e*this.width);this.pixels[0+i]=255&n,n=(n-(255&n))/256,this.pixels[1+i]=255&n,n=(n-(255&n))/256,this.pixels[2+i]=255&n,n=(n-(255&n))/256,this.pixels[3+i]=255&n},parse:function(){try{for(var t=[],e=0;e<this.height;e++)for(var n=0;n<this.width;n++){var i=this.getPixel(n,e);i!=this.base&&t.push(this.parse1Pattern(n,e))}return t}catch(r){if(r.isParseError)return console.log("parse error! "+r),[{image:this.img,x:0,y:0,width:this.width,height:this.height}];throw r}},parse1Pattern:function(t,e){function n(t){return t}function i(t,e,n){return{toString:function(){return"at ("+t+","+e+") :"+n},isParseError:!0}}for(var r=this.getPixel(t,e),o=t,a=e,s=this.base,u=this.width,f=this.height;u>o;){var c=this.getPixel(o,a);if(c!=r)break;o++}if(o>=u||this.getPixel(o,a)!=s)throw i(o,a,n(this.getPixel(o,a))+"!="+n(s));for(o--;f>a&&this.getPixel(o,a)==r;)a++;if(a>=f||this.getPixel(o,a)!=s)throw i(o,a,n(this.getPixel(o,a))+"!="+n(s));a--;var l=t+1,h=e+1,p=o-l,d=a-h;if(console.log("PP",l,h,p,d,o,a),p*d==0)throw i(o,a,"w*h==0");for(var m=this.newImage(p,d),g=m.getContext("2d"),v=g.getImageData(0,0,p,d),y=v.data,b=0,T=h;a>T;T++)for(var S=l;o>S;S++){var w=this.getPixel(S,T);w==r?(y[b++]=0,y[b++]=0,y[b++]=0,y[b++]=0):(y[b++]=255&w,w=(w-(255&w))/256,y[b++]=255&w,w=(w-(255&w))/256,y[b++]=255&w,w=(w-(255&w))/256,y[b++]=255&w)}g.putImageData(v,0,0);for(var x=h-1;a>=x;x++)for(var M=l-1;o>=M;M++)this.setPixel(M,x,s);return this.options.boundsInSrc?{x:l,y:h,width:p,height:d}:{image:m,x:0,y:0,width:p,height:d}}}),e}),requireSimulator.setName("Assets"),define(["WebSite","Util","Tonyu"],function(t,e,n){var i={};return i.resolve=function(n,i){if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,n){return t[n]}),t.urlAliases[n]&&(n=t.urlAliases[n]),e.startsWith(n,"ls:")){var r=n.substring("ls:".length);if(!i)throw new Error("Basedir not specified");var o=i.rel(r);if(!o.exists())throw new Error("Resource file not found: "+o);if(t.mp3Disabled&&r.match(/\.mp3$/)){var a=i.rel(r.replace(/\.mp3$/,".ogg"));a.exists()&&(o=a)}n=o.getURL()}return n},n.Assets=i,i}),requireSimulator.setName("ImageList"),define(["PatternParser","Util","Assets","assert"],function(t,e,n,i){function r(t){var e=[];return t.forEach(function(t){t&&""!=t.url&&e.push(t)}),e}var o,a={};return o=function(e,n,s){s||(s={}),e=r(e);var u=[],f=e.length;0==f&&setTimeout(function(){var t=[];t.names={},n(t)},0),e.forEach(function(e,r){function c(){var o,a;if((o=e.pwidth)&&(a=e.pheight)){for(var s=0,c=0,l=this.width,h=this.height,p=[];;){var d=o,m=a;if(s+o>l&&(d=l-s),c+a>h&&(m=h-c),p.push({image:this,x:s,y:c,width:d,height:m}),s+=o,s+o>l&&(s=0,c+=a,c+a>h))break}u[r]=p}else{var g=new t(this);u[r]=g.parse()}if(u[r].name=e.name,i.is(u[r],Array),f--,0==f){var v=[],y={};u.forEach(function(t){y[t.name]=v.length,v=v.concat(t)}),v.names=y,n(v)}}console.log("loading",e,r);var l=e.url,h=l;if(a[h])return void c.apply(a[h],[]);l=o.convURL(l,s.baseDir);var p=$("<img>");p.load(function(){a[h]=this,c.apply(this,[])}),p.attr("src",l)})},o.load=o,o.parse1=function(e,n,r){var o,a,s;if((o=e.pwidth)&&(a=e.pheight)){for(var u=0,f=0,c=n.width,l=n.height,h=[];;)if(h.push({image:this,x:u,y:f,width:o,height:a}),u+=o,u+o>c&&(u=0,f+=a,f+a>l))break;s=h}else{var p=new t(n,r);s=p.parse()}return s.name=e.name,i.is(s,Array)},o.convURL=function(t,e){return n.resolve(t,e)},window.ImageList=o,o}),requireSimulator.setName("T2MediaLib");var T2MediaLib_BGMPlayer=function(t){this.id=t,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1};T2MediaLib_BGMPlayer.prototype.playBGM=function(t,e,n,i,r){if(!T2MediaLib.context)return null;var o=this.playingBGM;return o instanceof AudioBufferSourceNode&&o.stop(0),this.playingBGM=T2MediaLib.playSE(t,this.bgmVolume,this.bgmTempo,n,e,i,r),this.playingBGMName=t,this.bgmPause=0,this.playingBGM},T2MediaLib_BGMPlayer.prototype.stopBGM=function(){var t=this.playingBGM;return t instanceof AudioBufferSourceNode?(t.stop(0),this.playingBGM=null,t):null},T2MediaLib_BGMPlayer.prototype.pauseBGM=function(){var t=this.playingBGM;return t instanceof AudioBufferSourceNode?(0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=t.loopStart,this.bgmPauseLoopEnd=t.loopEnd,this.bgmPauseLoop=t.loop,this.bgmPauseCurrentTime=t.context.currentTime,this.bgmPauseTempo=T2MediaLib.bgmTempo,t.stop(0),this.bgmPause=1),t):null},T2MediaLib_BGMPlayer.prototype.resumeBGM=function(){var t=this.playingBGM;return t instanceof AudioBufferSourceNode?(1===this.bgmPause&&(t=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd),this.bgmPause=0),t):null},T2MediaLib_BGMPlayer.prototype.setBGMVolume=function(t){var e=this.playingBGM;return e instanceof AudioBufferSourceNode?(this.bgmVolume=t,void T2MediaLib.setSEVolume(e,t)):null},T2MediaLib_BGMPlayer.prototype.setBGMTempo=function(t){var e=this.playingBGM;return e instanceof AudioBufferSourceNode?(0===this.bgmPause&&(e.plusTime-=(T2MediaLib.context.currentTime-e.playStartTime)*(t-this.bgmTempo)),this.bgmTempo=t,void T2MediaLib.setSERate(e,t)):null},T2MediaLib_BGMPlayer.prototype.getBGMCurrentTime=function(){var t=this.playingBGM;if(!(t instanceof AudioBufferSourceNode))return null;var e,n,i,r,o,a,s;return 0===this.bgmPause?(i=T2MediaLib.context.currentTime,r=this.bgmTempo):(i=this.bgmPauseCurrentTime,r=this.bgmPauseTempo),n=(i-t.playStartTime)*r+t.plusTime,t.loop&&(t.loopEnd-t.loopStart>0?n<t.loopStart?(o=0,a=0,s=t.buffer.duration):(o=t.loopStart,a=t.loopStart,s=t.loopEnd-t.loopStart):(s=t.buffer.duration,o=0,a=0)),t.loop?e=(n-a)%s+o:(e=n,e>t.buffer.duration&&(e=t.buffer.duration)),e},T2MediaLib_BGMPlayer.prototype.getBGMLength=function(){var t=this.playingBGM;return t instanceof AudioBufferSourceNode?t.buffer.duration:null};var T2MediaLib={context:null,seDataAry:{data:[]},bgmPlayerMax:16,bgmPlayerAry:[],playingBGM:null,playingBGMName:null,bgmPause:0,bgmPauseTime:0,bgmPauseCurrentTime:0,bgmPauseTempo:0,bgmPauseLoop:!1,bgmPauseLoopStart:0,bgmPauseLoopEnd:0,bgmVolume:1,bgmTempo:1,playingAudio:null,audioVolume:1,audioTempo:1,audioDataAry:{data:[]},init:function(){if(!this.inited&&(this.inited=!0,!this.disabled&&(window.AudioContext?T2MediaLib.context=new AudioContext:window.webkitAudioContext?T2MediaLib.context=new webkitAudioContext:(T2MediaLib.context=null,console.log("Your browser does not support yet Web Audio API")),T2MediaLib.context)))for(var t=0;t<T2MediaLib.bgmPlayerMax;t++)T2MediaLib.bgmPlayerAry[t]=new T2MediaLib_BGMPlayer(t)},allClearData:function(){var t=T2MediaLib.seDataAry.data;for(var e in t)delete t[e]},clearData:function(t){var e=T2MediaLib.seDataAry.data;delete e[t]},loadSEFromArray:function(t,e){for(var n=T2MediaLib.context,i=n.createBuffer(1,e.length,n.sampleRate),r=i.getChannelData(0),o=0;o<e.length;o++)r[o]=e[o];T2MediaLib.seDataAry.data[t]=i},loadSE:function(t,e,n){if(!T2MediaLib.context||T2MediaLib.disabled)return T2MediaLib.seDataAry.data[t]=-1,null;"object"==typeof WebSite&&WebSite.mp3Disabled&&(e=e.replace(/\.mp3$/,".ogg"));var i=new XMLHttpRequest;i.onload=function(){if(200===i.status||0===i.status){var r=i.response;if(r instanceof ArrayBuffer){var o=function(e){T2MediaLib.seDataAry.data[t]=e,n&&n.succ&&n.succ(t)},a=function(i){i instanceof Error?console.log("T2MediaLib: "+i.message,e):console.log("T2MediaLib: Error decodeAudioData()",e),T2MediaLib.seDataAry.data[t]=-4,n&&n.err&&n.err(t,T2MediaLib.seDataAry.data[t])};T2MediaLib.context.decodeAudioData(r,o,a)}else T2MediaLib.seDataAry.data[t]=-3,n&&n.err&&n.err(t,T2MediaLib.seDataAry.data[t])}else T2MediaLib.seDataAry.data[t]=-2,n&&n.err&&n.err(t,T2MediaLib.seDataAry.data[t])},i.onerror=function(e){n&&n.err&&n.err(t,e+"")},T2MediaLib.seDataAry.data[t]=null,e.match(/^data:/)&&Util&&Util.Base64_To_ArrayBuffer?(i={onload:i.onload},i.response=Util.Base64_To_ArrayBuffer(e.replace(/^data:audio\/[a-zA-Z0-9]+;base64,/i,"")),i.status=200,i.onload()):(i.open("GET",e,!0),i.responseType="arraybuffer",i.send(null))},activate:function(){if(this.init(),!this.isActivated){this.isActivated=!0;for(var t=T2MediaLib.context,e=t.createBuffer(1,Math.floor(t.sampleRate/32),t.sampleRate),n=e.getChannelData(0),i=Math.floor(t.sampleRate/860),r=0;r<n.length;r++)n[r]=(i/2>r%i?.1:-.1)*(i>r?2:1);var o=t.createBufferSource();o.buffer=e,o.connect(t.destination),o.noteOn?o.noteOn(0):o.start&&o.start(0)}},playSE:function(t,e,n,i,r,o,a){if(!T2MediaLib.context)return null;var s=T2MediaLib.seDataAry.data[t];if(!(s instanceof AudioBuffer))return null;null===e&&(e=1),n||(n=1),i?i>s.duration?i=s.duration:0>i&&(i=0):i=0,r||(r=!1),o?0>o?o=0:o>s.duration&&(o=s.duration):o=0,a?0>a?a=0:a>s.duration&&(a=s.duration):a=s.duration;var u=T2MediaLib.context.createBufferSource();
T2MediaLib.context.createGain=T2MediaLib.context.createGain||T2MediaLib.context.createGainNode;var f=T2MediaLib.context.createGain();u.buffer=s,u.loop=r,u.loopStart=o,u.loopEnd=a,u.playbackRate.value=n,u.connect(f),f.connect(T2MediaLib.context.destination);var c;return c=r&&a-o>0&&i>a?a:i,u.gainNode=f,u.playStartTime=T2MediaLib.context.currentTime,u.playOffset=c,u.plusTime=c,u.start=u.start||u.noteOn,u.stop=u.stop||u.noteOff,f.gain.value=e*e,i?r?u.start(0,i,86400):u.start(0,i):u.start(0),u.onended=function(){delete u.gainNode,u.onended=null},u},stopSE:function(t){return t instanceof AudioBufferSourceNode?(t.stop(0),t):null},setSEVolume:function(t,e){return t instanceof AudioBufferSourceNode?void(t.gainNode.gain.value=e*e):null},setSERate:function(t,e){return t instanceof AudioBufferSourceNode?void(t.playbackRate.value=e):null},getSEData:function(t){return T2MediaLib.seDataAry.data[t]},loadBGM:function(t,e,n){return T2MediaLib.loadSE(t,e,n)},playBGM:function(t,e,n,i,r,o){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var a=T2MediaLib.bgmPlayerAry[t];return a instanceof T2MediaLib_BGMPlayer?a.playBGM(e,n,i,r,o):null},stopBGM:function(t){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var e=T2MediaLib.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e.stopBGM():null},pauseBGM:function(t){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var e=T2MediaLib.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e.pauseBGM():null},resumeBGM:function(t){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var e=T2MediaLib.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e.resumeBGM():null},setBGMVolume:function(t,e){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var n=T2MediaLib.bgmPlayerAry[t];return n instanceof T2MediaLib_BGMPlayer?n.setBGMVolume(e):null},setBGMTempo:function(t,e){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var n=T2MediaLib.bgmPlayerAry[t];return n instanceof T2MediaLib_BGMPlayer?n.setBGMTempo(e):null},getBGMCurrentTime:function(t){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var e=T2MediaLib.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e.getBGMCurrentTime():null},getBGMLength:function(t){if(0>t||T2MediaLib.bgmPlayerMax<=t)return null;var e=T2MediaLib.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e.getBGMLength():null},getBGMData:function(t){return T2MediaLib.getSEData(t)},getBGMPlayerMax:function(){return T2MediaLib.bgmPlayerMax},allStopBGM:function(){for(var t=0;t<T2MediaLib.bgmPlayerMax;t++)T2MediaLib.stopBGM(t)},loadAudio:function(t,e){var n=new Audio(e);n.play(),T2MediaLib.audioDataAry.data[t]=null,n.addEventListener("loadstart",function(){if(!T2MediaLib.context)return null;var t=T2MediaLib.context.createMediaElementSource(n);t.connect(T2MediaLib.context.destination)},!1),n.addEventListener("canplay",function(){T2MediaLib.audioDataAry.data[t]=n},!1),n.load()},playAudio:function(t,e,n){var i=T2MediaLib.audioDataAry.data[t];return i?(n||(n=0),T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.pause(),T2MediaLib.playingAudio.currentTime=0),T2MediaLib.playingAudio=i,i.loop=e,i.volume=T2MediaLib.audioVolume,i.currentTime=n,i.play(),i):null},stopAudio:function(){var t=T2MediaLib.playingAudio;return t instanceof Audio?(t.pause(),t.currentTime=0,T2MediaLib.playingAudio=null,t):null},pauseAudio:function(){var t=T2MediaLib.playingAudio;return t?(t.pause(),t):null},resumeAudio:function(){var t=T2MediaLib.playingAudio;return t?(t.play(),t):null},setAudioVolume:function(t){T2MediaLib.audioVolume=t,T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.volume=t)},setAudioTempo:function(t){T2MediaLib.audioTempo=t,T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.playbackRate=t)},setAudioPosition:function(t){T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.currentTime=t)},getAudioData:function(t){return T2MediaLib.audioDataAry.data[t]},getAudioCurrentTime:function(){return T2MediaLib.playingAudio instanceof Audio?T2MediaLib.playingAudio.currentTime:null},getAudioLength:function(){return T2MediaLib.playingAudio instanceof Audio?T2MediaLib.playingAudio.duration:null}};requireSimulator.setName("exceptionCatcher"),define([],function(){var t={};return t.f=function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(n){t.handleException(n)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var i in e)e[i]=t.f(e[i]);return e}},t}),requireSimulator.setName("UI"),define(["Util","exceptionCatcher"],function(t,e){var n={},i=e.f;return n=function(){function e(){c.forEach(function(t){t()}),setTimeout(i(e),50)}function r(t){return t instanceof Array?o(t):"string"==typeof t?s(t):t}function o(t){var e=t[0],n=1,i=$("<"+e+">");for("object"!=typeof t[n]||t[n]instanceof Array||t[n]instanceof $||(a(i,t[n],e),n++);n<t.length;)i.append(r(t[n])),n++;return i}function a(e,r){function o(t,n){if(n)if("enterkey"==t)e.on("keypress",i(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var o,a=!0;c.push(function(){var t;t="checkbox"==r.type?!!e.prop("checked"):e.val(),(a||o!=t)&&(n.apply(e,[t,o]),o=t),a=!1})}else e.on(t,i(n))}r.$var&&(l[r.$var]=e),r.$edit&&("string"==typeof r.$edit&&(r.$edit={name:r.$edit,type:n.types.String}),r.on||(r.on={}),r.on.realtimechange=i(function(t){h.writeToModel(r.$edit,t,e)}),l[r.$edit.name]||(l[r.$edit.name]=e),h.push({jq:e,params:r}));for(var a in r)if("on"==a)for(var s in r.on)o(s,r.on[s]);else"css"==a&&null!=r[a]?e.css(r[a]):t.startsWith(a,"$")||null==r[a]||e.attr(a,r[a])}function s(t){return $("<span>").text(t)}for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];var c=[],l={},h=[],p=r(u);return p.$edits=h,p.$vars=l,h.load=function(t){h.model=t,h.forEach(function(t){h.writeToJq(t.params.$edit,t.jq)})},h.writeToJq=function(t,e){var n=h.model;if(n){for(var i=t.name,r=i.split("."),o=0;o<r.length;o++)n=n[r[o]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},h.validator={errors:{},show:function(){if(l.validationMessage){l.validationMessage.empty();for(var t in this.errors)l.validationMessage.append(n("div",this.errors[t].mesg))}if(l.OKButton){var e=!0;for(var t in this.errors)e=!1;l.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},h.writeToModel=function(t,e,n){var i=h.model;if(i){var r=t.name;try{e=t.type.fromVal(e)}catch(o){return void h.validator.addError(r,o,n)}h.validator.removeError(r);for(var a=r.split("."),s=0;s<a.length;s++)s==a.length-1?h.on.writeToModel(r,e)||(i[a[s]]=e):i=i[a[s]];h.validator.on.validate.call(h.validator,h.model)}},h.on={},h.on.writeToModel=function(){},c.length>0&&setTimeout(i(e),50),p},n.types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),requireSimulator.setName("UIDiag"),define(["UI"],function(t){var e={};return e.confirm=function(e){function n(t){return function(){r.resolve(t),i.dialog("close"),i.remove()}}var i=t("div",{title:""},["div",e],["button",{on:{click:n(!0)}},"OK"],["button",{on:{click:n(!1)}},""]).dialog({width:"auto",close:n(!1)}),r=$.Deferred();return r.promise()},e.alert=function(e){function n(t){return function(){r.resolve(t),i.dialog("close"),i.remove()}}var i=t("div",{title:""},["div",e],["button",{on:{click:n(!0)}},"OK"]).dialog({width:"auto",close:n(!1)}),r=$.Deferred();return r.promise()},e.prompt=function(e,n){function i(){var t=o.$vars.val.val();a.resolve(t),o.dialog("close"),o.remove()}function r(){o.dialog("close"),o.remove(),a.resolve()}var o=t("div",{title:""},["div",e],["input",{on:{enterkey:i},$var:"val",value:n}],["br"],["button",{on:{click:i}},"OK"],["button",{on:{click:r}},""]).dialog({width:"auto",close:function(){o.dialog("close"),a.resolve()}}),a=$.Deferred();return a.promise()},"undefined"!=typeof window&&(window.UIDiag=e),e}),requireSimulator.setName("runtime"),requirejs(["ImageList","T2MediaLib","Tonyu","UIDiag"],function(){}),requireSimulator.setName("runScript2"),requirejs(["FS","compiledTonyuProject","Shell","runtime","WebSite","LSFS","Tonyu","NativeFS"],function(t,e,n,i,r,o,a){$(function(){function i(){u=$(window).width(),f=$(window).height(),c.attr({width:u-10,height:f-10})}function s(){a.currentProject=a.globals.$currentProject=y;var t=y.getOptions();y.runScriptMode=!0,y.run(t.run.bootClass)}SplashScreen={hide:function(){$("#splash").hide()},show:function(){},progress:function(t){$("#splash").text(t)}};var u=$(window).width(),f=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var c=$("<canvas>").attr({width:u-10,height:f-10}).appendTo("body");$(window).resize(i);var l;if(r.isNW){var h=location.href.replace(/^file:\/\//,"");h.match(/^\/[a-z]:/i)&&(h=h.replace(/^\//,"")),h=t.get(h),h.isDir()||(h=h.up()),l=h.rel("data/")}else{var p=location.href.replace(/\?.*/,"").split(/\//),d=p.pop()||"runscript",m=p.pop()||"nobody",h=t.get(r.tonyuHome),g=t.get("/ram/");t.mount(g.path(),o.ramDisk()),l=g;var v=h.rel(m+"/"+d+"/");g.rel("files/").link(v)}loadFiles(l),n.cd(l),r.compiledKernel="js/kernel.js";var y=e("user","js/concat.js",l);s()})}),requireSimulator.setName();