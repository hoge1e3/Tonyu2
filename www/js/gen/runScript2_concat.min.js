!function(){var e={};return e.def=function(t,n,r){var i=e.getModuleInfo(e.curName);i.type=r,e.setReqs(i,t),i.func=function(){return n.apply(this,e.getObjs(t))},e.loadIfAvailable(i)},define=function(){var t=Array.prototype.slice.call(arguments);"string"==typeof t[0]&&(e.curName=t.shift());var n=t.shift(),r=t.shift();e.def(n,r,"define")},define.amd={jQuery:!0},requirejs=function(t,n){e.def(t,n,"require")},e.setReqs=function(t,n){n.forEach(function(n){var r=e.getModuleInfo(n);r.loaded||(t.reqs[n]=r,r.revReqs[t.name]=t)})},e.getModuleInfo=function(t){var n=e.modules;return n[t]||(n[t]={name:t,reqs:{},revReqs:{}}),n[t]},e.doLoad=function(t){var n=e.getModuleInfo(t);if(n.loaded)return n.obj;n.loaded=!0;var r=null;if(n.func)r=n.func();else{var i=t.split(/\./);r=function(){return this}(),i.forEach(function(e){r&&(r=r[e])}),null==r&&console.log("Warning: No obj for "+t)}if("define"==n.type&&null==r)throw"No obj for "+t;n.obj=r;for(var a in n.revReqs)e.notifyLoaded(n.revReqs[a],n.name);return r},e.notifyLoaded=function(t,n){delete t.reqs[n],e.loadIfAvailable(t)},e.loadIfAvailable=function(t){for(var n in t.reqs)return;e.doLoad(t.name)},e.getObjs=function(t){var n=[];return t.forEach(function(t){var r=e.doLoad(t);n.push(r)}),n},e.modules={},e.setName=function(t){e.curName&&(e.getModuleInfo(e.curName).func||e.doLoad(e.curName)),t&&(e.curName=t)},requireSimulator=e,e}(),requireSimulator.setName("FS"),define([],function(){var e,t,n={},i="REQJS_",a=0;n.def=function(e,t,r){var i=n.getModuleInfo(e);"function"==typeof t?(r=t,t=n.reqsFromFunc(r),n.setReqs(i,t),i.func=function(){var e={exports:{}},t=r(n.doLoad,e,e.exports);return t||e.exports}):(n.setReqs(i,t),i.func=function(){return r.apply(this,n.getObjs(t))}),n.loadIfAvailable(i)},e=function(e,t,r){n.def(e,t,r)},e.amd={},t=function(e,t){n.def(i+a++,e,t)},n.setReqs=function(e,t){t.forEach(function(t){var r=n.getModuleInfo(t);r.loaded||(e.reqs[t]=r,r.revReqs[e.name]=e)})},n.getModuleInfo=function(e){var t=n.modules;return t[e]=t[e]||{name:e,reqs:{},revReqs:{}}},n.doLoad=function(e){var t=n.getModuleInfo(e);if(t.loaded)return t.obj;t.loaded=!0;var r=t.func();null!=r||e.match(/^REQJS_/)||console.log("Warning: No obj for "+e),t.obj=r;for(var i in t.revReqs)n.notifyLoaded(t.revReqs[i],t.name);return r},n.notifyLoaded=function(e,t){delete e.reqs[t],n.loadIfAvailable(e)},n.loadIfAvailable=function(e){for(var t in e.reqs)return;n.doLoad(e.name)},n.getObjs=function(e){var t=[];return e.forEach(function(e){var r=n.doLoad(e);t.push(r)}),t},n.reqsFromFunc=function(e){var t=e+"",n=[];return t.replace(/require\s*\(\s*["']([^"']+)["']\s*\)/g,function(e,t){n.push(t)}),n},n.modules={},requireSimulator=n,e("extend",[],function(){return function(e,t){for(var n in t)e[n]=t[n]}}),e("assert",[],function(){function e(t){if(t instanceof Array){var n=[];return t.forEach(function(t){n=n.concat(e(t))}),n}return[t]}var t,n=function(t){this.failMesg=e(t||"Assertion failed: ")};n.prototype={_regedType:{},registerType:function(e,t){this._regedType[e]=t},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var n=t(arguments),r=n.shift();if(n=e(n),n=this.failMesg.concat(r).concat(n).concat(["mode",this._mode]),console.log.apply(console,n),this.isDefensive())return r;if(this.isBool())return!1;throw new Error(n.join(" "))},subAssertion:function(){var r=t(arguments);return r=e(r),new n(this.failMesg.concat(r))},assert:function(e,t){return e?e:this.fail(e,t)},eq:function(e,t){return e!==t?this.fail(e,"!==",t):this.isBool()?!0:e},ne:function(e,t){return e===t?this.fail(e,"===",t):this.isBool()?!0:e},isset:function(e,t){return null==e?this.fail(e,(t||"")+" is null/undef"):this.isBool()?!0:e},is:function(e,t){var n=t,r=e;if(null==n)return this.fail(e,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),this.isBool()?!0:e;if(this.assert(null!=e,[e,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!e||"number"!=typeof e.length)return this.fail(e,"should be array:");for(var i=this,a=0;a<n.length;a++){var s=i.subAssertion("failed at ",e,"[",a,"]: ");null==n[a]&&console.log("WOW!7",r[a],n[a]),s.is(r[a],n[a])}return this.isBool()?!0:e}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),this.isBool()?!0:e;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),this.isBool()?!0:e;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),this.isBool()?!0:e;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),this.isBool()?!0:e;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),this.isBool()?!0:e;if(n&&"object"==typeof n){for(var o in n){var s=this.subAssertion("failed at ",e,".",o,":");s.is(e[o],n[o])}return this.isBool()?!0:e}if("string"==typeof n){var u=this._regedType[n];return u?this.is(e,u):this.isBool()?!0:e}return this.fail(e,"Invaild type: ",n)},ensureError:function(e,t){try{e()}catch(n){return"string"==typeof t&&i(n+""===t,e+" thrown an error "+n+" but expected:"+t),void console.log("Error thrown successfully: ",n.message)}this.fail(e,"should throw an error",t)},setMode:function(e){this._mode=e},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},t=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t};var r=new n,i=function(){try{return r.assert.apply(r,arguments)}catch(e){throw new Error(e.message)}};return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(e){i[e]=function(){try{return r[e].apply(r,arguments)}catch(t){throw console.log(t.stack),new Error(t.message)}}}),i.fail=r.fail.bind(r),i.MODE_STRICT=r.MODE_STRICT,i.MODE_DEFENSIVE=r.MODE_DEFENSIVE,i.MODE_BOOL=r.MODE_BOOL,i.f=function(e){return{_assert_func:e}},i.opt=function(e){return i.f(function(t){return null==t||t instanceof e})},i.and=function(){var e=t(arguments);return i(e instanceof Array),i.f(function(t){for(var n=this,r=0;r<e.length;r++)n.is(t,e[r])})},i}),e("PathUtil",["assert"],function(e){function t(t,n){return e.is(arguments,[String,String]),t.substring(t.length-n.length)===n}function n(t,n){return e.is(arguments,[String,String]),t.substring(0,n.length)===n}var r,i=/^([a-zA-Z]):/,a=/^([a-z]+):\/\/\/?([^\/]+)\//,s=e.f(function(e){this.is(e,String),this.assert(r.isPath(e),[e," is not a path"])}),o=e.f(function(e){this.is(e,String),this.assert(r.isAbsolutePath(e),[e," is not a absolute path"])}),u=e.f(function(e){this.is(e,String),this.assert(!r.isAbsolutePath(e),[e," is not a relative path"])}),c=e.f(function(e){this.is(e,s),this.assert(r.isDir(e),[e," is not a directory path"])}),l=e.and(c,o),f=e.f(function(e){this.is(e,s),this.assert(!r.isDir(e),[e," is not a file path"])}),h="/";return r={Path:s,Absolute:o,Relative:u,Dir:c,File:f,AbsDir:l,SEP:h,endsWith:t,startsWith:n,hasDriveLetter:function(e){return i.exec(e)},isURL:function(e){var t=a.exec(e);if(t)return{protocol:t[1],hostPort:t[2],path:h+e.substring(t[0].length)}},isPath:function(){return e.is(arguments,[String]),!0},isRelativePath:function(t){return e.is(arguments,[String]),r.isPath(t)&&!r.isAbsolutePath(t)},isAbsolutePath:function(t){return e.is(arguments,[String]),r.isPath(t)&&(r.startsWith(t,h)||r.hasDriveLetter(t)||r.isURL(t))},isDir:function(n){return n=r.fixSep(n),e.is(arguments,[s]),t(n,h)},hasBackslashSep:function(e){return e.indexOf("\\")>=0},fixSep:function(t,n){return n=n||"/",e.is(arguments,[String]),e.is(t.replace(/[\\\/]/g,n),s)},directorify:function(t){return r.isDir(t)?t:e.is(t+h,c)},filify:function(t){return r.isDir(t)?e.is(t.substring(0,t.length-1),f):t},splitPath:function(t){e.is(arguments,[s]);var n;if(n=this.isURL(t)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}t=t.replace(/\/+/g,h);var i=t.split(h);return""==i[i.length-1]&&(i[i.length-2]+=h,i.pop()),i},name:function(t){return e.is(arguments,[String]),r.splitPath(t).pop()},ext:function(t){e.is(arguments,[String]);var n=r.name(t),i=/\.[a-zA-Z0-9]+$/.exec(n);return i?i[0]:null},truncExt:function(t,n){e.is(t,String);var i=r.name(t);return n=n||r.ext(t),e.is(n,String),i.substring(0,i.length-n.length)},truncSEP:function(t){return e.is(arguments,[s]),r.isDir(t)?t.substring(0,t.length-1):t},endsWith:function(n,i){return e.is(arguments,[String,String]),t(r.name(n),i)},parent:function(t){return e.is(arguments,[String]),r.up(t)},rel:function(t,n){if(""==n)return t;e.is(arguments,[l,u]);var i=r.splitPath(n),a=t;a=a.replace(/\/$/,"");var s=r;return i.forEach(function(e){".."==e||"../"==e?a=s.up(a):(a=a.replace(/\/$/,""),a+=h+("."==e||"./"==e?"":e))}),a},relPath:function(t,n){return e.is(arguments,[o,o]),t.substring(0,n.length)!=n?"../"+r.relPath(t,this.up(n)):t.substring(n.length)},up:function(e){if(e==h)return null;var t=r.splitPath(e);return t.pop(),t.join(h)+h}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(e){var t=r[e];r[e]=function(){var e=!1,n=Array.prototype.slice.call(arguments).map(function(t){return r.hasBackslashSep(t)?(e=!0,r.fixSep(t)):t}),i=t.apply(r,n);return e?r.fixSep(i,"\\"):i}}),r.isAbsolute=r.isAbsolutePath,r.isRelative=r.isRelativePath,"object"==typeof window&&(window.PathUtil=r),r}),e("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".mp3":"audio/mp3",".ogg":"audio/ogg",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu"}}),e("DeferredUtil",[],function(){var e,t=function(e){this.res=e};return e={isNativePromise:function(e){return e&&"function"==typeof e.then&&"function"!=typeof e.promise&&"function"==typeof e.catch},isJQPromise:function(e){return e&&"function"==typeof e.then&&"function"==typeof e.promise&&"function"==typeof e.fail},isPromise:function(e){return e&&"function"==typeof e.then&&("function"==typeof e.promise||"function"==typeof e.catch)},all:function(t){return e.promise(function(n,r){var i=[],a=t.length;t.forEach(function(t,s){e.resolve(t).then(function(e){i[s]=e,a--,0===a&&n(i)},r)})})},resolve:function(t){return e.config.useJQ&&e.isJQPromise(t)?t:!e.config.useJQ&&e.isNativePromise(t)?t:e.promise(function(n,r){e.isPromise(t)?t.then(n,r):n(t)})},assertResolved:function(e){var t,n;if(e.then(function(e){t=e,n=!0}),!n)throw console.log(r),new Error("Promise not resolved");return t},ensureDefer:function(t){return e.promise(function(n,r){var i;e.resolve(t).then(function(e){i?n(e):setTimeout(function(){n(e)},0)}).fail(function(e){i?r(e):setTimeout(function(){r(e)},0)}),i=!0})},directPromise:function(t){return e.timeout(t,0)},then:function(t){return e.directPromise().then(t)},timeout:function(t,n){return e.promise(function(e){setTimeout(function(){e(n)},t||0)})},funcPromise:function(t){if(e.config.useJQ){var n=new $.Deferred;try{t(function(e){n.resolve(e)},function(e){n.reject(e)})}catch(r){n.reject(r)}return n.promise()}if(e.external.Promise)return new e.external.Promise(function(e,n){try{t(e,n)}catch(r){n(r)}});throw new Error("promise is not found")},reject:function(t){if(e.config.useJQ){var n=new $.Deferred;return n.reject(t),n.promise()}return new JQ.external.Promise(function(e,n){n(t)})},throwPromise:function(t){if(e.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(t)},0),n.promise()}return new JQ.external.Promise(function(e,n){n(t)})},throwF:function(t){return function(){try{return t.apply(this,arguments)}catch(n){return console.log(n,n.stack),e.throwPromise(n)}}},each:function(t,n){if(t instanceof Array)return e.loop(function(r){return r>=t.length?e.brk():e.resolve(n(t[r],r)).then(function(){return r+1})},0);var r=[];for(var i in t)r.push({k:i,v:t[i]});return e.each(r,function(e){return n(e.k,e.v)})},loop:function(n,r){try{for(var i;;){if(r instanceof t)return e.when1(r.res);var a=!0,s=!1,o=n(r),u=e.resolve(o).then(function(i){return r=i,a=!1,r instanceof t?r.res:s?e.loop(n,r):void 0}).fail(function(e){a=!1,i=e});if(i)throw i;if(s=!0,a)return u}}catch(c){return e.reject(c)}},brk:function(e){return new t(e)},tryLoop:function(t,n){return e.loop(e.tr(t),n)},tryEach:function(t,n){return e.loop(t,e.tr(n))},documentReady:function(){return e.callbackToPromise(function(e){$(e)})},requirejs:function(t){if(!window.requirejs)throw new Error("requirejs is not loaded");return e.callbackToPromise(function(e){window.requirejs(t,e)})}},e.NOP=function(e){return e},e.begin=e.try=e.tr=e.throwF,e.promise=e.callbackToPromise=e.funcPromise,e.when1=e.resolve,e.config={},window.$&&window.$.Deferred&&(e.config.useJQ=!0),e.external={Promise:window.Promise},window.DeferredUtil||(window.DeferredUtil=e),e}),e("FS2",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(e,t,n,r,i){function a(e){throw new Error(e+" is STUB!")}var s=function(){},o={};return s.addFSType=function(e,t){o[e]=t},s.availFSTypes=function(){return o},e(s.prototype,{err:function(e,t){throw new Error(e+": "+t)},fstype:function(){return"Unknown"},isReadOnly:function(){a("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(e){return r(this.getRootFS()!==this),this.getRootFS().resolveFS(e)},mounted:function(e,t){this.rootFS=e,this.mountPoint=t},inMyFS:function(e){return!this.mountPoint||t.startsWith(e,this.mountPoint)},getRootFS:function(){return r(this.rootFS,"rootFS is not set")},getReturnTypes:function(){a("")},getContent:function(){a("getContent")},getContentAsync:function(){return this.supportsSync()||a("getContentAsync"),i.resolve(this.getContent.apply(this,arguments))},setContent:function(){a("")},setContentAsync:function(e,t,n){var r=this;return r.supportsSync()||a("setContentAsync"),i.resolve(t).then(function(t){return i.resolve(r.setContent(e,t,n))})},appendContent:function(){a("")},appendContentAsync:function(e,t,n){var r=this;return r.supportsSync()||a("appendContentAsync"),i.resolve(t).then(function(t){return i.resolve(r.appendContent(e,t,n))})},getMetaInfo:function(){a("")},setMetaInfo:function(){a("")},mkdir:function(){a("mkdir")},touch:function(){a("touch")},exists:function(){a("exists")},opendir:function(){a("opendir")},opendirAsync:function(){return this.supportsSync()||a("opendirAsync"),i.resolve(this.opendir.apply(this,arguments))},cp:function(e,n,i){r.is(arguments,[t.Absolute,t.Absolute]),this.assertExist(e),i=i||{};var a=this.isDir(e),s=this.getRootFS().resolveFS(n),o=s.isDir(n);if(a||o)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(e),c=s.setContent(n,u);return i.a&&s.setMetaInfo(n,this.getMetaInfo(e)),c}return s.setContentAsync(n,this.getContentAsync(e)).then(function(t){return i.a?s.setMetaInfo(n,this.getMetaInfo(e)):t})},mv:function(e,t,n){return this.cp(e,t,n),this.rm(e,{r:!0})},rm:function(){a("")},link:function(e,t){throw new Error("ln "+t+" "+e+" : This FS not support link.")},getURL:function(){a("")}}),s.delegateMethods=function(e,n){for(var i in n)!function(i){r.ne(i,"inMyFS"),e[i]=function(){var e=arguments[0];r.is(e,t.Absolute);var a=this.resolveFS(e);return a!==this?(console.log("Invoked for other fs",this.mountPoint,a.mountPoint),a[i].apply(a,arguments)):n[i].apply(this,arguments)}}(i)},s.delegateMethods(s.prototype,{assertWriteable:function(e){this.isReadOnly(e)&&this.err(e,"read only.")},getContentType:function(e,r){var i=(t.ext(e)+"").toLowerCase();return n[i]||(r||{}).def||"text/plain"},getBlob:function(e,t){var n=this.getContent(e);return t=t||{},t.blobType=t.blobType||Blob,t.binType=t.binType||ArrayBuffer,n.hasPlainText()?new t.blobType([n.toPlainText()],this.getContentType(e)):new t.blobType([n.toBin(t.binType)],this.getContentType(e))},isText:function(e){var n=this.getContentType(e);return t.startsWith(n,"text")},assertExist:function(e,n){this.exists(e,n)||this.err(e,": No such "+(t.isDir(e)?"directory":"file"))},isDir:function(e){return t.isDir(e)},find:function(e,n){r.is(arguments,[t.Absolute]);var i=this.opendir(e,n),a=this,s=[e];return i.forEach(function(r){var i=t.rel(e,r);if(t.isDir(i)){var o=a.resolveFS(i);s=s.concat(o.find(i,n))}else s.push(i)}),s},resolveLink:function(e){r.is(e,t.Absolute);for(var n=e;n;n=t.up(n)){r(!this.mountPoint||t.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+e);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var a=t.rel(i,t.relPath(e,n));return r(a!=e,"np==path=="+a),r.is(this.getRootFS().resolveFS(a).resolveLink(a),t.Absolute)}if(this.exists(n))return e}return e},isLink:function(){return null},opendirEx:function(e){r.is(e,t.AbsDir);var n=this.opendir(e),i=this,a={};return n.forEach(function(n){var r=t.rel(e,n);a[n]=i.getMetaInfo(r)}),a},getDirTree:function(e,n){n=n||{};var i=n.dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],r.is(n.excludes,Array),n.base||(n.base=e),r.is(e,t.AbsDir);var a=this.opendirEx(e,n);if("no-recursive"==n.style)return a;var s=this;for(var o in a){var u=a[o],c=t.rel(e,o),l=t.relPath(c,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(l)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(c)>=0)continue}if(s.isDir(c))switch(n.style){case"flat-absolute":case"flat-relative":s.getDirTree(c,n);break;case"hierarchical":n.dest={},i[o]=s.getDirTree(c,n)}else switch(n.style){case"flat-absolute":i[c]=u;break;case"flat-relative":i[l]=u;break;case"hierarchical":i[o]=u}}return i}}),s}),e("Util",[],function(){function e(e,n){null==n&&(n=""),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:t(i[1])}function t(e){return decodeURIComponent(e.replace(/\+/g,"%20"))}function n(e,t){return e.substring(e.length-t.length)===t}function r(e,t){return e.substring(0,t.length)===t}function i(e){if(e.__privatized)return e;var t={__privatized:!0};for(var n in e)!function(n){var r=e[n];n.match(/^_/)||"function"==typeof r&&(t[n]=function(){var t=r.apply(e,arguments);return t})}(n);return t}function a(e,t){for(var n in t||{})e[n]=t[n];return e}return{getQueryString:e,endsWith:n,startsWith:r,privatize:i,extend:a}}),e("Content",["assert","Util"],function(e,t){var n=function(){},r=t.extend;n.plainText=function(e,t){var r=new n;return r.contentType=t||"text/plain",r.plain=e,r},n.url=function(e){var t=new n;return t.url=e,t},n.buffer2ArrayBuffer=function(t){if(n.isBuffer(t)){var r=new Uint8Array(t),i=r.buffer;if(i instanceof ArrayBuffer)return i;var a=Array.prototype.slice.call(r);return e(new Uint8Array(a).buffer,"n2a: buf is not set")}return e(t,"n2a: a is not set")},n.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var n=new Buffer(new Uint8Array(t));return n}return e(t,"a2n: a is not set")},n.bin=function(t,r){e(r,"contentType should be set");var i=new n;if(t&&n.isBuffer(t.buffer))i.arrayBuffer=t.buffer;else if(n.isNodeBuffer(t))i.nodeBuffer=t;else{if(!(t instanceof ArrayBuffer))throw new Error(t+" is not a bin");i.arrayBuffer=t}return i.contentType=r,i};var i=n.prototype;i.toBin=function(e){if(e=e||(n.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return e===Buffer?this.nodeBuffer:this.arrayBuffer=n.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return e===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=n.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var t=new s(this.url,e);return this.setBuffer(t.buffer)}if(null!=this.plain)return this.setBuffer(n.str2utf8bytes(this.plain,e));throw new Error("No data")},i.setBuffer=function(t){return e(t,"b is not set"),n.isNodeBuffer(t)?this.nodeBuffer=t:this.arrayBuffer=t},i.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},i.toNodeBuffer=function(){return this.toBin(Buffer)},i.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=n.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var e=new s(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=e.url}throw new Error("No data")},i.toPlainText=function(){if(null!=this.plain)return this.plain;if(this.url&&!this.hasBin()){var e=new s(this.url,ArrayBuffer);this.arrayBuffer=e.buffer}if(this.hasBin())return this.plain=n.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},i.hasURL=function(){return this.url},i.hasPlainText=function(){return null!=this.plain},i.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},i.hasNodeBuffer=function(){return this.nodeBuffer},i.hasArrayBuffer=function(){return this.arrayBuffer},n.Base64_To_ArrayBuffer=function(e,t){function r(t){throw console.log(t),console.log(e,h),new Error(t)}var i=t||ArrayBuffer;e=e.replace(/[\n=]/g,"");var a=new Object;a[65]=0,a[66]=1,a[67]=2,a[68]=3,a[69]=4,a[70]=5,a[71]=6,a[72]=7,a[73]=8,a[74]=9,a[75]=10,a[76]=11,a[77]=12,a[78]=13,a[79]=14,a[80]=15,a[81]=16,a[82]=17,a[83]=18,a[84]=19,a[85]=20,a[86]=21,a[87]=22,a[88]=23,a[89]=24,a[90]=25,a[97]=26,a[98]=27,a[99]=28,a[100]=29,a[101]=30,a[102]=31,a[103]=32,a[104]=33,a[105]=34,a[106]=35,a[107]=36,a[108]=37,a[109]=38,a[110]=39,a[111]=40,a[112]=41,a[113]=42,a[114]=43,a[115]=44,a[116]=45,a[117]=46,a[118]=47,a[119]=48,a[120]=49,a[121]=50,a[122]=51,a[48]=52,a[49]=53,a[50]=54,a[51]=55,a[52]=56,a[53]=57,a[54]=58,a[55]=59,a[56]=60,a[57]=61,a[43]=62,a[47]=63;var s,o=e.length,u=0,c=0;if(!o)return new i(0);s=Math.floor(o/4*3),"="==e.charAt(o-1)&&(s-=1),"="==e.charAt(o-2)&&(s-=1);for(var l=new i(s),f=n.isNodeBuffer(l)?l:new Uint8Array(l),h=0,d=0;s>d&&(c=a[e.charCodeAt(h)],void 0===c&&r("Invalid letter: "+e.charCodeAt(h)),u=c<<2,h++,c=a[e.charCodeAt(h)],void 0===c&&r("Invalid letter: "+e.charCodeAt(h)),f[d]=u|c>>4&3,u=(15&c)<<4,h++,d++,!(d>=s))&&(c=a[e.charCodeAt(h)],void 0===c&&r("Invalid letter: "+e.charCodeAt(h)),f[d]=u|c>>2&15,u=(3&c)<<6,h++,d++,!(d>=s));)c=a[e.charCodeAt(h)],void 0===c&&r("Invalid letter: "+e.charCodeAt(h)),f[d]=u|c,h++,d++;return l},n.Base64_From_ArrayBuffer=function(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(e),i=r.length,a=0,s=0,o=0;i>o&&(s=r[o],n+=t[s>>2],a=(3&s)<<4,o++,!(o>=i))&&(s=r[o],n+=t[a|s>>4],a=(15&s)<<2,o++,!(o>=i));)s=r[o],n+=t[a|s>>6],n+=t[63&s],o++;var u=i%3;return u&&(n+=t[a]),1==u?n+="==":2==u&&(n+="="),n},n.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},n.isNodeBuffer=function(e){return n.hasNodeBuffer()&&e instanceof Buffer},n.isBuffer=function(e){return e instanceof ArrayBuffer||n.isNodeBuffer(e)},n.utf8bytes2str=function(e){for(var t=[],n=0;n<e.length;n++)t.push("%"+("0"+e[n].toString(16)).slice(-2));try{return decodeURIComponent(t.join(""))}catch(r){throw console.log(t.join("")),r}},n.str2utf8bytes=function(e,t){for(var n=encodeURIComponent(e),r=/^%(..)/,i=[],a=0;a<n.length;a++){var s=r.exec(n.substring(a));s?(i.push(parseInt("0x"+s[1])),a+=s[0].length-1):i.push(n.charCodeAt(a))}return"undefined"!=typeof Buffer&&t===Buffer?new Buffer(i):new Uint8Array(i).buffer};var a=n.hasNodeBuffer()?Buffer:ArrayBuffer,s=function(t,r){"string"==typeof t?(this.url=t,this.binType=r||a,this.dataURL2bin(t)):t&&n.isBuffer(t.buffer)?(this.buffer=t.buffer,e.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):n.isBuffer(t)?(this.buffer=t,e.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),e.fail("Invalid args: ",arguments))};return n.DataURL=s,r(s.prototype,{bin2dataURL:function(t,r){e(n.isBuffer(t)),e.is(r,String);var i=this.dataHeader(r),a=n.Base64_From_ArrayBuffer(t);return e.is(a,String),this.url=i+a},dataURL2bin:function(t){e.is(arguments,[String]);var r=/^data:([^;]+);base64,/i,i=r.exec(t);return e(i,["malformed dataURL:",t]),this.contentType=i[1],this.buffer=n.Base64_To_ArrayBuffer(t.substring(i[0].length),this.binType),e.is(this.buffer,this.binType)},dataHeader:function(t){return e.is(arguments,[String]),"data:"+t+";base64,"},toString:function(){return e.is(this.url,String)}}),n}),e("NativeFS",["FS2","assert","PathUtil","extend","MIMETypes","Content"],function(e,t,n,r,i,a){var s="object"==typeof process;if(!s)return function(){throw new Error("This system not support native FS")};var o=t,u=require("fs"),c=function(e){e&&(t.is(e,n.AbsDir),this.rootPoint=e)},l=n.hasDriveLetter(process.cwd());c.available=!0;var f=n.SEP,h=c.prototype=new e;return h.toNativePath=function(e){return this.rootPoint?(t.is(e,n.Absolute),t(this.inMyFS(e),e+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(e,this.mountPoint||n.SEP))):e},h.arrayBuffer2Buffer=function(e){if(e instanceof ArrayBuffer){var t=new Buffer(new Uint8Array(e));return t}return e},e.addFSType("NativeFS",function(e,t){return new c(t.r)}),c.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},c.prototype.inMyFS=function(e){return this.mountPoint?n.startsWith(e,this.mountPoint):!(!!l^!!n.hasDriveLetter(e))},e.delegateMethods(c.prototype,{getReturnTypes:function(){return o.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(e,r){r=r||{},t.is(e,n.Absolute);var i=this.toNativePath(e);return this.assertExist(e),this.isText(e)?a.plainText(u.readFileSync(i,{encoding:"utf8"})):a.bin(u.readFileSync(i),this.getContentType(e))},setContent:function(e,r){t.is(arguments,[n.Absolute,a]);var i=n.up(e);i&&this.getRootFS().resolveFS(i).mkdir(i);var s=this.toNativePath(e);r.hasBin()||!r.hasPlainText()?u.writeFileSync(s,r.toNodeBuffer()):u.writeFileSync(s,r.toPlainText())},appendContent:function(e,r){t.is(arguments,[n.Absolute,a]);var i=n.up(e);i&&this.getRootFS().resolveFS(i).mkdir(i);var s=this.toNativePath(e);r.hasBin()||!r.hasPlainText()?u.appendFileSync(s,r.toNodeBuffer()):u.appendFileSync(s,r.toPlainText())},getMetaInfo:function(e,t){this.assertExist(e,t);var n=this.stat(e);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(){},isReadOnly:function(){return!1},stat:function(e){t.is(e,n.Absolute);var r=this.toNativePath(e);return u.statSync(r)},mkdir:function(e){if(o.is(arguments,[n.Absolute]),this.exists(e)){if(this.isDir(e))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(e);var t=n.up(e);t&&this.getRootFS().resolveFS(t).mkdir(t);var r=this.toNativePath(e);return u.mkdirSync(r),this.assertExist(r)},opendir:function(e,t){o.is(arguments,[String]),t=t||{};var r=this.toNativePath(e),i=n.truncSEP(r),a=u.readdirSync(r);t.nosep||(a=a.map(function(e){var t=u.statSync(i+f+e),n=t.isDirectory()?f:"";return e+n}));var s=[];return o.is(s.concat(a),Array)},rm:function(e,t){o.is(arguments,[n.Absolute]),t=t||{},this.assertExist(e);var r=this.toNativePath(e);return this.isDir(e)?u.rmdirSync(r):u.unlinkSync(r)},exists:function(e){var t=this.toNativePath(e);return u.existsSync(t)},isDir:function(e){return this.exists(e)?this.stat(e).isDirectory():n.isDir(e)},touch:function(e){!this.exists(e)&&this.isDir(e)?this.mkdir(e):this.exists(e)&&u.utimesSync(e,Date.now()/1e3,Date.now()/1e3)},getURL:function(e){return"file:///"+e.replace(/\\/g,"/")}}),c}),e("LSFS",["FS2","PathUtil","extend","assert","Util","Content"],function(e,t,n,r,i,a){function s(){return(new Date).getTime()}var o=function(e,t){r(e," new LSFS fail: no storage"),this.storage=e,this.options=t||{},this.options.useDirCache&&(this.dirCache={})},u=t.isDir.bind(t),c=t.up.bind(t),l=t.endsWith.bind(t),f=(t.Path,t.Absolute),h=t.SEP;return o.ramDisk=function(e){var n={};return n[t.SEP]="{}",e=e||{},"useDirCache"in e||(e.useDirCache=!0),new o(n,e)},e.addFSType("localStorage",function(e,t){return new o(localStorage,t)}),e.addFSType("ram",function(e,t){return o.ramDisk(t)}),o.now=s,o.prototype=new e,o.prototype.resolveKey=function(e){return r.is(e,t.Absolute),this.mountPoint?t.SEP+t.relPath(e,this.mountPoint):e},o.prototype.getItem=function(e){r.is(e,t.Absolute);var n=this.resolveKey(e);return this.storage[n]},o.prototype.setItem=function(e,n){r.is(e,t.Absolute);var i=this.resolveKey(e);r(i.indexOf("..")<0),r(t.startsWith(i,t.SEP)),this.storage[i]=n},o.prototype.removeItem=function(e){r.is(e,t.Absolute);var n=this.resolveKey(e);delete this.storage[n]},o.prototype.itemExists=function(e){r.is(e,t.Absolute);var n=this.resolveKey(e);return r(this.storage,"No storage"),n in this.storage},o.prototype.getDirInfo=function(e){if(r.is(arguments,[t.AbsDir]),null==e)throw new Error("getDir: Null path");if(l(e,h)||(e+=h),r(this.inMyFS(e)),this.dirCache&&this.dirCache[e])return this.dirCache[e];var n={};try{var i=this.getItem(e);i&&(n=JSON.parse(i))}catch(a){console.log("dinfo err : ",e,i)}return this.dirCache&&(this.dirCache[e]=n),n},o.prototype.putDirInfo=function(e,n,i){if(r.is(arguments,[t.AbsDir,Object]),!u(e))throw new Error("Not a directory : "+e);r(this.inMyFS(e)),this.dirCache&&(this.dirCache[e]=n),this.setItem(e,JSON.stringify(n));var a=c(e);if(null!=a&&this.inMyFS(a)){var s=this.getDirInfo(a);this._touch(s,a,t.name(e),i)}},o.prototype._touch=function(e,n,i,a){r.is(arguments,[Object,String,String]),r(this.inMyFS(n)),e[i]||(e[i]={},a&&(e[i].trashed=!0)),a||delete e[i].trashed,e[i].lastUpdate=s(),this.getRootFS().notifyChanged(t.rel(n,i),e[i]),this.putDirInfo(n,e,a)},o.prototype.removeEntry=function(e,t,n){r.is(arguments,[Object,String,String]),e[n]&&(e[n]={lastUpdate:s(),trashed:!0},this.putDirInfo(t,e,!0))},o.prototype.removeEntryWithoutTrash=function(e,t,n){r.is(arguments,[Object,String,String]),e[n]&&(delete e[n],this.putDirInfo(t,e,!0))},o.prototype.isRAM=function(){return this.storage!==localStorage},o.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},e.delegateMethods(o.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(e){r.is(arguments,[f]),this.assertExist(e);var t;return t=this.isText(e)?a.plainText(this.getItem(e)):a.url(this.getItem(e))},setContent:function(e,t){r.is(arguments,[f,a]),this.assertWriteable(e),this.isText(e)?this.setItem(e,t.toPlainText()):this.setItem(e,t.toURL()),this.touch(e)},getMetaInfo:function(e){if(this.assertExist(e,{includeTrashed:!0}),r.is(arguments,[f]),e==t.SEP)return{};var n=r(t.up(e));if(!this.inMyFS(n))return{};var i=t.name(e);r.is(n,t.AbsDir);var a=this.getDirInfo(n);return r(a[i])},setMetaInfo:function(e,n){r.is(arguments,[String,Object]),this.assertWriteable(e);
var i=r(t.up(e));if(this.inMyFS(i)){var a=this.getDirInfo(i),s=t.name(e);a[s]=n,this.putDirInfo(i,a,a[s].trashed)}},mkdir:function(e){r.is(arguments,[f]),this.assertWriteable(e),this.touch(e)},opendir:function(e,t){r.is(arguments,[String]),t=t||{};var n=this.getDirInfo(e),i=[];for(var a in n)r(n[a]),(!n[a].trashed||t.includeTrashed)&&i.push(a);return r.is(i,Array)},rm:function(e,n){r.is(arguments,[f]),n=n||{},this.assertWriteable(e);var i=t.up(e);if(null==i||!this.inMyFS(i))throw new Error(e+": cannot remove. It is root of this FS.");if(this.assertExist(e,{includeTrashed:n.noTrash}),t.isDir(e)){var a=this.opendir(e);a.length>0&&this.err(e,"Directory not empty"),n.noTrash&&this.removeItem(e)}else this.removeItem(e);var s=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(s,i,t.name(e)):this.removeEntry(s,i,t.name(e))},exists:function(e,n){r.is(arguments,[f]),n=n||{};var i=t.name(e),a=t.up(e);if(null==a||!this.inMyFS(a))return!0;var s=this.getDirInfo(a),o=s[i];return o&&o.trashed&&this.itemExists(e)&&this.isDir(e),!o&&this.itemExists(e),o&&!o.trashed&&!o.link&&!this.itemExists(e),o&&!n.includeTrashed&&(o=!o.trashed),!!o},link:function(e,n){r.is(arguments,[t.Absolute,t.Absolute]),this.assertWriteable(e),this.exists(e)&&this.err(e,"file exists"),t.isDir(e)&&!t.isDir(n)&&this.err(e," can not link to file "+n),!t.isDir(e)&&t.isDir(n)&&this.err(e," can not link to directory "+n);var i={};i.link=n,i.lastUpdate=s(),this.setMetaInfo(e,i),r(this.exists(e)),r(this.isLink(e))},isLink:function(e){if(r.is(arguments,[t.Absolute]),!this.exists(e))return null;var n=r(this.getMetaInfo(e));return n.link},touch:function(e){r.is(arguments,[f]),this.assertWriteable(e),this.itemExists(e)||(t.isDir(e)?(this.dirCache&&(this.dirCache[e]={}),this.setItem(e,"{}")):this.setItem(e,""));var n=c(e);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,t.name(e),!1)}else r(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(e){return this.getContent(e).toURL()},opendirEx:function(e,n){r.is(e,t.AbsDir),n=n||{};var i={},a=this.getDirInfo(e);if(n.includeTrashed)return a;for(var s in a)a[s].trashed||(i[s]=a[s]);return i}}),o}),$.ajaxTransport("+binary",function(e,t,n){return window.FormData&&(e.dataType&&"binary"==e.dataType||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob))?{send:function(t,n){var r=new XMLHttpRequest,i=e.url,a=e.type,s=e.async||!0,o=e.responseType||"blob",u=e.data||null,c=e.username||null,l=e.password||null;r.addEventListener("load",function(){var t={};t[e.dataType]=r.response,n(r.status,r.statusText,t,r.getAllResponseHeaders())}),r.open(a,i,s,c,l);for(var f in t)r.setRequestHeader(f,t[f]);r.responseType=o,r.send(u)},abort:function(){n.abort()}}:void 0}),e("jquery.binarytransport",function(){}),e("WebFS",["FS2","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(e,t,n,r,i){var a=function(){},s=a.prototype=new e;return e.addFSType("web",function(){return new a}),s.fstype=function(){return"Web"},s.supportsSync=function(){return!1},s.inMyFS=function(e){return i.isURL(e)},e.delegateMethods(s,{exists:function(){return!0},getContentAsync:function(e){var t=this;return n.promise(function(n,i){$.get(e,function(i){var a=new FileReader;a.addEventListener("loadend",function(){n(r.bin(a.result,t.getContentType(e)))}),a.readAsArrayBuffer(i)},"binary").fail(i)})},getURL:function(e){return e}}),a}),e("Env",["assert","PathUtil"],function(e,t){var n=function(e){this.value=e};return n.prototype={expand:function(t){e.is(t,String);var n=this;return t.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,t){return n.get(t)})},expandPath:function(n){return e.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),n=n.replace(/^[a-z][a-z]+:\//,function(e){return e+"/"}),e.is(n,t.Path)},get:function(e){return this.value[e]},set:function(e,t){this.value[e]=t}},n});var s=s||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in n,i=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},a=e.webkitRequestFileSystem,s=e.requestFileSystem||a||e.mozRequestFileSystem,o=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u=0,c=function(t){var n=function(){"string"==typeof t?(e.URL||e.webkitURL||e).revokeObjectURL(t):t.remove()};e.chrome?n():setTimeout(n,10)},l=function(e,t,n){t=[].concat(t);for(var r=t.length;r--;){var i=e["on"+t[r]];if("function"==typeof i)try{i.call(e,n||e)}catch(a){o(a)}}},f=function(t,o){var f,h,d,p=this,m=t.type,g=!1,v=function(){l(p,["writestart","progress","write","writeend"])},y=function(){(g||!f)&&(f=(e.URL||e.webkitURL||e).createObjectURL(t)),h?h.location.href=f:void 0==e.open(f,"_blank")&&"undefined"!=typeof safari&&(e.location.href=f),p.readyState=p.DONE,v(),c(f)},b=function(e){return function(){return p.readyState!==p.DONE?e.apply(this,arguments):void 0}},_={create:!0,exclusive:!1};p.readyState=p.INIT,o||(o="download"),r?(f=(e.URL||e.webkitURL||e).createObjectURL(t),n.href=f,n.download=o,i(n),p.readyState=p.DONE,v(),c(f)):(e.chrome&&m&&"application/octet-stream"!==m&&(d=t.slice||t.webkitSlice,t=d.call(t,0,t.size,"application/octet-stream"),g=!0),a&&"download"!==o&&(o+=".download"),("application/octet-stream"===m||a)&&(h=e),s?(u+=t.size,s(e.TEMPORARY,u,b(function(e){e.root.getDirectory("saved",_,b(function(e){var n=function(){e.getFile(o,_,b(function(e){e.createWriter(b(function(n){n.onwriteend=function(t){h.location.href=e.toURL(),p.readyState=p.DONE,l(p,"writeend",t),c(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&y()},["writestart","progress","write","abort"].forEach(function(e){n["on"+e]=p["on"+e]}),n.write(t),p.abort=function(){n.abort(),p.readyState=p.DONE},p.readyState=p.WRITING}),y)}),y)};e.getFile(o,{create:!1},b(function(e){e.remove(),n()}),b(function(e){e.code===e.NOT_FOUND_ERR?n():y()}))}),y)}),y)):y())},h=f.prototype;return h.abort=function(){this.readyState=this.DONE,l(this,"abort")},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(e,t){return new f(e,t)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=s:"undefined"!=typeof e&&null!==e&&null!=e.amd&&e("FileSaver.min",[],function(){return s}),e("SFile",["extend","assert","PathUtil","Util","Content","FS2","FileSaver.min","DeferredUtil"],function(e,t,n,r,i,a,o,u){var c=function(e,r){t.is(r,n.Absolute),this._path=r,this.rootFS=e,this.fs=e.resolveFS(r),this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return c.is=function(e){return e&&"function"==typeof e.isSFile&&e.isSFile()},c.prototype={isSFile:function(){return!0},setPolicy:function(e){if(this.policy)throw new Error("policy already set");return this.policy=e,this._clone()},getPolicy:function(){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(e,i){var a;if(i=i||{},c.is(e))a=e;else{t.is(e,n.Absolute);var s,o=i.policy||this.policy;if(o&&(s=o.topDir)&&(s.path&&(s=s.path()),!n.startsWith(e,s)))throw new Error(e+": cannot access. Restricted to "+s);a=new c(this.rootFS,e),a.policy=o}return a.policy?r.privatize(a):a},contains:function(e){return t(c.is(e),e+" shoud be a SFile object."),this.isDir()?n.startsWith(e.path(),this.path()):!1},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(e){return n.truncExt(this.path(),e)},ext:function(){return n.ext(this.path())},relPath:function(e){var r=e.path?e.path():e;return n.relPath(this.path(),t.is(r,n.Absolute))},up:function(){var e=this.path(),t=n.up(e);return null==t?null:this._resolve(t)},rel:function(e){t.is(e,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,e))},sibling:function(e){return this.up().rel(e)},startsWith:function(e){return n.startsWith(this.name(),e)},endsWith:function(e){return n.endsWith(this.name(),e)},equals:function(e){return e&&"function"==typeof e.path&&e.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var e=this.metaInfo();return e?e.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(e){return this.act.fs.getMetaInfo(this.act.path,e)},setMetaInfo:function(e,t){return this.act.fs.setMetaInfo(this.act.path,e,t)},getDirTree:function(e){return this.act.fs.getDirTree(this.act.path,e)},assertExists:function(){t(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(e){var t=Array.prototype.slice.call(arguments);if("function"==typeof t[0]){var n=t.shift();return u.resolve(this.exists.apply(this,t)).then(n)}e=e||{};var r=this.fs.exists(this.path(),e);return r||e.noFollowLink?r:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(e){var t=this;if(e=e||{},this.isLink())return u.resolve(this.fs.rm(this.path(),e));var n;return n=this.isDir()&&(e.recursive||e.r)?this.each(function(t){return t.rm(e)}):u.resolve(),n.then(function(){return t.act.fs.rm(t.act.path,e)})},removeWithoutTrash:function(e){e=e||{},e.noTrash=!0,this.rm(e)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(e){return"function"==typeof e?this.getText(e):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(e){if(t.is(e,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());return u.resolve(this.isText()?this.act.fs.setContent(this.act.path,i.plainText(e)):this.act.fs.setContent(this.act.path,i.url(e)))},appendText:function(e){if(t.is(e,String),this.isText())return this.act.fs.appendContent(this.act.path,i.plainText(e));throw new Error("append only for text file")},getContent:function(e){return"function"==typeof e?this.act.fs.getContentAsync(this.act.path).then(e):this.act.fs.getContent(this.act.path)},setContent:function(e){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,e)},getText:function(e){if("function"==typeof e){var t=this;return this.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}).then(e)}return this.isText()?this.act.fs.getContent(this.act.path).toPlainText():this.act.fs.getContent(this.act.path).toURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(){return this.act.fs.getContentType(this.act.path)},bytes:function(e){return i.isBuffer(e)?this.setBytes(e):this.getBytes()},setBytes:function(e){return this.act.fs.setContent(this.act.path,i.bin(e,this.contentType()))},getBytes:function(e){return e=e||{},this.act.fs.getContent(this.act.path).toBin(e.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(){return this.text().replace(/\r/g,"").split("\n")},obj:function(){var e=this;if(0==arguments.length){var n=e.text();return n?JSON.parse(n):null}e.text(JSON.stringify(t.is(arguments[0],Object)))},copyFrom:function(e,t){return e.copyTo(this,t)},copyTo:function(e,n){t(e&&e.isSFile(),e+" is not a file");var r=this,n=n||{},i=r.isDir(),a=e.isDir();if(!i&&a&&(e=e.rel(r.name()),t(!e.isDir(),e+" is a directory."),a=!1),!i||a){if(i||a)return t(i&&a,"Both src and dst should be dir"),r.each(function(t){e.rel(t.name()).copyFrom(t,n)});n.echo&&n.echo(r+" -> "+e);var s=this.act.fs.cp(this.act.path,e.getResolvedLinkPath(),n);return n.a&&e.setMetaInfo(r.getMetaInfo()),u.resolve(s)}this.err("Cannot move dir to file")},moveFrom:function(e,t){return this.copyFrom(e,t).then(function(){return e.rm({recursive:!0})})},moveTo:function(e,t){return e.moveFrom(this,t)},assertDir:function(){return t.is(this.path(),n.Dir),this},each:function(e,t){var n=this.assertDir();return n.listFilesAsync(t).then(function(t){return u.each(t,e)})},eachrev:function(e,t){var n=this.assertDir();return n.listFilesAsync(t).then(function(t){return u.each(t.reverse(),e)})},recursive:function(e,t){var n=this.assertDir();return n.each(function(t){return t.isDir()?t.recursive(e):e(t)},t)},listFilesAsync:function(e){t(null==e||"object"==typeof e);var n,r=this.assertDir(),i=this.path();return e=r.convertOptions(e),n||(n=e.order),this.act.fs.opendirAsync(this.act.path,e).then(function(t){for(var a=[],s=0;s<t.length;s++){var o=t[s];e.excludes[i+o]||a.push(r.rel(o))}return"function"==typeof n&&a.sort&&a.sort(n),a})},listFiles:function(e){var t=Array.prototype.slice.call(arguments);return u.assertResolved(this.listFilesAsync.apply(this,t))},ls:function(e){t(null==e||"object"==typeof e);var n=this.assertDir();if(!e)return this.act.fs.opendir(this.act.path,e);var r=n.listFiles(e);return r.map(function(e){return e.name()})},convertOptions:function(e){var i=r.extend({},e),a=(this.assertDir(),this.path());if(i.excludes||(i.excludes={}),i.excludes instanceof Array){var s={};i.excludes.forEach(function(e){n.startsWith(e,"/")?s[e]=1:s[a+e]=1}),i.excludes=s}return t.is(i,{excludes:{}})},mkdir:function(){return this.touch()},link:function(e,t){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,e.path(),t)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(e){return this.getFS().getRootFS().addObserver(this.path(),e)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use 'zip' instead.");s(this.getBlob(),this.name())}},Object.defineProperty(c.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),t.is(this._act,{fs:a,path:n.Absolute}),this._act)}}),c}),e("RootFS",["assert","FS2","PathUtil","SFile"],function(e,t,n,r){var i=function(n){e.is(n,t),this.mount(null,n)},a=i.prototype,s={err:function(e,t){throw new Error(e+": "+t)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(t){e.is(arguments,[n.AbsDir]);var r=this.fstab();console.log(r);for(var i=0;i<r.length;i++)if(r[i].mountPoint==t)return r.splice(i,1),!0;return!1},availFSTypes:function(){return t.availFSTypes()},mount:function(n,r,i){if("string"==typeof r){var a=e(t.availFSTypes()[r],"fstype "+r+" is undefined.");r=a(n,i||{})}e.is(r,t),r.mounted(this,n),this.fstab().unshift(r)},resolveFS:function(r){e.is(r,n.Absolute);var i;return this.fstab().forEach(function(e){i||e.inMyFS(r)&&(i=e)}),i||this.err(r,"Cannot resolve"),e.is(i,t)},get:function(t){return e.is(t,n.Absolute),new r(this.resolveFS(t),t)},addObserver:function(){this.observers=this.observers||[];var t,n;if(2==arguments.length)t=arguments[0],n=arguments[1];else{if(1!=arguments.length)throw new Error("Invalid argument spec");t="",n=arguments[0]}e.is(t,String),e.is(n,Function);var r=this.observers,i={path:t,handler:n,remove:function(){var e=r.indexOf(this);r.splice(e,1)}};return this.observers.push(i),i},notifyChanged:function(e,t){this.observers&&this.observers.forEach(function(r){n.startsWith(e,r.path)&&r.handler(e,t)})},getRootFS:function(){return this}};for(var o in s)a[o]=s[o];return i}),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof e&&e.amd)e("jszip",[],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.JSZip=t()}}(function(){return function e(t,n,r){function i(s,o){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";var r=e("./utils"),i=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,i,s,o,u,c,l=[],f=0,h=e.length,d=h,p="string"!==r.getTypeOf(e);f<e.length;)d=h-f,p?(t=e[f++],n=h>f?e[f++]:0,i=h>f?e[f++]:0):(t=e.charCodeAt(f++),n=h>f?e.charCodeAt(f++):0,i=h>f?e.charCodeAt(f++):0),s=t>>2,o=(3&t)<<4|n>>4,u=d>1?(15&n)<<2|i>>6:64,c=d>2?63&i:64,l.push(a.charAt(s)+a.charAt(o)+a.charAt(u)+a.charAt(c));return l.join("")},n.decode=function(e){var t,n,r,s,o,u,c,l=0,f=0,h="data:";if(e.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var d=3*e.length/4;if(e.charAt(e.length-1)===a.charAt(64)&&d--,e.charAt(e.length-2)===a.charAt(64)&&d--,d%1!==0)throw new Error("Invalid base64 input, bad content length.");var p;for(p=i.uint8array?new Uint8Array(0|d):new Array(0|d);l<e.length;)s=a.indexOf(e.charAt(l++)),o=a.indexOf(e.charAt(l++)),u=a.indexOf(e.charAt(l++)),c=a.indexOf(e.charAt(l++)),t=s<<2|o>>4,n=(15&o)<<4|u>>2,r=(3&u)<<6|c,p[f++]=t,64!==u&&(p[f++]=n),64!==c&&(p[f++]=r);return p}},{"./support":30,"./utils":32}],2:[function(e,t){"use strict";function n(e,t,n,r,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=r,this.compressedContent=i}var r=e("./external"),i=e("./stream/DataWorker"),a=e("./stream/DataLengthProbe"),s=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");n.prototype={getContentWorker:function(){var e=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},n.createWorkerFrom=function(e,t,n){return e.pipe(new s).pipe(new a("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new a("compressedSize")).withStreamInfo("compression",t)},t.exports=n},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){"use strict";var r=e("./stream/GenericWorker");n.STORE={magic:"\x00\x00",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t){"use strict";function n(){for(var e,t=[],n=0;256>n;n++){e=n;for(var r=0;8>r;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function r(e,t,n,r){var i=s,a=r+n;e=-1^e;for(var o=r;a>o;o++)e=e>>>8^i[255&(e^t[o])];return-1^e}function i(e,t,n,r){var i=s,a=r+n;e=-1^e;for(var o=r;a>o;o++)e=e>>>8^i[255&(e^t.charCodeAt(o))];return-1^e}var a=e("./utils"),s=n();t.exports=function(e,t){if("undefined"==typeof e||!e.length)return 0;var n="string"!==a.getTypeOf(e);return n?r(0|t,e,e.length,0):i(0|t,e,e.length,0)}},{"./utils":32}],5:[function(e,t,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t){var n=null;n="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:n}},{lie:58}],7:[function(e,t,n){"use strict";function r(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,a=e("pako"),s=e("./utils"),o=e("./stream/GenericWorker"),u=i?"uint8array":"array";n.magic="\b\x00",s.inherits(r,o),r.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(u,e.data),!1)},r.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},r.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},r.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},n.compressWorker=function(e){return new r("Deflate",e)},n.uncompressWorker=function(){return new r("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(e,t){"use strict";function n(e,t,n,r){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var r=e("../utils"),i=e("../stream/GenericWorker"),a=e("../utf8"),s=e("../crc32"),o=e("../signature"),u=function(e,t){var n,r="";for(n=0;t>n;n++)r+=String.fromCharCode(255&e),e>>>=8;return r},c=function(e,t){var n=e;return e||(n=t?16893:33204),(65535&n)<<16},l=function(e){return 63&(e||0)},f=function(e,t,n,i,f,h){var d,p,m=e.file,g=e.compression,v=h!==a.utf8encode,y=r.transformTo("string",h(m.name)),b=r.transformTo("string",a.utf8encode(m.name)),_=m.comment,w=r.transformTo("string",h(_)),T=r.transformTo("string",a.utf8encode(_)),S=b.length!==m.name.length,x=T.length!==_.length,A="",M="",k="",E=m.dir,P=m.date,B={crc32:0,compressedSize:0,uncompressedSize:0};(!t||n)&&(B.crc32=e.crc32,B.compressedSize=e.compressedSize,B.uncompressedSize=e.uncompressedSize);var D=0;t&&(D|=8),v||!S&&!x||(D|=2048);var L=0,I=0;E&&(L|=16),"UNIX"===f?(I=798,L|=c(m.unixPermissions,E)):(I=20,L|=l(m.dosPermissions,E)),d=P.getUTCHours(),d<<=6,d|=P.getUTCMinutes(),d<<=5,d|=P.getUTCSeconds()/2,p=P.getUTCFullYear()-1980,p<<=4,p|=P.getUTCMonth()+1,p<<=5,p|=P.getUTCDate(),S&&(M=u(1,1)+u(s(y),4)+b,A+="up"+u(M.length,2)+M),x&&(k=u(1,1)+u(s(w),4)+T,A+="uc"+u(k.length,2)+k);var C="";C+="\n\x00",C+=u(D,2),C+=g.magic,C+=u(d,2),C+=u(p,2),C+=u(B.crc32,4),C+=u(B.compressedSize,4),C+=u(B.uncompressedSize,4),C+=u(y.length,2),C+=u(A.length,2);var N=o.LOCAL_FILE_HEADER+C+y+A,O=o.CENTRAL_FILE_HEADER+u(I,2)+C+u(w.length,2)+"\x00\x00\x00\x00"+u(L,4)+u(i,4)+y+A+w;return{fileRecord:N,dirRecord:O}},h=function(e,t,n,i,a){var s="",c=r.transformTo("string",a(i));return s=o.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+u(e,2)+u(e,2)+u(t,4)+u(n,4)+u(c.length,2)+c},d=function(e){var t="";return t=o.DATA_DESCRIPTOR+u(e.crc32,4)+u(e.compressedSize,4)+u(e.uncompressedSize,4)};r.inherits(n,i),n.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-r-1))/n:100}}))},n.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=f(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},n.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=f(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:d(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},n.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,r=h(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},n.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},n.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},n.prototype.resume=function(){return i.prototype.resume.call(this)?!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0):!1},n.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},n.prototype.lock=function(){i.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=n},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){"use strict";var r=e("../compressions"),i=e("./ZipFileWorker"),a=function(e,t){var n=e||t,i=r[n];if(!i)throw new Error(n+" is not a valid compression method !");return i};n.generateWorker=function(e,t,n){var r=new i(t.streamFiles,n,t.platform,t.encodeFileName),s=0;try{e.forEach(function(e,n){s++;var i=a(n.options.compression,t.compression),o=n.options.compressionOptions||t.compressionOptions||{},u=n.dir,c=n.date;n._compressWorker(i,o).withStreamInfo("file",{name:e,dir:u,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(r)}),r.entriesCount=s}catch(o){r.error(o)}return r}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}n.prototype=e("./object"),n.prototype.loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.1.5",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=e("./external"),t.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t){"use strict";function n(e){return new i.Promise(function(t,n){var r=e.decompressed.getContentWorker().pipe(new o);r.on("error",function(e){n(e)}).on("end",function(){r.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}var r=e("./utils"),i=e("./external"),a=e("./utf8"),r=e("./utils"),s=e("./zipEntries"),o=e("./stream/Crc32Probe"),u=e("./nodejsUtils");t.exports=function(e,t){var o=this;return t=r.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then(function(e){var n=new s(t);return n.load(e),n}).then(function(e){var r=[i.Promise.resolve(e)],a=e.files;if(t.checkCRC32)for(var s=0;s<a.length;s++)r.push(n(a[s]));return i.Promise.all(r)}).then(function(e){for(var n=e.shift(),r=n.files,i=0;i<r.length;i++){var a=r[i];o.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:t.createFolders})}return n.zipComment.length&&(o.comment=n.zipComment),o})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t){"use strict";function n(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}var r=e("../utils"),i=e("../stream/GenericWorker");r.inherits(n,i),n.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},n.prototype.pause=function(){return i.prototype.pause.call(this)?(this._stream.pause(),!0):!1},n.prototype.resume=function(){return i.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1},t.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t){"use strict";function n(e,t,n){r.call(this,t),this._helper=e;var i=this;e.on("data",function(e,t){i.push(e)||i._helper.pause(),n&&n(t)}).on("error",function(e){i.emit("error",e)}).on("end",function(){i.push(null)})}var r=e("readable-stream").Readable,i=e("../utils");i.inherits(n,r),n.prototype._read=function(){this._helper.resume()},t.exports=n},{"../utils":32,"readable-stream":16}],14:[function(e,t){"use strict";t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){return new Buffer(e,t)},allocBuffer:function(e){return Buffer.alloc?Buffer.alloc(e):new Buffer(e)},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t){"use strict";function n(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var r=e("./utf8"),i=e("./utils"),a=e("./stream/GenericWorker"),s=e("./stream/StreamHelper"),o=e("./defaults"),u=e("./compressedObject"),c=e("./zipObject"),l=e("./generate"),f=e("./nodejsUtils"),h=e("./nodejs/NodejsStreamInputAdapter"),d=function(e,t,n){var r,s=i.getTypeOf(t),l=i.extend(n||{},o);l.date=l.date||new Date,null!==l.compression&&(l.compression=l.compression.toUpperCase()),"string"==typeof l.unixPermissions&&(l.unixPermissions=parseInt(l.unixPermissions,8)),l.unixPermissions&&16384&l.unixPermissions&&(l.dir=!0),l.dosPermissions&&16&l.dosPermissions&&(l.dir=!0),l.dir&&(e=m(e)),l.createFolders&&(r=p(e))&&g.call(this,r,!0);var d="string"===s&&l.binary===!1&&l.base64===!1;n&&"undefined"!=typeof n.binary||(l.binary=!d);var v=t instanceof u&&0===t.uncompressedSize;(v||l.dir||!t||0===t.length)&&(l.base64=!1,l.binary=!0,t="",l.compression="STORE",s="string");var y=null;y=t instanceof u||t instanceof a?t:f.isNode&&f.isStream(t)?new h(e,t):i.prepareContent(e,t,l.binary,l.optimizedBinaryString,l.base64);var b=new c(e,y,l);this.files[e]=b},p=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t="undefined"!=typeof t?t:o.createFolders,e=m(e),this.files[e]||d.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,r;for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],n=t.slice(this.root.length,t.length),n&&t.slice(0,this.root.length)===this.root&&e(n,r))},filter:function(e){var t=[];return this.forEach(function(n,r){e(n,r)&&t.push(r)}),t},file:function(e,t,r){if(1===arguments.length){if(n(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}var a=this.files[this.root+e];return a&&!a.dir?a:null}return e=this.root+e,d.call(this,e,t,r),this},folder:function(e){if(!e)return this;if(n(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,r=g.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;
var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if(n=i.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode}),n.type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");i.checkSupport(n.type),("darwin"===n.platform||"freebsd"===n.platform||"linux"===n.platform||"sunos"===n.platform)&&(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var o=n.comment||this.comment||"";t=l.generateWorker(this,n,o)}catch(u){t=new a("error"),t.error(u)}return new s(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return e=e||{},e.type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t){t.exports=e("stream")},{stream:void 0}],17:[function(e,t){"use strict";function n(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}var r=e("./DataReader"),i=e("../utils");i.inherits(n,r),n.prototype.byteAt=function(e){return this.data[this.zero+e]},n.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===n&&this.data[a+2]===r&&this.data[a+3]===i)return a-this.zero;return-1},n.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),a=this.readData(4);return t===a[0]&&n===a[1]&&r===a[2]&&i===a[3]},n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./DataReader":18}],18:[function(e,t){"use strict";function n(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}var r=e("../utils");n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=n},{"../utils":32}],19:[function(e,t){"use strict";function n(e){r.call(this,e)}var r=e("./Uint8ArrayReader"),i=e("../utils");i.inherits(n,r),n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t){"use strict";function n(e){r.call(this,e)}var r=e("./DataReader"),i=e("../utils");i.inherits(n,r),n.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},n.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},n.prototype.readAndCheckSignature=function(e){var t=this.readData(4);return e===t},n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./DataReader":18}],21:[function(e,t){"use strict";function n(e){r.call(this,e)}var r=e("./ArrayReader"),i=e("../utils");i.inherits(n,r),n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(e,t){"use strict";var n=e("../utils"),r=e("../support"),i=e("./ArrayReader"),a=e("./StringReader"),s=e("./NodeBufferReader"),o=e("./Uint8ArrayReader");t.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),"string"!==t||r.uint8array?"nodebuffer"===t?new s(e):r.uint8array?new o(n.transformTo("uint8array",e)):new i(n.transformTo("array",e)):new a(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t){"use strict";function n(e){r.call(this,"ConvertWorker to "+e),this.destType=e}var r=e("./GenericWorker"),i=e("../utils");i.inherits(n,r),n.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(e,t){"use strict";function n(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var r=e("./GenericWorker"),i=e("../crc32"),a=e("../utils");a.inherits(n,r),n.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t){"use strict";function n(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}var r=e("../utils"),i=e("./GenericWorker");r.inherits(n,i),n.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(e,t){"use strict";function n(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}var r=e("../utils"),i=e("./GenericWorker"),a=16384;r.inherits(n,i),n.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return i.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0):!1},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=a,t=null,n=Math.min(this.max,this.index+e);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,n);break;case"uint8array":t=this.data.subarray(this.index,n);break;case"array":case"nodebuffer":t=this.data.slice(this.index,n)}return this.index=n,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(e,t){"use strict";function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return this.isFinished?!1:(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=n},{}],29:[function(e,t){"use strict";function n(e,t,n){switch(e){case"blob":return s.newBlob(s.transformTo("arraybuffer",t),n);case"base64":return c.encode(t);default:return s.transformTo(e,t)}}function r(e,t){var n,r=0,i=null,a=0;for(n=0;n<t.length;n++)a+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(a),n=0;n<t.length;n++)i.set(t[n],r),r+=t[n].length;return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}function i(e,t){return new f.Promise(function(i,a){var s=[],o=e._internalType,u=e._outputType,c=e._mimeType;e.on("data",function(e,n){s.push(e),t&&t(n)}).on("error",function(e){s=[],a(e)}).on("end",function(){try{var e=n(u,r(o,s),c);i(e)}catch(t){a(t)}s=[]}).resume()})}function a(e,t,n){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=t,this._mimeType=n,s.checkSupport(r),this._worker=e.pipe(new o(r)),e.lock()}catch(i){this._worker=new u("error"),this._worker.error(i)}}var s=e("../utils"),o=e("./ConvertWorker"),u=e("./GenericWorker"),c=e("../base64"),l=e("../support"),f=e("../external"),h=null;if(l.nodestream)try{h=e("../nodejs/NodejsStreamOutputAdapter")}catch(d){}a.prototype={accumulate:function(e){return i(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,function(e){t.call(n,e.data,e.meta)}):this._worker.on(e,function(){s.delay(t,arguments,n)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(s.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=a},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=0===new Blob([r],{type:"application/zip"}).size}catch(i){try{var a=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,s=new a;s.append(r),n.blob=0===s.getBlob("application/zip").size}catch(i){n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch(i){n.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){"use strict";function r(){u.call(this,"utf-8 decode"),this.leftOver=null}function i(){u.call(this,"utf-8 encode")}for(var a=e("./utils"),s=e("./support"),o=e("./nodejsUtils"),u=e("./stream/GenericWorker"),c=new Array(256),l=0;256>l;l++)c[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;c[254]=c[254]=1;var f=function(e){var t,n,r,i,a,o=e.length,u=0;for(i=0;o>i;i++)n=e.charCodeAt(i),55296===(64512&n)&&o>i+1&&(r=e.charCodeAt(i+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),u+=128>n?1:2048>n?2:65536>n?3:4;for(t=s.uint8array?new Uint8Array(u):new Array(u),a=0,i=0;u>a;i++)n=e.charCodeAt(i),55296===(64512&n)&&o>i+1&&(r=e.charCodeAt(i+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),128>n?t[a++]=n:2048>n?(t[a++]=192|n>>>6,t[a++]=128|63&n):65536>n?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},h=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n?t:0===n?t:n+c[e[n]]>t?n:t},d=function(e){var t,n,r,i,s=e.length,o=new Array(2*s);for(n=0,t=0;s>t;)if(r=e[t++],128>r)o[n++]=r;else if(i=c[r],i>4)o[n++]=65533,t+=i-1;else{for(r&=2===i?31:3===i?15:7;i>1&&s>t;)r=r<<6|63&e[t++],i--;i>1?o[n++]=65533:65536>r?o[n++]=r:(r-=65536,o[n++]=55296|r>>10&1023,o[n++]=56320|1023&r)}return o.length!==n&&(o.subarray?o=o.subarray(0,n):o.length=n),a.applyFromCharCode(o)};n.utf8encode=function(e){return s.nodebuffer?o.newBufferFrom(e,"utf-8"):f(e)},n.utf8decode=function(e){return s.nodebuffer?a.transformTo("nodebuffer",e).toString("utf-8"):(e=a.transformTo(s.uint8array?"uint8array":"array",e),d(e))},a.inherits(r,u),r.prototype.processChunk=function(e){var t=a.transformTo(s.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var r=t;t=new Uint8Array(r.length+this.leftOver.length),t.set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var i=h(t),o=t;i!==t.length&&(s.uint8array?(o=t.subarray(0,i),this.leftOver=t.subarray(i,t.length)):(o=t.slice(0,i),this.leftOver=t.slice(i,t.length))),this.push({data:n.utf8decode(o),meta:e.meta})},r.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=r,a.inherits(i,u),i.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=i},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,n){"use strict";function r(e){var t=null;return t=u.uint8array?new Uint8Array(e.length):new Array(e.length),a(e,t)}function i(e){return e}function a(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}function s(e){var t=65536,r=n.getTypeOf(e),i=!0;if("uint8array"===r?i=d.applyCanBeUsed.uint8array:"nodebuffer"===r&&(i=d.applyCanBeUsed.nodebuffer),i)for(;t>1;)try{return d.stringifyByChunk(e,r,t)}catch(a){t=Math.floor(t/2)}return d.stringifyByChar(e)}function o(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}var u=e("./support"),c=e("./base64"),l=e("./nodejsUtils"),f=e("core-js/library/fn/set-immediate"),h=e("./external");n.newBlob=function(e,t){n.checkSupport("blob");try{return new Blob([e],{type:t})}catch(r){try{var i=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,a=new i;return a.append(e),a.getBlob(t)}catch(r){throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(e,t,n){var r=[],i=0,a=e.length;if(n>=a)return String.fromCharCode.apply(null,e);for(;a>i;)r.push("array"===t||"nodebuffer"===t?String.fromCharCode.apply(null,e.slice(i,Math.min(i+n,a))):String.fromCharCode.apply(null,e.subarray(i,Math.min(i+n,a)))),i+=n;return r.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return u.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return u.nodebuffer&&1===String.fromCharCode.apply(null,l.allocBuffer(1)).length}catch(e){return!1}}()}};n.applyFromCharCode=s;var p={};p.string={string:i,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return p.string.uint8array(e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:function(e){return a(e,l.allocBuffer(e.length))}},p.array={string:s,array:i,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return l.newBufferFrom(e)}},p.arraybuffer={string:function(e){return s(new Uint8Array(e))},array:function(e){return o(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:i,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return l.newBufferFrom(new Uint8Array(e))}},p.uint8array={string:s,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:i,nodebuffer:function(e){return l.newBufferFrom(e)}},p.nodebuffer={string:s,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return p.nodebuffer.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:i},n.transformTo=function(e,t){if(t||(t=""),!e)return t;n.checkSupport(e);var r=n.getTypeOf(t),i=p[r][e](t);return i},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":u.nodebuffer&&l.isBuffer(e)?"nodebuffer":u.uint8array&&e instanceof Uint8Array?"uint8array":u.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){var t=u[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,r="";for(n=0;n<(e||"").length;n++)t=e.charCodeAt(n),r+="\\x"+(16>t?"0":"")+t.toString(16).toUpperCase();return r},n.delay=function(e,t,n){f(function(){e.apply(n||null,t||[])})},n.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},n.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&"undefined"==typeof n[t]&&(n[t]=arguments[e][t]);return n},n.prepareContent=function(e,t,i,a,s){var o=h.Promise.resolve(t).then(function(e){var t=u.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)));return t&&"undefined"!=typeof FileReader?new h.Promise(function(t,n){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=function(e){n(e.target.error)},r.readAsArrayBuffer(e)}):e});return o.then(function(t){var o=n.getTypeOf(t);return o?("arraybuffer"===o?t=n.transformTo("uint8array",t):"string"===o&&(s?t=c.decode(t):i&&a!==!0&&(t=r(t))),t):h.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(e,t){"use strict";function n(e){this.files=[],this.loadOptions=e}var r=e("./reader/readerFor"),i=e("./utils"),a=e("./signature"),s=e("./zipEntry"),o=(e("./utf8"),e("./support"));n.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var r=this.reader.readString(4),i=r===t;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=o.uint8array?"uint8array":"array",n=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,r=this.zip64EndOfCentralSize-44,i=0;r>i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)e=new s({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(0>e){var t=!this.isSignature(0,a.LOCAL_FILE_HEADER);throw new Error(t?"Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html":"Corrupted zip: can't find end of central directory")}this.reader.setIndex(e);var n=e;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),0>e)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var s=n-r;if(s>0)this.isSignature(n,a.CENTRAL_FILE_HEADER)||(this.reader.zero=s);else if(0>s)throw new Error("Corrupted zip: missing "+Math.abs(s)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=n},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t){"use strict";function n(e,t){this.options=e,this.loadOptions=t}var r=e("./reader/readerFor"),i=e("./utils"),a=e("./compressedObject"),s=e("./crc32"),o=e("./utf8"),u=e("./compressions"),c=e("./support"),l=0,f=3,h=function(e){for(var t in u)if(u.hasOwnProperty(t)&&u[t].magic===e)return u[t];return null};n.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(t=h(this.compressionMethod),null===t)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=16&this.externalFileAttributes?!0:!1,e===l&&(this.dosPermissions=63&this.externalFileAttributes),e===f&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,n,r,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<i;)t=e.readInt(2),n=e.readInt(2),r=e.readData(n),this.extraFields[t]={id:t,length:n,value:r}},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var a=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:s(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:s(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null}},t.exports=n},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t){"use strict";var n=e("./stream/StreamHelper"),r=e("./stream/DataWorker"),i=e("./utf8"),a=e("./compressedObject"),s=e("./stream/GenericWorker"),o=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};o.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");r=e.toLowerCase();var a="string"===r||"text"===r;("binarystring"===r||"text"===r)&&(r="string"),t=this._decompressWorker();var o=!this._dataBinary;o&&!a&&(t=t.pipe(new i.Utf8EncodeWorker)),!o&&a&&(t=t.pipe(new i.Utf8DecodeWorker))}catch(u){t=new s("error"),t.error(u)}return new n(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof a&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new i.Utf8EncodeWorker)),a.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof s?this._data:new r(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<u.length;l++)o.prototype[u[l]]=c;t.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t){e("../modules/web.immediate"),t.exports=e("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(e,t){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],38:[function(e,t){var n=e("./_is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":51}],39:[function(e,t){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],40:[function(e,t){var n=t.exports={version:"2.3.0"};"number"==typeof __e&&(__e=n)},{}],41:[function(e,t){var n=e("./_a-function");t.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":37}],42:[function(e,t){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(e,t){var n=e("./_is-object"),r=e("./_global").document,i=n(r)&&n(r.createElement);t.exports=function(e){return i?r.createElement(e):{}}},{"./_global":46,"./_is-object":51}],44:[function(e,t){var n=e("./_global"),r=e("./_core"),i=e("./_ctx"),a=e("./_hide"),s="prototype",o=function(e,t,u){var c,l,f,h=e&o.F,d=e&o.G,p=e&o.S,m=e&o.P,g=e&o.B,v=e&o.W,y=d?r:r[t]||(r[t]={}),b=y[s],_=d?n:p?n[t]:(n[t]||{})[s];d&&(u=t);for(c in u)l=!h&&_&&void 0!==_[c],l&&c in y||(f=l?_[c]:u[c],y[c]=d&&"function"!=typeof _[c]?u[c]:g&&l?i(f,n):v&&_[c]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[s]=e[s],t}(f):m&&"function"==typeof f?i(Function.call,f):f,m&&((y.virtual||(y.virtual={}))[c]=f,e&o.R&&b&&!b[c]&&a(b,c,f)))};o.F=1,o.G=2,o.S=4,o.P=8,o.B=16,o.W=32,o.U=64,o.R=128,t.exports=o
},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(e,t){t.exports=function(e){try{return!!e()}catch(t){return!0}}},{}],46:[function(e,t){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],47:[function(e,t){var n=e("./_object-dp"),r=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,i){return n.f(e,t,r(1,i))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(e,t){t.exports=e("./_global").document&&document.documentElement},{"./_global":46}],49:[function(e,t){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(e,t){t.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],51:[function(e,t){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],52:[function(e,t,n){var r=e("./_an-object"),i=e("./_ie8-dom-define"),a=e("./_to-primitive"),s=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return s(e,t,n)}catch(o){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(e,t){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],54:[function(e,t){var n,r,i,a=e("./_ctx"),s=e("./_invoke"),o=e("./_html"),u=e("./_dom-create"),c=e("./_global"),l=c.process,f=c.setImmediate,h=c.clearImmediate,d=c.MessageChannel,p=0,m={},g="onreadystatechange",v=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},y=function(e){v.call(e.data)};f&&h||(f=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return m[++p]=function(){s("function"==typeof e?e:Function(e),t)},n(p),p},h=function(e){delete m[e]},"process"==e("./_cof")(l)?n=function(e){l.nextTick(a(v,e,1))}:d?(r=new d,i=r.port2,r.port1.onmessage=y,n=a(i.postMessage,i,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(n=function(e){c.postMessage(e+"","*")},c.addEventListener("message",y,!1)):n=g in u("script")?function(e){o.appendChild(u("script"))[g]=function(){o.removeChild(this),v.call(e)}}:function(e){setTimeout(a(v,e,1),0)}),t.exports={set:f,clear:h}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(e,t){var n=e("./_is-object");t.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(e){var t=e("./_export"),n=e("./_task");t(t.G+t.B,{setImmediate:n.set,clearImmediate:n.clear})},{"./_export":44,"./_task":54}],57:[function(e,t){(function(e){"use strict";function n(){l=!0;for(var e,t,n=f.length;n;){for(t=f,f=[],e=-1;++e<n;)t[e]();n=f.length}l=!1}function r(e){1!==f.push(e)||l||i()}var i,a=e.MutationObserver||e.WebKitMutationObserver;if(a){var s=0,o=new a(n),u=e.document.createTextNode("");o.observe(u,{characterData:!0}),i=function(){u.data=s=++s%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var c=new e.MessageChannel;c.port1.onmessage=n,i=function(){c.port2.postMessage(0)}}var l,f=[];t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(e,t){"use strict";function n(){}function r(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,e!==n&&o(this,e)}function i(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function a(e,t,n){d(function(){var r;try{r=t(n)}catch(i){return p.reject(e,i)}r===e?p.reject(e,new TypeError("Cannot resolve promise with itself")):p.resolve(e,r)})}function s(e){var t=e&&e.then;return!e||"object"!=typeof e&&"function"!=typeof e||"function"!=typeof t?void 0:function(){t.apply(e,arguments)}}function o(e,t){function n(t){a||(a=!0,p.reject(e,t))}function r(t){a||(a=!0,p.resolve(e,t))}function i(){t(r,n)}var a=!1,s=u(i);"error"===s.status&&n(s.value)}function u(e,t){var n={};try{n.value=e(t),n.status="success"}catch(r){n.status="error",n.value=r}return n}function c(e){return e instanceof this?e:p.resolve(new this(n),e)}function l(e){var t=new this(n);return p.reject(t,e)}function f(e){function t(e,t){function n(e){s[t]=e,++o!==i||a||(a=!0,p.resolve(c,s))}r.resolve(e).then(n,function(e){a||(a=!0,p.reject(c,e))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,a=!1;if(!i)return this.resolve([]);for(var s=new Array(i),o=0,u=-1,c=new this(n);++u<i;)t(e[u],u);return c}function h(e){function t(e){r.resolve(e).then(function(e){a||(a=!0,p.resolve(o,e))},function(e){a||(a=!0,p.reject(o,e))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,a=!1;if(!i)return this.resolve([]);for(var s=-1,o=new this(n);++s<i;)t(e[s]);return o}var d=e("immediate"),p={},m=["REJECTED"],g=["FULFILLED"],v=["PENDING"];t.exports=r,r.prototype["catch"]=function(e){return this.then(null,e)},r.prototype.then=function(e,t){if("function"!=typeof e&&this.state===g||"function"!=typeof t&&this.state===m)return this;var r=new this.constructor(n);if(this.state!==v){var s=this.state===g?e:t;a(r,s,this.outcome)}else this.queue.push(new i(r,e,t));return r},i.prototype.callFulfilled=function(e){p.resolve(this.promise,e)},i.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},i.prototype.callRejected=function(e){p.reject(this.promise,e)},i.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},p.resolve=function(e,t){var n=u(s,t);if("error"===n.status)return p.reject(e,n.value);var r=n.value;if(r)o(e,r);else{e.state=g,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},p.reject=function(e,t){e.state=m,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},r.resolve=c,r.reject=l,r.all=f,r.race=h},{immediate:57}],59:[function(e,t){var n=e("./lib/utils/common").assign,r=e("./lib/deflate"),i=e("./lib/inflate"),a=e("./lib/zlib/constants"),s={};n(s,r,i,a),t.exports=s},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.options=u.assign({level:y,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var n=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==m)throw new Error(l[n]);if(t.header&&o.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"==typeof t.dictionary?c.string2buf(t.dictionary):"[object ArrayBuffer]"===h.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=o.deflateSetDictionary(this.strm,i),n!==m)throw new Error(l[n]);this._dict_set=!0}}function i(e,t){var n=new r(t);if(n.push(e,!0),n.err)throw n.msg||l[n.err];return n.result}function a(e,t){return t=t||{},t.raw=!0,i(e,t)}function s(e,t){return t=t||{},t.gzip=!0,i(e,t)}var o=e("./zlib/deflate"),u=e("./utils/common"),c=e("./utils/strings"),l=e("./zlib/messages"),f=e("./zlib/zstream"),h=Object.prototype.toString,d=0,p=4,m=0,g=1,v=2,y=-1,b=0,_=8;r.prototype.push=function(e,t){var n,r,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:t===!0?p:d,i.input="string"==typeof e?c.string2buf(e):"[object ArrayBuffer]"===h.call(e)?new Uint8Array(e):e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new u.Buf8(a),i.next_out=0,i.avail_out=a),n=o.deflate(i,r),n!==g&&n!==m)return this.onEnd(n),this.ended=!0,!1;(0===i.avail_out||0===i.avail_in&&(r===p||r===v))&&this.onData("string"===this.options.to?c.buf2binstring(u.shrinkBuf(i.output,i.next_out)):u.shrinkBuf(i.output,i.next_out))}while((i.avail_in>0||0===i.avail_out)&&n!==g);return r===p?(n=o.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===m):r===v?(this.onEnd(m),i.avail_out=0,!0):!0},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===m&&(this.result="string"===this.options.to?this.chunks.join(""):u.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=r,n.deflate=i,n.deflateRaw=a,n.gzip=s},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var n=s.inflateInit2(this.strm,t.windowBits);if(n!==c.Z_OK)throw new Error(l[n]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function i(e,t){var n=new r(t);if(n.push(e,!0),n.err)throw n.msg||l[n.err];return n.result}function a(e,t){return t=t||{},t.raw=!0,i(e,t)}var s=e("./zlib/inflate"),o=e("./utils/common"),u=e("./utils/strings"),c=e("./zlib/constants"),l=e("./zlib/messages"),f=e("./zlib/zstream"),h=e("./zlib/gzheader"),d=Object.prototype.toString;r.prototype.push=function(e,t){var n,r,i,a,l,f,h=this.strm,p=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;r=t===~~t?t:t===!0?c.Z_FINISH:c.Z_NO_FLUSH,h.input="string"==typeof e?u.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?new Uint8Array(e):e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new o.Buf8(p),h.next_out=0,h.avail_out=p),n=s.inflate(h,c.Z_NO_FLUSH),n===c.Z_NEED_DICT&&m&&(f="string"==typeof m?u.string2buf(m):"[object ArrayBuffer]"===d.call(m)?new Uint8Array(m):m,n=s.inflateSetDictionary(this.strm,f)),n===c.Z_BUF_ERROR&&g===!0&&(n=c.Z_OK,g=!1),n!==c.Z_STREAM_END&&n!==c.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0===h.avail_out||n===c.Z_STREAM_END||0===h.avail_in&&(r===c.Z_FINISH||r===c.Z_SYNC_FLUSH))&&("string"===this.options.to?(i=u.utf8border(h.output,h.next_out),a=h.next_out-i,l=u.buf2string(h.output,i),h.next_out=a,h.avail_out=p-a,a&&o.arraySet(h.output,h.output,i,a,0),this.onData(l)):this.onData(o.shrinkBuf(h.output,h.next_out))),0===h.avail_in&&0===h.avail_out&&(g=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==c.Z_STREAM_END);return n===c.Z_STREAM_END&&(r=c.Z_FINISH),r===c.Z_FINISH?(n=s.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c.Z_OK):r===c.Z_SYNC_FLUSH?(this.onEnd(c.Z_OK),h.avail_out=0,!0):!0},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===c.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=r,n.inflate=i,n.inflateRaw=a,n.ungzip=i},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)return void e.set(t.subarray(n,n+r),i);for(var a=0;r>a;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,s;for(r=0,t=0,n=e.length;n>t;t++)r+=e[t].length;for(s=new Uint8Array(r),i=0,t=0,n=e.length;n>t;t++)a=e[t],s.set(a,i),i+=a.length;return s}},a={arraySet:function(e,t,n,r,i){for(var a=0;r>a;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],63:[function(e,t,n){function r(e,t){if(65537>t&&(e.subarray&&s||!e.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",r=0;t>r;r++)n+=String.fromCharCode(e[r]);return n}var i=e("./common"),a=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(o){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){s=!1}for(var u=new i.Buf8(256),c=0;256>c;c++)u[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;u[254]=u[254]=1,n.string2buf=function(e){var t,n,r,a,s,o=e.length,u=0;for(a=0;o>a;a++)n=e.charCodeAt(a),55296===(64512&n)&&o>a+1&&(r=e.charCodeAt(a+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),a++)),u+=128>n?1:2048>n?2:65536>n?3:4;for(t=new i.Buf8(u),s=0,a=0;u>s;a++)n=e.charCodeAt(a),55296===(64512&n)&&o>a+1&&(r=e.charCodeAt(a+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),a++)),128>n?t[s++]=n:2048>n?(t[s++]=192|n>>>6,t[s++]=128|63&n):65536>n?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},n.buf2binstring=function(e){return r(e,e.length)},n.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;r>n;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,a,s,o=t||e.length,c=new Array(2*o);for(i=0,n=0;o>n;)if(a=e[n++],128>a)c[i++]=a;else if(s=u[a],s>4)c[i++]=65533,n+=s-1;else{for(a&=2===s?31:3===s?15:7;s>1&&o>n;)a=a<<6|63&e[n++],s--;s>1?c[i++]=65533:65536>a?c[i++]=a:(a-=65536,c[i++]=55296|a>>10&1023,c[i++]=56320|1023&a)}return r(c,i)},n.utf8border=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n?t:0===n?t:n+u[e[n]]>t?n:t}},{"./common":62}],64:[function(e,t){"use strict";function n(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,s=0;0!==n;){s=n>2e3?2e3:n,n-=s;do i=i+t[r++]|0,a=a+i|0;while(--s);i%=65521,a%=65521}return i|a<<16|0}t.exports=n},{}],65:[function(e,t){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(e,t){"use strict";function n(){for(var e,t=[],n=0;256>n;n++){e=n;for(var r=0;8>r;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function r(e,t,n,r){var a=i,s=r+n;e^=-1;for(var o=r;s>o;o++)e=e>>>8^a[255&(e^t[o])];return-1^e}var i=n();t.exports=r},{}],67:[function(e,t,n){"use strict";function r(e,t){return e.msg=C[t],t}function i(e){return(e<<1)-(e>4?9:0)}function a(e){for(var t=e.length;--t>=0;)e[t]=0}function s(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(B.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function o(e,t){D._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,s(e.strm)}function u(e,t){e.pending_buf[e.pending++]=t}function c(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function l(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,B.arraySet(t,e.input,e.next_in,i,n),1===e.state.wrap?e.adler=L(e.adler,t,i,n):2===e.state.wrap&&(e.adler=I(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)}function f(e,t){var n,r,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match,u=e.strstart>e.w_size-ft?e.strstart-(e.w_size-ft):0,c=e.window,l=e.w_mask,f=e.prev,h=e.strstart+lt,d=c[a+s-1],p=c[a+s];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do if(n=t,c[n+s]===p&&c[n+s-1]===d&&c[n]===c[a]&&c[++n]===c[a+1]){a+=2,n++;do;while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&h>a);if(r=lt-(h-a),a=h-lt,r>s){if(e.match_start=t,s=r,r>=o)break;d=c[a+s-1],p=c[a+s]}}while((t=f[t&l])>u&&0!==--i);return s<=e.lookahead?s:e.lookahead}function h(e){var t,n,r,i,a,s=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-ft)){B.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,n=e.hash_size,t=n;do r=e.head[--t],e.head[t]=r>=s?r-s:0;while(--n);n=s,t=n;do r=e.prev[--t],e.prev[t]=r>=s?r-s:0;while(--n);i+=s}if(0===e.strm.avail_in)break;if(n=l(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=ct)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+ct-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<ct)););}while(e.lookahead<ft&&0!==e.strm.avail_in)}function d(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(h(e),0===e.lookahead&&t===N)return _t;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,o(e,!1),0===e.strm.avail_out))return _t;if(e.strstart-e.block_start>=e.w_size-ft&&(o(e,!1),0===e.strm.avail_out))return _t}return e.insert=0,t===F?(o(e,!0),0===e.strm.avail_out?Tt:St):e.strstart>e.block_start&&(o(e,!1),0===e.strm.avail_out)?_t:_t}function p(e,t){for(var n,r;;){if(e.lookahead<ft){if(h(e),e.lookahead<ft&&t===N)return _t;if(0===e.lookahead)break}if(n=0,e.lookahead>=ct&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ct-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ft&&(e.match_length=f(e,n)),e.match_length>=ct)if(r=D._tr_tally(e,e.strstart-e.match_start,e.match_length-ct),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ct){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ct-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=D._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(o(e,!1),0===e.strm.avail_out))return _t}return e.insert=e.strstart<ct-1?e.strstart:ct-1,t===F?(o(e,!0),0===e.strm.avail_out?Tt:St):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?_t:wt}function m(e,t){for(var n,r,i;;){if(e.lookahead<ft){if(h(e),e.lookahead<ft&&t===N)return _t;if(0===e.lookahead)break}if(n=0,e.lookahead>=ct&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ct-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ct-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ft&&(e.match_length=f(e,n),e.match_length<=5&&(e.strategy===Z||e.match_length===ct&&e.strstart-e.match_start>4096)&&(e.match_length=ct-1)),e.prev_length>=ct&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-ct,r=D._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ct),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ct-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!==--e.prev_length);if(e.match_available=0,e.match_length=ct-1,e.strstart++,r&&(o(e,!1),0===e.strm.avail_out))return _t}else if(e.match_available){if(r=D._tr_tally(e,0,e.window[e.strstart-1]),r&&o(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return _t}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=D._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ct-1?e.strstart:ct-1,t===F?(o(e,!0),0===e.strm.avail_out?Tt:St):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?_t:wt}function g(e,t){for(var n,r,i,a,s=e.window;;){if(e.lookahead<=lt){if(h(e),e.lookahead<=lt&&t===N)return _t;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=ct&&e.strstart>0&&(i=e.strstart-1,r=s[i],r===s[++i]&&r===s[++i]&&r===s[++i])){a=e.strstart+lt;do;while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&a>i);e.match_length=lt-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ct?(n=D._tr_tally(e,1,e.match_length-ct),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=D._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(o(e,!1),0===e.strm.avail_out))return _t}return e.insert=0,t===F?(o(e,!0),0===e.strm.avail_out?Tt:St):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?_t:wt}function v(e,t){for(var n;;){if(0===e.lookahead&&(h(e),0===e.lookahead)){if(t===N)return _t;break}if(e.match_length=0,n=D._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(o(e,!1),0===e.strm.avail_out))return _t}return e.insert=0,t===F?(o(e,!0),0===e.strm.avail_out?Tt:St):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?_t:wt}function y(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function b(e){e.window_size=2*e.w_size,a(e.head),e.max_lazy_match=P[e.level].max_lazy,e.good_match=P[e.level].good_length,e.nice_match=P[e.level].nice_length,e.max_chain_length=P[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ct-1,e.match_available=0,e.ins_h=0}function _(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=J,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new B.Buf16(2*ot),this.dyn_dtree=new B.Buf16(2*(2*at+1)),this.bl_tree=new B.Buf16(2*(2*st+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new B.Buf16(ut+1),this.heap=new B.Buf16(2*it+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new B.Buf16(2*it+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Y,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?dt:yt,e.adler=2===t.wrap?0:1,t.last_flush=N,D._tr_init(t),j):r(e,U)}function T(e){var t=w(e);return t===j&&b(e.state),t}function S(e,t){return e&&e.state?2!==e.state.wrap?U:(e.state.gzhead=t,j):U}function x(e,t,n,i,a,s){if(!e)return U;var o=1;if(t===q&&(t=6),0>i?(o=0,i=-i):i>15&&(o=2,i-=16),1>a||a>Q||n!==J||8>i||i>15||0>t||t>9||0>s||s>K)return r(e,U);8===i&&(i=9);var u=new _;return e.state=u,u.strm=e,u.wrap=o,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=a+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+ct-1)/ct),u.window=new B.Buf8(2*u.w_size),u.head=new B.Buf16(u.hash_size),u.prev=new B.Buf16(u.w_size),u.lit_bufsize=1<<a+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new B.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=s,u.method=n,T(e)}function A(e,t){return x(e,t,J,et,tt,X)}function M(e,t){var n,o,l,f;if(!e||!e.state||t>z||0>t)return e?r(e,U):U;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||o.status===bt&&t!==F)return r(e,0===e.avail_out?V:U);if(o.strm=e,n=o.last_flush,o.last_flush=t,o.status===dt)if(2===o.wrap)e.adler=0,u(o,31),u(o,139),u(o,8),o.gzhead?(u(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),u(o,255&o.gzhead.time),u(o,o.gzhead.time>>8&255),u(o,o.gzhead.time>>16&255),u(o,o.gzhead.time>>24&255),u(o,9===o.level?2:o.strategy>=$||o.level<2?4:0),u(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(u(o,255&o.gzhead.extra.length),u(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=I(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=pt):(u(o,0),u(o,0),u(o,0),u(o,0),u(o,0),u(o,9===o.level?2:o.strategy>=$||o.level<2?4:0),u(o,xt),o.status=yt);else{var h=J+(o.w_bits-8<<4)<<8,d=-1;d=o.strategy>=$||o.level<2?0:o.level<6?1:6===o.level?2:3,h|=d<<6,0!==o.strstart&&(h|=ht),h+=31-h%31,o.status=yt,c(o,h),0!==o.strstart&&(c(o,e.adler>>>16),c(o,65535&e.adler)),e.adler=1}if(o.status===pt)if(o.gzhead.extra){for(l=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>l&&(e.adler=I(e.adler,o.pending_buf,o.pending-l,l)),s(e),l=o.pending,o.pending!==o.pending_buf_size));)u(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>l&&(e.adler=I(e.adler,o.pending_buf,o.pending-l,l)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=mt)}else o.status=mt;if(o.status===mt)if(o.gzhead.name){l=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>l&&(e.adler=I(e.adler,o.pending_buf,o.pending-l,l)),s(e),l=o.pending,o.pending===o.pending_buf_size)){f=1;break}f=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,u(o,f)}while(0!==f);o.gzhead.hcrc&&o.pending>l&&(e.adler=I(e.adler,o.pending_buf,o.pending-l,l)),0===f&&(o.gzindex=0,o.status=gt)}else o.status=gt;if(o.status===gt)if(o.gzhead.comment){l=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>l&&(e.adler=I(e.adler,o.pending_buf,o.pending-l,l)),s(e),l=o.pending,o.pending===o.pending_buf_size)){f=1;break}f=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,u(o,f)}while(0!==f);o.gzhead.hcrc&&o.pending>l&&(e.adler=I(e.adler,o.pending_buf,o.pending-l,l)),0===f&&(o.status=vt)}else o.status=vt;if(o.status===vt&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&s(e),o.pending+2<=o.pending_buf_size&&(u(o,255&e.adler),u(o,e.adler>>8&255),e.adler=0,o.status=yt)):o.status=yt),0!==o.pending){if(s(e),0===e.avail_out)return o.last_flush=-1,j}else if(0===e.avail_in&&i(t)<=i(n)&&t!==F)return r(e,V);if(o.status===bt&&0!==e.avail_in)return r(e,V);if(0!==e.avail_in||0!==o.lookahead||t!==N&&o.status!==bt){var p=o.strategy===$?v(o,t):o.strategy===H?g(o,t):P[o.level].func(o,t);if((p===Tt||p===St)&&(o.status=bt),p===_t||p===Tt)return 0===e.avail_out&&(o.last_flush=-1),j;if(p===wt&&(t===O?D._tr_align(o):t!==z&&(D._tr_stored_block(o,0,0,!1),t===R&&(a(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),s(e),0===e.avail_out))return o.last_flush=-1,j}return t!==F?j:o.wrap<=0?G:(2===o.wrap?(u(o,255&e.adler),u(o,e.adler>>8&255),u(o,e.adler>>16&255),u(o,e.adler>>24&255),u(o,255&e.total_in),u(o,e.total_in>>8&255),u(o,e.total_in>>16&255),u(o,e.total_in>>24&255)):(c(o,e.adler>>>16),c(o,65535&e.adler)),s(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?j:G)}function k(e){var t;return e&&e.state?(t=e.state.status,t!==dt&&t!==pt&&t!==mt&&t!==gt&&t!==vt&&t!==yt&&t!==bt?r(e,U):(e.state=null,t===yt?r(e,W):j)):U}function E(e,t){var n,r,i,s,o,u,c,l,f=t.length;if(!e||!e.state)return U;if(n=e.state,s=n.wrap,2===s||1===s&&n.status!==dt||n.lookahead)return U;for(1===s&&(e.adler=L(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(a(n.head),n.strstart=0,n.block_start=0,n.insert=0),l=new B.Buf8(n.w_size),B.arraySet(l,t,f-n.w_size,n.w_size,0),t=l,f=n.w_size),o=e.avail_in,u=e.next_in,c=e.input,e.avail_in=f,e.next_in=0,e.input=t,h(n);n.lookahead>=ct;){r=n.strstart,i=n.lookahead-(ct-1);do n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+ct-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++;while(--i);n.strstart=r,n.lookahead=ct-1,h(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=ct-1,n.match_available=0,e.next_in=u,e.input=c,e.avail_in=o,n.wrap=s,j}var P,B=e("../utils/common"),D=e("./trees"),L=e("./adler32"),I=e("./crc32"),C=e("./messages"),N=0,O=1,R=3,F=4,z=5,j=0,G=1,U=-2,W=-3,V=-5,q=-1,Z=1,$=2,H=3,K=4,X=0,Y=2,J=8,Q=9,et=15,tt=8,nt=29,rt=256,it=rt+1+nt,at=30,st=19,ot=2*it+1,ut=15,ct=3,lt=258,ft=lt+ct+1,ht=32,dt=42,pt=69,mt=73,gt=91,vt=103,yt=113,bt=666,_t=1,wt=2,Tt=3,St=4,xt=3;P=[new y(0,0,0,0,d),new y(4,4,8,4,p),new y(4,5,16,8,p),new y(4,6,32,32,p),new y(4,4,16,16,m),new y(8,16,32,32,m),new y(8,16,128,128,m),new y(8,32,128,256,m),new y(32,128,258,1024,m),new y(32,258,258,4096,m)],n.deflateInit=A,n.deflateInit2=x,n.deflateReset=T,n.deflateResetKeep=w,n.deflateSetHeader=S,n.deflate=M,n.deflateEnd=k,n.deflateSetDictionary=E,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(e,t){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=n},{}],69:[function(e,t){"use strict";var n=30,r=12;t.exports=function(e,t){var i,a,s,o,u,c,l,f,h,d,p,m,g,v,y,b,_,w,T,S,x,A,M,k,E;i=e.state,a=e.next_in,k=e.input,s=a+(e.avail_in-5),o=e.next_out,E=e.output,u=o-(t-e.avail_out),c=o+(e.avail_out-257),l=i.dmax,f=i.wsize,h=i.whave,d=i.wnext,p=i.window,m=i.hold,g=i.bits,v=i.lencode,y=i.distcode,b=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;e:do{15>g&&(m+=k[a++]<<g,g+=8,m+=k[a++]<<g,g+=8),w=v[m&b];t:for(;;){if(T=w>>>24,m>>>=T,g-=T,T=w>>>16&255,0===T)E[o++]=65535&w;else{if(!(16&T)){if(0===(64&T)){w=v[(65535&w)+(m&(1<<T)-1)];continue t}if(32&T){i.mode=r;break e}e.msg="invalid literal/length code",i.mode=n;break e}S=65535&w,T&=15,T&&(T>g&&(m+=k[a++]<<g,g+=8),S+=m&(1<<T)-1,m>>>=T,g-=T),15>g&&(m+=k[a++]<<g,g+=8,m+=k[a++]<<g,g+=8),w=y[m&_];n:for(;;){if(T=w>>>24,m>>>=T,g-=T,T=w>>>16&255,!(16&T)){if(0===(64&T)){w=y[(65535&w)+(m&(1<<T)-1)];continue n}e.msg="invalid distance code",i.mode=n;break e}if(x=65535&w,T&=15,T>g&&(m+=k[a++]<<g,g+=8,T>g&&(m+=k[a++]<<g,g+=8)),x+=m&(1<<T)-1,x>l){e.msg="invalid distance too far back",i.mode=n;
break e}if(m>>>=T,g-=T,T=o-u,x>T){if(T=x-T,T>h&&i.sane){e.msg="invalid distance too far back",i.mode=n;break e}if(A=0,M=p,0===d){if(A+=f-T,S>T){S-=T;do E[o++]=p[A++];while(--T);A=o-x,M=E}}else if(T>d){if(A+=f+d-T,T-=d,S>T){S-=T;do E[o++]=p[A++];while(--T);if(A=0,S>d){T=d,S-=T;do E[o++]=p[A++];while(--T);A=o-x,M=E}}}else if(A+=d-T,S>T){S-=T;do E[o++]=p[A++];while(--T);A=o-x,M=E}for(;S>2;)E[o++]=M[A++],E[o++]=M[A++],E[o++]=M[A++],S-=3;S&&(E[o++]=M[A++],S>1&&(E[o++]=M[A++]))}else{A=o-x;do E[o++]=E[A++],E[o++]=E[A++],E[o++]=E[A++],S-=3;while(S>2);S&&(E[o++]=E[A++],S>1&&(E[o++]=E[A++]))}break}}break}}while(s>a&&c>o);S=g>>3,a-=S,g-=S<<3,m&=(1<<g)-1,e.next_in=a,e.next_out=o,e.avail_in=s>a?5+(s-a):5-(a-s),e.avail_out=c>o?257+(c-o):257-(o-c),i.hold=m,i.bits=g}},{}],70:[function(e,t,n){"use strict";function r(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new y.Buf16(320),this.work=new y.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=R,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new y.Buf32(mt),t.distcode=t.distdyn=new y.Buf32(gt),t.sane=1,t.back=-1,P):L}function s(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,a(e)):L}function o(e,t){var n,r;return e&&e.state?(r=e.state,0>t?(n=0,t=-t):(n=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||t>15)?L:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,s(e))):L}function u(e,t){var n,r;return e?(r=new i,e.state=r,r.window=null,n=o(e,t),n!==P&&(e.state=null),n):L}function c(e){return u(e,yt)}function l(e){if(bt){var t;for(g=new y.Buf32(512),v=new y.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(T(x,e.lens,0,288,g,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;T(A,e.lens,0,32,v,0,e.work,{bits:5}),bt=!1}e.lencode=g,e.lenbits=9,e.distcode=v,e.distbits=5}function f(e,t,n,r){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new y.Buf8(a.wsize)),r>=a.wsize?(y.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),y.arraySet(a.window,t,n-r,i,a.wnext),r-=i,r?(y.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}function h(e,t){var n,i,a,s,o,u,c,h,d,p,m,g,v,mt,gt,vt,yt,bt,_t,wt,Tt,St,xt,At,Mt=0,kt=new y.Buf8(4),Et=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return L;n=e.state,n.mode===H&&(n.mode=K),o=e.next_out,a=e.output,c=e.avail_out,s=e.next_in,i=e.input,u=e.avail_in,h=n.hold,d=n.bits,p=u,m=c,St=P;e:for(;;)switch(n.mode){case R:if(0===n.wrap){n.mode=K;break}for(;16>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}if(2&n.wrap&&35615===h){n.check=0,kt[0]=255&h,kt[1]=h>>>8&255,n.check=_(n.check,kt,2,0),h=0,d=0,n.mode=F;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",n.mode=ht;break}if((15&h)!==O){e.msg="unknown compression method",n.mode=ht;break}if(h>>>=4,d-=4,Tt=(15&h)+8,0===n.wbits)n.wbits=Tt;else if(Tt>n.wbits){e.msg="invalid window size",n.mode=ht;break}n.dmax=1<<Tt,e.adler=n.check=1,n.mode=512&h?Z:H,h=0,d=0;break;case F:for(;16>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}if(n.flags=h,(255&n.flags)!==O){e.msg="unknown compression method",n.mode=ht;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=ht;break}n.head&&(n.head.text=h>>8&1),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,n.check=_(n.check,kt,2,0)),h=0,d=0,n.mode=z;case z:for(;32>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}n.head&&(n.head.time=h),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,kt[2]=h>>>16&255,kt[3]=h>>>24&255,n.check=_(n.check,kt,4,0)),h=0,d=0,n.mode=j;case j:for(;16>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,n.check=_(n.check,kt,2,0)),h=0,d=0,n.mode=G;case G:if(1024&n.flags){for(;16>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}n.length=h,n.head&&(n.head.extra_len=h),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,n.check=_(n.check,kt,2,0)),h=0,d=0}else n.head&&(n.head.extra=null);n.mode=U;case U:if(1024&n.flags&&(g=n.length,g>u&&(g=u),g&&(n.head&&(Tt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),y.arraySet(n.head.extra,i,s,g,Tt)),512&n.flags&&(n.check=_(n.check,i,g,s)),u-=g,s+=g,n.length-=g),n.length))break e;n.length=0,n.mode=W;case W:if(2048&n.flags){if(0===u)break e;g=0;do Tt=i[s+g++],n.head&&Tt&&n.length<65536&&(n.head.name+=String.fromCharCode(Tt));while(Tt&&u>g);if(512&n.flags&&(n.check=_(n.check,i,g,s)),u-=g,s+=g,Tt)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=V;case V:if(4096&n.flags){if(0===u)break e;g=0;do Tt=i[s+g++],n.head&&Tt&&n.length<65536&&(n.head.comment+=String.fromCharCode(Tt));while(Tt&&u>g);if(512&n.flags&&(n.check=_(n.check,i,g,s)),u-=g,s+=g,Tt)break e}else n.head&&(n.head.comment=null);n.mode=q;case q:if(512&n.flags){for(;16>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}if(h!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ht;break}h=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=H;break;case Z:for(;32>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}e.adler=n.check=r(h),h=0,d=0,n.mode=$;case $:if(0===n.havedict)return e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=u,n.hold=h,n.bits=d,D;e.adler=n.check=1,n.mode=H;case H:if(t===k||t===E)break e;case K:if(n.last){h>>>=7&d,d-=7&d,n.mode=ct;break}for(;3>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}switch(n.last=1&h,h>>>=1,d-=1,3&h){case 0:n.mode=X;break;case 1:if(l(n),n.mode=nt,t===E){h>>>=2,d-=2;break e}break;case 2:n.mode=Q;break;case 3:e.msg="invalid block type",n.mode=ht}h>>>=2,d-=2;break;case X:for(h>>>=7&d,d-=7&d;32>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}if((65535&h)!==(h>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ht;break}if(n.length=65535&h,h=0,d=0,n.mode=Y,t===E)break e;case Y:n.mode=J;case J:if(g=n.length){if(g>u&&(g=u),g>c&&(g=c),0===g)break e;y.arraySet(a,i,s,g,o),u-=g,s+=g,c-=g,o+=g,n.length-=g;break}n.mode=H;break;case Q:for(;14>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}if(n.nlen=(31&h)+257,h>>>=5,d-=5,n.ndist=(31&h)+1,h>>>=5,d-=5,n.ncode=(15&h)+4,h>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ht;break}n.have=0,n.mode=et;case et:for(;n.have<n.ncode;){for(;3>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}n.lens[Et[n.have++]]=7&h,h>>>=3,d-=3}for(;n.have<19;)n.lens[Et[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,xt={bits:n.lenbits},St=T(S,n.lens,0,19,n.lencode,0,n.work,xt),n.lenbits=xt.bits,St){e.msg="invalid code lengths set",n.mode=ht;break}n.have=0,n.mode=tt;case tt:for(;n.have<n.nlen+n.ndist;){for(;Mt=n.lencode[h&(1<<n.lenbits)-1],gt=Mt>>>24,vt=Mt>>>16&255,yt=65535&Mt,!(d>=gt);){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}if(16>yt)h>>>=gt,d-=gt,n.lens[n.have++]=yt;else{if(16===yt){for(At=gt+2;At>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}if(h>>>=gt,d-=gt,0===n.have){e.msg="invalid bit length repeat",n.mode=ht;break}Tt=n.lens[n.have-1],g=3+(3&h),h>>>=2,d-=2}else if(17===yt){for(At=gt+3;At>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}h>>>=gt,d-=gt,Tt=0,g=3+(7&h),h>>>=3,d-=3}else{for(At=gt+7;At>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}h>>>=gt,d-=gt,Tt=0,g=11+(127&h),h>>>=7,d-=7}if(n.have+g>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ht;break}for(;g--;)n.lens[n.have++]=Tt}}if(n.mode===ht)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=ht;break}if(n.lenbits=9,xt={bits:n.lenbits},St=T(x,n.lens,0,n.nlen,n.lencode,0,n.work,xt),n.lenbits=xt.bits,St){e.msg="invalid literal/lengths set",n.mode=ht;break}if(n.distbits=6,n.distcode=n.distdyn,xt={bits:n.distbits},St=T(A,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,xt),n.distbits=xt.bits,St){e.msg="invalid distances set",n.mode=ht;break}if(n.mode=nt,t===E)break e;case nt:n.mode=rt;case rt:if(u>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=u,n.hold=h,n.bits=d,w(e,m),o=e.next_out,a=e.output,c=e.avail_out,s=e.next_in,i=e.input,u=e.avail_in,h=n.hold,d=n.bits,n.mode===H&&(n.back=-1);break}for(n.back=0;Mt=n.lencode[h&(1<<n.lenbits)-1],gt=Mt>>>24,vt=Mt>>>16&255,yt=65535&Mt,!(d>=gt);){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}if(vt&&0===(240&vt)){for(bt=gt,_t=vt,wt=yt;Mt=n.lencode[wt+((h&(1<<bt+_t)-1)>>bt)],gt=Mt>>>24,vt=Mt>>>16&255,yt=65535&Mt,!(d>=bt+gt);){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}h>>>=bt,d-=bt,n.back+=bt}if(h>>>=gt,d-=gt,n.back+=gt,n.length=yt,0===vt){n.mode=ut;break}if(32&vt){n.back=-1,n.mode=H;break}if(64&vt){e.msg="invalid literal/length code",n.mode=ht;break}n.extra=15&vt,n.mode=it;case it:if(n.extra){for(At=n.extra;At>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=at;case at:for(;Mt=n.distcode[h&(1<<n.distbits)-1],gt=Mt>>>24,vt=Mt>>>16&255,yt=65535&Mt,!(d>=gt);){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}if(0===(240&vt)){for(bt=gt,_t=vt,wt=yt;Mt=n.distcode[wt+((h&(1<<bt+_t)-1)>>bt)],gt=Mt>>>24,vt=Mt>>>16&255,yt=65535&Mt,!(d>=bt+gt);){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}h>>>=bt,d-=bt,n.back+=bt}if(h>>>=gt,d-=gt,n.back+=gt,64&vt){e.msg="invalid distance code",n.mode=ht;break}n.offset=yt,n.extra=15&vt,n.mode=st;case st:if(n.extra){for(At=n.extra;At>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ht;break}n.mode=ot;case ot:if(0===c)break e;if(g=m-c,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ht;break}g>n.wnext?(g-=n.wnext,v=n.wsize-g):v=n.wnext-g,g>n.length&&(g=n.length),mt=n.window}else mt=a,v=o-n.offset,g=n.length;g>c&&(g=c),c-=g,n.length-=g;do a[o++]=mt[v++];while(--g);0===n.length&&(n.mode=rt);break;case ut:if(0===c)break e;a[o++]=n.length,c--,n.mode=rt;break;case ct:if(n.wrap){for(;32>d;){if(0===u)break e;u--,h|=i[s++]<<d,d+=8}if(m-=c,e.total_out+=m,n.total+=m,m&&(e.adler=n.check=n.flags?_(n.check,a,m,o-m):b(n.check,a,m,o-m)),m=c,(n.flags?h:r(h))!==n.check){e.msg="incorrect data check",n.mode=ht;break}h=0,d=0}n.mode=lt;case lt:if(n.wrap&&n.flags){for(;32>d;){if(0===u)break e;u--,h+=i[s++]<<d,d+=8}if(h!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ht;break}h=0,d=0}n.mode=ft;case ft:St=B;break e;case ht:St=I;break e;case dt:return C;case pt:default:return L}return e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=u,n.hold=h,n.bits=d,(n.wsize||m!==e.avail_out&&n.mode<ht&&(n.mode<ct||t!==M))&&f(e,e.output,e.next_out,m-e.avail_out)?(n.mode=dt,C):(p-=e.avail_in,m-=e.avail_out,e.total_in+=p,e.total_out+=m,n.total+=m,n.wrap&&m&&(e.adler=n.check=n.flags?_(n.check,a,m,e.next_out-m):b(n.check,a,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===H?128:0)+(n.mode===nt||n.mode===Y?256:0),(0===p&&0===m||t===M)&&St===P&&(St=N),St)}function d(e){if(!e||!e.state)return L;var t=e.state;return t.window&&(t.window=null),e.state=null,P}function p(e,t){var n;return e&&e.state?(n=e.state,0===(2&n.wrap)?L:(n.head=t,t.done=!1,P)):L}function m(e,t){var n,r,i,a=t.length;return e&&e.state?(n=e.state,0!==n.wrap&&n.mode!==$?L:n.mode===$&&(r=1,r=b(r,t,a,0),r!==n.check)?I:(i=f(e,t,a,a))?(n.mode=dt,C):(n.havedict=1,P)):L}var g,v,y=e("../utils/common"),b=e("./adler32"),_=e("./crc32"),w=e("./inffast"),T=e("./inftrees"),S=0,x=1,A=2,M=4,k=5,E=6,P=0,B=1,D=2,L=-2,I=-3,C=-4,N=-5,O=8,R=1,F=2,z=3,j=4,G=5,U=6,W=7,V=8,q=9,Z=10,$=11,H=12,K=13,X=14,Y=15,J=16,Q=17,et=18,tt=19,nt=20,rt=21,it=22,at=23,st=24,ot=25,ut=26,ct=27,lt=28,ft=29,ht=30,dt=31,pt=32,mt=852,gt=592,vt=15,yt=vt,bt=!0;n.inflateReset=s,n.inflateReset2=o,n.inflateResetKeep=a,n.inflateInit=c,n.inflateInit2=u,n.inflate=h,n.inflateEnd=d,n.inflateGetHeader=p,n.inflateSetDictionary=m,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(e,t){"use strict";var n=e("../utils/common"),r=15,i=852,a=592,s=0,o=1,u=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,d,p,m,g,v,y){var b,_,w,T,S,x,A,M,k,E=y.bits,P=0,B=0,D=0,L=0,I=0,C=0,N=0,O=0,R=0,F=0,z=null,j=0,G=new n.Buf16(r+1),U=new n.Buf16(r+1),W=null,V=0;for(P=0;r>=P;P++)G[P]=0;for(B=0;p>B;B++)G[t[d+B]]++;for(I=E,L=r;L>=1&&0===G[L];L--);if(I>L&&(I=L),0===L)return m[g++]=20971520,m[g++]=20971520,y.bits=1,0;for(D=1;L>D&&0===G[D];D++);for(D>I&&(I=D),O=1,P=1;r>=P;P++)if(O<<=1,O-=G[P],0>O)return-1;if(O>0&&(e===s||1!==L))return-1;for(U[1]=0,P=1;r>P;P++)U[P+1]=U[P]+G[P];for(B=0;p>B;B++)0!==t[d+B]&&(v[U[t[d+B]]++]=B);if(e===s?(z=W=v,x=19):e===o?(z=c,j-=257,W=l,V-=257,x=256):(z=f,W=h,x=-1),F=0,B=0,P=D,S=g,C=I,N=0,w=-1,R=1<<I,T=R-1,e===o&&R>i||e===u&&R>a)return 1;for(;;){A=P-N,v[B]<x?(M=0,k=v[B]):v[B]>x?(M=W[V+v[B]],k=z[j+v[B]]):(M=96,k=0),b=1<<P-N,_=1<<C,D=_;do _-=b,m[S+(F>>N)+_]=A<<24|M<<16|k|0;while(0!==_);for(b=1<<P-1;F&b;)b>>=1;if(0!==b?(F&=b-1,F+=b):F=0,B++,0===--G[P]){if(P===L)break;P=t[d+v[B]]}if(P>I&&(F&T)!==w){for(0===N&&(N=I),S+=D,C=P-N,O=1<<C;L>C+N&&(O-=G[C+N],!(0>=O));)C++,O<<=1;if(R+=1<<C,e===o&&R>i||e===u&&R>a)return 1;w=F&T,m[w]=I<<24|C<<16|S-g|0}}return 0!==F&&(m[S+F]=P-N<<24|64<<16|0),y.bits=I,0}},{"../utils/common":62}],72:[function(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(e,t,n){"use strict";function r(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function a(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function s(e){return 256>e?ut[e]:ut[256+(e>>>7)]}function o(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function u(e,t,n){e.bi_valid>K-n?(e.bi_buf|=t<<e.bi_valid&65535,o(e,e.bi_buf),e.bi_buf=t>>K-e.bi_valid,e.bi_valid+=n-K):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function c(e,t,n){u(e,n[2*t],n[2*t+1])}function l(e,t){var n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1}function f(e){16===e.bi_valid?(o(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function h(e,t){var n,r,i,a,s,o,u=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;H>=a;a++)e.bl_count[a]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;$>n;n++)r=e.heap[n],a=u[2*u[2*r+1]+1]+1,a>p&&(a=p,m++),u[2*r+1]=a,r>c||(e.bl_count[a]++,s=0,r>=d&&(s=h[r-d]),o=u[2*r],e.opt_len+=o*(a+s),f&&(e.static_len+=o*(l[2*r+1]+s)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)i=e.heap[--n],i>c||(u[2*i+1]!==a&&(e.opt_len+=(a-u[2*i+1])*u[2*i],u[2*i+1]=a),r--)}}function d(e,t,n){var r,i,a=new Array(H+1),s=0;for(r=1;H>=r;r++)a[r]=s=s+n[r-1]<<1;for(i=0;t>=i;i++){var o=e[2*i+1];0!==o&&(e[2*i]=l(a[o]++,o))}}function p(){var e,t,n,r,a,s=new Array(H+1);for(n=0,r=0;U-1>r;r++)for(lt[r]=n,e=0;e<1<<tt[r];e++)ct[n++]=r;for(ct[n-1]=r,a=0,r=0;16>r;r++)for(ft[r]=a,e=0;e<1<<nt[r];e++)ut[a++]=r;for(a>>=7;q>r;r++)for(ft[r]=a<<7,e=0;e<1<<nt[r]-7;e++)ut[256+a++]=r;for(t=0;H>=t;t++)s[t]=0;for(e=0;143>=e;)st[2*e+1]=8,e++,s[8]++;for(;255>=e;)st[2*e+1]=9,e++,s[9]++;for(;279>=e;)st[2*e+1]=7,e++,s[7]++;for(;287>=e;)st[2*e+1]=8,e++,s[8]++;for(d(st,V+1,s),e=0;q>e;e++)ot[2*e+1]=5,ot[2*e]=l(e,5);ht=new i(st,tt,W+1,V,H),dt=new i(ot,nt,0,q,H),pt=new i(new Array(0),rt,0,Z,X)}function m(e){var t;for(t=0;V>t;t++)e.dyn_ltree[2*t]=0;for(t=0;q>t;t++)e.dyn_dtree[2*t]=0;for(t=0;Z>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*Y]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function g(e){e.bi_valid>8?o(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function v(e,t,n,r){g(e),r&&(o(e,n),o(e,~n)),L.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function y(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function b(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&y(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!y(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function _(e,t,n){var r,i,a,o,l=0;if(0!==e.last_lit)do r=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],i=e.pending_buf[e.l_buf+l],l++,0===r?c(e,i,t):(a=ct[i],c(e,a+W+1,t),o=tt[a],0!==o&&(i-=lt[a],u(e,i,o)),r--,a=s(r),c(e,a,n),o=nt[a],0!==o&&(r-=ft[a],u(e,r,o)));while(l<e.last_lit);c(e,Y,t)}function w(e,t){var n,r,i,a=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=$,n=0;u>n;n++)0!==a[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=2>c?++c:0,a[2*i]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=s[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)b(e,a,n);i=u;do n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],b(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,b(e,a,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],h(e,t),d(a,c,e.bl_count)}function T(e,t,n){var r,i,a=-1,s=t[1],o=0,u=7,c=4;for(0===s&&(u=138,c=3),t[2*(n+1)+1]=65535,r=0;n>=r;r++)i=s,s=t[2*(r+1)+1],++o<u&&i===s||(c>o?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*J]++):10>=o?e.bl_tree[2*Q]++:e.bl_tree[2*et]++,o=0,a=i,0===s?(u=138,c=3):i===s?(u=6,c=3):(u=7,c=4))}function S(e,t,n){var r,i,a=-1,s=t[1],o=0,l=7,f=4;for(0===s&&(l=138,f=3),r=0;n>=r;r++)if(i=s,s=t[2*(r+1)+1],!(++o<l&&i===s)){if(f>o){do c(e,i,e.bl_tree);while(0!==--o)}else 0!==i?(i!==a&&(c(e,i,e.bl_tree),o--),c(e,J,e.bl_tree),u(e,o-3,2)):10>=o?(c(e,Q,e.bl_tree),u(e,o-3,3)):(c(e,et,e.bl_tree),u(e,o-11,7));o=0,a=i,0===s?(l=138,f=3):i===s?(l=6,f=3):(l=7,f=4)}}function x(e){var t;for(T(e,e.dyn_ltree,e.l_desc.max_code),T(e,e.dyn_dtree,e.d_desc.max_code),w(e,e.bl_desc),t=Z-1;t>=3&&0===e.bl_tree[2*it[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function A(e,t,n,r){var i;for(u(e,t-257,5),u(e,n-1,5),u(e,r-4,4),i=0;r>i;i++)u(e,e.bl_tree[2*it[i]+1],3);S(e,e.dyn_ltree,t-1),S(e,e.dyn_dtree,n-1)}function M(e){var t,n=4093624447;for(t=0;31>=t;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return C;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return N;for(t=32;W>t;t++)if(0!==e.dyn_ltree[2*t])return N;return C}function k(e){mt||(p(),mt=!0),e.l_desc=new a(e.dyn_ltree,ht),e.d_desc=new a(e.dyn_dtree,dt),e.bl_desc=new a(e.bl_tree,pt),e.bi_buf=0,e.bi_valid=0,m(e)}function E(e,t,n,r){u(e,(R<<1)+(r?1:0),3),v(e,t,n,!0)}function P(e){u(e,F<<1,3),c(e,Y,st),f(e)}function B(e,t,n,r){var i,a,s=0;e.level>0?(e.strm.data_type===O&&(e.strm.data_type=M(e)),w(e,e.l_desc),w(e,e.d_desc),s=x(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,i>=a&&(i=a)):i=a=n+5,i>=n+4&&-1!==t?E(e,t,n,r):e.strategy===I||a===i?(u(e,(F<<1)+(r?1:0),3),_(e,st,ot)):(u(e,(z<<1)+(r?1:0),3),A(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),_(e,e.dyn_ltree,e.dyn_dtree)),m(e),r&&g(e)}function D(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ct[n]+W+1)]++,e.dyn_dtree[2*s(t)]++),e.last_lit===e.lit_bufsize-1}var L=e("../utils/common"),I=4,C=0,N=1,O=2,R=0,F=1,z=2,j=3,G=258,U=29,W=256,V=W+1+U,q=30,Z=19,$=2*V+1,H=15,K=16,X=7,Y=256,J=16,Q=17,et=18,tt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],nt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],rt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],it=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],at=512,st=new Array(2*(V+2));r(st);var ot=new Array(2*q);r(ot);var ut=new Array(at);r(ut);var ct=new Array(G-j+1);r(ct);var lt=new Array(U);r(lt);var ft=new Array(q);r(ft);var ht,dt,pt,mt=!1;n._tr_init=k,n._tr_stored_block=E,n._tr_flush_block=B,n._tr_tally=D,n._tr_align=P},{"../utils/common":62}],74:[function(e,t){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=n},{}]},{},[10])(10)}),e("zip",["SFile","jszip","FileSaver.min","Util","MIMETypes","DeferredUtil"],function(e,t,n,r,i,a){var o={};return o.zip=function(n,r,i){function o(e,t){return t.each(function(t){if(t.isDir()){var n=e.folder(t.name().replace(/[\/\\]$/,""));return o(n,t)}return t.getContent(function(n){e.file(t.name(),n.toArrayBuffer())})})}e.is(r)||(i=r),i=i||{};var u=new t;return o(u,n).then(function(){return a.resolve(u.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(t){return e.is(r)?r.setBytes(t):void s(new Blob([t],{type:"application/zip"}),n.name().replace(/[\/\\]$/,"")+".zip")})},o.unzip=function(n,r,i){var s,o={};i=i||{},e.is(n)&&(s=n.getContent(),n=s.toArrayBuffer()),i.onCheckFile||(i.onCheckFile=function(e){return i.overwrite?e:e.exists()?!1:e});var u=new t;return a.resolve(u.loadAsync(n)).then(function(){return a.each(u.files,function(t,n){return a.resolve(n.async("arraybuffer")).then(function(t){var a=r.rel(n.name);if(console.log("Inflating",n.name),!a.isDir()){var s={file:a,status:"uploaded"};o[a.path()]=s;var u=FS.Content.bin(t,a.contentType()),c=i.onCheckFile(a,u);return c===!1&&(s.status="cancelled",a=null),e.is(c)&&(a.path()!==c.path()&&(s.redirectedTo=c),a=c),a?a.setContent(u):void 0}})})}).then(function(){return console.log("unzip done",o),o})},o.JSZip=t,o}),e("FS",["FS2","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil"],function(e,t,n,r,i,a,s,o,u,c,l,f){var h={};h.assert=s,h.Content=c,h.Class=e,h.DeferredUtil=f,h.Env=a,h.LSFS=n,h.NativeFS=t,h.PathUtil=i,h.RootFS=u,h.SFile=o,h.WebFS=r,h.zip=l,"object"==typeof window&&(window.FS=h);var d,p=new a({});return f.external.Promise=l.JSZip.external.Promise,h.addFSType=e.addFSType,h.availFSTypes=e.availFSTypes,h.setEnvProvider=function(e){p=e},h.getEnvProvider=function(){return p},h.setEnv=function(e,t){if("object"==typeof e)for(var n in e)p.set(n,e[n]);else p.set(e,t)},h.getEnv=function(e){return"string"==typeof e?p.get(e):p.value},h.init=function(e){d||(e||(e="object"==typeof process?new t:new n(localStorage)),d=new u(e))},h.getRootFS=function(){return h.init(),d},h.get=function(){return h.init(),d.get.apply(d,arguments)},h.expandPath=function(){return p.expandPath.apply(p,arguments)},h.resolve=function(e,t){return h.init(),o.is(e)?e:(e=p.expandPath(e),t&&!i.isAbsolutePath(e)?(t=p.expandPath(t),h.get(t).rel(e)):h.get(e))},h.mount=function(){return h.init(),d.mount.apply(d,arguments)},h.unmount=function(){return h.init(),d.unmount.apply(d,arguments)},h.isFile=function(e){return o.is(e)},h});var o;return t(["FS"],function(e){o=e}),void 0===window.FS&&(window.FS=o),o}),requireSimulator.setName("WebSite"),define(["FS"],function(e){var t,n=e.PathUtil,r=document.location.href,i=!!r.match(/html\/dev\//)&&!!r.match(/localhost:3/);if(r.match(/jsrun\.it/))t={urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:i,pluginTop:"http://tonyuedit.appspot.com/js/plugins",removeJSOutput:!0};else if(r.match(/tonyuexe\.appspot\.com/)||r.match(/localhost:8887/)||r.match(/\/html\/((dev)|(build))\//))t={urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/sound_ogg.png":"../../images/sound_ogg.png","images/sound_mp3.png":"../../images/sound_mp3.png","images/sound_mp4.png":"../../images/sound_mp4.png","images/sound_m4a.png":"../../images/sound_m4a.png","images/sound_mid.png":"../../images/sound_mid.png","images/sound_wav.png":"../../images/sound_wav.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:i};else if(r.match(/bitarrow/)||r.match(/localhost.*pub/)){t={};var a=t;t.serverType="BA",a.runtime="../../../runtime/",a.urlAliases={"images/base.png":a.runtime+"images/base.png","images/Sample.png":a.runtime+"images/Sample.png","images/neko.png":a.runtime+"images/neko.png","images/inputPad.png":a.runtime+"images/inputPad.png","images/mapchip.png":a.runtime+"images/mapchip.png","images/sound.png":a.runtime+"images/sound.png","images/sound_ogg.png":a.runtime+"images/sound_ogg.png","images/sound_mp3.png":a.runtime+"images/sound_mp3.png","images/sound_mp4.png":a.runtime+"images/sound_mp4.png","images/sound_m4a.png":a.runtime+"images/sound_m4a.png","images/sound_mid.png":a.runtime+"images/sound_mid.png","images/sound_wav.png":a.runtime+"images/sound_wav.png","images/ecl.png":a.runtime+"images/ecl.png"}}else t={urlAliases:{},top:".",devMode:i};var s=window.navigator.userAgent.toLowerCase();return t.tablet=-1!=s.indexOf("windows")&&-1!=s.indexOf("touch")||-1!=s.indexOf("ipad")||-1!=s.indexOf("android")&&-1==s.indexOf("mobile")||-1!=s.indexOf("firefox")&&-1!=s.indexOf("tablet")||-1!=s.indexOf("kindle")||-1!=s.indexOf("silk")||-1!=s.indexOf("playbook"),t.mobile=-1!=s.indexOf("windows")&&-1!=s.indexOf("phone")||-1!=s.indexOf("iphone")||-1!=s.indexOf("ipod")||-1!=s.indexOf("android")&&-1!=s.indexOf("mobile")||-1!=s.indexOf("firefox")&&-1!=s.indexOf("mobile")||-1!=s.indexOf("blackberry"),t.pluginTop||(t.pluginTop=t.top+"/js/plugins"),t.disableROM={},r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:8888/),(r.match(/\.appspot\.com/)||r.match(/localhost:888[87]/))&&(t.serverType="GAE"),r.match(/localhost:3000/)&&(t.serverType="Node"),t.serverTop=r.match(/tonyuexe\.appspot\.com/)||r.match(/localhost:8887/)?t.top+"/exe":t.top+"/edit",t.sampleImg=t.top+"/images",t.blobPath=t.serverTop+"/serveBlob",t.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),t.mp3Disabled=t.isNW,t.tonyuHome="/Tonyu/",t.url={getDirInfo:t.serverTop+"/getDirInfo",getFiles:t.serverTop+"/File2LSSync",putFiles:t.serverTop+"/LS2FileSync"},t.isNW?(t.cwd=n.directorify(process.cwd()),t.tonyuHome=process.env.TONYU_HOME?n.directorify(process.env.TONYU_HOME):n.rel(t.cwd,"fs/Tonyu/"),t.logdir=process.env.TONYU_LOGDIR,t.wwwDir=n.rel(t.cwd,"www/"),t.platform=process.platform,t.ffmpeg=n.rel(t.cwd,"win32"==t.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),t.pkgInfo=require(n.rel(t.cwd,"package.json")),t.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):t.pkgInfo&&t.pkgInfo.config&&t.pkgInfo.config.prjDirs?t.pkgInfo.config.prjDirs.map(function(e){return e=n.directorify(e),n.isAbsolute(e)?e:n.rel(t.cwd,e)}):[n.rel(t.cwd,"Projects/"),n.rel(t.tonyuHome,"Projects/")],t.kernelDir=n.rel(t.wwwDir,"Kernel/")):(t.wwwDir=location.protocol+"//"+location.host+"/",t.projects=[n.rel(t.tonyuHome,"Projects/")]),(r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:888/))&&(t.kernelDir=location.protocol+"//"+location.host+"/Kernel/"),t.compiledKernel=r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:888/)||t.isNW?t.top+"/Kernel/js/concat.js":"BA"===t.serverType?t.runtime+"lib/tonyu/kernel.js":"http://tonyuexe.appspot.com/Kernel/js/concat.js",e.setEnvProvider(new e.Env(t)),window.WebSite=t}),requireSimulator.setName("plugins"),define(["WebSite"],function(e){function t(e){return"function"==typeof e&&(e={onload:e}),e||(e={}),e.onload||(e.onload=function(){}),e}var n={},r={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/BodyActor/,symbol:"Box2D"},timbre:{src:"timbre.js",detection:/\bplay(SE)?\b/,symbol:"T"}};return n.installed=r,n.detectNeeded=function(e,t){for(var n in r){var i=r[n].detection.exec(e);i&&(t[n]=1)}return t},n.loaded=function(e){var t=r[e];if(!t)throw new Error("plugin not found: "+e);return window[t.symbol]},n.loadAll=function(e,i){function a(){u>=s.length?i.onload():n.load(s[u++],a)}i=t(i);var s=[];for(var o in e)r[o]&&!n.loaded(o)&&s.push(o);var u=0;console.log("loading plugins",s),setTimeout(a,0)},n.load=function(n,i){var a=r[n];if(!a)throw new Error("plugin not found: "+n);i=t(i);var s=e.pluginTop+"/"+a.src;location.href.match(/^file:/)?($("<script>").attr("src",s).appendTo("body"),setTimeout(i.onload,500)):$.getScript(s,i.onload)},n.request=function(e){if(!n.loaded(e)){var t=new Error("Plugin "+e+" required");t.pluginName=e}},n}),requireSimulator.setName("DeferredUtil"),define([],function(){var e;return e={ensureDefer:function(e){var t,n=new $.Deferred;return $.when(e).then(function(e){t?n.resolve(e):setTimeout(function(){n.resolve(e)},0)}).fail(function(e){t?n.reject(e):setTimeout(function(){n.reject(e)},0)}),t=!0,n.promise()},directPromise:function(e){var t=new $.Deferred;return setTimeout(function(){t.resolve(e)},0),t.promise()},then:function(t){return e.directPromise().then(t)},timeout:function(e){var t=new $.Deferred;return setTimeout(function(){t.resolve()},e),t.promise()},funcPromise:function(e){var t=new $.Deferred;return e(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},throwPromise:function(e){var t=new $.Deferred;return setTimeout(function(){t.reject(e)},0),t.promise()},throwF:function(t){return function(){try{return t.apply(this,arguments)}catch(n){return console.log(n,n.stack),e.throwPromise(n)}}},each:function(t,n){if(t instanceof Array)return e.loop(function(r){return r>=t.length?e.brk():$.when(n(t[r],r)).then(function(){return r+1})},0);var r=[];for(var i in t)r.push({k:i,v:t[i]});return e.each(r,function(e){return n(e.k,e.v)})},loop:function(t,n){return e.directPromise(n).then(e.throwF(function(){var n=t.apply(this,arguments);return n.DU_BRK?n.res:$.when(n).then(function(n){return e.loop(t,n)})}))},brk:function(e){return{DU_BRK:!0,res:e}},tryLoop:function(t,n){return e.loop(e.tr(t),n)},tryEach:function(t,n){return e.loop(t,e.tr(n))},documentReady:function(){return e.callbackToPromise(function(e){$(e)})},requirejs:function(t){if(!window.requirejs)throw new Error("requirejs is not loaded");return e.callbackToPromise(function(e){window.requirejs(t,e)})}},e.begin=e.try=e.tr=e.throwF,e.promise=e.callbackToPromise=e.funcPromise,e}),requireSimulator.setName("assert"),define(["FS"],function(e){return e.assert}),requireSimulator.setName("compiledProject"),define(["DeferredUtil","WebSite","assert"],function(e,t,n){var r=function(r,i){return n.is(arguments,[String,String]),{getNamespace:function(){return r},sourceDir:function(){return null},getDependingProjects:function(){return[]},loadDependingClasses:function(t){var n=e.directPromise(),r=this.getNamespace();
return this.getDependingProjects().forEach(function(e){e.getNamespace()!=r&&(n=n.then(function(){return e.loadClasses(t)}))}),n},loadClasses:function(e){console.log("Loading compiled classes ns=",r,"url=",i);var n=i+("BA"===t.serverType?"?"+Math.random():""),a=this;return this.loadDependingClasses(e).then(function(){return a.requirejs(n)}).then(function(){console.log("Done Loading compiled classes ns=",r,"url=",n,Tonyu.classes)})},requirejs:function(t){return e.promise(function(e){var n=document.getElementsByTagName("head")[0]||document.documentElement,r=document.createElement("script");r.src=t;var i=!1;r.onload=r.onreadystatechange=function(){i||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i=!0,console.log("Done load ",t),r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r),e())},n.insertBefore(r,n.firstChild)})},loadClassesOLD:function(e){console.log("Load compiled classes ns=",r,"url=",i);var n=new $.Deferred,a=document.getElementsByTagName("head")[0]||document.documentElement,s=document.createElement("script");s.src=i+("BA"===t.serverType?"?"+Math.random():"");var o=!1;return s.onload=s.onreadystatechange=function(){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,s.onload=s.onreadystatechange=null,a&&s.parentNode&&a.removeChild(s),console.log("Done Load compiled classes ns=",r,"url=",i,Tonyu.classes),n.resolve())},this.loadDependingClasses(e).then(function(){a.insertBefore(s,a.firstChild)}),n.promise()}}};return r}),requireSimulator.setName("compiledTonyuProject"),define(["plugins","compiledProject"],function(e,t){var n=function(n,r,i){var a=t(n,r),s=t("kernel",WebSite.compiledKernel),o={getDir:function(){return i},getDependingProjects:function(){return[s]},getOptions:function(){var e=this.getDir().rel("options.json");return e.obj()},getResource:function(){var e=this.getDir().rel("res.json");return e.obj()},loadPlugins:function(t){var n=this.getOptions();return e.loadAll(n.plugins,t)},requestPlugin:function(){},run:function(e){var t={classes:Tonyu.classMetas};this.loadClasses(t).then(function(){Tonyu.run(e)})}};for(var u in o)a[u]=o[u];return a};return n}),requireSimulator.setName("Util"),Util=function(){function e(e,n){null==n&&(n=""),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:t(i[1])}function t(e){return decodeURIComponent(e.replace(/\+/g,"%20"))}function n(e,t){return e.substring(e.length-t.length)===t}function r(e,t){return e.substring(0,t.length)===t}function i(e){function t(t){throw console.log(t),console.log(e,c),new Error(t)}e=e.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var r,i=e.length,a=0,s=0;if(!i)return new ArrayBuffer(0);r=Math.floor(i/4*3),"="==e.charAt(i-1)&&(r-=1),"="==e.charAt(i-2)&&(r-=1);for(var o=new ArrayBuffer(r),u=new Uint8Array(o),c=0,l=0;r>l&&(s=n[e.charCodeAt(c)],void 0===s&&t("Invalid letter: "+e.charCodeAt(c)),a=s<<2,c++,s=n[e.charCodeAt(c)],void 0===s&&t("Invalid letter: "+e.charCodeAt(c)),u[l]=a|s>>4&3,a=(15&s)<<4,c++,l++,!(l>=r))&&(s=n[e.charCodeAt(c)],void 0===s&&t("Invalid letter: "+e.charCodeAt(c)),u[l]=a|s>>2&15,a=(3&s)<<6,c++,l++,!(l>=r));)s=n[e.charCodeAt(c)],void 0===s&&t("Invalid letter: "+e.charCodeAt(c)),u[l]=a|s,c++,l++;return o}function a(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(e),i=r.length,a=0,s=0,o=0;i>o&&(s=r[o],n+=t[s>>2],a=(3&s)<<4,o++,!(o>=i))&&(s=r[o],n+=t[a|s>>4],a=(15&s)<<2,o++,!(o>=i));)s=r[o],n+=t[a|s>>6],n+=t[63&s],o++;var u=i%3;return u&&(n+=t[a]),1==u?n+="==":2==u&&(n+="="),n}function s(e){if(e.__privatized)return e;var t={__privatized:!0};for(var n in e)!function(n){var r=e[n];n.match(/^_/)||"function"==typeof r&&(t[n]=function(){var t=r.apply(e,arguments);return t})}(n);return t}function o(){return"undefined"!=typeof Buffer}function u(e){return o()&&e instanceof Buffer}function c(e){return e instanceof ArrayBuffer||u(e)}function l(e){for(var t=[],n=0;n<e.length;n++)t.push("%"+("0"+e[n].toString(16)).slice(-2));try{return decodeURIComponent(t.join(""))}catch(r){throw console.log(t.join("")),r}}function f(e,t){for(var n=encodeURIComponent(e),r=/^%(..)/,i=[],a=0;a<n.length;a++){var s=r.exec(n.substring(a));s?(i.push(parseInt("0x"+s[1])),a+=s[0].length-1):i.push(n.charCodeAt(a))}return"undefined"!=typeof Buffer&&t===Buffer?new Buffer(i):new Uint8Array(i).buffer}return{getQueryString:e,endsWith:n,startsWith:r,Base64_To_ArrayBuffer:i,Base64_From_ArrayBuffer:a,utf8bytes2str:l,str2utf8bytes:f,privatize:s,hasNodeBuffer:o,isNodeBuffer:u,isBuffer:c}}(),requireSimulator.setName("PathUtil"),define(["FS"],function(e){return e.PathUtil}),requireSimulator.setName("Shell"),define(["FS","Util","WebSite","PathUtil","assert"],function(e,t,n,r){function i(e,t){var n=a(e);if(t&&!n.exists())throw n+": no such file or directory";return n}function a(t){if("string"!=typeof t)return t;if(r.isAbsolutePath(t))return e.get(t);var n=s.cwd;return n.rel(t)}var s={};return s.cd=function(e){return s.cwd=i(e,!0),s.pwd()},s.mount=function(t,n){if(!t||!t.t){var r=[];for(var i in e.getRootFS().availFSTypes())r.push(i);return void sh.err("-t=("+r.join("|")+") should be specified.")}e.mount(n,t.t,t)},s.unmount=function(t){e.unmount(t)},s.fstab=function(){var t=e.getRootFS(),n=t.fstab(),r=this;n.forEach(function(e){r.echo(e.fstype()+"	"+(e.mountPoint||""))})},s.resolve=i,s.pwd=function(){return s.cwd+""},s.ls=function(e){return e=e?i(e,!0):s.cwd,e.ls()},s.cp=function(e,t,n){n||(n={}),n.v&&(s.echo("cp",e,t),n.echo=s.echo.bind(s));var r=i(e,!0),a=i(t);return r.copyTo(a,n)},s.ln=function(e,t,n){var r=i(t),a=i(e,!0);if(r.isDir()&&r.exists()&&(r=r.rel(a.name())),r.exists())throw new Error(r+" exists");return r.link(a,n)},s.rm=function(e,t){if(t||(t={}),t.notrash)return e=i(e,!1),e.removeWithoutTrash(),1;if(e=i(e,!0),e.isDir()&&t.r){var n=e,r=0;return n.each(function(e){e.exists()&&(r+=s.rm(e,t))}),n.rm(),r+1}return e.rm(),1},s.cat=function(e){return e=i(e,!0),s.echo(e.getContent(function(t){return e.isText()?t.toPlainText():t.toURL()}))},s.resolve=function(e){return e||(e="."),e=i(e)},s.grep=function(e,t,n){function r(e,t,r){n.res&&n.res.push({file:e,lineNo:t,line:r}),s.echo(e+"("+t+"): "+r)}return t=i(t,!0),n||(n={}),n.res||(n.res=[]),t.isDir()?t.each(function(t){s.grep(e,t,n)}):"string"==typeof e&&t.lines().forEach(function(n,i){n.indexOf(e)>=0&&r(t,i+1,n)}),n.res},s.touch=function(e){return e=i(e),e.text(e.exists()?e.text():""),1},s.setout=function(e){s.outUI=e},s.echo=function(){console.log.apply(console,arguments),s.outUI&&s.outUI.log&&s.outUI.log.apply(s.outUI,arguments)},s.err=function(){console.log.apply(console,arguments),s.outUI&&s.outUI.err&&s.outUI.err.apply(s.outUI,arguments)},s.prompt=function(){},s.ASYNC={r:"SH_ASYNC"},s.help=function(){for(var e in s){var t=s[e];"function"==typeof t&&s.echo(e+(t.description?" - "+t.description:""))}},sh=s,n.isNW&&(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()}),s}),requireSimulator.setName("Klass"),define(["assert"],function(e){function t(e){if("object"!=typeof e)return!1;if(!e)return!1;var t={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},n=0;for(var r in e){if(!t[r])return!1;n+=t[r]}return n}var n={};return n.define=function(r){function i(t){r.$fields&&e.is(t,r.$fields)}var a,s;r.$parent?(s=r.$parent,a=Object.create(s.prototype),a.super=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return s.prototype[t].apply(this,e)}):a={};var o,u=r.$||function(e){if(e&&"object"==typeof e)for(var t in e)this[t]=e[t]};u instanceof Array&&(o=u,u=function(){for(var e=Array.prototype.slice.call(arguments),t=0;t<o.length;t++)e.length>0&&(this[o[t]]=e.shift())});var c;c=function(){if(!(this instanceof c)){var e=Object.create(a);return u.apply(e,arguments),i(e),e}u.apply(this,arguments),i(this)},s&&(c.super=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift();return s.prototype[n].apply(t,e)}),c.inherit=function(e){return e.$parent=c,n.define(e)},c.prototype=a;for(var l in r)"$"!=l[0]&&("static$"==l.substring(0,7)?c[l.substring(7)]=r[l]:t(r[l])?Object.defineProperty(a,l,r[l]):a[l]=r[l]);return a.$=u,c},n.Function=function(){throw new Exception("Abstract")},n.opt=e.opt,n}),requireSimulator.setName("Tonyu.Thread"),define(["DeferredUtil","Klass"],function(e,t){var n={enterC:{},exitC:0};try{window.cnts=n}catch(r){}var i=t.define({$:function(){this.frame=null,this._isDead=!1,this.cnt=0,this._isWaiting=!1,this.fSuspended=!1,this.tryStack=[],this.preemptionTime=60,this.onEndHandlers=[],this.onTerminateHandlers=[],this.age=0},isAlive:function(){return!this.isDead()},isDead:function(){return this._isDead=this._isDead||null==this.frame||this._threadGroup&&(this._threadGroup.objectPoolAge!=this.tGrpObjectPoolAge||this._threadGroup.isDeadThreadGroup())},setThreadGroup:function(e){this._threadGroup=e,this.tGrpObjectPoolAge=e.objectPoolAge},isWaiting:function(){return this._isWaiting},suspend:function(){this.fSuspended=!0,this.cnt=0},enter:function(e){this.frame={prev:this.frame,func:e}},apply:function(e,t,n){n||(n=[]);var r;if("string"==typeof t&&(r=e["fiber$"+t],!r))throw new Error(""+t+"");"function"==typeof t&&(r=t.fiber),n=[this].concat(n);var i=0;return this.enter(function(t){switch(i){case 0:r.apply(e,n),i=1;break;case 1:t.termStatus="success",t.notifyEnd(t.retVal),n[0].exit(),i=2}})},notifyEnd:function(e){this.onEndHandlers.forEach(function(t){t(e)}),this.notifyTermination({status:"success",value:e})},notifyTermination:function(e){this.onTerminateHandlers.forEach(function(t){t(e)})},on:function(e,t){("end"===e||"success"===e)&&this.onEndHandlers.push(t),"terminate"===e&&(this.onTerminateHandlers.push(t),this.handleEx&&delete this.handleEx)},promise:function(){var t=this;return e.funcPromise(function(e,n){t.on("terminate",function(t){"success"===t.status?e(t.value):n("exception"===t.status?t.exception:new Error(t.status))})})},then:function(e,t){return t?this.proimse().then(e,t):this.proimse().then(e)},fail:function(e){return this.promise().fail(e)},gotoCatch:function(e){var t=this;if(0==t.tryStack.length)return t.termStatus="exception",t.kill(),void(t.handleEx?t.handleEx(e):t.notifyTermination({status:"exception",exception:e}));t.lastEx=e;for(var n=t.tryStack.pop();t.frame;){if(n.frame===t.frame){t.catchPC=n.catchPC;break}t.frame=t.frame.prev}},startCatch:function(){var e=this,t=e.lastEx;return e.lastEx=null,t},exit:function(e){this.frame=this.frame?this.frame.prev:null,this.retVal=e},enterTry:function(e){var t=this;t.tryStack.push({frame:t.frame,catchPC:e})},exitTry:function(){var e=this;e.tryStack.pop()},waitEvent:function(e,t){var n=this;if(n.suspend(),e.on){var r;t=t.concat(function(){n.lastEvent=arguments,n.retVal=arguments[0],r.remove(),n.steps()}),r=e.on.apply(e,t)}},runAsync:function(e){var t=this,n=function(){t.retVal=arguments,t.steps()},r=function(){for(var e="",n=0;n<arguments.length;n++)e+=arguments[n]+",";0==e.length&&(e="Async fail");var r=new Error(e);r.args=arguments,t.gotoCatch(r),t.steps()};t.suspend(),setTimeout(function(){e(n,r)},0)},waitFor:function(t){var n=this;return n._isWaiting=!0,n.suspend(),t instanceof i&&(t=t.promise()),e.ensureDefer(t).then(function(e){n.retVal=e,n.stepsLoop()}).fail(function(e){if(e instanceof Error)n.gotoCatch(e);else{var t=new Error(e);t.original=e,n.gotoCatch(t)}n.stepsLoop()})},resume:function(e){this.retVal=e,this.steps()},steps:function(){var e=this;if(!e.isDead()){var t=Tonyu.currentThread;for(Tonyu.currentThread=e,e.cnt=e.preemptionTime,e.preempted=!1,e.fSuspended=!1;e.cnt>0&&e.frame;)try{for(;e.cnt-->0&&e.frame;)e.frame.func(e);e.preempted=!e.fSuspended&&e.isAlive()}catch(n){e.gotoCatch(n)}Tonyu.currentThread=t}},stepsLoop:function(){var e=this;e.steps(),e.preempted&&setTimeout(function(){e.stepsLoop()},0)},kill:function(){var e=this;e._isDead=!0,e.frame=null,e.termStatus||(e.termStatus="killed",e.notifyTermination({status:"killed"}))},clearFrame:function(){this.frame=null,this.tryStack=[]}});return i}),requireSimulator.setName("Tonyu.Iterator"),define(["Klass"],function(e){function t(e,t){if(e.tonyuIterator)return e.tonyuIterator(t);if(e instanceof Array)return 1==t?new n(e):new r(e);if(e instanceof Object)return 1==t?new i(e):new a(e);throw console.log(e),new Error(e+" is not iterable")}var n=e.define({$:function(e){this.set=e,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.set[this.i],this.i++,!0)}}),r=e.define({$:function(e){this.set=e,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.i,this[1]=this.set[this.i],this.i++,!0)}}),i=e.define({$:function(e){this.elems=[];for(var t in e)this.elems.push(t);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i],this.i++,!0)}}),a=e.define({$:function(e){this.elems=[];for(var t in e)this.elems.push([t,e[t]]);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i][0],this[1]=this.elems[this.i][1],this.i++,!0)}});return t}),requireSimulator.setName("Tonyu"),"function"!=typeof define&&(define=require("requirejs").define),define(["assert","Tonyu.Thread","Tonyu.Iterator","DeferredUtil"],function(e,t,n,r){return Tonyu=function(){function i(){var e=new t;return e.handleEx=o,e}function a(e){return r.funcPromise(function(t){setTimeout(t,e)})}function s(){return r.funcPromise(function(e){requestAnimationFrame(e)})}function o(e){if(!Tonyu.onRuntimeError)throw"undefined"==typeof $LASTPOS&&($LASTPOS=0),alert("! at "+$LASTPOS+"   : "+e),console.log(e.stack),e;Tonyu.onRuntimeError(e)}function u(t,n){return e.is(arguments,[String,Object]),l(klass.getMeta(t),n)}function c(e,t){return e?l(Object.create(e.prototype),t):t}function l(e,t){if(t&&"object"==typeof t)for(var n in t)e[n]=t[n];return e}function f(e,t){M[e]=t}function h(e){return M[e]}function d(e){var t=e.split("."),n=k;if(t.forEach(function(e){n&&(n=n[e])}),!n&&1==t.length){var r;for(var i in k){var a=k[i][e];if(a){if(n)throw new Error(" "+i+"."+e+", "+r);n=a,r=i+"."+e}}}return n}function p(e,t){if("function"!=typeof t)return t;var n=function(){return t.apply(e,arguments)};return n.methodInfo=Tonyu.extend({thiz:e},t.methodInfo||{}),t.fiber&&(n.fiber=function(){return t.fiber.apply(e,arguments)},n.fiber.methodInfo=Tonyu.extend({thiz:e},t.fiber.methodInfo||{})),n}function m(e,t,n,r){if(!e)throw new Error(r+"(="+e+") "+t+"");var i=e[t];if("function"!=typeof i)throw new Error(("this"==r?"":r+".")+t+"(="+i+")");return i.apply(e,n)}function g(e,t,n){if("function"!=typeof e)throw new Error(n+"");return e.apply({},t)}function v(e,t){if(e!=e||null==e)throw new Error(t+"(="+e+")");return e}function y(e){for(var t=[],n=1;n<e.length;n++)t[n-1]=e[n];return t}function b(e){throw new Error(""+e+"new")}function _(e){throw console.log("Not a tonyu object: ",e),new Error(e+" is not a tonyu object")}function w(e,t){return e in t}function T(e){var t=d(e);if(!t)throw new Error(e+" ");Tonyu.runMode=!0;var n,r=new t;(n=Tonyu.currentProject)&&(n.runningObj=r),$LASTPOS=0}function S(){var e=(new Date).getTime();if(e-P>1e3)throw x(1e4),new Error(""+(e-A));A=e}function x(e){P=(new Date).getTime()+(e||0)}klass=function(){throw alert(" Deprecated. compile again."),new Error(" Deprecated. compile again.")},klass.addMeta=u,klass.removeMeta=function(e){delete E[e]},klass.getMeta=function(e){if("function"==typeof e)return e.meta;if("string"==typeof e){var t=E[e];return t||(E[e]=t={}),t}},klass.ensureNamespace=function(e,t){var n,r=t.split("."),i=e;for(n=0;n<r.length;n++){var a=r[n];i[a]||(i[a]={}),i=i[a]}return i},Function.prototype.constructor=function(){throw new Error("This method should not be called")},klass.define=function(e){var t=e.superclass,n=e.includes,r=e.fullName,i=e.shortName,a=e.namespace,s=e.methods,o=e.decls,l=klass.ensureNamespace(Tonyu.classes,a),f=s,h=f.initialize;delete f.initialize;var d;d=h?function(){this instanceof d||b(r),h.apply(this,arguments)}:t?function(){this instanceof d||b(r),t.apply(this,arguments)}:function(){this instanceof d||b(r)},l[i]=d,d.methods=f,n.forEach(function(e){if(!e.methods)throw e+" Does not have methods";for(var t in e.methods)t in f||(f[t]=e.methods[t])});var p={},m=/^__([gs]et)ter__(.*)$/;for(var g in f)if(!g.match(/^fiber\$/)){f["fiber$"+g]&&(f[g].fiber=f["fiber$"+g],f[g].fiber.methodInfo={name:g,klass:d,fiber:!0}),f[g].methodInfo={name:g,klass:d};var v=m.exec(g);v&&(p[v[2]]=p[v[2]]||{},p[v[2]][v[1]]=f[g])}d.prototype=c(t,f),d.prototype.isTonyuObject=!0;for(var g in p)Object.defineProperty(d.prototype,g,p[g]);d.meta=u(r,{fullName:r,shortName:i,namepsace:a,decls:o,superclass:t?t.meta:null,func:d,includes:n.map(function(e){return e.meta})});var y=klass.getMeta(d);return d.prototype.getClassInfo=function(){return y},d},klass.isSourceChanged=function(e){return e=e.meta||e,e.src&&e.src.tonyu?e.nodeTimestamp?e.src.tonyu.lastUpdate()>e.nodeTimestamp:!0:!1},klass.shouldCompile=function(e){if(e=e.meta||e,klass.isSourceChanged(e))return!0;for(var t=klass.getDependingClasses(e),n=0;n<t.length;n++)if(klass.shouldCompile(t[n]))return!0},klass.getDependingClasses=function(e){e=e.meta||e;var t=[];return e.superclass&&(t=[e.superclass]),e.includes&&(t=t.concat(e.includes)),t};var A,M={},k={},E={},P=(new Date).getTime();return setInterval(x,16),Tonyu={thread:i,klass:klass,bless:c,extend:l,globals:M,classes:k,classMetas:E,setGlobal:f,getGlobal:h,getClass:d,timeout:a,animationFrame:s,bindFunc:p,not_a_tonyu_object:_,hasKey:w,invokeMethod:m,callFunc:g,checkNonNull:v,run:T,iterator:n,checkLoop:S,resetLoopCheck:x,VERSION:1511765730045,A:y}}()}),requireSimulator.setName("PatternParser"),define(["Tonyu"],function(e){var t=function(e,t){this.options=t||{},this.img=e,this.height=e.height,this.width=e.width;var n=this.newImage(e.width,e.height),r=n.getContext("2d");r.drawImage(e,0,0),this.ctx=r,this.pixels=this.ctx.getImageData(0,0,e.width,e.height).data,this.base=this.getPixel(0,0)};return e.extend(t.prototype,{newImage:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},getPixel:function(e,t){var n=this.pixels,r=4*(e+t*this.width),i=n[0+r],a=n[1+r],s=n[2+r],o=n[3+r];return 256*(256*(256*o+s)+a)+i},setPixel:function(e,t,n){var r=4*(e+t*this.width);this.pixels[0+r]=255&n,n=(n-(255&n))/256,this.pixels[1+r]=255&n,n=(n-(255&n))/256,this.pixels[2+r]=255&n,n=(n-(255&n))/256,this.pixels[3+r]=255&n},parse:function(){try{for(var e=[],t=0;t<this.height;t++)for(var n=0;n<this.width;n++){var r=this.getPixel(n,t);r!=this.base&&e.push(this.parse1Pattern(n,t))}return e}catch(i){if(i.isParseError)return console.log("parse error! "+i),[{image:this.img,x:0,y:0,width:this.width,height:this.height}];throw i}},parse1Pattern:function(e,t){function n(e){return e}function r(e,t,n){return{toString:function(){return"at ("+e+","+t+") :"+n},isParseError:!0}}for(var i=this.getPixel(e,t),a=e,s=t,o=this.base,u=this.width,c=this.height;u>a;){var l=this.getPixel(a,s);if(l!=i)break;a++}if(a>=u||this.getPixel(a,s)!=o)throw r(a,s,n(this.getPixel(a,s))+"!="+n(o));for(a--;c>s&&this.getPixel(a,s)==i;)s++;if(s>=c||this.getPixel(a,s)!=o)throw r(a,s,n(this.getPixel(a,s))+"!="+n(o));s--;var f=e+1,h=t+1,d=a-f,p=s-h;if(console.log("PP",f,h,d,p,a,s),d*p==0)throw r(a,s,"w*h==0");for(var m=this.newImage(d,p),g=m.getContext("2d"),v=g.getImageData(0,0,d,p),y=v.data,b=0,_=h;s>_;_++)for(var w=f;a>w;w++){var T=this.getPixel(w,_);T==i?(y[b++]=0,y[b++]=0,y[b++]=0,y[b++]=0):(y[b++]=255&T,T=(T-(255&T))/256,y[b++]=255&T,T=(T-(255&T))/256,y[b++]=255&T,T=(T-(255&T))/256,y[b++]=255&T)}g.putImageData(v,0,0);for(var S=h-1;s>=S;S++)for(var x=f-1;a>=x;x++)this.setPixel(x,S,o);return this.options.boundsInSrc?{x:f,y:h,width:d,height:p}:{image:m,x:0,y:0,width:d,height:p}}}),t}),requireSimulator.setName("Assets"),define(["WebSite","Util","Tonyu","FS"],function(e,t,n,r){var i={};return i.resolve=function(n,i){var a=r.isFile(i)?i:i.getDir();if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,n){return e[n]}),e.urlAliases[n]&&(n=e.urlAliases[n]),t.startsWith(n,"ls:")){var s=n.substring("ls:".length);if(!a)throw new Error("Basedir not specified");var o=a.rel(s);if(!o.exists())throw new Error("Resource file not found: "+o);if(e.mp3Disabled&&s.match(/\.(mp3|mp4|m4a)$/)){var u=a.rel(s.replace(/\.(mp3|mp4|m4a)$/,".ogg"));u.exists()&&(o=u)}n=o.getURL()}return n},n.Assets=i,i}),requireSimulator.setName("ImageList"),define(["PatternParser","Util","Assets","assert"],function(e,t,n,r){function i(e){var t=[];return e.forEach(function(e){e&&""!=e.url&&t.push(e)}),t}var a,s={};return a=function(t,a,o){o||(o={}),t=i(t);var u=[],c=t.length;0==c&&setTimeout(function(){var e=[];e.names={},a(e)},0),t.forEach(function(t,i){function l(){var n,s;if("single"==t.type)u[i]=[{image:this,x:0,y:0,width:this.width,height:this.height}];else if((n=t.pwidth)&&(s=t.pheight)){for(var o=0,l=0,f=this.width,h=this.height,d=[];;){var p=n,m=s;if(o+n>f&&(p=f-o),l+s>h&&(m=h-l),d.push({image:this,x:o,y:l,width:p,height:m}),o+=n,o+n>f&&(o=0,l+=s,l+s>h))break}u[i]=d}else{var g=new e(this);u[i]=g.parse()}if(u[i].name=t.name,r.is(u[i],Array),c--,0==c){var v=[],y={};u.forEach(function(e){y[e.name]=v.length,v=v.concat(e)}),v.names=y,a(v)}}console.log("loading",t,i);var f=t.url,h=f;if(s[h])return void l.apply(s[h],[]);f=n.resolve(f,o.prj||o.baseDir);var d=$("<img>");d.load(function(){s[h]=this,l.apply(this,[])}),d.attr("src",f)})},a.load=a,a.parse1=function(t,n,i){var a,s,o;if((a=t.pwidth)&&(s=t.pheight)){for(var u=0,c=0,l=n.width,f=n.height,h=[];;)if(h.push({image:this,x:u,y:c,width:a,height:s}),u+=a,u+a>l&&(u=0,c+=s,c+s>f))break;o=h}else{var d=new e(n,i);o=d.parse()}return o.name=t.name,r.is(o,Array)},window.ImageList=a,a}),requireSimulator.setName("PicoAudio");var PicoAudio=function(){function e(e,t){var n=window.AudioContext||window.webkitAudioContext;this.context=e?e:new n,this.settings={masterVolume:1,generateVolume:.15,tempo:120,basePitch:440,resolution:480,hashLength:this.isAndroid()?25:50,hashBuffer:2,isWebMIDI:!1,WebMIDIPortOutputs:null,WebMIDIPortOutput:null,WebMIDIPort:-1,WebMIDIPortSysEx:!0,isReverb:!this.isAndroid(),reverbVolume:1.5,isChorus:!0,chorusVolume:.5,isCC111:!0,dramMaxPlayLength:.5,loop:!1},this.trigger={isNoteTrigger:!0,noteOn:function(){},noteOff:function(){},songEnd:function(){}},this.states={isPlaying:!1,playIndex:0,startTime:0,stopTime:0,stopFuncs:[],webMIDIWaitState:null,webMIDIStopTime:0},this.hashedDataList=[],this.hashedMessageList=[],this.channels=[],this.tempoTrack=[{timing:0,value:120},{timing:0,value:120}],this.cc111Time=-1;for(var r=0;17>r;r++)this.channels.push([0,0,1]);if(t&&t.whitenoise)this.whitenoise=t.whitenoise;else{this.whitenoise=this.context.createBuffer(2,this.context.sampleRate,this.context.sampleRate);for(var i=0;2>i;i++)for(var r=0;r<this.context.sampleRate;r++)this.whitenoise.getChannelData(i)[r]=2*Math.random()-1}if(this.masterGainNode=this.context.createGain(),this.masterGainNode.gain.value=this.settings.masterVolume,t&&t.impulseResponse)this.impulseResponse=t.impulseResponse;else{var a=3.5*this.context.sampleRate;this.impulseResponse=this.context.createBuffer(2,a,this.context.sampleRate);for(var i=0;2>i;i++)for(var s=this.impulseResponse.getChannelData(i),r=0;a>r;r++){var o=(a-r)/a,u=r/this.context.sampleRate,c=(.03>u?0:o)*(u>=.03&&.031>u?2*o:o)*(u>=.04&&.042>u?1.5*o:o)*(u>=.05&&.054>u?1.25*o:o)*Math.random()*.2*Math.pow(o-.03,4);s[r]=c}}this.convolver=this.context.createConvolver(),this.convolver.buffer=this.impulseResponse,this.convolver.normalize=!1,this.convolverGainNode=this.context.createGain(),this.convolverGainNode.gain.value=this.settings.reverbVolume,this.convolver.connect(this.convolverGainNode),this.convolverGainNode.connect(this.masterGainNode),this.masterGainNode.connect(this.context.destination),this.chorusDelayNode=this.context.createDelay(),this.chorusGainNode=this.context.createGain(),this.chorusOscillator=this.context.createOscillator(),this.chorusLfoGainNode=this.context.createGain(),this.chorusDelayNode.delayTime.value=.025,this.chorusLfoGainNode.gain.value=.01,this.chorusOscillator.frequency.value=.05,this.chorusGainNode.gain.value=this.settings.chorusVolume,this.chorusOscillator.connect(this.chorusLfoGainNode),this.chorusLfoGainNode.connect(this.chorusDelayNode.delayTime),this.chorusDelayNode.connect(this.chorusGainNode),this.chorusGainNode.connect(this.masterGainNode),this.masterGainNode.connect(this.context.destination),this.chorusOscillator.start(0),this.onSongEndListener=null}return e.prototype.createNote=function(e){var t=!1;if(e.channel)switch(this.channels[e.channel][1]/10||e.instrument){case.2:case 12:case 13:case 45:case 55:t=!0}var n=this.createBaseNote(e,!0,!1,t),r=n.oscillator,i=n.gainNode,a=(n.panNode,n.noiseCutGainNode),s=!1,o=this;switch(this.channels[n.channel][0]/10||e.instrument){case.1:case 6:case 15:case 24:case 26:case 46:case 50:case 51:case 52:case 53:case 54:case 82:case 85:case 86:r.type="sine",i.gain.value*=1.5;break;case.2:case 4:case 12:case 13:case 16:case 19:case 20:case 32:case 34:case 45:case 48:case 49:case 55:case 56:case 57:case 61:case 62:case 63:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 84:r.type="square",i.gain.value*=.8;break;case.3:case 0:case 1:case 2:case 3:case 6:case 7:case 17:case 18:case 21:case 22:case 23:case 27:case 28:case 29:case 30:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 47:case 59:case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 82:case 87:r.type="sawtooth";break;case.4:case 8:case 9:case 10:case 11:case 14:case 25:case 31:case 33:case 35:case 58:case 60:case 83:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:r.type="triangle",i.gain.value*=1.5;break;default:r.type="square"}switch(this.channels[n.channel][1]/10||e.instrument){case.2:case 12:case 13:case 45:case 55:s=!0,i.gain.value*=1.1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(0,n.start+.2),o.stopAudioNode(r,n.start+.5,i);break;case.3:case 0:case 1:case 2:case 3:case 6:case 9:case 11:case 14:case 15:case 32:case 36:case 37:case 46:case 47:i.gain.value*=1.1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(.95*i.gain.value,n.start+.1),i.gain.setValueAtTime(.95*i.gain.value,n.start+.1),i.gain.linearRampToValueAtTime(0,n.start+1.5+3*n.velocity);break;case.4:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 34:i.gain.value*=1.1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(0,n.start+1+4*n.velocity);break;case.5:case 4:case 5:case 7:case 8:case 10:case 33:case 35:i.gain.value*=1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(.95*i.gain.value,n.start+.1),i.gain.setValueAtTime(.95*i.gain.value,n.start+.1),i.gain.linearRampToValueAtTime(0,n.start+2+10*n.velocity);break;case 119:i.gain.value=0,o.stopAudioNode(r,0,i)}return("sine"==r.type||"triangle"==r.type)&&!s&&n.stop-n.start>.01&&(a.gain.setValueAtTime(1,n.stop-.005),a.gain.linearRampToValueAtTime(0,n.stop)),function(){o.stopAudioNode(r,0,i)}},e.prototype.createPercussionNote=function(e){var t=this.createBaseNote(e,!1),n=t.oscillator,r=t.gainNode,i=(t.panNode,t.start),a=(t.stop,t.velocity*((e.expression?e.expression[0].value:100)/127)),s=this.createBaseNote(e,!1,!0),o=s.oscillator,u=s.gainNode,c=(s.panNode,this);switch(e.pitch){case 35:case 36:r.gain.value=.6*a,n.playbackRate.value=.02,c.stopAudioNode(n,i+.07,r),u.gain.value=1.1*a,o.frequency.setValueAtTime(120,i),o.frequency.linearRampToValueAtTime(50,i+.07),c.stopAudioNode(o,i+.07,u);break;case 38:case 40:n.playbackRate.value=.7,c.stopAudioNode(n,i+.05,r),u.gain.setValueAtTime(.8*a,i),u.gain.linearRampToValueAtTime(0,i+.05),o.frequency.setValueAtTime(300,i),o.frequency.linearRampToValueAtTime(200,i+.05),c.stopAudioNode(o,i+.05,u);break;case 41:case 43:case 45:case 47:case 48:case 50:n.playbackRate.value=.01,c.stopAudioNode(n,i+.1,r),o.type="square",u.gain.setValueAtTime(a,i),u.gain.linearRampToValueAtTime(.01,i+.1),o.frequency.setValueAtTime(150+20*(e.pitch-40),i),o.frequency.linearRampToValueAtTime(50+20*(e.pitch-40),i+.1),c.stopAudioNode(o,i+.1,u);break;case 42:case 44:n.playbackRate.value=1.5,c.stopAudioNode(n,i+.02,r),c.stopAudioNode(o,0,u);break;case 46:n.playbackRate.value=1.5,c.stopAudioNode(n,i+.3,r),r.gain.setValueAtTime(.9*a,i),r.gain.linearRampToValueAtTime(0,i+.3),c.stopAudioNode(o,0,u);break;case 49:case 51:case 52:case 53:case 55:case 57:n.playbackRate.value=1.2,c.stopAudioNode(n,i+.5,r),r.gain.setValueAtTime(1*a,i),r.gain.linearRampToValueAtTime(0,i+.5),c.stopAudioNode(o,0,u);break;case 51:n.playbackRate.value=1.1,c.stopAudioNode(n,i+.4,r),r.gain.setValueAtTime(.8*a,i),r.gain.linearRampToValueAtTime(0,i+.4),c.stopAudioNode(o,0,u);break;case 59:n.playbackRate.value=1.8,c.stopAudioNode(n,i+.3,r),r.gain.setValueAtTime(.5*a,i),r.gain.linearRampToValueAtTime(0,i+.3),c.stopAudioNode(o,0,u);break;case 60:case 61:n.playbackRate.value=.03,c.stopAudioNode(n,i+.03,r),u.gain.setValueAtTime(.8*a,i),u.gain.linearRampToValueAtTime(0,i+.1),o.frequency.setValueAtTime(400-40*(e.pitch-60),i),o.frequency.linearRampToValueAtTime(450-40*(e.pitch-60),i+.1),c.stopAudioNode(o,i+.1,u);break;case 62:n.playbackRate.value=.03,c.stopAudioNode(n,i+.03,r),u.gain.setValueAtTime(a,i),u.gain.linearRampToValueAtTime(0,i+.03),o.frequency.setValueAtTime(200,i),o.frequency.linearRampToValueAtTime(250,i+.03),c.stopAudioNode(o,i+.03,u);break;case 63:case 64:n.playbackRate.value=.03,c.stopAudioNode(n,i+.03,r),u.gain.setValueAtTime(a,i),u.gain.linearRampToValueAtTime(0,i+.1),o.frequency.setValueAtTime(200-30*(e.pitch-63),i),o.frequency.linearRampToValueAtTime(250-30*(e.pitch-63),i+.1),c.stopAudioNode(o,i+.1,u);break;case 56:case 75:n.playbackRate.value=.01,c.stopAudioNode(n,i+.1,r),u.gain.setValueAtTime(a,i),u.gain.linearRampToValueAtTime(0,i+.1),o.frequency.setValueAtTime(1e3+48*(e.pitch-56),i),c.stopAudioNode(o,i+.1,u);break;case 80:n.playbackRate.value=5,r.gain.setValueAtTime(.5*a,i),r.gain.linearRampToValueAtTime(0,i+.2),c.stopAudioNode(n,i+.05,r),o.type="triangle",u.gain.setValueAtTime(.7*a,i),u.gain.linearRampToValueAtTime(0,i+.2),o.frequency.setValueAtTime(6e3,i),c.stopAudioNode(o,i+.05,u);break;case 81:n.playbackRate.value=5,r.gain.setValueAtTime(.9*a,i),r.gain.linearRampToValueAtTime(0,i+.5),c.stopAudioNode(n,i+.5,r),o.type="triangle",u.gain.setValueAtTime(.8*a,i),u.gain.linearRampToValueAtTime(0,i+.3),o.frequency.setValueAtTime(6e3,i),c.stopAudioNode(o,i+.3,u);break;default:n.playbackRate.value=e.pitch/69*2,c.stopAudioNode(n,i+.05,r),c.stopAudioNode(o,0,u)}return function(){c.stopAudioNode(n,0,r),c.stopAudioNode(o,0,u)}},e.prototype.createBaseNote=function(e,t,n,r){var i=this.settings,a=this.context,s=this.states.startTime,o=this.getTime(e.start)+s,u=this.getTime(e.stop)+s,c=i.basePitch*Math.pow(Math.pow(2,1/12),(e.pitch||69)-69),l=n?0:e.channel||0,f=e.velocity*Number(n?1:this.channels[l][2]||1)*i.generateVolume,h=9!=l?a.createOscillator():a.createBufferSource(),d=a.createStereoPanner?a.createStereoPanner():a.createPanner?a.createPanner():{pan:{setValueAtTime:function(){}}},p=a.createGain(),m=a.createGain(),g=this;
if(!a.createStereoPanner&&a.createPanner){var v=e.pan&&64!=e.pan[0].value?e.pan[0].value/127*2-1:0;v>1&&(v=1);var y=90*v,b=Math.sin(y*(Math.PI/180)),_=-Math.cos(y*(Math.PI/180));d.panningModel="equalpower",d.setPosition(b,0,_)}else if(a.createStereoPanner){var v=e.pan&&64!=e.pan[0].value?e.pan[0].value/127*2-1:0;v>1&&(v=1),d.pan.value=v}if(p.gain.value=f*((e.expression?e.expression[0].value:100)/127),9!=l?(h.type=e.type||"sine",h.detune.value=0,h.frequency.value=c,e.pitchBend?e.pitchBend.forEach(function(t){h.frequency.setValueAtTime(i.basePitch*Math.pow(Math.pow(2,1/12),e.pitch-69+t.value),g.getTime(t.timing)+s)}):!1):(h.loop=!0,h.buffer=this.whitenoise),t&&(e.expression?e.expression.forEach(function(e){p.gain.setValueAtTime(f*(e.value/127),g.getTime(e.timing)+s)}):!1),a.createStereoPanner||a.createPanner){var w=!0;a.createStereoPanner?e.pan?e.pan.forEach(function(e){if(w)return void(w=!1);var t=64==e.value?0:e.value/127*2-1;t>1&&(t=1),d.pan.setValueAtTime(t,g.getTime(e.timing)+s)}):!1:a.createPanner&&(d.positionX?e.pan?e.pan.forEach(function(e){if(w)return void(w=!1);var t=64==e.value?0:e.value/127*2-1;t>1&&(t=1);var n=90*t,r=Math.sin(n*(Math.PI/180)),i=-Math.cos(n*(Math.PI/180));d.positionX.setValueAtTime(r,g.getTime(e.timing)+s),d.positionY.setValueAtTime(0,g.getTime(e.timing)+s),d.positionZ.setValueAtTime(i,g.getTime(e.timing)+s)}):!1:e.pan?e.pan.forEach(function(e){if(w)return void(w=!1);var t=setTimeout(function(){g.clearFunc("pan",t);var n=64==e.value?0:e.value/127*2-1;n>1&&(n=1);var r=90*n,i=Math.sin(r*(Math.PI/180)),a=-Math.cos(r*(Math.PI/180));d.setPosition(i,0,a)},1e3*(g.getTime(e.timing)+s-a.currentTime));g.pushFunc({pan:t,stopFunc:function(){clearTimeout(t)}})}):!1),h.connect(d),d.connect(p)}else h.connect(p);if(p.connect(m),m.connect(this.masterGainNode),this.masterGainNode.connect(a.destination),9!=l&&e.modulation&&(e.modulation.length>=2||e.modulation[0].value>0)){var T=a.createOscillator(),S=a.createGain();w=!0,e.modulation?e.modulation.forEach(function(e){if(w)return void(w=!1);var t=e.value/127;t>1&&(t=1),S.gain.setValueAtTime(10*c/440*t,g.getTime(e.timing)+s)}):!1;var x=e.modulation?e.modulation[0].value/127:0;x>1&&(x=1),S.gain.value=10*c/440*x,T.frequency.value=6,T.connect(S),S.connect(h.frequency)}if(this.settings.isReverb&&e.reverb&&(e.reverb.length>=2||e.reverb[0].value>0)){var A=this.convolver,M=(this.masterGainNode,a.createGain());w=!0,e.reverb?e.reverb.forEach(function(e){if(w)return void(w=!1);var t=e.value/127;t>1&&(t=1),M.gain.setValueAtTime(t,g.getTime(e.timing)+s)}):!1;var k=e.reverb?e.reverb[0].value/127:0;k>1&&(k=1),M.gain.value=k,p.connect(M),M.connect(A)}if(this.settings.isChorus&&e.chorus&&(e.chorus.length>=2||e.chorus[0].value>0)){var E=this.chorusDelayNode,P=(this.masterGainNode,a.createGain());w=!0,e.chorus?e.chorus.forEach(function(e){if(w)return void(w=!1);var t=e.value/127;t>1&&(t=1),P.gain.setValueAtTime(t,g.getTime(e.timing)+s)}):!1;var B=e.chorus?e.chorus[0].value/127:0;B>1&&(B=1),P.gain.value=B,p.connect(P),P.connect(E)}return T&&(T.start(o),this.stopAudioNode(T,u,S)),h.start(o),9==l||n||r||this.stopAudioNode(h,u,p),{start:o,stop:u,pitch:c,channel:l,velocity:f,oscillator:h,panNode:d,gainNode:p,noiseCutGainNode:m}},e.prototype.startWebMIDI=function(){var e,t=this;if(navigator.requestMIDIAccess){var n=this.settings.WebMIDIPortSysEx,r=function(r){e=r.outputs,t.settings.WebMIDIPortOutputs=e;var i;return-1==t.settings.WebMIDIPort?t.settings.WebMIDIPortOutputs.forEach(function(e){i||(i=e)}):i=t.settings.WebMIDIPortOutputs.get(settings.WebMIDIPort),t.settings.WebMIDIPortOutput=i,t.settings.WebMIDIPortSysEx=n,i&&(i.open(),t.initStatus()),e},i=function(e){console.log(e),n&&(n=!1,navigator.requestMIDIAccess({sysex:n}).then(r).catch(i))};navigator.requestMIDIAccess({sysex:n}).then(r).catch(i),window.addEventListener("unload",function(){for(var e=0;16>e;e++){t.settings.WebMIDIPortOutput.send([176+e,120,0]);for(var n=0;128>n;n++)t.settings.WebMIDIPortOutput.send([128+e,n,0])}})}},e.prototype.initStatus=function(e,t){if(!this.settings.isWebMIDI||null==this.states.webMIDIWaitState){this.stop(e);var n=this.states.webMIDIStopTime;if(this.states={isPlaying:!1,playIndex:0,startTime:0,stopTime:0,stopFuncs:[],webMIDIWaitState:null,webMIDIStopTime:0},this.states.webMIDIStopTime=n,this.settings.isWebMIDI&&!t){if(e)return;if(null==this.settings.WebMIDIPortOutput)return void this.startWebMIDI();if(this.settings.WebMIDIPortSysEx)this.settings.WebMIDIPortOutput.send([240,126,127,9,1,247]);else for(var r=0;16>r;r++)this.settings.WebMIDIPortOutput.send([192+r,0]),this.settings.WebMIDIPortOutput.send([224+r,0,64]),this.settings.WebMIDIPortOutput.send([176+r,100,0]),this.settings.WebMIDIPortOutput.send([176+r,101,0]),this.settings.WebMIDIPortOutput.send([176+r,6,2]),this.settings.WebMIDIPortOutput.send([176+r,100,1]),this.settings.WebMIDIPortOutput.send([176+r,96,0]),this.settings.WebMIDIPortOutput.send([176+r,97,64]),this.settings.WebMIDIPortOutput.send([176+r,7,100]),this.settings.WebMIDIPortOutput.send([176+r,10,64]),this.settings.WebMIDIPortOutput.send([176+r,11,127]),this.settings.WebMIDIPortOutput.send([176+r,98,0]),this.settings.WebMIDIPortOutput.send([176+r,99,0]),this.settings.WebMIDIPortOutput.send([176+r,122,0])}}},e.prototype.stop=function(e){var t=this.states,n=this;if(0!=t.isPlaying&&(t.isPlaying=!1,t.playIndex-=this.settings.hashBuffer+1,t.stopTime=this.context.currentTime,t.stopFuncs.forEach(function(e){e.stopFunc()}),t.stopFuncs=[],this.settings.isWebMIDI)){if(e)return;if(null==this.settings.WebMIDIPortOutput)return;t.webMIDIStopTime=this.context.currentTime,setTimeout(function(){for(var e=0;16>e;e++){n.settings.WebMIDIPortOutput.send([176+e,120,0]);for(var t=0;128>t;t++)n.settings.WebMIDIPortOutput.send([128+e,t,0])}},200)}},e.prototype.play=function(e){var t=this.context,n=this.settings,r=this.trigger,i=this.states,a=this.hashedDataList,s=this;if(1!=i.isPlaying){if(n.isWebMIDI&&!e){if("completed"!=i.webMIDIWaitState){if("waiting"!=i.webMIDIWaitState){i.webMIDIWaitState="waiting";var o=800-1e3*(t.currentTime-i.webMIDIStopTime);0==i.webMIDIStopTime&&(o=800),setTimeout(function(){s.states.webMIDIWaitState="completed",s.states.isPlaying=!1,s.play()},o)}return}i.webMIDIWaitState=null}{var u=this.context.currentTime;i.startTime}i.isPlaying=!0,i.startTime=i.startTime||i.stopTime?i.startTime+u-i.stopTime:u,i.stopFuncs=[];var c=this.getTime(this.firstNoteOnTiming);-i.startTime+u<c&&this.setStartTime(c+i.startTime-u);var l,f=function(){s.clearFunc("rootTimeout",l);var e=s.getTime(s.settings.isCC111&&-1!=s.cc111Time?s.lastNoteOffTiming:s.getTiming(Number.MAX_SAFE_INTEGER));e-t.currentTime+i.startTime<=0?s.onSongEnd():(l=setTimeout(f,1),s.pushFunc({rootTimeout:l,stopFunc:function(){clearTimeout(l)}}))},h=this.getTime(this.settings.isCC111&&-1!=this.cc111Time?this.lastNoteOffTiming:this.getTiming(Number.MAX_SAFE_INTEGER)),d=1e3*(h-t.currentTime+i.startTime);l=setTimeout(f,d),s.pushFunc({rootTimeout:l,stopFunc:function(){clearTimeout(l)}}),function p(e){if(i.playIndex=e,a&&a[e]&&a[e].forEach(function(e){n.isWebMIDI||s.pushFunc({note:e,stopFunc:9!=e.channel?s.createNote(e):s.createPercussionNote(e)});var a=setTimeout(function(){s.clearFunc("timeout",a),r.isNoteTrigger&&r.noteOn(e);var t=setTimeout(function(){s.clearFunc("timeout",t),s.clearFunc("note",e),r.isNoteTrigger&&r.noteOff(e)},9!=e.channel?1e3*(s.getTime(e.stop)-s.getTime(e.start)):1e3*s.settings.dramMaxPlayLength);s.pushFunc({timeout:t,stopFunc:function(){clearTimeout(t)}})},1e3*(s.getTime(e.start)-t.currentTime+i.startTime));s.pushFunc({timeout:a,stopFunc:function(){clearTimeout(a)}})}),n.isWebMIDI&&s.hashedMessageList&&s.hashedMessageList[e]&&s.hashedMessageList[e].forEach(function(e){if(null!=n.WebMIDIPortOutput&&255!=e.message[0]&&(s.settings.WebMIDIPortSysEx||240!=e.message[0]&&247!=e.message[0]))try{n.WebMIDIPortOutput.send(e.message,1e3*(s.getTime(e.timing)-t.currentTime+window.performance.now()/1e3+i.startTime))}catch(r){console.log(r,e.message)}}),e<a.length)if(e-Math.floor(1e3*(t.currentTime-i.startTime)/n.hashLength)<=n.hashBuffer)p(e+1);else{var o=setTimeout(function(){p(e+1),s.clearFunc("rootTimeout",o)},n.hashLength);s.pushFunc({rootTimeout:o,stopFunc:function(){clearTimeout(o)}})}else r.songEnd()}(i.playIndex||0)}},e.prototype.setData=function(e){this.states.isPlaying&&this.stop(),this.settings.resolution=e.header.resolution,this.settings.tempo=e.tempo||120,this.tempoTrack=e.tempoTrack,this.cc111Time=e.cc111Time,this.firstNoteOnTiming=e.firstNoteOnTiming,this.lastNoteOffTiming=e.lastNoteOffTiming;var t=this,n=[];if(e.channels.forEach(function(e){e.notes.forEach(function(e){var r=t.getTime(e.start)*(1e3/t.settings.hashLength);n[Math.floor(r)]||(n[Math.floor(r)]=[]),n[Math.floor(r)].push(e)})}),this.settings.isWebMIDI){var r=[];e.messages.forEach(function(e){var n=t.getTime(e.timing)*(1e3/t.settings.hashLength);r[Math.floor(n)]||(r[Math.floor(n)]=[]),r[Math.floor(n)].push(e)}),this.hashedMessageList=r}return this.hashedDataList=n,this.initStatus(),this},e.prototype.getMasterVolume=function(){return this.settings.masterVolume},e.prototype.setMasterVolume=function(e){this.settings.masterVolume=e,this.masterGainNode.gain.value=this.settings.masterVolume},e.prototype.isLoop=function(){return this.settings.loop},e.prototype.setLoop=function(e){this.settings.loop=e},e.prototype.isWebMIDI=function(){return this.settings.isWebMIDI},e.prototype.setWebMIDI=function(e){this.settings.isWebMIDI=e},e.prototype.isCC111=function(){return this.settings.isCC111},e.prototype.setCC111=function(e){this.settings.isCC111=e},e.prototype.setStartTime=function(e){this.states.startTime-=e,this.states.playIndex=Math.floor(1e3*e/this.settings.hashLength)},e.prototype.setOnSongEndListener=function(e){this.onSongEndListener=e},e.prototype.onSongEnd=function(){if(this.onSongEndListener){var e=this.onSongEndListener();if(e)return}this.settings.loop&&(this.initStatus(!0),this.settings.isCC111&&-1!=this.cc111Time&&this.setStartTime(this.getTime(this.cc111Time)),this.play(!0))},e.prototype.isReverb=function(){return this.settings.isReverb},e.prototype.setReverb=function(e){this.settings.isReverb=e},e.prototype.getReverbVolume=function(){return this.settings.reverbVolume},e.prototype.setReverbVolume=function(e){this.settings.reverbVolume=e},e.prototype.isChorus=function(){return this.settings.isChorus},e.prototype.setChorus=function(e){this.settings.isChorus=e},e.prototype.getChorusVolume=function(){return this.settings.chorusVolume},e.prototype.setChorusVolume=function(e){this.settings.chorusVolume=e},e.prototype.isAndroid=function(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("android")&&-1==e.indexOf("windows")},e.prototype.getTime=function(e){var t=0,n=120,r=0,i=this;return this.tempoTrack.some(function(a){return e<a.timing?!0:(t+=60/n/i.settings.resolution*(a.timing-r),r=a.timing,void(n=a.value))}),t+=60/n/i.settings.resolution*(e-r)},e.prototype.getTiming=function(e){var t=0,n=120,r=0,i=this;return this.tempoTrack.some(function(a){return t+=60/n/i.settings.resolution*(a.timing-r),t>e?(t-=60/n/i.settings.resolution*(a.timing-r),r+=(e-t)/(60/n/i.settings.resolution),!0):(r=a.timing,void(n=a.value))}),r},e.prototype.parseSMF=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<8)+e[n];return t}function n(e){for(var t=0,n=0;t<e.length-1&&e[t]>=128;)4>t&&(n=(n<<7)+(e[t]-128)),t++;return n=(n<<7)+e[t],t++,[n,t]}if(77!=e[0]||84!=e[1]||104!=e[2]||100!=e[3])return"Not Sandard MIDI File.";var r=new Object,i=4,a=new Object;a.size=t(e.subarray(4,8)),a.format=e[9],a.trackcount=t(e.subarray(10,12)),a.timemanage=e[12],a.resolution=t(e.subarray(12,14)),i+=4+a.size;for(var s=new Array,o=new Array,u=new Array,c=-1,l=Number.MAX_SAFE_INTEGER,f=0,h=0;16>h;h++){var d=new Object;u.push(d),d.messages=[],d.notes=[]}var p=0;if(this.settings.isWebMIDI)var m=[];for(var g=0;g<a.trackcount;g++){if(77!=e[i]||84!=e[i+1]||114!=e[i+2]||107!=e[i+3])return"Irregular SMF.";i+=4;var v=(new Object,i+4+t(e.subarray(i,i+4)));i+=4;for(var y=0,b=1;v>i;){if(null!=b){var _=n(e.subarray(i,i+5)),w=_[0];y+=w,y>1e8&&(y=1e8),i+=_[1]}if(this.settings.isWebMIDI)var T=i;var S,x={timing:y,mes:[]};switch(Math.floor(e[i]/16)){case 8:case 9:case 10:case 11:case 14:b=e[i],x.mes.push(e[i],e[i+1],e[i+2]);var A=u[15&b].messages;for(S=A.length-1;S>=0;S--){var M=A[S];if(y>=M.timing)break}S++,A.splice(S,0,x),i+=3;break;case 12:case 13:b=e[i],x.mes.push(e[i],e[i+1]);var A=u[15&b].messages;for(S=A.length-1;S>=0;S--){var M=A[S];if(y>=M.timing)break}S++,A.splice(S,0,x),i+=2;break;case 15:switch(e[i]){case 240:case 247:var _=n(e.subarray(i+1,i+1+4));if(_[0]>=7&&127==e[i+2]&&127==e[i+3]&&4==e[i+4]&&1==e[i+5])for(var h=0;16>h;h++){x.mes.push(e[i],_[0]-1,e[i+2],e[i+3],e[i+4],e[i+5],e[i+6],e[i+7]);var A=u[h].messages;for(S=A.length-1;S>=0;S--){var M=A[S];if(y>=M.timing)break}S++,A.splice(S,0,x)}i+=1+_[1]+_[0];break;case 241:i+=2;break;case 242:i+=3;break;case 243:i+=2;break;case 246:case 248:case 250:case 251:case 252:case 254:i+=1;break;case 255:switch(e[i+1]){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 32:break;case 47:y+=-w;break;case 81:r.tempo=6e7/(65536*e[i+3]+256*e[i+4]+e[i+5]),s.push({timing:y,value:6e7/(65536*e[i+3]+256*e[i+4]+e[i+5])});break;case 84:break;case 88:o.push({timing:y,value:[e[i+3],Math.pow(2,e[i+4])]});break;case 89:case 127:}var _=n(e.subarray(i+2,i+2+4));i+=2+_[1]+_[0]}break;default:if(null==b)return"Irregular SMF.";i--,e[i]=b,b=null}if(this.settings.isWebMIDI&&null!=b){var k=e[T];if(240==k||247==k){if(this.settings.WebMIDIPortSysEx){var _=n(e.subarray(T+1,T+1+4)),E=T+1+_[1],P=E+_[0],B=new Uint8Array(1+_[0]);B[0]=k;for(var D=P-E,h=0;D>h;h++)B[h+1]=e[E+h];m.push({message:B,timing:y})}}else m.push({message:e.subarray(T,i),timing:y})}}y>p&&(p=y)}s.push({timing:p,value:120});for(var L=0;L<u.length;L++){for(var d=u[L],i=0,v=d.messages.length,I=2,C=0,N=64,O=127,R=100,F=0,z=0,j=0,G=127,U=127,W=127,V=127,q=null,Z=127,$=[];v>i;){var x=d.messages[i],y=x.timing,H=d.messages[i].mes;switch(Math.floor(H[0]/16)){case 8:var h=0;$.some(function(e){var t=d.notes[e];return t.pitch==H[1]&&null==t.stop?(t.stop=y,$.splice(h,1),y>f&&(f=y),!0):void h++});break;case 9:if(0!=H[2]){var K={start:y,stop:null,pitch:H[1],pitchBend:[{timing:y,value:C}],pan:[{timing:y,value:N}],expression:[{timing:y,value:O*(Z/127)}],velocity:H[2]/127*(R/127),modulation:[{timing:y,value:F}],reverb:[{timing:y,value:z}],chorus:[{timing:y,value:j}],instrument:q,channel:L};$.push(d.notes.length),d.notes.push(K),l>y&&(l=y)}else{var h=0;$.some(function(e){var t=d.notes[e];return t.pitch==H[1]&&null==t.stop?(t.stop=y,$.splice(h,1),y>f&&(f=y),!0):void h++})}break;case 10:break;case 11:switch(H[1]){case 1:F=H[2],$.forEach(function(e){var t=d.notes[e];t.modulation.push({timing:y,value:F})});break;case 6:0==W&&0==V&&(I=H[2],I>24&&(I=24));break;case 7:R=H[2];break;case 10:N=H[2],$.forEach(function(e){var t=d.notes[e];t.pan.push({timing:y,value:N})});break;case 11:O=H[2],$.forEach(function(e){var t=d.notes[e];t.expression.push({timing:y,value:O*(Z/127)})});break;case 91:z=H[2],$.forEach(function(e){var t=d.notes[e];t.reverb.push({timing:y,value:z})});break;case 93:j=H[2],$.forEach(function(e){var t=d.notes[e];t.chorus.push({timing:y,value:j})});break;case 98:G=H[2];break;case 99:U=H[2];break;case 100:W=H[2];break;case 101:V=H[2];break;case 111:-1==c&&(c=y)}break;case 12:q=H[1];break;case 13:break;case 14:C=(128*H[2]+H[1]-8192)/8192*I,$.forEach(function(e){var t=d.notes[e];t.pitchBend.push({timing:y,value:C})});break;case 15:switch(H[0]){case 240:case 247:if(H[1]>=6&&127==H[2]&&127==H[3]&&4==H[4]&&1==H[5]){var X=H[7];X>127&&(X=127),Z=X,$.forEach(function(e){var t=d.notes[e];t.expression.push({timing:y,value:O*(Z/127)})})}}break;default:return"Error parseSMF."}i++}delete d.messages}return r.header=a,r.tempoTrack=s,r.beatTrack=o,r.channels=u,r.songLength=p,r.cc111Time=c,r.firstNoteOnTiming=l,r.lastNoteOffTiming=f,this.settings.isWebMIDI&&(r.messages=m),r},e.prototype.stopAudioNode=function(e,t,n){try{t>0?e.stop(t):(e.stop(this.context.currentTime+.005),n.gain.cancelScheduledValues(this.context.currentTime),n.gain.linearRampToValueAtTime(0,this.context.currentTime+.005))}catch(r){n.gain.cancelScheduledValues(t),0>=t&&n.gain.linearRampToValueAtTime(0,this.context.currentTime+.005)}},e.prototype.pushFunc=function(e){(e.note||e.rootTimeout||this.trigger.isNoteTrigger)&&this.states.stopFuncs.push(e)},e.prototype.clearFunc=function(e,t){if("note"==e||"rootTimeout"==e||this.trigger.isNoteTrigger){var n=this;n.states.stopFuncs.some(function(r,i){return r[e]==t?(n.states.stopFuncs.splice(i,1),!0):void 0})}},e}();requireSimulator.setName("T2MediaLib");var T2MediaLib_BGMPlayer=function(e){this.id=e,this.playingState="stop",this.playingStatePending=null,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1,this.bgmPan=0,this.picoAudio=null,this.picoAudioSetDataBGMName=null,this.PICO_AUDIO_VOLUME_COEF=1};T2MediaLib_BGMPlayer.prototype.playBGM=function(e,t,n,r,i){if(!T2MediaLib.context)return null;this.stopBGM();var a=T2MediaLib.soundDataAry[e];if(null==a)return null;if(!a.isDecodeComplete()){var s=this,o={};return o.succ=function(){var a=s.playingStatePending;s._setPlayingState("stop",!0),"stop"!=a&&s.playingBGMName==e&&s.playBGM(e,t,n,r,i),"pause"==a&&s.pauseBGM()},o.err=function(){s._setPlayingState("stop",!0)},this.playingBGMName=e,this._setPlayingState("decoding",!0),T2MediaLib.decodeSound(e,o),this.playingBGMName=e,this._setPlayingState("play"),this}var u=a.decodedData;if(u instanceof AudioBuffer)this.playingBGM=T2MediaLib.playSE(e,this.bgmVolume,this.bgmPan,this.bgmTempo,n,t,r,i);else if(u instanceof Object){if(null==this.picoAudio&&(0==this.id&&(this.picoAudio=T2MediaLib.picoAudio),null==this.picoAudio&&(this.picoAudio=new PicoAudio(T2MediaLib.context,T2MediaLib.picoAudio))),e!=this.picoAudioSetDataBGMName?(this.picoAudio.setData(u),this.picoAudioSetDataBGMName=e):this.picoAudio.initStatus(),this.picoAudio.setLoop(t),this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*this.bgmVolume*T2MediaLib.bgmMasterVolume*T2MediaLib.masterVolume),n){var c=this.picoAudio.getTime(this.picoAudio.getTiming(Number.MAX_SAFE_INTEGER));n>c?n=c:0>n&&(n=0)}else n=0;this.picoAudio.setStartTime(n),this.picoAudio.play(),this.playingBGM=this.picoAudio}return this.playingBGMName=e,this.bgmPause=0,this._setPlayingState("play"),this},T2MediaLib_BGMPlayer.prototype.stopBGM=function(){var e=this.playingBGM;return e instanceof PicoAudio?this.picoAudio.stop():e instanceof AudioBufferSourceNode&&e.stop(0),this.playingBGM=null,this.playingBGMName=null,this._setPlayingState("stop"),this},T2MediaLib_BGMPlayer.prototype.pauseBGM=function(){var e=this.playingBGM;return e instanceof PicoAudio?0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseCurrentTime=e.context.currentTime,e.stop(),this.bgmPause=1):e instanceof AudioBufferSourceNode&&0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=T2MediaLib.getSELoopStartTime(e),this.bgmPauseLoopEnd=T2MediaLib.getSELoopEndTime(e),this.bgmPauseLoop=T2MediaLib.isSELoop(e),this.bgmPauseCurrentTime=e.context.currentTime,this.bgmPauseTempo=this.bgmTempo,e.stop(0),this.bgmPause=1),"stop"!=this.playingState&&this._setPlayingState("pause"),this},T2MediaLib_BGMPlayer.prototype.resumeBGM=function(){var e=this.playingBGM;return e instanceof PicoAudio?1===this.bgmPause&&(e.play(),this.bgmPause=0):e instanceof AudioBufferSourceNode&&1===this.bgmPause&&(e=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd)),this},T2MediaLib_BGMPlayer.prototype.onChangeBGMMasterVolume=function(){this.setBGMVolume(this.getBGMVolume())},T2MediaLib_BGMPlayer.prototype.getBGMVolume=function(){return this.bgmVolume},T2MediaLib_BGMPlayer.prototype.setBGMVolume=function(e){var t=this.playingBGM;return this.bgmVolume=e,t instanceof PicoAudio?this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*e*T2MediaLib.bgmMasterVolume*T2MediaLib.masterVolume):t instanceof AudioBufferSourceNode&&(t.gainNode.gain.value=e*T2MediaLib.bgmMasterVolume*T2MediaLib.masterVolume),this},T2MediaLib_BGMPlayer.prototype.getBGMTempo=function(){return this.bgmTempo},T2MediaLib_BGMPlayer.prototype.setBGMTempo=function(e){var t=this.playingBGM;return(0>=e||isNaN(e))&&(e=1),t instanceof AudioBufferSourceNode&&0===this.bgmPause&&(t.plusTime-=(T2MediaLib.context.currentTime-t.playStartTime)*(e-this.bgmTempo)),this.bgmTempo=e,T2MediaLib.setSERate(t,e),this},T2MediaLib_BGMPlayer.prototype.getBGMPan=function(){return this.bgmPan},T2MediaLib_BGMPlayer.prototype.setBGMPan=function(e){var t=this.playingBGM;return this.bgmPan=e,t instanceof AudioBufferSourceNode&&T2MediaLib.setSEPan(t,e),this},T2MediaLib_BGMPlayer.prototype.isBGMLoop=function(){var e=this.playingBGM;return e instanceof PicoAudio?this.picoAudio.isLoop():e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoop:T2MediaLib.isSELoop(e):null},T2MediaLib_BGMPlayer.prototype.setBGMLoop=function(e){var t=this.playingBGM;return t instanceof PicoAudio?this.picoAudio.setLoop(e):t instanceof AudioBufferSourceNode&&(1===this.bgmPause?this.bgmPauseLoop=e:T2MediaLib.setSELoop(t,e)),this},T2MediaLib_BGMPlayer.prototype.getBGMLoopStartTime=function(){var e=this.playingBGM;return e instanceof PicoAudio?0:e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopStart:T2MediaLib.getSELoopStartTime(e):null},T2MediaLib_BGMPlayer.prototype.setBGMLoopStartTime=function(e){var t=this.playingBGM;if(t instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return T2MediaLib.setSELoopStartTime(t,e);this.bgmPauseLoopStart=e}return this},T2MediaLib_BGMPlayer.prototype.getBGMLoopEndTime=function(){var e=this.playingBGM;return e instanceof PicoAudio?this.getBGMLength():e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopEnd:T2MediaLib.getSELoopEndTime(e):null},T2MediaLib_BGMPlayer.prototype.setBGMLoopEndTime=function(e){var t=this.playingBGM;if(t instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return T2MediaLib.setSELoopEndTime(t,e);this.bgmPauseLoopEnd=e}return this},T2MediaLib_BGMPlayer.prototype.getBGMCurrentTime=function(){var e=this.playingBGM;if(e instanceof PicoAudio){var t;return t=0===this.bgmPause?this.picoAudio.getTime(this.picoAudio.getTiming(this.picoAudio.context.currentTime-this.picoAudio.states.startTime)):this.bgmPauseTime}if(e instanceof AudioBufferSourceNode){var t,n,r,i,a,s,o;return 0===this.bgmPause?(r=T2MediaLib.context.currentTime,i=this.bgmTempo):(r=this.bgmPauseCurrentTime,i=this.bgmPauseTempo),n=(r-e.playStartTime)*i+e.plusTime,e.loop&&(e.loopEnd-e.loopStart>0?n<e.loopStart?(a=0,s=0,o=e.buffer.duration):(a=e.loopStart,s=e.loopStart,o=e.loopEnd-e.loopStart):(o=e.buffer.duration,a=0,s=0)),e.loop?t=(n-s)%o+a:(t=n,t>e.buffer.duration&&(t=e.buffer.duration)),t}return null},T2MediaLib_BGMPlayer.prototype.getBGMLength=function(){var e=this.playingBGM;return e instanceof PicoAudio?this.picoAudio.getTime(this.picoAudio.getTiming(Number.MAX_SAFE_INTEGER)):e instanceof AudioBufferSourceNode?e.buffer.duration:null},T2MediaLib_BGMPlayer.prototype.getPlayingBGMName=function(){return this.playingBGMName},T2MediaLib_BGMPlayer.prototype.setOnBGMEndListener=function(e){null==this.picoAudio&&this.picoAudio.setOnSongEndListener(e)},T2MediaLib_BGMPlayer.prototype.getPlayingState=function(){return this.playingState},T2MediaLib_BGMPlayer.prototype._setPlayingState=function(e,t){t||"decoding"!=this.playingState?(this.playingState=e,this.playingStatePending=null):this.playingStatePending=e};var T2MediaLib_SoundData=function(){this.state="none",this.errorID=null,this.url=null,this.fileData=null,this.decodedData=null,this.decodedSuccCallbacks=null,this.decodedErrCallbacks=null};T2MediaLib_SoundData.prototype.onLoad=function(e){this.state="loading",this.url=e},T2MediaLib_SoundData.prototype.onLoadComplete=function(e){this.state="loaded",this.fileData=e},T2MediaLib_SoundData.prototype.onDecode=function(){this.state="decoding"},T2MediaLib_SoundData.prototype.onDecodeComplete=function(e){this.state="decoded",this.decodedData=e},T2MediaLib_SoundData.prototype.onError=function(e){this.state="error",this.errorID=e},T2MediaLib_SoundData.prototype.isLoadComplete=function(){switch(this.state){case"loaded":case"decoding":case"decoded":return!0}return!1},T2MediaLib_SoundData.prototype.isDecoding=function(){return"decoding"==this.state},T2MediaLib_SoundData.prototype.isDecodeComplete=function(){return"decoded"==this.state},T2MediaLib_SoundData.prototype.removeDecodedData=function(){this.state="loaded",this.decodedData=null};var T2MediaLib={context:null,picoAudio:null,soundDataAry:[],bgmPlayerMax:16,bgmPlayerAry:[],masterVolume:1,seMasterVolume:1,bgmMasterVolume:1,playingAudio:null,audioVolume:1,audioTempo:1,audioDataAry:{data:[]},init:function(){if(!this.inited&&(this.inited=!0,!this.disabled&&(window.AudioContext?T2MediaLib.context=new AudioContext:window.webkitAudioContext?T2MediaLib.context=new webkitAudioContext:(T2MediaLib.context=null,console.log("Your browser does not support yet Web Audio API")),T2MediaLib.context)))for(var e=0;e<T2MediaLib.bgmPlayerMax;e++)T2MediaLib.bgmPlayerAry[e]=new T2MediaLib_BGMPlayer(e)},allClearSoundData:function(){var e=T2MediaLib.soundDataAry;for(var t in e)delete e[t]},clearSoundData:function(e){var t=T2MediaLib.soundDataAry;delete t[e]},allRemoveDecodedSoundData:function(){var e=T2MediaLib.soundDataAry;for(var t in e){var n=e[t];null!=n&&(n.isDecodeComplete()||n.isDecoding())&&n.removeDecodedData()}},removeDecodedSoundData:function(e){var t=T2MediaLib.soundDataAry[e];null!=t&&(t.isDecodeComplete()||t.isDecoding())&&t.removeDecodedData()},getMasterVolume:function(){return T2MediaLib.masterVolume},setMasterVolume:function(e){T2MediaLib.masterVolume=e;for(var t=0;t<T2MediaLib.bgmPlayerMax;t++){var n=T2MediaLib.bgmPlayerAry[t];n instanceof T2MediaLib_BGMPlayer&&n.onChangeBGMMasterVolume()}},createSoundFromArray:function(e,t,n){T2MediaLib.soundDataAry[e]=new T2MediaLib_SoundData;for(var r=T2MediaLib.context,i=null!=t&&null!=n?2:1,a=r.createBuffer(i,array.length,r.sampleRate),s=a.getChannelData(0),o=null!=n?a.getChannelData(1):null,u=0;u<array.length;u++)s[u]=t[u];if(o)for(var u=0;u<array.length;u++)o[u]=n[u];T2MediaLib.soundDataAry[e].onDecodeComplete(a)},loadSound:function(e,t,n){if(T2MediaLib.soundDataAry[e]=new T2MediaLib_SoundData,!T2MediaLib.context||T2MediaLib.disabled)return T2MediaLib.soundDataAry[e].onError("FUNC_DISABLED_ERROR"),null;(t.match(/\.(midi?)$/)||t.match(/^data:audio\/mid/))&&null==T2MediaLib.picoAudio&&(T2MediaLib.picoAudio=new PicoAudio(T2MediaLib.context)),"object"==typeof WebSite&&WebSite.mp3Disabled&&(t=t.replace(/\.(mp3|mp4|m4a)$/,".ogg"));var r=new XMLHttpRequest;r.onload=function(){if(200===r.status||0===r.status){var t=r.response;t instanceof ArrayBuffer?(T2MediaLib.soundDataAry[e].onLoadComplete(t),n&&n.succ&&n.succ(e)):(T2MediaLib.soundDataAry[e].onError("XHR_RESPONSE_ERROR"),n&&n.err&&n.err(e,T2MediaLib.soundDataAry[e].errorID))}else T2MediaLib.soundDataAry[e].onError("XHR_STATUS_ERROR"),n&&n.err&&n.err(e,T2MediaLib.soundDataAry[e].errorID)},r.onerror=function(t){console.log(t+""),T2MediaLib.soundDataAry[e].onError("XHR_ERROR"),n&&n.err&&n.err(e,T2MediaLib.soundDataAry[e].errorID)},T2MediaLib.soundDataAry[e].onLoad(t),t.match(/^data:/)&&Util&&Util.Base64_To_ArrayBuffer?(r={onload:r.onload},r.response=Util.Base64_To_ArrayBuffer(t.replace(/^data:audio\/[a-zA-Z0-9]+;base64,/i,"")),r.status=200,r.onload()):(r.open("GET",t,!0),r.responseType="arraybuffer",r.send(null))},decodeSound:function(e,t){var n=T2MediaLib.soundDataAry[e];if(null!=n&&!n.isDecodeComplete()&&(null==n.decodedSuccCallbacks&&(n.decodedSuccCallbacks=[]),null==n.decodedErrCallbacks&&(n.decodedErrCallbacks=[]),t&&t.succ&&n.decodedSuccCallbacks.push(t.succ),t&&t.err&&n.decodedErrCallbacks.push(t.err),!n.isDecoding())){n.onDecode();var r=n.fileData.slice(0);if(n.url.match(/\.(midi?)$/)||n.url.match(/^data:audio\/mid/)){null==T2MediaLib.picoAudio&&(T2MediaLib.picoAudio=new PicoAudio(T2MediaLib.context));var i=new Uint8Array(r),a=T2MediaLib.picoAudio.parseSMF(i);"string"==typeof a?(console.log("T2MediaLib: Error parseSMF()",a),T2MediaLib.soundDataAry[e].onError("DECODE_ERROR"),n.decodedErrCallbacks.forEach(function(t,n,r){console.log(t,n,r),t(e,T2MediaLib.soundDataAry[e].errorID)})):(T2MediaLib.soundDataAry[e].onDecodeComplete(a),n.decodedSuccCallbacks.forEach(function(t,n,r){console.log(t,n,r),t(e)}))}else{var s=function(t){T2MediaLib.soundDataAry[e].isDecoding()&&(T2MediaLib.soundDataAry[e].onDecodeComplete(t),n.decodedSuccCallbacks.forEach(function(t,n,r){console.log(t,n,r),t(e)}))},o=function(t){t instanceof Error?console.log("T2MediaLib: "+t.message,n.url):console.log("T2MediaLib: Error decodeAudioData()",n.url),T2MediaLib.soundDataAry[e].onError("DECODE_ERROR"),n.decodedSuccCallbacks.forEach(function(t,n,r){console.log(t,n,r),t(e,T2MediaLib.soundDataAry[e].errorID)})};T2MediaLib.context.decodeAudioData(r,s,o)}}},activate:function(){if(this.init(),!this.isActivated){this.isActivated=!0;for(var e=T2MediaLib.context,t=e.createBuffer(1,Math.floor(e.sampleRate/32),e.sampleRate),n=t.getChannelData(0),r=(Math.floor(e.sampleRate/860),0);r<n.length;r++)n[r]=0;var i=e.createBufferSource();i.buffer=t,i.connect(e.destination),i.noteOn?i.noteOn(0):i.start&&i.start(0)}},getSoundData:function(e){var t=T2MediaLib.soundDataAry[e];return t?t.decodedData:null},playSE:function(e,t,n,r,i,a,s,o,u,c){if(!T2MediaLib.context)return null;var l=T2MediaLib.soundDataAry[e];if(null==l)return null;if(!l.isDecodeComplete()){var f={};return f.succ=function(e){T2MediaLib.playSE(e,t,n,r,i,a,s,o,u,c)},f.err=function(){},T2MediaLib.decodeSound(e,f),null}var h=l.decodedData;if(!(h instanceof AudioBuffer))return null;null==t&&(t=1),null==n&&(n=0),r||(r=1),i?i>h.duration?i=h.duration:0>i&&(i=0):i=0,c||(c=h.duration-i),a||(a=!1),s?0>s?s=0:s>h.duration&&(s=h.duration):s=0,o?0>o?o=0:o>h.duration&&(o=h.duration):o=h.duration,u=u||0;var d=T2MediaLib.context.createBufferSource();T2MediaLib.context.createGain=T2MediaLib.context.createGain||T2MediaLib.context.createGainNode;var p=T2MediaLib.context.createGain(),m=T2MediaLib.context.createPanner();d.buffer=h,d.loop=a,d.loopStart=s,d.loopEnd=o,d.playbackRate.value=r,d.connect(p),p.connect(m),m.connect(T2MediaLib.context.destination),m.panningModel="equalpower",-1>n?n=-1:n>1&&(n=1);var g=90*n,v=Math.sin(g*(Math.PI/180)),y=-Math.cos(g*(Math.PI/180));(-1===n||1===n)&&(y=0),m.positionX?(m.positionX.value=v,m.positionY.value=0,m.positionZ.value=y):m.setPosition(v,0,y),p.gain.value=t*T2MediaLib.seMasterVolume*T2MediaLib.masterVolume;var b;return b=a&&o-s>0&&i>o?o:i,d.gainNode=p,d.volumeValue=t,d.panNode=m,d.panValue=n,d.playStartTime=T2MediaLib.context.currentTime+u,d.playOffset=b,d.plusTime=b,d.start=d.start||d.noteOn,d.stop=d.stop||d.noteOff,i?a?d.start(u,i,86400):d.start(u,i,c):d.start(u,0,c),d.onended=function(){d.onended=null},d},stopSE:function(e){return e instanceof AudioBufferSourceNode?(e.stop(0),e):null},getSEMasterVolume:function(){return T2MediaLib.seMasterVolume},setSEMasterVolume:function(e){T2MediaLib.seMasterVolume=e},getSEVolume:function(e){return e instanceof AudioBufferSourceNode?source.volumeValue:null},setSEVolume:function(e,t){return e instanceof AudioBufferSourceNode?(e.gainNode.gain.value=t*T2MediaLib.seMasterVolume*T2MediaLib.masterVolume,source.volumeValue=t,e):null},getSERate:function(e){return e instanceof AudioBufferSourceNode?e.playbackRate.value:null},setSERate:function(e,t){return e instanceof AudioBufferSourceNode?void(e.playbackRate.value=t):null},getSEPan:function(e){return e instanceof AudioBufferSourceNode?e.panValue:null},setSEPan:function(e,t){if(!(e instanceof AudioBufferSourceNode))return null;var n=e.panNode;-1>t?t=-1:t>1&&(t=1);var r=90*t,i=Math.sin(r*(Math.PI/180)),a=Math.cos(r*(Math.PI/180));
(-1===t||1===t)&&(a=0),n.positionX?(n.positionX.value=i,n.positionY.value=0,n.positionZ.value=a):n.setPosition(i,0,a),e.panValue=t},isSELoop:function(e){return e instanceof AudioBufferSourceNode?e.loop:null},setSELoop:function(e,t){return e instanceof AudioBufferSourceNode?void(e.loop=t):null},getSELoopStartTime:function(e){return e instanceof AudioBufferSourceNode?e.loopStart:null},setSELoopStartTime:function(e,t){return e instanceof AudioBufferSourceNode?void(e.loopStart=t):null},getSELoopEndTime:function(e){return e instanceof AudioBufferSourceNode?e.loopEnd:null},setSELoopEndTime:function(e,t){return e instanceof AudioBufferSourceNode?void(e.loopEnd=t):null},playBGM:function(e,t,n,r,i,a){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var s=T2MediaLib.bgmPlayerAry[e];return s instanceof T2MediaLib_BGMPlayer?s.playBGM(t,n,r,i,a):null},stopBGM:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.stopBGM():null},pauseBGM:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.pauseBGM():null},resumeBGM:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.resumeBGM():null},getBGMMasterVolume:function(){return T2MediaLib.bgmMasterVolume},setBGMMasterVolume:function(e){T2MediaLib.bgmMasterVolume=e;for(var t=0;t<T2MediaLib.bgmPlayerMax;t++){var n=T2MediaLib.bgmPlayerAry[t];n instanceof T2MediaLib_BGMPlayer&&n.onChangeBGMMasterVolume()}},getBGMVolume:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.getBGMVolume():null},setBGMVolume:function(e,t){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var n=T2MediaLib.bgmPlayerAry[e];return n instanceof T2MediaLib_BGMPlayer?n.setBGMVolume(t):null},getBGMTempo:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.getBGMTempo():null},setBGMTempo:function(e,t){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var n=T2MediaLib.bgmPlayerAry[e];return n instanceof T2MediaLib_BGMPlayer?n.setBGMTempo(t):null},getBGMPan:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.getBGMPan():null},setBGMPan:function(e,t){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var n=T2MediaLib.bgmPlayerAry[e];return n instanceof T2MediaLib_BGMPlayer?n.setBGMPan(t):null},isBGMLoop:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.isBGMLoop():null},setBGMLoop:function(e,t){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var n=T2MediaLib.bgmPlayerAry[e];return n instanceof T2MediaLib_BGMPlayer?n.setBGMLoop(t):null},getBGMLoopStartTime:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.getBGMLoopStartTime():null},setBGMLoopStartTime:function(e,t){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var n=T2MediaLib.bgmPlayerAry[e];return n instanceof T2MediaLib_BGMPlayer?n.setBGMLoopStartTime(t):null},getBGMLoopEndTime:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.getBGMLoopEndTime():null},setBGMLoopEndTime:function(e,t){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var n=T2MediaLib.bgmPlayerAry[e];return n instanceof T2MediaLib_BGMPlayer?n.setBGMLoopEndTime(t):null},getBGMCurrentTime:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.getBGMCurrentTime():null},getBGMLength:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.getBGMLength():null},getPlayingBGMName:function(e){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var t=T2MediaLib.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t.getPlayingBGMName():null},setOnBGMEndListener:function(e,t){if(0>e||T2MediaLib.bgmPlayerMax<=e)return null;var n=T2MediaLib.bgmPlayerAry[e];return n instanceof T2MediaLib_BGMPlayer?n.setOnBGMEndListener(t):null},getBGMPlayerMax:function(){return T2MediaLib.bgmPlayerMax},allStopBGM:function(){for(var e=0;e<T2MediaLib.bgmPlayerMax;e++)T2MediaLib.stopBGM(e)},allResetBGM:function(){for(var e=0;e<T2MediaLib.bgmPlayerMax;e++)T2MediaLib.stopBGM(e),T2MediaLib.setBGMVolume(e,1),T2MediaLib.setBGMTempo(e,1),T2MediaLib.setBGMPan(e,0);T2MediaLib.setMasterVolume(1),T2MediaLib.setSEMasterVolume(1),T2MediaLib.setBGMMasterVolume(1)},loadAudio:function(e,t){var n=new Audio(t);n.play(),T2MediaLib.audioDataAry.data[e]=null,n.addEventListener("loadstart",function(){if(!T2MediaLib.context)return null;var e=T2MediaLib.context.createMediaElementSource(n);e.connect(T2MediaLib.context.destination)},!1),n.addEventListener("canplay",function(){T2MediaLib.audioDataAry.data[e]=n},!1),n.load()},playAudio:function(e,t,n){var r=T2MediaLib.audioDataAry.data[e];return r?(n||(n=0),T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.pause(),T2MediaLib.playingAudio.currentTime=0),T2MediaLib.playingAudio=r,r.loop=t,r.volume=T2MediaLib.audioVolume,r.currentTime=n,r.play(),r):null},stopAudio:function(){var e=T2MediaLib.playingAudio;return e instanceof Audio?(e.pause(),e.currentTime=0,T2MediaLib.playingAudio=null,e):null},pauseAudio:function(){var e=T2MediaLib.playingAudio;return e?(e.pause(),e):null},resumeAudio:function(){var e=T2MediaLib.playingAudio;return e?(e.play(),e):null},setAudioVolume:function(e){T2MediaLib.audioVolume=e,T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.volume=e)},setAudioTempo:function(e){T2MediaLib.audioTempo=e,T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.playbackRate=e)},setAudioPosition:function(e){T2MediaLib.playingAudio instanceof Audio&&(T2MediaLib.playingAudio.currentTime=e)},getAudioData:function(e){return T2MediaLib.audioDataAry.data[e]},getAudioCurrentTime:function(){return T2MediaLib.playingAudio instanceof Audio?T2MediaLib.playingAudio.currentTime:null},getCurrentTime:function(){return T2MediaLib.context.currentTime},getAudioLength:function(){return T2MediaLib.playingAudio instanceof Audio?T2MediaLib.playingAudio.duration:null}};requireSimulator.setName("exceptionCatcher"),define([],function(){var e={};return e.f=function(t){if("function"==typeof t){if(t.isTrcf)return t;var n=function(){if(!e.handleException||e.enter)return t.apply(this,arguments);try{return e.enter=!0,t.apply(this,arguments)}catch(n){e.handleException(n)}finally{e.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof t){for(var r in t)t[r]=e.f(t[r]);return t}},e}),requireSimulator.setName("UI"),define(["Util","exceptionCatcher"],function(e,t){var n={},r=t.f;return n=function(){function t(){l.forEach(function(e){e()}),setTimeout(r(t),50)}function i(e){return e instanceof Array?a(e):"string"==typeof e?o(e):e}function a(e){var t=e[0],n=1,r=$("<"+t+">");for("object"!=typeof e[n]||e[n]instanceof Array||e[n]instanceof $||(s(r,e[n],t),n++);n<e.length;)r.append(i(e[n])),n++;return r}function s(t,i){function a(e,n){if(n)if("enterkey"==e)t.on("keypress",r(function(e){13==e.which&&n.apply(t,arguments)}));else if("realtimechange"==e){var a,s=!0;l.push(function(){var e;e="checkbox"==i.type?!!t.prop("checked"):t.val(),(s||a!=e)&&(n.apply(t,[e,a]),a=e),s=!1})}else t.on(e,r(n))}i.$var&&(f[i.$var]=t),i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(e){h.writeToModel(i.$edit,e,t)}),f[i.$edit.name]||(f[i.$edit.name]=t),h.push({jq:t,params:i}));for(var s in i)if("on"==s)for(var o in i.on)a(o,i.on[o]);else"css"==s&&null!=i[s]?t.css(i[s]):e.startsWith(s,"$")||null==i[s]||t.attr(s,i[s])}function o(e){return $("<span>").text(e)}for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];var l=[],f={},h=[],d=i(u);return d.$edits=h,d.$vars=f,h.load=function(e){h.model=e,h.forEach(function(e){h.writeToJq(e.params.$edit,e.jq)}),h.validator.on.validate.call(h.validator,h.model)},h.writeToJq=function(e,t){var n=h.model;if(n){for(var r=e.name,i=r.split("."),a=0;a<i.length;a++)n=n[i[a]];n=e.type.toVal(n),"checkbox"==t.attr("type")?t.prop("checked",!!n):t.val(n)}},h.validator={errors:{},show:function(){if(f.validationMessage){f.validationMessage.empty();for(var e in this.errors)f.validationMessage.append(n("div",this.errors[e].mesg))}if(f.OKButton){var t=!0;for(var e in this.errors)t=!1;f.OKButton.attr("disabled",!t)}},on:{validate:function(){}},addError:function(e,t,n){this.errors[e]={mesg:t,jq:n},this.show()},removeError:function(e){delete this.errors[e],this.show()},allOK:function(){for(var e in this.errors)delete this.errors[e];this.show()},isValid:function(){var e=!0;for(var t in this.errors)e=!1;return e}},h.writeToModel=function(e,t,n){var r=h.model;if(r){var i=e.name;try{t=e.type.fromVal(t)}catch(a){return void h.validator.addError(i,a,n)}h.validator.removeError(i);for(var s=i.split("."),o=0;o<s.length;o++)o==s.length-1?h.on.writeToModel(i,t)||(r[s[o]]=t):r=r[s[o]];h.validator.on.validate.call(h.validator,h.model)}},h.on={},h.on.writeToModel=function(){},l.length>0&&setTimeout(r(t),50),d},n.types={String:{toVal:function(e){return e},fromVal:function(e){return e}},Number:{toVal:function(e){return e+""},fromVal:function(e){return parseFloat(e)}}},n}),requireSimulator.setName("UIDiag"),define(["UI"],function(e){var t={};return t.confirm=function(t){function n(e){return function(){i.resolve(e),r.dialog("close"),r.remove()}}var r=e("div",{title:""},["div",t],["button",{on:{click:n(!0)}},"OK"],["button",{on:{click:n(!1)}},""]).dialog({width:"auto",close:n(!1)}),i=$.Deferred();return i.promise()},t.alert=function(t){function n(e){return function(){i.resolve(e),r.dialog("close"),r.remove()}}var r=e("div",{title:""},["div",t],["button",{on:{click:n(!0)}},"OK"]).dialog({width:"auto",close:n(!1)}),i=$.Deferred();return i.promise()},t.prompt=function(t,n){function r(){var e=a.$vars.val.val();s.resolve(e),a.dialog("close"),a.remove()}function i(){a.dialog("close"),a.remove(),s.resolve()}var a=e("div",{title:""},["div",t],["input",{on:{enterkey:r},$var:"val",value:n}],["br"],["button",{on:{click:r}},"OK"],["button",{on:{click:i}},""]).dialog({width:"auto",close:function(){a.dialog("close"),s.resolve()}});setTimeout(function(){a.$vars.val.focus()},10);var s=$.Deferred();return s.promise()},"undefined"!=typeof window&&(window.UIDiag=t),t}),requireSimulator.setName("runtime"),requirejs(["ImageList","PicoAudio","T2MediaLib","Tonyu","UIDiag"],function(){}),requireSimulator.setName("LSFS"),define(["FS"],function(e){return e.LSFS}),requireSimulator.setName("NativeFS"),define(["FS"],function(e){return e.NativeFS}),requireSimulator.setName("runScript2"),requirejs(["FS","compiledTonyuProject","Shell","runtime","WebSite","LSFS","Tonyu","NativeFS"],function(e,t,n,r,i,a,s){$(function(){function r(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("iphone")&&-1==e.indexOf("ipad")&&-1==e.indexOf("ipod")||window==window.parent?0:40}function o(){var e=r();l=$(window).width(),f=$(window).height(),h.attr({width:l-e,height:f-e})}function u(){s.currentProject=s.globals.$currentProject=_;var e=_.getOptions();_.runScriptMode=!0,_.run(e.run.bootClass)}SplashScreen={hide:function(){$("#splash").hide()},show:function(){},progress:function(e){$("#splash").text(e)}};var c=r(),l=$(window).width(),f=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var h=$("<canvas>").attr({width:l-c,height:f-c}).appendTo("body");$(window).resize(o);var d;if(i.isNW){var p=location.href.replace(/^file:\/\//,"");p.match(/^\/[a-z]:/i)&&(p=p.replace(/^\//,"")),p=e.get(p),p.isDir()||(p=p.up()),d=p.rel("data/")}else{var m=location.href.replace(/\?.*/,"").split(/\//),g=m.pop()||"runscript",v=m.pop()||"nobody",p=e.get(i.tonyuHome),y=e.get("/ram/");e.mount(y.path(),a.ramDisk()),d=y;var b=p.rel(v+"/"+g+"/");y.rel("files/").link(b)}loadFiles(d),n.cd(d),i.compiledKernel="js/kernel.js","BA"===i.serverType&&(i.compiledKernel=window.runtimePath+"lib/tonyu/kernel.js");var _=t("user","js/concat.js",d);u()})}),requireSimulator.setName();