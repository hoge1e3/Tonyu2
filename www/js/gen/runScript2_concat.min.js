!function(){var t={};return t.def=function(e,n,r){var i=t.getModuleInfo(t.curName);i.type=r,t.setReqs(i,e),i.func=function(){return n.apply(this,t.getObjs(e))},t.loadIfAvailable(i)},define=function(){var e=Array.prototype.slice.call(arguments);"string"==typeof e[0]&&(t.curName=e.shift());var n=e.shift(),r=e.shift();t.def(n,r,"define")},define.amd={jQuery:!0},requirejs=function(e,n){t.def(e,n,"require")},t.setReqs=function(e,n){n.forEach(function(n){var r=t.getModuleInfo(n);r.loaded||(e.reqs[n]=r,r.revReqs[e.name]=e)})},t.getModuleInfo=function(e){var n=t.modules;return n[e]||(n[e]={name:e,reqs:{},revReqs:{}}),n[e]},t.doLoad=function(e){var n=t.getModuleInfo(e);if(n.loaded)return n.obj;n.loaded=!0;var r=null;if(n.func)r=n.func();else{var i=e.split(/\./);r=function(){return this}(),i.forEach(function(t){r&&(r=r[t])}),null==r&&console.log("Warning: No obj for "+e)}if("define"==n.type&&null==r)throw"No obj for "+e;n.obj=r;for(var s in n.revReqs)t.notifyLoaded(n.revReqs[s],n.name);return r},t.notifyLoaded=function(e,n){delete e.reqs[n],t.loadIfAvailable(e)},t.loadIfAvailable=function(e){for(var n in e.reqs)return;t.doLoad(e.name)},t.getObjs=function(e){var n=[];return e.forEach(function(e){var r=t.doLoad(e);n.push(r)}),n},t.modules={},t.setName=function(e){t.curName&&(t.getModuleInfo(t.curName).func||t.doLoad(t.curName)),e&&(t.curName=e)},requireSimulator=t,t}(),requireSimulator.setName("FS"),define([],function(){var t,e,n={},i="REQJS_",s=0;n.def=function(t,e,r){var i=n.getModuleInfo(t);"function"==typeof e?(r=e,e=n.reqsFromFunc(r),n.setReqs(i,e),i.func=function(){var t={exports:{}},e=r(n.doLoad,t,t.exports);return e||t.exports}):(n.setReqs(i,e),i.func=function(){return r.apply(this,n.getObjs(e))}),n.loadIfAvailable(i)},t=function(t,e,r){n.def(t,e,r)},t.amd={},e=function(t,e){n.def(i+s++,t,e)},n.setReqs=function(t,e){e.forEach(function(e){var r=n.getModuleInfo(e);r.loaded||(t.reqs[e]=r,r.revReqs[t.name]=t)})},n.getModuleInfo=function(t){var e=n.modules;return e[t]=e[t]||{name:t,reqs:{},revReqs:{}}},n.doLoad=function(t){var e=n.getModuleInfo(t);if(e.loaded)return e.obj;e.loaded=!0;var r=e.func();null!=r||t.match(/^REQJS_/)||console.log("Warning: No obj for "+t),e.obj=r;for(var i in e.revReqs)n.notifyLoaded(e.revReqs[i],e.name);return r},n.notifyLoaded=function(t,e){delete t.reqs[e],n.loadIfAvailable(t)},n.loadIfAvailable=function(t){for(var e in t.reqs)return;n.doLoad(t.name)},n.getObjs=function(t){var e=[];return t.forEach(function(t){var r=n.doLoad(t);e.push(r)}),e},n.reqsFromFunc=function(t){var e=t+"",n=[];return e.replace(/require\s*\(\s*["']([^"']+)["']\s*\)/g,function(t,e){n.push(e)}),n},n.modules={},t("extend",[],function(){return function(t,e){for(var n in e)t[n]=e[n]}}),t("assert",[],function(){function t(e){if(e instanceof Array){var n=[];return e.forEach(function(e){n=n.concat(t(e))}),n}return[e]}var e,n=function(e){this.failMesg=t(e||"Assertion failed: ")};n.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var n=e(arguments),r=n.shift();if(n=t(n),n=this.failMesg.concat(r).concat(n).concat(["mode",this._mode]),console.log.apply(console,n),this.isDefensive())return r;if(this.isBool())return!1;throw new Error(n.join(" "))},subAssertion:function(){var r=e(arguments);return r=t(r),new n(this.failMesg.concat(r))},assert:function(t,e){return t?t:this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):this.isBool()?!0:t},ne:function(t,e){return t===e?this.fail(t,"===",e):this.isBool()?!0:t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):this.isBool()?!0:t},is:function(t,e){var n=e,r=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),this.isBool()?!0:t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var i=this,s=0;s<n.length;s++){var o=i.subAssertion("failed at ",t,"[",s,"]: ");null==n[s]&&console.log("WOW!7",r[s],n[s]),o.is(r[s],n[s])}return this.isBool()?!0:t}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),this.isBool()?!0:t;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),this.isBool()?!0:t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),this.isBool()?!0:t;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),this.isBool()?!0:t;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),this.isBool()?!0:t;if(n&&"object"==typeof n){for(var a in n){var o=this.subAssertion("failed at ",t,".",a,":");o.is(t[a],n[a])}return this.isBool()?!0:t}if("string"==typeof n){var u=this._regedType[n];return u?this.is(t,u):this.isBool()?!0:t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&i(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},e=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var r=new n,i=function(){try{return r.assert.apply(r,arguments)}catch(t){throw new Error(t.message)}};return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){i[t]=function(){try{return r[t].apply(r,arguments)}catch(e){throw console.log(e.stack),new Error(e.message)}}}),i.fail=r.fail.bind(r),i.MODE_STRICT=r.MODE_STRICT,i.MODE_DEFENSIVE=r.MODE_DEFENSIVE,i.MODE_BOOL=r.MODE_BOOL,i.f=function(t){return{_assert_func:t}},i.opt=function(t){return i.f(function(e){return null==e||e instanceof t})},i.and=function(){var t=e(arguments);return i(t instanceof Array),i.f(function(e){for(var n=this,r=0;r<t.length;r++)n.is(e,t[r])})},i}),t("PathUtil",["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}function n(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n}var r,i=/^([a-zA-Z]):/,s=/^([a-z]+):\/\/\/?([^\/]+)\//,o=t.f(function(t){this.is(t,String),this.assert(r.isPath(t),[t," is not a path"])}),a=t.f(function(t){this.is(t,String),this.assert(r.isAbsolutePath(t),[t," is not a absolute path"])}),u=t.f(function(t){this.is(t,String),this.assert(!r.isAbsolutePath(t),[t," is not a relative path"])}),c=t.f(function(t){this.is(t,o),this.assert(r.isDir(t),[t," is not a directory path"])}),l=t.and(c,a),f=t.f(function(t){this.is(t,o),this.assert(!r.isDir(t),[t," is not a file path"])}),h="/";return r={Path:o,Absolute:a,Relative:u,Dir:c,File:f,AbsDir:l,SEP:h,endsWith:e,startsWith:n,hasDriveLetter:function(t){return i.exec(t)},isURL:function(t){var e=s.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:h+t.substring(e[0].length)}},isPath:function(){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&!r.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),r.isPath(e)&&(r.startsWith(e,h)||r.hasDriveLetter(e)||r.isURL(e))},isDir:function(n){return n=r.fixSep(n),t.is(arguments,[o]),e(n,h)},hasBackslashSep:function(t){return t.indexOf("\\")>=0},fixSep:function(e,n){return n=n||"/",t.is(arguments,[String]),t.is(e.replace(/[\\\/]/g,n),o)},directorify:function(e){return r.isDir(e)?e:t.is(e+h,c)},filify:function(e){return r.isDir(e)?t.is(e.substring(0,e.length-1),f):e},splitPath:function(e){t.is(arguments,[o]);var n;if(n=this.isURL(e)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}e=e.replace(/\/+/g,h);var i=e.split(h);return""==i[i.length-1]&&(i[i.length-2]+=h,i.pop()),i},name:function(e){return t.is(arguments,[String]),r.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var n=r.name(e),i=/\.[a-zA-Z0-9]+$/.exec(n);return i?i[0]:null},truncExt:function(e,n){t.is(e,String);var i=r.name(e);return n=n||r.ext(e),t.is(n,String),i.substring(0,i.length-n.length)},truncSEP:function(e){return t.is(arguments,[o]),r.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(n,i){return t.is(arguments,[String,String]),e(r.name(n),i)},parent:function(e){return t.is(arguments,[String]),r.up(e)},rel:function(e,n){if(""==n)return e;t.is(arguments,[l,u]);var i=r.splitPath(n),s=e;s=s.replace(/\/$/,"");var o=r;return i.forEach(function(t){".."==t||"../"==t?s=o.up(s):(s=s.replace(/\/$/,""),s+=h+("."==t||"./"==t?"":t))}),s},relPath:function(e,n){return t.is(arguments,[a,a]),e.substring(0,n.length)!=n?"../"+r.relPath(e,this.up(n)):e.substring(n.length)},up:function(t){if(t==h)return null;var e=r.splitPath(t);return e.pop(),e.join(h)+h}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(t){var e=r[t];r[t]=function(){var t=!1,n=Array.prototype.slice.call(arguments).map(function(e){return r.hasBackslashSep(e)?(t=!0,r.fixSep(e)):e}),i=e.apply(r,n);return t?r.fixSep(i,"\\"):i}}),r.isAbsolute=r.isAbsolutePath,r.isRelative=r.isRelativePath,"object"==typeof window&&(window.PathUtil=r),r}),t("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".mp3":"audio/mp3",".ogg":"audio/ogg",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu"}}),t("DeferredUtil",[],function(){var t,e=function(t){this.res=t};return t={isNativePromise:function(t){return t&&"function"==typeof t.then&&"function"!=typeof t.promise&&"function"==typeof t.catch},isJQPromise:function(t){return t&&"function"==typeof t.then&&"function"==typeof t.promise&&"function"==typeof t.fail},isPromise:function(t){return t&&"function"==typeof t.then&&("function"==typeof t.promise||"function"==typeof t.catch)},all:function(e){return t.promise(function(n,r){var i=[],s=e.length;e.forEach(function(e,o){t.resolve(e).then(function(t){i[o]=t,s--,0===s&&n(i)},r)})})},resolve:function(e){return t.config.useJQ&&t.isJQPromise(e)?e:!t.config.useJQ&&t.isNativePromise(e)?e:t.promise(function(n,r){t.isPromise(e)?e.then(n,r):n(e)})},assertResolved:function(t){var e,n;if(t.then(function(t){e=t,n=!0}),!n)throw console.log(r),new Error("Promise not resolved");return e},ensureDefer:function(e){return t.promise(function(n,r){var i;t.resolve(e).then(function(t){i?n(t):setTimeout(function(){n(t)},0)}).fail(function(t){i?r(t):setTimeout(function(){r(t)},0)}),i=!0})},directPromise:function(e){return t.timeout(e,0)},then:function(e){return t.directPromise().then(e)},timeout:function(e,n){return t.promise(function(t){setTimeout(function(){t(n)},e||0)})},funcPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;try{e(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(r){n.reject(r)}return n.promise()}if(t.external.Promise)return new t.external.Promise(function(t,n){try{e(t,n)}catch(r){n(r)}});throw new Error("promise is not found")},reject:function(e){if(t.config.useJQ){var n=new $.Deferred;return n.reject(e),n.promise()}return new JQ.external.Promise(function(t,n){n(e)})},throwPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(e)},0),n.promise()}return new JQ.external.Promise(function(t,n){n(e)})},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(n){return console.log(n,n.stack),t.throwPromise(n)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(r){return r>=e.length?t.brk():t.resolve(n(e[r],r)).then(function(){return r+1})},0);var r=[];for(var i in e)r.push({k:i,v:e[i]});return t.each(r,function(t){return n(t.k,t.v)})},loop:function(n,r){try{for(var i;;){if(r instanceof e)return t.when1(r.res);var s=!0,o=!1,a=n(r),u=t.resolve(a).then(function(i){return r=i,s=!1,r instanceof e?r.res:o?t.loop(n,r):void 0}).fail(function(t){s=!1,i=t});if(i)throw i;if(o=!0,s)return u}}catch(c){return t.reject(c)}},brk:function(t){return new e(t)},tryLoop:function(e,n){return t.loop(t.tr(e),n)},tryEach:function(e,n){return t.loop(e,t.tr(n))},documentReady:function(){return t.callbackToPromise(function(t){$(t)})},requirejs:function(e){if(!window.requirejs)throw new Error("requirejs is not loaded");return t.callbackToPromise(function(t){window.requirejs(e,t)})}},t.NOP=function(t){return t},t.begin=t.try=t.tr=t.throwF,t.promise=t.callbackToPromise=t.funcPromise,t.when1=t.resolve,t.config={},window.$&&window.$.Deferred&&(t.config.useJQ=!0),t.external={Promise:window.Promise},window.DeferredUtil||(window.DeferredUtil=t),t}),t("FS2",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(t,e,n,r,i){function s(t){throw new Error(t+" is STUB!")}var o=function(){},a={};return o.addFSType=function(t,e){a[t]=e},o.availFSTypes=function(){return a},t(o.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},isReadOnly:function(){s("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(t){return r(this.getRootFS()!==this),this.getRootFS().resolveFS(t)},mounted:function(t,e){this.rootFS=t,this.mountPoint=e},inMyFS:function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},getRootFS:function(){return r(this.rootFS,"rootFS is not set")},getReturnTypes:function(){s("")},getContent:function(){s("getContent")},getContentAsync:function(){return this.supportsSync()||s("getContentAsync"),i.resolve(this.getContent.apply(this,arguments))},setContent:function(){s("")},setContentAsync:function(t,e,n){var r=this;return r.supportsSync()||s("setContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.setContent(t,e,n))})},appendContent:function(){s("")},appendContentAsync:function(t,e,n){var r=this;return r.supportsSync()||s("appendContentAsync"),i.resolve(e).then(function(e){return i.resolve(r.appendContent(t,e,n))})},getMetaInfo:function(){s("")},setMetaInfo:function(){s("")},mkdir:function(){s("mkdir")},touch:function(){s("touch")},exists:function(){s("exists")},opendir:function(){s("opendir")},opendirAsync:function(){return this.supportsSync()||s("opendirAsync"),i.resolve(this.opendir.apply(this,arguments))},cp:function(t,n,i){r.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),i=i||{};var s=this.isDir(t),o=this.getRootFS().resolveFS(n),a=o.isDir(n);if(s||a)throw new Error("only file to file supports");if(this.supportsSync()&&o.supportsSync()){var u=this.getContent(t),c=o.setContent(n,u);return i.a&&o.setMetaInfo(n,this.getMetaInfo(t)),c}return o.setContentAsync(n,this.getContentAsync(t)).then(function(e){return i.a?o.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(){s("")},link:function(t,e){throw new Error("ln "+e+" "+t+" : This FS not support link.")},getURL:function(){s("")}}),o.delegateMethods=function(t,n){for(var i in n)!function(i){r.ne(i,"inMyFS"),t[i]=function(){var t=arguments[0];r.is(t,e.Absolute);var s=this.resolveFS(t);return s!==this?(console.log("Invoked for other fs",this.mountPoint,s.mountPoint),s[i].apply(s,arguments)):n[i].apply(this,arguments)}}(i)},o.delegateMethods(o.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},getContentType:function(t,r){var i=(e.ext(t)+"").toLowerCase();return n[i]||(r||{}).def||"text/plain"},getBlob:function(t,e){var n=this.getContent(t);return e=e||{},e.blobType=e.blobType||Blob,e.binType=e.binType||ArrayBuffer,n.hasPlainText()?new e.blobType([n.toPlainText()],this.getContentType(t)):new e.blobType([n.toBin(e.binType)],this.getContentType(t))},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t){return e.isDir(t)},find:function(t,n){r.is(arguments,[e.Absolute]);var i=this.opendir(t,n),s=this,o=[t];return i.forEach(function(r){var i=e.rel(t,r);if(e.isDir(i)){var a=s.resolveFS(i);o=o.concat(a.find(i,n))}else o.push(i)}),o},resolveLink:function(t){r.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){r(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var s=e.rel(i,e.relPath(t,n));return r(s!=t,"np==path=="+s),r.is(this.getRootFS().resolveFS(s).resolveLink(s),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(){return null},opendirEx:function(t){r.is(t,e.AbsDir);var n=this.opendir(t),i=this,s={};return n.forEach(function(n){var r=e.rel(t,n);s[n]=i.getMetaInfo(r)}),s},getDirTree:function(t,n){n=n||{};var i=n.dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],r.is(n.excludes,Array),n.base||(n.base=t),r.is(t,e.AbsDir);var s=this.opendirEx(t,n);if("no-recursive"==n.style)return s;var o=this;for(var a in s){var u=s[a],c=e.rel(t,a),l=e.relPath(c,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(l)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(c)>=0)continue}if(o.isDir(c))switch(n.style){case"flat-absolute":case"flat-relative":o.getDirTree(c,n);break;case"hierarchical":n.dest={},i[a]=o.getDirTree(c,n)}else switch(n.style){case"flat-absolute":i[c]=u;break;case"flat-relative":i[l]=u;break;case"hierarchical":i[a]=u}}return i}}),o}),t("Util",[],function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:e(i[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function r(t,e){return t.substring(0,e.length)===e}function i(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){var e=r.apply(t,arguments);return e})}(n);return e}function s(t,e){for(var n in e||{})t[n]=e[n];return t}return{getQueryString:t,endsWith:n,startsWith:r,privatize:i,extend:s}}),t("Content",["assert","Util"],function(t,e){var n=function(){},r=e.extend;n.plainText=function(t,e){var r=new n;return r.contentType=e||"text/plain",r.plain=t,r},n.url=function(t){var e=new n;return e.url=t,e},n.buffer2ArrayBuffer=function(e){if(n.isBuffer(e)){var r=new Uint8Array(e),i=r.buffer;if(i instanceof ArrayBuffer)return i;var s=Array.prototype.slice.call(r);return t(new Uint8Array(s).buffer,"n2a: buf is not set")}return t(e,"n2a: a is not set")},n.arrayBuffer2Buffer=function(e){if(e instanceof ArrayBuffer){var n=new Buffer(new Uint8Array(e));return n}return t(e,"a2n: a is not set")},n.bin=function(e,r){t(r,"contentType should be set");var i=new n;if(e&&n.isBuffer(e.buffer))i.arrayBuffer=e.buffer;else if(n.isNodeBuffer(e))i.nodeBuffer=e;else{if(!(e instanceof ArrayBuffer))throw new Error(e+" is not a bin");i.arrayBuffer=e}return i.contentType=r,i};var i=n.prototype;i.toBin=function(t){if(t=t||(n.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return t===Buffer?this.nodeBuffer:this.arrayBuffer=n.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return t===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=n.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var e=new o(this.url,t);return this.setBuffer(e.buffer)}if(null!=this.plain)return this.setBuffer(n.str2utf8bytes(this.plain,t));throw new Error("No data")},i.setBuffer=function(e){return t(e,"b is not set"),n.isNodeBuffer(e)?this.nodeBuffer=e:this.arrayBuffer=e},i.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},i.toNodeBuffer=function(){return this.toBin(Buffer)},i.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=n.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var t=new o(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=t.url}throw new Error("No data")},i.toPlainText=function(){if(null!=this.plain)return this.plain;if(this.url&&!this.hasBin()){var t=new o(this.url,ArrayBuffer);this.arrayBuffer=t.buffer}if(this.hasBin())return this.plain=n.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},i.hasURL=function(){return this.url},i.hasPlainText=function(){return null!=this.plain},i.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},i.hasNodeBuffer=function(){return this.nodeBuffer},i.hasArrayBuffer=function(){return this.arrayBuffer},n.Base64_To_ArrayBuffer=function(t,e){function r(e){throw console.log(e),console.log(t,h),new Error(e)}var i=e||ArrayBuffer;t=t.replace(/[\n=]/g,"");var s=new Object;s[65]=0,s[66]=1,s[67]=2,s[68]=3,s[69]=4,s[70]=5,s[71]=6,s[72]=7,s[73]=8,s[74]=9,s[75]=10,s[76]=11,s[77]=12,s[78]=13,s[79]=14,s[80]=15,s[81]=16,s[82]=17,s[83]=18,s[84]=19,s[85]=20,s[86]=21,s[87]=22,s[88]=23,s[89]=24,s[90]=25,s[97]=26,s[98]=27,s[99]=28,s[100]=29,s[101]=30,s[102]=31,s[103]=32,s[104]=33,s[105]=34,s[106]=35,s[107]=36,s[108]=37,s[109]=38,s[110]=39,s[111]=40,s[112]=41,s[113]=42,s[114]=43,s[115]=44,s[116]=45,s[117]=46,s[118]=47,s[119]=48,s[120]=49,s[121]=50,s[122]=51,s[48]=52,s[49]=53,s[50]=54,s[51]=55,s[52]=56,s[53]=57,s[54]=58,s[55]=59,s[56]=60,s[57]=61,s[43]=62,s[47]=63;var o,a=t.length,u=0,c=0;if(!a)return new i(0);o=Math.floor(a/4*3),"="==t.charAt(a-1)&&(o-=1),"="==t.charAt(a-2)&&(o-=1);for(var l=new i(o),f=n.isNodeBuffer(l)?l:new Uint8Array(l),h=0,d=0;o>d&&(c=s[t.charCodeAt(h)],void 0===c&&r("Invalid letter: "+t.charCodeAt(h)),u=c<<2,h++,c=s[t.charCodeAt(h)],void 0===c&&r("Invalid letter: "+t.charCodeAt(h)),f[d]=u|c>>4&3,u=(15&c)<<4,h++,d++,!(d>=o))&&(c=s[t.charCodeAt(h)],void 0===c&&r("Invalid letter: "+t.charCodeAt(h)),f[d]=u|c>>2&15,u=(3&c)<<6,h++,d++,!(d>=o));)c=s[t.charCodeAt(h)],void 0===c&&r("Invalid letter: "+t.charCodeAt(h)),f[d]=u|c,h++,d++;return l},n.Base64_From_ArrayBuffer=function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,s=0,o=0,a=0;i>a&&(o=r[a],n+=e[o>>2],s=(3&o)<<4,a++,!(a>=i))&&(o=r[a],n+=e[s|o>>4],s=(15&o)<<2,a++,!(a>=i));)o=r[a],n+=e[s|o>>6],n+=e[63&o],a++;var u=i%3;return u&&(n+=e[s]),1==u?n+="==":2==u&&(n+="="),n},n.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},n.isNodeBuffer=function(t){return n.hasNodeBuffer()&&t instanceof Buffer},n.isBuffer=function(t){return t instanceof ArrayBuffer||n.isNodeBuffer(t)},n.utf8bytes2str=function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(r){throw console.log(e.join("")),r}},n.str2utf8bytes=function(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],s=0;s<n.length;s++){var o=r.exec(n.substring(s));o?(i.push(parseInt("0x"+o[1])),s+=o[0].length-1):i.push(n.charCodeAt(s))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer};var s=n.hasNodeBuffer()?Buffer:ArrayBuffer,o=function(e,r){"string"==typeof e?(this.url=e,this.binType=r||s,this.dataURL2bin(e)):e&&n.isBuffer(e.buffer)?(this.buffer=e.buffer,t.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):n.isBuffer(e)?(this.buffer=e,t.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),t.fail("Invalid args: ",arguments))};return n.DataURL=o,r(o.prototype,{bin2dataURL:function(e,r){t(n.isBuffer(e)),t.is(r,String);var i=this.dataHeader(r),s=n.Base64_From_ArrayBuffer(e);return t.is(s,String),this.url=i+s},dataURL2bin:function(e){t.is(arguments,[String]);var r=/^data:([^;]+);base64,/i,i=r.exec(e);return t(i,["malformed dataURL:",e]),this.contentType=i[1],this.buffer=n.Base64_To_ArrayBuffer(e.substring(i[0].length),this.binType),t.is(this.buffer,this.binType)},dataHeader:function(e){return t.is(arguments,[String]),"data:"+e+";base64,"},toString:function(){return t.is(this.url,String)}}),n}),t("NativeFS",["FS2","assert","PathUtil","extend","MIMETypes","Content"],function(t,e,n,r,i,s){var o="object"==typeof process;if(!o)return function(){throw new Error("This system not support native FS")};var a=e,u=require("fs"),c=function(t){t&&(e.is(t,n.AbsDir),this.rootPoint=t)},l=n.hasDriveLetter(process.cwd());c.available=!0;var f=n.SEP,h=c.prototype=new t;return h.toNativePath=function(t){return this.rootPoint?(e.is(t,n.Absolute),e(this.inMyFS(t),t+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(t,this.mountPoint||n.SEP))):t},h.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var e=new Buffer(new Uint8Array(t));return e}return t},t.addFSType("NativeFS",function(t,e){return new c(e.r)}),c.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},c.prototype.inMyFS=function(t){return this.mountPoint?n.startsWith(t,this.mountPoint):!(!!l^!!n.hasDriveLetter(t))},t.delegateMethods(c.prototype,{getReturnTypes:function(){return a.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,r){r=r||{},e.is(t,n.Absolute);var i=this.toNativePath(t);return this.assertExist(t),this.isText(t)?s.plainText(u.readFileSync(i,{encoding:"utf8"})):s.bin(u.readFileSync(i),this.getContentType(t))},setContent:function(t,r){e.is(arguments,[n.Absolute,s]);var i=n.up(t);i&&this.getRootFS().resolveFS(i).mkdir(i);var o=this.toNativePath(t);r.hasBin()||!r.hasPlainText()?u.writeFileSync(o,r.toNodeBuffer()):u.writeFileSync(o,r.toPlainText())},appendContent:function(t,r){e.is(arguments,[n.Absolute,s]);var i=n.up(t);i&&this.getRootFS().resolveFS(i).mkdir(i);var o=this.toNativePath(t);r.hasBin()||!r.hasPlainText()?u.appendFileSync(o,r.toNodeBuffer()):u.appendFileSync(o,r.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(){},isReadOnly:function(){return!1},stat:function(t){e.is(t,n.Absolute);var r=this.toNativePath(t);return u.statSync(r)},mkdir:function(t){if(a.is(arguments,[n.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var e=n.up(t);e&&this.getRootFS().resolveFS(e).mkdir(e);var r=this.toNativePath(t);return u.mkdirSync(r),this.assertExist(r)},opendir:function(t,e){a.is(arguments,[String]),e=e||{};var r=this.toNativePath(t),i=n.truncSEP(r),s=u.readdirSync(r);e.nosep||(s=s.map(function(t){var e=u.statSync(i+f+t),n=e.isDirectory()?f:"";return t+n}));var o=[];return a.is(o.concat(s),Array)},rm:function(t,e){a.is(arguments,[n.Absolute]),e=e||{},this.assertExist(t);var r=this.toNativePath(t);return this.isDir(t)?u.rmdirSync(r):u.unlinkSync(r)},exists:function(t){var e=this.toNativePath(t);return u.existsSync(e)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():n.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&u.utimesSync(t,Date.now()/1e3,Date.now()/1e3)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")}}),c}),t("LSFS",["FS2","PathUtil","extend","assert","Util","Content"],function(t,e,n,r,i,s){function o(){return(new Date).getTime()}var a=function(t,e){r(t," new LSFS fail: no storage"),this.storage=t,this.options=e||{},this.options.useDirCache&&(this.dirCache={})},u=e.isDir.bind(e),c=e.up.bind(e),l=e.endsWith.bind(e),f=(e.Path,e.Absolute),h=e.SEP;return a.ramDisk=function(t){var n={};return n[e.SEP]="{}",t=t||{},"useDirCache"in t||(t.useDirCache=!0),new a(n,t)},t.addFSType("localStorage",function(t,e){return new a(localStorage,e)}),t.addFSType("ram",function(t,e){return a.ramDisk(e)}),a.now=o,a.prototype=new t,a.prototype.resolveKey=function(t){return r.is(t,e.Absolute),this.mountPoint?e.SEP+e.relPath(t,this.mountPoint):t},a.prototype.getItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},a.prototype.setItem=function(t,n){r.is(t,e.Absolute);var i=this.resolveKey(t);r(i.indexOf("..")<0),r(e.startsWith(i,e.SEP)),this.storage[i]=n},a.prototype.removeItem=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},a.prototype.itemExists=function(t){r.is(t,e.Absolute);var n=this.resolveKey(t);return r(this.storage,"No storage"),n in this.storage},a.prototype.getDirInfo=function(t){if(r.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");if(l(t,h)||(t+=h),r(this.inMyFS(t)),this.dirCache&&this.dirCache[t])return this.dirCache[t];var n={};try{var i=this.getItem(t);i&&(n=JSON.parse(i))}catch(s){console.log("dinfo err : ",t,i)}return this.dirCache&&(this.dirCache[t]=n),n},a.prototype.putDirInfo=function(t,n,i){if(r.is(arguments,[e.AbsDir,Object]),!u(t))throw new Error("Not a directory : "+t);r(this.inMyFS(t)),this.dirCache&&(this.dirCache[t]=n),this.setItem(t,JSON.stringify(n));var s=c(t);if(null!=s&&this.inMyFS(s)){var o=this.getDirInfo(s);this._touch(o,s,e.name(t),i)}},a.prototype._touch=function(t,n,i,s){r.is(arguments,[Object,String,String]),r(this.inMyFS(n)),t[i]||(t[i]={},s&&(t[i].trashed=!0)),s||delete t[i].trashed,t[i].lastUpdate=o(),this.getRootFS().notifyChanged(e.rel(n,i),t[i]),this.putDirInfo(n,t,s)},a.prototype.removeEntry=function(t,e,n){r.is(arguments,[Object,String,String]),t[n]&&(t[n]={lastUpdate:o(),trashed:!0},this.putDirInfo(e,t,!0))},a.prototype.removeEntryWithoutTrash=function(t,e,n){r.is(arguments,[Object,String,String]),t[n]&&(delete t[n],this.putDirInfo(e,t,!0))},a.prototype.isRAM=function(){return this.storage!==localStorage},a.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},t.delegateMethods(a.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t){r.is(arguments,[f]),this.assertExist(t);var e;return e=this.isText(t)?s.plainText(this.getItem(t)):s.url(this.getItem(t))},setContent:function(t,e){r.is(arguments,[f,s]),this.assertWriteable(t),this.isText(t)?this.setItem(t,e.toPlainText()):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t){if(this.assertExist(t,{includeTrashed:!0}),r.is(arguments,[f]),t==e.SEP)return{};var n=r(e.up(t));if(!this.inMyFS(n))return{};var i=e.name(t);r.is(n,e.AbsDir);var s=this.getDirInfo(n);return r(s[i])},setMetaInfo:function(t,n){r.is(arguments,[String,Object]),this.assertWriteable(t);
var i=r(e.up(t));if(this.inMyFS(i)){var s=this.getDirInfo(i),o=e.name(t);s[o]=n,this.putDirInfo(i,s,s[o].trashed)}},mkdir:function(t){r.is(arguments,[f]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){r.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),i=[];for(var s in n)r(n[s]),(!n[s].trashed||e.includeTrashed)&&i.push(s);return r.is(i,Array)},rm:function(t,n){r.is(arguments,[f]),n=n||{},this.assertWriteable(t);var i=e.up(t);if(null==i||!this.inMyFS(i))throw new Error(t+": cannot remove. It is root of this FS.");if(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t)){var s=this.opendir(t);s.length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)}else this.removeItem(t);var o=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(o,i,e.name(t)):this.removeEntry(o,i,e.name(t))},exists:function(t,n){r.is(arguments,[f]),n=n||{};var i=e.name(t),s=e.up(t);if(null==s||!this.inMyFS(s))return!0;var o=this.getDirInfo(s),a=o[i];return a&&a.trashed&&this.itemExists(t)&&this.isDir(t),!a&&this.itemExists(t),a&&!a.trashed&&!a.link&&!this.itemExists(t),a&&!n.includeTrashed&&(a=!a.trashed),!!a},link:function(t,n){r.is(arguments,[e.Absolute,e.Absolute]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var i={};i.link=n,i.lastUpdate=o(),this.setMetaInfo(t,i),r(this.exists(t)),r(this.isLink(t))},isLink:function(t){if(r.is(arguments,[e.Absolute]),!this.exists(t))return null;var n=r(this.getMetaInfo(t));return n.link},touch:function(t){r.is(arguments,[f]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?(this.dirCache&&(this.dirCache[t]={}),this.setItem(t,"{}")):this.setItem(t,""));var n=c(t);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,e.name(t),!1)}else r(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(t){return this.getContent(t).toURL()},opendirEx:function(t,n){r.is(t,e.AbsDir),n=n||{};var i={},s=this.getDirInfo(t);if(n.includeTrashed)return s;for(var o in s)s[o].trashed||(i[o]=s[o]);return i}}),a}),$.ajaxTransport("+binary",function(t,e,n){return window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob))?{send:function(e,n){var r=new XMLHttpRequest,i=t.url,s=t.type,o=t.async||!0,a=t.responseType||"blob",u=t.data||null,c=t.username||null,l=t.password||null;r.addEventListener("load",function(){var e={};e[t.dataType]=r.response,n(r.status,r.statusText,e,r.getAllResponseHeaders())}),r.open(s,i,o,c,l);for(var f in e)r.setRequestHeader(f,e[f]);r.responseType=a,r.send(u)},abort:function(){n.abort()}}:void 0}),t("jquery.binarytransport",function(){}),t("WebFS",["FS2","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(t,e,n,r,i){var s=function(){},o=s.prototype=new t;return t.addFSType("web",function(){return new s}),o.fstype=function(){return"Web"},o.supportsSync=function(){return!1},o.inMyFS=function(t){return i.isURL(t)},t.delegateMethods(o,{exists:function(){return!0},getContentAsync:function(t){var e=this;return n.promise(function(n,i){$.get(t,function(i){var s=new FileReader;s.addEventListener("loadend",function(){n(r.bin(s.result,e.getContentType(t)))}),s.readAsArrayBuffer(i)},"binary").fail(i)})},getURL:function(t){return t}}),s}),t("Env",["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),n=n.replace(/^[a-z][a-z]+:\//,function(t){return t+"/"}),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n});var o=o||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,n=e.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in n,i=function(n){var r=e.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},s=t.webkitRequestFileSystem,o=t.requestFileSystem||s||t.mozRequestFileSystem,a=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},u=0,c=function(e){var n=function(){"string"==typeof e?(t.URL||t.webkitURL||t).revokeObjectURL(e):e.remove()};t.chrome?n():setTimeout(n,10)},l=function(t,e,n){e=[].concat(e);for(var r=e.length;r--;){var i=t["on"+e[r]];if("function"==typeof i)try{i.call(t,n||t)}catch(s){a(s)}}},f=function(e,a){var f,h,d,p=this,m=e.type,g=!1,v=function(){l(p,["writestart","progress","write","writeend"])},y=function(){(g||!f)&&(f=(t.URL||t.webkitURL||t).createObjectURL(e)),h?h.location.href=f:void 0==t.open(f,"_blank")&&"undefined"!=typeof safari&&(t.location.href=f),p.readyState=p.DONE,v(),c(f)},b=function(t){return function(){return p.readyState!==p.DONE?t.apply(this,arguments):void 0}},_={create:!0,exclusive:!1};p.readyState=p.INIT,a||(a="download"),r?(f=(t.URL||t.webkitURL||t).createObjectURL(e),n.href=f,n.download=a,i(n),p.readyState=p.DONE,v(),c(f)):(t.chrome&&m&&"application/octet-stream"!==m&&(d=e.slice||e.webkitSlice,e=d.call(e,0,e.size,"application/octet-stream"),g=!0),s&&"download"!==a&&(a+=".download"),("application/octet-stream"===m||s)&&(h=t),o?(u+=e.size,o(t.TEMPORARY,u,b(function(t){t.root.getDirectory("saved",_,b(function(t){var n=function(){t.getFile(a,_,b(function(t){t.createWriter(b(function(n){n.onwriteend=function(e){h.location.href=t.toURL(),p.readyState=p.DONE,l(p,"writeend",e),c(t)},n.onerror=function(){var t=n.error;t.code!==t.ABORT_ERR&&y()},["writestart","progress","write","abort"].forEach(function(t){n["on"+t]=p["on"+t]}),n.write(e),p.abort=function(){n.abort(),p.readyState=p.DONE},p.readyState=p.WRITING}),y)}),y)};t.getFile(a,{create:!1},b(function(t){t.remove(),n()}),b(function(t){t.code===t.NOT_FOUND_ERR?n():y()}))}),y)}),y)):y())},h=f.prototype;return h.abort=function(){this.readyState=this.DONE,l(this,"abort")},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(t,e){return new f(t,e)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=o:"undefined"!=typeof t&&null!==t&&null!=t.amd&&t("FileSaver.min",[],function(){return o}),t("SFile",["extend","assert","PathUtil","Util","Content","FS2","FileSaver.min","DeferredUtil"],function(t,e,n,r,i,s,a,u){var c=function(t,r){e.is(r,n.Absolute),this._path=r,this.rootFS=t,this.fs=t.resolveFS(r),this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return c.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},c.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},getPolicy:function(){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(t,i){var s;if(i=i||{},c.is(t))s=t;else{e.is(t,n.Absolute);var o,a=i.policy||this.policy;if(a&&(o=a.topDir)&&(o.path&&(o=o.path()),!n.startsWith(t,o)))throw new Error(t+": cannot access. Restricted to "+o);s=new c(this.rootFS,t),s.policy=a}return s.policy?r.privatize(s):s},contains:function(t){return e(c.is(t),t+" shoud be a SFile object."),this.isDir()?n.startsWith(t.path(),this.path()):!1},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var r=t.path?t.path():t;return n.relPath(this.path(),e.is(r,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,t))},sibling:function(t){return this.up().rel(t)},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var t=this.metaInfo();return t?t.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.act.fs.getMetaInfo(this.act.path,t)},setMetaInfo:function(t,e){return this.act.fs.setMetaInfo(this.act.path,t,e)},getDirTree:function(t){return this.act.fs.getDirTree(this.act.path,t)},assertExists:function(){e(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(t){var e=Array.prototype.slice.call(arguments);if("function"==typeof e[0]){var n=e.shift();return u.resolve(this.exists.apply(this,e)).then(n)}t=t||{};var r=this.fs.exists(this.path(),t);return r||t.noFollowLink?r:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(t){var e=this;if(t=t||{},this.isLink())return u.resolve(this.fs.rm(this.path(),t));var n;return n=this.isDir()&&(t.recursive||t.r)?this.each(function(e){return e.rm(t)}):u.resolve(),n.then(function(){return e.act.fs.rm(e.act.path,t)})},removeWithoutTrash:function(t){t=t||{},t.noTrash=!0,this.rm(t)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(t){return"function"==typeof t?this.getText(t):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(t){if(e.is(t,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());return u.resolve(this.isText()?this.act.fs.setContent(this.act.path,i.plainText(t)):this.act.fs.setContent(this.act.path,i.url(t)))},appendText:function(t){if(e.is(t,String),this.isText())return this.act.fs.appendContent(this.act.path,i.plainText(t));throw new Error("append only for text file")},getContent:function(t){return"function"==typeof t?this.act.fs.getContentAsync(this.act.path).then(t):this.act.fs.getContent(this.act.path)},setContent:function(t){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,t)},getText:function(t){if("function"==typeof t){var e=this;return this.getContent(function(t){return e.isText()?t.toPlainText():t.toURL()}).then(t)}return this.isText()?this.act.fs.getContent(this.act.path).toPlainText():this.act.fs.getContent(this.act.path).toURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(){return this.act.fs.getContentType(this.act.path)},bytes:function(t){return i.isBuffer(t)?this.setBytes(t):this.getBytes()},setBytes:function(t){return this.act.fs.setContent(this.act.path,i.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.act.fs.getContent(this.act.path).toBin(t.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(){return this.text().replace(/\r/g,"").split("\n")},obj:function(){var t=this;if(0==arguments.length){var n=t.text();return n?JSON.parse(n):null}t.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,n){e(t&&t.isSFile(),t+" is not a file");var r=this,n=n||{},i=r.isDir(),s=t.isDir();if(!i&&s&&(t=t.rel(r.name()),e(!t.isDir(),t+" is a directory."),s=!1),!i||s){if(i||s)return e(i&&s,"Both src and dst should be dir"),r.each(function(e){t.rel(e.name()).copyFrom(e,n)});n.echo&&n.echo(r+" -> "+t);var o=this.act.fs.cp(this.act.path,t.getResolvedLinkPath(),n);return n.a&&t.setMetaInfo(r.getMetaInfo()),u.resolve(o)}this.err("Cannot move dir to file")},moveFrom:function(t,e){return this.copyFrom(t,e).then(function(){return t.rm({recursive:!0})})},moveTo:function(t,e){return t.moveFrom(this,e)},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){var n=this.assertDir();return n.listFilesAsync(e).then(function(e){return u.each(e,t)})},eachrev:function(t,e){var n=this.assertDir();return n.listFilesAsync(e).then(function(e){return u.each(e.reverse(),t)})},recursive:function(t,e){var n=this.assertDir();return n.each(function(e){return e.isDir()?e.recursive(t):t(e)},e)},listFilesAsync:function(t){e(null==t||"object"==typeof t);var n,r=this.assertDir(),i=this.path();return t=r.convertOptions(t),n||(n=t.order),this.act.fs.opendirAsync(this.act.path,t).then(function(e){for(var s=[],o=0;o<e.length;o++){var a=e[o];t.excludes[i+a]||s.push(r.rel(a))}return"function"==typeof n&&s.sort&&s.sort(n),s})},listFiles:function(t){var e=Array.prototype.slice.call(arguments);return u.assertResolved(this.listFilesAsync.apply(this,e))},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir();if(!t)return this.act.fs.opendir(this.act.path,t);var r=n.listFiles(t);return r.map(function(t){return t.name()})},convertOptions:function(t){var i=r.extend({},t),s=(this.assertDir(),this.path());if(i.excludes||(i.excludes={}),i.excludes instanceof Array){var o={};i.excludes.forEach(function(t){n.startsWith(t,"/")?o[t]=1:o[s+t]=1}),i.excludes=o}return e.is(i,{excludes:{}})},mkdir:function(){return this.touch()},link:function(t,e){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,t.path(),e)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(t){return this.getFS().getRootFS().addObserver(this.path(),t)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use 'zip' instead.");o(this.getBlob(),this.name())}},Object.defineProperty(c.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),e.is(this._act,{fs:s,path:n.Absolute}),this._act)}}),c}),t("RootFS",["assert","FS2","PathUtil","SFile"],function(t,e,n,r){var i=function(n){t.is(n,e),this.mount(null,n)},s=i.prototype,o={err:function(t,e){throw new Error(t+": "+e)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(e){t.is(arguments,[n.AbsDir]);var r=this.fstab();console.log(r);for(var i=0;i<r.length;i++)if(r[i].mountPoint==e)return r.splice(i,1),!0;return!1},availFSTypes:function(){return e.availFSTypes()},mount:function(n,r,i){if("string"==typeof r){var s=t(e.availFSTypes()[r],"fstype "+r+" is undefined.");r=s(n,i||{})}t.is(r,e),r.mounted(this,n),this.fstab().unshift(r)},resolveFS:function(r){t.is(r,n.Absolute);var i;return this.fstab().forEach(function(t){i||t.inMyFS(r)&&(i=t)}),i||this.err(r,"Cannot resolve"),t.is(i,e)},get:function(e){return t.is(e,n.Absolute),new r(this.resolveFS(e),e)},addObserver:function(){this.observers=this.observers||[];var e,n;if(2==arguments.length)e=arguments[0],n=arguments[1];else{if(1!=arguments.length)throw new Error("Invalid argument spec");e="",n=arguments[0]}t.is(e,String),t.is(n,Function);var r=this.observers,i={path:e,handler:n,remove:function(){var t=r.indexOf(this);r.splice(t,1)}};return this.observers.push(i),i},notifyChanged:function(t,e){this.observers&&this.observers.forEach(function(r){n.startsWith(t,r.path)&&r.handler(t,e)})},getRootFS:function(){return this}};for(var a in o)s[a]=o[a];return i}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof t&&t.amd)t("jszip",[],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.JSZip=e()}}(function(){return function t(e,n,r){function i(o,a){if(!n[o]){if(!e[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e,n){"use strict";var r=t("./utils"),i=t("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(t){for(var e,n,i,o,a,u,c,l=[],f=0,h=t.length,d=h,p="string"!==r.getTypeOf(t);f<t.length;)d=h-f,p?(e=t[f++],n=h>f?t[f++]:0,i=h>f?t[f++]:0):(e=t.charCodeAt(f++),n=h>f?t.charCodeAt(f++):0,i=h>f?t.charCodeAt(f++):0),o=e>>2,a=(3&e)<<4|n>>4,u=d>1?(15&n)<<2|i>>6:64,c=d>2?63&i:64,l.push(s.charAt(o)+s.charAt(a)+s.charAt(u)+s.charAt(c));return l.join("")},n.decode=function(t){var e,n,r,o,a,u,c,l=0,f=0,h="data:";if(t.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");var d=3*t.length/4;if(t.charAt(t.length-1)===s.charAt(64)&&d--,t.charAt(t.length-2)===s.charAt(64)&&d--,d%1!==0)throw new Error("Invalid base64 input, bad content length.");var p;for(p=i.uint8array?new Uint8Array(0|d):new Array(0|d);l<t.length;)o=s.indexOf(t.charAt(l++)),a=s.indexOf(t.charAt(l++)),u=s.indexOf(t.charAt(l++)),c=s.indexOf(t.charAt(l++)),e=o<<2|a>>4,n=(15&a)<<4|u>>2,r=(3&u)<<6|c,p[f++]=e,64!==u&&(p[f++]=n),64!==c&&(p[f++]=r);return p}},{"./support":30,"./utils":32}],2:[function(t,e){"use strict";function n(t,e,n,r,i){this.compressedSize=t,this.uncompressedSize=e,this.crc32=n,this.compression=r,this.compressedContent=i}var r=t("./external"),i=t("./stream/DataWorker"),s=t("./stream/DataLengthProbe"),o=t("./stream/Crc32Probe"),s=t("./stream/DataLengthProbe");n.prototype={getContentWorker:function(){var t=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},n.createWorkerFrom=function(t,e,n){return t.pipe(new o).pipe(new s("uncompressedSize")).pipe(e.compressWorker(n)).pipe(new s("compressedSize")).withStreamInfo("compression",e)},e.exports=n},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,n){"use strict";var r=t("./stream/GenericWorker");n.STORE={magic:"\x00\x00",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e){"use strict";function n(){for(var t,e=[],n=0;256>n;n++){t=n;for(var r=0;8>r;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}function r(t,e,n,r){var i=o,s=r+n;t=-1^t;for(var a=r;s>a;a++)t=t>>>8^i[255&(t^e[a])];return-1^t}function i(t,e,n,r){var i=o,s=r+n;t=-1^t;for(var a=r;s>a;a++)t=t>>>8^i[255&(t^e.charCodeAt(a))];return-1^t}var s=t("./utils"),o=n();e.exports=function(t,e){if("undefined"==typeof t||!t.length)return 0;var n="string"!==s.getTypeOf(t);return n?r(0|e,t,t.length,0):i(0|e,t,t.length,0)}},{"./utils":32}],5:[function(t,e,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,e){var n=null;n="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:n}},{lie:58}],7:[function(t,e,n){"use strict";function r(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,s=t("pako"),o=t("./utils"),a=t("./stream/GenericWorker"),u=i?"uint8array":"array";n.magic="\b\x00",o.inherits(r,a),r.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(u,t.data),!1)},r.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},r.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},r.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},n.compressWorker=function(t){return new r("Deflate",t)},n.uncompressWorker=function(){return new r("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(t,e){"use strict";function n(t,e,n,r){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var r=t("../utils"),i=t("../stream/GenericWorker"),s=t("../utf8"),o=t("../crc32"),a=t("../signature"),u=function(t,e){var n,r="";for(n=0;e>n;n++)r+=String.fromCharCode(255&t),t>>>=8;return r},c=function(t,e){var n=t;return t||(n=e?16893:33204),(65535&n)<<16},l=function(t){return 63&(t||0)},f=function(t,e,n,i,f,h){var d,p,m=t.file,g=t.compression,v=h!==s.utf8encode,y=r.transformTo("string",h(m.name)),b=r.transformTo("string",s.utf8encode(m.name)),_=m.comment,w=r.transformTo("string",h(_)),S=r.transformTo("string",s.utf8encode(_)),A=b.length!==m.name.length,x=S.length!==_.length,T="",k="",E="",B=m.dir,P=m.date,D={crc32:0,compressedSize:0,uncompressedSize:0};(!e||n)&&(D.crc32=t.crc32,D.compressedSize=t.compressedSize,D.uncompressedSize=t.uncompressedSize);var I=0;e&&(I|=8),v||!A&&!x||(I|=2048);var M=0,C=0;B&&(M|=16),"UNIX"===f?(C=798,M|=c(m.unixPermissions,B)):(C=20,M|=l(m.dosPermissions,B)),d=P.getUTCHours(),d<<=6,d|=P.getUTCMinutes(),d<<=5,d|=P.getUTCSeconds()/2,p=P.getUTCFullYear()-1980,p<<=4,p|=P.getUTCMonth()+1,p<<=5,p|=P.getUTCDate(),A&&(k=u(1,1)+u(o(y),4)+b,T+="up"+u(k.length,2)+k),x&&(E=u(1,1)+u(o(w),4)+S,T+="uc"+u(E.length,2)+E);var N="";N+="\n\x00",N+=u(I,2),N+=g.magic,N+=u(d,2),N+=u(p,2),N+=u(D.crc32,4),N+=u(D.compressedSize,4),N+=u(D.uncompressedSize,4),N+=u(y.length,2),N+=u(T.length,2);var O=a.LOCAL_FILE_HEADER+N+y+T,R=a.CENTRAL_FILE_HEADER+u(C,2)+N+u(w.length,2)+"\x00\x00\x00\x00"+u(M,4)+u(i,4)+y+T+w;return{fileRecord:O,dirRecord:R}},h=function(t,e,n,i,s){var o="",c=r.transformTo("string",s(i));return o=a.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+u(t,2)+u(t,2)+u(e,4)+u(n,4)+u(c.length,2)+c},d=function(t){var e="";return e=a.DATA_DESCRIPTOR+u(t.crc32,4)+u(t.compressedSize,4)+u(t.uncompressedSize,4)};r.inherits(n,i),n.prototype.push=function(t){var e=t.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,i.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:n?(e+100*(n-r-1))/n:100}}))},n.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var n=f(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},n.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,n=f(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),e)this.push({data:d(t),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},n.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var n=this.bytesWritten-t,r=h(this.dirRecords.length,n,t,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},n.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},n.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},n.prototype.resume=function(){return i.prototype.resume.call(this)?!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0):!1},n.prototype.error=function(t){var e=this._sources;if(!i.prototype.error.call(this,t))return!1;for(var n=0;n<e.length;n++)try{e[n].error(t)}catch(t){}return!0},n.prototype.lock=function(){i.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=n},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,n){"use strict";var r=t("../compressions"),i=t("./ZipFileWorker"),s=function(t,e){var n=t||e,i=r[n];if(!i)throw new Error(n+" is not a valid compression method !");return i};n.generateWorker=function(t,e,n){var r=new i(e.streamFiles,n,e.platform,e.encodeFileName),o=0;try{t.forEach(function(t,n){o++;var i=s(n.options.compression,e.compression),a=n.options.compressionOptions||e.compressionOptions||{},u=n.dir,c=n.date;n._compressWorker(i,a).withStreamInfo("file",{name:t,dir:u,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(r)}),r.entriesCount=o}catch(a){r.error(a)}return r}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new n;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}n.prototype=t("./object"),n.prototype.loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.1.5",n.loadAsync=function(t,e){return(new n).loadAsync(t,e)},n.external=t("./external"),e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e){"use strict";function n(t){return new i.Promise(function(e,n){var r=t.decompressed.getContentWorker().pipe(new a);r.on("error",function(t){n(t)}).on("end",function(){r.streamInfo.crc32!==t.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}var r=t("./utils"),i=t("./external"),s=t("./utf8"),r=t("./utils"),o=t("./zipEntries"),a=t("./stream/Crc32Probe"),u=t("./nodejsUtils");e.exports=function(t,e){var a=this;return e=r.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),u.isNode&&u.isStream(t)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var n=new o(e);return n.load(t),n}).then(function(t){var r=[i.Promise.resolve(t)],s=t.files;if(e.checkCRC32)for(var o=0;o<s.length;o++)r.push(n(s[o]));return i.Promise.all(r)}).then(function(t){for(var n=t.shift(),r=n.files,i=0;i<r.length;i++){var s=r[i];a.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:e.createFolders})}return n.zipComment.length&&(a.comment=n.zipComment),a})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e){"use strict";function n(t,e){i.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}var r=t("../utils"),i=t("../stream/GenericWorker");r.inherits(n,i),n.prototype._bindStream=function(t){var e=this;this._stream=t,t.pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},n.prototype.pause=function(){return i.prototype.pause.call(this)?(this._stream.pause(),!0):!1},n.prototype.resume=function(){return i.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1},e.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e){"use strict";function n(t,e,n){r.call(this,e),this._helper=t;var i=this;t.on("data",function(t,e){i.push(t)||i._helper.pause(),n&&n(e)}).on("error",function(t){i.emit("error",t)}).on("end",function(){i.push(null)})}var r=t("readable-stream").Readable,i=t("../utils");i.inherits(n,r),n.prototype._read=function(){this._helper.resume()},e.exports=n},{"../utils":32,"readable-stream":16}],14:[function(t,e){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){return new Buffer(t,e)},allocBuffer:function(t){return Buffer.alloc?Buffer.alloc(t):new Buffer(t)},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e){"use strict";function n(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var r=t("./utf8"),i=t("./utils"),s=t("./stream/GenericWorker"),o=t("./stream/StreamHelper"),a=t("./defaults"),u=t("./compressedObject"),c=t("./zipObject"),l=t("./generate"),f=t("./nodejsUtils"),h=t("./nodejs/NodejsStreamInputAdapter"),d=function(t,e,n){var r,o=i.getTypeOf(e),l=i.extend(n||{},a);l.date=l.date||new Date,null!==l.compression&&(l.compression=l.compression.toUpperCase()),"string"==typeof l.unixPermissions&&(l.unixPermissions=parseInt(l.unixPermissions,8)),l.unixPermissions&&16384&l.unixPermissions&&(l.dir=!0),l.dosPermissions&&16&l.dosPermissions&&(l.dir=!0),l.dir&&(t=m(t)),l.createFolders&&(r=p(t))&&g.call(this,r,!0);var d="string"===o&&l.binary===!1&&l.base64===!1;n&&"undefined"!=typeof n.binary||(l.binary=!d);var v=e instanceof u&&0===e.uncompressedSize;(v||l.dir||!e||0===e.length)&&(l.base64=!1,l.binary=!0,e="",l.compression="STORE",o="string");var y=null;y=e instanceof u||e instanceof s?e:f.isNode&&f.isStream(e)?new h(t,e):i.prepareContent(t,e,l.binary,l.optimizedBinaryString,l.base64);var b=new c(t,y,l);this.files[t]=b},p=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},m=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},g=function(t,e){return e="undefined"!=typeof e?e:a.createFolders,t=m(t),this.files[t]||d.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]},v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,n,r;for(e in this.files)this.files.hasOwnProperty(e)&&(r=this.files[e],n=e.slice(this.root.length,e.length),n&&e.slice(0,this.root.length)===this.root&&t(n,r))},filter:function(t){var e=[];return this.forEach(function(n,r){t(n,r)&&e.push(r)}),e},file:function(t,e,r){if(1===arguments.length){if(n(t)){var i=t;return this.filter(function(t,e){return!e.dir&&i.test(t)})}var s=this.files[this.root+t];return s&&!s.dir?s:null}return t=this.root+t,d.call(this,t,e,r),this},folder:function(t){if(!t)return this;if(n(t))return this.filter(function(e,n){return n.dir&&t.test(e)});var e=this.root+t,r=g.call(this,e),i=this.clone();return i.root=r.name,i},remove:function(t){t=this.root+t;
var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var n=this.filter(function(e,n){return n.name.slice(0,t.length)===t}),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,n={};try{if(n=i.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode}),n.type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");i.checkSupport(n.type),("darwin"===n.platform||"freebsd"===n.platform||"linux"===n.platform||"sunos"===n.platform)&&(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var a=n.comment||this.comment||"";e=l.generateWorker(this,n,a)}catch(u){e=new s("error"),e.error(u)}return new o(e,n.type||"string",n.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return t=t||{},t.type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e){e.exports=t("stream")},{stream:void 0}],17:[function(t,e){"use strict";function n(t){r.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}var r=t("./DataReader"),i=t("../utils");i.inherits(n,r),n.prototype.byteAt=function(t){return this.data[this.zero+t]},n.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2),i=t.charCodeAt(3),s=this.length-4;s>=0;--s)if(this.data[s]===e&&this.data[s+1]===n&&this.data[s+2]===r&&this.data[s+3]===i)return s-this.zero;return-1},n.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2),i=t.charCodeAt(3),s=this.readData(4);return e===s[0]&&n===s[1]&&r===s[2]&&i===s[3]},n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./DataReader":18}],18:[function(t,e){"use strict";function n(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}var r=t("../utils");n.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||0>t)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var e,n=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)n=(n<<8)+this.byteAt(e);return this.index+=t,n},readString:function(t){return r.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC((t>>25&127)+1980,(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=n},{"../utils":32}],19:[function(t,e){"use strict";function n(t){r.call(this,t)}var r=t("./Uint8ArrayReader"),i=t("../utils");i.inherits(n,r),n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e){"use strict";function n(t){r.call(this,t)}var r=t("./DataReader"),i=t("../utils");i.inherits(n,r),n.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},n.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},n.prototype.readAndCheckSignature=function(t){var e=this.readData(4);return t===e},n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./DataReader":18}],21:[function(t,e){"use strict";function n(t){r.call(this,t)}var r=t("./ArrayReader"),i=t("../utils");i.inherits(n,r),n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(t,e){"use strict";var n=t("../utils"),r=t("../support"),i=t("./ArrayReader"),s=t("./StringReader"),o=t("./NodeBufferReader"),a=t("./Uint8ArrayReader");e.exports=function(t){var e=n.getTypeOf(t);return n.checkSupport(e),"string"!==e||r.uint8array?"nodebuffer"===e?new o(t):r.uint8array?new a(n.transformTo("uint8array",t)):new i(n.transformTo("array",t)):new s(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e){"use strict";function n(t){r.call(this,"ConvertWorker to "+t),this.destType=t}var r=t("./GenericWorker"),i=t("../utils");i.inherits(n,r),n.prototype.processChunk=function(t){this.push({data:i.transformTo(this.destType,t.data),meta:t.meta})},e.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(t,e){"use strict";function n(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var r=t("./GenericWorker"),i=t("../crc32"),s=t("../utils");s.inherits(n,r),n.prototype.processChunk=function(t){this.streamInfo.crc32=i(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e){"use strict";function n(t){i.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}var r=t("../utils"),i=t("./GenericWorker");r.inherits(n,i),n.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}i.prototype.processChunk.call(this,t)},e.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(t,e){"use strict";function n(t){i.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=r.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}var r=t("../utils"),i=t("./GenericWorker"),s=16384;r.inherits(n,i),n.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return i.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0):!1},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=s,e=null,n=Math.min(this.max,this.index+t);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,n);break;case"uint8array":e=this.data.subarray(this.index,n);break;case"array":case"nodebuffer":e=this.data.slice(this.index,n)}return this.index=n,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(t,e){"use strict";function n(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return this.isFinished?!1:(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var t=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=n},{}],29:[function(t,e){"use strict";function n(t,e,n){switch(t){case"blob":return o.newBlob(o.transformTo("arraybuffer",e),n);case"base64":return c.encode(e);default:return o.transformTo(t,e)}}function r(t,e){var n,r=0,i=null,s=0;for(n=0;n<e.length;n++)s+=e[n].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(i=new Uint8Array(s),n=0;n<e.length;n++)i.set(e[n],r),r+=e[n].length;return i;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}function i(t,e){return new f.Promise(function(i,s){var o=[],a=t._internalType,u=t._outputType,c=t._mimeType;t.on("data",function(t,n){o.push(t),e&&e(n)}).on("error",function(t){o=[],s(t)}).on("end",function(){try{var t=n(u,r(a,o),c);i(t)}catch(e){s(e)}o=[]}).resume()})}function s(t,e,n){var r=e;switch(e){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=e,this._mimeType=n,o.checkSupport(r),this._worker=t.pipe(new a(r)),t.lock()}catch(i){this._worker=new u("error"),this._worker.error(i)}}var o=t("../utils"),a=t("./ConvertWorker"),u=t("./GenericWorker"),c=t("../base64"),l=t("../support"),f=t("../external"),h=null;if(l.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch(d){}s.prototype={accumulate:function(t){return i(this,t)},on:function(t,e){var n=this;return"data"===t?this._worker.on(t,function(t){e.call(n,t.data,t.meta)}):this._worker.on(t,function(){o.delay(e,arguments,n)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(o.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=s},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=0===new Blob([r],{type:"application/zip"}).size}catch(i){try{var s=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,o=new s;o.append(r),n.blob=0===o.getBlob("application/zip").size}catch(i){n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch(i){n.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,n){"use strict";function r(){u.call(this,"utf-8 decode"),this.leftOver=null}function i(){u.call(this,"utf-8 encode")}for(var s=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),u=t("./stream/GenericWorker"),c=new Array(256),l=0;256>l;l++)c[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;c[254]=c[254]=1;var f=function(t){var e,n,r,i,s,a=t.length,u=0;for(i=0;a>i;i++)n=t.charCodeAt(i),55296===(64512&n)&&a>i+1&&(r=t.charCodeAt(i+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),u+=128>n?1:2048>n?2:65536>n?3:4;for(e=o.uint8array?new Uint8Array(u):new Array(u),s=0,i=0;u>s;i++)n=t.charCodeAt(i),55296===(64512&n)&&a>i+1&&(r=t.charCodeAt(i+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),128>n?e[s++]=n:2048>n?(e[s++]=192|n>>>6,e[s++]=128|63&n):65536>n?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},h=function(t,e){var n;for(e=e||t.length,e>t.length&&(e=t.length),n=e-1;n>=0&&128===(192&t[n]);)n--;return 0>n?e:0===n?e:n+c[t[n]]>e?n:e},d=function(t){var e,n,r,i,o=t.length,a=new Array(2*o);for(n=0,e=0;o>e;)if(r=t[e++],128>r)a[n++]=r;else if(i=c[r],i>4)a[n++]=65533,e+=i-1;else{for(r&=2===i?31:3===i?15:7;i>1&&o>e;)r=r<<6|63&t[e++],i--;i>1?a[n++]=65533:65536>r?a[n++]=r:(r-=65536,a[n++]=55296|r>>10&1023,a[n++]=56320|1023&r)}return a.length!==n&&(a.subarray?a=a.subarray(0,n):a.length=n),s.applyFromCharCode(a)};n.utf8encode=function(t){return o.nodebuffer?a.newBufferFrom(t,"utf-8"):f(t)},n.utf8decode=function(t){return o.nodebuffer?s.transformTo("nodebuffer",t).toString("utf-8"):(t=s.transformTo(o.uint8array?"uint8array":"array",t),d(t))},s.inherits(r,u),r.prototype.processChunk=function(t){var e=s.transformTo(o.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var r=e;e=new Uint8Array(r.length+this.leftOver.length),e.set(this.leftOver,0),e.set(r,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var i=h(e),a=e;i!==e.length&&(o.uint8array?(a=e.subarray(0,i),this.leftOver=e.subarray(i,e.length)):(a=e.slice(0,i),this.leftOver=e.slice(i,e.length))),this.push({data:n.utf8decode(a),meta:t.meta})},r.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=r,s.inherits(i,u),i.prototype.processChunk=function(t){this.push({data:n.utf8encode(t.data),meta:t.meta})},n.Utf8EncodeWorker=i},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,n){"use strict";function r(t){var e=null;return e=u.uint8array?new Uint8Array(t.length):new Array(t.length),s(t,e)}function i(t){return t}function s(t,e){for(var n=0;n<t.length;++n)e[n]=255&t.charCodeAt(n);return e}function o(t){var e=65536,r=n.getTypeOf(t),i=!0;if("uint8array"===r?i=d.applyCanBeUsed.uint8array:"nodebuffer"===r&&(i=d.applyCanBeUsed.nodebuffer),i)for(;e>1;)try{return d.stringifyByChunk(t,r,e)}catch(s){e=Math.floor(e/2)}return d.stringifyByChar(t)}function a(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e}var u=t("./support"),c=t("./base64"),l=t("./nodejsUtils"),f=t("core-js/library/fn/set-immediate"),h=t("./external");n.newBlob=function(t,e){n.checkSupport("blob");try{return new Blob([t],{type:e})}catch(r){try{var i=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,s=new i;return s.append(t),s.getBlob(e)}catch(r){throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(t,e,n){var r=[],i=0,s=t.length;if(n>=s)return String.fromCharCode.apply(null,t);for(;s>i;)r.push("array"===e||"nodebuffer"===e?String.fromCharCode.apply(null,t.slice(i,Math.min(i+n,s))):String.fromCharCode.apply(null,t.subarray(i,Math.min(i+n,s)))),i+=n;return r.join("")},stringifyByChar:function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},applyCanBeUsed:{uint8array:function(){try{return u.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return u.nodebuffer&&1===String.fromCharCode.apply(null,l.allocBuffer(1)).length}catch(t){return!1}}()}};n.applyFromCharCode=o;var p={};p.string={string:i,array:function(t){return s(t,new Array(t.length))},arraybuffer:function(t){return p.string.uint8array(t).buffer},uint8array:function(t){return s(t,new Uint8Array(t.length))},nodebuffer:function(t){return s(t,l.allocBuffer(t.length))}},p.array={string:o,array:i,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return l.newBufferFrom(t)}},p.arraybuffer={string:function(t){return o(new Uint8Array(t))},array:function(t){return a(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:i,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return l.newBufferFrom(new Uint8Array(t))}},p.uint8array={string:o,array:function(t){return a(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:i,nodebuffer:function(t){return l.newBufferFrom(t)}},p.nodebuffer={string:o,array:function(t){return a(t,new Array(t.length))},arraybuffer:function(t){return p.nodebuffer.uint8array(t).buffer},uint8array:function(t){return a(t,new Uint8Array(t.length))},nodebuffer:i},n.transformTo=function(t,e){if(e||(e=""),!t)return e;n.checkSupport(t);var r=n.getTypeOf(e),i=p[r][t](e);return i},n.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":u.nodebuffer&&l.isBuffer(t)?"nodebuffer":u.uint8array&&t instanceof Uint8Array?"uint8array":u.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(t){var e=u[t.toLowerCase()];if(!e)throw new Error(t+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(t){var e,n,r="";for(n=0;n<(t||"").length;n++)e=t.charCodeAt(n),r+="\\x"+(16>e?"0":"")+e.toString(16).toUpperCase();return r},n.delay=function(t,e,n){f(function(){t.apply(n||null,e||[])})},n.inherits=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n},n.extend=function(){var t,e,n={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&"undefined"==typeof n[e]&&(n[e]=arguments[t][e]);return n},n.prepareContent=function(t,e,i,s,o){var a=h.Promise.resolve(e).then(function(t){var e=u.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)));return e&&"undefined"!=typeof FileReader?new h.Promise(function(e,n){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=function(t){n(t.target.error)},r.readAsArrayBuffer(t)}):t});return a.then(function(e){var a=n.getTypeOf(e);return a?("arraybuffer"===a?e=n.transformTo("uint8array",e):"string"===a&&(o?e=c.decode(e):i&&s!==!0&&(e=r(e))),e):h.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(t,e){"use strict";function n(t){this.files=[],this.loadOptions=t}var r=t("./reader/readerFor"),i=t("./utils"),s=t("./signature"),o=t("./zipEntry"),a=(t("./utf8"),t("./support"));n.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(e)+", expected "+i.pretty(t)+")")}},isSignature:function(t,e){var n=this.reader.index;this.reader.setIndex(t);var r=this.reader.readString(4),i=r===e;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=a.uint8array?"uint8array":"array",n=i.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,n,r=this.zip64EndOfCentralSize-44,i=0;r>i;)t=this.reader.readInt(2),e=this.reader.readInt(4),n=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)t=new o({zip64:this.zip64},this.loadOptions),t.readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(0>t){var e=!this.isSignature(0,s.LOCAL_FILE_HEADER);throw new Error(e?"Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html":"Corrupted zip: can't find end of central directory")}this.reader.setIndex(t);var n=t;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,t=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),0>t)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var o=n-r;if(o>0)this.isSignature(n,s.CENTRAL_FILE_HEADER)||(this.reader.zero=o);else if(0>o)throw new Error("Corrupted zip: missing "+Math.abs(o)+" bytes.")},prepareReader:function(t){this.reader=r(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=n},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e){"use strict";function n(t,e){this.options=t,this.loadOptions=e}var r=t("./reader/readerFor"),i=t("./utils"),s=t("./compressedObject"),o=t("./crc32"),a=t("./utf8"),u=t("./compressions"),c=t("./support"),l=0,f=3,h=function(t){for(var e in u)if(u.hasOwnProperty(e)&&u[e].magic===t)return u[e];return null};n.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(t){var e,n;if(t.skip(22),this.fileNameLength=t.readInt(2),n=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(e=h(this.compressionMethod),null===e)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=16&this.externalFileAttributes?!0:!1,t===l&&(this.dosPermissions=63&this.externalFileAttributes),t===f&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var t=r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(t){var e,n,r,i=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<i;)e=t.readInt(2),n=t.readInt(2),r=t.readData(n),this.extraFields[e]={id:e,length:n,value:r}},handleUTF8:function(){var t=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var n=i.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var s=i.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=r(t.value);return 1!==e.readInt(1)?null:o(this.fileName)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=r(t.value);return 1!==e.readInt(1)?null:o(this.fileComment)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}return null}},e.exports=n},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e){"use strict";var n=t("./stream/StreamHelper"),r=t("./stream/DataWorker"),i=t("./utf8"),s=t("./compressedObject"),o=t("./stream/GenericWorker"),a=function(t,e,n){this.name=t,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=e,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};a.prototype={internalStream:function(t){var e=null,r="string";try{if(!t)throw new Error("No output type specified.");r=t.toLowerCase();var s="string"===r||"text"===r;("binarystring"===r||"text"===r)&&(r="string"),e=this._decompressWorker();var a=!this._dataBinary;a&&!s&&(e=e.pipe(new i.Utf8EncodeWorker)),!a&&s&&(e=e.pipe(new i.Utf8DecodeWorker))}catch(u){e=new o("error"),e.error(u)}return new n(e,r,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof s&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new i.Utf8EncodeWorker)),s.createWorkerFrom(n,t,e)},_decompressWorker:function(){return this._data instanceof s?this._data.getContentWorker():this._data instanceof o?this._data:new r(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<u.length;l++)a.prototype[u[l]]=c;e.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e){t("../modules/web.immediate"),e.exports=t("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(t,e){e.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},{}],38:[function(t,e){var n=t("./_is-object");e.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},{"./_is-object":51}],39:[function(t,e){var n={}.toString;e.exports=function(t){return n.call(t).slice(8,-1)}},{}],40:[function(t,e){var n=e.exports={version:"2.3.0"};"number"==typeof __e&&(__e=n)},{}],41:[function(t,e){var n=t("./_a-function");e.exports=function(t,e,r){if(n(t),void 0===e)return t;switch(r){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}},{"./_a-function":37}],42:[function(t,e){e.exports=!t("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(t,e){var n=t("./_is-object"),r=t("./_global").document,i=n(r)&&n(r.createElement);e.exports=function(t){return i?r.createElement(t):{}}},{"./_global":46,"./_is-object":51}],44:[function(t,e){var n=t("./_global"),r=t("./_core"),i=t("./_ctx"),s=t("./_hide"),o="prototype",a=function(t,e,u){var c,l,f,h=t&a.F,d=t&a.G,p=t&a.S,m=t&a.P,g=t&a.B,v=t&a.W,y=d?r:r[e]||(r[e]={}),b=y[o],_=d?n:p?n[e]:(n[e]||{})[o];d&&(u=e);for(c in u)l=!h&&_&&void 0!==_[c],l&&c in y||(f=l?_[c]:u[c],y[c]=d&&"function"!=typeof _[c]?u[c]:g&&l?i(f,n):v&&_[c]==f?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e[o]=t[o],e}(f):m&&"function"==typeof f?i(Function.call,f):f,m&&((y.virtual||(y.virtual={}))[c]=f,t&a.R&&b&&!b[c]&&s(b,c,f)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,e.exports=a
},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(t,e){e.exports=function(t){try{return!!t()}catch(e){return!0}}},{}],46:[function(t,e){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],47:[function(t,e){var n=t("./_object-dp"),r=t("./_property-desc");e.exports=t("./_descriptors")?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,n){return t[e]=n,t}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(t,e){e.exports=t("./_global").document&&document.documentElement},{"./_global":46}],49:[function(t,e){e.exports=!t("./_descriptors")&&!t("./_fails")(function(){return 7!=Object.defineProperty(t("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(t,e){e.exports=function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)}},{}],51:[function(t,e){e.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},{}],52:[function(t,e,n){var r=t("./_an-object"),i=t("./_ie8-dom-define"),s=t("./_to-primitive"),o=Object.defineProperty;n.f=t("./_descriptors")?Object.defineProperty:function(t,e,n){if(r(t),e=s(e,!0),r(n),i)try{return o(t,e,n)}catch(a){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(t,e){e.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},{}],54:[function(t,e){var n,r,i,s=t("./_ctx"),o=t("./_invoke"),a=t("./_html"),u=t("./_dom-create"),c=t("./_global"),l=c.process,f=c.setImmediate,h=c.clearImmediate,d=c.MessageChannel,p=0,m={},g="onreadystatechange",v=function(){var t=+this;if(m.hasOwnProperty(t)){var e=m[t];delete m[t],e()}},y=function(t){v.call(t.data)};f&&h||(f=function(t){for(var e=[],r=1;arguments.length>r;)e.push(arguments[r++]);return m[++p]=function(){o("function"==typeof t?t:Function(t),e)},n(p),p},h=function(t){delete m[t]},"process"==t("./_cof")(l)?n=function(t){l.nextTick(s(v,t,1))}:d?(r=new d,i=r.port2,r.port1.onmessage=y,n=s(i.postMessage,i,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(n=function(t){c.postMessage(t+"","*")},c.addEventListener("message",y,!1)):n=g in u("script")?function(t){a.appendChild(u("script"))[g]=function(){a.removeChild(this),v.call(t)}}:function(t){setTimeout(s(v,t,1),0)}),e.exports={set:f,clear:h}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(t,e){var n=t("./_is-object");e.exports=function(t,e){if(!n(t))return t;var r,i;if(e&&"function"==typeof(r=t.toString)&&!n(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!n(i=r.call(t)))return i;if(!e&&"function"==typeof(r=t.toString)&&!n(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(t){var e=t("./_export"),n=t("./_task");e(e.G+e.B,{setImmediate:n.set,clearImmediate:n.clear})},{"./_export":44,"./_task":54}],57:[function(t,e){(function(t){"use strict";function n(){l=!0;for(var t,e,n=f.length;n;){for(e=f,f=[],t=-1;++t<n;)e[t]();n=f.length}l=!1}function r(t){1!==f.push(t)||l||i()}var i,s=t.MutationObserver||t.WebKitMutationObserver;if(s){var o=0,a=new s(n),u=t.document.createTextNode("");a.observe(u,{characterData:!0}),i=function(){u.data=o=++o%2}}else if(t.setImmediate||"undefined"==typeof t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){n(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(n,0)};else{var c=new t.MessageChannel;c.port1.onmessage=n,i=function(){c.port2.postMessage(0)}}var l,f=[];e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(t,e){"use strict";function n(){}function r(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,t!==n&&a(this,t)}function i(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function s(t,e,n){d(function(){var r;try{r=e(n)}catch(i){return p.reject(t,i)}r===t?p.reject(t,new TypeError("Cannot resolve promise with itself")):p.resolve(t,r)})}function o(t){var e=t&&t.then;return!t||"object"!=typeof t&&"function"!=typeof t||"function"!=typeof e?void 0:function(){e.apply(t,arguments)}}function a(t,e){function n(e){s||(s=!0,p.reject(t,e))}function r(e){s||(s=!0,p.resolve(t,e))}function i(){e(r,n)}var s=!1,o=u(i);"error"===o.status&&n(o.value)}function u(t,e){var n={};try{n.value=t(e),n.status="success"}catch(r){n.status="error",n.value=r}return n}function c(t){return t instanceof this?t:p.resolve(new this(n),t)}function l(t){var e=new this(n);return p.reject(e,t)}function f(t){function e(t,e){function n(t){o[e]=t,++a!==i||s||(s=!0,p.resolve(c,o))}r.resolve(t).then(n,function(t){s||(s=!0,p.reject(c,t))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,s=!1;if(!i)return this.resolve([]);for(var o=new Array(i),a=0,u=-1,c=new this(n);++u<i;)e(t[u],u);return c}function h(t){function e(t){r.resolve(t).then(function(t){s||(s=!0,p.resolve(a,t))},function(t){s||(s=!0,p.reject(a,t))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,s=!1;if(!i)return this.resolve([]);for(var o=-1,a=new this(n);++o<i;)e(t[o]);return a}var d=t("immediate"),p={},m=["REJECTED"],g=["FULFILLED"],v=["PENDING"];e.exports=r,r.prototype["catch"]=function(t){return this.then(null,t)},r.prototype.then=function(t,e){if("function"!=typeof t&&this.state===g||"function"!=typeof e&&this.state===m)return this;var r=new this.constructor(n);if(this.state!==v){var o=this.state===g?t:e;s(r,o,this.outcome)}else this.queue.push(new i(r,t,e));return r},i.prototype.callFulfilled=function(t){p.resolve(this.promise,t)},i.prototype.otherCallFulfilled=function(t){s(this.promise,this.onFulfilled,t)},i.prototype.callRejected=function(t){p.reject(this.promise,t)},i.prototype.otherCallRejected=function(t){s(this.promise,this.onRejected,t)},p.resolve=function(t,e){var n=u(o,e);if("error"===n.status)return p.reject(t,n.value);var r=n.value;if(r)a(t,r);else{t.state=g,t.outcome=e;for(var i=-1,s=t.queue.length;++i<s;)t.queue[i].callFulfilled(e)}return t},p.reject=function(t,e){t.state=m,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},r.resolve=c,r.reject=l,r.all=f,r.race=h},{immediate:57}],59:[function(t,e){var n=t("./lib/utils/common").assign,r=t("./lib/deflate"),i=t("./lib/inflate"),s=t("./lib/zlib/constants"),o={};n(o,r,i,s),e.exports=o},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(t,e,n){"use strict";function r(t){if(!(this instanceof r))return new r(t);this.options=u.assign({level:y,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var n=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==m)throw new Error(l[n]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var i;if(i="string"==typeof e.dictionary?c.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,n=a.deflateSetDictionary(this.strm,i),n!==m)throw new Error(l[n]);this._dict_set=!0}}function i(t,e){var n=new r(e);if(n.push(t,!0),n.err)throw n.msg||l[n.err];return n.result}function s(t,e){return e=e||{},e.raw=!0,i(t,e)}function o(t,e){return e=e||{},e.gzip=!0,i(t,e)}var a=t("./zlib/deflate"),u=t("./utils/common"),c=t("./utils/strings"),l=t("./zlib/messages"),f=t("./zlib/zstream"),h=Object.prototype.toString,d=0,p=4,m=0,g=1,v=2,y=-1,b=0,_=8;r.prototype.push=function(t,e){var n,r,i=this.strm,s=this.options.chunkSize;if(this.ended)return!1;r=e===~~e?e:e===!0?p:d,i.input="string"==typeof t?c.string2buf(t):"[object ArrayBuffer]"===h.call(t)?new Uint8Array(t):t,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new u.Buf8(s),i.next_out=0,i.avail_out=s),n=a.deflate(i,r),n!==g&&n!==m)return this.onEnd(n),this.ended=!0,!1;(0===i.avail_out||0===i.avail_in&&(r===p||r===v))&&this.onData("string"===this.options.to?c.buf2binstring(u.shrinkBuf(i.output,i.next_out)):u.shrinkBuf(i.output,i.next_out))}while((i.avail_in>0||0===i.avail_out)&&n!==g);return r===p?(n=a.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===m):r===v?(this.onEnd(m),i.avail_out=0,!0):!0},r.prototype.onData=function(t){this.chunks.push(t)},r.prototype.onEnd=function(t){t===m&&(this.result="string"===this.options.to?this.chunks.join(""):u.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=r,n.deflate=i,n.deflateRaw=s,n.gzip=o},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(t,e,n){"use strict";function r(t){if(!(this instanceof r))return new r(t);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var n=o.inflateInit2(this.strm,e.windowBits);if(n!==c.Z_OK)throw new Error(l[n]);this.header=new h,o.inflateGetHeader(this.strm,this.header)}function i(t,e){var n=new r(e);if(n.push(t,!0),n.err)throw n.msg||l[n.err];return n.result}function s(t,e){return e=e||{},e.raw=!0,i(t,e)}var o=t("./zlib/inflate"),a=t("./utils/common"),u=t("./utils/strings"),c=t("./zlib/constants"),l=t("./zlib/messages"),f=t("./zlib/zstream"),h=t("./zlib/gzheader"),d=Object.prototype.toString;r.prototype.push=function(t,e){var n,r,i,s,l,f,h=this.strm,p=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;r=e===~~e?e:e===!0?c.Z_FINISH:c.Z_NO_FLUSH,h.input="string"==typeof t?u.binstring2buf(t):"[object ArrayBuffer]"===d.call(t)?new Uint8Array(t):t,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(p),h.next_out=0,h.avail_out=p),n=o.inflate(h,c.Z_NO_FLUSH),n===c.Z_NEED_DICT&&m&&(f="string"==typeof m?u.string2buf(m):"[object ArrayBuffer]"===d.call(m)?new Uint8Array(m):m,n=o.inflateSetDictionary(this.strm,f)),n===c.Z_BUF_ERROR&&g===!0&&(n=c.Z_OK,g=!1),n!==c.Z_STREAM_END&&n!==c.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0===h.avail_out||n===c.Z_STREAM_END||0===h.avail_in&&(r===c.Z_FINISH||r===c.Z_SYNC_FLUSH))&&("string"===this.options.to?(i=u.utf8border(h.output,h.next_out),s=h.next_out-i,l=u.buf2string(h.output,i),h.next_out=s,h.avail_out=p-s,s&&a.arraySet(h.output,h.output,i,s,0),this.onData(l)):this.onData(a.shrinkBuf(h.output,h.next_out))),0===h.avail_in&&0===h.avail_out&&(g=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==c.Z_STREAM_END);return n===c.Z_STREAM_END&&(r=c.Z_FINISH),r===c.Z_FINISH?(n=o.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c.Z_OK):r===c.Z_SYNC_FLUSH?(this.onEnd(c.Z_OK),h.avail_out=0,!0):!0},r.prototype.onData=function(t){this.chunks.push(t)},r.prototype.onEnd=function(t){t===c.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=r,n.inflate=i,n.inflateRaw=s,n.ungzip=i},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(t,e,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}}return t},n.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,n,r,i){if(e.subarray&&t.subarray)return void t.set(e.subarray(n,n+r),i);for(var s=0;r>s;s++)t[i+s]=e[n+s]},flattenChunks:function(t){var e,n,r,i,s,o;for(r=0,e=0,n=t.length;n>e;e++)r+=t[e].length;for(o=new Uint8Array(r),i=0,e=0,n=t.length;n>e;e++)s=t[e],o.set(s,i),i+=s.length;return o}},s={arraySet:function(t,e,n,r,i){for(var s=0;r>s;s++)t[i+s]=e[n+s]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(r)},{}],63:[function(t,e,n){function r(t,e){if(65537>e&&(t.subarray&&o||!t.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var n="",r=0;e>r;r++)n+=String.fromCharCode(t[r]);return n}var i=t("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(a){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){o=!1}for(var u=new i.Buf8(256),c=0;256>c;c++)u[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;u[254]=u[254]=1,n.string2buf=function(t){var e,n,r,s,o,a=t.length,u=0;for(s=0;a>s;s++)n=t.charCodeAt(s),55296===(64512&n)&&a>s+1&&(r=t.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),u+=128>n?1:2048>n?2:65536>n?3:4;for(e=new i.Buf8(u),o=0,s=0;u>o;s++)n=t.charCodeAt(s),55296===(64512&n)&&a>s+1&&(r=t.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),128>n?e[o++]=n:2048>n?(e[o++]=192|n>>>6,e[o++]=128|63&n):65536>n?(e[o++]=224|n>>>12,e[o++]=128|n>>>6&63,e[o++]=128|63&n):(e[o++]=240|n>>>18,e[o++]=128|n>>>12&63,e[o++]=128|n>>>6&63,e[o++]=128|63&n);return e},n.buf2binstring=function(t){return r(t,t.length)},n.binstring2buf=function(t){for(var e=new i.Buf8(t.length),n=0,r=e.length;r>n;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,i,s,o,a=e||t.length,c=new Array(2*a);for(i=0,n=0;a>n;)if(s=t[n++],128>s)c[i++]=s;else if(o=u[s],o>4)c[i++]=65533,n+=o-1;else{for(s&=2===o?31:3===o?15:7;o>1&&a>n;)s=s<<6|63&t[n++],o--;o>1?c[i++]=65533:65536>s?c[i++]=s:(s-=65536,c[i++]=55296|s>>10&1023,c[i++]=56320|1023&s)}return r(c,i)},n.utf8border=function(t,e){var n;for(e=e||t.length,e>t.length&&(e=t.length),n=e-1;n>=0&&128===(192&t[n]);)n--;return 0>n?e:0===n?e:n+u[t[n]]>e?n:e}},{"./common":62}],64:[function(t,e){"use strict";function n(t,e,n,r){for(var i=65535&t|0,s=t>>>16&65535|0,o=0;0!==n;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0}e.exports=n},{}],65:[function(t,e){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(t,e){"use strict";function n(){for(var t,e=[],n=0;256>n;n++){t=n;for(var r=0;8>r;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}function r(t,e,n,r){var s=i,o=r+n;t^=-1;for(var a=r;o>a;a++)t=t>>>8^s[255&(t^e[a])];return-1^t}var i=n();e.exports=r},{}],67:[function(t,e,n){"use strict";function r(t,e){return t.msg=N[e],e}function i(t){return(t<<1)-(t>4?9:0)}function s(t){for(var e=t.length;--e>=0;)t[e]=0}function o(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(D.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function a(t,e){I._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,o(t.strm)}function u(t,e){t.pending_buf[t.pending++]=e}function c(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function l(t,e,n,r){var i=t.avail_in;return i>r&&(i=r),0===i?0:(t.avail_in-=i,D.arraySet(e,t.input,t.next_in,i,n),1===t.state.wrap?t.adler=M(t.adler,e,i,n):2===t.state.wrap&&(t.adler=C(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)}function f(t,e){var n,r,i=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match,u=t.strstart>t.w_size-fe?t.strstart-(t.w_size-fe):0,c=t.window,l=t.w_mask,f=t.prev,h=t.strstart+le,d=c[s+o-1],p=c[s+o];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do if(n=e,c[n+o]===p&&c[n+o-1]===d&&c[n]===c[s]&&c[++n]===c[s+1]){s+=2,n++;do;while(c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&h>s);if(r=le-(h-s),s=h-le,r>o){if(t.match_start=e,o=r,r>=a)break;d=c[s+o-1],p=c[s+o]}}while((e=f[e&l])>u&&0!==--i);return o<=t.lookahead?o:t.lookahead}function h(t){var e,n,r,i,s,o=t.w_size;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=o+(o-fe)){D.arraySet(t.window,t.window,o,o,0),t.match_start-=o,t.strstart-=o,t.block_start-=o,n=t.hash_size,e=n;do r=t.head[--e],t.head[e]=r>=o?r-o:0;while(--n);n=o,e=n;do r=t.prev[--e],t.prev[e]=r>=o?r-o:0;while(--n);i+=o}if(0===t.strm.avail_in)break;if(n=l(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=ce)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+ce-1])&t.hash_mask,t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<ce)););}while(t.lookahead<fe&&0!==t.strm.avail_in)}function d(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(h(t),0===t.lookahead&&e===O)return _e;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,a(t,!1),0===t.strm.avail_out))return _e;if(t.strstart-t.block_start>=t.w_size-fe&&(a(t,!1),0===t.strm.avail_out))return _e}return t.insert=0,e===L?(a(t,!0),0===t.strm.avail_out?Se:Ae):t.strstart>t.block_start&&(a(t,!1),0===t.strm.avail_out)?_e:_e}function p(t,e){for(var n,r;;){if(t.lookahead<fe){if(h(t),t.lookahead<fe&&e===O)return _e;if(0===t.lookahead)break}if(n=0,t.lookahead>=ce&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ce-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-fe&&(t.match_length=f(t,n)),t.match_length>=ce)if(r=I._tr_tally(t,t.strstart-t.match_start,t.match_length-ce),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=ce){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ce-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=I._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(a(t,!1),0===t.strm.avail_out))return _e}return t.insert=t.strstart<ce-1?t.strstart:ce-1,e===L?(a(t,!0),0===t.strm.avail_out?Se:Ae):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?_e:we}function m(t,e){for(var n,r,i;;){if(t.lookahead<fe){if(h(t),t.lookahead<fe&&e===O)return _e;if(0===t.lookahead)break}if(n=0,t.lookahead>=ce&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ce-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=ce-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-fe&&(t.match_length=f(t,n),t.match_length<=5&&(t.strategy===Z||t.match_length===ce&&t.strstart-t.match_start>4096)&&(t.match_length=ce-1)),t.prev_length>=ce&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-ce,r=I._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-ce),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ce-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(0!==--t.prev_length);if(t.match_available=0,t.match_length=ce-1,t.strstart++,r&&(a(t,!1),0===t.strm.avail_out))return _e}else if(t.match_available){if(r=I._tr_tally(t,0,t.window[t.strstart-1]),r&&a(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return _e}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=I._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<ce-1?t.strstart:ce-1,e===L?(a(t,!0),0===t.strm.avail_out?Se:Ae):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?_e:we}function g(t,e){for(var n,r,i,s,o=t.window;;){if(t.lookahead<=le){if(h(t),t.lookahead<=le&&e===O)return _e;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=ce&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+le;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&s>i);t.match_length=le-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=ce?(n=I._tr_tally(t,1,t.match_length-ce),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=I._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(a(t,!1),0===t.strm.avail_out))return _e}return t.insert=0,e===L?(a(t,!0),0===t.strm.avail_out?Se:Ae):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?_e:we}function v(t,e){for(var n;;){if(0===t.lookahead&&(h(t),0===t.lookahead)){if(e===O)return _e;break}if(t.match_length=0,n=I._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(a(t,!1),0===t.strm.avail_out))return _e}return t.insert=0,e===L?(a(t,!0),0===t.strm.avail_out?Se:Ae):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?_e:we}function y(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function b(t){t.window_size=2*t.w_size,s(t.head),t.max_lazy_match=P[t.level].max_lazy,t.good_match=P[t.level].good_length,t.nice_match=P[t.level].nice_length,t.max_chain_length=P[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=ce-1,t.match_available=0,t.ins_h=0}function _(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=J,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new D.Buf16(2*ae),this.dyn_dtree=new D.Buf16(2*(2*se+1)),this.bl_tree=new D.Buf16(2*(2*oe+1)),s(this.dyn_ltree),s(this.dyn_dtree),s(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new D.Buf16(ue+1),this.heap=new D.Buf16(2*ie+1),s(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new D.Buf16(2*ie+1),s(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=Y,e=t.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?de:ye,t.adler=2===e.wrap?0:1,e.last_flush=O,I._tr_init(e),j):r(t,G)}function S(t){var e=w(t);return e===j&&b(t.state),e}function A(t,e){return t&&t.state?2!==t.state.wrap?G:(t.state.gzhead=e,j):G}function x(t,e,n,i,s,o){if(!t)return G;var a=1;if(e===q&&(e=6),0>i?(a=0,i=-i):i>15&&(a=2,i-=16),1>s||s>Q||n!==J||8>i||i>15||0>e||e>9||0>o||o>K)return r(t,G);8===i&&(i=9);var u=new _;return t.state=u,u.strm=t,u.wrap=a,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=s+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+ce-1)/ce),u.window=new D.Buf8(2*u.w_size),u.head=new D.Buf16(u.hash_size),u.prev=new D.Buf16(u.w_size),u.lit_bufsize=1<<s+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new D.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=e,u.strategy=o,u.method=n,S(t)}function T(t,e){return x(t,e,J,te,ee,X)}function k(t,e){var n,a,l,f;if(!t||!t.state||e>z||0>e)return t?r(t,G):G;if(a=t.state,!t.output||!t.input&&0!==t.avail_in||a.status===be&&e!==L)return r(t,0===t.avail_out?V:G);if(a.strm=t,n=a.last_flush,a.last_flush=e,a.status===de)if(2===a.wrap)t.adler=0,u(a,31),u(a,139),u(a,8),a.gzhead?(u(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),u(a,255&a.gzhead.time),u(a,a.gzhead.time>>8&255),u(a,a.gzhead.time>>16&255),u(a,a.gzhead.time>>24&255),u(a,9===a.level?2:a.strategy>=$||a.level<2?4:0),u(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(u(a,255&a.gzhead.extra.length),u(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=C(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=pe):(u(a,0),u(a,0),u(a,0),u(a,0),u(a,0),u(a,9===a.level?2:a.strategy>=$||a.level<2?4:0),u(a,xe),a.status=ye);else{var h=J+(a.w_bits-8<<4)<<8,d=-1;d=a.strategy>=$||a.level<2?0:a.level<6?1:6===a.level?2:3,h|=d<<6,0!==a.strstart&&(h|=he),h+=31-h%31,a.status=ye,c(a,h),0!==a.strstart&&(c(a,t.adler>>>16),c(a,65535&t.adler)),t.adler=1}if(a.status===pe)if(a.gzhead.extra){for(l=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>l&&(t.adler=C(t.adler,a.pending_buf,a.pending-l,l)),o(t),l=a.pending,a.pending!==a.pending_buf_size));)u(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>l&&(t.adler=C(t.adler,a.pending_buf,a.pending-l,l)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=me)}else a.status=me;if(a.status===me)if(a.gzhead.name){l=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>l&&(t.adler=C(t.adler,a.pending_buf,a.pending-l,l)),o(t),l=a.pending,a.pending===a.pending_buf_size)){f=1;break}f=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,u(a,f)}while(0!==f);a.gzhead.hcrc&&a.pending>l&&(t.adler=C(t.adler,a.pending_buf,a.pending-l,l)),0===f&&(a.gzindex=0,a.status=ge)}else a.status=ge;if(a.status===ge)if(a.gzhead.comment){l=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>l&&(t.adler=C(t.adler,a.pending_buf,a.pending-l,l)),o(t),l=a.pending,a.pending===a.pending_buf_size)){f=1;break}f=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,u(a,f)}while(0!==f);a.gzhead.hcrc&&a.pending>l&&(t.adler=C(t.adler,a.pending_buf,a.pending-l,l)),0===f&&(a.status=ve)}else a.status=ve;if(a.status===ve&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&o(t),a.pending+2<=a.pending_buf_size&&(u(a,255&t.adler),u(a,t.adler>>8&255),t.adler=0,a.status=ye)):a.status=ye),0!==a.pending){if(o(t),0===t.avail_out)return a.last_flush=-1,j}else if(0===t.avail_in&&i(e)<=i(n)&&e!==L)return r(t,V);if(a.status===be&&0!==t.avail_in)return r(t,V);if(0!==t.avail_in||0!==a.lookahead||e!==O&&a.status!==be){var p=a.strategy===$?v(a,e):a.strategy===H?g(a,e):P[a.level].func(a,e);if((p===Se||p===Ae)&&(a.status=be),p===_e||p===Se)return 0===t.avail_out&&(a.last_flush=-1),j;if(p===we&&(e===R?I._tr_align(a):e!==z&&(I._tr_stored_block(a,0,0,!1),e===F&&(s(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),o(t),0===t.avail_out))return a.last_flush=-1,j}return e!==L?j:a.wrap<=0?U:(2===a.wrap?(u(a,255&t.adler),u(a,t.adler>>8&255),u(a,t.adler>>16&255),u(a,t.adler>>24&255),u(a,255&t.total_in),u(a,t.total_in>>8&255),u(a,t.total_in>>16&255),u(a,t.total_in>>24&255)):(c(a,t.adler>>>16),c(a,65535&t.adler)),o(t),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?j:U)}function E(t){var e;return t&&t.state?(e=t.state.status,e!==de&&e!==pe&&e!==me&&e!==ge&&e!==ve&&e!==ye&&e!==be?r(t,G):(t.state=null,e===ye?r(t,W):j)):G}function B(t,e){var n,r,i,o,a,u,c,l,f=e.length;if(!t||!t.state)return G;if(n=t.state,o=n.wrap,2===o||1===o&&n.status!==de||n.lookahead)return G;for(1===o&&(t.adler=M(t.adler,e,f,0)),n.wrap=0,f>=n.w_size&&(0===o&&(s(n.head),n.strstart=0,n.block_start=0,n.insert=0),l=new D.Buf8(n.w_size),D.arraySet(l,e,f-n.w_size,n.w_size,0),e=l,f=n.w_size),a=t.avail_in,u=t.next_in,c=t.input,t.avail_in=f,t.next_in=0,t.input=e,h(n);n.lookahead>=ce;){r=n.strstart,i=n.lookahead-(ce-1);do n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+ce-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++;while(--i);n.strstart=r,n.lookahead=ce-1,h(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=ce-1,n.match_available=0,t.next_in=u,t.input=c,t.avail_in=a,n.wrap=o,j}var P,D=t("../utils/common"),I=t("./trees"),M=t("./adler32"),C=t("./crc32"),N=t("./messages"),O=0,R=1,F=3,L=4,z=5,j=0,U=1,G=-2,W=-3,V=-5,q=-1,Z=1,$=2,H=3,K=4,X=0,Y=2,J=8,Q=9,te=15,ee=8,ne=29,re=256,ie=re+1+ne,se=30,oe=19,ae=2*ie+1,ue=15,ce=3,le=258,fe=le+ce+1,he=32,de=42,pe=69,me=73,ge=91,ve=103,ye=113,be=666,_e=1,we=2,Se=3,Ae=4,xe=3;P=[new y(0,0,0,0,d),new y(4,4,8,4,p),new y(4,5,16,8,p),new y(4,6,32,32,p),new y(4,4,16,16,m),new y(8,16,32,32,m),new y(8,16,128,128,m),new y(8,32,128,256,m),new y(32,128,258,1024,m),new y(32,258,258,4096,m)],n.deflateInit=T,n.deflateInit2=x,n.deflateReset=S,n.deflateResetKeep=w,n.deflateSetHeader=A,n.deflate=k,n.deflateEnd=E,n.deflateSetDictionary=B,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(t,e){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}e.exports=n},{}],69:[function(t,e){"use strict";var n=30,r=12;e.exports=function(t,e){var i,s,o,a,u,c,l,f,h,d,p,m,g,v,y,b,_,w,S,A,x,T,k,E,B;i=t.state,s=t.next_in,E=t.input,o=s+(t.avail_in-5),a=t.next_out,B=t.output,u=a-(e-t.avail_out),c=a+(t.avail_out-257),l=i.dmax,f=i.wsize,h=i.whave,d=i.wnext,p=i.window,m=i.hold,g=i.bits,v=i.lencode,y=i.distcode,b=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;t:do{15>g&&(m+=E[s++]<<g,g+=8,m+=E[s++]<<g,g+=8),w=v[m&b];e:for(;;){if(S=w>>>24,m>>>=S,g-=S,S=w>>>16&255,0===S)B[a++]=65535&w;else{if(!(16&S)){if(0===(64&S)){w=v[(65535&w)+(m&(1<<S)-1)];continue e}if(32&S){i.mode=r;break t}t.msg="invalid literal/length code",i.mode=n;break t}A=65535&w,S&=15,S&&(S>g&&(m+=E[s++]<<g,g+=8),A+=m&(1<<S)-1,m>>>=S,g-=S),15>g&&(m+=E[s++]<<g,g+=8,m+=E[s++]<<g,g+=8),w=y[m&_];n:for(;;){if(S=w>>>24,m>>>=S,g-=S,S=w>>>16&255,!(16&S)){if(0===(64&S)){w=y[(65535&w)+(m&(1<<S)-1)];continue n}t.msg="invalid distance code",i.mode=n;break t}if(x=65535&w,S&=15,S>g&&(m+=E[s++]<<g,g+=8,S>g&&(m+=E[s++]<<g,g+=8)),x+=m&(1<<S)-1,x>l){t.msg="invalid distance too far back",i.mode=n;
break t}if(m>>>=S,g-=S,S=a-u,x>S){if(S=x-S,S>h&&i.sane){t.msg="invalid distance too far back",i.mode=n;break t}if(T=0,k=p,0===d){if(T+=f-S,A>S){A-=S;do B[a++]=p[T++];while(--S);T=a-x,k=B}}else if(S>d){if(T+=f+d-S,S-=d,A>S){A-=S;do B[a++]=p[T++];while(--S);if(T=0,A>d){S=d,A-=S;do B[a++]=p[T++];while(--S);T=a-x,k=B}}}else if(T+=d-S,A>S){A-=S;do B[a++]=p[T++];while(--S);T=a-x,k=B}for(;A>2;)B[a++]=k[T++],B[a++]=k[T++],B[a++]=k[T++],A-=3;A&&(B[a++]=k[T++],A>1&&(B[a++]=k[T++]))}else{T=a-x;do B[a++]=B[T++],B[a++]=B[T++],B[a++]=B[T++],A-=3;while(A>2);A&&(B[a++]=B[T++],A>1&&(B[a++]=B[T++]))}break}}break}}while(o>s&&c>a);A=g>>3,s-=A,g-=A<<3,m&=(1<<g)-1,t.next_in=s,t.next_out=a,t.avail_in=o>s?5+(o-s):5-(s-o),t.avail_out=c>a?257+(c-a):257-(a-c),i.hold=m,i.bits=g}},{}],70:[function(t,e,n){"use strict";function r(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new y.Buf16(320),this.work=new y.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function s(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=F,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new y.Buf32(me),e.distcode=e.distdyn=new y.Buf32(ge),e.sane=1,e.back=-1,P):M}function o(t){var e;return t&&t.state?(e=t.state,e.wsize=0,e.whave=0,e.wnext=0,s(t)):M}function a(t,e){var n,r;return t&&t.state?(r=t.state,0>e?(n=0,e=-e):(n=(e>>4)+1,48>e&&(e&=15)),e&&(8>e||e>15)?M:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,o(t))):M}function u(t,e){var n,r;return t?(r=new i,t.state=r,r.window=null,n=a(t,e),n!==P&&(t.state=null),n):M}function c(t){return u(t,ye)}function l(t){if(be){var e;for(g=new y.Buf32(512),v=new y.Buf32(32),e=0;144>e;)t.lens[e++]=8;for(;256>e;)t.lens[e++]=9;for(;280>e;)t.lens[e++]=7;for(;288>e;)t.lens[e++]=8;for(S(x,t.lens,0,288,g,0,t.work,{bits:9}),e=0;32>e;)t.lens[e++]=5;S(T,t.lens,0,32,v,0,t.work,{bits:5}),be=!1}t.lencode=g,t.lenbits=9,t.distcode=v,t.distbits=5}function f(t,e,n,r){var i,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new y.Buf8(s.wsize)),r>=s.wsize?(y.arraySet(s.window,e,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),y.arraySet(s.window,e,n-r,i,s.wnext),r-=i,r?(y.arraySet(s.window,e,n-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}function h(t,e){var n,i,s,o,a,u,c,h,d,p,m,g,v,me,ge,ve,ye,be,_e,we,Se,Ae,xe,Te,ke=0,Ee=new y.Buf8(4),Be=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return M;n=t.state,n.mode===H&&(n.mode=K),a=t.next_out,s=t.output,c=t.avail_out,o=t.next_in,i=t.input,u=t.avail_in,h=n.hold,d=n.bits,p=u,m=c,Ae=P;t:for(;;)switch(n.mode){case F:if(0===n.wrap){n.mode=K;break}for(;16>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}if(2&n.wrap&&35615===h){n.check=0,Ee[0]=255&h,Ee[1]=h>>>8&255,n.check=_(n.check,Ee,2,0),h=0,d=0,n.mode=L;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",n.mode=he;break}if((15&h)!==R){t.msg="unknown compression method",n.mode=he;break}if(h>>>=4,d-=4,Se=(15&h)+8,0===n.wbits)n.wbits=Se;else if(Se>n.wbits){t.msg="invalid window size",n.mode=he;break}n.dmax=1<<Se,t.adler=n.check=1,n.mode=512&h?Z:H,h=0,d=0;break;case L:for(;16>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}if(n.flags=h,(255&n.flags)!==R){t.msg="unknown compression method",n.mode=he;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=he;break}n.head&&(n.head.text=h>>8&1),512&n.flags&&(Ee[0]=255&h,Ee[1]=h>>>8&255,n.check=_(n.check,Ee,2,0)),h=0,d=0,n.mode=z;case z:for(;32>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}n.head&&(n.head.time=h),512&n.flags&&(Ee[0]=255&h,Ee[1]=h>>>8&255,Ee[2]=h>>>16&255,Ee[3]=h>>>24&255,n.check=_(n.check,Ee,4,0)),h=0,d=0,n.mode=j;case j:for(;16>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&n.flags&&(Ee[0]=255&h,Ee[1]=h>>>8&255,n.check=_(n.check,Ee,2,0)),h=0,d=0,n.mode=U;case U:if(1024&n.flags){for(;16>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}n.length=h,n.head&&(n.head.extra_len=h),512&n.flags&&(Ee[0]=255&h,Ee[1]=h>>>8&255,n.check=_(n.check,Ee,2,0)),h=0,d=0}else n.head&&(n.head.extra=null);n.mode=G;case G:if(1024&n.flags&&(g=n.length,g>u&&(g=u),g&&(n.head&&(Se=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),y.arraySet(n.head.extra,i,o,g,Se)),512&n.flags&&(n.check=_(n.check,i,g,o)),u-=g,o+=g,n.length-=g),n.length))break t;n.length=0,n.mode=W;case W:if(2048&n.flags){if(0===u)break t;g=0;do Se=i[o+g++],n.head&&Se&&n.length<65536&&(n.head.name+=String.fromCharCode(Se));while(Se&&u>g);if(512&n.flags&&(n.check=_(n.check,i,g,o)),u-=g,o+=g,Se)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=V;case V:if(4096&n.flags){if(0===u)break t;g=0;do Se=i[o+g++],n.head&&Se&&n.length<65536&&(n.head.comment+=String.fromCharCode(Se));while(Se&&u>g);if(512&n.flags&&(n.check=_(n.check,i,g,o)),u-=g,o+=g,Se)break t}else n.head&&(n.head.comment=null);n.mode=q;case q:if(512&n.flags){for(;16>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}if(h!==(65535&n.check)){t.msg="header crc mismatch",n.mode=he;break}h=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=H;break;case Z:for(;32>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}t.adler=n.check=r(h),h=0,d=0,n.mode=$;case $:if(0===n.havedict)return t.next_out=a,t.avail_out=c,t.next_in=o,t.avail_in=u,n.hold=h,n.bits=d,I;t.adler=n.check=1,n.mode=H;case H:if(e===E||e===B)break t;case K:if(n.last){h>>>=7&d,d-=7&d,n.mode=ce;break}for(;3>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}switch(n.last=1&h,h>>>=1,d-=1,3&h){case 0:n.mode=X;break;case 1:if(l(n),n.mode=ne,e===B){h>>>=2,d-=2;break t}break;case 2:n.mode=Q;break;case 3:t.msg="invalid block type",n.mode=he}h>>>=2,d-=2;break;case X:for(h>>>=7&d,d-=7&d;32>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}if((65535&h)!==(h>>>16^65535)){t.msg="invalid stored block lengths",n.mode=he;break}if(n.length=65535&h,h=0,d=0,n.mode=Y,e===B)break t;case Y:n.mode=J;case J:if(g=n.length){if(g>u&&(g=u),g>c&&(g=c),0===g)break t;y.arraySet(s,i,o,g,a),u-=g,o+=g,c-=g,a+=g,n.length-=g;break}n.mode=H;break;case Q:for(;14>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}if(n.nlen=(31&h)+257,h>>>=5,d-=5,n.ndist=(31&h)+1,h>>>=5,d-=5,n.ncode=(15&h)+4,h>>>=4,d-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=he;break}n.have=0,n.mode=te;case te:for(;n.have<n.ncode;){for(;3>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}n.lens[Be[n.have++]]=7&h,h>>>=3,d-=3}for(;n.have<19;)n.lens[Be[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,xe={bits:n.lenbits},Ae=S(A,n.lens,0,19,n.lencode,0,n.work,xe),n.lenbits=xe.bits,Ae){t.msg="invalid code lengths set",n.mode=he;break}n.have=0,n.mode=ee;case ee:for(;n.have<n.nlen+n.ndist;){for(;ke=n.lencode[h&(1<<n.lenbits)-1],ge=ke>>>24,ve=ke>>>16&255,ye=65535&ke,!(d>=ge);){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}if(16>ye)h>>>=ge,d-=ge,n.lens[n.have++]=ye;else{if(16===ye){for(Te=ge+2;Te>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}if(h>>>=ge,d-=ge,0===n.have){t.msg="invalid bit length repeat",n.mode=he;break}Se=n.lens[n.have-1],g=3+(3&h),h>>>=2,d-=2}else if(17===ye){for(Te=ge+3;Te>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}h>>>=ge,d-=ge,Se=0,g=3+(7&h),h>>>=3,d-=3}else{for(Te=ge+7;Te>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}h>>>=ge,d-=ge,Se=0,g=11+(127&h),h>>>=7,d-=7}if(n.have+g>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=he;break}for(;g--;)n.lens[n.have++]=Se}}if(n.mode===he)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=he;break}if(n.lenbits=9,xe={bits:n.lenbits},Ae=S(x,n.lens,0,n.nlen,n.lencode,0,n.work,xe),n.lenbits=xe.bits,Ae){t.msg="invalid literal/lengths set",n.mode=he;break}if(n.distbits=6,n.distcode=n.distdyn,xe={bits:n.distbits},Ae=S(T,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,xe),n.distbits=xe.bits,Ae){t.msg="invalid distances set",n.mode=he;break}if(n.mode=ne,e===B)break t;case ne:n.mode=re;case re:if(u>=6&&c>=258){t.next_out=a,t.avail_out=c,t.next_in=o,t.avail_in=u,n.hold=h,n.bits=d,w(t,m),a=t.next_out,s=t.output,c=t.avail_out,o=t.next_in,i=t.input,u=t.avail_in,h=n.hold,d=n.bits,n.mode===H&&(n.back=-1);break}for(n.back=0;ke=n.lencode[h&(1<<n.lenbits)-1],ge=ke>>>24,ve=ke>>>16&255,ye=65535&ke,!(d>=ge);){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}if(ve&&0===(240&ve)){for(be=ge,_e=ve,we=ye;ke=n.lencode[we+((h&(1<<be+_e)-1)>>be)],ge=ke>>>24,ve=ke>>>16&255,ye=65535&ke,!(d>=be+ge);){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}h>>>=be,d-=be,n.back+=be}if(h>>>=ge,d-=ge,n.back+=ge,n.length=ye,0===ve){n.mode=ue;break}if(32&ve){n.back=-1,n.mode=H;break}if(64&ve){t.msg="invalid literal/length code",n.mode=he;break}n.extra=15&ve,n.mode=ie;case ie:if(n.extra){for(Te=n.extra;Te>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=se;case se:for(;ke=n.distcode[h&(1<<n.distbits)-1],ge=ke>>>24,ve=ke>>>16&255,ye=65535&ke,!(d>=ge);){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}if(0===(240&ve)){for(be=ge,_e=ve,we=ye;ke=n.distcode[we+((h&(1<<be+_e)-1)>>be)],ge=ke>>>24,ve=ke>>>16&255,ye=65535&ke,!(d>=be+ge);){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}h>>>=be,d-=be,n.back+=be}if(h>>>=ge,d-=ge,n.back+=ge,64&ve){t.msg="invalid distance code",n.mode=he;break}n.offset=ye,n.extra=15&ve,n.mode=oe;case oe:if(n.extra){for(Te=n.extra;Te>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=he;break}n.mode=ae;case ae:if(0===c)break t;if(g=m-c,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=he;break}g>n.wnext?(g-=n.wnext,v=n.wsize-g):v=n.wnext-g,g>n.length&&(g=n.length),me=n.window}else me=s,v=a-n.offset,g=n.length;g>c&&(g=c),c-=g,n.length-=g;do s[a++]=me[v++];while(--g);0===n.length&&(n.mode=re);break;case ue:if(0===c)break t;s[a++]=n.length,c--,n.mode=re;break;case ce:if(n.wrap){for(;32>d;){if(0===u)break t;u--,h|=i[o++]<<d,d+=8}if(m-=c,t.total_out+=m,n.total+=m,m&&(t.adler=n.check=n.flags?_(n.check,s,m,a-m):b(n.check,s,m,a-m)),m=c,(n.flags?h:r(h))!==n.check){t.msg="incorrect data check",n.mode=he;break}h=0,d=0}n.mode=le;case le:if(n.wrap&&n.flags){for(;32>d;){if(0===u)break t;u--,h+=i[o++]<<d,d+=8}if(h!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=he;break}h=0,d=0}n.mode=fe;case fe:Ae=D;break t;case he:Ae=C;break t;case de:return N;case pe:default:return M}return t.next_out=a,t.avail_out=c,t.next_in=o,t.avail_in=u,n.hold=h,n.bits=d,(n.wsize||m!==t.avail_out&&n.mode<he&&(n.mode<ce||e!==k))&&f(t,t.output,t.next_out,m-t.avail_out)?(n.mode=de,N):(p-=t.avail_in,m-=t.avail_out,t.total_in+=p,t.total_out+=m,n.total+=m,n.wrap&&m&&(t.adler=n.check=n.flags?_(n.check,s,m,t.next_out-m):b(n.check,s,m,t.next_out-m)),t.data_type=n.bits+(n.last?64:0)+(n.mode===H?128:0)+(n.mode===ne||n.mode===Y?256:0),(0===p&&0===m||e===k)&&Ae===P&&(Ae=O),Ae)}function d(t){if(!t||!t.state)return M;var e=t.state;return e.window&&(e.window=null),t.state=null,P}function p(t,e){var n;return t&&t.state?(n=t.state,0===(2&n.wrap)?M:(n.head=e,e.done=!1,P)):M}function m(t,e){var n,r,i,s=e.length;return t&&t.state?(n=t.state,0!==n.wrap&&n.mode!==$?M:n.mode===$&&(r=1,r=b(r,e,s,0),r!==n.check)?C:(i=f(t,e,s,s))?(n.mode=de,N):(n.havedict=1,P)):M}var g,v,y=t("../utils/common"),b=t("./adler32"),_=t("./crc32"),w=t("./inffast"),S=t("./inftrees"),A=0,x=1,T=2,k=4,E=5,B=6,P=0,D=1,I=2,M=-2,C=-3,N=-4,O=-5,R=8,F=1,L=2,z=3,j=4,U=5,G=6,W=7,V=8,q=9,Z=10,$=11,H=12,K=13,X=14,Y=15,J=16,Q=17,te=18,ee=19,ne=20,re=21,ie=22,se=23,oe=24,ae=25,ue=26,ce=27,le=28,fe=29,he=30,de=31,pe=32,me=852,ge=592,ve=15,ye=ve,be=!0;n.inflateReset=o,n.inflateReset2=a,n.inflateResetKeep=s,n.inflateInit=c,n.inflateInit2=u,n.inflate=h,n.inflateEnd=d,n.inflateGetHeader=p,n.inflateSetDictionary=m,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(t,e){"use strict";var n=t("../utils/common"),r=15,i=852,s=592,o=0,a=1,u=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,d,p,m,g,v,y){var b,_,w,S,A,x,T,k,E,B=y.bits,P=0,D=0,I=0,M=0,C=0,N=0,O=0,R=0,F=0,L=0,z=null,j=0,U=new n.Buf16(r+1),G=new n.Buf16(r+1),W=null,V=0;for(P=0;r>=P;P++)U[P]=0;for(D=0;p>D;D++)U[e[d+D]]++;for(C=B,M=r;M>=1&&0===U[M];M--);if(C>M&&(C=M),0===M)return m[g++]=20971520,m[g++]=20971520,y.bits=1,0;for(I=1;M>I&&0===U[I];I++);for(I>C&&(C=I),R=1,P=1;r>=P;P++)if(R<<=1,R-=U[P],0>R)return-1;if(R>0&&(t===o||1!==M))return-1;for(G[1]=0,P=1;r>P;P++)G[P+1]=G[P]+U[P];for(D=0;p>D;D++)0!==e[d+D]&&(v[G[e[d+D]]++]=D);if(t===o?(z=W=v,x=19):t===a?(z=c,j-=257,W=l,V-=257,x=256):(z=f,W=h,x=-1),L=0,D=0,P=I,A=g,N=C,O=0,w=-1,F=1<<C,S=F-1,t===a&&F>i||t===u&&F>s)return 1;for(;;){T=P-O,v[D]<x?(k=0,E=v[D]):v[D]>x?(k=W[V+v[D]],E=z[j+v[D]]):(k=96,E=0),b=1<<P-O,_=1<<N,I=_;do _-=b,m[A+(L>>O)+_]=T<<24|k<<16|E|0;while(0!==_);for(b=1<<P-1;L&b;)b>>=1;if(0!==b?(L&=b-1,L+=b):L=0,D++,0===--U[P]){if(P===M)break;P=e[d+v[D]]}if(P>C&&(L&S)!==w){for(0===O&&(O=C),A+=I,N=P-O,R=1<<N;M>N+O&&(R-=U[N+O],!(0>=R));)N++,R<<=1;if(F+=1<<N,t===a&&F>i||t===u&&F>s)return 1;w=L&S,m[w]=C<<24|N<<16|A-g|0}}return 0!==L&&(m[A+L]=P-O<<24|64<<16|0),y.bits=C,0}},{"../utils/common":62}],72:[function(t,e){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(t,e,n){"use strict";function r(t){for(var e=t.length;--e>=0;)t[e]=0}function i(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function s(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function o(t){return 256>t?ue[t]:ue[256+(t>>>7)]}function a(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function u(t,e,n){t.bi_valid>K-n?(t.bi_buf|=e<<t.bi_valid&65535,a(t,t.bi_buf),t.bi_buf=e>>K-t.bi_valid,t.bi_valid+=n-K):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function c(t,e,n){u(t,n[2*e],n[2*e+1])}function l(t,e){var n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1}function f(t){16===t.bi_valid?(a(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function h(t,e){var n,r,i,s,o,a,u=e.dyn_tree,c=e.max_code,l=e.stat_desc.static_tree,f=e.stat_desc.has_stree,h=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,p=e.stat_desc.max_length,m=0;for(s=0;H>=s;s++)t.bl_count[s]=0;for(u[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;$>n;n++)r=t.heap[n],s=u[2*u[2*r+1]+1]+1,s>p&&(s=p,m++),u[2*r+1]=s,r>c||(t.bl_count[s]++,o=0,r>=d&&(o=h[r-d]),a=u[2*r],t.opt_len+=a*(s+o),f&&(t.static_len+=a*(l[2*r+1]+o)));if(0!==m){do{for(s=p-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[p]--,m-=2}while(m>0);for(s=p;0!==s;s--)for(r=t.bl_count[s];0!==r;)i=t.heap[--n],i>c||(u[2*i+1]!==s&&(t.opt_len+=(s-u[2*i+1])*u[2*i],u[2*i+1]=s),r--)}}function d(t,e,n){var r,i,s=new Array(H+1),o=0;for(r=1;H>=r;r++)s[r]=o=o+n[r-1]<<1;for(i=0;e>=i;i++){var a=t[2*i+1];0!==a&&(t[2*i]=l(s[a]++,a))}}function p(){var t,e,n,r,s,o=new Array(H+1);for(n=0,r=0;G-1>r;r++)for(le[r]=n,t=0;t<1<<ee[r];t++)ce[n++]=r;for(ce[n-1]=r,s=0,r=0;16>r;r++)for(fe[r]=s,t=0;t<1<<ne[r];t++)ue[s++]=r;for(s>>=7;q>r;r++)for(fe[r]=s<<7,t=0;t<1<<ne[r]-7;t++)ue[256+s++]=r;for(e=0;H>=e;e++)o[e]=0;for(t=0;143>=t;)oe[2*t+1]=8,t++,o[8]++;for(;255>=t;)oe[2*t+1]=9,t++,o[9]++;for(;279>=t;)oe[2*t+1]=7,t++,o[7]++;for(;287>=t;)oe[2*t+1]=8,t++,o[8]++;for(d(oe,V+1,o),t=0;q>t;t++)ae[2*t+1]=5,ae[2*t]=l(t,5);he=new i(oe,ee,W+1,V,H),de=new i(ae,ne,0,q,H),pe=new i(new Array(0),re,0,Z,X)}function m(t){var e;for(e=0;V>e;e++)t.dyn_ltree[2*e]=0;for(e=0;q>e;e++)t.dyn_dtree[2*e]=0;for(e=0;Z>e;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*Y]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function g(t){t.bi_valid>8?a(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function v(t,e,n,r){g(t),r&&(a(t,n),a(t,~n)),M.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}function y(t,e,n,r){var i=2*e,s=2*n;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]}function b(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&y(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!y(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function _(t,e,n){var r,i,s,a,l=0;if(0!==t.last_lit)do r=t.pending_buf[t.d_buf+2*l]<<8|t.pending_buf[t.d_buf+2*l+1],i=t.pending_buf[t.l_buf+l],l++,0===r?c(t,i,e):(s=ce[i],c(t,s+W+1,e),a=ee[s],0!==a&&(i-=le[s],u(t,i,a)),r--,s=o(r),c(t,s,n),a=ne[s],0!==a&&(r-=fe[s],u(t,r,a)));while(l<t.last_lit);c(t,Y,e)}function w(t,e){var n,r,i,s=e.dyn_tree,o=e.stat_desc.static_tree,a=e.stat_desc.has_stree,u=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=$,n=0;u>n;n++)0!==s[2*n]?(t.heap[++t.heap_len]=c=n,t.depth[n]=0):s[2*n+1]=0;for(;t.heap_len<2;)i=t.heap[++t.heap_len]=2>c?++c:0,s[2*i]=1,t.depth[i]=0,t.opt_len--,a&&(t.static_len-=o[2*i+1]);for(e.max_code=c,n=t.heap_len>>1;n>=1;n--)b(t,s,n);i=u;do n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],b(t,s,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,s[2*i]=s[2*n]+s[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,s[2*n+1]=s[2*r+1]=i,t.heap[1]=i++,b(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],h(t,e),d(s,c,t.bl_count)}function S(t,e,n){var r,i,s=-1,o=e[1],a=0,u=7,c=4;for(0===o&&(u=138,c=3),e[2*(n+1)+1]=65535,r=0;n>=r;r++)i=o,o=e[2*(r+1)+1],++a<u&&i===o||(c>a?t.bl_tree[2*i]+=a:0!==i?(i!==s&&t.bl_tree[2*i]++,t.bl_tree[2*J]++):10>=a?t.bl_tree[2*Q]++:t.bl_tree[2*te]++,a=0,s=i,0===o?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4))}function A(t,e,n){var r,i,s=-1,o=e[1],a=0,l=7,f=4;for(0===o&&(l=138,f=3),r=0;n>=r;r++)if(i=o,o=e[2*(r+1)+1],!(++a<l&&i===o)){if(f>a){do c(t,i,t.bl_tree);while(0!==--a)}else 0!==i?(i!==s&&(c(t,i,t.bl_tree),a--),c(t,J,t.bl_tree),u(t,a-3,2)):10>=a?(c(t,Q,t.bl_tree),u(t,a-3,3)):(c(t,te,t.bl_tree),u(t,a-11,7));a=0,s=i,0===o?(l=138,f=3):i===o?(l=6,f=3):(l=7,f=4)}}function x(t){var e;for(S(t,t.dyn_ltree,t.l_desc.max_code),S(t,t.dyn_dtree,t.d_desc.max_code),w(t,t.bl_desc),e=Z-1;e>=3&&0===t.bl_tree[2*ie[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function T(t,e,n,r){var i;for(u(t,e-257,5),u(t,n-1,5),u(t,r-4,4),i=0;r>i;i++)u(t,t.bl_tree[2*ie[i]+1],3);A(t,t.dyn_ltree,e-1),A(t,t.dyn_dtree,n-1)}function k(t){var e,n=4093624447;for(e=0;31>=e;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return N;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return O;for(e=32;W>e;e++)if(0!==t.dyn_ltree[2*e])return O;return N}function E(t){me||(p(),me=!0),t.l_desc=new s(t.dyn_ltree,he),t.d_desc=new s(t.dyn_dtree,de),t.bl_desc=new s(t.bl_tree,pe),t.bi_buf=0,t.bi_valid=0,m(t)}function B(t,e,n,r){u(t,(F<<1)+(r?1:0),3),v(t,e,n,!0)}function P(t){u(t,L<<1,3),c(t,Y,oe),f(t)}function D(t,e,n,r){var i,s,o=0;t.level>0?(t.strm.data_type===R&&(t.strm.data_type=k(t)),w(t,t.l_desc),w(t,t.d_desc),o=x(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,i>=s&&(i=s)):i=s=n+5,i>=n+4&&-1!==e?B(t,e,n,r):t.strategy===C||s===i?(u(t,(L<<1)+(r?1:0),3),_(t,oe,ae)):(u(t,(z<<1)+(r?1:0),3),T(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),_(t,t.dyn_ltree,t.dyn_dtree)),m(t),r&&g(t)}function I(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(ce[n]+W+1)]++,t.dyn_dtree[2*o(e)]++),t.last_lit===t.lit_bufsize-1}var M=t("../utils/common"),C=4,N=0,O=1,R=2,F=0,L=1,z=2,j=3,U=258,G=29,W=256,V=W+1+G,q=30,Z=19,$=2*V+1,H=15,K=16,X=7,Y=256,J=16,Q=17,te=18,ee=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ne=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],re=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ie=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],se=512,oe=new Array(2*(V+2));r(oe);var ae=new Array(2*q);r(ae);var ue=new Array(se);r(ue);var ce=new Array(U-j+1);r(ce);var le=new Array(G);r(le);var fe=new Array(q);r(fe);var he,de,pe,me=!1;n._tr_init=E,n._tr_stored_block=B,n._tr_flush_block=D,n._tr_tally=I,n._tr_align=P},{"../utils/common":62}],74:[function(t,e){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=n},{}]},{},[10])(10)}),t("zip",["SFile","jszip","FileSaver.min","Util","MIMETypes","DeferredUtil"],function(t,e,n,r,i,s){var a={};return a.zip=function(n,r,i){function a(t,e){return e.each(function(e){if(e.isDir()){var n=t.folder(e.name().replace(/[\/\\]$/,""));return a(n,e)}return e.getContent(function(n){t.file(e.name(),n.toArrayBuffer())})})}t.is(r)||(i=r),i=i||{};var u=new e;return a(u,n).then(function(){return s.resolve(u.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(e){return t.is(r)?r.setBytes(e):void o(new Blob([e],{type:"application/zip"}),n.name().replace(/[\/\\]$/,"")+".zip")})},a.unzip=function(n,r,i){var o,a={};i=i||{},t.is(n)&&(o=n.getContent(),n=o.toArrayBuffer()),i.onCheckFile||(i.onCheckFile=function(t){return i.overwrite?t:t.exists()?!1:t});var u=new e;return s.resolve(u.loadAsync(n)).then(function(){return s.each(u.files,function(e,n){return s.resolve(n.async("arraybuffer")).then(function(e){var s=r.rel(n.name);if(console.log("Inflating",n.name),!s.isDir()){var o={file:s,status:"uploaded"};a[s.path()]=o;var u=FS.Content.bin(e,s.contentType()),c=i.onCheckFile(s,u);return c===!1&&(o.status="cancelled",s=null),t.is(c)&&(s.path()!==c.path()&&(o.redirectedTo=c),s=c),s?s.setContent(u):void 0}})})}).then(function(){return console.log("unzip done",a),a})},a.JSZip=e,a}),t("FS",["FS2","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil"],function(t,e,n,r,i,s,o,a,u,c,l,f){var h={};h.assert=o,h.Content=c,h.Class=t,h.DeferredUtil=f,h.Env=s,h.LSFS=n,h.NativeFS=e,h.PathUtil=i,h.RootFS=u,h.SFile=a,h.WebFS=r,h.zip=l,"object"==typeof window&&(window.FS=h);var d,p=new s({});return f.external.Promise=l.JSZip.external.Promise,h.addFSType=t.addFSType,h.availFSTypes=t.availFSTypes,h.setEnvProvider=function(t){p=t},h.getEnvProvider=function(){return p},h.setEnv=function(t,e){if("object"==typeof t)for(var n in t)p.set(n,t[n]);else p.set(t,e)},h.getEnv=function(t){return"string"==typeof t?p.get(t):p.value},h.init=function(t){d||(t||(t="object"==typeof process?new e:new n(localStorage)),d=new u(t))},h.getRootFS=function(){return h.init(),d},h.get=function(){return h.init(),d.get.apply(d,arguments)},h.expandPath=function(){return p.expandPath.apply(p,arguments)},h.resolve=function(t,e){return h.init(),a.is(t)?t:(t=p.expandPath(t),e&&!i.isAbsolutePath(t)?(e=p.expandPath(e),h.get(e).rel(t)):h.get(t))},h.mount=function(){return h.init(),d.mount.apply(d,arguments)},h.unmount=function(){return h.init(),d.unmount.apply(d,arguments)},h.isFile=function(t){return a.is(t)},h});var a;return e(["FS"],function(t){a=t}),void 0===window.FS&&(window.FS=a),a}),requireSimulator.setName("WebSite"),define(["FS"],function(t){var e,n=t.PathUtil,r=document.location.href,i=!!r.match(/html\/dev\//)&&!!r.match(/localhost:3/);if(r.match(/jsrun\.it/))e={urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:i,pluginTop:"http://tonyuedit.appspot.com/js/plugins",removeJSOutput:!0};else if(r.match(/tonyuexe\.appspot\.com/)||r.match(/localhost:8887/)||r.match(/\/html\/((dev)|(build))\//))e={urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/sound_ogg.png":"../../images/sound_ogg.png","images/sound_mp3.png":"../../images/sound_mp3.png","images/sound_mp4.png":"../../images/sound_mp4.png","images/sound_m4a.png":"../../images/sound_m4a.png","images/sound_mid.png":"../../images/sound_mid.png","images/sound_wav.png":"../../images/sound_wav.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:i};else if(r.match(/bitarrow/)||r.match(/localhost.*pub/)){e={};var s=e;e.serverType="BA",s.runtime="../../../runtime/",s.urlAliases={"images/base.png":s.runtime+"images/base.png","images/Sample.png":s.runtime+"images/Sample.png","images/neko.png":s.runtime+"images/neko.png","images/inputPad.png":s.runtime+"images/inputPad.png","images/mapchip.png":s.runtime+"images/mapchip.png","images/sound.png":s.runtime+"images/sound.png","images/sound_ogg.png":s.runtime+"images/sound_ogg.png","images/sound_mp3.png":s.runtime+"images/sound_mp3.png","images/sound_mp4.png":s.runtime+"images/sound_mp4.png","images/sound_m4a.png":s.runtime+"images/sound_m4a.png","images/sound_mid.png":s.runtime+"images/sound_mid.png","images/sound_wav.png":s.runtime+"images/sound_wav.png","images/ecl.png":s.runtime+"images/ecl.png"}}else e={urlAliases:{},top:".",devMode:i};var o=window.navigator.userAgent.toLowerCase();return e.tablet=-1!=o.indexOf("windows")&&-1!=o.indexOf("touch")||-1!=o.indexOf("ipad")||-1!=o.indexOf("android")&&-1==o.indexOf("mobile")||-1!=o.indexOf("firefox")&&-1!=o.indexOf("tablet")||-1!=o.indexOf("kindle")||-1!=o.indexOf("silk")||-1!=o.indexOf("playbook"),e.mobile=-1!=o.indexOf("windows")&&-1!=o.indexOf("phone")||-1!=o.indexOf("iphone")||-1!=o.indexOf("ipod")||-1!=o.indexOf("android")&&-1!=o.indexOf("mobile")||-1!=o.indexOf("firefox")&&-1!=o.indexOf("mobile")||-1!=o.indexOf("blackberry"),e.pluginTop||(e.pluginTop=e.top+"/js/plugins"),e.disableROM={},r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:8888/),(r.match(/\.appspot\.com/)||r.match(/localhost:888[87]/))&&(e.serverType="GAE"),r.match(/localhost:3000/)&&(e.serverType="Node"),e.serverTop=r.match(/tonyuexe\.appspot\.com/)||r.match(/localhost:8887/)?e.top+"/exe":e.top+"/edit",e.sampleImg=e.top+"/images",e.blobPath=e.serverTop+"/serveBlob",e.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),e.mp3Disabled=e.isNW,e.tonyuHome="/Tonyu/",e.url={getDirInfo:e.serverTop+"/getDirInfo",getFiles:e.serverTop+"/File2LSSync",putFiles:e.serverTop+"/LS2FileSync"},e.isNW?(e.cwd=n.directorify(process.cwd()),e.tonyuHome=process.env.TONYU_HOME?n.directorify(process.env.TONYU_HOME):n.rel(e.cwd,"fs/Tonyu/"),e.logdir=process.env.TONYU_LOGDIR,e.wwwDir=n.rel(e.cwd,"www/"),e.platform=process.platform,e.ffmpeg=n.rel(e.cwd,"win32"==e.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),e.pkgInfo=require(n.rel(e.cwd,"package.json")),e.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):e.pkgInfo&&e.pkgInfo.config&&e.pkgInfo.config.prjDirs?e.pkgInfo.config.prjDirs.map(function(t){return t=n.directorify(t),n.isAbsolute(t)?t:n.rel(e.cwd,t)}):[n.rel(e.cwd,"Projects/"),n.rel(e.tonyuHome,"Projects/")],e.kernelDir=n.rel(e.wwwDir,"Kernel/")):(e.wwwDir=location.protocol+"//"+location.host+"/",e.projects=[n.rel(e.tonyuHome,"Projects/")]),(r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:888/))&&(e.kernelDir=location.protocol+"//"+location.host+"/Kernel/"),e.compiledKernel=r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:888/)||e.isNW?e.top+"/Kernel/js/concat.js":"BA"===e.serverType?e.runtime+"lib/tonyu/kernel.js":"http://tonyuexe.appspot.com/Kernel/js/concat.js",t.setEnvProvider(new t.Env(e)),window.WebSite=e}),requireSimulator.setName("plugins"),define(["WebSite"],function(t){function e(t){return"function"==typeof t&&(t={onload:t}),t||(t={}),t.onload||(t.onload=function(){}),t}var n={},r={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/BodyActor/,symbol:"Box2D"},timbre:{src:"timbre.js",detection:/\bplay(SE)?\b/,symbol:"T"}};return n.installed=r,n.detectNeeded=function(t,e){for(var n in r){var i=r[n].detection.exec(t);i&&(e[n]=1)}return e},n.loaded=function(t){var e=r[t];if(!e)throw new Error("plugin not found: "+t);return window[e.symbol]},n.loadAll=function(t,i){function s(){u>=o.length?i.onload():n.load(o[u++],s)}i=e(i);var o=[];for(var a in t)r[a]&&!n.loaded(a)&&o.push(a);var u=0;console.log("loading plugins",o),setTimeout(s,0)},n.load=function(n,i){var s=r[n];if(!s)throw new Error("plugin not found: "+n);i=e(i);var o=t.pluginTop+"/"+s.src;location.href.match(/^file:/)?($("<script>").attr("src",o).appendTo("body"),setTimeout(i.onload,500)):$.getScript(o,i.onload)},n.request=function(t){if(!n.loaded(t)){var e=new Error("Plugin "+t+" required");e.pluginName=t}},n}),requireSimulator.setName("DeferredUtil"),define([],function(){var t;return t={ensureDefer:function(t){var e,n=new $.Deferred;return $.when(t).then(function(t){e?n.resolve(t):setTimeout(function(){n.resolve(t)},0)}).fail(function(t){e?n.reject(t):setTimeout(function(){n.reject(t)},0)}),e=!0,n.promise()},directPromise:function(t){var e=new $.Deferred;return setTimeout(function(){e.resolve(t)},0),e.promise()},then:function(e){return t.directPromise().then(e)},timeout:function(t){var e=new $.Deferred;return setTimeout(function(){e.resolve()},t),e.promise()},funcPromise:function(t){var e=new $.Deferred;return t(function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise()},throwPromise:function(t){var e=new $.Deferred;return setTimeout(function(){e.reject(t)},0),e.promise()},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(n){return console.log(n,n.stack),t.throwPromise(n)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(r){return r>=e.length?t.brk():$.when(n(e[r],r)).then(function(){return r+1})},0);var r=[];for(var i in e)r.push({k:i,v:e[i]});return t.each(r,function(t){return n(t.k,t.v)})},loop:function(e,n){return t.directPromise(n).then(t.throwF(function(){var n=e.apply(this,arguments);return n.DU_BRK?n.res:$.when(n).then(function(n){return t.loop(e,n)})}))},brk:function(t){return{DU_BRK:!0,res:t}},tryLoop:function(e,n){return t.loop(t.tr(e),n)},tryEach:function(e,n){return t.loop(e,t.tr(n))},documentReady:function(){return t.callbackToPromise(function(t){$(t)})},requirejs:function(e){if(!window.requirejs)throw new Error("requirejs is not loaded");return t.callbackToPromise(function(t){window.requirejs(e,t)})}},t.begin=t.try=t.tr=t.throwF,t.promise=t.callbackToPromise=t.funcPromise,t}),requireSimulator.setName("assert"),define(["FS"],function(t){return t.assert}),requireSimulator.setName("compiledProject"),define(["DeferredUtil","WebSite","assert"],function(t,e,n){var r=function(r,i){return n.is(arguments,[String,String]),{getNamespace:function(){return r},sourceDir:function(){return null},getDependingProjects:function(){return[]},loadDependingClasses:function(e){var n=t.directPromise(),r=this.getNamespace();
return this.getDependingProjects().forEach(function(t){t.getNamespace()!=r&&(n=n.then(function(){return t.loadClasses(e)}))}),n},loadClasses:function(t){console.log("Loading compiled classes ns=",r,"url=",i);var n=i+("BA"===e.serverType?"?"+Math.random():""),s=this;return this.loadDependingClasses(t).then(function(){return s.requirejs(n)}).then(function(){console.log("Done Loading compiled classes ns=",r,"url=",n,Tonyu.classes)})},requirejs:function(e){return t.promise(function(t){var n=document.getElementsByTagName("head")[0]||document.documentElement,r=document.createElement("script");r.src=e;var i=!1;r.onload=r.onreadystatechange=function(){i||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i=!0,console.log("Done load ",e),r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r),t())},n.insertBefore(r,n.firstChild)})},loadClassesOLD:function(t){console.log("Load compiled classes ns=",r,"url=",i);var n=new $.Deferred,s=document.getElementsByTagName("head")[0]||document.documentElement,o=document.createElement("script");o.src=i+("BA"===e.serverType?"?"+Math.random():"");var a=!1;return o.onload=o.onreadystatechange=function(){a||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(a=!0,o.onload=o.onreadystatechange=null,s&&o.parentNode&&s.removeChild(o),console.log("Done Load compiled classes ns=",r,"url=",i,Tonyu.classes),n.resolve())},this.loadDependingClasses(t).then(function(){s.insertBefore(o,s.firstChild)}),n.promise()}}};return r}),requireSimulator.setName("compiledTonyuProject"),define(["plugins","compiledProject"],function(t,e){var n=function(n,r,i){var s=e(n,r),o=e("kernel",WebSite.compiledKernel),a={getDir:function(){return i},getDependingProjects:function(){return[o]},getOptions:function(){var t=this.getDir().rel("options.json");return t.obj()},getResource:function(){var t=this.getDir().rel("res.json");return t.obj()},loadPlugins:function(e){var n=this.getOptions();return t.loadAll(n.plugins,e)},requestPlugin:function(){},run:function(t){var e={classes:Tonyu.classMetas};this.loadClasses(e).then(function(){Tonyu.run(t)})}};for(var u in a)s[u]=a[u];return s};return n}),requireSimulator.setName("Shell"),define(["FS","assert"],function(t,e){function n(e,n){var i=r(e);if(t.SFile.is(i)||console.log(i," is not file"),n&&!i.exists())throw new Error(i+": no such file or directory");return i}function r(e){if("string"!=typeof e)return e;var n=i.cwd;return s.isAbsolutePath(e)?t.resolve(e,n):n.rel(e)}var i={},s=e(t.PathUtil);return i.newCommand=function(t,e){this[t]=e},i.cd=function(t){return i.cwd=n(t,!0),i.pwd()},i.vars=Object.create(t.getEnv()),i.mount=function(e,n){if(!e||!e.t){var r=[];for(var i in t.getRootFS().availFSTypes())r.push(i);return void sh.err("-t=("+r.join("|")+") should be specified.")}t.mount(n,e.t,e)},i.unmount=function(e){t.unmount(e)},i.fstab=function(){var e=t.getRootFS(),n=e.fstab(),r=this;n.forEach(function(t){r.echo(t.fstype()+"	"+(t.mountPoint||"<Default>"))})},i.resolve=n,i.pwd=function(){return i.cwd+""},i.ls=function(t){return t=t?n(t,!0):i.cwd,t.ls()},i.cp=function(t,e,r){r||(r={}),r.v&&(i.echo("cp",t,e),r.echo=i.echo.bind(i));var s=n(t,!0),o=n(e);return s.copyTo(o,r)},i.ln=function(t,e,r){var i=n(e),s=n(t,!0);if(i.isDir()&&i.exists()&&(i=i.rel(s.name())),i.exists())throw new Error(i+" exists");return i.link(s,r)},i.rm=function(t,e){if(e||(e={}),e.notrash)return t=n(t,!1),t.removeWithoutTrash(),1;if(t=n(t,!0),t.isDir()&&e.r){var r=t,s=0;return r.each(function(t){t.exists()&&(s+=i.rm(t,e))}),r.rm(),s+1}return t.rm(),1},i.mkdir=function(t){if(t=n(t,!1),t.exists())throw new Error(t+" : exists");return t.mkdir()},i.cat=function(t){return t=n(t,!0),i.echo(t.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}))},i.resolve=function(t){return t||(t="."),t=n(t)},i.grep=function(t,e,r){function s(t,e,n){r.res&&r.res.push({file:t,lineNo:e,line:n}),i.echo(t+"("+e+"): "+n)}return e=n(e,!0),r||(r={}),r.res||(r.res=[]),e.isDir()?e.each(function(e){i.grep(t,e,r)}):"string"==typeof t&&e.lines().forEach(function(n,r){n.indexOf(t)>=0&&s(e,r+1,n)}),r.res},i.touch=function(t){return t=n(t),t.text(t.exists()?t.text():""),1},i.setout=function(t){i.outUI=t},i.echo=function(){return $.when.apply($,arguments).then(function(){console.log.apply(console,arguments),i.outUI&&i.outUI.log&&i.outUI.log.apply(i.outUI,arguments)})},i.err=function(t){console.log.apply(console,arguments),t&&t.stack&&console.log(t.stack),i.outUI&&i.outUI.err&&i.outUI.err.apply(i.outUI,arguments)},i.clone=function(){var t=Object.create(this);return t.vars=Object.create(this.vars),t},i.getvar=function(t){return this.vars[t]||process&&process.env[t]},i.get=i.getvar,i.set=function(t,e){return this.vars[t]=e},i.strcat=function(){if(1==arguments.length)return arguments[0];for(var t="",e=0;e<arguments.length;e++)t+=arguments[e];return t},i.exists=function(t){return t=this.resolve(t),t.exists()},i.dl=function(t){return t=this.resolve(t||"."),t.download()},i.zip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.zip.apply(t.zip,n)},i.unzip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.unzip.apply(t.zip,n)},i.prompt=function(){},i.ASYNC={r:"SH_ASYNC"},i.help=function(){for(var t in i){var e=i[t];"function"==typeof e&&i.echo(t+(e.description?" - "+e.description:""))}},window.sh||(window.sh=i),"object"==typeof process?(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()},sh.cd(process.cwd().replace(/\\/g,"/"))):sh.cd("/"),i}),requireSimulator.setName("Klass"),define(["assert"],function(t){function e(t){if("object"!=typeof t)return!1;if(!t)return!1;var e={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},n=0;for(var r in t){if(!e[r])return!1;n+=e[r]}return n}var n={};return n.define=function(r){function i(e){r.$fields&&t.is(e,r.$fields)}var s,o;r.$parent?(o=r.$parent,s=Object.create(o.prototype),s.super=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return o.prototype[e].apply(this,t)}):s={};var a,u=r.$||function(t){if(t&&"object"==typeof t)for(var e in t)this[e]=t[e]};u instanceof Array&&(a=u,u=function(){for(var t=Array.prototype.slice.call(arguments),e=0;e<a.length;e++)t.length>0&&(this[a[e]]=t.shift())});var c;c=function(){if(!(this instanceof c)){var t=Object.create(s);return u.apply(t,arguments),i(t),t}u.apply(this,arguments),i(this)},o&&(c.super=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift();return o.prototype[n].apply(e,t)}),c.inherit=function(t){return t.$parent=c,n.define(t)},c.prototype=s;for(var l in r)"$"!=l[0]&&("static$"==l.substring(0,7)?c[l.substring(7)]=r[l]:e(r[l])?Object.defineProperty(s,l,r[l]):s[l]=r[l]);return s.$=u,c},n.Function=function(){throw new Exception("Abstract")},n.opt=t.opt,n}),requireSimulator.setName("Tonyu.Thread"),define(["DeferredUtil","Klass"],function(t,e){var n={enterC:{},exitC:0};try{window.cnts=n}catch(r){}var i=e.define({$:function(){this.frame=null,this._isDead=!1,this.cnt=0,this._isWaiting=!1,this.fSuspended=!1,this.tryStack=[],this.preemptionTime=60,this.onEndHandlers=[],this.onTerminateHandlers=[],this.age=0},isAlive:function(){return!this.isDead()},isDead:function(){return this._isDead=this._isDead||null==this.frame||this._threadGroup&&(this._threadGroup.objectPoolAge!=this.tGrpObjectPoolAge||this._threadGroup.isDeadThreadGroup())},setThreadGroup:function(t){this._threadGroup=t,this.tGrpObjectPoolAge=t.objectPoolAge},isWaiting:function(){return this._isWaiting},suspend:function(){this.fSuspended=!0,this.cnt=0},enter:function(t){this.frame={prev:this.frame,func:t}},apply:function(t,e,n){n||(n=[]);var r;if("string"==typeof e&&(r=t["fiber$"+e],!r))throw new Error("メソッド"+e+"が見つかりません");"function"==typeof e&&(r=e.fiber),n=[this].concat(n);var i=0;return this.enter(function(e){switch(i){case 0:r.apply(t,n),i=1;break;case 1:e.termStatus="success",e.notifyEnd(e.retVal),n[0].exit(),i=2}})},notifyEnd:function(t){this.onEndHandlers.forEach(function(e){e(t)}),this.notifyTermination({status:"success",value:t})},notifyTermination:function(t){this.onTerminateHandlers.forEach(function(e){e(t)})},on:function(t,e){("end"===t||"success"===t)&&this.onEndHandlers.push(e),"terminate"===t&&(this.onTerminateHandlers.push(e),this.handleEx&&delete this.handleEx)},promise:function(){var e=this;return t.funcPromise(function(t,n){e.on("terminate",function(e){"success"===e.status?t(e.value):n("exception"===e.status?e.exception:new Error(e.status))})})},then:function(t,e){return e?this.proimse().then(t,e):this.proimse().then(t)},fail:function(t){return this.promise().fail(t)},gotoCatch:function(t){var e=this;if(0==e.tryStack.length)return e.termStatus="exception",e.kill(),void(e.handleEx?e.handleEx(t):e.notifyTermination({status:"exception",exception:t}));e.lastEx=t;for(var n=e.tryStack.pop();e.frame;){if(n.frame===e.frame){e.catchPC=n.catchPC;break}e.frame=e.frame.prev}},startCatch:function(){var t=this,e=t.lastEx;return t.lastEx=null,e},exit:function(t){this.frame=this.frame?this.frame.prev:null,this.retVal=t},enterTry:function(t){var e=this;e.tryStack.push({frame:e.frame,catchPC:t})},exitTry:function(){var t=this;t.tryStack.pop()},waitEvent:function(t,e){var n=this;if(n.suspend(),t.on){var r;e=e.concat(function(){n.lastEvent=arguments,n.retVal=arguments[0],r.remove(),n.steps()}),r=t.on.apply(t,e)}},runAsync:function(t){var e=this,n=function(){e.retVal=arguments,e.steps()},r=function(){for(var t="",n=0;n<arguments.length;n++)t+=arguments[n]+",";0==t.length&&(t="Async fail");var r=new Error(t);r.args=arguments,e.gotoCatch(r),e.steps()};e.suspend(),setTimeout(function(){t(n,r)},0)},waitFor:function(e){var n=this;return n._isWaiting=!0,n.suspend(),e instanceof i&&(e=e.promise()),t.ensureDefer(e).then(function(t){n.retVal=t,n.stepsLoop()}).fail(function(t){if(t instanceof Error)n.gotoCatch(t);else{var e=new Error(t);e.original=t,n.gotoCatch(e)}n.stepsLoop()})},resume:function(t){this.retVal=t,this.steps()},steps:function(){var t=this;if(!t.isDead()){var e=Tonyu.currentThread;for(Tonyu.currentThread=t,t.cnt=t.preemptionTime,t.preempted=!1,t.fSuspended=!1;t.cnt>0&&t.frame;)try{for(;t.cnt-->0&&t.frame;)t.frame.func(t);t.preempted=!t.fSuspended&&t.isAlive()}catch(n){t.gotoCatch(n)}Tonyu.currentThread=e}},stepsLoop:function(){var t=this;t.steps(),t.preempted&&setTimeout(function(){t.stepsLoop()},0)},kill:function(){var t=this;t._isDead=!0,t.frame=null,t.termStatus||(t.termStatus="killed",t.notifyTermination({status:"killed"}))},clearFrame:function(){this.frame=null,this.tryStack=[]}});return i}),requireSimulator.setName("Tonyu.Iterator"),define(["Klass"],function(t){function e(t,e){if(t.tonyuIterator)return t.tonyuIterator(e);if(t instanceof Array)return 1==e?new n(t):new r(t);if(t instanceof Object)return 1==e?new i(t):new s(t);throw console.log(t),new Error(t+" is not iterable")}var n=t.define({$:function(t){this.set=t,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.set[this.i],this.i++,!0)}}),r=t.define({$:function(t){this.set=t,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.i,this[1]=this.set[this.i],this.i++,!0)}}),i=t.define({$:function(t){this.elems=[];for(var e in t)this.elems.push(e);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i],this.i++,!0)}}),s=t.define({$:function(t){this.elems=[];for(var e in t)this.elems.push([e,t[e]]);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i][0],this[1]=this.elems[this.i][1],this.i++,!0)}});return e}),requireSimulator.setName("Tonyu"),"function"!=typeof define&&(define=require("requirejs").define),define(["assert","Tonyu.Thread","Tonyu.Iterator","DeferredUtil"],function(t,e,n,r){return Tonyu=function(){function i(){var t=new e;return t.handleEx=a,t}function s(t){return r.funcPromise(function(e){setTimeout(e,t)})}function o(){return r.funcPromise(function(t){requestAnimationFrame(t)})}function a(t){if(!Tonyu.onRuntimeError)throw"undefined"==typeof $LASTPOS&&($LASTPOS=0),alert("エラー! at "+$LASTPOS+" メッセージ  : "+t),console.log(t.stack),t;Tonyu.onRuntimeError(t)}function u(e,n){return t.is(arguments,[String,Object]),l(klass.getMeta(e),n)}function c(t,e){return t?l(Object.create(t.prototype),e):e}function l(t,e){if(e&&"object"==typeof e)for(var n in e)t[n]=e[n];return t}function f(t,e){k[t]=e}function h(t){return k[t]}function d(t){var e=t.split("."),n=E;if(e.forEach(function(t){n&&(n=n[t])}),!n&&1==e.length){var r;for(var i in E){var s=E[i][t];if(s){if(n)throw new Error("曖昧なクラス名： "+i+"."+t+", "+r);n=s,r=i+"."+t}}}return n}function p(t,e){if("function"!=typeof e)return e;var n=function(){return e.apply(t,arguments)};return n.methodInfo=Tonyu.extend({thiz:t},e.methodInfo||{}),e.fiber&&(n.fiber=function(){return e.fiber.apply(t,arguments)},n.fiber.methodInfo=Tonyu.extend({thiz:t},e.fiber.methodInfo||{})),n}function m(t,e,n,r){if(!t)throw new Error(r+"(="+t+")のメソッド "+e+"を呼び出せません");var i=t[e];if("function"!=typeof i)throw new Error(("this"==r?"":r+".")+e+"(="+i+")はメソッドではありません");return i.apply(t,n)}function g(t,e,n){if("function"!=typeof t)throw new Error(n+"は関数ではありません");return t.apply({},e)}function v(t,e){if(t!=t||null==t)throw new Error(e+"(="+t+")は初期化されていません");return t}function y(t){for(var e=[],n=1;n<t.length;n++)e[n-1]=t[n];return e}function b(t){throw new Error("クラス名"+t+"はnewをつけて呼び出して下さい。")}function _(t){throw console.log("Not a tonyu object: ",t),new Error(t+" is not a tonyu object")}function w(t,e){return t in e}function S(t){var e=d(t);if(!e)throw new Error(t+" というクラスはありません");Tonyu.runMode=!0;var n,r=new e;(n=Tonyu.currentProject)&&(n.runningObj=r),$LASTPOS=0}function A(){var t=(new Date).getTime();if(t-P>1e3)throw x(1e4),new Error("無限ループをストップしました"+(t-T));T=t}function x(t){P=(new Date).getTime()+(t||0)}klass=function(){throw alert("この関数は古くなりました。コンパイルをやり直してください。 Deprecated. compile again."),new Error("この関数は古くなりました。コンパイルをやり直してください。 Deprecated. compile again.")},klass.addMeta=u,klass.removeMeta=function(t){delete B[t]},klass.getMeta=function(t){if("function"==typeof t)return t.meta;if("string"==typeof t){var e=B[t];return e||(B[t]=e={}),e}},klass.ensureNamespace=function(t,e){var n,r=e.split("."),i=t;for(n=0;n<r.length;n++){var s=r[n];i[s]||(i[s]={}),i=i[s]}return i},Function.prototype.constructor=function(){throw new Error("This method should not be called")},klass.define=function(t){var e=t.superclass,n=t.includes,r=t.fullName,i=t.shortName,s=t.namespace,o=t.methods,a=t.decls,l=klass.ensureNamespace(Tonyu.classes,s),f=o,h=f.initialize;delete f.initialize;var d;d=h?function(){this instanceof d||b(r),h.apply(this,arguments)}:e?function(){this instanceof d||b(r),e.apply(this,arguments)}:function(){this instanceof d||b(r)},l[i]=d,d.methods=f,n.forEach(function(t){if(!t.methods)throw t+" Does not have methods";for(var e in t.methods)e in f||(f[e]=t.methods[e])});var p={},m=/^__([gs]et)ter__(.*)$/;for(var g in f)if(!g.match(/^fiber\$/)){f["fiber$"+g]&&(f[g].fiber=f["fiber$"+g],f[g].fiber.methodInfo={name:g,klass:d,fiber:!0}),f[g].methodInfo={name:g,klass:d};var v=m.exec(g);v&&(p[v[2]]=p[v[2]]||{},p[v[2]][v[1]]=f[g])}d.prototype=c(e,f),d.prototype.isTonyuObject=!0;for(var g in p)Object.defineProperty(d.prototype,g,p[g]);d.meta=u(r,{fullName:r,shortName:i,namepsace:s,decls:a,superclass:e?e.meta:null,func:d,includes:n.map(function(t){return t.meta})});var y=klass.getMeta(d);return d.prototype.getClassInfo=function(){return y},d},klass.isSourceChanged=function(t){return t=t.meta||t,t.src&&t.src.tonyu?t.nodeTimestamp?t.src.tonyu.lastUpdate()>t.nodeTimestamp:!0:!1},klass.shouldCompile=function(t){if(t=t.meta||t,klass.isSourceChanged(t))return!0;for(var e=klass.getDependingClasses(t),n=0;n<e.length;n++)if(klass.shouldCompile(e[n]))return!0},klass.getDependingClasses=function(t){t=t.meta||t;var e=[];return t.superclass&&(e=[t.superclass]),t.includes&&(e=e.concat(t.includes)),e};var T,k={},E={},B={},P=(new Date).getTime();return setInterval(x,16),Tonyu={thread:i,klass:klass,bless:c,extend:l,globals:k,classes:E,classMetas:B,setGlobal:f,getGlobal:h,getClass:d,timeout:s,animationFrame:o,bindFunc:p,not_a_tonyu_object:_,hasKey:w,invokeMethod:m,callFunc:g,checkNonNull:v,run:S,iterator:n,checkLoop:A,resetLoopCheck:x,VERSION:1511935986846,A:y}}()}),requireSimulator.setName("PatternParser"),define(["Tonyu"],function(t){var e=function(t,e){this.options=e||{},this.img=t,this.height=t.height,this.width=t.width;var n=this.newImage(t.width,t.height),r=n.getContext("2d");r.drawImage(t,0,0),this.ctx=r,this.pixels=this.ctx.getImageData(0,0,t.width,t.height).data,this.base=this.getPixel(0,0)};return t.extend(e.prototype,{newImage:function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n},getPixel:function(t,e){var n=this.pixels,r=4*(t+e*this.width),i=n[0+r],s=n[1+r],o=n[2+r],a=n[3+r];return 256*(256*(256*a+o)+s)+i},setPixel:function(t,e,n){var r=4*(t+e*this.width);this.pixels[0+r]=255&n,n=(n-(255&n))/256,this.pixels[1+r]=255&n,n=(n-(255&n))/256,this.pixels[2+r]=255&n,n=(n-(255&n))/256,this.pixels[3+r]=255&n},parse:function(){try{for(var t=[],e=0;e<this.height;e++)for(var n=0;n<this.width;n++){var r=this.getPixel(n,e);r!=this.base&&t.push(this.parse1Pattern(n,e))}return t}catch(i){if(i.isParseError)return console.log("parse error! "+i),[{image:this.img,x:0,y:0,width:this.width,height:this.height}];throw i}},parse1Pattern:function(t,e){function n(t){return t}function r(t,e,n){return{toString:function(){return"at ("+t+","+e+") :"+n},isParseError:!0}}for(var i=this.getPixel(t,e),s=t,o=e,a=this.base,u=this.width,c=this.height;u>s;){var l=this.getPixel(s,o);if(l!=i)break;s++}if(s>=u||this.getPixel(s,o)!=a)throw r(s,o,n(this.getPixel(s,o))+"!="+n(a));for(s--;c>o&&this.getPixel(s,o)==i;)o++;if(o>=c||this.getPixel(s,o)!=a)throw r(s,o,n(this.getPixel(s,o))+"!="+n(a));o--;var f=t+1,h=e+1,d=s-f,p=o-h;if(console.log("PP",f,h,d,p,s,o),d*p==0)throw r(s,o,"w*h==0");for(var m=this.newImage(d,p),g=m.getContext("2d"),v=g.getImageData(0,0,d,p),y=v.data,b=0,_=h;o>_;_++)for(var w=f;s>w;w++){var S=this.getPixel(w,_);S==i?(y[b++]=0,y[b++]=0,y[b++]=0,y[b++]=0):(y[b++]=255&S,S=(S-(255&S))/256,y[b++]=255&S,S=(S-(255&S))/256,y[b++]=255&S,S=(S-(255&S))/256,y[b++]=255&S)}g.putImageData(v,0,0);for(var A=h-1;o>=A;A++)for(var x=f-1;s>=x;x++)this.setPixel(x,A,a);return this.options.boundsInSrc?{x:f,y:h,width:d,height:p}:{image:m,x:0,y:0,width:d,height:p}}}),e}),requireSimulator.setName("Util"),Util=function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:e(i[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function r(t,e){return t.substring(0,e.length)===e}function i(t){function e(e){throw console.log(e),console.log(t,c),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var r,i=t.length,s=0,o=0;if(!i)return new ArrayBuffer(0);r=Math.floor(i/4*3),"="==t.charAt(i-1)&&(r-=1),"="==t.charAt(i-2)&&(r-=1);for(var a=new ArrayBuffer(r),u=new Uint8Array(a),c=0,l=0;r>l&&(o=n[t.charCodeAt(c)],void 0===o&&e("Invalid letter: "+t.charCodeAt(c)),s=o<<2,c++,o=n[t.charCodeAt(c)],void 0===o&&e("Invalid letter: "+t.charCodeAt(c)),u[l]=s|o>>4&3,s=(15&o)<<4,c++,l++,!(l>=r))&&(o=n[t.charCodeAt(c)],void 0===o&&e("Invalid letter: "+t.charCodeAt(c)),u[l]=s|o>>2&15,s=(3&o)<<6,c++,l++,!(l>=r));)o=n[t.charCodeAt(c)],void 0===o&&e("Invalid letter: "+t.charCodeAt(c)),u[l]=s|o,c++,l++;return a}function s(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(t),i=r.length,s=0,o=0,a=0;i>a&&(o=r[a],n+=e[o>>2],s=(3&o)<<4,a++,!(a>=i))&&(o=r[a],n+=e[s|o>>4],s=(15&o)<<2,a++,!(a>=i));)o=r[a],n+=e[s|o>>6],n+=e[63&o],a++;var u=i%3;return u&&(n+=e[s]),1==u?n+="==":2==u&&(n+="="),n}function o(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var r=t[n];n.match(/^_/)||"function"==typeof r&&(e[n]=function(){var e=r.apply(t,arguments);return e})}(n);return e}function a(){return"undefined"!=typeof Buffer}function u(t){return a()&&t instanceof Buffer}function c(t){return t instanceof ArrayBuffer||u(t)}function l(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(r){throw console.log(e.join("")),r}}function f(t,e){for(var n=encodeURIComponent(t),r=/^%(..)/,i=[],s=0;s<n.length;s++){var o=r.exec(n.substring(s));o?(i.push(parseInt("0x"+o[1])),s+=o[0].length-1):i.push(n.charCodeAt(s))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(i):new Uint8Array(i).buffer}return{getQueryString:t,endsWith:n,startsWith:r,Base64_To_ArrayBuffer:i,Base64_From_ArrayBuffer:s,utf8bytes2str:l,str2utf8bytes:f,privatize:o,hasNodeBuffer:a,isNodeBuffer:u,isBuffer:c}}(),requireSimulator.setName("Assets"),define(["WebSite","Util","Tonyu","FS"],function(t,e,n,r){var i={};return i.resolve=function(n,i){var s=r.isFile(i)?i:i.getDir();if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,n){return t[n]}),t.urlAliases[n]&&(n=t.urlAliases[n]),e.startsWith(n,"ls:")){var o=n.substring("ls:".length);if(!s)throw new Error("Basedir not specified");var a=s.rel(o);if(!a.exists())throw new Error("Resource file not found: "+a);if(t.mp3Disabled&&o.match(/\.(mp3|mp4|m4a)$/)){var u=s.rel(o.replace(/\.(mp3|mp4|m4a)$/,".ogg"));u.exists()&&(a=u)}n=a.getURL()}return n},n.Assets=i,i}),requireSimulator.setName("ImageList"),define(["PatternParser","Util","Assets","assert"],function(t,e,n,r){function i(t){var e=[];return t.forEach(function(t){t&&""!=t.url&&e.push(t)}),e}var s,o={};return s=function(e,s,a){a||(a={}),e=i(e);var u=[],c=e.length;0==c&&setTimeout(function(){var t=[];t.names={},s(t)},0),e.forEach(function(e,i){function l(){var n,o;if("single"==e.type)u[i]=[{image:this,x:0,y:0,width:this.width,height:this.height}];else if((n=e.pwidth)&&(o=e.pheight)){for(var a=0,l=0,f=this.width,h=this.height,d=[];;){var p=n,m=o;if(a+n>f&&(p=f-a),l+o>h&&(m=h-l),d.push({image:this,x:a,y:l,width:p,height:m}),a+=n,a+n>f&&(a=0,l+=o,l+o>h))break}u[i]=d}else{var g=new t(this);u[i]=g.parse()}if(u[i].name=e.name,r.is(u[i],Array),c--,0==c){var v=[],y={};u.forEach(function(t){y[t.name]=v.length,v=v.concat(t)}),v.names=y,s(v)}}console.log("loading",e,i);var f=e.url,h=f;if(o[h])return void l.apply(o[h],[]);f=n.resolve(f,a.prj||a.baseDir);var d=$("<img>");d.load(function(){o[h]=this,l.apply(this,[])}),d.attr("src",f)})},s.load=s,s.parse1=function(e,n,i){var s,o,a;if((s=e.pwidth)&&(o=e.pheight)){for(var u=0,c=0,l=n.width,f=n.height,h=[];;)if(h.push({image:this,x:u,y:c,width:s,height:o}),u+=s,u+s>l&&(u=0,c+=o,c+o>f))break;a=h}else{var d=new t(n,i);a=d.parse()}return a.name=e.name,r.is(a,Array)},window.ImageList=s,s}),requireSimulator.setName("PicoAudio");var PicoAudio=function(){function t(t,e){var n=window.AudioContext||window.webkitAudioContext;this.context=t?t:new n,this.settings={masterVolume:1,generateVolume:.15,tempo:120,basePitch:440,resolution:480,hashLength:this.isAndroid()?25:50,hashBuffer:2,isWebMIDI:!1,WebMIDIPortOutputs:null,WebMIDIPortOutput:null,WebMIDIPort:-1,WebMIDIPortSysEx:!0,isReverb:!this.isAndroid(),reverbVolume:1.5,isChorus:!0,chorusVolume:.5,isCC111:!0,dramMaxPlayLength:.5,loop:!1},this.trigger={isNoteTrigger:!0,noteOn:function(){},noteOff:function(){},songEnd:function(){}},this.states={isPlaying:!1,playIndex:0,startTime:0,stopTime:0,stopFuncs:[],webMIDIWaitState:null,webMIDIStopTime:0},this.hashedDataList=[],this.hashedMessageList=[],this.channels=[],this.tempoTrack=[{timing:0,value:120},{timing:0,value:120}],this.cc111Time=-1;for(var r=0;17>r;r++)this.channels.push([0,0,1]);if(e&&e.whitenoise)this.whitenoise=e.whitenoise;else{this.whitenoise=this.context.createBuffer(2,this.context.sampleRate,this.context.sampleRate);for(var i=0;2>i;i++)for(var r=0;r<this.context.sampleRate;r++)this.whitenoise.getChannelData(i)[r]=2*Math.random()-1}if(this.masterGainNode=this.context.createGain(),this.masterGainNode.gain.value=this.settings.masterVolume,e&&e.impulseResponse)this.impulseResponse=e.impulseResponse;else{var s=3.5*this.context.sampleRate;this.impulseResponse=this.context.createBuffer(2,s,this.context.sampleRate);for(var i=0;2>i;i++)for(var o=this.impulseResponse.getChannelData(i),r=0;s>r;r++){var a=(s-r)/s,u=r/this.context.sampleRate,c=(.03>u?0:a)*(u>=.03&&.031>u?2*a:a)*(u>=.04&&.042>u?1.5*a:a)*(u>=.05&&.054>u?1.25*a:a)*Math.random()*.2*Math.pow(a-.03,4);o[r]=c}}this.convolver=this.context.createConvolver(),this.convolver.buffer=this.impulseResponse,this.convolver.normalize=!1,this.convolverGainNode=this.context.createGain(),this.convolverGainNode.gain.value=this.settings.reverbVolume,this.convolver.connect(this.convolverGainNode),this.convolverGainNode.connect(this.masterGainNode),this.masterGainNode.connect(this.context.destination),this.chorusDelayNode=this.context.createDelay(),this.chorusGainNode=this.context.createGain(),this.chorusOscillator=this.context.createOscillator(),this.chorusLfoGainNode=this.context.createGain(),this.chorusDelayNode.delayTime.value=.025,this.chorusLfoGainNode.gain.value=.01,this.chorusOscillator.frequency.value=.05,this.chorusGainNode.gain.value=this.settings.chorusVolume,this.chorusOscillator.connect(this.chorusLfoGainNode),this.chorusLfoGainNode.connect(this.chorusDelayNode.delayTime),this.chorusDelayNode.connect(this.chorusGainNode),this.chorusGainNode.connect(this.masterGainNode),this.masterGainNode.connect(this.context.destination),this.chorusOscillator.start(0),this.onSongEndListener=null}return t.prototype.createNote=function(t){var e=!1;if(t.channel)switch(this.channels[t.channel][1]/10||t.instrument){case.2:case 12:case 13:case 45:case 55:e=!0}var n=this.createBaseNote(t,!0,!1,e),r=n.oscillator,i=n.gainNode,s=(n.panNode,n.noiseCutGainNode),o=!1,a=this;switch(this.channels[n.channel][0]/10||t.instrument){case.1:case 6:case 15:case 24:case 26:case 46:case 50:case 51:case 52:case 53:case 54:case 82:case 85:case 86:r.type="sine",i.gain.value*=1.5;break;case.2:case 4:case 12:case 13:case 16:case 19:case 20:case 32:case 34:case 45:case 48:case 49:case 55:case 56:case 57:case 61:case 62:case 63:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 84:r.type="square",i.gain.value*=.8;break;case.3:case 0:case 1:case 2:case 3:case 6:case 7:case 17:case 18:case 21:case 22:case 23:case 27:case 28:case 29:case 30:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 47:case 59:case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 82:case 87:r.type="sawtooth";break;case.4:case 8:case 9:case 10:case 11:case 14:case 25:case 31:case 33:case 35:case 58:case 60:case 83:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:r.type="triangle",i.gain.value*=1.5;break;default:r.type="square"}switch(this.channels[n.channel][1]/10||t.instrument){case.2:case 12:case 13:case 45:case 55:o=!0,i.gain.value*=1.1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(0,n.start+.2),a.stopAudioNode(r,n.start+.5,i);break;case.3:case 0:case 1:case 2:case 3:case 6:case 9:case 11:case 14:case 15:case 32:case 36:case 37:case 46:case 47:i.gain.value*=1.1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(.95*i.gain.value,n.start+.1),i.gain.setValueAtTime(.95*i.gain.value,n.start+.1),i.gain.linearRampToValueAtTime(0,n.start+1.5+3*n.velocity);break;case.4:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 34:i.gain.value*=1.1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(0,n.start+1+4*n.velocity);break;case.5:case 4:case 5:case 7:case 8:case 10:case 33:case 35:i.gain.value*=1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(.95*i.gain.value,n.start+.1),i.gain.setValueAtTime(.95*i.gain.value,n.start+.1),i.gain.linearRampToValueAtTime(0,n.start+2+10*n.velocity);break;case 119:i.gain.value=0,a.stopAudioNode(r,0,i)}return("sine"==r.type||"triangle"==r.type)&&!o&&n.stop-n.start>.01&&(s.gain.setValueAtTime(1,n.stop-.005),s.gain.linearRampToValueAtTime(0,n.stop)),function(){a.stopAudioNode(r,0,i)}},t.prototype.createPercussionNote=function(t){var e=this.createBaseNote(t,!1),n=e.oscillator,r=e.gainNode,i=(e.panNode,e.start),s=(e.stop,e.velocity*((t.expression?t.expression[0].value:100)/127)),o=this.createBaseNote(t,!1,!0),a=o.oscillator,u=o.gainNode,c=(o.panNode,this);switch(t.pitch){case 35:case 36:r.gain.value=.6*s,n.playbackRate.value=.02,c.stopAudioNode(n,i+.07,r),u.gain.value=1.1*s,a.frequency.setValueAtTime(120,i),a.frequency.linearRampToValueAtTime(50,i+.07),c.stopAudioNode(a,i+.07,u);break;case 38:case 40:n.playbackRate.value=.7,c.stopAudioNode(n,i+.05,r),u.gain.setValueAtTime(.8*s,i),u.gain.linearRampToValueAtTime(0,i+.05),a.frequency.setValueAtTime(300,i),a.frequency.linearRampToValueAtTime(200,i+.05),c.stopAudioNode(a,i+.05,u);break;case 41:case 43:case 45:case 47:case 48:case 50:n.playbackRate.value=.01,c.stopAudioNode(n,i+.1,r),a.type="square",u.gain.setValueAtTime(s,i),u.gain.linearRampToValueAtTime(.01,i+.1),a.frequency.setValueAtTime(150+20*(t.pitch-40),i),a.frequency.linearRampToValueAtTime(50+20*(t.pitch-40),i+.1),c.stopAudioNode(a,i+.1,u);break;case 42:case 44:n.playbackRate.value=1.5,c.stopAudioNode(n,i+.02,r),c.stopAudioNode(a,0,u);break;case 46:n.playbackRate.value=1.5,c.stopAudioNode(n,i+.3,r),r.gain.setValueAtTime(.9*s,i),r.gain.linearRampToValueAtTime(0,i+.3),c.stopAudioNode(a,0,u);break;case 49:case 51:case 52:case 53:case 55:case 57:n.playbackRate.value=1.2,c.stopAudioNode(n,i+.5,r),r.gain.setValueAtTime(1*s,i),r.gain.linearRampToValueAtTime(0,i+.5),c.stopAudioNode(a,0,u);break;case 51:n.playbackRate.value=1.1,c.stopAudioNode(n,i+.4,r),r.gain.setValueAtTime(.8*s,i),r.gain.linearRampToValueAtTime(0,i+.4),c.stopAudioNode(a,0,u);break;case 59:n.playbackRate.value=1.8,c.stopAudioNode(n,i+.3,r),r.gain.setValueAtTime(.5*s,i),r.gain.linearRampToValueAtTime(0,i+.3),c.stopAudioNode(a,0,u);break;case 60:case 61:n.playbackRate.value=.03,c.stopAudioNode(n,i+.03,r),u.gain.setValueAtTime(.8*s,i),u.gain.linearRampToValueAtTime(0,i+.1),a.frequency.setValueAtTime(400-40*(t.pitch-60),i),a.frequency.linearRampToValueAtTime(450-40*(t.pitch-60),i+.1),c.stopAudioNode(a,i+.1,u);break;case 62:n.playbackRate.value=.03,c.stopAudioNode(n,i+.03,r),u.gain.setValueAtTime(s,i),u.gain.linearRampToValueAtTime(0,i+.03),a.frequency.setValueAtTime(200,i),a.frequency.linearRampToValueAtTime(250,i+.03),c.stopAudioNode(a,i+.03,u);break;case 63:case 64:n.playbackRate.value=.03,c.stopAudioNode(n,i+.03,r),u.gain.setValueAtTime(s,i),u.gain.linearRampToValueAtTime(0,i+.1),a.frequency.setValueAtTime(200-30*(t.pitch-63),i),a.frequency.linearRampToValueAtTime(250-30*(t.pitch-63),i+.1),c.stopAudioNode(a,i+.1,u);break;case 56:case 75:n.playbackRate.value=.01,c.stopAudioNode(n,i+.1,r),u.gain.setValueAtTime(s,i),u.gain.linearRampToValueAtTime(0,i+.1),a.frequency.setValueAtTime(1e3+48*(t.pitch-56),i),c.stopAudioNode(a,i+.1,u);break;case 80:n.playbackRate.value=5,r.gain.setValueAtTime(.5*s,i),r.gain.linearRampToValueAtTime(0,i+.2),c.stopAudioNode(n,i+.05,r),a.type="triangle",u.gain.setValueAtTime(.7*s,i),u.gain.linearRampToValueAtTime(0,i+.2),a.frequency.setValueAtTime(6e3,i),c.stopAudioNode(a,i+.05,u);
break;case 81:n.playbackRate.value=5,r.gain.setValueAtTime(.9*s,i),r.gain.linearRampToValueAtTime(0,i+.5),c.stopAudioNode(n,i+.5,r),a.type="triangle",u.gain.setValueAtTime(.8*s,i),u.gain.linearRampToValueAtTime(0,i+.3),a.frequency.setValueAtTime(6e3,i),c.stopAudioNode(a,i+.3,u);break;default:n.playbackRate.value=t.pitch/69*2,c.stopAudioNode(n,i+.05,r),c.stopAudioNode(a,0,u)}return function(){c.stopAudioNode(n,0,r),c.stopAudioNode(a,0,u)}},t.prototype.createBaseNote=function(t,e,n,r){var i=this.settings,s=this.context,o=this.states.startTime,a=this.getTime(t.start)+o,u=this.getTime(t.stop)+o,c=i.basePitch*Math.pow(Math.pow(2,1/12),(t.pitch||69)-69),l=n?0:t.channel||0,f=t.velocity*Number(n?1:this.channels[l][2]||1)*i.generateVolume,h=9!=l?s.createOscillator():s.createBufferSource(),d=s.createStereoPanner?s.createStereoPanner():s.createPanner?s.createPanner():{pan:{setValueAtTime:function(){}}},p=s.createGain(),m=s.createGain(),g=this;if(!s.createStereoPanner&&s.createPanner){var v=t.pan&&64!=t.pan[0].value?t.pan[0].value/127*2-1:0;v>1&&(v=1);var y=90*v,b=Math.sin(y*(Math.PI/180)),_=-Math.cos(y*(Math.PI/180));d.panningModel="equalpower",d.setPosition(b,0,_)}else if(s.createStereoPanner){var v=t.pan&&64!=t.pan[0].value?t.pan[0].value/127*2-1:0;v>1&&(v=1),d.pan.value=v}if(p.gain.value=f*((t.expression?t.expression[0].value:100)/127),9!=l?(h.type=t.type||"sine",h.detune.value=0,h.frequency.value=c,t.pitchBend?t.pitchBend.forEach(function(e){h.frequency.setValueAtTime(i.basePitch*Math.pow(Math.pow(2,1/12),t.pitch-69+e.value),g.getTime(e.timing)+o)}):!1):(h.loop=!0,h.buffer=this.whitenoise),e&&(t.expression?t.expression.forEach(function(t){p.gain.setValueAtTime(f*(t.value/127),g.getTime(t.timing)+o)}):!1),s.createStereoPanner||s.createPanner){var w=!0;s.createStereoPanner?t.pan?t.pan.forEach(function(t){if(w)return void(w=!1);var e=64==t.value?0:t.value/127*2-1;e>1&&(e=1),d.pan.setValueAtTime(e,g.getTime(t.timing)+o)}):!1:s.createPanner&&(d.positionX?t.pan?t.pan.forEach(function(t){if(w)return void(w=!1);var e=64==t.value?0:t.value/127*2-1;e>1&&(e=1);var n=90*e,r=Math.sin(n*(Math.PI/180)),i=-Math.cos(n*(Math.PI/180));d.positionX.setValueAtTime(r,g.getTime(t.timing)+o),d.positionY.setValueAtTime(0,g.getTime(t.timing)+o),d.positionZ.setValueAtTime(i,g.getTime(t.timing)+o)}):!1:t.pan?t.pan.forEach(function(t){if(w)return void(w=!1);var e=setTimeout(function(){g.clearFunc("pan",e);var n=64==t.value?0:t.value/127*2-1;n>1&&(n=1);var r=90*n,i=Math.sin(r*(Math.PI/180)),s=-Math.cos(r*(Math.PI/180));d.setPosition(i,0,s)},1e3*(g.getTime(t.timing)+o-s.currentTime));g.pushFunc({pan:e,stopFunc:function(){clearTimeout(e)}})}):!1),h.connect(d),d.connect(p)}else h.connect(p);if(p.connect(m),m.connect(this.masterGainNode),this.masterGainNode.connect(s.destination),9!=l&&t.modulation&&(t.modulation.length>=2||t.modulation[0].value>0)){var S=s.createOscillator(),A=s.createGain();w=!0,t.modulation?t.modulation.forEach(function(t){if(w)return void(w=!1);var e=t.value/127;e>1&&(e=1),A.gain.setValueAtTime(10*c/440*e,g.getTime(t.timing)+o)}):!1;var x=t.modulation?t.modulation[0].value/127:0;x>1&&(x=1),A.gain.value=10*c/440*x,S.frequency.value=6,S.connect(A),A.connect(h.frequency)}if(this.settings.isReverb&&t.reverb&&(t.reverb.length>=2||t.reverb[0].value>0)){var T=this.convolver,k=(this.masterGainNode,s.createGain());w=!0,t.reverb?t.reverb.forEach(function(t){if(w)return void(w=!1);var e=t.value/127;e>1&&(e=1),k.gain.setValueAtTime(e,g.getTime(t.timing)+o)}):!1;var E=t.reverb?t.reverb[0].value/127:0;E>1&&(E=1),k.gain.value=E,p.connect(k),k.connect(T)}if(this.settings.isChorus&&t.chorus&&(t.chorus.length>=2||t.chorus[0].value>0)){var B=this.chorusDelayNode,P=(this.masterGainNode,s.createGain());w=!0,t.chorus?t.chorus.forEach(function(t){if(w)return void(w=!1);var e=t.value/127;e>1&&(e=1),P.gain.setValueAtTime(e,g.getTime(t.timing)+o)}):!1;var D=t.chorus?t.chorus[0].value/127:0;D>1&&(D=1),P.gain.value=D,p.connect(P),P.connect(B)}return S&&(S.start(a),this.stopAudioNode(S,u,A)),h.start(a),9==l||n||r||this.stopAudioNode(h,u,p),{start:a,stop:u,pitch:c,channel:l,velocity:f,oscillator:h,panNode:d,gainNode:p,noiseCutGainNode:m}},t.prototype.startWebMIDI=function(){var t,e=this;if(navigator.requestMIDIAccess){var n=this.settings.WebMIDIPortSysEx,r=function(r){t=r.outputs,e.settings.WebMIDIPortOutputs=t;var i;return-1==e.settings.WebMIDIPort?e.settings.WebMIDIPortOutputs.forEach(function(t){i||(i=t)}):i=e.settings.WebMIDIPortOutputs.get(settings.WebMIDIPort),e.settings.WebMIDIPortOutput=i,e.settings.WebMIDIPortSysEx=n,i&&(i.open(),e.initStatus()),t},i=function(t){console.log(t),n&&(n=!1,navigator.requestMIDIAccess({sysex:n}).then(r).catch(i))};navigator.requestMIDIAccess({sysex:n}).then(r).catch(i),window.addEventListener("unload",function(){for(var t=0;16>t;t++){e.settings.WebMIDIPortOutput.send([176+t,120,0]);for(var n=0;128>n;n++)e.settings.WebMIDIPortOutput.send([128+t,n,0])}})}},t.prototype.initStatus=function(t,e){if(!this.settings.isWebMIDI||null==this.states.webMIDIWaitState){this.stop(t);var n=this.states.webMIDIStopTime;if(this.states={isPlaying:!1,playIndex:0,startTime:0,stopTime:0,stopFuncs:[],webMIDIWaitState:null,webMIDIStopTime:0},this.states.webMIDIStopTime=n,this.settings.isWebMIDI&&!e){if(t)return;if(null==this.settings.WebMIDIPortOutput)return void this.startWebMIDI();if(this.settings.WebMIDIPortSysEx)this.settings.WebMIDIPortOutput.send([240,126,127,9,1,247]);else for(var r=0;16>r;r++)this.settings.WebMIDIPortOutput.send([192+r,0]),this.settings.WebMIDIPortOutput.send([224+r,0,64]),this.settings.WebMIDIPortOutput.send([176+r,100,0]),this.settings.WebMIDIPortOutput.send([176+r,101,0]),this.settings.WebMIDIPortOutput.send([176+r,6,2]),this.settings.WebMIDIPortOutput.send([176+r,100,1]),this.settings.WebMIDIPortOutput.send([176+r,96,0]),this.settings.WebMIDIPortOutput.send([176+r,97,64]),this.settings.WebMIDIPortOutput.send([176+r,7,100]),this.settings.WebMIDIPortOutput.send([176+r,10,64]),this.settings.WebMIDIPortOutput.send([176+r,11,127]),this.settings.WebMIDIPortOutput.send([176+r,98,0]),this.settings.WebMIDIPortOutput.send([176+r,99,0]),this.settings.WebMIDIPortOutput.send([176+r,122,0])}}},t.prototype.stop=function(t){var e=this.states,n=this;if(0!=e.isPlaying&&(e.isPlaying=!1,e.playIndex-=this.settings.hashBuffer+1,e.stopTime=this.context.currentTime,e.stopFuncs.forEach(function(t){t.stopFunc()}),e.stopFuncs=[],this.settings.isWebMIDI)){if(t)return;if(null==this.settings.WebMIDIPortOutput)return;e.webMIDIStopTime=this.context.currentTime,setTimeout(function(){for(var t=0;16>t;t++){n.settings.WebMIDIPortOutput.send([176+t,120,0]);for(var e=0;128>e;e++)n.settings.WebMIDIPortOutput.send([128+t,e,0])}},200)}},t.prototype.play=function(t){var e=this.context,n=this.settings,r=this.trigger,i=this.states,s=this.hashedDataList,o=this;if(1!=i.isPlaying){if(n.isWebMIDI&&!t){if("completed"!=i.webMIDIWaitState){if("waiting"!=i.webMIDIWaitState){i.webMIDIWaitState="waiting";var a=800-1e3*(e.currentTime-i.webMIDIStopTime);0==i.webMIDIStopTime&&(a=800),setTimeout(function(){o.states.webMIDIWaitState="completed",o.states.isPlaying=!1,o.play()},a)}return}i.webMIDIWaitState=null}{var u=this.context.currentTime;i.startTime}i.isPlaying=!0,i.startTime=i.startTime||i.stopTime?i.startTime+u-i.stopTime:u,i.stopFuncs=[];var c=this.getTime(this.firstNoteOnTiming);-i.startTime+u<c&&this.setStartTime(c+i.startTime-u);var l,f=function(){o.clearFunc("rootTimeout",l);var t=o.getTime(o.settings.isCC111&&-1!=o.cc111Time?o.lastNoteOffTiming:o.getTiming(Number.MAX_SAFE_INTEGER));t-e.currentTime+i.startTime<=0?o.onSongEnd():(l=setTimeout(f,1),o.pushFunc({rootTimeout:l,stopFunc:function(){clearTimeout(l)}}))},h=this.getTime(this.settings.isCC111&&-1!=this.cc111Time?this.lastNoteOffTiming:this.getTiming(Number.MAX_SAFE_INTEGER)),d=1e3*(h-e.currentTime+i.startTime);l=setTimeout(f,d),o.pushFunc({rootTimeout:l,stopFunc:function(){clearTimeout(l)}}),function p(t){if(i.playIndex=t,s&&s[t]&&s[t].forEach(function(t){n.isWebMIDI||o.pushFunc({note:t,stopFunc:9!=t.channel?o.createNote(t):o.createPercussionNote(t)});var s=setTimeout(function(){o.clearFunc("timeout",s),r.isNoteTrigger&&r.noteOn(t);var e=setTimeout(function(){o.clearFunc("timeout",e),o.clearFunc("note",t),r.isNoteTrigger&&r.noteOff(t)},9!=t.channel?1e3*(o.getTime(t.stop)-o.getTime(t.start)):1e3*o.settings.dramMaxPlayLength);o.pushFunc({timeout:e,stopFunc:function(){clearTimeout(e)}})},1e3*(o.getTime(t.start)-e.currentTime+i.startTime));o.pushFunc({timeout:s,stopFunc:function(){clearTimeout(s)}})}),n.isWebMIDI&&o.hashedMessageList&&o.hashedMessageList[t]&&o.hashedMessageList[t].forEach(function(t){if(null!=n.WebMIDIPortOutput&&255!=t.message[0]&&(o.settings.WebMIDIPortSysEx||240!=t.message[0]&&247!=t.message[0]))try{n.WebMIDIPortOutput.send(t.message,1e3*(o.getTime(t.timing)-e.currentTime+window.performance.now()/1e3+i.startTime))}catch(r){console.log(r,t.message)}}),t<s.length)if(t-Math.floor(1e3*(e.currentTime-i.startTime)/n.hashLength)<=n.hashBuffer)p(t+1);else{var a=setTimeout(function(){p(t+1),o.clearFunc("rootTimeout",a)},n.hashLength);o.pushFunc({rootTimeout:a,stopFunc:function(){clearTimeout(a)}})}else r.songEnd()}(i.playIndex||0)}},t.prototype.setData=function(t){this.states.isPlaying&&this.stop(),this.settings.resolution=t.header.resolution,this.settings.tempo=t.tempo||120,this.tempoTrack=t.tempoTrack,this.cc111Time=t.cc111Time,this.firstNoteOnTiming=t.firstNoteOnTiming,this.lastNoteOffTiming=t.lastNoteOffTiming;var e=this,n=[];if(t.channels.forEach(function(t){t.notes.forEach(function(t){var r=e.getTime(t.start)*(1e3/e.settings.hashLength);n[Math.floor(r)]||(n[Math.floor(r)]=[]),n[Math.floor(r)].push(t)})}),this.settings.isWebMIDI){var r=[];t.messages.forEach(function(t){var n=e.getTime(t.timing)*(1e3/e.settings.hashLength);r[Math.floor(n)]||(r[Math.floor(n)]=[]),r[Math.floor(n)].push(t)}),this.hashedMessageList=r}return this.hashedDataList=n,this.initStatus(),this},t.prototype.getMasterVolume=function(){return this.settings.masterVolume},t.prototype.setMasterVolume=function(t){this.settings.masterVolume=t,this.masterGainNode.gain.value=this.settings.masterVolume},t.prototype.isLoop=function(){return this.settings.loop},t.prototype.setLoop=function(t){this.settings.loop=t},t.prototype.isWebMIDI=function(){return this.settings.isWebMIDI},t.prototype.setWebMIDI=function(t){this.settings.isWebMIDI=t},t.prototype.isCC111=function(){return this.settings.isCC111},t.prototype.setCC111=function(t){this.settings.isCC111=t},t.prototype.setStartTime=function(t){this.states.startTime-=t,this.states.playIndex=Math.floor(1e3*t/this.settings.hashLength)},t.prototype.setOnSongEndListener=function(t){this.onSongEndListener=t},t.prototype.onSongEnd=function(){if(this.onSongEndListener){var t=this.onSongEndListener();if(t)return}this.settings.loop&&(this.initStatus(!0),this.settings.isCC111&&-1!=this.cc111Time&&this.setStartTime(this.getTime(this.cc111Time)),this.play(!0))},t.prototype.isReverb=function(){return this.settings.isReverb},t.prototype.setReverb=function(t){this.settings.isReverb=t},t.prototype.getReverbVolume=function(){return this.settings.reverbVolume},t.prototype.setReverbVolume=function(t){this.settings.reverbVolume=t},t.prototype.isChorus=function(){return this.settings.isChorus},t.prototype.setChorus=function(t){this.settings.isChorus=t},t.prototype.getChorusVolume=function(){return this.settings.chorusVolume},t.prototype.setChorusVolume=function(t){this.settings.chorusVolume=t},t.prototype.isAndroid=function(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("android")&&-1==t.indexOf("windows")},t.prototype.getTime=function(t){var e=0,n=120,r=0,i=this;return this.tempoTrack.some(function(s){return t<s.timing?!0:(e+=60/n/i.settings.resolution*(s.timing-r),r=s.timing,void(n=s.value))}),e+=60/n/i.settings.resolution*(t-r)},t.prototype.getTiming=function(t){var e=0,n=120,r=0,i=this;return this.tempoTrack.some(function(s){return e+=60/n/i.settings.resolution*(s.timing-r),e>t?(e-=60/n/i.settings.resolution*(s.timing-r),r+=(t-e)/(60/n/i.settings.resolution),!0):(r=s.timing,void(n=s.value))}),r},t.prototype.parseSMF=function(t){function e(t){for(var e=0,n=0;n<t.length;n++)e=(e<<8)+t[n];return e}function n(t){for(var e=0,n=0;e<t.length-1&&t[e]>=128;)4>e&&(n=(n<<7)+(t[e]-128)),e++;return n=(n<<7)+t[e],e++,[n,e]}if(77!=t[0]||84!=t[1]||104!=t[2]||100!=t[3])return"Not Sandard MIDI File.";var r=new Object,i=4,s=new Object;s.size=e(t.subarray(4,8)),s.format=t[9],s.trackcount=e(t.subarray(10,12)),s.timemanage=t[12],s.resolution=e(t.subarray(12,14)),i+=4+s.size;for(var o=new Array,a=new Array,u=new Array,c=-1,l=Number.MAX_SAFE_INTEGER,f=0,h=0;16>h;h++){var d=new Object;u.push(d),d.messages=[],d.notes=[]}var p=0;if(this.settings.isWebMIDI)var m=[];for(var g=0;g<s.trackcount;g++){if(77!=t[i]||84!=t[i+1]||114!=t[i+2]||107!=t[i+3])return"Irregular SMF.";i+=4;var v=(new Object,i+4+e(t.subarray(i,i+4)));i+=4;for(var y=0,b=1;v>i;){if(null!=b){var _=n(t.subarray(i,i+5)),w=_[0];y+=w,y>1e8&&(y=1e8),i+=_[1]}if(this.settings.isWebMIDI)var S=i;var A,x={timing:y,mes:[]};switch(Math.floor(t[i]/16)){case 8:case 9:case 10:case 11:case 14:b=t[i],x.mes.push(t[i],t[i+1],t[i+2]);var T=u[15&b].messages;for(A=T.length-1;A>=0;A--){var k=T[A];if(y>=k.timing)break}A++,T.splice(A,0,x),i+=3;break;case 12:case 13:b=t[i],x.mes.push(t[i],t[i+1]);var T=u[15&b].messages;for(A=T.length-1;A>=0;A--){var k=T[A];if(y>=k.timing)break}A++,T.splice(A,0,x),i+=2;break;case 15:switch(t[i]){case 240:case 247:var _=n(t.subarray(i+1,i+1+4));if(_[0]>=7&&127==t[i+2]&&127==t[i+3]&&4==t[i+4]&&1==t[i+5])for(var h=0;16>h;h++){x.mes.push(t[i],_[0]-1,t[i+2],t[i+3],t[i+4],t[i+5],t[i+6],t[i+7]);var T=u[h].messages;for(A=T.length-1;A>=0;A--){var k=T[A];if(y>=k.timing)break}A++,T.splice(A,0,x)}i+=1+_[1]+_[0];break;case 241:i+=2;break;case 242:i+=3;break;case 243:i+=2;break;case 246:case 248:case 250:case 251:case 252:case 254:i+=1;break;case 255:switch(t[i+1]){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 32:break;case 47:y+=-w;break;case 81:r.tempo=6e7/(65536*t[i+3]+256*t[i+4]+t[i+5]),o.push({timing:y,value:6e7/(65536*t[i+3]+256*t[i+4]+t[i+5])});break;case 84:break;case 88:a.push({timing:y,value:[t[i+3],Math.pow(2,t[i+4])]});break;case 89:case 127:}var _=n(t.subarray(i+2,i+2+4));i+=2+_[1]+_[0]}break;default:if(null==b)return"Irregular SMF.";i--,t[i]=b,b=null}if(this.settings.isWebMIDI&&null!=b){var E=t[S];if(240==E||247==E){if(this.settings.WebMIDIPortSysEx){var _=n(t.subarray(S+1,S+1+4)),B=S+1+_[1],P=B+_[0],D=new Uint8Array(1+_[0]);D[0]=E;for(var I=P-B,h=0;I>h;h++)D[h+1]=t[B+h];m.push({message:D,timing:y})}}else m.push({message:t.subarray(S,i),timing:y})}}y>p&&(p=y)}o.push({timing:p,value:120});for(var M=0;M<u.length;M++){for(var d=u[M],i=0,v=d.messages.length,C=2,N=0,O=64,R=127,F=100,L=0,z=0,j=0,U=127,G=127,W=127,V=127,q=null,Z=127,$=[];v>i;){var x=d.messages[i],y=x.timing,H=d.messages[i].mes;switch(Math.floor(H[0]/16)){case 8:var h=0;$.some(function(t){var e=d.notes[t];return e.pitch==H[1]&&null==e.stop?(e.stop=y,$.splice(h,1),y>f&&(f=y),!0):void h++});break;case 9:if(0!=H[2]){var K={start:y,stop:null,pitch:H[1],pitchBend:[{timing:y,value:N}],pan:[{timing:y,value:O}],expression:[{timing:y,value:R*(Z/127)}],velocity:H[2]/127*(F/127),modulation:[{timing:y,value:L}],reverb:[{timing:y,value:z}],chorus:[{timing:y,value:j}],instrument:q,channel:M};$.push(d.notes.length),d.notes.push(K),l>y&&(l=y)}else{var h=0;$.some(function(t){var e=d.notes[t];return e.pitch==H[1]&&null==e.stop?(e.stop=y,$.splice(h,1),y>f&&(f=y),!0):void h++})}break;case 10:break;case 11:switch(H[1]){case 1:L=H[2],$.forEach(function(t){var e=d.notes[t];e.modulation.push({timing:y,value:L})});break;case 6:0==W&&0==V&&(C=H[2],C>24&&(C=24));break;case 7:F=H[2];break;case 10:O=H[2],$.forEach(function(t){var e=d.notes[t];e.pan.push({timing:y,value:O})});break;case 11:R=H[2],$.forEach(function(t){var e=d.notes[t];e.expression.push({timing:y,value:R*(Z/127)})});break;case 91:z=H[2],$.forEach(function(t){var e=d.notes[t];e.reverb.push({timing:y,value:z})});break;case 93:j=H[2],$.forEach(function(t){var e=d.notes[t];e.chorus.push({timing:y,value:j})});break;case 98:U=H[2];break;case 99:G=H[2];break;case 100:W=H[2];break;case 101:V=H[2];break;case 111:-1==c&&(c=y)}break;case 12:q=H[1];break;case 13:break;case 14:N=(128*H[2]+H[1]-8192)/8192*C,$.forEach(function(t){var e=d.notes[t];e.pitchBend.push({timing:y,value:N})});break;case 15:switch(H[0]){case 240:case 247:if(H[1]>=6&&127==H[2]&&127==H[3]&&4==H[4]&&1==H[5]){var X=H[7];X>127&&(X=127),Z=X,$.forEach(function(t){var e=d.notes[t];e.expression.push({timing:y,value:R*(Z/127)})})}}break;default:return"Error parseSMF."}i++}delete d.messages}return r.header=s,r.tempoTrack=o,r.beatTrack=a,r.channels=u,r.songLength=p,r.cc111Time=c,r.firstNoteOnTiming=l,r.lastNoteOffTiming=f,this.settings.isWebMIDI&&(r.messages=m),r},t.prototype.stopAudioNode=function(t,e,n){try{e>0?t.stop(e):(t.stop(this.context.currentTime+.005),n.gain.cancelScheduledValues(this.context.currentTime),n.gain.linearRampToValueAtTime(0,this.context.currentTime+.005))}catch(r){n.gain.cancelScheduledValues(e),0>=e&&n.gain.linearRampToValueAtTime(0,this.context.currentTime+.005)}},t.prototype.pushFunc=function(t){(t.note||t.rootTimeout||this.trigger.isNoteTrigger)&&this.states.stopFuncs.push(t)},t.prototype.clearFunc=function(t,e){if("note"==t||"rootTimeout"==t||this.trigger.isNoteTrigger){var n=this;n.states.stopFuncs.some(function(r,i){return r[t]==e?(n.states.stopFuncs.splice(i,1),!0):void 0})}},t}();requireSimulator.setName("T2MediaLib");var T2MediaLib=function(){var t=function(t){this.context=null,this.picoAudio=null,this.soundDataAry=[],this.bgmPlayerMax=16,this.bgmPlayerAry=[],this.masterVolume=1,this.seMasterVolume=1,this.bgmMasterVolume=1,this.playingAudio=null,this.audioVolume=1,this.audioTempo=1,this.audioDataAry={data:[]},this.init(t)};return t.prototype.init=function(t){if(!this.inited&&(this.inited=!0,!this.disabled&&(t?this.context=t:window.AudioContext?this.context=new AudioContext:window.webkitAudioContext?this.context=new webkitAudioContext:(this.context=null,console.log("Your browser does not support yet Web Audio API")),this.context)))for(var e=0;e<this.bgmPlayerMax;e++)this.bgmPlayerAry[e]=new T2MediaLib_BGMPlayer(this,e)},t.prototype.allClearSoundData=function(){var t=this.soundDataAry;for(var e in t)delete t[e]},t.prototype.clearSoundData=function(t){var e=this.soundDataAry;delete e[t]},t.prototype.allRemoveDecodedSoundData=function(){var t=this.soundDataAry;for(var e in t){var n=t[e];null!=n&&(n.isDecodeComplete()||n.isDecoding())&&n.removeDecodedData()}},t.prototype.removeDecodedSoundData=function(t){var e=this.soundDataAry[t];null!=e&&(e.isDecodeComplete()||e.isDecoding())&&e.removeDecodedData()},t.prototype.getMasterVolume=function(){return this.masterVolume},t.prototype.setMasterVolume=function(t){this.masterVolume=t;for(var e=0;e<this.bgmPlayerMax;e++){var n=this.bgmPlayerAry[e];n instanceof T2MediaLib_BGMPlayer&&n.onChangeBGMMasterVolume()}},t.prototype.createSoundFromArray=function(t,e,n){this.soundDataAry[t]=new T2MediaLib_SoundData;for(var r=this.context,i=null!=e&&null!=n?2:1,s=r.createBuffer(i,array.length,r.sampleRate),o=s.getChannelData(0),a=null!=n?s.getChannelData(1):null,u=0;u<array.length;u++)o[u]=e[u];if(a)for(var u=0;u<array.length;u++)a[u]=n[u];this.soundDataAry[t].onDecodeComplete(s)},t.prototype.loadSound=function(t,e,n){if(this.soundDataAry[t]=new T2MediaLib_SoundData,!this.context||this.disabled)return this.soundDataAry[t].onError("FUNC_DISABLED_ERROR"),null;(e.match(/\.(midi?)$/)||e.match(/^data:audio\/mid/))&&null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context)),"object"==typeof WebSite&&WebSite.mp3Disabled&&(e=e.replace(/\.(mp3|mp4|m4a)$/,".ogg"));var r=this,i=new XMLHttpRequest;i.onload=function(){if(200===i.status||0===i.status){var e=i.response;e instanceof ArrayBuffer?(r.soundDataAry[t].onLoadComplete(e),n&&n.succ&&n.succ(t)):(r.soundDataAry[t].onError("XHR_RESPONSE_ERROR"),n&&n.err&&n.err(t,r.soundDataAry[t].errorID))}else r.soundDataAry[t].onError("XHR_STATUS_ERROR"),n&&n.err&&n.err(t,r.soundDataAry[t].errorID)},i.onerror=function(e){console.log(e+""),r.soundDataAry[t].onError("XHR_ERROR"),n&&n.err&&n.err(t,r.soundDataAry[t].errorID)},this.soundDataAry[t].onLoad(e),e.match(/^data:/)&&Util&&Util.Base64_To_ArrayBuffer?(i={onload:i.onload},i.response=Util.Base64_To_ArrayBuffer(e.replace(/^data:audio\/[a-zA-Z0-9]+;base64,/i,"")),i.status=200,i.onload()):(i.open("GET",e,!0),i.responseType="arraybuffer",i.send(null))},t.prototype.decodeSound=function(t,e){var n=this.soundDataAry[t];if(null!=n&&!n.isDecodeComplete()){if(null==n.decodedCallbacksAry&&(n.decodedCallbacksAry=[]),e)if(null!=e.bgmPlayerId){var r=n.decodedCallbacksAry.some(function(t,r){return e.bgmPlayerId==t.bgmPlayerId?(n.decodedCallbacksAry[r]=e,!0):!1});r||n.decodedCallbacksAry.push(e)}else n.decodedCallbacksAry.push(e);if(!n.isDecoding()){n.onDecode();var i=n.fileData.slice(0);if(n.url.match(/\.(midi?)$/)||n.url.match(/^data:audio\/mid/)){null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context));var s=new Uint8Array(i),o=this.picoAudio.parseSMF(s);"string"==typeof o?(console.log("T2MediaLib: Error parseSMF()",o),this.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,this.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null):(this.soundDataAry[t].onDecodeComplete(o),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)}else{var a=this,u=function(e){a.soundDataAry[t].isDecoding()&&(a.soundDataAry[t].onDecodeComplete(e),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)},c=function(e){e instanceof Error?console.log("T2MediaLib: "+e.message,n.url):console.log("T2MediaLib: Error decodeAudioData()",n.url),a.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,a.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null};this.context.decodeAudioData(i,u,c)}}}},t.prototype.activate=function(){if(this.init(),!this.isActivated){this.isActivated=!0;for(var t=this.context,e=t.createBuffer(1,Math.floor(t.sampleRate/32),t.sampleRate),n=e.getChannelData(0),r=(Math.floor(t.sampleRate/860),0);r<n.length;r++)n[r]=0;var i=t.createBufferSource();i.buffer=e,i.connect(t.destination),i.start=i.start||i.noteOn,i.start(0)}},t.prototype.getSoundFileData=function(t){var e=this.soundDataAry[t];return e?e.fileData:null},t.prototype.getSoundDecodedData=function(t){var e=this.soundDataAry[t];return e?e.decodedData:null},t.prototype.getCurrentTime=function(){return this.context?this.context.currentTime:null},t.prototype.playSE=function(t,e,n,r,i,s,o,a,u,c){if(!this.context)return null;var l=this.soundDataAry[t];if(null==l)return null;if(!l.isDecodeComplete()){var f=this,h={};return h.succ=function(t){f.playSE(t,e,n,r,i,s,o,a,u,c)},h.err=function(){},this.decodeSound(t,h),null}var d=l.decodedData;if(!(d instanceof AudioBuffer))return null;null==e&&(e=1),null==n&&(n=0),r||(r=1),i?i>d.duration?i=d.duration:0>i&&(i=0):i=0,c||(c=void 0),s||(s=!1),o?0>o?o=0:o>d.duration&&(o=d.duration):o=0,a?0>a?a=0:a>d.duration&&(a=d.duration):a=d.duration,u=u||0;var p=this.context.createBufferSource();this.context.createGain=this.context.createGain||this.context.createGainNode;var m=this.context.createGain(),g=this.context.createPanner();p.buffer=d,p.loop=s,p.loopStart=o,p.loopEnd=a,p.playbackRate.value=r,p.connect(m),m.connect(g),g.connect(this.context.destination),g.panningModel="equalpower",-1>n?n=-1:n>1&&(n=1);var v=90*n,y=Math.sin(v*(Math.PI/180)),b=-Math.cos(v*(Math.PI/180));(-1===n||1===n)&&(b=0),g.positionX?(g.positionX.value=y,g.positionY.value=0,g.positionZ.value=b):g.setPosition(y,0,b),m.gain.value=e*this.seMasterVolume*this.masterVolume;var _;return _=s&&a-o>0&&i>a?a:i,p.gainNode=m,p.volumeValue=e,p.panNode=g,p.panValue=n,p.playStartTime=this.context.currentTime+u,p.playOffset=_,p.plusTime=_,p.start=p.start||p.noteOn,p.stop=p.stop||p.noteOff,p.start(u,i,c),s&&null!=c&&p.stop(u+c),p.onended=function(){p.onended=null},p},t.prototype.stopSE=function(t){return t instanceof AudioBufferSourceNode?(t.stop(0),t):null},t.prototype.getSEMasterVolume=function(){return this.seMasterVolume},t.prototype.setSEMasterVolume=function(t){this.seMasterVolume=t},t.prototype.getSEVolume=function(t){return t instanceof AudioBufferSourceNode?source.volumeValue:null},t.prototype.setSEVolume=function(t,e){return t instanceof AudioBufferSourceNode?(t.gainNode.gain.value=e*this.seMasterVolume*this.masterVolume,source.volumeValue=e,t):null},t.prototype.getSERate=function(t){return t instanceof AudioBufferSourceNode?t.playbackRate.value:null},t.prototype.setSERate=function(t,e){return t instanceof AudioBufferSourceNode?void(t.playbackRate.value=e):null},t.prototype.getSEPan=function(t){return t instanceof AudioBufferSourceNode?t.panValue:null},t.prototype.setSEPan=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;var n=t.panNode;-1>e?e=-1:e>1&&(e=1);var r=90*e,i=Math.sin(r*(Math.PI/180)),s=Math.cos(r*(Math.PI/180));(-1===e||1===e)&&(s=0),n.positionX?(n.positionX.value=i,n.positionY.value=0,n.positionZ.value=s):n.setPosition(i,0,s),t.panValue=e},t.prototype.isSELoop=function(t){return t instanceof AudioBufferSourceNode?t.loop:null},t.prototype.setSELoop=function(t,e){return t instanceof AudioBufferSourceNode?void(t.loop=e):null},t.prototype.getSELoopStartTime=function(t){return t instanceof AudioBufferSourceNode?t.loopStart:null},t.prototype.setSELoopStartTime=function(t,e){return t instanceof AudioBufferSourceNode?void(t.loopStart=e):null},t.prototype.getSELoopEndTime=function(t){return t instanceof AudioBufferSourceNode?t.loopEnd:null},t.prototype.setSELoopEndTime=function(t,e){return t instanceof AudioBufferSourceNode?void(t.loopEnd=e):null},t.prototype.playBGM=function(t,e,n,r,i,s){if(!this.context)return null;var o=this._getBgmPlayer(t);return o?o.playBGM(e,n,r,i,s):null},t.prototype.stopBGM=function(t){var e=this._getBgmPlayer(t);return e?e.stopBGM():null},t.prototype.pauseBGM=function(t){var e=this._getBgmPlayer(t);return e?e.pauseBGM():null},t.prototype.resumeBGM=function(t){var e=this._getBgmPlayer(t);return e?e.resumeBGM():null},t.prototype.getBGMMasterVolume=function(){return this.bgmMasterVolume},t.prototype.setBGMMasterVolume=function(t){this.bgmMasterVolume=t;for(var e=0;e<this.bgmPlayerMax;e++){var n=this.bgmPlayerAry[e];n instanceof T2MediaLib_BGMPlayer&&n.onChangeBGMMasterVolume()}},t.prototype.getBGMVolume=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMVolume():null},t.prototype.setBGMVolume=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMVolume(e):null},t.prototype.getBGMTempo=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMTempo():null},t.prototype.setBGMTempo=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMTempo(e):null},t.prototype.getBGMPan=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMPan():null},t.prototype.setBGMPan=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMPan(e):null},t.prototype.isBGMLoop=function(t){var e=this._getBgmPlayer(t);return e?e.isBGMLoop():null},t.prototype.setBGMLoop=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoop(e):null},t.prototype.getBGMLoopStartTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLoopStartTime():null},t.prototype.setBGMLoopStartTime=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoopStartTime(e):null},t.prototype.getBGMLoopEndTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLoopEndTime():null},t.prototype.setBGMLoopEndTime=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoopEndTime(e):null},t.prototype.getBGMCurrentTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMCurrentTime():null},t.prototype.getBGMLength=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLength():null},t.prototype.getPlayingBGMName=function(t){var e=this._getBgmPlayer(t);return e?e.getPlayingBGMName():null},t.prototype.setOnBGMEndListener=function(t,e){var n=this._getBgmPlayer(t);return n?n.setOnBGMEndListener(e):null},t.prototype.getPlayingBGMState=function(t){var e=this._getBgmPlayer(t);return e?e.getPlayingBGMState():null},t.prototype.getBGMPicoAudio=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMPicoAudio():null},t.prototype.getBGMPlayerMax=function(){return this.bgmPlayerMax},t.prototype.allStopBGM=function(){for(var t=0;t<this.bgmPlayerMax;t++)this.stopBGM(t)},t.prototype.allResetBGM=function(){for(var t=0;t<this.bgmPlayerMax;t++)this.stopBGM(t),this.setBGMVolume(t,1),this.setBGMTempo(t,1),this.setBGMPan(t,0);this.setMasterVolume(1),this.setSEMasterVolume(1),this.setBGMMasterVolume(1)},t.prototype._getBgmPlayer=function(t){if(0>t||this.bgmPlayerMax<=t)return null;var e=this.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e:null},t.prototype.loadAudio=function(t,e){var n=new Audio(e);n.play(),this.audioDataAry.data[t]=null;var r=this;n.addEventListener("loadstart",function(){if(!r.context)return null;var t=r.context.createMediaElementSource(n);t.connect(r.context.destination)},!1),n.addEventListener("canplay",function(){this.audioDataAry.data[t]=n},!1),n.load()},t.prototype.playAudio=function(t,e,n){var r=this.audioDataAry.data[t];return r?(n||(n=0),this.playingAudio instanceof Audio&&(this.playingAudio.pause(),this.playingAudio.currentTime=0),this.playingAudio=r,r.loop=e,r.volume=this.audioVolume,r.currentTime=n,r.play(),r):null},t.prototype.stopAudio=function(){var t=this.playingAudio;return t instanceof Audio?(t.pause(),t.currentTime=0,this.playingAudio=null,t):null},t.prototype.pauseAudio=function(){var t=this.playingAudio;return t?(t.pause(),t):null},t.prototype.resumeAudio=function(){var t=this.playingAudio;return t?(t.play(),t):null},t.prototype.setAudioVolume=function(t){this.audioVolume=t,this.playingAudio instanceof Audio&&(this.playingAudio.volume=t)},t.prototype.setAudioTempo=function(t){this.audioTempo=t,this.playingAudio instanceof Audio&&(this.playingAudio.playbackRate=t)},t.prototype.setAudioPosition=function(t){this.playingAudio instanceof Audio&&(this.playingAudio.currentTime=t)},t.prototype.getAudioData=function(t){return this.audioDataAry.data[t]},t.prototype.getAudioCurrentTime=function(){return this.playingAudio instanceof Audio?this.playingAudio.currentTime:null},t.prototype.getAudioLength=function(){return this.playingAudio instanceof Audio?this.playingAudio.duration:null},t}(),T2MediaLib_BGMPlayer=function(){var t=function(t,e){this.t2MediaLib=t,this.id=e,this.playingBGMState="stop",this.playingBGMStatePending=null,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1,this.bgmPan=0,this.picoAudio=null,this.picoAudioSetDataBGMName=null,this.PICO_AUDIO_VOLUME_COEF=1};return t.prototype.playBGM=function(t,e,n,r,i){this.stopBGM();var s=this.t2MediaLib.soundDataAry[t];if(null==s)return null;if(!s.isDecodeComplete()){var o=this,a={};return a.bgmPlayerId=this.id,a.succ=function(){var s=o.playingBGMStatePending;o._setPlayingBGMState("stop",!0),"stop"!=s&&o.playingBGMName==t&&o.playBGM(t,e,n,r,i),"pause"==s&&o.pauseBGM()},a.err=function(){o._setPlayingBGMState("stop",!0)},this.playingBGMName=t,this._setPlayingBGMState("decoding",!0),this._setPlayingBGMState("play"),this.t2MediaLib.decodeSound(t,a),this}var u=s.decodedData;if(u instanceof AudioBuffer)this.playingBGM=this.t2MediaLib.playSE(t,this.bgmVolume,this.bgmPan,this.bgmTempo,n,e,r,i);else if(u instanceof Object){if(this._initPicoAudio(),t!=this.picoAudioSetDataBGMName?(this.picoAudio.setData(u),this.picoAudioSetDataBGMName=t):this.picoAudio.initStatus(),this.picoAudio.setLoop(e),this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*this.bgmVolume*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),n){var c=this.picoAudio.getTime(this.picoAudio.getTiming(Number.MAX_SAFE_INTEGER));
n>c?n=c:0>n&&(n=0)}else n=0;this.picoAudio.setStartTime(n),this.picoAudio.play(),this.playingBGM=this.picoAudio}return this.playingBGMName=t,this.bgmPause=0,this._setPlayingBGMState("play"),this},t.prototype.stopBGM=function(){var t=this.playingBGM;return t instanceof PicoAudio?this.picoAudio.stop():t instanceof AudioBufferSourceNode&&t.stop(0),this.playingBGM=null,this.playingBGMName=null,this._setPlayingBGMState("stop"),this},t.prototype.pauseBGM=function(){var t=this.playingBGM;return t instanceof PicoAudio?0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseCurrentTime=t.context.currentTime,t.stop(),this.bgmPause=1):t instanceof AudioBufferSourceNode&&0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=this.t2MediaLib.getSELoopStartTime(t),this.bgmPauseLoopEnd=this.t2MediaLib.getSELoopEndTime(t),this.bgmPauseLoop=this.t2MediaLib.isSELoop(t),this.bgmPauseCurrentTime=t.context.currentTime,this.bgmPauseTempo=this.bgmTempo,t.stop(0),this.bgmPause=1),"stop"!=this.playingBGMState&&this._setPlayingBGMState("pause"),this},t.prototype.resumeBGM=function(){var t=this.playingBGM;return t instanceof PicoAudio?1===this.bgmPause&&(t.play(),this.bgmPause=0):t instanceof AudioBufferSourceNode&&1===this.bgmPause&&(t=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd)),this},t.prototype.onChangeBGMMasterVolume=function(){this.setBGMVolume(this.getBGMVolume())},t.prototype.getBGMVolume=function(){return this.bgmVolume},t.prototype.setBGMVolume=function(t){var e=this.playingBGM;return this.bgmVolume=t,e instanceof PicoAudio?this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*t*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume):e instanceof AudioBufferSourceNode&&(e.gainNode.gain.value=t*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),this},t.prototype.getBGMTempo=function(){return this.bgmTempo},t.prototype.setBGMTempo=function(t){var e=this.playingBGM;return(0>=t||isNaN(t))&&(t=1),e instanceof AudioBufferSourceNode&&0===this.bgmPause&&(e.plusTime-=(this.t2MediaLib.context.currentTime-e.playStartTime)*(t-this.bgmTempo)),this.bgmTempo=t,this.t2MediaLib.setSERate(e,t),this},t.prototype.getBGMPan=function(){return this.bgmPan},t.prototype.setBGMPan=function(t){var e=this.playingBGM;return this.bgmPan=t,e instanceof AudioBufferSourceNode&&this.t2MediaLib.setSEPan(e,t),this},t.prototype.isBGMLoop=function(){var t=this.playingBGM;return t instanceof PicoAudio?this.picoAudio.isLoop():t instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoop:this.t2MediaLib.isSELoop(t):null},t.prototype.setBGMLoop=function(t){var e=this.playingBGM;return e instanceof PicoAudio?this.picoAudio.setLoop(t):e instanceof AudioBufferSourceNode&&(1===this.bgmPause?this.bgmPauseLoop=t:this.t2MediaLib.setSELoop(e,t)),this},t.prototype.getBGMLoopStartTime=function(){var t=this.playingBGM;return t instanceof PicoAudio?0:t instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopStart:this.t2MediaLib.getSELoopStartTime(t):null},t.prototype.setBGMLoopStartTime=function(t){var e=this.playingBGM;if(e instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopStartTime(e,t);this.bgmPauseLoopStart=t}return this},t.prototype.getBGMLoopEndTime=function(){var t=this.playingBGM;return t instanceof PicoAudio?this.getBGMLength():t instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopEnd:this.t2MediaLib.getSELoopEndTime(t):null},t.prototype.setBGMLoopEndTime=function(t){var e=this.playingBGM;if(e instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopEndTime(e,t);this.bgmPauseLoopEnd=t}return this},t.prototype.getBGMCurrentTime=function(){var t=this.playingBGM;if(t instanceof PicoAudio){var e;return e=0===this.bgmPause?this.picoAudio.getTime(this.picoAudio.getTiming(this.picoAudio.context.currentTime-this.picoAudio.states.startTime)):this.bgmPauseTime}if(t instanceof AudioBufferSourceNode){var e,n,r,i,s,o,a;return 0===this.bgmPause?(r=this.t2MediaLib.context.currentTime,i=this.bgmTempo):(r=this.bgmPauseCurrentTime,i=this.bgmPauseTempo),n=(r-t.playStartTime)*i+t.plusTime,t.loop&&(t.loopEnd-t.loopStart>0?n<t.loopStart?(s=0,o=0,a=t.buffer.duration):(s=t.loopStart,o=t.loopStart,a=t.loopEnd-t.loopStart):(a=t.buffer.duration,s=0,o=0)),t.loop?e=(n-o)%a+s:(e=n,e>t.buffer.duration&&(e=t.buffer.duration)),e}return null},t.prototype.getBGMLength=function(){var t=this.playingBGM;return t instanceof PicoAudio?this.picoAudio.getTime(this.picoAudio.getTiming(Number.MAX_SAFE_INTEGER)):t instanceof AudioBufferSourceNode?t.buffer.duration:null},t.prototype.getPlayingBGMName=function(){return this.playingBGMName},t.prototype.setOnBGMEndListener=function(t){null!=this.picoAudio&&this.picoAudio.setOnSongEndListener(t)},t.prototype.getPlayingBGMState=function(){return this.playingBGMState},t.prototype.getBGMPicoAudio=function(){return this._initPicoAudio(),this.picoAudio},t.prototype._setPlayingBGMState=function(t,e){e||"decoding"!=this.playingBGMState?(this.playingBGMState=t,this.playingBGMStatePending=null):this.playingBGMStatePending=t},t.prototype._initPicoAudio=function(){null==this.picoAudio&&(0==this.id&&(this.picoAudio=this.t2MediaLib.picoAudio),null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.t2MediaLib.context,this.t2MediaLib.picoAudio)))},t}(),T2MediaLib_SoundData=function(){var t=function(){this.state="none",this.errorID=null,this.url=null,this.fileData=null,this.decodedData=null,this.decodedCallbacksAry=null};return t.prototype.onLoad=function(t){this.state="loading",this.url=t},t.prototype.onLoadComplete=function(t){this.state="loaded",this.fileData=t},t.prototype.onDecode=function(){this.state="decoding"},t.prototype.onDecodeComplete=function(t){this.state="decoded",this.decodedData=t},t.prototype.onError=function(t){this.state="error",this.errorID=t},t.prototype.isLoadComplete=function(){switch(this.state){case"loaded":case"decoding":case"decoded":return!0}return!1},t.prototype.isDecoding=function(){return"decoding"==this.state},t.prototype.isDecodeComplete=function(){return"decoded"==this.state},t.prototype.removeDecodedData=function(){this.state="loaded",this.decodedData=null},t}();requireSimulator.setName("exceptionCatcher"),define([],function(){var t={};return t.f=function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(n){t.handleException(n)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var r in e)e[r]=t.f(e[r]);return e}},t}),requireSimulator.setName("UI"),define(["Util","exceptionCatcher"],function(t,e){var n={},r=e.f;return n=function(){function e(){l.forEach(function(t){t()}),setTimeout(r(e),50)}function i(t){return t instanceof Array?s(t):"string"==typeof t?a(t):t}function s(t){var e=t[0],n=1,r=$("<"+e+">");for("object"!=typeof t[n]||t[n]instanceof Array||t[n]instanceof $||(o(r,t[n],e),n++);n<t.length;)r.append(i(t[n])),n++;return r}function o(e,i){function s(t,n){if(n)if("enterkey"==t)e.on("keypress",r(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var s,o=!0;l.push(function(){var t;t="checkbox"==i.type?!!e.prop("checked"):e.val(),(o||s!=t)&&(n.apply(e,[t,s]),s=t),o=!1})}else e.on(t,r(n))}i.$var&&(f[i.$var]=e),i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(t){h.writeToModel(i.$edit,t,e)}),f[i.$edit.name]||(f[i.$edit.name]=e),h.push({jq:e,params:i}));for(var o in i)if("on"==o)for(var a in i.on)s(a,i.on[a]);else"css"==o&&null!=i[o]?e.css(i[o]):t.startsWith(o,"$")||null==i[o]||e.attr(o,i[o])}function a(t){return $("<span>").text(t)}for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];var l=[],f={},h=[],d=i(u);return d.$edits=h,d.$vars=f,h.load=function(t){h.model=t,h.forEach(function(t){h.writeToJq(t.params.$edit,t.jq)}),h.validator.on.validate.call(h.validator,h.model)},h.writeToJq=function(t,e){var n=h.model;if(n){for(var r=t.name,i=r.split("."),s=0;s<i.length;s++)n=n[i[s]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},h.validator={errors:{},show:function(){if(f.validationMessage){f.validationMessage.empty();for(var t in this.errors)f.validationMessage.append(n("div",this.errors[t].mesg))}if(f.OKButton){var e=!0;for(var t in this.errors)e=!1;f.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},h.writeToModel=function(t,e,n){var r=h.model;if(r){var i=t.name;try{e=t.type.fromVal(e)}catch(s){return void h.validator.addError(i,s,n)}h.validator.removeError(i);for(var o=i.split("."),a=0;a<o.length;a++)a==o.length-1?h.on.writeToModel(i,e)||(r[o[a]]=e):r=r[o[a]];h.validator.on.validate.call(h.validator,h.model)}},h.on={},h.on.writeToModel=function(){},l.length>0&&setTimeout(r(e),50),d},n.types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),requireSimulator.setName("UIDiag"),define(["UI"],function(t){var e={};return e.confirm=function(e){function n(t){return function(){i.resolve(t),r.dialog("close"),r.remove()}}var r=t("div",{title:"確認"},["div",e],["button",{on:{click:n(!0)}},"OK"],["button",{on:{click:n(!1)}},"キャンセル"]).dialog({width:"auto",close:n(!1)}),i=$.Deferred();return i.promise()},e.alert=function(e){function n(t){return function(){i.resolve(t),r.dialog("close"),r.remove()}}var r=t("div",{title:"確認"},["div",e],["button",{on:{click:n(!0)}},"OK"]).dialog({width:"auto",close:n(!1)}),i=$.Deferred();return i.promise()},e.prompt=function(e,n){function r(){var t=s.$vars.val.val();o.resolve(t),s.dialog("close"),s.remove()}function i(){s.dialog("close"),s.remove(),o.resolve()}var s=t("div",{title:"入力"},["div",e],["input",{on:{enterkey:r},$var:"val",value:n}],["br"],["button",{on:{click:r}},"OK"],["button",{on:{click:i}},"キャンセル"]).dialog({width:"auto",close:function(){s.dialog("close"),o.resolve()}});setTimeout(function(){s.$vars.val.focus()},10);var o=$.Deferred();return o.promise()},"undefined"!=typeof window&&(window.UIDiag=e),e}),requireSimulator.setName("runtime"),requirejs(["ImageList","PicoAudio","T2MediaLib","Tonyu","UIDiag"],function(){}),requireSimulator.setName("LSFS"),define(["FS"],function(t){return t.LSFS}),requireSimulator.setName("NativeFS"),define(["FS"],function(t){return t.NativeFS}),requireSimulator.setName("runScript2"),requirejs(["FS","compiledTonyuProject","Shell","runtime","WebSite","LSFS","Tonyu","NativeFS"],function(t,e,n,r,i,s,o){$(function(){function r(){var t=navigator.userAgent.toLowerCase();return-1==t.indexOf("iphone")&&-1==t.indexOf("ipad")&&-1==t.indexOf("ipod")||window==window.parent?0:40}function a(){var t=r();l=$(window).width(),f=$(window).height(),h.attr({width:l-t,height:f-t})}function u(){o.currentProject=o.globals.$currentProject=_;var t=_.getOptions();_.runScriptMode=!0,_.run(t.run.bootClass)}SplashScreen={hide:function(){$("#splash").hide()},show:function(){},progress:function(t){$("#splash").text(t)}};var c=r(),l=$(window).width(),f=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var h=$("<canvas>").attr({width:l-c,height:f-c}).appendTo("body");$(window).resize(a);var d;if(i.isNW){var p=location.href.replace(/^file:\/\//,"");p.match(/^\/[a-z]:/i)&&(p=p.replace(/^\//,"")),p=t.get(p),p.isDir()||(p=p.up()),d=p.rel("data/")}else{var m=location.href.replace(/\?.*/,"").split(/\//),g=m.pop()||"runscript",v=m.pop()||"nobody",p=t.get(i.tonyuHome),y=t.get("/ram/");t.mount(y.path(),s.ramDisk()),d=y;var b=p.rel(v+"/"+g+"/");y.rel("files/").link(b)}loadFiles(d),n.cd(d),i.compiledKernel="js/kernel.js","BA"===i.serverType&&(i.compiledKernel=window.runtimePath+"lib/tonyu/kernel.js");var _=e("user","js/concat.js",d);u()})}),requireSimulator.setName();