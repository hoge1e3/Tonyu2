!function(){var t={};return t.def=function(e,n,i){var r=t.getModuleInfo(t.curName);r.type=i,t.setReqs(r,e),r.func=function(){return n.apply(this,t.getObjs(e))},t.loadIfAvailable(r)},define=function(){var e=Array.prototype.slice.call(arguments);"string"==typeof e[0]&&(t.curName=e.shift());var n=e.shift(),i=e.shift();t.def(n,i,"define")},define.amd={jQuery:!0},requirejs=function(e,n){t.def(e,n,"require")},t.setReqs=function(e,n){n.forEach(function(n){var i=t.getModuleInfo(n);i.loaded||(e.reqs[n]=i,i.revReqs[e.name]=e)})},t.getModuleInfo=function(e){var n=t.modules;return n[e]||(n[e]={name:e,reqs:{},revReqs:{}}),n[e]},t.doLoad=function(e){var n=t.getModuleInfo(e);if(n.loaded)return n.obj;n.loaded=!0;var i=null;if(n.func)i=n.func();else{var r=e.split(/\./);i=function(){return this}(),r.forEach(function(t){i&&(i=i[t])}),null==i&&console.log("Warning: No obj for "+e)}if("define"==n.type&&null==i)throw"No obj for "+e;n.obj=i;for(var o in n.revReqs)t.notifyLoaded(n.revReqs[o],n.name);return i},t.notifyLoaded=function(e,n){delete e.reqs[n],t.loadIfAvailable(e)},t.loadIfAvailable=function(e){for(var n in e.reqs)return;t.doLoad(e.name)},t.getObjs=function(e){var n=[];return e.forEach(function(e){var i=t.doLoad(e);n.push(i)}),n},t.modules={},t.setName=function(e){t.curName&&(t.getModuleInfo(t.curName).func||t.doLoad(t.curName)),e&&(t.curName=e)},requireSimulator=t,t}(),requireSimulator.setName("FS"),define([],function(){var t,e,n={},i="REQJS_",o=0;n.def=function(t,e,i){var r=n.getModuleInfo(t);"function"==typeof e?(i=e,e=n.reqsFromFunc(i),n.setReqs(r,e),r.func=function(){var t={exports:{}},e=i(n.doLoad,t,t.exports);return e||t.exports}):(n.setReqs(r,e),r.func=function(){return i.apply(this,n.getObjs(e))}),n.loadIfAvailable(r)},t=function(t,e,i){n.def(t,e,i)},t.amd={},e=function(t,e){n.def(i+o++,t,e)},n.setReqs=function(t,e){e.forEach(function(e){var i=n.getModuleInfo(e);i.loaded||(t.reqs[e]=i,i.revReqs[t.name]=t)})},n.getModuleInfo=function(t){var e=n.modules;return e[t]=e[t]||{name:t,reqs:{},revReqs:{}}},n.doLoad=function(t){var e=n.getModuleInfo(t);if(e.loaded)return e.obj;e.loaded=!0;var i=e.func();null!=i||t.match(/^REQJS_/)||console.log("Warning: No obj for "+t),e.obj=i;for(var r in e.revReqs)n.notifyLoaded(e.revReqs[r],e.name);return i},n.notifyLoaded=function(t,e){delete t.reqs[e],n.loadIfAvailable(t)},n.loadIfAvailable=function(t){for(var e in t.reqs)return;n.doLoad(t.name)},n.getObjs=function(t){var e=[];return t.forEach(function(t){var i=n.doLoad(t);e.push(i)}),e},n.reqsFromFunc=function(t){var e=t+"",n=[];return e.replace(/require\s*\(\s*["']([^"']+)["']\s*\)/g,function(t,e){n.push(e)}),n},n.modules={},t("extend",[],function(){return function(t,e){for(var n in e)t[n]=e[n]}}),t("assert",[],function(){function t(e){if(e instanceof Array){var n=[];return e.forEach(function(e){n=n.concat(t(e))}),n}return[e]}var e,n=function(e){this.failMesg=t(e||"Assertion failed: ")};n.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var n=e(arguments),i=n.shift();if(n=t(n),n=this.failMesg.concat(i).concat(n).concat(["mode",this._mode]),console.log.apply(console,n),this.isDefensive())return i;if(this.isBool())return!1;throw new Error(n.join(" "))},subAssertion:function(){var i=e(arguments);return i=t(i),new n(this.failMesg.concat(i))},assert:function(t,e){return t?t:this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):this.isBool()?!0:t},ne:function(t,e){return t===e?this.fail(t,"===",e):this.isBool()?!0:t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):this.isBool()?!0:t},is:function(t,e){var n=e,i=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[i]),this.isBool()?!0:t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var r=this,o=0;o<n.length;o++){var s=r.subAssertion("failed at ",t,"[",o,"]: ");null==n[o]&&console.log("WOW!7",i[o],n[o]),s.is(i[o],n[o])}return this.isBool()?!0:t}if(n===String||"string"==n)return this.assert("string"==typeof i,[i,"should be a string "]),this.isBool()?!0:t;if(n===Number||"number"==n)return this.assert("number"==typeof i,[i,"should be a number"]),this.isBool()?!0:t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(i,String),this.assert(n.exec(i),[i,"does not match to",n]),this.isBool()?!0:t;if(n===Function)return this.assert("function"==typeof i,[i,"should be a function"]),this.isBool()?!0:t;if("function"==typeof n)return this.assert(i instanceof n,[i,"should be ",n]),this.isBool()?!0:t;if(n&&"object"==typeof n){for(var a in n){var s=this.subAssertion("failed at ",t,".",a,":");s.is(t[a],n[a])}return this.isBool()?!0:t}if("string"==typeof n){var u=this._regedType[n];return u?this.is(t,u):this.isBool()?!0:t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&r(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},e=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var i=new n,r=function(){try{return i.assert.apply(i,arguments)}catch(t){throw new Error(t.stack)}};return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){r[t]=function(){try{return i[t].apply(i,arguments)}catch(e){throw console.log(e.stack),new Error(e.message)}}}),r.fail=i.fail.bind(i),r.MODE_STRICT=i.MODE_STRICT,r.MODE_DEFENSIVE=i.MODE_DEFENSIVE,r.MODE_BOOL=i.MODE_BOOL,r.f=function(t){return{_assert_func:t}},r.opt=function(t){return r.f(function(e){return null==e||e instanceof t})},r.and=function(){var t=e(arguments);return r(t instanceof Array),r.f(function(e){for(var n=this,i=0;i<t.length;i++)n.is(e,t[i])})},r}),t("PathUtil",["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}function n(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n}var i,r=/^([a-zA-Z]):/,o=/^([a-z\-]+):\/\/\/?([^\/]+)\//,s=t.f(function(t){this.is(t,String),this.assert(i.isPath(t),[t," is not a path"])}),a=t.f(function(t){this.is(t,String),this.assert(i.isAbsolutePath(t),[t," is not a absolute path"])}),u=t.f(function(t){this.is(t,String),this.assert(!i.isAbsolutePath(t),[t," is not a relative path"])}),c=t.f(function(t){this.is(t,s),this.assert(i.isDir(t),[t," is not a directory path"])}),l=t.and(c,a),f=t.f(function(t){this.is(t,s),this.assert(!i.isDir(t),[t," is not a file path"])}),h="/";return i={Path:s,Absolute:a,Relative:u,Dir:c,File:f,AbsDir:l,SEP:h,endsWith:e,startsWith:n,hasDriveLetter:function(t){return r.exec(t)},isURL:function(t){var e=o.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:h+t.substring(e[0].length)}},isPath:function(){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),i.isPath(e)&&!i.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),i.isPath(e)&&(i.startsWith(e,h)||i.hasDriveLetter(e)||i.isURL(e))},isDir:function(n){return n=i.fixSep(n),t.is(arguments,[s]),e(n,h)},hasBackslashSep:function(t){return t.indexOf("\\")>=0},fixSep:function(e,n){return n=n||"/",t.is(arguments,[String]),t.is(e.replace(/[\\\/]/g,n),s)},directorify:function(e){return i.isDir(e)?e:t.is(e+h,c)},filify:function(e){return i.isDir(e)?t.is(e.substring(0,e.length-1),f):e},splitPath:function(e){t.is(arguments,[s]);var n;if(n=this.isURL(e)){var i=this.splitPath(n.path);return i[0]=n.protocol+"://"+n.hostPort,i}e=e.replace(/\/+/g,h);var r=e.split(h);return""==r[r.length-1]&&(r[r.length-2]+=h,r.pop()),r},name:function(e){return t.is(arguments,[String]),i.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var n=i.name(e),r=/\.[a-zA-Z0-9]+$/.exec(n);return r?r[0]:null},truncExt:function(e,n){t.is(e,String);var r=i.name(e);return n=n||i.ext(e),t.is(n,String),r.substring(0,r.length-n.length)},truncSEP:function(e){return t.is(arguments,[s]),i.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(n,r){return t.is(arguments,[String,String]),e(i.name(n),r)},parent:function(e){return t.is(arguments,[String]),i.up(e)},rel:function(e,n){if(""==n)return e;t.is(arguments,[l,u]);var r=i.splitPath(n),o=e;o=o.replace(/\/$/,"");var s=i;return r.forEach(function(t){".."==t||"../"==t?o=s.up(o):(o=o.replace(/\/$/,""),o+=h+("."==t||"./"==t?"":t))}),o},relPath:function(e,n){return t.is(arguments,[a,a]),e.substring(0,n.length)!=n?"../"+i.relPath(e,this.up(n)):e.substring(n.length)},up:function(t){if(t==h)return null;var e=i.splitPath(t);return e.pop(),e.join(h)+h}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(t){var e=i[t];i[t]=function(){var t=!1,n=Array.prototype.slice.call(arguments).map(function(e){return i.hasBackslashSep(e)?(t=!0,i.fixSep(e)):e}),r=e.apply(i,n);return t?i.fixSep(r,"\\"):r}}),i.isAbsolute=i.isAbsolutePath,i.isRelative=i.isRelativePath,"object"==typeof window&&(window.PathUtil=i),i}),t("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".wav":"audio/x-wav",".mp3":"audio/mp3",".ogg":"audio/ogg",".midi":"audio/midi",".mid":"audio/midi",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu",".c":"text/c",".dtl":"text/dolittle"}}),t("DeferredUtil",[],function(){var t,e="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:null,n=function(t){this.res=t};return t={isNativePromise:function(t){return t&&"function"==typeof t.then&&"function"!=typeof t.promise&&"function"==typeof t.catch},isJQPromise:function(t){return t&&"function"==typeof t.then&&"function"==typeof t.promise&&"function"==typeof t.fail},isPromise:function(t){return t&&"function"==typeof t.then&&("function"==typeof t.promise||"function"==typeof t.catch)},all:function(e){return t.promise(function(n,i){var r=[],o=e.length;e.forEach(function(e,s){t.resolve(e).then(function(t){r[s]=t,o--,0===o&&n(r)},i)})})},resolve:function(e){return t.config.useJQ&&t.isJQPromise(e)?e:!t.config.useJQ&&t.isNativePromise(e)?e:t.promise(function(n,i){t.isPromise(e)?e.then(n,i):n(e)})},throwNowIfRejected:function(e){var n,i,r=e.then(function(t){return n||(n="resolved"),t},function(e){return n?t.reject(e):(n="rejected",void(i=e))});if(n||(n="notyet"),"rejected"===n)throw i;return r},assertResolved:function(t){var e,n;if(t.then(function(t){e=t,n=!0}),!n)throw console.log(r),new Error("Promise not resolved");return e},ensureDefer:function(e){return t.promise(function(n,i){var r;t.resolve(e).then(function(t){r?n(t):setTimeout(function(){n(t)},0)}).fail(function(t){r?i(t):setTimeout(function(){i(t)},0)}),r=!0})},directPromise:function(e){return t.timeout(e,0)},then:function(e){return t.directPromise().then(e)},timeout:function(e,n){return t.promise(function(t){setTimeout(function(){t(n)},e||0)})},funcPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;try{e(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(i){n.reject(i)}return n.promise()}if(t.external.Promise)return new t.external.Promise(function(t,n){try{e(t,n)}catch(i){n(i)}});throw new Error("promise is not found")},reject:function(e){if(t.config.useJQ){var n=new $.Deferred;return n.reject(e),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(e)},0),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(n){return console.log(n,n.stack),t.throwPromise(n)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(i){return i>=e.length?t.brk():t.resolve(n(e[i],i)).then(function(){return i+1})},0);var i=[];for(var r in e)i.push({k:r,v:e[r]});return t.each(i,function(t){return n(t.k,t.v)})},loop:function(e,i){try{for(var r;;){if(i instanceof n)return t.when1(i.res);var o=!0,s=!1,a=e(i),u=t.resolve(a).then(function(r){return i=r,o=!1,i instanceof n?i.res:s?t.loop(e,i):void 0}).fail(function(t){o=!1,r=t});if(r)throw r;if(s=!0,o)return u}}catch(c){return t.reject(c)}},brk:function(t){return new n(t)},tryLoop:function(e,n){return t.loop(t.tr(e),n)},tryEach:function(e,n){return t.loop(e,t.tr(n))},documentReady:function(){return t.callbackToPromise(function(t){$(t)})},requirejs:function(n){if(!e.requirejs)throw new Error("requirejs is not loaded");return t.callbackToPromise(function(t){e.requirejs(n,t)})}},t.NOP=function(t){return t},t.E=function(){console.log("DUE",arguments),t.errorHandler.apply(t,arguments)},t.errorHandler=function(t){console.error.apply(console,arguments),alert(t)},t.setE=function(e){t.errorHandler=e},t.begin=t.try=t.tr=t.throwF,t.promise=t.callbackToPromise=t.funcPromise,t.when1=t.resolve,t.config={},e.$&&e.$.Deferred&&(t.config.useJQ=!0),t.external={Promise:e.Promise},e.DeferredUtil||(e.DeferredUtil=t),t}),t("FSClass",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(t,e,n,i,r){function o(t){throw new Error(t+" is STUB!")}var s=function(){},a={};return s.addFSType=function(t,e){a[t]=e},s.availFSTypes=function(){return a},t(s.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},isReadOnly:function(){o("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(t){return i(this.getRootFS()!==this),this.getRootFS().resolveFS(t)},mounted:function(t,e){this.rootFS=t,this.mountPoint=e},inMyFS:function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},getRootFS:function(){return i(this.rootFS,"rootFS is not set")},getReturnTypes:function(){o("")},getContent:function(){o("getContent")},getContentAsync:function(){return this.supportsSync()||o("getContentAsync"),r.resolve(this.getContent.apply(this,arguments))},setContent:function(){o("")},setContentAsync:function(t,e,n){var i=this;return i.supportsSync()||o("setContentAsync"),r.resolve(e).then(function(e){return r.resolve(i.setContent(t,e,n))})},appendContent:function(){o("")},appendContentAsync:function(t,e,n){var i=this;return i.supportsSync()||o("appendContentAsync"),r.resolve(e).then(function(e){return r.resolve(i.appendContent(t,e,n))})},getMetaInfo:function(){o("")},setMetaInfo:function(){o("")},mkdir:function(){o("mkdir")},touch:function(){o("touch")},exists:function(){o("exists")},opendir:function(){o("opendir")},opendirAsync:function(){return this.supportsSync()||o("opendirAsync"),r.resolve(this.opendir.apply(this,arguments))},cp:function(t,n,r){i.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),r=r||{};var o=this.isDir(t),s=this.getRootFS().resolveFS(n),a=s.isDir(n);if(o||a)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(t),c=s.setContent(n,u);return r.a&&s.setMetaInfo(n,this.getMetaInfo(t)),c}return s.setContentAsync(n,this.getContentAsync(t)).then(function(e){return r.a?s.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(){o("")},link:function(t,e){throw new Error("ln "+e+" "+t+" : This FS not support link.")},getURL:function(){o("")}}),s.delegateMethods=function(t,n){for(var r in n)!function(r){i.ne(r,"inMyFS"),t[r]=function(){var t=arguments[0];i.is(t,e.Absolute);var o=this.resolveFS(t);return o!==this?(console.log("Invoked for other fs",this.mountPoint,o.mountPoint),o[r].apply(o,arguments)):n[r].apply(this,arguments)}}(r)},s.delegateMethods(s.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},getContentType:function(t,i){var r=(e.ext(t)+"").toLowerCase();return n[r]||(i||{}).def||"application/octet-stream"},getBlob:function(t,e){var n=this.getContent(t);return e=e||{},e.blobType=e.blobType||Blob,e.binType=e.binType||ArrayBuffer,n.hasPlainText()?new e.blobType([n.toPlainText()],this.getContentType(t)):new e.blobType([n.toBin(e.binType)],this.getContentType(t))},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t){return e.isDir(t)},find:function(t,n){i.is(arguments,[e.Absolute]);var r=this.opendir(t,n),o=this,s=[t];return r.forEach(function(i){var r=e.rel(t,i);if(e.isDir(r)){var a=o.resolveFS(r);s=s.concat(a.find(r,n))}else s.push(r)}),s},resolveLink:function(t){i.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){i(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var r=this.isLink(n);if(r){i(r!=n,"l==p=="+r);var o=e.rel(r,e.relPath(t,n));return i(o!=t,"np==path=="+o),i.is(this.getRootFS().resolveFS(o).resolveLink(o),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(){return null},opendirEx:function(t){i.is(t,e.AbsDir);var n=this.opendir(t),r=this,o={};return n.forEach(function(n){var i=e.rel(t,n);o[n]=r.getMetaInfo(i)}),o},getDirTree:function(t,n){n=n||{};var r=n.dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],i.is(n.excludes,Array),n.base||(n.base=t),i.is(t,e.AbsDir);var o=this.opendirEx(t,n);if("no-recursive"==n.style)return o;var s=this;for(var a in o){var u=o[a],c=e.rel(t,a),l=e.relPath(c,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(l)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(c)>=0)continue}if(s.isDir(c))switch(n.style){case"flat-absolute":case"flat-relative":s.getDirTree(c,n);break;case"hierarchical":n.dest={},r[a]=s.getDirTree(c,n)}else switch(n.style){case"flat-absolute":r[c]=u;break;case"flat-relative":r[l]=u;break;case"hierarchical":r[a]=u}}return r}}),s}),t("Util",[],function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=i.exec(window.location.href);return null==r?n:e(r[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function i(t,e){return t.substring(0,e.length)===e}function r(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var i=t[n];n.match(/^_/)||"function"==typeof i&&(e[n]=function(){var e=i.apply(t,arguments);return e})}(n);return e}function o(t,e){for(var n in e||{})t[n]=e[n];return t}return{getQueryString:t,endsWith:n,startsWith:i,privatize:r,extend:o}}),t("Content",["assert","Util"],function(t,e){var n=function(){},i=e.extend;n.plainText=function(t,e){var i=new n;return i.contentType=e||"text/plain",i.plain=t,i},n.url=function(t){var e=new n;return e.url=t,e},n.buffer2ArrayBuffer=function(e){if(n.isBuffer(e)){var i=new Uint8Array(e),r=i.buffer;if(r instanceof ArrayBuffer)return r;var o=Array.prototype.slice.call(i);return t(new Uint8Array(o).buffer,"n2a: buf is not set")}return t(e,"n2a: a is not set")},n.arrayBuffer2Buffer=function(e){if(e instanceof ArrayBuffer){var n=new Buffer(new Uint8Array(e));return n}return t(e,"a2n: a is not set")},n.bin=function(e,i){t(i,"contentType should be set");var r=new n;if(e&&n.isBuffer(e.buffer))r.arrayBuffer=e.buffer;else if(n.isNodeBuffer(e))r.nodeBuffer=e;else{if(!(e instanceof ArrayBuffer))throw new Error(e+" is not a bin");r.arrayBuffer=e}return r.contentType=i,r},n.looksLikeDataURL=function(t){return t.match(/^data:/)};var r=n.prototype;r.toBin=function(t){if(t=t||(n.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return t===Buffer?this.nodeBuffer:this.arrayBuffer=n.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return t===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=n.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var e=new s(this.url,t);return this.setBuffer(e.buffer)}if(null!=this.plain)return this.setBuffer(n.str2utf8bytes(this.plain,t));throw new Error("No data")},r.setBuffer=function(e){return t(e,"b is not set"),n.isNodeBuffer(e)?this.nodeBuffer=e:this.arrayBuffer=e},r.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},r.toNodeBuffer=function(){return this.toBin(Buffer)},r.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=n.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var t=new s(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=t.url}throw new Error("No data")},r.toPlainText=function(){if(this.hasPlainText())return this.plain;if(this.url&&!this.hasBin()){var t=new s(this.url,ArrayBuffer);this.arrayBuffer=t.buffer}if(this.hasBin())return this.plain=n.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},r.hasURL=function(){return this.url},r.hasPlainText=function(){return null!=this.plain},r.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},r.hasNodeBuffer=function(){return this.nodeBuffer},r.hasArrayBuffer=function(){return this.arrayBuffer},n.Base64_To_ArrayBuffer=function(t,e){function i(e){throw console.log(e),console.log(t,h),new Error(e)}var r=e||ArrayBuffer;t=t.replace(/[\n=]/g,"");var o=new Object;o[65]=0,o[66]=1,o[67]=2,o[68]=3,o[69]=4,o[70]=5,o[71]=6,o[72]=7,o[73]=8,o[74]=9,o[75]=10,o[76]=11,o[77]=12,o[78]=13,o[79]=14,o[80]=15,o[81]=16,o[82]=17,o[83]=18,o[84]=19,o[85]=20,o[86]=21,o[87]=22,o[88]=23,o[89]=24,o[90]=25,o[97]=26,o[98]=27,o[99]=28,o[100]=29,o[101]=30,o[102]=31,o[103]=32,o[104]=33,o[105]=34,o[106]=35,o[107]=36,o[108]=37,o[109]=38,o[110]=39,o[111]=40,o[112]=41,o[113]=42,o[114]=43,o[115]=44,o[116]=45,o[117]=46,o[118]=47,o[119]=48,o[120]=49,o[121]=50,o[122]=51,o[48]=52,o[49]=53,o[50]=54,o[51]=55,o[52]=56,o[53]=57,o[54]=58,o[55]=59,o[56]=60,o[57]=61,o[43]=62,o[47]=63;var s,a=t.length,u=0,c=0;if(!a)return new r(0);s=Math.floor(a/4*3),"="==t.charAt(a-1)&&(s-=1),"="==t.charAt(a-2)&&(s-=1);for(var l=new r(s),f=n.isNodeBuffer(l)?l:new Uint8Array(l),h=0,p=0;s>p&&(c=o[t.charCodeAt(h)],void 0===c&&i("Invalid letter: "+t.charCodeAt(h)),u=c<<2,h++,c=o[t.charCodeAt(h)],void 0===c&&i("Invalid letter: "+t.charCodeAt(h)),f[p]=u|c>>4&3,u=(15&c)<<4,h++,p++,!(p>=s))&&(c=o[t.charCodeAt(h)],void 0===c&&i("Invalid letter: "+t.charCodeAt(h)),f[p]=u|c>>2&15,u=(3&c)<<6,h++,p++,!(p>=s));)c=o[t.charCodeAt(h)],void 0===c&&i("Invalid letter: "+t.charCodeAt(h)),f[p]=u|c,h++,p++;return l},n.Base64_From_ArrayBuffer=function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",i=new Uint8Array(t),r=i.length,o=0,s=0,a=0;r>a&&(s=i[a],n+=e[s>>2],o=(3&s)<<4,a++,!(a>=r))&&(s=i[a],n+=e[o|s>>4],o=(15&s)<<2,a++,!(a>=r));)s=i[a],n+=e[o|s>>6],n+=e[63&s],a++;var u=r%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n},n.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},n.isNodeBuffer=function(t){return n.hasNodeBuffer()&&t instanceof Buffer},n.isBuffer=function(t){return t instanceof ArrayBuffer||n.isNodeBuffer(t)},n.utf8bytes2str=function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));return decodeURIComponent(e.join(""))},n.str2utf8bytes=function(t,e){for(var n=encodeURIComponent(t),i=/^%(..)/,r=[],o=0;o<n.length;o++){var s=i.exec(n.substring(o));s?(r.push(parseInt("0x"+s[1])),o+=s[0].length-1):r.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(r):new Uint8Array(r).buffer};var o=n.hasNodeBuffer()?Buffer:ArrayBuffer,s=function(e,i){"string"==typeof e?(this.url=e,this.binType=i||o,this.dataURL2bin(e)):e&&n.isBuffer(e.buffer)?(this.buffer=e.buffer,t.is(i,String),this.contentType=i,this.bin2dataURL(this.buffer,this.contentType)):n.isBuffer(e)?(this.buffer=e,t.is(i,String),this.contentType=i,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),t.fail("Invalid args: ",arguments))};return n.DataURL=s,i(s.prototype,{bin2dataURL:function(e,i){t(n.isBuffer(e)),t.is(i,String);var r=this.dataHeader(i),o=n.Base64_From_ArrayBuffer(e);return t.is(o,String),this.url=r+o},dataURL2bin:function(e){t.is(arguments,[String]);var i=/^data:([^;]+);base64,/i,r=i.exec(e);return t(r,["malformed dataURL:",e]),this.contentType=r[1],this.buffer=n.Base64_To_ArrayBuffer(e.substring(r[0].length),this.binType),t.is(this.buffer,this.binType)},dataHeader:function(e){return t.is(arguments,[String]),"data:"+e+";base64,"},toString:function(){return t.is(this.url,String)}}),n}),t("NativeFS",["FSClass","assert","PathUtil","extend","Content"],function(t,e,n,i,r){var o="object"==typeof process;if(!o)return function(){throw new Error("This system not support native FS")};var s=e,a=require("fs"),u=function(t){t&&(e.is(t,n.AbsDir),this.rootPoint=t)},c=n.hasDriveLetter(process.cwd());u.available=!0;var l=n.SEP,f=u.prototype=new t;return f.toNativePath=function(t){return this.rootPoint?(e.is(t,n.Absolute),e(this.inMyFS(t),t+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(t,this.mountPoint||n.SEP))):t},f.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var e=new Buffer(new Uint8Array(t));return e}return t},t.addFSType("NativeFS",function(t,e){return new u(e.r)}),u.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},u.prototype.inMyFS=function(t){return this.mountPoint?n.startsWith(t,this.mountPoint):!(!!c^!!n.hasDriveLetter(t))},t.delegateMethods(u.prototype,{getReturnTypes:function(){return s.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,i){i=i||{},e.is(t,n.Absolute);var o=this.toNativePath(t);return this.assertExist(t),r.bin(a.readFileSync(o),this.getContentType(t))},setContent:function(t,i){e.is(arguments,[n.Absolute,r]);var o=n.up(t);o&&this.getRootFS().resolveFS(o).mkdir(o);var s=this.toNativePath(t);i.hasBin()||!i.hasPlainText()?a.writeFileSync(s,i.toNodeBuffer()):a.writeFileSync(s,i.toPlainText())},appendContent:function(t,i){e.is(arguments,[n.Absolute,r]);var o=n.up(t);o&&this.getRootFS().resolveFS(o).mkdir(o);var s=this.toNativePath(t);i.hasBin()||!i.hasPlainText()?a.appendFileSync(s,i.toNodeBuffer()):a.appendFileSync(s,i.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(){},isReadOnly:function(){return!1},stat:function(t){e.is(t,n.Absolute);var i=this.toNativePath(t);return a.statSync(i)},mkdir:function(t){if(s.is(arguments,[n.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var e=n.up(t);e&&this.getRootFS().resolveFS(e).mkdir(e);var i=this.toNativePath(t);return a.mkdirSync(i),this.assertExist(i)},opendir:function(t,e){s.is(arguments,[String]),e=e||{};var i=this.toNativePath(t),r=n.truncSEP(i),o=a.readdirSync(i);e.nosep||(o=o.map(function(t){var e=a.statSync(r+l+t),n=e.isDirectory()?l:"";return t+n}));var u=[];return s.is(u.concat(o),Array)},rm:function(t,e){s.is(arguments,[n.Absolute]),e=e||{},this.assertExist(t);var i=this.toNativePath(t);return this.isDir(t)?a.rmdirSync(i):a.unlinkSync(i)},exists:function(t){var e=this.toNativePath(t);return a.existsSync(e)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():n.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&a.utimesSync(t,Date.now()/1e3,Date.now()/1e3)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")}}),u}),t("LSFS",["FSClass","PathUtil","extend","assert","Util","Content"],function(t,e,n,i,r,o){function s(){return(new Date).getTime()}var a=function(t,e){i(t," new LSFS fail: no storage"),this.storage=t,this.options=e||{},this.options.useDirCache&&(this.dirCache={})},u=e.isDir.bind(e),c=e.up.bind(e),l=e.endsWith.bind(e),f=(e.Path,e.Absolute),h=e.SEP;return a.ramDisk=function(t){var n={};return n[e.SEP]="{}",t=t||{},"useDirCache"in t||(t.useDirCache=!0),new a(n,t)},t.addFSType("localStorage",function(t,e){return new a(localStorage,e)}),t.addFSType("ram",function(t,e){return a.ramDisk(e)}),a.now=s,a.prototype=new t,a.prototype.resolveKey=function(t){return i.is(t,e.Absolute),this.mountPoint?e.SEP+e.relPath(t,this.mountPoint):t},a.prototype.getItem=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},a.prototype.setItem=function(t,n){i.is(t,e.Absolute);var r=this.resolveKey(t);i(r.indexOf("..")<0),i(e.startsWith(r,e.SEP)),this.storage[r]=n},a.prototype.removeItem=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},a.prototype.itemExists=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);return i(this.storage,"No storage"),n in this.storage},a.prototype.getDirInfo=function(t){if(i.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");if(l(t,h)||(t+=h),i(this.inMyFS(t)),this.dirCache&&this.dirCache[t])return this.dirCache[t];var n={};try{var r=this.getItem(t);r&&(n=JSON.parse(r))}catch(o){console.log("dinfo err : ",t,r)}return this.dirCache&&(this.dirCache[t]=n),n},a.prototype.putDirInfo=function(t,n,r){if(i.is(arguments,[e.AbsDir,Object]),!u(t))throw new Error("Not a directory : "+t);i(this.inMyFS(t)),this.dirCache&&(this.dirCache[t]=n),this.setItem(t,JSON.stringify(n));var o=c(t);if(null!=o&&this.inMyFS(o)){var s=this.getDirInfo(o);this._touch(s,o,e.name(t),r)}},a.prototype._touch=function(t,n,r,o){i.is(arguments,[Object,String,String]),i(this.inMyFS(n)),t[r]||(t[r]={},o&&(t[r].trashed=!0)),o||delete t[r].trashed,t[r].lastUpdate=s(),this.getRootFS().notifyChanged(e.rel(n,r),t[r]),this.putDirInfo(n,t,o)},a.prototype.removeEntry=function(t,e,n){i.is(arguments,[Object,String,String]),t[n]&&(t[n]={lastUpdate:s(),trashed:!0},this.putDirInfo(e,t,!0))},a.prototype.removeEntryWithoutTrash=function(t,e,n){i.is(arguments,[Object,String,String]),t[n]&&(delete t[n],this.putDirInfo(e,t,!0))},a.prototype.isRAM=function(){return this.storage!==localStorage},a.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},a.getUsage=function(){var t=0;for(var e in localStorage)"string"==typeof localStorage[e]&&(t+=localStorage[e].length);return t},a.getCapacity=function(){function t(){try{return localStorage[i+e]=n,e++,r+=n.length,!0}catch(t){return delete localStorage[i+e],!1
}}var e=0,n="a",i="___checkls___",r=0,o=Math.pow(2,25);try{for(var s=0;10>s;s++)n+=n;for(var s in localStorage)s.substring(0,i.length)==i?delete localStorage[s]:"string"==typeof localStorage[s]&&(r+=localStorage[s].length);for(var a=r;t()&&n.length<o;)n+=n;for(;n.length>1024;)n=n.substring(n.length/2),t();return{using:a,max:r}}finally{for(var s=0;e>s;s++)delete localStorage[i+s]}},t.delegateMethods(a.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(){return i.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t){i.is(arguments,[f]),this.assertExist(t);var e,n=this.getItem(t);return e=o.looksLikeDataURL(n)?o.url(n):o.plainText(n)},setContent:function(t,e){i.is(arguments,[f,o]),this.assertWriteable(t);var n=null;e.hasPlainText()&&(n=e.toPlainText(),o.looksLikeDataURL(n)&&(n=null)),null!=n?this.setItem(t,n):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t){if(this.assertExist(t,{includeTrashed:!0}),i.is(arguments,[f]),t==e.SEP)return{};var n=i(e.up(t));if(!this.inMyFS(n))return{};var r=e.name(t);i.is(n,e.AbsDir);var o=this.getDirInfo(n);return i(o[r])},setMetaInfo:function(t,n){i.is(arguments,[String,Object]),this.assertWriteable(t);var r=i(e.up(t));if(this.inMyFS(r)){var o=this.getDirInfo(r),s=e.name(t);o[s]=n,this.putDirInfo(r,o,o[s].trashed)}},mkdir:function(t){i.is(arguments,[f]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){i.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),r=[];for(var o in n)i(n[o]),(!n[o].trashed||e.includeTrashed)&&r.push(o);return i.is(r,Array)},rm:function(t,n){i.is(arguments,[f]),n=n||{},this.assertWriteable(t);var r=e.up(t);if(null==r||!this.inMyFS(r))throw new Error(t+": cannot remove. It is root of this FS.");if(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t)){var o=this.opendir(t);o.length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)}else this.removeItem(t);var s=this.getDirInfo(r);n.noTrash?this.removeEntryWithoutTrash(s,r,e.name(t)):this.removeEntry(s,r,e.name(t))},exists:function(t,n){i.is(arguments,[f]),n=n||{};var r=e.name(t),o=e.up(t);if(null==o||!this.inMyFS(o))return!0;var s=this.getDirInfo(o),a=s[r];return a&&a.trashed&&this.itemExists(t)&&this.isDir(t),!a&&this.itemExists(t),a&&!a.trashed&&!a.link&&!this.itemExists(t),a&&!n.includeTrashed&&(a=!a.trashed),!!a},link:function(t,n){i.is(arguments,[e.Absolute,e.Absolute]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var r={};r.link=n,r.lastUpdate=s(),this.setMetaInfo(t,r),i(this.exists(t)),i(this.isLink(t))},isLink:function(t){if(i.is(arguments,[e.Absolute]),!this.exists(t))return null;var n=i(this.getMetaInfo(t));return n.link},touch:function(t){i.is(arguments,[f]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?(this.dirCache&&(this.dirCache[t]={}),this.setItem(t,"{}")):this.setItem(t,""));var n=c(t);if(null!=n)if(this.inMyFS(n)){var r=this.getDirInfo(n);this._touch(r,n,e.name(t),!1)}else i(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(t){return this.getContent(t).toURL()},opendirEx:function(t,n){i.is(t,e.AbsDir),n=n||{};var r={},o=this.getDirInfo(t);if(n.includeTrashed)return o;for(var s in o)o[s].trashed||(r[s]=o[s]);return r}}),a}),$.ajaxTransport("+binary",function(t,e,n){return window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob))?{send:function(e,n){var i=new XMLHttpRequest,r=t.url,o=t.type,s=t.async||!0,a=t.responseType||"blob",u=t.data||null,c=t.username||null,l=t.password||null;i.addEventListener("load",function(){var e={};e[t.dataType]=i.response,n(i.status,i.statusText,e,i.getAllResponseHeaders())}),i.open(o,r,s,c,l);for(var f in e)i.setRequestHeader(f,e[f]);i.responseType=a,i.send(u)},abort:function(){n.abort()}}:void 0}),t("jquery.binarytransport",function(){}),t("WebFS",["FSClass","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(t,e,n,i,r){var o=function(){},s=o.prototype=new t;return t.addFSType("web",function(){return new o}),s.fstype=function(){return"Web"},s.supportsSync=function(){return!1},s.inMyFS=function(t){return r.isURL(t)},t.delegateMethods(s,{exists:function(){return!0},getContentAsync:function(t){var e=this;return n.promise(function(n,r){$.get(t,function(r){var o=new FileReader;o.addEventListener("loadend",function(){n(i.bin(o.result,e.getContentType(t)))}),o.readAsArrayBuffer(r)},"binary").fail(r)})},getURL:function(t){return t}}),o}),t("Env",["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),n=n.replace(/^[a-z][a-z]+:\//,function(t){return t+"/"}),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n});var s=s||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,n=e.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in n,r=function(n){var i=e.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)},o=t.webkitRequestFileSystem,s=t.requestFileSystem||o||t.mozRequestFileSystem,a=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},u=0,c=function(e){var n=function(){"string"==typeof e?(t.URL||t.webkitURL||t).revokeObjectURL(e):e.remove()};t.chrome?n():setTimeout(n,10)},l=function(t,e,n){e=[].concat(e);for(var i=e.length;i--;){var r=t["on"+e[i]];if("function"==typeof r)try{r.call(t,n||t)}catch(o){a(o)}}},f=function(e,a){var f,h,p,d=this,m=e.type,g=!1,v=function(){l(d,["writestart","progress","write","writeend"])},y=function(){(g||!f)&&(f=(t.URL||t.webkitURL||t).createObjectURL(e)),h?h.location.href=f:void 0==t.open(f,"_blank")&&"undefined"!=typeof safari&&(t.location.href=f),d.readyState=d.DONE,v(),c(f)},b=function(t){return function(){return d.readyState!==d.DONE?t.apply(this,arguments):void 0}},T={create:!0,exclusive:!1};d.readyState=d.INIT,a||(a="download"),i?(f=(t.URL||t.webkitURL||t).createObjectURL(e),n.href=f,n.download=a,r(n),d.readyState=d.DONE,v(),c(f)):(t.chrome&&m&&"application/octet-stream"!==m&&(p=e.slice||e.webkitSlice,e=p.call(e,0,e.size,"application/octet-stream"),g=!0),o&&"download"!==a&&(a+=".download"),("application/octet-stream"===m||o)&&(h=t),s?(u+=e.size,s(t.TEMPORARY,u,b(function(t){t.root.getDirectory("saved",T,b(function(t){var n=function(){t.getFile(a,T,b(function(t){t.createWriter(b(function(n){n.onwriteend=function(e){h.location.href=t.toURL(),d.readyState=d.DONE,l(d,"writeend",e),c(t)},n.onerror=function(){var t=n.error;t.code!==t.ABORT_ERR&&y()},["writestart","progress","write","abort"].forEach(function(t){n["on"+t]=d["on"+t]}),n.write(e),d.abort=function(){n.abort(),d.readyState=d.DONE},d.readyState=d.WRITING}),y)}),y)};t.getFile(a,{create:!1},b(function(t){t.remove(),n()}),b(function(t){t.code===t.NOT_FOUND_ERR?n():y()}))}),y)}),y)):y())},h=f.prototype;return h.abort=function(){this.readyState=this.DONE,l(this,"abort")},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(t,e){return new f(t,e)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=s:"undefined"!=typeof t&&null!==t&&null!=t.amd&&t("FileSaver.min",[],function(){return s}),t("SFile",["extend","assert","PathUtil","Util","Content","FSClass","FileSaver.min","DeferredUtil"],function(t,e,n,i,r,o,a,u){var c=function(t,i){e.is(i,n.Absolute),this._path=i,this.rootFS=t,this.fs=t.resolveFS(i),this.isDir()&&!n.isDir(i)&&(this._path+=n.SEP)};return c.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},c.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},getPolicy:function(){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(t,r){var o;if(r=r||{},c.is(t))o=t;else{e.is(t,n.Absolute);var s,a=r.policy||this.policy;if(a&&(s=a.topDir)&&(s.path&&(s=s.path()),!n.startsWith(t,s)))throw new Error(t+": cannot access. Restricted to "+s);o=new c(this.rootFS,t),o.policy=a}return o.policy?i.privatize(o):o},contains:function(t){return e(c.is(t),t+" shoud be a SFile object."),this.isDir()?n.startsWith(t.path(),this.path()):!1},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var i=t.path?t.path():t;return n.relPath(this.path(),e.is(i,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var i=this.path();return this._resolve(n.rel(i,t))},sibling:function(t){return this.up().rel(t)},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var t=this.metaInfo();return t?t.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.act.fs.getMetaInfo(this.act.path,t)},setMetaInfo:function(t,e){return this.act.fs.setMetaInfo(this.act.path,t,e)},getDirTree:function(t){return this.act.fs.getDirTree(this.act.path,t)},assertExists:function(){e(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(t){var e=Array.prototype.slice.call(arguments);if("function"==typeof e[0]){var n=e.shift();return u.resolve(this.exists.apply(this,e)).then(n)}t=t||{};var i=this.fs.exists(this.path(),t);return i||t.noFollowLink?i:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(t){var e=this;if(t=t||{},this.isLink())return u.resolve(this.fs.rm(this.path(),t));var n;return n=this.isDir()&&(t.recursive||t.r)?this.each(function(e){return e.rm(t)}):u.resolve(),n.then(function(){return e.act.fs.rm(e.act.path,t)})},removeWithoutTrash:function(t){t=t||{},t.noTrash=!0,this.rm(t)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(t){return"function"==typeof t?this.getText(t):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(t){if(e.is(t,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());var n=this.contentType({def:null});return u.throwNowIfRejected(null!==n&&!n.match(/^text/)&&r.looksLikeDataURL(t)?this.setContent(r.url(t)):this.setContent(r.plainText(t)))},appendText:function(t){return e.is(t,String),this.act.fs.appendContent(this.act.path,r.plainText(t))},getContent:function(t){return"function"==typeof t?this.act.fs.getContentAsync(this.act.path).then(t):this.act.fs.getContent(this.act.path)},setContent:function(t){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,t)},getText:function(t){function e(t){try{return t.toPlainText()}catch(e){return t.toURL()}}if("function"==typeof t){return this.getContent(e).then(t)}return e(this.act.fs.getContent(this.act.path))},getDataURL:function(t){return"function"==typeof t?this.getContent(function(t){return t.toURL()}):this.getContent().toURL()},setDataURL:function(t){return this.setContent(r.url(t))},dataURL:function(t){return"string"==typeof t?this.setDataURL(t):"function"==typeof t?this.getDataURL(t):this.getDataURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(t){return this.act.fs.getContentType(this.act.path,t)},bytes:function(t){return r.isBuffer(t)?this.setBytes(t):this.getBytes()},setBytes:function(t){return this.act.fs.setContent(this.act.path,r.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.act.fs.getContent(this.act.path).toBin(t.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(){return this.text().replace(/\r/g,"").split("\n")},obj:function(){var t=this;if(0==arguments.length){var n=t.text();return n?JSON.parse(n):null}t.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,n){e(t&&t.isSFile(),t+" is not a file");var i=this,n=n||{},r=i.isDir(),o=t.isDir();if(!r&&o&&(t=t.rel(i.name()),e(!t.isDir(),t+" is a directory."),o=!1),!r||o){if(r||o)return e(r&&o,"Both src and dst should be dir"),i.each(function(e){return t.rel(e.name()).copyFrom(e,n)});n.echo&&n.echo(i+" -> "+t);var s=this.act.fs.cp(this.act.path,t.getResolvedLinkPath(),n);return s=u.resolve(s),n.a?s.then(function(){return t.setMetaInfo(i.getMetaInfo())}):s}this.err("Cannot move dir "+i.path()+" to file "+t.path())},moveFrom:function(t,e){var n=this;return n.exists(function(i){return n.copyFrom(t,e).then(function(){return t.rm({recursive:!0})},function(t){if(!i)return n.exists(function(t){return t?n.rm({recursive:!0}):void 0}).then(function(){throw t});throw t})})},moveTo:function(t,e){return t.moveFrom(this,e)},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){var n=this.assertDir();return n.listFilesAsync(e).then(function(e){return u.each(e,t)})},eachrev:function(t,e){var n=this.assertDir();return n.listFilesAsync(e).then(function(e){return u.each(e.reverse(),t)})},recursive:function(t,e){var n=this.assertDir();return n.each(function(e){return e.isDir()?e.recursive(t):t(e)},e)},listFilesAsync:function(t){e(null==t||"object"==typeof t);var n,i=this.assertDir(),r=this.path();return t=i.convertOptions(t),n||(n=t.order),this.act.fs.opendirAsync(this.act.path,t).then(function(e){for(var o=[],s=0;s<e.length;s++){var a=e[s];t.excludes[r+a]||o.push(i.rel(a))}return"function"==typeof n&&o.sort&&o.sort(n),o})},listFiles:function(t){var e=Array.prototype.slice.call(arguments);return u.assertResolved(this.listFilesAsync.apply(this,e))},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir();if(!t)return this.act.fs.opendir(this.act.path,t);var i=n.listFiles(t);return i.map(function(t){return t.name()})},convertOptions:function(t){var r=i.extend({},t),o=(this.assertDir(),this.path());if(r.excludes||(r.excludes={}),r.excludes instanceof Array){var s={};r.excludes.forEach(function(t){n.startsWith(t,"/")?s[t]=1:s[o+t]=1}),r.excludes=s}return e.is(r,{excludes:{}})},mkdir:function(){return this.touch()},link:function(t,e){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,t.path(),e)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(t){return this.getFS().getRootFS().addObserver(this.path(),t)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use 'zip' instead.");s(this.getBlob(),this.name())},err:function(){var t=Array.prototype.slice.call(arguments);throw console.log.apply(console,t),new Error(t.join(""))}},Object.defineProperty(c.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),e.is(this._act,{fs:o,path:n.Absolute}),this._act)}}),c}),t("RootFS",["assert","FSClass","PathUtil","SFile"],function(t,e,n,i){var r=function(n){t.is(n,e),this.mount(null,n)},o=r.prototype,s={err:function(t,e){throw new Error(t+": "+e)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(e){t.is(arguments,[n.AbsDir]);var i=this.fstab();console.log(i);for(var r=0;r<i.length;r++)if(i[r].mountPoint==e)return i.splice(r,1),!0;return!1},availFSTypes:function(){return e.availFSTypes()},mount:function(n,i,r){if("string"==typeof i){var o=t(e.availFSTypes()[i],"fstype "+i+" is undefined.");i=o(n,r||{})}t.is(i,e),i.mounted(this,n),this.fstab().unshift(i)},resolveFS:function(i){t.is(i,n.Absolute);var r;return this.fstab().forEach(function(t){r||t.inMyFS(i)&&(r=t)}),r||this.err(i,"Cannot resolve"),t.is(r,e)},get:function(e){return t.is(e,n.Absolute),new i(this.resolveFS(e),e)},addObserver:function(){this.observers=this.observers||[];var e,n;if(2==arguments.length)e=arguments[0],n=arguments[1];else{if(1!=arguments.length)throw new Error("Invalid argument spec");e="",n=arguments[0]}t.is(e,String),t.is(n,Function);var i=this.observers,r={path:e,handler:n,remove:function(){var t=i.indexOf(this);i.splice(t,1)}};return this.observers.push(r),r},notifyChanged:function(t,e){this.observers&&this.observers.forEach(function(i){n.startsWith(t,i.path)&&i.handler(t,e)})},getRootFS:function(){return this}};for(var a in s)o[a]=s[a];return r}),t("zip",["SFile","FileSaver.min","Util","DeferredUtil"],function(t,e,n,i){var r={};return r.setJSZip=function(t){r.JSZip=t,i.external.Promise||(i.external.Promise=t.external.Promise)},"undefined"!=typeof JSZip&&r.setJSZip(JSZip),r.zip=function(e,n,o){function a(t,e){return e.each(function(e){var n=i.resolve();return o.progress&&(n=o.progress(e)),n.then(function(){if(e.isDir()){var n=t.folder(e.name().replace(/[\/\\]$/,""));return a(n,e)}return e.getContent(function(n){t.file(e.name(),n.toArrayBuffer())})})})}t.is(n)||(o=n),o=o||{};var u=new r.JSZip;return a(u,e).then(function(){return i.resolve(u.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(i){return t.is(n)?n.setBytes(i):void s(new Blob([i],{type:"application/zip"}),e.name().replace(/[\/\\]$/,"")+".zip")})},r.unzip=function(e,n,o){var s,a={};o=o||{},t.is(e)&&(s=e.getContent(),e=s.toArrayBuffer()),o.onCheckFile||(o.onCheckFile=function(t){return o.overwrite?t:t.exists()?!1:t});var u=new r.JSZip;return i.resolve(u.loadAsync(e)).then(function(){return i.each(u.files,function(e,r){var s,u;return i.resolve(r.async("arraybuffer")).then(function(t){return s=t,u=n.rel(r.name),o.progress?i.resolve(o.progress(u)):void 0}).then(function(){if(console.log("Inflating",r.name),!u.isDir()){var e={file:u,status:"uploaded"};a[u.path()]=e;var n=FS.Content.bin(s,u.contentType()),i=o.onCheckFile(u,n);return i===!1&&(e.status="cancelled",u=null),t.is(i)&&(u.path()!==i.path()&&(e.redirectedTo=i),u=i),u?u.setContent(n):void 0}})})}).then(function(){return console.log("unzip done",a),a})},r}),t("FS",["FSClass","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil"],function(t,e,n,i,r,o,s,a,u,c,l,f){var h={};h.assert=s,h.Content=c,h.Class=t,h.DeferredUtil=f,h.Env=o,h.LSFS=n,h.NativeFS=e,h.PathUtil=r,h.RootFS=u,h.SFile=a,h.WebFS=i,h.zip=l,"object"==typeof window&&(window.FS=h);var p,d=new o({});return h.addFSType=t.addFSType,h.availFSTypes=t.availFSTypes,h.setEnvProvider=function(t){d=t},h.getEnvProvider=function(){return d},h.setEnv=function(t,e){if("object"==typeof t)for(var n in t)d.set(n,t[n]);else d.set(t,e)},h.getEnv=function(t){return"string"==typeof t?d.get(t):d.value},h.init=function(t){p||(t||(t="object"==typeof process?new e:new n(localStorage)),p=new u(t))},h.getRootFS=function(){return h.init(),p},h.get=function(){return h.init(),p.get.apply(p,arguments)},h.expandPath=function(){return d.expandPath.apply(d,arguments)},h.resolve=function(t,e){return h.init(),a.is(t)?t:(t=d.expandPath(t),e&&!r.isAbsolutePath(t)?(e=d.expandPath(e),h.get(e).rel(t)):h.get(t))},h.mount=function(){return h.init(),p.mount.apply(p,arguments)},h.unmount=function(){return h.init(),p.unmount.apply(p,arguments)},h.isFile=function(t){return a.is(t)},h});var a;return e(["FS"],function(t){a=t}),void 0===window.FS&&(window.FS=a),a}),requireSimulator.setName("Platform"),define([],function(){var t={},e=window.navigator.userAgent.toLowerCase();return t.tablet=-1!=e.indexOf("windows")&&-1!=e.indexOf("touch")||-1!=e.indexOf("ipad")||-1!=e.indexOf("android")&&-1==e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("tablet")||-1!=e.indexOf("kindle")||-1!=e.indexOf("silk")||-1!=e.indexOf("playbook"),t.mobile=-1!=e.indexOf("windows")&&-1!=e.indexOf("phone")||-1!=e.indexOf("iphone")||-1!=e.indexOf("ipod")||-1!=e.indexOf("android")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("blackberry"),t}),requireSimulator.setName("WebSite"),define(["FS","Platform"],function(t,e){var n,i=t.PathUtil,r=document.location.href,o=!!r.match(/html\/dev\//)&&!!r.match(/localhost:3/),s=location.protocol;switch(s.match(/^http/)||(s="https:"),window.WebSite_runType){case"IDE":return n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},n.builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/neko.png":1,"images/mapchip.png":1,"images/inputPad.png":1},n.pluginTop||(n.pluginTop=n.top+"/js/plugins"),n.sampleImg=n.top+"/images",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.mp3Disabled=n.isNW,n.tonyuHome="/Tonyu/",n.PathSep="/",n.isNW?(n.noconcat=!0,n.PathSep=require("path").sep,n.cwd=i.directorify(process.cwd().replace(/\\/g,"/")),n.tonyuHome=process.env.TONYU_HOME?i.directorify(process.env.TONYU_HOME):i.rel(n.cwd,"fs/Tonyu/"),n.logdir=process.env.TONYU_LOGDIR,n.wwwDir=i.rel(n.cwd,"www/"),n.platform=process.platform,n.ffmpeg=i.rel(n.cwd,"win32"==n.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),n.pkgInfo=require(i.rel(n.cwd,"package.json")),n.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):n.pkgInfo&&n.pkgInfo.config&&n.pkgInfo.config.prjDirs?n.pkgInfo.config.prjDirs.map(function(t){return t=i.directorify(t),i.isAbsolute(t)?t:i.rel(n.cwd,t)}):[i.rel(n.cwd,"Projects/"),i.rel(n.tonyuHome,"Projects/")],n.kernelDir=i.rel(n.wwwDir,"Kernel/")):(n.wwwDir=s+"//"+location.host+"/",n.projects=[i.rel(n.tonyuHome,"Projects/")]),n.kernelDir=i.rel(n.wwwDir,"Kernel/"),n.compiledKernel=i.rel(n.kernelDir,"js/concat.js"),r.match(/localhost\/tonyu2/)?(n.wwwDir=s+"//"+location.host+"/tonyu2/",n.kernelDir=n.wwwDir+"Kernel/",n.compiledKernel=n.kernelDir+"js/concat.js",n.uploadTmpUrl=s+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//localhost/tsite/tonyu/project/newVersion.cgi"):(n.uploadTmpUrl=s+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//www.tonyu.jp/project/newVersion.cgi"),n.version=2,n.hoge="fuga",t.setEnvProvider(new t.Env(n)),window.WebSite=n;case"singleHTML":if(n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},"object"==typeof BuiltinAssets)for(var a in BuiltinAssets)n.urlAliases[a]=BuiltinAssets[a];return n.tonyuHome="/Tonyu/",n.projects=[i.rel(n.tonyuHome,"Projects/")],n.scriptServer="https://edit.tonyu.jp/",n.pluginTop=n.scriptServer+"js/plugins",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.PathSep="/",n.compiledKernel=n.scriptServer+"Kernel/js/concat.js",t.setEnvProvider(new t.Env(n)),window.WebSite=n;case"multiHTML":return n={urlAliases:{},top:".",tablet:e.tablet,mobile:e.mobile},n.tonyuHome="/Tonyu/",n.pluginTop=n.top+"/js/plugins",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.PathSep="/",n.mp3Disabled=n.isNW,n.isNW&&(n.PathSep=require("path").sep,n.cwd=i.directorify(process.cwd().replace(/\\/g,"/")),n.platform=process.platform),t.setEnvProvider(new t.Env(n)),window.WebSite=n}if(r.match(/jsrun\.it/))n={urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:o,pluginTop:"https://edit.tonyu.jp/js/plugins",removeJSOutput:!0};else if(r.match(/tonyuexe\.appspot\.com/)||r.match(/localhost:8887/)||r.match(/\/html\/((dev)|(build))\//))n={urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/sound_ogg.png":"../../images/sound_ogg.png","images/sound_mp3.png":"../../images/sound_mp3.png","images/sound_mp4.png":"../../images/sound_mp4.png","images/sound_m4a.png":"../../images/sound_m4a.png","images/sound_mid.png":"../../images/sound_mid.png","images/sound_wav.png":"../../images/sound_wav.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:o};else if(r.match(/bitarrow/)||r.match(/localhost.*pub/)){n={};var u=n;n.serverType="BA",u.runtime="../../../runtime/",u.urlAliases={"images/base.png":u.runtime+"images/base.png","images/Sample.png":u.runtime+"images/Sample.png","images/neko.png":u.runtime+"images/neko.png","images/inputPad.png":u.runtime+"images/inputPad.png","images/mapchip.png":u.runtime+"images/mapchip.png","images/sound.png":u.runtime+"images/sound.png","images/sound_ogg.png":u.runtime+"images/sound_ogg.png","images/sound_mp3.png":u.runtime+"images/sound_mp3.png","images/sound_mp4.png":u.runtime+"images/sound_mp4.png","images/sound_m4a.png":u.runtime+"images/sound_m4a.png","images/sound_mid.png":u.runtime+"images/sound_mid.png","images/sound_wav.png":u.runtime+"images/sound_wav.png","images/ecl.png":u.runtime+"images/ecl.png"}}else n={urlAliases:{},top:".",devMode:o};if("object"==typeof BuiltinAssets)for(var a in BuiltinAssets)n.urlAliases[a]=BuiltinAssets[a];n.builtinAssetNames={"images/Ball.png":1,"images/base.png":1,"images/Sample.png":1,"images/neko.png":1,"images/mapchip.png":1,"images/inputPad.png":1};var c=window.navigator.userAgent.toLowerCase();return n.tablet=-1!=c.indexOf("windows")&&-1!=c.indexOf("touch")||-1!=c.indexOf("ipad")||-1!=c.indexOf("android")&&-1==c.indexOf("mobile")||-1!=c.indexOf("firefox")&&-1!=c.indexOf("tablet")||-1!=c.indexOf("kindle")||-1!=c.indexOf("silk")||-1!=c.indexOf("playbook"),n.mobile=-1!=c.indexOf("windows")&&-1!=c.indexOf("phone")||-1!=c.indexOf("iphone")||-1!=c.indexOf("ipod")||-1!=c.indexOf("android")&&-1!=c.indexOf("mobile")||-1!=c.indexOf("firefox")&&-1!=c.indexOf("mobile")||-1!=c.indexOf("blackberry"),n.pluginTop||(n.pluginTop=n.top+"/js/plugins"),n.disableROM={},(r.match(/\.appspot\.com/)||r.match(/localhost:888[87]/))&&(n.serverType="GAE"),r.match(/localhost:3000/)&&(n.serverType="Node"),n.serverTop=r.match(/tonyuexe\.appspot\.com/)||r.match(/localhost:8887/)?n.top+"/exe":n.top+"/edit",n.sampleImg=n.top+"/images",n.blobPath=n.serverTop+"/serveBlob",n.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),n.mp3Disabled=n.isNW,n.tonyuHome="/Tonyu/",n.url={getDirInfo:n.serverTop+"/getDirInfo",getFiles:n.serverTop+"/File2LSSync",putFiles:n.serverTop+"/LS2FileSync"},n.PathSep="/",n.isNW?(n.PathSep=require("path").sep,n.cwd=i.directorify(process.cwd().replace(/\\/g,"/")),n.tonyuHome=process.env.TONYU_HOME?i.directorify(process.env.TONYU_HOME):i.rel(n.cwd,"fs/Tonyu/"),n.logdir=process.env.TONYU_LOGDIR,n.wwwDir=i.rel(n.cwd,"www/"),n.platform=process.platform,n.ffmpeg=i.rel(n.cwd,"win32"==n.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),n.pkgInfo=require(i.rel(n.cwd,"package.json")),n.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):n.pkgInfo&&n.pkgInfo.config&&n.pkgInfo.config.prjDirs?n.pkgInfo.config.prjDirs.map(function(t){return t=i.directorify(t),i.isAbsolute(t)?t:i.rel(n.cwd,t)}):[i.rel(n.cwd,"Projects/"),i.rel(n.tonyuHome,"Projects/")],n.kernelDir=i.rel(n.wwwDir,"Kernel/")):(n.wwwDir=s+"//"+location.host+"/",n.projects=[i.rel(n.tonyuHome,"Projects/")]),(r.match(/edit\.tonyu\.jp/)||r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:888/))&&(n.kernelDir=s+"//"+location.host+"/Kernel/"),n.compiledKernel=r.match(/edit\.tonyu\.jp/)||r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:888/)||n.isNW?n.kernelDir+"js/concat.js":"BA"===n.serverType?n.runtime+"lib/tonyu/kernel.js":"https://edit.tonyu.jp/Kernel/js/concat.js",r.match(/localhost\/tonyu2/)?(n.wwwDir=s+"//"+location.host+"/tonyu2/",n.kernelDir=n.wwwDir+"Kernel/",n.compiledKernel=n.kernelDir+"js/concat.js",n.uploadTmpUrl=s+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//localhost/tsite/tonyu/project/newVersion.cgi"):(n.uploadTmpUrl=s+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",n.newVersionUrl=s+"//www.tonyu.jp/project/newVersion.cgi"),r.match(/((index)|(project))2/)&&(n.version=2,n.devMode=n.isNW?!0:!1),t.setEnvProvider(new t.Env(n)),window.WebSite=n}),requireSimulator.setName("plugins"),define(["WebSite"],function(t){function e(t){return"function"==typeof t&&(t={onload:t}),t||(t={}),t.onload||(t.onload=function(){}),t}var n={},i={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/BodyActor/,symbol:"Box2D"},timbre:{src:"timbre.js",detection:/\bplay(SE)?\b/,symbol:"T"}};return n.installed=i,n.detectNeeded=function(t,e){for(var n in i){var r=i[n].detection.exec(t);r&&(e[n]=1)}return e},n.loaded=function(t){var e=i[t];if(!e)throw new Error("plugin not found: "+t);return window[e.symbol]},n.loadAll=function(t,r){function o(){u>=s.length?r.onload():n.load(s[u++],o)}r=e(r);var s=[];for(var a in t)i[a]&&!n.loaded(a)&&s.push(a);var u=0;console.log("loading plugins",s),setTimeout(o,0)},n.load=function(n,r){var o=i[n];if(!o)throw new Error("plugin not found: "+n);r=e(r);var s=t.pluginTop+"/"+o.src;location.href.match(/^file:/)?($("<script>").attr("src",s).appendTo("body"),setTimeout(r.onload,500)):$.getScript(s,r.onload)},n.request=function(t){if(!n.loaded(t)){var e=new Error("Plugin "+t+" required");e.pluginName=t}},n}),requireSimulator.setName("DeferredUtil"),define(["FS"],function(t){return t.DeferredUtil}),requireSimulator.setName("assert"),define(["FS"],function(t){return t.assert}),requireSimulator.setName("compiledProject"),define(["DeferredUtil","WebSite","assert"],function(t,e,n){var i=function(i,r){return n.is(arguments,[String,String]),{getNamespace:function(){return i},sourceDir:function(){return null},getDependingProjects:function(){return[]},loadDependingClasses:function(e){var n=t.directPromise(),i=this.getNamespace();return this.getDependingProjects().forEach(function(t){t.getNamespace()!=i&&(n=n.then(function(){return t.loadClasses(e)}))}),n},loadClasses:function(t){console.log("Loading compiled classes ns=",i,"url=",r);var n=r+("BA"===e.serverType?"?"+Math.random():""),o=this;return this.loadDependingClasses(t).then(function(){return o.requirejs(n)}).then(function(){console.log("Done Loading compiled classes ns=",i,"url=",n,Tonyu.classes)})},requirejs:function(e){return t.promise(function(t){var n=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");"string"==typeof tonyu_app_version&&(e+="?"+tonyu_app_version),i.src=e;var r=!1;i.onload=i.onreadystatechange=function(){r||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(r=!0,console.log("Done load ",e),i.onload=i.onreadystatechange=null,n&&i.parentNode&&n.removeChild(i),t())},n.insertBefore(i,n.firstChild)})},loadClassesOLD:function(t){console.log("Load compiled classes ns=",i,"url=",r);var n=new $.Deferred,o=document.getElementsByTagName("head")[0]||document.documentElement,s=document.createElement("script");
s.src=r+("BA"===e.serverType?"?"+Math.random():"");var a=!1;return s.onload=s.onreadystatechange=function(){a||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(a=!0,s.onload=s.onreadystatechange=null,o&&s.parentNode&&o.removeChild(s),console.log("Done Load compiled classes ns=",i,"url=",r,Tonyu.classes),n.resolve())},this.loadDependingClasses(t).then(function(){o.insertBefore(s,o.firstChild)}),n.promise()}}};return i}),requireSimulator.setName("compiledTonyuProject"),define(["plugins","compiledProject"],function(t,e){var n=function(n,i,r){var o=e(n,i),s=e("kernel",WebSite.compiledKernel),a={getDir:function(){return r},getDependingProjects:function(){return[s]},getOptions:function(){var t=this.getDir().rel("options.json");return t.obj()},getResource:function(){var t=this.getDir().rel("res.json");return t.obj()},loadPlugins:function(e){var n=this.getOptions();return t.loadAll(n.plugins,e)},requestPlugin:function(){},run:function(t){var e={classes:Tonyu.classMetas};this.loadClasses(e).then(function(){Tonyu.run(t)})}};for(var u in a)o[u]=a[u];return o};return n}),requireSimulator.setName("Shell"),define(["FS","assert"],function(t,e){function n(e,n){var r=i(e);if(t.SFile.is(r)||console.log(r," is not file"),n&&!r.exists())throw new Error(r+": no such file or directory");return r}function i(e){if("string"!=typeof e)return e;var n=r.cwd;return o.isAbsolutePath(e)?t.resolve(e,n):n.rel(e)}var r={},o=e(t.PathUtil);return r.newCommand=function(t,e){this[t]=e},r.cd=function(t){return r.cwd=n(t,!0),r.pwd()},r.vars=Object.create(t.getEnv()),r.mount=function(e,n){if(!e||!e.t){var i=[];for(var r in t.getRootFS().availFSTypes())i.push(r);return void sh.err("-t=("+i.join("|")+") should be specified.")}t.mount(n,e.t,e)},r.unmount=function(e){t.unmount(e)},r.fstab=function(){var e=t.getRootFS(),n=e.fstab(),i=this;n.forEach(function(t){i.echo(t.fstype()+"	"+(t.mountPoint||"<Default>"))})},r.resolve=n,r.pwd=function(){return r.cwd+""},r.ls=function(t){return t=t?n(t,!0):r.cwd,t.ls()},r.cp=function(t,e,i){i||(i={}),i.v&&(r.echo("cp",t,e),i.echo=r.echo.bind(r));var o=n(t,!0),s=n(e);return o.copyTo(s,i)},r.ln=function(t,e,i){var r=n(e),o=n(t,!0);if(r.isDir()&&r.exists()&&(r=r.rel(o.name())),r.exists())throw new Error(r+" exists");return r.link(o,i)},r.rm=function(t,e){if(e||(e={}),e.notrash)return t=n(t,!1),t.removeWithoutTrash(),1;if(t=n(t,!0),t.isDir()&&e.r){var i=t,o=0;return i.each(function(t){t.exists()&&(o+=r.rm(t,e))}),i.rm(),o+1}return t.rm(),1},r.mkdir=function(t){if(t=n(t,!1),t.exists())throw new Error(t+" : exists");return t.mkdir()},r.cat=function(t){return t=n(t,!0),r.echo(t.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}))},r.resolve=function(t){return t||(t="."),t=n(t)},r.grep=function(t,e,i){function o(t,e,n){i.res&&i.res.push({file:t,lineNo:e,line:n}),r.echo(t+"("+e+"): "+n)}return e=n(e,!0),i||(i={}),i.res||(i.res=[]),e.isDir()?e.each(function(e){r.grep(t,e,i)}):"string"==typeof t&&e.lines().forEach(function(n,i){n.indexOf(t)>=0&&o(e,i+1,n)}),i.res},r.touch=function(t){return t=n(t),t.text(t.exists()?t.text():""),1},r.setout=function(t){r.outUI=t},r.echo=function(){return $.when.apply($,arguments).then(function(){console.log.apply(console,arguments),r.outUI&&r.outUI.log&&r.outUI.log.apply(r.outUI,arguments)})},r.err=function(t){console.log.apply(console,arguments),t&&t.stack&&console.log(t.stack),r.outUI&&r.outUI.err&&r.outUI.err.apply(r.outUI,arguments)},r.clone=function(){var t=Object.create(this);return t.vars=Object.create(this.vars),t},r.getvar=function(t){return this.vars[t]||process&&process.env[t]},r.get=r.getvar,r.set=function(t,e){return this.vars[t]=e},r.strcat=function(){if(1==arguments.length)return arguments[0];for(var t="",e=0;e<arguments.length;e++)t+=arguments[e];return t},r.exists=function(t){return t=this.resolve(t),t.exists()},r.dl=function(t){return t=this.resolve(t||"."),t.download()},r.zip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.zip.apply(t.zip,n)},r.unzip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.unzip.apply(t.zip,n)},r.prompt=function(){},r.ASYNC={r:"SH_ASYNC"},r.help=function(){for(var t in r){var e=r[t];"function"==typeof e&&r.echo(t+(e.description?" - "+e.description:""))}},window.sh||(window.sh=r),"object"==typeof process?(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()},sh.cd(process.cwd().replace(/\\/g,"/"))):sh.cd("/"),r}),requireSimulator.setName("Klass"),define(["assert"],function(t){function e(t){var e=/function[^\(]+\(([^\)]*)\)/,n=e.exec(t+"");return n?n[1].replace(/\s/g,"").split(","):[]}function n(t){if("object"!=typeof t)return!1;if(!t)return!1;var e={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},n=0;for(var i in t){if(!e[i])return!1;n+=e[i]}return n}var i={};return i.define=function(r){function o(e){r.$fields&&t.is(e,r.$fields)}function s(t){if(!f)return t;var n=e(t);return n[0]!==f?t:function(){var e=Array.prototype.slice.call(arguments);return e.unshift(d),t.apply(d,e)}}function a(t){if(!l)return t;if(n(t)){for(var i in t)t[i]=a(t[i]);return t}if("function"!=typeof t)return t;var r=e(t);return r[0]!==l?t:function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),t.apply(this,e)}}var u,c;r.$parent?(c=r.$parent,u=Object.create(c.prototype),u.super=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return c.prototype[e].apply(this,t)}):u={};var l,f;r.$this&&(l=r.$this),r.$singleton&&(f=r.$singleton);var h,p=a(r.$)||function(t){if(t&&"object"==typeof t)for(var e in t)this[e]=t[e]};p instanceof Array&&(h=p,p=function(){for(var t=Array.prototype.slice.call(arguments),e=0;e<h.length;e++)t.length>0&&(this[h[e]]=t.shift())});var d;d=function(){if(!(this instanceof d)){var t=Object.create(u);return p.apply(t,arguments),o(t),t}p.apply(this,arguments),o(this)},c&&(d.super=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift();return c.prototype[n].apply(e,t)}),d.inherit=function(t){return t.$parent=d,i.define(t)},d.prototype=u;for(var m in r)"$"!=m[0]&&("static$"==m.substring(0,7)?d[m.substring(7)]=s(r[m]):n(r[m])?Object.defineProperty(u,m,a(r[m])):u[m]=a(r[m]));return u.$=p,Object.defineProperty(u,"$bind",{get:function(){return this.__bounded||(this.__bounded=new i.Binder(this)),this.__bounded}}),d},i.Function=function(){throw new Exception("Abstract")},i.opt=t.opt,i.Binder=i.define({$this:"t",$:function(t,e){for(var n in e)(function(n){"function"==typeof e[n]&&(t[n]=function(){var t=Array.prototype.slice.call(arguments);return e[n].apply(e,t)})})(n)}}),i}),requireSimulator.setName("Tonyu.Thread"),define(["DeferredUtil","Klass"],function(t,e){var n={enterC:{},exitC:0};try{window.cnts=n}catch(i){}var r=e.define({$:function(){this.frame=null,this._isDead=!1,this.cnt=0,this._isWaiting=!1,this.fSuspended=!1,this.tryStack=[],this.preemptionTime=60,this.onEndHandlers=[],this.onTerminateHandlers=[],this.age=0},isAlive:function(){return!this.isDead()},isDead:function(){return this._isDead=this._isDead||null==this.frame||this._threadGroup&&(this._threadGroup.objectPoolAge!=this.tGrpObjectPoolAge||this._threadGroup.isDeadThreadGroup())},setThreadGroup:function(t){this._threadGroup=t,this.tGrpObjectPoolAge=t.objectPoolAge},isWaiting:function(){return this._isWaiting},suspend:function(){this.fSuspended=!0,this.cnt=0},enter:function(t){this.frame={prev:this.frame,func:t}},apply:function(t,e,n){n||(n=[]);var i;if("string"==typeof e&&(i=t["fiber$"+e],!i))throw new Error("メソッド"+e+"が見つかりません");"function"==typeof e&&(i=e.fiber),n=[this].concat(n);var r=0;return this.enter(function(e){switch(r){case 0:i.apply(t,n),r=1;break;case 1:e.termStatus="success",e.notifyEnd(e.retVal),n[0].exit(),r=2}})},notifyEnd:function(t){this.onEndHandlers.forEach(function(e){e(t)}),this.notifyTermination({status:"success",value:t})},notifyTermination:function(t){this.onTerminateHandlers.forEach(function(e){e(t)})},on:function(t,e){("end"===t||"success"===t)&&this.onEndHandlers.push(e),"terminate"===t&&(this.onTerminateHandlers.push(e),this.handleEx&&delete this.handleEx)},promise:function(){var e=this;return t.funcPromise(function(t,n){e.on("terminate",function(e){"success"===e.status?t(e.value):n("exception"===e.status?e.exception:new Error(e.status))})})},then:function(t,e){return e?this.proimse().then(t,e):this.proimse().then(t)},fail:function(t){return this.promise().fail(t)},gotoCatch:function(t){var e=this;if(0==e.tryStack.length)return e.termStatus="exception",e.kill(),void(e.handleEx?e.handleEx(t):e.notifyTermination({status:"exception",exception:t}));e.lastEx=t;for(var n=e.tryStack.pop();e.frame;){if(n.frame===e.frame){e.catchPC=n.catchPC;break}e.frame=e.frame.prev}},startCatch:function(){var t=this,e=t.lastEx;return t.lastEx=null,e},exit:function(t){this.frame=this.frame?this.frame.prev:null,this.retVal=t},enterTry:function(t){var e=this;e.tryStack.push({frame:e.frame,catchPC:t})},exitTry:function(){var t=this;t.tryStack.pop()},waitEvent:function(t,e){var n=this;if(n.suspend(),t.on){var i;e=e.concat(function(){n.lastEvent=arguments,n.retVal=arguments[0],i.remove(),n.steps()}),i=t.on.apply(t,e)}},runAsync:function(t){var e=this,n=function(){e.retVal=arguments,e.steps()},i=function(){for(var t="",n=0;n<arguments.length;n++)t+=arguments[n]+",";0==t.length&&(t="Async fail");var i=new Error(t);i.args=arguments,e.gotoCatch(i),e.steps()};e.suspend(),setTimeout(function(){t(n,i)},0)},waitFor:function(e){var n=this;return n._isWaiting=!0,n.suspend(),e instanceof r&&(e=e.promise()),t.ensureDefer(e).then(function(t){n.retVal=t,n.stepsLoop()}).fail(function(t){if(t instanceof Error)n.gotoCatch(t);else{var e=new Error(t);e.original=t,n.gotoCatch(e)}n.stepsLoop()})},resume:function(t){this.retVal=t,this.steps()},steps:function(){var t=this;if(!t.isDead()){var e=Tonyu.currentThread;for(Tonyu.currentThread=t,t.cnt=t.preemptionTime,t.preempted=!1,t.fSuspended=!1;t.cnt>0&&t.frame;)try{for(;t.cnt-->0&&t.frame;)t.frame.func(t);t.preempted=!t.fSuspended&&t.isAlive()}catch(n){t.gotoCatch(n)}Tonyu.currentThread=e}},stepsLoop:function(){var t=this;t.steps(),t.preempted&&setTimeout(function(){t.stepsLoop()},0)},kill:function(){var t=this;t._isDead=!0,t.frame=null,t.termStatus||(t.termStatus="killed",t.notifyTermination({status:"killed"}))},clearFrame:function(){this.frame=null,this.tryStack=[]}});return r}),requireSimulator.setName("Tonyu.Iterator"),define(["Klass"],function(t){function e(t,e){if(t.tonyuIterator)return t.tonyuIterator(e);if(t instanceof Array)return 1==e?new n(t):new i(t);if(t instanceof Object)return 1==e?new r(t):new o(t);throw console.log(t),new Error(t+" is not iterable")}var n=t.define({$:function(t){this.set=t,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.set[this.i],this.i++,!0)}}),i=t.define({$:function(t){this.set=t,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.i,this[1]=this.set[this.i],this.i++,!0)}}),r=t.define({$:function(t){this.elems=[];for(var e in t)this.elems.push(e);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i],this.i++,!0)}}),o=t.define({$:function(t){this.elems=[];for(var e in t)this.elems.push([e,t[e]]);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i][0],this[1]=this.elems[this.i][1],this.i++,!0)}});return e}),requireSimulator.setName("Tonyu"),"function"!=typeof define&&(define=require("requirejs").define),define(["assert","Tonyu.Thread","Tonyu.Iterator","DeferredUtil"],function(t,e,n,i){return Tonyu=function(){function r(){var t=new e;return t.handleEx=a,t}function o(t){return i.funcPromise(function(e){setTimeout(e,t)})}function s(){return i.funcPromise(function(t){requestAnimationFrame(t)})}function a(t){if(!Tonyu.onRuntimeError)throw"undefined"==typeof $LASTPOS&&($LASTPOS=0),alert("エラー! at "+$LASTPOS+" メッセージ  : "+t),console.log(t.stack),t;Tonyu.onRuntimeError(t)}function u(e,n){return t.is(arguments,[String,Object]),l(klass.getMeta(e),n)}function c(t,e){return t?l(Object.create(t.prototype),e):e}function l(t,e){if(e&&"object"==typeof e)for(var n in e)t[n]=e[n];return t}function f(t,e){D[t]=e}function h(t){return D[t]}function p(t){var e=t.split("."),n=x;if(e.forEach(function(t){n&&(n=n[t])}),!n&&1==e.length){var i;for(var r in x){var o=x[r][t];if(o){if(n)throw new Error("曖昧なクラス名： "+r+"."+t+", "+i);n=o,i=r+"."+t}}}return n}function d(t,e){if("function"!=typeof e)return e;var n=function(){return e.apply(t,arguments)};return n.methodInfo=Tonyu.extend({thiz:t},e.methodInfo||{}),e.fiber&&(n.fiber=function(){return e.fiber.apply(t,arguments)},n.fiber.methodInfo=Tonyu.extend({thiz:t},e.fiber.methodInfo||{})),n}function m(t,e,n,i){if(!t)throw new Error(i+"(="+t+")のメソッド "+e+"を呼び出せません");var r=t[e];if("function"!=typeof r)throw new Error(("this"==i?"":i+".")+e+"(="+r+")はメソッドではありません");return r.apply(t,n)}function g(t,e,n){if("function"!=typeof t)throw new Error(n+"は関数ではありません");return t.apply({},e)}function v(t,e){if(t!=t||null==t)throw new Error(e+"(="+t+")は初期化されていません");return t}function y(t){for(var e=[],n=1;n<t.length;n++)e[n-1]=t[n];return e}function b(t){throw new Error("クラス名"+t+"はnewをつけて呼び出して下さい。")}function T(t){throw console.log("Not a tonyu object: ",t),new Error(t+" is not a tonyu object")}function w(t,e){return t in e}function S(t){var e=p(t);if(!e)throw new Error(t+" というクラスはありません");Tonyu.runMode=!0;var n,i=new e;(n=Tonyu.currentProject)&&(n.runningObj=i),$LASTPOS=0}function A(){var t=(new Date).getTime();if(t-E>1e3)throw M(1e4),new Error("無限ループをストップしました"+(t-P));P=t}function M(t){E=(new Date).getTime()+(t||0)}klass=function(){throw alert("この関数は古くなりました。コンパイルをやり直してください。 Deprecated. compile again."),new Error("この関数は古くなりました。コンパイルをやり直してください。 Deprecated. compile again.")},klass.addMeta=u,klass.removeMeta=function(t){delete B[t]},klass.getMeta=function(t){if("function"==typeof t)return t.meta;if("string"==typeof t){var e=B[t];return e||(B[t]=e={}),e}},klass.ensureNamespace=function(t,e){var n,i=e.split("."),r=t;for(n=0;n<i.length;n++){var o=i[n];r[o]||(r[o]={}),r=r[o]}return r},Function.prototype.constructor=function(){throw new Error("This method should not be called")},klass.define=function(t){var e=t.superclass,n=t.includes,i=t.fullName,r=t.shortName,o=t.namespace,s=t.methods,a=t.decls,l=klass.ensureNamespace(Tonyu.classes,o),f=s,h=f.initialize;delete f.initialize;var p;p=h?function(){this instanceof p||b(i),h.apply(this,arguments)}:e?function(){this instanceof p||b(i),e.apply(this,arguments)}:function(){this instanceof p||b(i)},l[r]=p,p.methods=f,n.forEach(function(t){if(!t.methods)throw t+" Does not have methods";for(var e in t.methods)e in f||(f[e]=t.methods[e])});var d={},m=/^__([gs]et)ter__(.*)$/;for(var g in f)if(!g.match(/^fiber\$/)){f["fiber$"+g]&&(f[g].fiber=f["fiber$"+g],f[g].fiber.methodInfo={name:g,klass:p,fiber:!0}),f[g].methodInfo={name:g,klass:p};var v=m.exec(g);v&&(d[v[2]]=d[v[2]]||{},d[v[2]][v[1]]=f[g])}p.prototype=c(e,f),p.prototype.isTonyuObject=!0;for(var g in d)Object.defineProperty(p.prototype,g,d[g]);p.meta=u(i,{fullName:i,shortName:r,namespace:o,decls:a,superclass:e?e.meta:null,func:p,includes:n.map(function(t){return t.meta})});var y=klass.getMeta(p);return p.prototype.getClassInfo=function(){return y},p},klass.isSourceChanged=function(t){return t=t.meta||t,t.src&&t.src.tonyu?t.nodeTimestamp?t.src.tonyu.lastUpdate()>t.nodeTimestamp:!0:!1},klass.shouldCompile=function(t){if(t=t.meta||t,klass.isSourceChanged(t))return!0;for(var e=klass.getDependingClasses(t),n=0;n<e.length;n++)if(klass.shouldCompile(e[n]))return!0},klass.getDependingClasses=function(t){t=t.meta||t;var e=[];return t.superclass&&(e=[t.superclass]),t.includes&&(e=e.concat(t.includes)),e};var P,D={},x={},B={},E=(new Date).getTime();return setInterval(M,16),Tonyu={thread:r,klass:klass,bless:c,extend:l,globals:D,classes:x,classMetas:B,setGlobal:f,getGlobal:h,getClass:p,timeout:o,animationFrame:s,bindFunc:d,not_a_tonyu_object:T,hasKey:w,invokeMethod:m,callFunc:g,checkNonNull:v,run:S,iterator:n,checkLoop:A,resetLoopCheck:M,VERSION:1522478582355,A:y}}()}),requireSimulator.setName("PatternParser"),define(["Tonyu"],function(t){var e=function(t,e){this.options=e||{},this.img=t,this.height=t.height,this.width=t.width;var n=this.newImage(t.width,t.height),i=n.getContext("2d");i.drawImage(t,0,0),this.ctx=i,this.pixels=this.ctx.getImageData(0,0,t.width,t.height).data,this.base=this.getPixel(0,0)};return t.extend(e.prototype,{newImage:function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n},getPixel:function(t,e){var n=this.pixels,i=4*(t+e*this.width),r=n[0+i],o=n[1+i],s=n[2+i],a=n[3+i];return 256*(256*(256*a+s)+o)+r},setPixel:function(t,e,n){var i=4*(t+e*this.width);this.pixels[0+i]=255&n,n=(n-(255&n))/256,this.pixels[1+i]=255&n,n=(n-(255&n))/256,this.pixels[2+i]=255&n,n=(n-(255&n))/256,this.pixels[3+i]=255&n},parse:function(){try{for(var t=[],e=0;e<this.height;e++)for(var n=0;n<this.width;n++){var i=this.getPixel(n,e);i!=this.base&&t.push(this.parse1Pattern(n,e))}return t}catch(r){if(r.isParseError)return console.log("parse error! "+r),[{image:this.img,x:0,y:0,width:this.width,height:this.height}];throw r}},parse1Pattern:function(t,e){function n(t){return t}function i(t,e,n){return{toString:function(){return"at ("+t+","+e+") :"+n},isParseError:!0}}for(var r=this.getPixel(t,e),o=t,s=e,a=this.base,u=this.width,c=this.height;u>o;){var l=this.getPixel(o,s);if(l!=r)break;o++}if(o>=u||this.getPixel(o,s)!=a)throw i(o,s,n(this.getPixel(o,s))+"!="+n(a));for(o--;c>s&&this.getPixel(o,s)==r;)s++;if(s>=c||this.getPixel(o,s)!=a)throw i(o,s,n(this.getPixel(o,s))+"!="+n(a));s--;var f=t+1,h=e+1,p=o-f,d=s-h;if(console.log("PP",f,h,p,d,o,s),p*d==0)throw i(o,s,"w*h==0");for(var m=this.newImage(p,d),g=m.getContext("2d"),v=g.getImageData(0,0,p,d),y=v.data,b=0,T=h;s>T;T++)for(var w=f;o>w;w++){var S=this.getPixel(w,T);S==r?(y[b++]=0,y[b++]=0,y[b++]=0,y[b++]=0):(y[b++]=255&S,S=(S-(255&S))/256,y[b++]=255&S,S=(S-(255&S))/256,y[b++]=255&S,S=(S-(255&S))/256,y[b++]=255&S)}g.putImageData(v,0,0);for(var A=h-1;s>=A;A++)for(var M=f-1;o>=M;M++)this.setPixel(M,A,a);return this.options.boundsInSrc?{x:f,y:h,width:p,height:d}:{image:m,x:0,y:0,width:p,height:d}}}),e}),requireSimulator.setName("Util"),Util=function(){function t(t,n){null==n&&(n=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=i.exec(window.location.href);return null==r?n:e(r[1])}function e(t){return decodeURIComponent(t.replace(/\+/g,"%20"))}function n(t,e){return t.substring(t.length-e.length)===e}function i(t,e){return t.substring(0,e.length)===e}function r(t){function e(e){throw console.log(e),console.log(t,c),new Error(e)}t=t.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var i,r=t.length,o=0,s=0;if(!r)return new ArrayBuffer(0);i=Math.floor(r/4*3),"="==t.charAt(r-1)&&(i-=1),"="==t.charAt(r-2)&&(i-=1);for(var a=new ArrayBuffer(i),u=new Uint8Array(a),c=0,l=0;i>l&&(s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),o=s<<2,c++,s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),u[l]=o|s>>4&3,o=(15&s)<<4,c++,l++,!(l>=i))&&(s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),u[l]=o|s>>2&15,o=(3&s)<<6,c++,l++,!(l>=i));)s=n[t.charCodeAt(c)],void 0===s&&e("Invalid letter: "+t.charCodeAt(c)),u[l]=o|s,c++,l++;return a}function o(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",i=new Uint8Array(t),r=i.length,o=0,s=0,a=0;r>a&&(s=i[a],n+=e[s>>2],o=(3&s)<<4,a++,!(a>=r))&&(s=i[a],n+=e[o|s>>4],o=(15&s)<<2,a++,!(a>=r));)s=i[a],n+=e[o|s>>6],n+=e[63&s],a++;var u=r%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n}function s(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var i=t[n];n.match(/^_/)||"function"==typeof i&&(e[n]=function(){var e=i.apply(t,arguments);return e})}(n);return e}function a(){return"undefined"!=typeof Buffer}function u(t){return a()&&t instanceof Buffer}function c(t){return t instanceof ArrayBuffer||u(t)}function l(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(i){throw console.log(e.join("")),i}}function f(t,e){for(var n=encodeURIComponent(t),i=/^%(..)/,r=[],o=0;o<n.length;o++){var s=i.exec(n.substring(o));s?(r.push(parseInt("0x"+s[1])),o+=s[0].length-1):r.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(r):new Uint8Array(r).buffer}return{getQueryString:t,endsWith:n,startsWith:i,Base64_To_ArrayBuffer:r,Base64_From_ArrayBuffer:o,utf8bytes2str:l,str2utf8bytes:f,privatize:s,hasNodeBuffer:a,isNodeBuffer:u,isBuffer:c}}(),requireSimulator.setName("Assets"),define(["WebSite","Util","Tonyu","FS"],function(t,e,n,i){var r={};return r.resolve=function(n,r,o){o=o||{};var s=i.isFile(r)?r:r.getDir();if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,n){return t[n]}),t.urlAliases[n]&&(n=t.urlAliases[n]),e.startsWith(n,"ls:")){var a=n.substring("ls:".length);if(!s)throw new Error("Basedir not specified");var u=s.rel(a);if(!u.exists())throw new Error("Resource file not found: "+u);if(t.mp3Disabled&&a.match(/\.(mp3|mp4|m4a)$/)){var c=s.rel(a.replace(/\.(mp3|mp4|m4a)$/,".ogg"));c.exists()&&(u=c)}if(n=u.getURL(),o.asFile)return u}return n},n.Assets=r,r}),requireSimulator.setName("ImageList"),define(["PatternParser","Util","Assets","assert"],function(t,e,n,i){function r(t){var e=[];return t.forEach(function(t){t&&""!=t.url&&e.push(t)}),e}var o,s={};return o=function(e,o,a){a||(a={}),e=r(e);var u=[],c=e.length;0==c&&setTimeout(function(){var t=[];t.names={},o(t)},0),e.forEach(function(e,r){function l(){var n,s;if("single"==e.type)u[r]=[{image:this,x:0,y:0,width:this.width,height:this.height}];else if((n=e.pwidth)&&(s=e.pheight)){for(var a=0,l=0,f=this.width,h=this.height,p=[];;){var d=n,m=s;if(a+n>f&&(d=f-a),l+s>h&&(m=h-l),p.push({image:this,x:a,y:l,width:d,height:m}),a+=n,a+n>f&&(a=0,l+=s,l+s>h))break}u[r]=p}else{var g=new t(this);u[r]=g.parse()}if(u[r].name=e.name,i.is(u[r],Array),c--,0==c){var v=[],y={};u.forEach(function(t){y[t.name]=v.length,v=v.concat(t)}),v.names=y,o(v)}}console.log("loading",e,r);var f=e.url,h=f;if(s[h])return void l.apply(s[h],[]);f=n.resolve(f,a.prj||a.baseDir);var p=$("<img>");p.load(function(){s[h]=this,l.apply(this,[])}),p.attr("src",f)})},o.load=o,o.parse1=function(e,n,r){var o,s,a;if((o=e.pwidth)&&(s=e.pheight)){for(var u=0,c=0,l=n.width,f=n.height,h=[];;)if(h.push({image:this,x:u,y:c,width:o,height:s}),u+=o,u+o>l&&(u=0,c+=s,c+s>f))break;a=h}else{var p=new t(n,r);a=p.parse()}return a.name=e.name,i.is(a,Array)},window.ImageList=o,o}),requireSimulator.setName("PicoAudio");var PicoAudio=function(){function t(t,e){var n=window.AudioContext||window.webkitAudioContext;this.context=t?t:new n,this.settings={masterVolume:1,generateVolume:.15,tempo:120,basePitch:440,resolution:480,hashLength:this.isAndroid()?20:30,hashBuffer:2,isWebMIDI:!1,WebMIDIPortOutputs:null,WebMIDIPortOutput:null,WebMIDIPort:-1,WebMIDIPortSysEx:!0,isReverb:!this.isAndroid(),reverbVolume:1.5,isChorus:!0,chorusVolume:.5,isCC111:!0,dramMaxPlayLength:.5,loop:!1,isSkipBeginning:!0,isSkipEnding:!0},this.trigger={isNoteTrigger:!0,noteOn:function(){},noteOff:function(){},songEnd:function(){}},this.states={isPlaying:!1,playIndex:0,startTime:0,stopTime:0,stopFuncs:[],webMIDIWaitState:null,webMIDIStopTime:0},this.hashedDataList=[],this.hashedMessageList=[],this.channels=[],this.tempoTrack=[{timing:0,value:120},{timing:0,value:120}],this.cc111Time=-1;for(var i=0;17>i;i++)this.channels.push([0,0,1]);if(e&&e.whitenoise)this.whitenoise=e.whitenoise;else{this.whitenoise=this.context.createBuffer(2,this.context.sampleRate,this.context.sampleRate);for(var r=0;2>r;r++)for(var i=0;i<this.context.sampleRate;i++)this.whitenoise.getChannelData(r)[i]=2*Math.random()-1}if(this.masterGainNode=this.context.createGain(),this.masterGainNode.gain.value=this.settings.masterVolume,e&&e.impulseResponse)this.impulseResponse=e.impulseResponse;else{var o=3.5*this.context.sampleRate;this.impulseResponse=this.context.createBuffer(2,o,this.context.sampleRate);for(var r=0;2>r;r++)for(var s=this.impulseResponse.getChannelData(r),i=0;o>i;i++){var a=(o-i)/o,u=i/this.context.sampleRate,c=(.03>u?0:a)*(u>=.03&&.031>u?2*a:a)*(u>=.04&&.042>u?1.5*a:a)*(u>=.05&&.054>u?1.25*a:a)*Math.random()*.2*Math.pow(a-.03,4);s[i]=c}}this.convolver=this.context.createConvolver(),this.convolver.buffer=this.impulseResponse,this.convolver.normalize=!1,this.convolverGainNode=this.context.createGain(),this.convolverGainNode.gain.value=this.settings.reverbVolume,this.convolver.connect(this.convolverGainNode),this.convolverGainNode.connect(this.masterGainNode),this.masterGainNode.connect(this.context.destination),this.chorusDelayNode=this.context.createDelay(),this.chorusGainNode=this.context.createGain(),this.chorusOscillator=this.context.createOscillator(),this.chorusLfoGainNode=this.context.createGain(),this.chorusDelayNode.delayTime.value=.025,this.chorusLfoGainNode.gain.value=.01,this.chorusOscillator.frequency.value=.05,this.chorusGainNode.gain.value=this.settings.chorusVolume,this.chorusOscillator.connect(this.chorusLfoGainNode),this.chorusLfoGainNode.connect(this.chorusDelayNode.delayTime),this.chorusDelayNode.connect(this.chorusGainNode),this.chorusGainNode.connect(this.masterGainNode),this.masterGainNode.connect(this.context.destination),this.chorusOscillator.start(0),this.onSongEndListener=null}return t.prototype.createNote=function(t){var e=!1;if(t.channel)switch(this.channels[t.channel][1]/10||t.instrument){case.2:case 12:case 13:case 45:case 55:case 119:e=!0}var n=this.createBaseNote(t,!0,!1,e);if(n.isGainValueZero)return function(){};var i=n.oscillator,r=n.gainNode,o=(n.panNode,n.noiseCutGainNode),s=!1,a=this;switch(this.channels[n.channel][0]/10||t.instrument){case.1:case 6:case 15:case 24:case 26:case 46:case 50:case 51:case 52:case 53:case 54:case 82:case 85:case 86:i.type="sine",r.gain.value*=1.5;break;case.2:case 4:case 12:case 13:case 16:case 19:case 20:case 32:case 34:case 45:case 48:case 49:case 55:case 56:case 57:case 61:case 62:case 63:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 84:i.type="square",r.gain.value*=.8;break;case.3:case 0:case 1:case 2:case 3:case 6:case 7:case 17:case 18:case 21:case 22:case 23:case 27:case 28:case 29:case 30:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 47:case 59:case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 82:case 87:i.type="sawtooth";break;case.4:case 8:case 9:case 10:case 11:case 14:case 25:case 31:case 33:case 35:case 58:case 60:case 83:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:i.type="triangle",r.gain.value*=1.5;break;default:i.type="square"}switch(this.channels[n.channel][1]/10||t.instrument){case.2:case 12:case 13:case 45:case 55:s=!0,r.gain.value*=1.1,r.gain.setValueAtTime(r.gain.value,n.start),r.gain.linearRampToValueAtTime(0,n.start+.2),a.stopAudioNode(i,n.start+.2,r);break;case.3:case 0:case 1:case 2:case 3:case 6:case 9:case 11:case 14:case 15:case 32:case 36:case 37:case 46:case 47:r.gain.value*=1.1,r.gain.setValueAtTime(r.gain.value,n.start),r.gain.linearRampToValueAtTime(.95*r.gain.value,n.start+.1),r.gain.setValueAtTime(.95*r.gain.value,n.start+.1),r.gain.linearRampToValueAtTime(0,n.start+1.5+3*n.velocity);break;case.4:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 34:r.gain.value*=1.1,r.gain.setValueAtTime(r.gain.value,n.start),r.gain.linearRampToValueAtTime(0,n.start+1+4*n.velocity);break;case.5:case 4:case 5:case 7:case 8:case 10:case 33:case 35:r.gain.value*=1,r.gain.setValueAtTime(r.gain.value,n.start),r.gain.linearRampToValueAtTime(.95*r.gain.value,n.start+.1),r.gain.setValueAtTime(.95*r.gain.value,n.start+.1),r.gain.linearRampToValueAtTime(0,n.start+2+10*n.velocity);break;case 119:r.gain.value=0,a.stopAudioNode(i,0,r)}return("sine"==i.type||"triangle"==i.type)&&!s&&n.stop-n.start>.01&&(o.gain.setValueAtTime(1,n.stop-.005),o.gain.linearRampToValueAtTime(0,n.stop)),function(){a.stopAudioNode(i,0,r)}},t.prototype.createPercussionNote=function(t){var e=this.createBaseNote(t,!1);if(e.isGainValueZero)return function(){};var n=e.oscillator,i=e.gainNode,r=(e.panNode,e.start),o=(e.stop,e.velocity*((t.expression?t.expression[0].value:100)/127)),s=this.createBaseNote(t,!1,!0),a=s.oscillator,u=s.gainNode,c=(s.panNode,this);switch(t.pitch){case 35:case 36:i.gain.value=.6*o,n.playbackRate.value=.02,c.stopAudioNode(n,r+.07,i),u.gain.value=1.1*o,a.frequency.setValueAtTime(120,r),a.frequency.linearRampToValueAtTime(50,r+.07),c.stopAudioNode(a,r+.07,u);break;case 38:case 40:n.playbackRate.value=.7,c.stopAudioNode(n,r+.05,i),u.gain.setValueAtTime(.8*o,r),u.gain.linearRampToValueAtTime(0,r+.05),a.frequency.setValueAtTime(300,r),a.frequency.linearRampToValueAtTime(200,r+.05),c.stopAudioNode(a,r+.05,u);break;case 41:case 43:case 45:case 47:case 48:case 50:n.playbackRate.value=.01,c.stopAudioNode(n,r+.1,i),a.type="square",u.gain.setValueAtTime(o,r),u.gain.linearRampToValueAtTime(.01,r+.1),a.frequency.setValueAtTime(150+20*(t.pitch-40),r),a.frequency.linearRampToValueAtTime(50+20*(t.pitch-40),r+.1),c.stopAudioNode(a,r+.1,u);break;case 42:case 44:n.playbackRate.value=1.5,c.stopAudioNode(n,r+.02,i),c.stopAudioNode(a,0,u);break;case 46:n.playbackRate.value=1.5,c.stopAudioNode(n,r+.3,i),i.gain.setValueAtTime(.9*o,r),i.gain.linearRampToValueAtTime(0,r+.3),c.stopAudioNode(a,0,u);break;case 49:case 51:case 52:case 53:case 55:case 57:n.playbackRate.value=1.2,c.stopAudioNode(n,r+.5,i),i.gain.setValueAtTime(1*o,r),i.gain.linearRampToValueAtTime(0,r+.5),c.stopAudioNode(a,0,u);break;case 51:n.playbackRate.value=1.1,c.stopAudioNode(n,r+.4,i),i.gain.setValueAtTime(.8*o,r),i.gain.linearRampToValueAtTime(0,r+.4),c.stopAudioNode(a,0,u);break;case 59:n.playbackRate.value=1.8,c.stopAudioNode(n,r+.3,i),i.gain.setValueAtTime(.5*o,r),i.gain.linearRampToValueAtTime(0,r+.3),c.stopAudioNode(a,0,u);break;case 60:case 61:n.playbackRate.value=.03,c.stopAudioNode(n,r+.03,i),u.gain.setValueAtTime(.8*o,r),u.gain.linearRampToValueAtTime(0,r+.1),a.frequency.setValueAtTime(400-40*(t.pitch-60),r),a.frequency.linearRampToValueAtTime(450-40*(t.pitch-60),r+.1),c.stopAudioNode(a,r+.1,u);break;case 62:n.playbackRate.value=.03,c.stopAudioNode(n,r+.03,i),u.gain.setValueAtTime(o,r),u.gain.linearRampToValueAtTime(0,r+.03),a.frequency.setValueAtTime(200,r),a.frequency.linearRampToValueAtTime(250,r+.03),c.stopAudioNode(a,r+.03,u);break;case 63:case 64:n.playbackRate.value=.03,c.stopAudioNode(n,r+.03,i),u.gain.setValueAtTime(o,r),u.gain.linearRampToValueAtTime(0,r+.1),a.frequency.setValueAtTime(200-30*(t.pitch-63),r),a.frequency.linearRampToValueAtTime(250-30*(t.pitch-63),r+.1),c.stopAudioNode(a,r+.1,u);break;case 56:case 75:n.playbackRate.value=.01,c.stopAudioNode(n,r+.1,i),u.gain.setValueAtTime(o,r),u.gain.linearRampToValueAtTime(0,r+.1),a.frequency.setValueAtTime(1e3+48*(t.pitch-56),r),c.stopAudioNode(a,r+.1,u);break;case 80:n.playbackRate.value=5,i.gain.setValueAtTime(.5*o,r),i.gain.linearRampToValueAtTime(0,r+.2),c.stopAudioNode(n,r+.05,i),a.type="triangle",u.gain.setValueAtTime(.7*o,r),u.gain.linearRampToValueAtTime(0,r+.2),a.frequency.setValueAtTime(6e3,r),c.stopAudioNode(a,r+.05,u);
break;case 81:n.playbackRate.value=5,i.gain.setValueAtTime(.9*o,r),i.gain.linearRampToValueAtTime(0,r+.5),c.stopAudioNode(n,r+.5,i),a.type="triangle",u.gain.setValueAtTime(.8*o,r),u.gain.linearRampToValueAtTime(0,r+.3),a.frequency.setValueAtTime(6e3,r),c.stopAudioNode(a,r+.3,u);break;default:n.playbackRate.value=t.pitch/69*2,c.stopAudioNode(n,r+.05,i),c.stopAudioNode(a,0,u)}return function(){c.stopAudioNode(n,0,i),c.stopAudioNode(a,0,u)}},t.prototype.createBaseNote=function(t,e,n,i){var r=this.settings,o=this.context,s=this.states.startTime,a=this,u=n?0:t.channel||0,c=t.velocity*Number(n?1:null!=this.channels[u][2]?this.channels[u][2]:1)*r.generateVolume,l=o.createGain(),f=!0,h=c*((t.expression?t.expression[0].value:100)/127);if(l.gain.value=h,e?t.expression?t.expression.forEach(function(t){var e=c*(t.value/127);e>0&&(f=!1),l.gain.setValueAtTime(e,a.getTime(t.timing)+s)}):!1:h>0&&(f=!1),f)return{isGainValueZero:f};var p=this.getTime(t.start)+s,d=this.getTime(t.stop)+s,m=r.basePitch*Math.pow(Math.pow(2,1/12),(t.pitch||69)-69),g=9!=u?o.createOscillator():o.createBufferSource(),v=o.createStereoPanner?o.createStereoPanner():o.createPanner?o.createPanner():{pan:{setValueAtTime:function(){}}},y=o.createGain();if(!o.createStereoPanner&&o.createPanner){var b=t.pan&&64!=t.pan[0].value?t.pan[0].value/127*2-1:0;b>1&&(b=1);var T=90*b,w=Math.sin(T*(Math.PI/180)),S=-Math.cos(T*(Math.PI/180));v.panningModel="equalpower",v.setPosition(w,0,S)}else if(o.createStereoPanner){var b=t.pan&&64!=t.pan[0].value?t.pan[0].value/127*2-1:0;b>1&&(b=1),v.pan.value=b}if(9!=u?(g.type=t.type||"sine",g.detune.value=0,g.frequency.value=m,t.pitchBend?t.pitchBend.forEach(function(e){g.frequency.setValueAtTime(r.basePitch*Math.pow(Math.pow(2,1/12),t.pitch-69+e.value),a.getTime(e.timing)+s)}):!1):(g.loop=!0,g.buffer=this.whitenoise),o.createStereoPanner||o.createPanner){var A=!0;o.createStereoPanner?t.pan?t.pan.forEach(function(t){if(A)return void(A=!1);var e=64==t.value?0:t.value/127*2-1;e>1&&(e=1),v.pan.setValueAtTime(e,a.getTime(t.timing)+s)}):!1:o.createPanner&&(v.positionX?t.pan?t.pan.forEach(function(t){if(A)return void(A=!1);var e=64==t.value?0:t.value/127*2-1;e>1&&(e=1);var n=90*e,i=Math.sin(n*(Math.PI/180)),r=-Math.cos(n*(Math.PI/180));v.positionX.setValueAtTime(i,a.getTime(t.timing)+s),v.positionY.setValueAtTime(0,a.getTime(t.timing)+s),v.positionZ.setValueAtTime(r,a.getTime(t.timing)+s)}):!1:t.pan?t.pan.forEach(function(t){if(A)return void(A=!1);var e=setTimeout(function(){a.clearFunc("pan",e);var n=64==t.value?0:t.value/127*2-1;n>1&&(n=1);var i=90*n,r=Math.sin(i*(Math.PI/180)),o=-Math.cos(i*(Math.PI/180));v.setPosition(r,0,o)},1e3*(a.getTime(t.timing)+s-o.currentTime));a.pushFunc({pan:e,stopFunc:function(){clearTimeout(e)}})}):!1),g.connect(v),v.connect(l)}else g.connect(l);if(l.connect(y),y.connect(this.masterGainNode),this.masterGainNode.connect(o.destination),9!=u&&t.modulation&&(t.modulation.length>=2||t.modulation[0].value>0)){var M=o.createOscillator(),P=o.createGain();A=!0,t.modulation?t.modulation.forEach(function(t){if(A)return void(A=!1);var e=t.value/127;e>1&&(e=1),P.gain.setValueAtTime(10*m/440*e,a.getTime(t.timing)+s)}):!1;var D=t.modulation?t.modulation[0].value/127:0;D>1&&(D=1),P.gain.value=10*m/440*D,M.frequency.value=6,M.connect(P),P.connect(g.frequency)}if(this.settings.isReverb&&t.reverb&&(t.reverb.length>=2||t.reverb[0].value>0)){var x=this.convolver,B=o.createGain();A=!0,t.reverb?t.reverb.forEach(function(t){if(A)return void(A=!1);var e=t.value/127;e>1&&(e=1),B.gain.setValueAtTime(e,a.getTime(t.timing)+s)}):!1;var E=t.reverb?t.reverb[0].value/127:0;E>1&&(E=1),B.gain.value=E,l.connect(B),B.connect(x)}if(this.settings.isChorus&&t.chorus&&(t.chorus.length>=2||t.chorus[0].value>0)){var I=this.chorusDelayNode,N=o.createGain();A=!0,t.chorus?t.chorus.forEach(function(t){if(A)return void(A=!1);var e=t.value/127;e>1&&(e=1),N.gain.setValueAtTime(e,a.getTime(t.timing)+s)}):!1;var k=t.chorus?t.chorus[0].value/127:0;k>1&&(k=1),N.gain.value=k,l.connect(N),N.connect(I)}return M&&(M.start(p),this.stopAudioNode(M,d,P)),g.start(p),9==u||n||i||this.stopAudioNode(g,d,l),{start:p,stop:d,pitch:m,channel:u,velocity:c,oscillator:g,panNode:v,gainNode:l,noiseCutGainNode:y,isGainValueZero:f}},t.prototype.startWebMIDI=function(){var t,e=this;if(navigator.requestMIDIAccess){var n=this.settings.WebMIDIPortSysEx,i=function(i){t=i.outputs,e.settings.WebMIDIPortOutputs=t;var r;return-1==e.settings.WebMIDIPort?e.settings.WebMIDIPortOutputs.forEach(function(t){r||(r=t)}):r=e.settings.WebMIDIPortOutputs.get(settings.WebMIDIPort),e.settings.WebMIDIPortOutput=r,e.settings.WebMIDIPortSysEx=n,r&&(r.open(),e.initStatus()),t},r=function(t){console.log(t),n&&(n=!1,navigator.requestMIDIAccess({sysex:n}).then(i).catch(r))};navigator.requestMIDIAccess({sysex:n}).then(i).catch(r),window.addEventListener("unload",function(){for(var t=0;16>t;t++){e.settings.WebMIDIPortOutput.send([176+t,120,0]);for(var n=0;128>n;n++)e.settings.WebMIDIPortOutput.send([128+t,n,0])}})}},t.prototype.initStatus=function(t,e){if(!this.settings.isWebMIDI||null==this.states.webMIDIWaitState){this.stop(t);var n=this.states.webMIDIStopTime;if(this.states={isPlaying:!1,playIndex:0,startTime:0,stopTime:0,stopFuncs:[],webMIDIWaitState:null,webMIDIStopTime:0},this.states.webMIDIStopTime=n,this.settings.isWebMIDI&&!e){if(t)return;if(null==this.settings.WebMIDIPortOutput)return void this.startWebMIDI();if(this.settings.WebMIDIPortSysEx)this.settings.WebMIDIPortOutput.send([240,126,127,9,1,247]);else for(var i=0;16>i;i++)this.settings.WebMIDIPortOutput.send([192+i,0]),this.settings.WebMIDIPortOutput.send([224+i,0,64]),this.settings.WebMIDIPortOutput.send([176+i,100,0]),this.settings.WebMIDIPortOutput.send([176+i,101,0]),this.settings.WebMIDIPortOutput.send([176+i,6,2]),this.settings.WebMIDIPortOutput.send([176+i,100,1]),this.settings.WebMIDIPortOutput.send([176+i,96,0]),this.settings.WebMIDIPortOutput.send([176+i,97,64]),this.settings.WebMIDIPortOutput.send([176+i,7,100]),this.settings.WebMIDIPortOutput.send([176+i,10,64]),this.settings.WebMIDIPortOutput.send([176+i,11,127]),this.settings.WebMIDIPortOutput.send([176+i,98,0]),this.settings.WebMIDIPortOutput.send([176+i,99,0]),this.settings.WebMIDIPortOutput.send([176+i,122,0])}}},t.prototype.stop=function(t){var e=this.states,n=this;if(0!=e.isPlaying&&(e.isPlaying=!1,e.playIndex-=this.settings.hashBuffer+1,e.stopTime=this.context.currentTime,e.stopFuncs.forEach(function(t){t.stopFunc()}),e.stopFuncs=[],this.settings.isWebMIDI)){if(t)return;if(null==this.settings.WebMIDIPortOutput)return;e.webMIDIStopTime=this.context.currentTime,setTimeout(function(){for(var t=0;16>t;t++){n.settings.WebMIDIPortOutput.send([176+t,120,0]);for(var e=0;128>e;e++)n.settings.WebMIDIPortOutput.send([128+t,e,0])}},200)}},t.prototype.play=function(t){var e=this.context,n=this.settings,i=this.trigger,r=this.states,o=this.hashedDataList,s=this;if(1!=r.isPlaying){if(n.isWebMIDI&&!t){if("completed"!=r.webMIDIWaitState){if("waiting"!=r.webMIDIWaitState){r.webMIDIWaitState="waiting";var a=800-1e3*(e.currentTime-r.webMIDIStopTime);0==r.webMIDIStopTime&&(a=800),setTimeout(function(){s.states.webMIDIWaitState="completed",s.states.isPlaying=!1,s.play()},a)}return}r.webMIDIWaitState=null}var u=this.context.currentTime;if(r.isPlaying=!0,r.startTime=r.startTime||r.stopTime?r.startTime+u-r.stopTime:u,r.stopFuncs=[],this.isSkipBeginning){var c=this.getTime(this.firstNoteOnTiming);-r.startTime+u<c&&this.setStartTime(c+r.startTime-u)}var l,f=function(){s.clearFunc("rootTimeout",l);var t=s.getTime(s.settings.isCC111&&-1!=s.cc111Time?s.lastNoteOffTiming:s.getTiming(Number.MAX_SAFE_INTEGER));t-e.currentTime+r.startTime<=0?s.onSongEnd():(l=setTimeout(f,1),s.pushFunc({rootTimeout:l,stopFunc:function(){clearTimeout(l)}}))},h=this.getTime(this.settings.isCC111&&-1!=this.cc111Time?this.lastNoteOffTiming:this.getTiming(Number.MAX_SAFE_INTEGER)),p=1e3*(h-e.currentTime+r.startTime);l=setTimeout(f,p),s.pushFunc({rootTimeout:l,stopFunc:function(){clearTimeout(l)}}),function d(t){if(r.playIndex=t,o&&o[t]&&o[t].forEach(function(t){n.isWebMIDI||s.pushFunc({note:t,stopFunc:9!=t.channel?s.createNote(t):s.createPercussionNote(t)});var o=setTimeout(function(){s.clearFunc("timeout",o),i.isNoteTrigger&&i.noteOn(t);var e=setTimeout(function(){s.clearFunc("timeout",e),s.clearFunc("note",t),i.isNoteTrigger&&i.noteOff(t)},9!=t.channel?1e3*(s.getTime(t.stop)-s.getTime(t.start)):1e3*s.settings.dramMaxPlayLength);s.pushFunc({timeout:e,stopFunc:function(){clearTimeout(e)}})},1e3*(s.getTime(t.start)-e.currentTime+r.startTime));s.pushFunc({timeout:o,stopFunc:function(){clearTimeout(o)}})}),n.isWebMIDI&&s.hashedMessageList&&s.hashedMessageList[t]&&s.hashedMessageList[t].forEach(function(t){if(null!=n.WebMIDIPortOutput&&255!=t.message[0]&&(s.settings.WebMIDIPortSysEx||240!=t.message[0]&&247!=t.message[0]))try{n.WebMIDIPortOutput.send(t.message,1e3*(s.getTime(t.timing)-e.currentTime+window.performance.now()/1e3+r.startTime))}catch(i){console.log(i,t.message)}}),t<o.length)if(t-Math.floor(1e3*(e.currentTime-r.startTime)/n.hashLength)<=n.hashBuffer)d(t+1);else{var a=setTimeout(function(){d(t+1),s.clearFunc("rootTimeout",a)},n.hashLength);s.pushFunc({rootTimeout:a,stopFunc:function(){clearTimeout(a)}})}else i.songEnd()}(r.playIndex||0)}},t.prototype.setData=function(t){this.states.isPlaying&&this.stop(),this.settings.resolution=t.header.resolution,this.settings.tempo=t.tempo||120,this.tempoTrack=t.tempoTrack,this.cc111Time=t.cc111Time,this.firstNoteOnTiming=t.firstNoteOnTiming,this.lastNoteOffTiming=t.lastNoteOffTiming;var e=this,n=[];if(t.channels.forEach(function(t){t.notes.forEach(function(t){var i=e.getTime(t.start)*(1e3/e.settings.hashLength);n[Math.floor(i)]||(n[Math.floor(i)]=[]),n[Math.floor(i)].push(t)})}),this.settings.isWebMIDI){var i=[];t.messages.forEach(function(t){var n=e.getTime(t.timing)*(1e3/e.settings.hashLength);i[Math.floor(n)]||(i[Math.floor(n)]=[]),i[Math.floor(n)].push(t)}),this.hashedMessageList=i}return this.hashedDataList=n,this.initStatus(),this},t.prototype.getMasterVolume=function(){return this.settings.masterVolume},t.prototype.setMasterVolume=function(t){this.settings.masterVolume=t,this.masterGainNode.gain.value=this.settings.masterVolume},t.prototype.isLoop=function(){return this.settings.loop},t.prototype.setLoop=function(t){this.settings.loop=t},t.prototype.isWebMIDI=function(){return this.settings.isWebMIDI},t.prototype.setWebMIDI=function(t){this.settings.isWebMIDI=t},t.prototype.isCC111=function(){return this.settings.isCC111},t.prototype.setCC111=function(t){this.settings.isCC111=t},t.prototype.setStartTime=function(t){this.states.startTime-=t,this.states.playIndex=Math.floor(1e3*t/this.settings.hashLength)},t.prototype.setOnSongEndListener=function(t){this.onSongEndListener=t},t.prototype.onSongEnd=function(){if(this.onSongEndListener){var t=this.onSongEndListener();if(t)return}this.settings.loop&&(this.initStatus(!0),this.settings.isCC111&&-1!=this.cc111Time&&this.setStartTime(this.getTime(this.cc111Time)),this.play(!0))},t.prototype.isReverb=function(){return this.settings.isReverb},t.prototype.setReverb=function(t){this.settings.isReverb=t},t.prototype.getReverbVolume=function(){return this.settings.reverbVolume},t.prototype.setReverbVolume=function(t){this.settings.reverbVolume=t},t.prototype.isChorus=function(){return this.settings.isChorus},t.prototype.setChorus=function(t){this.settings.isChorus=t},t.prototype.getChorusVolume=function(){return this.settings.chorusVolume},t.prototype.setChorusVolume=function(t){this.settings.chorusVolume=t},t.prototype.isAndroid=function(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("android")&&-1==t.indexOf("windows")},t.prototype.getTime=function(t){var e=0,n=120,i=0,r=this;return this.tempoTrack.some(function(o){return t<o.timing?!0:(e+=60/n/r.settings.resolution*(o.timing-i),i=o.timing,void(n=o.value))}),e+=60/n/r.settings.resolution*(t-i)},t.prototype.getTiming=function(t){var e=0,n=120,i=0,r=this;return this.tempoTrack.some(function(o){return e+=60/n/r.settings.resolution*(o.timing-i),e>t?(e-=60/n/r.settings.resolution*(o.timing-i),i+=(t-e)/(60/n/r.settings.resolution),!0):(i=o.timing,void(n=o.value))}),i},t.prototype.parseSMF=function(t){function e(t){for(var e=0,n=0;n<t.length;n++)e=(e<<8)+t[n];return e}function n(t){for(var e=0,n=0;e<t.length-1&&t[e]>=128;)4>e&&(n=(n<<7)+(t[e]-128)),e++;return n=(n<<7)+t[e],e++,[n,e]}if(77!=t[0]||84!=t[1]||104!=t[2]||100!=t[3])return"Not Sandard MIDI File.";var i=new Object,r=4,o=new Object;o.size=e(t.subarray(4,8)),o.format=t[9],o.trackcount=e(t.subarray(10,12)),o.timemanage=t[12],o.resolution=e(t.subarray(12,14)),r+=4+o.size;for(var s=new Array,a=new Array,u=new Array,c=-1,l=Number.MAX_SAFE_INTEGER,f=0,h=0;16>h;h++){var p=new Object;u.push(p),p.messages=[],p.notes=[]}var d=0;if(this.settings.isWebMIDI)var m=[];for(var g=0;g<o.trackcount;g++){if(77!=t[r]||84!=t[r+1]||114!=t[r+2]||107!=t[r+3])return"Irregular SMF.";r+=4;var v=(new Object,r+4+e(t.subarray(r,r+4)));r+=4;for(var y=0,b=1;v>r;){if(null!=b){var T=n(t.subarray(r,r+5)),w=T[0];y+=w,y>1e8&&(y=1e8),r+=T[1]}if(this.settings.isWebMIDI)var S=r;var A,M={timing:y,mes:[]};switch(Math.floor(t[r]/16)){case 8:case 9:case 10:case 11:case 14:b=t[r],M.mes.push(t[r],t[r+1],t[r+2]);var P=u[15&b].messages;for(A=P.length-1;A>=0;A--){var D=P[A];if(y>=D.timing)break}A++,P.splice(A,0,M),r+=3;break;case 12:case 13:b=t[r],M.mes.push(t[r],t[r+1]);var P=u[15&b].messages;for(A=P.length-1;A>=0;A--){var D=P[A];if(y>=D.timing)break}A++,P.splice(A,0,M),r+=2;break;case 15:switch(t[r]){case 240:case 247:var T=n(t.subarray(r+1,r+1+4));if(T[0]>=7&&127==t[r+2]&&127==t[r+3]&&4==t[r+4]&&1==t[r+5])for(var h=0;16>h;h++){M.mes.push(t[r],T[0]-1,t[r+2],t[r+3],t[r+4],t[r+5],t[r+6],t[r+7]);var P=u[h].messages;for(A=P.length-1;A>=0;A--){var D=P[A];if(y>=D.timing)break}A++,P.splice(A,0,M)}r+=1+T[1]+T[0];break;case 241:r+=2;break;case 242:r+=3;break;case 243:r+=2;break;case 246:case 248:case 250:case 251:case 252:case 254:r+=1;break;case 255:switch(t[r+1]){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 32:break;case 47:y+=(this.settings.isSkipEnding?0:o.resolution)-w;break;case 81:i.tempo=6e7/(65536*t[r+3]+256*t[r+4]+t[r+5]),s.push({timing:y,value:6e7/(65536*t[r+3]+256*t[r+4]+t[r+5])});break;case 84:break;case 88:a.push({timing:y,value:[t[r+3],Math.pow(2,t[r+4])]});break;case 89:case 127:}var T=n(t.subarray(r+2,r+2+4));r+=2+T[1]+T[0]}break;default:if(null==b)return"Irregular SMF.";r--,t[r]=b,b=null}if(this.settings.isWebMIDI&&null!=b){var x=t[S];if(240==x||247==x){if(this.settings.WebMIDIPortSysEx){var T=n(t.subarray(S+1,S+1+4)),B=S+1+T[1],E=B+T[0],I=new Uint8Array(1+T[0]);I[0]=x;for(var N=E-B,h=0;N>h;h++)I[h+1]=t[B+h];m.push({message:I,timing:y})}}else m.push({message:t.subarray(S,r),timing:y})}}y>d&&(d=y)}s.push({timing:d,value:120});for(var k=0;k<u.length;k++){for(var p=u[k],r=0,v=p.messages.length,L=2,C=0,O=64,R=127,F=100,_=0,G=0,j=0,V=127,U=127,W=127,q=127,$=null,z=127,H=[];v>r;){var M=p.messages[r],y=M.timing,K=p.messages[r].mes;switch(Math.floor(K[0]/16)){case 8:var h=0;H.some(function(t){var e=p.notes[t];return e.pitch==K[1]&&null==e.stop?(e.stop=y,H.splice(h,1),y>f&&(f=y),!0):void h++});break;case 9:if(0!=K[2]){var J={start:y,stop:null,pitch:K[1],pitchBend:[{timing:y,value:C}],pan:[{timing:y,value:O}],expression:[{timing:y,value:R*(z/127)}],velocity:K[2]/127*(F/127),modulation:[{timing:y,value:_}],reverb:[{timing:y,value:G}],chorus:[{timing:y,value:j}],instrument:$,channel:k};H.push(p.notes.length),p.notes.push(J),l>y&&(l=y)}else{var h=0;H.some(function(t){var e=p.notes[t];return e.pitch==K[1]&&null==e.stop?(e.stop=y,H.splice(h,1),y>f&&(f=y),!0):void h++})}break;case 10:break;case 11:switch(K[1]){case 1:_=K[2],H.forEach(function(t){var e=p.notes[t];e.modulation.push({timing:y,value:_})});break;case 6:0==W&&0==q&&(L=K[2],L>24&&(L=24));break;case 7:F=K[2];break;case 10:O=K[2],H.forEach(function(t){var e=p.notes[t];e.pan.push({timing:y,value:O})});break;case 11:R=K[2],H.forEach(function(t){var e=p.notes[t];e.expression.push({timing:y,value:R*(z/127)})});break;case 91:G=K[2],H.forEach(function(t){var e=p.notes[t];e.reverb.push({timing:y,value:G})});break;case 93:j=K[2],H.forEach(function(t){var e=p.notes[t];e.chorus.push({timing:y,value:j})});break;case 98:V=K[2];break;case 99:U=K[2];break;case 100:W=K[2];break;case 101:q=K[2];break;case 111:-1==c&&(c=y)}break;case 12:$=K[1];break;case 13:break;case 14:C=(128*K[2]+K[1]-8192)/8192*L,H.forEach(function(t){var e=p.notes[t];e.pitchBend.push({timing:y,value:C})});break;case 15:switch(K[0]){case 240:case 247:if(K[1]>=6&&127==K[2]&&127==K[3]&&4==K[4]&&1==K[5]){var Z=K[7];Z>127&&(Z=127),z=Z,H.forEach(function(t){var e=p.notes[t];e.expression.push({timing:y,value:R*(z/127)})})}}break;default:return"Error parseSMF."}r++}delete p.messages}return i.header=o,i.tempoTrack=s,i.beatTrack=a,i.channels=u,i.songLength=d,i.cc111Time=c,i.firstNoteOnTiming=l,i.lastNoteOffTiming=f,this.settings.isWebMIDI&&(i.messages=m),i},t.prototype.stopAudioNode=function(t,e,n){try{e>0?t.stop(e):(t.stop(this.context.currentTime+.005),n.gain.cancelScheduledValues(this.context.currentTime),n.gain.linearRampToValueAtTime(0,this.context.currentTime+.005))}catch(i){n.gain.cancelScheduledValues(e),0>=e&&n.gain.linearRampToValueAtTime(0,this.context.currentTime+.005)}},t.prototype.pushFunc=function(t){(t.note||t.rootTimeout||this.trigger.isNoteTrigger)&&this.states.stopFuncs.push(t)},t.prototype.clearFunc=function(t,e){if("note"==t||"rootTimeout"==t||this.trigger.isNoteTrigger){var n=this;n.states.stopFuncs.some(function(i,r){return i[t]==e?(n.states.stopFuncs.splice(r,1),!0):void 0})}},t}();requireSimulator.setName("T2MediaLib");var T2MediaLib=function(){var t=function(t){this.context=null,this.picoAudio=null,this.soundDataAry=[],this.bgmPlayerMax=16,this.bgmPlayerAry=[],this.masterVolume=1,this.seMasterVolume=1,this.bgmMasterVolume=1,this.playingAudio=null,this.audioVolume=1,this.audioTempo=1,this.audioDataAry={data:[]},this.init(t)};return t.prototype.init=function(t){if(!this.inited&&(this.inited=!0,!this.disabled&&(t?this.context=t:window.AudioContext?this.context=new AudioContext:window.webkitAudioContext?this.context=new webkitAudioContext:(this.context=null,console.log("Your browser does not support yet Web Audio API")),this.context)))for(var e=0;e<this.bgmPlayerMax;e++)this.bgmPlayerAry[e]=new T2MediaLib_BGMPlayer(this,e)},t.prototype.allClearSoundData=function(){var t=this.soundDataAry;for(var e in t)delete t[e]},t.prototype.clearSoundData=function(t){var e=this.soundDataAry;delete e[t]},t.prototype.allRemoveDecodedSoundData=function(){var t=this.soundDataAry;for(var e in t){var n=t[e];null!=n&&(n.isDecodeComplete()||n.isDecoding())&&n.removeDecodedData()}},t.prototype.removeDecodedSoundData=function(t){var e=this.soundDataAry[t];null!=e&&(e.isDecodeComplete()||e.isDecoding())&&e.removeDecodedData()},t.prototype.getMasterVolume=function(){return this.masterVolume},t.prototype.setMasterVolume=function(t){this.masterVolume=t;for(var e=0;e<this.bgmPlayerMax;e++){var n=this.bgmPlayerAry[e];n instanceof T2MediaLib_BGMPlayer&&n.onChangeBGMMasterVolume()}},t.prototype.createSoundFromArray=function(t,e,n){this.soundDataAry[t]=new T2MediaLib_SoundData;for(var i=this.context,r=null!=e&&null!=n?2:1,o=i.createBuffer(r,array.length,i.sampleRate),s=o.getChannelData(0),a=null!=n?o.getChannelData(1):null,u=0;u<array.length;u++)s[u]=e[u];if(a)for(var u=0;u<array.length;u++)a[u]=n[u];this.soundDataAry[t].onDecodeComplete(o)},t.prototype.loadSound=function(t,e,n){if(this.soundDataAry[t]=new T2MediaLib_SoundData,!this.context||this.disabled)return this.soundDataAry[t].onError("FUNC_DISABLED_ERROR"),null;(e.match(/\.(midi?)$/)||e.match(/^data:audio\/mid/))&&null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context)),"object"==typeof WebSite&&WebSite.mp3Disabled&&(e=e.replace(/\.(mp3|mp4|m4a)$/,".ogg"));var i=this,r=new XMLHttpRequest;r.onload=function(){if(200===r.status||0===r.status){var e=r.response;e instanceof ArrayBuffer?(i.soundDataAry[t].onLoadComplete(e),n&&n.succ&&n.succ(t)):(i.soundDataAry[t].onError("XHR_RESPONSE_ERROR"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID))}else i.soundDataAry[t].onError("XHR_STATUS_ERROR"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID)},r.onerror=function(e){console.log(e+""),i.soundDataAry[t].onError("XHR_ERROR"),n&&n.err&&n.err(t,i.soundDataAry[t].errorID)},this.soundDataAry[t].onLoad(e),e.match(/^data:/)&&Util&&Util.Base64_To_ArrayBuffer?(r={onload:r.onload},r.response=Util.Base64_To_ArrayBuffer(e.replace(/^data:audio\/[a-zA-Z0-9\-]+;base64,/i,"")),r.status=200,r.onload()):(r.open("GET",e,!0),r.responseType="arraybuffer",r.send(null))},t.prototype.decodeSound=function(t,e){var n=this.soundDataAry[t];if(null!=n&&!n.isDecodeComplete()){if(null==n.decodedCallbacksAry&&(n.decodedCallbacksAry=[]),e)if(null!=e.bgmPlayerId){var i=n.decodedCallbacksAry.some(function(t,i){return e.bgmPlayerId==t.bgmPlayerId?(n.decodedCallbacksAry[i]=e,!0):!1});i||n.decodedCallbacksAry.push(e)}else n.decodedCallbacksAry.push(e);if(!n.isDecoding()){n.onDecode();var r=n.fileData.slice(0);if(n.url.match(/\.(midi?)$/)||n.url.match(/^data:audio\/mid/)){null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context));var o=new Uint8Array(r),s=this.picoAudio.parseSMF(o);"string"==typeof s?(console.log("T2MediaLib: Error parseSMF()",s),this.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,this.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null):(this.soundDataAry[t].onDecodeComplete(s),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)}else{var a=this,u=function(e){a.soundDataAry[t].isDecoding()&&(a.soundDataAry[t].onDecodeComplete(e),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)},c=function(e){e instanceof Error?console.log("T2MediaLib: "+e.message,n.url):console.log("T2MediaLib: Error decodeAudioData()",n.url),a.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,a.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null};this.context.decodeAudioData(r,u,c)}}}},t.prototype.activate=function(){if(this.init(),!this.isActivated){this.isActivated=!0;var t=this.context;if(t){for(var e=t.createBuffer(1,Math.floor(t.sampleRate/32),t.sampleRate),n=e.getChannelData(0),i=(Math.floor(t.sampleRate/860),0);i<n.length;i++)n[i]=0;var r=t.createBufferSource();r.buffer=e,r.connect(t.destination),r.start=r.start||r.noteOn,r.start(0)}}},t.prototype.getSoundFileData=function(t){var e=this.soundDataAry[t];return e?e.fileData:null},t.prototype.getSoundDecodedData=function(t){var e=this.soundDataAry[t];return e?e.decodedData:null},t.prototype.getCurrentTime=function(){return this.context?this.context.currentTime:null},t.prototype.playSE=function(t,e,n,i,r,o,s,a,u,c){if(!this.context)return null;var l=this.soundDataAry[t];if(null==l)return null;if(!l.isDecodeComplete()){var f=this,h={};return h.succ=function(t){f.playSE(t,e,n,i,r,o,s,a,u,c)},h.err=function(){},this.decodeSound(t,h),null}var p=l.decodedData;if(!(p instanceof AudioBuffer))return null;null==e&&(e=1),null==n&&(n=0),i||(i=1),r?r>p.duration?r=p.duration:0>r&&(r=0):r=0,c||(c=86400),o||(o=!1),s?0>s?s=0:s>p.duration&&(s=p.duration):s=0,a?0>a?a=0:a>p.duration&&(a=p.duration):a=p.duration,u=u||0;var d=this.context.createBufferSource();this.context.createGain=this.context.createGain||this.context.createGainNode;var m=this.context.createGain(),g=this.context.createPanner();d.buffer=p,d.loop=o,d.loopStart=s,d.loopEnd=a,d.playbackRate.value=i,d.connect(m),m.connect(g),g.connect(this.context.destination),g.panningModel="equalpower",-1>n?n=-1:n>1&&(n=1);var v=90*n,y=Math.sin(v*(Math.PI/180)),b=-Math.cos(v*(Math.PI/180));(-1===n||1===n)&&(b=0),g.positionX?(g.positionX.value=y,g.positionY.value=0,g.positionZ.value=b):g.setPosition(y,0,b),m.gain.value=e*this.seMasterVolume*this.masterVolume;var T;return T=o&&a-s>0&&r>a?a:r,d.gainNode=m,d.volumeValue=e,d.panNode=g,d.panValue=n,d.playStartTime=this.context.currentTime+u,d.playOffset=T,d.plusTime=T,d.start=d.start||d.noteOn,d.stop=d.stop||d.noteOff,d.start(u,r,c),o&&null!=c&&d.stop(u+c),d.onended=function(){d.onended=null},d},t.prototype.stopSE=function(t){return t instanceof AudioBufferSourceNode?(t.stop(0),t):null},t.prototype.getSEMasterVolume=function(){return this.seMasterVolume},t.prototype.setSEMasterVolume=function(t){this.seMasterVolume=t},t.prototype.getSEVolume=function(t){return t instanceof AudioBufferSourceNode?source.volumeValue:null},t.prototype.setSEVolume=function(t,e){return t instanceof AudioBufferSourceNode?(t.gainNode.gain.value=e*this.seMasterVolume*this.masterVolume,source.volumeValue=e,t):null},t.prototype.getSERate=function(t){return t instanceof AudioBufferSourceNode?t.playbackRate.value:null},t.prototype.setSERate=function(t,e){return t instanceof AudioBufferSourceNode?void(t.playbackRate.value=e):null},t.prototype.getSEPan=function(t){return t instanceof AudioBufferSourceNode?t.panValue:null},t.prototype.setSEPan=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;var n=t.panNode;-1>e?e=-1:e>1&&(e=1);var i=90*e,r=Math.sin(i*(Math.PI/180)),o=Math.cos(i*(Math.PI/180));(-1===e||1===e)&&(o=0),n.positionX?(n.positionX.value=r,n.positionY.value=0,n.positionZ.value=o):n.setPosition(r,0,o),t.panValue=e},t.prototype.isSELoop=function(t){return t instanceof AudioBufferSourceNode?t.loop:null},t.prototype.setSELoop=function(t,e){return t instanceof AudioBufferSourceNode?void(t.loop=e):null},t.prototype.getSELoopStartTime=function(t){return t instanceof AudioBufferSourceNode?t.loopStart:null},t.prototype.setSELoopStartTime=function(t,e){return t instanceof AudioBufferSourceNode?void(t.loopStart=e):null},t.prototype.getSELoopEndTime=function(t){return t instanceof AudioBufferSourceNode?t.loopEnd:null},t.prototype.setSELoopEndTime=function(t,e){return t instanceof AudioBufferSourceNode?void(t.loopEnd=e):null},t.prototype.playBGM=function(t,e,n,i,r,o){if(!this.context)return null;var s=this._getBgmPlayer(t);return s?s.playBGM(e,n,i,r,o):null},t.prototype.stopBGM=function(t){var e=this._getBgmPlayer(t);return e?e.stopBGM():null},t.prototype.pauseBGM=function(t){var e=this._getBgmPlayer(t);return e?e.pauseBGM():null},t.prototype.resumeBGM=function(t){var e=this._getBgmPlayer(t);return e?e.resumeBGM():null},t.prototype.getBGMMasterVolume=function(){return this.bgmMasterVolume},t.prototype.setBGMMasterVolume=function(t){this.bgmMasterVolume=t;for(var e=0;e<this.bgmPlayerMax;e++){var n=this.bgmPlayerAry[e];n instanceof T2MediaLib_BGMPlayer&&n.onChangeBGMMasterVolume()}},t.prototype.getBGMVolume=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMVolume():null},t.prototype.setBGMVolume=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMVolume(e):null},t.prototype.getBGMTempo=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMTempo():null},t.prototype.setBGMTempo=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMTempo(e):null},t.prototype.getBGMPan=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMPan():null},t.prototype.setBGMPan=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMPan(e):null},t.prototype.isBGMLoop=function(t){var e=this._getBgmPlayer(t);return e?e.isBGMLoop():null},t.prototype.setBGMLoop=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoop(e):null},t.prototype.getBGMLoopStartTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLoopStartTime():null},t.prototype.setBGMLoopStartTime=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoopStartTime(e):null},t.prototype.getBGMLoopEndTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLoopEndTime():null},t.prototype.setBGMLoopEndTime=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoopEndTime(e):null},t.prototype.getBGMCurrentTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMCurrentTime():null},t.prototype.getBGMLength=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLength():null},t.prototype.getPlayingBGMName=function(t){var e=this._getBgmPlayer(t);return e?e.getPlayingBGMName():null},t.prototype.setOnBGMEndListener=function(t,e){var n=this._getBgmPlayer(t);return n?n.setOnBGMEndListener(e):null},t.prototype.getPlayingBGMState=function(t){var e=this._getBgmPlayer(t);return e?e.getPlayingBGMState():null},t.prototype.getBGMPicoAudio=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMPicoAudio():null},t.prototype.getBGMPlayerMax=function(){return this.bgmPlayerMax},t.prototype.allStopBGM=function(){for(var t=0;t<this.bgmPlayerMax;t++)this.stopBGM(t)},t.prototype.allResetBGM=function(){for(var t=0;t<this.bgmPlayerMax;t++)this.stopBGM(t),this.setBGMVolume(t,1),this.setBGMTempo(t,1),this.setBGMPan(t,0);this.setMasterVolume(1),this.setSEMasterVolume(1),this.setBGMMasterVolume(1)},t.prototype._getBgmPlayer=function(t){if(0>t||this.bgmPlayerMax<=t)return null;var e=this.bgmPlayerAry[t];return e instanceof T2MediaLib_BGMPlayer?e:null},t.prototype.loadAudio=function(t,e){var n=new Audio(e);n.play(),this.audioDataAry.data[t]=null;var i=this;n.addEventListener("loadstart",function(){if(!i.context)return null;var t=i.context.createMediaElementSource(n);t.connect(i.context.destination)},!1),n.addEventListener("canplay",function(){this.audioDataAry.data[t]=n},!1),n.load()},t.prototype.playAudio=function(t,e,n){var i=this.audioDataAry.data[t];return i?(n||(n=0),this.playingAudio instanceof Audio&&(this.playingAudio.pause(),this.playingAudio.currentTime=0),this.playingAudio=i,i.loop=e,i.volume=this.audioVolume,i.currentTime=n,i.play(),i):null},t.prototype.stopAudio=function(){var t=this.playingAudio;return t instanceof Audio?(t.pause(),t.currentTime=0,this.playingAudio=null,t):null},t.prototype.pauseAudio=function(){var t=this.playingAudio;return t?(t.pause(),t):null},t.prototype.resumeAudio=function(){var t=this.playingAudio;return t?(t.play(),t):null},t.prototype.setAudioVolume=function(t){this.audioVolume=t,this.playingAudio instanceof Audio&&(this.playingAudio.volume=t)},t.prototype.setAudioTempo=function(t){this.audioTempo=t,this.playingAudio instanceof Audio&&(this.playingAudio.playbackRate=t)},t.prototype.setAudioPosition=function(t){this.playingAudio instanceof Audio&&(this.playingAudio.currentTime=t)},t.prototype.getAudioData=function(t){return this.audioDataAry.data[t]},t.prototype.getAudioCurrentTime=function(){return this.playingAudio instanceof Audio?this.playingAudio.currentTime:null},t.prototype.getAudioLength=function(){return this.playingAudio instanceof Audio?this.playingAudio.duration:null},t}(),T2MediaLib_BGMPlayer=function(){var t=function(t,e){this.t2MediaLib=t,this.id=e,this.playingBGMState="stop",this.playingBGMStatePending=null,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1,this.bgmPan=0,this.picoAudio=null,this.picoAudioSetDataBGMName=null,this.PICO_AUDIO_VOLUME_COEF=1};return t.prototype.playBGM=function(t,e,n,i,r){this.stopBGM();var o=this.t2MediaLib.soundDataAry[t];if(null==o)return null;if(!o.isDecodeComplete()){var s=this,a={};return a.bgmPlayerId=this.id,a.succ=function(){var o=s.playingBGMStatePending;s._setPlayingBGMState("stop",!0),"stop"!=o&&s.playingBGMName==t&&s.playBGM(t,e,n,i,r),"pause"==o&&s.pauseBGM()},a.err=function(){s._setPlayingBGMState("stop",!0)},this.playingBGMName=t,this._setPlayingBGMState("decoding",!0),this._setPlayingBGMState("play"),this.t2MediaLib.decodeSound(t,a),this}var u=o.decodedData;if(u instanceof AudioBuffer)this.playingBGM=this.t2MediaLib.playSE(t,this.bgmVolume,this.bgmPan,this.bgmTempo,n,e,i,r);else if(u instanceof Object){if(this._initPicoAudio(),t!=this.picoAudioSetDataBGMName?(this.picoAudio.setData(u),this.picoAudioSetDataBGMName=t):this.picoAudio.initStatus(),this.picoAudio.setLoop(e),this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*this.bgmVolume*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),n){var c=this.picoAudio.getTime(this.picoAudio.getTiming(Number.MAX_SAFE_INTEGER));
n>c?n=c:0>n&&(n=0)}else n=0;this.picoAudio.setStartTime(n),this.picoAudio.play(),this.playingBGM=this.picoAudio}return this.playingBGMName=t,this.bgmPause=0,this._setPlayingBGMState("play"),this},t.prototype.stopBGM=function(){var t=this.playingBGM;return t instanceof PicoAudio?this.picoAudio.stop():t instanceof AudioBufferSourceNode&&t.stop(0),this.playingBGM=null,this.playingBGMName=null,this._setPlayingBGMState("stop"),this},t.prototype.pauseBGM=function(){var t=this.playingBGM;return t instanceof PicoAudio?0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseCurrentTime=t.context.currentTime,t.stop(),this.bgmPause=1):t instanceof AudioBufferSourceNode&&0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=this.t2MediaLib.getSELoopStartTime(t),this.bgmPauseLoopEnd=this.t2MediaLib.getSELoopEndTime(t),this.bgmPauseLoop=this.t2MediaLib.isSELoop(t),this.bgmPauseCurrentTime=t.context.currentTime,this.bgmPauseTempo=this.bgmTempo,t.stop(0),this.bgmPause=1),"stop"!=this.playingBGMState&&this._setPlayingBGMState("pause"),this},t.prototype.resumeBGM=function(){var t=this.playingBGM;return t instanceof PicoAudio?1===this.bgmPause&&(t.play(),this.bgmPause=0):t instanceof AudioBufferSourceNode&&1===this.bgmPause&&(t=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd)),this},t.prototype.onChangeBGMMasterVolume=function(){this.setBGMVolume(this.getBGMVolume())},t.prototype.getBGMVolume=function(){return this.bgmVolume},t.prototype.setBGMVolume=function(t){var e=this.playingBGM;return this.bgmVolume=t,e instanceof PicoAudio?this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*t*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume):e instanceof AudioBufferSourceNode&&(e.gainNode.gain.value=t*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),this},t.prototype.getBGMTempo=function(){return this.bgmTempo},t.prototype.setBGMTempo=function(t){var e=this.playingBGM;return(0>=t||isNaN(t))&&(t=1),e instanceof AudioBufferSourceNode&&0===this.bgmPause&&(e.plusTime-=(this.t2MediaLib.context.currentTime-e.playStartTime)*(t-this.bgmTempo)),this.bgmTempo=t,this.t2MediaLib.setSERate(e,t),this},t.prototype.getBGMPan=function(){return this.bgmPan},t.prototype.setBGMPan=function(t){var e=this.playingBGM;return this.bgmPan=t,e instanceof AudioBufferSourceNode&&this.t2MediaLib.setSEPan(e,t),this},t.prototype.isBGMLoop=function(){var t=this.playingBGM;return t instanceof PicoAudio?this.picoAudio.isLoop():t instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoop:this.t2MediaLib.isSELoop(t):null},t.prototype.setBGMLoop=function(t){var e=this.playingBGM;return e instanceof PicoAudio?this.picoAudio.setLoop(t):e instanceof AudioBufferSourceNode&&(1===this.bgmPause?this.bgmPauseLoop=t:this.t2MediaLib.setSELoop(e,t)),this},t.prototype.getBGMLoopStartTime=function(){var t=this.playingBGM;return t instanceof PicoAudio?0:t instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopStart:this.t2MediaLib.getSELoopStartTime(t):null},t.prototype.setBGMLoopStartTime=function(t){var e=this.playingBGM;if(e instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopStartTime(e,t);this.bgmPauseLoopStart=t}return this},t.prototype.getBGMLoopEndTime=function(){var t=this.playingBGM;return t instanceof PicoAudio?this.getBGMLength():t instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopEnd:this.t2MediaLib.getSELoopEndTime(t):null},t.prototype.setBGMLoopEndTime=function(t){var e=this.playingBGM;if(e instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopEndTime(e,t);this.bgmPauseLoopEnd=t}return this},t.prototype.getBGMCurrentTime=function(){var t=this.playingBGM;if(t instanceof PicoAudio){var e;return e=0===this.bgmPause?this.picoAudio.getTime(this.picoAudio.getTiming(this.picoAudio.context.currentTime-this.picoAudio.states.startTime)):this.bgmPauseTime}if(t instanceof AudioBufferSourceNode){var e,n,i,r,o,s,a;return 0===this.bgmPause?(i=this.t2MediaLib.context.currentTime,r=this.bgmTempo):(i=this.bgmPauseCurrentTime,r=this.bgmPauseTempo),n=(i-t.playStartTime)*r+t.plusTime,t.loop&&(t.loopEnd-t.loopStart>0?n<t.loopStart?(o=0,s=0,a=t.buffer.duration):(o=t.loopStart,s=t.loopStart,a=t.loopEnd-t.loopStart):(a=t.buffer.duration,o=0,s=0)),t.loop?e=(n-s)%a+o:(e=n,e>t.buffer.duration&&(e=t.buffer.duration)),e}return null},t.prototype.getBGMLength=function(){var t=this.playingBGM;return t instanceof PicoAudio?this.picoAudio.getTime(this.picoAudio.getTiming(Number.MAX_SAFE_INTEGER)):t instanceof AudioBufferSourceNode?t.buffer.duration:null},t.prototype.getPlayingBGMName=function(){return this.playingBGMName},t.prototype.setOnBGMEndListener=function(t){null!=this.picoAudio&&this.picoAudio.setOnSongEndListener(t)},t.prototype.getPlayingBGMState=function(){return this.playingBGMState},t.prototype.getBGMPicoAudio=function(){return this._initPicoAudio(),this.picoAudio},t.prototype._setPlayingBGMState=function(t,e){e||"decoding"!=this.playingBGMState?(this.playingBGMState=t,this.playingBGMStatePending=null):this.playingBGMStatePending=t},t.prototype._initPicoAudio=function(){null==this.picoAudio&&(0==this.id&&(this.picoAudio=this.t2MediaLib.picoAudio),null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.t2MediaLib.context,this.t2MediaLib.picoAudio)))},t}(),T2MediaLib_SoundData=function(){var t=function(){this.state="none",this.errorID=null,this.url=null,this.fileData=null,this.decodedData=null,this.decodedCallbacksAry=null};return t.prototype.onLoad=function(t){this.state="loading",this.url=t},t.prototype.onLoadComplete=function(t){this.state="loaded",this.fileData=t},t.prototype.onDecode=function(){this.state="decoding"},t.prototype.onDecodeComplete=function(t){this.state="decoded",this.decodedData=t},t.prototype.onError=function(t){this.state="error",this.errorID=t},t.prototype.isLoadComplete=function(){switch(this.state){case"loaded":case"decoding":case"decoded":return!0}return!1},t.prototype.isDecoding=function(){return"decoding"==this.state},t.prototype.isDecodeComplete=function(){return"decoded"==this.state},t.prototype.removeDecodedData=function(){this.state="loaded",this.decodedData=null},t}();requireSimulator.setName("exceptionCatcher"),define([],function(){var t={};return t.f=function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(n){t.handleException(n)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var i in e)e[i]=t.f(e[i]);return e}},t}),requireSimulator.setName("UI"),define(["Util","exceptionCatcher"],function(t,e){var n={},i=e.f;return n=function(){function e(){l.forEach(function(t){t()}),setTimeout(i(e),50)}function r(t){return t instanceof Array?o(t):"string"==typeof t?a(t):t}function o(t){var e=t[0],n=1,i=$("<"+e+">");for("object"!=typeof t[n]||t[n]instanceof Array||t[n]instanceof $||(s(i,t[n],e),n++);n<t.length;)i.append(r(t[n])),n++;return i}function s(e,r){function o(t,n){if(n)if("enterkey"==t)e.on("keypress",i(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var o,s=!0;l.push(function(){var t;t="checkbox"==r.type?!!e.prop("checked"):e.val(),(s||o!=t)&&(n.apply(e,[t,o]),o=t),s=!1})}else e.on(t,i(n))}r.$var&&(f[r.$var]=e),r.$edit&&("string"==typeof r.$edit&&(r.$edit={name:r.$edit,type:n.types.String}),r.on||(r.on={}),r.on.realtimechange=i(function(t){h.writeToModel(r.$edit,t,e)}),f[r.$edit.name]||(f[r.$edit.name]=e),h.push({jq:e,params:r}));for(var s in r)if("on"==s)for(var a in r.on)o(a,r.on[a]);else"css"==s&&null!=r[s]?e.css(r[s]):t.startsWith(s,"$")||null==r[s]||e.attr(s,r[s])}function a(t){return $(document.createTextNode(t))}for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];var l=[],f={},h=[],p=r(u);return p.$edits=h,p.$vars=f,h.load=function(t){h.model=t,h.forEach(function(t){h.writeToJq(t.params.$edit,t.jq)}),h.validator.on.validate.call(h.validator,h.model)},h.writeToJq=function(t,e){var n=h.model;if(n){for(var i=t.name,r=i.split("."),o=0;o<r.length;o++)n=n[r[o]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},h.validator={errors:{},show:function(){if(f.validationMessage){f.validationMessage.empty();for(var t in this.errors)f.validationMessage.append(n("div",this.errors[t].mesg))}if(f.OKButton){var e=!0;for(var t in this.errors)e=!1;f.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},h.writeToModel=function(t,e,n){var i=h.model;if(i){var r=t.name;try{e=t.type.fromVal(e)}catch(o){return void h.validator.addError(r,o,n)}h.validator.removeError(r);for(var s=r.split("."),a=0;a<s.length;a++)a==s.length-1?h.on.writeToModel(r,e)||(i[s[a]]=e):i=i[s[a]];h.validator.on.validate.call(h.validator,h.model)}},h.on={},h.on.writeToModel=function(){},l.length>0&&setTimeout(i(e),50),p},n.types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),requireSimulator.setName("UIDiag"),define(["UI"],function(t){var e={};return e.confirm=function(e){function n(t){return function(){r.resolve(t),i.dialog("close"),i.remove()}}var i=t("div",{title:"確認"},["div",e],["button",{on:{click:n(!0)}},"OK"],["button",{on:{click:n(!1)}},"キャンセル"]).dialog({width:"auto",close:n(!1)}),r=$.Deferred();return r.promise()},e.alert=function(e){function n(t){return function(){r.resolve(t),i.dialog("close"),i.remove()}}var i=t("div",{title:"確認"},["div",e],["button",{on:{click:n(!0)}},"OK"]).dialog({width:"auto",close:n(!1)}),r=$.Deferred();return r.promise()},e.prompt=function(e,n){function i(){var t=o.$vars.val.val();s.resolve(t),o.dialog("close"),o.remove()}function r(){o.dialog("close"),o.remove(),s.resolve()}var o=t("div",{title:"入力"},["div",e],["input",{on:{enterkey:i},$var:"val",value:n}],["br"],["button",{on:{click:i}},"OK"],["button",{on:{click:r}},"キャンセル"]).dialog({width:"auto",close:function(){o.dialog("close"),s.resolve()}});setTimeout(function(){o.$vars.val.focus()},10);var s=$.Deferred();return s.promise()},"undefined"!=typeof window&&(window.UIDiag=e),e}),requireSimulator.setName("runtime"),requirejs(["ImageList","PicoAudio","T2MediaLib","Tonyu","UIDiag"],function(){}),requireSimulator.setName("LSFS"),define(["FS"],function(t){return t.LSFS}),requireSimulator.setName("NativeFS"),define(["FS"],function(t){return t.NativeFS}),requireSimulator.setName("runScript2"),requirejs(["FS","compiledTonyuProject","Shell","runtime","WebSite","LSFS","Tonyu","NativeFS"],function(t,e,n,i,r,o,s){$(function(){function i(){var t=navigator.userAgent.toLowerCase();return-1==t.indexOf("iphone")&&-1==t.indexOf("ipad")&&-1==t.indexOf("ipod")||window==window.parent?0:40}function a(){var t=i();l=$(window).width(),f=$(window).height(),h.attr({width:l-t,height:f-t})}function u(){s.currentProject=s.globals.$currentProject=T;var t=T.getOptions();T.runScriptMode=!0,T.run(t.run.bootClass)}SplashScreen={hide:function(){$("#splash").hide()},show:function(){},progress:function(t){$("#splash").text(t)}};var c=i(),l=$(window).width(),f=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var h=$("<canvas>").attr({width:l-c,height:f-c}).appendTo("body");s.globals.$mainCanvas=h,$(window).resize(a);var p;if(r.isNW){var d=location.href.replace(/^file:\/\//,"");d.match(/^\/[a-z]:/i)&&(d=d.replace(/^\//,"")),d=t.get(d),d.isDir()||(d=d.up()),p=d.rel("data/")}else{var m=location.href.replace(/\?.*/,"").split(/\//),g=m.pop()||"runscript",v=m.pop()||"nobody",d=t.get(r.tonyuHome),y=t.get("/ram/");t.mount(y.path(),o.ramDisk()),p=y;var b=d.rel(v+"/"+g+"/");y.rel("files/").link(b)}loadFiles(p),n.cd(p),r.compiledKernel="js/kernel.js","BA"===r.serverType&&window.runtimePath&&(r.compiledKernel=window.runtimePath+"lib/tonyu/kernel.js");var T=e("user","js/concat.js",p);u()})}),requireSimulator.setName();