!function(){var e={};return e.def=function(t,n,r){var i=e.getModuleInfo(e.curName);i.type=r,e.setReqs(i,t),i.func=function(){return n.apply(this,e.getObjs(t))},e.loadIfAvailable(i)},define=function(){var t=Array.prototype.slice.call(arguments);"string"==typeof t[0]&&(e.curName=t.shift());var n=t.shift(),r=t.shift();e.def(n,r,"define")},define.amd={jQuery:!0},requirejs=function(t,n){e.def(t,n,"require")},e.setReqs=function(t,n){n.forEach(function(n){var r=e.getModuleInfo(n);r.loaded||(t.reqs[n]=r,r.revReqs[t.name]=t)})},e.getModuleInfo=function(t){var n=e.modules;return n[t]||(n[t]={name:t,reqs:{},revReqs:{}}),n[t]},e.doLoad=function(t){var n=e.getModuleInfo(t);if(n.loaded)return n.obj;n.loaded=!0;var r=null;if(n.func)r=n.func();else{var i=t.split(/\./);r=function(){return this}(),i.forEach(function(e){r&&(r=r[e])}),null==r&&console.log("Warning: No obj for "+t)}if("define"==n.type&&null==r)throw"No obj for "+t;n.obj=r;for(var o in n.revReqs)e.notifyLoaded(n.revReqs[o],n.name);return r},e.notifyLoaded=function(t,n){delete t.reqs[n],e.loadIfAvailable(t)},e.loadIfAvailable=function(t){for(var n in t.reqs)return;e.doLoad(t.name)},e.getObjs=function(t){var n=[];return t.forEach(function(t){var r=e.doLoad(t);n.push(r)}),n},e.modules={},e.setName=function(t){e.curName&&(e.getModuleInfo(e.curName).func||e.doLoad(e.curName)),t&&(e.curName=t)},requireSimulator=e,e}(),requireSimulator.setName("FS"),define([],function(){var e,t,n={},i="REQJS_",o=0;n.def=function(e,t,r){var i=n.getModuleInfo(e);"function"==typeof t?(r=t,t=n.reqsFromFunc(r),n.setReqs(i,t),i.func=function(){var e={exports:{}},t=r(n.doLoad,e,e.exports);return t||e.exports}):(n.setReqs(i,t),i.func=function(){return r.apply(this,n.getObjs(t))}),n.loadIfAvailable(i)},e=function(e,t,r){n.def(e,t,r)},e.amd={},t=function(e,t){n.def(i+o++,e,t)},n.setReqs=function(e,t){t.forEach(function(t){var r=n.getModuleInfo(t);r.loaded||(e.reqs[t]=r,r.revReqs[e.name]=e)})},n.getModuleInfo=function(e){var t=n.modules;return t[e]=t[e]||{name:e,reqs:{},revReqs:{}}},n.doLoad=function(e){var t=n.getModuleInfo(e);if(t.loaded)return t.obj;t.loaded=!0;var r=t.func();null!=r||e.match(/^REQJS_/)||console.log("Warning: No obj for "+e),t.obj=r;for(var i in t.revReqs)n.notifyLoaded(t.revReqs[i],t.name);return r},n.notifyLoaded=function(e,t){delete e.reqs[t],n.loadIfAvailable(e)},n.loadIfAvailable=function(e){for(var t in e.reqs)return;n.doLoad(e.name)},n.getObjs=function(e){var t=[];return e.forEach(function(e){var r=n.doLoad(e);t.push(r)}),t},n.reqsFromFunc=function(e){var t=e+"",n=[];return t.replace(/require\s*\(\s*["']([^"']+)["']\s*\)/g,function(e,t){n.push(t)}),n},n.modules={},e("extend",[],function(){return function(e,t){for(var n in t)e[n]=t[n]}}),e("assert",[],function(){function e(t){if(t instanceof Array){var n=[];return t.forEach(function(t){n=n.concat(e(t))}),n}return[t]}var t,n=function(t){this.failMesg=e(t||"Assertion failed: ")};n.prototype={_regedType:{},registerType:function(e,t){this._regedType[e]=t},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var n=t(arguments),r=n.shift();if(n=e(n),n=this.failMesg.concat(r).concat(n).concat(["mode",this._mode]),console.log.apply(console,n),this.isDefensive())return r;if(this.isBool())return!1;throw new Error(n.join(" "))},subAssertion:function(){var r=t(arguments);return r=e(r),new n(this.failMesg.concat(r))},assert:function(e,t){return e?e:this.fail(e,t)},eq:function(e,t){return e!==t?this.fail(e,"!==",t):this.isBool()?!0:e},ne:function(e,t){return e===t?this.fail(e,"===",t):this.isBool()?!0:e},isset:function(e,t){return null==e?this.fail(e,(t||"")+" is null/undef"):this.isBool()?!0:e},is:function(e,t){var n=t,r=e;if(null==n)return this.fail(e,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[r]),this.isBool()?!0:e;if(this.assert(null!=e,[e,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!e||"number"!=typeof e.length)return this.fail(e,"should be array:");for(var i=this,o=0;o<n.length;o++){var s=i.subAssertion("failed at ",e,"[",o,"]: ");null==n[o]&&console.log("WOW!7",r[o],n[o]),s.is(r[o],n[o])}return this.isBool()?!0:e}if(n===String||"string"==n)return this.assert("string"==typeof r,[r,"should be a string "]),this.isBool()?!0:e;if(n===Number||"number"==n)return this.assert("number"==typeof r,[r,"should be a number"]),this.isBool()?!0:e;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(r,String),this.assert(n.exec(r),[r,"does not match to",n]),this.isBool()?!0:e;if(n===Function)return this.assert("function"==typeof r,[r,"should be a function"]),this.isBool()?!0:e;if("function"==typeof n)return this.assert(r instanceof n,[r,"should be ",n]),this.isBool()?!0:e;if(n&&"object"==typeof n){for(var a in n){var s=this.subAssertion("failed at ",e,".",a,":");s.is(e[a],n[a])}return this.isBool()?!0:e}if("string"==typeof n){var u=this._regedType[n];return u?this.is(e,u):this.isBool()?!0:e}return this.fail(e,"Invaild type: ",n)},ensureError:function(e,t){try{e()}catch(n){return"string"==typeof t&&i(n+""===t,e+" thrown an error "+n+" but expected:"+t),void console.log("Error thrown successfully: ",n.message)}this.fail(e,"should throw an error",t)},setMode:function(e){this._mode=e},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},t=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t};var r=new n,i=function(){try{return r.assert.apply(r,arguments)}catch(e){throw new Error(e.message)}};return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(e){i[e]=function(){try{return r[e].apply(r,arguments)}catch(t){throw console.log(t.stack),new Error(t.message)}}}),i.fail=r.fail.bind(r),i.MODE_STRICT=r.MODE_STRICT,i.MODE_DEFENSIVE=r.MODE_DEFENSIVE,i.MODE_BOOL=r.MODE_BOOL,i.f=function(e){return{_assert_func:e}},i.opt=function(e){return i.f(function(t){return null==t||t instanceof e})},i.and=function(){var e=t(arguments);return i(e instanceof Array),i.f(function(t){for(var n=this,r=0;r<e.length;r++)n.is(t,e[r])})},i}),e("PathUtil",["assert"],function(e){function t(t,n){return e.is(arguments,[String,String]),t.substring(t.length-n.length)===n}function n(t,n){return e.is(arguments,[String,String]),t.substring(0,n.length)===n}var r,i=/^([a-zA-Z]):/,o=/^([a-z]+):\/\/\/?([^\/]+)\//,s=e.f(function(e){this.is(e,String),this.assert(r.isPath(e),[e," is not a path"])}),a=e.f(function(e){this.is(e,String),this.assert(r.isAbsolutePath(e),[e," is not a absolute path"])}),u=e.f(function(e){this.is(e,String),this.assert(!r.isAbsolutePath(e),[e," is not a relative path"])}),c=e.f(function(e){this.is(e,s),this.assert(r.isDir(e),[e," is not a directory path"])}),l=e.and(c,a),f=e.f(function(e){this.is(e,s),this.assert(!r.isDir(e),[e," is not a file path"])}),h="/";return r={Path:s,Absolute:a,Relative:u,Dir:c,File:f,AbsDir:l,SEP:h,endsWith:t,startsWith:n,hasDriveLetter:function(e){return i.exec(e)},isURL:function(e){var t=o.exec(e);if(t)return{protocol:t[1],hostPort:t[2],path:h+e.substring(t[0].length)}},isPath:function(){return e.is(arguments,[String]),!0},isRelativePath:function(t){return e.is(arguments,[String]),r.isPath(t)&&!r.isAbsolutePath(t)},isAbsolutePath:function(t){return e.is(arguments,[String]),r.isPath(t)&&(r.startsWith(t,h)||r.hasDriveLetter(t)||r.isURL(t))},isDir:function(n){return n=r.fixSep(n),e.is(arguments,[s]),t(n,h)},hasBackslashSep:function(e){return e.indexOf("\\")>=0},fixSep:function(t,n){return n=n||"/",e.is(arguments,[String]),e.is(t.replace(/[\\\/]/g,n),s)},directorify:function(t){return r.isDir(t)?t:e.is(t+h,c)},filify:function(t){return r.isDir(t)?e.is(t.substring(0,t.length-1),f):t},splitPath:function(t){e.is(arguments,[s]);var n;if(n=this.isURL(t)){var r=this.splitPath(n.path);return r[0]=n.protocol+"://"+n.hostPort,r}t=t.replace(/\/+/g,h);var i=t.split(h);return""==i[i.length-1]&&(i[i.length-2]+=h,i.pop()),i},name:function(t){return e.is(arguments,[String]),r.splitPath(t).pop()},ext:function(t){e.is(arguments,[String]);var n=r.name(t),i=/\.[a-zA-Z0-9]+$/.exec(n);return i?i[0]:null},truncExt:function(t,n){e.is(t,String);var i=r.name(t);return n=n||r.ext(t),e.is(n,String),i.substring(0,i.length-n.length)},truncSEP:function(t){return e.is(arguments,[s]),r.isDir(t)?t.substring(0,t.length-1):t},endsWith:function(n,i){return e.is(arguments,[String,String]),t(r.name(n),i)},parent:function(t){return e.is(arguments,[String]),r.up(t)},rel:function(t,n){if(""==n)return t;e.is(arguments,[l,u]);var i=r.splitPath(n),o=t;o=o.replace(/\/$/,"");var s=r;return i.forEach(function(e){".."==e||"../"==e?o=s.up(o):(o=o.replace(/\/$/,""),o+=h+("."==e||"./"==e?"":e))}),o},relPath:function(t,n){return e.is(arguments,[a,a]),t.substring(0,n.length)!=n?"../"+r.relPath(t,this.up(n)):t.substring(n.length)},up:function(e){if(e==h)return null;var t=r.splitPath(e);return t.pop(),t.join(h)+h}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(e){var t=r[e];r[e]=function(){var e=!1,n=Array.prototype.slice.call(arguments).map(function(t){return r.hasBackslashSep(t)?(e=!0,r.fixSep(t)):t}),i=t.apply(r,n);return e?r.fixSep(i,"\\"):i}}),r.isAbsolute=r.isAbsolutePath,r.isRelative=r.isRelativePath,"object"==typeof window&&(window.PathUtil=r),r}),e("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".mp3":"audio/mp3",".ogg":"audio/ogg",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu"}}),e("DeferredUtil",[],function(){var e,t=function(e){this.res=e};return e={isNativePromise:function(e){return e&&"function"==typeof e.then&&"function"!=typeof e.promise&&"function"==typeof e.catch},isJQPromise:function(e){return e&&"function"==typeof e.then&&"function"==typeof e.promise&&"function"==typeof e.fail},isPromise:function(e){return e&&"function"==typeof e.then&&("function"==typeof e.promise||"function"==typeof e.catch)},all:function(t){return e.promise(function(n,r){var i=[],o=t.length;t.forEach(function(t,s){e.resolve(t).then(function(e){i[s]=e,o--,0===o&&n(i)},r)})})},resolve:function(t){return e.config.useJQ&&e.isJQPromise(t)?t:!e.config.useJQ&&e.isNativePromise(t)?t:e.promise(function(n,r){e.isPromise(t)?t.then(n,r):n(t)})},assertResolved:function(e){var t,n;if(e.then(function(e){t=e,n=!0}),!n)throw console.log(r),new Error("Promise not resolved");return t},ensureDefer:function(t){return e.promise(function(n,r){var i;e.resolve(t).then(function(e){i?n(e):setTimeout(function(){n(e)},0)}).fail(function(e){i?r(e):setTimeout(function(){r(e)},0)}),i=!0})},directPromise:function(t){return e.timeout(t,0)},then:function(t){return e.directPromise().then(t)},timeout:function(t,n){return e.promise(function(e){setTimeout(function(){e(n)},t||0)})},funcPromise:function(t){if(e.config.useJQ){var n=new $.Deferred;try{t(function(e){n.resolve(e)},function(e){n.reject(e)})}catch(r){n.reject(r)}return n.promise()}if(e.external.Promise)return new e.external.Promise(function(e,n){try{t(e,n)}catch(r){n(r)}});throw new Error("promise is not found")},reject:function(t){if(e.config.useJQ){var n=new $.Deferred;return n.reject(t),n.promise()}return new JQ.external.Promise(function(e,n){n(t)})},throwPromise:function(t){if(e.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(t)},0),n.promise()}return new JQ.external.Promise(function(e,n){n(t)})},throwF:function(t){return function(){try{return t.apply(this,arguments)}catch(n){return console.log(n,n.stack),e.throwPromise(n)}}},each:function(t,n){if(t instanceof Array)return e.loop(function(r){return r>=t.length?e.brk():e.resolve(n(t[r],r)).then(function(){return r+1})},0);var r=[];for(var i in t)r.push({k:i,v:t[i]});return e.each(r,function(e){return n(e.k,e.v)})},loop:function(n,r){try{for(var i;;){if(r instanceof t)return e.when1(r.res);var o=!0,s=!1,a=n(r),u=e.resolve(a).then(function(i){return r=i,o=!1,r instanceof t?r.res:s?e.loop(n,r):void 0}).fail(function(e){o=!1,i=e});if(i)throw i;if(s=!0,o)return u}}catch(c){return e.reject(c)}},brk:function(e){return new t(e)},tryLoop:function(t,n){return e.loop(e.tr(t),n)},tryEach:function(t,n){return e.loop(t,e.tr(n))},documentReady:function(){return e.callbackToPromise(function(e){$(e)})},requirejs:function(t){if(!window.requirejs)throw new Error("requirejs is not loaded");return e.callbackToPromise(function(e){window.requirejs(t,e)})}},e.NOP=function(e){return e},e.begin=e.try=e.tr=e.throwF,e.promise=e.callbackToPromise=e.funcPromise,e.when1=e.resolve,e.config={},window.$&&window.$.Deferred&&(e.config.useJQ=!0),e.external={Promise:window.Promise},window.DeferredUtil||(window.DeferredUtil=e),e}),e("FS2",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(e,t,n,r,i){function o(e){throw new Error(e+" is STUB!")}var s=function(){},a={};return s.addFSType=function(e,t){a[e]=t},s.availFSTypes=function(){return a},e(s.prototype,{err:function(e,t){throw new Error(e+": "+t)},fstype:function(){return"Unknown"},isReadOnly:function(){o("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(e){return r(this.getRootFS()!==this),this.getRootFS().resolveFS(e)},mounted:function(e,t){this.rootFS=e,this.mountPoint=t},inMyFS:function(e){return!this.mountPoint||t.startsWith(e,this.mountPoint)},getRootFS:function(){return r(this.rootFS,"rootFS is not set")},getReturnTypes:function(){o("")},getContent:function(){o("getContent")},getContentAsync:function(){return this.supportsSync()||o("getContentAsync"),i.resolve(this.getContent.apply(this,arguments))},setContent:function(){o("")},setContentAsync:function(e,t,n){var r=this;return r.supportsSync()||o("setContentAsync"),i.resolve(t).then(function(t){return i.resolve(r.setContent(e,t,n))})},appendContent:function(){o("")},appendContentAsync:function(e,t,n){var r=this;return r.supportsSync()||o("appendContentAsync"),i.resolve(t).then(function(t){return i.resolve(r.appendContent(e,t,n))})},getMetaInfo:function(){o("")},setMetaInfo:function(){o("")},mkdir:function(){o("mkdir")},touch:function(){o("touch")},exists:function(){o("exists")},opendir:function(){o("opendir")},opendirAsync:function(){return this.supportsSync()||o("opendirAsync"),i.resolve(this.opendir.apply(this,arguments))},cp:function(e,n,i){r.is(arguments,[t.Absolute,t.Absolute]),this.assertExist(e),i=i||{};var o=this.isDir(e),s=this.getRootFS().resolveFS(n),a=s.isDir(n);if(o||a)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(e),c=s.setContent(n,u);return i.a&&s.setMetaInfo(n,this.getMetaInfo(e)),c}return s.setContentAsync(n,this.getContentAsync(e)).then(function(t){return i.a?s.setMetaInfo(n,this.getMetaInfo(e)):t})},mv:function(e,t,n){return this.cp(e,t,n),this.rm(e,{r:!0})},rm:function(){o("")},link:function(e,t){throw new Error("ln "+t+" "+e+" : This FS not support link.")},getURL:function(){o("")}}),s.delegateMethods=function(e,n){for(var i in n)!function(i){r.ne(i,"inMyFS"),e[i]=function(){var e=arguments[0];r.is(e,t.Absolute);var o=this.resolveFS(e);return o!==this?(console.log("Invoked for other fs",this.mountPoint,o.mountPoint),o[i].apply(o,arguments)):n[i].apply(this,arguments)}}(i)},s.delegateMethods(s.prototype,{assertWriteable:function(e){this.isReadOnly(e)&&this.err(e,"read only.")},getContentType:function(e,r){var i=(t.ext(e)+"").toLowerCase();return n[i]||(r||{}).def||"text/plain"},getBlob:function(e,t){var n=this.getContent(e);return t=t||{},t.blobType=t.blobType||Blob,t.binType=t.binType||ArrayBuffer,n.hasPlainText()?new t.blobType([n.toPlainText()],this.getContentType(e)):new t.blobType([n.toBin(t.binType)],this.getContentType(e))},isText:function(e){var n=this.getContentType(e);return t.startsWith(n,"text")},assertExist:function(e,n){this.exists(e,n)||this.err(e,": No such "+(t.isDir(e)?"directory":"file"))},isDir:function(e){return t.isDir(e)},find:function(e,n){r.is(arguments,[t.Absolute]);var i=this.opendir(e,n),o=this,s=[e];return i.forEach(function(r){var i=t.rel(e,r);if(t.isDir(i)){var a=o.resolveFS(i);s=s.concat(a.find(i,n))}else s.push(i)}),s},resolveLink:function(e){r.is(e,t.Absolute);for(var n=e;n;n=t.up(n)){r(!this.mountPoint||t.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+e);var i=this.isLink(n);if(i){r(i!=n,"l==p=="+i);var o=t.rel(i,t.relPath(e,n));return r(o!=e,"np==path=="+o),r.is(this.getRootFS().resolveFS(o).resolveLink(o),t.Absolute)}if(this.exists(n))return e}return e},isLink:function(){return null},opendirEx:function(e){r.is(e,t.AbsDir);var n=this.opendir(e),i=this,o={};return n.forEach(function(n){var r=t.rel(e,n);o[n]=i.getMetaInfo(r)}),o},getDirTree:function(e,n){n=n||{};var i=n.dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],r.is(n.excludes,Array),n.base||(n.base=e),r.is(e,t.AbsDir);var o=this.opendirEx(e,n);if("no-recursive"==n.style)return o;var s=this;for(var a in o){var u=o[a],c=t.rel(e,a),l=t.relPath(c,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(l)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(c)>=0)continue}if(s.isDir(c))switch(n.style){case"flat-absolute":case"flat-relative":s.getDirTree(c,n);break;case"hierarchical":n.dest={},i[a]=s.getDirTree(c,n)}else switch(n.style){case"flat-absolute":i[c]=u;break;case"flat-relative":i[l]=u;break;case"hierarchical":i[a]=u}}return i}}),s}),e("Util",[],function(){function e(e,n){null==n&&(n=""),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:t(i[1])}function t(e){return decodeURIComponent(e.replace(/\+/g,"%20"))}function n(e,t){return e.substring(e.length-t.length)===t}function r(e,t){return e.substring(0,t.length)===t}function i(e){if(e.__privatized)return e;var t={__privatized:!0};for(var n in e)!function(n){var r=e[n];n.match(/^_/)||"function"==typeof r&&(t[n]=function(){var t=r.apply(e,arguments);return t})}(n);return t}function o(e,t){for(var n in t||{})e[n]=t[n];return e}return{getQueryString:e,endsWith:n,startsWith:r,privatize:i,extend:o}}),e("Content",["assert","Util"],function(e,t){var n=function(){},r=t.extend;n.plainText=function(e,t){var r=new n;return r.contentType=t||"text/plain",r.plain=e,r},n.url=function(e){var t=new n;return t.url=e,t},n.buffer2ArrayBuffer=function(t){if(n.isBuffer(t)){var r=new Uint8Array(t),i=r.buffer;if(i instanceof ArrayBuffer)return i;var o=Array.prototype.slice.call(r);return e(new Uint8Array(o).buffer,"n2a: buf is not set")}return e(t,"n2a: a is not set")},n.arrayBuffer2Buffer=function(t){if(t instanceof ArrayBuffer){var n=new Buffer(new Uint8Array(t));return n}return e(t,"a2n: a is not set")},n.bin=function(t,r){e(r,"contentType should be set");var i=new n;if(t&&n.isBuffer(t.buffer))i.arrayBuffer=t.buffer;else if(n.isNodeBuffer(t))i.nodeBuffer=t;else{if(!(t instanceof ArrayBuffer))throw new Error(t+" is not a bin");i.arrayBuffer=t}return i.contentType=r,i};var i=n.prototype;i.toBin=function(e){if(e=e||(n.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return e===Buffer?this.nodeBuffer:this.arrayBuffer=n.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return e===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=n.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var t=new s(this.url,e);return this.setBuffer(t.buffer)}if(null!=this.plain)return this.setBuffer(n.str2utf8bytes(this.plain,e));throw new Error("No data")},i.setBuffer=function(t){return e(t,"b is not set"),n.isNodeBuffer(t)?this.nodeBuffer=t:this.arrayBuffer=t},i.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},i.toNodeBuffer=function(){return this.toBin(Buffer)},i.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=n.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var e=new s(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=e.url}throw new Error("No data")},i.toPlainText=function(){if(null!=this.plain)return this.plain;if(this.url&&!this.hasBin()){var e=new s(this.url,ArrayBuffer);this.arrayBuffer=e.buffer}if(this.hasBin())return this.plain=n.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},i.hasURL=function(){return this.url},i.hasPlainText=function(){return null!=this.plain},i.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},i.hasNodeBuffer=function(){return this.nodeBuffer},i.hasArrayBuffer=function(){return this.arrayBuffer},n.Base64_To_ArrayBuffer=function(e,t){function r(t){throw console.log(t),console.log(e,h),new Error(t)}var i=t||ArrayBuffer;e=e.replace(/[\n=]/g,"");var o=new Object;o[65]=0,o[66]=1,o[67]=2,o[68]=3,o[69]=4,o[70]=5,o[71]=6,o[72]=7,o[73]=8,o[74]=9,o[75]=10,o[76]=11,o[77]=12,o[78]=13,o[79]=14,o[80]=15,o[81]=16,o[82]=17,o[83]=18,o[84]=19,o[85]=20,o[86]=21,o[87]=22,o[88]=23,o[89]=24,o[90]=25,o[97]=26,o[98]=27,o[99]=28,o[100]=29,o[101]=30,o[102]=31,o[103]=32,o[104]=33,o[105]=34,o[106]=35,o[107]=36,o[108]=37,o[109]=38,o[110]=39,o[111]=40,o[112]=41,o[113]=42,o[114]=43,o[115]=44,o[116]=45,o[117]=46,o[118]=47,o[119]=48,o[120]=49,o[121]=50,o[122]=51,o[48]=52,o[49]=53,o[50]=54,o[51]=55,o[52]=56,o[53]=57,o[54]=58,o[55]=59,o[56]=60,o[57]=61,o[43]=62,o[47]=63;var s,a=e.length,u=0,c=0;if(!a)return new i(0);s=Math.floor(a/4*3),"="==e.charAt(a-1)&&(s-=1),"="==e.charAt(a-2)&&(s-=1);for(var l=new i(s),f=n.isNodeBuffer(l)?l:new Uint8Array(l),h=0,p=0;s>p&&(c=o[e.charCodeAt(h)],void 0===c&&r("Invalid letter: "+e.charCodeAt(h)),u=c<<2,h++,c=o[e.charCodeAt(h)],void 0===c&&r("Invalid letter: "+e.charCodeAt(h)),f[p]=u|c>>4&3,u=(15&c)<<4,h++,p++,!(p>=s))&&(c=o[e.charCodeAt(h)],void 0===c&&r("Invalid letter: "+e.charCodeAt(h)),f[p]=u|c>>2&15,u=(3&c)<<6,h++,p++,!(p>=s));)c=o[e.charCodeAt(h)],void 0===c&&r("Invalid letter: "+e.charCodeAt(h)),f[p]=u|c,h++,p++;return l},n.Base64_From_ArrayBuffer=function(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(e),i=r.length,o=0,s=0,a=0;i>a&&(s=r[a],n+=t[s>>2],o=(3&s)<<4,a++,!(a>=i))&&(s=r[a],n+=t[o|s>>4],o=(15&s)<<2,a++,!(a>=i));)s=r[a],n+=t[o|s>>6],n+=t[63&s],a++;var u=i%3;return u&&(n+=t[o]),1==u?n+="==":2==u&&(n+="="),n},n.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},n.isNodeBuffer=function(e){return n.hasNodeBuffer()&&e instanceof Buffer},n.isBuffer=function(e){return e instanceof ArrayBuffer||n.isNodeBuffer(e)},n.utf8bytes2str=function(e){for(var t=[],n=0;n<e.length;n++)t.push("%"+("0"+e[n].toString(16)).slice(-2));try{return decodeURIComponent(t.join(""))}catch(r){throw console.log(t.join("")),r}},n.str2utf8bytes=function(e,t){for(var n=encodeURIComponent(e),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&t===Buffer?new Buffer(i):new Uint8Array(i).buffer};var o=n.hasNodeBuffer()?Buffer:ArrayBuffer,s=function(t,r){"string"==typeof t?(this.url=t,this.binType=r||o,this.dataURL2bin(t)):t&&n.isBuffer(t.buffer)?(this.buffer=t.buffer,e.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):n.isBuffer(t)?(this.buffer=t,e.is(r,String),this.contentType=r,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),e.fail("Invalid args: ",arguments))};return n.DataURL=s,r(s.prototype,{bin2dataURL:function(t,r){e(n.isBuffer(t)),e.is(r,String);var i=this.dataHeader(r),o=n.Base64_From_ArrayBuffer(t);return e.is(o,String),this.url=i+o},dataURL2bin:function(t){e.is(arguments,[String]);var r=/^data:([^;]+);base64,/i,i=r.exec(t);return e(i,["malformed dataURL:",t]),this.contentType=i[1],this.buffer=n.Base64_To_ArrayBuffer(t.substring(i[0].length),this.binType),e.is(this.buffer,this.binType)},dataHeader:function(t){return e.is(arguments,[String]),"data:"+t+";base64,"},toString:function(){return e.is(this.url,String)}}),n}),e("NativeFS",["FS2","assert","PathUtil","extend","MIMETypes","Content"],function(e,t,n,r,i,o){var s="object"==typeof process;if(!s)return function(){throw new Error("This system not support native FS")};var a=t,u=require("fs"),c=function(e){e&&(t.is(e,n.AbsDir),this.rootPoint=e)},l=n.hasDriveLetter(process.cwd());c.available=!0;var f=n.SEP,h=c.prototype=new e;return h.toNativePath=function(e){return this.rootPoint?(t.is(e,n.Absolute),t(this.inMyFS(e),e+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(e,this.mountPoint||n.SEP))):e},h.arrayBuffer2Buffer=function(e){if(e instanceof ArrayBuffer){var t=new Buffer(new Uint8Array(e));return t}return e},e.addFSType("NativeFS",function(e,t){return new c(t.r)}),c.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},c.prototype.inMyFS=function(e){return this.mountPoint?n.startsWith(e,this.mountPoint):!(!!l^!!n.hasDriveLetter(e))},e.delegateMethods(c.prototype,{getReturnTypes:function(){return a.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(e,r){r=r||{},t.is(e,n.Absolute);var i=this.toNativePath(e);return this.assertExist(e),this.isText(e)?o.plainText(u.readFileSync(i,{encoding:"utf8"})):o.bin(u.readFileSync(i),this.getContentType(e))},setContent:function(e,r){t.is(arguments,[n.Absolute,o]);var i=n.up(e);i&&this.getRootFS().resolveFS(i).mkdir(i);var s=this.toNativePath(e);r.hasBin()||!r.hasPlainText()?u.writeFileSync(s,r.toNodeBuffer()):u.writeFileSync(s,r.toPlainText())},appendContent:function(e,r){t.is(arguments,[n.Absolute,o]);var i=n.up(e);i&&this.getRootFS().resolveFS(i).mkdir(i);var s=this.toNativePath(e);r.hasBin()||!r.hasPlainText()?u.appendFileSync(s,r.toNodeBuffer()):u.appendFileSync(s,r.toPlainText())},getMetaInfo:function(e,t){this.assertExist(e,t);var n=this.stat(e);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(){},isReadOnly:function(){return!1},stat:function(e){t.is(e,n.Absolute);var r=this.toNativePath(e);return u.statSync(r)},mkdir:function(e){if(a.is(arguments,[n.Absolute]),this.exists(e)){if(this.isDir(e))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(e);var t=n.up(e);t&&this.getRootFS().resolveFS(t).mkdir(t);var r=this.toNativePath(e);return u.mkdirSync(r),this.assertExist(r)},opendir:function(e,t){a.is(arguments,[String]),t=t||{};var r=this.toNativePath(e),i=n.truncSEP(r),o=u.readdirSync(r);t.nosep||(o=o.map(function(e){var t=u.statSync(i+f+e),n=t.isDirectory()?f:"";return e+n}));var s=[];return a.is(s.concat(o),Array)},rm:function(e,t){a.is(arguments,[n.Absolute]),t=t||{},this.assertExist(e);var r=this.toNativePath(e);return this.isDir(e)?u.rmdirSync(r):u.unlinkSync(r)},exists:function(e){var t=this.toNativePath(e);return u.existsSync(t)},isDir:function(e){return this.exists(e)?this.stat(e).isDirectory():n.isDir(e)},touch:function(e){!this.exists(e)&&this.isDir(e)?this.mkdir(e):this.exists(e)&&u.utimesSync(e,Date.now()/1e3,Date.now()/1e3)},getURL:function(e){return"file:///"+e.replace(/\\/g,"/")}}),c}),e("LSFS",["FS2","PathUtil","extend","assert","Util","Content"],function(e,t,n,r,i,o){function s(){return(new Date).getTime()}var a=function(e,t){r(e," new LSFS fail: no storage"),this.storage=e,this.options=t||{},this.options.useDirCache&&(this.dirCache={})},u=t.isDir.bind(t),c=t.up.bind(t),l=t.endsWith.bind(t),f=(t.Path,t.Absolute),h=t.SEP;return a.ramDisk=function(e){var n={};return n[t.SEP]="{}",e=e||{},"useDirCache"in e||(e.useDirCache=!0),new a(n,e)},e.addFSType("localStorage",function(e,t){return new a(localStorage,t)}),e.addFSType("ram",function(e,t){return a.ramDisk(t)}),a.now=s,a.prototype=new e,a.prototype.resolveKey=function(e){return r.is(e,t.Absolute),this.mountPoint?t.SEP+t.relPath(e,this.mountPoint):e},a.prototype.getItem=function(e){r.is(e,t.Absolute);var n=this.resolveKey(e);return this.storage[n]},a.prototype.setItem=function(e,n){r.is(e,t.Absolute);var i=this.resolveKey(e);r(i.indexOf("..")<0),r(t.startsWith(i,t.SEP)),this.storage[i]=n},a.prototype.removeItem=function(e){r.is(e,t.Absolute);var n=this.resolveKey(e);delete this.storage[n]},a.prototype.itemExists=function(e){r.is(e,t.Absolute);var n=this.resolveKey(e);return r(this.storage,"No storage"),n in this.storage},a.prototype.getDirInfo=function(e){if(r.is(arguments,[t.AbsDir]),null==e)throw new Error("getDir: Null path");if(l(e,h)||(e+=h),r(this.inMyFS(e)),this.dirCache&&this.dirCache[e])return this.dirCache[e];var n={};try{var i=this.getItem(e);i&&(n=JSON.parse(i))}catch(o){console.log("dinfo err : ",e,i)}return this.dirCache&&(this.dirCache[e]=n),n},a.prototype.putDirInfo=function(e,n,i){if(r.is(arguments,[t.AbsDir,Object]),!u(e))throw new Error("Not a directory : "+e);r(this.inMyFS(e)),this.dirCache&&(this.dirCache[e]=n),this.setItem(e,JSON.stringify(n));var o=c(e);if(null!=o&&this.inMyFS(o)){var s=this.getDirInfo(o);this._touch(s,o,t.name(e),i)}},a.prototype._touch=function(e,n,i,o){r.is(arguments,[Object,String,String]),r(this.inMyFS(n)),e[i]||(e[i]={},o&&(e[i].trashed=!0)),o||delete e[i].trashed,e[i].lastUpdate=s(),this.getRootFS().notifyChanged(t.rel(n,i),e[i]),this.putDirInfo(n,e,o)},a.prototype.removeEntry=function(e,t,n){r.is(arguments,[Object,String,String]),e[n]&&(e[n]={lastUpdate:s(),trashed:!0},this.putDirInfo(t,e,!0))},a.prototype.removeEntryWithoutTrash=function(e,t,n){r.is(arguments,[Object,String,String]),e[n]&&(delete e[n],this.putDirInfo(t,e,!0))},a.prototype.isRAM=function(){return this.storage!==localStorage},a.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},e.delegateMethods(a.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(){return r.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(e){r.is(arguments,[f]),this.assertExist(e);var t;return t=this.isText(e)?o.plainText(this.getItem(e)):o.url(this.getItem(e))},setContent:function(e,t){r.is(arguments,[f,o]),this.assertWriteable(e),this.isText(e)?this.setItem(e,t.toPlainText()):this.setItem(e,t.toURL()),this.touch(e)},getMetaInfo:function(e){if(this.assertExist(e,{includeTrashed:!0}),r.is(arguments,[f]),e==t.SEP)return{};var n=r(t.up(e));if(!this.inMyFS(n))return{};var i=t.name(e);r.is(n,t.AbsDir);var o=this.getDirInfo(n);return r(o[i])},setMetaInfo:function(e,n){r.is(arguments,[String,Object]),this.assertWriteable(e);
var i=r(t.up(e));if(this.inMyFS(i)){var o=this.getDirInfo(i),s=t.name(e);o[s]=n,this.putDirInfo(i,o,o[s].trashed)}},mkdir:function(e){r.is(arguments,[f]),this.assertWriteable(e),this.touch(e)},opendir:function(e,t){r.is(arguments,[String]),t=t||{};var n=this.getDirInfo(e),i=[];for(var o in n)r(n[o]),(!n[o].trashed||t.includeTrashed)&&i.push(o);return r.is(i,Array)},rm:function(e,n){r.is(arguments,[f]),n=n||{},this.assertWriteable(e);var i=t.up(e);if(null==i||!this.inMyFS(i))throw new Error(e+": cannot remove. It is root of this FS.");if(this.assertExist(e,{includeTrashed:n.noTrash}),t.isDir(e)){var o=this.opendir(e);o.length>0&&this.err(e,"Directory not empty"),n.noTrash&&this.removeItem(e)}else this.removeItem(e);var s=this.getDirInfo(i);n.noTrash?this.removeEntryWithoutTrash(s,i,t.name(e)):this.removeEntry(s,i,t.name(e))},exists:function(e,n){r.is(arguments,[f]),n=n||{};var i=t.name(e),o=t.up(e);if(null==o||!this.inMyFS(o))return!0;var s=this.getDirInfo(o),a=s[i];return a&&a.trashed&&this.itemExists(e)&&this.isDir(e),!a&&this.itemExists(e),a&&!a.trashed&&!a.link&&!this.itemExists(e),a&&!n.includeTrashed&&(a=!a.trashed),!!a},link:function(e,n){r.is(arguments,[t.Absolute,t.Absolute]),this.assertWriteable(e),this.exists(e)&&this.err(e,"file exists"),t.isDir(e)&&!t.isDir(n)&&this.err(e," can not link to file "+n),!t.isDir(e)&&t.isDir(n)&&this.err(e," can not link to directory "+n);var i={};i.link=n,i.lastUpdate=s(),this.setMetaInfo(e,i),r(this.exists(e)),r(this.isLink(e))},isLink:function(e){if(r.is(arguments,[t.Absolute]),!this.exists(e))return null;var n=r(this.getMetaInfo(e));return n.link},touch:function(e){r.is(arguments,[f]),this.assertWriteable(e),this.itemExists(e)||(t.isDir(e)?(this.dirCache&&(this.dirCache[e]={}),this.setItem(e,"{}")):this.setItem(e,""));var n=c(e);if(null!=n)if(this.inMyFS(n)){var i=this.getDirInfo(n);this._touch(i,n,t.name(e),!1)}else r(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(e){return this.getContent(e).toURL()},opendirEx:function(e,n){r.is(e,t.AbsDir),n=n||{};var i={},o=this.getDirInfo(e);if(n.includeTrashed)return o;for(var s in o)o[s].trashed||(i[s]=o[s]);return i}}),a}),$.ajaxTransport("+binary",function(e,t,n){return window.FormData&&(e.dataType&&"binary"==e.dataType||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob))?{send:function(t,n){var r=new XMLHttpRequest,i=e.url,o=e.type,s=e.async||!0,a=e.responseType||"blob",u=e.data||null,c=e.username||null,l=e.password||null;r.addEventListener("load",function(){var t={};t[e.dataType]=r.response,n(r.status,r.statusText,t,r.getAllResponseHeaders())}),r.open(o,i,s,c,l);for(var f in t)r.setRequestHeader(f,t[f]);r.responseType=a,r.send(u)},abort:function(){n.abort()}}:void 0}),e("jquery.binarytransport",function(){}),e("WebFS",["FS2","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(e,t,n,r,i){var o=function(){},s=o.prototype=new e;return e.addFSType("web",function(){return new o}),s.fstype=function(){return"Web"},s.supportsSync=function(){return!1},s.inMyFS=function(e){return i.isURL(e)},e.delegateMethods(s,{exists:function(){return!0},getContentAsync:function(e){var t=this;return n.promise(function(n,i){$.get(e,function(i){var o=new FileReader;o.addEventListener("loadend",function(){n(r.bin(o.result,t.getContentType(e)))}),o.readAsArrayBuffer(i)},"binary").fail(i)})},getURL:function(e){return e}}),o}),e("Env",["assert","PathUtil"],function(e,t){var n=function(e){this.value=e};return n.prototype={expand:function(t){e.is(t,String);var n=this;return t.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,t){return n.get(t)})},expandPath:function(n){return e.is(n,String),n=this.expand(n),n=n.replace(/\/+/g,"/"),n=n.replace(/^[a-z][a-z]+:\//,function(e){return e+"/"}),e.is(n,t.Path)},get:function(e){return this.value[e]},set:function(e,t){this.value[e]=t}},n});var s=s||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in n,i=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},o=e.webkitRequestFileSystem,s=e.requestFileSystem||o||e.mozRequestFileSystem,a=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u=0,c=function(t){var n=function(){"string"==typeof t?(e.URL||e.webkitURL||e).revokeObjectURL(t):t.remove()};e.chrome?n():setTimeout(n,10)},l=function(e,t,n){t=[].concat(t);for(var r=t.length;r--;){var i=e["on"+t[r]];if("function"==typeof i)try{i.call(e,n||e)}catch(o){a(o)}}},f=function(t,a){var f,h,p,d=this,m=t.type,g=!1,v=function(){l(d,["writestart","progress","write","writeend"])},y=function(){(g||!f)&&(f=(e.URL||e.webkitURL||e).createObjectURL(t)),h?h.location.href=f:void 0==e.open(f,"_blank")&&"undefined"!=typeof safari&&(e.location.href=f),d.readyState=d.DONE,v(),c(f)},b=function(e){return function(){return d.readyState!==d.DONE?e.apply(this,arguments):void 0}},_={create:!0,exclusive:!1};d.readyState=d.INIT,a||(a="download"),r?(f=(e.URL||e.webkitURL||e).createObjectURL(t),n.href=f,n.download=a,i(n),d.readyState=d.DONE,v(),c(f)):(e.chrome&&m&&"application/octet-stream"!==m&&(p=t.slice||t.webkitSlice,t=p.call(t,0,t.size,"application/octet-stream"),g=!0),o&&"download"!==a&&(a+=".download"),("application/octet-stream"===m||o)&&(h=e),s?(u+=t.size,s(e.TEMPORARY,u,b(function(e){e.root.getDirectory("saved",_,b(function(e){var n=function(){e.getFile(a,_,b(function(e){e.createWriter(b(function(n){n.onwriteend=function(t){h.location.href=e.toURL(),d.readyState=d.DONE,l(d,"writeend",t),c(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&y()},["writestart","progress","write","abort"].forEach(function(e){n["on"+e]=d["on"+e]}),n.write(t),d.abort=function(){n.abort(),d.readyState=d.DONE},d.readyState=d.WRITING}),y)}),y)};e.getFile(a,{create:!1},b(function(e){e.remove(),n()}),b(function(e){e.code===e.NOT_FOUND_ERR?n():y()}))}),y)}),y)):y())},h=f.prototype;return h.abort=function(){this.readyState=this.DONE,l(this,"abort")},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(e,t){return new f(e,t)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=s:"undefined"!=typeof e&&null!==e&&null!=e.amd&&e("FileSaver.min",[],function(){return s}),e("SFile",["extend","assert","PathUtil","Util","Content","FS2","FileSaver.min","DeferredUtil"],function(e,t,n,r,i,o,a,u){var c=function(e,r){t.is(r,n.Absolute),this._path=r,this.rootFS=e,this.fs=e.resolveFS(r),this.isDir()&&!n.isDir(r)&&(this._path+=n.SEP)};return c.is=function(e){return e&&"function"==typeof e.isSFile&&e.isSFile()},c.prototype={isSFile:function(){return!0},setPolicy:function(e){if(this.policy)throw new Error("policy already set");return this.policy=e,this._clone()},getPolicy:function(){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(e,i){var o;if(i=i||{},c.is(e))o=e;else{t.is(e,n.Absolute);var s,a=i.policy||this.policy;if(a&&(s=a.topDir)&&(s.path&&(s=s.path()),!n.startsWith(e,s)))throw new Error(e+": cannot access. Restricted to "+s);o=new c(this.rootFS,e),o.policy=a}return o.policy?r.privatize(o):o},contains:function(e){return t(c.is(e),e+" shoud be a SFile object."),this.isDir()?n.startsWith(e.path(),this.path()):!1},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(e){return n.truncExt(this.path(),e)},ext:function(){return n.ext(this.path())},relPath:function(e){var r=e.path?e.path():e;return n.relPath(this.path(),t.is(r,n.Absolute))},up:function(){var e=this.path(),t=n.up(e);return null==t?null:this._resolve(t)},rel:function(e){t.is(e,n.Relative),this.assertDir();var r=this.path();return this._resolve(n.rel(r,e))},sibling:function(e){return this.up().rel(e)},startsWith:function(e){return n.startsWith(this.name(),e)},endsWith:function(e){return n.endsWith(this.name(),e)},equals:function(e){return e&&"function"==typeof e.path&&e.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var e=this.metaInfo();return e?e.trashed:!1},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(e){return this.act.fs.getMetaInfo(this.act.path,e)},setMetaInfo:function(e,t){return this.act.fs.setMetaInfo(this.act.path,e,t)},getDirTree:function(e){return this.act.fs.getDirTree(this.act.path,e)},assertExists:function(){t(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(e){var t=Array.prototype.slice.call(arguments);if("function"==typeof t[0]){var n=t.shift();return u.resolve(this.exists.apply(this,t)).then(n)}e=e||{};var r=this.fs.exists(this.path(),e);return r||e.noFollowLink?r:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(e){var t=this;if(e=e||{},this.isLink())return u.resolve(this.fs.rm(this.path(),e));var n;return n=this.isDir()&&(e.recursive||e.r)?this.each(function(t){return t.rm(e)}):u.resolve(),n.then(function(){return t.act.fs.rm(t.act.path,e)})},removeWithoutTrash:function(e){e=e||{},e.noTrash=!0,this.rm(e)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(e){return"function"==typeof e?this.getText(e):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(e){if(t.is(e,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());return u.resolve(this.isText()?this.act.fs.setContent(this.act.path,i.plainText(e)):this.act.fs.setContent(this.act.path,i.url(e)))},appendText:function(e){if(t.is(e,String),this.isText())return this.act.fs.appendContent(this.act.path,i.plainText(e));throw new Error("append only for text file")},getContent:function(e){return"function"==typeof e?this.act.fs.getContentAsync(this.act.path).then(e):this.act.fs.getContent(this.act.path)},setContent:function(e){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,e)},getText:function(e){if("function"==typeof e){var t=this;return this.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}).then(e)}return this.isText()?this.act.fs.getContent(this.act.path).toPlainText():this.act.fs.getContent(this.act.path).toURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(){return this.act.fs.getContentType(this.act.path)},bytes:function(e){return i.isBuffer(e)?this.setBytes(e):this.getBytes()},setBytes:function(e){return this.act.fs.setContent(this.act.path,i.bin(e,this.contentType()))},getBytes:function(e){return e=e||{},this.act.fs.getContent(this.act.path).toBin(e.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(){return this.text().replace(/\r/g,"").split("\n")},obj:function(){var e=this;if(0==arguments.length){var n=e.text();return n?JSON.parse(n):null}e.text(JSON.stringify(t.is(arguments[0],Object)))},copyFrom:function(e,t){return e.copyTo(this,t)},copyTo:function(e,n){t(e&&e.isSFile(),e+" is not a file");var r=this,n=n||{},i=r.isDir(),o=e.isDir();if(!i&&o&&(e=e.rel(r.name()),t(!e.isDir(),e+" is a directory."),o=!1),!i||o){if(i||o)return t(i&&o,"Both src and dst should be dir"),r.each(function(t){e.rel(t.name()).copyFrom(t,n)});n.echo&&n.echo(r+" -> "+e);var s=this.act.fs.cp(this.act.path,e.getResolvedLinkPath(),n);return n.a&&e.setMetaInfo(r.getMetaInfo()),u.resolve(s)}this.err("Cannot move dir to file")},moveFrom:function(e,t){return this.copyFrom(e,t).then(function(){return e.rm({recursive:!0})})},moveTo:function(e,t){return e.moveFrom(this,t)},assertDir:function(){return t.is(this.path(),n.Dir),this},each:function(e,t){var n=this.assertDir();return n.listFilesAsync(t).then(function(t){return u.each(t,e)})},eachrev:function(e,t){var n=this.assertDir();return n.listFilesAsync(t).then(function(t){return u.each(t.reverse(),e)})},recursive:function(e,t){var n=this.assertDir();return n.each(function(t){return t.isDir()?t.recursive(e):e(t)},t)},listFilesAsync:function(e){t(null==e||"object"==typeof e);var n,r=this.assertDir(),i=this.path();return e=r.convertOptions(e),n||(n=e.order),this.act.fs.opendirAsync(this.act.path,e).then(function(t){for(var o=[],s=0;s<t.length;s++){var a=t[s];e.excludes[i+a]||o.push(r.rel(a))}return"function"==typeof n&&o.sort&&o.sort(n),o})},listFiles:function(e){var t=Array.prototype.slice.call(arguments);return u.assertResolved(this.listFilesAsync.apply(this,t))},ls:function(e){t(null==e||"object"==typeof e);var n=this.assertDir();if(!e)return this.act.fs.opendir(this.act.path,e);var r=n.listFiles(e);return r.map(function(e){return e.name()})},convertOptions:function(e){var i=r.extend({},e),o=(this.assertDir(),this.path());if(i.excludes||(i.excludes={}),i.excludes instanceof Array){var s={};i.excludes.forEach(function(e){n.startsWith(e,"/")?s[e]=1:s[o+e]=1}),i.excludes=s}return t.is(i,{excludes:{}})},mkdir:function(){return this.touch()},link:function(e,t){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,e.path(),t)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(e){return this.getFS().getRootFS().addObserver(this.path(),e)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use 'zip' instead.");s(this.getBlob(),this.name())}},Object.defineProperty(c.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),t.is(this._act,{fs:o,path:n.Absolute}),this._act)}}),c}),e("RootFS",["assert","FS2","PathUtil","SFile"],function(e,t,n,r){var i=function(n){e.is(n,t),this.mount(null,n)},o=i.prototype,s={err:function(e,t){throw new Error(e+": "+t)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(t){e.is(arguments,[n.AbsDir]);var r=this.fstab();console.log(r);for(var i=0;i<r.length;i++)if(r[i].mountPoint==t)return r.splice(i,1),!0;return!1},availFSTypes:function(){return t.availFSTypes()},mount:function(n,r,i){if("string"==typeof r){var o=e(t.availFSTypes()[r],"fstype "+r+" is undefined.");r=o(n,i||{})}e.is(r,t),r.mounted(this,n),this.fstab().unshift(r)},resolveFS:function(r){e.is(r,n.Absolute);var i;return this.fstab().forEach(function(e){i||e.inMyFS(r)&&(i=e)}),i||this.err(r,"Cannot resolve"),e.is(i,t)},get:function(t){return e.is(t,n.Absolute),new r(this.resolveFS(t),t)},addObserver:function(){this.observers=this.observers||[];var t,n;if(2==arguments.length)t=arguments[0],n=arguments[1];else{if(1!=arguments.length)throw new Error("Invalid argument spec");t="",n=arguments[0]}e.is(t,String),e.is(n,Function);var r=this.observers,i={path:t,handler:n,remove:function(){var e=r.indexOf(this);r.splice(e,1)}};return this.observers.push(i),i},notifyChanged:function(e,t){this.observers&&this.observers.forEach(function(r){n.startsWith(e,r.path)&&r.handler(e,t)})},getRootFS:function(){return this}};for(var a in s)o[a]=s[a];return i}),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof e&&e.amd)e("jszip",[],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.JSZip=t()}}(function(){return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";var r=e("./utils"),i=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,i,s,a,u,c,l=[],f=0,h=e.length,p=h,d="string"!==r.getTypeOf(e);f<e.length;)p=h-f,d?(t=e[f++],n=h>f?e[f++]:0,i=h>f?e[f++]:0):(t=e.charCodeAt(f++),n=h>f?e.charCodeAt(f++):0,i=h>f?e.charCodeAt(f++):0),s=t>>2,a=(3&t)<<4|n>>4,u=p>1?(15&n)<<2|i>>6:64,c=p>2?63&i:64,l.push(o.charAt(s)+o.charAt(a)+o.charAt(u)+o.charAt(c));return l.join("")},n.decode=function(e){var t,n,r,s,a,u,c,l=0,f=0,h="data:";if(e.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var p=3*e.length/4;if(e.charAt(e.length-1)===o.charAt(64)&&p--,e.charAt(e.length-2)===o.charAt(64)&&p--,p%1!==0)throw new Error("Invalid base64 input, bad content length.");var d;for(d=i.uint8array?new Uint8Array(0|p):new Array(0|p);l<e.length;)s=o.indexOf(e.charAt(l++)),a=o.indexOf(e.charAt(l++)),u=o.indexOf(e.charAt(l++)),c=o.indexOf(e.charAt(l++)),t=s<<2|a>>4,n=(15&a)<<4|u>>2,r=(3&u)<<6|c,d[f++]=t,64!==u&&(d[f++]=n),64!==c&&(d[f++]=r);return d}},{"./support":30,"./utils":32}],2:[function(e,t){"use strict";function n(e,t,n,r,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=r,this.compressedContent=i}var r=e("./external"),i=e("./stream/DataWorker"),o=e("./stream/DataLengthProbe"),s=e("./stream/Crc32Probe"),o=e("./stream/DataLengthProbe");n.prototype={getContentWorker:function(){var e=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},n.createWorkerFrom=function(e,t,n){return e.pipe(new s).pipe(new o("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new o("compressedSize")).withStreamInfo("compression",t)},t.exports=n},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){"use strict";var r=e("./stream/GenericWorker");n.STORE={magic:"\x00\x00",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t){"use strict";function n(){for(var e,t=[],n=0;256>n;n++){e=n;for(var r=0;8>r;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function r(e,t,n,r){var i=s,o=r+n;e=-1^e;for(var a=r;o>a;a++)e=e>>>8^i[255&(e^t[a])];return-1^e}function i(e,t,n,r){var i=s,o=r+n;e=-1^e;for(var a=r;o>a;a++)e=e>>>8^i[255&(e^t.charCodeAt(a))];return-1^e}var o=e("./utils"),s=n();t.exports=function(e,t){if("undefined"==typeof e||!e.length)return 0;var n="string"!==o.getTypeOf(e);return n?r(0|t,e,e.length,0):i(0|t,e,e.length,0)}},{"./utils":32}],5:[function(e,t,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t){var n=null;n="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:n}},{lie:58}],7:[function(e,t,n){"use strict";function r(e,t){a.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,o=e("pako"),s=e("./utils"),a=e("./stream/GenericWorker"),u=i?"uint8array":"array";n.magic="\b\x00",s.inherits(r,a),r.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(u,e.data),!1)},r.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},r.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},r.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},n.compressWorker=function(e){return new r("Deflate",e)},n.uncompressWorker=function(){return new r("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(e,t){"use strict";function n(e,t,n,r){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var r=e("../utils"),i=e("../stream/GenericWorker"),o=e("../utf8"),s=e("../crc32"),a=e("../signature"),u=function(e,t){var n,r="";for(n=0;t>n;n++)r+=String.fromCharCode(255&e),e>>>=8;return r},c=function(e,t){var n=e;return e||(n=t?16893:33204),(65535&n)<<16},l=function(e){return 63&(e||0)},f=function(e,t,n,i,f,h){var p,d,m=e.file,g=e.compression,v=h!==o.utf8encode,y=r.transformTo("string",h(m.name)),b=r.transformTo("string",o.utf8encode(m.name)),_=m.comment,w=r.transformTo("string",h(_)),x=r.transformTo("string",o.utf8encode(_)),S=b.length!==m.name.length,T=x.length!==_.length,A="",E="",k="",C=m.dir,P=m.date,D={crc32:0,compressedSize:0,uncompressedSize:0};(!t||n)&&(D.crc32=e.crc32,D.compressedSize=e.compressedSize,D.uncompressedSize=e.uncompressedSize);var M=0;t&&(M|=8),v||!S&&!T||(M|=2048);var B=0,N=0;C&&(B|=16),"UNIX"===f?(N=798,B|=c(m.unixPermissions,C)):(N=20,B|=l(m.dosPermissions,C)),p=P.getUTCHours(),p<<=6,p|=P.getUTCMinutes(),p<<=5,p|=P.getUTCSeconds()/2,d=P.getUTCFullYear()-1980,d<<=4,d|=P.getUTCMonth()+1,d<<=5,d|=P.getUTCDate(),S&&(E=u(1,1)+u(s(y),4)+b,A+="up"+u(E.length,2)+E),T&&(k=u(1,1)+u(s(w),4)+x,A+="uc"+u(k.length,2)+k);var I="";I+="\n\x00",I+=u(M,2),I+=g.magic,I+=u(p,2),I+=u(d,2),I+=u(D.crc32,4),I+=u(D.compressedSize,4),I+=u(D.uncompressedSize,4),I+=u(y.length,2),I+=u(A.length,2);var O=a.LOCAL_FILE_HEADER+I+y+A,L=a.CENTRAL_FILE_HEADER+u(N,2)+I+u(w.length,2)+"\x00\x00\x00\x00"+u(B,4)+u(i,4)+y+A+w;return{fileRecord:O,dirRecord:L}},h=function(e,t,n,i,o){var s="",c=r.transformTo("string",o(i));return s=a.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+u(e,2)+u(e,2)+u(t,4)+u(n,4)+u(c.length,2)+c},p=function(e){var t="";return t=a.DATA_DESCRIPTOR+u(e.crc32,4)+u(e.compressedSize,4)+u(e.uncompressedSize,4)};r.inherits(n,i),n.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-r-1))/n:100}}))},n.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=f(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},n.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=f(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:p(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},n.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,r=h(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},n.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},n.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},n.prototype.resume=function(){return i.prototype.resume.call(this)?!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0):!1},n.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},n.prototype.lock=function(){i.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=n},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){"use strict";var r=e("../compressions"),i=e("./ZipFileWorker"),o=function(e,t){var n=e||t,i=r[n];if(!i)throw new Error(n+" is not a valid compression method !");return i};n.generateWorker=function(e,t,n){var r=new i(t.streamFiles,n,t.platform,t.encodeFileName),s=0;try{e.forEach(function(e,n){s++;var i=o(n.options.compression,t.compression),a=n.options.compressionOptions||t.compressionOptions||{},u=n.dir,c=n.date;n._compressWorker(i,a).withStreamInfo("file",{name:e,dir:u,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(r)}),r.entriesCount=s}catch(a){r.error(a)}return r}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}n.prototype=e("./object"),n.prototype.loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.1.5",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=e("./external"),t.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t){"use strict";function n(e){return new i.Promise(function(t,n){var r=e.decompressed.getContentWorker().pipe(new a);r.on("error",function(e){n(e)}).on("end",function(){r.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}var r=e("./utils"),i=e("./external"),o=e("./utf8"),r=e("./utils"),s=e("./zipEntries"),a=e("./stream/Crc32Probe"),u=e("./nodejsUtils");t.exports=function(e,t){var a=this;return t=r.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then(function(e){var n=new s(t);return n.load(e),n}).then(function(e){var r=[i.Promise.resolve(e)],o=e.files;if(t.checkCRC32)for(var s=0;s<o.length;s++)r.push(n(o[s]));return i.Promise.all(r)}).then(function(e){for(var n=e.shift(),r=n.files,i=0;i<r.length;i++){var o=r[i];a.file(o.fileNameStr,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders})}return n.zipComment.length&&(a.comment=n.zipComment),a})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t){"use strict";function n(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}var r=e("../utils"),i=e("../stream/GenericWorker");r.inherits(n,i),n.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},n.prototype.pause=function(){return i.prototype.pause.call(this)?(this._stream.pause(),!0):!1},n.prototype.resume=function(){return i.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1},t.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t){"use strict";function n(e,t,n){r.call(this,t),this._helper=e;var i=this;e.on("data",function(e,t){i.push(e)||i._helper.pause(),n&&n(t)}).on("error",function(e){i.emit("error",e)}).on("end",function(){i.push(null)})}var r=e("readable-stream").Readable,i=e("../utils");i.inherits(n,r),n.prototype._read=function(){this._helper.resume()},t.exports=n},{"../utils":32,"readable-stream":16}],14:[function(e,t){"use strict";t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){return new Buffer(e,t)},allocBuffer:function(e){return Buffer.alloc?Buffer.alloc(e):new Buffer(e)},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t){"use strict";function n(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var r=e("./utf8"),i=e("./utils"),o=e("./stream/GenericWorker"),s=e("./stream/StreamHelper"),a=e("./defaults"),u=e("./compressedObject"),c=e("./zipObject"),l=e("./generate"),f=e("./nodejsUtils"),h=e("./nodejs/NodejsStreamInputAdapter"),p=function(e,t,n){var r,s=i.getTypeOf(t),l=i.extend(n||{},a);l.date=l.date||new Date,null!==l.compression&&(l.compression=l.compression.toUpperCase()),"string"==typeof l.unixPermissions&&(l.unixPermissions=parseInt(l.unixPermissions,8)),l.unixPermissions&&16384&l.unixPermissions&&(l.dir=!0),l.dosPermissions&&16&l.dosPermissions&&(l.dir=!0),l.dir&&(e=m(e)),l.createFolders&&(r=d(e))&&g.call(this,r,!0);var p="string"===s&&l.binary===!1&&l.base64===!1;n&&"undefined"!=typeof n.binary||(l.binary=!p);var v=t instanceof u&&0===t.uncompressedSize;(v||l.dir||!t||0===t.length)&&(l.base64=!1,l.binary=!0,t="",l.compression="STORE",s="string");var y=null;y=t instanceof u||t instanceof o?t:f.isNode&&f.isStream(t)?new h(e,t):i.prepareContent(e,t,l.binary,l.optimizedBinaryString,l.base64);var b=new c(e,y,l);this.files[e]=b},d=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t="undefined"!=typeof t?t:a.createFolders,e=m(e),this.files[e]||p.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,r;for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],n=t.slice(this.root.length,t.length),n&&t.slice(0,this.root.length)===this.root&&e(n,r))},filter:function(e){var t=[];return this.forEach(function(n,r){e(n,r)&&t.push(r)}),t},file:function(e,t,r){if(1===arguments.length){if(n(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}var o=this.files[this.root+e];return o&&!o.dir?o:null}return e=this.root+e,p.call(this,e,t,r),this},folder:function(e){if(!e)return this;if(n(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,r=g.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;
var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if(n=i.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode}),n.type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");i.checkSupport(n.type),("darwin"===n.platform||"freebsd"===n.platform||"linux"===n.platform||"sunos"===n.platform)&&(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var a=n.comment||this.comment||"";t=l.generateWorker(this,n,a)}catch(u){t=new o("error"),t.error(u)}return new s(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return e=e||{},e.type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t){t.exports=e("stream")},{stream:void 0}],17:[function(e,t){"use strict";function n(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}var r=e("./DataReader"),i=e("../utils");i.inherits(n,r),n.prototype.byteAt=function(e){return this.data[this.zero+e]},n.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===t&&this.data[o+1]===n&&this.data[o+2]===r&&this.data[o+3]===i)return o-this.zero;return-1},n.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),o=this.readData(4);return t===o[0]&&n===o[1]&&r===o[2]&&i===o[3]},n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./DataReader":18}],18:[function(e,t){"use strict";function n(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}var r=e("../utils");n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=n},{"../utils":32}],19:[function(e,t){"use strict";function n(e){r.call(this,e)}var r=e("./Uint8ArrayReader"),i=e("../utils");i.inherits(n,r),n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t){"use strict";function n(e){r.call(this,e)}var r=e("./DataReader"),i=e("../utils");i.inherits(n,r),n.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},n.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},n.prototype.readAndCheckSignature=function(e){var t=this.readData(4);return e===t},n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./DataReader":18}],21:[function(e,t){"use strict";function n(e){r.call(this,e)}var r=e("./ArrayReader"),i=e("../utils");i.inherits(n,r),n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(e,t){"use strict";var n=e("../utils"),r=e("../support"),i=e("./ArrayReader"),o=e("./StringReader"),s=e("./NodeBufferReader"),a=e("./Uint8ArrayReader");t.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),"string"!==t||r.uint8array?"nodebuffer"===t?new s(e):r.uint8array?new a(n.transformTo("uint8array",e)):new i(n.transformTo("array",e)):new o(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t){"use strict";function n(e){r.call(this,"ConvertWorker to "+e),this.destType=e}var r=e("./GenericWorker"),i=e("../utils");i.inherits(n,r),n.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(e,t){"use strict";function n(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var r=e("./GenericWorker"),i=e("../crc32"),o=e("../utils");o.inherits(n,r),n.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t){"use strict";function n(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}var r=e("../utils"),i=e("./GenericWorker");r.inherits(n,i),n.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(e,t){"use strict";function n(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}var r=e("../utils"),i=e("./GenericWorker"),o=16384;r.inherits(n,i),n.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return i.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0):!1},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=o,t=null,n=Math.min(this.max,this.index+e);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,n);break;case"uint8array":t=this.data.subarray(this.index,n);break;case"array":case"nodebuffer":t=this.data.slice(this.index,n)}return this.index=n,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(e,t){"use strict";function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return this.isFinished?!1:(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=n},{}],29:[function(e,t){"use strict";function n(e,t,n){switch(e){case"blob":return s.newBlob(s.transformTo("arraybuffer",t),n);case"base64":return c.encode(t);default:return s.transformTo(e,t)}}function r(e,t){var n,r=0,i=null,o=0;for(n=0;n<t.length;n++)o+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(o),n=0;n<t.length;n++)i.set(t[n],r),r+=t[n].length;return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}function i(e,t){return new f.Promise(function(i,o){var s=[],a=e._internalType,u=e._outputType,c=e._mimeType;e.on("data",function(e,n){s.push(e),t&&t(n)}).on("error",function(e){s=[],o(e)}).on("end",function(){try{var e=n(u,r(a,s),c);i(e)}catch(t){o(t)}s=[]}).resume()})}function o(e,t,n){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=t,this._mimeType=n,s.checkSupport(r),this._worker=e.pipe(new a(r)),e.lock()}catch(i){this._worker=new u("error"),this._worker.error(i)}}var s=e("../utils"),a=e("./ConvertWorker"),u=e("./GenericWorker"),c=e("../base64"),l=e("../support"),f=e("../external"),h=null;if(l.nodestream)try{h=e("../nodejs/NodejsStreamOutputAdapter")}catch(p){}o.prototype={accumulate:function(e){return i(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,function(e){t.call(n,e.data,e.meta)}):this._worker.on(e,function(){s.delay(t,arguments,n)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(s.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=o},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=0===new Blob([r],{type:"application/zip"}).size}catch(i){try{var o=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,s=new o;s.append(r),n.blob=0===s.getBlob("application/zip").size}catch(i){n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch(i){n.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){"use strict";function r(){u.call(this,"utf-8 decode"),this.leftOver=null}function i(){u.call(this,"utf-8 encode")}for(var o=e("./utils"),s=e("./support"),a=e("./nodejsUtils"),u=e("./stream/GenericWorker"),c=new Array(256),l=0;256>l;l++)c[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;c[254]=c[254]=1;var f=function(e){var t,n,r,i,o,a=e.length,u=0;for(i=0;a>i;i++)n=e.charCodeAt(i),55296===(64512&n)&&a>i+1&&(r=e.charCodeAt(i+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),u+=128>n?1:2048>n?2:65536>n?3:4;for(t=s.uint8array?new Uint8Array(u):new Array(u),o=0,i=0;u>o;i++)n=e.charCodeAt(i),55296===(64512&n)&&a>i+1&&(r=e.charCodeAt(i+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),128>n?t[o++]=n:2048>n?(t[o++]=192|n>>>6,t[o++]=128|63&n):65536>n?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},h=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n?t:0===n?t:n+c[e[n]]>t?n:t},p=function(e){var t,n,r,i,s=e.length,a=new Array(2*s);for(n=0,t=0;s>t;)if(r=e[t++],128>r)a[n++]=r;else if(i=c[r],i>4)a[n++]=65533,t+=i-1;else{for(r&=2===i?31:3===i?15:7;i>1&&s>t;)r=r<<6|63&e[t++],i--;i>1?a[n++]=65533:65536>r?a[n++]=r:(r-=65536,a[n++]=55296|r>>10&1023,a[n++]=56320|1023&r)}return a.length!==n&&(a.subarray?a=a.subarray(0,n):a.length=n),o.applyFromCharCode(a)};n.utf8encode=function(e){return s.nodebuffer?a.newBufferFrom(e,"utf-8"):f(e)},n.utf8decode=function(e){return s.nodebuffer?o.transformTo("nodebuffer",e).toString("utf-8"):(e=o.transformTo(s.uint8array?"uint8array":"array",e),p(e))},o.inherits(r,u),r.prototype.processChunk=function(e){var t=o.transformTo(s.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var r=t;t=new Uint8Array(r.length+this.leftOver.length),t.set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var i=h(t),a=t;i!==t.length&&(s.uint8array?(a=t.subarray(0,i),this.leftOver=t.subarray(i,t.length)):(a=t.slice(0,i),this.leftOver=t.slice(i,t.length))),this.push({data:n.utf8decode(a),meta:e.meta})},r.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=r,o.inherits(i,u),i.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=i},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,n){"use strict";function r(e){var t=null;return t=u.uint8array?new Uint8Array(e.length):new Array(e.length),o(e,t)}function i(e){return e}function o(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}function s(e){var t=65536,r=n.getTypeOf(e),i=!0;if("uint8array"===r?i=p.applyCanBeUsed.uint8array:"nodebuffer"===r&&(i=p.applyCanBeUsed.nodebuffer),i)for(;t>1;)try{return p.stringifyByChunk(e,r,t)}catch(o){t=Math.floor(t/2)}return p.stringifyByChar(e)}function a(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}var u=e("./support"),c=e("./base64"),l=e("./nodejsUtils"),f=e("core-js/library/fn/set-immediate"),h=e("./external");n.newBlob=function(e,t){n.checkSupport("blob");try{return new Blob([e],{type:t})}catch(r){try{var i=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,o=new i;return o.append(e),o.getBlob(t)}catch(r){throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(e,t,n){var r=[],i=0,o=e.length;if(n>=o)return String.fromCharCode.apply(null,e);for(;o>i;)r.push("array"===t||"nodebuffer"===t?String.fromCharCode.apply(null,e.slice(i,Math.min(i+n,o))):String.fromCharCode.apply(null,e.subarray(i,Math.min(i+n,o)))),i+=n;return r.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return u.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return u.nodebuffer&&1===String.fromCharCode.apply(null,l.allocBuffer(1)).length}catch(e){return!1}}()}};n.applyFromCharCode=s;var d={};d.string={string:i,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return d.string.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:function(e){return o(e,l.allocBuffer(e.length))}},d.array={string:s,array:i,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return l.newBufferFrom(e)}},d.arraybuffer={string:function(e){return s(new Uint8Array(e))},array:function(e){return a(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:i,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return l.newBufferFrom(new Uint8Array(e))}},d.uint8array={string:s,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:i,nodebuffer:function(e){return l.newBufferFrom(e)}},d.nodebuffer={string:s,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return d.nodebuffer.uint8array(e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:i},n.transformTo=function(e,t){if(t||(t=""),!e)return t;n.checkSupport(e);var r=n.getTypeOf(t),i=d[r][e](t);return i},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":u.nodebuffer&&l.isBuffer(e)?"nodebuffer":u.uint8array&&e instanceof Uint8Array?"uint8array":u.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){var t=u[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,r="";for(n=0;n<(e||"").length;n++)t=e.charCodeAt(n),r+="\\x"+(16>t?"0":"")+t.toString(16).toUpperCase();return r},n.delay=function(e,t,n){f(function(){e.apply(n||null,t||[])})},n.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},n.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&"undefined"==typeof n[t]&&(n[t]=arguments[e][t]);return n},n.prepareContent=function(e,t,i,o,s){var a=h.Promise.resolve(t).then(function(e){var t=u.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)));return t&&"undefined"!=typeof FileReader?new h.Promise(function(t,n){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=function(e){n(e.target.error)},r.readAsArrayBuffer(e)}):e});return a.then(function(t){var a=n.getTypeOf(t);return a?("arraybuffer"===a?t=n.transformTo("uint8array",t):"string"===a&&(s?t=c.decode(t):i&&o!==!0&&(t=r(t))),t):h.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(e,t){"use strict";function n(e){this.files=[],this.loadOptions=e}var r=e("./reader/readerFor"),i=e("./utils"),o=e("./signature"),s=e("./zipEntry"),a=(e("./utf8"),e("./support"));n.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var r=this.reader.readString(4),i=r===t;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",n=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,r=this.zip64EndOfCentralSize-44,i=0;r>i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)e=new s({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(0>e){var t=!this.isSignature(0,o.LOCAL_FILE_HEADER);throw new Error(t?"Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html":"Corrupted zip: can't find end of central directory")}this.reader.setIndex(e);var n=e;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),0>e)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var s=n-r;if(s>0)this.isSignature(n,o.CENTRAL_FILE_HEADER)||(this.reader.zero=s);else if(0>s)throw new Error("Corrupted zip: missing "+Math.abs(s)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=n},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t){"use strict";function n(e,t){this.options=e,this.loadOptions=t}var r=e("./reader/readerFor"),i=e("./utils"),o=e("./compressedObject"),s=e("./crc32"),a=e("./utf8"),u=e("./compressions"),c=e("./support"),l=0,f=3,h=function(e){for(var t in u)if(u.hasOwnProperty(t)&&u[t].magic===e)return u[t];return null};n.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(t=h(this.compressionMethod),null===t)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=16&this.externalFileAttributes?!0:!1,e===l&&(this.dosPermissions=63&this.externalFileAttributes),e===f&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,n,r,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<i;)t=e.readInt(2),n=e.readInt(2),r=e.readData(n),this.extraFields[t]={id:t,length:n,value:r}},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var o=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:s(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:s(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null}},t.exports=n},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t){"use strict";var n=e("./stream/StreamHelper"),r=e("./stream/DataWorker"),i=e("./utf8"),o=e("./compressedObject"),s=e("./stream/GenericWorker"),a=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};a.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");r=e.toLowerCase();var o="string"===r||"text"===r;("binarystring"===r||"text"===r)&&(r="string"),t=this._decompressWorker();var a=!this._dataBinary;a&&!o&&(t=t.pipe(new i.Utf8EncodeWorker)),!a&&o&&(t=t.pipe(new i.Utf8DecodeWorker))}catch(u){t=new s("error"),t.error(u)}return new n(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new i.Utf8EncodeWorker)),o.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof s?this._data:new r(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<u.length;l++)a.prototype[u[l]]=c;t.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t){e("../modules/web.immediate"),t.exports=e("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(e,t){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],38:[function(e,t){var n=e("./_is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":51}],39:[function(e,t){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],40:[function(e,t){var n=t.exports={version:"2.3.0"};"number"==typeof __e&&(__e=n)},{}],41:[function(e,t){var n=e("./_a-function");t.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":37}],42:[function(e,t){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(e,t){var n=e("./_is-object"),r=e("./_global").document,i=n(r)&&n(r.createElement);t.exports=function(e){return i?r.createElement(e):{}}},{"./_global":46,"./_is-object":51}],44:[function(e,t){var n=e("./_global"),r=e("./_core"),i=e("./_ctx"),o=e("./_hide"),s="prototype",a=function(e,t,u){var c,l,f,h=e&a.F,p=e&a.G,d=e&a.S,m=e&a.P,g=e&a.B,v=e&a.W,y=p?r:r[t]||(r[t]={}),b=y[s],_=p?n:d?n[t]:(n[t]||{})[s];p&&(u=t);for(c in u)l=!h&&_&&void 0!==_[c],l&&c in y||(f=l?_[c]:u[c],y[c]=p&&"function"!=typeof _[c]?u[c]:g&&l?i(f,n):v&&_[c]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[s]=e[s],t}(f):m&&"function"==typeof f?i(Function.call,f):f,m&&((y.virtual||(y.virtual={}))[c]=f,e&a.R&&b&&!b[c]&&o(b,c,f)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a
},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(e,t){t.exports=function(e){try{return!!e()}catch(t){return!0}}},{}],46:[function(e,t){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],47:[function(e,t){var n=e("./_object-dp"),r=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,i){return n.f(e,t,r(1,i))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(e,t){t.exports=e("./_global").document&&document.documentElement},{"./_global":46}],49:[function(e,t){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(e,t){t.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],51:[function(e,t){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],52:[function(e,t,n){var r=e("./_an-object"),i=e("./_ie8-dom-define"),o=e("./_to-primitive"),s=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return s(e,t,n)}catch(a){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(e,t){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],54:[function(e,t){var n,r,i,o=e("./_ctx"),s=e("./_invoke"),a=e("./_html"),u=e("./_dom-create"),c=e("./_global"),l=c.process,f=c.setImmediate,h=c.clearImmediate,p=c.MessageChannel,d=0,m={},g="onreadystatechange",v=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},y=function(e){v.call(e.data)};f&&h||(f=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return m[++d]=function(){s("function"==typeof e?e:Function(e),t)},n(d),d},h=function(e){delete m[e]},"process"==e("./_cof")(l)?n=function(e){l.nextTick(o(v,e,1))}:p?(r=new p,i=r.port2,r.port1.onmessage=y,n=o(i.postMessage,i,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(n=function(e){c.postMessage(e+"","*")},c.addEventListener("message",y,!1)):n=g in u("script")?function(e){a.appendChild(u("script"))[g]=function(){a.removeChild(this),v.call(e)}}:function(e){setTimeout(o(v,e,1),0)}),t.exports={set:f,clear:h}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(e,t){var n=e("./_is-object");t.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(e){var t=e("./_export"),n=e("./_task");t(t.G+t.B,{setImmediate:n.set,clearImmediate:n.clear})},{"./_export":44,"./_task":54}],57:[function(e,t){(function(e){"use strict";function n(){l=!0;for(var e,t,n=f.length;n;){for(t=f,f=[],e=-1;++e<n;)t[e]();n=f.length}l=!1}function r(e){1!==f.push(e)||l||i()}var i,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var s=0,a=new o(n),u=e.document.createTextNode("");a.observe(u,{characterData:!0}),i=function(){u.data=s=++s%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var c=new e.MessageChannel;c.port1.onmessage=n,i=function(){c.port2.postMessage(0)}}var l,f=[];t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(e,t){"use strict";function n(){}function r(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,e!==n&&a(this,e)}function i(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function o(e,t,n){p(function(){var r;try{r=t(n)}catch(i){return d.reject(e,i)}r===e?d.reject(e,new TypeError("Cannot resolve promise with itself")):d.resolve(e,r)})}function s(e){var t=e&&e.then;return!e||"object"!=typeof e&&"function"!=typeof e||"function"!=typeof t?void 0:function(){t.apply(e,arguments)}}function a(e,t){function n(t){o||(o=!0,d.reject(e,t))}function r(t){o||(o=!0,d.resolve(e,t))}function i(){t(r,n)}var o=!1,s=u(i);"error"===s.status&&n(s.value)}function u(e,t){var n={};try{n.value=e(t),n.status="success"}catch(r){n.status="error",n.value=r}return n}function c(e){return e instanceof this?e:d.resolve(new this(n),e)}function l(e){var t=new this(n);return d.reject(t,e)}function f(e){function t(e,t){function n(e){s[t]=e,++a!==i||o||(o=!0,d.resolve(c,s))}r.resolve(e).then(n,function(e){o||(o=!0,d.reject(c,e))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,o=!1;if(!i)return this.resolve([]);for(var s=new Array(i),a=0,u=-1,c=new this(n);++u<i;)t(e[u],u);return c}function h(e){function t(e){r.resolve(e).then(function(e){o||(o=!0,d.resolve(a,e))},function(e){o||(o=!0,d.reject(a,e))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,o=!1;if(!i)return this.resolve([]);for(var s=-1,a=new this(n);++s<i;)t(e[s]);return a}var p=e("immediate"),d={},m=["REJECTED"],g=["FULFILLED"],v=["PENDING"];t.exports=r,r.prototype["catch"]=function(e){return this.then(null,e)},r.prototype.then=function(e,t){if("function"!=typeof e&&this.state===g||"function"!=typeof t&&this.state===m)return this;var r=new this.constructor(n);if(this.state!==v){var s=this.state===g?e:t;o(r,s,this.outcome)}else this.queue.push(new i(r,e,t));return r},i.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},i.prototype.otherCallFulfilled=function(e){o(this.promise,this.onFulfilled,e)},i.prototype.callRejected=function(e){d.reject(this.promise,e)},i.prototype.otherCallRejected=function(e){o(this.promise,this.onRejected,e)},d.resolve=function(e,t){var n=u(s,t);if("error"===n.status)return d.reject(e,n.value);var r=n.value;if(r)a(e,r);else{e.state=g,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},d.reject=function(e,t){e.state=m,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},r.resolve=c,r.reject=l,r.all=f,r.race=h},{immediate:57}],59:[function(e,t){var n=e("./lib/utils/common").assign,r=e("./lib/deflate"),i=e("./lib/inflate"),o=e("./lib/zlib/constants"),s={};n(s,r,i,o),t.exports=s},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.options=u.assign({level:y,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var n=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==m)throw new Error(l[n]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"==typeof t.dictionary?c.string2buf(t.dictionary):"[object ArrayBuffer]"===h.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=a.deflateSetDictionary(this.strm,i),n!==m)throw new Error(l[n]);this._dict_set=!0}}function i(e,t){var n=new r(t);if(n.push(e,!0),n.err)throw n.msg||l[n.err];return n.result}function o(e,t){return t=t||{},t.raw=!0,i(e,t)}function s(e,t){return t=t||{},t.gzip=!0,i(e,t)}var a=e("./zlib/deflate"),u=e("./utils/common"),c=e("./utils/strings"),l=e("./zlib/messages"),f=e("./zlib/zstream"),h=Object.prototype.toString,p=0,d=4,m=0,g=1,v=2,y=-1,b=0,_=8;r.prototype.push=function(e,t){var n,r,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:t===!0?d:p,i.input="string"==typeof e?c.string2buf(e):"[object ArrayBuffer]"===h.call(e)?new Uint8Array(e):e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new u.Buf8(o),i.next_out=0,i.avail_out=o),n=a.deflate(i,r),n!==g&&n!==m)return this.onEnd(n),this.ended=!0,!1;(0===i.avail_out||0===i.avail_in&&(r===d||r===v))&&this.onData("string"===this.options.to?c.buf2binstring(u.shrinkBuf(i.output,i.next_out)):u.shrinkBuf(i.output,i.next_out))}while((i.avail_in>0||0===i.avail_out)&&n!==g);return r===d?(n=a.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===m):r===v?(this.onEnd(m),i.avail_out=0,!0):!0},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===m&&(this.result="string"===this.options.to?this.chunks.join(""):u.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=r,n.deflate=i,n.deflateRaw=o,n.gzip=s},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var n=s.inflateInit2(this.strm,t.windowBits);if(n!==c.Z_OK)throw new Error(l[n]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function i(e,t){var n=new r(t);if(n.push(e,!0),n.err)throw n.msg||l[n.err];return n.result}function o(e,t){return t=t||{},t.raw=!0,i(e,t)}var s=e("./zlib/inflate"),a=e("./utils/common"),u=e("./utils/strings"),c=e("./zlib/constants"),l=e("./zlib/messages"),f=e("./zlib/zstream"),h=e("./zlib/gzheader"),p=Object.prototype.toString;r.prototype.push=function(e,t){var n,r,i,o,l,f,h=this.strm,d=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;r=t===~~t?t:t===!0?c.Z_FINISH:c.Z_NO_FLUSH,h.input="string"==typeof e?u.binstring2buf(e):"[object ArrayBuffer]"===p.call(e)?new Uint8Array(e):e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(d),h.next_out=0,h.avail_out=d),n=s.inflate(h,c.Z_NO_FLUSH),n===c.Z_NEED_DICT&&m&&(f="string"==typeof m?u.string2buf(m):"[object ArrayBuffer]"===p.call(m)?new Uint8Array(m):m,n=s.inflateSetDictionary(this.strm,f)),n===c.Z_BUF_ERROR&&g===!0&&(n=c.Z_OK,g=!1),n!==c.Z_STREAM_END&&n!==c.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0===h.avail_out||n===c.Z_STREAM_END||0===h.avail_in&&(r===c.Z_FINISH||r===c.Z_SYNC_FLUSH))&&("string"===this.options.to?(i=u.utf8border(h.output,h.next_out),o=h.next_out-i,l=u.buf2string(h.output,i),h.next_out=o,h.avail_out=d-o,o&&a.arraySet(h.output,h.output,i,o,0),this.onData(l)):this.onData(a.shrinkBuf(h.output,h.next_out))),0===h.avail_in&&0===h.avail_out&&(g=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==c.Z_STREAM_END);return n===c.Z_STREAM_END&&(r=c.Z_FINISH),r===c.Z_FINISH?(n=s.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c.Z_OK):r===c.Z_SYNC_FLUSH?(this.onEnd(c.Z_OK),h.avail_out=0,!0):!0},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===c.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=r,n.inflate=i,n.inflateRaw=o,n.ungzip=i},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)return void e.set(t.subarray(n,n+r),i);for(var o=0;r>o;o++)e[i+o]=t[n+o]},flattenChunks:function(e){var t,n,r,i,o,s;for(r=0,t=0,n=e.length;n>t;t++)r+=e[t].length;for(s=new Uint8Array(r),i=0,t=0,n=e.length;n>t;t++)o=e[t],s.set(o,i),i+=o.length;return s}},o={arraySet:function(e,t,n,r,i){for(var o=0;r>o;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(r)},{}],63:[function(e,t,n){function r(e,t){if(65537>t&&(e.subarray&&s||!e.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",r=0;t>r;r++)n+=String.fromCharCode(e[r]);return n}var i=e("./common"),o=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(a){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){s=!1}for(var u=new i.Buf8(256),c=0;256>c;c++)u[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;u[254]=u[254]=1,n.string2buf=function(e){var t,n,r,o,s,a=e.length,u=0;for(o=0;a>o;o++)n=e.charCodeAt(o),55296===(64512&n)&&a>o+1&&(r=e.charCodeAt(o+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),o++)),u+=128>n?1:2048>n?2:65536>n?3:4;for(t=new i.Buf8(u),s=0,o=0;u>s;o++)n=e.charCodeAt(o),55296===(64512&n)&&a>o+1&&(r=e.charCodeAt(o+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),o++)),128>n?t[s++]=n:2048>n?(t[s++]=192|n>>>6,t[s++]=128|63&n):65536>n?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},n.buf2binstring=function(e){return r(e,e.length)},n.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;r>n;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,o,s,a=t||e.length,c=new Array(2*a);for(i=0,n=0;a>n;)if(o=e[n++],128>o)c[i++]=o;else if(s=u[o],s>4)c[i++]=65533,n+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&a>n;)o=o<<6|63&e[n++],s--;s>1?c[i++]=65533:65536>o?c[i++]=o:(o-=65536,c[i++]=55296|o>>10&1023,c[i++]=56320|1023&o)}return r(c,i)},n.utf8border=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n?t:0===n?t:n+u[e[n]]>t?n:t}},{"./common":62}],64:[function(e,t){"use strict";function n(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,s=0;0!==n;){s=n>2e3?2e3:n,n-=s;do i=i+t[r++]|0,o=o+i|0;while(--s);i%=65521,o%=65521}return i|o<<16|0}t.exports=n},{}],65:[function(e,t){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(e,t){"use strict";function n(){for(var e,t=[],n=0;256>n;n++){e=n;for(var r=0;8>r;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function r(e,t,n,r){var o=i,s=r+n;e^=-1;for(var a=r;s>a;a++)e=e>>>8^o[255&(e^t[a])];return-1^e}var i=n();t.exports=r},{}],67:[function(e,t,n){"use strict";function r(e,t){return e.msg=I[t],t}function i(e){return(e<<1)-(e>4?9:0)}function o(e){for(var t=e.length;--t>=0;)e[t]=0}function s(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(D.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function a(e,t){M._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,s(e.strm)}function u(e,t){e.pending_buf[e.pending++]=t}function c(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function l(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,D.arraySet(t,e.input,e.next_in,i,n),1===e.state.wrap?e.adler=B(e.adler,t,i,n):2===e.state.wrap&&(e.adler=N(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)}function f(e,t){var n,r,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match,u=e.strstart>e.w_size-ft?e.strstart-(e.w_size-ft):0,c=e.window,l=e.w_mask,f=e.prev,h=e.strstart+lt,p=c[o+s-1],d=c[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do if(n=t,c[n+s]===d&&c[n+s-1]===p&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do;while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&h>o);if(r=lt-(h-o),o=h-lt,r>s){if(e.match_start=t,s=r,r>=a)break;p=c[o+s-1],d=c[o+s]}}while((t=f[t&l])>u&&0!==--i);return s<=e.lookahead?s:e.lookahead}function h(e){var t,n,r,i,o,s=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-ft)){D.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,n=e.hash_size,t=n;do r=e.head[--t],e.head[t]=r>=s?r-s:0;while(--n);n=s,t=n;do r=e.prev[--t],e.prev[t]=r>=s?r-s:0;while(--n);i+=s}if(0===e.strm.avail_in)break;if(n=l(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=ct)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+ct-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<ct)););}while(e.lookahead<ft&&0!==e.strm.avail_in)}function p(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(h(e),0===e.lookahead&&t===O)return _t;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,a(e,!1),0===e.strm.avail_out))return _t;if(e.strstart-e.block_start>=e.w_size-ft&&(a(e,!1),0===e.strm.avail_out))return _t}return e.insert=0,t===F?(a(e,!0),0===e.strm.avail_out?xt:St):e.strstart>e.block_start&&(a(e,!1),0===e.strm.avail_out)?_t:_t}function d(e,t){for(var n,r;;){if(e.lookahead<ft){if(h(e),e.lookahead<ft&&t===O)return _t;if(0===e.lookahead)break}if(n=0,e.lookahead>=ct&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ct-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ft&&(e.match_length=f(e,n)),e.match_length>=ct)if(r=M._tr_tally(e,e.strstart-e.match_start,e.match_length-ct),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ct){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ct-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=M._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(a(e,!1),0===e.strm.avail_out))return _t}return e.insert=e.strstart<ct-1?e.strstart:ct-1,t===F?(a(e,!0),0===e.strm.avail_out?xt:St):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?_t:wt}function m(e,t){for(var n,r,i;;){if(e.lookahead<ft){if(h(e),e.lookahead<ft&&t===O)return _t;if(0===e.lookahead)break}if(n=0,e.lookahead>=ct&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ct-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ct-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ft&&(e.match_length=f(e,n),e.match_length<=5&&(e.strategy===$||e.match_length===ct&&e.strstart-e.match_start>4096)&&(e.match_length=ct-1)),e.prev_length>=ct&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-ct,r=M._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ct),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ct-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!==--e.prev_length);if(e.match_available=0,e.match_length=ct-1,e.strstart++,r&&(a(e,!1),0===e.strm.avail_out))return _t}else if(e.match_available){if(r=M._tr_tally(e,0,e.window[e.strstart-1]),r&&a(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return _t}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=M._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ct-1?e.strstart:ct-1,t===F?(a(e,!0),0===e.strm.avail_out?xt:St):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?_t:wt}function g(e,t){for(var n,r,i,o,s=e.window;;){if(e.lookahead<=lt){if(h(e),e.lookahead<=lt&&t===O)return _t;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=ct&&e.strstart>0&&(i=e.strstart-1,r=s[i],r===s[++i]&&r===s[++i]&&r===s[++i])){o=e.strstart+lt;do;while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&o>i);e.match_length=lt-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ct?(n=M._tr_tally(e,1,e.match_length-ct),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=M._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(a(e,!1),0===e.strm.avail_out))return _t}return e.insert=0,t===F?(a(e,!0),0===e.strm.avail_out?xt:St):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?_t:wt}function v(e,t){for(var n;;){if(0===e.lookahead&&(h(e),0===e.lookahead)){if(t===O)return _t;break}if(e.match_length=0,n=M._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(a(e,!1),0===e.strm.avail_out))return _t}return e.insert=0,t===F?(a(e,!0),0===e.strm.avail_out?xt:St):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?_t:wt}function y(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function b(e){e.window_size=2*e.w_size,o(e.head),e.max_lazy_match=P[e.level].max_lazy,e.good_match=P[e.level].good_length,e.nice_match=P[e.level].nice_length,e.max_chain_length=P[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ct-1,e.match_available=0,e.ins_h=0}function _(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new D.Buf16(2*at),this.dyn_dtree=new D.Buf16(2*(2*ot+1)),this.bl_tree=new D.Buf16(2*(2*st+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new D.Buf16(ut+1),this.heap=new D.Buf16(2*it+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new D.Buf16(2*it+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=X,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?pt:yt,e.adler=2===t.wrap?0:1,t.last_flush=O,M._tr_init(t),z):r(e,G)}function x(e){var t=w(e);return t===z&&b(e.state),t}function S(e,t){return e&&e.state?2!==e.state.wrap?G:(e.state.gzhead=t,z):G}function T(e,t,n,i,o,s){if(!e)return G;var a=1;if(t===q&&(t=6),0>i?(a=0,i=-i):i>15&&(a=2,i-=16),1>o||o>Q||n!==Y||8>i||i>15||0>t||t>9||0>s||s>J)return r(e,G);8===i&&(i=9);var u=new _;return e.state=u,u.strm=e,u.wrap=a,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+ct-1)/ct),u.window=new D.Buf8(2*u.w_size),u.head=new D.Buf16(u.hash_size),u.prev=new D.Buf16(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new D.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=s,u.method=n,x(e)}function A(e,t){return T(e,t,Y,et,tt,K)}function E(e,t){var n,a,l,f;if(!e||!e.state||t>j||0>t)return e?r(e,G):G;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||a.status===bt&&t!==F)return r(e,0===e.avail_out?V:G);if(a.strm=e,n=a.last_flush,a.last_flush=t,a.status===pt)if(2===a.wrap)e.adler=0,u(a,31),u(a,139),u(a,8),a.gzhead?(u(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),u(a,255&a.gzhead.time),u(a,a.gzhead.time>>8&255),u(a,a.gzhead.time>>16&255),u(a,a.gzhead.time>>24&255),u(a,9===a.level?2:a.strategy>=Z||a.level<2?4:0),u(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(u(a,255&a.gzhead.extra.length),u(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=N(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=dt):(u(a,0),u(a,0),u(a,0),u(a,0),u(a,0),u(a,9===a.level?2:a.strategy>=Z||a.level<2?4:0),u(a,Tt),a.status=yt);else{var h=Y+(a.w_bits-8<<4)<<8,p=-1;p=a.strategy>=Z||a.level<2?0:a.level<6?1:6===a.level?2:3,h|=p<<6,0!==a.strstart&&(h|=ht),h+=31-h%31,a.status=yt,c(a,h),0!==a.strstart&&(c(a,e.adler>>>16),c(a,65535&e.adler)),e.adler=1}if(a.status===dt)if(a.gzhead.extra){for(l=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>l&&(e.adler=N(e.adler,a.pending_buf,a.pending-l,l)),s(e),l=a.pending,a.pending!==a.pending_buf_size));)u(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>l&&(e.adler=N(e.adler,a.pending_buf,a.pending-l,l)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=mt)}else a.status=mt;if(a.status===mt)if(a.gzhead.name){l=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>l&&(e.adler=N(e.adler,a.pending_buf,a.pending-l,l)),s(e),l=a.pending,a.pending===a.pending_buf_size)){f=1;break}f=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,u(a,f)}while(0!==f);a.gzhead.hcrc&&a.pending>l&&(e.adler=N(e.adler,a.pending_buf,a.pending-l,l)),0===f&&(a.gzindex=0,a.status=gt)}else a.status=gt;if(a.status===gt)if(a.gzhead.comment){l=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>l&&(e.adler=N(e.adler,a.pending_buf,a.pending-l,l)),s(e),l=a.pending,a.pending===a.pending_buf_size)){f=1;break}f=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,u(a,f)}while(0!==f);a.gzhead.hcrc&&a.pending>l&&(e.adler=N(e.adler,a.pending_buf,a.pending-l,l)),0===f&&(a.status=vt)}else a.status=vt;if(a.status===vt&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&s(e),a.pending+2<=a.pending_buf_size&&(u(a,255&e.adler),u(a,e.adler>>8&255),e.adler=0,a.status=yt)):a.status=yt),0!==a.pending){if(s(e),0===e.avail_out)return a.last_flush=-1,z}else if(0===e.avail_in&&i(t)<=i(n)&&t!==F)return r(e,V);if(a.status===bt&&0!==e.avail_in)return r(e,V);if(0!==e.avail_in||0!==a.lookahead||t!==O&&a.status!==bt){var d=a.strategy===Z?v(a,t):a.strategy===H?g(a,t):P[a.level].func(a,t);if((d===xt||d===St)&&(a.status=bt),d===_t||d===xt)return 0===e.avail_out&&(a.last_flush=-1),z;if(d===wt&&(t===L?M._tr_align(a):t!==j&&(M._tr_stored_block(a,0,0,!1),t===R&&(o(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),s(e),0===e.avail_out))return a.last_flush=-1,z}return t!==F?z:a.wrap<=0?U:(2===a.wrap?(u(a,255&e.adler),u(a,e.adler>>8&255),u(a,e.adler>>16&255),u(a,e.adler>>24&255),u(a,255&e.total_in),u(a,e.total_in>>8&255),u(a,e.total_in>>16&255),u(a,e.total_in>>24&255)):(c(a,e.adler>>>16),c(a,65535&e.adler)),s(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?z:U)}function k(e){var t;return e&&e.state?(t=e.state.status,t!==pt&&t!==dt&&t!==mt&&t!==gt&&t!==vt&&t!==yt&&t!==bt?r(e,G):(e.state=null,t===yt?r(e,W):z)):G}function C(e,t){var n,r,i,s,a,u,c,l,f=t.length;if(!e||!e.state)return G;if(n=e.state,s=n.wrap,2===s||1===s&&n.status!==pt||n.lookahead)return G;for(1===s&&(e.adler=B(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(o(n.head),n.strstart=0,n.block_start=0,n.insert=0),l=new D.Buf8(n.w_size),D.arraySet(l,t,f-n.w_size,n.w_size,0),t=l,f=n.w_size),a=e.avail_in,u=e.next_in,c=e.input,e.avail_in=f,e.next_in=0,e.input=t,h(n);n.lookahead>=ct;){r=n.strstart,i=n.lookahead-(ct-1);do n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+ct-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++;while(--i);n.strstart=r,n.lookahead=ct-1,h(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=ct-1,n.match_available=0,e.next_in=u,e.input=c,e.avail_in=a,n.wrap=s,z}var P,D=e("../utils/common"),M=e("./trees"),B=e("./adler32"),N=e("./crc32"),I=e("./messages"),O=0,L=1,R=3,F=4,j=5,z=0,U=1,G=-2,W=-3,V=-5,q=-1,$=1,Z=2,H=3,J=4,K=0,X=2,Y=8,Q=9,et=15,tt=8,nt=29,rt=256,it=rt+1+nt,ot=30,st=19,at=2*it+1,ut=15,ct=3,lt=258,ft=lt+ct+1,ht=32,pt=42,dt=69,mt=73,gt=91,vt=103,yt=113,bt=666,_t=1,wt=2,xt=3,St=4,Tt=3;P=[new y(0,0,0,0,p),new y(4,4,8,4,d),new y(4,5,16,8,d),new y(4,6,32,32,d),new y(4,4,16,16,m),new y(8,16,32,32,m),new y(8,16,128,128,m),new y(8,32,128,256,m),new y(32,128,258,1024,m),new y(32,258,258,4096,m)],n.deflateInit=A,n.deflateInit2=T,n.deflateReset=x,n.deflateResetKeep=w,n.deflateSetHeader=S,n.deflate=E,n.deflateEnd=k,n.deflateSetDictionary=C,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(e,t){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=n},{}],69:[function(e,t){"use strict";var n=30,r=12;t.exports=function(e,t){var i,o,s,a,u,c,l,f,h,p,d,m,g,v,y,b,_,w,x,S,T,A,E,k,C;i=e.state,o=e.next_in,k=e.input,s=o+(e.avail_in-5),a=e.next_out,C=e.output,u=a-(t-e.avail_out),c=a+(e.avail_out-257),l=i.dmax,f=i.wsize,h=i.whave,p=i.wnext,d=i.window,m=i.hold,g=i.bits,v=i.lencode,y=i.distcode,b=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;e:do{15>g&&(m+=k[o++]<<g,g+=8,m+=k[o++]<<g,g+=8),w=v[m&b];t:for(;;){if(x=w>>>24,m>>>=x,g-=x,x=w>>>16&255,0===x)C[a++]=65535&w;else{if(!(16&x)){if(0===(64&x)){w=v[(65535&w)+(m&(1<<x)-1)];continue t}if(32&x){i.mode=r;break e}e.msg="invalid literal/length code",i.mode=n;break e}S=65535&w,x&=15,x&&(x>g&&(m+=k[o++]<<g,g+=8),S+=m&(1<<x)-1,m>>>=x,g-=x),15>g&&(m+=k[o++]<<g,g+=8,m+=k[o++]<<g,g+=8),w=y[m&_];n:for(;;){if(x=w>>>24,m>>>=x,g-=x,x=w>>>16&255,!(16&x)){if(0===(64&x)){w=y[(65535&w)+(m&(1<<x)-1)];continue n}e.msg="invalid distance code",i.mode=n;break e}if(T=65535&w,x&=15,x>g&&(m+=k[o++]<<g,g+=8,x>g&&(m+=k[o++]<<g,g+=8)),T+=m&(1<<x)-1,T>l){e.msg="invalid distance too far back",i.mode=n;
break e}if(m>>>=x,g-=x,x=a-u,T>x){if(x=T-x,x>h&&i.sane){e.msg="invalid distance too far back",i.mode=n;break e}if(A=0,E=d,0===p){if(A+=f-x,S>x){S-=x;do C[a++]=d[A++];while(--x);A=a-T,E=C}}else if(x>p){if(A+=f+p-x,x-=p,S>x){S-=x;do C[a++]=d[A++];while(--x);if(A=0,S>p){x=p,S-=x;do C[a++]=d[A++];while(--x);A=a-T,E=C}}}else if(A+=p-x,S>x){S-=x;do C[a++]=d[A++];while(--x);A=a-T,E=C}for(;S>2;)C[a++]=E[A++],C[a++]=E[A++],C[a++]=E[A++],S-=3;S&&(C[a++]=E[A++],S>1&&(C[a++]=E[A++]))}else{A=a-T;do C[a++]=C[A++],C[a++]=C[A++],C[a++]=C[A++],S-=3;while(S>2);S&&(C[a++]=C[A++],S>1&&(C[a++]=C[A++]))}break}}break}}while(s>o&&c>a);S=g>>3,o-=S,g-=S<<3,m&=(1<<g)-1,e.next_in=o,e.next_out=a,e.avail_in=s>o?5+(s-o):5-(o-s),e.avail_out=c>a?257+(c-a):257-(a-c),i.hold=m,i.bits=g}},{}],70:[function(e,t,n){"use strict";function r(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new y.Buf16(320),this.work=new y.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=R,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new y.Buf32(mt),t.distcode=t.distdyn=new y.Buf32(gt),t.sane=1,t.back=-1,P):B}function s(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,o(e)):B}function a(e,t){var n,r;return e&&e.state?(r=e.state,0>t?(n=0,t=-t):(n=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||t>15)?B:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,s(e))):B}function u(e,t){var n,r;return e?(r=new i,e.state=r,r.window=null,n=a(e,t),n!==P&&(e.state=null),n):B}function c(e){return u(e,yt)}function l(e){if(bt){var t;for(g=new y.Buf32(512),v=new y.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(x(T,e.lens,0,288,g,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;x(A,e.lens,0,32,v,0,e.work,{bits:5}),bt=!1}e.lencode=g,e.lenbits=9,e.distcode=v,e.distbits=5}function f(e,t,n,r){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new y.Buf8(o.wsize)),r>=o.wsize?(y.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>r&&(i=r),y.arraySet(o.window,t,n-r,i,o.wnext),r-=i,r?(y.arraySet(o.window,t,n-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}function h(e,t){var n,i,o,s,a,u,c,h,p,d,m,g,v,mt,gt,vt,yt,bt,_t,wt,xt,St,Tt,At,Et=0,kt=new y.Buf8(4),Ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return B;n=e.state,n.mode===H&&(n.mode=J),a=e.next_out,o=e.output,c=e.avail_out,s=e.next_in,i=e.input,u=e.avail_in,h=n.hold,p=n.bits,d=u,m=c,St=P;e:for(;;)switch(n.mode){case R:if(0===n.wrap){n.mode=J;break}for(;16>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}if(2&n.wrap&&35615===h){n.check=0,kt[0]=255&h,kt[1]=h>>>8&255,n.check=_(n.check,kt,2,0),h=0,p=0,n.mode=F;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",n.mode=ht;break}if((15&h)!==L){e.msg="unknown compression method",n.mode=ht;break}if(h>>>=4,p-=4,xt=(15&h)+8,0===n.wbits)n.wbits=xt;else if(xt>n.wbits){e.msg="invalid window size",n.mode=ht;break}n.dmax=1<<xt,e.adler=n.check=1,n.mode=512&h?$:H,h=0,p=0;break;case F:for(;16>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}if(n.flags=h,(255&n.flags)!==L){e.msg="unknown compression method",n.mode=ht;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=ht;break}n.head&&(n.head.text=h>>8&1),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,n.check=_(n.check,kt,2,0)),h=0,p=0,n.mode=j;case j:for(;32>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}n.head&&(n.head.time=h),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,kt[2]=h>>>16&255,kt[3]=h>>>24&255,n.check=_(n.check,kt,4,0)),h=0,p=0,n.mode=z;case z:for(;16>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,n.check=_(n.check,kt,2,0)),h=0,p=0,n.mode=U;case U:if(1024&n.flags){for(;16>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&n.flags&&(kt[0]=255&h,kt[1]=h>>>8&255,n.check=_(n.check,kt,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=G;case G:if(1024&n.flags&&(g=n.length,g>u&&(g=u),g&&(n.head&&(xt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),y.arraySet(n.head.extra,i,s,g,xt)),512&n.flags&&(n.check=_(n.check,i,g,s)),u-=g,s+=g,n.length-=g),n.length))break e;n.length=0,n.mode=W;case W:if(2048&n.flags){if(0===u)break e;g=0;do xt=i[s+g++],n.head&&xt&&n.length<65536&&(n.head.name+=String.fromCharCode(xt));while(xt&&u>g);if(512&n.flags&&(n.check=_(n.check,i,g,s)),u-=g,s+=g,xt)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=V;case V:if(4096&n.flags){if(0===u)break e;g=0;do xt=i[s+g++],n.head&&xt&&n.length<65536&&(n.head.comment+=String.fromCharCode(xt));while(xt&&u>g);if(512&n.flags&&(n.check=_(n.check,i,g,s)),u-=g,s+=g,xt)break e}else n.head&&(n.head.comment=null);n.mode=q;case q:if(512&n.flags){for(;16>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}if(h!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ht;break}h=0,p=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=H;break;case $:for(;32>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}e.adler=n.check=r(h),h=0,p=0,n.mode=Z;case Z:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=u,n.hold=h,n.bits=p,M;e.adler=n.check=1,n.mode=H;case H:if(t===k||t===C)break e;case J:if(n.last){h>>>=7&p,p-=7&p,n.mode=ct;break}for(;3>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=K;break;case 1:if(l(n),n.mode=nt,t===C){h>>>=2,p-=2;break e}break;case 2:n.mode=Q;break;case 3:e.msg="invalid block type",n.mode=ht}h>>>=2,p-=2;break;case K:for(h>>>=7&p,p-=7&p;32>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}if((65535&h)!==(h>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ht;break}if(n.length=65535&h,h=0,p=0,n.mode=X,t===C)break e;case X:n.mode=Y;case Y:if(g=n.length){if(g>u&&(g=u),g>c&&(g=c),0===g)break e;y.arraySet(o,i,s,g,a),u-=g,s+=g,c-=g,a+=g,n.length-=g;break}n.mode=H;break;case Q:for(;14>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}if(n.nlen=(31&h)+257,h>>>=5,p-=5,n.ndist=(31&h)+1,h>>>=5,p-=5,n.ncode=(15&h)+4,h>>>=4,p-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ht;break}n.have=0,n.mode=et;case et:for(;n.have<n.ncode;){for(;3>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}n.lens[Ct[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[Ct[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Tt={bits:n.lenbits},St=x(S,n.lens,0,19,n.lencode,0,n.work,Tt),n.lenbits=Tt.bits,St){e.msg="invalid code lengths set",n.mode=ht;break}n.have=0,n.mode=tt;case tt:for(;n.have<n.nlen+n.ndist;){for(;Et=n.lencode[h&(1<<n.lenbits)-1],gt=Et>>>24,vt=Et>>>16&255,yt=65535&Et,!(p>=gt);){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}if(16>yt)h>>>=gt,p-=gt,n.lens[n.have++]=yt;else{if(16===yt){for(At=gt+2;At>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}if(h>>>=gt,p-=gt,0===n.have){e.msg="invalid bit length repeat",n.mode=ht;break}xt=n.lens[n.have-1],g=3+(3&h),h>>>=2,p-=2}else if(17===yt){for(At=gt+3;At>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}h>>>=gt,p-=gt,xt=0,g=3+(7&h),h>>>=3,p-=3}else{for(At=gt+7;At>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}h>>>=gt,p-=gt,xt=0,g=11+(127&h),h>>>=7,p-=7}if(n.have+g>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ht;break}for(;g--;)n.lens[n.have++]=xt}}if(n.mode===ht)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=ht;break}if(n.lenbits=9,Tt={bits:n.lenbits},St=x(T,n.lens,0,n.nlen,n.lencode,0,n.work,Tt),n.lenbits=Tt.bits,St){e.msg="invalid literal/lengths set",n.mode=ht;break}if(n.distbits=6,n.distcode=n.distdyn,Tt={bits:n.distbits},St=x(A,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Tt),n.distbits=Tt.bits,St){e.msg="invalid distances set",n.mode=ht;break}if(n.mode=nt,t===C)break e;case nt:n.mode=rt;case rt:if(u>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=u,n.hold=h,n.bits=p,w(e,m),a=e.next_out,o=e.output,c=e.avail_out,s=e.next_in,i=e.input,u=e.avail_in,h=n.hold,p=n.bits,n.mode===H&&(n.back=-1);break}for(n.back=0;Et=n.lencode[h&(1<<n.lenbits)-1],gt=Et>>>24,vt=Et>>>16&255,yt=65535&Et,!(p>=gt);){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}if(vt&&0===(240&vt)){for(bt=gt,_t=vt,wt=yt;Et=n.lencode[wt+((h&(1<<bt+_t)-1)>>bt)],gt=Et>>>24,vt=Et>>>16&255,yt=65535&Et,!(p>=bt+gt);){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}h>>>=bt,p-=bt,n.back+=bt}if(h>>>=gt,p-=gt,n.back+=gt,n.length=yt,0===vt){n.mode=ut;break}if(32&vt){n.back=-1,n.mode=H;break}if(64&vt){e.msg="invalid literal/length code",n.mode=ht;break}n.extra=15&vt,n.mode=it;case it:if(n.extra){for(At=n.extra;At>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=ot;case ot:for(;Et=n.distcode[h&(1<<n.distbits)-1],gt=Et>>>24,vt=Et>>>16&255,yt=65535&Et,!(p>=gt);){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}if(0===(240&vt)){for(bt=gt,_t=vt,wt=yt;Et=n.distcode[wt+((h&(1<<bt+_t)-1)>>bt)],gt=Et>>>24,vt=Et>>>16&255,yt=65535&Et,!(p>=bt+gt);){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}h>>>=bt,p-=bt,n.back+=bt}if(h>>>=gt,p-=gt,n.back+=gt,64&vt){e.msg="invalid distance code",n.mode=ht;break}n.offset=yt,n.extra=15&vt,n.mode=st;case st:if(n.extra){for(At=n.extra;At>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ht;break}n.mode=at;case at:if(0===c)break e;if(g=m-c,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ht;break}g>n.wnext?(g-=n.wnext,v=n.wsize-g):v=n.wnext-g,g>n.length&&(g=n.length),mt=n.window}else mt=o,v=a-n.offset,g=n.length;g>c&&(g=c),c-=g,n.length-=g;do o[a++]=mt[v++];while(--g);0===n.length&&(n.mode=rt);break;case ut:if(0===c)break e;o[a++]=n.length,c--,n.mode=rt;break;case ct:if(n.wrap){for(;32>p;){if(0===u)break e;u--,h|=i[s++]<<p,p+=8}if(m-=c,e.total_out+=m,n.total+=m,m&&(e.adler=n.check=n.flags?_(n.check,o,m,a-m):b(n.check,o,m,a-m)),m=c,(n.flags?h:r(h))!==n.check){e.msg="incorrect data check",n.mode=ht;break}h=0,p=0}n.mode=lt;case lt:if(n.wrap&&n.flags){for(;32>p;){if(0===u)break e;u--,h+=i[s++]<<p,p+=8}if(h!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ht;break}h=0,p=0}n.mode=ft;case ft:St=D;break e;case ht:St=N;break e;case pt:return I;case dt:default:return B}return e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=u,n.hold=h,n.bits=p,(n.wsize||m!==e.avail_out&&n.mode<ht&&(n.mode<ct||t!==E))&&f(e,e.output,e.next_out,m-e.avail_out)?(n.mode=pt,I):(d-=e.avail_in,m-=e.avail_out,e.total_in+=d,e.total_out+=m,n.total+=m,n.wrap&&m&&(e.adler=n.check=n.flags?_(n.check,o,m,e.next_out-m):b(n.check,o,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===H?128:0)+(n.mode===nt||n.mode===X?256:0),(0===d&&0===m||t===E)&&St===P&&(St=O),St)}function p(e){if(!e||!e.state)return B;var t=e.state;return t.window&&(t.window=null),e.state=null,P}function d(e,t){var n;return e&&e.state?(n=e.state,0===(2&n.wrap)?B:(n.head=t,t.done=!1,P)):B}function m(e,t){var n,r,i,o=t.length;return e&&e.state?(n=e.state,0!==n.wrap&&n.mode!==Z?B:n.mode===Z&&(r=1,r=b(r,t,o,0),r!==n.check)?N:(i=f(e,t,o,o))?(n.mode=pt,I):(n.havedict=1,P)):B}var g,v,y=e("../utils/common"),b=e("./adler32"),_=e("./crc32"),w=e("./inffast"),x=e("./inftrees"),S=0,T=1,A=2,E=4,k=5,C=6,P=0,D=1,M=2,B=-2,N=-3,I=-4,O=-5,L=8,R=1,F=2,j=3,z=4,U=5,G=6,W=7,V=8,q=9,$=10,Z=11,H=12,J=13,K=14,X=15,Y=16,Q=17,et=18,tt=19,nt=20,rt=21,it=22,ot=23,st=24,at=25,ut=26,ct=27,lt=28,ft=29,ht=30,pt=31,dt=32,mt=852,gt=592,vt=15,yt=vt,bt=!0;n.inflateReset=s,n.inflateReset2=a,n.inflateResetKeep=o,n.inflateInit=c,n.inflateInit2=u,n.inflate=h,n.inflateEnd=p,n.inflateGetHeader=d,n.inflateSetDictionary=m,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(e,t){"use strict";var n=e("../utils/common"),r=15,i=852,o=592,s=0,a=1,u=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,p,d,m,g,v,y){var b,_,w,x,S,T,A,E,k,C=y.bits,P=0,D=0,M=0,B=0,N=0,I=0,O=0,L=0,R=0,F=0,j=null,z=0,U=new n.Buf16(r+1),G=new n.Buf16(r+1),W=null,V=0;for(P=0;r>=P;P++)U[P]=0;for(D=0;d>D;D++)U[t[p+D]]++;for(N=C,B=r;B>=1&&0===U[B];B--);if(N>B&&(N=B),0===B)return m[g++]=20971520,m[g++]=20971520,y.bits=1,0;for(M=1;B>M&&0===U[M];M++);for(M>N&&(N=M),L=1,P=1;r>=P;P++)if(L<<=1,L-=U[P],0>L)return-1;if(L>0&&(e===s||1!==B))return-1;for(G[1]=0,P=1;r>P;P++)G[P+1]=G[P]+U[P];for(D=0;d>D;D++)0!==t[p+D]&&(v[G[t[p+D]]++]=D);if(e===s?(j=W=v,T=19):e===a?(j=c,z-=257,W=l,V-=257,T=256):(j=f,W=h,T=-1),F=0,D=0,P=M,S=g,I=N,O=0,w=-1,R=1<<N,x=R-1,e===a&&R>i||e===u&&R>o)return 1;for(;;){A=P-O,v[D]<T?(E=0,k=v[D]):v[D]>T?(E=W[V+v[D]],k=j[z+v[D]]):(E=96,k=0),b=1<<P-O,_=1<<I,M=_;do _-=b,m[S+(F>>O)+_]=A<<24|E<<16|k|0;while(0!==_);for(b=1<<P-1;F&b;)b>>=1;if(0!==b?(F&=b-1,F+=b):F=0,D++,0===--U[P]){if(P===B)break;P=t[p+v[D]]}if(P>N&&(F&x)!==w){for(0===O&&(O=N),S+=M,I=P-O,L=1<<I;B>I+O&&(L-=U[I+O],!(0>=L));)I++,L<<=1;if(R+=1<<I,e===a&&R>i||e===u&&R>o)return 1;w=F&x,m[w]=N<<24|I<<16|S-g|0}}return 0!==F&&(m[S+F]=P-O<<24|64<<16|0),y.bits=N,0}},{"../utils/common":62}],72:[function(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(e,t,n){"use strict";function r(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function o(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function s(e){return 256>e?ut[e]:ut[256+(e>>>7)]}function a(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function u(e,t,n){e.bi_valid>J-n?(e.bi_buf|=t<<e.bi_valid&65535,a(e,e.bi_buf),e.bi_buf=t>>J-e.bi_valid,e.bi_valid+=n-J):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function c(e,t,n){u(e,n[2*t],n[2*t+1])}function l(e,t){var n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1}function f(e){16===e.bi_valid?(a(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function h(e,t){var n,r,i,o,s,a,u=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,d=t.stat_desc.max_length,m=0;for(o=0;H>=o;o++)e.bl_count[o]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;Z>n;n++)r=e.heap[n],o=u[2*u[2*r+1]+1]+1,o>d&&(o=d,m++),u[2*r+1]=o,r>c||(e.bl_count[o]++,s=0,r>=p&&(s=h[r-p]),a=u[2*r],e.opt_len+=a*(o+s),f&&(e.static_len+=a*(l[2*r+1]+s)));if(0!==m){do{for(o=d-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[d]--,m-=2}while(m>0);for(o=d;0!==o;o--)for(r=e.bl_count[o];0!==r;)i=e.heap[--n],i>c||(u[2*i+1]!==o&&(e.opt_len+=(o-u[2*i+1])*u[2*i],u[2*i+1]=o),r--)}}function p(e,t,n){var r,i,o=new Array(H+1),s=0;for(r=1;H>=r;r++)o[r]=s=s+n[r-1]<<1;for(i=0;t>=i;i++){var a=e[2*i+1];0!==a&&(e[2*i]=l(o[a]++,a))}}function d(){var e,t,n,r,o,s=new Array(H+1);for(n=0,r=0;G-1>r;r++)for(lt[r]=n,e=0;e<1<<tt[r];e++)ct[n++]=r;for(ct[n-1]=r,o=0,r=0;16>r;r++)for(ft[r]=o,e=0;e<1<<nt[r];e++)ut[o++]=r;for(o>>=7;q>r;r++)for(ft[r]=o<<7,e=0;e<1<<nt[r]-7;e++)ut[256+o++]=r;for(t=0;H>=t;t++)s[t]=0;for(e=0;143>=e;)st[2*e+1]=8,e++,s[8]++;for(;255>=e;)st[2*e+1]=9,e++,s[9]++;for(;279>=e;)st[2*e+1]=7,e++,s[7]++;for(;287>=e;)st[2*e+1]=8,e++,s[8]++;for(p(st,V+1,s),e=0;q>e;e++)at[2*e+1]=5,at[2*e]=l(e,5);ht=new i(st,tt,W+1,V,H),pt=new i(at,nt,0,q,H),dt=new i(new Array(0),rt,0,$,K)}function m(e){var t;for(t=0;V>t;t++)e.dyn_ltree[2*t]=0;for(t=0;q>t;t++)e.dyn_dtree[2*t]=0;for(t=0;$>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*X]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function g(e){e.bi_valid>8?a(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function v(e,t,n,r){g(e),r&&(a(e,n),a(e,~n)),B.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function y(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]}function b(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&y(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!y(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function _(e,t,n){var r,i,o,a,l=0;if(0!==e.last_lit)do r=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],i=e.pending_buf[e.l_buf+l],l++,0===r?c(e,i,t):(o=ct[i],c(e,o+W+1,t),a=tt[o],0!==a&&(i-=lt[o],u(e,i,a)),r--,o=s(r),c(e,o,n),a=nt[o],0!==a&&(r-=ft[o],u(e,r,a)));while(l<e.last_lit);c(e,X,t)}function w(e,t){var n,r,i,o=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=Z,n=0;u>n;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=2>c?++c:0,o[2*i]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=s[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)b(e,o,n);i=u;do n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],b(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,b(e,o,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],h(e,t),p(o,c,e.bl_count)}function x(e,t,n){var r,i,o=-1,s=t[1],a=0,u=7,c=4;for(0===s&&(u=138,c=3),t[2*(n+1)+1]=65535,r=0;n>=r;r++)i=s,s=t[2*(r+1)+1],++a<u&&i===s||(c>a?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*Y]++):10>=a?e.bl_tree[2*Q]++:e.bl_tree[2*et]++,a=0,o=i,0===s?(u=138,c=3):i===s?(u=6,c=3):(u=7,c=4))}function S(e,t,n){var r,i,o=-1,s=t[1],a=0,l=7,f=4;for(0===s&&(l=138,f=3),r=0;n>=r;r++)if(i=s,s=t[2*(r+1)+1],!(++a<l&&i===s)){if(f>a){do c(e,i,e.bl_tree);while(0!==--a)}else 0!==i?(i!==o&&(c(e,i,e.bl_tree),a--),c(e,Y,e.bl_tree),u(e,a-3,2)):10>=a?(c(e,Q,e.bl_tree),u(e,a-3,3)):(c(e,et,e.bl_tree),u(e,a-11,7));a=0,o=i,0===s?(l=138,f=3):i===s?(l=6,f=3):(l=7,f=4)}}function T(e){var t;for(x(e,e.dyn_ltree,e.l_desc.max_code),x(e,e.dyn_dtree,e.d_desc.max_code),w(e,e.bl_desc),t=$-1;t>=3&&0===e.bl_tree[2*it[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function A(e,t,n,r){var i;for(u(e,t-257,5),u(e,n-1,5),u(e,r-4,4),i=0;r>i;i++)u(e,e.bl_tree[2*it[i]+1],3);S(e,e.dyn_ltree,t-1),S(e,e.dyn_dtree,n-1)}function E(e){var t,n=4093624447;for(t=0;31>=t;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return I;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return O;for(t=32;W>t;t++)if(0!==e.dyn_ltree[2*t])return O;return I}function k(e){mt||(d(),mt=!0),e.l_desc=new o(e.dyn_ltree,ht),e.d_desc=new o(e.dyn_dtree,pt),e.bl_desc=new o(e.bl_tree,dt),e.bi_buf=0,e.bi_valid=0,m(e)}function C(e,t,n,r){u(e,(R<<1)+(r?1:0),3),v(e,t,n,!0)}function P(e){u(e,F<<1,3),c(e,X,st),f(e)}function D(e,t,n,r){var i,o,s=0;e.level>0?(e.strm.data_type===L&&(e.strm.data_type=E(e)),w(e,e.l_desc),w(e,e.d_desc),s=T(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,i>=o&&(i=o)):i=o=n+5,i>=n+4&&-1!==t?C(e,t,n,r):e.strategy===N||o===i?(u(e,(F<<1)+(r?1:0),3),_(e,st,at)):(u(e,(j<<1)+(r?1:0),3),A(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),_(e,e.dyn_ltree,e.dyn_dtree)),m(e),r&&g(e)}function M(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ct[n]+W+1)]++,e.dyn_dtree[2*s(t)]++),e.last_lit===e.lit_bufsize-1}var B=e("../utils/common"),N=4,I=0,O=1,L=2,R=0,F=1,j=2,z=3,U=258,G=29,W=256,V=W+1+G,q=30,$=19,Z=2*V+1,H=15,J=16,K=7,X=256,Y=16,Q=17,et=18,tt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],nt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],rt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],it=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ot=512,st=new Array(2*(V+2));r(st);var at=new Array(2*q);r(at);var ut=new Array(ot);r(ut);var ct=new Array(U-z+1);r(ct);var lt=new Array(G);r(lt);var ft=new Array(q);r(ft);var ht,pt,dt,mt=!1;n._tr_init=k,n._tr_stored_block=C,n._tr_flush_block=D,n._tr_tally=M,n._tr_align=P},{"../utils/common":62}],74:[function(e,t){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=n},{}]},{},[10])(10)}),e("zip",["SFile","jszip","FileSaver.min","Util","MIMETypes","DeferredUtil"],function(e,t,n,r,i,o){var a={};return a.zip=function(n,r,i){function a(e,t){return t.each(function(t){if(t.isDir()){var n=e.folder(t.name().replace(/[\/\\]$/,""));return a(n,t)}return t.getContent(function(n){e.file(t.name(),n.toArrayBuffer())})})}e.is(r)||(i=r),i=i||{};var u=new t;return a(u,n).then(function(){return o.resolve(u.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(t){return e.is(r)?r.setBytes(t):void s(new Blob([t],{type:"application/zip"}),n.name().replace(/[\/\\]$/,"")+".zip")})},a.unzip=function(n,r,i){var s,a={};i=i||{},e.is(n)&&(s=n.getContent(),n=s.toArrayBuffer()),i.onCheckFile||(i.onCheckFile=function(e){return i.overwrite?e:e.exists()?!1:e});var u=new t;return o.resolve(u.loadAsync(n)).then(function(){return o.each(u.files,function(t,n){return o.resolve(n.async("arraybuffer")).then(function(t){var o=r.rel(n.name);if(console.log("Inflating",n.name),!o.isDir()){var s={file:o,status:"uploaded"};a[o.path()]=s;var u=FS.Content.bin(t,o.contentType()),c=i.onCheckFile(o,u);return c===!1&&(s.status="cancelled",o=null),e.is(c)&&(o.path()!==c.path()&&(s.redirectedTo=c),o=c),o?o.setContent(u):void 0}})})}).then(function(){return console.log("unzip done",a),a})},a.JSZip=t,a}),e("FS",["FS2","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil"],function(e,t,n,r,i,o,s,a,u,c,l,f){var h={};h.assert=s,h.Content=c,h.Class=e,h.DeferredUtil=f,h.Env=o,h.LSFS=n,h.NativeFS=t,h.PathUtil=i,h.RootFS=u,h.SFile=a,h.WebFS=r,h.zip=l,"object"==typeof window&&(window.FS=h);var p,d=new o({});return f.external.Promise=l.JSZip.external.Promise,h.addFSType=e.addFSType,h.availFSTypes=e.availFSTypes,h.setEnvProvider=function(e){d=e},h.getEnvProvider=function(){return d},h.setEnv=function(e,t){if("object"==typeof e)for(var n in e)d.set(n,e[n]);else d.set(e,t)},h.getEnv=function(e){return"string"==typeof e?d.get(e):d.value},h.init=function(e){p||(e||(e="object"==typeof process?new t:new n(localStorage)),p=new u(e))},h.getRootFS=function(){return h.init(),p},h.get=function(){return h.init(),p.get.apply(p,arguments)},h.expandPath=function(){return d.expandPath.apply(d,arguments)},h.resolve=function(e,t){return h.init(),a.is(e)?e:(e=d.expandPath(e),t&&!i.isAbsolutePath(e)?(t=d.expandPath(t),h.get(t).rel(e)):h.get(e))},h.mount=function(){return h.init(),p.mount.apply(p,arguments)},h.unmount=function(){return h.init(),p.unmount.apply(p,arguments)},h.isFile=function(e){return a.is(e)},h});var a;return t(["FS"],function(e){a=e}),void 0===window.FS&&(window.FS=a),a}),requireSimulator.setName("assert"),define(["FS"],function(e){return e.assert}),requireSimulator.setName("DeferredUtil"),define([],function(){var e;return e={ensureDefer:function(e){var t,n=new $.Deferred;return $.when(e).then(function(e){t?n.resolve(e):setTimeout(function(){n.resolve(e)},0)}).fail(function(e){t?n.reject(e):setTimeout(function(){n.reject(e)},0)}),t=!0,n.promise()},directPromise:function(e){var t=new $.Deferred;return setTimeout(function(){t.resolve(e)},0),t.promise()},then:function(t){return e.directPromise().then(t)},timeout:function(e){var t=new $.Deferred;return setTimeout(function(){t.resolve()},e),t.promise()},funcPromise:function(e){var t=new $.Deferred;return e(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},throwPromise:function(e){var t=new $.Deferred;return setTimeout(function(){t.reject(e)},0),t.promise()},throwF:function(t){return function(){try{return t.apply(this,arguments)}catch(n){return console.log(n,n.stack),e.throwPromise(n)}}},each:function(t,n){if(t instanceof Array)return e.loop(function(r){return r>=t.length?e.brk():$.when(n(t[r],r)).then(function(){return r+1})},0);var r=[];for(var i in t)r.push({k:i,v:t[i]});return e.each(r,function(e){return n(e.k,e.v)})},loop:function(t,n){return e.directPromise(n).then(e.throwF(function(){var n=t.apply(this,arguments);return n.DU_BRK?n.res:$.when(n).then(function(n){return e.loop(t,n)})}))},brk:function(e){return{DU_BRK:!0,res:e}},tryLoop:function(t,n){return e.loop(e.tr(t),n)},tryEach:function(t,n){return e.loop(t,e.tr(n))},documentReady:function(){return e.callbackToPromise(function(e){$(e)})},requirejs:function(t){if(!window.requirejs)throw new Error("requirejs is not loaded");return e.callbackToPromise(function(e){window.requirejs(t,e)})}},e.begin=e.try=e.tr=e.throwF,e.promise=e.callbackToPromise=e.funcPromise,e}),requireSimulator.setName("Klass"),define(["assert"],function(e){function t(e){if("object"!=typeof e)return!1;if(!e)return!1;var t={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},n=0;for(var r in e){if(!t[r])return!1;n+=t[r]}return n}var n={};return n.define=function(r){function i(t){r.$fields&&e.is(t,r.$fields)}var o,s;r.$parent?(s=r.$parent,o=Object.create(s.prototype),o.super=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return s.prototype[t].apply(this,e)}):o={};var a,u=r.$||function(e){if(e&&"object"==typeof e)for(var t in e)this[t]=e[t]};u instanceof Array&&(a=u,u=function(){for(var e=Array.prototype.slice.call(arguments),t=0;t<a.length;t++)e.length>0&&(this[a[t]]=e.shift())});var c;c=function(){if(!(this instanceof c)){var e=Object.create(o);return u.apply(e,arguments),i(e),e}u.apply(this,arguments),i(this)},s&&(c.super=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift();return s.prototype[n].apply(t,e)}),c.inherit=function(e){return e.$parent=c,n.define(e)},c.prototype=o;for(var l in r)"$"!=l[0]&&("static$"==l.substring(0,7)?c[l.substring(7)]=r[l]:t(r[l])?Object.defineProperty(o,l,r[l]):o[l]=r[l]);return o.$=u,c},n.Function=function(){throw new Exception("Abstract")},n.opt=e.opt,n}),requireSimulator.setName("Tonyu.Thread"),define(["DeferredUtil","Klass"],function(e,t){var n={enterC:{},exitC:0};try{window.cnts=n}catch(r){}var i=t.define({$:function(){this.frame=null,this._isDead=!1,this.cnt=0,this._isWaiting=!1,this.fSuspended=!1,this.tryStack=[],this.preemptionTime=60,this.onEndHandlers=[],this.onTerminateHandlers=[],this.age=0},isAlive:function(){return!this.isDead()},isDead:function(){return this._isDead=this._isDead||null==this.frame||this._threadGroup&&(this._threadGroup.objectPoolAge!=this.tGrpObjectPoolAge||this._threadGroup.isDeadThreadGroup())},setThreadGroup:function(e){this._threadGroup=e,this.tGrpObjectPoolAge=e.objectPoolAge},isWaiting:function(){return this._isWaiting},suspend:function(){this.fSuspended=!0,this.cnt=0},enter:function(e){this.frame={prev:this.frame,func:e}},apply:function(e,t,n){n||(n=[]);var r;if("string"==typeof t&&(r=e["fiber$"+t],!r))throw new Error("メソッド"+t+"が見つかりません");"function"==typeof t&&(r=t.fiber),n=[this].concat(n);var i=0;return this.enter(function(t){switch(i){case 0:r.apply(e,n),i=1;break;case 1:t.termStatus="success",t.notifyEnd(t.retVal),n[0].exit(),i=2}})},notifyEnd:function(e){this.onEndHandlers.forEach(function(t){t(e)}),this.notifyTermination({status:"success",value:e})},notifyTermination:function(e){this.onTerminateHandlers.forEach(function(t){t(e)})},on:function(e,t){("end"===e||"success"===e)&&this.onEndHandlers.push(t),"terminate"===e&&(this.onTerminateHandlers.push(t),this.handleEx&&delete this.handleEx)},promise:function(){var t=this;return e.funcPromise(function(e,n){t.on("terminate",function(t){"success"===t.status?e(t.value):n("exception"===t.status?t.exception:new Error(t.status))})})},then:function(e,t){return t?this.proimse().then(e,t):this.proimse().then(e)},fail:function(e){return this.promise().fail(e)},gotoCatch:function(e){var t=this;if(0==t.tryStack.length)return t.termStatus="exception",t.kill(),void(t.handleEx?t.handleEx(e):t.notifyTermination({status:"exception",exception:e}));t.lastEx=e;for(var n=t.tryStack.pop();t.frame;){if(n.frame===t.frame){t.catchPC=n.catchPC;break}t.frame=t.frame.prev}},startCatch:function(){var e=this,t=e.lastEx;return e.lastEx=null,t},exit:function(e){this.frame=this.frame?this.frame.prev:null,this.retVal=e},enterTry:function(e){var t=this;t.tryStack.push({frame:t.frame,catchPC:e})},exitTry:function(){var e=this;e.tryStack.pop()},waitEvent:function(e,t){var n=this;if(n.suspend(),e.on){var r;t=t.concat(function(){n.lastEvent=arguments,n.retVal=arguments[0],r.remove(),n.steps()}),r=e.on.apply(e,t)}},runAsync:function(e){var t=this,n=function(){t.retVal=arguments,t.steps()},r=function(){for(var e="",n=0;n<arguments.length;n++)e+=arguments[n]+",";0==e.length&&(e="Async fail");var r=new Error(e);r.args=arguments,t.gotoCatch(r),t.steps()};t.suspend(),setTimeout(function(){e(n,r)},0)},waitFor:function(t){var n=this;return n._isWaiting=!0,n.suspend(),t instanceof i&&(t=t.promise()),e.ensureDefer(t).then(function(e){n.retVal=e,n.stepsLoop()}).fail(function(e){if(e instanceof Error)n.gotoCatch(e);else{var t=new Error(e);t.original=e,n.gotoCatch(t)}n.stepsLoop()})},resume:function(e){this.retVal=e,this.steps()},steps:function(){var e=this;if(!e.isDead()){var t=Tonyu.currentThread;for(Tonyu.currentThread=e,e.cnt=e.preemptionTime,e.preempted=!1,e.fSuspended=!1;e.cnt>0&&e.frame;)try{for(;e.cnt-->0&&e.frame;)e.frame.func(e);e.preempted=!e.fSuspended&&e.isAlive()}catch(n){e.gotoCatch(n)}Tonyu.currentThread=t}},stepsLoop:function(){var e=this;e.steps(),e.preempted&&setTimeout(function(){e.stepsLoop()},0)},kill:function(){var e=this;e._isDead=!0,e.frame=null,e.termStatus||(e.termStatus="killed",e.notifyTermination({status:"killed"}))},clearFrame:function(){this.frame=null,this.tryStack=[]}});return i}),requireSimulator.setName("Tonyu.Iterator"),define(["Klass"],function(e){function t(e,t){if(e.tonyuIterator)return e.tonyuIterator(t);if(e instanceof Array)return 1==t?new n(e):new r(e);if(e instanceof Object)return 1==t?new i(e):new o(e);throw console.log(e),new Error(e+" is not iterable")}var n=e.define({$:function(e){this.set=e,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.set[this.i],this.i++,!0)}}),r=e.define({$:function(e){this.set=e,this.i=0},next:function(){return this.i>=this.set.length?!1:(this[0]=this.i,this[1]=this.set[this.i],this.i++,!0)}}),i=e.define({$:function(e){this.elems=[];for(var t in e)this.elems.push(t);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i],this.i++,!0)}}),o=e.define({$:function(e){this.elems=[];for(var t in e)this.elems.push([t,e[t]]);this.i=0},next:function(){return this.i>=this.elems.length?!1:(this[0]=this.elems[this.i][0],this[1]=this.elems[this.i][1],this.i++,!0)}});return t}),requireSimulator.setName("Tonyu"),"function"!=typeof define&&(define=require("requirejs").define),define(["assert","Tonyu.Thread","Tonyu.Iterator","DeferredUtil"],function(e,t,n,r){return Tonyu=function(){function i(){var e=new t;
return e.handleEx=a,e}function o(e){return r.funcPromise(function(t){setTimeout(t,e)})}function s(){return r.funcPromise(function(e){requestAnimationFrame(e)})}function a(e){if(!Tonyu.onRuntimeError)throw"undefined"==typeof $LASTPOS&&($LASTPOS=0),alert("エラー! at "+$LASTPOS+" メッセージ  : "+e),console.log(e.stack),e;Tonyu.onRuntimeError(e)}function u(t,n){return e.is(arguments,[String,Object]),l(klass.getMeta(t),n)}function c(e,t){return e?l(Object.create(e.prototype),t):t}function l(e,t){if(t&&"object"==typeof t)for(var n in t)e[n]=t[n];return e}function f(e,t){E[e]=t}function h(e){return E[e]}function p(e){var t=e.split("."),n=k;if(t.forEach(function(e){n&&(n=n[e])}),!n&&1==t.length){var r;for(var i in k){var o=k[i][e];if(o){if(n)throw new Error("曖昧なクラス名： "+i+"."+e+", "+r);n=o,r=i+"."+e}}}return n}function d(e,t){if("function"!=typeof t)return t;var n=function(){return t.apply(e,arguments)};return n.methodInfo=Tonyu.extend({thiz:e},t.methodInfo||{}),t.fiber&&(n.fiber=function(){return t.fiber.apply(e,arguments)},n.fiber.methodInfo=Tonyu.extend({thiz:e},t.fiber.methodInfo||{})),n}function m(e,t,n,r){if(!e)throw new Error(r+"(="+e+")のメソッド "+t+"を呼び出せません");var i=e[t];if("function"!=typeof i)throw new Error(("this"==r?"":r+".")+t+"(="+i+")はメソッドではありません");return i.apply(e,n)}function g(e,t,n){if("function"!=typeof e)throw new Error(n+"は関数ではありません");return e.apply({},t)}function v(e,t){if(e!=e||null==e)throw new Error(t+"(="+e+")は初期化されていません");return e}function y(e){for(var t=[],n=1;n<e.length;n++)t[n-1]=e[n];return t}function b(e){throw new Error("クラス名"+e+"はnewをつけて呼び出して下さい。")}function _(e){throw console.log("Not a tonyu object: ",e),new Error(e+" is not a tonyu object")}function w(e,t){return e in t}function x(e){var t=p(e);if(!t)throw new Error(e+" というクラスはありません");Tonyu.runMode=!0;var n,r=new t;(n=Tonyu.currentProject)&&(n.runningObj=r),$LASTPOS=0}function S(){var e=(new Date).getTime();if(e-P>1e3)throw T(1e4),new Error("無限ループをストップしました"+(e-A));A=e}function T(e){P=(new Date).getTime()+(e||0)}klass=function(){throw alert("この関数は古くなりました。コンパイルをやり直してください。 Deprecated. compile again."),new Error("この関数は古くなりました。コンパイルをやり直してください。 Deprecated. compile again.")},klass.addMeta=u,klass.removeMeta=function(e){delete C[e]},klass.getMeta=function(e){if("function"==typeof e)return e.meta;if("string"==typeof e){var t=C[e];return t||(C[e]=t={}),t}},klass.ensureNamespace=function(e,t){var n,r=t.split("."),i=e;for(n=0;n<r.length;n++){var o=r[n];i[o]||(i[o]={}),i=i[o]}return i},Function.prototype.constructor=function(){throw new Error("This method should not be called")},klass.define=function(e){var t=e.superclass,n=e.includes,r=e.fullName,i=e.shortName,o=e.namespace,s=e.methods,a=e.decls,l=klass.ensureNamespace(Tonyu.classes,o),f=s,h=f.initialize;delete f.initialize;var p;p=h?function(){this instanceof p||b(r),h.apply(this,arguments)}:t?function(){this instanceof p||b(r),t.apply(this,arguments)}:function(){this instanceof p||b(r)},l[i]=p,p.methods=f,n.forEach(function(e){if(!e.methods)throw e+" Does not have methods";for(var t in e.methods)t in f||(f[t]=e.methods[t])});var d={},m=/^__([gs]et)ter__(.*)$/;for(var g in f)if(!g.match(/^fiber\$/)){f["fiber$"+g]&&(f[g].fiber=f["fiber$"+g],f[g].fiber.methodInfo={name:g,klass:p,fiber:!0}),f[g].methodInfo={name:g,klass:p};var v=m.exec(g);v&&(d[v[2]]=d[v[2]]||{},d[v[2]][v[1]]=f[g])}p.prototype=c(t,f),p.prototype.isTonyuObject=!0;for(var g in d)Object.defineProperty(p.prototype,g,d[g]);p.meta=u(r,{fullName:r,shortName:i,namepsace:o,decls:a,superclass:t?t.meta:null,func:p,includes:n.map(function(e){return e.meta})});var y=klass.getMeta(p);return p.prototype.getClassInfo=function(){return y},p},klass.isSourceChanged=function(e){return e=e.meta||e,e.src&&e.src.tonyu?e.nodeTimestamp?e.src.tonyu.lastUpdate()>e.nodeTimestamp:!0:!1},klass.shouldCompile=function(e){if(e=e.meta||e,klass.isSourceChanged(e))return!0;for(var t=klass.getDependingClasses(e),n=0;n<t.length;n++)if(klass.shouldCompile(t[n]))return!0},klass.getDependingClasses=function(e){e=e.meta||e;var t=[];return e.superclass&&(t=[e.superclass]),e.includes&&(t=t.concat(e.includes)),t};var A,E={},k={},C={},P=(new Date).getTime();return setInterval(T,16),Tonyu={thread:i,klass:klass,bless:c,extend:l,globals:E,classes:k,classMetas:C,setGlobal:f,getGlobal:h,getClass:p,timeout:o,animationFrame:s,bindFunc:d,not_a_tonyu_object:_,hasKey:w,invokeMethod:m,callFunc:g,checkNonNull:v,run:x,iterator:n,checkLoop:S,resetLoopCheck:T,VERSION:1511935986846,A:y}}()}),requireSimulator.setName("source-map"),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("source-map",[],t):"object"==typeof exports?exports.sourceMap=t():e.sourceMap=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){t.SourceMapGenerator=n(1).SourceMapGenerator,t.SourceMapConsumer=n(7).SourceMapConsumer,t.SourceNode=n(10).SourceNode},function(e,t,n){function r(e){e||(e={}),this._file=o.getArg(e,"file",null),this._sourceRoot=o.getArg(e,"sourceRoot",null),this._skipValidation=o.getArg(e,"skipValidation",!1),this._sources=new s,this._names=new s,this._mappings=new a,this._sourcesContents=null}var i=n(2),o=n(4),s=n(5).ArraySet,a=n(6).MappingList;r.prototype._version=3,r.fromSourceMap=function(e){var t=e.sourceRoot,n=new r({file:e.file,sourceRoot:t});return e.eachMapping(function(e){var r={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(r.source=e.source,null!=t&&(r.source=o.relative(t,r.source)),r.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(r.name=e.name)),n.addMapping(r)}),e.sources.forEach(function(t){var r=e.sourceContentFor(t);null!=r&&n.setSourceContent(t,r)}),n},r.prototype.addMapping=function(e){var t=o.getArg(e,"generated"),n=o.getArg(e,"original",null),r=o.getArg(e,"source",null),i=o.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,n,r,i),null!=r&&(r=String(r),this._sources.has(r)||this._sources.add(r)),null!=i&&(i=String(i),this._names.has(i)||this._names.add(i)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:r,name:i})},r.prototype.setSourceContent=function(e,t){var n=e;null!=this._sourceRoot&&(n=o.relative(this._sourceRoot,n)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[o.toSetString(n)]=t):this._sourcesContents&&(delete this._sourcesContents[o.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},r.prototype.applySourceMap=function(e,t,n){var r=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=e.file}var i=this._sourceRoot;null!=i&&(r=o.relative(i,r));var a=new s,u=new s;this._mappings.unsortedForEach(function(t){if(t.source===r&&null!=t.originalLine){var s=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=s.source&&(t.source=s.source,null!=n&&(t.source=o.join(n,t.source)),null!=i&&(t.source=o.relative(i,t.source)),t.originalLine=s.line,t.originalColumn=s.column,null!=s.name&&(t.name=s.name))}var c=t.source;null==c||a.has(c)||a.add(c);var l=t.name;null==l||u.has(l)||u.add(l)},this),this._sources=a,this._names=u,e.sources.forEach(function(t){var r=e.sourceContentFor(t);null!=r&&(null!=n&&(t=o.join(n,t)),null!=i&&(t=o.relative(i,t)),this.setSourceContent(t,r))},this)},r.prototype._validateMapping=function(e,t,n,r){if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!t&&!n&&!r||e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:n,original:t,name:r}))},r.prototype._serializeMappings=function(){for(var e,t,n,r,s=0,a=1,u=0,c=0,l=0,f=0,h="",p=this._mappings.toArray(),d=0,m=p.length;m>d;d++){if(t=p[d],e="",t.generatedLine!==a)for(s=0;t.generatedLine!==a;)e+=";",a++;else if(d>0){if(!o.compareByGeneratedPositionsInflated(t,p[d-1]))continue;e+=","}e+=i.encode(t.generatedColumn-s),s=t.generatedColumn,null!=t.source&&(r=this._sources.indexOf(t.source),e+=i.encode(r-f),f=r,e+=i.encode(t.originalLine-1-c),c=t.originalLine-1,e+=i.encode(t.originalColumn-u),u=t.originalColumn,null!=t.name&&(n=this._names.indexOf(t.name),e+=i.encode(n-l),l=n)),h+=e}return h},r.prototype._generateSourcesContent=function(e,t){return e.map(function(e){if(!this._sourcesContents)return null;null!=t&&(e=o.relative(t,e));var n=o.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null},this)},r.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},r.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=r},function(e,t,n){function r(e){return 0>e?(-e<<1)+1:(e<<1)+0}function i(e){var t=1===(1&e),n=e>>1;return t?-n:n}var o=n(3),s=5,a=1<<s,u=a-1,c=a;t.encode=function(e){var t,n="",i=r(e);do t=i&u,i>>>=s,i>0&&(t|=c),n+=o.encode(t);while(i>0);return n},t.decode=function(e,t,n){var r,a,l=e.length,f=0,h=0;do{if(t>=l)throw new Error("Expected more digits in base 64 VLQ value.");if(a=o.decode(e.charCodeAt(t++)),-1===a)throw new Error("Invalid base64 digit: "+e.charAt(t-1));r=!!(a&c),a&=u,f+=a<<h,h+=s}while(r);n.value=i(f),n.rest=t}},function(e,t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(e>=0&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){var t=65,n=90,r=97,i=122,o=48,s=57,a=43,u=47,c=26,l=52;return e>=t&&n>=e?e-t:e>=r&&i>=e?e-r+c:e>=o&&s>=e?e-o+l:e==a?62:e==u?63:-1}},function(e,t){function n(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')}function r(e){var t=e.match(g);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function o(e){var n=e,o=r(e);if(o){if(!o.path)return e;n=o.path}for(var s,a=t.isAbsolute(n),u=n.split(/\/+/),c=0,l=u.length-1;l>=0;l--)s=u[l],"."===s?u.splice(l,1):".."===s?c++:c>0&&(""===s?(u.splice(l+1,c),c=0):(u.splice(l,2),c--));return n=u.join("/"),""===n&&(n=a?"/":"."),o?(o.path=n,i(o)):n}function s(e,t){""===e&&(e="."),""===t&&(t=".");var n=r(t),s=r(e);if(s&&(e=s.path||"/"),n&&!n.scheme)return s&&(n.scheme=s.scheme),i(n);if(n||t.match(v))return t;if(s&&!s.host&&!s.path)return s.host=t,i(s);var a="/"===t.charAt(0)?t:o(e.replace(/\/+$/,"")+"/"+t);return s?(s.path=a,i(s)):a}function a(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var n=0;0!==t.indexOf(e+"/");){var r=e.lastIndexOf("/");if(0>r)return t;if(e=e.slice(0,r),e.match(/^([^\/]+:\/)?\/*$/))return t;++n}return Array(n+1).join("../")+t.substr(e.length+1)}function u(e){return e}function c(e){return f(e)?"$"+e:e}function l(e){return f(e)?e.slice(1):e}function f(e){if(!e)return!1;var t=e.length;if(9>t)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var n=t-10;n>=0;n--)if(36!==e.charCodeAt(n))return!1;return!0}function h(e,t,n){var r=e.source-t.source;return 0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r||n?r:(r=e.generatedColumn-t.generatedColumn,0!==r?r:(r=e.generatedLine-t.generatedLine,0!==r?r:e.name-t.name))))}function p(e,t,n){var r=e.generatedLine-t.generatedLine;return 0!==r?r:(r=e.generatedColumn-t.generatedColumn,0!==r||n?r:(r=e.source-t.source,0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r?r:e.name-t.name))))}function d(e,t){return e===t?0:e>t?1:-1}function m(e,t){var n=e.generatedLine-t.generatedLine;return 0!==n?n:(n=e.generatedColumn-t.generatedColumn,0!==n?n:(n=d(e.source,t.source),0!==n?n:(n=e.originalLine-t.originalLine,0!==n?n:(n=e.originalColumn-t.originalColumn,0!==n?n:d(e.name,t.name)))))}t.getArg=n;var g=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,v=/^data:.+\,.+$/;t.urlParse=r,t.urlGenerate=i,t.normalize=o,t.join=s,t.isAbsolute=function(e){return"/"===e.charAt(0)||!!e.match(g)},t.relative=a;var y=function(){var e=Object.create(null);return!("__proto__"in e)}();t.toSetString=y?u:c,t.fromSetString=y?u:l,t.compareByOriginalPositions=h,t.compareByGeneratedPositionsDeflated=p,t.compareByGeneratedPositionsInflated=m},function(e,t,n){function r(){this._array=[],this._set=Object.create(null)}var i=n(4),o=Object.prototype.hasOwnProperty;r.fromArray=function(e,t){for(var n=new r,i=0,o=e.length;o>i;i++)n.add(e[i],t);return n},r.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},r.prototype.add=function(e,t){var n=i.toSetString(e),r=o.call(this._set,n),s=this._array.length;(!r||t)&&this._array.push(e),r||(this._set[n]=s)},r.prototype.has=function(e){var t=i.toSetString(e);return o.call(this._set,t)},r.prototype.indexOf=function(e){var t=i.toSetString(e);if(o.call(this._set,t))return this._set[t];throw new Error('"'+e+'" is not in the set.')},r.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},r.prototype.toArray=function(){return this._array.slice()},t.ArraySet=r},function(e,t,n){function r(e,t){var n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||o.compareByGeneratedPositionsInflated(e,t)<=0}function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}var o=n(4);i.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},i.prototype.add=function(e){r(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(o.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.MappingList=i},function(e,t,n){function r(e){var t=e;return"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,""))),null!=t.sections?new s(t):new i(t)}function i(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=a.getArg(t,"version"),r=a.getArg(t,"sources"),i=a.getArg(t,"names",[]),o=a.getArg(t,"sourceRoot",null),s=a.getArg(t,"sourcesContent",null),u=a.getArg(t,"mappings"),l=a.getArg(t,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);r=r.map(String).map(a.normalize).map(function(e){return o&&a.isAbsolute(o)&&a.isAbsolute(e)?a.relative(o,e):e}),this._names=c.fromArray(i.map(String),!0),this._sources=c.fromArray(r,!0),this.sourceRoot=o,this.sourcesContent=s,this._mappings=u,this.file=l}function o(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function s(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=a.getArg(t,"version"),i=a.getArg(t,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new c,this._names=new c;var o={line:-1,column:0};this._sections=i.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=a.getArg(e,"offset"),n=a.getArg(t,"line"),i=a.getArg(t,"column");if(n<o.line||n===o.line&&i<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=t,{generatedOffset:{generatedLine:n+1,generatedColumn:i+1},consumer:new r(a.getArg(e,"map"))}})}var a=n(4),u=n(8),c=n(5).ArraySet,l=n(2),f=n(9).quickSort;r.fromSourceMap=function(e){return i.fromSourceMap(e)},r.prototype._version=3,r.prototype.__generatedMappings=null,Object.defineProperty(r.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),r.prototype.__originalMappings=null,Object.defineProperty(r.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),r.prototype._charIsMappingSeparator=function(e,t){var n=e.charAt(t);return";"===n||","===n},r.prototype._parseMappings=function(){throw new Error("Subclasses must implement _parseMappings")},r.GENERATED_ORDER=1,r.ORIGINAL_ORDER=2,r.GREATEST_LOWER_BOUND=1,r.LEAST_UPPER_BOUND=2,r.prototype.eachMapping=function(e,t,n){var i,o=t||null,s=n||r.GENERATED_ORDER;switch(s){case r.GENERATED_ORDER:i=this._generatedMappings;break;case r.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var u=this.sourceRoot;i.map(function(e){var t=null===e.source?null:this._sources.at(e.source);return null!=t&&null!=u&&(t=a.join(u,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}},this).forEach(e,o)},r.prototype.allGeneratedPositionsFor=function(e){var t=a.getArg(e,"line"),n={source:a.getArg(e,"source"),originalLine:t,originalColumn:a.getArg(e,"column",0)};if(null!=this.sourceRoot&&(n.source=a.relative(this.sourceRoot,n.source)),!this._sources.has(n.source))return[];n.source=this._sources.indexOf(n.source);var r=[],i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,u.LEAST_UPPER_BOUND);if(i>=0){var o=this._originalMappings[i];if(void 0===e.column)for(var s=o.originalLine;o&&o.originalLine===s;)r.push({line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++i];else for(var c=o.originalColumn;o&&o.originalLine===t&&o.originalColumn==c;)r.push({line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++i]}return r},t.SourceMapConsumer=r,i.prototype=Object.create(r.prototype),i.prototype.consumer=r,i.fromSourceMap=function(e){var t=Object.create(i.prototype),n=t._names=c.fromArray(e._names.toArray(),!0),r=t._sources=c.fromArray(e._sources.toArray(),!0);t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file;for(var s=e._mappings.toArray().slice(),u=t.__generatedMappings=[],l=t.__originalMappings=[],h=0,p=s.length;p>h;h++){var d=s[h],m=new o;m.generatedLine=d.generatedLine,m.generatedColumn=d.generatedColumn,d.source&&(m.source=r.indexOf(d.source),m.originalLine=d.originalLine,m.originalColumn=d.originalColumn,d.name&&(m.name=n.indexOf(d.name)),l.push(m)),u.push(m)}return f(t.__originalMappings,a.compareByOriginalPositions),t},i.prototype._version=3,Object.defineProperty(i.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?a.join(this.sourceRoot,e):e},this)}}),i.prototype._parseMappings=function(e){for(var t,n,r,i,s,u=1,c=0,h=0,p=0,d=0,m=0,g=e.length,v=0,y={},b={},_=[],w=[];g>v;)if(";"===e.charAt(v))u++,v++,c=0;else if(","===e.charAt(v))v++;else{for(t=new o,t.generatedLine=u,i=v;g>i&&!this._charIsMappingSeparator(e,i);i++);if(n=e.slice(v,i),r=y[n])v+=n.length;else{for(r=[];i>v;)l.decode(e,v,b),s=b.value,v=b.rest,r.push(s);if(2===r.length)throw new Error("Found a source, but no line and column");if(3===r.length)throw new Error("Found a source and line, but no column");y[n]=r}t.generatedColumn=c+r[0],c=t.generatedColumn,r.length>1&&(t.source=d+r[1],d+=r[1],t.originalLine=h+r[2],h=t.originalLine,t.originalLine+=1,t.originalColumn=p+r[3],p=t.originalColumn,r.length>4&&(t.name=m+r[4],m+=r[4])),w.push(t),"number"==typeof t.originalLine&&_.push(t)}f(w,a.compareByGeneratedPositionsDeflated),this.__generatedMappings=w,f(_,a.compareByOriginalPositions),this.__originalMappings=_},i.prototype._findMapping=function(e,t,n,r,i,o){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[r]);return u.search(e,t,i,o)},i.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},i.prototype.originalPositionFor=function(e){var t={generatedLine:a.getArg(e,"line"),generatedColumn:a.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",a.compareByGeneratedPositionsDeflated,a.getArg(e,"bias",r.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===t.generatedLine){var o=a.getArg(i,"source",null);null!==o&&(o=this._sources.at(o),null!=this.sourceRoot&&(o=a.join(this.sourceRoot,o)));var s=a.getArg(i,"name",null);return null!==s&&(s=this._names.at(s)),{source:o,line:a.getArg(i,"originalLine",null),column:a.getArg(i,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}},i.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return null==e}):!1},i.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=a.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var n;if(null!=this.sourceRoot&&(n=a.urlParse(this.sourceRoot))){var r=e.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(r))return this.sourcesContent[this._sources.indexOf(r)];if((!n.path||"/"==n.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},i.prototype.generatedPositionFor=function(e){var t=a.getArg(e,"source");if(null!=this.sourceRoot&&(t=a.relative(this.sourceRoot,t)),!this._sources.has(t))return{line:null,column:null,lastColumn:null};t=this._sources.indexOf(t);var n={source:t,originalLine:a.getArg(e,"line"),originalColumn:a.getArg(e,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,a.getArg(e,"bias",r.GREATEST_LOWER_BOUND));if(i>=0){var o=this._originalMappings[i];if(o.source===n.source)return{line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=i,s.prototype=Object.create(r.prototype),s.prototype.constructor=r,s.prototype._version=3,Object.defineProperty(s.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),s.prototype.originalPositionFor=function(e){var t={generatedLine:a.getArg(e,"line"),generatedColumn:a.getArg(e,"column")},n=u.search(t,this._sections,function(e,t){var n=e.generatedLine-t.generatedOffset.generatedLine;return n?n:e.generatedColumn-t.generatedOffset.generatedColumn}),r=this._sections[n];return r?r.consumer.originalPositionFor({line:t.generatedLine-(r.generatedOffset.generatedLine-1),column:t.generatedColumn-(r.generatedOffset.generatedLine===t.generatedLine?r.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},s.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})},s.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var r=this._sections[n],i=r.consumer.sourceContentFor(e,!0);if(i)return i}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},s.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var n=this._sections[t];if(-1!==n.consumer.sources.indexOf(a.getArg(e,"source"))){var r=n.consumer.generatedPositionFor(e);if(r){var i={line:r.line+(n.generatedOffset.generatedLine-1),column:r.column+(n.generatedOffset.generatedLine===r.line?n.generatedOffset.generatedColumn-1:0)};return i}}}return{line:null,column:null}},s.prototype._parseMappings=function(){this.__generatedMappings=[],this.__originalMappings=[];for(var e=0;e<this._sections.length;e++)for(var t=this._sections[e],n=t.consumer._generatedMappings,r=0;r<n.length;r++){var i=n[r],o=t.consumer._sources.at(i.source);null!==t.consumer.sourceRoot&&(o=a.join(t.consumer.sourceRoot,o)),this._sources.add(o),o=this._sources.indexOf(o);var s=t.consumer._names.at(i.name);this._names.add(s),s=this._names.indexOf(s);var u={source:o,generatedLine:i.generatedLine+(t.generatedOffset.generatedLine-1),generatedColumn:i.generatedColumn+(t.generatedOffset.generatedLine===i.generatedLine?t.generatedOffset.generatedColumn-1:0),originalLine:i.originalLine,originalColumn:i.originalColumn,name:s};this.__generatedMappings.push(u),"number"==typeof u.originalLine&&this.__originalMappings.push(u)}f(this.__generatedMappings,a.compareByGeneratedPositionsDeflated),f(this.__originalMappings,a.compareByOriginalPositions)},t.IndexedSourceMapConsumer=s},function(e,t){function n(e,r,i,o,s,a){var u=Math.floor((r-e)/2)+e,c=s(i,o[u],!0);return 0===c?u:c>0?r-u>1?n(u,r,i,o,s,a):a==t.LEAST_UPPER_BOUND?r<o.length?r:-1:u:u-e>1?n(e,u,i,o,s,a):a==t.LEAST_UPPER_BOUND?u:0>e?-1:e}t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,r,i,o){if(0===r.length)return-1;var s=n(-1,r.length,e,r,i,o||t.GREATEST_LOWER_BOUND);if(0>s)return-1;for(;s-1>=0&&0===i(r[s],r[s-1],!0);)--s;return s}},function(e,t){function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t){return Math.round(e+Math.random()*(t-e))}function i(e,t,o,s){if(s>o){var a=r(o,s),u=o-1;n(e,a,s);for(var c=e[s],l=o;s>l;l++)t(e[l],c)<=0&&(u+=1,n(e,u,l));n(e,u+1,l);var f=u+1;i(e,t,o,f-1),i(e,t,f+1,s)}}t.quickSort=function(e,t){i(e,t,0,e.length-1)}},function(e,t,n){function r(e,t,n,r,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==n?null:n,this.name=null==i?null:i,this[u]=!0,null!=r&&this.add(r)}var i=n(1).SourceMapGenerator,o=n(4),s=/(\r?\n)/,a=10,u="$$$isSourceNode$$$";r.fromStringWithSourceMap=function(e,t,n){function i(e,t){if(null===e||void 0===e.source)a.add(t);else{var i=n?o.join(n,e.source):e.source;a.add(new r(e.originalLine,e.originalColumn,i,t,e.name))}}var a=new r,u=e.split(s),c=function(){var e=u.shift(),t=u.shift()||"";return e+t},l=1,f=0,h=null;return t.eachMapping(function(e){if(null!==h){if(!(l<e.generatedLine)){var t=u[0],n=t.substr(0,e.generatedColumn-f);return u[0]=t.substr(e.generatedColumn-f),f=e.generatedColumn,i(h,n),void(h=e)}i(h,c()),l++,f=0}for(;l<e.generatedLine;)a.add(c()),l++;if(f<e.generatedColumn){var t=u[0];a.add(t.substr(0,e.generatedColumn)),u[0]=t.substr(e.generatedColumn),f=e.generatedColumn}h=e},this),u.length>0&&(h&&i(h,c()),a.add(u.join(""))),t.sources.forEach(function(e){var r=t.sourceContentFor(e);null!=r&&(null!=n&&(e=o.join(n,e)),a.setSourceContent(e,r))}),a},r.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[u]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},r.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[u]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},r.prototype.walk=function(e){for(var t,n=0,r=this.children.length;r>n;n++)t=this.children[n],t[u]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},r.prototype.join=function(e){var t,n,r=this.children.length;if(r>0){for(t=[],n=0;r-1>n;n++)t.push(this.children[n]),t.push(e);t.push(this.children[n]),this.children=t}return this},r.prototype.replaceRight=function(e,t){var n=this.children[this.children.length-1];return n[u]?n.replaceRight(e,t):"string"==typeof n?this.children[this.children.length-1]=n.replace(e,t):this.children.push("".replace(e,t)),this},r.prototype.setSourceContent=function(e,t){this.sourceContents[o.toSetString(e)]=t},r.prototype.walkSourceContents=function(e){for(var t=0,n=this.children.length;n>t;t++)this.children[t][u]&&this.children[t].walkSourceContents(e);for(var r=Object.keys(this.sourceContents),t=0,n=r.length;n>t;t++)e(o.fromSetString(r[t]),this.sourceContents[r[t]])},r.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},r.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},n=new i(e),r=!1,o=null,s=null,u=null,c=null;return this.walk(function(e,i){t.code+=e,null!==i.source&&null!==i.line&&null!==i.column?((o!==i.source||s!==i.line||u!==i.column||c!==i.name)&&n.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name}),o=i.source,s=i.line,u=i.column,c=i.name,r=!0):r&&(n.addMapping({generated:{line:t.line,column:t.column}}),o=null,r=!1);for(var l=0,f=e.length;f>l;l++)e.charCodeAt(l)===a?(t.line++,t.column=0,l+1===f?(o=null,r=!1):r&&n.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name})):t.column++}),this.walkSourceContents(function(e,t){n.setSourceContent(e,t)}),{code:t.code,map:n}},t.SourceNode=r}])}),requireSimulator.setName("IndentBuffer"),"function"!=typeof define&&(define=require("requirejs").define),define(["assert","source-map"],function(e,t){var n=function(e){var t={},n=[],r=0,i=0;return e.split("\n").forEach(function(e){n.push(r),r+=e.length+1}),n.push(r),t.getRC=function(e){for(;;){if(0>i)return{row:1,col:1};if(i+1>=n.length)return{row:n.length,col:1};if(e<n[i])i--;else{if(!(n[i+1]<=e))return{row:i+1,col:e-n[i]+1};i++}}},t};return IndentBuffer=function(r){r=r||{};var i=function(){function e(e){r++;var i=t[r];if(null==i&&!e)throw console.log(t),new Error(r+"th null param: fmt="+n);return i}for(var t=arguments,n=t[0],r=0;;){var o=n.indexOf("%");if(0>o){i.print(n);break}i.print(n.substring(0,o)),o++;var s=n.charAt(o);if("s"==s){var a=e();"string"==typeof a||"number"==typeof a||(null==a?a="null":a.text&&(i.addMapping(a),a=a.text)),i.print(a),o++}else if("d"==s){var u=e();if("number"!=typeof u)throw new Error(u+" is not a number: fmt="+n);i.print(u),o++}else if("n"==s)i.ln(),o++;else if("{"==s)i.indent(),o++;else if("}"==s)i.dedent(),o++;else if("%"==s)i.print("%"),o++;else if("f"==s)e()(i),o++;else if("l"==s){var c=e();i.print(i.toLiteral(c)),o++}else if("v"==s){var l=e();if(!l)throw new Error("Null %v");if("object"!=typeof l)throw new Error("nonobject %v:"+l);i.addMapping(l),i.visitor.visit(l),o++}else if("z"==s){var f=e();if("val"in f)return void i.print(f.val);f.inited||i.lazy(f),f.print(),o++}else if("j"==s){var h=e(),p=h[0],d=h[1],m=!1;if(!d||!d.forEach)throw console.log(d),new Error(d+" is not array. cannot join fmt:"+n);d.forEach(function(e){m&&i.printf(p),m=!0,i.visitor.visit(e)}),o++}else"D"==s?(e(!0),o++):o+=2;n=n.substring(o)}};return i.addMapping=function(e){if(i.srcFile){var t;"number"==typeof e.row&&"number"==typeof e.col?t={row:e.row,col:e.col}:"number"==typeof e.pos&&(t=i.srcRCM.getRC(e.pos)),t&&i.srcmap.addMapping({generated:{line:i.bufRow,column:i.bufCol},source:i.srcFile+"",original:{line:t.row,column:t.col}})
}},i.setSrcFile=function(e){i.srcFile=e,i.srcRCM=n(e.text()),i.srcmap.setSourceContent(e.path(),e.text())},i.print=function(e){i.buf+=e;var t=(e+"").split("\n");t.forEach(function(e,n){n<t.length-1?(i.bufCol+=e.length+1,i.bufRow++,i.bufCol=1):i.bufCol+=e.length})},i.dstFile=r.dstFile,i.mapFile=r.mapFile,i.printf=i,i.buf="",i.bufRow=1,i.bufCol=1,i.srcmap=new t.SourceMapGenerator,i.lazy=function(t){return t||(t={}),r.fixLazyLength?(t.length=t.length||r.fixLazyLength,t.pad=t.pad||" ",t.gen=function(){for(var e="",n=0;n<t.length;n++)e+=t.pad;return e}(),t.puts=[],i.useLengthPlace=!0):(t.gen=("GENERETID"+Math.random()+"DITERENEG").replace(/\W/g,""),t.reg=new RegExp(t.gen,"g"),e(!i.useLengthPlace,"GENERETID cannot be used")),t.inited=!0,t.put=function(t){if(this.val=t+"",this.puts){for(this.val.length>this.length&&(i.lazyOverflow=!0);this.val.length<this.length;)this.val+=this.pad;var n=this;this.puts.forEach(function(t){var r=i.buf.length;i.buf=i.buf.substring(0,t)+n.val+i.buf.substring(t+n.length),e.eq(r,i.buf.length)})}return this.reg&&(i.buf=i.buf.replace(this.reg,t)),this.val},t.print=function(){this.puts&&this.puts.push(i.buf.length),i.print(this.gen)},t},i.ln=function(){i.print("\n"+i.indentBuf)},i.indent=function(){i.indentBuf+=i.indentStr,i.print("\n"+i.indentBuf)},i.dedent=function(){var e=i.indentStr.length;if(!i.buf.substring(i.buf.length-e).match(/^\s*$/))throw console.log(i.buf),new Error("Non-space truncated ");i.buf=i.buf.substring(0,i.buf.length-e),i.indentBuf=i.indentBuf.substring(0,i.indentBuf.length-e)},i.toLiteral=function(e,t){if(t||(t="'"),"string"!=typeof e)throw console.log("no literal ",e),new Error("toLiteral:"+e+" is not a literal");return e=e.replace(/\\/g,"\\\\"),e=e.replace(/\r/g,"\\r"),e=e.replace(/\n/g,"\\n"),e="'"==t?e.replace(/'/g,"\\'"):e.replace(/"/g,'\\"'),t+e+t},i.indentBuf="",i.indentStr="  ",i.close=function(){return i.mapStr=i.srcmap.toString(),i.mapFile&&i.dstFile&&(i.mapFile.text(i.mapStr),i.printf("%n//# sourceMappingURL=%s%n",i.mapFile.relPath(i.dstFile.up()))),i.dstFile&&i.dstFile.text(i.buf),i.buf},i}}),requireSimulator.setName("disp"),"function"!=typeof define&&(define=require("requirejs").define),define(["IndentBuffer"],function(e){return disp=function(t){function n(e){if(null==e)return r("null%n");if("string"==typeof e)return r("'%s'%n",e);if("number"==typeof e)return r("%s%n",e);if("function"==typeof e)return r("func%n");r(e instanceof Array?"[%{":"{%{");var t="";for(var i in e)r(t+i+":"),n(e[i]);r(e instanceof Array?"%}]%n":"%}}%n")}var r=e();return n(t),r.buf}}),requireSimulator.setName("Parser"),"function"!=typeof define&&(define=require("requirejs").define),define(["disp"],function(){return Parser=function(){function e(e,t){var n;for(n in t)e[n]=t[n];return e}function t(e){this.parse=i.options.traceTap?function(t){console.log("tap: name="+this.name+"  pos="+(t?t.pos:"?"));var n=e.apply(this,[t]),r="NOIMG";return n.src&&n.src.str&&(r=n.src.str.substring(n.pos-3,n.pos)+"^"+n.src.str.substring(n.pos,n.pos+3)),n.src&&n.src.tokens&&(r=n.src.tokens[n.pos-1]+"["+n.src.tokens[n.pos]+"]"+n.src.tokens[n.pos+1]),console.log("/tap: name="+this.name+" pos="+(t?t.pos:"?")+"->"+(n?n.pos:"?")+" "+r+" res="+(n?n.success:"?")),n}:e}function n(e,t){if(null==e)throw t+" is null!";return e}function r(e,t){null!=e&&(this.src={maxPos:0,global:t},"string"==typeof e&&(this.src.str=e),e instanceof Array&&(this.src.tokens=e),this.pos=0,this.result=[],this.success=!0)}var i={consoleBuffer:"",options:{traceTap:!1,optimizeFirst:!0,profile:!1,verboseFirst:!1,traceFirstTbl:!1},Parser:t,StringParser:o,nc:n};i.dispTbl=function(e){var t="",n={};if(!e)return t;for(var r in e){var i=e[r].name;n[i]||(n[i]=""),n[i]+=r}for(var i in n)t+=n[i]+"->"+i+",";return t},t.create=function(e){return new t(e)},i.create=t.create,e(t.prototype,{except:function(e){var n=this;return this.ret(t.create(function(t){return e.apply({},t.result)&&(t.success=!1),t}).setName("(except "+n.name+")"))},noFollow:function(e){var r=this;return n(e,"p"),this.ret(t.create(function(t){var n=e.parse(t);return t.success=!n.success,t}).setName("("+r.name+" noFollow "+e.name+")"))},andNoUnify:function(e){n(e,"next");var r=this,i=t.create(function(t){var n=r.parse(t);if(!n.success)return n;var i=e.parse(n);return i.success&&(i.result=n.result.concat(i.result)),i});return i.setName("("+this.name+" "+e.name+")")},and:function(e){var n=this.andNoUnify(e);if(!this._first)return n;var r=this._first.tbl,o={};for(var s in r)o[s]=r[s].andNoUnify(e);return n=t.fromFirst(this._first.space,o),n.setName("("+this.name+" >> "+e.name+")"),i.options.verboseFirst&&console.log("Created aunify name="+n.name+" tbl="+i.dispTbl(o)),n},retNoUnify:function(e){var n,r=this;n="function"==typeof e?t.create(function(t){var n=t.clone();return n.result=[e.apply({},t.result)],n}).setName("retfunc"):e;var i=t.create(function(e){var t=r.parse(e);return t.success?n.parse(t):t}).setName("("+this.name+" >= "+n.name+")");return i},ret:function(e){if(!this._first)return this.retNoUnify(e);var n=this._first.tbl,r={};for(var o in n)r[o]=n[o].retNoUnify(e);return res=t.fromFirst(this._first.space,r),res.setName("("+this.name+" >>= "+e.name+")"),i.options.verboseFirst&&console.log("Created runify name="+res.name+" tbl="+i.dispTbl(r)),res},first:function(e,n){if(!i.options.optimizeFirst)return this;if(null==e)throw"Space is null2!";if("string"==typeof n){for(var r={},o=0;o<n.length;o++)r[n.substring(o,o+1)]=this;return t.fromFirst(e,r).setName("(fst "+this.name+")")}if(null==n)return t.fromFirst(e,{ALL:this}).setName("(fst "+this.name+")");if("object"==typeof n)throw"this._first={space: space, tbl:ct}";return this},firstTokens:function(e){if(!i.options.optimizeFirst)return this;"string"==typeof e&&(e=[e]);var n={};if(e){var r=this;e.forEach(function(e){n[e]=r})}else n.ALL=this;return t.fromFirstTokens(n).setName("(fstT "+this.name+")")},unifyFirst:function(n){function r(e,t){return e?t?e.orNoUnify(t).checkTbl():e:t}function o(){var e=n._first.tbl,t={};for(var i in s)t[i]=1;for(var i in e)t[i]=1;delete t.ALL,(s.ALL||e.ALL)&&(s.ALL=r(s.ALL,e.ALL));for(var i in t)s[i]&&e[i]?s[i]=r(s[i],e[i]):s[i]&&!e[i]?s[i]=r(s[i],e.ALL):!s[i]&&e[i]&&(s[i]=r(s.ALL,e[i]))}var s={};this.checkTbl(),n.checkTbl(),e(s,this._first.tbl),o();var a=t.fromFirst(this._first.space,s).setName("("+this.name+")U("+n.name+")");return i.options.verboseFirst&&console.log("Created unify name="+a.name+" tbl="+i.dispTbl(s)),a},or:function(e){return n(e,"other"),this._first&&e._first&&this._first.space&&this._first.space===e._first.space?this.unifyFirst(e):(i.options.verboseFirst&&console.log("Cannot unify"+this.name+" || "+e.name+" "+this._first+" - "+e._first),this.orNoUnify(e))},orNoUnify:function(e){var n=this,r=t.create(function(t){var r=n.parse(t);if(r.success)return r;var i=e.parse(t);return i});return r.name="("+this.name+")|("+e.name+")",r},setName:function(e){return this.name=e,this._first,this},profile:function(e){return i.options.profile&&(this.parse=this.parse.profile(e||this.name)),this},repN:function(e){var n=this;e||(e=0);var r=t.create(function(t){for(var r=t,i=[];;){var o=n.parse(r);if(!o.success){var s;return i.length>=e?(s=r.clone(),s.result=[i],s.success=!0,s):(s=t.clone(),s.success=!1,s)}i.push(o.result[0]),r=o}});return r.setName("("+n.name+" * "+e+")")},rep0:function(){return this.repN(0)},rep1:function(){return this.repN(1)},opt:function(){var e=this;return t.create(function(t){var n=e.parse(t);return n.success?n:(t=t.clone(),t.success=!0,t.result=[null],t)}).setName("("+e.name+")?")},sep1:function(e,t){var r=this;n(r,"value"),n(e,"sep");var i=e.and(r).ret(function(e,n){return t?n:{sep:e,value:n}});return r.and(i.rep0()).ret(function(e,n){var r;if(t){var i=[e];for(r in n)i.push(n[r]);return i}return{head:e,tails:n}}).setName("(sep1 "+r.name+"~~"+e.name+")")},sep0:function(e){return this.sep1(e,!0).opt().ret(function(e){return e?e:[]})},tap:function(e){return this},retN:function(e){return this.ret(function(){return arguments[e]})},parseStr:function(e,t){var n=new r(e,t);return this.parse(n)},checkTbl:function(){if(!this._first)return this;var e=this._first.tbl;for(var t in e)if(!e[t].parse)throw this.name+": tbl."+t+" is not a parser :"+e[t];return this}}),e(r.prototype,{clone:function(){var e=new r;return e.src=this.src,e.pos=this.pos,e.result=this.result.slice(),e.success=this.success,e},updateMaxPos:function(e){e>this.src.maxPos&&(this.src.maxPos=e)},isSuccess:function(){return this.success},getGlobal:function(){return this.src.global||(this.src.global={}),this.src.global}}),t.fromFirst=function(e,n){if("TOKEN"==e)return t.fromFirstTokens(n);var r=t.create(function(t){var r=e.parse(t),o=r.src.str.substring(r.pos,r.pos+1);return i.options.traceFirstTbl&&console.log(this.name+": first="+o+" tbl="+(n[o]?n[o].name:"-")),n[o]?n[o].parse(r):n.ALL?n.ALL.parse(r):(r.success=!1,r)});return r._first={space:e,tbl:n},r.checkTbl(),r},t.fromFirstTokens=function(e){var n=t.create(function(t){var n=t.src.tokens[t.pos],r=n?n.type:null;return i.options.traceFirstTbl&&console.log(this.name+": firstT="+r+" tbl="+(e[r]?e[r].name:"-")),null!=r&&e[r]?e[r].parse(t):e.ALL?e.ALL.parse(t):(t.success=!1,t)});return n._first={space:"TOKEN",tbl:e},n.checkTbl(),n};var o={empty:t.create(function(e){var t=e.clone();return t.success=!0,t.result=[null],t}).setName("E"),fail:t.create(function(e){return e.success=!1,e}).setName("F"),str:function(e){return this.strLike(function(t,n){return t.substring(n,n+e.length)===e?{len:e.length}:null}).setName(e)},reg:function(e){return(e+"").match(/^\/\^/)||console.log("Waring regex should have ^ at the head:"+(e+"")),this.strLike(function(t,n){var r=e.exec(t.substring(n));return r?(r.len=r[0].length,r):null}).setName(e+"")},strLike:function(n){return t.create(function(t){var r=t.src.str;if(null==r)throw"strLike: str is null!";var o=t.pos,s=n(r,o,t);if(i.options.traceToken&&console.log("pos="+o+" r="+s),s){i.options.traceToken&&console.log("str:succ"),s.pos=o,s.src=t.src;var a=t.clone();return e(a,{pos:o+s.len,success:!0,result:[s]}),t.updateMaxPos(a.pos),a}return i.options.traceToken&&console.log("str:fail"),t.success=!1,t}).setName("STRLIKE")},parse:function(e,t,n){var i=new r(t,n);return e.parse(i)}};o.eof=o.strLike(function(e,t){return t==e.length?{len:0}:null}).setName("EOF"),i.StringParser=o;var s={token:function(e){return t.create(function(t){var n=t.src.tokens[t.pos];return t.success=!1,n?(n.type==e&&(t=t.clone(),t.updateMaxPos(t.pos),t.pos++,t.success=!0,t.result=[n]),t):t}).setName(e).firstTokens(e)},parse:function(e,t,n){var i=new r(t,n);return e.parse(i)},eof:t.create(function(e){var t=e.pos>=e.src.tokens.length;return e.success=t,t&&(e=e.clone(),e.result=[{type:"EOF"}]),e}).setName("EOT")};return i.TokensParser=s,i.lazy=function(e){var n=null;return t.create(function(t){if(n||(n=e()),!n)throw e+" returned null!";return this.name=e.name,n.parse(t)}).setName("LZ")},i.addRange=function(e,t){if(null==t)return e;if("number"!=typeof e.pos)return e.pos=t.pos,e.len=t.len,e;var n=t.pos+t.len,r=e.pos+e.len;return t.pos<e.pos&&(e.pos=t.pos),n>r&&(e.len=n-e.pos),e},i.setRange=function(e){if(null!=e&&"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e){var t=i.getRange(e);if(null!=t)return e;for(var n in e)if(e.hasOwnProperty(n)){var r=i.setRange(e[n]);i.addRange(e,r)}return e}},i.getRange=function(e){return null==e?null:"number"!=typeof e.pos?null:"number"==typeof e.len?e:null},i}()}),requireSimulator.setName("Grammar"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(e){return Grammar=function(){function t(e){return"string"==typeof e?r.get(e):e}var n=e,r=null;return r=function(n){var i={};return i.ands=function(){for(var i=t(arguments[0]),o=1;o<arguments.length;o++)i=i.and(t(arguments[o]));i=i.tap(n),r.defs[n]=i;var s={};return s.autoNode=function(){var t=i.ret(function(){for(var t={type:n},r=0;r<arguments.length;r++){var i=arguments[r],o=e.setRange(i);e.addRange(t,o),t["-element"+r]=i}t.toString=function(){return"("+this.type+")"}}).setName(n);return r.defs[n]=t},s.ret=function(t){if(0==arguments.length)return i;if("function"==typeof t)return r.defs[n]=i.ret(t);for(var o=[],s=function(e){return e},a=0;a<arguments.length;a++){if("function"==typeof arguments[a]){s=arguments[a];break}o[a]=arguments[a]}var u=i.ret(function(){var t={type:n};t[Grammar.SUBELEMENTS]=[];for(var r=0;r<arguments.length;r++){var i=arguments[r],a=e.setRange(i);e.addRange(t,a),o[r]&&(t[o[r]]=i),t[Grammar.SUBELEMENTS].push(i)}return t.toString=function(){return"("+this.type+")"},s(t)}).setName(n);return r.defs[n]=u},s},i.ors=function(){for(var e=t(arguments[0]),i=1;i<arguments.length;i++)e=e.or(t(arguments[i]));return r.defs[n]=e.setName(n)},i},r.defs={},r.get=function(e){return r.defs[e]?r.defs[e]:n.lazy(function(){var t=r.defs[e];if(!t)throw"grammar named '"+e+"' is undefined";return t}).setName("(Lazy of "+e+")")},r},Grammar.SUBELEMENTS="[SUBELEMENTS]",Grammar}),requireSimulator.setName("XMLBuffer"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(e){return XMLBuffer=function(t){var n;return n=function(r,i){if(null!=r&&"string"!=typeof r&&"number"!=typeof r){var o=e.getRange(r);if(o)for(;n.srcLen<o.pos;)n.src(t.substring(n.srcLen,o.pos));if(null!=r){if(i&&n.startTag("attr_"+i),r.type&&n.startTag(r.isToken?"token_"+r.type:r.type+""),r.text)n.src(o.text);else{var s=n.orderByPos(r);s.forEach(function(e){e.name&&e.name.match(/^-/)?n(e.value):n(e.value,e.name)})}if(o)for(;n.srcLen<o.pos+o.len;)n.src(t.substring(n.srcLen,o.pos+o.len));r.type&&n.endTag(r.isToken?"token_"+r.type:""+r.type),i&&n.endTag("attr_"+i)}}},n.orderByPos=XMLBuffer.orderByPos,n.src=function(e){n.buf+=e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"),n.srcLen+=e.length},n.tag=function(e){n.buf+=e},n.startTag=function(e){n.tag(e.match(/^[a-zA-Z_0-9]+$/)?"<"+e+">":"<token>")},n.endTag=function(e){n.tag(e.match(/^[a-zA-Z_0-9]+$/)?"</"+e+">":"</token>")},n.buf="",n.srcLen=0,n},XMLBuffer.orderByPos=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&null!=e[n]&&"string"!=typeof e[n]&&"number"!=typeof e[n]&&"number"==typeof e[n].pos&&t.push(isNaN(parseInt(n))&&!(n+"").match(/^-/)?{name:n,value:e[n]}:{value:e[n]});return t=t.sort(function(e,t){return e.value.pos-t.value.pos})},XMLBuffer.SUBELEMENTS="[SUBELEMENTS]",XMLBuffer}),requireSimulator.setName("TError"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return TError=function(e,t,n){if("string"==typeof t)return{isTError:!0,mesg:e,src:{name:function(){return t},text:function(){return t}},pos:n,toString:function(){return this.mesg+" at "+t+":"+this.pos},raise:function(){throw this}};var r=null;if(t&&t.src&&(r=t,t=r.src.tonyu),"function"!=typeof t.name)throw"src="+t+" should be file object";var i;if("function"==typeof t.text){var o=t.text();"string"==typeof o&&(i=TError.calcRowCol(o,n))}return{isTError:!0,mesg:e,src:t,pos:n,row:i.row,col:i.col,klass:r,toString:function(){return this.mesg+" at "+this.src.name()+":"+this.row+":"+this.col},raise:function(){throw this}}},TError.calcRowCol=function(e,t){var n,r,i=e.split("\n"),o=0;for(n=0;n<i.length;n++)if(o+=i[n].length+1,o>t){r=t-(o-i[n].length);break}return{row:n,col:r}},TError}),requireSimulator.setName("TT"),"function"!=typeof define&&(define=require("requirejs").define),define(["Grammar","XMLBuffer","IndentBuffer","disp","Parser","TError"],function(e,t,n,r,i){return TT=function(){function e(e,t){var n,i;"string"==typeof e?(n=a.str(e),e.length>0&&(i=e.substring(0,1)),t||(t=e)):(n=a.reg(e),t||(t=e+""));var o=f.and(n).ret(function(e,n){var i={};if(i.pos=n.pos,"number"!=typeof i.pos)throw"no pos for "+t+" "+r(n);if(i.len=n.len,i.text=n.src.str.substring(i.pos,i.pos+i.len),"string"!=typeof i.text)throw"no text("+i.text+") for "+t+" "+r(n);return i.toString=function(){return this.text},i.isToken=!0,i});return i&&(o=o.first(f,i)),o.setName(t)}function t(t,n,r){"string"==typeof r&&(r=e(r)),h[t]=o(h[t],r.ret(function(e){return e.type=n,e}).setName(n))}function n(e,n,r,i){n==u&&(n=r);for(var o=1;e>=o;o*=2)0!=(e&o)&&t(e&o,n,r,i);p[n]=i}function o(e,t){return e?e.or(t):t}function s(e){var t=((new Date).getTime(),i.StringParser.parse(d,e));return t.success||console.log("Stopped at "+e.substring(t.src.maxPos-5,t.src.maxPos+5)),t}var a=i.StringParser,u="SAMENAME",c=1,l=2,f=a.reg(/^(\s*(\/\*([^\/]|[^*]\/|\r|\n)*\*\/)*(\/\/.*\r?\n)*)*/).setName("space"),h={},p={},d=i.create(function(e){for(var t=l,n=[];;){if(e=h[t].parse(e),!e.success)break;var r=e.result[0];t=p[r.type],n.push(r)}return e=f.parse(e),e.success=e.src.maxPos==e.src.str.length,e.result[0]=n,e}),m={"function":!0,"var":!0,"return":!0,"typeof":!0,"if":!0,__typeof:!0,"for":!0,"else":!0,"super":!0,"while":!0,"continue":!0,"break":!0,"do":!0,"switch":!0,"case":!0,"default":!0,"try":!0,"catch":!0,"finally":!0,"throw":!0,of:!0,"in":!0,fiber:!0,"native":!0,"instanceof":!0,"new":!0,is:!0,"true":!0,"false":!0,"null":!0,"this":!0,undefined:!0,usethread:!0,constructor:!0,ifwait:!0,nowait:!0,_thread:!0,arguments:!0,"delete":!0,"extends":!0,includes:!0},g=e(/^[0-9][xb]?[0-9a-f\.]*/i).ret(function(e){return e.type="number",e.value=e.text-0,e}).first(f,"0123456789"),v=e({exec:function(e){var t=e.substring(0,1);if('"'!==t&&"'"!==t)return!1;for(var n=1;n<e.length;n++){var r=e.substring(n,n+1);if(r===t)return[e.substring(0,n+1)];"\\"===r&&n++}return!1},toString:function(){return"literal"}}).first(f,"\"'"),y=e({exec:function(e){if("/"!==e.substring(0,1))return!1;for(var t=1;t<e.length;t++){var n=e.substring(t,t+1);if("/"===n){var r=/^[ig]*/.exec(e.substring(t+1));return[e.substring(0,t+1+r[0].length)]}if("\n"==n)return!1;"\\"===n&&t++}return!1},toString:function(){return"regex"}}).first(f,"/");n(l|c,"number",g,c),n(l,"regex",y,c),n(l|c,"literal",v,c),n(l|c,u,"++",c),n(l|c,u,"--",c),n(l|c,u,"!==",l),n(l|c,u,"===",l),n(l|c,u,"+=",l),n(l|c,u,"-=",l),n(l|c,u,"*=",l),n(l|c,u,"/=",l),n(l|c,u,"%=",l),n(l|c,u,">=",l),n(l|c,u,"<=",l),n(l|c,u,"!=",l),n(l|c,u,"==",l),n(l|c,u,">>",l),n(l|c,u,"<<",l),n(l|c,u,"&&",l),n(l|c,u,"||",l),n(l|c,u,"(",l),n(l|c,u,")",c),n(l|c,u,"[",l),n(l|c,u,"]",c),n(l|c,u,"{",l),n(l|c,u,"}",c),n(l|c,u,">",l),n(l|c,u,"<",l),n(l|c,u,"+",l),n(l|c,u,"-",l),n(l|c,u,".",l),n(l|c,u,"?",l),n(l|c,u,"=",l),n(l|c,u,"*",l),n(l|c,u,"%",l),n(c,u,"/",l),n(c|l,u,"^",l),n(c|l,u,"~",l),n(c|l,u,"\\",l),n(c|l,u,":",l),n(c|l,u,";",l),n(c|l,u,",",l),n(l|c,u,"!",l),n(l|c,u,"&",l),n(l|c,u,"|",l);var b=e(/^[a-zA-Z_$][a-zA-Z0-9_$]*/,"symresv_reg").ret(function(e){return e.type="constructor"==e.text?"tk_constructor":m.hasOwnProperty(e.text)?e.text:"symbol",e}).first(f);for(var _ in m)p[_]=l;return p.tk_constructor=l,p.symbol=c,h[l]=o(h[l],b),h[c]=o(h[c],b),{parse:s,extension:"js"}}()}),requireSimulator.setName("ExpressionParser"),"function"!=typeof define&&(define=require("requirejs").define),define(["Parser"],function(e){return ExpressionParser=function(){function t(e,t){var n={};return n.eq=function(n){return e==n.type()&&t==n.prio()},n.type=function(t){return t?t==e:e},n.prio=function(){return t},n.toString=function(){return"["+e+":"+t+"]"},n}function n(e){var t={},n=e;return t.add=function(e){n=n?n.or(e):e},t.get=function(){return n},t}function r(){var r=n(),i={};return i.reg=function(n,i,o){var s=t(n,i);r.add(o.ret(e.create(function(e){return e.opType=s,e})).setName("(opType "+s+" "+o.name+")"))},i.get=function(){return r.get()},i.parse=function(e){return i.get().parse(e)},i}function i(e,t){return}function o(e,t){var n,r=t;if(i(t," start minprio= "+e),t=a.parse(t),i(t," prefixorelem "+e),!t.isSuccess())return t;if(n=t.opType,n.type("prefix")){if(pre=t.result[0],t=o(n.prio(),t),!t.isSuccess())return t;var c=s.mkPrefix.def(pre,t.result[0]);if(r=t.clone(),r.result=[c],!t.nextPostfixOrInfix)return r;t=t.nextPostfixOrInfix}else if(r=t.clone(),t=u.parse(t),!t.isSuccess())return r;for(;;){if(i(t,"st:pi"),i(r,"res:ex"),n=t.opType,n.prio()<e)return r.nextPostfixOrInfix=t,r;if(n.type("postfix")){var c=s.mkPostfix.def(r.result[0],t.result[0]);if(r=t.clone(),r.result=[c],i(t,"185"),t=u.parse(t),!t.isSuccess())return r}else if(n.type("infixl")){var f=t.result[0];if(t=o(n.prio()+1,t),!t.isSuccess())return r;var c=s.mkInfixl.def(r.result[0],f,t.result[0]);if(r=t.clone(),r.result=[c],!t.nextPostfixOrInfix)return r;t=t.nextPostfixOrInfix}else if(n.type("infixr")){var f=t.result[0];if(t=o(n.prio(),t),!t.isSuccess())return r;var c=s.mkInfixr.def(r.result[0],f,t.result[0]);if(r=t.clone(),r.result=[c],!t.nextPostfixOrInfix)return r;t=t.nextPostfixOrInfix}else if(n.type("trifixr")){var h=r.result[0],p=t.result[0];if(t=o(n.prio()+1,t),!t.isSuccess())return r;var d=t.result[0],t=l[n.prio()].parse(t);if(!t.isSuccess())return r;var m=t.result[0];if(t=o(n.prio(),t),!t.isSuccess())return r;var g=t.result[0],c=s.mkTrifixr.def(h,p,d,m,g);if(r=t.clone(),r.result=[c],!t.nextPostfixOrInfix)return r;t=t.nextPostfixOrInfix}else{var f=t.result[0];if(t=o(n.prio()+1,t),!t.isSuccess())return r;var c=s.mkInfix.def(r.result[0],f,t.result[0]);if(r=t.clone(),r.result=[c],!t.nextPostfixOrInfix)return r;if(t=t.nextPostfixOrInfix,n.prio()==t.opType.prio())return r.success=!1,r}}}var s={},a=r(),u=r(),c=n(),l=[];return s.element=function(e){a.reg("element",-1,e),c.add(e)},s.getElement=function(){return c.get()},s.prefix=function(e,t){a.reg("prefix",e,t)},s.postfix=function(e,t){u.reg("postfix",e,t)},s.infixl=function(e,t){u.reg("infixl",e,t)},s.infixr=function(e,t){u.reg("infixr",e,t)},s.infix=function(e,t){u.reg("infix",e,t)},s.trifixr=function(e,t,n){u.reg("trifixr",e,t),l[e]=n},s.custom=function(){},s.mkInfix=function(e){s.mkInfix.def=e},s.mkInfix.def=function(t,n,r){return e.setRange({type:"infix",op:n,left:t,right:r})},s.mkInfixl=function(e){s.mkInfixl.def=e},s.mkInfixl.def=function(t,n,r){return e.setRange({type:"infixl",op:n,left:t,right:r})},s.mkInfixr=function(e){s.mkInfixr.def=e},s.mkInfixr.def=function(t,n,r){return e.setRange({type:"infixr",op:n,left:t,right:r})},s.mkPrefix=function(e){s.mkPrefix.def=e},s.mkPrefix.def=function(t,n){return e.setRange({type:"prefix",op:t,right:n})},s.mkPostfix=function(e){s.mkPostfix.def=e},s.mkPostfix.def=function(t,n){return e.setRange({type:"postfix",left:t,op:n})},s.mkTrifixr=function(e){s.mkTrifixr.def=e},s.mkTrifixr.def=function(t,n,r,i,o){return e.setRange({type:"trifixr",left:t,op1:n,mid:r,op2:i,right:o})},s.build=function(){return s.built=e.create(function(e){return o(0,e)}).setName("ExpBuilt"),s.built},s.lazy=function(){return e.create(function(e){return s.built.parse(e)})},s}}),requireSimulator.setName("TonyuLang"),"function"!=typeof define&&(define=require("requirejs").define),define(["Grammar","XMLBuffer","IndentBuffer","TT","disp","Parser","ExpressionParser","TError"],function(e,t,n,r,i,o,s,a){return TonyuLang=function(){function n(e){return function(){return arguments[e]}}function u(e){return e.sep0(m(","),!0).and(m(",").opt()).ret(function(e){return e})}function c(e,t){var n=[];if(e&&!e.args)throw i(e);if(e){var r=o.getRange(e);o.addRange(n,r),e.args.forEach(function(e){n.push(e)})}return t.forEach(function(e){var t=o.getRange(e);o.addRange(n,t),n.push(e.obj)}),n}function l(e,t,n){var r={type:"infix",left:e,op:t,right:n};return o.setRange(r),r.toString=function(){return"("+e+t+n+")"},r}var f=o,h={},p=e(),d=p.get,m=(f.StringParser,f.TokensParser.token),g=m("number").ret(function(e){if(e.type="number","string"!=typeof e.text)throw"No text for "+i(e);if(e.value=e.text-0,isNaN(e.value))throw"No value for "+i(e);return e}),v=m("symbol"),y=m("==="),b=m("!=="),_=m("=="),w=m("!="),x=m(">="),S=m("<="),T=m(">"),A=m("<"),E=m("&&"),k=m("||"),C=m("-"),P=m("+"),D=m("*"),M=m("/"),B=m("%"),N=m("="),I=m("literal"),O=m("regex"),L=s(),R=p("arrayElem").ands(m("["),L.lazy(),m("]")).ret(null,"subscript"),F=p("argList").ands(m("("),u(L.lazy()),m(")")).ret(null,"args"),j=p("member").ands(m("."),v).ret(null,"name"),z=p("parenExpr").ands(m("("),L.lazy(),m(")")).ret(null,"expr"),U=p("varAccess").ands(v).ret("name"),G=d("funcExpr").firstTokens(["function","\\"]),W=p("funcExprArg").ands(G).ret("obj"),V=d("objlit").firstTokens("{"),q=p("objlitArg").ands(V).ret("obj"),$=q.or(W),Z=F.and($.rep0()).ret(function(e,t){return c(e,t)}).or($.rep1().ret(function(e){return c(null,e)})),H=(F.or(q),p("call").ands(Z).ret("args")),J=p("scall").ands(Z).ret("args"),K=p("newExpr").ands(m("new"),U,H.opt()).ret(null,"klass","params"),X=p("superExpr").ands(m("super"),m(".").and(v).ret(n(1)).opt(),J).ret(null,"name","params"),Y=m("true").or(m("false")).or(m("null")).or(m("undefined")).or(m("_thread")).or(m("this")).or(m("arguments")).ret(function(e){return e.type="reservedConst",e});L.element(g),L.element(Y),L.element(O),L.element(I),L.element(z),L.element(K),L.element(X),L.element(G),L.element(V),L.element(d("arylit").firstTokens("[")),L.element(U);var Q=0;L.infixr(Q,N),L.infixr(Q,m("+=")),L.infixr(Q,m("-=")),L.infixr(Q,m("*=")),L.infixr(Q,m("/=")),L.infixr(Q,m("%=")),L.infixr(Q,m("|=")),L.infixr(Q,m("&=")),Q++,L.trifixr(Q,m("?"),m(":")),Q++,L.infixl(Q,k),Q++,L.infixl(Q,E),Q++,L.infix(Q,m("instanceof")),L.infix(Q,m("is")),L.infix(Q,y),L.infix(Q,b),L.infix(Q,_),L.infix(Q,w),L.infix(Q,x),L.infix(Q,S),L.infix(Q,T),L.infix(Q,A),Q++,L.postfix(Q+3,m("++")),L.postfix(Q+3,m("--")),L.infixl(Q,C),L.infixl(Q,P),Q++,L.infixl(Q,D),L.infixl(Q,M),L.infixl(Q,B),Q++,L.prefix(Q,m("typeof")),L.prefix(Q,m("__typeof")),L.prefix(Q,m("delete")),L.prefix(Q,m("++")),L.prefix(Q,m("--")),L.prefix(Q,m("+")),L.prefix(Q,m("-")),L.prefix(Q,m("!")),Q++,Q++,L.postfix(Q,H),L.postfix(Q,j),L.postfix(Q,R),L.mkInfixl(l),L.mkInfixr(l);{var et=L.build().setName("expr").profile(),n=function(e){return function(){return arguments[e]}},tt=d("stmt").firstTokens();p("exprstmt").ands(et,m(";")).ret("expr")}p("compound").ands(m("{"),tt.rep0(),m("}")).ret(null,"stmts");var nt=m("else").and(tt).ret(n(1)),rt=(p("return").ands(m("return"),et.opt(),m(";")).ret(null,"value"),p("if").ands(m("if"),m("("),et,m(")"),tt,nt.opt()).ret(null,null,"cond",null,"then","_else"),p("forin").ands(m("var").opt(),v.sep1(m(","),!0),m("in").or(m("of")),et).ret("isVar","vars","inof","set")),it=p("normalFor").ands(tt,et.opt(),m(";"),et.opt()).ret("init","cond",null,"next"),ot=it.or(rt),st=(p("for").ands(m("for"),m("("),ot,m(")"),"stmt").ret(null,null,"inFor",null,"loop"),p("while").ands(m("while"),m("("),et,m(")"),"stmt").ret(null,null,"cond",null,"loop"),p("do").ands(m("do"),"stmt",m("while"),m("("),et,m(")"),m(";")).ret(null,"loop",null,null,"cond",null,null),p("case").ands(m("case"),et,m(":"),tt.rep0()).ret(null,"value",null,"stmts")),at=p("default").ands(m("default"),m(":"),tt.rep0()).ret(null,null,"stmts"),ut=(p("switch").ands(m("switch"),m("("),et,m(")"),m("{"),st.rep1(),at.opt(),m("}")).ret(null,null,"value",null,null,"cases","defs"),p("break").ands(m("break"),m(";")).ret("brk"),p("continue").ands(m("continue"),m(";")).ret("cont"),p("finally").ands(m("finally"),"stmt").ret(null,"stmt"),p("catch").ands(m("catch"),m("("),v,m(")"),"stmt").ret(null,null,"name",null,"stmt"),p("catches").ors("catch","finally")),ct=(p("try").ands(m("try"),"stmt",ut.rep1()).ret(null,"stmt","catches"),p("throw").ands(m("throw"),et,m(";")).ret(null,"ex"),p("typeExpr").ands(v).ret("name")),lt=p("typeDecl").ands(m(":"),ct).ret(null,"vtype"),ft=p("varDecl").ands(v,lt.opt(),m("=").and(et).ret(n(1)).opt()).ret("name","typeDecl","value"),ht=(p("varsDecl").ands(m("var"),ft.sep1(m(","),!0),m(";")).ret(null,"decls"),p("paramDecl").ands(v,lt.opt()).ret("name","typeDecl")),pt=p("paramDecls").ands(m("("),u(ht),m(")")).ret(null,"params"),dt=p("setterDecl").ands(m("="),ht).ret(null,"value");p("funcDeclHead").ands(m("nowait").opt(),m("function").or(m("fiber")).or(m("tk_constructor")).or(m("\\")).opt(),v.or(m("new")),dt.opt(),pt.opt(),lt.opt()).ret("nowait","ftype","name","setter","params","rtype");p("funcDecl").ands("funcDeclHead","compound").ret("head","body"),p("nativeDecl").ands(m("native"),v,m(";")).ret(null,"name"),p("ifWait").ands(m("ifwait"),"stmt",nt.opt()).ret(null,"then","_else"),p("empty").ands(m(";")).ret(null);tt=p("stmt").ors("return","if","for","while","do","break","continue","switch","ifWait","try","throw","nativeDecl","funcDecl","compound","exprstmt","varsDecl","empty"),p("funcExprHead").ands(m("function").or(m("\\")),v.opt(),pt.opt()).ret(null,"name","params");var mt=(p("funcExpr").ands("funcExprHead","compound").ret("head","body"),p("jsonElem").ands(v.or(I),m(":").or(m("=")).and(et).ret(function(e,t){return t}).opt()).ret("key","value")),gt=(p("objlit").ands(m("{"),u(mt),m("}")).ret(null,"elems"),p("arylit").ands(m("["),u(et),m("]")).ret(null,"elems"),p("extends").ands(m("extends"),v.or(m("null")),m(";")).ret(null,"superclassName")),vt=p("includes").ands(m("includes"),v.sep1(m(","),!0),m(";")).ret(null,"includeClassNames"),yt=p("program").ands(gt.opt(),vt.opt(),tt.rep0(),o.TokensParser.eof).ret("ext","incl","stmts");for(var bt in p.defs)p.defs[bt].profile();return h.parse=function(e){str="string"==typeof e?e:e.text(),str+="\n";var t=r.parse(str);if(!t.isSuccess())throw a("文法エラー(Token)",e,t.src.maxPos);var n=t.result[0],i=f.TokensParser.parse(yt,n);if(i.isSuccess()){var o=i.result[0];return o}var s=n[i.src.maxPos],u=s?s.pos+s.len:str.length;throw a("文法エラー",e,u)},h.genXML=function(e,n){var r=t(e);return r(n),r.buf},h.extension="tonyu",h}()}),requireSimulator.setName("ObjectMatcher"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return ObjectMatcher=function(){function e(e,t){var n={};return n[i]=e,t&&(n[o]=t),n}function t(e){return e&&e[i]}function n(e,t,r){if(e===t)return!0;if(null==e)return!1;if("string"==typeof e&&t instanceof RegExp)return e.match(t);if("function"==typeof t)return t(e,r);if("object"==typeof t){for(var s in t)if(s!=i){var a=s==o?e:e[s],u=t[s];if(!n(a,u,r))return!1}return t[i]&&(r[t[i]]=e),!0}return!1}var r={},i="$var",o="$this";r.v=e,r.isVar=t;for(var s="ABCDEFGHIJKLMNOPQRSTUVWXYZ",a=0;a<s.length;a++){var u=s.substring(a,a+1);r[u]=e(u)}return r.match=function(e,t){var r={};return n(e,t,r)?r:null},r}()}),requireSimulator.setName("context"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return context=function(){function e(e,n){var r={};for(var i in e)i.match(/^\$/)?(i=RegExp.rightContext,r[i]=t[i],t[i]=t.ovrFunc(t[i],e[i])):(r[i]=t[i],t[i]=e[i]);var o=n(t);for(var i in r)t[i]=r[i];return o}var t={};t.ovrFunc=function(e,t){return t.parent=e,t},t.enter=e;var n={};t.clear=function(){for(var e in t)n[e]||delete t[e]};for(var r in t)n[r]=!0;return t}}),requireSimulator.setName("Visitor"),"function"!=typeof define&&(define=require("requirejs").define),define([],function(){return Visitor=function(e){var t={funcs:e,path:[]};return t.visit=function(n){try{t.path.push(n),t.debug&&console.log("visit ",n.type,n.pos);var r=n?e[n.type]:null;if(r)return r.call(t,n);if(t.def)return t.def.call(t,n)}finally{t.path.pop()}},t.replace=function(e){return t.def||(t.def=function(e){if("object"==typeof e)for(var n in e)e[n]&&"object"==typeof e[n]&&(e[n]=t.visit(e[n]));return e}),t.visit(e)},t}}),requireSimulator.setName("Tonyu.Compiler"),define(["Tonyu","ObjectMatcher","TError"],function(e){function t(e,t){var n={type:e};if(t)for(var r in t)n[r]=t[r];return n.name||(n.name=o("_"+e+"_")),n}function n(e){return e?e.type:null}function r(e){var t=function(){};return t.prototype=e,new t}function i(e,t){if(!e)throw t+" is null";return e}function o(e){return e+(p++ +"").replace(/\./g,"")}function s(e,t,n){t._id||(e._idseq||(e._idseq=0),t._id=++e._idseq);var r=e[t._id];if(r||(r=e[t._id]={node:t}),n)for(var i in n)r[i]=n[i];return r}function a(e,t){return e.substring(t.pos,t.pos+t.len)}function u(e,t){var n=null;return c(e).forEach(function(e){n||(n=e.decls.methods[t])}),n}function c(e){function t(e){n[e.fullName]||(n[e.fullName]=!0,r.push(e),e.superclass&&t(e.superclass),e.includes&&e.includes.forEach(t))}var n={},r=[];return t(e),r}function l(e){var t=[];if(!e.head)return t;e.head.setter&&t.push(e.head.setter.value);var n=e.head.params?e.head.params.params:null;
if(n&&!n.forEach)throw new Error(e+" is not array ");return n&&(t=t.concat(n)),t}var f={};e.Compiler=f;var h={FIELD:"field",METHOD:"method",NATIVE:"native",LOCAL:"local",THVAR:"threadvar",PARAM:"param",GLOBAL:"global",CLASS:"class",MODULE:"module"};f.ScopeTypes=h;var p=1;return f.newScopeType=t,f.getScopeType=n,f.newScope=r,f.nullCheck=i,f.genSym=o,f.extend=function(e,t){for(var n in t)e[n]=t[n];return e},f.annotation=s,f.getSource=a,f.getField=function(t,n){if(t instanceof Function)return null;var r=null;return c(t).forEach(function(e){r||(r=e.decls.fields[n])}),"string"==typeof r.vtype&&(r.vtype=e.classMetas[r.vtype]||window[r.vtype]),r},f.getMethod=u,f.getDependingClasses=c,f.getParams=l,f}),requireSimulator.setName("Tonyu.Compiler.JSGenerator"),"function"!=typeof define&&(define=require("requirejs").define),define(["Tonyu","Tonyu.Iterator","TonyuLang","ObjectMatcher","TError","IndentBuffer","context","Visitor","Tonyu.Compiler","assert"],function(e,t,n,r,i,o,s,a,u,c){return u.JSGenerator=function(){function e(e,P){function D(e){return u.getSource(J,e)}function M(t,n){return C(e.annotation,t,n)}function B(e){return"string"==typeof e?w+(P.aliases[e]||e):e.builtin?e.fullName:w+e.fullName}function N(e){var t=[];return e.forEach(function(e){t.push(B(e))}),t}function I(e,t){return function(){Y.enter(e,function(){v.visit(t)})}}function O(e,r,i){var o=k(r);if(o==it.THVAR)K.printf("%s",t);else if(o==it.FIELD)K.printf("%s.%s",n,e);else if(o==it.METHOD)i&&i.noBind?K.printf("%s.%s",n,e):K.printf("%s(%s,%s.%s)",g,n,n,e);else if(o==it.CLASS)K.printf("%s",B(e));else if(o==it.GLOBAL)K.printf("%s%s",x,e);else{if(o!=it.PARAM&&o!=it.LOCAL&&o!=it.NATIVE&&o!=it.MODULE)throw console.log("Unknown scope type: ",o),new Error("Unknown scope type: "+o);K.printf("%s",e)}return r}function L(e){return function(){R.apply(this,[e])}}function R(e){"compound"==e.type?Y.enter({noWait:!0},function(){K.printf("%j%n",["%n",e.stmts])}):v.visit(e)}function F(t){return function(){Y.noLastPos||K.printf("%s%s=%s;//%s%n",P.options.compiler.commentLastPos?"//":"",p,tt.add(e,t.pos),e.fullName+":"+t.pos)}}function j(){Y.enter({},function(){if(at){X("define(function (require) {%{");var t={Tonyu:1};for(var n in e.decls.amds)t[n]=1;if(e.superclass){var n=e.superclass.shortName;t[n]=1}(e.includes||[]).forEach(function(e){var n=e.shortName;t[n]=1});for(var n in e.decls.softRefClasses)t[n]=1;for(var n in t)X("var %s=require('%s');%n",n,n)}X((at?"return ":"")+"Tonyu.klass.define({%{"),X("fullName: %l,%n",e.fullName),X("shortName: %l,%n",e.shortName),X("namespace: %l,%n",e.namespace),e.superclass&&X("superclass: %s,%n",B(e.superclass)),X("includes: [%s],%n",N(e.includes).join(",")),X("methods: {%{");for(var r in rt){Q&&console.log("method1",r);var i=rt[r];Y.enter({noWait:!0,threadAvail:!1},function(){G(i)}),Q&&console.log("method2",r),i.nowait||Y.enter({noWait:!1,threadAvail:!0},function(){U(i)}),Q&&console.log("method3",r)}X("__dummy: false%n"),X("%}},%n"),X("decls: %s%n",JSON.stringify(z(e))),X("%}});"),at&&X("%n%}});")})}function z(e){var t={methods:{},fields:{}};for(var n in e.decls.methods)t.methods[n]={nowait:!!e.decls.methods[n].nowait};for(var n in e.decls.fields){var r=e.decls.fields[n],i={};r.vtype&&(i.vtype="string"==typeof r.vtype?r.vtype:r.vtype.fullName||r.vtype.name),t.fields[n]=i}return t}function U(e){function r(){Y.enter({method:e,noWait:!0,threadAvail:!0},function(){s.forEach(function(e){X("%v%n",e)})})}function i(){Y.enter({method:e,finfo:e,pc:1},function(){a.forEach(function(e){X("%v%n",e)})})}if(!Z(e)){var o=e.stmts,s=[],a=[],u=s,c=!0;c?o.forEach(function(e){M(e).fiberCallRequired&&(u=a),u.push(e)}):a=o,X("%s%s :function %s(%j) {%{"+T+"var %s=%s;%n%svar %s=%s;%nvar %s=0;%n%f%n%f%n",f,e.name,V(e.pos,"f_"+e.name),[",",[ct].concat(e.params)],n,S,e.useArgs?"":"//",l,"Tonyu.A(arguments)",h,$(e),r),a.length>0?X("%s.enter(function %s(%s) {%{if (%s.lastEx) %s=%s.catchPC;%nfor(var %s=%d ; %s--;) {%{switch (%s) {%{%}case 0:%{%f%s.exit(%s);return;%n%}}%n%}}%n%}});%n",t,V(e.pos,"ent_"+e.name),t,t,h,t,d,m,d,h,i,t,n):X("%s.retVal=%s;return;%n",t,n),X("%}},%n")}}function G(e){function t(){Y.enter({method:e,finfo:e},function(){e.stmts.forEach(function(e){X("%v%n",e)})})}var r=Z(e)?"initialize":e.name;X("%s :function %s(%j) {%{"+T+"var %s=%s;%n%f%n%f%}},%n",r,V(e.pos,r),[",",e.params],n,S,$(e),t)}function W(e){function t(){Y.enter({noWait:!0,threadAvail:!1,finfo:n},function(){e.body.stmts.forEach(function(e){X("%v%n",e)})})}var n=M(e).info;K.printf("(function %s(%j) {%{%f%n%f%}})",n.name,[",",n.params],$(n),t)}function V(t,n){return n||(n=ot++ +""),"_trc_"+e.shortName+"_"+n}function q(e){function t(){Y.enter({noWait:!0,threadAvail:!1,finfo:n},function(){e.body.stmts.forEach(function(e){X("%v%n",e)})})}var n=M(e).info;K.printf("function %s(%j) {%{%f%n%f%}}",n.name,[",",n.params],$(n),t)}function $(e){function t(){Y.enter({},function(){for(var t in e.locals.varDecls)K.printf("var %s;%n",t);for(var t in e.locals.subFuncDecls)q(e.locals.subFuncDecls[t])})}return t}function Z(e){return et.match(e,{ftype:"constructor"})||et.match(e,{name:"new"})}var H=e.src.tonyu,J=H.text(),K=P.codeBuffer||o({fixLazyLength:6});K.setSrcFile(H);var X=K.printf,Y=s(),Q=!1,et=r,tt=P.traceTbl,nt=e.decls,rt=(nt.fields,nt.methods),it=(nt.natives,E),ot=0,st=P.options.compiler.diagnose,at=P.options.compiler.genAMD,ut=!P.options.compiler.noLoopCheck,ct={type:"THNode"};v=K.visitor=a({THNode:function(){K.printf(t)},dummy:function(e){K.printf("",e)},literal:function(e){K.printf("%s",e.text)},paramDecl:function(e){K.printf("%v",e.name)},paramDecls:function(e){K.printf("(%j)",[", ",e.params])},funcDeclHead:function(e){K.printf("function %v %v",e.name,e.params)},funcDecl:function(){},"return":function(e){if(Y.inTry)throw i("現実装では、tryの中にreturnは書けません",H,e.pos);Y.noWait?Y.threadAvail?e.value?K.printf("%s.retVal=%v;return;%n",t,e.value):K.printf("%s.retVal=%s;return;%n",t,n):e.value?K.printf("return %v;",e.value):K.printf("return %s;",n):e.value?K.printf("%s.exit(%v);return;",t,e.value):K.printf("%s.exit(%s);return;",t,n)},program:function(e){genClass(e.stmts)},number:function(e){K.printf("%s",e.value)},reservedConst:function(e){"this"==e.text?K.printf("%s",n):"arguments"==e.text&&Y.threadAvail?K.printf("%s",l):e.text==t?K.printf("%s",Y.threadAvail?t:"null"):K.printf("%s",e.text)},varDecl:function(e){var r=M(e),i=r.varInMain?n+".":"";if(e.value){var o=!Y.noWait&&M(e).fiberCall;o?(c.is(Y.pc,Number),K.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{%s%v=%s.retVal;%n",n,f,o.N,[", ",[ct].concat(o.A)],h,Y.pc,Y.pc++,i,e.name,t)):K.printf("%s%v = %v;%n",i,e.name,e.value)}},varsDecl:function(e){var t=e.decls.filter(function(e){return e.value});t.length>0&&(F(e)(),t.forEach(function(e){K.printf("%v",e)}))},jsonElem:function(e){e.value?K.printf("%v: %v",e.key,e.value):K.printf("%v: %f",e.key,function(){O(e.key.text,M(e).scopeInfo,M(e))})},objlit:function(e){K.printf("{%j}",[",",e.elems])},arylit:function(e){K.printf("[%j]",[",",e.elems])},funcExpr:function(e){W(e)},parenExpr:function(e){K.printf("(%v)",e.expr)},varAccess:function(e){{var t=e.name.text;O(t,M(e).scopeInfo,M(e))}},exprstmt:function(r){var i={};if(F(r)(),Y.noWait||(i=M(r).fiberCall||{}),"noRet"==i.type)K.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{",n,f,i.N,[", ",[ct].concat(i.A)],h,Y.pc,Y.pc++);else if("ret"==i.type)K.printf("%s.%s%s(%j);%n%s=%s;return;%n%}case %d:%{%v%v%s.retVal;%n",n,f,i.N,[", ",[ct].concat(i.A)],h,Y.pc,Y.pc++,i.L,i.O,t);else if("noRetSuper"==i.type){var o=B(e.superclass);K.printf("%s.prototype.%s%s.apply( %s, [%j]);%n%s=%s;return;%n%}case %d:%{",o,f,i.S.name.text,n,[", ",[ct].concat(i.A)],h,Y.pc,Y.pc++)}else"retSuper"==i.type?K.printf("%s.prototype.%s%s.apply( %s, [%j]);%n%s=%s;return;%n%}case %d:%{%v%v%s.retVal;%n",o,f,i.S.name.text,n,[", ",[ct].concat(i.A)],h,Y.pc,Y.pc++,i.L,i.O,t):K.printf("%v;",r.expr)},infix:function(e){var t=e.op.text;if(st){if("+"==t||"-"==t||"*"==t||"/"==t||"%"==t)return void K.printf("%s(%v,%l)%v%s(%v,%l)",_,e.left,D(e.left),e.op,_,e.right,D(e.right));if("+="==t||"-="==t||"*="==t||"/="==t||"%="==t)return void K.printf("%v%v%s(%v,%l)",e.left,e.op,_,e.right,D(e.right))}K.printf("%v%v%v",e.left,e.op,e.right)},trifixr:function(e){K.printf("%v%v%v%v%v",e.left,e.op1,e.mid,e.op2,e.right)},prefix:function(e){if("__typeof"===e.op.text){var t=M(e.right);return void(t.vtype?K.printf("%l",t.vtype.name||t.vtype.fullName||"No type name?"):K.printf("%l","Any"))}K.printf("%v %v",e.op,e.right)},postfix:function(e){var t=M(e);if(st){if(t.myMethodCall){var r=t.myMethodCall,i=r.scopeInfo,o=k(i);return void(o==it.FIELD||o==it.METHOD?K.printf("%s(%s, %l, [%j], %l )",y,n,r.name,[",",r.args],"this"):K.printf("%s(%v, [%j], %l)",b,e.left,[",",r.args],D(e.left)))}if(t.othersMethodCall){var s=t.othersMethodCall;return void K.printf("%s(%v, %l, [%j], %l )",y,s.target,s.name,[",",s.args],D(s.target))}if(t.memberAccess){var a=t.memberAccess;return void K.printf("%s(%v,%l).%s",_,a.target,D(a.target),a.name)}}else if(t.myMethodCall){var r=t.myMethodCall,i=r.scopeInfo,o=k(i);if(o==it.METHOD)return void K.printf("%s.%s(%j)",n,r.name,[",",r.args])}K.printf("%v%v",e.left,e.op)},"break":function(e){if(Y.noWait)K.printf("break;%n");else{if(Y.inTry&&Y.exitTryOnJump)throw i("現実装では、tryの中にbreak;は書けません",H,e.pos);if(!Y.closestBrk)throw i("break； は繰り返しの中で使います",H,e.pos);K.printf("%s=%z; break;%n",h,Y.closestBrk)}},"continue":function(e){if(Y.noWait)K.printf("continue;%n");else{if(Y.inTry&&Y.exitTryOnJump)throw i("現実装では、tryの中にcontinue;は書けません",H,e.pos);if("number"==typeof Y.closestCnt)K.printf("%s=%s; break;%n",h,Y.closestCnt);else{if(!Y.closestCnt)throw i("continue； は繰り返しの中で使います",H,e.pos);K.printf("%s=%z; break;%n",h,Y.closestCnt)}}},"try":function(e){var n=M(e);if(!Y.noWait&&(n.fiberCallRequired||n.hasJump||n.hasReturn)){if(1!=e.catches.length||"catch"!=e.catches[0].type)throw i("現実装では、catch節1個のみをサポートしています",H,e.pos);var r=e.catches[0],o={},s={};K.printf("%s.enterTry(%z);%n",t,o),K.printf("%f",I({inTry:!0,exitTryOnJump:!0},e.stmt)),K.printf("%s.exitTry();%n",t),K.printf("%s=%z;break;%n",h,s),K.printf("%}case %f:%{",function(){K.print(o.put(Y.pc++))}),K.printf("%s=%s.startCatch();%n",r.name.text,t),K.printf("%s.exitTry();%n",t),K.printf("%v%n",r.stmt),K.printf("%}case %f:%{",function(){K.print(s.put(Y.pc++))})}else Y.enter({noWait:!0},function(){K.printf("try {%{%f%n%}} ",L(e.stmt)),e.catches.forEach(v.visit)})},"catch":function(e){K.printf("catch (%s) {%{%f%n%}}",e.name.text,L(e.stmt))},"throw":function(e){K.printf("throw %v;%n",e.ex)},"switch":function(e){if(Y.noWait)K.printf("switch (%v) {%{%j"+(e.defs?"%v":"%D")+"%n%}}",e.value,["%n",e.cases],e.defs);else{var t=e.cases.map(function(){return K.lazy()});e.defs&&t.push(K.lazy()),K.printf("switch (%v) {%{%f%n%}}%nbreak;%n",e.value,function(){var n=0;e.cases.forEach(function(e){K.printf("%}case %v:%{%s=%z;break;%n",e.value,h,t[n]),n++}),e.defs&&K.printf("%}default:%{%s=%z;break;%n",h,t[n])});var n=K.lazy();Y.enter({closestBrk:n},function(){var r=0;e.cases.forEach(function(e){K.printf("%}case %f:%{%j%n",function(){K.print(t[r].put(Y.pc++))},["%n",e.stmts]),r++}),e.defs&&K.printf("%}case %f:%{%j%n",function(){K.print(t[r].put(Y.pc++))},["%n",e.defs.stmts]),K.printf("case %f:%n",function(){K.print(n.put(Y.pc++))})})}},"case":function(e){K.printf("%}case %v:%{%j",e.value,["%n",e.stmts])},"default":function(e){K.printf("%}default:%{%j",["%n",e.stmts])},"while":function(e){F(e)();var t=M(e);if(Y.noWait||!t.fiberCallRequired&&!t.hasReturn)Y.enter({noWait:!0},function(){K.printf("while (%v) {%{"+(ut?"Tonyu.checkLoop();%n":"")+"%f%n%}}",e.cond,L(e.loop))});else{var n=K.lazy(),r=Y.pc++,i="reservedConst"==e.cond.type&&"true"==e.cond.text;K.printf("%}case %d:%{"+(i?"%D%D%D":"if (!(%v)) { %s=%z; break; }%n")+"%f%n%s=%s;break;%n%}case %f:%{",r,e.cond,h,n,I({closestBrk:n,closestCnt:r,exitTryOnJump:!1},e.loop),h,r,function(){K.print(n.put(Y.pc++))})}},"do":function(e){F(e)();var t=M(e);if(Y.noWait||!t.fiberCallRequired&&!t.hasReturn)Y.enter({noWait:!0},function(){K.printf("do {%{"+(ut?"Tonyu.checkLoop();%n":"")+"%f%n%}} while (%v);%n",L(e.loop),e.cond)});else{var n=K.lazy(),r=K.lazy(),i=Y.pc++;K.printf("%}case %d:%{%f%n%}case %f:%{if (%v) { %s=%s; break; }%n%}case %f:%{",i,I({closestBrk:n,closestCnt:r,exitTryOnJump:!1},e.loop),function(){K.print(r.put(Y.pc++))},e.cond,h,i,function(){K.print(n.put(Y.pc++))})}},"for":function(e){function t(e,t,n){return function(){n.forEach(function(t,n){K.printf("%s=%s[%s];%n",t.text,e,n)})}}F(e)();var n=M(e);if("forin"==e.inFor.type){var r=M(e.inFor).iterName;if(Y.noWait||!n.fiberCallRequired&&!n.hasReturn)Y.enter({noWait:!0},function(){K.printf("%s=%s(%v,%s);%nwhile(%s.next()) {%{%f%n%f%n%}}",r,A,e.inFor.set,e.inFor.vars.length,r,t(r,e.inFor.isVar,e.inFor.vars),L(e.loop))});else{var i=K.lazy(),o=Y.pc++;K.printf("%s=%s(%v,%s);%n%}case %d:%{if (!(%s.next())) { %s=%z; break; }%n%f%n%f%n%s=%s;break;%n%}case %f:%{",r,A,e.inFor.set,e.inFor.vars.length,o,r,h,i,t(r,e.inFor.isVar,e.inFor.vars),I({closestBrk:i,closestCnt:o,exitTryOnJump:!1},e.loop),h,o,function(e){e.print(i.put(Y.pc++))})}}else if(Y.noWait||!n.fiberCallRequired&&!n.hasReturn)Y.enter({noWait:!0},function(){"varsDecl"==e.inFor.init.type||"exprstmt"==e.inFor.init.type?K.printf("%vfor (; %v ; %v) {%{"+(ut?"Tonyu.checkLoop();%n":"")+"%v%n%}}",e.inFor.init,e.inFor.cond,e.inFor.next,e.loop):K.printf("%v%nwhile(%v) {%{"+(ut?"Tonyu.checkLoop();%n":"")+"%v%n%v;%n%}}",e.inFor.init,e.inFor.cond,e.loop,e.inFor.next)});else{var i=K.lazy(),s=K.lazy(),o=Y.pc++;K.printf("%v%n%}case %d:%{if (!(%v)) { %s=%z; break; }%n%f%n%}case %f:%{%v;%n%s=%s;break;%n%}case %f:%{",e.inFor.init,o,e.inFor.cond,h,i,I({closestBrk:i,closestCnt:s,exitTryOnJump:!1},e.loop),function(e){e.print(s.put(Y.pc++))},e.inFor.next,h,o,function(e){e.print(i.put(Y.pc++))})}},"if":function(e){F(e)();var t=M(e);if(!Y.noWait&&(t.fiberCallRequired||t.hasJump||t.hasReturn)){var n=K.lazy(),r=K.lazy();e._else?K.printf("if (!(%v)) { %s=%z; break; }%n%v%n%s=%z;break;%n%}case %f:%{%v%n%}case %f:%{",e.cond,h,r,e.then,h,n,function(){K.print(r.put(Y.pc++))},e._else,function(){K.print(n.put(Y.pc++))}):K.printf("if (!(%v)) { %s=%z; break; }%n%v%n%}case %f:%{",e.cond,h,n,e.then,function(){K.print(n.put(Y.pc++))})}else Y.enter({noWait:!0},function(){e._else?K.printf("if (%v) {%{%f%n%}} else {%{%f%n%}}",e.cond,L(e.then),L(e._else)):K.printf("if (%v) {%{%f%n%}}",e.cond,L(e.then))})},ifWait:function(e){Y.noWait?e._else&&K.printf("%v",e._else):K.printf("%v",e.then)},empty:function(){K.printf(";%n")},call:function(e){K.printf("(%j)",[",",e.args])},objlitArg:function(e){K.printf("%v",e.obj)},argList:function(e){K.printf("%j",[",",e.args])},newExpr:function(e){var t=e.params;t?K.printf("new %v%v",e.klass,t):K.printf("new %v",e.klass)},scall:function(e){K.printf("[%j]",[",",e.args])},superExpr:function(t){var r;if(!e.superclass)throw new Error(e.fullName+"には親クラスがありません");t.name?(r=t.name.text,K.printf("%s.prototype.%s.apply( %s, %v)",B(e.superclass),r,n,t.params)):K.printf("%s.apply( %s, %v)",B(e.superclass),n,t.params)},arrayElem:function(e){K.printf("[%v]",e.subscript)},member:function(e){K.printf(".%v",e.name)},symbol:function(e){K.print(e.text)},normalFor:function(e){K.printf("%v; %v; %v",e.init,e.cond,e.next)},compound:function(e){var t=M(e);!Y.noWait&&(t.fiberCallRequired||t.hasJump||t.hasReturn)?K.printf("%j",["%n",e.stmts]):Y.enter({noWait:!0},function(){K.printf("{%{%j%n%}}",["%n",e.stmts])})},"typeof":function(){K.printf("typeof ")},"instanceof":function(){K.printf(" instanceof ")},is:function(){K.printf(" instanceof ")},regex:function(e){K.printf("%s",e.text)}});var lt=["++","--","!==","===","+=","-=","*=","/=","%=",">=","<=","!=","==",">>","<<","&&","||",">","<","+","?","=","*","%","/","^","~","\\",":",";",",","!","&","|","-","delete"];lt.forEach(function(e){v.funcs[e]=function(){K.printf("%s",e)}}),v.def=function(e){throw console.log("Err node="),console.log(e),new Error(e.type+" is not defined in visitor:compiler2")},v.cnt=0,j(),at?(e.src.js=e.src.tonyu.up().rel(e.src.tonyu.truncExt()+".js"),e.src.js.text(K.buf)):e.src.js=K.buf,Q&&console.log("method4",K.buf);var ft=K.close();return e.src.map=K.mapStr,ft}{var t="_thread",n="_this",l="_arguments",f="fiber$",h="__pc",p="$LASTPOS",d="__cnt",m=100,g="Tonyu.bindFunc",y="Tonyu.invokeMethod",b="Tonyu.callFunc",_="Tonyu.checkNonNull",w="Tonyu.classes.",x="Tonyu.globals.",S="this",T='"use strict";%n',A="Tonyu.iterator",E=u.ScopeTypes,k=u.getScopeType,C=u.annotation;u.getMethod,u.getDependingClasses,u.getParams}return{genJS:e}}()}),requireSimulator.setName("Tonyu.Compiler.Semantics"),"function"!=typeof define&&(define=require("requirejs").define),define(["Tonyu","Tonyu.Iterator","TonyuLang","ObjectMatcher","TError","IndentBuffer","context","Visitor","Tonyu.Compiler"],function(e,t,n,r,i,o,s,a,u){return u.Semantics=function(){function e(e,t){function o(n){var r,o=t.options.compiler.defaultSuperClass,s=0;if((r=d.match(n,{ext:{superclassName:{text:d.N,pos:d.P}}}))&&(o=r.N,s=r.P,"null"==o&&(o=null)),e.includes=[],(r=d.match(n,{incl:{includeClassNames:d.C}}))&&r.C.forEach(function(n){var r=n.text,o=n.pos,s=t.classes[t.aliases[r]||r];if(!s)throw i("クラス "+r+"は定義されていません",a,o);e.includes.push(s)}),"Array"==o)e.superclass={name:"Array",fullName:"Array",builtin:!0};else if(o){var h=t.classes[t.aliases[o]||o];if(!h)throw i("親クラス "+o+"は定義されていません",a,s);e.superclass=h}else delete e.superclass;n.stmts.forEach(function(t){if("funcDecl"==t.type){var n=t.head,r="function";n.ftype&&(r=n.ftype.text);var i=n.name.text,o=n.params?"":n.setter?"__setter__":"__getter__";i=o+i,l[i]={nowait:!!n.nowait||""!==o,ftype:r,name:i,klass:e.fullName,head:n,pos:n.pos,stmts:t.body.stmts,node:t}}else"nativeDecl"==t.type?f[t.name.text]=t:("varsDecl"==t.type&&t.decls.forEach(function(t){c[t.name.text]={node:t,klass:e.fullName,name:t.name.text,pos:t.pos}}),u.stmts.push(t))})}var s,a=e.src.tonyu;e.node&&e.nodeTimestamp==a.lastUpdate()&&(s=e.node),s||(console.log("Parse "+a),s=n.parse(a),e.nodeTimestamp=a.lastUpdate());var u={name:"main",stmts:[],pos:0,isMain:!0},c={},l={main:u},f={},h={},p={};e.decls={fields:c,methods:l,natives:f,amds:h,softRefClasses:p},e.node=s;var d=r;o(s)}function t(e,t){function n(e){return u.getSource(j,e)}function y(t,n){return p(e.annotation,t,n)}function b(e){if(!e.builtin){var t,n=V,r=e.decls;for(t in r.fields){var i=r.fields[t];n[t]=c(W.FIELD,{klass:e.fullName,name:t,info:i}),i.node&&y(i.node,{info:i})}for(t in r.methods){var i=r.methods[t];n[t]=c(W.METHOD,{klass:e.fullName,name:t,info:i}),i.node&&y(i.node,{info:i})}}}function _(){var n=V;m(e).forEach(b);var r=e.decls;for(var i in r.natives)n[i]=c(W.NATIVE,{name:"native::"+i,value:window[i]});for(var i in v)n[i]=c(W.NATIVE,{name:"native::"+i,value:window[i]});for(var i in t.aliases){var o=t.aliases[i];n[i]=c(W.CLASS,{name:i,fullName:o,info:t.classes[o]})}}function w(){var t=m(e);for(var n in e.decls.methods){var r=e.decls.methods[n];t.forEach(function(e){var t=e.decls.methods[n];t&&t.nowait&&(r.nowait=!0)})}}function x(t){return d(e,t)}function S(e){if("varAccess"==e.type||"postfix"==e.type&&("member"==e.op.type||"arrayElem"==e.op.type))return"varAccess"==e.type&&y(e,{noBind:!0}),!0;throw console.log("LVal",e),i("'"+n(e)+"'は左辺には書けません．",F,e.pos)}function T(n){var r=q.scope[n],i=l(r);if(!i){if(t.amdPaths&&t.amdPaths[n])i=W.MODULE,e.decls.amds[n]=t.amdPaths[n];else{var o=n.match(/^\$/);i=o?W.GLOBAL:W.FIELD}var s={name:n};i==W.FIELD&&(s.klass=e.name,e.decls.fields[n]=e.decls.fields[n]||{},u.extend(e.decls.fields[n],{klass:e.fullName,name:n})),r=V[n]=c(i,s)}return i==W.CLASS&&(e.decls.softRefClasses[n]=r),r}function A(e){var t=this;if(e&&"object"==typeof e){var n;if(n=e instanceof Array?e:e[Grammar.SUBELEMENTS],!n){n=[];for(var r in e)n.push(e[r])}n.forEach(function(e){t.visit(e)})}}function E(e){var t={varDecls:{},subFuncDecls:{}};return q.enter({locals:t},function(){et.visit(e)}),t}function k(e,t){e.forEach(function(e){y(e,t)})}function C(e){q.method&&(q.method.fiberCallRequired=!0),k(e,{fiberCallRequired:!0})}function P(e){var t=e.name+"",n=T(t),r=l(n);console.log("TExpr",t,n,r),r===W.NATIVE?y(e,{resolvedType:n.value}):r===W.CLASS&&y(e,{resolvedType:n.info})}function D(e,t){q.enter({scope:t},function(){tt.visit(e)})}function M(e,t){var n=e.locals;for(var r in n.varDecls){var i=c(W.LOCAL,{declaringFunc:e});t[r]=i,y(n.varDecls[r],{scopeInfo:i})}for(var r in n.subFuncDecls){var i=c(W.LOCAL,{declaringFunc:e});t[r]=i,y(n.subFuncDecls[r],{scopeInfo:i})}}function B(e){e.forEach(function(e){e.typeDecl&&(console.log("restype",e),P(e.typeDecl.vtype))})}function N(e){q.enter({isMain:e.isMain,finfo:e},function(){e.locals=E(e.stmts),e.params=g(e)}),B(e.params)}function I(e){var t,n,r=e.body,i=e.head.name?e.head.name.text:"anonymous_"+e.pos;n=(t=z.match(e,{head:{params:{params:z.P}}}))?t.P:[];var o={},s=f(q.scope);return q.enter({finfo:o},function(){n.forEach(function(e){var t=c(W.PARAM,{declaringFunc:o});y(e,{scopeInfo:t}),s[e.name.text]=t}),o.locals=E(r),M(o,s),D(r,s)}),o.scope=s,o.name=i,o.params=n,B(o.params),y(e,{info:o}),O(o.locals,s),o}function O(e,t){q.enter({scope:t},function(){for(var t in e.subFuncDecls)I(e.subFuncDecls[t])})}function L(t){var n=f(q.scope);return t.params.forEach(function(r,i){var o=c(W.PARAM,{klass:e.name,name:t.name,no:i,declaringFunc:t});n[r.name.text]=o,y(r,{scopeInfo:o,declaringFunc:t})}),M(t,n),q.enter({method:t,finfo:t,noWait:!1},function(){D(t.stmts,n)}),t.scope=n,O(t.locals,n),n}function R(){q.enter({scope:V},function(){for(var e in G){$&&console.log("anon method1",e);var t=G[e];N(t),L(t)}})}var F=e.src.tonyu,j=F.text(),z=r,U=(t.traceTbl,e.decls),G=(U.fields,U.methods),W=(U.natives,U.amds,o),V={},q=s(),$=!1,Z={type:"postfix",left:{type:"postfix",left:z.T,op:{type:"member",name:{text:z.N}}},op:{type:"call",args:z.A}},H={type:"postfix",left:z.T,op:{type:"member",name:{text:z.N}}},J=fiberCallTmpl={type:"postfix",left:{type:"varAccess",name:{text:z.N}},op:{type:"call",args:z.A}},K={expr:fiberCallTmpl},X={expr:{type:"infix",op:z.O,left:z.L,right:fiberCallTmpl}},Y={expr:{type:"superExpr",params:{args:z.A},$var:"S"}},Q={expr:{type:"infix",op:z.O,left:z.L,right:{type:"superExpr",params:{args:z.A},$var:"S"}}};e.annotation={};var et=a({varDecl:function(t){q.isMain?(y(t,{varInMain:!0}),y(t,{declaringClass:e})):(q.locals.varDecls[t.name.text]=t,y(t,{declaringFunc:q.finfo}))},funcDecl:function(e){q.locals.subFuncDecls[e.head.name.text]=e},funcExpr:function(){},"catch":function(e){q.locals.varDecls[e.name.text]=e},exprstmt:function(){},forin:function(e){e.isVar;e.vars.forEach(function(t){q.locals.varDecls[t.text]=e});var t=h("_it_");y(e,{iterName:t}),q.locals.varDecls[t]=e}});et.def=A;var tt=a({varAccess:function(e){{var t=T(e.name.text);l(t)}y(e,{scopeInfo:t})},funcDecl:function(){},funcExpr:function(e){I(e)},objlit:function(e){var t=this,n={};e.elems.forEach(function(e){var r;if(r="literal"==e.key.type?e.key.text.substring(1,e.key.text.length-1):e.key.text,n[r])throw i("オブジェクトリテラルのキー名'"+r+"'が重複しています",F,e.pos);n[r]=1,t.visit(e)})},jsonElem:function(e){if(e.value)this.visit(e.value);else{if("literal"==e.key.type)throw i("オブジェクトリテラルのパラメタに単独の文字列は使えません",F,e.pos);var t=T(e.key.text);y(e,{scopeInfo:t})}},"do":function(e){var t=this;q.enter({brkable:!0,contable:!0},function(){t.def(e)})},"switch":function(e){var t=this;q.enter({brkable:!0},function(){t.def(e)})},"while":function(e){var t=this;q.enter({brkable:!0,contable:!0},function(){t.def(e)}),C(this.path)},"for":function(e){var t=this;q.enter({brkable:!0,contable:!0},function(){t.def(e)})},forin:function(e){e.vars.forEach(function(e){var t=T(e.text);y(e,{scopeInfo:t})}),this.visit(e.set)},ifWait:function(e){var t="_thread",n=this,r=f(q.scope);r[t]=c(W.THVAR),q.enter({scope:r},function(){n.visit(e.then)}),e._else&&n.visit(e._else),C(this.path)},"try":function(e){q.finfo.useTry=!0,this.def(e)},"return":function(e){q.noWait||k(this.path,{hasReturn:!0}),this.visit(e.value)},"break":function(e){if(!q.brkable)throw i("break； は繰り返しまたはswitch文の中で使います.",F,e.pos);q.noWait||k(this.path,{hasJump:!0})},"continue":function(e){if(!q.contable)throw i("continue； は繰り返しの中で使います.",F,e.pos);q.noWait||k(this.path,{hasJump:!0})},reservedConst:function(e){"arguments"==e.text&&(q.finfo.useArgs=!0)},postfix:function(e){var t;if(this.visit(e.left),this.visit(e.op),t=z.match(e,J)){var n=y(e.left).scopeInfo;y(e,{myMethodCall:{name:t.N,args:t.A,scopeInfo:n}})}else(t=z.match(e,Z))?y(e,{othersMethodCall:{target:t.T,name:t.N,args:t.A}}):(t=z.match(e,H))&&y(e,{memberAccess:{target:t.T,name:t.N}})},infix:function(e){var t=e.op.text;("="==t||"+="==t||"-="==t||"*="==t||"/="==t||"%="==t)&&S(e.left),this.def(e)},exprstmt:function(t){var n,r;if(q.noWait||!(n=z.match(t,K))||l(q.scope[n.N])!=W.METHOD||x(n.N).nowait)if(q.noWait||!(n=z.match(t,X))||l(q.scope[n.N])!=W.METHOD||x(n.N).nowait){if(!q.noWait&&(n=z.match(t,Y))&&n.S.name){if(r=x(n.S.name.text),!r)throw new Error("メソッド"+n.S.name.text+" はありません。");r.nowait||(n.type="noRetSuper",n.superclass=e.superclass,y(t,{fiberCall:n}),C(this.path))}else if(!q.noWait&&(n=z.match(t,Q))&&n.S.name){if(r=x(n.S.name.text),!r)throw new Error("メソッド"+n.S.name.text+" はありません。");r.nowait||(n.type="retSuper",n.superclass=e.superclass,y(t,{fiberCall:n}),C(this.path))}}else n.type="ret",y(t,{fiberCall:n}),C(this.path);else n.type="noRet",y(t,{fiberCall:n}),C(this.path);this.visit(t.expr)},varDecl:function(e){var t;q.noWait||!(t=z.match(e.value,fiberCallTmpl))||l(q.scope[t.N])!=W.METHOD||x(t.N).nowait||(t.type="varDecl",y(e,{fiberCall:t}),C(this.path)),this.visit(e.value),this.visit(e.typeDecl)},typeExpr:function(e){P(e)}});tt.def=A,_(),w(),R()}var o=u.ScopeTypes,c=u.newScopeType,l=u.getScopeType,f=u.newScope,h=u.genSym,p=u.annotation,d=u.getMethod,m=u.getDependingClasses,g=u.getParams,v={Array:1,String:1,Boolean:1,Number:1,Void:1,Object:1,RegExp:1,Error:1,Date:1};return{initClassDecls:e,annotate:t}}()}),requireSimulator.setName("StackTrace"),define([],function(){var trc={},pat=/(_trc_[A-Za-z0-9_]*).*[^0-9]([0-9]+):([0-9]+)[\s\)]*\r?$/;return trc.isAvailable=function(){var scr="({\n    main :function _trc_func_17000000_0() {\n      var a=(this.t.x);\n    }\n}).main();\n",s;try{eval(scr)}catch(e){if(s=e.stack,"string"!=typeof s)return!1;for(var lines=s.split(/\n/),i=0;i<lines.length;i++){var p=pat.exec(lines[i]);if(p)return!0}}return!1},trc.get=function(e){var t=e.stack;if("string"!=typeof t)return!1;for(var n=t.split(/\n/),r=[],i=0;i<n.length;i++){var o=pat.exec(n[i]);if(o){var s=o[1],a=o[2],u=o[3];r.push({fname:s,row:a,col:u})}}return console.log("StackTrace.get",r),r},trc}),requireSimulator.setName("Tonyu.TraceTbl"),define(["Tonyu","FS","TError","StackTrace"],function(e,t,n,r){return e.TraceTbl=function(){var e={},i=1e6,o=1,s=1e4,a={},u=[],c={};e.add=function(e,t){var n=e.src.tonyu,r=n.path(),l=a[r];void 0==l&&(l=o++,o>s&&(o=0),a[r]=l,u[l]=r),c[r]=e,t>=i&&(t=i-1);var f=l*i+t;return f};var l={};return e.decodeOLD=function(e){var r=e%i,o=(e-r)/i,s=u[o];if(s){var a=t.get(s),l=c[s];return n("Trace info",l||a,r)}return null},e.srcMap=l,e.decode=function(e){var t=new RegExp("LASTPOS="+e+";//(.*)\r?\n");console.log("pat=",t);for(var n in l){var r=t.exec(l[n]);if(r)return r[1];console.log("pat=",t,"Not found in ",n)}},e.find=function(e){var t=r.get(e),n=t[0];if(!n)return null;var i=new RegExp("LASTPOS=[0-9]+;//(.*)\r?");for(var o in l){console.log("Finding ",n.fname," in ",o);var s=l[o].indexOf(n.fname);if(s>=0){console.log("fname found at ",s);var a=l[o].split(/\n/),u=n.row-1;console.log("Scan from row=",u);for(var c=u;c>=0&&(console.log("row ",c,a[c]),null!=a[c]);c--){var f=i.exec(a[c]);if(f)return f[1]}console.log("Not found LASTPOS pat")}else console.log("Not found in ",o)}},e.addSource=function(e,t){l[e]=t},e}()}),requireSimulator.setName("WebSite"),define(["FS"],function(e){var t,n=e.PathUtil,r=document.location.href,i=!!r.match(/html\/dev\//)&&!!r.match(/localhost:3/);if(r.match(/jsrun\.it/))t={urlAliases:{"images/Ball.png":"http://jsrun.it/assets/9/X/T/b/9XTbt.png","images/base.png":"http://jsrun.it/assets/6/F/y/3/6Fy3B.png","images/Sample.png":"http://jsrun.it/assets/s/V/S/l/sVSlZ.png","images/neko.png":"http://jsrun.it/assets/f/D/z/z/fDzze.png","images/mapchip.png":"http://jsrun.it/assets/f/u/N/v/fuNvz.png","images/inputPad.png":"http://jsrun.it/assets/r/K/T/Y/rKTY9.png"},top:"",devMode:i,pluginTop:"http://tonyuedit.appspot.com/js/plugins",removeJSOutput:!0};else if(r.match(/tonyuexe\.appspot\.com/)||r.match(/localhost:8887/)||r.match(/\/html\/((dev)|(build))\//))t={urlAliases:{"images/Ball.png":"../../images/Ball.png","images/base.png":"../../images/base.png","images/Sample.png":"../../images/Sample.png","images/neko.png":"../../images/neko.png","images/inputPad.png":"../../images/inputPad.png","images/mapchip.png":"../../images/mapchip.png","images/sound.png":"../../images/sound.png","images/sound_ogg.png":"../../images/sound_ogg.png","images/sound_mp3.png":"../../images/sound_mp3.png","images/sound_mp4.png":"../../images/sound_mp4.png","images/sound_m4a.png":"../../images/sound_m4a.png","images/sound_mid.png":"../../images/sound_mid.png","images/sound_wav.png":"../../images/sound_wav.png","images/ecl.png":"../../images/ecl.png"},top:"../..",devMode:i};else if(r.match(/bitarrow/)||r.match(/localhost.*pub/)){t={};var o=t;t.serverType="BA",o.runtime="../../../runtime/",o.urlAliases={"images/base.png":o.runtime+"images/base.png","images/Sample.png":o.runtime+"images/Sample.png","images/neko.png":o.runtime+"images/neko.png","images/inputPad.png":o.runtime+"images/inputPad.png","images/mapchip.png":o.runtime+"images/mapchip.png","images/sound.png":o.runtime+"images/sound.png","images/sound_ogg.png":o.runtime+"images/sound_ogg.png","images/sound_mp3.png":o.runtime+"images/sound_mp3.png","images/sound_mp4.png":o.runtime+"images/sound_mp4.png","images/sound_m4a.png":o.runtime+"images/sound_m4a.png","images/sound_mid.png":o.runtime+"images/sound_mid.png","images/sound_wav.png":o.runtime+"images/sound_wav.png","images/ecl.png":o.runtime+"images/ecl.png"}}else t={urlAliases:{},top:".",devMode:i};var s=window.navigator.userAgent.toLowerCase();return t.tablet=-1!=s.indexOf("windows")&&-1!=s.indexOf("touch")||-1!=s.indexOf("ipad")||-1!=s.indexOf("android")&&-1==s.indexOf("mobile")||-1!=s.indexOf("firefox")&&-1!=s.indexOf("tablet")||-1!=s.indexOf("kindle")||-1!=s.indexOf("silk")||-1!=s.indexOf("playbook"),t.mobile=-1!=s.indexOf("windows")&&-1!=s.indexOf("phone")||-1!=s.indexOf("iphone")||-1!=s.indexOf("ipod")||-1!=s.indexOf("android")&&-1!=s.indexOf("mobile")||-1!=s.indexOf("firefox")&&-1!=s.indexOf("mobile")||-1!=s.indexOf("blackberry"),t.pluginTop||(t.pluginTop=t.top+"/js/plugins"),t.disableROM={},r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:8888/),(r.match(/\.appspot\.com/)||r.match(/localhost:888[87]/))&&(t.serverType="GAE"),r.match(/localhost:3000/)&&(t.serverType="Node"),t.serverTop=r.match(/tonyuexe\.appspot\.com/)||r.match(/localhost:8887/)?t.top+"/exe":t.top+"/edit",t.sampleImg=t.top+"/images",t.blobPath=t.serverTop+"/serveBlob",t.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),t.mp3Disabled=t.isNW,t.tonyuHome="/Tonyu/",t.url={getDirInfo:t.serverTop+"/getDirInfo",getFiles:t.serverTop+"/File2LSSync",putFiles:t.serverTop+"/LS2FileSync"},t.isNW?(t.cwd=n.directorify(process.cwd()),t.tonyuHome=process.env.TONYU_HOME?n.directorify(process.env.TONYU_HOME):n.rel(t.cwd,"fs/Tonyu/"),t.logdir=process.env.TONYU_LOGDIR,t.wwwDir=n.rel(t.cwd,"www/"),t.platform=process.platform,t.ffmpeg=n.rel(t.cwd,"win32"==t.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),t.pkgInfo=require(n.rel(t.cwd,"package.json")),t.projects=process.env.TONYU_PROJECTS?process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(require("path").delimiter):t.pkgInfo&&t.pkgInfo.config&&t.pkgInfo.config.prjDirs?t.pkgInfo.config.prjDirs.map(function(e){return e=n.directorify(e),n.isAbsolute(e)?e:n.rel(t.cwd,e)}):[n.rel(t.cwd,"Projects/"),n.rel(t.tonyuHome,"Projects/")],t.kernelDir=n.rel(t.wwwDir,"Kernel/")):(t.wwwDir=location.protocol+"//"+location.host+"/",t.projects=[n.rel(t.tonyuHome,"Projects/")]),(r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:888/))&&(t.kernelDir=location.protocol+"//"+location.host+"/Kernel/"),t.compiledKernel=r.match(/tonyuedit\.appspot\.com/)||r.match(/localhost:888/)||t.isNW?t.top+"/Kernel/js/concat.js":"BA"===t.serverType?t.runtime+"lib/tonyu/kernel.js":"http://tonyuexe.appspot.com/Kernel/js/concat.js",e.setEnvProvider(new e.Env(t)),window.WebSite=t
}),requireSimulator.setName("compiledProject"),define(["DeferredUtil","WebSite","assert"],function(e,t,n){var r=function(r,i){return n.is(arguments,[String,String]),{getNamespace:function(){return r},sourceDir:function(){return null},getDependingProjects:function(){return[]},loadDependingClasses:function(t){var n=e.directPromise(),r=this.getNamespace();return this.getDependingProjects().forEach(function(e){e.getNamespace()!=r&&(n=n.then(function(){return e.loadClasses(t)}))}),n},loadClasses:function(e){console.log("Loading compiled classes ns=",r,"url=",i);var n=i+("BA"===t.serverType?"?"+Math.random():""),o=this;return this.loadDependingClasses(e).then(function(){return o.requirejs(n)}).then(function(){console.log("Done Loading compiled classes ns=",r,"url=",n,Tonyu.classes)})},requirejs:function(t){return e.promise(function(e){var n=document.getElementsByTagName("head")[0]||document.documentElement,r=document.createElement("script");r.src=t;var i=!1;r.onload=r.onreadystatechange=function(){i||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i=!0,console.log("Done load ",t),r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r),e())},n.insertBefore(r,n.firstChild)})},loadClassesOLD:function(e){console.log("Load compiled classes ns=",r,"url=",i);var n=new $.Deferred,o=document.getElementsByTagName("head")[0]||document.documentElement,s=document.createElement("script");s.src=i+("BA"===t.serverType?"?"+Math.random():"");var a=!1;return s.onload=s.onreadystatechange=function(){a||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(a=!0,s.onload=s.onreadystatechange=null,o&&s.parentNode&&o.removeChild(s),console.log("Done Load compiled classes ns=",r,"url=",i,Tonyu.classes),n.resolve())},this.loadDependingClasses(e).then(function(){o.insertBefore(s,o.firstChild)}),n.promise()}}};return r}),requireSimulator.setName("TypeChecker"),"function"!=typeof define&&(define=require("requirejs").define),define(["Visitor","Tonyu.Compiler","context"],function(e,t,n){function r(e){var t=this;if(e&&"object"==typeof e){var n;if(n=e instanceof Array?e:e[Grammar.SUBELEMENTS],!n){n=[];for(var r in e)n.push(e[r])}n.forEach(function(e){t.visit(e)})}}var i=t.ScopeTypes,o=(t.newScopeType,t.getScopeType,t.newScope,t.genSym,t.annotation),s=(t.getMethod,t.getDependingClasses,t.getParams,{});return s.checkTypeDecl=function(t){function n(e,n){return o(t.annotation,e,n)}var i=e({varDecl:function(e){if(e.value&&this.visit(e.value),e.name&&e.typeDecl){var t=n(e.typeDecl.vtype);console.log("var typeis",e.name+"",e.typeDecl.vtype,t.resolvedType);var r=n(e),i=r.scopeInfo,o=r.info;i?(console.log("set var type",e.name+"",t.resolvedType),i.vtype=t.resolvedType):o&&(console.log("set fld type",e.name+"",t.resolvedType),o.vtype=t.resolvedType)}},paramDecl:function(e){if(e.name&&e.typeDecl){console.log("param typeis",e.name+"",e.typeDecl.vtype+"");var t=n(e.typeDecl.vtype),r=n(e),i=r.scopeInfo;i&&t.resolvedType&&(console.log("set param type",e.name+"",e.typeDecl.vtype+""),i.vtype=t.resolvedType)}},funcDecl:function(e){var t=e.head,r=n(e).info;t.rtype&&(console.log("ret typeis",t.name+"",t.rtype.vtype+""),r.rtype=t.rtype.vtype),this.visit(t),this.visit(e.body)}});i.def=r,i.visit(t.node)},s.checkExpr=function(s){function a(e,t){return o(s.annotation,e,t)}function u(e){c.visit(e);var t=a(e);return t.vtype}{var c=e({number:function(e){a(e,{vtype:Number})},literal:function(e){a(e,{vtype:String})},postfix:function(e){var n=a(e);if(n.memberAccess){var r=n.memberAccess,i=u(r.target);if(i){var o=t.getField(i,r.name);console.log("GETF",i,r.name,o),o&&o.vtype&&a(e,{vtype:o.vtype})}}else this.visit(e.left),this.visit(e.op)},varAccess:function(e){var t=a(e),n=t.scopeInfo;if(n)if(n.vtype)console.log("VA typeof",e.name+":",n.vtype),a(e,{vtype:n.vtype});else if(n.type===i.FIELD){var r;if(r=s.decls.fields[e.name+""],!r)return void console.log("TC Warning: fld not found",s,e.name+"");var o=r.vtype;o?(a(e,{vtype:o}),console.log("VA typeof",e.name+":",o)):console.log("VA vtype not found",e.name+":",r)}}});n()}c.def=r,c.visit(s.node)},s}),requireSimulator.setName("ProjectCompiler"),define(["Tonyu","Tonyu.Compiler.JSGenerator","Tonyu.Compiler.Semantics","Tonyu.TraceTbl","FS","assert","DeferredUtil","compiledProject","source-map","TypeChecker"],function(e,t,n,r,i,o,s,a,u){var c=function(r){function l(t){var n=p.env;return t||(t={}),t.visited||(t={visited:{},classes:n.classes=n.classes||e.classMetas,options:t}),t}function f(e){function t(t){var n=t.superclass,i=n?[n]:[];return t.includes&&(i=i.concat(t.includes)),i=i.filter(function(t){return t&&e[t.fullName]&&!t.builtin&&!r[t.fullName]})}function n(e,r){if(console.log("detectloop",e.fullName),o[e.fullName]){console.log("Detected: ",e.fullName,o,o[e.fullName]);var i=e.fullName,s=[];do s.unshift(i),i=o[i];while(i!=e.fullName);return s.unshift(e.fullName),s}r&&(o[e.fullName]=r.fullName);var a,u=t(e);return u.forEach(function(t){if(!a){var r=n(t,e);r&&(a=r)}}),delete o[e.fullName],a}var r={},i=[],o={},s=0;for(var a in e)r[a]=!1,s++;for(;i.length<s;){var u=i.length;for(var a in e)if(!r[a]){var c=e[a],l=t(c);0==l.length&&(i.push(c),r[a]=!0)}if(i.length==u){var f=[];for(var a in e)if(!r[a]){f=n(e[a])||[];break}throw TError("次のクラス間に循環参照があります: "+f.join("->"),"不明",0)}}return i}function h(e){console.log("evalFile: "+e.path());var t=new Function(e.text());return d.addSource(e.path(),t+""),s.directPromise(t())}o(i.isFile(r)&&r.isDir(),"projectCompiler: "+r+" is not dir obj");var p={env:{}},d=e.TraceTbl,m=s.throwF;return p.env.traceTbl=d,p.EXT=".tonyu",p.getDir=function(){return r},p.getOptionsFile=function(){var e=r.rel("options.json");return e},p.getOptions=function(){var e=p.env;e.options={};var t=p.getOptionsFile();return t.exists()&&(e.options=t.obj()),p.fixOptions(e.options),e.options},p.getEXT=function(){var e=p.getOptions();return p.EXT=e.language&&"js"!=e.language?"."+e.language:".tonyu",p.EXT},p.setOptions=function(e){p.getOptionsFile().obj(e)},p.fixOptions=function(e){e.compiler||(e.compiler={})},p.resolve=function(e){if(e instanceof Array){var t=[];return e.forEach(function(e){t.push(p.resolve(e))}),t}if("string"==typeof e)return i.resolve(e,r.path());if(!e||!e.isDir)throw new Error("Cannot TPR.resolve: "+e);return e},p.shouldCompile=function(){var t=p.getOutputFile();if(!t.exists())return!0;if(t.isReadOnly())return!1;var n=t.lastUpdate();if(n<e.VERSION)return console.log("Should compile: ",t.name()+" last="+new Date(n)+" < Tonyu.ver="+new Date(e.VERSION)),!0;var r=p.sourceFiles(p.getNamespace());for(var i in r){var o=r[i],s=o.lastUpdate();if(s>n)return console.log("Should compile: ",o.name()+" last="+new Date(s)),!0}var a=p.getOptionsFile();return a.exists()&&a.lastUpdate()>n?(console.log("Should compile: ",a.name()+" last="+new Date(a.lastUpdate())),!0):!1},p.getClassName=function(e){if(o(i.isFile(e)),r.contains(e))return p.getNamespace()+"."+e.truncExt(p.EXT);var t;return p.getDependingProjects().forEach(function(n){t||(t=n.getClassName(e))}),t},p.getName=function(){return r.name().replace(/\/$/,"")},p.getNamespace=function(){var e=p.getOptions();return o(e.compiler.namespace,"namespace not specified opt="+JSON.stringify(e))},p.getPublishedURL=function(){return p._publishedURL?p._publishedURL:s.requirejs(["Auth"]).then(function(e){return e.publishedURL(p.getName()+"/")}).then(function(e){return p._publishedURL=e,e})},p.getOutputFile=function(){var e=p.getOptions(),t=p.resolve(o(e.compiler.outputFile,"outputFile should be specified in options"));if(t.isDir())throw new Error("out: directory style not supported");return t},p.loadDependingClasses=function(e){var t=s.directPromise(),n=p.getNamespace();return p.getDependingProjects().forEach(function(r){r.getNamespace()!=n&&(t=t.then(function(){return r.loadClasses(e)}))}),t},p.loadClasses=function(t){e.runMode=!1,p.showProgress("LoadClasses: "+r.name()),console.log("LoadClasses: "+r.path()),t=l(t);var n=t.visited||{};return n[p.path()]?s.directPromise():(n[p.path()]=!0,p.loadDependingClasses(t).then(function(){return p.shouldCompile()}).then(function(e){if(e)return p.compile(t);var n=p.getOutputFile("js");return p.showProgress("Eval "+n.name()),h(n)}))},p.compile=function(t){e.runMode=!1,p.showProgress("Compile: "+r.name()),console.log("Compile: "+r.path()),t=l(t);var i,o,s,a,u,c,h,d,g=p.getNamespace();return p.loadDependingClasses(t).then(m(function(){i=t.classes,o=t.options,s=p.env,s.aliases={},s.parsedNode=s.parsedNode||{},s.classes=i;for(var e in i){var n=i[e];s.aliases[n.shortName]=n.fullName}return p.showProgress("scan sources")})).then(m(function(){a={},u=!!o.noIncremental,c=p.sourceFiles(g);for(var t in c){var n=c[t],r=g+"."+t;i[r]||(console.log("Class",r,"is added."),u=!0);var l=e.klass.getMeta(r);a[r]=i[r]=l,e.extend(l,{fullName:r,shortName:t,namespace:g}),l.src=l.src||{},l.src.tonyu=n,s.aliases[t]=r}return p.showProgress("update check")})).then(m(function(){for(var t in i)a[t]&&a[t].src&&!a[t].src.js&&(console.log("Class",t,"has no js src"),u=!0),a[t]||i[t].namespace!=g||(console.log("Class",t,"is removed"),e.klass.removeMeta(t),u=!0);if(u)d=a;else{d={};for(var t in a)e.klass.shouldCompile(a[t])&&(d[t]=a[t])}return p.showProgress("initClassDecl")})).then(m(function(){for(var e in d)console.log("initClassDecl: "+e),n.initClassDecls(d[e],s);return p.showProgress("order")})).then(m(function(){h=f(a),h.forEach(function(e){d[e.fullName]&&(console.log("annotate :"+e.fullName),n.annotate(e,s))});try{}catch(e){console.log("Error in Typecheck(It doesnt matter because Experimental)",e.stack)}return p.showProgress("genJS")})).then(m(function(){return p.genJS(h.filter(function(e){return d[e.fullName]}))})).then(m(function(){var e=p.getOptions().compiler;return e.genAMD?void 0:p.concatJS(h)}))},p.genJS=function(e){var n=p.env;return s.each(e,function(e){return console.log("genJS :"+e.fullName),t.genJS(e,n),p.showProgress("genJS :"+e.fullName)})},p.concatJS=function(e){var t=p.getOutputFile();p.showProgress("generate :"+t.name()),console.log("generate :"+t);var n=new u.SourceNode(null,null,t.path());e.forEach(function(e){var t,r=null;if("string"==typeof e.src.js)t=e.src.js+"\n";else{if(!i.isFile(e.src.js))throw new Error("Src for "+e.fullName+" not generated ");r=e.src.js.path(),t=e.src.js.text()+"\n"}var o;o=e.src.map?u.SourceNode.fromStringWithSourceMap(t,new u.SourceMapConsumer(e.src.map)):new u.SourceNode(null,null,r,t),n.add(o)});var r=t.sibling(t.name()+".map"),o=n.toStringWithSourceMap();return t.text(o.code+"\n//# sourceMappingURL="+r.name()),r.text(o.map+""),h(t)},p.getDependingProjects=function(){var e=p.getOptions(),t=e.compiler.dependingProjects||[];return t.map(function(e){if("string"==typeof e){var t=p.resolve(e);return c(t)}return"object"==typeof e?a(e.namespace,i.expandPath(e.compiledURL)):void 0})},p.dir=r,p.path=function(){return r.path()},p.sourceFiles=function(e){function t(e){if(e.endsWith(p.EXT)){var t=e.truncExt(p.EXT);r[t]=e}}for(var n=p.sourceDirs(e),r={},i=n.length-1;i>=0;i--)n[i].recursive(t);return r},p.sourceDir=function(){return r},p.sourceDirs=function(e){var t=p.getDependingProjects(),n=[r];return t.forEach(function(t){var r=t.getNamespace();if(!e||r==e){var i=t.sourceDir();i&&n.push(i)}}),n},p.decodeTrace=function(e){var t=e.split(":"),n=t[0],r=parseInt(t[1]),i=n.split("."),o=i.pop(),s=i.join(".");if(s==p.getNamespace()){var a=p.sourceFiles(s);for(var u in a)if(o==u)return TError("Trace info",a[u],r)}},p.showProgress=function(){},p.setAMDPaths=function(e){p.env.amdPaths=e},p.genXML=function(e){requirejs(["XMLBuffer"],function(t){var n=p.env.classes[e];if(!n)throw new Error("Class "+e+" not found");if(!n.node)throw new Error("Node not found compile it");var r=t(n.src.tonyu.text());r(n.node),console.log(r.buf)})},p};return"object"==typeof sh&&(sh.tonyuc=function(e){var t=c(sh.resolve(e));return t.compile()}),c}),requireSimulator.setName("PatternParser"),define(["Tonyu"],function(e){var t=function(e,t){this.options=t||{},this.img=e,this.height=e.height,this.width=e.width;var n=this.newImage(e.width,e.height),r=n.getContext("2d");r.drawImage(e,0,0),this.ctx=r,this.pixels=this.ctx.getImageData(0,0,e.width,e.height).data,this.base=this.getPixel(0,0)};return e.extend(t.prototype,{newImage:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},getPixel:function(e,t){var n=this.pixels,r=4*(e+t*this.width),i=n[0+r],o=n[1+r],s=n[2+r],a=n[3+r];return 256*(256*(256*a+s)+o)+i},setPixel:function(e,t,n){var r=4*(e+t*this.width);this.pixels[0+r]=255&n,n=(n-(255&n))/256,this.pixels[1+r]=255&n,n=(n-(255&n))/256,this.pixels[2+r]=255&n,n=(n-(255&n))/256,this.pixels[3+r]=255&n},parse:function(){try{for(var e=[],t=0;t<this.height;t++)for(var n=0;n<this.width;n++){var r=this.getPixel(n,t);r!=this.base&&e.push(this.parse1Pattern(n,t))}return e}catch(i){if(i.isParseError)return console.log("parse error! "+i),[{image:this.img,x:0,y:0,width:this.width,height:this.height}];throw i}},parse1Pattern:function(e,t){function n(e){return e}function r(e,t,n){return{toString:function(){return"at ("+e+","+t+") :"+n},isParseError:!0}}for(var i=this.getPixel(e,t),o=e,s=t,a=this.base,u=this.width,c=this.height;u>o;){var l=this.getPixel(o,s);if(l!=i)break;o++}if(o>=u||this.getPixel(o,s)!=a)throw r(o,s,n(this.getPixel(o,s))+"!="+n(a));for(o--;c>s&&this.getPixel(o,s)==i;)s++;if(s>=c||this.getPixel(o,s)!=a)throw r(o,s,n(this.getPixel(o,s))+"!="+n(a));s--;var f=e+1,h=t+1,p=o-f,d=s-h;if(console.log("PP",f,h,p,d,o,s),p*d==0)throw r(o,s,"w*h==0");for(var m=this.newImage(p,d),g=m.getContext("2d"),v=g.getImageData(0,0,p,d),y=v.data,b=0,_=h;s>_;_++)for(var w=f;o>w;w++){var x=this.getPixel(w,_);x==i?(y[b++]=0,y[b++]=0,y[b++]=0,y[b++]=0):(y[b++]=255&x,x=(x-(255&x))/256,y[b++]=255&x,x=(x-(255&x))/256,y[b++]=255&x,x=(x-(255&x))/256,y[b++]=255&x)}g.putImageData(v,0,0);for(var S=h-1;s>=S;S++)for(var T=f-1;o>=T;T++)this.setPixel(T,S,a);return this.options.boundsInSrc?{x:f,y:h,width:p,height:d}:{image:m,x:0,y:0,width:p,height:d}}}),t}),requireSimulator.setName("Util"),Util=function(){function e(e,n){null==n&&(n=""),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=r.exec(window.location.href);return null==i?n:t(i[1])}function t(e){return decodeURIComponent(e.replace(/\+/g,"%20"))}function n(e,t){return e.substring(e.length-t.length)===t}function r(e,t){return e.substring(0,t.length)===t}function i(e){function t(t){throw console.log(t),console.log(e,c),new Error(t)}e=e.replace(/[\n=]/g,"");var n=new Object;n[65]=0,n[66]=1,n[67]=2,n[68]=3,n[69]=4,n[70]=5,n[71]=6,n[72]=7,n[73]=8,n[74]=9,n[75]=10,n[76]=11,n[77]=12,n[78]=13,n[79]=14,n[80]=15,n[81]=16,n[82]=17,n[83]=18,n[84]=19,n[85]=20,n[86]=21,n[87]=22,n[88]=23,n[89]=24,n[90]=25,n[97]=26,n[98]=27,n[99]=28,n[100]=29,n[101]=30,n[102]=31,n[103]=32,n[104]=33,n[105]=34,n[106]=35,n[107]=36,n[108]=37,n[109]=38,n[110]=39,n[111]=40,n[112]=41,n[113]=42,n[114]=43,n[115]=44,n[116]=45,n[117]=46,n[118]=47,n[119]=48,n[120]=49,n[121]=50,n[122]=51,n[48]=52,n[49]=53,n[50]=54,n[51]=55,n[52]=56,n[53]=57,n[54]=58,n[55]=59,n[56]=60,n[57]=61,n[43]=62,n[47]=63;var r,i=e.length,o=0,s=0;if(!i)return new ArrayBuffer(0);r=Math.floor(i/4*3),"="==e.charAt(i-1)&&(r-=1),"="==e.charAt(i-2)&&(r-=1);for(var a=new ArrayBuffer(r),u=new Uint8Array(a),c=0,l=0;r>l&&(s=n[e.charCodeAt(c)],void 0===s&&t("Invalid letter: "+e.charCodeAt(c)),o=s<<2,c++,s=n[e.charCodeAt(c)],void 0===s&&t("Invalid letter: "+e.charCodeAt(c)),u[l]=o|s>>4&3,o=(15&s)<<4,c++,l++,!(l>=r))&&(s=n[e.charCodeAt(c)],void 0===s&&t("Invalid letter: "+e.charCodeAt(c)),u[l]=o|s>>2&15,o=(3&s)<<6,c++,l++,!(l>=r));)s=n[e.charCodeAt(c)],void 0===s&&t("Invalid letter: "+e.charCodeAt(c)),u[l]=o|s,c++,l++;return a}function o(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",r=new Uint8Array(e),i=r.length,o=0,s=0,a=0;i>a&&(s=r[a],n+=t[s>>2],o=(3&s)<<4,a++,!(a>=i))&&(s=r[a],n+=t[o|s>>4],o=(15&s)<<2,a++,!(a>=i));)s=r[a],n+=t[o|s>>6],n+=t[63&s],a++;var u=i%3;return u&&(n+=t[o]),1==u?n+="==":2==u&&(n+="="),n}function s(e){if(e.__privatized)return e;var t={__privatized:!0};for(var n in e)!function(n){var r=e[n];n.match(/^_/)||"function"==typeof r&&(t[n]=function(){var t=r.apply(e,arguments);return t})}(n);return t}function a(){return"undefined"!=typeof Buffer}function u(e){return a()&&e instanceof Buffer}function c(e){return e instanceof ArrayBuffer||u(e)}function l(e){for(var t=[],n=0;n<e.length;n++)t.push("%"+("0"+e[n].toString(16)).slice(-2));try{return decodeURIComponent(t.join(""))}catch(r){throw console.log(t.join("")),r}}function f(e,t){for(var n=encodeURIComponent(e),r=/^%(..)/,i=[],o=0;o<n.length;o++){var s=r.exec(n.substring(o));s?(i.push(parseInt("0x"+s[1])),o+=s[0].length-1):i.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&t===Buffer?new Buffer(i):new Uint8Array(i).buffer}return{getQueryString:e,endsWith:n,startsWith:r,Base64_To_ArrayBuffer:i,Base64_From_ArrayBuffer:o,utf8bytes2str:l,str2utf8bytes:f,privatize:s,hasNodeBuffer:a,isNodeBuffer:u,isBuffer:c}}(),requireSimulator.setName("Assets"),define(["WebSite","Util","Tonyu","FS"],function(e,t,n,r){var i={};return i.resolve=function(n,i){var o=r.isFile(i)?i:i.getDir();if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,n){return e[n]}),e.urlAliases[n]&&(n=e.urlAliases[n]),t.startsWith(n,"ls:")){var s=n.substring("ls:".length);if(!o)throw new Error("Basedir not specified");var a=o.rel(s);if(!a.exists())throw new Error("Resource file not found: "+a);if(e.mp3Disabled&&s.match(/\.(mp3|mp4|m4a)$/)){var u=o.rel(s.replace(/\.(mp3|mp4|m4a)$/,".ogg"));u.exists()&&(a=u)}n=a.getURL()}return n},n.Assets=i,i}),requireSimulator.setName("ImageList"),define(["PatternParser","Util","Assets","assert"],function(e,t,n,r){function i(e){var t=[];return e.forEach(function(e){e&&""!=e.url&&t.push(e)}),t}var o,s={};return o=function(t,o,a){a||(a={}),t=i(t);var u=[],c=t.length;0==c&&setTimeout(function(){var e=[];e.names={},o(e)},0),t.forEach(function(t,i){function l(){var n,s;if("single"==t.type)u[i]=[{image:this,x:0,y:0,width:this.width,height:this.height}];else if((n=t.pwidth)&&(s=t.pheight)){for(var a=0,l=0,f=this.width,h=this.height,p=[];;){var d=n,m=s;if(a+n>f&&(d=f-a),l+s>h&&(m=h-l),p.push({image:this,x:a,y:l,width:d,height:m}),a+=n,a+n>f&&(a=0,l+=s,l+s>h))break}u[i]=p}else{var g=new e(this);u[i]=g.parse()}if(u[i].name=t.name,r.is(u[i],Array),c--,0==c){var v=[],y={};u.forEach(function(e){y[e.name]=v.length,v=v.concat(e)}),v.names=y,o(v)}}console.log("loading",t,i);var f=t.url,h=f;if(s[h])return void l.apply(s[h],[]);f=n.resolve(f,a.prj||a.baseDir);var p=$("<img>");p.load(function(){s[h]=this,l.apply(this,[])}),p.attr("src",f)})},o.load=o,o.parse1=function(t,n,i){var o,s,a;if((o=t.pwidth)&&(s=t.pheight)){for(var u=0,c=0,l=n.width,f=n.height,h=[];;)if(h.push({image:this,x:u,y:c,width:o,height:s}),u+=o,u+o>l&&(u=0,c+=s,c+s>f))break;a=h}else{var p=new e(n,i);a=p.parse()}return a.name=t.name,r.is(a,Array)},window.ImageList=o,o}),requireSimulator.setName("Auth"),define(["WebSite"],function(e){var t={};return t.currentUser=function(t){$.ajax({type:"get",url:e.serverTop+"/currentUser",data:{withCsrfToken:!0},success:function(e){console.log("auth.currentUser",e),e=JSON.parse(e);var n=e.user;"null"==n&&(n=null),console.log("user",n,"csrfToken",e.csrfToken),t(n,e.csrfToken)}})},t.assertLogin=function(n){t.currentUser(function(t,r){return t?n.success(t,r):(window.onLoggedIn=n.success,void n.showLoginLink(e.serverTop+"/login"))})},window.Auth=t,t}),requireSimulator.setName("Blob"),define(["Auth","WebSite","Util"],function(e,t,n){var r={},i="${blobPath}";return r.BLOB_PATH_EXPR=i,r.upload=function(e,n,r,i){var o=new FormData(document.getElementById("fileinfo"));i.error&&(i.error=function(e){alert(e)}),o.append("theFile",r),o.append("user",e),o.append("project",n),o.append("fileName",r.name),$.ajax({type:"get",url:t.serverTop+"/blobURL",success:function(e){$.ajax({url:e,type:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("Res = "+e),i.success.apply({},arguments)},error:i.error})}})},r.isBlobURL=function(e){if(n.startsWith(e,i)){var t=e.split("/");return{user:t[1],project:t[2],fileName:t[3]}}},r.url=function(e,n,r){return t.blobPath+e+"/"+n+"/"+r},r.uploadToExe=function(e,n){var r=e.getBlobInfos(),i=r.length;return console.log("uploadBlobToExe cnt=",i),0==i?n.success():(n.progress||(n.progress=function(e){console.log("uploadBlobToExe cnt=",e)}),void r.forEach(function(e){var r={csrfToken:n.csrfToken};for(var o in e)r[o]=e[o];$.ajax({type:"get",url:t.serverTop+"/uploadBlobToExe",data:r,success:function(){return i--,0==i?n.success():void n.progress(i)},error:n.error})}))},r}),requireSimulator.setName("ImageRect"),define([],function(){function e(t,n){if("string"==typeof t){var r=new Image,i=null,o=null,s=function(e){e&&(o=e),o&&i&&o(i)};return r.onload=function(){i=e(r,n),s()},r.src=t,s}var a=n.width,u=n.height,c=n.getContext("2d"),l=t.width,f=t.height,h=u/f*l,p=a/l*f;p>u&&(p=u),h>a&&(h=a),c.clearRect(0,0,a,u);var d=Math.floor((a-h)/2),m=Math.floor((u-p)/2);return c.drawImage(t,0,0,l,f,d,m,h,p),{left:d,top:m,width:h,height:p,src:t}}return e}),requireSimulator.setName("Content"),define(["FS"],function(e){return e.Content}),requireSimulator.setName("thumbnail"),define(["ImageRect","Content"],function(e){function t(t){try{var i=Tonyu.globals.$Screen.buf[0],o=$("<canvas>").attr({width:100,height:100});e(i,o[0]);var s=o[0].toDataURL(),a=t.getResource(),u=t.getDir(),c=n.file(t);c.text(s);for(var l={name:r,pwidth:100,pheight:100,url:"ls:"+c.relPath(u)},f=a.images,h=!1,p=0;p<f.length;p++)f[p].name==r&&(f[p]=l,h=!0);h||f.push(l),t.setResource(a),console.log("setRSRC",a)}catch(d){console.log("Create thumbnail failed",d),console.log(d.stack)}}var n={},r="$icon_thumbnail";return n.set=function(e,n){setTimeout(function(){t(e)},n)},n.get=function(e){var t=n.file(e);return t.exists()?t.text():null},n.file=function(e){var t=e.getDir(),n=t.rel("images/").rel("icon_thumbnail.png");return n},n}),requireSimulator.setName("plugins"),define(["WebSite"],function(e){function t(e){return"function"==typeof e&&(e={onload:e}),e||(e={}),e.onload||(e.onload=function(){}),e}var n={},r={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/BodyActor/,symbol:"Box2D"},timbre:{src:"timbre.js",detection:/\bplay(SE)?\b/,symbol:"T"}};return n.installed=r,n.detectNeeded=function(e,t){for(var n in r){var i=r[n].detection.exec(e);i&&(t[n]=1)}return t},n.loaded=function(e){var t=r[e];if(!t)throw new Error("plugin not found: "+e);return window[t.symbol]},n.loadAll=function(e,i){function o(){u>=s.length?i.onload():n.load(s[u++],o)}i=t(i);var s=[];for(var a in e)r[a]&&!n.loaded(a)&&s.push(a);var u=0;console.log("loading plugins",s),setTimeout(o,0)},n.load=function(n,i){var o=r[n];if(!o)throw new Error("plugin not found: "+n);i=t(i);var s=e.pluginTop+"/"+o.src;location.href.match(/^file:/)?($("<script>").attr("src",s).appendTo("body"),setTimeout(i.onload,500)):$.getScript(s,i.onload)},n.request=function(e){if(!n.loaded(e)){var t=new Error("Plugin "+e+" required");t.pluginName=e}},n}),requireSimulator.setName("Tonyu.Project"),define(["Tonyu","ProjectCompiler","TError","FS","Tonyu.TraceTbl","ImageList","StackTrace","Blob","thumbnail","WebSite","plugins","Tonyu.Compiler.Semantics","Tonyu.Compiler.JSGenerator","DeferredUtil","compiledProject"],function(e,t,n,r,i,o,s,a,u,c,l,f,h,p,d){return e.Project=function(n,i){{var f=t(n);e.extend({},f),r.get(c.tonyuHome)}f.EXT=".tonyu",f.NSP_KER="kernel",f.NSP_USR="user";var h;h=i?t(i):d(f.NSP_KER,c.compiledKernel);var m=e.TraceTbl,g={classes:e.classMetas,traceTbl:m,options:{compiler:{}}};return f.env=g,f.dumpJS=function(e){function t(e){console.log("Class "+e+":\n"+g.classes[e].src.js)}if(e)t(e);else for(var e in g.classes)t(e)},f.stop=function(){var e=f.runningThread;e&&e.kill();var t=f.runningObj;return t&&t.stop?t.stop():void 0},f.rawRun=function(e){if(c.removeJSOutput){var t=f.getOutputFile();t.exists()&&t.rm()}return f.loadClasses().then(p.throwF(function(){f.fixBootRunClasses(),f.runScriptMode||u.set(f,2e3),f.rawBoot(e)}))},f.getResource=function(){var t=n.rel("res.json");if(t.exists()){var r=t.obj(),i=!1;for(var o in r)for(var s=r[o],a=s.length-1;a>=0;a--)s[a].url||(s.splice(a,1),i=!0);return i&&f.setResource(r),r}return e.defaultResource},f.hasSoundResource=function(){var e=f.getResource();return e&&e.sounds&&e.sounds.length>0},f.setResource=function(e){var t=n.rel("res.json");t.obj(e)},f.getThumbnail=function(){return u.get(f)},f.convertBlobInfos=function(e){function t(n){if("object"==typeof n)for(var i in n)if(n.hasOwnProperty(i)){var o=n[i];if("url"==i){var s;(s=a.isBlobURL(o))&&(n[i]=[a.BLOB_PATH_EXPR,e,r,s.fileName].join("/"))}t(o)}}var n=f.getResource(),r=f.getName();t(n),f.setResource(n)},f.getBlobInfos=function(){function e(t){if("object"==typeof t)for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];if("url"==r){var o;(o=a.isBlobURL(i))&&n.push(o)}e(i)}}var t=f.getResource(),n=[];return e(t),n},f.loadResource=function(t){var n=f.getResource();o(n.images,function(n){var r=e.getGlobal("$Sprites");r&&r.setImageList(n);for(var i in n.names)e.setGlobal(i,n.names[i]);t&&t()})},f.getOptions=function(){g.options=null;var t=n.rel("options.json");return t.exists()&&(g.options=t.obj()),g.options&&!g.options.run&&(g.options=null),g.options||(g.options=e.defaultOptions),f.fixOptions(g.options),g.options},f.fixOptions=function(e){e.compiler||(e.compiler={}),e.compiler.commentLastPos=f.runScriptMode||s.isAvailable(),e.plugins||(e.plugins={},n.each(function(t){t.endsWith(f.EXT)&&l.detectNeeded(t.text(),e.plugins)}))},f.requestPlugin=function(e){if(!l.loaded(e)){var t=f.getOptions();t.plugins[e]=1,f.setOptions(t);var n=new Error("必要なプラグイン"+e+"を追加しました。もう一度実行してください");throw n.pluginName=e,n}},f.loadPlugins=function(e){var t=f.getOptions();return l.loadAll(t.plugins,e)},f.fixBootRunClasses=function(){var e=f.getOptions();if(e.run){var t=f.fixClassName(e.run.mainClass),n=f.fixClassName(e.run.bootClass);(t!=e.run.mainClass||n!=e.run.bootClass)&&(e.run.mainClass=t,e.run.bootClass=n,f.setOptions(e))}},f.fixClassName=function(t){if(e.getClass(t))return t;var n,r=t.split("."),i=r.pop();return n=f.NSP_USR+"."+i,e.getClass(n)?n:(n=f.NSP_KER+"."+i,e.getClass(n)?n:t)},f.getNamespace=function(){var e=f.getOptions();return e.compiler&&e.compiler.namespace?e.compiler.namespace:f.isKernelEditable()?f.NSP_KER:f.NSP_USR},f.getDependingProjects=function(){return[h]},f.getOutputFile=function(){var e=f.getOptions();return e.compiler.outputFile?r.resolve(e.compiler.outputFile):n.rel("js/concat.js")},f.setOptions=function(e){e&&(g.options=e);var t=n.rel("options.json"),r=t.exists()?t.text():"",i=JSON.stringify(g.options);r!=i&&(console.log("update option",r,i),t.text(i))},f.rawBoot=function(t){f.showProgress("Running "+t),e.run(t)},f.srcExists=function(e,t){var n=null;return t.recursive(function(t){t.truncExt(f.EXT)===e&&(n=t)}),n},f.isKernel=function(t){return i?f.srcExists(t,i):g.classes[f.NSP_KER+"."+t]||e.getClass(f.NSP_KER+"."+t)},f.isKernelEditable=function(){return g.options.kernelEditable},f.renameClassName=function(e,t){return f.compile({noIncremental:!0}).then(function(){var n=f.env.classes;for(var r in n){var i=n[r],o=i.src?i.src.tonyu:null,s=i.annotation,a=[];if(s&&o){console.log("Check",r);for(var u in s)try{var c=s[u],l=c.scopeInfo;if(l&&"class"==l.type&&l.name==e){var h=c.node.pos,p=c.node.len,d=o.text().substring(h,h+p);d==e&&(a.push({pos:h,len:p}),console.log(o.path(),h,p,o.text().substring(h-5,h+p+5),"->",t))}}catch(m){console.log(m)}a=a.sort(function(e,t){return t.pos-e.pos}),console.log(o.path(),a);var g=o.text(),v=g;a.forEach(function(e){g=g.substring(0,e.pos)+t+g.substring(e.pos+e.len)}),v==g||o.isReadOnly()||(console.log("Refact:",o.path(),g),o.text(g))}else console.log("No Check",r)}})},f.showProgress=function(e){return console.log("PROGRESS",e),"undefined"!=typeof SplashScreen&&SplashScreen.progress(e),p.promise(function(e){setTimeout(e,0)})},f}}),requireSimulator.setName("Shell"),define(["FS","assert"],function(e,t){function n(t,n){var i=r(t);if(e.SFile.is(i)||console.log(i," is not file"),n&&!i.exists())throw new Error(i+": no such file or directory");return i}function r(t){if("string"!=typeof t)return t;var n=i.cwd;return o.isAbsolutePath(t)?e.resolve(t,n):n.rel(t)}var i={},o=t(e.PathUtil);return i.newCommand=function(e,t){this[e]=t},i.cd=function(e){return i.cwd=n(e,!0),i.pwd()},i.vars=Object.create(e.getEnv()),i.mount=function(t,n){if(!t||!t.t){var r=[];for(var i in e.getRootFS().availFSTypes())r.push(i);return void sh.err("-t=("+r.join("|")+") should be specified.")}e.mount(n,t.t,t)},i.unmount=function(t){e.unmount(t)},i.fstab=function(){var t=e.getRootFS(),n=t.fstab(),r=this;n.forEach(function(e){r.echo(e.fstype()+"	"+(e.mountPoint||"<Default>"))})},i.resolve=n,i.pwd=function(){return i.cwd+""},i.ls=function(e){return e=e?n(e,!0):i.cwd,e.ls()},i.cp=function(e,t,r){r||(r={}),r.v&&(i.echo("cp",e,t),r.echo=i.echo.bind(i));var o=n(e,!0),s=n(t);return o.copyTo(s,r)},i.ln=function(e,t,r){var i=n(t),o=n(e,!0);if(i.isDir()&&i.exists()&&(i=i.rel(o.name())),i.exists())throw new Error(i+" exists");return i.link(o,r)},i.rm=function(e,t){if(t||(t={}),t.notrash)return e=n(e,!1),e.removeWithoutTrash(),1;if(e=n(e,!0),e.isDir()&&t.r){var r=e,o=0;return r.each(function(e){e.exists()&&(o+=i.rm(e,t))}),r.rm(),o+1}return e.rm(),1},i.mkdir=function(e){if(e=n(e,!1),e.exists())throw new Error(e+" : exists");return e.mkdir()},i.cat=function(e){return e=n(e,!0),i.echo(e.getContent(function(t){return e.isText()?t.toPlainText():t.toURL()}))},i.resolve=function(e){return e||(e="."),e=n(e)},i.grep=function(e,t,r){function o(e,t,n){r.res&&r.res.push({file:e,lineNo:t,line:n}),i.echo(e+"("+t+"): "+n)}return t=n(t,!0),r||(r={}),r.res||(r.res=[]),t.isDir()?t.each(function(t){i.grep(e,t,r)}):"string"==typeof e&&t.lines().forEach(function(n,r){n.indexOf(e)>=0&&o(t,r+1,n)}),r.res},i.touch=function(e){return e=n(e),e.text(e.exists()?e.text():""),1},i.setout=function(e){i.outUI=e},i.echo=function(){return $.when.apply($,arguments).then(function(){console.log.apply(console,arguments),i.outUI&&i.outUI.log&&i.outUI.log.apply(i.outUI,arguments)})},i.err=function(e){console.log.apply(console,arguments),e&&e.stack&&console.log(e.stack),i.outUI&&i.outUI.err&&i.outUI.err.apply(i.outUI,arguments)},i.clone=function(){var e=Object.create(this);return e.vars=Object.create(this.vars),e},i.getvar=function(e){return this.vars[e]||process&&process.env[e]},i.get=i.getvar,i.set=function(e,t){return this.vars[e]=t},i.strcat=function(){if(1==arguments.length)return arguments[0];for(var e="",t=0;t<arguments.length;t++)e+=arguments[t];return e},i.exists=function(e){return e=this.resolve(e),e.exists()},i.dl=function(e){return e=this.resolve(e||"."),e.download()},i.zip=function(){var t=this,n=Array.prototype.slice.call(arguments).map(function(e){return"string"==typeof e?t.resolve(e):e});return e.zip.zip.apply(e.zip,n)},i.unzip=function(){var t=this,n=Array.prototype.slice.call(arguments).map(function(e){return"string"==typeof e?t.resolve(e):e});return e.zip.unzip.apply(e.zip,n)},i.prompt=function(){},i.ASYNC={r:"SH_ASYNC"},i.help=function(){for(var e in i){var t=i[e];"function"==typeof t&&i.echo(e+(t.description?" - "+t.description:""))}},window.sh||(window.sh=i),"object"==typeof process?(sh.devtool=function(){require("nw.gui").Window.get().showDevTools()},sh.cd(process.cwd().replace(/\\/g,"/"))):sh.cd("/"),i}),requireSimulator.setName("KeyEventChecker"),define([],function(){var e={};return e.down=function(t,n,r){t instanceof $||(t=$(t)),t.bind("keydown",function(i){return e.is(i,n)?r.call(t[0],i):void 0})},e.is=function(e,t){t=t.toLowerCase(),e=e.originalEvent||e;var n="";return e.altKey&&(n+="alt+"),e.ctrlKey&&(n+="ctrl+"),e.shiftKey&&(n+="shift+"),n+=e.keyCode>=112&&e.keyCode<=123?"f"+(e.keyCode-111):String.fromCharCode(e.keyCode),n=n.toLowerCase(),t==n
},e}),requireSimulator.setName("ScriptTagFS"),define(["Content"],function(e){var t={};return t.toObj=function(){function e(e,t){var n=e.split("\n"),r="";return n.forEach(function(e){r+=e.length>t?e.substring(0,t):e+"\n"}),r}var t=$("script"),n={};return t.each(function(){var t=this;if("text/tonyu"==t.type){var r=$(t).data("filename");if(r){var i=parseInt($(t).data("lastupdate")),o=$(t).data("wrap");o?(o=parseInt(o),n[r]={lastUpdate:i,text:e(t.innerHTML,o)}):n[r]={lastUpdate:i,text:t.innerHTML}}}}),n},t.copyTo=function(n){var r=t.toObj();for(var i in r){var o=n.rel(i);o.isText()?o.text(r[i].text):o.setBytes(e.url(r[i].text).toByteArray())}},t}),requireSimulator.setName("PicoAudio");var PicoAudio=function(){function e(e,t){var n=window.AudioContext||window.webkitAudioContext;this.context=e?e:new n,this.settings={masterVolume:1,generateVolume:.15,tempo:120,basePitch:440,resolution:480,hashLength:this.isAndroid()?25:50,hashBuffer:2,isWebMIDI:!1,WebMIDIPortOutputs:null,WebMIDIPortOutput:null,WebMIDIPort:-1,WebMIDIPortSysEx:!0,isReverb:!this.isAndroid(),reverbVolume:1.5,isChorus:!0,chorusVolume:.5,isCC111:!0,dramMaxPlayLength:.5,loop:!1},this.trigger={isNoteTrigger:!0,noteOn:function(){},noteOff:function(){},songEnd:function(){}},this.states={isPlaying:!1,playIndex:0,startTime:0,stopTime:0,stopFuncs:[],webMIDIWaitState:null,webMIDIStopTime:0},this.hashedDataList=[],this.hashedMessageList=[],this.channels=[],this.tempoTrack=[{timing:0,value:120},{timing:0,value:120}],this.cc111Time=-1;for(var r=0;17>r;r++)this.channels.push([0,0,1]);if(t&&t.whitenoise)this.whitenoise=t.whitenoise;else{this.whitenoise=this.context.createBuffer(2,this.context.sampleRate,this.context.sampleRate);for(var i=0;2>i;i++)for(var r=0;r<this.context.sampleRate;r++)this.whitenoise.getChannelData(i)[r]=2*Math.random()-1}if(this.masterGainNode=this.context.createGain(),this.masterGainNode.gain.value=this.settings.masterVolume,t&&t.impulseResponse)this.impulseResponse=t.impulseResponse;else{var o=3.5*this.context.sampleRate;this.impulseResponse=this.context.createBuffer(2,o,this.context.sampleRate);for(var i=0;2>i;i++)for(var s=this.impulseResponse.getChannelData(i),r=0;o>r;r++){var a=(o-r)/o,u=r/this.context.sampleRate,c=(.03>u?0:a)*(u>=.03&&.031>u?2*a:a)*(u>=.04&&.042>u?1.5*a:a)*(u>=.05&&.054>u?1.25*a:a)*Math.random()*.2*Math.pow(a-.03,4);s[r]=c}}this.convolver=this.context.createConvolver(),this.convolver.buffer=this.impulseResponse,this.convolver.normalize=!1,this.convolverGainNode=this.context.createGain(),this.convolverGainNode.gain.value=this.settings.reverbVolume,this.convolver.connect(this.convolverGainNode),this.convolverGainNode.connect(this.masterGainNode),this.masterGainNode.connect(this.context.destination),this.chorusDelayNode=this.context.createDelay(),this.chorusGainNode=this.context.createGain(),this.chorusOscillator=this.context.createOscillator(),this.chorusLfoGainNode=this.context.createGain(),this.chorusDelayNode.delayTime.value=.025,this.chorusLfoGainNode.gain.value=.01,this.chorusOscillator.frequency.value=.05,this.chorusGainNode.gain.value=this.settings.chorusVolume,this.chorusOscillator.connect(this.chorusLfoGainNode),this.chorusLfoGainNode.connect(this.chorusDelayNode.delayTime),this.chorusDelayNode.connect(this.chorusGainNode),this.chorusGainNode.connect(this.masterGainNode),this.masterGainNode.connect(this.context.destination),this.chorusOscillator.start(0),this.onSongEndListener=null}return e.prototype.createNote=function(e){var t=!1;if(e.channel)switch(this.channels[e.channel][1]/10||e.instrument){case.2:case 12:case 13:case 45:case 55:t=!0}var n=this.createBaseNote(e,!0,!1,t),r=n.oscillator,i=n.gainNode,o=(n.panNode,n.noiseCutGainNode),s=!1,a=this;switch(this.channels[n.channel][0]/10||e.instrument){case.1:case 6:case 15:case 24:case 26:case 46:case 50:case 51:case 52:case 53:case 54:case 82:case 85:case 86:r.type="sine",i.gain.value*=1.5;break;case.2:case 4:case 12:case 13:case 16:case 19:case 20:case 32:case 34:case 45:case 48:case 49:case 55:case 56:case 57:case 61:case 62:case 63:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 84:r.type="square",i.gain.value*=.8;break;case.3:case 0:case 1:case 2:case 3:case 6:case 7:case 17:case 18:case 21:case 22:case 23:case 27:case 28:case 29:case 30:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 47:case 59:case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 82:case 87:r.type="sawtooth";break;case.4:case 8:case 9:case 10:case 11:case 14:case 25:case 31:case 33:case 35:case 58:case 60:case 83:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:r.type="triangle",i.gain.value*=1.5;break;default:r.type="square"}switch(this.channels[n.channel][1]/10||e.instrument){case.2:case 12:case 13:case 45:case 55:s=!0,i.gain.value*=1.1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(0,n.start+.2),a.stopAudioNode(r,n.start+.5,i);break;case.3:case 0:case 1:case 2:case 3:case 6:case 9:case 11:case 14:case 15:case 32:case 36:case 37:case 46:case 47:i.gain.value*=1.1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(.95*i.gain.value,n.start+.1),i.gain.setValueAtTime(.95*i.gain.value,n.start+.1),i.gain.linearRampToValueAtTime(0,n.start+1.5+3*n.velocity);break;case.4:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 34:i.gain.value*=1.1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(0,n.start+1+4*n.velocity);break;case.5:case 4:case 5:case 7:case 8:case 10:case 33:case 35:i.gain.value*=1,i.gain.setValueAtTime(i.gain.value,n.start),i.gain.linearRampToValueAtTime(.95*i.gain.value,n.start+.1),i.gain.setValueAtTime(.95*i.gain.value,n.start+.1),i.gain.linearRampToValueAtTime(0,n.start+2+10*n.velocity);break;case 119:i.gain.value=0,a.stopAudioNode(r,0,i)}return("sine"==r.type||"triangle"==r.type)&&!s&&n.stop-n.start>.01&&(o.gain.setValueAtTime(1,n.stop-.005),o.gain.linearRampToValueAtTime(0,n.stop)),function(){a.stopAudioNode(r,0,i)}},e.prototype.createPercussionNote=function(e){var t=this.createBaseNote(e,!1),n=t.oscillator,r=t.gainNode,i=(t.panNode,t.start),o=(t.stop,t.velocity*((e.expression?e.expression[0].value:100)/127)),s=this.createBaseNote(e,!1,!0),a=s.oscillator,u=s.gainNode,c=(s.panNode,this);switch(e.pitch){case 35:case 36:r.gain.value=.6*o,n.playbackRate.value=.02,c.stopAudioNode(n,i+.07,r),u.gain.value=1.1*o,a.frequency.setValueAtTime(120,i),a.frequency.linearRampToValueAtTime(50,i+.07),c.stopAudioNode(a,i+.07,u);break;case 38:case 40:n.playbackRate.value=.7,c.stopAudioNode(n,i+.05,r),u.gain.setValueAtTime(.8*o,i),u.gain.linearRampToValueAtTime(0,i+.05),a.frequency.setValueAtTime(300,i),a.frequency.linearRampToValueAtTime(200,i+.05),c.stopAudioNode(a,i+.05,u);break;case 41:case 43:case 45:case 47:case 48:case 50:n.playbackRate.value=.01,c.stopAudioNode(n,i+.1,r),a.type="square",u.gain.setValueAtTime(o,i),u.gain.linearRampToValueAtTime(.01,i+.1),a.frequency.setValueAtTime(150+20*(e.pitch-40),i),a.frequency.linearRampToValueAtTime(50+20*(e.pitch-40),i+.1),c.stopAudioNode(a,i+.1,u);break;case 42:case 44:n.playbackRate.value=1.5,c.stopAudioNode(n,i+.02,r),c.stopAudioNode(a,0,u);break;case 46:n.playbackRate.value=1.5,c.stopAudioNode(n,i+.3,r),r.gain.setValueAtTime(.9*o,i),r.gain.linearRampToValueAtTime(0,i+.3),c.stopAudioNode(a,0,u);break;case 49:case 51:case 52:case 53:case 55:case 57:n.playbackRate.value=1.2,c.stopAudioNode(n,i+.5,r),r.gain.setValueAtTime(1*o,i),r.gain.linearRampToValueAtTime(0,i+.5),c.stopAudioNode(a,0,u);break;case 51:n.playbackRate.value=1.1,c.stopAudioNode(n,i+.4,r),r.gain.setValueAtTime(.8*o,i),r.gain.linearRampToValueAtTime(0,i+.4),c.stopAudioNode(a,0,u);break;case 59:n.playbackRate.value=1.8,c.stopAudioNode(n,i+.3,r),r.gain.setValueAtTime(.5*o,i),r.gain.linearRampToValueAtTime(0,i+.3),c.stopAudioNode(a,0,u);break;case 60:case 61:n.playbackRate.value=.03,c.stopAudioNode(n,i+.03,r),u.gain.setValueAtTime(.8*o,i),u.gain.linearRampToValueAtTime(0,i+.1),a.frequency.setValueAtTime(400-40*(e.pitch-60),i),a.frequency.linearRampToValueAtTime(450-40*(e.pitch-60),i+.1),c.stopAudioNode(a,i+.1,u);break;case 62:n.playbackRate.value=.03,c.stopAudioNode(n,i+.03,r),u.gain.setValueAtTime(o,i),u.gain.linearRampToValueAtTime(0,i+.03),a.frequency.setValueAtTime(200,i),a.frequency.linearRampToValueAtTime(250,i+.03),c.stopAudioNode(a,i+.03,u);break;case 63:case 64:n.playbackRate.value=.03,c.stopAudioNode(n,i+.03,r),u.gain.setValueAtTime(o,i),u.gain.linearRampToValueAtTime(0,i+.1),a.frequency.setValueAtTime(200-30*(e.pitch-63),i),a.frequency.linearRampToValueAtTime(250-30*(e.pitch-63),i+.1),c.stopAudioNode(a,i+.1,u);break;case 56:case 75:n.playbackRate.value=.01,c.stopAudioNode(n,i+.1,r),u.gain.setValueAtTime(o,i),u.gain.linearRampToValueAtTime(0,i+.1),a.frequency.setValueAtTime(1e3+48*(e.pitch-56),i),c.stopAudioNode(a,i+.1,u);break;case 80:n.playbackRate.value=5,r.gain.setValueAtTime(.5*o,i),r.gain.linearRampToValueAtTime(0,i+.2),c.stopAudioNode(n,i+.05,r),a.type="triangle",u.gain.setValueAtTime(.7*o,i),u.gain.linearRampToValueAtTime(0,i+.2),a.frequency.setValueAtTime(6e3,i),c.stopAudioNode(a,i+.05,u);break;case 81:n.playbackRate.value=5,r.gain.setValueAtTime(.9*o,i),r.gain.linearRampToValueAtTime(0,i+.5),c.stopAudioNode(n,i+.5,r),a.type="triangle",u.gain.setValueAtTime(.8*o,i),u.gain.linearRampToValueAtTime(0,i+.3),a.frequency.setValueAtTime(6e3,i),c.stopAudioNode(a,i+.3,u);break;default:n.playbackRate.value=e.pitch/69*2,c.stopAudioNode(n,i+.05,r),c.stopAudioNode(a,0,u)}return function(){c.stopAudioNode(n,0,r),c.stopAudioNode(a,0,u)}},e.prototype.createBaseNote=function(e,t,n,r){var i=this.settings,o=this.context,s=this.states.startTime,a=this.getTime(e.start)+s,u=this.getTime(e.stop)+s,c=i.basePitch*Math.pow(Math.pow(2,1/12),(e.pitch||69)-69),l=n?0:e.channel||0,f=e.velocity*Number(n?1:this.channels[l][2]||1)*i.generateVolume,h=9!=l?o.createOscillator():o.createBufferSource(),p=o.createStereoPanner?o.createStereoPanner():o.createPanner?o.createPanner():{pan:{setValueAtTime:function(){}}},d=o.createGain(),m=o.createGain(),g=this;if(!o.createStereoPanner&&o.createPanner){var v=e.pan&&64!=e.pan[0].value?e.pan[0].value/127*2-1:0;v>1&&(v=1);var y=90*v,b=Math.sin(y*(Math.PI/180)),_=-Math.cos(y*(Math.PI/180));p.panningModel="equalpower",p.setPosition(b,0,_)}else if(o.createStereoPanner){var v=e.pan&&64!=e.pan[0].value?e.pan[0].value/127*2-1:0;v>1&&(v=1),p.pan.value=v}if(d.gain.value=f*((e.expression?e.expression[0].value:100)/127),9!=l?(h.type=e.type||"sine",h.detune.value=0,h.frequency.value=c,e.pitchBend?e.pitchBend.forEach(function(t){h.frequency.setValueAtTime(i.basePitch*Math.pow(Math.pow(2,1/12),e.pitch-69+t.value),g.getTime(t.timing)+s)}):!1):(h.loop=!0,h.buffer=this.whitenoise),t&&(e.expression?e.expression.forEach(function(e){d.gain.setValueAtTime(f*(e.value/127),g.getTime(e.timing)+s)}):!1),o.createStereoPanner||o.createPanner){var w=!0;o.createStereoPanner?e.pan?e.pan.forEach(function(e){if(w)return void(w=!1);var t=64==e.value?0:e.value/127*2-1;t>1&&(t=1),p.pan.setValueAtTime(t,g.getTime(e.timing)+s)}):!1:o.createPanner&&(p.positionX?e.pan?e.pan.forEach(function(e){if(w)return void(w=!1);var t=64==e.value?0:e.value/127*2-1;t>1&&(t=1);var n=90*t,r=Math.sin(n*(Math.PI/180)),i=-Math.cos(n*(Math.PI/180));p.positionX.setValueAtTime(r,g.getTime(e.timing)+s),p.positionY.setValueAtTime(0,g.getTime(e.timing)+s),p.positionZ.setValueAtTime(i,g.getTime(e.timing)+s)}):!1:e.pan?e.pan.forEach(function(e){if(w)return void(w=!1);var t=setTimeout(function(){g.clearFunc("pan",t);var n=64==e.value?0:e.value/127*2-1;n>1&&(n=1);var r=90*n,i=Math.sin(r*(Math.PI/180)),o=-Math.cos(r*(Math.PI/180));p.setPosition(i,0,o)},1e3*(g.getTime(e.timing)+s-o.currentTime));g.pushFunc({pan:t,stopFunc:function(){clearTimeout(t)}})}):!1),h.connect(p),p.connect(d)}else h.connect(d);if(d.connect(m),m.connect(this.masterGainNode),this.masterGainNode.connect(o.destination),9!=l&&e.modulation&&(e.modulation.length>=2||e.modulation[0].value>0)){var x=o.createOscillator(),S=o.createGain();w=!0,e.modulation?e.modulation.forEach(function(e){if(w)return void(w=!1);var t=e.value/127;t>1&&(t=1),S.gain.setValueAtTime(10*c/440*t,g.getTime(e.timing)+s)}):!1;var T=e.modulation?e.modulation[0].value/127:0;T>1&&(T=1),S.gain.value=10*c/440*T,x.frequency.value=6,x.connect(S),S.connect(h.frequency)}if(this.settings.isReverb&&e.reverb&&(e.reverb.length>=2||e.reverb[0].value>0)){var A=this.convolver,E=(this.masterGainNode,o.createGain());w=!0,e.reverb?e.reverb.forEach(function(e){if(w)return void(w=!1);var t=e.value/127;t>1&&(t=1),E.gain.setValueAtTime(t,g.getTime(e.timing)+s)}):!1;var k=e.reverb?e.reverb[0].value/127:0;k>1&&(k=1),E.gain.value=k,d.connect(E),E.connect(A)}if(this.settings.isChorus&&e.chorus&&(e.chorus.length>=2||e.chorus[0].value>0)){var C=this.chorusDelayNode,P=(this.masterGainNode,o.createGain());w=!0,e.chorus?e.chorus.forEach(function(e){if(w)return void(w=!1);var t=e.value/127;t>1&&(t=1),P.gain.setValueAtTime(t,g.getTime(e.timing)+s)}):!1;var D=e.chorus?e.chorus[0].value/127:0;D>1&&(D=1),P.gain.value=D,d.connect(P),P.connect(C)}return x&&(x.start(a),this.stopAudioNode(x,u,S)),h.start(a),9==l||n||r||this.stopAudioNode(h,u,d),{start:a,stop:u,pitch:c,channel:l,velocity:f,oscillator:h,panNode:p,gainNode:d,noiseCutGainNode:m}},e.prototype.startWebMIDI=function(){var e,t=this;if(navigator.requestMIDIAccess){var n=this.settings.WebMIDIPortSysEx,r=function(r){e=r.outputs,t.settings.WebMIDIPortOutputs=e;var i;return-1==t.settings.WebMIDIPort?t.settings.WebMIDIPortOutputs.forEach(function(e){i||(i=e)}):i=t.settings.WebMIDIPortOutputs.get(settings.WebMIDIPort),t.settings.WebMIDIPortOutput=i,t.settings.WebMIDIPortSysEx=n,i&&(i.open(),t.initStatus()),e},i=function(e){console.log(e),n&&(n=!1,navigator.requestMIDIAccess({sysex:n}).then(r).catch(i))};navigator.requestMIDIAccess({sysex:n}).then(r).catch(i),window.addEventListener("unload",function(){for(var e=0;16>e;e++){t.settings.WebMIDIPortOutput.send([176+e,120,0]);for(var n=0;128>n;n++)t.settings.WebMIDIPortOutput.send([128+e,n,0])}})}},e.prototype.initStatus=function(e,t){if(!this.settings.isWebMIDI||null==this.states.webMIDIWaitState){this.stop(e);var n=this.states.webMIDIStopTime;if(this.states={isPlaying:!1,playIndex:0,startTime:0,stopTime:0,stopFuncs:[],webMIDIWaitState:null,webMIDIStopTime:0},this.states.webMIDIStopTime=n,this.settings.isWebMIDI&&!t){if(e)return;if(null==this.settings.WebMIDIPortOutput)return void this.startWebMIDI();if(this.settings.WebMIDIPortSysEx)this.settings.WebMIDIPortOutput.send([240,126,127,9,1,247]);else for(var r=0;16>r;r++)this.settings.WebMIDIPortOutput.send([192+r,0]),this.settings.WebMIDIPortOutput.send([224+r,0,64]),this.settings.WebMIDIPortOutput.send([176+r,100,0]),this.settings.WebMIDIPortOutput.send([176+r,101,0]),this.settings.WebMIDIPortOutput.send([176+r,6,2]),this.settings.WebMIDIPortOutput.send([176+r,100,1]),this.settings.WebMIDIPortOutput.send([176+r,96,0]),this.settings.WebMIDIPortOutput.send([176+r,97,64]),this.settings.WebMIDIPortOutput.send([176+r,7,100]),this.settings.WebMIDIPortOutput.send([176+r,10,64]),this.settings.WebMIDIPortOutput.send([176+r,11,127]),this.settings.WebMIDIPortOutput.send([176+r,98,0]),this.settings.WebMIDIPortOutput.send([176+r,99,0]),this.settings.WebMIDIPortOutput.send([176+r,122,0])}}},e.prototype.stop=function(e){var t=this.states,n=this;if(0!=t.isPlaying&&(t.isPlaying=!1,t.playIndex-=this.settings.hashBuffer+1,t.stopTime=this.context.currentTime,t.stopFuncs.forEach(function(e){e.stopFunc()}),t.stopFuncs=[],this.settings.isWebMIDI)){if(e)return;if(null==this.settings.WebMIDIPortOutput)return;t.webMIDIStopTime=this.context.currentTime,setTimeout(function(){for(var e=0;16>e;e++){n.settings.WebMIDIPortOutput.send([176+e,120,0]);for(var t=0;128>t;t++)n.settings.WebMIDIPortOutput.send([128+e,t,0])}},200)}},e.prototype.play=function(e){var t=this.context,n=this.settings,r=this.trigger,i=this.states,o=this.hashedDataList,s=this;if(1!=i.isPlaying){if(n.isWebMIDI&&!e){if("completed"!=i.webMIDIWaitState){if("waiting"!=i.webMIDIWaitState){i.webMIDIWaitState="waiting";var a=800-1e3*(t.currentTime-i.webMIDIStopTime);0==i.webMIDIStopTime&&(a=800),setTimeout(function(){s.states.webMIDIWaitState="completed",s.states.isPlaying=!1,s.play()},a)}return}i.webMIDIWaitState=null}{var u=this.context.currentTime;i.startTime}i.isPlaying=!0,i.startTime=i.startTime||i.stopTime?i.startTime+u-i.stopTime:u,i.stopFuncs=[];var c=this.getTime(this.firstNoteOnTiming);-i.startTime+u<c&&this.setStartTime(c+i.startTime-u);var l,f=function(){s.clearFunc("rootTimeout",l);var e=s.getTime(s.settings.isCC111&&-1!=s.cc111Time?s.lastNoteOffTiming:s.getTiming(Number.MAX_SAFE_INTEGER));e-t.currentTime+i.startTime<=0?s.onSongEnd():(l=setTimeout(f,1),s.pushFunc({rootTimeout:l,stopFunc:function(){clearTimeout(l)}}))},h=this.getTime(this.settings.isCC111&&-1!=this.cc111Time?this.lastNoteOffTiming:this.getTiming(Number.MAX_SAFE_INTEGER)),p=1e3*(h-t.currentTime+i.startTime);l=setTimeout(f,p),s.pushFunc({rootTimeout:l,stopFunc:function(){clearTimeout(l)}}),function d(e){if(i.playIndex=e,o&&o[e]&&o[e].forEach(function(e){n.isWebMIDI||s.pushFunc({note:e,stopFunc:9!=e.channel?s.createNote(e):s.createPercussionNote(e)});var o=setTimeout(function(){s.clearFunc("timeout",o),r.isNoteTrigger&&r.noteOn(e);var t=setTimeout(function(){s.clearFunc("timeout",t),s.clearFunc("note",e),r.isNoteTrigger&&r.noteOff(e)},9!=e.channel?1e3*(s.getTime(e.stop)-s.getTime(e.start)):1e3*s.settings.dramMaxPlayLength);s.pushFunc({timeout:t,stopFunc:function(){clearTimeout(t)}})},1e3*(s.getTime(e.start)-t.currentTime+i.startTime));s.pushFunc({timeout:o,stopFunc:function(){clearTimeout(o)}})}),n.isWebMIDI&&s.hashedMessageList&&s.hashedMessageList[e]&&s.hashedMessageList[e].forEach(function(e){if(null!=n.WebMIDIPortOutput&&255!=e.message[0]&&(s.settings.WebMIDIPortSysEx||240!=e.message[0]&&247!=e.message[0]))try{n.WebMIDIPortOutput.send(e.message,1e3*(s.getTime(e.timing)-t.currentTime+window.performance.now()/1e3+i.startTime))}catch(r){console.log(r,e.message)}}),e<o.length)if(e-Math.floor(1e3*(t.currentTime-i.startTime)/n.hashLength)<=n.hashBuffer)d(e+1);else{var a=setTimeout(function(){d(e+1),s.clearFunc("rootTimeout",a)},n.hashLength);s.pushFunc({rootTimeout:a,stopFunc:function(){clearTimeout(a)}})}else r.songEnd()}(i.playIndex||0)}},e.prototype.setData=function(e){this.states.isPlaying&&this.stop(),this.settings.resolution=e.header.resolution,this.settings.tempo=e.tempo||120,this.tempoTrack=e.tempoTrack,this.cc111Time=e.cc111Time,this.firstNoteOnTiming=e.firstNoteOnTiming,this.lastNoteOffTiming=e.lastNoteOffTiming;var t=this,n=[];if(e.channels.forEach(function(e){e.notes.forEach(function(e){var r=t.getTime(e.start)*(1e3/t.settings.hashLength);n[Math.floor(r)]||(n[Math.floor(r)]=[]),n[Math.floor(r)].push(e)})}),this.settings.isWebMIDI){var r=[];e.messages.forEach(function(e){var n=t.getTime(e.timing)*(1e3/t.settings.hashLength);r[Math.floor(n)]||(r[Math.floor(n)]=[]),r[Math.floor(n)].push(e)}),this.hashedMessageList=r}return this.hashedDataList=n,this.initStatus(),this},e.prototype.getMasterVolume=function(){return this.settings.masterVolume},e.prototype.setMasterVolume=function(e){this.settings.masterVolume=e,this.masterGainNode.gain.value=this.settings.masterVolume},e.prototype.isLoop=function(){return this.settings.loop},e.prototype.setLoop=function(e){this.settings.loop=e},e.prototype.isWebMIDI=function(){return this.settings.isWebMIDI},e.prototype.setWebMIDI=function(e){this.settings.isWebMIDI=e},e.prototype.isCC111=function(){return this.settings.isCC111},e.prototype.setCC111=function(e){this.settings.isCC111=e},e.prototype.setStartTime=function(e){this.states.startTime-=e,this.states.playIndex=Math.floor(1e3*e/this.settings.hashLength)},e.prototype.setOnSongEndListener=function(e){this.onSongEndListener=e},e.prototype.onSongEnd=function(){if(this.onSongEndListener){var e=this.onSongEndListener();if(e)return}this.settings.loop&&(this.initStatus(!0),this.settings.isCC111&&-1!=this.cc111Time&&this.setStartTime(this.getTime(this.cc111Time)),this.play(!0))},e.prototype.isReverb=function(){return this.settings.isReverb},e.prototype.setReverb=function(e){this.settings.isReverb=e},e.prototype.getReverbVolume=function(){return this.settings.reverbVolume},e.prototype.setReverbVolume=function(e){this.settings.reverbVolume=e},e.prototype.isChorus=function(){return this.settings.isChorus},e.prototype.setChorus=function(e){this.settings.isChorus=e},e.prototype.getChorusVolume=function(){return this.settings.chorusVolume},e.prototype.setChorusVolume=function(e){this.settings.chorusVolume=e},e.prototype.isAndroid=function(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("android")&&-1==e.indexOf("windows")},e.prototype.getTime=function(e){var t=0,n=120,r=0,i=this;return this.tempoTrack.some(function(o){return e<o.timing?!0:(t+=60/n/i.settings.resolution*(o.timing-r),r=o.timing,void(n=o.value))}),t+=60/n/i.settings.resolution*(e-r)},e.prototype.getTiming=function(e){var t=0,n=120,r=0,i=this;return this.tempoTrack.some(function(o){return t+=60/n/i.settings.resolution*(o.timing-r),t>e?(t-=60/n/i.settings.resolution*(o.timing-r),r+=(e-t)/(60/n/i.settings.resolution),!0):(r=o.timing,void(n=o.value))}),r},e.prototype.parseSMF=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<8)+e[n];return t}function n(e){for(var t=0,n=0;t<e.length-1&&e[t]>=128;)4>t&&(n=(n<<7)+(e[t]-128)),t++;return n=(n<<7)+e[t],t++,[n,t]}if(77!=e[0]||84!=e[1]||104!=e[2]||100!=e[3])return"Not Sandard MIDI File.";var r=new Object,i=4,o=new Object;o.size=t(e.subarray(4,8)),o.format=e[9],o.trackcount=t(e.subarray(10,12)),o.timemanage=e[12],o.resolution=t(e.subarray(12,14)),i+=4+o.size;for(var s=new Array,a=new Array,u=new Array,c=-1,l=Number.MAX_SAFE_INTEGER,f=0,h=0;16>h;h++){var p=new Object;u.push(p),p.messages=[],p.notes=[]}var d=0;if(this.settings.isWebMIDI)var m=[];for(var g=0;g<o.trackcount;g++){if(77!=e[i]||84!=e[i+1]||114!=e[i+2]||107!=e[i+3])return"Irregular SMF.";i+=4;var v=(new Object,i+4+t(e.subarray(i,i+4)));i+=4;for(var y=0,b=1;v>i;){if(null!=b){var _=n(e.subarray(i,i+5)),w=_[0];y+=w,y>1e8&&(y=1e8),i+=_[1]}if(this.settings.isWebMIDI)var x=i;var S,T={timing:y,mes:[]};switch(Math.floor(e[i]/16)){case 8:case 9:case 10:case 11:case 14:b=e[i],T.mes.push(e[i],e[i+1],e[i+2]);var A=u[15&b].messages;for(S=A.length-1;S>=0;S--){var E=A[S];if(y>=E.timing)break}S++,A.splice(S,0,T),i+=3;break;case 12:case 13:b=e[i],T.mes.push(e[i],e[i+1]);var A=u[15&b].messages;for(S=A.length-1;S>=0;S--){var E=A[S];if(y>=E.timing)break}S++,A.splice(S,0,T),i+=2;break;case 15:switch(e[i]){case 240:case 247:var _=n(e.subarray(i+1,i+1+4));if(_[0]>=7&&127==e[i+2]&&127==e[i+3]&&4==e[i+4]&&1==e[i+5])for(var h=0;16>h;h++){T.mes.push(e[i],_[0]-1,e[i+2],e[i+3],e[i+4],e[i+5],e[i+6],e[i+7]);var A=u[h].messages;for(S=A.length-1;S>=0;S--){var E=A[S];if(y>=E.timing)break}S++,A.splice(S,0,T)}i+=1+_[1]+_[0];break;case 241:i+=2;break;case 242:i+=3;break;case 243:i+=2;break;case 246:case 248:case 250:case 251:case 252:case 254:i+=1;break;case 255:switch(e[i+1]){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 32:break;case 47:y+=-w;break;case 81:r.tempo=6e7/(65536*e[i+3]+256*e[i+4]+e[i+5]),s.push({timing:y,value:6e7/(65536*e[i+3]+256*e[i+4]+e[i+5])});break;case 84:break;case 88:a.push({timing:y,value:[e[i+3],Math.pow(2,e[i+4])]});break;case 89:case 127:}var _=n(e.subarray(i+2,i+2+4));i+=2+_[1]+_[0]}break;default:if(null==b)return"Irregular SMF.";i--,e[i]=b,b=null}if(this.settings.isWebMIDI&&null!=b){var k=e[x];if(240==k||247==k){if(this.settings.WebMIDIPortSysEx){var _=n(e.subarray(x+1,x+1+4)),C=x+1+_[1],P=C+_[0],D=new Uint8Array(1+_[0]);D[0]=k;for(var M=P-C,h=0;M>h;h++)D[h+1]=e[C+h];m.push({message:D,timing:y})}}else m.push({message:e.subarray(x,i),timing:y})}}y>d&&(d=y)}s.push({timing:d,value:120});for(var B=0;B<u.length;B++){for(var p=u[B],i=0,v=p.messages.length,N=2,I=0,O=64,L=127,R=100,F=0,j=0,z=0,U=127,G=127,W=127,V=127,q=null,$=127,Z=[];v>i;){var T=p.messages[i],y=T.timing,H=p.messages[i].mes;switch(Math.floor(H[0]/16)){case 8:var h=0;Z.some(function(e){var t=p.notes[e];return t.pitch==H[1]&&null==t.stop?(t.stop=y,Z.splice(h,1),y>f&&(f=y),!0):void h++});break;case 9:if(0!=H[2]){var J={start:y,stop:null,pitch:H[1],pitchBend:[{timing:y,value:I}],pan:[{timing:y,value:O}],expression:[{timing:y,value:L*($/127)}],velocity:H[2]/127*(R/127),modulation:[{timing:y,value:F}],reverb:[{timing:y,value:j}],chorus:[{timing:y,value:z}],instrument:q,channel:B};Z.push(p.notes.length),p.notes.push(J),l>y&&(l=y)}else{var h=0;Z.some(function(e){var t=p.notes[e];return t.pitch==H[1]&&null==t.stop?(t.stop=y,Z.splice(h,1),y>f&&(f=y),!0):void h++})}break;case 10:break;case 11:switch(H[1]){case 1:F=H[2],Z.forEach(function(e){var t=p.notes[e];t.modulation.push({timing:y,value:F})});break;case 6:0==W&&0==V&&(N=H[2],N>24&&(N=24));break;case 7:R=H[2];break;case 10:O=H[2],Z.forEach(function(e){var t=p.notes[e];t.pan.push({timing:y,value:O})});break;case 11:L=H[2],Z.forEach(function(e){var t=p.notes[e];t.expression.push({timing:y,value:L*($/127)})});break;case 91:j=H[2],Z.forEach(function(e){var t=p.notes[e];t.reverb.push({timing:y,value:j})});break;case 93:z=H[2],Z.forEach(function(e){var t=p.notes[e];t.chorus.push({timing:y,value:z})});break;case 98:U=H[2];break;case 99:G=H[2];break;case 100:W=H[2];break;case 101:V=H[2];break;case 111:-1==c&&(c=y)}break;case 12:q=H[1];break;case 13:break;case 14:I=(128*H[2]+H[1]-8192)/8192*N,Z.forEach(function(e){var t=p.notes[e];t.pitchBend.push({timing:y,value:I})});break;case 15:switch(H[0]){case 240:case 247:if(H[1]>=6&&127==H[2]&&127==H[3]&&4==H[4]&&1==H[5]){var K=H[7];K>127&&(K=127),$=K,Z.forEach(function(e){var t=p.notes[e];t.expression.push({timing:y,value:L*($/127)})})}}break;default:return"Error parseSMF."}i++}delete p.messages}return r.header=o,r.tempoTrack=s,r.beatTrack=a,r.channels=u,r.songLength=d,r.cc111Time=c,r.firstNoteOnTiming=l,r.lastNoteOffTiming=f,this.settings.isWebMIDI&&(r.messages=m),r},e.prototype.stopAudioNode=function(e,t,n){try{t>0?e.stop(t):(e.stop(this.context.currentTime+.005),n.gain.cancelScheduledValues(this.context.currentTime),n.gain.linearRampToValueAtTime(0,this.context.currentTime+.005))}catch(r){n.gain.cancelScheduledValues(t),0>=t&&n.gain.linearRampToValueAtTime(0,this.context.currentTime+.005)}},e.prototype.pushFunc=function(e){(e.note||e.rootTimeout||this.trigger.isNoteTrigger)&&this.states.stopFuncs.push(e)},e.prototype.clearFunc=function(e,t){if("note"==e||"rootTimeout"==e||this.trigger.isNoteTrigger){var n=this;n.states.stopFuncs.some(function(r,i){return r[e]==t?(n.states.stopFuncs.splice(i,1),!0):void 0})}},e}();requireSimulator.setName("T2MediaLib");var T2MediaLib=function(){var e=function(e){this.context=null,this.picoAudio=null,this.soundDataAry=[],this.bgmPlayerMax=16,this.bgmPlayerAry=[],this.masterVolume=1,this.seMasterVolume=1,this.bgmMasterVolume=1,this.playingAudio=null,this.audioVolume=1,this.audioTempo=1,this.audioDataAry={data:[]},this.init(e)};return e.prototype.init=function(e){if(!this.inited&&(this.inited=!0,!this.disabled&&(e?this.context=e:window.AudioContext?this.context=new AudioContext:window.webkitAudioContext?this.context=new webkitAudioContext:(this.context=null,console.log("Your browser does not support yet Web Audio API")),this.context)))for(var t=0;t<this.bgmPlayerMax;t++)this.bgmPlayerAry[t]=new T2MediaLib_BGMPlayer(this,t)},e.prototype.allClearSoundData=function(){var e=this.soundDataAry;for(var t in e)delete e[t]},e.prototype.clearSoundData=function(e){var t=this.soundDataAry;delete t[e]},e.prototype.allRemoveDecodedSoundData=function(){var e=this.soundDataAry;for(var t in e){var n=e[t];null!=n&&(n.isDecodeComplete()||n.isDecoding())&&n.removeDecodedData()}},e.prototype.removeDecodedSoundData=function(e){var t=this.soundDataAry[e];null!=t&&(t.isDecodeComplete()||t.isDecoding())&&t.removeDecodedData()},e.prototype.getMasterVolume=function(){return this.masterVolume},e.prototype.setMasterVolume=function(e){this.masterVolume=e;for(var t=0;t<this.bgmPlayerMax;t++){var n=this.bgmPlayerAry[t];n instanceof T2MediaLib_BGMPlayer&&n.onChangeBGMMasterVolume()}},e.prototype.createSoundFromArray=function(e,t,n){this.soundDataAry[e]=new T2MediaLib_SoundData;for(var r=this.context,i=null!=t&&null!=n?2:1,o=r.createBuffer(i,array.length,r.sampleRate),s=o.getChannelData(0),a=null!=n?o.getChannelData(1):null,u=0;u<array.length;u++)s[u]=t[u];if(a)for(var u=0;u<array.length;u++)a[u]=n[u];this.soundDataAry[e].onDecodeComplete(o)},e.prototype.loadSound=function(e,t,n){if(this.soundDataAry[e]=new T2MediaLib_SoundData,!this.context||this.disabled)return this.soundDataAry[e].onError("FUNC_DISABLED_ERROR"),null;(t.match(/\.(midi?)$/)||t.match(/^data:audio\/mid/))&&null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context)),"object"==typeof WebSite&&WebSite.mp3Disabled&&(t=t.replace(/\.(mp3|mp4|m4a)$/,".ogg"));var r=this,i=new XMLHttpRequest;i.onload=function(){if(200===i.status||0===i.status){var t=i.response;t instanceof ArrayBuffer?(r.soundDataAry[e].onLoadComplete(t),n&&n.succ&&n.succ(e)):(r.soundDataAry[e].onError("XHR_RESPONSE_ERROR"),n&&n.err&&n.err(e,r.soundDataAry[e].errorID))}else r.soundDataAry[e].onError("XHR_STATUS_ERROR"),n&&n.err&&n.err(e,r.soundDataAry[e].errorID)},i.onerror=function(t){console.log(t+""),r.soundDataAry[e].onError("XHR_ERROR"),n&&n.err&&n.err(e,r.soundDataAry[e].errorID)},this.soundDataAry[e].onLoad(t),t.match(/^data:/)&&Util&&Util.Base64_To_ArrayBuffer?(i={onload:i.onload},i.response=Util.Base64_To_ArrayBuffer(t.replace(/^data:audio\/[a-zA-Z0-9]+;base64,/i,"")),i.status=200,i.onload()):(i.open("GET",t,!0),i.responseType="arraybuffer",i.send(null))},e.prototype.decodeSound=function(e,t){var n=this.soundDataAry[e];if(null!=n&&!n.isDecodeComplete()){if(null==n.decodedCallbacksAry&&(n.decodedCallbacksAry=[]),t)if(null!=t.bgmPlayerId){var r=n.decodedCallbacksAry.some(function(e,r){return t.bgmPlayerId==e.bgmPlayerId?(n.decodedCallbacksAry[r]=t,!0):!1});r||n.decodedCallbacksAry.push(t)}else n.decodedCallbacksAry.push(t);if(!n.isDecoding()){n.onDecode();var i=n.fileData.slice(0);if(n.url.match(/\.(midi?)$/)||n.url.match(/^data:audio\/mid/)){null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.context));var o=new Uint8Array(i),s=this.picoAudio.parseSMF(o);"string"==typeof s?(console.log("T2MediaLib: Error parseSMF()",s),this.soundDataAry[e].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(t){"function"==typeof t.err&&t.err(e,this.soundDataAry[e].errorID)}),n.decodedCallbacksAry=null):(this.soundDataAry[e].onDecodeComplete(s),n.decodedCallbacksAry.forEach(function(t){"function"==typeof t.succ&&t.succ(e)}),n.decodedCallbacksAry=null)}else{var a=this,u=function(t){a.soundDataAry[e].isDecoding()&&(a.soundDataAry[e].onDecodeComplete(t),n.decodedCallbacksAry.forEach(function(t){"function"==typeof t.succ&&t.succ(e)}),n.decodedCallbacksAry=null)},c=function(t){t instanceof Error?console.log("T2MediaLib: "+t.message,n.url):console.log("T2MediaLib: Error decodeAudioData()",n.url),a.soundDataAry[e].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(t){"function"==typeof t.err&&t.err(e,a.soundDataAry[e].errorID)}),n.decodedCallbacksAry=null};this.context.decodeAudioData(i,u,c)}}}},e.prototype.activate=function(){if(this.init(),!this.isActivated){this.isActivated=!0;for(var e=this.context,t=e.createBuffer(1,Math.floor(e.sampleRate/32),e.sampleRate),n=t.getChannelData(0),r=(Math.floor(e.sampleRate/860),0);r<n.length;r++)n[r]=0;var i=e.createBufferSource();i.buffer=t,i.connect(e.destination),i.start=i.start||i.noteOn,i.start(0)}},e.prototype.getSoundFileData=function(e){var t=this.soundDataAry[e];return t?t.fileData:null},e.prototype.getSoundDecodedData=function(e){var t=this.soundDataAry[e];return t?t.decodedData:null},e.prototype.getCurrentTime=function(){return this.context?this.context.currentTime:null},e.prototype.playSE=function(e,t,n,r,i,o,s,a,u,c){if(!this.context)return null;
var l=this.soundDataAry[e];if(null==l)return null;if(!l.isDecodeComplete()){var f=this,h={};return h.succ=function(e){f.playSE(e,t,n,r,i,o,s,a,u,c)},h.err=function(){},this.decodeSound(e,h),null}var p=l.decodedData;if(!(p instanceof AudioBuffer))return null;null==t&&(t=1),null==n&&(n=0),r||(r=1),i?i>p.duration?i=p.duration:0>i&&(i=0):i=0,c||(c=void 0),o||(o=!1),s?0>s?s=0:s>p.duration&&(s=p.duration):s=0,a?0>a?a=0:a>p.duration&&(a=p.duration):a=p.duration,u=u||0;var d=this.context.createBufferSource();this.context.createGain=this.context.createGain||this.context.createGainNode;var m=this.context.createGain(),g=this.context.createPanner();d.buffer=p,d.loop=o,d.loopStart=s,d.loopEnd=a,d.playbackRate.value=r,d.connect(m),m.connect(g),g.connect(this.context.destination),g.panningModel="equalpower",-1>n?n=-1:n>1&&(n=1);var v=90*n,y=Math.sin(v*(Math.PI/180)),b=-Math.cos(v*(Math.PI/180));(-1===n||1===n)&&(b=0),g.positionX?(g.positionX.value=y,g.positionY.value=0,g.positionZ.value=b):g.setPosition(y,0,b),m.gain.value=t*this.seMasterVolume*this.masterVolume;var _;return _=o&&a-s>0&&i>a?a:i,d.gainNode=m,d.volumeValue=t,d.panNode=g,d.panValue=n,d.playStartTime=this.context.currentTime+u,d.playOffset=_,d.plusTime=_,d.start=d.start||d.noteOn,d.stop=d.stop||d.noteOff,d.start(u,i,c),o&&null!=c&&d.stop(u+c),d.onended=function(){d.onended=null},d},e.prototype.stopSE=function(e){return e instanceof AudioBufferSourceNode?(e.stop(0),e):null},e.prototype.getSEMasterVolume=function(){return this.seMasterVolume},e.prototype.setSEMasterVolume=function(e){this.seMasterVolume=e},e.prototype.getSEVolume=function(e){return e instanceof AudioBufferSourceNode?source.volumeValue:null},e.prototype.setSEVolume=function(e,t){return e instanceof AudioBufferSourceNode?(e.gainNode.gain.value=t*this.seMasterVolume*this.masterVolume,source.volumeValue=t,e):null},e.prototype.getSERate=function(e){return e instanceof AudioBufferSourceNode?e.playbackRate.value:null},e.prototype.setSERate=function(e,t){return e instanceof AudioBufferSourceNode?void(e.playbackRate.value=t):null},e.prototype.getSEPan=function(e){return e instanceof AudioBufferSourceNode?e.panValue:null},e.prototype.setSEPan=function(e,t){if(!(e instanceof AudioBufferSourceNode))return null;var n=e.panNode;-1>t?t=-1:t>1&&(t=1);var r=90*t,i=Math.sin(r*(Math.PI/180)),o=Math.cos(r*(Math.PI/180));(-1===t||1===t)&&(o=0),n.positionX?(n.positionX.value=i,n.positionY.value=0,n.positionZ.value=o):n.setPosition(i,0,o),e.panValue=t},e.prototype.isSELoop=function(e){return e instanceof AudioBufferSourceNode?e.loop:null},e.prototype.setSELoop=function(e,t){return e instanceof AudioBufferSourceNode?void(e.loop=t):null},e.prototype.getSELoopStartTime=function(e){return e instanceof AudioBufferSourceNode?e.loopStart:null},e.prototype.setSELoopStartTime=function(e,t){return e instanceof AudioBufferSourceNode?void(e.loopStart=t):null},e.prototype.getSELoopEndTime=function(e){return e instanceof AudioBufferSourceNode?e.loopEnd:null},e.prototype.setSELoopEndTime=function(e,t){return e instanceof AudioBufferSourceNode?void(e.loopEnd=t):null},e.prototype.playBGM=function(e,t,n,r,i,o){if(!this.context)return null;var s=this._getBgmPlayer(e);return s?s.playBGM(t,n,r,i,o):null},e.prototype.stopBGM=function(e){var t=this._getBgmPlayer(e);return t?t.stopBGM():null},e.prototype.pauseBGM=function(e){var t=this._getBgmPlayer(e);return t?t.pauseBGM():null},e.prototype.resumeBGM=function(e){var t=this._getBgmPlayer(e);return t?t.resumeBGM():null},e.prototype.getBGMMasterVolume=function(){return this.bgmMasterVolume},e.prototype.setBGMMasterVolume=function(e){this.bgmMasterVolume=e;for(var t=0;t<this.bgmPlayerMax;t++){var n=this.bgmPlayerAry[t];n instanceof T2MediaLib_BGMPlayer&&n.onChangeBGMMasterVolume()}},e.prototype.getBGMVolume=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMVolume():null},e.prototype.setBGMVolume=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMVolume(t):null},e.prototype.getBGMTempo=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMTempo():null},e.prototype.setBGMTempo=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMTempo(t):null},e.prototype.getBGMPan=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMPan():null},e.prototype.setBGMPan=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMPan(t):null},e.prototype.isBGMLoop=function(e){var t=this._getBgmPlayer(e);return t?t.isBGMLoop():null},e.prototype.setBGMLoop=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMLoop(t):null},e.prototype.getBGMLoopStartTime=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMLoopStartTime():null},e.prototype.setBGMLoopStartTime=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMLoopStartTime(t):null},e.prototype.getBGMLoopEndTime=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMLoopEndTime():null},e.prototype.setBGMLoopEndTime=function(e,t){var n=this._getBgmPlayer(e);return n?n.setBGMLoopEndTime(t):null},e.prototype.getBGMCurrentTime=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMCurrentTime():null},e.prototype.getBGMLength=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMLength():null},e.prototype.getPlayingBGMName=function(e){var t=this._getBgmPlayer(e);return t?t.getPlayingBGMName():null},e.prototype.setOnBGMEndListener=function(e,t){var n=this._getBgmPlayer(e);return n?n.setOnBGMEndListener(t):null},e.prototype.getPlayingBGMState=function(e){var t=this._getBgmPlayer(e);return t?t.getPlayingBGMState():null},e.prototype.getBGMPicoAudio=function(e){var t=this._getBgmPlayer(e);return t?t.getBGMPicoAudio():null},e.prototype.getBGMPlayerMax=function(){return this.bgmPlayerMax},e.prototype.allStopBGM=function(){for(var e=0;e<this.bgmPlayerMax;e++)this.stopBGM(e)},e.prototype.allResetBGM=function(){for(var e=0;e<this.bgmPlayerMax;e++)this.stopBGM(e),this.setBGMVolume(e,1),this.setBGMTempo(e,1),this.setBGMPan(e,0);this.setMasterVolume(1),this.setSEMasterVolume(1),this.setBGMMasterVolume(1)},e.prototype._getBgmPlayer=function(e){if(0>e||this.bgmPlayerMax<=e)return null;var t=this.bgmPlayerAry[e];return t instanceof T2MediaLib_BGMPlayer?t:null},e.prototype.loadAudio=function(e,t){var n=new Audio(t);n.play(),this.audioDataAry.data[e]=null;var r=this;n.addEventListener("loadstart",function(){if(!r.context)return null;var e=r.context.createMediaElementSource(n);e.connect(r.context.destination)},!1),n.addEventListener("canplay",function(){this.audioDataAry.data[e]=n},!1),n.load()},e.prototype.playAudio=function(e,t,n){var r=this.audioDataAry.data[e];return r?(n||(n=0),this.playingAudio instanceof Audio&&(this.playingAudio.pause(),this.playingAudio.currentTime=0),this.playingAudio=r,r.loop=t,r.volume=this.audioVolume,r.currentTime=n,r.play(),r):null},e.prototype.stopAudio=function(){var e=this.playingAudio;return e instanceof Audio?(e.pause(),e.currentTime=0,this.playingAudio=null,e):null},e.prototype.pauseAudio=function(){var e=this.playingAudio;return e?(e.pause(),e):null},e.prototype.resumeAudio=function(){var e=this.playingAudio;return e?(e.play(),e):null},e.prototype.setAudioVolume=function(e){this.audioVolume=e,this.playingAudio instanceof Audio&&(this.playingAudio.volume=e)},e.prototype.setAudioTempo=function(e){this.audioTempo=e,this.playingAudio instanceof Audio&&(this.playingAudio.playbackRate=e)},e.prototype.setAudioPosition=function(e){this.playingAudio instanceof Audio&&(this.playingAudio.currentTime=e)},e.prototype.getAudioData=function(e){return this.audioDataAry.data[e]},e.prototype.getAudioCurrentTime=function(){return this.playingAudio instanceof Audio?this.playingAudio.currentTime:null},e.prototype.getAudioLength=function(){return this.playingAudio instanceof Audio?this.playingAudio.duration:null},e}(),T2MediaLib_BGMPlayer=function(){var e=function(e,t){this.t2MediaLib=e,this.id=t,this.playingBGMState="stop",this.playingBGMStatePending=null,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1,this.bgmPan=0,this.picoAudio=null,this.picoAudioSetDataBGMName=null,this.PICO_AUDIO_VOLUME_COEF=1};return e.prototype.playBGM=function(e,t,n,r,i){this.stopBGM();var o=this.t2MediaLib.soundDataAry[e];if(null==o)return null;if(!o.isDecodeComplete()){var s=this,a={};return a.bgmPlayerId=this.id,a.succ=function(){var o=s.playingBGMStatePending;s._setPlayingBGMState("stop",!0),"stop"!=o&&s.playingBGMName==e&&s.playBGM(e,t,n,r,i),"pause"==o&&s.pauseBGM()},a.err=function(){s._setPlayingBGMState("stop",!0)},this.playingBGMName=e,this._setPlayingBGMState("decoding",!0),this._setPlayingBGMState("play"),this.t2MediaLib.decodeSound(e,a),this}var u=o.decodedData;if(u instanceof AudioBuffer)this.playingBGM=this.t2MediaLib.playSE(e,this.bgmVolume,this.bgmPan,this.bgmTempo,n,t,r,i);else if(u instanceof Object){if(this._initPicoAudio(),e!=this.picoAudioSetDataBGMName?(this.picoAudio.setData(u),this.picoAudioSetDataBGMName=e):this.picoAudio.initStatus(),this.picoAudio.setLoop(t),this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*this.bgmVolume*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),n){var c=this.picoAudio.getTime(this.picoAudio.getTiming(Number.MAX_SAFE_INTEGER));n>c?n=c:0>n&&(n=0)}else n=0;this.picoAudio.setStartTime(n),this.picoAudio.play(),this.playingBGM=this.picoAudio}return this.playingBGMName=e,this.bgmPause=0,this._setPlayingBGMState("play"),this},e.prototype.stopBGM=function(){var e=this.playingBGM;return e instanceof PicoAudio?this.picoAudio.stop():e instanceof AudioBufferSourceNode&&e.stop(0),this.playingBGM=null,this.playingBGMName=null,this._setPlayingBGMState("stop"),this},e.prototype.pauseBGM=function(){var e=this.playingBGM;return e instanceof PicoAudio?0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseCurrentTime=e.context.currentTime,e.stop(),this.bgmPause=1):e instanceof AudioBufferSourceNode&&0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=this.t2MediaLib.getSELoopStartTime(e),this.bgmPauseLoopEnd=this.t2MediaLib.getSELoopEndTime(e),this.bgmPauseLoop=this.t2MediaLib.isSELoop(e),this.bgmPauseCurrentTime=e.context.currentTime,this.bgmPauseTempo=this.bgmTempo,e.stop(0),this.bgmPause=1),"stop"!=this.playingBGMState&&this._setPlayingBGMState("pause"),this},e.prototype.resumeBGM=function(){var e=this.playingBGM;return e instanceof PicoAudio?1===this.bgmPause&&(e.play(),this.bgmPause=0):e instanceof AudioBufferSourceNode&&1===this.bgmPause&&(e=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd)),this},e.prototype.onChangeBGMMasterVolume=function(){this.setBGMVolume(this.getBGMVolume())},e.prototype.getBGMVolume=function(){return this.bgmVolume},e.prototype.setBGMVolume=function(e){var t=this.playingBGM;return this.bgmVolume=e,t instanceof PicoAudio?this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*e*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume):t instanceof AudioBufferSourceNode&&(t.gainNode.gain.value=e*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),this},e.prototype.getBGMTempo=function(){return this.bgmTempo},e.prototype.setBGMTempo=function(e){var t=this.playingBGM;return(0>=e||isNaN(e))&&(e=1),t instanceof AudioBufferSourceNode&&0===this.bgmPause&&(t.plusTime-=(this.t2MediaLib.context.currentTime-t.playStartTime)*(e-this.bgmTempo)),this.bgmTempo=e,this.t2MediaLib.setSERate(t,e),this},e.prototype.getBGMPan=function(){return this.bgmPan},e.prototype.setBGMPan=function(e){var t=this.playingBGM;return this.bgmPan=e,t instanceof AudioBufferSourceNode&&this.t2MediaLib.setSEPan(t,e),this},e.prototype.isBGMLoop=function(){var e=this.playingBGM;return e instanceof PicoAudio?this.picoAudio.isLoop():e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoop:this.t2MediaLib.isSELoop(e):null},e.prototype.setBGMLoop=function(e){var t=this.playingBGM;return t instanceof PicoAudio?this.picoAudio.setLoop(e):t instanceof AudioBufferSourceNode&&(1===this.bgmPause?this.bgmPauseLoop=e:this.t2MediaLib.setSELoop(t,e)),this},e.prototype.getBGMLoopStartTime=function(){var e=this.playingBGM;return e instanceof PicoAudio?0:e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopStart:this.t2MediaLib.getSELoopStartTime(e):null},e.prototype.setBGMLoopStartTime=function(e){var t=this.playingBGM;if(t instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopStartTime(t,e);this.bgmPauseLoopStart=e}return this},e.prototype.getBGMLoopEndTime=function(){var e=this.playingBGM;return e instanceof PicoAudio?this.getBGMLength():e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopEnd:this.t2MediaLib.getSELoopEndTime(e):null},e.prototype.setBGMLoopEndTime=function(e){var t=this.playingBGM;if(t instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopEndTime(t,e);this.bgmPauseLoopEnd=e}return this},e.prototype.getBGMCurrentTime=function(){var e=this.playingBGM;if(e instanceof PicoAudio){var t;return t=0===this.bgmPause?this.picoAudio.getTime(this.picoAudio.getTiming(this.picoAudio.context.currentTime-this.picoAudio.states.startTime)):this.bgmPauseTime}if(e instanceof AudioBufferSourceNode){var t,n,r,i,o,s,a;return 0===this.bgmPause?(r=this.t2MediaLib.context.currentTime,i=this.bgmTempo):(r=this.bgmPauseCurrentTime,i=this.bgmPauseTempo),n=(r-e.playStartTime)*i+e.plusTime,e.loop&&(e.loopEnd-e.loopStart>0?n<e.loopStart?(o=0,s=0,a=e.buffer.duration):(o=e.loopStart,s=e.loopStart,a=e.loopEnd-e.loopStart):(a=e.buffer.duration,o=0,s=0)),e.loop?t=(n-s)%a+o:(t=n,t>e.buffer.duration&&(t=e.buffer.duration)),t}return null},e.prototype.getBGMLength=function(){var e=this.playingBGM;return e instanceof PicoAudio?this.picoAudio.getTime(this.picoAudio.getTiming(Number.MAX_SAFE_INTEGER)):e instanceof AudioBufferSourceNode?e.buffer.duration:null},e.prototype.getPlayingBGMName=function(){return this.playingBGMName},e.prototype.setOnBGMEndListener=function(e){null!=this.picoAudio&&this.picoAudio.setOnSongEndListener(e)},e.prototype.getPlayingBGMState=function(){return this.playingBGMState},e.prototype.getBGMPicoAudio=function(){return this._initPicoAudio(),this.picoAudio},e.prototype._setPlayingBGMState=function(e,t){t||"decoding"!=this.playingBGMState?(this.playingBGMState=e,this.playingBGMStatePending=null):this.playingBGMStatePending=e},e.prototype._initPicoAudio=function(){null==this.picoAudio&&(0==this.id&&(this.picoAudio=this.t2MediaLib.picoAudio),null==this.picoAudio&&(this.picoAudio=new PicoAudio(this.t2MediaLib.context,this.t2MediaLib.picoAudio)))},e}(),T2MediaLib_SoundData=function(){var e=function(){this.state="none",this.errorID=null,this.url=null,this.fileData=null,this.decodedData=null,this.decodedCallbacksAry=null};return e.prototype.onLoad=function(e){this.state="loading",this.url=e},e.prototype.onLoadComplete=function(e){this.state="loaded",this.fileData=e},e.prototype.onDecode=function(){this.state="decoding"},e.prototype.onDecodeComplete=function(e){this.state="decoded",this.decodedData=e},e.prototype.onError=function(e){this.state="error",this.errorID=e},e.prototype.isLoadComplete=function(){switch(this.state){case"loaded":case"decoding":case"decoded":return!0}return!1},e.prototype.isDecoding=function(){return"decoding"==this.state},e.prototype.isDecodeComplete=function(){return"decoded"==this.state},e.prototype.removeDecodedData=function(){this.state="loaded",this.decodedData=null},e}();requireSimulator.setName("exceptionCatcher"),define([],function(){var e={};return e.f=function(t){if("function"==typeof t){if(t.isTrcf)return t;var n=function(){if(!e.handleException||e.enter)return t.apply(this,arguments);try{return e.enter=!0,t.apply(this,arguments)}catch(n){e.handleException(n)}finally{e.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof t){for(var r in t)t[r]=e.f(t[r]);return t}},e}),requireSimulator.setName("UI"),define(["Util","exceptionCatcher"],function(e,t){var n={},r=t.f;return n=function(){function t(){l.forEach(function(e){e()}),setTimeout(r(t),50)}function i(e){return e instanceof Array?o(e):"string"==typeof e?a(e):e}function o(e){var t=e[0],n=1,r=$("<"+t+">");for("object"!=typeof e[n]||e[n]instanceof Array||e[n]instanceof $||(s(r,e[n],t),n++);n<e.length;)r.append(i(e[n])),n++;return r}function s(t,i){function o(e,n){if(n)if("enterkey"==e)t.on("keypress",r(function(e){13==e.which&&n.apply(t,arguments)}));else if("realtimechange"==e){var o,s=!0;l.push(function(){var e;e="checkbox"==i.type?!!t.prop("checked"):t.val(),(s||o!=e)&&(n.apply(t,[e,o]),o=e),s=!1})}else t.on(e,r(n))}i.$var&&(f[i.$var]=t),i.$edit&&("string"==typeof i.$edit&&(i.$edit={name:i.$edit,type:n.types.String}),i.on||(i.on={}),i.on.realtimechange=r(function(e){h.writeToModel(i.$edit,e,t)}),f[i.$edit.name]||(f[i.$edit.name]=t),h.push({jq:t,params:i}));for(var s in i)if("on"==s)for(var a in i.on)o(a,i.on[a]);else"css"==s&&null!=i[s]?t.css(i[s]):e.startsWith(s,"$")||null==i[s]||t.attr(s,i[s])}function a(e){return $("<span>").text(e)}for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];var l=[],f={},h=[],p=i(u);return p.$edits=h,p.$vars=f,h.load=function(e){h.model=e,h.forEach(function(e){h.writeToJq(e.params.$edit,e.jq)}),h.validator.on.validate.call(h.validator,h.model)},h.writeToJq=function(e,t){var n=h.model;if(n){for(var r=e.name,i=r.split("."),o=0;o<i.length;o++)n=n[i[o]];n=e.type.toVal(n),"checkbox"==t.attr("type")?t.prop("checked",!!n):t.val(n)}},h.validator={errors:{},show:function(){if(f.validationMessage){f.validationMessage.empty();for(var e in this.errors)f.validationMessage.append(n("div",this.errors[e].mesg))}if(f.OKButton){var t=!0;for(var e in this.errors)t=!1;f.OKButton.attr("disabled",!t)}},on:{validate:function(){}},addError:function(e,t,n){this.errors[e]={mesg:t,jq:n},this.show()},removeError:function(e){delete this.errors[e],this.show()},allOK:function(){for(var e in this.errors)delete this.errors[e];this.show()},isValid:function(){var e=!0;for(var t in this.errors)e=!1;return e}},h.writeToModel=function(e,t,n){var r=h.model;if(r){var i=e.name;try{t=e.type.fromVal(t)}catch(o){return void h.validator.addError(i,o,n)}h.validator.removeError(i);for(var s=i.split("."),a=0;a<s.length;a++)a==s.length-1?h.on.writeToModel(i,t)||(r[s[a]]=t):r=r[s[a]];h.validator.on.validate.call(h.validator,h.model)}},h.on={},h.on.writeToModel=function(){},l.length>0&&setTimeout(r(t),50),p},n.types={String:{toVal:function(e){return e},fromVal:function(e){return e}},Number:{toVal:function(e){return e+""},fromVal:function(e){return parseFloat(e)}}},n}),requireSimulator.setName("UIDiag"),define(["UI"],function(e){var t={};return t.confirm=function(t){function n(e){return function(){i.resolve(e),r.dialog("close"),r.remove()}}var r=e("div",{title:"確認"},["div",t],["button",{on:{click:n(!0)}},"OK"],["button",{on:{click:n(!1)}},"キャンセル"]).dialog({width:"auto",close:n(!1)}),i=$.Deferred();return i.promise()},t.alert=function(t){function n(e){return function(){i.resolve(e),r.dialog("close"),r.remove()}}var r=e("div",{title:"確認"},["div",t],["button",{on:{click:n(!0)}},"OK"]).dialog({width:"auto",close:n(!1)}),i=$.Deferred();return i.promise()},t.prompt=function(t,n){function r(){var e=o.$vars.val.val();s.resolve(e),o.dialog("close"),o.remove()}function i(){o.dialog("close"),o.remove(),s.resolve()}var o=e("div",{title:"入力"},["div",t],["input",{on:{enterkey:r},$var:"val",value:n}],["br"],["button",{on:{click:r}},"OK"],["button",{on:{click:i}},"キャンセル"]).dialog({width:"auto",close:function(){o.dialog("close"),s.resolve()}});setTimeout(function(){o.$vars.val.focus()},10);var s=$.Deferred();return s.promise()},"undefined"!=typeof window&&(window.UIDiag=t),t}),requireSimulator.setName("runtime"),requirejs(["ImageList","PicoAudio","T2MediaLib","Tonyu","UIDiag"],function(){}),requireSimulator.setName("LSFS"),define(["FS"],function(e){return e.LSFS}),requireSimulator.setName("runScript"),requirejs(["FS","Tonyu.Project","Shell","KeyEventChecker","ScriptTagFS","runtime","WebSite","LSFS"],function(e,t,n,r,i,o,s,a){$(function(){function r(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("iphone")&&-1==e.indexOf("ipad")&&-1==e.indexOf("ipod")||window==window.parent?0:40}function o(){var e=r();h=$(window).width(),p=$(window).height(),d.attr({width:h-e,height:p-e})}function u(){Tonyu.currentProject=Tonyu.globals.$currentProject=T;var e=T.getOptions();e.compiler&&e.compiler.diagnose&&(e.compiler.diagnose=!1,T.setOptions(e)),T.runScriptMode=!0,T.rawRun(e.run.bootClass)}var c=e.get(s.tonyuHome),l=e.get("/ram/");e.mount(l.path(),a.ramDisk()),Tonyu.defaultResource={images:[{name:"$pat_base",url:"images/base.png",pwidth:32,pheight:32},{name:"$pat_sample",url:"images/Sample.png"},{name:"$pat_neko",url:"images/neko.png",pwidth:32,pheight:32}],sounds:[]},SplashScreen={hide:function(){$("#splash").hide()},show:function(){},progress:function(e){$("#splash").text(e)}};var f=r(),h=$(window).width(),p=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var d=$("<canvas>").attr({width:h-f,height:p-f}).appendTo("body");$(window).resize(o);var m=location.href.replace(/\?.*/,"").split(/\//),g=m.pop()||"runscript",v=m.pop()||"nobody",y=l,b=c.rel(v+"/"+g+"/");l.rel("files/").link(b);var _=i.toObj();for(var w in _){var x=y.rel(w);if(!x.isDir()){var S=_[w];x.text(S.text),delete S.text,S.lastUpdate&&x.metaInfo(S)}}n.cd(y),Tonyu.defaultOptions={compiler:{defaultSuperClass:"Actor"},run:{mainClass:"Main",bootClass:"Boot"},kernelEditable:!1};var T=t(y);u()})}),requireSimulator.setName();