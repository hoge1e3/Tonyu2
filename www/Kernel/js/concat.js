Tonyu.klass.define({
  fullName: 'kernel.EventHandlerCaller',
  shortName: 'EventHandlerCaller',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_EventHandlerCaller_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_EventHandlerCaller_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    callEventHandler :function _trc_EventHandlerCaller_callEventHandler(h,args) {
      "use strict";
      var _this=this;
      var t;
      
      
      //$LASTPOS=1000076;//kernel.EventHandlerCaller:76
      if (h["fiber"]) {
        //$LASTPOS=1000103;//kernel.EventHandlerCaller:103
        t=Tonyu.thread();
        //$LASTPOS=1000130;//kernel.EventHandlerCaller:130
        h["fiber"].apply(_this.target,[t].concat(args));
        //$LASTPOS=1000184;//kernel.EventHandlerCaller:184
        t.steps();
        
      } else {
        //$LASTPOS=1000218;//kernel.EventHandlerCaller:218
        h.apply(_this.target,args);
        
      }
    },
    fiber$callEventHandler :function _trc_EventHandlerCaller_f_callEventHandler(_thread,h,args) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var t;
      
      
      //$LASTPOS=1000076;//kernel.EventHandlerCaller:76
      if (h["fiber"]) {
        //$LASTPOS=1000103;//kernel.EventHandlerCaller:103
        t=Tonyu.thread();
        //$LASTPOS=1000130;//kernel.EventHandlerCaller:130
        h["fiber"].apply(_this.target,[t].concat(args));
        //$LASTPOS=1000184;//kernel.EventHandlerCaller:184
        t.steps();
        
      } else {
        //$LASTPOS=1000218;//kernel.EventHandlerCaller:218
        h.apply(_this.target,args);
        
      }
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"callEventHandler":{"nowait":false}},"fields":{"target":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.EventMod',
  shortName: 'EventMod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_EventMod_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_EventMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initEventMod :function _trc_EventMod_initEventMod() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=2000076;//kernel.EventMod:76
      if (_this._eventHandlers) {
        return _this;
      }
      //$LASTPOS=2000169;//kernel.EventMod:169
      _this._eventHandlers={};
      //$LASTPOS=2000192;//kernel.EventMod:192
      _this.on("die",Tonyu.bindFunc(_this,_this.releaseEventMod));
    },
    releaseEventMod :function _trc_EventMod_releaseEventMod() {
      "use strict";
      var _this=this;
      var k;
      var v;
      var _it_2;
      
      //$LASTPOS=2000256;//kernel.EventMod:256
      _it_2=Tonyu.iterator(_this._eventHandlers,2);
      while(_it_2.next()) {
        k=_it_2[0];
        v=_it_2[1];
        
        //$LASTPOS=2000298;//kernel.EventMod:298
        v.release();
        
      }
    },
    parseArgs :function _trc_EventMod_parseArgs(a) {
      "use strict";
      var _this=this;
      var res;
      var i;
      
      //$LASTPOS=2000348;//kernel.EventMod:348
      res = {type: a[0],args: []};
      
      //$LASTPOS=2000382;//kernel.EventMod:382
      //$LASTPOS=2000387;//kernel.EventMod:387
      i = 1;
      for (; i<a.length ; i++) {
        {
          //$LASTPOS=2000425;//kernel.EventMod:425
          res.args.push(a[i]);
        }
      }
      return res;
    },
    registerEventHandler :function _trc_EventMod_registerEventHandler(type,obj) {
      "use strict";
      var _this=this;
      var cl;
      
      //$LASTPOS=2000548;//kernel.EventMod:548
      _this.initEventMod();
      //$LASTPOS=2000568;//kernel.EventMod:568
      if (typeof  type=="function") {
        //$LASTPOS=2000607;//kernel.EventMod:607
        obj=obj||new type({target: _this});
        //$LASTPOS=2000647;//kernel.EventMod:647
        type=obj.getClassInfo().fullName;
        
      } else {
        //$LASTPOS=2000702;//kernel.EventMod:702
        if (! obj) {
          //$LASTPOS=2000726;//kernel.EventMod:726
          cl = Tonyu.globals.$Boot.eventTypes[type]||Tonyu.classes.kernel.EventHandler;
          
          //$LASTPOS=2000785;//kernel.EventMod:785
          obj=new cl({target: _this});
          
        }
        
      }
      return _this._eventHandlers[type]=obj;
    },
    getEventHandler :function _trc_EventMod_getEventHandler(type) {
      "use strict";
      var _this=this;
      var res;
      
      //$LASTPOS=2000998;//kernel.EventMod:998
      _this.initEventMod();
      //$LASTPOS=2001018;//kernel.EventMod:1018
      if (typeof  type=="function") {
        //$LASTPOS=2001057;//kernel.EventMod:1057
        type=type.meta.fullName;
        
      }
      //$LASTPOS=2001092;//kernel.EventMod:1092
      res = _this._eventHandlers[type];
      
      return res;
    },
    getOrRegisterEventHandler :function _trc_EventMod_getOrRegisterEventHandler(type) {
      "use strict";
      var _this=this;
      var res;
      
      //$LASTPOS=2001188;//kernel.EventMod:1188
      res = _this.getEventHandler(type)||_this.registerEventHandler(type);
      
      return res;
    },
    on :function _trc_EventMod_on() {
      "use strict";
      var _this=this;
      var a;
      var h;
      
      //$LASTPOS=2001291;//kernel.EventMod:1291
      a = _this.parseArgs(arguments);
      
      //$LASTPOS=2001324;//kernel.EventMod:1324
      h = _this.getOrRegisterEventHandler(a.type);
      
      return h.addListener.apply(h,a.args);
    },
    fireEvent :function _trc_EventMod_fireEvent(type,arg) {
      "use strict";
      var _this=this;
      var h;
      
      //$LASTPOS=2001509;//kernel.EventMod:1509
      h = _this.getEventHandler(type);
      
      //$LASTPOS=2001543;//kernel.EventMod:1543
      if (h) {
        //$LASTPOS=2001550;//kernel.EventMod:1550
        h.fire([arg]);
      }
    },
    sendEvent :function _trc_EventMod_sendEvent(type,arg) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=2001605;//kernel.EventMod:1605
      _this.fireEvent(type,arg);
    },
    waitEvent :function _trc_EventMod_waitEvent() {
      "use strict";
      var _this=this;
      var args;
      var act;
      
      //$LASTPOS=2001652;//kernel.EventMod:1652
      if (null) {
        //$LASTPOS=2001676;//kernel.EventMod:1676
        args = new Tonyu.classes.kernel.ArgParser(arguments);
        
        //$LASTPOS=2001720;//kernel.EventMod:1720
        act = args.shift(Tonyu.classes.kernel.BaseActor)||_this;
        
        //$LASTPOS=2001768;//kernel.EventMod:1768
        args.trimUndefs();
        //$LASTPOS=2001947;//kernel.EventMod:1947
        null.waitEvent(act,args.toArray());
        
      }
    },
    fiber$waitEvent :function _trc_EventMod_f_waitEvent(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var args;
      var act;
      
      //$LASTPOS=2001652;//kernel.EventMod:1652
      if (_thread) {
        //$LASTPOS=2001676;//kernel.EventMod:1676
        args = new Tonyu.classes.kernel.ArgParser(_arguments);
        
        //$LASTPOS=2001720;//kernel.EventMod:1720
        act = args.shift(Tonyu.classes.kernel.BaseActor)||_this;
        
        //$LASTPOS=2001768;//kernel.EventMod:1768
        args.trimUndefs();
        //$LASTPOS=2001947;//kernel.EventMod:1947
        _thread.waitEvent(act,args.toArray());
        
      }
      
      _thread.retVal=_this;return;
    },
    waitFor :function _trc_EventMod_waitFor(f) {
      "use strict";
      var _this=this;
      var r;
      
      //$LASTPOS=2002019;//kernel.EventMod:2019
      if (null) {
        //$LASTPOS=2002043;//kernel.EventMod:2043
        r = null.waitFor(f);
        
        return r;
        
      }
      return f;
    },
    fiber$waitFor :function _trc_EventMod_f_waitFor(_thread,f) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      //$LASTPOS=2002019;//kernel.EventMod:2019
      if (_thread) {
        //$LASTPOS=2002043;//kernel.EventMod:2043
        r = _thread.waitFor(f);
        
        _thread.retVal=r;return;
        
        
      }
      _thread.retVal=f;return;
      
      
      _thread.retVal=_this;return;
    },
    runAsync :function _trc_EventMod_runAsync(f) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=2002136;//kernel.EventMod:2136
      if (! null) {
        throw new Error("runAsync should run in wait mode");
        
        
      }
      //$LASTPOS=2002226;//kernel.EventMod:2226
      null.runAsync(f);
    },
    fiber$runAsync :function _trc_EventMod_f_runAsync(_thread,f) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=2002136;//kernel.EventMod:2136
      if (! _thread) {
        throw new Error("runAsync should run in wait mode");
        
        
      }
      //$LASTPOS=2002226;//kernel.EventMod:2226
      _thread.runAsync(f);
      
      _thread.retVal=_this;return;
    },
    runPromise :function _trc_EventMod_runPromise(f) {
      "use strict";
      var _this=this;
      var r;
      var e;
      
      //$LASTPOS=2002273;//kernel.EventMod:2273
      if (! null) {
        return Tonyu.DeferredUtil.promise(f);
        
      } else {
        
        try {
          //$LASTPOS=2002395;//kernel.EventMod:2395
          r=_this.runAsync(f);
          
        } catch (e) {
          throw null.wrapError(e.args[0]);
          
          
        }
        return r[0];
        
      }
    },
    fiber$runPromise :function _trc_EventMod_f_runPromise(_thread,f) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      var e;
      
      
      _thread.enter(function _trc_EventMod_ent_runPromise(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=2002273;//kernel.EventMod:2273
            if (!(! _thread)) { __pc=1     ; break; }
            _thread.exit(Tonyu.DeferredUtil.promise(f));return;
            __pc=5     ;break;
          case 1     :
            
            _thread.enterTry(3     );
            //$LASTPOS=2002395;//kernel.EventMod:2395
            _this.fiber$runAsync(_thread, f);
            __pc=2;return;
          case 2:
            r=_thread.retVal;
            _thread.exitTry();
            __pc=4     ;break;
          case 3     :
            e=_thread.startCatch();
            {
              throw _thread.wrapError(e.args[0]);
              
            }
          case 4     :
            
            _thread.exit(r[0]);return;
          case 5     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"initEventMod":{"nowait":true},"releaseEventMod":{"nowait":true},"parseArgs":{"nowait":true},"registerEventHandler":{"nowait":true},"getEventHandler":{"nowait":true},"getOrRegisterEventHandler":{"nowait":true},"on":{"nowait":true},"fireEvent":{"nowait":true},"sendEvent":{"nowait":true},"waitEvent":{"nowait":false},"waitFor":{"nowait":false},"runAsync":{"nowait":false},"runPromise":{"nowait":false}},"fields":{"_eventHandlers":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Context3D',
  shortName: 'Context3D',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_Context3D_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_Context3D_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.OneframeSpriteMod',
  shortName: 'OneframeSpriteMod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_OneframeSpriteMod_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_OneframeSpriteMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    drawText :function _trc_OneframeSpriteMod_drawText(x,y,text,col,size,zOrder) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=3000067;//kernel.OneframeSpriteMod:67
      if (! size) {
        //$LASTPOS=3000078;//kernel.OneframeSpriteMod:78
        size=15;
      }
      //$LASTPOS=3000092;//kernel.OneframeSpriteMod:92
      if (! col) {
        //$LASTPOS=3000102;//kernel.OneframeSpriteMod:102
        col="white";
      }
      //$LASTPOS=3000120;//kernel.OneframeSpriteMod:120
      _this.appear(Tonyu.classes.kernel.T1Text,{x: x,y: y,text: text,col: col,size: size,zOrder: zOrder,owner: _this});
    },
    drawLine :function _trc_OneframeSpriteMod_drawLine(x,y,tx,ty,col,zOrder) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=3000225;//kernel.OneframeSpriteMod:225
      if (! col) {
        //$LASTPOS=3000235;//kernel.OneframeSpriteMod:235
        col="white";
      }
      //$LASTPOS=3000253;//kernel.OneframeSpriteMod:253
      _this.appear(Tonyu.classes.kernel.T1Line,{x: x,y: y,tx: tx,ty: ty,col: col,zOrder: zOrder,owner: _this});
    },
    fillRect :function _trc_OneframeSpriteMod_fillRect(x,y,w,h,col,zOrder) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=3000353;//kernel.OneframeSpriteMod:353
      _this.appear(Tonyu.classes.kernel.T1Rect,{x: x,y: y,w: w,h: h,col: col,zOrder: zOrder,owner: _this});
    },
    drawSprite :function _trc_OneframeSpriteMod_drawSprite(x,y,p,f,zOrder) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=3000450;//kernel.OneframeSpriteMod:450
      _this.drawDxSprite(x,y,p,f,zOrder,0,255,1,1);
    },
    drawDxSprite :function _trc_OneframeSpriteMod_drawDxSprite(x,y,p,f,zOrder,angle,alpha,scaleX,scaleY) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=3000564;//kernel.OneframeSpriteMod:564
      _this.appear(Tonyu.classes.kernel.T1Sprite,{x: x,y: y,p: p,f: f,zOrder: zOrder,angle: angle,alpha: alpha,scaleX: scaleX,scaleY: scaleY,owner: _this});
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"drawText":{"nowait":true},"drawLine":{"nowait":true},"fillRect":{"nowait":true},"drawSprite":{"nowait":true},"drawDxSprite":{"nowait":true}},"fields":{"appear":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.SpriteMod',
  shortName: 'SpriteMod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_SpriteMod_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=4000015;//kernel.SpriteMod:15
      "field strict";
      
    },
    fiber$main :function _trc_SpriteMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=4000015;//kernel.SpriteMod:15
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    initSpriteMod :function _trc_SpriteMod_initSpriteMod() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=4000235;//kernel.SpriteMod:235
      _this.position=new Tonyu.classes.kernel.Vec3View(_this);
      //$LASTPOS=4000269;//kernel.SpriteMod:269
      if (_this.scaleX==null) {
        //$LASTPOS=4000287;//kernel.SpriteMod:287
        _this.scaleX=1;
      }
      //$LASTPOS=4000302;//kernel.SpriteMod:302
      if (_this.rotation==null) {
        //$LASTPOS=4000322;//kernel.SpriteMod:322
        _this.rotation=0;
      }
      //$LASTPOS=4000339;//kernel.SpriteMod:339
      if (_this.alpha==null) {
        //$LASTPOS=4000356;//kernel.SpriteMod:356
        _this.alpha=255;
      }
      //$LASTPOS=4000372;//kernel.SpriteMod:372
      if (_this.zOrder==null) {
        //$LASTPOS=4000390;//kernel.SpriteMod:390
        _this.zOrder=0;
      }
    },
    fiber$initSpriteMod :function _trc_SpriteMod_f_initSpriteMod(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=4000235;//kernel.SpriteMod:235
      _this.position=new Tonyu.classes.kernel.Vec3View(_this);
      //$LASTPOS=4000269;//kernel.SpriteMod:269
      if (_this.scaleX==null) {
        //$LASTPOS=4000287;//kernel.SpriteMod:287
        _this.scaleX=1;
      }
      //$LASTPOS=4000302;//kernel.SpriteMod:302
      if (_this.rotation==null) {
        //$LASTPOS=4000322;//kernel.SpriteMod:322
        _this.rotation=0;
      }
      //$LASTPOS=4000339;//kernel.SpriteMod:339
      if (_this.alpha==null) {
        //$LASTPOS=4000356;//kernel.SpriteMod:356
        _this.alpha=255;
      }
      //$LASTPOS=4000372;//kernel.SpriteMod:372
      if (_this.zOrder==null) {
        //$LASTPOS=4000390;//kernel.SpriteMod:390
        _this.zOrder=0;
      }
      
      _thread.retVal=_this;return;
    },
    detectShape :function _trc_SpriteMod_detectShape() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=4000438;//kernel.SpriteMod:438
      if (typeof  _this.p!="number") {
        //$LASTPOS=4000473;//kernel.SpriteMod:473
        _this.p=0;
        
      }
      //$LASTPOS=4000490;//kernel.SpriteMod:490
      _this.p=Math.floor(_this.p);
      //$LASTPOS=4000512;//kernel.SpriteMod:512
      _this.pImg=Tonyu.globals.$imageList[_this.p];
      //$LASTPOS=4000537;//kernel.SpriteMod:537
      if (! _this.pImg) {
        return _this;
      }
      //$LASTPOS=4000561;//kernel.SpriteMod:561
      _this.width=_this.pImg.width;
      //$LASTPOS=4000584;//kernel.SpriteMod:584
      _this.height=_this.pImg.height;
    },
    color :function _trc_SpriteMod_color(r,g,b) {
      "use strict";
      var _this=this;
      
      return "rgb("+[r,g,b].join(",")+")";
    },
    setVisible :function _trc_SpriteMod_setVisible(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=4003009;//kernel.SpriteMod:3009
      _this._isInvisible=! v;
    },
    fiber$setVisible :function _trc_SpriteMod_f_setVisible(_thread,v) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=4003009;//kernel.SpriteMod:3009
      _this._isInvisible=! v;
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"initSpriteMod":{"nowait":false},"detectShape":{"nowait":true},"color":{"nowait":true},"setVisible":{"nowait":false}},"fields":{"p":{},"pImg":{},"text":{},"size":{},"font":{},"align":{},"fillStyle":{},"scaleX":{},"scaleY":{},"width":{},"height":{},"radius":{},"rotation":{},"alpha":{},"position":{},"zOrder":{},"_isInvisible":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.SpriteMod3D',
  shortName: 'SpriteMod3D',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.SpriteMod],
  methods: {
    main :function _trc_SpriteMod3D_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=5000036;//kernel.SpriteMod3D:36
      "field strict";
      
    },
    fiber$main :function _trc_SpriteMod3D_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=5000036;//kernel.SpriteMod3D:36
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    draw3D :function _trc_SpriteMod3D_draw3D(camera) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=5000112;//kernel.SpriteMod3D:112
      if (_this.p==null||typeof  _this.p==="number") {
        //$LASTPOS=5000148;//kernel.SpriteMod3D:148
        _this.detectShape();
      }
      //$LASTPOS=5000194;//kernel.SpriteMod3D:194
      camera.addSprite3D(_this);
    },
    fiber$draw3D :function _trc_SpriteMod3D_f_draw3D(_thread,camera) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=5000112;//kernel.SpriteMod3D:112
      if (_this.p==null||typeof  _this.p==="number") {
        //$LASTPOS=5000148;//kernel.SpriteMod3D:148
        _this.detectShape();
      }
      //$LASTPOS=5000194;//kernel.SpriteMod3D:194
      camera.addSprite3D(_this);
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"draw3D":{"nowait":false}},"fields":{"x":{},"y":{},"z":{},"direction":{},"transform":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TextRectMod',
  shortName: 'TextRectMod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_TextRectMod_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=6000015;//kernel.TextRectMod:15
      "field strict";
    },
    fiber$main :function _trc_TextRectMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=6000015;//kernel.TextRectMod:15
      "field strict";
      
      _thread.retVal=_this;return;
    },
    drawTextRect :function _trc_TextRectMod_drawTextRect(ctx,text,x,topY,h,align,type) {
      "use strict";
      var _this=this;
      var met;
      var res;
      var t;
      
      //$LASTPOS=6000107;//kernel.TextRectMod:107
      if (! align) {
        //$LASTPOS=6000119;//kernel.TextRectMod:119
        align="center";
      }
      //$LASTPOS=6000140;//kernel.TextRectMod:140
      ctx.textBaseline="top";
      //$LASTPOS=6000169;//kernel.TextRectMod:169
      _this.setFontSize(ctx,h);
      //$LASTPOS=6000195;//kernel.TextRectMod:195
      met = ctx.measureText(text);
      
      //$LASTPOS=6000231;//kernel.TextRectMod:231
      res = {y: topY,w: met.width,h: h};
      
      //$LASTPOS=6000273;//kernel.TextRectMod:273
      t = align.substring(0,1).toLowerCase();
      
      //$LASTPOS=6000320;//kernel.TextRectMod:320
      if (t=="l") {
        //$LASTPOS=6000332;//kernel.TextRectMod:332
        res.x=x;
      } else {
        //$LASTPOS=6000351;//kernel.TextRectMod:351
        if (t=="r") {
          //$LASTPOS=6000363;//kernel.TextRectMod:363
          res.x=x-met.width;
        } else {
          //$LASTPOS=6000392;//kernel.TextRectMod:392
          if (t=="c") {
            //$LASTPOS=6000404;//kernel.TextRectMod:404
            res.x=x-met.width/2;
          }
        }
      }
      //$LASTPOS=6000430;//kernel.TextRectMod:430
      if (type=="fill") {
        //$LASTPOS=6000448;//kernel.TextRectMod:448
        ctx.fillText(text,res.x,topY);
      }
      //$LASTPOS=6000485;//kernel.TextRectMod:485
      if (type=="stroke") {
        //$LASTPOS=6000505;//kernel.TextRectMod:505
        ctx.strokeText(text,res.x,topY);
      }
      return res;
    },
    setFontSize :function _trc_TextRectMod_setFontSize(ctx,sz) {
      "use strict";
      var _this=this;
      var post;
      
      //$LASTPOS=6000603;//kernel.TextRectMod:603
      post = ctx.font.replace(/^[0-9\.]+/,"");
      
      //$LASTPOS=6000651;//kernel.TextRectMod:651
      ctx.font=sz+post;
    },
    fukidashi :function _trc_TextRectMod_fukidashi(ctx,text,x,y,sz) {
      "use strict";
      var _this=this;
      var align;
      var theight;
      var margin;
      var r;
      var fs;
      
      //$LASTPOS=6000729;//kernel.TextRectMod:729
      align = "c";
      
      //$LASTPOS=6000749;//kernel.TextRectMod:749
      theight = 20;
      
      //$LASTPOS=6000770;//kernel.TextRectMod:770
      margin = 5;
      
      //$LASTPOS=6000789;//kernel.TextRectMod:789
      r = _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align);
      
      //$LASTPOS=6000859;//kernel.TextRectMod:859
      ctx.beginPath();
      //$LASTPOS=6000881;//kernel.TextRectMod:881
      ctx.moveTo(x,y);
      //$LASTPOS=6000905;//kernel.TextRectMod:905
      ctx.lineTo(x+margin,y-theight);
      //$LASTPOS=6000944;//kernel.TextRectMod:944
      ctx.lineTo(x+r.w/2+margin,y-theight);
      //$LASTPOS=6000989;//kernel.TextRectMod:989
      ctx.lineTo(x+r.w/2+margin,y-theight-r.h-margin*2);
      //$LASTPOS=6001047;//kernel.TextRectMod:1047
      ctx.lineTo(x-r.w/2-margin,y-theight-r.h-margin*2);
      //$LASTPOS=6001105;//kernel.TextRectMod:1105
      ctx.lineTo(x-r.w/2-margin,y-theight);
      //$LASTPOS=6001150;//kernel.TextRectMod:1150
      ctx.lineTo(x-margin,y-theight);
      //$LASTPOS=6001189;//kernel.TextRectMod:1189
      ctx.closePath();
      //$LASTPOS=6001211;//kernel.TextRectMod:1211
      ctx.fill();
      //$LASTPOS=6001228;//kernel.TextRectMod:1228
      ctx.stroke();
      //$LASTPOS=6001249;//kernel.TextRectMod:1249
      fs = ctx.fillStyle;
      
      //$LASTPOS=6001276;//kernel.TextRectMod:1276
      ctx.fillStyle=ctx.strokeStyle;
      //$LASTPOS=6001312;//kernel.TextRectMod:1312
      _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align,"fill");
      //$LASTPOS=6001385;//kernel.TextRectMod:1385
      ctx.fillStyle=fs;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"drawTextRect":{"nowait":true},"setFontSize":{"nowait":true},"fukidashi":{"nowait":true}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.T2Mod',
  shortName: 'T2Mod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_T2Mod_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_T2Mod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    bvec :function _trc_T2Mod_bvec(tx,ty) {
      "use strict";
      var _this=this;
      var b2Vec2;
      
      //$LASTPOS=7000037;//kernel.T2Mod:37
      b2Vec2 = Box2D.Common.Math.b2Vec2;
      
      return new b2Vec2(tx/_this.scale,ty/_this.scale);
    },
    fiber$bvec :function _trc_T2Mod_f_bvec(_thread,tx,ty) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var b2Vec2;
      
      //$LASTPOS=7000037;//kernel.T2Mod:37
      b2Vec2 = Box2D.Common.Math.b2Vec2;
      
      _thread.retVal=new b2Vec2(tx/_this.scale,ty/_this.scale);return;
      
      
      _thread.retVal=_this;return;
    },
    defv :function _trc_T2Mod_defv(t,d) {
      "use strict";
      var _this=this;
      
      return (t===t&&(typeof  t)==="number")?t:d;
    },
    fiber$defv :function _trc_T2Mod_f_defv(_thread,t,d) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=(t===t&&(typeof  t)==="number")?t:d;return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"bvec":{"nowait":false},"defv":{"nowait":false}},"fields":{"scale":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MediaPlayer',
  shortName: 'MediaPlayer',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_MediaPlayer_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_MediaPlayer_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    play :function _trc_MediaPlayer_play(s) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=8000031;//kernel.MediaPlayer:31
      Tonyu.globals.$sound.playBGM(s);
    },
    fiber$play :function _trc_MediaPlayer_f_play(_thread,s) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=8000031;//kernel.MediaPlayer:31
      Tonyu.globals.$sound.playBGM(s);
      
      _thread.retVal=_this;return;
    },
    stop :function _trc_MediaPlayer_stop() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=8000069;//kernel.MediaPlayer:69
      Tonyu.globals.$sound.stopBGM(_this.s);
    },
    fiber$stop :function _trc_MediaPlayer_f_stop(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=8000069;//kernel.MediaPlayer:69
      Tonyu.globals.$sound.stopBGM(_this.s);
      
      _thread.retVal=_this;return;
    },
    playSE :function _trc_MediaPlayer_playSE() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=8000109;//kernel.MediaPlayer:109
      Tonyu.globals.$sound.playSE(_this.s);
    },
    fiber$playSE :function _trc_MediaPlayer_f_playSE(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=8000109;//kernel.MediaPlayer:109
      Tonyu.globals.$sound.playSE(_this.s);
      
      _thread.retVal=_this;return;
    },
    setDelay :function _trc_MediaPlayer_setDelay() {
      "use strict";
      var _this=this;
      
    },
    fiber$setDelay :function _trc_MediaPlayer_f_setDelay(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    setVolume :function _trc_MediaPlayer_setVolume() {
      "use strict";
      var _this=this;
      
    },
    fiber$setVolume :function _trc_MediaPlayer_f_setVolume(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"play":{"nowait":false},"stop":{"nowait":false},"playSE":{"nowait":false},"setDelay":{"nowait":false},"setVolume":{"nowait":false}},"fields":{"s":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ParallelMod',
  shortName: 'ParallelMod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_ParallelMod_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=9000037;//kernel.ParallelMod:37
      "field strict";
    },
    fiber$main :function _trc_ParallelMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=9000037;//kernel.ParallelMod:37
      "field strict";
      
      _thread.retVal=_this;return;
    },
    parallel :function _trc_ParallelMod_parallel() {
      "use strict";
      var _this=this;
      var args;
      var i;
      var name;
      var th;
      
      //$LASTPOS=9000083;//kernel.ParallelMod:83
      args = [];
      
      //$LASTPOS=9000102;//kernel.ParallelMod:102
      //$LASTPOS=9000107;//kernel.ParallelMod:107
      i = 1;
      for (; i<arguments.length ; i++) {
        {
          //$LASTPOS=9000153;//kernel.ParallelMod:153
          args.push(arguments[i]);
        }
      }
      //$LASTPOS=9000192;//kernel.ParallelMod:192
      name = arguments[0];
      
      
      //$LASTPOS=9000235;//kernel.ParallelMod:235
      th=Tonyu.globals.$Boot.schedule(_this,name,args);
      return th;
    },
    call :function _trc_ParallelMod_call() {
      "use strict";
      var _this=this;
      var a;
      var t;
      var n;
      var f;
      var ag2;
      
      //$LASTPOS=9000306;//kernel.ParallelMod:306
      a = new Tonyu.classes.kernel.ArgParser(arguments);
      
      //$LASTPOS=9000343;//kernel.ParallelMod:343
      t = a.shift();
      
      //$LASTPOS=9000365;//kernel.ParallelMod:365
      n = a.shift();
      
      //$LASTPOS=9000387;//kernel.ParallelMod:387
      f = t["fiber$"+n];
      
      //$LASTPOS=9000413;//kernel.ParallelMod:413
      if (! f) {
        throw new Error("メソッド"+n+"が見つかりません");
        
        
      }
      //$LASTPOS=9000482;//kernel.ParallelMod:482
      ag2 = a.toArray();
      
      //$LASTPOS=9000508;//kernel.ParallelMod:508
      ag2.unshift(null);
      return f.apply(t,ag2);
    },
    fiber$call :function _trc_ParallelMod_f_call(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      var t;
      var n;
      var f;
      var ag2;
      
      //$LASTPOS=9000306;//kernel.ParallelMod:306
      a = new Tonyu.classes.kernel.ArgParser(_arguments);
      
      //$LASTPOS=9000343;//kernel.ParallelMod:343
      t = a.shift();
      
      //$LASTPOS=9000365;//kernel.ParallelMod:365
      n = a.shift();
      
      //$LASTPOS=9000387;//kernel.ParallelMod:387
      f = t["fiber$"+n];
      
      //$LASTPOS=9000413;//kernel.ParallelMod:413
      if (! f) {
        throw new Error("メソッド"+n+"が見つかりません");
        
        
      }
      //$LASTPOS=9000482;//kernel.ParallelMod:482
      ag2 = a.toArray();
      
      //$LASTPOS=9000508;//kernel.ParallelMod:508
      ag2.unshift(_thread);
      _thread.retVal=f.apply(t,ag2);return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"parallel":{"nowait":true},"call":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.SchedulerMod',
  shortName: 'SchedulerMod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_SchedulerMod_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=10000015;//kernel.SchedulerMod:15
      "field strict";
      
    },
    fiber$main :function _trc_SchedulerMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=10000015;//kernel.SchedulerMod:15
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    initSchedulerMod :function _trc_SchedulerMod_initSchedulerMod() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=10000170;//kernel.SchedulerMod:170
      _this._scheduler=_this._scheduler||Tonyu.globals.$Scheduler;
      //$LASTPOS=10000210;//kernel.SchedulerMod:210
      if (Tonyu.runMode) {
        //$LASTPOS=10000229;//kernel.SchedulerMod:229
        _this._th=Tonyu.globals.$Boot.schedule(_this,"main",[]);
      }
    },
    fiber$initSchedulerMod :function _trc_SchedulerMod_f_initSchedulerMod(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=10000170;//kernel.SchedulerMod:170
      _this._scheduler=_this._scheduler||Tonyu.globals.$Scheduler;
      //$LASTPOS=10000210;//kernel.SchedulerMod:210
      if (Tonyu.runMode) {
        //$LASTPOS=10000229;//kernel.SchedulerMod:229
        _this._th=Tonyu.globals.$Boot.schedule(_this,"main",[]);
      }
      
      _thread.retVal=_this;return;
    },
    update :function _trc_SchedulerMod_update() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=10000288;//kernel.SchedulerMod:288
      _this.onUpdate();
      //$LASTPOS=10000305;//kernel.SchedulerMod:305
      if (null) {
        //$LASTPOS=10000328;//kernel.SchedulerMod:328
        null.suspend();
        //$LASTPOS=10000356;//kernel.SchedulerMod:356
        if (_this._scheduler) {
          //$LASTPOS=10000372;//kernel.SchedulerMod:372
          _this._scheduler.addToNext(null);
        }
        
      } else {
        //$LASTPOS=10000426;//kernel.SchedulerMod:426
        _this._scheduler.checkTimeout();
        
      }
    },
    fiber$update :function _trc_SchedulerMod_f_update(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=10000288;//kernel.SchedulerMod:288
      _this.onUpdate();
      //$LASTPOS=10000305;//kernel.SchedulerMod:305
      if (_thread) {
        //$LASTPOS=10000328;//kernel.SchedulerMod:328
        _thread.suspend();
        //$LASTPOS=10000356;//kernel.SchedulerMod:356
        if (_this._scheduler) {
          //$LASTPOS=10000372;//kernel.SchedulerMod:372
          _this._scheduler.addToNext(_thread);
        }
        
      } else {
        //$LASTPOS=10000426;//kernel.SchedulerMod:426
        _this._scheduler.checkTimeout();
        
      }
      
      _thread.retVal=_this;return;
    },
    onUpdate :function _trc_SchedulerMod_onUpdate() {
      "use strict";
      var _this=this;
      
    },
    updateEx :function _trc_SchedulerMod_updateEx(updateT) {
      "use strict";
      var _this=this;
      var updateCount;
      
      //$LASTPOS=10000516;//kernel.SchedulerMod:516
      //$LASTPOS=10000520;//kernel.SchedulerMod:520
      updateCount = 0;
      for (; updateCount<updateT ; updateCount++) {
        {
          //$LASTPOS=10000583;//kernel.SchedulerMod:583
          _this.update();
        }
      }
    },
    fiber$updateEx :function _trc_SchedulerMod_f_updateEx(_thread,updateT) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var updateCount;
      
      
      _thread.enter(function _trc_SchedulerMod_ent_updateEx(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=10000516;//kernel.SchedulerMod:516
            //$LASTPOS=10000520;//kernel.SchedulerMod:520
            updateCount = 0;
            
          case 1:
            if (!(updateCount<updateT)) { __pc=4     ; break; }
            //$LASTPOS=10000583;//kernel.SchedulerMod:583
            _this.fiber$update(_thread);
            __pc=2;return;
          case 2:
            
          case 3     :
            updateCount++;
            __pc=1;break;
          case 4     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    currentThreadGroup :function _trc_SchedulerMod_currentThreadGroup() {
      "use strict";
      var _this=this;
      
      return _this._scheduler;
    },
    wait :function _trc_SchedulerMod_wait(t) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=10000715;//kernel.SchedulerMod:715
      if (null) {
        //$LASTPOS=10000738;//kernel.SchedulerMod:738
        null.suspend();
        //$LASTPOS=10000766;//kernel.SchedulerMod:766
        if (t) {
          //$LASTPOS=10000788;//kernel.SchedulerMod:788
          null.waitCount=t;
          //$LASTPOS=10000822;//kernel.SchedulerMod:822
          if (_this._scheduler) {
            //$LASTPOS=10000838;//kernel.SchedulerMod:838
            _this._scheduler.addToNext(null);
          }
          
        }
        
      } else {
        //$LASTPOS=10000892;//kernel.SchedulerMod:892
        if (_this._th) {
          //$LASTPOS=10000912;//kernel.SchedulerMod:912
          if (t) {
            //$LASTPOS=10000934;//kernel.SchedulerMod:934
            _this._th.waitCount=t;
            
          } else {
            //$LASTPOS=10000982;//kernel.SchedulerMod:982
            if (_this._th.scheduled) {
              //$LASTPOS=10001001;//kernel.SchedulerMod:1001
              _this._th.scheduled.unschedule(_this._th);
            }
            
          }
          
        }
      }
    },
    fiber$wait :function _trc_SchedulerMod_f_wait(_thread,t) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=10000715;//kernel.SchedulerMod:715
      if (_thread) {
        //$LASTPOS=10000738;//kernel.SchedulerMod:738
        _thread.suspend();
        //$LASTPOS=10000766;//kernel.SchedulerMod:766
        if (t) {
          //$LASTPOS=10000788;//kernel.SchedulerMod:788
          _thread.waitCount=t;
          //$LASTPOS=10000822;//kernel.SchedulerMod:822
          if (_this._scheduler) {
            //$LASTPOS=10000838;//kernel.SchedulerMod:838
            _this._scheduler.addToNext(_thread);
          }
          
        }
        
      } else {
        //$LASTPOS=10000892;//kernel.SchedulerMod:892
        if (_this._th) {
          //$LASTPOS=10000912;//kernel.SchedulerMod:912
          if (t) {
            //$LASTPOS=10000934;//kernel.SchedulerMod:934
            _this._th.waitCount=t;
            
          } else {
            //$LASTPOS=10000982;//kernel.SchedulerMod:982
            if (_this._th.scheduled) {
              //$LASTPOS=10001001;//kernel.SchedulerMod:1001
              _this._th.scheduled.unschedule(_this._th);
            }
            
          }
          
        }
      }
      
      _thread.retVal=_this;return;
    },
    notify :function _trc_SchedulerMod_notify() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=10001078;//kernel.SchedulerMod:1078
      if (_this._th) {
        //$LASTPOS=10001098;//kernel.SchedulerMod:1098
        if (_this._th.scheduled) {
          //$LASTPOS=10001133;//kernel.SchedulerMod:1133
          _this._th.waitCount=0;
          
        } else {
          //$LASTPOS=10001181;//kernel.SchedulerMod:1181
          if (_this._scheduler) {
            //$LASTPOS=10001197;//kernel.SchedulerMod:1197
            _this._scheduler.addToCur(_this._th);
          }
          
        }
        
      }
    },
    timeStop :function _trc_SchedulerMod_timeStop() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$Boot.timeStop(_this);
    },
    fiber$timeStop :function _trc_SchedulerMod_f_timeStop(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$Boot.timeStop(_this);return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"initSchedulerMod":{"nowait":false},"update":{"nowait":false},"onUpdate":{"nowait":true},"updateEx":{"nowait":false},"currentThreadGroup":{"nowait":true},"wait":{"nowait":false},"notify":{"nowait":true},"timeStop":{"nowait":false}},"fields":{"_scheduler":{},"_th":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ThreadGroupMod',
  shortName: 'ThreadGroupMod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_ThreadGroupMod_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_ThreadGroupMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    isDeadThreadGroup :function _trc_ThreadGroupMod_isDeadThreadGroup() {
      "use strict";
      var _this=this;
      
      return _this._isDeadThreadGroup=_this._isDeadThreadGroup||(_this._threadGroup&&(_this._threadGroup.objectPoolAge!=_this.tGrpObjectPoolAge||_this._threadGroup.isDeadThreadGroup()));
    },
    fiber$isDeadThreadGroup :function _trc_ThreadGroupMod_f_isDeadThreadGroup(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this._isDeadThreadGroup=_this._isDeadThreadGroup||(_this._threadGroup&&(_this._threadGroup.objectPoolAge!=_this.tGrpObjectPoolAge||_this._threadGroup.isDeadThreadGroup()));return;
      
      
      _thread.retVal=_this;return;
    },
    setThreadGroup :function _trc_ThreadGroupMod_setThreadGroup(g) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=11000252;//kernel.ThreadGroupMod:252
      _this._threadGroup=g;
      //$LASTPOS=11000273;//kernel.ThreadGroupMod:273
      _this.tGrpObjectPoolAge=g.objectPoolAge;
    },
    fiber$setThreadGroup :function _trc_ThreadGroupMod_f_setThreadGroup(_thread,g) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=11000252;//kernel.ThreadGroupMod:252
      _this._threadGroup=g;
      //$LASTPOS=11000273;//kernel.ThreadGroupMod:273
      _this.tGrpObjectPoolAge=g.objectPoolAge;
      
      _thread.retVal=_this;return;
    },
    killThreadGroup :function _trc_ThreadGroupMod_killThreadGroup() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=11000338;//kernel.ThreadGroupMod:338
      _this._isDeadThreadGroup=true;
    },
    fiber$killThreadGroup :function _trc_ThreadGroupMod_f_killThreadGroup(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=11000338;//kernel.ThreadGroupMod:338
      _this._isDeadThreadGroup=true;
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"isDeadThreadGroup":{"nowait":false},"setThreadGroup":{"nowait":false},"killThreadGroup":{"nowait":false}},"fields":{"_isDeadThreadGroup":{},"_threadGroup":{},"tGrpObjectPoolAge":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.InputDevice',
  shortName: 'InputDevice',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_InputDevice_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_InputDevice_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_InputDevice_initialize() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=12000109;//kernel.InputDevice:109
      _this.listeners=[];
      //$LASTPOS=12000128;//kernel.InputDevice:128
      _this.touchEmu=true;
      //$LASTPOS=12000148;//kernel.InputDevice:148
      _this.defaultLayer=Tonyu.globals.$Screen;
    },
    handleListeners :function _trc_InputDevice_handleListeners() {
      "use strict";
      var _this=this;
      var l;
      
      //$LASTPOS=12000200;//kernel.InputDevice:200
      l = _this.listeners;
      
      //$LASTPOS=12000222;//kernel.InputDevice:222
      _this.listeners=[];
      //$LASTPOS=12000241;//kernel.InputDevice:241
      while (l.length>0) {
        //$LASTPOS=12000262;//kernel.InputDevice:262
        (l.shift())();
        
      }
    },
    fiber$handleListeners :function _trc_InputDevice_f_handleListeners(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var l;
      
      //$LASTPOS=12000200;//kernel.InputDevice:200
      l = _this.listeners;
      
      //$LASTPOS=12000222;//kernel.InputDevice:222
      _this.listeners=[];
      
      _thread.enter(function _trc_InputDevice_ent_handleListeners(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=12000241;//kernel.InputDevice:241
          case 1:
            if (!(l.length>0)) { __pc=2     ; break; }
            {
              //$LASTPOS=12000262;//kernel.InputDevice:262
              (l.shift())();
            }
            __pc=1;break;
          case 2     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    addOnetimeListener :function _trc_InputDevice_addOnetimeListener(l) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=12000312;//kernel.InputDevice:312
      _this.listeners.push(l);
    },
    fiber$addOnetimeListener :function _trc_InputDevice_f_addOnetimeListener(_thread,l) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=12000312;//kernel.InputDevice:312
      _this.listeners.push(l);
      
      _thread.retVal=_this;return;
    },
    newTouch :function _trc_InputDevice_newTouch(i) {
      "use strict";
      var _this=this;
      
      return {index: i,px: 0,py: 0,x: 0,y: 0,vx: 0,vy: 0,touched: 0,identifier: - 1,ended: false,layer: _this.defaultLayer};
    },
    fiber$newTouch :function _trc_InputDevice_f_newTouch(_thread,i) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal={index: i,px: 0,py: 0,x: 0,y: 0,vx: 0,vy: 0,touched: 0,identifier: - 1,ended: false,layer: _this.defaultLayer};return;
      
      
      _thread.retVal=_this;return;
    },
    changeTouchLayer :function _trc_InputDevice_changeTouchLayer(t,toLayer) {
      "use strict";
      var _this=this;
      
      return t.layer=toLayer;
    },
    fiber$changeTouchLayer :function _trc_InputDevice_f_changeTouchLayer(_thread,t,toLayer) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=t.layer=toLayer;return;
      
      
      _thread.retVal=_this;return;
    },
    initCanvasEvents :function _trc_InputDevice_initCanvasEvents(cvj) {
      "use strict";
      var _this=this;
      var cv;
      var ID_MOUSE;
      var handleMouseDown;
      var handleMouseMove;
      var handleMouseUp;
      var handleTouchStart;
      var handleTouchMove;
      var handleTouchEnd;
      var d;
      
      //$LASTPOS=12000572;//kernel.InputDevice:572
      _this.rootCanvas=cvj;
      //$LASTPOS=12000593;//kernel.InputDevice:593
      cv = cvj[0];
      
      //$LASTPOS=12000613;//kernel.InputDevice:613
      ID_MOUSE = 31238612;
      
      //$LASTPOS=12000641;//kernel.InputDevice:641
      Tonyu.globals.$handleMouseDown=(function anonymous_658(e) {
        var p;
        var mp;
        
        //$LASTPOS=12000674;//kernel.InputDevice:674
        _this.mouseDownAtCV=true;
        //$LASTPOS=12000703;//kernel.InputDevice:703
        Tonyu.resetLoopCheck();
        //$LASTPOS=12000736;//kernel.InputDevice:736
        if (Tonyu.globals.$t2MediaLib) {
          //$LASTPOS=12000753;//kernel.InputDevice:753
          Tonyu.globals.$t2MediaLib.activate();
        }
        //$LASTPOS=12000902;//kernel.InputDevice:902
        p = cvj.offset();
        
        //$LASTPOS=12000931;//kernel.InputDevice:931
        mp = {x: e.clientX-p.left,y: e.clientY-p.top,layer: Tonyu.globals.$Screen.layer};
        
        //$LASTPOS=12001008;//kernel.InputDevice:1008
        mp=Tonyu.globals.$Screen.convert(mp,_this.defaultLayer);
        //$LASTPOS=12001080;//kernel.InputDevice:1080
        Tonyu.globals.$mouseX=mp.x;
        //$LASTPOS=12001103;//kernel.InputDevice:1103
        Tonyu.globals.$mouseY=mp.y;
        //$LASTPOS=12001126;//kernel.InputDevice:1126
        _this.mouseButton=_this.mouseButton|(1<<e.button);
        //$LASTPOS=12001174;//kernel.InputDevice:1174
        _this.isMouseDown=true;
        //$LASTPOS=12001201;//kernel.InputDevice:1201
        if (Tonyu.globals.$InputDevice.touchEmu) {
          //$LASTPOS=12001243;//kernel.InputDevice:1243
          Tonyu.globals.$handleTouchStart({preventDefault: (function anonymous_1295() {
            
          }),originalEvent: {changedTouches: [{identifier: ID_MOUSE,pageX: e.clientX,pageY: e.clientY}]}});
          
        }
        //$LASTPOS=12001540;//kernel.InputDevice:1540
        _this.handleListeners();
      });
      //$LASTPOS=12001572;//kernel.InputDevice:1572
      Tonyu.globals.$handleMouseMove=(function anonymous_1589(e) {
        var p;
        var mp;
        
        //$LASTPOS=12001605;//kernel.InputDevice:1605
        Tonyu.resetLoopCheck();
        //$LASTPOS=12001638;//kernel.InputDevice:1638
        if (_this.mouseDownAtCV) {
          //$LASTPOS=12001657;//kernel.InputDevice:1657
          e.preventDefault();
        }
        //$LASTPOS=12001686;//kernel.InputDevice:1686
        p = cvj.offset();
        
        //$LASTPOS=12001715;//kernel.InputDevice:1715
        mp = {x: e.clientX-p.left,y: e.clientY-p.top,layer: Tonyu.globals.$Screen.layer};
        
        //$LASTPOS=12001792;//kernel.InputDevice:1792
        mp=Tonyu.globals.$Screen.convert(mp,_this.defaultLayer);
        //$LASTPOS=12001864;//kernel.InputDevice:1864
        Tonyu.globals.$mouseX=mp.x;
        //$LASTPOS=12001887;//kernel.InputDevice:1887
        Tonyu.globals.$mouseY=mp.y;
        //$LASTPOS=12001910;//kernel.InputDevice:1910
        if (_this.isMouseDown&&Tonyu.globals.$InputDevice.touchEmu) {
          //$LASTPOS=12001967;//kernel.InputDevice:1967
          Tonyu.globals.$handleTouchMove({preventDefault: (function anonymous_2018() {
            
          }),originalEvent: {changedTouches: [{identifier: ID_MOUSE,pageX: e.clientX,pageY: e.clientY}]}});
          
        }
        //$LASTPOS=12002263;//kernel.InputDevice:2263
        _this.handleListeners();
      });
      //$LASTPOS=12002295;//kernel.InputDevice:2295
      Tonyu.globals.$handleMouseUp=(function anonymous_2310(e) {
        
        //$LASTPOS=12002326;//kernel.InputDevice:2326
        Tonyu.resetLoopCheck();
        //$LASTPOS=12002359;//kernel.InputDevice:2359
        if (Tonyu.globals.$t2MediaLib) {
          //$LASTPOS=12002376;//kernel.InputDevice:2376
          Tonyu.globals.$t2MediaLib.activate();
        }
        //$LASTPOS=12002409;//kernel.InputDevice:2409
        if (_this.mouseDownAtCV) {
          //$LASTPOS=12002428;//kernel.InputDevice:2428
          e.preventDefault();
        }
        //$LASTPOS=12002457;//kernel.InputDevice:2457
        _this.mouseDownAtCV=false;
        //$LASTPOS=12002487;//kernel.InputDevice:2487
        _this.isMouseDown=false;
        //$LASTPOS=12002515;//kernel.InputDevice:2515
        _this.mouseButton=_this.mouseButton&~ (1<<e.button);
        //$LASTPOS=12002564;//kernel.InputDevice:2564
        if (Tonyu.globals.$InputDevice.touchEmu) {
          //$LASTPOS=12002606;//kernel.InputDevice:2606
          Tonyu.globals.$handleTouchEnd({preventDefault: (function anonymous_2656() {
            
          }),originalEvent: {changedTouches: [{identifier: ID_MOUSE,pageX: e.clientX,pageY: e.clientY}]}});
          
        }
      });
      //$LASTPOS=12002916;//kernel.InputDevice:2916
      _this.touch=new Tonyu.classes.kernel.TouchFingers(_this);
      //$LASTPOS=12002951;//kernel.InputDevice:2951
      Tonyu.globals.$touches=_this.touch.fingerArray;
      //$LASTPOS=12002984;//kernel.InputDevice:2984
      Tonyu.globals.$handleTouchStart=(function anonymous_3002(e) {
        
        return _this.touch.handleStart(e);
      });
      //$LASTPOS=12003069;//kernel.InputDevice:3069
      Tonyu.globals.$handleTouchMove=(function anonymous_3086(e) {
        
        return _this.touch.handleMove(e);
      });
      //$LASTPOS=12003152;//kernel.InputDevice:3152
      Tonyu.globals.$handleTouchEnd=(function anonymous_3168(e) {
        
        return _this.touch.handleEnd(e);
      });
      //$LASTPOS=12003233;//kernel.InputDevice:3233
      Tonyu.globals.$unsetTouchEmu=(function anonymous_3248() {
        
        //$LASTPOS=12003263;//kernel.InputDevice:3263
        Tonyu.resetLoopCheck();
        //$LASTPOS=12003296;//kernel.InputDevice:3296
        Tonyu.globals.$InputDevice.touchEmu=false;
        return _this.touch.unsetEmu();
      });
      //$LASTPOS=12003381;//kernel.InputDevice:3381
      handleMouseDown = (function anonymous_3401(e) {
        
        //$LASTPOS=12003406;//kernel.InputDevice:3406
        Tonyu.globals.$handleMouseDown(e);
      });
      
      //$LASTPOS=12003434;//kernel.InputDevice:3434
      handleMouseMove = (function anonymous_3454(e) {
        
        //$LASTPOS=12003459;//kernel.InputDevice:3459
        Tonyu.globals.$handleMouseMove(e);
      });
      
      //$LASTPOS=12003487;//kernel.InputDevice:3487
      handleMouseUp = (function anonymous_3505(e) {
        
        //$LASTPOS=12003510;//kernel.InputDevice:3510
        Tonyu.globals.$handleMouseUp(e);
      });
      
      //$LASTPOS=12003536;//kernel.InputDevice:3536
      handleTouchStart = (function anonymous_3557(e) {
        
        //$LASTPOS=12003562;//kernel.InputDevice:3562
        Tonyu.globals.$unsetTouchEmu();
        //$LASTPOS=12003579;//kernel.InputDevice:3579
        Tonyu.globals.$handleTouchStart(e);
      });
      
      //$LASTPOS=12003608;//kernel.InputDevice:3608
      handleTouchMove = (function anonymous_3628(e) {
        
        //$LASTPOS=12003633;//kernel.InputDevice:3633
        Tonyu.globals.$unsetTouchEmu();
        //$LASTPOS=12003650;//kernel.InputDevice:3650
        Tonyu.globals.$handleTouchMove(e);
      });
      
      //$LASTPOS=12003678;//kernel.InputDevice:3678
      handleTouchEnd = (function anonymous_3697(e) {
        
        //$LASTPOS=12003702;//kernel.InputDevice:3702
        Tonyu.globals.$unsetTouchEmu();
        //$LASTPOS=12003719;//kernel.InputDevice:3719
        Tonyu.globals.$handleTouchEnd(e);
      });
      
      //$LASTPOS=12003746;//kernel.InputDevice:3746
      d = $.data(cv,"events");
      
      //$LASTPOS=12003778;//kernel.InputDevice:3778
      if (! d) {
        //$LASTPOS=12003797;//kernel.InputDevice:3797
        $.data(cv,"events","true");
        //$LASTPOS=12003834;//kernel.InputDevice:3834
        cvj.mousedown(handleMouseDown);
        //$LASTPOS=12003875;//kernel.InputDevice:3875
        $(document).mousemove(handleMouseMove);
        //$LASTPOS=12003924;//kernel.InputDevice:3924
        $(document).mouseup(handleMouseUp);
        //$LASTPOS=12003969;//kernel.InputDevice:3969
        cvj.on("contextmenu",(function anonymous_3990(e) {
          
          //$LASTPOS=12004018;//kernel.InputDevice:4018
          e.stopPropagation();
          //$LASTPOS=12004052;//kernel.InputDevice:4052
          e.preventDefault();
        }));
        //$LASTPOS=12004094;//kernel.InputDevice:4094
        cvj.on("touchstart",handleTouchStart);
        //$LASTPOS=12004142;//kernel.InputDevice:4142
        cvj.on("touchmove",handleTouchMove);
        //$LASTPOS=12004188;//kernel.InputDevice:4188
        cvj.on("touchend",handleTouchEnd);
        //$LASTPOS=12004232;//kernel.InputDevice:4232
        cvj.on("touchcancel",handleTouchEnd);
        
      }
    },
    fiber$initCanvasEvents :function _trc_InputDevice_f_initCanvasEvents(_thread,cvj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var cv;
      var ID_MOUSE;
      var handleMouseDown;
      var handleMouseMove;
      var handleMouseUp;
      var handleTouchStart;
      var handleTouchMove;
      var handleTouchEnd;
      var d;
      
      //$LASTPOS=12000572;//kernel.InputDevice:572
      _this.rootCanvas=cvj;
      //$LASTPOS=12000593;//kernel.InputDevice:593
      cv = cvj[0];
      
      //$LASTPOS=12000613;//kernel.InputDevice:613
      ID_MOUSE = 31238612;
      
      
      _thread.enter(function _trc_InputDevice_ent_initCanvasEvents(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=12000641;//kernel.InputDevice:641
            Tonyu.globals.$handleMouseDown=(function anonymous_658(e) {
              var p;
              var mp;
              
              //$LASTPOS=12000674;//kernel.InputDevice:674
              _this.mouseDownAtCV=true;
              //$LASTPOS=12000703;//kernel.InputDevice:703
              Tonyu.resetLoopCheck();
              //$LASTPOS=12000736;//kernel.InputDevice:736
              if (Tonyu.globals.$t2MediaLib) {
                //$LASTPOS=12000753;//kernel.InputDevice:753
                Tonyu.globals.$t2MediaLib.activate();
              }
              //$LASTPOS=12000902;//kernel.InputDevice:902
              p = cvj.offset();
              
              //$LASTPOS=12000931;//kernel.InputDevice:931
              mp = {x: e.clientX-p.left,y: e.clientY-p.top,layer: Tonyu.globals.$Screen.layer};
              
              //$LASTPOS=12001008;//kernel.InputDevice:1008
              mp=Tonyu.globals.$Screen.convert(mp,_this.defaultLayer);
              //$LASTPOS=12001080;//kernel.InputDevice:1080
              Tonyu.globals.$mouseX=mp.x;
              //$LASTPOS=12001103;//kernel.InputDevice:1103
              Tonyu.globals.$mouseY=mp.y;
              //$LASTPOS=12001126;//kernel.InputDevice:1126
              _this.mouseButton=_this.mouseButton|(1<<e.button);
              //$LASTPOS=12001174;//kernel.InputDevice:1174
              _this.isMouseDown=true;
              //$LASTPOS=12001201;//kernel.InputDevice:1201
              if (Tonyu.globals.$InputDevice.touchEmu) {
                //$LASTPOS=12001243;//kernel.InputDevice:1243
                Tonyu.globals.$handleTouchStart({preventDefault: (function anonymous_1295() {
                  
                }),originalEvent: {changedTouches: [{identifier: ID_MOUSE,pageX: e.clientX,pageY: e.clientY}]}});
                
              }
              //$LASTPOS=12001540;//kernel.InputDevice:1540
              _this.handleListeners();
            });
            //$LASTPOS=12001572;//kernel.InputDevice:1572
            Tonyu.globals.$handleMouseMove=(function anonymous_1589(e) {
              var p;
              var mp;
              
              //$LASTPOS=12001605;//kernel.InputDevice:1605
              Tonyu.resetLoopCheck();
              //$LASTPOS=12001638;//kernel.InputDevice:1638
              if (_this.mouseDownAtCV) {
                //$LASTPOS=12001657;//kernel.InputDevice:1657
                e.preventDefault();
              }
              //$LASTPOS=12001686;//kernel.InputDevice:1686
              p = cvj.offset();
              
              //$LASTPOS=12001715;//kernel.InputDevice:1715
              mp = {x: e.clientX-p.left,y: e.clientY-p.top,layer: Tonyu.globals.$Screen.layer};
              
              //$LASTPOS=12001792;//kernel.InputDevice:1792
              mp=Tonyu.globals.$Screen.convert(mp,_this.defaultLayer);
              //$LASTPOS=12001864;//kernel.InputDevice:1864
              Tonyu.globals.$mouseX=mp.x;
              //$LASTPOS=12001887;//kernel.InputDevice:1887
              Tonyu.globals.$mouseY=mp.y;
              //$LASTPOS=12001910;//kernel.InputDevice:1910
              if (_this.isMouseDown&&Tonyu.globals.$InputDevice.touchEmu) {
                //$LASTPOS=12001967;//kernel.InputDevice:1967
                Tonyu.globals.$handleTouchMove({preventDefault: (function anonymous_2018() {
                  
                }),originalEvent: {changedTouches: [{identifier: ID_MOUSE,pageX: e.clientX,pageY: e.clientY}]}});
                
              }
              //$LASTPOS=12002263;//kernel.InputDevice:2263
              _this.handleListeners();
            });
            //$LASTPOS=12002295;//kernel.InputDevice:2295
            Tonyu.globals.$handleMouseUp=(function anonymous_2310(e) {
              
              //$LASTPOS=12002326;//kernel.InputDevice:2326
              Tonyu.resetLoopCheck();
              //$LASTPOS=12002359;//kernel.InputDevice:2359
              if (Tonyu.globals.$t2MediaLib) {
                //$LASTPOS=12002376;//kernel.InputDevice:2376
                Tonyu.globals.$t2MediaLib.activate();
              }
              //$LASTPOS=12002409;//kernel.InputDevice:2409
              if (_this.mouseDownAtCV) {
                //$LASTPOS=12002428;//kernel.InputDevice:2428
                e.preventDefault();
              }
              //$LASTPOS=12002457;//kernel.InputDevice:2457
              _this.mouseDownAtCV=false;
              //$LASTPOS=12002487;//kernel.InputDevice:2487
              _this.isMouseDown=false;
              //$LASTPOS=12002515;//kernel.InputDevice:2515
              _this.mouseButton=_this.mouseButton&~ (1<<e.button);
              //$LASTPOS=12002564;//kernel.InputDevice:2564
              if (Tonyu.globals.$InputDevice.touchEmu) {
                //$LASTPOS=12002606;//kernel.InputDevice:2606
                Tonyu.globals.$handleTouchEnd({preventDefault: (function anonymous_2656() {
                  
                }),originalEvent: {changedTouches: [{identifier: ID_MOUSE,pageX: e.clientX,pageY: e.clientY}]}});
                
              }
            });
            //$LASTPOS=12002916;//kernel.InputDevice:2916
            _this.touch=new Tonyu.classes.kernel.TouchFingers(_this);
            //$LASTPOS=12002951;//kernel.InputDevice:2951
            Tonyu.globals.$touches=_this.touch.fingerArray;
            //$LASTPOS=12002984;//kernel.InputDevice:2984
            Tonyu.globals.$handleTouchStart=(function anonymous_3002(e) {
              
              return _this.touch.handleStart(e);
            });
            //$LASTPOS=12003069;//kernel.InputDevice:3069
            Tonyu.globals.$handleTouchMove=(function anonymous_3086(e) {
              
              return _this.touch.handleMove(e);
            });
            //$LASTPOS=12003152;//kernel.InputDevice:3152
            Tonyu.globals.$handleTouchEnd=(function anonymous_3168(e) {
              
              return _this.touch.handleEnd(e);
            });
            //$LASTPOS=12003233;//kernel.InputDevice:3233
            Tonyu.globals.$unsetTouchEmu=(function anonymous_3248() {
              
              //$LASTPOS=12003263;//kernel.InputDevice:3263
              Tonyu.resetLoopCheck();
              //$LASTPOS=12003296;//kernel.InputDevice:3296
              Tonyu.globals.$InputDevice.touchEmu=false;
              return _this.touch.unsetEmu();
            });
            //$LASTPOS=12003381;//kernel.InputDevice:3381
            handleMouseDown = (function anonymous_3401(e) {
              
              //$LASTPOS=12003406;//kernel.InputDevice:3406
              Tonyu.globals.$handleMouseDown(e);
            });
            
            //$LASTPOS=12003434;//kernel.InputDevice:3434
            handleMouseMove = (function anonymous_3454(e) {
              
              //$LASTPOS=12003459;//kernel.InputDevice:3459
              Tonyu.globals.$handleMouseMove(e);
            });
            
            //$LASTPOS=12003487;//kernel.InputDevice:3487
            handleMouseUp = (function anonymous_3505(e) {
              
              //$LASTPOS=12003510;//kernel.InputDevice:3510
              Tonyu.globals.$handleMouseUp(e);
            });
            
            //$LASTPOS=12003536;//kernel.InputDevice:3536
            handleTouchStart = (function anonymous_3557(e) {
              
              //$LASTPOS=12003562;//kernel.InputDevice:3562
              Tonyu.globals.$unsetTouchEmu();
              //$LASTPOS=12003579;//kernel.InputDevice:3579
              Tonyu.globals.$handleTouchStart(e);
            });
            
            //$LASTPOS=12003608;//kernel.InputDevice:3608
            handleTouchMove = (function anonymous_3628(e) {
              
              //$LASTPOS=12003633;//kernel.InputDevice:3633
              Tonyu.globals.$unsetTouchEmu();
              //$LASTPOS=12003650;//kernel.InputDevice:3650
              Tonyu.globals.$handleTouchMove(e);
            });
            
            //$LASTPOS=12003678;//kernel.InputDevice:3678
            handleTouchEnd = (function anonymous_3697(e) {
              
              //$LASTPOS=12003702;//kernel.InputDevice:3702
              Tonyu.globals.$unsetTouchEmu();
              //$LASTPOS=12003719;//kernel.InputDevice:3719
              Tonyu.globals.$handleTouchEnd(e);
            });
            
            //$LASTPOS=12003746;//kernel.InputDevice:3746
            d = $.data(cv,"events");
            
            //$LASTPOS=12003778;//kernel.InputDevice:3778
            if (! d) {
              //$LASTPOS=12003797;//kernel.InputDevice:3797
              $.data(cv,"events","true");
              //$LASTPOS=12003834;//kernel.InputDevice:3834
              cvj.mousedown(handleMouseDown);
              //$LASTPOS=12003875;//kernel.InputDevice:3875
              $(document).mousemove(handleMouseMove);
              //$LASTPOS=12003924;//kernel.InputDevice:3924
              $(document).mouseup(handleMouseUp);
              //$LASTPOS=12003969;//kernel.InputDevice:3969
              cvj.on("contextmenu",(function anonymous_3990(e) {
                
                //$LASTPOS=12004018;//kernel.InputDevice:4018
                e.stopPropagation();
                //$LASTPOS=12004052;//kernel.InputDevice:4052
                e.preventDefault();
              }));
              //$LASTPOS=12004094;//kernel.InputDevice:4094
              cvj.on("touchstart",handleTouchStart);
              //$LASTPOS=12004142;//kernel.InputDevice:4142
              cvj.on("touchmove",handleTouchMove);
              //$LASTPOS=12004188;//kernel.InputDevice:4188
              cvj.on("touchend",handleTouchEnd);
              //$LASTPOS=12004232;//kernel.InputDevice:4232
              cvj.on("touchcancel",handleTouchEnd);
              
            }
            _thread.exit(_this);return;
          }
        }
      });
    },
    update :function _trc_InputDevice_update() {
      "use strict";
      var _this=this;
      
      return _this.touch.updateFingers();
    },
    fiber$update :function _trc_InputDevice_f_update(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.touch.updateFingers();return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"handleListeners":{"nowait":false},"addOnetimeListener":{"nowait":false},"newTouch":{"nowait":false},"changeTouchLayer":{"nowait":false},"initCanvasEvents":{"nowait":false},"update":{"nowait":false}},"fields":{"listeners":{},"touchEmu":{},"defaultLayer":{},"rootCanvas":{},"mouseDownAtCV":{},"mouseButton":{},"isMouseDown":{},"touch":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ArgParser',
  shortName: 'ArgParser',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_ArgParser_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_ArgParser_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_ArgParser_initialize(asrc) {
      "use strict";
      var _this=this;
      var i;
      
      //$LASTPOS=13000018;//kernel.ArgParser:18
      if (! asrc) {
        throw new Error("Use as: new ArgParser(arguments)");
        
      }
      //$LASTPOS=13000087;//kernel.ArgParser:87
      _this.length=0;
      //$LASTPOS=13000102;//kernel.ArgParser:102
      _this.a=_this;
      //$LASTPOS=13000115;//kernel.ArgParser:115
      //$LASTPOS=13000120;//kernel.ArgParser:120
      i = 0;
      for (; i<asrc.length ; i++) {
        //$LASTPOS=13000148;//kernel.ArgParser:148
        _this.push(asrc[i]);
      }
    },
    push :function _trc_ArgParser_push(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=13000183;//kernel.ArgParser:183
      _this.a[_this.length++]=v;
    },
    fiber$push :function _trc_ArgParser_f_push(_thread,v) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=13000183;//kernel.ArgParser:183
      _this.a[_this.length++]=v;
      
      _thread.retVal=_this;return;
    },
    trimUndefs :function _trc_ArgParser_trimUndefs() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=13000223;//kernel.ArgParser:223
      while (_this.length>0) {
        //$LASTPOS=13000250;//kernel.ArgParser:250
        if (_this.a[_this.length-1]!==_this._undef) {
          break;
          
        }
        //$LASTPOS=13000292;//kernel.ArgParser:292
        _this.length--;
        //$LASTPOS=13000311;//kernel.ArgParser:311
        delete _this.a[_this.length];
        
      }
    },
    fiber$trimUndefs :function _trc_ArgParser_f_trimUndefs(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_ArgParser_ent_trimUndefs(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=13000223;//kernel.ArgParser:223
          case 1:
            if (!(_this.length>0)) { __pc=3     ; break; }
            //$LASTPOS=13000250;//kernel.ArgParser:250
            if (!(_this.a[_this.length-1]!==_this._undef)) { __pc=2     ; break; }
            __pc=3     ; break;
            
          case 2     :
            
            //$LASTPOS=13000292;//kernel.ArgParser:292
            _this.length--;
            //$LASTPOS=13000311;//kernel.ArgParser:311
            delete _this.a[_this.length];
            __pc=1;break;
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    peek :function _trc_ArgParser_peek(i) {
      "use strict";
      var _this=this;
      
      return _this.a[i||0];
    },
    fiber$peek :function _trc_ArgParser_f_peek(_thread,i) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.a[i||0];return;
      
      
      _thread.retVal=_this;return;
    },
    shift :function _trc_ArgParser_shift(type) {
      "use strict";
      var _this=this;
      var res;
      var i;
      
      //$LASTPOS=13000396;//kernel.ArgParser:396
      if (typeof  type=="number") {
        //$LASTPOS=13000434;//kernel.ArgParser:434
        res = [];
        
        //$LASTPOS=13000455;//kernel.ArgParser:455
        //$LASTPOS=13000460;//kernel.ArgParser:460
        i = 0;
        for (; i<type ; i++) {
          //$LASTPOS=13000481;//kernel.ArgParser:481
          res.push(_this.shift());
        }
        return res;
        
      } else {
        //$LASTPOS=13000533;//kernel.ArgParser:533
        if (typeof  type=="string") {
          //$LASTPOS=13000571;//kernel.ArgParser:571
          if (_this.a[0]==null) {
            return _this._undef;
          }
          //$LASTPOS=13000657;//kernel.ArgParser:657
          if (typeof  _this.a[0]===type) {
            return _this.shift();
          }
          return _this._undef;
          
        } else {
          //$LASTPOS=13000733;//kernel.ArgParser:733
          if (type) {
            //$LASTPOS=13000754;//kernel.ArgParser:754
            if (_this.a[0] instanceof type) {
              return _this.shift();
            }
            return _this._undef;
            
          }
        }
      }
      //$LASTPOS=13000824;//kernel.ArgParser:824
      res = _this.a[0];
      
      //$LASTPOS=13000843;//kernel.ArgParser:843
      //$LASTPOS=13000848;//kernel.ArgParser:848
      i = 1;
      for (; i<_this.length ; i++) {
        {
          //$LASTPOS=13000885;//kernel.ArgParser:885
          _this.a[i-1]=_this.a[i];
        }
      }
      //$LASTPOS=13000910;//kernel.ArgParser:910
      _this.length--;
      //$LASTPOS=13000941;//kernel.ArgParser:941
      delete _this.a[_this.length];
      return res;
    },
    fiber$shift :function _trc_ArgParser_f_shift(_thread,type) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var i;
      
      
      _thread.enter(function _trc_ArgParser_ent_shift(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=13000396;//kernel.ArgParser:396
            if (!(typeof  type=="number")) { __pc=1     ; break; }
            //$LASTPOS=13000434;//kernel.ArgParser:434
            res = [];
            
            //$LASTPOS=13000455;//kernel.ArgParser:455
            //$LASTPOS=13000460;//kernel.ArgParser:460
            i = 0;
            for (; i<type ; i++) {
              //$LASTPOS=13000481;//kernel.ArgParser:481
              res.push(_this.shift());
            }
            _thread.exit(res);return;
            __pc=10    ;break;
          case 1     :
            //$LASTPOS=13000533;//kernel.ArgParser:533
            if (!(typeof  type=="string")) { __pc=5     ; break; }
            //$LASTPOS=13000571;//kernel.ArgParser:571
            if (!(_this.a[0]==null)) { __pc=2     ; break; }
            _thread.exit(_this._undef);return;
          case 2     :
            
            //$LASTPOS=13000657;//kernel.ArgParser:657
            if (!(typeof  _this.a[0]===type)) { __pc=4     ; break; }
            _this.fiber$shift(_thread);
            __pc=3;return;
          case 3:
            _thread.exit(_thread.retVal);return;
            
          case 4     :
            
            _thread.exit(_this._undef);return;
            __pc=9     ;break;
          case 5     :
            //$LASTPOS=13000733;//kernel.ArgParser:733
            if (!(type)) { __pc=8     ; break; }
            //$LASTPOS=13000754;//kernel.ArgParser:754
            if (!(_this.a[0] instanceof type)) { __pc=7     ; break; }
            _this.fiber$shift(_thread);
            __pc=6;return;
          case 6:
            _thread.exit(_thread.retVal);return;
            
          case 7     :
            
            _thread.exit(_this._undef);return;
          case 8     :
            
          case 9     :
            
          case 10    :
            
            //$LASTPOS=13000824;//kernel.ArgParser:824
            res = _this.a[0];
            
            //$LASTPOS=13000843;//kernel.ArgParser:843
            //$LASTPOS=13000848;//kernel.ArgParser:848
            i = 1;
            for (; i<_this.length ; i++) {
              {
                //$LASTPOS=13000885;//kernel.ArgParser:885
                _this.a[i-1]=_this.a[i];
              }
            }
            //$LASTPOS=13000910;//kernel.ArgParser:910
            _this.length--;
            //$LASTPOS=13000941;//kernel.ArgParser:941
            delete _this.a[_this.length];
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    toArray :function _trc_ArgParser_toArray() {
      "use strict";
      var _this=this;
      var res;
      var i;
      
      //$LASTPOS=13001003;//kernel.ArgParser:1003
      res = [];
      
      //$LASTPOS=13001020;//kernel.ArgParser:1020
      //$LASTPOS=13001025;//kernel.ArgParser:1025
      i = 0;
      for (; i<_this.a.length ; i++) {
        //$LASTPOS=13001051;//kernel.ArgParser:1051
        res.push(_this.a[i]);
      }
      return res;
    },
    fiber$toArray :function _trc_ArgParser_f_toArray(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var i;
      
      //$LASTPOS=13001003;//kernel.ArgParser:1003
      res = [];
      
      //$LASTPOS=13001020;//kernel.ArgParser:1020
      //$LASTPOS=13001025;//kernel.ArgParser:1025
      i = 0;
      for (; i<_this.a.length ; i++) {
        //$LASTPOS=13001051;//kernel.ArgParser:1051
        res.push(_this.a[i]);
      }
      _thread.retVal=res;return;
      
      
      _thread.retVal=_this;return;
    },
    parseOptions :function _trc_ArgParser_parseOptions(spec) {
      "use strict";
      var _this=this;
      var speca;
      var res;
      var name;
      var opt;
      var notOption;
      var k;
      var v;
      var _it_71;
      var _it_72;
      
      //$LASTPOS=13001115;//kernel.ArgParser:1115
      speca = spec.split(",");
      
      //$LASTPOS=13001147;//kernel.ArgParser:1147
      res = {};
      
      //$LASTPOS=13001164;//kernel.ArgParser:1164
      if (_this.length>speca.length) {
        throw new Error("# of arguments("+_this.length+") is more than spec("+speca.length+").");
        
        
      }
      //$LASTPOS=13001306;//kernel.ArgParser:1306
      while (_this.length>1) {
        //$LASTPOS=13001333;//kernel.ArgParser:1333
        name = speca.shift();
        
        //$LASTPOS=13001366;//kernel.ArgParser:1366
        res[name]=_this.shift();
        
      }
      //$LASTPOS=13001397;//kernel.ArgParser:1397
      opt = _this.shift();
      
      //$LASTPOS=13001429;//kernel.ArgParser:1429
      if (typeof  opt!=="object") {
        //$LASTPOS=13001467;//kernel.ArgParser:1467
        notOption=true;
        
      } else {
        //$LASTPOS=13001506;//kernel.ArgParser:1506
        _it_71=Tonyu.iterator(opt,2);
        while(_it_71.next()) {
          k=_it_71[0];
          v=_it_71[1];
          
          //$LASTPOS=13001542;//kernel.ArgParser:1542
          if (speca.indexOf(k)<0) {
            //$LASTPOS=13001585;//kernel.ArgParser:1585
            notOption=true;
            break;
            
            
          }
          
        }
        
      }
      //$LASTPOS=13001663;//kernel.ArgParser:1663
      if (notOption) {
        //$LASTPOS=13001689;//kernel.ArgParser:1689
        res[speca.shift()]=opt;
        
      } else {
        //$LASTPOS=13001736;//kernel.ArgParser:1736
        _it_72=Tonyu.iterator(opt,2);
        while(_it_72.next()) {
          k=_it_72[0];
          v=_it_72[1];
          
          //$LASTPOS=13001772;//kernel.ArgParser:1772
          res[k]=v;
          
        }
        
      }
      return res;
    },
    fiber$parseOptions :function _trc_ArgParser_f_parseOptions(_thread,spec) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var speca;
      var res;
      var name;
      var opt;
      var notOption;
      var k;
      var v;
      var _it_71;
      var _it_72;
      
      //$LASTPOS=13001115;//kernel.ArgParser:1115
      speca = spec.split(",");
      
      //$LASTPOS=13001147;//kernel.ArgParser:1147
      res = {};
      
      //$LASTPOS=13001164;//kernel.ArgParser:1164
      if (_this.length>speca.length) {
        throw new Error("# of arguments("+_this.length+") is more than spec("+speca.length+").");
        
        
      }
      
      _thread.enter(function _trc_ArgParser_ent_parseOptions(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=13001306;//kernel.ArgParser:1306
          case 1:
            if (!(_this.length>1)) { __pc=3     ; break; }
            //$LASTPOS=13001333;//kernel.ArgParser:1333
            name = speca.shift();
            
            //$LASTPOS=13001366;//kernel.ArgParser:1366
            _this.fiber$shift(_thread);
            __pc=2;return;
          case 2:
            res[name]=_thread.retVal;
            
            __pc=1;break;
          case 3     :
            
            //$LASTPOS=13001397;//kernel.ArgParser:1397
            _this.fiber$shift(_thread);
            __pc=4;return;
          case 4:
            opt=_thread.retVal;
            
            //$LASTPOS=13001429;//kernel.ArgParser:1429
            if (!(typeof  opt!=="object")) { __pc=5     ; break; }
            {
              //$LASTPOS=13001467;//kernel.ArgParser:1467
              notOption=true;
            }
            __pc=6     ;break;
          case 5     :
            //$LASTPOS=13001506;//kernel.ArgParser:1506
            _it_71=Tonyu.iterator(opt,2);
            while(_it_71.next()) {
              k=_it_71[0];
              v=_it_71[1];
              
              //$LASTPOS=13001542;//kernel.ArgParser:1542
              if (speca.indexOf(k)<0) {
                //$LASTPOS=13001585;//kernel.ArgParser:1585
                notOption=true;
                break;
                
                
              }
              
            }
          case 6     :
            
            //$LASTPOS=13001663;//kernel.ArgParser:1663
            if (notOption) {
              //$LASTPOS=13001689;//kernel.ArgParser:1689
              res[speca.shift()]=opt;
              
            } else {
              //$LASTPOS=13001736;//kernel.ArgParser:1736
              _it_72=Tonyu.iterator(opt,2);
              while(_it_72.next()) {
                k=_it_72[0];
                v=_it_72[1];
                
                //$LASTPOS=13001772;//kernel.ArgParser:1772
                res[k]=v;
                
              }
              
            }
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"push":{"nowait":false},"trimUndefs":{"nowait":false},"peek":{"nowait":false},"shift":{"nowait":false},"toArray":{"nowait":false},"parseOptions":{"nowait":false}},"fields":{"length":{},"a":{},"_undef":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.FileMod',
  shortName: 'FileMod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_FileMod_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_FileMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    file :function _trc_FileMod_file(path) {
      "use strict";
      var _this=this;
      var d;
      var files;
      
      //$LASTPOS=14000034;//kernel.FileMod:34
      d = Tonyu.currentProject.getDir();
      
      //$LASTPOS=14000076;//kernel.FileMod:76
      if (path.isSFile&&path.isSFile()) {
        return path;
      }
      //$LASTPOS=14000130;//kernel.FileMod:130
      files = d.rel("files/");
      
      return files.rel(path).setPolicy({topDir: d});
    },
    fiber$file :function _trc_FileMod_f_file(_thread,path) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var d;
      var files;
      
      //$LASTPOS=14000034;//kernel.FileMod:34
      d = Tonyu.currentProject.getDir();
      
      //$LASTPOS=14000076;//kernel.FileMod:76
      if (path.isSFile&&path.isSFile()) {
        _thread.retVal=path;return;
        
      }
      //$LASTPOS=14000130;//kernel.FileMod:130
      files = d.rel("files/");
      
      _thread.retVal=files.rel(path).setPolicy({topDir: d});return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"file":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.GeneratorMod',
  shortName: 'GeneratorMod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_GeneratorMod_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_GeneratorMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    generator :function _trc_GeneratorMod_generator() {
      "use strict";
      var _this=this;
      var a;
      var methodName;
      var th;
      var res;
      
      //$LASTPOS=15000035;//kernel.GeneratorMod:35
      a = new Tonyu.classes.kernel.ArgParser(arguments);
      
      //$LASTPOS=15000072;//kernel.GeneratorMod:72
      methodName = a.shift();
      
      //$LASTPOS=15000103;//kernel.GeneratorMod:103
      th = Tonyu.thread();
      
      //$LASTPOS=15000131;//kernel.GeneratorMod:131
      a = a.toArray();
      
      //$LASTPOS=15000155;//kernel.GeneratorMod:155
      a.unshift(_this.yielder);
      //$LASTPOS=15000180;//kernel.GeneratorMod:180
      res = {tonyuIterator: (function anonymous_214() {
        
      })};
      
      //$LASTPOS=15000243;//kernel.GeneratorMod:243
      th.apply(_this,methodName,a);
    },
    fiber$generator :function _trc_GeneratorMod_f_generator(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      var methodName;
      var th;
      var res;
      
      //$LASTPOS=15000035;//kernel.GeneratorMod:35
      a = new Tonyu.classes.kernel.ArgParser(_arguments);
      
      //$LASTPOS=15000072;//kernel.GeneratorMod:72
      methodName = a.shift();
      
      //$LASTPOS=15000103;//kernel.GeneratorMod:103
      th = Tonyu.thread();
      
      //$LASTPOS=15000131;//kernel.GeneratorMod:131
      a = a.toArray();
      
      //$LASTPOS=15000155;//kernel.GeneratorMod:155
      a.unshift(_this.yielder);
      //$LASTPOS=15000180;//kernel.GeneratorMod:180
      res = {tonyuIterator: (function anonymous_214() {
        
      })};
      
      //$LASTPOS=15000243;//kernel.GeneratorMod:243
      th.apply(_this,methodName,a);
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"generator":{"nowait":false}},"fields":{"yielder":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MathMod',
  shortName: 'MathMod',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_MathMod_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_MathMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    sin :function _trc_MathMod_sin(d) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=16000073;//kernel.MathMod:73
      if (d%90==0) {
        //$LASTPOS=16000097;//kernel.MathMod:97
        d=_this.amod(d,360);
        return [0,1,0,- 1][_this.floor(d/90)];
        
      }
      return Math.sin(_this.rad(d));
    },
    cos :function _trc_MathMod_cos(d) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=16000216;//kernel.MathMod:216
      if (d%90==0) {
        //$LASTPOS=16000240;//kernel.MathMod:240
        d=_this.amod(d,360);
        return [1,0,- 1,0][_this.floor(d/90)];
        
      }
      return Math.cos(_this.rad(d));
    },
    rad :function _trc_MathMod_rad(d) {
      "use strict";
      var _this=this;
      
      return d/180*Math.PI;
    },
    deg :function _trc_MathMod_deg(d) {
      "use strict";
      var _this=this;
      
      return d/Math.PI*180;
    },
    abs :function _trc_MathMod_abs(v) {
      "use strict";
      var _this=this;
      
      return Math.abs(v);
    },
    sgn :function _trc_MathMod_sgn(v,base) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=16000508;//kernel.MathMod:508
      base=base||0;
      return (v>base?1:v<- base?- 1:0);
    },
    atan2 :function _trc_MathMod_atan2(y,x) {
      "use strict";
      var _this=this;
      
      return _this.deg(Math.atan2(y,x));
    },
    atanxy :function _trc_MathMod_atanxy(x,y) {
      "use strict";
      var _this=this;
      
      return _this.atan2(y,x);
    },
    floor :function _trc_MathMod_floor(x) {
      "use strict";
      var _this=this;
      
      return Math.floor(x);
    },
    angleDiff :function _trc_MathMod_angleDiff(a,b) {
      "use strict";
      var _this=this;
      var c;
      
      
      //$LASTPOS=16000766;//kernel.MathMod:766
      a=_this.floor(a);
      //$LASTPOS=16000783;//kernel.MathMod:783
      b=_this.floor(b);
      //$LASTPOS=16000800;//kernel.MathMod:800
      if (a>=b) {
        //$LASTPOS=16000821;//kernel.MathMod:821
        c=(a-b)%360;
        //$LASTPOS=16000845;//kernel.MathMod:845
        if (c>=180) {
          //$LASTPOS=16000857;//kernel.MathMod:857
          c-=360;
        }
        
      } else {
        //$LASTPOS=16000888;//kernel.MathMod:888
        c=- ((b-a)%360);
        //$LASTPOS=16000915;//kernel.MathMod:915
        if (c<- 180) {
          //$LASTPOS=16000927;//kernel.MathMod:927
          c+=360;
        }
        
      }
      return c;
    },
    sqrt :function _trc_MathMod_sqrt(t) {
      "use strict";
      var _this=this;
      
      return Math.sqrt(t);
    },
    dist :function _trc_MathMod_dist(dx,dy) {
      "use strict";
      var _this=this;
      var t;
      
      //$LASTPOS=16001036;//kernel.MathMod:1036
      if (typeof  dx=="object") {
        //$LASTPOS=16001072;//kernel.MathMod:1072
        t = dx;
        
        //$LASTPOS=16001091;//kernel.MathMod:1091
        dx=t.x-_this.x;
        //$LASTPOS=16001100;//kernel.MathMod:1100
        dy=t.y-_this.y;
        
      }
      return _this.sqrt(dx*dx+dy*dy);
    },
    trunc :function _trc_MathMod_trunc(f) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=16001176;//kernel.MathMod:1176
      if (f>=0) {
        return Math.floor(f);
      } else {
        return Math.ceil(f);
      }
    },
    ceil :function _trc_MathMod_ceil(f) {
      "use strict";
      var _this=this;
      
      return Math.ceil(f);
    },
    rndFloat :function _trc_MathMod_rndFloat(r,m) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=16001318;//kernel.MathMod:1318
      if (typeof  r!=="number") {
        //$LASTPOS=16001343;//kernel.MathMod:1343
        r=0;
      }
      //$LASTPOS=16001353;//kernel.MathMod:1353
      if (typeof  m!=="number") {
        //$LASTPOS=16001378;//kernel.MathMod:1378
        m=1;
      }
      //$LASTPOS=16001388;//kernel.MathMod:1388
      if (r<m) {
        return Math.random()*(m-r)+r;
        
      } else {
        return Math.random()*(r-m)+m;
        
      }
    },
    rnd :function _trc_MathMod_rnd(r,m) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=16001528;//kernel.MathMod:1528
      if (typeof  r=="number") {
        //$LASTPOS=16001563;//kernel.MathMod:1563
        if (typeof  m=="number") {
          //$LASTPOS=16001602;//kernel.MathMod:1602
          if (r<m) {
            return Math.floor(Math.random()*(m-r)+r);
            
          } else {
            return Math.floor(Math.random()*(r-m)+m);
            
          }
          
        } else {
          return Math.floor(Math.random()*(r>0?r:0));
          
        }
        
      }
      return Math.random();
    },
    parseFloat :function _trc_MathMod_parseFloat(s) {
      "use strict";
      var _this=this;
      
      return parseFloat(s);
    },
    clamp :function _trc_MathMod_clamp(v,min,max) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=16001979;//kernel.MathMod:1979
      if (min>max) {
        return _this.clamp(v,max,min);
      }
      return v<min?min:v>max?max:v;
    },
    clamped :function _trc_MathMod_clamped(v,min,max) {
      "use strict";
      var _this=this;
      
      return _this.clamp(v,min,max)-v;
    },
    min :function _trc_MathMod_min() {
      "use strict";
      var _this=this;
      
      return Math.min.apply(Math,arguments);
    },
    max :function _trc_MathMod_max() {
      "use strict";
      var _this=this;
      
      return Math.max.apply(Math,arguments);
    },
    amod :function _trc_MathMod_amod(v,d) {
      "use strict";
      var _this=this;
      
      return (v%d+d)%d;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"sin":{"nowait":true},"cos":{"nowait":true},"rad":{"nowait":true},"deg":{"nowait":true},"abs":{"nowait":true},"sgn":{"nowait":true},"atan2":{"nowait":true},"atanxy":{"nowait":true},"floor":{"nowait":true},"angleDiff":{"nowait":true},"sqrt":{"nowait":true},"dist":{"nowait":true},"trunc":{"nowait":true},"ceil":{"nowait":true},"rndFloat":{"nowait":true},"rnd":{"nowait":true},"parseFloat":{"nowait":true},"clamp":{"nowait":true},"clamped":{"nowait":true},"min":{"nowait":true},"max":{"nowait":true},"amod":{"nowait":true}},"fields":{"x":{},"y":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Navigator',
  shortName: 'Navigator',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_Navigator_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_Navigator_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    getUserAgent :function _trc_Navigator_getUserAgent() {
      "use strict";
      var _this=this;
      
      return navigator.userAgent;
    },
    fiber$getUserAgent :function _trc_Navigator_f_getUserAgent(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=navigator.userAgent;return;
      
      
      _thread.retVal=_this;return;
    },
    isTablet :function _trc_Navigator_isTablet() {
      "use strict";
      var _this=this;
      var u;
      
      //$LASTPOS=17000263;//kernel.Navigator:263
      u = _this.getUserAgent().toLowerCase();
      
      return ((u.indexOf("windows")!=- 1&&u.indexOf("touch")!=- 1&&u.indexOf("tablet pc")==- 1)||u.indexOf("ipad")!=- 1||(u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1&&u.indexOf("mobile")==- 1)||(u.indexOf("firefox")!=- 1&&u.indexOf("tablet")!=- 1)||u.indexOf("kindle")!=- 1||u.indexOf("silk")!=- 1||u.indexOf("playbook")!=- 1||u.indexOf('a1_07')!=- 1||u.indexOf('sc-01c')!=- 1);
    },
    fiber$isTablet :function _trc_Navigator_f_isTablet(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var u;
      
      //$LASTPOS=17000263;//kernel.Navigator:263
      u = _this.getUserAgent().toLowerCase();
      
      _thread.retVal=((u.indexOf("windows")!=- 1&&u.indexOf("touch")!=- 1&&u.indexOf("tablet pc")==- 1)||u.indexOf("ipad")!=- 1||(u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1&&u.indexOf("mobile")==- 1)||(u.indexOf("firefox")!=- 1&&u.indexOf("tablet")!=- 1)||u.indexOf("kindle")!=- 1||u.indexOf("silk")!=- 1||u.indexOf("playbook")!=- 1||u.indexOf('a1_07')!=- 1||u.indexOf('sc-01c')!=- 1);return;
      
      
      _thread.retVal=_this;return;
    },
    isMobile :function _trc_Navigator_isMobile() {
      "use strict";
      var _this=this;
      var u;
      
      //$LASTPOS=17000800;//kernel.Navigator:800
      u = _this.getUserAgent().toLowerCase();
      
      return ((u.indexOf("windows")!=- 1&&u.indexOf("phone")!=- 1)||u.indexOf("iphone")!=- 1||u.indexOf("ipod")!=- 1||(u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1&&u.indexOf("mobile")!=- 1)||(u.indexOf("firefox")!=- 1&&u.indexOf("mobile")!=- 1)||(u.indexOf("blackberry")!=- 1||(u.indexOf("bb10")!=- 1&&u.indexOf("mobile")!=- 1)));
    },
    fiber$isMobile :function _trc_Navigator_f_isMobile(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var u;
      
      //$LASTPOS=17000800;//kernel.Navigator:800
      u = _this.getUserAgent().toLowerCase();
      
      _thread.retVal=((u.indexOf("windows")!=- 1&&u.indexOf("phone")!=- 1)||u.indexOf("iphone")!=- 1||u.indexOf("ipod")!=- 1||(u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1&&u.indexOf("mobile")!=- 1)||(u.indexOf("firefox")!=- 1&&u.indexOf("mobile")!=- 1)||(u.indexOf("blackberry")!=- 1||(u.indexOf("bb10")!=- 1&&u.indexOf("mobile")!=- 1)));return;
      
      
      _thread.retVal=_this;return;
    },
    isWindows :function _trc_Navigator_isWindows() {
      "use strict";
      var _this=this;
      var u;
      
      //$LASTPOS=17001274;//kernel.Navigator:1274
      u = _this.getUserAgent().toLowerCase();
      
      return u.indexOf("windows")!=- 1;
    },
    fiber$isWindows :function _trc_Navigator_f_isWindows(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var u;
      
      //$LASTPOS=17001274;//kernel.Navigator:1274
      u = _this.getUserAgent().toLowerCase();
      
      _thread.retVal=u.indexOf("windows")!=- 1;return;
      
      
      _thread.retVal=_this;return;
    },
    isAndroid :function _trc_Navigator_isAndroid() {
      "use strict";
      var _this=this;
      var u;
      
      //$LASTPOS=17001378;//kernel.Navigator:1378
      u = _this.getUserAgent().toLowerCase();
      
      return (u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1);
    },
    fiber$isAndroid :function _trc_Navigator_f_isAndroid(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var u;
      
      //$LASTPOS=17001378;//kernel.Navigator:1378
      u = _this.getUserAgent().toLowerCase();
      
      _thread.retVal=(u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1);return;
      
      
      _thread.retVal=_this;return;
    },
    isIOS :function _trc_Navigator_isIOS() {
      "use strict";
      var _this=this;
      var u;
      
      //$LASTPOS=17001522;//kernel.Navigator:1522
      u = _this.getUserAgent().toLowerCase();
      
      return (u.indexOf("iphone")!=- 1||u.indexOf("ipad")!=- 1||u.indexOf("ipod")!=- 1);
    },
    fiber$isIOS :function _trc_Navigator_f_isIOS(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var u;
      
      //$LASTPOS=17001522;//kernel.Navigator:1522
      u = _this.getUserAgent().toLowerCase();
      
      _thread.retVal=(u.indexOf("iphone")!=- 1||u.indexOf("ipad")!=- 1||u.indexOf("ipod")!=- 1);return;
      
      
      _thread.retVal=_this;return;
    },
    isFirefoxOS :function _trc_Navigator_isFirefoxOS() {
      "use strict";
      var _this=this;
      var u;
      
      //$LASTPOS=17001705;//kernel.Navigator:1705
      u = _this.getUserAgent().toLowerCase();
      
      return u.indexOf("firefox")!=1;
    },
    fiber$isFirefoxOS :function _trc_Navigator_f_isFirefoxOS(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var u;
      
      //$LASTPOS=17001705;//kernel.Navigator:1705
      u = _this.getUserAgent().toLowerCase();
      
      _thread.retVal=u.indexOf("firefox")!=1;return;
      
      
      _thread.retVal=_this;return;
    },
    isKindle :function _trc_Navigator_isKindle() {
      "use strict";
      var _this=this;
      var u;
      
      //$LASTPOS=17001807;//kernel.Navigator:1807
      u = _this.getUserAgent().toLowerCase();
      
      return (u.indexOf("kindle")!=- 1||u.indexOf("silk")!=- 1);
    },
    fiber$isKindle :function _trc_Navigator_f_isKindle(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var u;
      
      //$LASTPOS=17001807;//kernel.Navigator:1807
      u = _this.getUserAgent().toLowerCase();
      
      _thread.retVal=(u.indexOf("kindle")!=- 1||u.indexOf("silk")!=- 1);return;
      
      
      _thread.retVal=_this;return;
    },
    isBlackBerry :function _trc_Navigator_isBlackBerry() {
      "use strict";
      var _this=this;
      var u;
      
      //$LASTPOS=17001959;//kernel.Navigator:1959
      u = _this.getUserAgent().toLowerCase();
      
      return (u.indexOf("blackberry")!=- 1||u.indexOf("playbook")!=- 1||(u.indexOf("bb10")!=- 1&&u.indexOf("mobile")!=- 1));
    },
    fiber$isBlackBerry :function _trc_Navigator_f_isBlackBerry(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var u;
      
      //$LASTPOS=17001959;//kernel.Navigator:1959
      u = _this.getUserAgent().toLowerCase();
      
      _thread.retVal=(u.indexOf("blackberry")!=- 1||u.indexOf("playbook")!=- 1||(u.indexOf("bb10")!=- 1&&u.indexOf("mobile")!=- 1));return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"getUserAgent":{"nowait":false},"isTablet":{"nowait":false},"isMobile":{"nowait":false},"isWindows":{"nowait":false},"isAndroid":{"nowait":false},"isIOS":{"nowait":false},"isFirefoxOS":{"nowait":false},"isKindle":{"nowait":false},"isBlackBerry":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.ObjectPool',
  shortName: 'ObjectPool',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_ObjectPool_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_ObjectPool_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    pool :function _trc_ObjectPool_pool(key,o) {
      "use strict";
      var _this=this;
      var list;
      
      //$LASTPOS=18000091;//kernel.ObjectPool:91
      list = _this.poolList(key);
      
      //$LASTPOS=18000117;//kernel.ObjectPool:117
      o.objectPoolAge=(o.objectPoolAge||0)+1;
      //$LASTPOS=18000159;//kernel.ObjectPool:159
      list.push(o);
    },
    fiber$pool :function _trc_ObjectPool_f_pool(_thread,key,o) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var list;
      
      
      _thread.enter(function _trc_ObjectPool_ent_pool(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=18000091;//kernel.ObjectPool:91
            _this.fiber$poolList(_thread, key);
            __pc=1;return;
          case 1:
            list=_thread.retVal;
            
            //$LASTPOS=18000117;//kernel.ObjectPool:117
            o.objectPoolAge=(o.objectPoolAge||0)+1;
            //$LASTPOS=18000159;//kernel.ObjectPool:159
            list.push(o);
            _thread.exit(_this);return;
          }
        }
      });
    },
    withdraw :function _trc_ObjectPool_withdraw(key) {
      "use strict";
      var _this=this;
      var list;
      
      //$LASTPOS=18000196;//kernel.ObjectPool:196
      list = _this.poolList(key);
      
      return list.shift();
    },
    fiber$withdraw :function _trc_ObjectPool_f_withdraw(_thread,key) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var list;
      
      
      _thread.enter(function _trc_ObjectPool_ent_withdraw(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=18000196;//kernel.ObjectPool:196
            _this.fiber$poolList(_thread, key);
            __pc=1;return;
          case 1:
            list=_thread.retVal;
            
            _thread.exit(list.shift());return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    poolList :function _trc_ObjectPool_poolList(key) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=18000266;//kernel.ObjectPool:266
      _this.lists=_this.lists||{};
      return _this.lists[key]=_this.lists[key]||[];
    },
    fiber$poolList :function _trc_ObjectPool_f_poolList(_thread,key) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=18000266;//kernel.ObjectPool:266
      _this.lists=_this.lists||{};
      _thread.retVal=_this.lists[key]=_this.lists[key]||[];return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"pool":{"nowait":false},"withdraw":{"nowait":false},"poolList":{"nowait":false}},"fields":{"lists":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TObject',
  shortName: 'TObject',
  namespace: 'kernel',
  includes: [],
  methods: {
    main :function _trc_TObject_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_TObject_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_TObject_initialize(options) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=19000052;//kernel.TObject:52
      if (typeof  options=="object") {
        //$LASTPOS=19000082;//kernel.TObject:82
        _this.extend(options);
      }
      //$LASTPOS=19000104;//kernel.TObject:104
      if (Tonyu.runMode) {
        //$LASTPOS=19000123;//kernel.TObject:123
        _this.main();
      }
    },
    extend :function _trc_TObject_extend(obj) {
      "use strict";
      var _this=this;
      
      return Tonyu.extend(_this,obj);
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"extend":{"nowait":true}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.TQuery',
  shortName: 'TQuery',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_TQuery_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_TQuery_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_TQuery_initialize(context) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=20000059;//kernel.TQuery:59
      _this.length=0;
      //$LASTPOS=20000074;//kernel.TQuery:74
      if (context instanceof Tonyu.classes.kernel.BaseActor) {
        //$LASTPOS=20000100;//kernel.TQuery:100
        context={actor: context};
      }
      //$LASTPOS=20000130;//kernel.TQuery:130
      if (context instanceof Tonyu.classes.kernel.Screen) {
        //$LASTPOS=20000153;//kernel.TQuery:153
        context={screen: context};
      }
      //$LASTPOS=20000184;//kernel.TQuery:184
      context=context||{};
      //$LASTPOS=20000210;//kernel.TQuery:210
      context.is3D=(context.actor instanceof Tonyu.classes.kernel.Actor3D);
      //$LASTPOS=20000256;//kernel.TQuery:256
      context.screen=context.screen||Tonyu.globals.$Screen;
      //$LASTPOS=20000301;//kernel.TQuery:301
      _this.context=context;
    },
    __getter__parent :function _trc_TQuery___getter__parent() {
      "use strict";
      var _this=this;
      
      return _this.context.actor;
    },
    create :function _trc_TQuery_create() {
      "use strict";
      var _this=this;
      
      return new Tonyu.classes.kernel.TQuery(_this.context);
    },
    fiber$create :function _trc_TQuery_f_create(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=new Tonyu.classes.kernel.TQuery(_this.context);return;
      
      
      _thread.retVal=_this;return;
    },
    contains :function _trc_TQuery_contains(t) {
      "use strict";
      var _this=this;
      var o;
      var _it_100;
      
      //$LASTPOS=20000437;//kernel.TQuery:437
      _it_100=Tonyu.iterator(_this,1);
      while(_it_100.next()) {
        o=_it_100[0];
        
        //$LASTPOS=20000468;//kernel.TQuery:468
        if (o===t) {
          return true;
        }
        
      }
      return false;
    },
    fiber$contains :function _trc_TQuery_f_contains(_thread,t) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var o;
      var _it_100;
      
      //$LASTPOS=20000437;//kernel.TQuery:437
      _it_100=Tonyu.iterator(_this,1);
      while(_it_100.next()) {
        o=_it_100[0];
        
        //$LASTPOS=20000468;//kernel.TQuery:468
        if (o===t) {
          _thread.retVal=true;return;
          
        }
        
      }
      _thread.retVal=false;return;
      
      
      _thread.retVal=_this;return;
    },
    tonyuIterator :function _trc_TQuery_tonyuIterator(arity) {
      "use strict";
      var _this=this;
      var res;
      
      //$LASTPOS=20000551;//kernel.TQuery:551
      res = {};
      
      //$LASTPOS=20000568;//kernel.TQuery:568
      res.i=0;
      //$LASTPOS=20000582;//kernel.TQuery:582
      if (arity==1) {
        //$LASTPOS=20000607;//kernel.TQuery:607
        res.next=(function anonymous_616() {
          
          //$LASTPOS=20000643;//kernel.TQuery:643
          if (res.i>=_this.length) {
            return false;
          }
          //$LASTPOS=20000694;//kernel.TQuery:694
          res[0]=_this[res.i];
          //$LASTPOS=20000727;//kernel.TQuery:727
          res.i++;
          return true;
        });
        
      } else {
        //$LASTPOS=20000797;//kernel.TQuery:797
        res.next=(function anonymous_806() {
          
          //$LASTPOS=20000833;//kernel.TQuery:833
          if (res.i>=_this.length) {
            return false;
          }
          //$LASTPOS=20000884;//kernel.TQuery:884
          res[0]=res.i;
          //$LASTPOS=20000911;//kernel.TQuery:911
          res[1]=_this[res.i];
          //$LASTPOS=20000944;//kernel.TQuery:944
          res.i++;
          return true;
        });
        
      }
      return res;
    },
    fiber$tonyuIterator :function _trc_TQuery_f_tonyuIterator(_thread,arity) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      
      //$LASTPOS=20000551;//kernel.TQuery:551
      res = {};
      
      //$LASTPOS=20000568;//kernel.TQuery:568
      res.i=0;
      //$LASTPOS=20000582;//kernel.TQuery:582
      if (arity==1) {
        //$LASTPOS=20000607;//kernel.TQuery:607
        res.next=(function anonymous_616() {
          
          //$LASTPOS=20000643;//kernel.TQuery:643
          if (res.i>=_this.length) {
            return false;
          }
          //$LASTPOS=20000694;//kernel.TQuery:694
          res[0]=_this[res.i];
          //$LASTPOS=20000727;//kernel.TQuery:727
          res.i++;
          return true;
        });
        
      } else {
        //$LASTPOS=20000797;//kernel.TQuery:797
        res.next=(function anonymous_806() {
          
          //$LASTPOS=20000833;//kernel.TQuery:833
          if (res.i>=_this.length) {
            return false;
          }
          //$LASTPOS=20000884;//kernel.TQuery:884
          res[0]=res.i;
          //$LASTPOS=20000911;//kernel.TQuery:911
          res[1]=_this[res.i];
          //$LASTPOS=20000944;//kernel.TQuery:944
          res.i++;
          return true;
        });
        
      }
      _thread.retVal=res;return;
      
      
      _thread.retVal=_this;return;
    },
    attr :function _trc_TQuery_attr() {
      "use strict";
      var _this=this;
      var values;
      var i;
      var e;
      var _it_104;
      
      
      //$LASTPOS=20001051;//kernel.TQuery:1051
      if (_this.length==0) {
        return _this;
      }
      //$LASTPOS=20001079;//kernel.TQuery:1079
      if (arguments.length==1&&typeof  arguments[0]=="string") {
        return _this[0][arguments[0]];
        
      }
      //$LASTPOS=20001190;//kernel.TQuery:1190
      if (arguments.length>=2) {
        //$LASTPOS=20001226;//kernel.TQuery:1226
        values={};
        //$LASTPOS=20001246;//kernel.TQuery:1246
        //$LASTPOS=20001251;//kernel.TQuery:1251
        i = 0;
        for (; i<arguments.length-1 ; i+=2) {
          {
            //$LASTPOS=20001304;//kernel.TQuery:1304
            values[arguments[i]]=arguments[i+1];
          }
        }
        
      } else {
        //$LASTPOS=20001375;//kernel.TQuery:1375
        values=arguments[0];
        
      }
      //$LASTPOS=20001408;//kernel.TQuery:1408
      if (values) {
        //$LASTPOS=20001431;//kernel.TQuery:1431
        _it_104=Tonyu.iterator(_this,1);
        while(_it_104.next()) {
          e=_it_104[0];
          
          //$LASTPOS=20001466;//kernel.TQuery:1466
          e.extend(values);
          
        }
        
      }
    },
    fiber$attr :function _trc_TQuery_f_attr(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var values;
      var i;
      var e;
      var _it_104;
      
      
      //$LASTPOS=20001051;//kernel.TQuery:1051
      if (_this.length==0) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=20001079;//kernel.TQuery:1079
      if (_arguments.length==1&&typeof  _arguments[0]=="string") {
        _thread.retVal=_this[0][_arguments[0]];return;
        
        
      }
      //$LASTPOS=20001190;//kernel.TQuery:1190
      if (_arguments.length>=2) {
        //$LASTPOS=20001226;//kernel.TQuery:1226
        values={};
        //$LASTPOS=20001246;//kernel.TQuery:1246
        //$LASTPOS=20001251;//kernel.TQuery:1251
        i = 0;
        for (; i<_arguments.length-1 ; i+=2) {
          {
            //$LASTPOS=20001304;//kernel.TQuery:1304
            values[_arguments[i]]=_arguments[i+1];
          }
        }
        
      } else {
        //$LASTPOS=20001375;//kernel.TQuery:1375
        values=_arguments[0];
        
      }
      //$LASTPOS=20001408;//kernel.TQuery:1408
      if (values) {
        //$LASTPOS=20001431;//kernel.TQuery:1431
        _it_104=Tonyu.iterator(_this,1);
        while(_it_104.next()) {
          e=_it_104[0];
          
          //$LASTPOS=20001466;//kernel.TQuery:1466
          e.extend(values);
          
        }
        
      }
      
      _thread.retVal=_this;return;
    },
    genKeyfunc :function _trc_TQuery_genKeyfunc(key) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=20001531;//kernel.TQuery:1531
      if (typeof  key!="function") {
        return (function anonymous_1577(o) {
          
          return o[key];
        });
        
      } else {
        return key;
        
      }
    },
    fiber$genKeyfunc :function _trc_TQuery_f_genKeyfunc(_thread,key) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=20001531;//kernel.TQuery:1531
      if (typeof  key!="function") {
        _thread.retVal=(function anonymous_1577(o) {
          
          return o[key];
        });return;
        
        
      } else {
        _thread.retVal=key;return;
        
        
      }
      
      _thread.retVal=_this;return;
    },
    applyArrayMethod :function _trc_TQuery_applyArrayMethod(name,args) {
      "use strict";
      var _this=this;
      var res;
      var a;
      var r;
      
      //$LASTPOS=20001682;//kernel.TQuery:1682
      res = _this.create();
      
      //$LASTPOS=20001705;//kernel.TQuery:1705
      a = _this.toArray();
      
      //$LASTPOS=20001727;//kernel.TQuery:1727
      r = a[name].apply(a,args);
      
      //$LASTPOS=20001761;//kernel.TQuery:1761
      res.push(r);
      return res;
    },
    fiber$applyArrayMethod :function _trc_TQuery_f_applyArrayMethod(_thread,name,args) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var a;
      var r;
      
      
      _thread.enter(function _trc_TQuery_ent_applyArrayMethod(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=20001682;//kernel.TQuery:1682
            _this.fiber$create(_thread);
            __pc=1;return;
          case 1:
            res=_thread.retVal;
            
            //$LASTPOS=20001705;//kernel.TQuery:1705
            _this.fiber$toArray(_thread);
            __pc=2;return;
          case 2:
            a=_thread.retVal;
            
            //$LASTPOS=20001727;//kernel.TQuery:1727
            r = a[name].apply(a,args);
            
            //$LASTPOS=20001761;//kernel.TQuery:1761
            res.push(r);
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    toArray :function _trc_TQuery_toArray() {
      "use strict";
      var _this=this;
      var res;
      var i;
      
      //$LASTPOS=20001813;//kernel.TQuery:1813
      res = [];
      
      //$LASTPOS=20001830;//kernel.TQuery:1830
      //$LASTPOS=20001834;//kernel.TQuery:1834
      i = 0;
      for (; i<_this.length ; i++) {
        //$LASTPOS=20001856;//kernel.TQuery:1856
        res.push(_this[i]);
      }
      return res;
    },
    fiber$toArray :function _trc_TQuery_f_toArray(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var i;
      
      //$LASTPOS=20001813;//kernel.TQuery:1813
      res = [];
      
      //$LASTPOS=20001830;//kernel.TQuery:1830
      //$LASTPOS=20001834;//kernel.TQuery:1834
      i = 0;
      for (; i<_this.length ; i++) {
        //$LASTPOS=20001856;//kernel.TQuery:1856
        res.push(_this[i]);
      }
      _thread.retVal=res;return;
      
      
      _thread.retVal=_this;return;
    },
    sort :function _trc_TQuery_sort() {
      "use strict";
      var _this=this;
      
      return _this.applyArrayMethod("sort",arguments);
    },
    fiber$sort :function _trc_TQuery_f_sort(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_TQuery_ent_sort(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$applyArrayMethod(_thread, "sort", _arguments);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    slice :function _trc_TQuery_slice() {
      "use strict";
      var _this=this;
      
      return _this.applyArrayMethod("slice",arguments);
    },
    fiber$slice :function _trc_TQuery_f_slice(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_TQuery_ent_slice(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$applyArrayMethod(_thread, "slice", _arguments);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    maxs :function _trc_TQuery_maxs(key) {
      "use strict";
      var _this=this;
      var f;
      var res;
      var reso;
      var o;
      var _it_115;
      var v;
      
      //$LASTPOS=20002040;//kernel.TQuery:2040
      f = _this.genKeyfunc(key);
      
      //$LASTPOS=20002068;//kernel.TQuery:2068
      reso = _this.create();
      
      //$LASTPOS=20002096;//kernel.TQuery:2096
      _it_115=Tonyu.iterator(_this,1);
      while(_it_115.next()) {
        o=_it_115[0];
        
        //$LASTPOS=20002127;//kernel.TQuery:2127
        v = f(o);
        
        //$LASTPOS=20002148;//kernel.TQuery:2148
        if (res==null||v>=res) {
          //$LASTPOS=20002188;//kernel.TQuery:2188
          if (v>res) {
            //$LASTPOS=20002199;//kernel.TQuery:2199
            reso=_this.create();
          }
          //$LASTPOS=20002227;//kernel.TQuery:2227
          reso.push(o);
          //$LASTPOS=20002254;//kernel.TQuery:2254
          res=v;
          
        }
        
      }
      return reso;
    },
    fiber$maxs :function _trc_TQuery_f_maxs(_thread,key) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var f;
      var res;
      var reso;
      var o;
      var _it_115;
      var v;
      
      
      _thread.enter(function _trc_TQuery_ent_maxs(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=20002040;//kernel.TQuery:2040
            _this.fiber$genKeyfunc(_thread, key);
            __pc=1;return;
          case 1:
            f=_thread.retVal;
            
            //$LASTPOS=20002068;//kernel.TQuery:2068
            _this.fiber$create(_thread);
            __pc=2;return;
          case 2:
            reso=_thread.retVal;
            
            //$LASTPOS=20002096;//kernel.TQuery:2096
            _it_115=Tonyu.iterator(_this,1);
          case 3:
            if (!(_it_115.next())) { __pc=7     ; break; }
            o=_it_115[0];
            
            //$LASTPOS=20002127;//kernel.TQuery:2127
            v = f(o);
            
            //$LASTPOS=20002148;//kernel.TQuery:2148
            if (!(res==null||v>=res)) { __pc=6     ; break; }
            //$LASTPOS=20002188;//kernel.TQuery:2188
            if (!(v>res)) { __pc=5     ; break; }
            //$LASTPOS=20002199;//kernel.TQuery:2199
            _this.fiber$create(_thread);
            __pc=4;return;
          case 4:
            reso=_thread.retVal;
            
          case 5     :
            
            //$LASTPOS=20002227;//kernel.TQuery:2227
            reso.push(o);
            //$LASTPOS=20002254;//kernel.TQuery:2254
            res=v;
          case 6     :
            
            __pc=3;break;
          case 7     :
            
            _thread.exit(reso);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    mins :function _trc_TQuery_mins(key) {
      "use strict";
      var _this=this;
      var f;
      var res;
      var reso;
      var o;
      var _it_122;
      var v;
      
      //$LASTPOS=20002319;//kernel.TQuery:2319
      f = _this.genKeyfunc(key);
      
      //$LASTPOS=20002347;//kernel.TQuery:2347
      reso = _this.create();
      
      //$LASTPOS=20002375;//kernel.TQuery:2375
      _it_122=Tonyu.iterator(_this,1);
      while(_it_122.next()) {
        o=_it_122[0];
        
        //$LASTPOS=20002406;//kernel.TQuery:2406
        v = f(o);
        
        //$LASTPOS=20002427;//kernel.TQuery:2427
        if (res==null||v<=res) {
          //$LASTPOS=20002467;//kernel.TQuery:2467
          if (v<res) {
            //$LASTPOS=20002478;//kernel.TQuery:2478
            reso=_this.create();
          }
          //$LASTPOS=20002506;//kernel.TQuery:2506
          reso.push(o);
          //$LASTPOS=20002533;//kernel.TQuery:2533
          res=v;
          
        }
        
      }
      return reso;
    },
    fiber$mins :function _trc_TQuery_f_mins(_thread,key) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var f;
      var res;
      var reso;
      var o;
      var _it_122;
      var v;
      
      
      _thread.enter(function _trc_TQuery_ent_mins(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=20002319;//kernel.TQuery:2319
            _this.fiber$genKeyfunc(_thread, key);
            __pc=1;return;
          case 1:
            f=_thread.retVal;
            
            //$LASTPOS=20002347;//kernel.TQuery:2347
            _this.fiber$create(_thread);
            __pc=2;return;
          case 2:
            reso=_thread.retVal;
            
            //$LASTPOS=20002375;//kernel.TQuery:2375
            _it_122=Tonyu.iterator(_this,1);
          case 3:
            if (!(_it_122.next())) { __pc=7     ; break; }
            o=_it_122[0];
            
            //$LASTPOS=20002406;//kernel.TQuery:2406
            v = f(o);
            
            //$LASTPOS=20002427;//kernel.TQuery:2427
            if (!(res==null||v<=res)) { __pc=6     ; break; }
            //$LASTPOS=20002467;//kernel.TQuery:2467
            if (!(v<res)) { __pc=5     ; break; }
            //$LASTPOS=20002478;//kernel.TQuery:2478
            _this.fiber$create(_thread);
            __pc=4;return;
          case 4:
            reso=_thread.retVal;
            
          case 5     :
            
            //$LASTPOS=20002506;//kernel.TQuery:2506
            reso.push(o);
            //$LASTPOS=20002533;//kernel.TQuery:2533
            res=v;
          case 6     :
            
            __pc=3;break;
          case 7     :
            
            _thread.exit(reso);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    minObj :function _trc_TQuery_minObj(key) {
      "use strict";
      var _this=this;
      
      return _this.mins(key)[0];
    },
    fiber$minObj :function _trc_TQuery_f_minObj(_thread,key) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.mins(key)[0];return;
      
      
      _thread.retVal=_this;return;
    },
    maxObj :function _trc_TQuery_maxObj(key) {
      "use strict";
      var _this=this;
      
      return _this.maxs(key)[0];
    },
    fiber$maxObj :function _trc_TQuery_f_maxObj(_thread,key) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.maxs(key)[0];return;
      
      
      _thread.retVal=_this;return;
    },
    nearests :function _trc_TQuery_nearests(x,y) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=20002692;//kernel.TQuery:2692
      if (x==null) {
        //$LASTPOS=20002716;//kernel.TQuery:2716
        if (! _this.parent) {
          throw new Error("nearests: 座標を指定してください");
          
        }
        //$LASTPOS=20002780;//kernel.TQuery:2780
        x=_this.parent.x;
        //$LASTPOS=20002791;//kernel.TQuery:2791
        y=_this.parent.y;
        //$LASTPOS=20002812;//kernel.TQuery:2812
        if (_this.context.is3D) {
          //$LASTPOS=20002830;//kernel.TQuery:2830
          _this.z=_this.parent.z;
        }
        
      }
      //$LASTPOS=20002854;//kernel.TQuery:2854
      if (typeof  x=="object") {
        //$LASTPOS=20002879;//kernel.TQuery:2879
        y=x.y;
        //$LASTPOS=20002885;//kernel.TQuery:2885
        x=x.x;
        
      }
      //$LASTPOS=20002898;//kernel.TQuery:2898
      if (_this.context.is3D) {
        return _this.mins((function anonymous_2939(o) {
          
          return _this.context.actor.dist(o);
        }));
        
      }
      return _this.mins((function anonymous_3029(o) {
        
        return _this.dist(o.x-x,o.y-y);
      }));
    },
    fiber$nearests :function _trc_TQuery_f_nearests(_thread,x,y) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=20002692;//kernel.TQuery:2692
      if (x==null) {
        //$LASTPOS=20002716;//kernel.TQuery:2716
        if (! _this.parent) {
          throw new Error("nearests: 座標を指定してください");
          
        }
        //$LASTPOS=20002780;//kernel.TQuery:2780
        x=_this.parent.x;
        //$LASTPOS=20002791;//kernel.TQuery:2791
        y=_this.parent.y;
        //$LASTPOS=20002812;//kernel.TQuery:2812
        if (_this.context.is3D) {
          //$LASTPOS=20002830;//kernel.TQuery:2830
          _this.z=_this.parent.z;
        }
        
      }
      //$LASTPOS=20002854;//kernel.TQuery:2854
      if (typeof  x=="object") {
        //$LASTPOS=20002879;//kernel.TQuery:2879
        y=x.y;
        //$LASTPOS=20002885;//kernel.TQuery:2885
        x=x.x;
        
      }
      
      _thread.enter(function _trc_TQuery_ent_nearests(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=20002898;//kernel.TQuery:2898
            if (!(_this.context.is3D)) { __pc=2     ; break; }
            _this.fiber$mins(_thread, (function anonymous_2939(o) {
              
              return _this.context.actor.dist(o);
            }));
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
          case 2     :
            
            _this.fiber$mins(_thread, (function anonymous_3029(o) {
              
              return _this.dist(o.x-x,o.y-y);
            }));
            __pc=3;return;
          case 3:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    nearest :function _trc_TQuery_nearest(x,y) {
      "use strict";
      var _this=this;
      
      return _this.nearests(x,y)[0];
    },
    fiber$nearest :function _trc_TQuery_f_nearest(_thread,x,y) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.nearests(x,y)[0];return;
      
      
      _thread.retVal=_this;return;
    },
    withins :function _trc_TQuery_withins(xo,yd,d) {
      "use strict";
      var _this=this;
      var x;
      var y;
      var z;
      
      
      //$LASTPOS=20003174;//kernel.TQuery:3174
      if (arguments.length==1) {
        //$LASTPOS=20003210;//kernel.TQuery:3210
        if (! _this.parent) {
          throw new Error("withins: 座標を指定してください");
          
        }
        //$LASTPOS=20003273;//kernel.TQuery:3273
        x=_this.parent.x;
        //$LASTPOS=20003294;//kernel.TQuery:3294
        y=_this.parent.y;
        //$LASTPOS=20003315;//kernel.TQuery:3315
        if (_this.context.is3D) {
          //$LASTPOS=20003333;//kernel.TQuery:3333
          z=_this.parent.z;
        }
        //$LASTPOS=20003354;//kernel.TQuery:3354
        d=xo;
        
      } else {
        //$LASTPOS=20003372;//kernel.TQuery:3372
        if (typeof  xo=="object") {
          //$LASTPOS=20003408;//kernel.TQuery:3408
          x=xo.x;
          //$LASTPOS=20003415;//kernel.TQuery:3415
          y=xo.y;
          //$LASTPOS=20003422;//kernel.TQuery:3422
          d=yd;
          
        } else {
          //$LASTPOS=20003451;//kernel.TQuery:3451
          x=xo;
          //$LASTPOS=20003456;//kernel.TQuery:3456
          y=yd;
          
        }
      }
      //$LASTPOS=20003474;//kernel.TQuery:3474
      if (_this.context.is3D) {
        return _this.find((function anonymous_3515(o) {
          
          return _this.context.actor.dist(o)<=d;
        }));
        
      }
      return _this.find((function anonymous_3608(o) {
        
        return _this.dist(o.x-x,o.y-y)<=d;
      }));
    },
    fiber$withins :function _trc_TQuery_f_withins(_thread,xo,yd,d) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var x;
      var y;
      var z;
      
      
      //$LASTPOS=20003174;//kernel.TQuery:3174
      if (_arguments.length==1) {
        //$LASTPOS=20003210;//kernel.TQuery:3210
        if (! _this.parent) {
          throw new Error("withins: 座標を指定してください");
          
        }
        //$LASTPOS=20003273;//kernel.TQuery:3273
        x=_this.parent.x;
        //$LASTPOS=20003294;//kernel.TQuery:3294
        y=_this.parent.y;
        //$LASTPOS=20003315;//kernel.TQuery:3315
        if (_this.context.is3D) {
          //$LASTPOS=20003333;//kernel.TQuery:3333
          z=_this.parent.z;
        }
        //$LASTPOS=20003354;//kernel.TQuery:3354
        d=xo;
        
      } else {
        //$LASTPOS=20003372;//kernel.TQuery:3372
        if (typeof  xo=="object") {
          //$LASTPOS=20003408;//kernel.TQuery:3408
          x=xo.x;
          //$LASTPOS=20003415;//kernel.TQuery:3415
          y=xo.y;
          //$LASTPOS=20003422;//kernel.TQuery:3422
          d=yd;
          
        } else {
          //$LASTPOS=20003451;//kernel.TQuery:3451
          x=xo;
          //$LASTPOS=20003456;//kernel.TQuery:3456
          y=yd;
          
        }
      }
      
      _thread.enter(function _trc_TQuery_ent_withins(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=20003474;//kernel.TQuery:3474
            if (!(_this.context.is3D)) { __pc=2     ; break; }
            _this.fiber$find(_thread, (function anonymous_3515(o) {
              
              return _this.context.actor.dist(o)<=d;
            }));
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
          case 2     :
            
            _this.fiber$find(_thread, (function anonymous_3608(o) {
              
              return _this.dist(o.x-x,o.y-y)<=d;
            }));
            __pc=3;return;
          case 3:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    within :function _trc_TQuery_within(xo,yd,d) {
      "use strict";
      var _this=this;
      
      return _this.withins(xo,yd,d).nearest();
    },
    fiber$within :function _trc_TQuery_f_within(_thread,xo,yd,d) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.withins(xo,yd,d).nearest();return;
      
      
      _thread.retVal=_this;return;
    },
    max :function _trc_TQuery_max(key) {
      "use strict";
      var _this=this;
      var f;
      var res;
      var o;
      var _it_136;
      var v;
      
      //$LASTPOS=20003751;//kernel.TQuery:3751
      f = _this.genKeyfunc(key);
      
      
      //$LASTPOS=20003793;//kernel.TQuery:3793
      _it_136=Tonyu.iterator(_this,1);
      while(_it_136.next()) {
        o=_it_136[0];
        
        //$LASTPOS=20003824;//kernel.TQuery:3824
        v = f(o);
        
        //$LASTPOS=20003845;//kernel.TQuery:3845
        if (res==null||v>res) {
          //$LASTPOS=20003869;//kernel.TQuery:3869
          res=v;
        }
        
      }
      return res;
    },
    min :function _trc_TQuery_min(key) {
      "use strict";
      var _this=this;
      var f;
      var res;
      var o;
      var _it_142;
      var v;
      
      //$LASTPOS=20003921;//kernel.TQuery:3921
      f = _this.genKeyfunc(key);
      
      
      //$LASTPOS=20003963;//kernel.TQuery:3963
      _it_142=Tonyu.iterator(_this,1);
      while(_it_142.next()) {
        o=_it_142[0];
        
        //$LASTPOS=20003994;//kernel.TQuery:3994
        v = f(o);
        
        //$LASTPOS=20004015;//kernel.TQuery:4015
        if (res==null||v<res) {
          //$LASTPOS=20004039;//kernel.TQuery:4039
          res=v;
        }
        
      }
      return res;
    },
    push :function _trc_TQuery_push(e) {
      "use strict";
      var _this=this;
      var ee;
      var _it_148;
      
      //$LASTPOS=20004090;//kernel.TQuery:4090
      if (e instanceof Tonyu.classes.kernel.TQuery||e instanceof Array) {
        //$LASTPOS=20004132;//kernel.TQuery:4132
        _it_148=Tonyu.iterator(e,1);
        while(_it_148.next()) {
          ee=_it_148[0];
          
          //$LASTPOS=20004150;//kernel.TQuery:4150
          _this.push(ee);
        }
        
      } else {
        //$LASTPOS=20004183;//kernel.TQuery:4183
        _this[_this.length]=e;
        //$LASTPOS=20004208;//kernel.TQuery:4208
        _this.length++;
        
      }
    },
    fiber$push :function _trc_TQuery_f_push(_thread,e) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ee;
      var _it_148;
      
      
      _thread.enter(function _trc_TQuery_ent_push(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=20004090;//kernel.TQuery:4090
            if (!(e instanceof Tonyu.classes.kernel.TQuery||e instanceof Array)) { __pc=4     ; break; }
            //$LASTPOS=20004132;//kernel.TQuery:4132
            _it_148=Tonyu.iterator(e,1);
          case 1:
            if (!(_it_148.next())) { __pc=3     ; break; }
            ee=_it_148[0];
            
            //$LASTPOS=20004150;//kernel.TQuery:4150
            _this.fiber$push(_thread, ee);
            __pc=2;return;
          case 2:
            
            __pc=1;break;
          case 3     :
            
            __pc=5     ;break;
          case 4     :
            {
              //$LASTPOS=20004183;//kernel.TQuery:4183
              _this[_this.length]=e;
              //$LASTPOS=20004208;//kernel.TQuery:4208
              _this.length++;
            }
          case 5     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    size :function _trc_TQuery_size() {
      "use strict";
      var _this=this;
      
      return _this.length;
    },
    fiber$size :function _trc_TQuery_f_size(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.length;return;
      
      
      _thread.retVal=_this;return;
    },
    find :function _trc_TQuery_find(f) {
      "use strict";
      var _this=this;
      var no;
      var q;
      var o;
      var _it_151;
      
      //$LASTPOS=20004271;//kernel.TQuery:4271
      no = _this.create();
      
      //$LASTPOS=20004293;//kernel.TQuery:4293
      if (typeof  f==="object") {
        //$LASTPOS=20004329;//kernel.TQuery:4329
        q = f;
        
        //$LASTPOS=20004347;//kernel.TQuery:4347
        f=(function anonymous_4349(o) {
          var k;
          var v;
          var _it_157;
          
          //$LASTPOS=20004369;//kernel.TQuery:4369
          _it_157=Tonyu.iterator(q,2);
          while(_it_157.next()) {
            k=_it_157[0];
            v=_it_157[1];
            
            //$LASTPOS=20004407;//kernel.TQuery:4407
            if (o[k]!==v) {
              return false;
            }
            
          }
          return true;
        });
        
      }
      //$LASTPOS=20004500;//kernel.TQuery:4500
      _it_151=Tonyu.iterator(_this,1);
      while(_it_151.next()) {
        o=_it_151[0];
        
        //$LASTPOS=20004531;//kernel.TQuery:4531
        if (f(o)) {
          //$LASTPOS=20004541;//kernel.TQuery:4541
          no.push(o);
        }
        
      }
      return no;
    },
    fiber$find :function _trc_TQuery_f_find(_thread,f) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var no;
      var q;
      var o;
      var _it_151;
      
      
      _thread.enter(function _trc_TQuery_ent_find(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=20004271;//kernel.TQuery:4271
            _this.fiber$create(_thread);
            __pc=1;return;
          case 1:
            no=_thread.retVal;
            
            //$LASTPOS=20004293;//kernel.TQuery:4293
            if (!(typeof  f==="object")) { __pc=2     ; break; }
            //$LASTPOS=20004329;//kernel.TQuery:4329
            q = f;
            
            //$LASTPOS=20004347;//kernel.TQuery:4347
            f=(function anonymous_4349(o) {
              var k;
              var v;
              var _it_157;
              
              //$LASTPOS=20004369;//kernel.TQuery:4369
              _it_157=Tonyu.iterator(q,2);
              while(_it_157.next()) {
                k=_it_157[0];
                v=_it_157[1];
                
                //$LASTPOS=20004407;//kernel.TQuery:4407
                if (o[k]!==v) {
                  return false;
                }
                
              }
              return true;
            });
          case 2     :
            
            //$LASTPOS=20004500;//kernel.TQuery:4500
            _it_151=Tonyu.iterator(_this,1);
            while(_it_151.next()) {
              o=_it_151[0];
              
              //$LASTPOS=20004531;//kernel.TQuery:4531
              if (f(o)) {
                //$LASTPOS=20004541;//kernel.TQuery:4541
                no.push(o);
              }
              
            }
            _thread.exit(no);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    find1 :function _trc_TQuery_find1(f) {
      "use strict";
      var _this=this;
      
      return _this.find(f)[0];
    },
    fiber$find1 :function _trc_TQuery_f_find1(_thread,f) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.find(f)[0];return;
      
      
      _thread.retVal=_this;return;
    },
    random :function _trc_TQuery_random() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=20004637;//kernel.TQuery:4637
      if (_this.length===0) {
        return null;
      }
      return _this[_this.rnd(_this.length)];
    },
    fiber$random :function _trc_TQuery_f_random(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=20004637;//kernel.TQuery:4637
      if (_this.length===0) {
        _thread.retVal=null;return;
        
      }
      _thread.retVal=_this[_this.rnd(_this.length)];return;
      
      
      _thread.retVal=_this;return;
    },
    apply :function _trc_TQuery_apply(name,args) {
      "use strict";
      var _this=this;
      var res;
      var o;
      var _it_161;
      var f;
      
      
      //$LASTPOS=20004741;//kernel.TQuery:4741
      if (! args) {
        //$LASTPOS=20004752;//kernel.TQuery:4752
        args=[];
      }
      //$LASTPOS=20004766;//kernel.TQuery:4766
      _it_161=Tonyu.iterator(_this,1);
      while(_it_161.next()) {
        o=_it_161[0];
        
        //$LASTPOS=20004797;//kernel.TQuery:4797
        f = o[name];
        
        //$LASTPOS=20004821;//kernel.TQuery:4821
        if (typeof  f=="function") {
          //$LASTPOS=20004862;//kernel.TQuery:4862
          res=f.apply(o,args);
          
        }
        
      }
      return res;
    },
    fiber$apply :function _trc_TQuery_f_apply(_thread,name,args) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var o;
      var _it_161;
      var f;
      
      
      //$LASTPOS=20004741;//kernel.TQuery:4741
      if (! args) {
        //$LASTPOS=20004752;//kernel.TQuery:4752
        args=[];
      }
      //$LASTPOS=20004766;//kernel.TQuery:4766
      _it_161=Tonyu.iterator(_this,1);
      while(_it_161.next()) {
        o=_it_161[0];
        
        //$LASTPOS=20004797;//kernel.TQuery:4797
        f = o[name];
        
        //$LASTPOS=20004821;//kernel.TQuery:4821
        if (typeof  f=="function") {
          //$LASTPOS=20004862;//kernel.TQuery:4862
          res=f.apply(o,args);
          
        }
        
      }
      _thread.retVal=res;return;
      
      
      _thread.retVal=_this;return;
    },
    alive :function _trc_TQuery_alive() {
      "use strict";
      var _this=this;
      
      return _this.find((function anonymous_5007(o) {
        
        return ! o.isDead();
      }));
    },
    fiber$alive :function _trc_TQuery_f_alive(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_TQuery_ent_alive(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$find(_thread, (function anonymous_5007(o) {
              
              return ! o.isDead();
            }));
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    die :function _trc_TQuery_die() {
      "use strict";
      var _this=this;
      var a;
      
      //$LASTPOS=20005069;//kernel.TQuery:5069
      a = _this.alive();
      
      //$LASTPOS=20005089;//kernel.TQuery:5089
      if (a.length==0) {
        return false;
      }
      //$LASTPOS=20005125;//kernel.TQuery:5125
      a.apply("die");
      return true;
    },
    fiber$die :function _trc_TQuery_f_die(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      
      
      _thread.enter(function _trc_TQuery_ent_die(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=20005069;//kernel.TQuery:5069
            _this.fiber$alive(_thread);
            __pc=1;return;
          case 1:
            a=_thread.retVal;
            
            //$LASTPOS=20005089;//kernel.TQuery:5089
            if (!(a.length==0)) { __pc=2     ; break; }
            _thread.exit(false);return;
          case 2     :
            
            //$LASTPOS=20005125;//kernel.TQuery:5125
            a.apply("die");
            _thread.exit(true);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    klass :function _trc_TQuery_klass(k) {
      "use strict";
      var _this=this;
      
      return _this.find((function anonymous_5194(o) {
        
        return o instanceof k;
      }));
    },
    fiber$klass :function _trc_TQuery_f_klass(_thread,k) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_TQuery_ent_klass(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$find(_thread, (function anonymous_5194(o) {
              
              return o instanceof k;
            }));
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"__getter__parent":{"nowait":true},"create":{"nowait":false},"contains":{"nowait":false},"tonyuIterator":{"nowait":false},"attr":{"nowait":false},"genKeyfunc":{"nowait":false},"applyArrayMethod":{"nowait":false},"toArray":{"nowait":false},"sort":{"nowait":false},"slice":{"nowait":false},"maxs":{"nowait":false},"mins":{"nowait":false},"minObj":{"nowait":false},"maxObj":{"nowait":false},"nearests":{"nowait":false},"nearest":{"nowait":false},"withins":{"nowait":false},"within":{"nowait":false},"max":{"nowait":true},"min":{"nowait":true},"push":{"nowait":false},"size":{"nowait":false},"find":{"nowait":false},"find1":{"nowait":false},"random":{"nowait":false},"apply":{"nowait":false},"alive":{"nowait":false},"die":{"nowait":false},"klass":{"nowait":false}},"fields":{"length":{},"context":{},"z":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.EventHandler',
  shortName: 'EventHandler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.EventHandlerCaller],
  methods: {
    main :function _trc_EventHandler_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=21000067;//kernel.EventHandler:67
      if (Tonyu.runMode) {
        //$LASTPOS=21000086;//kernel.EventHandler:86
        _this.listeners=[];
      }
    },
    fiber$main :function _trc_EventHandler_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=21000067;//kernel.EventHandler:67
      if (Tonyu.runMode) {
        //$LASTPOS=21000086;//kernel.EventHandler:86
        _this.listeners=[];
      }
      
      _thread.retVal=_this;return;
    },
    toListener :function _trc_EventHandler_toListener(f) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=21000132;//kernel.EventHandler:132
      if (_this.target&&(typeof  f)=="string") {
        //$LASTPOS=21000179;//kernel.EventHandler:179
        f=_this.target[f];
        
      }
      //$LASTPOS=21000204;//kernel.EventHandler:204
      if (typeof  f!="function") {
        throw new Error("Not a event listener: "+_this.target+" / "+f);
        
      }
      return f;
    },
    addListener :function _trc_EventHandler_addListener(f) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=21000341;//kernel.EventHandler:341
      _this.listeners.push(_this.toListener(f));
      return {remove: (function anonymous_403() {
        
        //$LASTPOS=21000418;//kernel.EventHandler:418
        _this.removeListener(f);
      })};
    },
    removeListener :function _trc_EventHandler_removeListener(f) {
      "use strict";
      var _this=this;
      var i;
      
      //$LASTPOS=21000493;//kernel.EventHandler:493
      i = _this.listeners.indexOf(f);
      
      //$LASTPOS=21000526;//kernel.EventHandler:526
      _this.listeners.splice(i,1);
    },
    fire :function _trc_EventHandler_fire(args) {
      "use strict";
      var _this=this;
      var t;
      var h;
      var _it_170;
      
      //$LASTPOS=21000572;//kernel.EventHandler:572
      if (_this.released) {
        return _this;
      }
      
      //$LASTPOS=21000611;//kernel.EventHandler:611
      _it_170=Tonyu.iterator(_this.listeners,1);
      while(_it_170.next()) {
        h=_it_170[0];
        
        //$LASTPOS=21000855;//kernel.EventHandler:855
        _this.callEventHandler(h,args);
        
      }
    },
    fiber$fire :function _trc_EventHandler_f_fire(_thread,args) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var t;
      var h;
      var _it_170;
      
      //$LASTPOS=21000572;//kernel.EventHandler:572
      if (_this.released) {
        _thread.retVal=_this;return;
        
      }
      
      
      _thread.enter(function _trc_EventHandler_ent_fire(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=21000611;//kernel.EventHandler:611
            _it_170=Tonyu.iterator(_this.listeners,1);
          case 1:
            if (!(_it_170.next())) { __pc=3     ; break; }
            h=_it_170[0];
            
            //$LASTPOS=21000855;//kernel.EventHandler:855
            _this.fiber$callEventHandler(_thread, h, args);
            __pc=2;return;
          case 2:
            
            __pc=1;break;
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    release :function _trc_EventHandler_release() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=21000918;//kernel.EventHandler:918
      _this.released=true;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"toListener":{"nowait":true},"addListener":{"nowait":true},"removeListener":{"nowait":true},"fire":{"nowait":false},"release":{"nowait":true}},"fields":{"listeners":{},"released":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ScreenOutHandler',
  shortName: 'ScreenOutHandler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.EventHandler,
  includes: [],
  methods: {
    main :function _trc_ScreenOutHandler_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_ScreenOutHandler_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    addListener :function _trc_ScreenOutHandler_addListener(d,f) {
      "use strict";
      var _this=this;
      var retThread;
      
      //$LASTPOS=22000049;//kernel.ScreenOutHandler:49
      retThread = _this.target.parallel("screenOutChecker",d,_this.toListener(f));
      
      return {remove: (function anonymous_147() {
        
        //$LASTPOS=22000163;//kernel.ScreenOutHandler:163
        retThread.kill();
      })};
    },
    initialize :function _trc_ScreenOutHandler_initialize(param) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=22000222;//kernel.ScreenOutHandler:222
      Tonyu.classes.kernel.EventHandler.apply( _this, [param]);
      //$LASTPOS=22000240;//kernel.ScreenOutHandler:240
      _this.id=(Tonyu.globals.$idseq=(Tonyu.globals.$idseq||0)+1);
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"addListener":{"nowait":true},"new":{"nowait":false}},"fields":{"id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.WithinHandler',
  shortName: 'WithinHandler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.EventHandler,
  includes: [],
  methods: {
    main :function _trc_WithinHandler_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_WithinHandler_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    addListener :function _trc_WithinHandler_addListener(d,r,f) {
      "use strict";
      var _this=this;
      var retThread;
      
      //$LASTPOS=23000052;//kernel.WithinHandler:52
      retThread = _this.target.parallel("withinChecker",d,r,_this.toListener(f));
      
      return {remove: (function anonymous_149() {
        
        //$LASTPOS=23000165;//kernel.WithinHandler:165
        retThread.kill();
      })};
    },
    initialize :function _trc_WithinHandler_initialize(param) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=23000225;//kernel.WithinHandler:225
      Tonyu.classes.kernel.EventHandler.apply( _this, [param]);
      //$LASTPOS=23000244;//kernel.WithinHandler:244
      _this.id=(Tonyu.globals.$idseq=(Tonyu.globals.$idseq||0)+1);
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"addListener":{"nowait":true},"new":{"nowait":false}},"fields":{"id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.CubeShape',
  shortName: 'CubeShape',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: {
    main :function _trc_CubeShape_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=24000018;//kernel.CubeShape:18
      "field strict";
      
    },
    fiber$main :function _trc_CubeShape_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=24000018;//kernel.CubeShape:18
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    intersects :function _trc_CubeShape_intersects(s) {
      "use strict";
      var _this=this;
      
      return s&&Math.abs(_this.x-s.x)*2<_this.width+s.width&&Math.abs(_this.y-s.y)*2<_this.height+s.height&&Math.abs(_this.z-s.z)*2<_this.depth+s.depth;
    },
    fiber$intersects :function _trc_CubeShape_f_intersects(_thread,s) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=s&&Math.abs(_this.x-s.x)*2<_this.width+s.width&&Math.abs(_this.y-s.y)*2<_this.height+s.height&&Math.abs(_this.z-s.z)*2<_this.depth+s.depth;return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"intersects":{"nowait":false}},"fields":{"x":{},"y":{},"z":{},"width":{},"height":{},"depth":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Direction',
  shortName: 'Direction',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_Direction_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=25000037;//kernel.Direction:37
      "field strict";
      
      
    },
    fiber$main :function _trc_Direction_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=25000037;//kernel.Direction:37
      "field strict";
      
      
      
      _thread.retVal=_this;return;
    },
    initAxis :function _trc_Direction_initAxis() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=25000139;//kernel.Direction:139
      if (! Tonyu.classes.kernel.Direction.axis) {
        //$LASTPOS=25000185;//kernel.Direction:185
        Tonyu.classes.kernel.Direction.axis={roll: new Tonyu.classes.kernel.Vec3(0,0,1),pitch: new Tonyu.classes.kernel.Vec3(1,0,0),yaw: new Tonyu.classes.kernel.Vec3(0,1,0)};
        
      }
    },
    fiber$initAxis :function _trc_Direction_f_initAxis(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=25000139;//kernel.Direction:139
      if (! Tonyu.classes.kernel.Direction.axis) {
        //$LASTPOS=25000185;//kernel.Direction:185
        Tonyu.classes.kernel.Direction.axis={roll: new Tonyu.classes.kernel.Vec3(0,0,1),pitch: new Tonyu.classes.kernel.Vec3(1,0,0),yaw: new Tonyu.classes.kernel.Vec3(0,1,0)};
        
      }
      
      _thread.retVal=_this;return;
    },
    set :function _trc_Direction_set(d) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=25000355;//kernel.Direction:355
      _this.quaternion.set(d.quaternion);
      return _this;
    },
    fiber$set :function _trc_Direction_f_set(_thread,d) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=25000355;//kernel.Direction:355
      _this.quaternion.set(d.quaternion);
      _thread.retVal=_this;return;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Direction_initialize(p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=25000422;//kernel.Direction:422
      _this.initAxis();
      //$LASTPOS=25000439;//kernel.Direction:439
      Tonyu.classes.kernel.TObject.apply( _this, [p]);
      //$LASTPOS=25000454;//kernel.Direction:454
      _this.quaternion=new Tonyu.classes.kernel.Quaternion;
      //$LASTPOS=25000486;//kernel.Direction:486
      _this.forward=new Tonyu.classes.kernel.ComputedVec3((function anonymous_511(t) {
        var r;
        
        //$LASTPOS=25000527;//kernel.Direction:527
        r = _this.quaternion.rotate(Tonyu.classes.kernel.Direction.axis.roll);
        
        return t.keep(r);
      }));
      //$LASTPOS=25000613;//kernel.Direction:613
      _this.down=new Tonyu.classes.kernel.ComputedVec3((function anonymous_635(t) {
        var r;
        
        //$LASTPOS=25000651;//kernel.Direction:651
        r = _this.quaternion.rotate(Tonyu.classes.kernel.Direction.axis.yaw);
        
        return t.keep(r);
      }));
      //$LASTPOS=25000736;//kernel.Direction:736
      _this.right=new Tonyu.classes.kernel.ComputedVec3((function anonymous_759(t) {
        var r;
        
        //$LASTPOS=25000775;//kernel.Direction:775
        r = _this.quaternion.rotate(Tonyu.classes.kernel.Direction.axis.pitch);
        
        return t.keep(r);
      }));
    },
    rotate :function _trc_Direction_rotate(mode,angle,unit) {
      "use strict";
      var _this=this;
      var x;
      var y;
      var nx;
      var ny;
      var axis;
      
      
      //$LASTPOS=25000992;//kernel.Direction:992
      axis=Tonyu.classes.kernel.Direction.axis[mode];
      //$LASTPOS=25001024;//kernel.Direction:1024
      if (! axis) {
        //$LASTPOS=25001046;//kernel.Direction:1046
        _this.quaternion.set(new Tonyu.classes.kernel.Quaternion);
        
      } else {
        //$LASTPOS=25001101;//kernel.Direction:1101
        _this.quaternion.product(new Tonyu.classes.kernel.Quaternion({axis: axis,r: angle}),_this.quaternion);
        
      }
      //$LASTPOS=25001174;//kernel.Direction:1174
      _this.forward.requestCompute();
      //$LASTPOS=25001205;//kernel.Direction:1205
      _this.down.requestCompute();
      //$LASTPOS=25001233;//kernel.Direction:1233
      _this.right.requestCompute();
      return _this;
    },
    fiber$rotate :function _trc_Direction_f_rotate(_thread,mode,angle,unit) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var x;
      var y;
      var nx;
      var ny;
      var axis;
      
      
      //$LASTPOS=25000992;//kernel.Direction:992
      axis=Tonyu.classes.kernel.Direction.axis[mode];
      //$LASTPOS=25001024;//kernel.Direction:1024
      if (! axis) {
        //$LASTPOS=25001046;//kernel.Direction:1046
        _this.quaternion.set(new Tonyu.classes.kernel.Quaternion);
        
      } else {
        //$LASTPOS=25001101;//kernel.Direction:1101
        _this.quaternion.product(new Tonyu.classes.kernel.Quaternion({axis: axis,r: angle}),_this.quaternion);
        
      }
      //$LASTPOS=25001174;//kernel.Direction:1174
      _this.forward.requestCompute();
      //$LASTPOS=25001205;//kernel.Direction:1205
      _this.down.requestCompute();
      //$LASTPOS=25001233;//kernel.Direction:1233
      _this.right.requestCompute();
      _thread.retVal=_this;return;
      
      
      _thread.retVal=_this;return;
    },
    localToWorld :function _trc_Direction_localToWorld(local,dst) {
      "use strict";
      var _this=this;
      
      return _this.quaternion.rotate(local,dst);
    },
    fiber$localToWorld :function _trc_Direction_f_localToWorld(_thread,local,dst) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.quaternion.rotate(local,dst);return;
      
      
      _thread.retVal=_this;return;
    },
    worldToLocal :function _trc_Direction_worldToLocal(world,dst) {
      "use strict";
      var _this=this;
      
      return _this.quaternion.inverse.rotate(world,dst);
    },
    fiber$worldToLocal :function _trc_Direction_f_worldToLocal(_thread,world,dst) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.quaternion.inverse.rotate(world,dst);return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"initAxis":{"nowait":false},"set":{"nowait":false},"new":{"nowait":false},"rotate":{"nowait":false},"localToWorld":{"nowait":false},"worldToLocal":{"nowait":false}},"fields":{"forward":{},"down":{},"right":{},"back":{},"up":{},"left":{},"quaternion":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ParentChanger',
  shortName: 'ParentChanger',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: {
    main :function _trc_ParentChanger_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=26000018;//kernel.ParentChanger:18
      "field strict";
      
      
    },
    fiber$main :function _trc_ParentChanger_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=26000018;//kernel.ParentChanger:18
      "field strict";
      
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_ParentChanger_initialize(dstParent) {
      "use strict";
      var _this=this;
      var cnode;
      var t;
      
      
      //$LASTPOS=26000197;//kernel.ParentChanger:197
      _this.nodes={};
      //$LASTPOS=26000212;//kernel.ParentChanger:212
      dstParent=dstParent||Tonyu.classes.kernel.Transform.root;
      //$LASTPOS=26000256;//kernel.ParentChanger:256
      _this.dstParent=dstParent;
      //$LASTPOS=26000287;//kernel.ParentChanger:287
      _this.nodes[dstParent.id]=cnode=_this.cn({transform: dstParent,isDst: true});
      //$LASTPOS=26000356;//kernel.ParentChanger:356
      //$LASTPOS=26000361;//kernel.ParentChanger:361
      t = dstParent.parent;
      for (; t ; t=t.parent) {
        {
          //$LASTPOS=26000412;//kernel.ParentChanger:412
          cnode=_this.cn({transform: t,next: cnode,relation: "child"});
          //$LASTPOS=26000475;//kernel.ParentChanger:475
          _this.nodes[t.id]=cnode;
        }
      }
    },
    cn :function _trc_ParentChanger_cn(n) {
      "use strict";
      var _this=this;
      
      switch (n.relation) {
      case "parent":
        //$LASTPOS=26000697;//kernel.ParentChanger:697
        _this.chk(n.next.transform.isParentOf(n.transform),"cn::parent not match");
        break;
        
      case "child":
        //$LASTPOS=26000815;//kernel.ParentChanger:815
        _this.chk(n.next.transform.isChildOf(n.transform),"cn::child not match");
        break;
        
      case "sibling":
        //$LASTPOS=26000933;//kernel.ParentChanger:933
        _this.chk(n.next.transform.isSibling(n.transform),"cn::sibling not match");
        break;
        
      default:
        //$LASTPOS=26001046;//kernel.ParentChanger:1046
        _this.chk(n.isDst,"cn::relation not set");
      }
      return n;
    },
    fiber$cn :function _trc_ParentChanger_f_cn(_thread,n) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_ParentChanger_ent_cn(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            switch (n.relation) {
            case "parent":
              __pc=1     ;break;
            case "child":
              __pc=3     ;break;
            case "sibling":
              __pc=5     ;break;
            default:
              __pc=7     ;break;
              
            }
            break;
          case 1     :
            //$LASTPOS=26000697;//kernel.ParentChanger:697
            _this.fiber$chk(_thread, n.next.transform.isParentOf(n.transform), "cn::parent not match");
            __pc=2;return;
          case 2:
            
            __pc=9     ; break;
            
          case 3     :
            //$LASTPOS=26000815;//kernel.ParentChanger:815
            _this.fiber$chk(_thread, n.next.transform.isChildOf(n.transform), "cn::child not match");
            __pc=4;return;
          case 4:
            
            __pc=9     ; break;
            
          case 5     :
            //$LASTPOS=26000933;//kernel.ParentChanger:933
            _this.fiber$chk(_thread, n.next.transform.isSibling(n.transform), "cn::sibling not match");
            __pc=6;return;
          case 6:
            
            __pc=9     ; break;
            
          case 7     :
            //$LASTPOS=26001046;//kernel.ParentChanger:1046
            _this.fiber$chk(_thread, n.isDst, "cn::relation not set");
            __pc=8;return;
          case 8:
            
            case 9     :
            
            _thread.exit(n);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    chk :function _trc_ParentChanger_chk(b,mesg) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=26001129;//kernel.ParentChanger:1129
      if (! b) {
        throw new Error("ParentChanger::"+mesg);
        
      }
    },
    fiber$chk :function _trc_ParentChanger_f_chk(_thread,b,mesg) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=26001129;//kernel.ParentChanger:1129
      if (! b) {
        throw new Error("ParentChanger::"+mesg);
        
      }
      
      _thread.retVal=_this;return;
    },
    getNode :function _trc_ParentChanger_getNode(tt) {
      "use strict";
      var _this=this;
      var cnode;
      var prev;
      var path;
      var t;
      
      //$LASTPOS=26001212;//kernel.ParentChanger:1212
      if (_this.nodes[tt.id]) {
        return _this.nodes[tt.id];
      }
      
      //$LASTPOS=26001277;//kernel.ParentChanger:1277
      path = [];
      
      //$LASTPOS=26001399;//kernel.ParentChanger:1399
      t = tt;
      
      //$LASTPOS=26001414;//kernel.ParentChanger:1414
      while (true) {
        //$LASTPOS=26001438;//kernel.ParentChanger:1438
        _this.chk(t,"t reached to root(null)");
        //$LASTPOS=26001481;//kernel.ParentChanger:1481
        cnode=_this.nodes[t.id];
        //$LASTPOS=26001509;//kernel.ParentChanger:1509
        if (cnode) {
          break;
          
          
        }
        //$LASTPOS=26001562;//kernel.ParentChanger:1562
        path.unshift(t);
        //$LASTPOS=26001588;//kernel.ParentChanger:1588
        t=t.parent;
        
      }
      //$LASTPOS=26001612;//kernel.ParentChanger:1612
      if (cnode.relation==="child") {
        //$LASTPOS=26001653;//kernel.ParentChanger:1653
        t=path.shift();
        //$LASTPOS=26001678;//kernel.ParentChanger:1678
        cnode=_this.nodes[t.id]=_this.cn({next: cnode.next,relation: "sibling",transform: t});
        
      }
      //$LASTPOS=26001786;//kernel.ParentChanger:1786
      while (t=path.shift()) {
        //$LASTPOS=26001851;//kernel.ParentChanger:1851
        _this.chk(t.parent===cnode.transform,"getNode cnode parent not match");
        //$LASTPOS=26001927;//kernel.ParentChanger:1927
        cnode=_this.nodes[t.id]=_this.cn({next: cnode,relation: "parent",transform: t});
        
      }
      //$LASTPOS=26002029;//kernel.ParentChanger:2029
      _this.chk(cnode.transform===tt,"getNode cnode not match");
      return cnode;
    },
    fiber$getNode :function _trc_ParentChanger_f_getNode(_thread,tt) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var cnode;
      var prev;
      var path;
      var t;
      
      //$LASTPOS=26001212;//kernel.ParentChanger:1212
      if (_this.nodes[tt.id]) {
        _thread.retVal=_this.nodes[tt.id];return;
        
      }
      
      //$LASTPOS=26001277;//kernel.ParentChanger:1277
      path = [];
      
      //$LASTPOS=26001399;//kernel.ParentChanger:1399
      t = tt;
      
      
      _thread.enter(function _trc_ParentChanger_ent_getNode(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=26001414;//kernel.ParentChanger:1414
          case 1:
            //$LASTPOS=26001438;//kernel.ParentChanger:1438
            _this.fiber$chk(_thread, t, "t reached to root(null)");
            __pc=2;return;
          case 2:
            
            //$LASTPOS=26001481;//kernel.ParentChanger:1481
            cnode=_this.nodes[t.id];
            //$LASTPOS=26001509;//kernel.ParentChanger:1509
            if (!(cnode)) { __pc=3     ; break; }
            __pc=4     ; break;
            
          case 3     :
            
            //$LASTPOS=26001562;//kernel.ParentChanger:1562
            path.unshift(t);
            //$LASTPOS=26001588;//kernel.ParentChanger:1588
            t=t.parent;
            __pc=1;break;
          case 4     :
            
            //$LASTPOS=26001612;//kernel.ParentChanger:1612
            if (cnode.relation==="child") {
              //$LASTPOS=26001653;//kernel.ParentChanger:1653
              t=path.shift();
              //$LASTPOS=26001678;//kernel.ParentChanger:1678
              cnode=_this.nodes[t.id]=_this.cn({next: cnode.next,relation: "sibling",transform: t});
              
            }
            //$LASTPOS=26001786;//kernel.ParentChanger:1786
          case 5:
            if (!(t=path.shift())) { __pc=7     ; break; }
            //$LASTPOS=26001851;//kernel.ParentChanger:1851
            _this.fiber$chk(_thread, t.parent===cnode.transform, "getNode cnode parent not match");
            __pc=6;return;
          case 6:
            
            //$LASTPOS=26001927;//kernel.ParentChanger:1927
            cnode=_this.nodes[t.id]=_this.cn({next: cnode,relation: "parent",transform: t});
            __pc=5;break;
          case 7     :
            
            //$LASTPOS=26002029;//kernel.ParentChanger:2029
            _this.fiber$chk(_thread, cnode.transform===tt, "getNode cnode not match");
            __pc=8;return;
          case 8:
            
            _thread.exit(cnode);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    change :function _trc_ParentChanger_change(t,res) {
      "use strict";
      var _this=this;
      var n;
      var dstNode;
      
      //$LASTPOS=26002147;//kernel.ParentChanger:2147
      res=res||new Tonyu.classes.kernel.Transform;
      //$LASTPOS=26002176;//kernel.ParentChanger:2176
      res.set(t);
      //$LASTPOS=26002193;//kernel.ParentChanger:2193
      if (res.parent===_this.dstParent) {
        return res;
      }
      //$LASTPOS=26002238;//kernel.ParentChanger:2238
      n = _this.getNode(res.parent);
      
      //$LASTPOS=26002270;//kernel.ParentChanger:2270
      dstNode = _this.getNode(_this.dstParent);
      
      //$LASTPOS=26002307;//kernel.ParentChanger:2307
      while (n!==dstNode) {
        //$LASTPOS=26002337;//kernel.ParentChanger:2337
        _this.chk(res.parent===n.transform,"convert not match ");
        switch (n.relation) {
        case "parent":
          //$LASTPOS=26002461;//kernel.ParentChanger:2461
          n.transform.childToSibling(res,res);
          break;
          
        case "child":
          //$LASTPOS=26002746;//kernel.ParentChanger:2746
          _this.chk(n.next.transform.isSibling(res),"convert::child not match");
          //$LASTPOS=26002824;//kernel.ParentChanger:2824
          n.next.transform.siblingToChild(res,res);
          break;
          
        case "sibling":
          //$LASTPOS=26002974;//kernel.ParentChanger:2974
          n.transform.childToSibling(res,res);
          //$LASTPOS=26003089;//kernel.ParentChanger:3089
          _this.chk(n.next.transform.isSibling(res),"convert::sibling not match");
          //$LASTPOS=26003170;//kernel.ParentChanger:3170
          n.next.transform.siblingToChild(res,res);
          break;
          
        default:
          //$LASTPOS=26003311;//kernel.ParentChanger:3311
          _this.chk(false,"Unknown relation:"+n.relation+"/"+n.transform.id+"/"+_this.dstParent.id);
        }
        //$LASTPOS=26003450;//kernel.ParentChanger:3450
        n=n.next;
        
      }
      //$LASTPOS=26003600;//kernel.ParentChanger:3600
      _this.chk(res.parent===_this.dstParent,"change::fail");
      return res;
    },
    fiber$change :function _trc_ParentChanger_f_change(_thread,t,res) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var n;
      var dstNode;
      
      //$LASTPOS=26002147;//kernel.ParentChanger:2147
      res=res||new Tonyu.classes.kernel.Transform;
      //$LASTPOS=26002176;//kernel.ParentChanger:2176
      res.set(t);
      //$LASTPOS=26002193;//kernel.ParentChanger:2193
      if (res.parent===_this.dstParent) {
        _thread.retVal=res;return;
        
      }
      
      _thread.enter(function _trc_ParentChanger_ent_change(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=26002238;//kernel.ParentChanger:2238
            _this.fiber$getNode(_thread, res.parent);
            __pc=1;return;
          case 1:
            n=_thread.retVal;
            
            //$LASTPOS=26002270;//kernel.ParentChanger:2270
            _this.fiber$getNode(_thread, _this.dstParent);
            __pc=2;return;
          case 2:
            dstNode=_thread.retVal;
            
            //$LASTPOS=26002307;//kernel.ParentChanger:2307
          case 3:
            if (!(n!==dstNode)) { __pc=13    ; break; }
            //$LASTPOS=26002337;//kernel.ParentChanger:2337
            _this.fiber$chk(_thread, res.parent===n.transform, "convert not match ");
            __pc=4;return;
          case 4:
            
            switch (n.relation) {
            case "parent":
              __pc=5     ;break;
            case "child":
              __pc=6     ;break;
            case "sibling":
              __pc=8     ;break;
            default:
              __pc=10    ;break;
              
            }
            break;
          case 5     :
            //$LASTPOS=26002461;//kernel.ParentChanger:2461
            n.transform.childToSibling(res,res);
            __pc=12    ; break;
            
          case 6     :
            //$LASTPOS=26002746;//kernel.ParentChanger:2746
            _this.fiber$chk(_thread, n.next.transform.isSibling(res), "convert::child not match");
            __pc=7;return;
          case 7:
            
            //$LASTPOS=26002824;//kernel.ParentChanger:2824
            n.next.transform.siblingToChild(res,res);
            __pc=12    ; break;
            
          case 8     :
            //$LASTPOS=26002974;//kernel.ParentChanger:2974
            n.transform.childToSibling(res,res);
            //$LASTPOS=26003089;//kernel.ParentChanger:3089
            _this.fiber$chk(_thread, n.next.transform.isSibling(res), "convert::sibling not match");
            __pc=9;return;
          case 9:
            
            //$LASTPOS=26003170;//kernel.ParentChanger:3170
            n.next.transform.siblingToChild(res,res);
            __pc=12    ; break;
            
          case 10    :
            //$LASTPOS=26003311;//kernel.ParentChanger:3311
            _this.fiber$chk(_thread, false, "Unknown relation:"+n.relation+"/"+n.transform.id+"/"+_this.dstParent.id);
            __pc=11;return;
          case 11:
            
            case 12    :
            
            //$LASTPOS=26003450;//kernel.ParentChanger:3450
            n=n.next;
            __pc=3;break;
          case 13    :
            
            //$LASTPOS=26003600;//kernel.ParentChanger:3600
            _this.fiber$chk(_thread, res.parent===_this.dstParent, "change::fail");
            __pc=14;return;
          case 14:
            
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"cn":{"nowait":false},"chk":{"nowait":false},"getNode":{"nowait":false},"change":{"nowait":false}},"fields":{"dstParent":{},"nodes":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Quaternion',
  shortName: 'Quaternion',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_Quaternion_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=27000037;//kernel.Quaternion:37
      "field strict";
      
      
      
    },
    fiber$main :function _trc_Quaternion_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=27000037;//kernel.Quaternion:37
      "field strict";
      
      
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Quaternion_initialize(p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=27000195;//kernel.Quaternion:195
      Tonyu.classes.kernel.TObject.apply( _this, [p]);
      //$LASTPOS=27000210;//kernel.Quaternion:210
      if (_this.axis&&typeof  _this.r==="number") {
        //$LASTPOS=27000254;//kernel.Quaternion:254
        _this.theta=_this.r/2;
        //$LASTPOS=27000318;//kernel.Quaternion:318
        _this.v=_this.axis.normalize(_this.sin(_this.theta));
        //$LASTPOS=27000379;//kernel.Quaternion:379
        _this.w=_this.cos(_this.theta);
        
      }
      //$LASTPOS=27000405;//kernel.Quaternion:405
      _this.v=_this.v||new Tonyu.classes.kernel.Vec3(0,0,0);
      //$LASTPOS=27000432;//kernel.Quaternion:432
      if (_this.w==null) {
        //$LASTPOS=27000445;//kernel.Quaternion:445
        _this.w=1;
      }
    },
    set :function _trc_Quaternion_set(q) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=27000480;//kernel.Quaternion:480
      _this.v.set(q.v);
      //$LASTPOS=27000497;//kernel.Quaternion:497
      _this.w=q.w;
      return _this;
    },
    fiber$set :function _trc_Quaternion_f_set(_thread,q) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=27000480;//kernel.Quaternion:480
      _this.v.set(q.v);
      //$LASTPOS=27000497;//kernel.Quaternion:497
      _this.w=q.w;
      _thread.retVal=_this;return;
      
      
      _thread.retVal=_this;return;
    },
    __getter__length :function _trc_Quaternion___getter__length() {
      "use strict";
      var _this=this;
      
      return _this.sqrt(_this.lengthSQ);
    },
    __getter__lengthSQ :function _trc_Quaternion___getter__lengthSQ() {
      "use strict";
      var _this=this;
      var l;
      
      //$LASTPOS=27000585;//kernel.Quaternion:585
      l = _this.v.length;
      
      return l*l+_this.w*_this.w;
    },
    add :function _trc_Quaternion_add(q) {
      "use strict";
      var _this=this;
      
      return new Tonyu.classes.kernel.Quaternion({v: _this.v.add(q.v),w: _this.w+q.w});
    },
    fiber$add :function _trc_Quaternion_f_add(_thread,q) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=new Tonyu.classes.kernel.Quaternion({v: _this.v.add(q.v),w: _this.w+q.w});return;
      
      
      _thread.retVal=_this;return;
    },
    sub :function _trc_Quaternion_sub(q) {
      "use strict";
      var _this=this;
      
      return new Tonyu.classes.kernel.Quaternion({v: _this.v.sub(q.v),w: _this.w-q.w});
    },
    fiber$sub :function _trc_Quaternion_f_sub(_thread,q) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=new Tonyu.classes.kernel.Quaternion({v: _this.v.sub(q.v),w: _this.w-q.w});return;
      
      
      _thread.retVal=_this;return;
    },
    mul :function _trc_Quaternion_mul(k) {
      "use strict";
      var _this=this;
      
      return new Tonyu.classes.kernel.Quaternion({v: _this.v.mul(k),w: k*_this.w});
    },
    fiber$mul :function _trc_Quaternion_f_mul(_thread,k) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=new Tonyu.classes.kernel.Quaternion({v: _this.v.mul(k),w: k*_this.w});return;
      
      
      _thread.retVal=_this;return;
    },
    product :function _trc_Quaternion_product(q,dst) {
      "use strict";
      var _this=this;
      var nv;
      var nw;
      
      //$LASTPOS=27001160;//kernel.Quaternion:1160
      nv = _this.v.product(q.v).add(_this.v.mul(q.w)).add(q.v.mul(_this.w));
      nw = _this.w*q.w-_this.v.innerProduct(q.v);
      
      //$LASTPOS=27001252;//kernel.Quaternion:1252
      if (dst) {
        //$LASTPOS=27001272;//kernel.Quaternion:1272
        dst.v.set(nv);
        //$LASTPOS=27001296;//kernel.Quaternion:1296
        dst.w=nw;
        //$LASTPOS=27001315;//kernel.Quaternion:1315
        delete dst.theta;
        return dst;
        
      }
      return new Tonyu.classes.kernel.Quaternion({v: nv,w: nw});
    },
    fiber$product :function _trc_Quaternion_f_product(_thread,q,dst) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var nv;
      var nw;
      
      //$LASTPOS=27001160;//kernel.Quaternion:1160
      nv = _this.v.product(q.v).add(_this.v.mul(q.w)).add(q.v.mul(_this.w));
      nw = _this.w*q.w-_this.v.innerProduct(q.v);
      
      //$LASTPOS=27001252;//kernel.Quaternion:1252
      if (dst) {
        //$LASTPOS=27001272;//kernel.Quaternion:1272
        dst.v.set(nv);
        //$LASTPOS=27001296;//kernel.Quaternion:1296
        dst.w=nw;
        //$LASTPOS=27001315;//kernel.Quaternion:1315
        delete dst.theta;
        _thread.retVal=dst;return;
        
        
      }
      _thread.retVal=new Tonyu.classes.kernel.Quaternion({v: nv,w: nw});return;
      
      
      _thread.retVal=_this;return;
    },
    __getter__inverse :function _trc_Quaternion___getter__inverse() {
      "use strict";
      var _this=this;
      
      return _this.conjugate.mul(1/_this.lengthSQ);
    },
    __getter__conjugate :function _trc_Quaternion___getter__conjugate() {
      "use strict";
      var _this=this;
      
      return new Tonyu.classes.kernel.Quaternion({v: _this.v.mul(- 1),w: _this.w});
    },
    rotate :function _trc_Quaternion_rotate(p,dst) {
      "use strict";
      var _this=this;
      var res;
      
      //$LASTPOS=27001573;//kernel.Quaternion:1573
      p=new Tonyu.classes.kernel.Quaternion({v: p,w: 1});
      //$LASTPOS=27001605;//kernel.Quaternion:1605
      res = _this.product(p).product(_this.inverse).v;
      
      //$LASTPOS=27001649;//kernel.Quaternion:1649
      if (dst) {
        //$LASTPOS=27001669;//kernel.Quaternion:1669
        dst.set(res);
        return dst;
        
      }
      return res;
    },
    fiber$rotate :function _trc_Quaternion_f_rotate(_thread,p,dst) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      
      //$LASTPOS=27001573;//kernel.Quaternion:1573
      p=new Tonyu.classes.kernel.Quaternion({v: p,w: 1});
      //$LASTPOS=27001605;//kernel.Quaternion:1605
      res = _this.product(p).product(_this.inverse).v;
      
      //$LASTPOS=27001649;//kernel.Quaternion:1649
      if (dst) {
        //$LASTPOS=27001669;//kernel.Quaternion:1669
        dst.set(res);
        _thread.retVal=dst;return;
        
        
      }
      _thread.retVal=res;return;
      
      
      _thread.retVal=_this;return;
    },
    calcTheta :function _trc_Quaternion_calcTheta() {
      "use strict";
      var _this=this;
      var y;
      var x;
      
      //$LASTPOS=27001791;//kernel.Quaternion:1791
      y = _this.v.length;
      
      //$LASTPOS=27001812;//kernel.Quaternion:1812
      x = _this.w;
      
      //$LASTPOS=27001826;//kernel.Quaternion:1826
      _this.theta=_this.atanxy(x,y);
      //$LASTPOS=27001850;//kernel.Quaternion:1850
      _this.r=_this.theta*2;
      return _this.theta;
    },
    fiber$calcTheta :function _trc_Quaternion_f_calcTheta(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var y;
      var x;
      
      //$LASTPOS=27001791;//kernel.Quaternion:1791
      y = _this.v.length;
      
      //$LASTPOS=27001812;//kernel.Quaternion:1812
      x = _this.w;
      
      //$LASTPOS=27001826;//kernel.Quaternion:1826
      _this.theta=_this.atanxy(x,y);
      //$LASTPOS=27001850;//kernel.Quaternion:1850
      _this.r=_this.theta*2;
      _thread.retVal=_this.theta;return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"set":{"nowait":false},"__getter__length":{"nowait":true},"__getter__lengthSQ":{"nowait":true},"add":{"nowait":false},"sub":{"nowait":false},"mul":{"nowait":false},"product":{"nowait":false},"__getter__inverse":{"nowait":true},"__getter__conjugate":{"nowait":true},"rotate":{"nowait":false},"calcTheta":{"nowait":false}},"fields":{"v":{},"w":{},"axis":{},"r":{},"theta":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.RectShape',
  shortName: 'RectShape',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: {
    main :function _trc_RectShape_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=28000018;//kernel.RectShape:18
      "field strict";
      
    },
    fiber$main :function _trc_RectShape_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=28000018;//kernel.RectShape:18
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    intersects :function _trc_RectShape_intersects(s) {
      "use strict";
      var _this=this;
      
      return s&&Math.abs(_this.x-s.x)*2<_this.width+s.width&&Math.abs(_this.y-s.y)*2<_this.height+s.height;
    },
    fiber$intersects :function _trc_RectShape_f_intersects(_thread,s) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=s&&Math.abs(_this.x-s.x)*2<_this.width+s.width&&Math.abs(_this.y-s.y)*2<_this.height+s.height;return;
      
      
      _thread.retVal=_this;return;
    },
    contains :function _trc_RectShape_contains(p) {
      "use strict";
      var _this=this;
      
      return p.x>=_this.xmin&&p.x<=_this.xmax&&p.y>=_this.ymin&&p.y<=_this.ymax;
    },
    fiber$contains :function _trc_RectShape_f_contains(_thread,p) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=p.x>=_this.xmin&&p.x<=_this.xmax&&p.y>=_this.ymin&&p.y<=_this.ymax;return;
      
      
      _thread.retVal=_this;return;
    },
    __getter__xmin :function _trc_RectShape___getter__xmin() {
      "use strict";
      var _this=this;
      
      return _this.x-_this.width/2;
    },
    __getter__xmax :function _trc_RectShape___getter__xmax() {
      "use strict";
      var _this=this;
      
      return _this.x+_this.width/2;
    },
    __getter__ymin :function _trc_RectShape___getter__ymin() {
      "use strict";
      var _this=this;
      
      return _this.y-_this.height/2;
    },
    __getter__ymax :function _trc_RectShape___getter__ymax() {
      "use strict";
      var _this=this;
      
      return _this.y+_this.height/2;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"intersects":{"nowait":false},"contains":{"nowait":false},"__getter__xmin":{"nowait":true},"__getter__xmax":{"nowait":true},"__getter__ymin":{"nowait":true},"__getter__ymax":{"nowait":true}},"fields":{"x":{},"y":{},"width":{},"height":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Transform',
  shortName: 'Transform',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: {
    main :function _trc_Transform_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=29000018;//kernel.Transform:18
      "field strict";
      
      
      
      
      
    },
    fiber$main :function _trc_Transform_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=29000018;//kernel.Transform:18
      "field strict";
      
      
      
      
      
      
      _thread.retVal=_this;return;
    },
    _static :function _trc_Transform__static() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=29000286;//kernel.Transform:286
      if (! Tonyu.classes.kernel.Transform._static) {
        //$LASTPOS=29000321;//kernel.Transform:321
        Tonyu.classes.kernel.Transform._static=true;
        //$LASTPOS=29000354;//kernel.Transform:354
        Tonyu.classes.kernel.Transform.IDSEQ=1;
        //$LASTPOS=29000382;//kernel.Transform:382
        Tonyu.classes.kernel.Transform.root=new Tonyu.classes.kernel.Transform;
        
      }
    },
    fiber$_static :function _trc_Transform_f__static(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=29000286;//kernel.Transform:286
      if (! Tonyu.classes.kernel.Transform._static) {
        //$LASTPOS=29000321;//kernel.Transform:321
        Tonyu.classes.kernel.Transform._static=true;
        //$LASTPOS=29000354;//kernel.Transform:354
        Tonyu.classes.kernel.Transform.IDSEQ=1;
        //$LASTPOS=29000382;//kernel.Transform:382
        Tonyu.classes.kernel.Transform.root=new Tonyu.classes.kernel.Transform;
        
      }
      
      _thread.retVal=_this;return;
    },
    __setter__parent :function _trc_Transform___setter__parent(p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=29000440;//kernel.Transform:440
      if (_this._parent===p) {
        return _this;
      }
      //$LASTPOS=29000470;//kernel.Transform:470
      if (_this._parent) {
        //$LASTPOS=29000494;//kernel.Transform:494
        _this.parentChanged(p,_this);
        
      } else {
        //$LASTPOS=29000540;//kernel.Transform:540
        _this._parent=p;
        
      }
    },
    __getter__parent :function _trc_Transform___getter__parent() {
      "use strict";
      var _this=this;
      
      return _this._parent;
    },
    __getter__quaternion :function _trc_Transform___getter__quaternion() {
      "use strict";
      var _this=this;
      
      return _this.direction.quaternion;
    },
    initialize :function _trc_Transform_initialize(param) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=29000660;//kernel.Transform:660
      _this._static();
      //$LASTPOS=29000676;//kernel.Transform:676
      Tonyu.classes.kernel.TObject.apply( _this, [param]);
      //$LASTPOS=29000695;//kernel.Transform:695
      _this.id=Tonyu.classes.kernel.Transform.IDSEQ++;
      //$LASTPOS=29000722;//kernel.Transform:722
      _this.scale=_this.scale||1;
      //$LASTPOS=29000743;//kernel.Transform:743
      _this.direction=_this.direction||new Tonyu.classes.kernel.Direction;
      //$LASTPOS=29000784;//kernel.Transform:784
      _this.position=_this.position||new Tonyu.classes.kernel.Vec3(0,0,0);
      //$LASTPOS=29000825;//kernel.Transform:825
      _this._parent=_this._parent||Tonyu.classes.kernel.Transform.root;
    },
    __getter__isRoot :function _trc_Transform___getter__isRoot() {
      "use strict";
      var _this=this;
      
      return _this===Tonyu.classes.kernel.Transform.root;
    },
    set :function _trc_Transform_set(t) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=29000936;//kernel.Transform:936
      _this.position.set(t.position);
      //$LASTPOS=29000967;//kernel.Transform:967
      _this.direction.set(t.direction);
      //$LASTPOS=29001000;//kernel.Transform:1000
      _this.scale=t.scale;
      //$LASTPOS=29001020;//kernel.Transform:1020
      _this._parent=t.parent;
    },
    fiber$set :function _trc_Transform_f_set(_thread,t) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=29000936;//kernel.Transform:936
      _this.position.set(t.position);
      //$LASTPOS=29000967;//kernel.Transform:967
      _this.direction.set(t.direction);
      //$LASTPOS=29001000;//kernel.Transform:1000
      _this.scale=t.scale;
      //$LASTPOS=29001020;//kernel.Transform:1020
      _this._parent=t.parent;
      
      _thread.retVal=_this;return;
    },
    product :function _trc_Transform_product(t,dst) {
      "use strict";
      var _this=this;
      var writeToThis;
      
      
      //$LASTPOS=29001253;//kernel.Transform:1253
      if (dst===_this) {
        //$LASTPOS=29001280;//kernel.Transform:1280
        writeToThis=true;
        //$LASTPOS=29001307;//kernel.Transform:1307
        dst=false;
        
      }
      //$LASTPOS=29001330;//kernel.Transform:1330
      if (! dst) {
        //$LASTPOS=29001340;//kernel.Transform:1340
        dst=new Tonyu.classes.kernel.Transform;
      }
      //$LASTPOS=29001364;//kernel.Transform:1364
      _this.quaternion.product(t.quaternion,dst.quaternion);
      //$LASTPOS=29001418;//kernel.Transform:1418
      dst.scale=_this.scale*t.scale;
      //$LASTPOS=29001448;//kernel.Transform:1448
      _this.localToWorld(t.position,dst.position);
      //$LASTPOS=29001492;//kernel.Transform:1492
      if (writeToThis) {
        //$LASTPOS=29001520;//kernel.Transform:1520
        _this.set(dst);
        return _this;
        
      }
      return dst;
    },
    fiber$product :function _trc_Transform_f_product(_thread,t,dst) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var writeToThis;
      
      
      //$LASTPOS=29001253;//kernel.Transform:1253
      if (dst===_this) {
        //$LASTPOS=29001280;//kernel.Transform:1280
        writeToThis=true;
        //$LASTPOS=29001307;//kernel.Transform:1307
        dst=false;
        
      }
      //$LASTPOS=29001330;//kernel.Transform:1330
      if (! dst) {
        //$LASTPOS=29001340;//kernel.Transform:1340
        dst=new Tonyu.classes.kernel.Transform;
      }
      //$LASTPOS=29001364;//kernel.Transform:1364
      _this.quaternion.product(t.quaternion,dst.quaternion);
      //$LASTPOS=29001418;//kernel.Transform:1418
      dst.scale=_this.scale*t.scale;
      
      _thread.enter(function _trc_Transform_ent_product(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=29001448;//kernel.Transform:1448
            _this.fiber$localToWorld(_thread, t.position, dst.position);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=29001492;//kernel.Transform:1492
            if (!(writeToThis)) { __pc=3     ; break; }
            //$LASTPOS=29001520;//kernel.Transform:1520
            _this.fiber$set(_thread, dst);
            __pc=2;return;
          case 2:
            
            _thread.exit(_this);return;
          case 3     :
            
            _thread.exit(dst);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    parentChanged :function _trc_Transform_parentChanged(to,dst) {
      "use strict";
      var _this=this;
      var p;
      
      //$LASTPOS=29001632;//kernel.Transform:1632
      p = new Tonyu.classes.kernel.ParentChanger(to);
      
      return p.change(_this,dst);
    },
    fiber$parentChanged :function _trc_Transform_f_parentChanged(_thread,to,dst) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var p;
      
      //$LASTPOS=29001632;//kernel.Transform:1632
      p = new Tonyu.classes.kernel.ParentChanger(to);
      
      _thread.retVal=p.change(_this,dst);return;
      
      
      _thread.retVal=_this;return;
    },
    localToWorld :function _trc_Transform_localToWorld(local,dst) {
      "use strict";
      var _this=this;
      
      return _this.childToSibling(local,dst);
    },
    fiber$localToWorld :function _trc_Transform_f_localToWorld(_thread,local,dst) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Transform_ent_localToWorld(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$childToSibling(_thread, local, dst);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    childToSibling :function _trc_Transform_childToSibling(child,dst) {
      "use strict";
      var _this=this;
      var res;
      
      //$LASTPOS=29001889;//kernel.Transform:1889
      if (child instanceof Tonyu.classes.kernel.Transform) {
        //$LASTPOS=29002010;//kernel.Transform:2010
        res = _this.product(child,dst);
        
        //$LASTPOS=29002047;//kernel.Transform:2047
        res._parent=_this.parent;
        return res;
        
      }
      //$LASTPOS=29002119;//kernel.Transform:2119
      dst=_this.direction.localToWorld(child,dst);
      //$LASTPOS=29002163;//kernel.Transform:2163
      dst.mulX(_this.scale);
      //$LASTPOS=29002185;//kernel.Transform:2185
      dst.addX(_this.position);
      return dst;
    },
    fiber$childToSibling :function _trc_Transform_f_childToSibling(_thread,child,dst) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      
      
      _thread.enter(function _trc_Transform_ent_childToSibling(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=29001889;//kernel.Transform:1889
            if (!(child instanceof Tonyu.classes.kernel.Transform)) { __pc=2     ; break; }
            //$LASTPOS=29002010;//kernel.Transform:2010
            _this.fiber$product(_thread, child, dst);
            __pc=1;return;
          case 1:
            res=_thread.retVal;
            
            //$LASTPOS=29002047;//kernel.Transform:2047
            res._parent=_this.parent;
            _thread.exit(res);return;
          case 2     :
            
            //$LASTPOS=29002119;//kernel.Transform:2119
            dst=_this.direction.localToWorld(child,dst);
            //$LASTPOS=29002163;//kernel.Transform:2163
            dst.mulX(_this.scale);
            //$LASTPOS=29002185;//kernel.Transform:2185
            dst.addX(_this.position);
            _thread.exit(dst);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    worldToLocal :function _trc_Transform_worldToLocal(local,dst) {
      "use strict";
      var _this=this;
      
      return _this.siblingToChild(local,dst);
    },
    fiber$worldToLocal :function _trc_Transform_f_worldToLocal(_thread,local,dst) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Transform_ent_worldToLocal(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$siblingToChild(_thread, local, dst);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    siblingToChild :function _trc_Transform_siblingToChild(sibling,dst) {
      "use strict";
      var _this=this;
      var copyToSibling;
      
      
      //$LASTPOS=29002442;//kernel.Transform:2442
      if (sibling instanceof Tonyu.classes.kernel.Transform) {
        //$LASTPOS=29002557;//kernel.Transform:2557
        if (dst===sibling) {
          //$LASTPOS=29002591;//kernel.Transform:2591
          copyToSibling=true;
          //$LASTPOS=29002624;//kernel.Transform:2624
          dst=null;
          
        }
        //$LASTPOS=29002654;//kernel.Transform:2654
        if (! dst) {
          //$LASTPOS=29002664;//kernel.Transform:2664
          dst=new Tonyu.classes.kernel.Transform;
        }
        //$LASTPOS=29002692;//kernel.Transform:2692
        _this.siblingToChild(sibling.position,dst.position);
        //$LASTPOS=29002748;//kernel.Transform:2748
        _this.quaternion.inverse.product(sibling.quaternion,dst.quaternion);
        //$LASTPOS=29002820;//kernel.Transform:2820
        dst.scale=sibling.scale/_this.scale;
        //$LASTPOS=29002860;//kernel.Transform:2860
        dst._parent=_this;
        //$LASTPOS=29002887;//kernel.Transform:2887
        if (copyToSibling) {
          //$LASTPOS=29002921;//kernel.Transform:2921
          sibling.set(dst);
          return sibling;
          
        }
        return dst;
        
      }
      //$LASTPOS=29003125;//kernel.Transform:3125
      if (! dst) {
        //$LASTPOS=29003135;//kernel.Transform:3135
        dst=new Tonyu.classes.kernel.Vec3(0,0,0);
      }
      //$LASTPOS=29003161;//kernel.Transform:3161
      dst.set(sibling);
      //$LASTPOS=29003184;//kernel.Transform:3184
      dst.subX(_this.position);
      //$LASTPOS=29003209;//kernel.Transform:3209
      _this.direction.worldToLocal(dst,dst);
      //$LASTPOS=29003247;//kernel.Transform:3247
      dst.divX(_this.scale);
      return dst;
    },
    fiber$siblingToChild :function _trc_Transform_f_siblingToChild(_thread,sibling,dst) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var copyToSibling;
      
      
      
      _thread.enter(function _trc_Transform_ent_siblingToChild(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=29002442;//kernel.Transform:2442
            if (!(sibling instanceof Tonyu.classes.kernel.Transform)) { __pc=3     ; break; }
            //$LASTPOS=29002557;//kernel.Transform:2557
            if (dst===sibling) {
              //$LASTPOS=29002591;//kernel.Transform:2591
              copyToSibling=true;
              //$LASTPOS=29002624;//kernel.Transform:2624
              dst=null;
              
            }
            //$LASTPOS=29002654;//kernel.Transform:2654
            if (! dst) {
              //$LASTPOS=29002664;//kernel.Transform:2664
              dst=new Tonyu.classes.kernel.Transform;
            }
            //$LASTPOS=29002692;//kernel.Transform:2692
            _this.fiber$siblingToChild(_thread, sibling.position, dst.position);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=29002748;//kernel.Transform:2748
            _this.quaternion.inverse.product(sibling.quaternion,dst.quaternion);
            //$LASTPOS=29002820;//kernel.Transform:2820
            dst.scale=sibling.scale/_this.scale;
            //$LASTPOS=29002860;//kernel.Transform:2860
            dst._parent=_this;
            //$LASTPOS=29002887;//kernel.Transform:2887
            if (!(copyToSibling)) { __pc=2     ; break; }
            //$LASTPOS=29002921;//kernel.Transform:2921
            sibling.set(dst);
            _thread.exit(sibling);return;
          case 2     :
            
            _thread.exit(dst);return;
          case 3     :
            
            //$LASTPOS=29003125;//kernel.Transform:3125
            if (! dst) {
              //$LASTPOS=29003135;//kernel.Transform:3135
              dst=new Tonyu.classes.kernel.Vec3(0,0,0);
            }
            //$LASTPOS=29003161;//kernel.Transform:3161
            dst.set(sibling);
            //$LASTPOS=29003184;//kernel.Transform:3184
            dst.subX(_this.position);
            //$LASTPOS=29003209;//kernel.Transform:3209
            _this.direction.worldToLocal(dst,dst);
            //$LASTPOS=29003247;//kernel.Transform:3247
            dst.divX(_this.scale);
            _thread.exit(dst);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    changeScale :function _trc_Transform_changeScale(vec,by) {
      "use strict";
      var _this=this;
      
      return vec.mulX(by);
    },
    fiber$changeScale :function _trc_Transform_f_changeScale(_thread,vec,by) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=vec.mulX(by);return;
      
      
      _thread.retVal=_this;return;
    },
    isSibling :function _trc_Transform_isSibling(sib) {
      "use strict";
      var _this=this;
      
      return sib.parent===_this.parent;
    },
    fiber$isSibling :function _trc_Transform_f_isSibling(_thread,sib) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=sib.parent===_this.parent;return;
      
      
      _thread.retVal=_this;return;
    },
    isParentOf :function _trc_Transform_isParentOf(child) {
      "use strict";
      var _this=this;
      
      return child.parent===_this;
    },
    fiber$isParentOf :function _trc_Transform_f_isParentOf(_thread,child) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=child.parent===_this;return;
      
      
      _thread.retVal=_this;return;
    },
    isChildOf :function _trc_Transform_isChildOf(parent) {
      "use strict";
      var _this=this;
      
      return _this.parent===parent;
    },
    fiber$isChildOf :function _trc_Transform_f_isChildOf(_thread,parent) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.parent===parent;return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"_static":{"nowait":false},"__setter__parent":{"nowait":true},"__getter__parent":{"nowait":true},"__getter__quaternion":{"nowait":true},"new":{"nowait":false},"__getter__isRoot":{"nowait":true},"set":{"nowait":false},"product":{"nowait":false},"parentChanged":{"nowait":false},"localToWorld":{"nowait":false},"childToSibling":{"nowait":false},"worldToLocal":{"nowait":false},"siblingToChild":{"nowait":false},"changeScale":{"nowait":false},"isSibling":{"nowait":false},"isParentOf":{"nowait":false},"isChildOf":{"nowait":false}},"fields":{"actor":{},"_parent":{},"direction":{},"position":{},"scale":{},"id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Vec3',
  shortName: 'Vec3',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_Vec3_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_Vec3_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Vec3_initialize(x,y,z) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=30000080;//kernel.Vec3:80
      if (typeof  x==="object") {
        //$LASTPOS=30000116;//kernel.Vec3:116
        z=x.z;
        //$LASTPOS=30000122;//kernel.Vec3:122
        y=x.y;
        //$LASTPOS=30000128;//kernel.Vec3:128
        x=x.x;
        
      }
      //$LASTPOS=30000147;//kernel.Vec3:147
      _this.x=(typeof  x==="number")?x:0;
      //$LASTPOS=30000189;//kernel.Vec3:189
      _this.y=(typeof  y==="number")?y:0;
      //$LASTPOS=30000231;//kernel.Vec3:231
      _this.z=(typeof  z==="number")?z:0;
    },
    checkNum :function _trc_Vec3_checkNum(o) {
      "use strict";
      var _this=this;
      var name;
      var val;
      var _it_205;
      
      //$LASTPOS=30000292;//kernel.Vec3:292
      _it_205=Tonyu.iterator(o,2);
      while(_it_205.next()) {
        name=_it_205[0];
        val=_it_205[1];
        
        //$LASTPOS=30000327;//kernel.Vec3:327
        if (typeof  val!=="number") {
          throw new Error(name+"("+val+")は数値ではありません．");
          
          
        }
        
      }
    },
    fiber$checkNum :function _trc_Vec3_f_checkNum(_thread,o) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var name;
      var val;
      var _it_205;
      
      //$LASTPOS=30000292;//kernel.Vec3:292
      _it_205=Tonyu.iterator(o,2);
      while(_it_205.next()) {
        name=_it_205[0];
        val=_it_205[1];
        
        //$LASTPOS=30000327;//kernel.Vec3:327
        if (typeof  val!=="number") {
          throw new Error(name+"("+val+")は数値ではありません．");
          
          
        }
        
      }
      
      _thread.retVal=_this;return;
    },
    parsePointArgs :function _trc_Vec3_parsePointArgs(args) {
      "use strict";
      var _this=this;
      var a;
      var p;
      
      //$LASTPOS=30000466;//kernel.Vec3:466
      a = new Tonyu.classes.kernel.ArgParser(args);
      
      //$LASTPOS=30000498;//kernel.Vec3:498
      p = a.shift(Object);
      
      //$LASTPOS=30000526;//kernel.Vec3:526
      if (! p) {
        //$LASTPOS=30000545;//kernel.Vec3:545
        p={};
        //$LASTPOS=30000560;//kernel.Vec3:560
        p.x=a.shift();
        //$LASTPOS=30000584;//kernel.Vec3:584
        p.y=a.shift();
        //$LASTPOS=30000608;//kernel.Vec3:608
        p.z=a.shift()||0;
        
      }
      return p;
    },
    fiber$parsePointArgs :function _trc_Vec3_f_parsePointArgs(_thread,args) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      var p;
      
      //$LASTPOS=30000466;//kernel.Vec3:466
      a = new Tonyu.classes.kernel.ArgParser(args);
      
      //$LASTPOS=30000498;//kernel.Vec3:498
      p = a.shift(Object);
      
      //$LASTPOS=30000526;//kernel.Vec3:526
      if (! p) {
        //$LASTPOS=30000545;//kernel.Vec3:545
        p={};
        //$LASTPOS=30000560;//kernel.Vec3:560
        p.x=a.shift();
        //$LASTPOS=30000584;//kernel.Vec3:584
        p.y=a.shift();
        //$LASTPOS=30000608;//kernel.Vec3:608
        p.z=a.shift()||0;
        
      }
      _thread.retVal=p;return;
      
      
      _thread.retVal=_this;return;
    },
    addX :function _trc_Vec3_addX() {
      "use strict";
      var _this=this;
      var p;
      
      //$LASTPOS=30000675;//kernel.Vec3:675
      p = _this.parsePointArgs(arguments);
      
      //$LASTPOS=30000713;//kernel.Vec3:713
      _this.x+=p.x;
      //$LASTPOS=30000726;//kernel.Vec3:726
      _this.y+=p.y;
      //$LASTPOS=30000739;//kernel.Vec3:739
      _this.z+=p.z;
      return _this;
    },
    fiber$addX :function _trc_Vec3_f_addX(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var p;
      
      
      _thread.enter(function _trc_Vec3_ent_addX(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=30000675;//kernel.Vec3:675
            _this.fiber$parsePointArgs(_thread, _arguments);
            __pc=1;return;
          case 1:
            p=_thread.retVal;
            
            //$LASTPOS=30000713;//kernel.Vec3:713
            _this.x+=p.x;
            //$LASTPOS=30000726;//kernel.Vec3:726
            _this.y+=p.y;
            //$LASTPOS=30000739;//kernel.Vec3:739
            _this.z+=p.z;
            _thread.exit(_this);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    subX :function _trc_Vec3_subX() {
      "use strict";
      var _this=this;
      var p;
      
      //$LASTPOS=30000792;//kernel.Vec3:792
      p = _this.parsePointArgs(arguments);
      
      //$LASTPOS=30000830;//kernel.Vec3:830
      _this.x-=p.x;
      //$LASTPOS=30000843;//kernel.Vec3:843
      _this.y-=p.y;
      //$LASTPOS=30000856;//kernel.Vec3:856
      _this.z-=p.z;
      return _this;
    },
    fiber$subX :function _trc_Vec3_f_subX(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var p;
      
      
      _thread.enter(function _trc_Vec3_ent_subX(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=30000792;//kernel.Vec3:792
            _this.fiber$parsePointArgs(_thread, _arguments);
            __pc=1;return;
          case 1:
            p=_thread.retVal;
            
            //$LASTPOS=30000830;//kernel.Vec3:830
            _this.x-=p.x;
            //$LASTPOS=30000843;//kernel.Vec3:843
            _this.y-=p.y;
            //$LASTPOS=30000856;//kernel.Vec3:856
            _this.z-=p.z;
            _thread.exit(_this);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    mulX :function _trc_Vec3_mulX(k) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=30000912;//kernel.Vec3:912
      _this.x=_this.x*k;
      //$LASTPOS=30000924;//kernel.Vec3:924
      _this.y=_this.y*k;
      //$LASTPOS=30000936;//kernel.Vec3:936
      _this.z=_this.z*k;
      return _this;
    },
    fiber$mulX :function _trc_Vec3_f_mulX(_thread,k) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=30000912;//kernel.Vec3:912
      _this.x=_this.x*k;
      //$LASTPOS=30000924;//kernel.Vec3:924
      _this.y=_this.y*k;
      //$LASTPOS=30000936;//kernel.Vec3:936
      _this.z=_this.z*k;
      _thread.retVal=_this;return;
      
      
      _thread.retVal=_this;return;
    },
    divX :function _trc_Vec3_divX(k) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=30000989;//kernel.Vec3:989
      _this.x=_this.x/k;
      //$LASTPOS=30001001;//kernel.Vec3:1001
      _this.y=_this.y/k;
      //$LASTPOS=30001013;//kernel.Vec3:1013
      _this.z=_this.z/k;
      return _this;
    },
    fiber$divX :function _trc_Vec3_f_divX(_thread,k) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=30000989;//kernel.Vec3:989
      _this.x=_this.x/k;
      //$LASTPOS=30001001;//kernel.Vec3:1001
      _this.y=_this.y/k;
      //$LASTPOS=30001013;//kernel.Vec3:1013
      _this.z=_this.z/k;
      _thread.retVal=_this;return;
      
      
      _thread.retVal=_this;return;
    },
    add :function _trc_Vec3_add(x,y,z) {
      "use strict";
      var _this=this;
      
      return _this.clone().addX(x,y,z);
    },
    fiber$add :function _trc_Vec3_f_add(_thread,x,y,z) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.clone().addX(x,y,z);return;
      
      
      _thread.retVal=_this;return;
    },
    sub :function _trc_Vec3_sub(x,y,z) {
      "use strict";
      var _this=this;
      
      return _this.clone().subX(x,y,z);
    },
    fiber$sub :function _trc_Vec3_f_sub(_thread,x,y,z) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.clone().subX(x,y,z);return;
      
      
      _thread.retVal=_this;return;
    },
    mul :function _trc_Vec3_mul(k) {
      "use strict";
      var _this=this;
      
      return _this.clone().mulX(k);
    },
    fiber$mul :function _trc_Vec3_f_mul(_thread,k) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.clone().mulX(k);return;
      
      
      _thread.retVal=_this;return;
    },
    div :function _trc_Vec3_div(k) {
      "use strict";
      var _this=this;
      
      return _this.clone().divX(k);
    },
    fiber$div :function _trc_Vec3_f_div(_thread,k) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.clone().divX(k);return;
      
      
      _thread.retVal=_this;return;
    },
    clone :function _trc_Vec3_clone() {
      "use strict";
      var _this=this;
      
      return new Tonyu.classes.kernel.Vec3(_this.x,_this.y,_this.z);
    },
    fiber$clone :function _trc_Vec3_f_clone(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=new Tonyu.classes.kernel.Vec3(_this.x,_this.y,_this.z);return;
      
      
      _thread.retVal=_this;return;
    },
    set :function _trc_Vec3_set(x,y,z) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=30002810;//kernel.Vec3:2810
      if (typeof  x==="object") {
        //$LASTPOS=30002846;//kernel.Vec3:2846
        y=x.y;
        //$LASTPOS=30002862;//kernel.Vec3:2862
        z=x.z;
        //$LASTPOS=30002878;//kernel.Vec3:2878
        x=x.x;
        
      }
      //$LASTPOS=30002897;//kernel.Vec3:2897
      if (typeof  x==="number") {
        //$LASTPOS=30002922;//kernel.Vec3:2922
        _this.x=x;
      }
      //$LASTPOS=30002937;//kernel.Vec3:2937
      if (typeof  y==="number") {
        //$LASTPOS=30002962;//kernel.Vec3:2962
        _this.y=y;
      }
      //$LASTPOS=30002977;//kernel.Vec3:2977
      if (typeof  z==="number") {
        //$LASTPOS=30003002;//kernel.Vec3:3002
        _this.z=z;
      }
      return _this;
    },
    fiber$set :function _trc_Vec3_f_set(_thread,x,y,z) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=30002810;//kernel.Vec3:2810
      if (typeof  x==="object") {
        //$LASTPOS=30002846;//kernel.Vec3:2846
        y=x.y;
        //$LASTPOS=30002862;//kernel.Vec3:2862
        z=x.z;
        //$LASTPOS=30002878;//kernel.Vec3:2878
        x=x.x;
        
      }
      //$LASTPOS=30002897;//kernel.Vec3:2897
      if (typeof  x==="number") {
        //$LASTPOS=30002922;//kernel.Vec3:2922
        _this.x=x;
      }
      //$LASTPOS=30002937;//kernel.Vec3:2937
      if (typeof  y==="number") {
        //$LASTPOS=30002962;//kernel.Vec3:2962
        _this.y=y;
      }
      //$LASTPOS=30002977;//kernel.Vec3:2977
      if (typeof  z==="number") {
        //$LASTPOS=30003002;//kernel.Vec3:3002
        _this.z=z;
      }
      _thread.retVal=_this;return;
      
      
      _thread.retVal=_this;return;
    },
    setTo :function _trc_Vec3_setTo(t) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=30001416;//kernel.Vec3:1416
      t.x=_this.x;
      //$LASTPOS=30001428;//kernel.Vec3:1428
      t.y=_this.y;
      //$LASTPOS=30001440;//kernel.Vec3:1440
      t.z=_this.z;
    },
    fiber$setTo :function _trc_Vec3_f_setTo(_thread,t) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=30001416;//kernel.Vec3:1416
      t.x=_this.x;
      //$LASTPOS=30001428;//kernel.Vec3:1428
      t.y=_this.y;
      //$LASTPOS=30001440;//kernel.Vec3:1440
      t.z=_this.z;
      
      _thread.retVal=_this;return;
    },
    addTo :function _trc_Vec3_addTo(t) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=30001468;//kernel.Vec3:1468
      t.x+=_this.x;
      //$LASTPOS=30001481;//kernel.Vec3:1481
      t.y+=_this.y;
      //$LASTPOS=30001494;//kernel.Vec3:1494
      t.z+=_this.z;
    },
    fiber$addTo :function _trc_Vec3_f_addTo(_thread,t) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=30001468;//kernel.Vec3:1468
      t.x+=_this.x;
      //$LASTPOS=30001481;//kernel.Vec3:1481
      t.y+=_this.y;
      //$LASTPOS=30001494;//kernel.Vec3:1494
      t.z+=_this.z;
      
      _thread.retVal=_this;return;
    },
    dist :function _trc_Vec3_dist(vec) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=30001524;//kernel.Vec3:1524
      if (vec) {
        return _this.sub(vec).dist();
      }
      return _this.sqrt(_this.x*_this.x+_this.y*_this.y+_this.z*_this.z);
    },
    __getter__length :function _trc_Vec3___getter__length() {
      "use strict";
      var _this=this;
      
      return _this.sqrt(_this.x*_this.x+_this.y*_this.y+_this.z*_this.z);
    },
    __setter__length :function _trc_Vec3___setter__length(l) {
      "use strict";
      var _this=this;
      
      return _this.normalizeX().mulX(l);
    },
    slerp :function _trc_Vec3_slerp(to,t) {
      "use strict";
      var _this=this;
      
      return _this.mul(1-t).addX(to.mul(t));
    },
    fiber$slerp :function _trc_Vec3_f_slerp(_thread,to,t) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.mul(1-t).addX(to.mul(t));return;
      
      
      _thread.retVal=_this;return;
    },
    normalizeX :function _trc_Vec3_normalizeX(len) {
      "use strict";
      var _this=this;
      var l;
      
      //$LASTPOS=30001768;//kernel.Vec3:1768
      l = _this.length;
      
      //$LASTPOS=30001784;//kernel.Vec3:1784
      if (l==0) {
        return _this;
      }
      //$LASTPOS=30001809;//kernel.Vec3:1809
      len=(typeof  len==="number")?len:1;
      //$LASTPOS=30001849;//kernel.Vec3:1849
      _this.x*=len/l;
      //$LASTPOS=30001864;//kernel.Vec3:1864
      _this.y*=len/l;
      //$LASTPOS=30001879;//kernel.Vec3:1879
      _this.z*=len/l;
      return _this;
    },
    fiber$normalizeX :function _trc_Vec3_f_normalizeX(_thread,len) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var l;
      
      //$LASTPOS=30001768;//kernel.Vec3:1768
      l = _this.length;
      
      //$LASTPOS=30001784;//kernel.Vec3:1784
      if (l==0) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=30001809;//kernel.Vec3:1809
      len=(typeof  len==="number")?len:1;
      //$LASTPOS=30001849;//kernel.Vec3:1849
      _this.x*=len/l;
      //$LASTPOS=30001864;//kernel.Vec3:1864
      _this.y*=len/l;
      //$LASTPOS=30001879;//kernel.Vec3:1879
      _this.z*=len/l;
      _thread.retVal=_this;return;
      
      
      _thread.retVal=_this;return;
    },
    normalize :function _trc_Vec3_normalize(len) {
      "use strict";
      var _this=this;
      
      return _this.clone().normalizeX(len);
    },
    fiber$normalize :function _trc_Vec3_f_normalize(_thread,len) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.clone().normalizeX(len);return;
      
      
      _thread.retVal=_this;return;
    },
    productX :function _trc_Vec3_productX() {
      "use strict";
      var _this=this;
      var a;
      var b;
      var i;
      var j;
      var k;
      
      //$LASTPOS=30002012;//kernel.Vec3:2012
      a = _this;
      
      //$LASTPOS=30002029;//kernel.Vec3:2029
      b = _this.parsePointArgs(arguments);
      
      //$LASTPOS=30002067;//kernel.Vec3:2067
      i = a.y*b.z-a.z*b.y;
      
      //$LASTPOS=30002095;//kernel.Vec3:2095
      j = a.z*b.x-a.x*b.z;
      
      //$LASTPOS=30002123;//kernel.Vec3:2123
      k = a.x*b.y-a.y*b.x;
      
      //$LASTPOS=30002151;//kernel.Vec3:2151
      a.x=i;
      //$LASTPOS=30002163;//kernel.Vec3:2163
      a.y=j;
      //$LASTPOS=30002175;//kernel.Vec3:2175
      a.z=k;
      //$LASTPOS=30002187;//kernel.Vec3:2187
      if (Tonyu.globals.$fixProductOrder) {
        return a;
      }
      return a.mul(- 1);
    },
    fiber$productX :function _trc_Vec3_f_productX(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      var b;
      var i;
      var j;
      var k;
      
      //$LASTPOS=30002012;//kernel.Vec3:2012
      a = _this;
      
      
      _thread.enter(function _trc_Vec3_ent_productX(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=30002029;//kernel.Vec3:2029
            _this.fiber$parsePointArgs(_thread, _arguments);
            __pc=1;return;
          case 1:
            b=_thread.retVal;
            
            //$LASTPOS=30002067;//kernel.Vec3:2067
            i = a.y*b.z-a.z*b.y;
            
            //$LASTPOS=30002095;//kernel.Vec3:2095
            j = a.z*b.x-a.x*b.z;
            
            //$LASTPOS=30002123;//kernel.Vec3:2123
            k = a.x*b.y-a.y*b.x;
            
            //$LASTPOS=30002151;//kernel.Vec3:2151
            a.x=i;
            //$LASTPOS=30002163;//kernel.Vec3:2163
            a.y=j;
            //$LASTPOS=30002175;//kernel.Vec3:2175
            a.z=k;
            //$LASTPOS=30002187;//kernel.Vec3:2187
            if (!(Tonyu.globals.$fixProductOrder)) { __pc=2     ; break; }
            _thread.exit(a);return;
          case 2     :
            
            _thread.exit(a.mul(- 1));return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    product :function _trc_Vec3_product(x,y,z) {
      "use strict";
      var _this=this;
      
      return _this.clone().productX(x,y,z);
    },
    fiber$product :function _trc_Vec3_f_product(_thread,x,y,z) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.clone().productX(x,y,z);return;
      
      
      _thread.retVal=_this;return;
    },
    innerProduct :function _trc_Vec3_innerProduct() {
      "use strict";
      var _this=this;
      var a;
      
      //$LASTPOS=30002328;//kernel.Vec3:2328
      a = _this.parsePointArgs(arguments);
      
      return _this.x*a.x+_this.y*a.y+_this.z*a.z;
    },
    fiber$innerProduct :function _trc_Vec3_f_innerProduct(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      
      
      _thread.enter(function _trc_Vec3_ent_innerProduct(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=30002328;//kernel.Vec3:2328
            _this.fiber$parsePointArgs(_thread, _arguments);
            __pc=1;return;
          case 1:
            a=_thread.retVal;
            
            _thread.exit(_this.x*a.x+_this.y*a.y+_this.z*a.z);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    __getter__angleXY :function _trc_Vec3___getter__angleXY() {
      "use strict";
      var _this=this;
      
      return _this.atanxy(_this.x,_this.y);
    },
    __setter__angleXY :function _trc_Vec3___setter__angleXY(a) {
      "use strict";
      var _this=this;
      var l;
      
      //$LASTPOS=30002454;//kernel.Vec3:2454
      l = Tonyu.globals.$Math.sqrt(_this.x*_this.x+_this.y*_this.y);
      
      //$LASTPOS=30002486;//kernel.Vec3:2486
      _this.x=_this.cos(a)*l;
      //$LASTPOS=30002503;//kernel.Vec3:2503
      _this.y=_this.sin(a)*l;
      return a;
    },
    rotate :function _trc_Vec3_rotate(angle,axis) {
      "use strict";
      var _this=this;
      var v90;
      
      //$LASTPOS=30002564;//kernel.Vec3:2564
      if (! axis) {
        //$LASTPOS=30002575;//kernel.Vec3:2575
        axis=new Tonyu.classes.kernel.Vec3(0,0,Tonyu.globals.$fixProductOrder?- 1:1);
      }
      //$LASTPOS=30002622;//kernel.Vec3:2622
      v90 = _this.product(axis);
      
      //$LASTPOS=30002650;//kernel.Vec3:2650
      v90.length=_this.length;
      return _this.mul(_this.cos(angle)).add(v90.mul(_this.sin(angle)));
    },
    fiber$rotate :function _trc_Vec3_f_rotate(_thread,angle,axis) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var v90;
      
      //$LASTPOS=30002564;//kernel.Vec3:2564
      if (! axis) {
        //$LASTPOS=30002575;//kernel.Vec3:2575
        axis=new Tonyu.classes.kernel.Vec3(0,0,Tonyu.globals.$fixProductOrder?- 1:1);
      }
      
      _thread.enter(function _trc_Vec3_ent_rotate(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=30002622;//kernel.Vec3:2622
            _this.fiber$product(_thread, axis);
            __pc=1;return;
          case 1:
            v90=_thread.retVal;
            
            //$LASTPOS=30002650;//kernel.Vec3:2650
            v90.length=_this.length;
            _thread.exit(_this.mul(_this.cos(angle)).add(v90.mul(_this.sin(angle))));return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    rotateX :function _trc_Vec3_rotateX(angle,axis) {
      "use strict";
      var _this=this;
      
      return _this.set(_this.rotate(angle,axis));
    },
    fiber$rotateX :function _trc_Vec3_f_rotateX(_thread,angle,axis) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Vec3_ent_rotateX(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$set(_thread, _this.rotate(angle,axis));
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    toString :function _trc_Vec3_toString() {
      "use strict";
      var _this=this;
      
      return "("+[_this.x,_this.y,_this.z].join(",")+")";
    },
    fiber$toString :function _trc_Vec3_f_toString(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal="("+[_this.x,_this.y,_this.z].join(",")+")";return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"checkNum":{"nowait":false},"parsePointArgs":{"nowait":false},"addX":{"nowait":false},"subX":{"nowait":false},"mulX":{"nowait":false},"divX":{"nowait":false},"add":{"nowait":false},"sub":{"nowait":false},"mul":{"nowait":false},"div":{"nowait":false},"clone":{"nowait":false},"set":{"nowait":false},"setTo":{"nowait":false},"addTo":{"nowait":false},"dist":{"nowait":true},"__getter__length":{"nowait":true},"__setter__length":{"nowait":true},"slerp":{"nowait":false},"normalizeX":{"nowait":false},"normalize":{"nowait":false},"productX":{"nowait":false},"product":{"nowait":false},"innerProduct":{"nowait":false},"__getter__angleXY":{"nowait":true},"__setter__angleXY":{"nowait":true},"rotate":{"nowait":false},"rotateX":{"nowait":false},"toString":{"nowait":false}},"fields":{"z":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Vec3View',
  shortName: 'Vec3View',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Vec3,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_Vec3View_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_Vec3View_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Vec3View_initialize(target,attrs) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=31000060;//kernel.Vec3View:60
      _this.target=target;
      //$LASTPOS=31000085;//kernel.Vec3View:85
      _this.attrs=attrs||{x: "x",y: "y",z: "z"};
    },
    __getter__x :function _trc_Vec3View___getter__x() {
      "use strict";
      var _this=this;
      
      return _this.target[_this.attrs.x]||0;
    },
    __getter__y :function _trc_Vec3View___getter__y() {
      "use strict";
      var _this=this;
      
      return _this.target[_this.attrs.y]||0;
    },
    __getter__z :function _trc_Vec3View___getter__z() {
      "use strict";
      var _this=this;
      
      return _this.target[_this.attrs.z]||0;
    },
    __setter__x :function _trc_Vec3View___setter__x(v) {
      "use strict";
      var _this=this;
      
      return _this.target[_this.attrs.x]=v;
    },
    __setter__y :function _trc_Vec3View___setter__y(v) {
      "use strict";
      var _this=this;
      
      return _this.target[_this.attrs.y]=v;
    },
    __setter__z :function _trc_Vec3View___setter__z(v) {
      "use strict";
      var _this=this;
      
      return _this.target[_this.attrs.z]=v;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"__getter__x":{"nowait":true},"__getter__y":{"nowait":true},"__getter__z":{"nowait":true},"__setter__x":{"nowait":true},"__setter__y":{"nowait":true},"__setter__z":{"nowait":true}},"fields":{"target":{},"attrs":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.AnimMod',
  shortName: 'AnimMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.SpriteMod,Tonyu.classes.kernel.SchedulerMod,Tonyu.classes.kernel.ParallelMod],
  methods: {
    main :function _trc_AnimMod_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=32000061;//kernel.AnimMod:61
      "field strict";
      
    },
    fiber$main :function _trc_AnimMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=32000061;//kernel.AnimMod:61
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    initAnimMod :function _trc_AnimMod_initAnimMod() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=32000139;//kernel.AnimMod:139
      if (_this.anim instanceof Array) {
        //$LASTPOS=32000176;//kernel.AnimMod:176
        _this.startAnim();
        
      } else {
        //$LASTPOS=32000210;//kernel.AnimMod:210
        _this.animMode=false;
        
      }
      //$LASTPOS=32000238;//kernel.AnimMod:238
      if (_this.animFps==null) {
        //$LASTPOS=32000257;//kernel.AnimMod:257
        _this.animFps=1;
      }
    },
    fiber$initAnimMod :function _trc_AnimMod_f_initAnimMod(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=32000139;//kernel.AnimMod:139
      if (_this.anim instanceof Array) {
        //$LASTPOS=32000176;//kernel.AnimMod:176
        _this.startAnim();
        
      } else {
        //$LASTPOS=32000210;//kernel.AnimMod:210
        _this.animMode=false;
        
      }
      //$LASTPOS=32000238;//kernel.AnimMod:238
      if (_this.animFps==null) {
        //$LASTPOS=32000257;//kernel.AnimMod:257
        _this.animFps=1;
      }
      
      _thread.retVal=_this;return;
    },
    setAnimFps :function _trc_AnimMod_setAnimFps(f) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=32000300;//kernel.AnimMod:300
      _this.animFps=f;
      //$LASTPOS=32000316;//kernel.AnimMod:316
      _this.animFrame=0;
      //$LASTPOS=32000334;//kernel.AnimMod:334
      _this.startAnim();
    },
    startAnim :function _trc_AnimMod_startAnim() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=32000377;//kernel.AnimMod:377
      if (! _this.animMode) {
        //$LASTPOS=32000403;//kernel.AnimMod:403
        _this.animMode=_this.parallel(Tonyu.bindFunc(_this,_this._animation));
        //$LASTPOS=32000443;//kernel.AnimMod:443
        _this.animFrame=_this.animFrame||0;
        
      }
    },
    stopAnim :function _trc_AnimMod_stopAnim() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=32000503;//kernel.AnimMod:503
      if (_this.animMode) {
        //$LASTPOS=32000528;//kernel.AnimMod:528
        _this.animMode.kill();
        //$LASTPOS=32000554;//kernel.AnimMod:554
        _this.animMode=null;
        
      }
    },
    _animation :function _trc_AnimMod__animation() {
      "use strict";
      var _this=this;
      var age;
      
      //$LASTPOS=32000600;//kernel.AnimMod:600
      age = 0;
      
      //$LASTPOS=32000616;//kernel.AnimMod:616
      while (true) {
        //$LASTPOS=32000639;//kernel.AnimMod:639
        age++;
        //$LASTPOS=32000655;//kernel.AnimMod:655
        if (age%_this.animFps==0&&_this.anim instanceof Array) {
          //$LASTPOS=32000714;//kernel.AnimMod:714
          _this.p=_this.anim[_this.animFrame%_this.anim.length];
          //$LASTPOS=32000758;//kernel.AnimMod:758
          _this.animFrame++;
          
        }
        //$LASTPOS=32000791;//kernel.AnimMod:791
        _this.update();
        
      }
    },
    fiber$_animation :function _trc_AnimMod_f__animation(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var age;
      
      //$LASTPOS=32000600;//kernel.AnimMod:600
      age = 0;
      
      
      _thread.enter(function _trc_AnimMod_ent__animation(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=32000616;//kernel.AnimMod:616
          case 1:
            //$LASTPOS=32000639;//kernel.AnimMod:639
            age++;
            //$LASTPOS=32000655;//kernel.AnimMod:655
            if (age%_this.animFps==0&&_this.anim instanceof Array) {
              //$LASTPOS=32000714;//kernel.AnimMod:714
              _this.p=_this.anim[_this.animFrame%_this.anim.length];
              //$LASTPOS=32000758;//kernel.AnimMod:758
              _this.animFrame++;
              
            }
            //$LASTPOS=32000791;//kernel.AnimMod:791
            _this.fiber$update(_thread);
            __pc=2;return;
          case 2:
            
            __pc=1;break;
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"initAnimMod":{"nowait":false},"setAnimFps":{"nowait":true},"startAnim":{"nowait":true},"stopAnim":{"nowait":true},"_animation":{"nowait":false}},"fields":{"anim":{},"animMode":{},"animFrame":{},"animFps":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Color',
  shortName: 'Color',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_Color_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_Color_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Color_initialize() {
      "use strict";
      var _this=this;
      var a;
      var s;
      var rgba;
      var p;
      var x;
      var y;
      
      //$LASTPOS=33000061;//kernel.Color:61
      a = new Tonyu.classes.kernel.ArgParser(arguments);
      
      
      
      //$LASTPOS=33000116;//kernel.Color:116
      _this.maxs={r: 255,g: 255,b: 255,a: 255,h: 360,s: 1,l: 1};
      //$LASTPOS=33000164;//kernel.Color:164
      p = a.peek(0);
      
      //$LASTPOS=33000183;//kernel.Color:183
      if (p&&p.height&&p.width&&p.data) {
        //$LASTPOS=33000228;//kernel.Color:228
        _this.imageData=a.shift();
        //$LASTPOS=33000252;//kernel.Color:252
        x = a.shift();
        
        //$LASTPOS=33000272;//kernel.Color:272
        y = a.shift();
        
        //$LASTPOS=33000292;//kernel.Color:292
        _this.index=(x+y*p.width)*4;
        //$LASTPOS=33000318;//kernel.Color:318
        _this.value={};
        return _this;
        
      }
      //$LASTPOS=33000345;//kernel.Color:345
      if (s=a.shift("string")) {
        //$LASTPOS=33000375;//kernel.Color:375
        _this.type="name";
        //$LASTPOS=33000391;//kernel.Color:391
        _this.value={name: s};
        
      } else {
        //$LASTPOS=33000416;//kernel.Color:416
        if (s=a.shift("object")) {
          //$LASTPOS=33000446;//kernel.Color:446
          if (typeof  s.r=="number") {
            //$LASTPOS=33000478;//kernel.Color:478
            _this.type="rgba";
            //$LASTPOS=33000495;//kernel.Color:495
            _this.value=s;
            //$LASTPOS=33000508;//kernel.Color:508
            _this.fillNum("g","b","a");
            
          } else {
            //$LASTPOS=33000540;//kernel.Color:540
            if (typeof  s.h=="number") {
              //$LASTPOS=33000572;//kernel.Color:572
              _this.type="hsl";
              //$LASTPOS=33000588;//kernel.Color:588
              _this.value=s;
              //$LASTPOS=33000601;//kernel.Color:601
              _this.fillNum("s","l","a");
              
            } else {
              throw new Error("Invalid color spec");
              
              
            }
          }
          
        } else {
          //$LASTPOS=33000692;//kernel.Color:692
          if ((s=a.shift("number"))!=null) {
            //$LASTPOS=33000732;//kernel.Color:732
            _this.type="rgba";
            //$LASTPOS=33000748;//kernel.Color:748
            _this.value={r: s};
            //$LASTPOS=33000764;//kernel.Color:764
            _this.value.g=a.shift();
            //$LASTPOS=33000786;//kernel.Color:786
            _this.value.b=a.shift();
            //$LASTPOS=33000808;//kernel.Color:808
            _this.value.a=a.shift();
            //$LASTPOS=33000830;//kernel.Color:830
            _this.fillNum("g","b","a");
            
          } else {
            throw new Error("Invalid color spec");
            
            
          }
        }
      }
    },
    fillNum :function _trc_Color_fillNum() {
      "use strict";
      var _this=this;
      var a;
      var k;
      var _it_229;
      
      //$LASTPOS=33000928;//kernel.Color:928
      a = new Tonyu.classes.kernel.ArgParser(arguments);
      
      //$LASTPOS=33000962;//kernel.Color:962
      _it_229=Tonyu.iterator(a.toArray(),1);
      while(_it_229.next()) {
        k=_it_229[0];
        
        //$LASTPOS=33000994;//kernel.Color:994
        if (_this.value[k]==null) {
          //$LASTPOS=33001014;//kernel.Color:1014
          _this.value[k]=(k=="a"?_this.maxs.a:0);
        }
        
      }
    },
    fiber$fillNum :function _trc_Color_f_fillNum(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      var k;
      var _it_229;
      
      //$LASTPOS=33000928;//kernel.Color:928
      a = new Tonyu.classes.kernel.ArgParser(_arguments);
      
      //$LASTPOS=33000962;//kernel.Color:962
      _it_229=Tonyu.iterator(a.toArray(),1);
      while(_it_229.next()) {
        k=_it_229[0];
        
        //$LASTPOS=33000994;//kernel.Color:994
        if (_this.value[k]==null) {
          //$LASTPOS=33001014;//kernel.Color:1014
          _this.value[k]=(k=="a"?_this.maxs.a:0);
        }
        
      }
      
      _thread.retVal=_this;return;
    },
    __getter__r :function _trc_Color___getter__r() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33001057;//kernel.Color:1057
      _this.makeRGBA();
      //$LASTPOS=33001071;//kernel.Color:1071
      if (_this.imageData) {
        return _this.imageData.data[_this.index];
      }
      return _this.value.r;
    },
    __getter__g :function _trc_Color___getter__g() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33001145;//kernel.Color:1145
      _this.makeRGBA();
      //$LASTPOS=33001159;//kernel.Color:1159
      if (_this.imageData) {
        return _this.imageData.data[_this.index+1];
      }
      return _this.value.g;
    },
    __getter__b :function _trc_Color___getter__b() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33001235;//kernel.Color:1235
      _this.makeRGBA();
      //$LASTPOS=33001249;//kernel.Color:1249
      if (_this.imageData) {
        return _this.imageData.data[_this.index+2];
      }
      return _this.value.b;
    },
    __getter__a :function _trc_Color___getter__a() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33001325;//kernel.Color:1325
      if (_this.imageData) {
        return _this.imageData.data[_this.index+3];
      }
      return _this.value.a;
    },
    __setter__a :function _trc_Color___setter__a(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33001403;//kernel.Color:1403
      _this.clearName();
      //$LASTPOS=33001418;//kernel.Color:1418
      v=_this.clamp(v,0,_this.maxs.a);
      //$LASTPOS=33001441;//kernel.Color:1441
      if (_this.imageData) {
        //$LASTPOS=33001456;//kernel.Color:1456
        _this.imageData.data[_this.index+3]=v;
      } else {
        //$LASTPOS=33001490;//kernel.Color:1490
        _this.value.a=v;
      }
    },
    __setter__r :function _trc_Color___setter__r(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33001516;//kernel.Color:1516
      _this.makeRGBA();
      //$LASTPOS=33001530;//kernel.Color:1530
      _this.clearName();
      //$LASTPOS=33001545;//kernel.Color:1545
      _this.clearHSLA();
      //$LASTPOS=33001560;//kernel.Color:1560
      v=_this.clamp(v,0,_this.maxs.r);
      //$LASTPOS=33001583;//kernel.Color:1583
      if (_this.imageData) {
        //$LASTPOS=33001598;//kernel.Color:1598
        _this.imageData.data[_this.index]=v;
      } else {
        //$LASTPOS=33001630;//kernel.Color:1630
        _this.value.r=v;
      }
    },
    __setter__g :function _trc_Color___setter__g(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33001654;//kernel.Color:1654
      _this.makeRGBA();
      //$LASTPOS=33001668;//kernel.Color:1668
      _this.clearName();
      //$LASTPOS=33001683;//kernel.Color:1683
      _this.clearHSLA();
      //$LASTPOS=33001698;//kernel.Color:1698
      v=_this.clamp(v,0,_this.maxs.g);
      //$LASTPOS=33001721;//kernel.Color:1721
      if (_this.imageData) {
        //$LASTPOS=33001736;//kernel.Color:1736
        _this.imageData.data[_this.index+1]=v;
      }
      //$LASTPOS=33001765;//kernel.Color:1765
      _this.value.g=v;
    },
    __setter__b :function _trc_Color___setter__b(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33001789;//kernel.Color:1789
      _this.makeRGBA();
      //$LASTPOS=33001803;//kernel.Color:1803
      _this.clearName();
      //$LASTPOS=33001818;//kernel.Color:1818
      _this.clearHSLA();
      //$LASTPOS=33001833;//kernel.Color:1833
      v=_this.clamp(v,0,_this.maxs.b);
      //$LASTPOS=33001856;//kernel.Color:1856
      if (_this.imageData) {
        //$LASTPOS=33001871;//kernel.Color:1871
        _this.imageData.data[_this.index+2]=v;
      }
      //$LASTPOS=33001900;//kernel.Color:1900
      _this.value.b=v;
    },
    __getter__h :function _trc_Color___getter__h() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33001924;//kernel.Color:1924
      _this.makeHSLA();
      return _this.value.h;
    },
    __getter__s :function _trc_Color___getter__s() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33001965;//kernel.Color:1965
      _this.makeHSLA();
      return _this.value.s;
    },
    __getter__l :function _trc_Color___getter__l() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33002006;//kernel.Color:2006
      _this.makeHSLA();
      return _this.value.l;
    },
    __setter__h :function _trc_Color___setter__h(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33002049;//kernel.Color:2049
      _this.makeHSLA();
      //$LASTPOS=33002063;//kernel.Color:2063
      _this.clearName();
      //$LASTPOS=33002078;//kernel.Color:2078
      _this.value.h=_this.amod(v,360);
      //$LASTPOS=33002101;//kernel.Color:2101
      if (_this.imageData) {
        //$LASTPOS=33002116;//kernel.Color:2116
        _this.makeRGBA(true);
      } else {
        //$LASTPOS=33002139;//kernel.Color:2139
        _this.clearRGBA();
      }
    },
    __setter__s :function _trc_Color___setter__s(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33002165;//kernel.Color:2165
      _this.makeHSLA();
      //$LASTPOS=33002179;//kernel.Color:2179
      _this.clearName();
      //$LASTPOS=33002194;//kernel.Color:2194
      _this.value.s=_this.clamp(v,0,_this.maxs.s);
      //$LASTPOS=33002223;//kernel.Color:2223
      if (_this.imageData) {
        //$LASTPOS=33002238;//kernel.Color:2238
        _this.makeRGBA(true);
      } else {
        //$LASTPOS=33002261;//kernel.Color:2261
        _this.clearRGBA();
      }
    },
    __setter__l :function _trc_Color___setter__l(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33002287;//kernel.Color:2287
      _this.makeHSLA();
      //$LASTPOS=33002301;//kernel.Color:2301
      _this.clearName();
      //$LASTPOS=33002316;//kernel.Color:2316
      _this.value.l=_this.clamp(v,0,_this.maxs.l);
      //$LASTPOS=33002345;//kernel.Color:2345
      if (_this.imageData) {
        //$LASTPOS=33002360;//kernel.Color:2360
        _this.makeRGBA(true);
      } else {
        //$LASTPOS=33002383;//kernel.Color:2383
        _this.clearRGBA();
      }
    },
    setHSLA :function _trc_Color_setHSLA(h,s,l,a) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33002422;//kernel.Color:2422
      _this.value.h=h;
      //$LASTPOS=33002435;//kernel.Color:2435
      _this.value.s=s;
      //$LASTPOS=33002448;//kernel.Color:2448
      _this.value.l=l;
      //$LASTPOS=33002461;//kernel.Color:2461
      if (typeof  a==="number") {
        //$LASTPOS=33002490;//kernel.Color:2490
        if (_this.imageData) {
          //$LASTPOS=33002511;//kernel.Color:2511
          _this.imageData.data[_this.index+3]=a;
          
        } else {
          //$LASTPOS=33002548;//kernel.Color:2548
          _this.value.a=a;
        }
        
      }
      //$LASTPOS=33002565;//kernel.Color:2565
      if (_this.imageData) {
        //$LASTPOS=33002580;//kernel.Color:2580
        _this.makeRGBA(true);
      } else {
        //$LASTPOS=33002603;//kernel.Color:2603
        _this.clearRGBA();
      }
      return true;
    },
    fiber$setHSLA :function _trc_Color_f_setHSLA(_thread,h,s,l,a) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=33002422;//kernel.Color:2422
      _this.value.h=h;
      //$LASTPOS=33002435;//kernel.Color:2435
      _this.value.s=s;
      //$LASTPOS=33002448;//kernel.Color:2448
      _this.value.l=l;
      //$LASTPOS=33002461;//kernel.Color:2461
      if (typeof  a==="number") {
        //$LASTPOS=33002490;//kernel.Color:2490
        if (_this.imageData) {
          //$LASTPOS=33002511;//kernel.Color:2511
          _this.imageData.data[_this.index+3]=a;
          
        } else {
          //$LASTPOS=33002548;//kernel.Color:2548
          _this.value.a=a;
        }
        
      }
      
      _thread.enter(function _trc_Color_ent_setHSLA(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=33002565;//kernel.Color:2565
            if (!(_this.imageData)) { __pc=2     ; break; }
            //$LASTPOS=33002580;//kernel.Color:2580
            _this.fiber$makeRGBA(_thread, true);
            __pc=1;return;
          case 1:
            
            __pc=4     ;break;
          case 2     :
            //$LASTPOS=33002603;//kernel.Color:2603
            _this.fiber$clearRGBA(_thread);
            __pc=3;return;
          case 3:
            
          case 4     :
            
            _thread.exit(true);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    setRGBA :function _trc_Color_setRGBA(r,g,b,a) {
      "use strict";
      var _this=this;
      var n;
      var i;
      
      //$LASTPOS=33002657;//kernel.Color:2657
      if (_this.imageData) {
        //$LASTPOS=33002677;//kernel.Color:2677
        n = ((typeof  a==="number")?4:3);
        
        //$LASTPOS=33002715;//kernel.Color:2715
        //$LASTPOS=33002719;//kernel.Color:2719
        i = 0;
        for (; i<n ; i++) {
          //$LASTPOS=33002736;//kernel.Color:2736
          _this.imageData.data[_this.index+i]=[r,g,b,a][i];
        }
        
      } else {
        //$LASTPOS=33002788;//kernel.Color:2788
        _this.value.r=r;
        //$LASTPOS=33002802;//kernel.Color:2802
        _this.value.g=g;
        //$LASTPOS=33002816;//kernel.Color:2816
        _this.value.b=b;
        //$LASTPOS=33002830;//kernel.Color:2830
        if (typeof  a==="number") {
          //$LASTPOS=33002854;//kernel.Color:2854
          _this.value.a=a;
        }
        //$LASTPOS=33002868;//kernel.Color:2868
        _this.clearHSLA();
        //$LASTPOS=33002884;//kernel.Color:2884
        _this.clearName();
        
      }
    },
    fiber$setRGBA :function _trc_Color_f_setRGBA(_thread,r,g,b,a) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var n;
      var i;
      
      
      _thread.enter(function _trc_Color_ent_setRGBA(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=33002657;//kernel.Color:2657
            if (!(_this.imageData)) { __pc=1     ; break; }
            {
              //$LASTPOS=33002677;//kernel.Color:2677
              n = ((typeof  a==="number")?4:3);
              
              //$LASTPOS=33002715;//kernel.Color:2715
              //$LASTPOS=33002719;//kernel.Color:2719
              i = 0;
              for (; i<n ; i++) {
                //$LASTPOS=33002736;//kernel.Color:2736
                _this.imageData.data[_this.index+i]=[r,g,b,a][i];
              }
            }
            __pc=4     ;break;
          case 1     :
            //$LASTPOS=33002788;//kernel.Color:2788
            _this.value.r=r;
            //$LASTPOS=33002802;//kernel.Color:2802
            _this.value.g=g;
            //$LASTPOS=33002816;//kernel.Color:2816
            _this.value.b=b;
            //$LASTPOS=33002830;//kernel.Color:2830
            if (typeof  a==="number") {
              //$LASTPOS=33002854;//kernel.Color:2854
              _this.value.a=a;
            }
            //$LASTPOS=33002868;//kernel.Color:2868
            _this.fiber$clearHSLA(_thread);
            __pc=2;return;
          case 2:
            
            //$LASTPOS=33002884;//kernel.Color:2884
            _this.fiber$clearName(_thread);
            __pc=3;return;
          case 3:
            
          case 4     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    hasRGBA :function _trc_Color_hasRGBA() {
      "use strict";
      var _this=this;
      
      return _this.imageData||typeof  (_this.value.r)==="number";
    },
    fiber$hasRGBA :function _trc_Color_f_hasRGBA(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.imageData||typeof  (_this.value.r)==="number";return;
      
      
      _thread.retVal=_this;return;
    },
    hasHSLA :function _trc_Color_hasHSLA() {
      "use strict";
      var _this=this;
      
      return typeof  (_this.value.h)==="number";
    },
    fiber$hasHSLA :function _trc_Color_f_hasHSLA(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=typeof  (_this.value.h)==="number";return;
      
      
      _thread.retVal=_this;return;
    },
    hasName :function _trc_Color_hasName() {
      "use strict";
      var _this=this;
      
      return typeof  (_this.value.name)==="string";
    },
    fiber$hasName :function _trc_Color_f_hasName(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=typeof  (_this.value.name)==="string";return;
      
      
      _thread.retVal=_this;return;
    },
    clearRGBA :function _trc_Color_clearRGBA() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33003105;//kernel.Color:3105
      delete _this.value.r;
    },
    fiber$clearRGBA :function _trc_Color_f_clearRGBA(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=33003105;//kernel.Color:3105
      delete _this.value.r;
      
      _thread.retVal=_this;return;
    },
    clearHSLA :function _trc_Color_clearHSLA() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33003142;//kernel.Color:3142
      delete _this.value.h;
    },
    fiber$clearHSLA :function _trc_Color_f_clearHSLA(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=33003142;//kernel.Color:3142
      delete _this.value.h;
      
      _thread.retVal=_this;return;
    },
    clearName :function _trc_Color_clearName() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33003179;//kernel.Color:3179
      delete _this.value.name;
    },
    fiber$clearName :function _trc_Color_f_clearName(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=33003179;//kernel.Color:3179
      delete _this.value.name;
      
      _thread.retVal=_this;return;
    },
    distRGBA :function _trc_Color_distRGBA(other) {
      "use strict";
      var _this=this;
      var dr;
      var dg;
      var db;
      var da;
      
      //$LASTPOS=33003223;//kernel.Color:3223
      if (other instanceof Tonyu.classes.kernel.Color) {
        
        
      } else {
        //$LASTPOS=33003255;//kernel.Color:3255
        other=new Tonyu.classes.kernel.Color(other+"");
        
      }
      //$LASTPOS=33003288;//kernel.Color:3288
      dr = (_this.r/_this.maxs.r-other.r/other.maxs.r);
      
      //$LASTPOS=33003330;//kernel.Color:3330
      dg = (_this.g/_this.maxs.g-other.g/other.maxs.g);
      
      //$LASTPOS=33003372;//kernel.Color:3372
      db = (_this.b/_this.maxs.b-other.b/other.maxs.b);
      
      //$LASTPOS=33003414;//kernel.Color:3414
      da = (_this.a/_this.maxs.a-other.a/other.maxs.a);
      
      return _this.sqrt(dr*dr+dg*dg+db*db+da*da);
    },
    fiber$distRGBA :function _trc_Color_f_distRGBA(_thread,other) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var dr;
      var dg;
      var db;
      var da;
      
      //$LASTPOS=33003223;//kernel.Color:3223
      if (other instanceof Tonyu.classes.kernel.Color) {
        
        
      } else {
        //$LASTPOS=33003255;//kernel.Color:3255
        other=new Tonyu.classes.kernel.Color(other+"");
        
      }
      //$LASTPOS=33003288;//kernel.Color:3288
      dr = (_this.r/_this.maxs.r-other.r/other.maxs.r);
      
      //$LASTPOS=33003330;//kernel.Color:3330
      dg = (_this.g/_this.maxs.g-other.g/other.maxs.g);
      
      //$LASTPOS=33003372;//kernel.Color:3372
      db = (_this.b/_this.maxs.b-other.b/other.maxs.b);
      
      //$LASTPOS=33003414;//kernel.Color:3414
      da = (_this.a/_this.maxs.a-other.a/other.maxs.a);
      
      _thread.retVal=_this.sqrt(dr*dr+dg*dg+db*db+da*da);return;
      
      
      _thread.retVal=_this;return;
    },
    distHSLA :function _trc_Color_distHSLA(other) {
      "use strict";
      var _this=this;
      var dh;
      var ds;
      var dl;
      var da;
      
      //$LASTPOS=33003519;//kernel.Color:3519
      if (other instanceof Tonyu.classes.kernel.Color) {
        
        
      } else {
        //$LASTPOS=33003551;//kernel.Color:3551
        other=new Tonyu.classes.kernel.Color(other+"");
        
      }
      //$LASTPOS=33003584;//kernel.Color:3584
      dh = _this.angleDiff(_this.h,other.h)/180;
      
      //$LASTPOS=33003619;//kernel.Color:3619
      ds = (_this.s/_this.maxs.s-other.s/other.maxs.s);
      
      //$LASTPOS=33003661;//kernel.Color:3661
      dl = (_this.l/_this.maxs.l-other.l/other.maxs.l);
      
      //$LASTPOS=33003703;//kernel.Color:3703
      da = (_this.a/_this.maxs.a-other.a/other.maxs.a);
      
      return _this.sqrt(dh*dh+ds*ds+dl*dl+da*da);
    },
    fiber$distHSLA :function _trc_Color_f_distHSLA(_thread,other) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var dh;
      var ds;
      var dl;
      var da;
      
      //$LASTPOS=33003519;//kernel.Color:3519
      if (other instanceof Tonyu.classes.kernel.Color) {
        
        
      } else {
        //$LASTPOS=33003551;//kernel.Color:3551
        other=new Tonyu.classes.kernel.Color(other+"");
        
      }
      //$LASTPOS=33003584;//kernel.Color:3584
      dh = _this.angleDiff(_this.h,other.h)/180;
      
      //$LASTPOS=33003619;//kernel.Color:3619
      ds = (_this.s/_this.maxs.s-other.s/other.maxs.s);
      
      //$LASTPOS=33003661;//kernel.Color:3661
      dl = (_this.l/_this.maxs.l-other.l/other.maxs.l);
      
      //$LASTPOS=33003703;//kernel.Color:3703
      da = (_this.a/_this.maxs.a-other.a/other.maxs.a);
      
      _thread.retVal=_this.sqrt(dh*dh+ds*ds+dl*dl+da*da);return;
      
      
      _thread.retVal=_this;return;
    },
    makeRGBA :function _trc_Color_makeRGBA(force) {
      "use strict";
      var _this=this;
      var rgb;
      var i;
      
      //$LASTPOS=33003812;//kernel.Color:3812
      if (! force&&_this.hasRGBA()) {
        return _this;
      }
      //$LASTPOS=33003847;//kernel.Color:3847
      if (_this.hasHSLA()) {
        //$LASTPOS=33003867;//kernel.Color:3867
        rgb = _this.HSLToRGB(_this.value.h,_this.value.s,_this.value.l);
        
        //$LASTPOS=33003913;//kernel.Color:3913
        if (_this.imageData) {
          //$LASTPOS=33003934;//kernel.Color:3934
          //$LASTPOS=33003938;//kernel.Color:3938
          i = 0;
          for (; i<3 ; i++) {
            //$LASTPOS=33003955;//kernel.Color:3955
            _this.imageData.data[_this.index+i]=rgb[i]*_this.maxs.r;
          }
          
        } else {
          //$LASTPOS=33004049;//kernel.Color:4049
          _this.value.r=rgb[0]*_this.maxs.r;
          //$LASTPOS=33004076;//kernel.Color:4076
          _this.value.g=rgb[1]*_this.maxs.g;
          //$LASTPOS=33004103;//kernel.Color:4103
          _this.value.b=rgb[2]*_this.maxs.b;
          
        }
        return _this;
        
      }
      //$LASTPOS=33004148;//kernel.Color:4148
      _this.nameToRGB();
    },
    fiber$makeRGBA :function _trc_Color_f_makeRGBA(_thread,force) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var rgb;
      var i;
      
      //$LASTPOS=33003812;//kernel.Color:3812
      if (! force&&_this.hasRGBA()) {
        _thread.retVal=_this;return;
        
      }
      
      _thread.enter(function _trc_Color_ent_makeRGBA(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=33003847;//kernel.Color:3847
            if (!(_this.hasHSLA())) { __pc=2     ; break; }
            //$LASTPOS=33003867;//kernel.Color:3867
            _this.fiber$HSLToRGB(_thread, _this.value.h, _this.value.s, _this.value.l);
            __pc=1;return;
          case 1:
            rgb=_thread.retVal;
            
            //$LASTPOS=33003913;//kernel.Color:3913
            if (_this.imageData) {
              //$LASTPOS=33003934;//kernel.Color:3934
              //$LASTPOS=33003938;//kernel.Color:3938
              i = 0;
              for (; i<3 ; i++) {
                //$LASTPOS=33003955;//kernel.Color:3955
                _this.imageData.data[_this.index+i]=rgb[i]*_this.maxs.r;
              }
              
            } else {
              //$LASTPOS=33004049;//kernel.Color:4049
              _this.value.r=rgb[0]*_this.maxs.r;
              //$LASTPOS=33004076;//kernel.Color:4076
              _this.value.g=rgb[1]*_this.maxs.g;
              //$LASTPOS=33004103;//kernel.Color:4103
              _this.value.b=rgb[2]*_this.maxs.b;
              
            }
            _thread.exit(_this);return;
          case 2     :
            
            //$LASTPOS=33004148;//kernel.Color:4148
            _this.fiber$nameToRGB(_thread);
            __pc=3;return;
          case 3:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    nameToRGB :function _trc_Color_nameToRGB() {
      "use strict";
      var _this=this;
      var ctx;
      var d;
      var i;
      
      //$LASTPOS=33004182;//kernel.Color:4182
      ctx = _this.tmpCanvas();
      
      //$LASTPOS=33004205;//kernel.Color:4205
      ctx.fillStyle=_this.value.name;
      //$LASTPOS=33004233;//kernel.Color:4233
      ctx.fillRect(0,0,1,1);
      //$LASTPOS=33004258;//kernel.Color:4258
      d = ctx.getImageData(0,0,1,1);
      
      //$LASTPOS=33004293;//kernel.Color:4293
      d=d.data;
      //$LASTPOS=33004305;//kernel.Color:4305
      if (_this.imageData) {
        //$LASTPOS=33004325;//kernel.Color:4325
        //$LASTPOS=33004329;//kernel.Color:4329
        i = 0;
        for (; i<4 ; i++) {
          //$LASTPOS=33004346;//kernel.Color:4346
          _this.imageData.data[_this.index+i]=d[i];
        }
        
      } else {
        //$LASTPOS=33004390;//kernel.Color:4390
        _this.value.r=d[0];
        //$LASTPOS=33004407;//kernel.Color:4407
        _this.value.g=d[1];
        //$LASTPOS=33004424;//kernel.Color:4424
        _this.value.b=d[2];
        //$LASTPOS=33004441;//kernel.Color:4441
        _this.value.a=d[3];
        
      }
    },
    fiber$nameToRGB :function _trc_Color_f_nameToRGB(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      var d;
      var i;
      
      
      _thread.enter(function _trc_Color_ent_nameToRGB(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=33004182;//kernel.Color:4182
            _this.fiber$tmpCanvas(_thread);
            __pc=1;return;
          case 1:
            ctx=_thread.retVal;
            
            //$LASTPOS=33004205;//kernel.Color:4205
            ctx.fillStyle=_this.value.name;
            //$LASTPOS=33004233;//kernel.Color:4233
            ctx.fillRect(0,0,1,1);
            //$LASTPOS=33004258;//kernel.Color:4258
            d = ctx.getImageData(0,0,1,1);
            
            //$LASTPOS=33004293;//kernel.Color:4293
            d=d.data;
            //$LASTPOS=33004305;//kernel.Color:4305
            if (_this.imageData) {
              //$LASTPOS=33004325;//kernel.Color:4325
              //$LASTPOS=33004329;//kernel.Color:4329
              i = 0;
              for (; i<4 ; i++) {
                //$LASTPOS=33004346;//kernel.Color:4346
                _this.imageData.data[_this.index+i]=d[i];
              }
              
            } else {
              //$LASTPOS=33004390;//kernel.Color:4390
              _this.value.r=d[0];
              //$LASTPOS=33004407;//kernel.Color:4407
              _this.value.g=d[1];
              //$LASTPOS=33004424;//kernel.Color:4424
              _this.value.b=d[2];
              //$LASTPOS=33004441;//kernel.Color:4441
              _this.value.a=d[3];
              
            }
            _thread.exit(_this);return;
          }
        }
      });
    },
    makeHSLA :function _trc_Color_makeHSLA() {
      "use strict";
      var _this=this;
      var hsl;
      
      //$LASTPOS=33004479;//kernel.Color:4479
      if (_this.hasHSLA()) {
        return _this;
      }
      //$LASTPOS=33004504;//kernel.Color:4504
      if (! _this.hasRGBA()) {
        //$LASTPOS=33004520;//kernel.Color:4520
        _this.nameToRGB();
      }
      
      //$LASTPOS=33004546;//kernel.Color:4546
      if (_this.imageData) {
        //$LASTPOS=33004566;//kernel.Color:4566
        hsl=_this.RGBToHSL(_this.imageData.data[_this.index]/_this.maxs.r,_this.imageData.data[_this.index+1]/_this.maxs.g,_this.imageData.data[_this.index+2]/_this.maxs.b);
        
      } else {
        //$LASTPOS=33004694;//kernel.Color:4694
        hsl=_this.RGBToHSL(_this.value.r/_this.maxs.r,_this.value.g/_this.maxs.g,_this.value.b/_this.maxs.b);
        
      }
      //$LASTPOS=33004760;//kernel.Color:4760
      _this.value.h=hsl[0];
      //$LASTPOS=33004778;//kernel.Color:4778
      _this.value.s=hsl[1];
      //$LASTPOS=33004796;//kernel.Color:4796
      _this.value.l=hsl[2];
      return _this;
    },
    fiber$makeHSLA :function _trc_Color_f_makeHSLA(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var hsl;
      
      //$LASTPOS=33004479;//kernel.Color:4479
      if (_this.hasHSLA()) {
        _thread.retVal=_this;return;
        
      }
      
      _thread.enter(function _trc_Color_ent_makeHSLA(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=33004504;//kernel.Color:4504
            if (!(! _this.hasRGBA())) { __pc=2     ; break; }
            //$LASTPOS=33004520;//kernel.Color:4520
            _this.fiber$nameToRGB(_thread);
            __pc=1;return;
          case 1:
            
          case 2     :
            
            
            //$LASTPOS=33004546;//kernel.Color:4546
            if (!(_this.imageData)) { __pc=4     ; break; }
            //$LASTPOS=33004566;//kernel.Color:4566
            _this.fiber$RGBToHSL(_thread, _this.imageData.data[_this.index]/_this.maxs.r, _this.imageData.data[_this.index+1]/_this.maxs.g, _this.imageData.data[_this.index+2]/_this.maxs.b);
            __pc=3;return;
          case 3:
            hsl=_thread.retVal;
            
            __pc=6     ;break;
          case 4     :
            //$LASTPOS=33004694;//kernel.Color:4694
            _this.fiber$RGBToHSL(_thread, _this.value.r/_this.maxs.r, _this.value.g/_this.maxs.g, _this.value.b/_this.maxs.b);
            __pc=5;return;
          case 5:
            hsl=_thread.retVal;
            
          case 6     :
            
            //$LASTPOS=33004760;//kernel.Color:4760
            _this.value.h=hsl[0];
            //$LASTPOS=33004778;//kernel.Color:4778
            _this.value.s=hsl[1];
            //$LASTPOS=33004796;//kernel.Color:4796
            _this.value.l=hsl[2];
            _thread.exit(_this);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    makeName :function _trc_Color_makeName(type) {
      "use strict";
      var _this=this;
      function p(r) {
        
        return _this.floor(r*100)+"%";
      }
      //$LASTPOS=33004846;//kernel.Color:4846
      if (_this.hasName()) {
        return _this;
      }
      //$LASTPOS=33004871;//kernel.Color:4871
      type=type||"rgb";
      //$LASTPOS=33004891;//kernel.Color:4891
      if (type=="rgb") {
        //$LASTPOS=33004913;//kernel.Color:4913
        _this.makeRGBA();
        //$LASTPOS=33004928;//kernel.Color:4928
        if (_this.imageData) {
          //$LASTPOS=33004949;//kernel.Color:4949
          _this.value.name="rgba("+[_this.floor(_this.imageData.data[_this.index]),_this.floor(_this.imageData.data[_this.index+1]),_this.floor(_this.imageData.data[_this.index+2]),_this.imageData.data[_this.index+3]/_this.maxs.a].join(",")+")";
          
        } else {
          //$LASTPOS=33005123;//kernel.Color:5123
          _this.value.name="rgba("+[_this.floor(_this.value.r),_this.floor(_this.value.g),_this.floor(_this.value.b),_this.value.a/_this.maxs.a].join(",")+")";
          
        }
        
      }
      //$LASTPOS=33005230;//kernel.Color:5230
      if (type=="hsl") {
        //$LASTPOS=33005252;//kernel.Color:5252
        _this.makeHSLA();
        //$LASTPOS=33005267;//kernel.Color:5267
        _this.value.name="hsla("+[_this.floor(_this.value.h),p(_this.value.s),p(_this.value.l),_this.value.a/_this.maxs.a].join(",")+")";
        
      }
      
    },
    fiber$makeName :function _trc_Color_f_makeName(_thread,type) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      function p(r) {
        
        return _this.floor(r*100)+"%";
      }
      //$LASTPOS=33004846;//kernel.Color:4846
      if (_this.hasName()) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=33004871;//kernel.Color:4871
      type=type||"rgb";
      
      _thread.enter(function _trc_Color_ent_makeName(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=33004891;//kernel.Color:4891
            if (!(type=="rgb")) { __pc=2     ; break; }
            //$LASTPOS=33004913;//kernel.Color:4913
            _this.fiber$makeRGBA(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=33004928;//kernel.Color:4928
            if (_this.imageData) {
              //$LASTPOS=33004949;//kernel.Color:4949
              _this.value.name="rgba("+[_this.floor(_this.imageData.data[_this.index]),_this.floor(_this.imageData.data[_this.index+1]),_this.floor(_this.imageData.data[_this.index+2]),_this.imageData.data[_this.index+3]/_this.maxs.a].join(",")+")";
              
            } else {
              //$LASTPOS=33005123;//kernel.Color:5123
              _this.value.name="rgba("+[_this.floor(_this.value.r),_this.floor(_this.value.g),_this.floor(_this.value.b),_this.value.a/_this.maxs.a].join(",")+")";
              
            }
          case 2     :
            
            //$LASTPOS=33005230;//kernel.Color:5230
            if (!(type=="hsl")) { __pc=4     ; break; }
            //$LASTPOS=33005252;//kernel.Color:5252
            _this.fiber$makeHSLA(_thread);
            __pc=3;return;
          case 3:
            
            //$LASTPOS=33005267;//kernel.Color:5267
            _this.value.name="hsla("+[_this.floor(_this.value.h),p(_this.value.s),p(_this.value.l),_this.value.a/_this.maxs.a].join(",")+")";
          case 4     :
            
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    toString :function _trc_Color_toString() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=33005428;//kernel.Color:5428
      _this.makeName();
      return _this.value.name;
    },
    tmpCanvas :function _trc_Color_tmpCanvas() {
      "use strict";
      var _this=this;
      var cv;
      
      //$LASTPOS=33005482;//kernel.Color:5482
      if (Tonyu.classes.kernel.Color.ctx) {
        return Tonyu.classes.kernel.Color.ctx;
      }
      //$LASTPOS=33005517;//kernel.Color:5517
      cv = $("<canvas>").attr({width: 1,height: 1}).css({display: "none"}).appendTo("body");
      
      //$LASTPOS=33005601;//kernel.Color:5601
      Tonyu.classes.kernel.Color.ctx=cv[0].getContext("2d");
      return Tonyu.classes.kernel.Color.ctx;
    },
    fiber$tmpCanvas :function _trc_Color_f_tmpCanvas(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var cv;
      
      //$LASTPOS=33005482;//kernel.Color:5482
      if (Tonyu.classes.kernel.Color.ctx) {
        _thread.retVal=Tonyu.classes.kernel.Color.ctx;return;
        
      }
      //$LASTPOS=33005517;//kernel.Color:5517
      cv = $("<canvas>").attr({width: 1,height: 1}).css({display: "none"}).appendTo("body");
      
      //$LASTPOS=33005601;//kernel.Color:5601
      Tonyu.classes.kernel.Color.ctx=cv[0].getContext("2d");
      _thread.retVal=Tonyu.classes.kernel.Color.ctx;return;
      
      
      _thread.retVal=_this;return;
    },
    RGBToHSL :function _trc_Color_RGBToHSL(r,g,b) {
      "use strict";
      var _this=this;
      var min;
      var max;
      var diff;
      var h;
      var s;
      var l;
      
      //$LASTPOS=33005741;//kernel.Color:5741
      min = Tonyu.globals.$Math.min(r,g,b);
      max = Tonyu.globals.$Math.max(r,g,b);
      diff = max-min;
      h = 0;
      s = 0;
      l = (min+max)/2;
      
      //$LASTPOS=33005862;//kernel.Color:5862
      if (diff!=0) {
        //$LASTPOS=33005882;//kernel.Color:5882
        s=l<0.5?diff/(max+min):diff/(2-max-min);
        //$LASTPOS=33005946;//kernel.Color:5946
        h=(r==max?(g-b)/diff:g==max?2+(b-r)/diff:4+(r-g)/diff)*60;
        
      }
      return [h,s,l];
    },
    fiber$RGBToHSL :function _trc_Color_f_RGBToHSL(_thread,r,g,b) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var min;
      var max;
      var diff;
      var h;
      var s;
      var l;
      
      //$LASTPOS=33005741;//kernel.Color:5741
      min = Tonyu.globals.$Math.min(r,g,b);
      max = Tonyu.globals.$Math.max(r,g,b);
      diff = max-min;
      h = 0;
      s = 0;
      l = (min+max)/2;
      
      //$LASTPOS=33005862;//kernel.Color:5862
      if (diff!=0) {
        //$LASTPOS=33005882;//kernel.Color:5882
        s=l<0.5?diff/(max+min):diff/(2-max-min);
        //$LASTPOS=33005946;//kernel.Color:5946
        h=(r==max?(g-b)/diff:g==max?2+(b-r)/diff:4+(r-g)/diff)*60;
        
      }
      _thread.retVal=[h,s,l];return;
      
      
      _thread.retVal=_this;return;
    },
    HSLToRGB :function _trc_Color_HSLToRGB(h,s,l) {
      "use strict";
      var _this=this;
      var temp2;
      var temp1;
      var rtemp;
      var gtemp;
      var btemp;
      var rgb;
      var i;
      
      //$LASTPOS=33006100;//kernel.Color:6100
      if (s==0) {
        return [l,l,l];
        
      }
      //$LASTPOS=33006143;//kernel.Color:6143
      temp2 = l<0.5?l*(1+s):l+s-l*s;
      
      //$LASTPOS=33006196;//kernel.Color:6196
      temp1 = 2*l-temp2;
      
      //$LASTPOS=33006227;//kernel.Color:6227
      h/=360;
      //$LASTPOS=33006241;//kernel.Color:6241
      rtemp = (h+1/3)%1;
      gtemp = h;
      btemp = (h+2/3)%1;
      rgb = [rtemp,gtemp,btemp];
      i = 0;
      
      //$LASTPOS=33006356;//kernel.Color:6356
      ;
      
      while(i<3) {
        {
          //$LASTPOS=33006380;//kernel.Color:6380
          rgb[i]=rgb[i]<1/6?temp1+(temp2-temp1)*6*rgb[i]:rgb[i]<1/2?temp2:rgb[i]<2/3?temp1+(temp2-temp1)*6*(2/3-rgb[i]):temp1;
        }
        ++ i;
      }
      return rgb;
    },
    fiber$HSLToRGB :function _trc_Color_f_HSLToRGB(_thread,h,s,l) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var temp2;
      var temp1;
      var rtemp;
      var gtemp;
      var btemp;
      var rgb;
      var i;
      
      //$LASTPOS=33006100;//kernel.Color:6100
      if (s==0) {
        _thread.retVal=[l,l,l];return;
        
        
      }
      //$LASTPOS=33006143;//kernel.Color:6143
      temp2 = l<0.5?l*(1+s):l+s-l*s;
      
      //$LASTPOS=33006196;//kernel.Color:6196
      temp1 = 2*l-temp2;
      
      //$LASTPOS=33006227;//kernel.Color:6227
      h/=360;
      //$LASTPOS=33006241;//kernel.Color:6241
      rtemp = (h+1/3)%1;
      gtemp = h;
      btemp = (h+2/3)%1;
      rgb = [rtemp,gtemp,btemp];
      i = 0;
      
      //$LASTPOS=33006356;//kernel.Color:6356
      ;
      
      while(i<3) {
        {
          //$LASTPOS=33006380;//kernel.Color:6380
          rgb[i]=rgb[i]<1/6?temp1+(temp2-temp1)*6*rgb[i]:rgb[i]<1/2?temp2:rgb[i]<2/3?temp1+(temp2-temp1)*6*(2/3-rgb[i]):temp1;
        }
        ++ i;
      }
      _thread.retVal=rgb;return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"fillNum":{"nowait":false},"__getter__r":{"nowait":true},"__getter__g":{"nowait":true},"__getter__b":{"nowait":true},"__getter__a":{"nowait":true},"__setter__a":{"nowait":true},"__setter__r":{"nowait":true},"__setter__g":{"nowait":true},"__setter__b":{"nowait":true},"__getter__h":{"nowait":true},"__getter__s":{"nowait":true},"__getter__l":{"nowait":true},"__setter__h":{"nowait":true},"__setter__s":{"nowait":true},"__setter__l":{"nowait":true},"setHSLA":{"nowait":false},"setRGBA":{"nowait":false},"hasRGBA":{"nowait":false},"hasHSLA":{"nowait":false},"hasName":{"nowait":false},"clearRGBA":{"nowait":false},"clearHSLA":{"nowait":false},"clearName":{"nowait":false},"distRGBA":{"nowait":false},"distHSLA":{"nowait":false},"makeRGBA":{"nowait":false},"nameToRGB":{"nowait":false},"makeHSLA":{"nowait":false},"makeName":{"nowait":false},"toString":{"nowait":true},"tmpCanvas":{"nowait":false},"RGBToHSL":{"nowait":false},"HSLToRGB":{"nowait":false}},"fields":{"maxs":{},"imageData":{},"index":{},"value":{},"type":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.GIFWriter',
  shortName: 'GIFWriter',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.ParallelMod,Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.FileMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.ThreadGroupMod],
  methods: {
    main :function _trc_GIFWriter_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_GIFWriter_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_GIFWriter_initialize(params) {
      "use strict";
      var _this=this;
      var cnt;
      var wevt;
      
      //$LASTPOS=34000240;//kernel.GIFWriter:240
      Tonyu.classes.kernel.TObject.apply( _this, [params]);
      //$LASTPOS=34000260;//kernel.GIFWriter:260
      Tonyu.globals.$currentProject.requestPlugin("gif");
      //$LASTPOS=34000343;//kernel.GIFWriter:343
      _this.target=_this.target||Tonyu.globals.$Screen;
      //$LASTPOS=34000374;//kernel.GIFWriter:374
      _this.fps=_this.fps||15;
      //$LASTPOS=34000394;//kernel.GIFWriter:394
      _this.interval=_this.interval||_this.floor(Tonyu.globals.$Boot.getFrameRate()/_this.fps);
      //$LASTPOS=34000459;//kernel.GIFWriter:459
      _this.duration=(1000/Tonyu.globals.$Boot.getFrameRate())*_this.interval;
      //$LASTPOS=34000513;//kernel.GIFWriter:513
      if (! _this.manual) {
        //$LASTPOS=34000537;//kernel.GIFWriter:537
        if (_this.delay) {
          //$LASTPOS=34000563;//kernel.GIFWriter:563
          cnt = 0;
          
          
          //$LASTPOS=34000610;//kernel.GIFWriter:610
          wevt=Tonyu.globals.$Boot.on("afterDraw",(function anonymous_637() {
            
            //$LASTPOS=34000657;//kernel.GIFWriter:657
            cnt++;
            //$LASTPOS=34000681;//kernel.GIFWriter:681
            if (cnt>=_this.delay) {
              //$LASTPOS=34000720;//kernel.GIFWriter:720
              wevt.remove();
              //$LASTPOS=34000756;//kernel.GIFWriter:756
              _this.start();
              
            }
          }));
          
        } else {
          //$LASTPOS=34000816;//kernel.GIFWriter:816
          _this.start();
        }
        
      }
    },
    start :function _trc_GIFWriter_start() {
      "use strict";
      var _this=this;
      var cnt;
      
      //$LASTPOS=34000852;//kernel.GIFWriter:852
      if (_this.e) {
        return _this;
      }
      //$LASTPOS=34000872;//kernel.GIFWriter:872
      _this.frames=[];
      //$LASTPOS=34000888;//kernel.GIFWriter:888
      _this.e=new GIF({workerScript: GIF_WORKER_URL,workers: 2,quality: 10});
      //$LASTPOS=34001135;//kernel.GIFWriter:1135
      _this.encoded=0;
      //$LASTPOS=34001151;//kernel.GIFWriter:1151
      if (! _this.manual) {
        //$LASTPOS=34001175;//kernel.GIFWriter:1175
        cnt = 0;
        
        //$LASTPOS=34001195;//kernel.GIFWriter:1195
        _this.evt=Tonyu.globals.$Boot.on("afterDraw",(function anonymous_1221(e) {
          var drawn;
          
          //$LASTPOS=34001241;//kernel.GIFWriter:1241
          drawn = e.drawn;
          
          //$LASTPOS=34001273;//kernel.GIFWriter:1273
          cnt++;
          //$LASTPOS=34001293;//kernel.GIFWriter:1293
          if (cnt>=_this.interval) {
            //$LASTPOS=34001331;//kernel.GIFWriter:1331
            cnt=0;
            //$LASTPOS=34001355;//kernel.GIFWriter:1355
            _this.addFrame();
            
          }
          //$LASTPOS=34001395;//kernel.GIFWriter:1395
          if (typeof  _this.length==="number") {
            //$LASTPOS=34001444;//kernel.GIFWriter:1444
            _this.length--;
            //$LASTPOS=34001471;//kernel.GIFWriter:1471
            if (_this.length<=0) {
              switch (_this.after) {
              case "save":
                return _this.save()["catch"]((function anonymous_1583(e) {
                  
                  //$LASTPOS=34001590;//kernel.GIFWriter:1590
                  console.error(e);
                }));
              case "download":
                return _this.download();
              }
              
            }
            
          }
        }));
        
      }
    },
    fiber$start :function _trc_GIFWriter_f_start(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var cnt;
      
      //$LASTPOS=34000852;//kernel.GIFWriter:852
      if (_this.e) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=34000872;//kernel.GIFWriter:872
      _this.frames=[];
      //$LASTPOS=34000888;//kernel.GIFWriter:888
      _this.e=new GIF({workerScript: GIF_WORKER_URL,workers: 2,quality: 10});
      //$LASTPOS=34001135;//kernel.GIFWriter:1135
      _this.encoded=0;
      
      _thread.enter(function _trc_GIFWriter_ent_start(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=34001151;//kernel.GIFWriter:1151
            if (!(! _this.manual)) { __pc=1     ; break; }
            //$LASTPOS=34001175;//kernel.GIFWriter:1175
            cnt = 0;
            
            //$LASTPOS=34001195;//kernel.GIFWriter:1195
            _this.evt=Tonyu.globals.$Boot.on("afterDraw",(function anonymous_1221(e) {
              var drawn;
              
              //$LASTPOS=34001241;//kernel.GIFWriter:1241
              drawn = e.drawn;
              
              //$LASTPOS=34001273;//kernel.GIFWriter:1273
              cnt++;
              //$LASTPOS=34001293;//kernel.GIFWriter:1293
              if (cnt>=_this.interval) {
                //$LASTPOS=34001331;//kernel.GIFWriter:1331
                cnt=0;
                //$LASTPOS=34001355;//kernel.GIFWriter:1355
                _this.addFrame();
                
              }
              //$LASTPOS=34001395;//kernel.GIFWriter:1395
              if (typeof  _this.length==="number") {
                //$LASTPOS=34001444;//kernel.GIFWriter:1444
                _this.length--;
                //$LASTPOS=34001471;//kernel.GIFWriter:1471
                if (_this.length<=0) {
                  switch (_this.after) {
                  case "save":
                    return _this.save()["catch"]((function anonymous_1583(e) {
                      
                      //$LASTPOS=34001590;//kernel.GIFWriter:1590
                      console.error(e);
                    }));
                  case "download":
                    return _this.download();
                  }
                  
                }
                
              }
            }));
          case 1     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    addFrame :function _trc_GIFWriter_addFrame() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=34001768;//kernel.GIFWriter:1768
      if (! _this.e) {
        //$LASTPOS=34001776;//kernel.GIFWriter:1776
        _this.start();
      }
      //$LASTPOS=34001790;//kernel.GIFWriter:1790
      _this.e.addFrame(_this.target.image,{delay: _this.duration,copy: true});
    },
    fiber$addFrame :function _trc_GIFWriter_f_addFrame(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_GIFWriter_ent_addFrame(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=34001768;//kernel.GIFWriter:1768
            if (!(! _this.e)) { __pc=2     ; break; }
            //$LASTPOS=34001776;//kernel.GIFWriter:1776
            _this.fiber$start(_thread);
            __pc=1;return;
          case 1:
            
          case 2     :
            
            //$LASTPOS=34001790;//kernel.GIFWriter:1790
            _this.e.addFrame(_this.target.image,{delay: _this.duration,copy: true});
            _thread.exit(_this);return;
          }
        }
      });
    },
    finish :function _trc_GIFWriter_finish() {
      "use strict";
      var _this=this;
      var r;
      
      //$LASTPOS=34001999;//kernel.GIFWriter:1999
      r = _this.runPromise((function anonymous_2016(onFinish,fail) {
        
        //$LASTPOS=34002044;//kernel.GIFWriter:2044
        if (_this.evt) {
          //$LASTPOS=34002068;//kernel.GIFWriter:2068
          _this.evt.remove();
          //$LASTPOS=34002095;//kernel.GIFWriter:2095
          _this.evt=null;
          
        }
        //$LASTPOS=34002125;//kernel.GIFWriter:2125
        _this.e.on('finished',onFinish);
        //$LASTPOS=34002162;//kernel.GIFWriter:2162
        _this.e.render();
      }));
      
      return r;
    },
    fiber$finish :function _trc_GIFWriter_f_finish(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      
      _thread.enter(function _trc_GIFWriter_ent_finish(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=34001999;//kernel.GIFWriter:1999
            _this.fiber$runPromise(_thread, (function anonymous_2016(onFinish,fail) {
              
              //$LASTPOS=34002044;//kernel.GIFWriter:2044
              if (_this.evt) {
                //$LASTPOS=34002068;//kernel.GIFWriter:2068
                _this.evt.remove();
                //$LASTPOS=34002095;//kernel.GIFWriter:2095
                _this.evt=null;
                
              }
              //$LASTPOS=34002125;//kernel.GIFWriter:2125
              _this.e.on('finished',onFinish);
              //$LASTPOS=34002162;//kernel.GIFWriter:2162
              _this.e.render();
            }));
            __pc=1;return;
          case 1:
            r=_thread.retVal;
            
            _thread.exit(r);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    download :function _trc_GIFWriter_download(f) {
      "use strict";
      var _this=this;
      var r;
      
      //$LASTPOS=34002221;//kernel.GIFWriter:2221
      f=f||_this.filename||"download.gif";
      //$LASTPOS=34002257;//kernel.GIFWriter:2257
      console.log("DL",f);
      //$LASTPOS=34002283;//kernel.GIFWriter:2283
      r = _this.runPromise((function anonymous_2300(succ,err) {
        
        //$LASTPOS=34002323;//kernel.GIFWriter:2323
        _this.finish().then((function anonymous_2337(blob) {
          
          //$LASTPOS=34002360;//kernel.GIFWriter:2360
          FS.Content.download(blob,f);
          //$LASTPOS=34002402;//kernel.GIFWriter:2402
          _this.e=null;
        })).then((function anonymous_2427() {
          
          //$LASTPOS=34002429;//kernel.GIFWriter:2429
          console.log("DL OK");
        }),err);
      }));
      
      return r;
    },
    fiber$download :function _trc_GIFWriter_f_download(_thread,f) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      //$LASTPOS=34002221;//kernel.GIFWriter:2221
      f=f||_this.filename||"download.gif";
      //$LASTPOS=34002257;//kernel.GIFWriter:2257
      console.log("DL",f);
      
      _thread.enter(function _trc_GIFWriter_ent_download(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=34002283;//kernel.GIFWriter:2283
            _this.fiber$runPromise(_thread, (function anonymous_2300(succ,err) {
              
              //$LASTPOS=34002323;//kernel.GIFWriter:2323
              _this.finish().then((function anonymous_2337(blob) {
                
                //$LASTPOS=34002360;//kernel.GIFWriter:2360
                FS.Content.download(blob,f);
                //$LASTPOS=34002402;//kernel.GIFWriter:2402
                _this.e=null;
              })).then((function anonymous_2427() {
                
                //$LASTPOS=34002429;//kernel.GIFWriter:2429
                console.log("DL OK");
              }),err);
            }));
            __pc=1;return;
          case 1:
            r=_thread.retVal;
            
            _thread.exit(r);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    save :function _trc_GIFWriter_save(f) {
      "use strict";
      var _this=this;
      var r;
      
      //$LASTPOS=34002502;//kernel.GIFWriter:2502
      console.log("Save",f);
      //$LASTPOS=34002530;//kernel.GIFWriter:2530
      r = _this.runPromise((function anonymous_2547(succ,err) {
        
        //$LASTPOS=34002570;//kernel.GIFWriter:2570
        _this.finish().then((function anonymous_2584(blob) {
          
          //$LASTPOS=34002607;//kernel.GIFWriter:2607
          f=_this.file(f||_this.filename);
          return f.setBlob(blob);
        })).then((function anonymous_2681() {
          
          //$LASTPOS=34002697;//kernel.GIFWriter:2697
          _this.e=null;
          //$LASTPOS=34002718;//kernel.GIFWriter:2718
          succ();
        })).then((function anonymous_2743() {
          
          //$LASTPOS=34002745;//kernel.GIFWriter:2745
          console.log("Save OK");
        }),err);
      }));
      
      return r;
    },
    fiber$save :function _trc_GIFWriter_f_save(_thread,f) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      //$LASTPOS=34002502;//kernel.GIFWriter:2502
      console.log("Save",f);
      
      _thread.enter(function _trc_GIFWriter_ent_save(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=34002530;//kernel.GIFWriter:2530
            _this.fiber$runPromise(_thread, (function anonymous_2547(succ,err) {
              
              //$LASTPOS=34002570;//kernel.GIFWriter:2570
              _this.finish().then((function anonymous_2584(blob) {
                
                //$LASTPOS=34002607;//kernel.GIFWriter:2607
                f=_this.file(f||_this.filename);
                return f.setBlob(blob);
              })).then((function anonymous_2681() {
                
                //$LASTPOS=34002697;//kernel.GIFWriter:2697
                _this.e=null;
                //$LASTPOS=34002718;//kernel.GIFWriter:2718
                succ();
              })).then((function anonymous_2743() {
                
                //$LASTPOS=34002745;//kernel.GIFWriter:2745
                console.log("Save OK");
              }),err);
            }));
            __pc=1;return;
          case 1:
            r=_thread.retVal;
            
            _thread.exit(r);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"start":{"nowait":false},"addFrame":{"nowait":false},"finish":{"nowait":false},"download":{"nowait":false},"save":{"nowait":false}},"fields":{"target":{},"fps":{},"interval":{},"duration":{},"manual":{},"delay":{},"e":{},"frames":{},"encoded":{},"evt":{},"length":{},"after":{},"filename":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Layer2D',
  shortName: 'Layer2D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_Layer2D_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=35000037;//kernel.Layer2D:37
      "field strict";
      
    },
    fiber$main :function _trc_Layer2D_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=35000037;//kernel.Layer2D:37
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_Layer2D_draw(c) {
      "use strict";
      var _this=this;
      var rt;
      var sc;
      var wpOnSX;
      var wpOnSY;
      
      //$LASTPOS=35000122;//kernel.Layer2D:122
      c.save();
      //$LASTPOS=35000137;//kernel.Layer2D:137
      rt = _this.rotation;
      sc = _this.scale;
      
      //$LASTPOS=35000237;//kernel.Layer2D:237
      wpOnSX = (_this.cos(rt)*_this.wpx+_this.cos(rt+90)*_this.wpy)*sc;
      
      //$LASTPOS=35000286;//kernel.Layer2D:286
      wpOnSY = (_this.sin(rt)*_this.wpx+_this.sin(rt+90)*_this.wpy)*sc;
      
      //$LASTPOS=35000370;//kernel.Layer2D:370
      c.translate(- wpOnSX+_this.spx,- wpOnSY+_this.spy);
      //$LASTPOS=35000413;//kernel.Layer2D:413
      c.rotate(_this.rad(rt));
      //$LASTPOS=35000437;//kernel.Layer2D:437
      c.scale(sc,sc);
      //$LASTPOS=35000458;//kernel.Layer2D:458
      _this.group.draw(c,_this);
      //$LASTPOS=35000483;//kernel.Layer2D:483
      c.restore();
    },
    fiber$draw :function _trc_Layer2D_f_draw(_thread,c) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var rt;
      var sc;
      var wpOnSX;
      var wpOnSY;
      
      //$LASTPOS=35000122;//kernel.Layer2D:122
      c.save();
      //$LASTPOS=35000137;//kernel.Layer2D:137
      rt = _this.rotation;
      sc = _this.scale;
      
      //$LASTPOS=35000237;//kernel.Layer2D:237
      wpOnSX = (_this.cos(rt)*_this.wpx+_this.cos(rt+90)*_this.wpy)*sc;
      
      //$LASTPOS=35000286;//kernel.Layer2D:286
      wpOnSY = (_this.sin(rt)*_this.wpx+_this.sin(rt+90)*_this.wpy)*sc;
      
      //$LASTPOS=35000370;//kernel.Layer2D:370
      c.translate(- wpOnSX+_this.spx,- wpOnSY+_this.spy);
      //$LASTPOS=35000413;//kernel.Layer2D:413
      c.rotate(_this.rad(rt));
      //$LASTPOS=35000437;//kernel.Layer2D:437
      c.scale(sc,sc);
      //$LASTPOS=35000458;//kernel.Layer2D:458
      _this.group.draw(c,_this);
      //$LASTPOS=35000483;//kernel.Layer2D:483
      c.restore();
      
      _thread.retVal=_this;return;
    },
    world2screen :function _trc_Layer2D_world2screen(obj) {
      "use strict";
      var _this=this;
      var dx;
      var dy;
      var rt;
      var x;
      var y;
      
      //$LASTPOS=35000567;//kernel.Layer2D:567
      dx = obj.x-_this.wpx;
      
      //$LASTPOS=35000590;//kernel.Layer2D:590
      dy = obj.y-_this.wpy;
      
      //$LASTPOS=35000613;//kernel.Layer2D:613
      rt = _this.rotation;
      
      //$LASTPOS=35000781;//kernel.Layer2D:781
      x = _this.spx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)*_this.scale;
      
      //$LASTPOS=35000832;//kernel.Layer2D:832
      y = _this.spy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)*_this.scale;
      
      return {x: x,y: y,rotation: obj.rotation,scale: obj.scale,layer: _this.screen};
    },
    fiber$world2screen :function _trc_Layer2D_f_world2screen(_thread,obj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var dx;
      var dy;
      var rt;
      var x;
      var y;
      
      //$LASTPOS=35000567;//kernel.Layer2D:567
      dx = obj.x-_this.wpx;
      
      //$LASTPOS=35000590;//kernel.Layer2D:590
      dy = obj.y-_this.wpy;
      
      //$LASTPOS=35000613;//kernel.Layer2D:613
      rt = _this.rotation;
      
      //$LASTPOS=35000781;//kernel.Layer2D:781
      x = _this.spx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)*_this.scale;
      
      //$LASTPOS=35000832;//kernel.Layer2D:832
      y = _this.spy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)*_this.scale;
      
      _thread.retVal={x: x,y: y,rotation: obj.rotation,scale: obj.scale,layer: _this.screen};return;
      
      
      _thread.retVal=_this;return;
    },
    screen2world :function _trc_Layer2D_screen2world(obj) {
      "use strict";
      var _this=this;
      var rt;
      var dx;
      var dy;
      var x;
      var y;
      
      //$LASTPOS=35001041;//kernel.Layer2D:1041
      rt = - _this.rotation;
      
      //$LASTPOS=35001064;//kernel.Layer2D:1064
      dx = obj.x-_this.spx;
      
      //$LASTPOS=35001087;//kernel.Layer2D:1087
      dy = obj.y-_this.spy;
      
      //$LASTPOS=35001256;//kernel.Layer2D:1256
      x = _this.wpx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)/_this.scale;
      
      //$LASTPOS=35001307;//kernel.Layer2D:1307
      y = _this.wpy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)/_this.scale;
      
      return {x: x,y: y,rotation: rt,scale: 1/_this.scale,layer: _this.group};
    },
    fiber$screen2world :function _trc_Layer2D_f_screen2world(_thread,obj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var rt;
      var dx;
      var dy;
      var x;
      var y;
      
      //$LASTPOS=35001041;//kernel.Layer2D:1041
      rt = - _this.rotation;
      
      //$LASTPOS=35001064;//kernel.Layer2D:1064
      dx = obj.x-_this.spx;
      
      //$LASTPOS=35001087;//kernel.Layer2D:1087
      dy = obj.y-_this.spy;
      
      //$LASTPOS=35001256;//kernel.Layer2D:1256
      x = _this.wpx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)/_this.scale;
      
      //$LASTPOS=35001307;//kernel.Layer2D:1307
      y = _this.wpy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)/_this.scale;
      
      _thread.retVal={x: x,y: y,rotation: rt,scale: 1/_this.scale,layer: _this.group};return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":false},"world2screen":{"nowait":false},"screen2world":{"nowait":false}},"fields":{"spx":{},"spy":{},"wpx":{},"wpy":{},"rotation":{},"scale":{},"group":{},"screen":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.OneframeSprite',
  shortName: 'OneframeSprite',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: {
    main :function _trc_OneframeSprite_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_OneframeSprite_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_OneframeSprite_initialize(params) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=36000054;//kernel.OneframeSprite:54
      _this.extend(params);
      //$LASTPOS=36000075;//kernel.OneframeSprite:75
      if (_this.layer&&typeof  _this.layer.add=="function") {
        //$LASTPOS=36000127;//kernel.OneframeSprite:127
        _this.layer.add(_this);
        
      } else {
        //$LASTPOS=36000165;//kernel.OneframeSprite:165
        Tonyu.globals.$Sprites.add(_this);
        
      }
    },
    die :function _trc_OneframeSprite_die() {
      "use strict";
      var _this=this;
      
    },
    fiber$die :function _trc_OneframeSprite_f_die(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    isDead :function _trc_OneframeSprite_isDead() {
      "use strict";
      var _this=this;
      
    },
    fiber$isDead :function _trc_OneframeSprite_f_isDead(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"die":{"nowait":false},"isDead":{"nowait":false}},"fields":{"layer":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.SpriteGroup',
  shortName: 'SpriteGroup',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: {
    main :function _trc_SpriteGroup_main() {
      "use strict";
      var _this=this;
      
      
    },
    fiber$main :function _trc_SpriteGroup_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      
      _thread.retVal=_this;return;
    },
    get :function _trc_SpriteGroup_get(i) {
      "use strict";
      var _this=this;
      
      return _this.sprites[i];
    },
    fiber$get :function _trc_SpriteGroup_f_get(_thread,i) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.sprites[i];return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"get":{"nowait":false}},"fields":{"sprites":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.SpriteMod2D',
  shortName: 'SpriteMod2D',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.SpriteMod,Tonyu.classes.kernel.TextRectMod],
  methods: {
    main :function _trc_SpriteMod2D_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=37000048;//kernel.SpriteMod2D:48
      "field strict";
      
    },
    fiber$main :function _trc_SpriteMod2D_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=37000048;//kernel.SpriteMod2D:48
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    performTransform :function _trc_SpriteMod2D_performTransform(ctx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=37000132;//kernel.SpriteMod2D:132
      if (_this.x!==_this.x||_this.y!==_this.y||_this.x==null||_this.y==null) {
        
        
      }
      //$LASTPOS=37000261;//kernel.SpriteMod2D:261
      ctx.translate(_this.x,_this.y);
      //$LASTPOS=37000286;//kernel.SpriteMod2D:286
      if (_this.rotation!=0) {
        //$LASTPOS=37000317;//kernel.SpriteMod2D:317
        ctx.rotate(_this.rotation/180*Math.PI);
        
      } else {
        //$LASTPOS=37000377;//kernel.SpriteMod2D:377
        ctx.rotate(_this.rotate/180*Math.PI);
        
      }
      //$LASTPOS=37000426;//kernel.SpriteMod2D:426
      if (typeof  _this.scaleY==="undefined") {
        //$LASTPOS=37000474;//kernel.SpriteMod2D:474
        ctx.scale(_this.scaleX,_this.scaleX);
        
      } else {
        //$LASTPOS=37000531;//kernel.SpriteMod2D:531
        ctx.scale(_this.scaleX,_this.scaleY);
        
      }
      //$LASTPOS=37000579;//kernel.SpriteMod2D:579
      ctx.globalAlpha=(_this.alpha<0?0:_this.alpha>255?255:_this.alpha)/255;
    },
    draw :function _trc_SpriteMod2D_draw(ctx) {
      "use strict";
      var _this=this;
      var drawY;
      var splitsText;
      var textCount;
      var rect;
      
      
      //$LASTPOS=37000681;//kernel.SpriteMod2D:681
      if (_this.x==null||_this.y==null||_this._isInvisible) {
        return _this;
      }
      //$LASTPOS=37000734;//kernel.SpriteMod2D:734
      if (_this.text!=null) {
        //$LASTPOS=37000761;//kernel.SpriteMod2D:761
        splitsText = (_this.text+"").split("\n");
        
        //$LASTPOS=37000808;//kernel.SpriteMod2D:808
        drawY=_this.y;
        //$LASTPOS=37000826;//kernel.SpriteMod2D:826
        if (! _this.size) {
          //$LASTPOS=37000837;//kernel.SpriteMod2D:837
          _this.size=15;
        }
        //$LASTPOS=37000855;//kernel.SpriteMod2D:855
        if (! _this.align) {
          //$LASTPOS=37000867;//kernel.SpriteMod2D:867
          _this.align="center";
        }
        //$LASTPOS=37000892;//kernel.SpriteMod2D:892
        if (! _this.fillStyle) {
          //$LASTPOS=37000908;//kernel.SpriteMod2D:908
          _this.fillStyle="white";
        }
        //$LASTPOS=37000936;//kernel.SpriteMod2D:936
        if (_this.font) {
          //$LASTPOS=37000946;//kernel.SpriteMod2D:946
          ctx.font=_this.size+"px "+_this.font;
        }
        //$LASTPOS=37000981;//kernel.SpriteMod2D:981
        ctx.fillStyle=_this.fillStyle+"";
        //$LASTPOS=37001018;//kernel.SpriteMod2D:1018
        ctx.globalAlpha=_this.alpha/255;
        //$LASTPOS=37001059;//kernel.SpriteMod2D:1059
        _this.height=0;
        //$LASTPOS=37001068;//kernel.SpriteMod2D:1068
        _this.width=0;
        //$LASTPOS=37001086;//kernel.SpriteMod2D:1086
        //$LASTPOS=37001090;//kernel.SpriteMod2D:1090
        textCount = 0;
        for (; textCount<splitsText.length ; textCount++) {
          {
            //$LASTPOS=37001161;//kernel.SpriteMod2D:1161
            rect = _this.drawTextRect(ctx,splitsText[textCount],_this.x,drawY,_this.size,_this.align,"fill");
            
            //$LASTPOS=37001257;//kernel.SpriteMod2D:1257
            if (_this.width<rect.w) {
              //$LASTPOS=37001274;//kernel.SpriteMod2D:1274
              _this.width=rect.w;
            }
            //$LASTPOS=37001301;//kernel.SpriteMod2D:1301
            _this.height+=rect.h;
            //$LASTPOS=37001330;//kernel.SpriteMod2D:1330
            drawY+=_this.size;
          }
        }
        
      } else {
        //$LASTPOS=37001366;//kernel.SpriteMod2D:1366
        if (_this.fillStyle!=null) {
          //$LASTPOS=37001398;//kernel.SpriteMod2D:1398
          ctx.save();
          //$LASTPOS=37001419;//kernel.SpriteMod2D:1419
          _this.performTransform(ctx);
          //$LASTPOS=37001451;//kernel.SpriteMod2D:1451
          ctx.fillStyle=_this.fillStyle+"";
          //$LASTPOS=37001488;//kernel.SpriteMod2D:1488
          if (_this.radius) {
            //$LASTPOS=37001515;//kernel.SpriteMod2D:1515
            ctx.beginPath();
            //$LASTPOS=37001545;//kernel.SpriteMod2D:1545
            ctx.arc(0,0,_this.radius,0,2*Math.PI);
            //$LASTPOS=37001591;//kernel.SpriteMod2D:1591
            ctx.fill();
            
          } else {
            //$LASTPOS=37001634;//kernel.SpriteMod2D:1634
            ctx.fillRect(- _this.width/2,- _this.height/2,_this.width,_this.height);
            
          }
          //$LASTPOS=37001701;//kernel.SpriteMod2D:1701
          ctx.restore();
          
        } else {
          //$LASTPOS=37001728;//kernel.SpriteMod2D:1728
          if (_this.p&&typeof  _this.p.draw==="function") {
            //$LASTPOS=37001776;//kernel.SpriteMod2D:1776
            ctx.save();
            //$LASTPOS=37001797;//kernel.SpriteMod2D:1797
            _this.performTransform(ctx);
            //$LASTPOS=37001829;//kernel.SpriteMod2D:1829
            _this.p.draw(ctx);
            //$LASTPOS=37001851;//kernel.SpriteMod2D:1851
            ctx.restore();
            //$LASTPOS=37001875;//kernel.SpriteMod2D:1875
            if (_this.p.width*_this.p.height>0) {
              //$LASTPOS=37001914;//kernel.SpriteMod2D:1914
              _this.width=_this.p.width;
              //$LASTPOS=37001942;//kernel.SpriteMod2D:1942
              _this.height=_this.p.height;
              
            }
            
          } else {
            //$LASTPOS=37001993;//kernel.SpriteMod2D:1993
            _this.detectShape();
            //$LASTPOS=37002017;//kernel.SpriteMod2D:2017
            if (_this.pImg) {
              //$LASTPOS=37002071;//kernel.SpriteMod2D:2071
              ctx.save();
              //$LASTPOS=37002096;//kernel.SpriteMod2D:2096
              _this.performTransform(ctx);
              //$LASTPOS=37002132;//kernel.SpriteMod2D:2132
              ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.width/2,- _this.height/2,_this.width,_this.height);
              //$LASTPOS=37002276;//kernel.SpriteMod2D:2276
              ctx.restore();
              
            }
            
          }
        }
      }
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"performTransform":{"nowait":true},"draw":{"nowait":true}},"fields":{"x":{},"y":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Sprites',
  shortName: 'Sprites',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.SpriteGroup,
  includes: [],
  methods: {
    main :function _trc_Sprites_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=38000022;//kernel.Sprites:22
      "field strict";
      
      
    },
    fiber$main :function _trc_Sprites_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=38000022;//kernel.Sprites:22
      "field strict";
      
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Sprites_initialize() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=38000150;//kernel.Sprites:150
      _this.sprites=[];
      //$LASTPOS=38000167;//kernel.Sprites:167
      _this.imageList=[];
      //$LASTPOS=38000186;//kernel.Sprites:186
      _this.hitWatchers=[];
      //$LASTPOS=38000243;//kernel.Sprites:243
      _this.sx=0;
      //$LASTPOS=38000254;//kernel.Sprites:254
      _this.sy=0;
      //$LASTPOS=38000265;//kernel.Sprites:265
      _this.objId=0;
    },
    addSubactor :function _trc_Sprites_addSubactor(s) {
      "use strict";
      var _this=this;
      
      return _this.add(s);
    },
    fiber$addSubactor :function _trc_Sprites_f_addSubactor(_thread,s) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Sprites_ent_addSubactor(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$add(_thread, s);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    add :function _trc_Sprites_add(s) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=38000351;//kernel.Sprites:351
      if (Tonyu.globals.$Boot.newLimit) {
        //$LASTPOS=38000382;//kernel.Sprites:382
        Tonyu.globals.$Boot.newLimitCount--;
        //$LASTPOS=38000414;//kernel.Sprites:414
        if (Tonyu.globals.$Boot.newLimitCount<=0) {
          throw new Error("一度にたくさんのオブジェクトを作りすぎています");
          
        }
        
      }
      //$LASTPOS=38000498;//kernel.Sprites:498
      if (s.__addedToSprites) {
        return _this;
      }
      //$LASTPOS=38000535;//kernel.Sprites:535
      if (s instanceof Tonyu.classes.kernel.PlainChar) {
        //$LASTPOS=38000574;//kernel.Sprites:574
        _this.t1Sprites=_this.t1Sprites||[];
        
      }
      //$LASTPOS=38000611;//kernel.Sprites:611
      if (_this.drawing) {
        //$LASTPOS=38000635;//kernel.Sprites:635
        s.draw(_this.drawing);
        return _this;
        
      }
      //$LASTPOS=38000681;//kernel.Sprites:681
      _this.sprites.push(s);
      //$LASTPOS=38000703;//kernel.Sprites:703
      if (s.__genId==null) {
        //$LASTPOS=38000733;//kernel.Sprites:733
        s.__genId=_this.objId;
        //$LASTPOS=38000759;//kernel.Sprites:759
        _this.objId++;
        
      }
      //$LASTPOS=38000780;//kernel.Sprites:780
      s.__addedToSprites=_this;
      return s;
    },
    fiber$add :function _trc_Sprites_f_add(_thread,s) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=38000351;//kernel.Sprites:351
      if (Tonyu.globals.$Boot.newLimit) {
        //$LASTPOS=38000382;//kernel.Sprites:382
        Tonyu.globals.$Boot.newLimitCount--;
        //$LASTPOS=38000414;//kernel.Sprites:414
        if (Tonyu.globals.$Boot.newLimitCount<=0) {
          throw new Error("一度にたくさんのオブジェクトを作りすぎています");
          
        }
        
      }
      //$LASTPOS=38000498;//kernel.Sprites:498
      if (s.__addedToSprites) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=38000535;//kernel.Sprites:535
      if (s instanceof Tonyu.classes.kernel.PlainChar) {
        //$LASTPOS=38000574;//kernel.Sprites:574
        _this.t1Sprites=_this.t1Sprites||[];
        
      }
      //$LASTPOS=38000611;//kernel.Sprites:611
      if (_this.drawing) {
        //$LASTPOS=38000635;//kernel.Sprites:635
        s.draw(_this.drawing);
        _thread.retVal=_this;return;
        
        
      }
      //$LASTPOS=38000681;//kernel.Sprites:681
      _this.sprites.push(s);
      //$LASTPOS=38000703;//kernel.Sprites:703
      if (s.__genId==null) {
        //$LASTPOS=38000733;//kernel.Sprites:733
        s.__genId=_this.objId;
        //$LASTPOS=38000759;//kernel.Sprites:759
        _this.objId++;
        
      }
      //$LASTPOS=38000780;//kernel.Sprites:780
      s.__addedToSprites=_this;
      _thread.retVal=s;return;
      
      
      _thread.retVal=_this;return;
    },
    remove :function _trc_Sprites_remove(s) {
      "use strict";
      var _this=this;
      var idx;
      
      //$LASTPOS=38000850;//kernel.Sprites:850
      idx = _this.sprites.indexOf(s);
      
      //$LASTPOS=38000883;//kernel.Sprites:883
      if (idx<0) {
        return _this;
      }
      //$LASTPOS=38000907;//kernel.Sprites:907
      _this.sprites.splice(idx,1);
      //$LASTPOS=38000935;//kernel.Sprites:935
      delete s.__addedToSprites;
    },
    fiber$remove :function _trc_Sprites_f_remove(_thread,s) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var idx;
      
      //$LASTPOS=38000850;//kernel.Sprites:850
      idx = _this.sprites.indexOf(s);
      
      //$LASTPOS=38000883;//kernel.Sprites:883
      if (idx<0) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=38000907;//kernel.Sprites:907
      _this.sprites.splice(idx,1);
      //$LASTPOS=38000935;//kernel.Sprites:935
      delete s.__addedToSprites;
      
      _thread.retVal=_this;return;
    },
    removeOneframes :function _trc_Sprites_removeOneframes(drawn) {
      "use strict";
      var _this=this;
      var s;
      var i;
      
      
      //$LASTPOS=38001069;//kernel.Sprites:1069
      //$LASTPOS=38001074;//kernel.Sprites:1074
      i = _this.sprites.length-1;
      for (; i>=0 ; i--) {
        {
          //$LASTPOS=38001122;//kernel.Sprites:1122
          s=_this.sprites[i];
          //$LASTPOS=38001145;//kernel.Sprites:1145
          if (s instanceof Tonyu.classes.kernel.OneframeSprite&&(! drawn||s.drawn)) {
            //$LASTPOS=38001318;//kernel.Sprites:1318
            Tonyu.globals.$ObjectPool.poolList(s.getClassInfo().fullName).push(s);
            //$LASTPOS=38001390;//kernel.Sprites:1390
            _this.sprites.splice(i,1);
            
          }
        }
      }
    },
    fiber$removeOneframes :function _trc_Sprites_f_removeOneframes(_thread,drawn) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var s;
      var i;
      
      
      //$LASTPOS=38001069;//kernel.Sprites:1069
      //$LASTPOS=38001074;//kernel.Sprites:1074
      i = _this.sprites.length-1;
      for (; i>=0 ; i--) {
        {
          //$LASTPOS=38001122;//kernel.Sprites:1122
          s=_this.sprites[i];
          //$LASTPOS=38001145;//kernel.Sprites:1145
          if (s instanceof Tonyu.classes.kernel.OneframeSprite&&(! drawn||s.drawn)) {
            //$LASTPOS=38001318;//kernel.Sprites:1318
            Tonyu.globals.$ObjectPool.poolList(s.getClassInfo().fullName).push(s);
            //$LASTPOS=38001390;//kernel.Sprites:1390
            _this.sprites.splice(i,1);
            
          }
        }
      }
      
      _thread.retVal=_this;return;
    },
    clear :function _trc_Sprites_clear() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=38001451;//kernel.Sprites:1451
      _this.sprites.splice(0,_this.sprites.length);
    },
    fiber$clear :function _trc_Sprites_f_clear(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=38001451;//kernel.Sprites:1451
      _this.sprites.splice(0,_this.sprites.length);
      
      _thread.retVal=_this;return;
    },
    compOrder :function _trc_Sprites_compOrder(obj1,obj2) {
      "use strict";
      var _this=this;
      var val1;
      var val2;
      
      //$LASTPOS=38001524;//kernel.Sprites:1524
      val1 = obj1.zOrder||0;
      
      //$LASTPOS=38001554;//kernel.Sprites:1554
      val2 = obj2.zOrder||0;
      
      //$LASTPOS=38001584;//kernel.Sprites:1584
      if (val1>val2) {
        return - 1;
        
      } else {
        //$LASTPOS=38001630;//kernel.Sprites:1630
        if (val1<val2) {
          return 1;
          
        } else {
          //$LASTPOS=38001675;//kernel.Sprites:1675
          if (val1==val2) {
            //$LASTPOS=38001700;//kernel.Sprites:1700
            if (obj1.__genId>obj2.__genId) {
              return 1;
              
            } else {
              return - 1;
              
            }
            return 0;
            
          }
        }
      }
    },
    fiber$compOrder :function _trc_Sprites_f_compOrder(_thread,obj1,obj2) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var val1;
      var val2;
      
      //$LASTPOS=38001524;//kernel.Sprites:1524
      val1 = obj1.zOrder||0;
      
      //$LASTPOS=38001554;//kernel.Sprites:1554
      val2 = obj2.zOrder||0;
      
      //$LASTPOS=38001584;//kernel.Sprites:1584
      if (val1>val2) {
        _thread.retVal=- 1;return;
        
        
      } else {
        //$LASTPOS=38001630;//kernel.Sprites:1630
        if (val1<val2) {
          _thread.retVal=1;return;
          
          
        } else {
          //$LASTPOS=38001675;//kernel.Sprites:1675
          if (val1==val2) {
            //$LASTPOS=38001700;//kernel.Sprites:1700
            if (obj1.__genId>obj2.__genId) {
              _thread.retVal=1;return;
              
              
            } else {
              _thread.retVal=- 1;return;
              
              
            }
            _thread.retVal=0;return;
            
            
          }
        }
      }
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_Sprites_draw(ctx,camera) {
      "use strict";
      var _this=this;
      var orderArray;
      
      //$LASTPOS=38001905;//kernel.Sprites:1905
      ctx.save();
      //$LASTPOS=38001922;//kernel.Sprites:1922
      orderArray = [];
      
      //$LASTPOS=38001946;//kernel.Sprites:1946
      if (_this.t1Sprites) {
        //$LASTPOS=38001972;//kernel.Sprites:1972
        _this.sprites.forEach((function anonymous_1988(s) {
          
          //$LASTPOS=38002008;//kernel.Sprites:2008
          if (s instanceof Tonyu.classes.kernel.PlainChar) {
            //$LASTPOS=38002055;//kernel.Sprites:2055
            s.draw();
            
          }
        }));
        //$LASTPOS=38002101;//kernel.Sprites:2101
        _this.sprites.forEach((function anonymous_2117(s) {
          
          //$LASTPOS=38002137;//kernel.Sprites:2137
          if (s instanceof Tonyu.classes.kernel.PlainChar) {
            
            
          } else {
            //$LASTPOS=38002187;//kernel.Sprites:2187
            orderArray.push(s);
          }
        }));
        
      } else {
        //$LASTPOS=38002242;//kernel.Sprites:2242
        orderArray=_this.sprites.slice();
        
      }
      //$LASTPOS=38002282;//kernel.Sprites:2282
      orderArray.sort(Tonyu.bindFunc(_this,_this.compOrder));
      //$LASTPOS=38002315;//kernel.Sprites:2315
      ctx.translate(- _this.sx,- _this.sy);
      //$LASTPOS=38002344;//kernel.Sprites:2344
      _this.drawing=ctx;
      //$LASTPOS=38002362;//kernel.Sprites:2362
      orderArray.forEach((function anonymous_2381(s) {
        
        //$LASTPOS=38002396;//kernel.Sprites:2396
        s.draw(ctx,camera);
      }));
      //$LASTPOS=38002431;//kernel.Sprites:2431
      _this.drawing=null;
      //$LASTPOS=38002450;//kernel.Sprites:2450
      ctx.restore();
    },
    fiber$draw :function _trc_Sprites_f_draw(_thread,ctx,camera) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var orderArray;
      
      //$LASTPOS=38001905;//kernel.Sprites:1905
      ctx.save();
      //$LASTPOS=38001922;//kernel.Sprites:1922
      orderArray = [];
      
      //$LASTPOS=38001946;//kernel.Sprites:1946
      if (_this.t1Sprites) {
        //$LASTPOS=38001972;//kernel.Sprites:1972
        _this.sprites.forEach((function anonymous_1988(s) {
          
          //$LASTPOS=38002008;//kernel.Sprites:2008
          if (s instanceof Tonyu.classes.kernel.PlainChar) {
            //$LASTPOS=38002055;//kernel.Sprites:2055
            s.draw();
            
          }
        }));
        //$LASTPOS=38002101;//kernel.Sprites:2101
        _this.sprites.forEach((function anonymous_2117(s) {
          
          //$LASTPOS=38002137;//kernel.Sprites:2137
          if (s instanceof Tonyu.classes.kernel.PlainChar) {
            
            
          } else {
            //$LASTPOS=38002187;//kernel.Sprites:2187
            orderArray.push(s);
          }
        }));
        
      } else {
        //$LASTPOS=38002242;//kernel.Sprites:2242
        orderArray=_this.sprites.slice();
        
      }
      //$LASTPOS=38002282;//kernel.Sprites:2282
      orderArray.sort(Tonyu.bindFunc(_this,_this.compOrder));
      //$LASTPOS=38002315;//kernel.Sprites:2315
      ctx.translate(- _this.sx,- _this.sy);
      //$LASTPOS=38002344;//kernel.Sprites:2344
      _this.drawing=ctx;
      //$LASTPOS=38002362;//kernel.Sprites:2362
      orderArray.forEach((function anonymous_2381(s) {
        
        //$LASTPOS=38002396;//kernel.Sprites:2396
        s.draw(ctx,camera);
      }));
      //$LASTPOS=38002431;//kernel.Sprites:2431
      _this.drawing=null;
      //$LASTPOS=38002450;//kernel.Sprites:2450
      ctx.restore();
      
      _thread.retVal=_this;return;
    },
    checkHit :function _trc_Sprites_checkHit() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=38002496;//kernel.Sprites:2496
      _this.hitWatchers.forEach((function anonymous_2516(w) {
        
        //$LASTPOS=38002540;//kernel.Sprites:2540
        _this.sprites.forEach((function anonymous_2556(a) {
          var a_owner;
          
          //$LASTPOS=38002628;//kernel.Sprites:2628
          a_owner = a;
          
          //$LASTPOS=38002670;//kernel.Sprites:2670
          if (! (a_owner instanceof w.A)) {
            return _this;
          }
          //$LASTPOS=38002723;//kernel.Sprites:2723
          _this.sprites.forEach((function anonymous_2739(b) {
            var b_owner;
            
            //$LASTPOS=38002771;//kernel.Sprites:2771
            b_owner = b;
            
            //$LASTPOS=38002817;//kernel.Sprites:2817
            if (a===b) {
              return _this;
            }
            //$LASTPOS=38002853;//kernel.Sprites:2853
            if (! (b_owner instanceof w.B)) {
              return _this;
            }
            //$LASTPOS=38002958;//kernel.Sprites:2958
            if (a.crashTo1(b)) {
              //$LASTPOS=38003061;//kernel.Sprites:3061
              w.h(a_owner,b_owner);
              
            }
          }));
        }));
      }));
    },
    fiber$checkHit :function _trc_Sprites_f_checkHit(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=38002496;//kernel.Sprites:2496
      _this.hitWatchers.forEach((function anonymous_2516(w) {
        
        //$LASTPOS=38002540;//kernel.Sprites:2540
        _this.sprites.forEach((function anonymous_2556(a) {
          var a_owner;
          
          //$LASTPOS=38002628;//kernel.Sprites:2628
          a_owner = a;
          
          //$LASTPOS=38002670;//kernel.Sprites:2670
          if (! (a_owner instanceof w.A)) {
            return _this;
          }
          //$LASTPOS=38002723;//kernel.Sprites:2723
          _this.sprites.forEach((function anonymous_2739(b) {
            var b_owner;
            
            //$LASTPOS=38002771;//kernel.Sprites:2771
            b_owner = b;
            
            //$LASTPOS=38002817;//kernel.Sprites:2817
            if (a===b) {
              return _this;
            }
            //$LASTPOS=38002853;//kernel.Sprites:2853
            if (! (b_owner instanceof w.B)) {
              return _this;
            }
            //$LASTPOS=38002958;//kernel.Sprites:2958
            if (a.crashTo1(b)) {
              //$LASTPOS=38003061;//kernel.Sprites:3061
              w.h(a_owner,b_owner);
              
            }
          }));
        }));
      }));
      
      _thread.retVal=_this;return;
    },
    watchHit :function _trc_Sprites_watchHit(typeA,typeB,onHit) {
      "use strict";
      var _this=this;
      var p;
      
      //$LASTPOS=38003191;//kernel.Sprites:3191
      p = {A: typeA,B: typeB,h: onHit};
      
      //$LASTPOS=38003255;//kernel.Sprites:3255
      _this.hitWatchers.push(p);
    },
    fiber$watchHit :function _trc_Sprites_f_watchHit(_thread,typeA,typeB,onHit) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var p;
      
      //$LASTPOS=38003191;//kernel.Sprites:3191
      p = {A: typeA,B: typeB,h: onHit};
      
      //$LASTPOS=38003255;//kernel.Sprites:3255
      _this.hitWatchers.push(p);
      
      _thread.retVal=_this;return;
    },
    drawGrid :function _trc_Sprites_drawGrid(c) {
      "use strict";
      var _this=this;
      var ctx;
      var i;
      
      //$LASTPOS=38003308;//kernel.Sprites:3308
      ctx = c.getContext("2d");
      
      //$LASTPOS=38003341;//kernel.Sprites:3341
      ctx.textBaseline="top";
      //$LASTPOS=38003370;//kernel.Sprites:3370
      ctx.save();
      //$LASTPOS=38003387;//kernel.Sprites:3387
      ctx.strokeStyle="rgb(40,100,200)";
      //$LASTPOS=38003427;//kernel.Sprites:3427
      //$LASTPOS=38003432;//kernel.Sprites:3432
      i = 0;
      for (; i<c.width ; i+=10) {
        {
          //$LASTPOS=38003472;//kernel.Sprites:3472
          ctx.beginPath();
          //$LASTPOS=38003498;//kernel.Sprites:3498
          ctx.lineWidth=(i%100==0?4:1);
          //$LASTPOS=38003544;//kernel.Sprites:3544
          ctx.moveTo(i,0);
          //$LASTPOS=38003570;//kernel.Sprites:3570
          ctx.lineTo(i,c.height);
          //$LASTPOS=38003603;//kernel.Sprites:3603
          ctx.closePath();
          //$LASTPOS=38003629;//kernel.Sprites:3629
          ctx.stroke();
        }
      }
      //$LASTPOS=38003657;//kernel.Sprites:3657
      //$LASTPOS=38003662;//kernel.Sprites:3662
      i = 0;
      for (; i<c.height ; i+=10) {
        {
          //$LASTPOS=38003703;//kernel.Sprites:3703
          ctx.beginPath();
          //$LASTPOS=38003729;//kernel.Sprites:3729
          ctx.lineWidth=(i%100==0?4:1);
          //$LASTPOS=38003775;//kernel.Sprites:3775
          ctx.moveTo(0,i);
          //$LASTPOS=38003801;//kernel.Sprites:3801
          ctx.lineTo(c.width,i);
          //$LASTPOS=38003833;//kernel.Sprites:3833
          ctx.closePath();
          //$LASTPOS=38003859;//kernel.Sprites:3859
          ctx.stroke();
        }
      }
      //$LASTPOS=38003885;//kernel.Sprites:3885
      ctx.fillStyle="white";
      //$LASTPOS=38003913;//kernel.Sprites:3913
      ctx.font="15px monospaced";
      //$LASTPOS=38003946;//kernel.Sprites:3946
      //$LASTPOS=38003951;//kernel.Sprites:3951
      i = 100;
      for (; i<c.width ; i+=100) {
        {
          //$LASTPOS=38003994;//kernel.Sprites:3994
          ctx.fillText(i,i,0);
        }
      }
      //$LASTPOS=38004028;//kernel.Sprites:4028
      //$LASTPOS=38004033;//kernel.Sprites:4033
      i = 100;
      for (; i<c.height ; i+=100) {
        {
          //$LASTPOS=38004077;//kernel.Sprites:4077
          ctx.fillText(i,0,i);
        }
      }
      //$LASTPOS=38004111;//kernel.Sprites:4111
      ctx.restore();
    },
    fiber$drawGrid :function _trc_Sprites_f_drawGrid(_thread,c) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      var i;
      
      //$LASTPOS=38003308;//kernel.Sprites:3308
      ctx = c.getContext("2d");
      
      //$LASTPOS=38003341;//kernel.Sprites:3341
      ctx.textBaseline="top";
      //$LASTPOS=38003370;//kernel.Sprites:3370
      ctx.save();
      //$LASTPOS=38003387;//kernel.Sprites:3387
      ctx.strokeStyle="rgb(40,100,200)";
      //$LASTPOS=38003427;//kernel.Sprites:3427
      //$LASTPOS=38003432;//kernel.Sprites:3432
      i = 0;
      for (; i<c.width ; i+=10) {
        {
          //$LASTPOS=38003472;//kernel.Sprites:3472
          ctx.beginPath();
          //$LASTPOS=38003498;//kernel.Sprites:3498
          ctx.lineWidth=(i%100==0?4:1);
          //$LASTPOS=38003544;//kernel.Sprites:3544
          ctx.moveTo(i,0);
          //$LASTPOS=38003570;//kernel.Sprites:3570
          ctx.lineTo(i,c.height);
          //$LASTPOS=38003603;//kernel.Sprites:3603
          ctx.closePath();
          //$LASTPOS=38003629;//kernel.Sprites:3629
          ctx.stroke();
        }
      }
      //$LASTPOS=38003657;//kernel.Sprites:3657
      //$LASTPOS=38003662;//kernel.Sprites:3662
      i = 0;
      for (; i<c.height ; i+=10) {
        {
          //$LASTPOS=38003703;//kernel.Sprites:3703
          ctx.beginPath();
          //$LASTPOS=38003729;//kernel.Sprites:3729
          ctx.lineWidth=(i%100==0?4:1);
          //$LASTPOS=38003775;//kernel.Sprites:3775
          ctx.moveTo(0,i);
          //$LASTPOS=38003801;//kernel.Sprites:3801
          ctx.lineTo(c.width,i);
          //$LASTPOS=38003833;//kernel.Sprites:3833
          ctx.closePath();
          //$LASTPOS=38003859;//kernel.Sprites:3859
          ctx.stroke();
        }
      }
      //$LASTPOS=38003885;//kernel.Sprites:3885
      ctx.fillStyle="white";
      //$LASTPOS=38003913;//kernel.Sprites:3913
      ctx.font="15px monospaced";
      //$LASTPOS=38003946;//kernel.Sprites:3946
      //$LASTPOS=38003951;//kernel.Sprites:3951
      i = 100;
      for (; i<c.width ; i+=100) {
        {
          //$LASTPOS=38003994;//kernel.Sprites:3994
          ctx.fillText(i,i,0);
        }
      }
      //$LASTPOS=38004028;//kernel.Sprites:4028
      //$LASTPOS=38004033;//kernel.Sprites:4033
      i = 100;
      for (; i<c.height ; i+=100) {
        {
          //$LASTPOS=38004077;//kernel.Sprites:4077
          ctx.fillText(i,0,i);
        }
      }
      //$LASTPOS=38004111;//kernel.Sprites:4111
      ctx.restore();
      
      _thread.retVal=_this;return;
    },
    scrollTo :function _trc_Sprites_scrollTo(scrollX,scrollY) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=38004171;//kernel.Sprites:4171
      _this.sx=scrollX;
      //$LASTPOS=38004188;//kernel.Sprites:4188
      _this.sy=scrollY;
    },
    fiber$scrollTo :function _trc_Sprites_f_scrollTo(_thread,scrollX,scrollY) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=38004171;//kernel.Sprites:4171
      _this.sx=scrollX;
      //$LASTPOS=38004188;//kernel.Sprites:4188
      _this.sy=scrollY;
      
      _thread.retVal=_this;return;
    },
    all :function _trc_Sprites_all(c) {
      "use strict";
      var _this=this;
      var res;
      
      //$LASTPOS=38004228;//kernel.Sprites:4228
      res = new Tonyu.classes.kernel.TQuery;
      
      //$LASTPOS=38004253;//kernel.Sprites:4253
      if (arguments.length>0&&typeof  c!="function") {
        return res;
        
      }
      //$LASTPOS=38004336;//kernel.Sprites:4336
      _this.sprites.forEach((function anonymous_4352(s) {
        
        //$LASTPOS=38004368;//kernel.Sprites:4368
        if (s===_this) {
          return _this;
        }
        //$LASTPOS=38004399;//kernel.Sprites:4399
        if (! c||s instanceof c) {
          //$LASTPOS=38004440;//kernel.Sprites:4440
          res.push(s);
          
        }
      }));
      return res;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"addSubactor":{"nowait":false},"add":{"nowait":false},"remove":{"nowait":false},"removeOneframes":{"nowait":false},"clear":{"nowait":false},"compOrder":{"nowait":false},"draw":{"nowait":false},"checkHit":{"nowait":false},"watchHit":{"nowait":false},"drawGrid":{"nowait":false},"scrollTo":{"nowait":false},"all":{"nowait":true}},"fields":{"imageList":{},"hitWatchers":{},"objId":{},"t1Sprites":{},"drawing":{},"sx":{},"sy":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Sprites3D',
  shortName: 'Sprites3D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.SpriteGroup,
  includes: [],
  methods: {
    main :function _trc_Sprites3D_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=39000039;//kernel.Sprites3D:39
      "field strict";
    },
    fiber$main :function _trc_Sprites3D_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=39000039;//kernel.Sprites3D:39
      "field strict";
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Sprites3D_initialize(p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=39000071;//kernel.Sprites3D:71
      Tonyu.classes.kernel.SpriteGroup.apply( _this, [p]);
      //$LASTPOS=39000086;//kernel.Sprites3D:86
      _this.sprites=[];
    },
    add :function _trc_Sprites3D_add(a) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=39000125;//kernel.Sprites3D:125
      if (a.transform&&_this.transform) {
        //$LASTPOS=39000160;//kernel.Sprites3D:160
        a.transform.parent=_this.transform;
      }
      //$LASTPOS=39000200;//kernel.Sprites3D:200
      a.layer=_this;
      //$LASTPOS=39000219;//kernel.Sprites3D:219
      _this.sprites.push(a);
    },
    fiber$add :function _trc_Sprites3D_f_add(_thread,a) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=39000125;//kernel.Sprites3D:125
      if (a.transform&&_this.transform) {
        //$LASTPOS=39000160;//kernel.Sprites3D:160
        a.transform.parent=_this.transform;
      }
      //$LASTPOS=39000200;//kernel.Sprites3D:200
      a.layer=_this;
      //$LASTPOS=39000219;//kernel.Sprites3D:219
      _this.sprites.push(a);
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_Sprites3D_draw(ctx,camera) {
      "use strict";
      var _this=this;
      var s2ds;
      var s;
      var _it_319;
      var s2d;
      var _it_320;
      
      //$LASTPOS=39000265;//kernel.Sprites3D:265
      s2ds = [];
      
      //$LASTPOS=39000283;//kernel.Sprites3D:283
      camera.sprites2D=s2ds;
      //$LASTPOS=39000311;//kernel.Sprites3D:311
      _it_319=Tonyu.iterator(_this.sprites,1);
      while(_it_319.next()) {
        s=_it_319[0];
        
        //$LASTPOS=39000345;//kernel.Sprites3D:345
        s.draw3D(camera);
        
      }
      //$LASTPOS=39000375;//kernel.Sprites3D:375
      s2ds=s2ds.sort((function anonymous_390(a,b) {
        
        return b.zOrder-a.zOrder;
      }));
      //$LASTPOS=39000447;//kernel.Sprites3D:447
      _it_320=Tonyu.iterator(s2ds,1);
      while(_it_320.next()) {
        s2d=_it_320[0];
        
        //$LASTPOS=39000480;//kernel.Sprites3D:480
        s2d.draw(ctx,camera);
        
      }
    },
    fiber$draw :function _trc_Sprites3D_f_draw(_thread,ctx,camera) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var s2ds;
      var s;
      var _it_319;
      var s2d;
      var _it_320;
      
      //$LASTPOS=39000265;//kernel.Sprites3D:265
      s2ds = [];
      
      //$LASTPOS=39000283;//kernel.Sprites3D:283
      camera.sprites2D=s2ds;
      //$LASTPOS=39000311;//kernel.Sprites3D:311
      _it_319=Tonyu.iterator(_this.sprites,1);
      while(_it_319.next()) {
        s=_it_319[0];
        
        //$LASTPOS=39000345;//kernel.Sprites3D:345
        s.draw3D(camera);
        
      }
      //$LASTPOS=39000375;//kernel.Sprites3D:375
      s2ds=s2ds.sort((function anonymous_390(a,b) {
        
        return b.zOrder-a.zOrder;
      }));
      //$LASTPOS=39000447;//kernel.Sprites3D:447
      _it_320=Tonyu.iterator(s2ds,1);
      while(_it_320.next()) {
        s2d=_it_320[0];
        
        //$LASTPOS=39000480;//kernel.Sprites3D:480
        s2d.draw(ctx,camera);
        
      }
      
      _thread.retVal=_this;return;
    },
    draw3D :function _trc_Sprites3D_draw3D(camera) {
      "use strict";
      var _this=this;
      var s;
      var _it_328;
      
      //$LASTPOS=39000536;//kernel.Sprites3D:536
      _it_328=Tonyu.iterator(_this.sprites,1);
      while(_it_328.next()) {
        s=_it_328[0];
        
        //$LASTPOS=39000570;//kernel.Sprites3D:570
        s.draw3D(camera);
        
      }
    },
    fiber$draw3D :function _trc_Sprites3D_f_draw3D(_thread,camera) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var s;
      var _it_328;
      
      //$LASTPOS=39000536;//kernel.Sprites3D:536
      _it_328=Tonyu.iterator(_this.sprites,1);
      while(_it_328.next()) {
        s=_it_328[0];
        
        //$LASTPOS=39000570;//kernel.Sprites3D:570
        s.draw3D(camera);
        
      }
      
      _thread.retVal=_this;return;
    },
    remove :function _trc_Sprites3D_remove(s) {
      "use strict";
      var _this=this;
      var idx;
      
      //$LASTPOS=39000655;//kernel.Sprites3D:655
      idx = _this.sprites.indexOf(s);
      
      //$LASTPOS=39000718;//kernel.Sprites3D:718
      if (idx<0) {
        return _this;
      }
      //$LASTPOS=39000742;//kernel.Sprites3D:742
      _this.sprites.splice(idx,1);
      //$LASTPOS=39000770;//kernel.Sprites3D:770
      delete s.__addedToSprites;
    },
    all :function _trc_Sprites3D_all(c) {
      "use strict";
      var _this=this;
      var res;
      
      //$LASTPOS=39000861;//kernel.Sprites3D:861
      res = new Tonyu.classes.kernel.TQuery;
      
      //$LASTPOS=39000886;//kernel.Sprites3D:886
      if (arguments.length>0&&typeof  c!="function") {
        return res;
        
      }
      //$LASTPOS=39000969;//kernel.Sprites3D:969
      _this.sprites.forEach((function anonymous_985(s) {
        
        //$LASTPOS=39001001;//kernel.Sprites3D:1001
        if (s===_this) {
          return _this;
        }
        //$LASTPOS=39001032;//kernel.Sprites3D:1032
        if (! c||s instanceof c) {
          //$LASTPOS=39001073;//kernel.Sprites3D:1073
          res.push(s);
          
        }
      }));
      return res;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"add":{"nowait":false},"draw":{"nowait":false},"draw3D":{"nowait":false},"remove":{"nowait":true},"all":{"nowait":true}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.MML',
  shortName: 'MML',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_MML_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=40000050;//kernel.MML:50
      _this.mmlBuf=[];
    },
    fiber$main :function _trc_MML_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=40000050;//kernel.MML:50
      _this.mmlBuf=[];
      
      _thread.retVal=_this;return;
    },
    play :function _trc_MML_play(mmls) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=40000081;//kernel.MML:81
      _this.mmlBuf.push(mmls);
      //$LASTPOS=40000105;//kernel.MML:105
      if (! _this.isPlaying()) {
        //$LASTPOS=40000134;//kernel.MML:134
        _this.playNext();
        
      }
    },
    fiber$play :function _trc_MML_f_play(_thread,mmls) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=40000081;//kernel.MML:81
      _this.mmlBuf.push(mmls);
      
      _thread.enter(function _trc_MML_ent_play(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=40000105;//kernel.MML:105
            if (!(! _this.isPlaying())) { __pc=2     ; break; }
            //$LASTPOS=40000134;//kernel.MML:134
            _this.fiber$playNext(_thread);
            __pc=1;return;
          case 1:
            
          case 2     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    playNext :function _trc_MML_playNext() {
      "use strict";
      var _this=this;
      var mml;
      
      //$LASTPOS=40000220;//kernel.MML:220
      if (_this.cTimeBase==null) {
        //$LASTPOS=40000241;//kernel.MML:241
        _this.cTimeBase=0;
      }
      //$LASTPOS=40000259;//kernel.MML:259
      if (_this.m) {
        //$LASTPOS=40000277;//kernel.MML:277
        _this.cTimeBase+=_this.m.currentTime;
        
      }
      //$LASTPOS=40000348;//kernel.MML:348
      mml = _this.mmlBuf.shift();
      
      //$LASTPOS=40000377;//kernel.MML:377
      if (! mml) {
        //$LASTPOS=40000398;//kernel.MML:398
        _this.m=null;
        //$LASTPOS=40000415;//kernel.MML:415
        _this.cTimeBase=0;
        return _this;
        
      }
      //$LASTPOS=40000457;//kernel.MML:457
      _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();
      //$LASTPOS=40000495;//kernel.MML:495
      _this.m=T("mml",{mml: mml},_this.mwav);
      //$LASTPOS=40000525;//kernel.MML:525
      _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));
      //$LASTPOS=40000555;//kernel.MML:555
      _this.m.start();
      //$LASTPOS=40000571;//kernel.MML:571
      Tonyu.globals.$MMLS[_this.id()]=_this;
    },
    fiber$playNext :function _trc_MML_f_playNext(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var mml;
      
      //$LASTPOS=40000220;//kernel.MML:220
      if (_this.cTimeBase==null) {
        //$LASTPOS=40000241;//kernel.MML:241
        _this.cTimeBase=0;
      }
      //$LASTPOS=40000259;//kernel.MML:259
      if (_this.m) {
        //$LASTPOS=40000277;//kernel.MML:277
        _this.cTimeBase+=_this.m.currentTime;
        
      }
      //$LASTPOS=40000348;//kernel.MML:348
      mml = _this.mmlBuf.shift();
      
      //$LASTPOS=40000377;//kernel.MML:377
      if (! mml) {
        //$LASTPOS=40000398;//kernel.MML:398
        _this.m=null;
        //$LASTPOS=40000415;//kernel.MML:415
        _this.cTimeBase=0;
        _thread.retVal=_this;return;
        
        
      }
      //$LASTPOS=40000457;//kernel.MML:457
      _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();
      //$LASTPOS=40000495;//kernel.MML:495
      _this.m=T("mml",{mml: mml},_this.mwav);
      //$LASTPOS=40000525;//kernel.MML:525
      _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));
      //$LASTPOS=40000555;//kernel.MML:555
      _this.m.start();
      //$LASTPOS=40000571;//kernel.MML:571
      Tonyu.globals.$MMLS[_this.id()]=_this;
      
      _thread.retVal=_this;return;
    },
    id :function _trc_MML_id() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=40000606;//kernel.MML:606
      if (! _this._id) {
        //$LASTPOS=40000616;//kernel.MML:616
        _this._id=_this.rnd()+"";
      }
      return _this._id;
    },
    fiber$id :function _trc_MML_f_id(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=40000606;//kernel.MML:606
      if (! _this._id) {
        //$LASTPOS=40000616;//kernel.MML:616
        _this._id=_this.rnd()+"";
      }
      _thread.retVal=_this._id;return;
      
      
      _thread.retVal=_this;return;
    },
    bufferCount :function _trc_MML_bufferCount() {
      "use strict";
      var _this=this;
      
      return _this.mmlBuf.length;
    },
    fiber$bufferCount :function _trc_MML_f_bufferCount(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.mmlBuf.length;return;
      
      
      _thread.retVal=_this;return;
    },
    isPlaying :function _trc_MML_isPlaying() {
      "use strict";
      var _this=this;
      
      return _this.m;
    },
    fiber$isPlaying :function _trc_MML_f_isPlaying(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.m;return;
      
      
      _thread.retVal=_this;return;
    },
    currentTime :function _trc_MML_currentTime() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=40000755;//kernel.MML:755
      if (_this.m) {
        return _this.m.currentTime+_this.cTimeBase;
      }
      return - 1;
    },
    fiber$currentTime :function _trc_MML_f_currentTime(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=40000755;//kernel.MML:755
      if (_this.m) {
        _thread.retVal=_this.m.currentTime+_this.cTimeBase;return;
        
      }
      _thread.retVal=- 1;return;
      
      
      _thread.retVal=_this;return;
    },
    stop :function _trc_MML_stop() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=40000829;//kernel.MML:829
      if (_this.m) {
        //$LASTPOS=40000847;//kernel.MML:847
        if (_this.mwav) {
          //$LASTPOS=40000872;//kernel.MML:872
          _this.mwav.pause();
          //$LASTPOS=40000899;//kernel.MML:899
          _this.mwav.stop();
          
        }
        //$LASTPOS=40000932;//kernel.MML:932
        _this.m.pause();
        //$LASTPOS=40000952;//kernel.MML:952
        _this.m.stop();
        //$LASTPOS=40000971;//kernel.MML:971
        _this.m=null;
        //$LASTPOS=40000988;//kernel.MML:988
        _this.mmlBuf=[];
        //$LASTPOS=40001056;//kernel.MML:1056
        delete Tonyu.globals.$MMLS[_this.id()];
        
      }
    },
    fiber$stop :function _trc_MML_f_stop(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=40000829;//kernel.MML:829
      if (_this.m) {
        //$LASTPOS=40000847;//kernel.MML:847
        if (_this.mwav) {
          //$LASTPOS=40000872;//kernel.MML:872
          _this.mwav.pause();
          //$LASTPOS=40000899;//kernel.MML:899
          _this.mwav.stop();
          
        }
        //$LASTPOS=40000932;//kernel.MML:932
        _this.m.pause();
        //$LASTPOS=40000952;//kernel.MML:952
        _this.m.stop();
        //$LASTPOS=40000971;//kernel.MML:971
        _this.m=null;
        //$LASTPOS=40000988;//kernel.MML:988
        _this.mmlBuf=[];
        //$LASTPOS=40001056;//kernel.MML:1056
        delete Tonyu.globals.$MMLS[_this.id()];
        
      }
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"play":{"nowait":false},"playNext":{"nowait":false},"id":{"nowait":false},"bufferCount":{"nowait":false},"isPlaying":{"nowait":false},"currentTime":{"nowait":false},"stop":{"nowait":false}},"fields":{"mmlBuf":{},"cTimeBase":{},"m":{},"mwav":{},"_id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.WaveTable',
  shortName: 'WaveTable',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: {
    main :function _trc_WaveTable_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=41000031;//kernel.WaveTable:31
      _this.wav={};
      //$LASTPOS=41000040;//kernel.WaveTable:40
      _this.env={};
      //$LASTPOS=41000335;//kernel.WaveTable:335
      if (typeof  T!=="undefined") {
        //$LASTPOS=41000416;//kernel.WaveTable:416
        _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});
        //$LASTPOS=41000485;//kernel.WaveTable:485
        _this.setEnv(0,_this.env);
        //$LASTPOS=41000506;//kernel.WaveTable:506
        _this.setWav(0,T("pulse"));
        
      }
    },
    fiber$main :function _trc_WaveTable_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=41000031;//kernel.WaveTable:31
      _this.wav={};
      //$LASTPOS=41000040;//kernel.WaveTable:40
      _this.env={};
      
      _thread.enter(function _trc_WaveTable_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=41000335;//kernel.WaveTable:335
            if (!(typeof  T!=="undefined")) { __pc=3     ; break; }
            //$LASTPOS=41000416;//kernel.WaveTable:416
            _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});
            //$LASTPOS=41000485;//kernel.WaveTable:485
            _this.fiber$setEnv(_thread, 0, _this.env);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=41000506;//kernel.WaveTable:506
            _this.fiber$setWav(_thread, 0, T("pulse"));
            __pc=2;return;
          case 2:
            
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    setWav :function _trc_WaveTable_setWav(num,synth) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=41000076;//kernel.WaveTable:76
      _this.wav[num]=synth;
    },
    fiber$setWav :function _trc_WaveTable_f_setWav(_thread,num,synth) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=41000076;//kernel.WaveTable:76
      _this.wav[num]=synth;
      
      _thread.retVal=_this;return;
    },
    setEnv :function _trc_WaveTable_setEnv(num,synth) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=41000123;//kernel.WaveTable:123
      _this.env[num]=synth;
    },
    fiber$setEnv :function _trc_WaveTable_f_setEnv(_thread,num,synth) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=41000123;//kernel.WaveTable:123
      _this.env[num]=synth;
      
      _thread.retVal=_this;return;
    },
    get :function _trc_WaveTable_get(w,e) {
      "use strict";
      var _this=this;
      var synth;
      
      //$LASTPOS=41000160;//kernel.WaveTable:160
      synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});
      
      return synth;
    },
    fiber$get :function _trc_WaveTable_f_get(_thread,w,e) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var synth;
      
      //$LASTPOS=41000160;//kernel.WaveTable:160
      synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});
      
      _thread.retVal=synth;return;
      
      
      _thread.retVal=_this;return;
    },
    stop :function _trc_WaveTable_stop() {
      "use strict";
      var _this=this;
      
    },
    fiber$stop :function _trc_WaveTable_f_stop(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"setWav":{"nowait":false},"setEnv":{"nowait":false},"get":{"nowait":false},"stop":{"nowait":false}},"fields":{"wav":{},"env":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Line',
  shortName: 'T1Line',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.OneframeSprite,
  includes: [],
  methods: {
    main :function _trc_T1Line_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_T1Line_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_T1Line_draw(ctx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=42000043;//kernel.T1Line:43
      ctx.strokeStyle=_this.col+"";
      //$LASTPOS=42000072;//kernel.T1Line:72
      ctx.beginPath();
      //$LASTPOS=42000094;//kernel.T1Line:94
      ctx.moveTo(_this.x,_this.y);
      //$LASTPOS=42000116;//kernel.T1Line:116
      ctx.lineTo(_this.tx,_this.ty);
      //$LASTPOS=42000140;//kernel.T1Line:140
      ctx.stroke();
      //$LASTPOS=42000159;//kernel.T1Line:159
      _this.drawn=true;
    },
    fiber$draw :function _trc_T1Line_f_draw(_thread,ctx) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=42000043;//kernel.T1Line:43
      ctx.strokeStyle=_this.col+"";
      //$LASTPOS=42000072;//kernel.T1Line:72
      ctx.beginPath();
      //$LASTPOS=42000094;//kernel.T1Line:94
      ctx.moveTo(_this.x,_this.y);
      //$LASTPOS=42000116;//kernel.T1Line:116
      ctx.lineTo(_this.tx,_this.ty);
      //$LASTPOS=42000140;//kernel.T1Line:140
      ctx.stroke();
      //$LASTPOS=42000159;//kernel.T1Line:159
      _this.drawn=true;
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":false}},"fields":{"col":{},"x":{},"y":{},"tx":{},"ty":{},"drawn":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Rect',
  shortName: 'T1Rect',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.OneframeSprite,
  includes: [],
  methods: {
    main :function _trc_T1Rect_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_T1Rect_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_T1Rect_draw(ctx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=43000041;//kernel.T1Rect:41
      ctx.fillStyle=_this.col+"";
      //$LASTPOS=43000067;//kernel.T1Rect:67
      ctx.fillRect(_this.x,_this.y,_this.w,_this.h);
      //$LASTPOS=43000094;//kernel.T1Rect:94
      _this.drawn=true;
    },
    fiber$draw :function _trc_T1Rect_f_draw(_thread,ctx) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=43000041;//kernel.T1Rect:41
      ctx.fillStyle=_this.col+"";
      //$LASTPOS=43000067;//kernel.T1Rect:67
      ctx.fillRect(_this.x,_this.y,_this.w,_this.h);
      //$LASTPOS=43000094;//kernel.T1Rect:94
      _this.drawn=true;
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":false}},"fields":{"col":{},"x":{},"y":{},"w":{},"h":{},"drawn":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Sprite',
  shortName: 'T1Sprite',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.OneframeSprite,
  includes: [],
  methods: {
    main :function _trc_T1Sprite_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_T1Sprite_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_T1Sprite_draw(ctx) {
      "use strict";
      var _this=this;
      var sgn;
      
      //$LASTPOS=44000057;//kernel.T1Sprite:57
      _this.pImg=Tonyu.globals.$imageList[Math.floor(_this.p||0)];
      //$LASTPOS=44000097;//kernel.T1Sprite:97
      if (! _this.pImg) {
        return _this;
      }
      //$LASTPOS=44000121;//kernel.T1Sprite:121
      ctx.save();
      //$LASTPOS=44000138;//kernel.T1Sprite:138
      ctx.translate(_this.x,_this.y);
      //$LASTPOS=44000163;//kernel.T1Sprite:163
      ctx.rotate(_this.angle/180*Math.PI);
      //$LASTPOS=44000204;//kernel.T1Sprite:204
      sgn = (_this.f?- 1:1);
      
      //$LASTPOS=44000227;//kernel.T1Sprite:227
      if (typeof  _this.scaleY==="undefined") {
        //$LASTPOS=44000275;//kernel.T1Sprite:275
        ctx.scale(_this.scaleX*sgn,_this.scaleX);
        
      } else {
        //$LASTPOS=44000336;//kernel.T1Sprite:336
        ctx.scale(_this.scaleX*sgn,_this.scaleY);
        
      }
      //$LASTPOS=44000388;//kernel.T1Sprite:388
      ctx.globalAlpha=_this.alpha/255;
      //$LASTPOS=44000425;//kernel.T1Sprite:425
      ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.pImg.width/2,- _this.pImg.height/2,_this.pImg.width,_this.pImg.height);
      //$LASTPOS=44000565;//kernel.T1Sprite:565
      ctx.restore();
      //$LASTPOS=44000585;//kernel.T1Sprite:585
      _this.drawn=true;
    },
    fiber$draw :function _trc_T1Sprite_f_draw(_thread,ctx) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var sgn;
      
      //$LASTPOS=44000057;//kernel.T1Sprite:57
      _this.pImg=Tonyu.globals.$imageList[Math.floor(_this.p||0)];
      //$LASTPOS=44000097;//kernel.T1Sprite:97
      if (! _this.pImg) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=44000121;//kernel.T1Sprite:121
      ctx.save();
      //$LASTPOS=44000138;//kernel.T1Sprite:138
      ctx.translate(_this.x,_this.y);
      //$LASTPOS=44000163;//kernel.T1Sprite:163
      ctx.rotate(_this.angle/180*Math.PI);
      //$LASTPOS=44000204;//kernel.T1Sprite:204
      sgn = (_this.f?- 1:1);
      
      //$LASTPOS=44000227;//kernel.T1Sprite:227
      if (typeof  _this.scaleY==="undefined") {
        //$LASTPOS=44000275;//kernel.T1Sprite:275
        ctx.scale(_this.scaleX*sgn,_this.scaleX);
        
      } else {
        //$LASTPOS=44000336;//kernel.T1Sprite:336
        ctx.scale(_this.scaleX*sgn,_this.scaleY);
        
      }
      //$LASTPOS=44000388;//kernel.T1Sprite:388
      ctx.globalAlpha=_this.alpha/255;
      //$LASTPOS=44000425;//kernel.T1Sprite:425
      ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.pImg.width/2,- _this.pImg.height/2,_this.pImg.width,_this.pImg.height);
      //$LASTPOS=44000565;//kernel.T1Sprite:565
      ctx.restore();
      //$LASTPOS=44000585;//kernel.T1Sprite:585
      _this.drawn=true;
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":false}},"fields":{"pImg":{},"p":{},"x":{},"y":{},"f":{},"drawn":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Text',
  shortName: 'T1Text',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.OneframeSprite,
  includes: [Tonyu.classes.kernel.TextRectMod],
  methods: {
    main :function _trc_T1Text_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_T1Text_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_T1Text_draw(ctx) {
      "use strict";
      var _this=this;
      var splitsText;
      var drawY;
      var textCount;
      var rect;
      
      //$LASTPOS=45000066;//kernel.T1Text:66
      ctx.font=_this.size+"px 'ＭＳ Ｐゴシック'";
      //$LASTPOS=45000102;//kernel.T1Text:102
      splitsText = (_this.text+"").split("\n");
      
      //$LASTPOS=45000145;//kernel.T1Text:145
      drawY = _this.y;
      
      //$LASTPOS=45000163;//kernel.T1Text:163
      if (! _this.size) {
        //$LASTPOS=45000174;//kernel.T1Text:174
        _this.size=15;
      }
      //$LASTPOS=45000188;//kernel.T1Text:188
      if (! _this.align) {
        //$LASTPOS=45000200;//kernel.T1Text:200
        _this.align="left";
      }
      //$LASTPOS=45000219;//kernel.T1Text:219
      if (! _this.fillStyle) {
        //$LASTPOS=45000235;//kernel.T1Text:235
        _this.fillStyle="white";
      }
      //$LASTPOS=45000259;//kernel.T1Text:259
      ctx.fillStyle=_this.col+"";
      //$LASTPOS=45000286;//kernel.T1Text:286
      ctx.globalAlpha=_this.alpha/255;
      //$LASTPOS=45000323;//kernel.T1Text:323
      _this.height=0;
      //$LASTPOS=45000332;//kernel.T1Text:332
      _this.width=0;
      //$LASTPOS=45000346;//kernel.T1Text:346
      //$LASTPOS=45000350;//kernel.T1Text:350
      textCount = 0;
      for (; textCount<splitsText.length ; textCount++) {
        {
          //$LASTPOS=45000417;//kernel.T1Text:417
          rect = _this.drawTextRect(ctx,splitsText[textCount],_this.x,drawY,_this.size,_this.align,"fill");
          
          //$LASTPOS=45000509;//kernel.T1Text:509
          if (_this.width<rect.w) {
            //$LASTPOS=45000526;//kernel.T1Text:526
            _this.width=rect.w;
          }
          //$LASTPOS=45000549;//kernel.T1Text:549
          _this.height+=rect.h;
          //$LASTPOS=45000574;//kernel.T1Text:574
          drawY+=_this.size;
        }
      }
      //$LASTPOS=45000599;//kernel.T1Text:599
      _this.owner.width=_this.width;
      //$LASTPOS=45000623;//kernel.T1Text:623
      _this.owner.height=_this.height;
      //$LASTPOS=45000649;//kernel.T1Text:649
      _this.drawn=true;
    },
    fiber$draw :function _trc_T1Text_f_draw(_thread,ctx) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var splitsText;
      var drawY;
      var textCount;
      var rect;
      
      //$LASTPOS=45000066;//kernel.T1Text:66
      ctx.font=_this.size+"px 'ＭＳ Ｐゴシック'";
      //$LASTPOS=45000102;//kernel.T1Text:102
      splitsText = (_this.text+"").split("\n");
      
      //$LASTPOS=45000145;//kernel.T1Text:145
      drawY = _this.y;
      
      //$LASTPOS=45000163;//kernel.T1Text:163
      if (! _this.size) {
        //$LASTPOS=45000174;//kernel.T1Text:174
        _this.size=15;
      }
      //$LASTPOS=45000188;//kernel.T1Text:188
      if (! _this.align) {
        //$LASTPOS=45000200;//kernel.T1Text:200
        _this.align="left";
      }
      //$LASTPOS=45000219;//kernel.T1Text:219
      if (! _this.fillStyle) {
        //$LASTPOS=45000235;//kernel.T1Text:235
        _this.fillStyle="white";
      }
      //$LASTPOS=45000259;//kernel.T1Text:259
      ctx.fillStyle=_this.col+"";
      //$LASTPOS=45000286;//kernel.T1Text:286
      ctx.globalAlpha=_this.alpha/255;
      //$LASTPOS=45000323;//kernel.T1Text:323
      _this.height=0;
      //$LASTPOS=45000332;//kernel.T1Text:332
      _this.width=0;
      //$LASTPOS=45000346;//kernel.T1Text:346
      //$LASTPOS=45000350;//kernel.T1Text:350
      textCount = 0;
      for (; textCount<splitsText.length ; textCount++) {
        {
          //$LASTPOS=45000417;//kernel.T1Text:417
          rect = _this.drawTextRect(ctx,splitsText[textCount],_this.x,drawY,_this.size,_this.align,"fill");
          
          //$LASTPOS=45000509;//kernel.T1Text:509
          if (_this.width<rect.w) {
            //$LASTPOS=45000526;//kernel.T1Text:526
            _this.width=rect.w;
          }
          //$LASTPOS=45000549;//kernel.T1Text:549
          _this.height+=rect.h;
          //$LASTPOS=45000574;//kernel.T1Text:574
          drawY+=_this.size;
        }
      }
      //$LASTPOS=45000599;//kernel.T1Text:599
      _this.owner.width=_this.width;
      //$LASTPOS=45000623;//kernel.T1Text:623
      _this.owner.height=_this.height;
      //$LASTPOS=45000649;//kernel.T1Text:649
      _this.drawn=true;
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":false}},"fields":{"size":{},"text":{},"y":{},"align":{},"fillStyle":{},"col":{},"height":{},"width":{},"x":{},"owner":{},"drawn":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Scheduler',
  shortName: 'Scheduler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: {
    main :function _trc_Scheduler_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=46000064;//kernel.Scheduler:64
      _this.cur=[];
      //$LASTPOS=46000073;//kernel.Scheduler:73
      _this.next=[];
    },
    fiber$main :function _trc_Scheduler_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=46000064;//kernel.Scheduler:64
      _this.cur=[];
      //$LASTPOS=46000073;//kernel.Scheduler:73
      _this.next=[];
      
      _thread.retVal=_this;return;
    },
    addObj :function _trc_Scheduler_addObj(obj,name,args) {
      "use strict";
      var _this=this;
      
      return _this.newThread(obj,name,args);
    },
    fiber$addObj :function _trc_Scheduler_f_addObj(_thread,obj,name,args) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Scheduler_ent_addObj(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$newThread(_thread, obj, name, args);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    newThread :function _trc_Scheduler_newThread(obj,name,args,options) {
      "use strict";
      var _this=this;
      var th;
      
      //$LASTPOS=46000228;//kernel.Scheduler:228
      name=name||"main";
      //$LASTPOS=46000252;//kernel.Scheduler:252
      args=args||[];
      //$LASTPOS=46000272;//kernel.Scheduler:272
      th = Tonyu.thread();
      
      //$LASTPOS=46000300;//kernel.Scheduler:300
      th.apply(obj,name,args);
      //$LASTPOS=46000330;//kernel.Scheduler:330
      th.name=(obj.getClassInfo?obj.getClassInfo().shortName:"Unknown")+"::"+name;
      //$LASTPOS=46000413;//kernel.Scheduler:413
      _this.addToCur(th);
      return th;
    },
    fiber$newThread :function _trc_Scheduler_f_newThread(_thread,obj,name,args,options) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var th;
      
      //$LASTPOS=46000228;//kernel.Scheduler:228
      name=name||"main";
      //$LASTPOS=46000252;//kernel.Scheduler:252
      args=args||[];
      //$LASTPOS=46000272;//kernel.Scheduler:272
      th = Tonyu.thread();
      
      //$LASTPOS=46000300;//kernel.Scheduler:300
      th.apply(obj,name,args);
      //$LASTPOS=46000330;//kernel.Scheduler:330
      th.name=(obj.getClassInfo?obj.getClassInfo().shortName:"Unknown")+"::"+name;
      
      _thread.enter(function _trc_Scheduler_ent_newThread(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=46000413;//kernel.Scheduler:413
            _this.fiber$addToCur(_thread, th);
            __pc=1;return;
          case 1:
            
            _thread.exit(th);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    addToCur :function _trc_Scheduler_addToCur(th) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=46000468;//kernel.Scheduler:468
      if (th.scheduled) {
        return _this;
      }
      //$LASTPOS=46000499;//kernel.Scheduler:499
      _this.cur.push(th);
      //$LASTPOS=46000518;//kernel.Scheduler:518
      th.scheduled=_this;
      //$LASTPOS=46000542;//kernel.Scheduler:542
      if (Tonyu.globals.$Boot.newLimit) {
        //$LASTPOS=46000573;//kernel.Scheduler:573
        Tonyu.globals.$Boot.newLimitCount--;
        //$LASTPOS=46000605;//kernel.Scheduler:605
        if (Tonyu.globals.$Boot.newLimitCount<=0) {
          throw new Error("一度にたくさんのスレッドを作りすぎています");
          
        }
        
      }
    },
    fiber$addToCur :function _trc_Scheduler_f_addToCur(_thread,th) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=46000468;//kernel.Scheduler:468
      if (th.scheduled) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=46000499;//kernel.Scheduler:499
      _this.cur.push(th);
      //$LASTPOS=46000518;//kernel.Scheduler:518
      th.scheduled=_this;
      //$LASTPOS=46000542;//kernel.Scheduler:542
      if (Tonyu.globals.$Boot.newLimit) {
        //$LASTPOS=46000573;//kernel.Scheduler:573
        Tonyu.globals.$Boot.newLimitCount--;
        //$LASTPOS=46000605;//kernel.Scheduler:605
        if (Tonyu.globals.$Boot.newLimitCount<=0) {
          throw new Error("一度にたくさんのスレッドを作りすぎています");
          
        }
        
      }
      
      _thread.retVal=_this;return;
    },
    addToNext :function _trc_Scheduler_addToNext(th) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=46000708;//kernel.Scheduler:708
      if (th.scheduled) {
        return _this;
      }
      //$LASTPOS=46000739;//kernel.Scheduler:739
      _this.next.push(th);
      //$LASTPOS=46000759;//kernel.Scheduler:759
      th.scheduled=_this;
    },
    fiber$addToNext :function _trc_Scheduler_f_addToNext(_thread,th) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=46000708;//kernel.Scheduler:708
      if (th.scheduled) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=46000739;//kernel.Scheduler:739
      _this.next.push(th);
      //$LASTPOS=46000759;//kernel.Scheduler:759
      th.scheduled=_this;
      
      _thread.retVal=_this;return;
    },
    unschedule :function _trc_Scheduler_unschedule(th) {
      "use strict";
      var _this=this;
      var i;
      
      //$LASTPOS=46000805;//kernel.Scheduler:805
      i = _this.cur.indexOf(th);
      
      //$LASTPOS=46000833;//kernel.Scheduler:833
      if (i>=0) {
        //$LASTPOS=46000854;//kernel.Scheduler:854
        _this.cur.splice(i,1);
        //$LASTPOS=46000880;//kernel.Scheduler:880
        delete th.scheduled;
        
      } else {
        //$LASTPOS=46000921;//kernel.Scheduler:921
        i=_this.next.indexOf(th);
        //$LASTPOS=46000947;//kernel.Scheduler:947
        if (i>=0) {
          //$LASTPOS=46000968;//kernel.Scheduler:968
          _this.next.splice(i,1);
          //$LASTPOS=46000998;//kernel.Scheduler:998
          delete th.scheduled;
          
        }
        
      }
    },
    fiber$unschedule :function _trc_Scheduler_f_unschedule(_thread,th) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var i;
      
      //$LASTPOS=46000805;//kernel.Scheduler:805
      i = _this.cur.indexOf(th);
      
      //$LASTPOS=46000833;//kernel.Scheduler:833
      if (i>=0) {
        //$LASTPOS=46000854;//kernel.Scheduler:854
        _this.cur.splice(i,1);
        //$LASTPOS=46000880;//kernel.Scheduler:880
        delete th.scheduled;
        
      } else {
        //$LASTPOS=46000921;//kernel.Scheduler:921
        i=_this.next.indexOf(th);
        //$LASTPOS=46000947;//kernel.Scheduler:947
        if (i>=0) {
          //$LASTPOS=46000968;//kernel.Scheduler:968
          _this.next.splice(i,1);
          //$LASTPOS=46000998;//kernel.Scheduler:998
          delete th.scheduled;
          
        }
        
      }
      
      _thread.retVal=_this;return;
    },
    checkTimeout :function _trc_Scheduler_checkTimeout() {
      "use strict";
      var _this=this;
      var now;
      
      //$LASTPOS=46001061;//kernel.Scheduler:1061
      now = new Date().getTime();
      
      //$LASTPOS=46001096;//kernel.Scheduler:1096
      if (now-_this.lastSteps>1000) {
        throw new Error("待機不能モードでupdateが呼ばれています．ブラウザが固まるのを防ぐために停止します．");
        
        
      }
    },
    fiber$checkTimeout :function _trc_Scheduler_f_checkTimeout(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var now;
      
      //$LASTPOS=46001061;//kernel.Scheduler:1061
      now = new Date().getTime();
      
      //$LASTPOS=46001096;//kernel.Scheduler:1096
      if (now-_this.lastSteps>1000) {
        throw new Error("待機不能モードでupdateが呼ばれています．ブラウザが固まるのを防ぐために停止します．");
        
        
      }
      
      _thread.retVal=_this;return;
    },
    stepsAll :function _trc_Scheduler_stepsAll() {
      "use strict";
      var _this=this;
      var t;
      var _it_344;
      
      //$LASTPOS=46001226;//kernel.Scheduler:1226
      _this.lastSteps=new Date().getTime();
      //$LASTPOS=46001263;//kernel.Scheduler:1263
      _it_344=Tonyu.iterator(_this.cur,1);
      while(_it_344.next()) {
        t=_it_344[0];
        
        //$LASTPOS=46001290;//kernel.Scheduler:1290
        delete t.scheduled;
        //$LASTPOS=46001316;//kernel.Scheduler:1316
        if (t.waitCount) {
          //$LASTPOS=46001345;//kernel.Scheduler:1345
          t.waitCount--;
          //$LASTPOS=46001373;//kernel.Scheduler:1373
          _this.addToNext(t);
          
        } else {
          //$LASTPOS=46001462;//kernel.Scheduler:1462
          t.steps();
          //$LASTPOS=46001536;//kernel.Scheduler:1536
          if (t.preempted) {
            //$LASTPOS=46001621;//kernel.Scheduler:1621
            _this.addToNext(t);
            
          }
          
        }
        
      }
      //$LASTPOS=46001673;//kernel.Scheduler:1673
      _this.cur=_this.next;
      //$LASTPOS=46001688;//kernel.Scheduler:1688
      _this.next=[];
    },
    fiber$stepsAll :function _trc_Scheduler_f_stepsAll(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var t;
      var _it_344;
      
      //$LASTPOS=46001226;//kernel.Scheduler:1226
      _this.lastSteps=new Date().getTime();
      
      _thread.enter(function _trc_Scheduler_ent_stepsAll(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=46001263;//kernel.Scheduler:1263
            _it_344=Tonyu.iterator(_this.cur,1);
          case 1:
            if (!(_it_344.next())) { __pc=7     ; break; }
            t=_it_344[0];
            
            //$LASTPOS=46001290;//kernel.Scheduler:1290
            delete t.scheduled;
            //$LASTPOS=46001316;//kernel.Scheduler:1316
            if (!(t.waitCount)) { __pc=3     ; break; }
            //$LASTPOS=46001345;//kernel.Scheduler:1345
            t.waitCount--;
            //$LASTPOS=46001373;//kernel.Scheduler:1373
            _this.fiber$addToNext(_thread, t);
            __pc=2;return;
          case 2:
            
            __pc=6     ;break;
          case 3     :
            //$LASTPOS=46001462;//kernel.Scheduler:1462
            t.steps();
            //$LASTPOS=46001536;//kernel.Scheduler:1536
            if (!(t.preempted)) { __pc=5     ; break; }
            //$LASTPOS=46001621;//kernel.Scheduler:1621
            _this.fiber$addToNext(_thread, t);
            __pc=4;return;
          case 4:
            
          case 5     :
            
          case 6     :
            
            __pc=1;break;
          case 7     :
            
            //$LASTPOS=46001673;//kernel.Scheduler:1673
            _this.cur=_this.next;
            //$LASTPOS=46001688;//kernel.Scheduler:1688
            _this.next=[];
            _thread.exit(_this);return;
          }
        }
      });
    },
    __getter__allThreads :function _trc_Scheduler___getter__allThreads() {
      "use strict";
      var _this=this;
      
      return _this.cur.concat(_this.next);
    },
    findByThreadGroup :function _trc_Scheduler_findByThreadGroup(o) {
      "use strict";
      var _this=this;
      
      return _this.allThreads.filter((function anonymous_1803(t) {
        
        return t._threadGroup===o;
      }));
    },
    fiber$findByThreadGroup :function _trc_Scheduler_f_findByThreadGroup(_thread,o) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.allThreads.filter((function anonymous_1803(t) {
        
        return t._threadGroup===o;
      }));return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"addObj":{"nowait":false},"newThread":{"nowait":false},"addToCur":{"nowait":false},"addToNext":{"nowait":false},"unschedule":{"nowait":false},"checkTimeout":{"nowait":false},"stepsAll":{"nowait":false},"__getter__allThreads":{"nowait":true},"findByThreadGroup":{"nowait":false}},"fields":{"cur":{},"next":{},"lastSteps":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.DialogMod',
  shortName: 'DialogMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_DialogMod_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_DialogMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    prompt :function _trc_DialogMod_prompt(mesg,val,geom) {
      "use strict";
      var _this=this;
      var r;
      
      
      //$LASTPOS=47000069;//kernel.DialogMod:69
      r=_this.waitFor(Tonyu.globals.$InputBox.prompt(mesg,val,geom));
      return r;
    },
    fiber$prompt :function _trc_DialogMod_f_prompt(_thread,mesg,val,geom) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      
      
      _thread.enter(function _trc_DialogMod_ent_prompt(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=47000069;//kernel.DialogMod:69
            _this.fiber$waitFor(_thread, Tonyu.globals.$InputBox.prompt(mesg,val,geom));
            __pc=1;return;
          case 1:
            r=_thread.retVal;
            
            _thread.exit(r);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    waitInput :function _trc_DialogMod_waitInput(title,mesg,val,geom) {
      "use strict";
      var _this=this;
      
      return _this.prompt({title: title,body: mesg},val,geom);
    },
    fiber$waitInput :function _trc_DialogMod_f_waitInput(_thread,title,mesg,val,geom) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_DialogMod_ent_waitInput(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$prompt(_thread, {title: title,body: mesg}, val, geom);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    promptNumber :function _trc_DialogMod_promptNumber(mesg,val) {
      "use strict";
      var _this=this;
      var r;
      
      
      //$LASTPOS=47000258;//kernel.DialogMod:258
      r=_this.prompt(mesg,val);
      return _this.parseFloat(r);
    },
    fiber$promptNumber :function _trc_DialogMod_f_promptNumber(_thread,mesg,val) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      
      
      _thread.enter(function _trc_DialogMod_ent_promptNumber(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=47000258;//kernel.DialogMod:258
            _this.fiber$prompt(_thread, mesg, val);
            __pc=1;return;
          case 1:
            r=_thread.retVal;
            
            _thread.exit(_this.parseFloat(r));return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    confirm :function _trc_DialogMod_confirm(mesg) {
      "use strict";
      var _this=this;
      var r;
      
      
      //$LASTPOS=47000340;//kernel.DialogMod:340
      r=_this.waitFor(Tonyu.globals.$InputBox.confirm(mesg));
      return r;
    },
    fiber$confirm :function _trc_DialogMod_f_confirm(_thread,mesg) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      
      
      _thread.enter(function _trc_DialogMod_ent_confirm(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=47000340;//kernel.DialogMod:340
            _this.fiber$waitFor(_thread, Tonyu.globals.$InputBox.confirm(mesg));
            __pc=1;return;
          case 1:
            r=_thread.retVal;
            
            _thread.exit(r);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    alert :function _trc_DialogMod_alert(mesg) {
      "use strict";
      var _this=this;
      var r;
      
      
      //$LASTPOS=47000421;//kernel.DialogMod:421
      r=_this.waitFor(Tonyu.globals.$InputBox.alert(mesg));
      return r;
    },
    fiber$alert :function _trc_DialogMod_f_alert(_thread,mesg) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      
      
      _thread.enter(function _trc_DialogMod_ent_alert(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=47000421;//kernel.DialogMod:421
            _this.fiber$waitFor(_thread, Tonyu.globals.$InputBox.alert(mesg));
            __pc=1;return;
          case 1:
            r=_thread.retVal;
            
            _thread.exit(r);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"prompt":{"nowait":false},"waitInput":{"nowait":false},"promptNumber":{"nowait":false},"confirm":{"nowait":false},"alert":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.Keys',
  shortName: 'Keys',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: {
    main :function _trc_Keys_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=48000106;//kernel.Keys:106
      _this.stats={};
      //$LASTPOS=48000117;//kernel.Keys:117
      _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,mouseleft: 1,mouseright: 2,mousewheel: 4};
      //$LASTPOS=48000273;//kernel.Keys:273
      //$LASTPOS=48000278;//kernel.Keys:278
      _this.i = 65;
      for (; _this.i<65+26 ; _this.i++) {
        {
          //$LASTPOS=48000310;//kernel.Keys:310
          _this.codes[String.fromCharCode(_this.i).toLowerCase()]=_this.i;
        }
      }
      //$LASTPOS=48000361;//kernel.Keys:361
      //$LASTPOS=48000366;//kernel.Keys:366
      _this.i = 48;
      for (; _this.i<58 ; _this.i++) {
        {
          //$LASTPOS=48000395;//kernel.Keys:395
          _this.codes[String.fromCharCode(_this.i)]=_this.i;
        }
      }
      //$LASTPOS=48000432;//kernel.Keys:432
      if (! $.data(document,"key_event")) {
        //$LASTPOS=48000474;//kernel.Keys:474
        _this.bmap = [1,4,2];
        
        //$LASTPOS=48000497;//kernel.Keys:497
        $.data(document,"key_event",true);
        //$LASTPOS=48000537;//kernel.Keys:537
        $(document).keydown((function anonymous_557(e) {
          
          //$LASTPOS=48000563;//kernel.Keys:563
          Tonyu.globals.$Keys.keydown(e);
        }));
        //$LASTPOS=48000588;//kernel.Keys:588
        $(document).keyup((function anonymous_606(e) {
          
          //$LASTPOS=48000612;//kernel.Keys:612
          Tonyu.globals.$Keys.keyup(e);
        }));
        //$LASTPOS=48000635;//kernel.Keys:635
        $(document).mousedown((function anonymous_657(e) {
          
          //$LASTPOS=48000673;//kernel.Keys:673
          _this.lastMouseDown=Tonyu.globals.$frameCount;
          //$LASTPOS=48000844;//kernel.Keys:844
          Tonyu.globals.$Keys.keydown({keyCode: _this.bmap[e.button]||1});
        }));
        //$LASTPOS=48000899;//kernel.Keys:899
        $(document).mouseup((function anonymous_919(e) {
          var a;
          
          //$LASTPOS=48000935;//kernel.Keys:935
          a = (function anonymous_941() {
            
            //$LASTPOS=48001108;//kernel.Keys:1108
            Tonyu.globals.$Keys.keyup({keyCode: _this.bmap[e.button]||1});
          });
          
          //$LASTPOS=48001169;//kernel.Keys:1169
          if (_this.lastMouseDown==Tonyu.globals.$frameCount&&! _this.reservedAction) {
            //$LASTPOS=48001235;//kernel.Keys:1235
            _this.reservedAction={at: Tonyu.globals.$frameCount+2,action: a};
            
          } else {
            //$LASTPOS=48001310;//kernel.Keys:1310
            a();
            
          }
        }));
        
      }
    },
    fiber$main :function _trc_Keys_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=48000106;//kernel.Keys:106
      _this.stats={};
      //$LASTPOS=48000117;//kernel.Keys:117
      _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,mouseleft: 1,mouseright: 2,mousewheel: 4};
      //$LASTPOS=48000273;//kernel.Keys:273
      //$LASTPOS=48000278;//kernel.Keys:278
      _this.i = 65;
      for (; _this.i<65+26 ; _this.i++) {
        {
          //$LASTPOS=48000310;//kernel.Keys:310
          _this.codes[String.fromCharCode(_this.i).toLowerCase()]=_this.i;
        }
      }
      //$LASTPOS=48000361;//kernel.Keys:361
      //$LASTPOS=48000366;//kernel.Keys:366
      _this.i = 48;
      for (; _this.i<58 ; _this.i++) {
        {
          //$LASTPOS=48000395;//kernel.Keys:395
          _this.codes[String.fromCharCode(_this.i)]=_this.i;
        }
      }
      //$LASTPOS=48000432;//kernel.Keys:432
      if (! $.data(document,"key_event")) {
        //$LASTPOS=48000474;//kernel.Keys:474
        _this.bmap = [1,4,2];
        
        //$LASTPOS=48000497;//kernel.Keys:497
        $.data(document,"key_event",true);
        //$LASTPOS=48000537;//kernel.Keys:537
        $(document).keydown((function anonymous_557(e) {
          
          //$LASTPOS=48000563;//kernel.Keys:563
          Tonyu.globals.$Keys.keydown(e);
        }));
        //$LASTPOS=48000588;//kernel.Keys:588
        $(document).keyup((function anonymous_606(e) {
          
          //$LASTPOS=48000612;//kernel.Keys:612
          Tonyu.globals.$Keys.keyup(e);
        }));
        //$LASTPOS=48000635;//kernel.Keys:635
        $(document).mousedown((function anonymous_657(e) {
          
          //$LASTPOS=48000673;//kernel.Keys:673
          _this.lastMouseDown=Tonyu.globals.$frameCount;
          //$LASTPOS=48000844;//kernel.Keys:844
          Tonyu.globals.$Keys.keydown({keyCode: _this.bmap[e.button]||1});
        }));
        //$LASTPOS=48000899;//kernel.Keys:899
        $(document).mouseup((function anonymous_919(e) {
          var a;
          
          //$LASTPOS=48000935;//kernel.Keys:935
          a = (function anonymous_941() {
            
            //$LASTPOS=48001108;//kernel.Keys:1108
            Tonyu.globals.$Keys.keyup({keyCode: _this.bmap[e.button]||1});
          });
          
          //$LASTPOS=48001169;//kernel.Keys:1169
          if (_this.lastMouseDown==Tonyu.globals.$frameCount&&! _this.reservedAction) {
            //$LASTPOS=48001235;//kernel.Keys:1235
            _this.reservedAction={at: Tonyu.globals.$frameCount+2,action: a};
            
          } else {
            //$LASTPOS=48001310;//kernel.Keys:1310
            a();
            
          }
        }));
        
      }
      
      _thread.retVal=_this;return;
    },
    getkey :function _trc_Keys_getkey(code) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=48001367;//kernel.Keys:1367
      if (typeof  code=="string") {
        //$LASTPOS=48001405;//kernel.Keys:1405
        code=_this.codes[code.toLowerCase()];
        
      }
      //$LASTPOS=48001449;//kernel.Keys:1449
      if (! code) {
        return 0;
      }
      //$LASTPOS=48001475;//kernel.Keys:1475
      if (_this.stats[code]==- 1) {
        return 0;
      }
      //$LASTPOS=48001511;//kernel.Keys:1511
      if (! _this.stats[code]) {
        //$LASTPOS=48001529;//kernel.Keys:1529
        _this.stats[code]=0;
      }
      return _this.stats[code];
    },
    fiber$getkey :function _trc_Keys_f_getkey(_thread,code) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=48001367;//kernel.Keys:1367
      if (typeof  code=="string") {
        //$LASTPOS=48001405;//kernel.Keys:1405
        code=_this.codes[code.toLowerCase()];
        
      }
      //$LASTPOS=48001449;//kernel.Keys:1449
      if (! code) {
        _thread.retVal=0;return;
        
      }
      //$LASTPOS=48001475;//kernel.Keys:1475
      if (_this.stats[code]==- 1) {
        _thread.retVal=0;return;
        
      }
      //$LASTPOS=48001511;//kernel.Keys:1511
      if (! _this.stats[code]) {
        //$LASTPOS=48001529;//kernel.Keys:1529
        _this.stats[code]=0;
      }
      _thread.retVal=_this.stats[code];return;
      
      
      _thread.retVal=_this;return;
    },
    update :function _trc_Keys_update() {
      "use strict";
      var _this=this;
      var i;
      var _it_357;
      
      //$LASTPOS=48001598;//kernel.Keys:1598
      _it_357=Tonyu.iterator(_this.stats,1);
      while(_it_357.next()) {
        i=_it_357[0];
        
        //$LASTPOS=48001630;//kernel.Keys:1630
        if (_this.stats[i]>0) {
          //$LASTPOS=48001647;//kernel.Keys:1647
          _this.stats[i]++;
          
        }
        //$LASTPOS=48001669;//kernel.Keys:1669
        if (_this.stats[i]==- 1) {
          //$LASTPOS=48001687;//kernel.Keys:1687
          _this.stats[i]=1;
        }
        
      }
      //$LASTPOS=48001711;//kernel.Keys:1711
      if (_this.reservedAction&&_this.reservedAction.at==Tonyu.globals.$frameCount) {
        //$LASTPOS=48001776;//kernel.Keys:1776
        _this.reservedAction.action();
        //$LASTPOS=48001810;//kernel.Keys:1810
        _this.reservedAction=null;
        
      }
    },
    fiber$update :function _trc_Keys_f_update(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var i;
      var _it_357;
      
      //$LASTPOS=48001598;//kernel.Keys:1598
      _it_357=Tonyu.iterator(_this.stats,1);
      while(_it_357.next()) {
        i=_it_357[0];
        
        //$LASTPOS=48001630;//kernel.Keys:1630
        if (_this.stats[i]>0) {
          //$LASTPOS=48001647;//kernel.Keys:1647
          _this.stats[i]++;
          
        }
        //$LASTPOS=48001669;//kernel.Keys:1669
        if (_this.stats[i]==- 1) {
          //$LASTPOS=48001687;//kernel.Keys:1687
          _this.stats[i]=1;
        }
        
      }
      //$LASTPOS=48001711;//kernel.Keys:1711
      if (_this.reservedAction&&_this.reservedAction.at==Tonyu.globals.$frameCount) {
        //$LASTPOS=48001776;//kernel.Keys:1776
        _this.reservedAction.action();
        //$LASTPOS=48001810;//kernel.Keys:1810
        _this.reservedAction=null;
        
      }
      
      _thread.retVal=_this;return;
    },
    keydown :function _trc_Keys_keydown(e) {
      "use strict";
      var _this=this;
      var s;
      
      //$LASTPOS=48001910;//kernel.Keys:1910
      if (Tonyu.globals.$t2MediaLib) {
        //$LASTPOS=48001927;//kernel.Keys:1927
        Tonyu.globals.$t2MediaLib.activate();
      }
      //$LASTPOS=48001956;//kernel.Keys:1956
      s = _this.stats[e.keyCode];
      
      //$LASTPOS=48001985;//kernel.Keys:1985
      if (! s) {
        //$LASTPOS=48002004;//kernel.Keys:2004
        _this.stats[e.keyCode]=1;
        
      }
      //$LASTPOS=48002036;//kernel.Keys:2036
      Tonyu.globals.$InputDevice.handleListeners();
    },
    fiber$keydown :function _trc_Keys_f_keydown(_thread,e) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var s;
      
      //$LASTPOS=48001910;//kernel.Keys:1910
      if (Tonyu.globals.$t2MediaLib) {
        //$LASTPOS=48001927;//kernel.Keys:1927
        Tonyu.globals.$t2MediaLib.activate();
      }
      //$LASTPOS=48001956;//kernel.Keys:1956
      s = _this.stats[e.keyCode];
      
      //$LASTPOS=48001985;//kernel.Keys:1985
      if (! s) {
        //$LASTPOS=48002004;//kernel.Keys:2004
        _this.stats[e.keyCode]=1;
        
      }
      //$LASTPOS=48002036;//kernel.Keys:2036
      Tonyu.globals.$InputDevice.handleListeners();
      
      _thread.retVal=_this;return;
    },
    keyup :function _trc_Keys_keyup(e) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=48002138;//kernel.Keys:2138
      if (Tonyu.globals.$t2MediaLib) {
        //$LASTPOS=48002155;//kernel.Keys:2155
        Tonyu.globals.$t2MediaLib.activate();
      }
      //$LASTPOS=48002184;//kernel.Keys:2184
      _this.stats[e.keyCode]=0;
      //$LASTPOS=48002209;//kernel.Keys:2209
      Tonyu.globals.$InputDevice.handleListeners();
    },
    fiber$keyup :function _trc_Keys_f_keyup(_thread,e) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=48002138;//kernel.Keys:2138
      if (Tonyu.globals.$t2MediaLib) {
        //$LASTPOS=48002155;//kernel.Keys:2155
        Tonyu.globals.$t2MediaLib.activate();
      }
      //$LASTPOS=48002184;//kernel.Keys:2184
      _this.stats[e.keyCode]=0;
      //$LASTPOS=48002209;//kernel.Keys:2209
      Tonyu.globals.$InputDevice.handleListeners();
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"getkey":{"nowait":false},"update":{"nowait":false},"keydown":{"nowait":false},"keyup":{"nowait":false}},"fields":{"i":{},"bmap":{},"stats":{},"codes":{},"lastMouseDown":{},"reservedAction":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TouchFinger',
  shortName: 'TouchFinger',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_TouchFinger_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_TouchFinger_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_TouchFinger_initialize(layer,screen) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=49000081;//kernel.TouchFinger:81
      _this.reset();
      //$LASTPOS=49000095;//kernel.TouchFinger:95
      _this._layer=layer;
      //$LASTPOS=49000114;//kernel.TouchFinger:114
      Tonyu.classes.kernel.TouchFinger.seq=Tonyu.classes.kernel.TouchFinger.seq||0;
      //$LASTPOS=49000155;//kernel.TouchFinger:155
      _this.oid=Tonyu.classes.kernel.TouchFinger.seq++;
      //$LASTPOS=49000183;//kernel.TouchFinger:183
      _this.screen=screen||Tonyu.globals.$Screen;
    },
    reset :function _trc_TouchFinger_reset() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=49000232;//kernel.TouchFinger:232
      _this.identifier=- 1;
      //$LASTPOS=49000252;//kernel.TouchFinger:252
      _this.px=_this.py=0;
      //$LASTPOS=49000266;//kernel.TouchFinger:266
      _this.x=_this.y=_this.vx=_this.vy=_this.touched=0;
      //$LASTPOS=49000292;//kernel.TouchFinger:292
      _this.ended=false;
    },
    fiber$reset :function _trc_TouchFinger_f_reset(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=49000232;//kernel.TouchFinger:232
      _this.identifier=- 1;
      //$LASTPOS=49000252;//kernel.TouchFinger:252
      _this.px=_this.py=0;
      //$LASTPOS=49000266;//kernel.TouchFinger:266
      _this.x=_this.y=_this.vx=_this.vy=_this.touched=0;
      //$LASTPOS=49000292;//kernel.TouchFinger:292
      _this.ended=false;
      
      _thread.retVal=_this;return;
    },
    __getter__layer :function _trc_TouchFinger___getter__layer() {
      "use strict";
      var _this=this;
      
      return _this._layer;
    },
    __setter__layer :function _trc_TouchFinger___setter__layer(toLayer) {
      "use strict";
      var _this=this;
      var p;
      
      //$LASTPOS=49000364;//kernel.TouchFinger:364
      if (_this._layer===toLayer) {
        return _this;
      }
      //$LASTPOS=49000399;//kernel.TouchFinger:399
      p = _this.screen.convert(_this,toLayer);
      
      //$LASTPOS=49000440;//kernel.TouchFinger:440
      _this.x=p.x;
      //$LASTPOS=49000452;//kernel.TouchFinger:452
      _this.y=p.y;
      //$LASTPOS=49000464;//kernel.TouchFinger:464
      _this.px=_this.x;
      //$LASTPOS=49000475;//kernel.TouchFinger:475
      _this.py=_this.y;
      //$LASTPOS=49000486;//kernel.TouchFinger:486
      _this._layer=p.layer;
      //$LASTPOS=49000507;//kernel.TouchFinger:507
      _this.vx=_this.vy=0;
    },
    update :function _trc_TouchFinger_update() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=49000862;//kernel.TouchFinger:862
      if (_this.touched>0) {
        //$LASTPOS=49000878;//kernel.TouchFinger:878
        _this.touched++;
        
      } else {
        //$LASTPOS=49000900;//kernel.TouchFinger:900
        if (_this.touched==- 1) {
          //$LASTPOS=49000917;//kernel.TouchFinger:917
          _this.touched=1;
        } else {
          
          
        }
      }
      //$LASTPOS=49000992;//kernel.TouchFinger:992
      if (_this.touched>0) {
        //$LASTPOS=49001057;//kernel.TouchFinger:1057
        if (typeof  _this.px=="number") {
          //$LASTPOS=49001097;//kernel.TouchFinger:1097
          _this.vx=_this.x-_this.px||0;
          //$LASTPOS=49001124;//kernel.TouchFinger:1124
          _this.vy=_this.y-_this.py||0;
          
        }
        //$LASTPOS=49001158;//kernel.TouchFinger:1158
        _this.px=_this.x;
        //$LASTPOS=49001173;//kernel.TouchFinger:1173
        _this.py=_this.y;
        
      }
    },
    fiber$update :function _trc_TouchFinger_f_update(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=49000862;//kernel.TouchFinger:862
      if (_this.touched>0) {
        //$LASTPOS=49000878;//kernel.TouchFinger:878
        _this.touched++;
        
      } else {
        //$LASTPOS=49000900;//kernel.TouchFinger:900
        if (_this.touched==- 1) {
          //$LASTPOS=49000917;//kernel.TouchFinger:917
          _this.touched=1;
        } else {
          
          
        }
      }
      //$LASTPOS=49000992;//kernel.TouchFinger:992
      if (_this.touched>0) {
        //$LASTPOS=49001057;//kernel.TouchFinger:1057
        if (typeof  _this.px=="number") {
          //$LASTPOS=49001097;//kernel.TouchFinger:1097
          _this.vx=_this.x-_this.px||0;
          //$LASTPOS=49001124;//kernel.TouchFinger:1124
          _this.vy=_this.y-_this.py||0;
          
        }
        //$LASTPOS=49001158;//kernel.TouchFinger:1158
        _this.px=_this.x;
        //$LASTPOS=49001173;//kernel.TouchFinger:1173
        _this.py=_this.y;
        
      }
      
      _thread.retVal=_this;return;
    },
    show :function _trc_TouchFinger_show() {
      "use strict";
      var _this=this;
      
      return "["+_this.oid+":"+_this.floor(_this.x*100)/100+","+_this.floor(_this.px*100)/100+"]";
    },
    fiber$show :function _trc_TouchFinger_f_show(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal="["+_this.oid+":"+_this.floor(_this.x*100)/100+","+_this.floor(_this.px*100)/100+"]";return;
      
      
      _thread.retVal=_this;return;
    },
    doStart :function _trc_TouchFinger_doStart(id,point) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=49001334;//kernel.TouchFinger:1334
      _this.identifier=id;
      //$LASTPOS=49001354;//kernel.TouchFinger:1354
      _this.px=_this.x=point.x;
      //$LASTPOS=49001373;//kernel.TouchFinger:1373
      _this.py=_this.y=point.y;
      //$LASTPOS=49001392;//kernel.TouchFinger:1392
      _this._layer=point.layer;
      //$LASTPOS=49001417;//kernel.TouchFinger:1417
      _this.vx=_this.vy=0;
      //$LASTPOS=49001431;//kernel.TouchFinger:1431
      _this.touched=1;
      //$LASTPOS=49001447;//kernel.TouchFinger:1447
      _this.ended=false;
      //$LASTPOS=49001465;//kernel.TouchFinger:1465
      if (_this.bound) {
        //$LASTPOS=49001487;//kernel.TouchFinger:1487
        _this.bound.doStart(id,point);
        
      }
    },
    fiber$doStart :function _trc_TouchFinger_f_doStart(_thread,id,point) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=49001334;//kernel.TouchFinger:1334
      _this.identifier=id;
      //$LASTPOS=49001354;//kernel.TouchFinger:1354
      _this.px=_this.x=point.x;
      //$LASTPOS=49001373;//kernel.TouchFinger:1373
      _this.py=_this.y=point.y;
      //$LASTPOS=49001392;//kernel.TouchFinger:1392
      _this._layer=point.layer;
      //$LASTPOS=49001417;//kernel.TouchFinger:1417
      _this.vx=_this.vy=0;
      //$LASTPOS=49001431;//kernel.TouchFinger:1431
      _this.touched=1;
      //$LASTPOS=49001447;//kernel.TouchFinger:1447
      _this.ended=false;
      //$LASTPOS=49001465;//kernel.TouchFinger:1465
      if (_this.bound) {
        //$LASTPOS=49001487;//kernel.TouchFinger:1487
        _this.bound.doStart(id,point);
        
      }
      
      _thread.retVal=_this;return;
    },
    doMove :function _trc_TouchFinger_doMove(point) {
      "use strict";
      var _this=this;
      var p;
      
      //$LASTPOS=49001545;//kernel.TouchFinger:1545
      p = _this.screen.convert(point,_this.layer);
      
      //$LASTPOS=49001585;//kernel.TouchFinger:1585
      _this.x=p.x;
      //$LASTPOS=49001597;//kernel.TouchFinger:1597
      _this.y=p.y;
      //$LASTPOS=49001609;//kernel.TouchFinger:1609
      if (_this.bound) {
        //$LASTPOS=49001631;//kernel.TouchFinger:1631
        _this.bound.doMove(p);
        
      }
    },
    fiber$doMove :function _trc_TouchFinger_f_doMove(_thread,point) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var p;
      
      //$LASTPOS=49001545;//kernel.TouchFinger:1545
      p = _this.screen.convert(point,_this.layer);
      
      //$LASTPOS=49001585;//kernel.TouchFinger:1585
      _this.x=p.x;
      //$LASTPOS=49001597;//kernel.TouchFinger:1597
      _this.y=p.y;
      //$LASTPOS=49001609;//kernel.TouchFinger:1609
      if (_this.bound) {
        //$LASTPOS=49001631;//kernel.TouchFinger:1631
        _this.bound.doMove(p);
        
      }
      
      _thread.retVal=_this;return;
    },
    doEnd :function _trc_TouchFinger_doEnd() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=49001674;//kernel.TouchFinger:1674
      _this.vx=_this.vy=_this.touched=0;
      //$LASTPOS=49001696;//kernel.TouchFinger:1696
      _this.ended=true;
      //$LASTPOS=49001713;//kernel.TouchFinger:1713
      if (_this.bound) {
        //$LASTPOS=49001735;//kernel.TouchFinger:1735
        _this.bound.doEnd();
        //$LASTPOS=49001759;//kernel.TouchFinger:1759
        delete _this.bound;
        
      }
    },
    fiber$doEnd :function _trc_TouchFinger_f_doEnd(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=49001674;//kernel.TouchFinger:1674
      _this.vx=_this.vy=_this.touched=0;
      //$LASTPOS=49001696;//kernel.TouchFinger:1696
      _this.ended=true;
      //$LASTPOS=49001713;//kernel.TouchFinger:1713
      if (_this.bound) {
        //$LASTPOS=49001735;//kernel.TouchFinger:1735
        _this.bound.doEnd();
        //$LASTPOS=49001759;//kernel.TouchFinger:1759
        delete _this.bound;
        
      }
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"reset":{"nowait":false},"__getter__layer":{"nowait":true},"__setter__layer":{"nowait":true},"update":{"nowait":false},"show":{"nowait":false},"doStart":{"nowait":false},"doMove":{"nowait":false},"doEnd":{"nowait":false}},"fields":{"_layer":{},"oid":{},"identifier":{},"px":{},"py":{},"vx":{},"vy":{},"touched":{},"ended":{},"screen":{},"bound":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TouchFingers',
  shortName: 'TouchFingers',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: {
    main :function _trc_TouchFingers_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_TouchFingers_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_TouchFingers_initialize(dev) {
      "use strict";
      var _this=this;
      var i;
      
      //$LASTPOS=50000067;//kernel.TouchFingers:67
      _this.inputDevice=dev;
      //$LASTPOS=50000089;//kernel.TouchFingers:89
      _this.fingerSet={};
      //$LASTPOS=50000108;//kernel.TouchFingers:108
      _this.fingerArray=[];
      //$LASTPOS=50000129;//kernel.TouchFingers:129
      _this.fingerArray.findById=(function anonymous_150(id) {
        
        return _this.fingerSet[id];
      });
      //$LASTPOS=50000202;//kernel.TouchFingers:202
      _this.fingerArray.findWithin=(function anonymous_225(o,d) {
        var j;
        var t;
        var _it_367;
        
        //$LASTPOS=50000251;//kernel.TouchFingers:251
        _it_367=Tonyu.iterator(_this.fingerSet,2);
        while(_it_367.next()) {
          j=_it_367[0];
          t=_it_367[1];
          
          //$LASTPOS=50000293;//kernel.TouchFingers:293
          if (o.within(t,d)) {
            return t;
            
          }
          
        }
      });
      //$LASTPOS=50000380;//kernel.TouchFingers:380
      _this.fingerArray.findTouch=(function anonymous_402(f) {
        var j;
        var t;
        var _it_372;
        
        //$LASTPOS=50000426;//kernel.TouchFingers:426
        _it_372=Tonyu.iterator(_this.fingerSet,2);
        while(_it_372.next()) {
          j=_it_372[0];
          t=_it_372[1];
          
          //$LASTPOS=50000468;//kernel.TouchFingers:468
          if (f(t)) {
            return t;
            
          }
          
        }
      });
      //$LASTPOS=50000546;//kernel.TouchFingers:546
      //$LASTPOS=50000551;//kernel.TouchFingers:551
      i = 0;
      for (; i<5 ; i++) {
        //$LASTPOS=50000568;//kernel.TouchFingers:568
        _this.fingerArray.push(new Tonyu.classes.kernel.TouchFinger(_this.inputDevice.defaultLayer,Tonyu.globals.$Screen));
      }
    },
    handleStart :function _trc_TouchFingers_handleStart(e) {
      "use strict";
      var _this=this;
      var p;
      var ts;
      var dst;
      var i;
      var src;
      var j;
      var mp;
      
      //$LASTPOS=50000666;//kernel.TouchFingers:666
      Tonyu.resetLoopCheck();
      //$LASTPOS=50000695;//kernel.TouchFingers:695
      Tonyu.globals.$t2MediaLib.activate();
      //$LASTPOS=50000724;//kernel.TouchFingers:724
      p = _this.inputDevice.rootCanvas.offset();
      
      //$LASTPOS=50000768;//kernel.TouchFingers:768
      e.preventDefault();
      //$LASTPOS=50000793;//kernel.TouchFingers:793
      ts = e.originalEvent.changedTouches;
      
      
      //$LASTPOS=50000851;//kernel.TouchFingers:851
      //$LASTPOS=50000856;//kernel.TouchFingers:856
      i = 0;
      for (; i<ts.length ; i++) {
        {
          //$LASTPOS=50000897;//kernel.TouchFingers:897
          src = ts[i];
          
          //$LASTPOS=50000921;//kernel.TouchFingers:921
          dst=new Tonyu.classes.kernel.TouchFinger(_this.inputDevice.defaultLayer,Tonyu.globals.$Screen);
          //$LASTPOS=50000986;//kernel.TouchFingers:986
          _this.fingerSet[src.identifier]=dst;
          //$LASTPOS=50001028;//kernel.TouchFingers:1028
          //$LASTPOS=50001033;//kernel.TouchFingers:1033
          j = 0;
          for (; j<_this.fingerArray.length ; j++) {
            {
              //$LASTPOS=50001086;//kernel.TouchFingers:1086
              if (! _this.fingerArray[j].touched) {
                //$LASTPOS=50001134;//kernel.TouchFingers:1134
                dst.bound=_this.fingerArray[j];
                break;
                
                
              }
            }
          }
          //$LASTPOS=50001219;//kernel.TouchFingers:1219
          mp = {x: src.pageX-p.left,y: src.pageY-p.top,layer: Tonyu.globals.$Screen.layer};
          
          //$LASTPOS=50001296;//kernel.TouchFingers:1296
          mp=Tonyu.globals.$Screen.convert(mp,_this.inputDevice.defaultLayer);
          //$LASTPOS=50001354;//kernel.TouchFingers:1354
          dst.doStart(src.identifier,mp);
        }
      }
      //$LASTPOS=50001398;//kernel.TouchFingers:1398
      Tonyu.globals.$mouseX=_this.fingerArray[0].x;
      //$LASTPOS=50001429;//kernel.TouchFingers:1429
      Tonyu.globals.$mouseY=_this.fingerArray[0].y;
      //$LASTPOS=50001460;//kernel.TouchFingers:1460
      _this.inputDevice.handleListeners();
    },
    fiber$handleStart :function _trc_TouchFingers_f_handleStart(_thread,e) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var p;
      var ts;
      var dst;
      var i;
      var src;
      var j;
      var mp;
      
      //$LASTPOS=50000666;//kernel.TouchFingers:666
      Tonyu.resetLoopCheck();
      //$LASTPOS=50000695;//kernel.TouchFingers:695
      Tonyu.globals.$t2MediaLib.activate();
      //$LASTPOS=50000724;//kernel.TouchFingers:724
      p = _this.inputDevice.rootCanvas.offset();
      
      //$LASTPOS=50000768;//kernel.TouchFingers:768
      e.preventDefault();
      //$LASTPOS=50000793;//kernel.TouchFingers:793
      ts = e.originalEvent.changedTouches;
      
      
      //$LASTPOS=50000851;//kernel.TouchFingers:851
      //$LASTPOS=50000856;//kernel.TouchFingers:856
      i = 0;
      for (; i<ts.length ; i++) {
        {
          //$LASTPOS=50000897;//kernel.TouchFingers:897
          src = ts[i];
          
          //$LASTPOS=50000921;//kernel.TouchFingers:921
          dst=new Tonyu.classes.kernel.TouchFinger(_this.inputDevice.defaultLayer,Tonyu.globals.$Screen);
          //$LASTPOS=50000986;//kernel.TouchFingers:986
          _this.fingerSet[src.identifier]=dst;
          //$LASTPOS=50001028;//kernel.TouchFingers:1028
          //$LASTPOS=50001033;//kernel.TouchFingers:1033
          j = 0;
          for (; j<_this.fingerArray.length ; j++) {
            {
              //$LASTPOS=50001086;//kernel.TouchFingers:1086
              if (! _this.fingerArray[j].touched) {
                //$LASTPOS=50001134;//kernel.TouchFingers:1134
                dst.bound=_this.fingerArray[j];
                break;
                
                
              }
            }
          }
          //$LASTPOS=50001219;//kernel.TouchFingers:1219
          mp = {x: src.pageX-p.left,y: src.pageY-p.top,layer: Tonyu.globals.$Screen.layer};
          
          //$LASTPOS=50001296;//kernel.TouchFingers:1296
          mp=Tonyu.globals.$Screen.convert(mp,_this.inputDevice.defaultLayer);
          //$LASTPOS=50001354;//kernel.TouchFingers:1354
          dst.doStart(src.identifier,mp);
        }
      }
      //$LASTPOS=50001398;//kernel.TouchFingers:1398
      Tonyu.globals.$mouseX=_this.fingerArray[0].x;
      //$LASTPOS=50001429;//kernel.TouchFingers:1429
      Tonyu.globals.$mouseY=_this.fingerArray[0].y;
      //$LASTPOS=50001460;//kernel.TouchFingers:1460
      _this.inputDevice.handleListeners();
      
      _thread.retVal=_this;return;
    },
    handleMove :function _trc_TouchFingers_handleMove(e) {
      "use strict";
      var _this=this;
      var p;
      var ts;
      var dst;
      var i;
      var src;
      
      //$LASTPOS=50001517;//kernel.TouchFingers:1517
      Tonyu.resetLoopCheck();
      //$LASTPOS=50001546;//kernel.TouchFingers:1546
      Tonyu.globals.$t2MediaLib.activate();
      //$LASTPOS=50001575;//kernel.TouchFingers:1575
      p = _this.inputDevice.rootCanvas.offset();
      
      //$LASTPOS=50001619;//kernel.TouchFingers:1619
      e.preventDefault();
      //$LASTPOS=50001644;//kernel.TouchFingers:1644
      ts = e.originalEvent.changedTouches;
      
      
      //$LASTPOS=50001702;//kernel.TouchFingers:1702
      //$LASTPOS=50001707;//kernel.TouchFingers:1707
      i = 0;
      for (; i<ts.length ; i++) {
        {
          //$LASTPOS=50001748;//kernel.TouchFingers:1748
          src = ts[i];
          
          //$LASTPOS=50001772;//kernel.TouchFingers:1772
          dst = _this.fingerSet[src.identifier];
          
          //$LASTPOS=50001816;//kernel.TouchFingers:1816
          if (dst) {
            //$LASTPOS=50001840;//kernel.TouchFingers:1840
            _this.mp={x: src.pageX-p.left,y: src.pageY-p.top,layer: Tonyu.globals.$Screen.layer};
            //$LASTPOS=50001992;//kernel.TouchFingers:1992
            dst.doMove(_this.mp);
            
          }
        }
      }
      //$LASTPOS=50002088;//kernel.TouchFingers:2088
      Tonyu.globals.$mouseX=_this.fingerArray[0].x;
      //$LASTPOS=50002119;//kernel.TouchFingers:2119
      Tonyu.globals.$mouseY=_this.fingerArray[0].y;
      //$LASTPOS=50002150;//kernel.TouchFingers:2150
      _this.inputDevice.handleListeners();
    },
    fiber$handleMove :function _trc_TouchFingers_f_handleMove(_thread,e) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var p;
      var ts;
      var dst;
      var i;
      var src;
      
      //$LASTPOS=50001517;//kernel.TouchFingers:1517
      Tonyu.resetLoopCheck();
      //$LASTPOS=50001546;//kernel.TouchFingers:1546
      Tonyu.globals.$t2MediaLib.activate();
      //$LASTPOS=50001575;//kernel.TouchFingers:1575
      p = _this.inputDevice.rootCanvas.offset();
      
      //$LASTPOS=50001619;//kernel.TouchFingers:1619
      e.preventDefault();
      //$LASTPOS=50001644;//kernel.TouchFingers:1644
      ts = e.originalEvent.changedTouches;
      
      
      //$LASTPOS=50001702;//kernel.TouchFingers:1702
      //$LASTPOS=50001707;//kernel.TouchFingers:1707
      i = 0;
      for (; i<ts.length ; i++) {
        {
          //$LASTPOS=50001748;//kernel.TouchFingers:1748
          src = ts[i];
          
          //$LASTPOS=50001772;//kernel.TouchFingers:1772
          dst = _this.fingerSet[src.identifier];
          
          //$LASTPOS=50001816;//kernel.TouchFingers:1816
          if (dst) {
            //$LASTPOS=50001840;//kernel.TouchFingers:1840
            _this.mp={x: src.pageX-p.left,y: src.pageY-p.top,layer: Tonyu.globals.$Screen.layer};
            //$LASTPOS=50001992;//kernel.TouchFingers:1992
            dst.doMove(_this.mp);
            
          }
        }
      }
      //$LASTPOS=50002088;//kernel.TouchFingers:2088
      Tonyu.globals.$mouseX=_this.fingerArray[0].x;
      //$LASTPOS=50002119;//kernel.TouchFingers:2119
      Tonyu.globals.$mouseY=_this.fingerArray[0].y;
      //$LASTPOS=50002150;//kernel.TouchFingers:2150
      _this.inputDevice.handleListeners();
      
      _thread.retVal=_this;return;
    },
    handleEnd :function _trc_TouchFingers_handleEnd(e) {
      "use strict";
      var _this=this;
      var ts;
      var i;
      var src;
      var dst;
      
      //$LASTPOS=50002206;//kernel.TouchFingers:2206
      Tonyu.resetLoopCheck();
      //$LASTPOS=50002235;//kernel.TouchFingers:2235
      Tonyu.globals.$t2MediaLib.activate();
      //$LASTPOS=50002264;//kernel.TouchFingers:2264
      ts = e.originalEvent.changedTouches;
      
      //$LASTPOS=50002308;//kernel.TouchFingers:2308
      //$LASTPOS=50002313;//kernel.TouchFingers:2313
      i = 0;
      for (; i<ts.length ; i++) {
        {
          //$LASTPOS=50002354;//kernel.TouchFingers:2354
          src = ts[i];
          
          //$LASTPOS=50002378;//kernel.TouchFingers:2378
          dst = _this.fingerSet[src.identifier];
          
          //$LASTPOS=50002422;//kernel.TouchFingers:2422
          if (dst) {
            //$LASTPOS=50002446;//kernel.TouchFingers:2446
            delete _this.fingerSet[src.identifier];
            //$LASTPOS=50002493;//kernel.TouchFingers:2493
            dst.doEnd();
            
          }
        }
      }
      //$LASTPOS=50002529;//kernel.TouchFingers:2529
      _this.inputDevice.handleListeners();
    },
    fiber$handleEnd :function _trc_TouchFingers_f_handleEnd(_thread,e) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ts;
      var i;
      var src;
      var dst;
      
      //$LASTPOS=50002206;//kernel.TouchFingers:2206
      Tonyu.resetLoopCheck();
      //$LASTPOS=50002235;//kernel.TouchFingers:2235
      Tonyu.globals.$t2MediaLib.activate();
      //$LASTPOS=50002264;//kernel.TouchFingers:2264
      ts = e.originalEvent.changedTouches;
      
      //$LASTPOS=50002308;//kernel.TouchFingers:2308
      //$LASTPOS=50002313;//kernel.TouchFingers:2313
      i = 0;
      for (; i<ts.length ; i++) {
        {
          //$LASTPOS=50002354;//kernel.TouchFingers:2354
          src = ts[i];
          
          //$LASTPOS=50002378;//kernel.TouchFingers:2378
          dst = _this.fingerSet[src.identifier];
          
          //$LASTPOS=50002422;//kernel.TouchFingers:2422
          if (dst) {
            //$LASTPOS=50002446;//kernel.TouchFingers:2446
            delete _this.fingerSet[src.identifier];
            //$LASTPOS=50002493;//kernel.TouchFingers:2493
            dst.doEnd();
            
          }
        }
      }
      //$LASTPOS=50002529;//kernel.TouchFingers:2529
      _this.inputDevice.handleListeners();
      
      _thread.retVal=_this;return;
    },
    unsetEmu :function _trc_TouchFingers_unsetEmu(ID_MOUSE) {
      "use strict";
      var _this=this;
      var t;
      var _it_392;
      var i;
      var _it_393;
      
      //$LASTPOS=50002591;//kernel.TouchFingers:2591
      _it_392=Tonyu.iterator(_this.fingerArray,1);
      while(_it_392.next()) {
        t=_it_392[0];
        
        //$LASTPOS=50002629;//kernel.TouchFingers:2629
        if (t.identifier==ID_MOUSE) {
          //$LASTPOS=50002672;//kernel.TouchFingers:2672
          t.reset();
          
        }
        
      }
      //$LASTPOS=50002706;//kernel.TouchFingers:2706
      _it_393=Tonyu.iterator(_this.fingerSet,2);
      while(_it_393.next()) {
        i=_it_393[0];
        t=_it_393[1];
        
        //$LASTPOS=50002744;//kernel.TouchFingers:2744
        if (t.identifier==ID_MOUSE) {
          //$LASTPOS=50002787;//kernel.TouchFingers:2787
          t.reset();
          
        }
        
      }
    },
    fiber$unsetEmu :function _trc_TouchFingers_f_unsetEmu(_thread,ID_MOUSE) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var t;
      var _it_392;
      var i;
      var _it_393;
      
      //$LASTPOS=50002591;//kernel.TouchFingers:2591
      _it_392=Tonyu.iterator(_this.fingerArray,1);
      while(_it_392.next()) {
        t=_it_392[0];
        
        //$LASTPOS=50002629;//kernel.TouchFingers:2629
        if (t.identifier==ID_MOUSE) {
          //$LASTPOS=50002672;//kernel.TouchFingers:2672
          t.reset();
          
        }
        
      }
      //$LASTPOS=50002706;//kernel.TouchFingers:2706
      _it_393=Tonyu.iterator(_this.fingerSet,2);
      while(_it_393.next()) {
        i=_it_393[0];
        t=_it_393[1];
        
        //$LASTPOS=50002744;//kernel.TouchFingers:2744
        if (t.identifier==ID_MOUSE) {
          //$LASTPOS=50002787;//kernel.TouchFingers:2787
          t.reset();
          
        }
        
      }
      
      _thread.retVal=_this;return;
    },
    updateFingers :function _trc_TouchFingers_updateFingers() {
      "use strict";
      var _this=this;
      var t;
      var _it_398;
      var i;
      var _it_399;
      
      //$LASTPOS=50002844;//kernel.TouchFingers:2844
      _it_398=Tonyu.iterator(_this.fingerArray,1);
      while(_it_398.next()) {
        t=_it_398[0];
        
        //$LASTPOS=50002882;//kernel.TouchFingers:2882
        t.update();
        
      }
      //$LASTPOS=50002906;//kernel.TouchFingers:2906
      _it_399=Tonyu.iterator(_this.fingerSet,2);
      while(_it_399.next()) {
        i=_it_399[0];
        t=_it_399[1];
        
        //$LASTPOS=50002944;//kernel.TouchFingers:2944
        t.update();
        
      }
    },
    fiber$updateFingers :function _trc_TouchFingers_f_updateFingers(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var t;
      var _it_398;
      var i;
      var _it_399;
      
      //$LASTPOS=50002844;//kernel.TouchFingers:2844
      _it_398=Tonyu.iterator(_this.fingerArray,1);
      while(_it_398.next()) {
        t=_it_398[0];
        
        //$LASTPOS=50002882;//kernel.TouchFingers:2882
        t.update();
        
      }
      //$LASTPOS=50002906;//kernel.TouchFingers:2906
      _it_399=Tonyu.iterator(_this.fingerSet,2);
      while(_it_399.next()) {
        i=_it_399[0];
        t=_it_399[1];
        
        //$LASTPOS=50002944;//kernel.TouchFingers:2944
        t.update();
        
      }
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"handleStart":{"nowait":false},"handleMove":{"nowait":false},"handleEnd":{"nowait":false},"unsetEmu":{"nowait":false},"updateFingers":{"nowait":false}},"fields":{"inputDevice":{},"fingerSet":{},"fingerArray":{},"mp":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.LifeCycleMod',
  shortName: 'LifeCycleMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.EventHandlerCaller,Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.ThreadGroupMod],
  methods: {
    main :function _trc_LifeCycleMod_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=51000077;//kernel.LifeCycleMod:77
      "field strict";
      
    },
    fiber$main :function _trc_LifeCycleMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=51000077;//kernel.LifeCycleMod:77
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    hide :function _trc_LifeCycleMod_hide() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=51000263;//kernel.LifeCycleMod:263
      _this.layer.remove(_this);
    },
    show :function _trc_LifeCycleMod_show(x,y,p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=51000314;//kernel.LifeCycleMod:314
      _this.layer.add(_this);
      //$LASTPOS=51000336;//kernel.LifeCycleMod:336
      if (x!=null) {
        //$LASTPOS=51000349;//kernel.LifeCycleMod:349
        _this.x=x;
      }
      //$LASTPOS=51000364;//kernel.LifeCycleMod:364
      if (y!=null) {
        //$LASTPOS=51000377;//kernel.LifeCycleMod:377
        _this.y=y;
      }
      //$LASTPOS=51000392;//kernel.LifeCycleMod:392
      if (p!=null) {
        //$LASTPOS=51000405;//kernel.LifeCycleMod:405
        _this.p=p;
      }
    },
    die :function _trc_LifeCycleMod_die() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=51000442;//kernel.LifeCycleMod:442
      _this.killThreadGroup();
      //$LASTPOS=51000466;//kernel.LifeCycleMod:466
      _this.hide();
      //$LASTPOS=51000479;//kernel.LifeCycleMod:479
      if (! _this._isDead) {
        //$LASTPOS=51000504;//kernel.LifeCycleMod:504
        _this.fireEvent("die");
        //$LASTPOS=51000531;//kernel.LifeCycleMod:531
        _this._isDead=true;
        //$LASTPOS=51000554;//kernel.LifeCycleMod:554
        if (_this._poolArray) {
          //$LASTPOS=51000585;//kernel.LifeCycleMod:585
          _this._poolArray.push(_this);
          //$LASTPOS=51000621;//kernel.LifeCycleMod:621
          _this.objectPoolAge=(_this.objectPoolAge||0)+1;
          
        }
        
      }
    },
    __setter__lifeKeeper :function _trc_LifeCycleMod___setter__lifeKeeper(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=51000702;//kernel.LifeCycleMod:702
      _this._lifeKeeper=v;
      //$LASTPOS=51000722;//kernel.LifeCycleMod:722
      if (v&&typeof  v.on==="function") {
        //$LASTPOS=51000768;//kernel.LifeCycleMod:768
        v.on("die",Tonyu.bindFunc(_this,_this.die));
        
      }
    },
    __getter__lifeKeeper :function _trc_LifeCycleMod___getter__lifeKeeper() {
      "use strict";
      var _this=this;
      
      return _this._lifeKeeper;
    },
    isDead :function _trc_LifeCycleMod_isDead() {
      "use strict";
      var _this=this;
      
      return _this._isDead;
    },
    __setter__useObjectPool :function _trc_LifeCycleMod___setter__useObjectPool(value) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=51000917;//kernel.LifeCycleMod:917
      if (value) {
        //$LASTPOS=51000939;//kernel.LifeCycleMod:939
        _this._poolArray=Tonyu.globals.$ObjectPool.poolList(_this.getClassInfo().fullName);
        
      }
    },
    appear :function _trc_LifeCycleMod_appear(o,param) {
      "use strict";
      var _this=this;
      var p;
      var k;
      var _it_404;
      
      //$LASTPOS=51001037;//kernel.LifeCycleMod:1037
      if (typeof  o=="function") {
        //$LASTPOS=51001074;//kernel.LifeCycleMod:1074
        if (param) {
          //$LASTPOS=51001087;//kernel.LifeCycleMod:1087
          param.layer=param.layer||_this.layer;
          
        }
        //$LASTPOS=51001130;//kernel.LifeCycleMod:1130
        p = Tonyu.globals.$ObjectPool.withdraw(o.meta.fullName);
        
        //$LASTPOS=51001184;//kernel.LifeCycleMod:1184
        if (p) {
          //$LASTPOS=51001203;//kernel.LifeCycleMod:1203
          _it_404=Tonyu.iterator(Object.keys(p),1);
          while(_it_404.next()) {
            k=_it_404[0];
            
            //$LASTPOS=51001248;//kernel.LifeCycleMod:1248
            if (k!="objectPoolAge") {
              //$LASTPOS=51001272;//kernel.LifeCycleMod:1272
              delete p[k];
            }
            
          }
          //$LASTPOS=51001301;//kernel.LifeCycleMod:1301
          o.call(p,param);
          return p;
          
        } else {
          return new o(param);
          
        }
        
      } else {
        return o;
        
      }
    },
    fiber$appear :function _trc_LifeCycleMod_f_appear(_thread,o,param) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var p;
      var k;
      var _it_404;
      
      //$LASTPOS=51001037;//kernel.LifeCycleMod:1037
      if (typeof  o=="function") {
        //$LASTPOS=51001074;//kernel.LifeCycleMod:1074
        if (param) {
          //$LASTPOS=51001087;//kernel.LifeCycleMod:1087
          param.layer=param.layer||_this.layer;
          
        }
        //$LASTPOS=51001130;//kernel.LifeCycleMod:1130
        p = Tonyu.globals.$ObjectPool.withdraw(o.meta.fullName);
        
        //$LASTPOS=51001184;//kernel.LifeCycleMod:1184
        if (p) {
          //$LASTPOS=51001203;//kernel.LifeCycleMod:1203
          _it_404=Tonyu.iterator(Object.keys(p),1);
          while(_it_404.next()) {
            k=_it_404[0];
            
            //$LASTPOS=51001248;//kernel.LifeCycleMod:1248
            if (k!="objectPoolAge") {
              //$LASTPOS=51001272;//kernel.LifeCycleMod:1272
              delete p[k];
            }
            
          }
          //$LASTPOS=51001301;//kernel.LifeCycleMod:1301
          o.call(p,param);
          _thread.retVal=p;return;
          
          
        } else {
          _thread.retVal=new o(param);return;
          
          
        }
        
      } else {
        _thread.retVal=o;return;
        
        
      }
      
      _thread.retVal=_this;return;
    },
    addToLayer :function _trc_LifeCycleMod_addToLayer() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=51001459;//kernel.LifeCycleMod:1459
      if (_this.layer&&typeof  _this.layer.addSubactor==="function") {
        //$LASTPOS=51001520;//kernel.LifeCycleMod:1520
        _this.layer.addSubactor(_this);
        
      } else {
        //$LASTPOS=51001557;//kernel.LifeCycleMod:1557
        if (_this.layer instanceof Tonyu.classes.kernel.SpriteGroup) {
          //$LASTPOS=51001592;//kernel.LifeCycleMod:1592
          _this.layer.add(_this);
          
        } else {
          //$LASTPOS=51001632;//kernel.LifeCycleMod:1632
          Tonyu.globals.$Sprites.add(_this);
          
        }
      }
      //$LASTPOS=51001664;//kernel.LifeCycleMod:1664
      _this.onAppear();
    },
    fiber$addToLayer :function _trc_LifeCycleMod_f_addToLayer(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=51001459;//kernel.LifeCycleMod:1459
      if (_this.layer&&typeof  _this.layer.addSubactor==="function") {
        //$LASTPOS=51001520;//kernel.LifeCycleMod:1520
        _this.layer.addSubactor(_this);
        
      } else {
        //$LASTPOS=51001557;//kernel.LifeCycleMod:1557
        if (_this.layer instanceof Tonyu.classes.kernel.SpriteGroup) {
          //$LASTPOS=51001592;//kernel.LifeCycleMod:1592
          _this.layer.add(_this);
          
        } else {
          //$LASTPOS=51001632;//kernel.LifeCycleMod:1632
          Tonyu.globals.$Sprites.add(_this);
          
        }
      }
      
      _thread.enter(function _trc_LifeCycleMod_ent_addToLayer(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=51001664;//kernel.LifeCycleMod:1664
            _this.fiber$onAppear(_thread);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    changeLayer :function _trc_LifeCycleMod_changeLayer(l) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=51001703;//kernel.LifeCycleMod:1703
      if (typeof  l.add!=="function") {
        return _this;
      }
      //$LASTPOS=51001747;//kernel.LifeCycleMod:1747
      if (_this.layer) {
        //$LASTPOS=51001758;//kernel.LifeCycleMod:1758
        _this.layer.remove(_this);
      }
      //$LASTPOS=51001783;//kernel.LifeCycleMod:1783
      l.add(_this);
      //$LASTPOS=51001801;//kernel.LifeCycleMod:1801
      _this.layer=l;
    },
    fiber$changeLayer :function _trc_LifeCycleMod_f_changeLayer(_thread,l) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=51001703;//kernel.LifeCycleMod:1703
      if (typeof  l.add!=="function") {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=51001747;//kernel.LifeCycleMod:1747
      if (_this.layer) {
        //$LASTPOS=51001758;//kernel.LifeCycleMod:1758
        _this.layer.remove(_this);
      }
      //$LASTPOS=51001783;//kernel.LifeCycleMod:1783
      l.add(_this);
      //$LASTPOS=51001801;//kernel.LifeCycleMod:1801
      _this.layer=l;
      
      _thread.retVal=_this;return;
    },
    onAppear :function _trc_LifeCycleMod_onAppear() {
      "use strict";
      var _this=this;
      
    },
    fiber$onAppear :function _trc_LifeCycleMod_f_onAppear(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"hide":{"nowait":true},"show":{"nowait":true},"die":{"nowait":true},"__setter__lifeKeeper":{"nowait":true},"__getter__lifeKeeper":{"nowait":true},"isDead":{"nowait":true},"__setter__useObjectPool":{"nowait":true},"appear":{"nowait":false},"addToLayer":{"nowait":false},"changeLayer":{"nowait":false},"onAppear":{"nowait":false}},"fields":{"layer":{},"_isDead":{},"_poolArray":{},"objectPoolAge":{},"_lifeKeeper":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Matrix',
  shortName: 'Matrix',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.FileMod],
  methods: {
    main :function _trc_Matrix_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_Matrix_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Matrix_initialize(d) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=52000071;//kernel.Matrix:71
      _this.data={}||d;
    },
    load :function _trc_Matrix_load(csvFile) {
      "use strict";
      var _this=this;
      var f;
      var x;
      var y;
      var SEP;
      var lines;
      var l;
      var _it_408;
      var _it_409;
      
      //$LASTPOS=52000109;//kernel.Matrix:109
      f = _this.file(csvFile);
      
      //$LASTPOS=52000135;//kernel.Matrix:135
      x = 0;
      y = 0;
      
      //$LASTPOS=52000153;//kernel.Matrix:153
      SEP = ",";
      
      //$LASTPOS=52000171;//kernel.Matrix:171
      lines = f.lines();
      
      //$LASTPOS=52000218;//kernel.Matrix:218
      _it_408=Tonyu.iterator(lines,1);
      while(_it_408.next()) {
        l=_it_408[0];
        
        //$LASTPOS=52000250;//kernel.Matrix:250
        _this.row=l.split(SEP);
        //$LASTPOS=52000277;//kernel.Matrix:277
        x=0;
        //$LASTPOS=52000291;//kernel.Matrix:291
        _it_409=Tonyu.iterator(_this.row,1);
        while(_it_409.next()) {
          _this.cell=_it_409[0];
          
          //$LASTPOS=52000324;//kernel.Matrix:324
          _this.set(x,y,_this.cell);
          //$LASTPOS=52000352;//kernel.Matrix:352
          x++;
          
        }
        //$LASTPOS=52000377;//kernel.Matrix:377
        y++;
        
      }
    },
    fiber$load :function _trc_Matrix_f_load(_thread,csvFile) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var f;
      var x;
      var y;
      var SEP;
      var lines;
      var l;
      var _it_408;
      var _it_409;
      
      
      _thread.enter(function _trc_Matrix_ent_load(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=52000109;//kernel.Matrix:109
            _this.fiber$file(_thread, csvFile);
            __pc=1;return;
          case 1:
            f=_thread.retVal;
            
            //$LASTPOS=52000135;//kernel.Matrix:135
            x = 0;
            y = 0;
            
            //$LASTPOS=52000153;//kernel.Matrix:153
            SEP = ",";
            
            //$LASTPOS=52000171;//kernel.Matrix:171
            lines = f.lines();
            
            //$LASTPOS=52000218;//kernel.Matrix:218
            _it_408=Tonyu.iterator(lines,1);
          case 2:
            if (!(_it_408.next())) { __pc=6     ; break; }
            l=_it_408[0];
            
            //$LASTPOS=52000250;//kernel.Matrix:250
            _this.row=l.split(SEP);
            //$LASTPOS=52000277;//kernel.Matrix:277
            x=0;
            //$LASTPOS=52000291;//kernel.Matrix:291
            _it_409=Tonyu.iterator(_this.row,1);
          case 3:
            if (!(_it_409.next())) { __pc=5     ; break; }
            _this.cell=_it_409[0];
            
            //$LASTPOS=52000324;//kernel.Matrix:324
            _this.fiber$set(_thread, x, y, _this.cell);
            __pc=4;return;
          case 4:
            
            //$LASTPOS=52000352;//kernel.Matrix:352
            x++;
            __pc=3;break;
          case 5     :
            
            //$LASTPOS=52000377;//kernel.Matrix:377
            y++;
            __pc=2;break;
          case 6     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    cross :function _trc_Matrix_cross(col,row) {
      "use strict";
      var _this=this;
      var colr;
      var rowr;
      
      //$LASTPOS=52000416;//kernel.Matrix:416
      colr = _this.find(col);
      
      //$LASTPOS=52000441;//kernel.Matrix:441
      rowr = _this.find(row);
      
      return _this.get(colr.x,rowr.y);
    },
    fiber$cross :function _trc_Matrix_f_cross(_thread,col,row) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var colr;
      var rowr;
      
      
      _thread.enter(function _trc_Matrix_ent_cross(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=52000416;//kernel.Matrix:416
            _this.fiber$find(_thread, col);
            __pc=1;return;
          case 1:
            colr=_thread.retVal;
            
            //$LASTPOS=52000441;//kernel.Matrix:441
            _this.fiber$find(_thread, row);
            __pc=2;return;
          case 2:
            rowr=_thread.retVal;
            
            _this.fiber$get(_thread, colr.x, rowr.y);
            __pc=3;return;
          case 3:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    search :function _trc_Matrix_search(cell,options) {
      "use strict";
      var _this=this;
      var k;
      var v;
      var _it_420;
      
      //$LASTPOS=52000526;//kernel.Matrix:526
      _it_420=Tonyu.iterator(_this.data,2);
      while(_it_420.next()) {
        k=_it_420[0];
        v=_it_420[1];
        
        //$LASTPOS=52000559;//kernel.Matrix:559
        if (v===cell) {
          return _this.unkey(k);
          
        }
        
      }
    },
    fiber$search :function _trc_Matrix_f_search(_thread,cell,options) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var k;
      var v;
      var _it_420;
      
      
      _thread.enter(function _trc_Matrix_ent_search(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=52000526;//kernel.Matrix:526
            _it_420=Tonyu.iterator(_this.data,2);
          case 1:
            if (!(_it_420.next())) { __pc=4     ; break; }
            k=_it_420[0];
            v=_it_420[1];
            
            //$LASTPOS=52000559;//kernel.Matrix:559
            if (!(v===cell)) { __pc=3     ; break; }
            _this.fiber$unkey(_thread, k);
            __pc=2;return;
          case 2:
            _thread.exit(_thread.retVal);return;
            
          case 3     :
            
            __pc=1;break;
          case 4     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    find :function _trc_Matrix_find() {
      "use strict";
      var _this=this;
      var r;
      
      //$LASTPOS=52000642;//kernel.Matrix:642
      r = Tonyu.bindFunc(_this,_this.search).apply(_this,arguments);
      
      //$LASTPOS=52000683;//kernel.Matrix:683
      if (r==null) {
        throw new Error(arguments[0]+" not found.");
        
        
      }
      return r;
    },
    fiber$find :function _trc_Matrix_f_find(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      //$LASTPOS=52000642;//kernel.Matrix:642
      r = Tonyu.bindFunc(_this,_this.search).apply(_this,_arguments);
      
      //$LASTPOS=52000683;//kernel.Matrix:683
      if (r==null) {
        throw new Error(_arguments[0]+" not found.");
        
        
      }
      _thread.retVal=r;return;
      
      
      _thread.retVal=_this;return;
    },
    crop :function _trc_Matrix_crop() {
      "use strict";
      var _this=this;
      var a;
      var o;
      var r;
      var y;
      var x;
      
      //$LASTPOS=52000793;//kernel.Matrix:793
      a = new Tonyu.classes.kernel.ArgParser(arguments);
      
      //$LASTPOS=52000830;//kernel.Matrix:830
      o = a.parseOptions("left,top,right,bottom,width,height,keepXY");
      
      //$LASTPOS=52000902;//kernel.Matrix:902
      r = new Tonyu.classes.kernel.Matrix;
      
      //$LASTPOS=52000925;//kernel.Matrix:925
      if (o.width) {
        //$LASTPOS=52000938;//kernel.Matrix:938
        o.right=o.left+o.width-1;
      }
      //$LASTPOS=52000969;//kernel.Matrix:969
      if (o.height) {
        //$LASTPOS=52000983;//kernel.Matrix:983
        o.bottom=o.top+o.height-1;
      }
      //$LASTPOS=52001015;//kernel.Matrix:1015
      if (o.right==null) {
        //$LASTPOS=52001034;//kernel.Matrix:1034
        o.right=_this.xmax;
      }
      //$LASTPOS=52001053;//kernel.Matrix:1053
      if (o.bottom==null) {
        //$LASTPOS=52001073;//kernel.Matrix:1073
        o.bottom=_this.ymax;
      }
      //$LASTPOS=52001093;//kernel.Matrix:1093
      //$LASTPOS=52001097;//kernel.Matrix:1097
      y = o.top;
      for (; y<=o.bottom ; y++) {
        {
          //$LASTPOS=52001137;//kernel.Matrix:1137
          //$LASTPOS=52001141;//kernel.Matrix:1141
          x = o.left;
          for (; x<=o.right ; x++) {
            {
              //$LASTPOS=52001184;//kernel.Matrix:1184
              if (o.keepXY) {
                //$LASTPOS=52001217;//kernel.Matrix:1217
                r.set(x,y,_this.get(x,y));
                
              } else {
                //$LASTPOS=52001277;//kernel.Matrix:1277
                r.set(x-o.left,y-o.top,_this.get(x,y));
                
              }
            }
          }
        }
      }
      return r;
    },
    fiber$crop :function _trc_Matrix_f_crop(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      var o;
      var r;
      var y;
      var x;
      
      //$LASTPOS=52000793;//kernel.Matrix:793
      a = new Tonyu.classes.kernel.ArgParser(_arguments);
      
      //$LASTPOS=52000830;//kernel.Matrix:830
      o = a.parseOptions("left,top,right,bottom,width,height,keepXY");
      
      //$LASTPOS=52000902;//kernel.Matrix:902
      r = new Tonyu.classes.kernel.Matrix;
      
      //$LASTPOS=52000925;//kernel.Matrix:925
      if (o.width) {
        //$LASTPOS=52000938;//kernel.Matrix:938
        o.right=o.left+o.width-1;
      }
      //$LASTPOS=52000969;//kernel.Matrix:969
      if (o.height) {
        //$LASTPOS=52000983;//kernel.Matrix:983
        o.bottom=o.top+o.height-1;
      }
      //$LASTPOS=52001015;//kernel.Matrix:1015
      if (o.right==null) {
        //$LASTPOS=52001034;//kernel.Matrix:1034
        o.right=_this.xmax;
      }
      //$LASTPOS=52001053;//kernel.Matrix:1053
      if (o.bottom==null) {
        //$LASTPOS=52001073;//kernel.Matrix:1073
        o.bottom=_this.ymax;
      }
      //$LASTPOS=52001093;//kernel.Matrix:1093
      //$LASTPOS=52001097;//kernel.Matrix:1097
      y = o.top;
      for (; y<=o.bottom ; y++) {
        {
          //$LASTPOS=52001137;//kernel.Matrix:1137
          //$LASTPOS=52001141;//kernel.Matrix:1141
          x = o.left;
          for (; x<=o.right ; x++) {
            {
              //$LASTPOS=52001184;//kernel.Matrix:1184
              if (o.keepXY) {
                //$LASTPOS=52001217;//kernel.Matrix:1217
                r.set(x,y,_this.get(x,y));
                
              } else {
                //$LASTPOS=52001277;//kernel.Matrix:1277
                r.set(x-o.left,y-o.top,_this.get(x,y));
                
              }
            }
          }
        }
      }
      _thread.retVal=r;return;
      
      
      _thread.retVal=_this;return;
    },
    rev :function _trc_Matrix_rev(line) {
      "use strict";
      var _this=this;
      var res;
      var e;
      var _it_430;
      
      //$LASTPOS=52001565;//kernel.Matrix:1565
      res = [];
      
      //$LASTPOS=52001582;//kernel.Matrix:1582
      _it_430=Tonyu.iterator(line,1);
      while(_it_430.next()) {
        e=_it_430[0];
        
        //$LASTPOS=52001613;//kernel.Matrix:1613
        res.unshift(e);
        
      }
      return res;
    },
    fiber$rev :function _trc_Matrix_f_rev(_thread,line) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var e;
      var _it_430;
      
      //$LASTPOS=52001565;//kernel.Matrix:1565
      res = [];
      
      //$LASTPOS=52001582;//kernel.Matrix:1582
      _it_430=Tonyu.iterator(line,1);
      while(_it_430.next()) {
        e=_it_430[0];
        
        //$LASTPOS=52001613;//kernel.Matrix:1613
        res.unshift(e);
        
      }
      _thread.retVal=res;return;
      
      
      _thread.retVal=_this;return;
    },
    keysIterator :function _trc_Matrix_keysIterator() {
      "use strict";
      var _this=this;
      
      return {tonyuIterator: Tonyu.bindFunc(_this,_this.tonyuIteratorKeys)};
    },
    fiber$keysIterator :function _trc_Matrix_f_keysIterator(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal={tonyuIterator: Tonyu.bindFunc(_this,_this.tonyuIteratorKeys)};return;
      
      
      _thread.retVal=_this;return;
    },
    rectIterator :function _trc_Matrix_rectIterator() {
      "use strict";
      var _this=this;
      
      return {tonyuIterator: Tonyu.bindFunc(_this,_this.tonyuIteratorRect)};
    },
    fiber$rectIterator :function _trc_Matrix_f_rectIterator(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal={tonyuIterator: Tonyu.bindFunc(_this,_this.tonyuIteratorRect)};return;
      
      
      _thread.retVal=_this;return;
    },
    tonyuIteratorKeys :function _trc_Matrix_tonyuIteratorKeys(arity) {
      "use strict";
      var _this=this;
      var res;
      var k;
      var v;
      var _it_434;
      
      //$LASTPOS=52001860;//kernel.Matrix:1860
      res = {i: 0,keys: []};
      
      //$LASTPOS=52001888;//kernel.Matrix:1888
      _it_434=Tonyu.iterator(_this.data,2);
      while(_it_434.next()) {
        k=_it_434[0];
        v=_it_434[1];
        
        //$LASTPOS=52001921;//kernel.Matrix:1921
        res.keys.push(k);
        
      }
      switch (arity) {
      case 3:
        //$LASTPOS=52001993;//kernel.Matrix:1993
        res.next=(function anonymous_2002() {
          var key;
          var xy;
          
          //$LASTPOS=52002018;//kernel.Matrix:2018
          if (res.i>=res.keys.length) {
            return false;
          }
          //$LASTPOS=52002073;//kernel.Matrix:2073
          key = res.keys[res.i];
          
          //$LASTPOS=52002111;//kernel.Matrix:2111
          res.i++;
          //$LASTPOS=52002133;//kernel.Matrix:2133
          xy = _this.unkey(key);
          
          //$LASTPOS=52002165;//kernel.Matrix:2165
          res[0]=xy.x;
          //$LASTPOS=52002191;//kernel.Matrix:2191
          res[1]=xy.y;
          //$LASTPOS=52002217;//kernel.Matrix:2217
          res[2]=_this.data[key];
          return true;
        });
        break;
        
      default:
        throw new Error("Matrix: in の前には3つの変数が必要です");
        
      }
      return res;
    },
    fiber$tonyuIteratorKeys :function _trc_Matrix_f_tonyuIteratorKeys(_thread,arity) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var k;
      var v;
      var _it_434;
      
      //$LASTPOS=52001860;//kernel.Matrix:1860
      res = {i: 0,keys: []};
      
      //$LASTPOS=52001888;//kernel.Matrix:1888
      _it_434=Tonyu.iterator(_this.data,2);
      while(_it_434.next()) {
        k=_it_434[0];
        v=_it_434[1];
        
        //$LASTPOS=52001921;//kernel.Matrix:1921
        res.keys.push(k);
        
      }
      
      _thread.enter(function _trc_Matrix_ent_tonyuIteratorKeys(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            switch (arity) {
            case 3:
              __pc=1     ;break;
            default:
              __pc=2     ;break;
              
            }
            break;
          case 1     :
            //$LASTPOS=52001993;//kernel.Matrix:1993
            res.next=(function anonymous_2002() {
              var key;
              var xy;
              
              //$LASTPOS=52002018;//kernel.Matrix:2018
              if (res.i>=res.keys.length) {
                return false;
              }
              //$LASTPOS=52002073;//kernel.Matrix:2073
              key = res.keys[res.i];
              
              //$LASTPOS=52002111;//kernel.Matrix:2111
              res.i++;
              //$LASTPOS=52002133;//kernel.Matrix:2133
              xy = _this.unkey(key);
              
              //$LASTPOS=52002165;//kernel.Matrix:2165
              res[0]=xy.x;
              //$LASTPOS=52002191;//kernel.Matrix:2191
              res[1]=xy.y;
              //$LASTPOS=52002217;//kernel.Matrix:2217
              res[2]=_this.data[key];
              return true;
            });
            __pc=3     ; break;
            
          case 2     :
            throw new Error("Matrix: in の前には3つの変数が必要です");
            
            case 3     :
            
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    tonyuIterator :function _trc_Matrix_tonyuIterator(arity) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=52002419;//kernel.Matrix:2419
      if (_this.iterateMode==="keys") {
        return _this.tonyuIteratorKeys(arity);
      }
      return _this.tonyuIteratorRect(arity);
    },
    fiber$tonyuIterator :function _trc_Matrix_f_tonyuIterator(_thread,arity) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Matrix_ent_tonyuIterator(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=52002419;//kernel.Matrix:2419
            if (!(_this.iterateMode==="keys")) { __pc=2     ; break; }
            _this.fiber$tonyuIteratorKeys(_thread, arity);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
          case 2     :
            
            _this.fiber$tonyuIteratorRect(_thread, arity);
            __pc=3;return;
          case 3:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    tonyuIteratorRect :function _trc_Matrix_tonyuIteratorRect(arity) {
      "use strict";
      var _this=this;
      var res;
      
      //$LASTPOS=52002553;//kernel.Matrix:2553
      res = {x: _this.xmin,y: _this.ymin,cnt: 0};
      
      //$LASTPOS=52002589;//kernel.Matrix:2589
      if (_this.xmin==null||_this.ymin==null||_this.xmax==null||_this.ymax==null) {
        //$LASTPOS=52002652;//kernel.Matrix:2652
        res.next=(function anonymous_2661() {
          
          return false;
        });
        return res;
        
      }
      switch (arity) {
      case 3:
        //$LASTPOS=52002754;//kernel.Matrix:2754
        res.next=(function anonymous_2763() {
          
          //$LASTPOS=52002890;//kernel.Matrix:2890
          if (res.x>_this.xmax) {
            //$LASTPOS=52002925;//kernel.Matrix:2925
            res.x=_this.xmin;
            //$LASTPOS=52002954;//kernel.Matrix:2954
            res.y++;
            
          }
          //$LASTPOS=52002991;//kernel.Matrix:2991
          if (res.y>_this.ymax) {
            return false;
          }
          //$LASTPOS=52003034;//kernel.Matrix:3034
          res[0]=res.x;
          //$LASTPOS=52003061;//kernel.Matrix:3061
          res[1]=res.y;
          //$LASTPOS=52003088;//kernel.Matrix:3088
          res[2]=_this.get(res.x,res.y);
          //$LASTPOS=52003126;//kernel.Matrix:3126
          res.x++;
          return true;
        });
        break;
        
      default:
        throw new Error("Matrix: in の前には3つの変数が必要です");
        
      }
      return res;
    },
    fiber$tonyuIteratorRect :function _trc_Matrix_f_tonyuIteratorRect(_thread,arity) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      
      //$LASTPOS=52002553;//kernel.Matrix:2553
      res = {x: _this.xmin,y: _this.ymin,cnt: 0};
      
      //$LASTPOS=52002589;//kernel.Matrix:2589
      if (_this.xmin==null||_this.ymin==null||_this.xmax==null||_this.ymax==null) {
        //$LASTPOS=52002652;//kernel.Matrix:2652
        res.next=(function anonymous_2661() {
          
          return false;
        });
        _thread.retVal=res;return;
        
        
      }
      
      _thread.enter(function _trc_Matrix_ent_tonyuIteratorRect(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            switch (arity) {
            case 3:
              __pc=1     ;break;
            default:
              __pc=2     ;break;
              
            }
            break;
          case 1     :
            //$LASTPOS=52002754;//kernel.Matrix:2754
            res.next=(function anonymous_2763() {
              
              //$LASTPOS=52002890;//kernel.Matrix:2890
              if (res.x>_this.xmax) {
                //$LASTPOS=52002925;//kernel.Matrix:2925
                res.x=_this.xmin;
                //$LASTPOS=52002954;//kernel.Matrix:2954
                res.y++;
                
              }
              //$LASTPOS=52002991;//kernel.Matrix:2991
              if (res.y>_this.ymax) {
                return false;
              }
              //$LASTPOS=52003034;//kernel.Matrix:3034
              res[0]=res.x;
              //$LASTPOS=52003061;//kernel.Matrix:3061
              res[1]=res.y;
              //$LASTPOS=52003088;//kernel.Matrix:3088
              res[2]=_this.get(res.x,res.y);
              //$LASTPOS=52003126;//kernel.Matrix:3126
              res.x++;
              return true;
            });
            __pc=3     ; break;
            
          case 2     :
            throw new Error("Matrix: in の前には3つの変数が必要です");
            
            case 3     :
            
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    unkey :function _trc_Matrix_unkey(key) {
      "use strict";
      var _this=this;
      var r;
      
      //$LASTPOS=52003309;//kernel.Matrix:3309
      r = key.split(",");
      
      return {x: r[0]-0,y: r[1]-0};
    },
    fiber$unkey :function _trc_Matrix_f_unkey(_thread,key) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      //$LASTPOS=52003309;//kernel.Matrix:3309
      r = key.split(",");
      
      _thread.retVal={x: r[0]-0,y: r[1]-0};return;
      
      
      _thread.retVal=_this;return;
    },
    key :function _trc_Matrix_key(x,y,updateRange) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=52003397;//kernel.Matrix:3397
      x=_this.floor(x);
      //$LASTPOS=52003414;//kernel.Matrix:3414
      y=_this.floor(y);
      //$LASTPOS=52003431;//kernel.Matrix:3431
      if (updateRange) {
        //$LASTPOS=52003459;//kernel.Matrix:3459
        if (_this.xmin==null||x<_this.xmin) {
          //$LASTPOS=52003485;//kernel.Matrix:3485
          _this.xmin=x;
        }
        //$LASTPOS=52003502;//kernel.Matrix:3502
        if (_this.xmax==null||x>_this.xmax) {
          //$LASTPOS=52003528;//kernel.Matrix:3528
          _this.xmax=x;
        }
        //$LASTPOS=52003545;//kernel.Matrix:3545
        if (_this.ymin==null||y<_this.ymin) {
          //$LASTPOS=52003571;//kernel.Matrix:3571
          _this.ymin=y;
        }
        //$LASTPOS=52003588;//kernel.Matrix:3588
        if (_this.ymax==null||y>_this.ymax) {
          //$LASTPOS=52003614;//kernel.Matrix:3614
          _this.ymax=y;
        }
        
      }
      return x+","+y;
    },
    fiber$key :function _trc_Matrix_f_key(_thread,x,y,updateRange) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=52003397;//kernel.Matrix:3397
      x=_this.floor(x);
      //$LASTPOS=52003414;//kernel.Matrix:3414
      y=_this.floor(y);
      //$LASTPOS=52003431;//kernel.Matrix:3431
      if (updateRange) {
        //$LASTPOS=52003459;//kernel.Matrix:3459
        if (_this.xmin==null||x<_this.xmin) {
          //$LASTPOS=52003485;//kernel.Matrix:3485
          _this.xmin=x;
        }
        //$LASTPOS=52003502;//kernel.Matrix:3502
        if (_this.xmax==null||x>_this.xmax) {
          //$LASTPOS=52003528;//kernel.Matrix:3528
          _this.xmax=x;
        }
        //$LASTPOS=52003545;//kernel.Matrix:3545
        if (_this.ymin==null||y<_this.ymin) {
          //$LASTPOS=52003571;//kernel.Matrix:3571
          _this.ymin=y;
        }
        //$LASTPOS=52003588;//kernel.Matrix:3588
        if (_this.ymax==null||y>_this.ymax) {
          //$LASTPOS=52003614;//kernel.Matrix:3614
          _this.ymax=y;
        }
        
      }
      _thread.retVal=x+","+y;return;
      
      
      _thread.retVal=_this;return;
    },
    __getter__rows :function _trc_Matrix___getter__rows() {
      "use strict";
      var _this=this;
      
      return _this.xmax-_this.xmin+1;
    },
    __getter__cols :function _trc_Matrix___getter__cols() {
      "use strict";
      var _this=this;
      
      return _this.ymax-_this.ymin+1;
    },
    get :function _trc_Matrix_get(x,y) {
      "use strict";
      var _this=this;
      var res;
      var e;
      
      //$LASTPOS=52003745;//kernel.Matrix:3745
      res = _this.data[_this.key(x,y)];
      
      //$LASTPOS=52003774;//kernel.Matrix:3774
      if (res===undefined) {
        //$LASTPOS=52003806;//kernel.Matrix:3806
        e = {set: (function anonymous_3832(v) {
          
          //$LASTPOS=52003855;//kernel.Matrix:3855
          e.value=v;
          //$LASTPOS=52003883;//kernel.Matrix:3883
          _this.set(x,y,v);
        }),x: x,y: y};
        
        //$LASTPOS=52003936;//kernel.Matrix:3936
        _this.sendEvent("newCell",e);
        return e.value;
        
      }
      return res;
    },
    fiber$get :function _trc_Matrix_f_get(_thread,x,y) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var e;
      
      //$LASTPOS=52003745;//kernel.Matrix:3745
      res = _this.data[_this.key(x,y)];
      
      
      _thread.enter(function _trc_Matrix_ent_get(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=52003774;//kernel.Matrix:3774
            if (!(res===undefined)) { __pc=1     ; break; }
            //$LASTPOS=52003806;//kernel.Matrix:3806
            e = {set: (function anonymous_3832(v) {
              
              //$LASTPOS=52003855;//kernel.Matrix:3855
              e.value=v;
              //$LASTPOS=52003883;//kernel.Matrix:3883
              _this.set(x,y,v);
            }),x: x,y: y};
            
            //$LASTPOS=52003936;//kernel.Matrix:3936
            _this.sendEvent("newCell",e);
            _thread.exit(e.value);return;
          case 1     :
            
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    exists :function _trc_Matrix_exists(x,y) {
      "use strict";
      var _this=this;
      
      return _this.data[_this.key(x,y)]!==undefined;
    },
    fiber$exists :function _trc_Matrix_f_exists(_thread,x,y) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.data[_this.key(x,y)]!==undefined;return;
      
      
      _thread.retVal=_this;return;
    },
    set :function _trc_Matrix_set(x,y,v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=52004091;//kernel.Matrix:4091
      if (v===undefined) {
        //$LASTPOS=52004121;//kernel.Matrix:4121
        delete _this.data[_this.key(x,y)];
        
      } else {
        return _this.data[_this.key(x,y,true)]=v;
        
      }
    },
    fiber$set :function _trc_Matrix_f_set(_thread,x,y,v) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=52004091;//kernel.Matrix:4091
      if (v===undefined) {
        //$LASTPOS=52004121;//kernel.Matrix:4121
        delete _this.data[_this.key(x,y)];
        
      } else {
        _thread.retVal=_this.data[_this.key(x,y,true)]=v;return;
        
        
      }
      
      _thread.retVal=_this;return;
    },
    neighbors :function _trc_Matrix_neighbors(x,y,options) {
      "use strict";
      var _this=this;
      var dirs;
      var res;
      var dir;
      var _it_446;
      var i;
      var j;
      var r;
      
      //$LASTPOS=52004320;//kernel.Matrix:4320
      options=options||{dirs: _this.neighborDirs};
      //$LASTPOS=52004363;//kernel.Matrix:4363
      options.dirs=options.dirs||_this.neighborDirs||4;
      //$LASTPOS=52004412;//kernel.Matrix:4412
      dirs = [[0,- 1],[1,- 1],[1,0],[1,1],[0,1],[- 1,1],[- 1,0],[- 1,- 1]];
      
      //$LASTPOS=52004497;//kernel.Matrix:4497
      res = [];
      
      //$LASTPOS=52004514;//kernel.Matrix:4514
      _it_446=Tonyu.iterator(dirs,1);
      while(_it_446.next()) {
        dir=_it_446[0];
        
        //$LASTPOS=52004546;//kernel.Matrix:4546
        i = dir[1];
        j = dir[0];
        
        //$LASTPOS=52004578;//kernel.Matrix:4578
        if (i==0&&j==0) {
          continue;
          
        }
        //$LASTPOS=52004613;//kernel.Matrix:4613
        if (options.dirs==4) {
          //$LASTPOS=52004649;//kernel.Matrix:4649
          if (i*j!=0) {
            continue;
            
          }
          
        }
        
        //$LASTPOS=52004707;//kernel.Matrix:4707
        if (_this.exists(x+j,y+i)) {
          //$LASTPOS=52004743;//kernel.Matrix:4743
          r=_this.get(x+j,y+i);
          //$LASTPOS=52004772;//kernel.Matrix:4772
          res.push({x: x+j,y: y+i,ox: j,oy: i,value: r});
          
        } else {
          //$LASTPOS=52004829;//kernel.Matrix:4829
          if (options.includeEmpty) {
            //$LASTPOS=52004870;//kernel.Matrix:4870
            res.push({x: x+j,y: y+i,ox: j,oy: i});
            
          }
        }
        
      }
      return res;
    },
    fiber$neighbors :function _trc_Matrix_f_neighbors(_thread,x,y,options) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var dirs;
      var res;
      var dir;
      var _it_446;
      var i;
      var j;
      var r;
      
      //$LASTPOS=52004320;//kernel.Matrix:4320
      options=options||{dirs: _this.neighborDirs};
      //$LASTPOS=52004363;//kernel.Matrix:4363
      options.dirs=options.dirs||_this.neighborDirs||4;
      //$LASTPOS=52004412;//kernel.Matrix:4412
      dirs = [[0,- 1],[1,- 1],[1,0],[1,1],[0,1],[- 1,1],[- 1,0],[- 1,- 1]];
      
      //$LASTPOS=52004497;//kernel.Matrix:4497
      res = [];
      
      
      _thread.enter(function _trc_Matrix_ent_neighbors(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=52004514;//kernel.Matrix:4514
            _it_446=Tonyu.iterator(dirs,1);
          case 1:
            if (!(_it_446.next())) { __pc=8     ; break; }
            dir=_it_446[0];
            
            //$LASTPOS=52004546;//kernel.Matrix:4546
            i = dir[1];
            j = dir[0];
            
            //$LASTPOS=52004578;//kernel.Matrix:4578
            if (!(i==0&&j==0)) { __pc=2     ; break; }
            __pc=1; break;
            
          case 2     :
            
            //$LASTPOS=52004613;//kernel.Matrix:4613
            if (!(options.dirs==4)) { __pc=4     ; break; }
            //$LASTPOS=52004649;//kernel.Matrix:4649
            if (!(i*j!=0)) { __pc=3     ; break; }
            __pc=1; break;
            
          case 3     :
            
          case 4     :
            
            
            //$LASTPOS=52004707;//kernel.Matrix:4707
            if (!(_this.exists(x+j,y+i))) { __pc=6     ; break; }
            //$LASTPOS=52004743;//kernel.Matrix:4743
            _this.fiber$get(_thread, x+j, y+i);
            __pc=5;return;
          case 5:
            r=_thread.retVal;
            
            //$LASTPOS=52004772;//kernel.Matrix:4772
            res.push({x: x+j,y: y+i,ox: j,oy: i,value: r});
            __pc=7     ;break;
          case 6     :
            //$LASTPOS=52004829;//kernel.Matrix:4829
            if (options.includeEmpty) {
              //$LASTPOS=52004870;//kernel.Matrix:4870
              res.push({x: x+j,y: y+i,ox: j,oy: i});
              
            }
          case 7     :
            
            __pc=1;break;
          case 8     :
            
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    fill :function _trc_Matrix_fill(left,top,cols,rows,data) {
      "use strict";
      var _this=this;
      var i;
      var j;
      var d;
      
      //$LASTPOS=52004980;//kernel.Matrix:4980
      data=data||{};
      //$LASTPOS=52005000;//kernel.Matrix:5000
      //$LASTPOS=52005005;//kernel.Matrix:5005
      i = top;
      for (; i<top+rows ; i++) {
        {
          //$LASTPOS=52005042;//kernel.Matrix:5042
          //$LASTPOS=52005047;//kernel.Matrix:5047
          j = left;
          for (; j<left+cols ; j++) {
            {
              //$LASTPOS=52005090;//kernel.Matrix:5090
              d = data;
              
              //$LASTPOS=52005115;//kernel.Matrix:5115
              if (typeof  data==="object") {
                //$LASTPOS=52005162;//kernel.Matrix:5162
                d=Object.create(data);
                
              } else {
                //$LASTPOS=52005205;//kernel.Matrix:5205
                if (typeof  data==="function") {
                  //$LASTPOS=52005254;//kernel.Matrix:5254
                  d=data(j,i);
                  
                }
              }
              //$LASTPOS=52005295;//kernel.Matrix:5295
              _this.set(j,i,d);
            }
          }
        }
      }
    },
    fiber$fill :function _trc_Matrix_f_fill(_thread,left,top,cols,rows,data) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var i;
      var j;
      var d;
      
      //$LASTPOS=52004980;//kernel.Matrix:4980
      data=data||{};
      
      _thread.enter(function _trc_Matrix_ent_fill(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=52005000;//kernel.Matrix:5000
            //$LASTPOS=52005005;//kernel.Matrix:5005
            i = top;
            
          case 1:
            if (!(i<top+rows)) { __pc=7     ; break; }
            //$LASTPOS=52005042;//kernel.Matrix:5042
            //$LASTPOS=52005047;//kernel.Matrix:5047
            j = left;
            
          case 2:
            if (!(j<left+cols)) { __pc=5     ; break; }
            //$LASTPOS=52005090;//kernel.Matrix:5090
            d = data;
            
            //$LASTPOS=52005115;//kernel.Matrix:5115
            if (typeof  data==="object") {
              //$LASTPOS=52005162;//kernel.Matrix:5162
              d=Object.create(data);
              
            } else {
              //$LASTPOS=52005205;//kernel.Matrix:5205
              if (typeof  data==="function") {
                //$LASTPOS=52005254;//kernel.Matrix:5254
                d=data(j,i);
                
              }
            }
            //$LASTPOS=52005295;//kernel.Matrix:5295
            _this.fiber$set(_thread, j, i, d);
            __pc=3;return;
          case 3:
            
          case 4     :
            j++;
            __pc=2;break;
          case 5     :
            
          case 6     :
            i++;
            __pc=1;break;
          case 7     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"load":{"nowait":false},"cross":{"nowait":false},"search":{"nowait":false},"find":{"nowait":false},"crop":{"nowait":false},"rev":{"nowait":false},"keysIterator":{"nowait":false},"rectIterator":{"nowait":false},"tonyuIteratorKeys":{"nowait":false},"tonyuIterator":{"nowait":false},"tonyuIteratorRect":{"nowait":false},"unkey":{"nowait":false},"key":{"nowait":false},"__getter__rows":{"nowait":true},"__getter__cols":{"nowait":true},"get":{"nowait":false},"exists":{"nowait":false},"set":{"nowait":false},"neighbors":{"nowait":false},"fill":{"nowait":false}},"fields":{"data":{},"row":{},"cell":{},"xmax":{},"ymax":{},"iterateMode":{},"xmin":{},"ymin":{},"neighborDirs":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.QueryMod',
  shortName: 'QueryMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.SchedulerMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.EventHandlerCaller,Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.LifeCycleMod,Tonyu.classes.kernel.SpriteMod],
  methods: {
    main :function _trc_QueryMod_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=53000098;//kernel.QueryMod:98
      "field strict";
      
    },
    fiber$main :function _trc_QueryMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=53000098;//kernel.QueryMod:98
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    hitTo :function _trc_QueryMod_hitTo(t) {
      "use strict";
      var _this=this;
      
      return _this.crashTo(t);
    },
    all :function _trc_QueryMod_all(c) {
      "use strict";
      var _this=this;
      var res;
      
      //$LASTPOS=53000369;//kernel.QueryMod:369
      res = new Tonyu.classes.kernel.TQuery(_this);
      
      //$LASTPOS=53000400;//kernel.QueryMod:400
      if (arguments.length>0&&typeof  c!="function") {
        return res;
        
      }
      //$LASTPOS=53000483;//kernel.QueryMod:483
      _this.layer.sprites.forEach((function anonymous_505(s) {
        
        //$LASTPOS=53000521;//kernel.QueryMod:521
        if (s===_this) {
          return _this;
        }
        //$LASTPOS=53000552;//kernel.QueryMod:552
        if (! c||s instanceof c) {
          //$LASTPOS=53000593;//kernel.QueryMod:593
          res.push(s);
          
        }
      }));
      return res;
    },
    allCrash :function _trc_QueryMod_allCrash(t) {
      "use strict";
      var _this=this;
      var res;
      var sp;
      var t1;
      
      //$LASTPOS=53000678;//kernel.QueryMod:678
      res = new Tonyu.classes.kernel.TQuery(_this);
      
      //$LASTPOS=53000709;//kernel.QueryMod:709
      sp = _this;
      
      //$LASTPOS=53000727;//kernel.QueryMod:727
      t1 = _this.getCrashShape();
      
      //$LASTPOS=53000784;//kernel.QueryMod:784
      if (! t1) {
        return res;
      }
      //$LASTPOS=53000810;//kernel.QueryMod:810
      _this.layer.sprites.forEach((function anonymous_832(s) {
        var t2;
        
        
        //$LASTPOS=53000865;//kernel.QueryMod:865
        if (s!==_this&&! s.excludeFromAll&&s instanceof t&&(t2=s.getCrashShape())&&t1.intersects(t2)) {
          //$LASTPOS=53001007;//kernel.QueryMod:1007
          res.push(s);
          
        }
      }));
      return res;
    },
    crashTo :function _trc_QueryMod_crashTo(t) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=53001333;//kernel.QueryMod:1333
      if (! t) {
        return false;
      }
      //$LASTPOS=53001360;//kernel.QueryMod:1360
      if (typeof  t=="function") {
        return _this.allCrash(t)[0];
        
      }
      return _this.crashTo1(t);
    },
    crashTo1 :function _trc_QueryMod_crashTo1(t) {
      "use strict";
      var _this=this;
      var t1;
      var t2;
      
      //$LASTPOS=53001488;//kernel.QueryMod:1488
      if (! t||t._isDead) {
        return false;
      }
      //$LASTPOS=53001528;//kernel.QueryMod:1528
      t1 = _this.getCrashShape();
      
      //$LASTPOS=53001584;//kernel.QueryMod:1584
      t2 = t.getCrashShape();
      
      return t1&&t1.intersects(t2);
    },
    crashToChecker :function _trc_QueryMod_crashToChecker(d,f) {
      "use strict";
      var _this=this;
      var obj;
      var _it_466;
      
      //$LASTPOS=53001683;//kernel.QueryMod:1683
      while (true) {
        //$LASTPOS=53001705;//kernel.QueryMod:1705
        if (typeof  d=="function") {
          //$LASTPOS=53001744;//kernel.QueryMod:1744
          _it_466=Tonyu.iterator(_this.allCrash(d),1);
          while(_it_466.next()) {
            obj=_it_466[0];
            
            //$LASTPOS=53001790;//kernel.QueryMod:1790
            _this.callEventHandler(f,[obj]);
            
          }
          
        } else {
          //$LASTPOS=53001847;//kernel.QueryMod:1847
          if (_this.crashTo(d)) {
            //$LASTPOS=53001876;//kernel.QueryMod:1876
            _this.callEventHandler(f,[d]);
            
          }
        }
        //$LASTPOS=53001921;//kernel.QueryMod:1921
        _this.update();
        
      }
    },
    fiber$crashToChecker :function _trc_QueryMod_f_crashToChecker(_thread,d,f) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var obj;
      var _it_466;
      
      
      _thread.enter(function _trc_QueryMod_ent_crashToChecker(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=53001683;//kernel.QueryMod:1683
          case 1:
            //$LASTPOS=53001705;//kernel.QueryMod:1705
            if (!(typeof  d=="function")) { __pc=5     ; break; }
            //$LASTPOS=53001744;//kernel.QueryMod:1744
            _it_466=Tonyu.iterator(_this.allCrash(d),1);
          case 2:
            if (!(_it_466.next())) { __pc=4     ; break; }
            obj=_it_466[0];
            
            //$LASTPOS=53001790;//kernel.QueryMod:1790
            _this.fiber$callEventHandler(_thread, f, [obj]);
            __pc=3;return;
          case 3:
            
            __pc=2;break;
          case 4     :
            
            __pc=8     ;break;
          case 5     :
            //$LASTPOS=53001847;//kernel.QueryMod:1847
            if (!(_this.crashTo(d))) { __pc=7     ; break; }
            //$LASTPOS=53001876;//kernel.QueryMod:1876
            _this.fiber$callEventHandler(_thread, f, [d]);
            __pc=6;return;
          case 6:
            
          case 7     :
            
          case 8     :
            
            //$LASTPOS=53001921;//kernel.QueryMod:1921
            _this.fiber$update(_thread);
            __pc=9;return;
          case 9:
            
            __pc=1;break;
          case 10    :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    allWithin :function _trc_QueryMod_allWithin(t,distance) {
      "use strict";
      var _this=this;
      var res;
      var sp;
      
      //$LASTPOS=53002005;//kernel.QueryMod:2005
      res = new Tonyu.classes.kernel.TQuery(_this);
      
      //$LASTPOS=53002036;//kernel.QueryMod:2036
      sp = _this;
      
      //$LASTPOS=53002054;//kernel.QueryMod:2054
      if (typeof  t!=="function") {
        throw new Error("allWithinの第一引数はクラスにしてください");
        
      }
      //$LASTPOS=53002133;//kernel.QueryMod:2133
      _this.layer.sprites.forEach((function anonymous_2155(s) {
        
        //$LASTPOS=53002171;//kernel.QueryMod:2171
        if (s!==_this&&! s.excludeFromAll&&s instanceof t&&_this.dist(s)<distance) {
          //$LASTPOS=53002286;//kernel.QueryMod:2286
          res.push(s);
          
        }
      }));
      return res;
    },
    within :function _trc_QueryMod_within(t,distance) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=53002378;//kernel.QueryMod:2378
      if (! t) {
        return false;
      }
      //$LASTPOS=53002404;//kernel.QueryMod:2404
      if (typeof  t=="function") {
        return _this.allWithin(t,distance)[0];
        
      }
      return _this.within1(t,distance);
    },
    within1 :function _trc_QueryMod_within1(t,distance) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=53002574;//kernel.QueryMod:2574
      if (! t||t._isDead) {
        return false;
      }
      //$LASTPOS=53002613;//kernel.QueryMod:2613
      if (Math.sqrt(Math.abs(_this.x-t.x)*Math.abs(_this.x-t.x)+Math.abs(_this.y-t.y)*Math.abs(_this.y-t.y))<distance) {
        return true;
        
      }
      return false;
    },
    withinChecker :function _trc_QueryMod_withinChecker(d,r,f) {
      "use strict";
      var _this=this;
      var obj;
      var _it_472;
      
      //$LASTPOS=53002788;//kernel.QueryMod:2788
      while (true) {
        //$LASTPOS=53002810;//kernel.QueryMod:2810
        if (typeof  d=="function") {
          //$LASTPOS=53002849;//kernel.QueryMod:2849
          _it_472=Tonyu.iterator(_this.allWithin(d,r),1);
          while(_it_472.next()) {
            obj=_it_472[0];
            
            //$LASTPOS=53002898;//kernel.QueryMod:2898
            f(obj);
            
          }
          
        } else {
          //$LASTPOS=53002936;//kernel.QueryMod:2936
          if (_this.within(d,r)) {
            //$LASTPOS=53002966;//kernel.QueryMod:2966
            f(d);
            
          }
        }
        //$LASTPOS=53002992;//kernel.QueryMod:2992
        _this.update();
        
      }
    },
    fiber$withinChecker :function _trc_QueryMod_f_withinChecker(_thread,d,r,f) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var obj;
      var _it_472;
      
      
      _thread.enter(function _trc_QueryMod_ent_withinChecker(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=53002788;//kernel.QueryMod:2788
          case 1:
            //$LASTPOS=53002810;//kernel.QueryMod:2810
            if (typeof  d=="function") {
              //$LASTPOS=53002849;//kernel.QueryMod:2849
              _it_472=Tonyu.iterator(_this.allWithin(d,r),1);
              while(_it_472.next()) {
                obj=_it_472[0];
                
                //$LASTPOS=53002898;//kernel.QueryMod:2898
                f(obj);
                
              }
              
            } else {
              //$LASTPOS=53002936;//kernel.QueryMod:2936
              if (_this.within(d,r)) {
                //$LASTPOS=53002966;//kernel.QueryMod:2966
                f(d);
                
              }
            }
            //$LASTPOS=53002992;//kernel.QueryMod:2992
            _this.fiber$update(_thread);
            __pc=2;return;
          case 2:
            
            __pc=1;break;
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    watchHit :function _trc_QueryMod_watchHit(typeA,typeB,onHit) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=53003061;//kernel.QueryMod:3061
      _this.layer.watchHit(typeA,typeB,(function anonymous_3091(a,b) {
        
        //$LASTPOS=53003109;//kernel.QueryMod:3109
        onHit.apply(_this,[a,b]);
      }));
    },
    screenOutChecker :function _trc_QueryMod_screenOutChecker(d,f) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=53003183;//kernel.QueryMod:3183
      while (true) {
        //$LASTPOS=53003205;//kernel.QueryMod:3205
        while (true) {
          //$LASTPOS=53003231;//kernel.QueryMod:3231
          if (_this.screenOut()>d) {
            //$LASTPOS=53003294;//kernel.QueryMod:3294
            f();
            break;
            
            
          }
          //$LASTPOS=53003351;//kernel.QueryMod:3351
          _this.update();
          
        }
        //$LASTPOS=53003381;//kernel.QueryMod:3381
        while (true) {
          //$LASTPOS=53003407;//kernel.QueryMod:3407
          if (_this.screenOut()<=d) {
            break;
            
            
          }
          //$LASTPOS=53003506;//kernel.QueryMod:3506
          _this.update();
          
        }
        //$LASTPOS=53003536;//kernel.QueryMod:3536
        _this.update();
        
      }
    },
    fiber$screenOutChecker :function _trc_QueryMod_f_screenOutChecker(_thread,d,f) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_QueryMod_ent_screenOutChecker(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=53003183;//kernel.QueryMod:3183
          case 1:
            //$LASTPOS=53003205;//kernel.QueryMod:3205
          case 2:
            //$LASTPOS=53003231;//kernel.QueryMod:3231
            if (!(_this.screenOut()>d)) { __pc=3     ; break; }
            //$LASTPOS=53003294;//kernel.QueryMod:3294
            f();
            __pc=5     ; break;
            
          case 3     :
            
            //$LASTPOS=53003351;//kernel.QueryMod:3351
            _this.fiber$update(_thread);
            __pc=4;return;
          case 4:
            
            __pc=2;break;
          case 5     :
            
            //$LASTPOS=53003381;//kernel.QueryMod:3381
          case 6:
            //$LASTPOS=53003407;//kernel.QueryMod:3407
            if (!(_this.screenOut()<=d)) { __pc=7     ; break; }
            __pc=9     ; break;
            
          case 7     :
            
            //$LASTPOS=53003506;//kernel.QueryMod:3506
            _this.fiber$update(_thread);
            __pc=8;return;
          case 8:
            
            __pc=6;break;
          case 9     :
            
            //$LASTPOS=53003536;//kernel.QueryMod:3536
            _this.fiber$update(_thread);
            __pc=10;return;
          case 10:
            
            __pc=1;break;
          case 11    :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"hitTo":{"nowait":true},"all":{"nowait":true},"allCrash":{"nowait":true},"crashTo":{"nowait":true},"crashTo1":{"nowait":true},"crashToChecker":{"nowait":false},"allWithin":{"nowait":true},"within":{"nowait":true},"within1":{"nowait":true},"withinChecker":{"nowait":false},"watchHit":{"nowait":true},"screenOutChecker":{"nowait":false}},"fields":{"crashScale":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.QueryMod2D',
  shortName: 'QueryMod2D',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.QueryMod],
  methods: {
    main :function _trc_QueryMod2D_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=54000049;//kernel.QueryMod2D:49
      "field strict";
    },
    fiber$main :function _trc_QueryMod2D_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=54000049;//kernel.QueryMod2D:49
      "field strict";
      
      _thread.retVal=_this;return;
    },
    getCrashShape :function _trc_QueryMod2D_getCrashShape() {
      "use strict";
      var _this=this;
      
      return new Tonyu.classes.kernel.RectShape(_this.getCrashRect());
    },
    fiber$getCrashShape :function _trc_QueryMod2D_f_getCrashShape(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=new Tonyu.classes.kernel.RectShape(_this.getCrashRect());return;
      
      
      _thread.retVal=_this;return;
    },
    getCrashRect :function _trc_QueryMod2D_getCrashRect() {
      "use strict";
      var _this=this;
      var actWidth;
      var actHeight;
      
      //$LASTPOS=54000213;//kernel.QueryMod2D:213
      actWidth = (_this.width||_this.radius*2)*_this.scaleX*_this.crashScale;
      
      //$LASTPOS=54000279;//kernel.QueryMod2D:279
      if (typeof  _this.scaleY==="undefined") {
        //$LASTPOS=54000321;//kernel.QueryMod2D:321
        actHeight=(_this.height||_this.radius*2)*_this.scaleX*_this.crashScale;
        
      } else {
        //$LASTPOS=54000390;//kernel.QueryMod2D:390
        actHeight=(_this.height||_this.radius*2)*_this.scaleY*_this.crashScale;
        
      }
      return typeof  _this.x=="number"&&typeof  _this.y=="number"&&typeof  actWidth=="number"&&typeof  actHeight=="number"&&{x: _this.x,y: _this.y,width: Math.abs(actWidth),height: Math.abs(actHeight)};
    },
    screenOut :function _trc_QueryMod2D_screenOut(a) {
      "use strict";
      var _this=this;
      var cp;
      
      //$LASTPOS=54000668;//kernel.QueryMod2D:668
      if (! a) {
        //$LASTPOS=54000676;//kernel.QueryMod2D:676
        a=0;
      }
      //$LASTPOS=54000686;//kernel.QueryMod2D:686
      cp = Tonyu.globals.$Screen.convert(_this,Tonyu.globals.$Screen);
      
      return _this.abs(_this.clamped(cp.x,- a,Tonyu.globals.$screenWidth+a))+_this.abs(_this.clamped(cp.y,- a,Tonyu.globals.$screenHeight+a));
    },
    fiber$screenOut :function _trc_QueryMod2D_f_screenOut(_thread,a) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var cp;
      
      //$LASTPOS=54000668;//kernel.QueryMod2D:668
      if (! a) {
        //$LASTPOS=54000676;//kernel.QueryMod2D:676
        a=0;
      }
      //$LASTPOS=54000686;//kernel.QueryMod2D:686
      cp = Tonyu.globals.$Screen.convert(_this,Tonyu.globals.$Screen);
      
      _thread.retVal=_this.abs(_this.clamped(cp.x,- a,Tonyu.globals.$screenWidth+a))+_this.abs(_this.clamped(cp.y,- a,Tonyu.globals.$screenHeight+a));return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"getCrashShape":{"nowait":false},"getCrashRect":{"nowait":true},"screenOut":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.QueryMod3D',
  shortName: 'QueryMod3D',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.QueryMod,Tonyu.classes.kernel.SpriteMod3D],
  methods: {
    main :function _trc_QueryMod3D_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=55000061;//kernel.QueryMod3D:61
      "field strict";
    },
    fiber$main :function _trc_QueryMod3D_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=55000061;//kernel.QueryMod3D:61
      "field strict";
      
      _thread.retVal=_this;return;
    },
    getCrashShape :function _trc_QueryMod3D_getCrashShape() {
      "use strict";
      var _this=this;
      var actWidth;
      var actHeight;
      
      //$LASTPOS=55000107;//kernel.QueryMod3D:107
      actWidth = (_this.width||_this.radius*2)*_this.scaleX*_this.crashScale;
      
      //$LASTPOS=55000173;//kernel.QueryMod3D:173
      if (typeof  _this.scaleY==="undefined") {
        //$LASTPOS=55000215;//kernel.QueryMod3D:215
        actHeight=(_this.height||_this.radius*2)*_this.scaleX*_this.crashScale;
        
      } else {
        //$LASTPOS=55000284;//kernel.QueryMod3D:284
        actHeight=(_this.height||_this.radius*2)*_this.scaleY*_this.crashScale;
        
      }
      return typeof  _this.x=="number"&&typeof  _this.y=="number"&&typeof  actWidth=="number"&&typeof  actHeight=="number"&&new Tonyu.classes.kernel.CubeShape({x: _this.x,y: _this.y,z: _this.z,width: Math.abs(actWidth),height: Math.abs(actHeight),depth: (Math.abs(actWidth)+Math.abs(actHeight))/2});
    },
    fiber$getCrashShape :function _trc_QueryMod3D_f_getCrashShape(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var actWidth;
      var actHeight;
      
      //$LASTPOS=55000107;//kernel.QueryMod3D:107
      actWidth = (_this.width||_this.radius*2)*_this.scaleX*_this.crashScale;
      
      //$LASTPOS=55000173;//kernel.QueryMod3D:173
      if (typeof  _this.scaleY==="undefined") {
        //$LASTPOS=55000215;//kernel.QueryMod3D:215
        actHeight=(_this.height||_this.radius*2)*_this.scaleX*_this.crashScale;
        
      } else {
        //$LASTPOS=55000284;//kernel.QueryMod3D:284
        actHeight=(_this.height||_this.radius*2)*_this.scaleY*_this.crashScale;
        
      }
      _thread.retVal=typeof  _this.x=="number"&&typeof  _this.y=="number"&&typeof  actWidth=="number"&&typeof  actHeight=="number"&&new Tonyu.classes.kernel.CubeShape({x: _this.x,y: _this.y,z: _this.z,width: Math.abs(actWidth),height: Math.abs(actHeight),depth: (Math.abs(actWidth)+Math.abs(actHeight))/2});return;
      
      
      _thread.retVal=_this;return;
    },
    screenOut :function _trc_QueryMod3D_screenOut(a) {
      "use strict";
      var _this=this;
      var cp;
      
      //$LASTPOS=55000662;//kernel.QueryMod3D:662
      if (! a) {
        //$LASTPOS=55000670;//kernel.QueryMod3D:670
        a=0;
      }
      return false;
      //$LASTPOS=55000706;//kernel.QueryMod3D:706
      cp = Tonyu.globals.$Screen.convert(_this,Tonyu.globals.$Screen);
      
      return _this.abs(_this.clamped(cp.x,- a,Tonyu.globals.$screenWidth+a))+_this.abs(_this.clamped(cp.y,- a,Tonyu.globals.$screenHeight+a));
    },
    fiber$screenOut :function _trc_QueryMod3D_f_screenOut(_thread,a) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var cp;
      
      //$LASTPOS=55000662;//kernel.QueryMod3D:662
      if (! a) {
        //$LASTPOS=55000670;//kernel.QueryMod3D:670
        a=0;
      }
      _thread.retVal=false;return;
      
      //$LASTPOS=55000706;//kernel.QueryMod3D:706
      cp = Tonyu.globals.$Screen.convert(_this,Tonyu.globals.$Screen);
      
      _thread.retVal=_this.abs(_this.clamped(cp.x,- a,Tonyu.globals.$screenWidth+a))+_this.abs(_this.clamped(cp.y,- a,Tonyu.globals.$screenHeight+a));return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"getCrashShape":{"nowait":false},"screenOut":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.CrashToHandler',
  shortName: 'CrashToHandler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.EventHandler,
  includes: [],
  methods: {
    main :function _trc_CrashToHandler_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_CrashToHandler_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    addListener :function _trc_CrashToHandler_addListener(d,f) {
      "use strict";
      var _this=this;
      var retThread;
      
      //$LASTPOS=56000049;//kernel.CrashToHandler:49
      retThread = _this.target.parallel("crashToChecker",d,_this.toListener(f));
      
      return {remove: (function anonymous_145() {
        
        //$LASTPOS=56000161;//kernel.CrashToHandler:161
        retThread.kill();
      })};
    },
    initialize :function _trc_CrashToHandler_initialize(param) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=56000221;//kernel.CrashToHandler:221
      Tonyu.classes.kernel.EventHandler.apply( _this, [param]);
      //$LASTPOS=56000240;//kernel.CrashToHandler:240
      _this.id=(Tonyu.globals.$idseq=(Tonyu.globals.$idseq||0)+1);
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"addListener":{"nowait":true},"new":{"nowait":false}},"fields":{"id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ComputedVec3',
  shortName: 'ComputedVec3',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Vec3,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: {
    main :function _trc_ComputedVec3_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_ComputedVec3_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_ComputedVec3_initialize(func) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=57000052;//kernel.ComputedVec3:52
      _this.computer=func;
    },
    requestCompute :function _trc_ComputedVec3_requestCompute() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=57000096;//kernel.ComputedVec3:96
      _this.computed=null;
    },
    fiber$requestCompute :function _trc_ComputedVec3_f_requestCompute(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=57000096;//kernel.ComputedVec3:96
      _this.computed=null;
      
      _thread.retVal=_this;return;
    },
    compute :function _trc_ComputedVec3_compute() {
      "use strict";
      var _this=this;
      var c;
      
      //$LASTPOS=57000133;//kernel.ComputedVec3:133
      if (_this.computed) {
        return _this.computed;
      }
      //$LASTPOS=57000169;//kernel.ComputedVec3:169
      c = _this.computer(_this);
      
      return _this.computed||c;
    },
    fiber$compute :function _trc_ComputedVec3_f_compute(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var c;
      
      //$LASTPOS=57000133;//kernel.ComputedVec3:133
      if (_this.computed) {
        _thread.retVal=_this.computed;return;
        
      }
      //$LASTPOS=57000169;//kernel.ComputedVec3:169
      c = _this.computer(_this);
      
      _thread.retVal=_this.computed||c;return;
      
      
      _thread.retVal=_this;return;
    },
    keep :function _trc_ComputedVec3_keep(c) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=57000236;//kernel.ComputedVec3:236
      _this.computed=c;
      return c;
    },
    fiber$keep :function _trc_ComputedVec3_f_keep(_thread,c) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=57000236;//kernel.ComputedVec3:236
      _this.computed=c;
      _thread.retVal=c;return;
      
      
      _thread.retVal=_this;return;
    },
    __getter__x :function _trc_ComputedVec3___getter__x() {
      "use strict";
      var _this=this;
      
      return _this.compute().x;
    },
    __getter__y :function _trc_ComputedVec3___getter__y() {
      "use strict";
      var _this=this;
      
      return _this.compute().y;
    },
    __getter__z :function _trc_ComputedVec3___getter__z() {
      "use strict";
      var _this=this;
      
      return _this.compute().z;
    },
    __setter__x :function _trc_ComputedVec3___setter__x(v) {
      "use strict";
      var _this=this;
      
      throw new Error("ComputedVec3: read only");
      
    },
    __setter__y :function _trc_ComputedVec3___setter__y(v) {
      "use strict";
      var _this=this;
      
      throw new Error("ComputedVec3: read only");
      
    },
    __setter__z :function _trc_ComputedVec3___setter__z(v) {
      "use strict";
      var _this=this;
      
      throw new Error("ComputedVec3: read only");
      
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"requestCompute":{"nowait":false},"compute":{"nowait":false},"keep":{"nowait":false},"__getter__x":{"nowait":true},"__getter__y":{"nowait":true},"__getter__z":{"nowait":true},"__setter__x":{"nowait":true},"__setter__y":{"nowait":true},"__setter__z":{"nowait":true}},"fields":{"computer":{},"computed":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ActorSprite',
  shortName: 'ActorSprite',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.SpriteMod2D],
  methods: {
    main :function _trc_ActorSprite_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_ActorSprite_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_ActorSprite_initialize(param) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=58000062;//kernel.ActorSprite:62
      Tonyu.classes.kernel.TObject.apply( _this, [param]);
      //$LASTPOS=58000081;//kernel.ActorSprite:81
      _this.initSpriteMod();
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.PanelMod',
  shortName: 'PanelMod',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.FileMod,Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.SpriteMod2D,Tonyu.classes.kernel.EventMod],
  methods: {
    main :function _trc_PanelMod_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59000066;//kernel.PanelMod:66
      "field strict";
      
    },
    fiber$main :function _trc_PanelMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=59000066;//kernel.PanelMod:66
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    initPanelMod :function _trc_PanelMod_initPanelMod() {
      "use strict";
      var _this=this;
      
      throw "Check overrides in spritesmod /oneframeSpritemod";
      
      //$LASTPOS=59000323;//kernel.PanelMod:323
      if (_this.canvas) {
        //$LASTPOS=59000346;//kernel.PanelMod:346
        _this.width=_this.canvas.width;
        //$LASTPOS=59000375;//kernel.PanelMod:375
        _this.height=_this.canvas.height;
        
      } else {
        //$LASTPOS=59000420;//kernel.PanelMod:420
        _this.setPanel(_this.width||Tonyu.globals.$screenWidth||465,_this.height||Tonyu.globals.$screenHeight||465);
        
      }
      //$LASTPOS=59000544;//kernel.PanelMod:544
      if (_this._fillStyle&&_this.canvas) {
        //$LASTPOS=59000570;//kernel.PanelMod:570
        _this.canvas.getContext("2d").fillStyle=_this._fillStyle+"";
      }
      //$LASTPOS=59000624;//kernel.PanelMod:624
      _this.x=_this.x||_this.width/2;
      //$LASTPOS=59000643;//kernel.PanelMod:643
      _this.y=_this.y||_this.height/2;
      //$LASTPOS=59000663;//kernel.PanelMod:663
      if (_this.align==null) {
        //$LASTPOS=59000679;//kernel.PanelMod:679
        _this.align="center";
      }
      //$LASTPOS=59000700;//kernel.PanelMod:700
      if (_this.alpha==null) {
        //$LASTPOS=59000716;//kernel.PanelMod:716
        _this.alpha=255;
      }
      //$LASTPOS=59000732;//kernel.PanelMod:732
      if (_this._drawn==null) {
        //$LASTPOS=59000749;//kernel.PanelMod:749
        _this._drawn=false;
      }
    },
    fiber$initPanelMod :function _trc_PanelMod_f_initPanelMod(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      throw "Check overrides in spritesmod /oneframeSpritemod";
      
      
      _thread.enter(function _trc_PanelMod_ent_initPanelMod(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=59000323;//kernel.PanelMod:323
            if (!(_this.canvas)) { __pc=1     ; break; }
            {
              //$LASTPOS=59000346;//kernel.PanelMod:346
              _this.width=_this.canvas.width;
              //$LASTPOS=59000375;//kernel.PanelMod:375
              _this.height=_this.canvas.height;
            }
            __pc=3     ;break;
          case 1     :
            //$LASTPOS=59000420;//kernel.PanelMod:420
            _this.fiber$setPanel(_thread, _this.width||Tonyu.globals.$screenWidth||465, _this.height||Tonyu.globals.$screenHeight||465);
            __pc=2;return;
          case 2:
            
          case 3     :
            
            //$LASTPOS=59000544;//kernel.PanelMod:544
            if (_this._fillStyle&&_this.canvas) {
              //$LASTPOS=59000570;//kernel.PanelMod:570
              _this.canvas.getContext("2d").fillStyle=_this._fillStyle+"";
            }
            //$LASTPOS=59000624;//kernel.PanelMod:624
            _this.x=_this.x||_this.width/2;
            //$LASTPOS=59000643;//kernel.PanelMod:643
            _this.y=_this.y||_this.height/2;
            //$LASTPOS=59000663;//kernel.PanelMod:663
            if (_this.align==null) {
              //$LASTPOS=59000679;//kernel.PanelMod:679
              _this.align="center";
            }
            //$LASTPOS=59000700;//kernel.PanelMod:700
            if (_this.alpha==null) {
              //$LASTPOS=59000716;//kernel.PanelMod:716
              _this.alpha=255;
            }
            //$LASTPOS=59000732;//kernel.PanelMod:732
            if (_this._drawn==null) {
              //$LASTPOS=59000749;//kernel.PanelMod:749
              _this._drawn=false;
            }
            _thread.exit(_this);return;
          }
        }
      });
    },
    setPanel :function _trc_PanelMod_setPanel(width,height) {
      "use strict";
      var _this=this;
      var buf;
      
      //$LASTPOS=59000826;//kernel.PanelMod:826
      _this.width=_this.trunc(width);
      //$LASTPOS=59000856;//kernel.PanelMod:856
      _this.height=_this.trunc(height);
      //$LASTPOS=59000888;//kernel.PanelMod:888
      buf = $("<canvas>").attr({width: width,height: height});
      
      //$LASTPOS=59000935;//kernel.PanelMod:935
      _this.canvas=buf[0];
      //$LASTPOS=59000955;//kernel.PanelMod:955
      _this.imageSmoothingEnabled=! Tonyu.globals.$imageSmoothingDisabled;
      //$LASTPOS=59001008;//kernel.PanelMod:1008
      _this._drawn=false;
      //$LASTPOS=59001027;//kernel.PanelMod:1027
      _this.fireEvent("resize",{width: width,height: height,force: true});
    },
    fiber$setPanel :function _trc_PanelMod_f_setPanel(_thread,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var buf;
      
      //$LASTPOS=59000826;//kernel.PanelMod:826
      _this.width=_this.trunc(width);
      //$LASTPOS=59000856;//kernel.PanelMod:856
      _this.height=_this.trunc(height);
      //$LASTPOS=59000888;//kernel.PanelMod:888
      buf = $("<canvas>").attr({width: width,height: height});
      
      //$LASTPOS=59000935;//kernel.PanelMod:935
      _this.canvas=buf[0];
      //$LASTPOS=59000955;//kernel.PanelMod:955
      _this.imageSmoothingEnabled=! Tonyu.globals.$imageSmoothingDisabled;
      //$LASTPOS=59001008;//kernel.PanelMod:1008
      _this._drawn=false;
      //$LASTPOS=59001027;//kernel.PanelMod:1027
      _this.fireEvent("resize",{width: width,height: height,force: true});
      
      _thread.retVal=_this;return;
    },
    resize :function _trc_PanelMod_resize(width,height) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59001106;//kernel.PanelMod:1106
      if (_this.width==width&&_this.height==height) {
        return _this;
      }
      //$LASTPOS=59001165;//kernel.PanelMod:1165
      _this.setPanel(width,height);
    },
    fiber$resize :function _trc_PanelMod_f_resize(_thread,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=59001106;//kernel.PanelMod:1106
      if (_this.width==width&&_this.height==height) {
        _thread.retVal=_this;return;
        
      }
      
      _thread.enter(function _trc_PanelMod_ent_resize(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=59001165;//kernel.PanelMod:1165
            _this.fiber$setPanel(_thread, width, height);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    getContext :function _trc_PanelMod_getContext() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59001213;//kernel.PanelMod:1213
      _this._drawn=true;
      return _this.canvas.getContext("2d");
    },
    fiber$getContext :function _trc_PanelMod_f_getContext(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=59001213;//kernel.PanelMod:1213
      _this._drawn=true;
      _thread.retVal=_this.canvas.getContext("2d");return;
      
      
      _thread.retVal=_this;return;
    },
    __getter__context :function _trc_PanelMod___getter__context() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59001283;//kernel.PanelMod:1283
      _this._drawn=true;
      return _this.canvas.getContext("2d");
    },
    __getter__image :function _trc_PanelMod___getter__image() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59001351;//kernel.PanelMod:1351
      _this._drawn=true;
      return _this.canvas;
    },
    setFillStyle :function _trc_PanelMod_setFillStyle(color) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59001415;//kernel.PanelMod:1415
      _this.fillStyle=color;
    },
    fiber$setFillStyle :function _trc_PanelMod_f_setFillStyle(_thread,color) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=59001415;//kernel.PanelMod:1415
      _this.fillStyle=color;
      
      _thread.retVal=_this;return;
    },
    __getter__fillStyle :function _trc_PanelMod___getter__fillStyle() {
      "use strict";
      var _this=this;
      
      return _this._fillStyle;
    },
    __setter__fillStyle :function _trc_PanelMod___setter__fillStyle(val) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59001499;//kernel.PanelMod:1499
      _this._fillStyle=val;
      //$LASTPOS=59001520;//kernel.PanelMod:1520
      if (! _this.canvas) {
        return _this;
      }
      //$LASTPOS=59001546;//kernel.PanelMod:1546
      _this.context.fillStyle=val+"";
    },
    __setter__strokeStyle :function _trc_PanelMod___setter__strokeStyle(val) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59001600;//kernel.PanelMod:1600
      _this.context.strokeStyle=val+"";
    },
    __setter__lineWidth :function _trc_PanelMod___setter__lineWidth(val) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59001654;//kernel.PanelMod:1654
      _this.context.lineWidth=val;
    },
    fillCircle :function _trc_PanelMod_fillCircle(x,y,r) {
      "use strict";
      var _this=this;
      var ctx;
      
      //$LASTPOS=59001707;//kernel.PanelMod:1707
      ctx = _this.context;
      
      //$LASTPOS=59001729;//kernel.PanelMod:1729
      ctx.fillStyle=_this.fillStyle+"";
      //$LASTPOS=59001762;//kernel.PanelMod:1762
      ctx.beginPath();
      //$LASTPOS=59001784;//kernel.PanelMod:1784
      ctx.arc(x,y,r,0,2*Tonyu.globals.$Math.PI);
      //$LASTPOS=59001818;//kernel.PanelMod:1818
      ctx.closePath();
      //$LASTPOS=59001840;//kernel.PanelMod:1840
      ctx.fill();
    },
    fiber$fillCircle :function _trc_PanelMod_f_fillCircle(_thread,x,y,r) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      
      //$LASTPOS=59001707;//kernel.PanelMod:1707
      ctx = _this.context;
      
      //$LASTPOS=59001729;//kernel.PanelMod:1729
      ctx.fillStyle=_this.fillStyle+"";
      //$LASTPOS=59001762;//kernel.PanelMod:1762
      ctx.beginPath();
      //$LASTPOS=59001784;//kernel.PanelMod:1784
      ctx.arc(x,y,r,0,2*Tonyu.globals.$Math.PI);
      //$LASTPOS=59001818;//kernel.PanelMod:1818
      ctx.closePath();
      //$LASTPOS=59001840;//kernel.PanelMod:1840
      ctx.fill();
      
      _thread.retVal=_this;return;
    },
    fillRect :function _trc_PanelMod_fillRect(x,y,w,h) {
      "use strict";
      var _this=this;
      var ctx;
      
      //$LASTPOS=59001881;//kernel.PanelMod:1881
      ctx = _this.getContext();
      
      //$LASTPOS=59001962;//kernel.PanelMod:1962
      ctx.fillRect(x,y,w,h);
    },
    fiber$fillRect :function _trc_PanelMod_f_fillRect(_thread,x,y,w,h) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      
      
      _thread.enter(function _trc_PanelMod_ent_fillRect(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=59001881;//kernel.PanelMod:1881
            _this.fiber$getContext(_thread);
            __pc=1;return;
          case 1:
            ctx=_thread.retVal;
            
            //$LASTPOS=59001962;//kernel.PanelMod:1962
            ctx.fillRect(x,y,w,h);
            _thread.exit(_this);return;
          }
        }
      });
    },
    fillText :function _trc_PanelMod_fillText(text,x,y,size,align) {
      "use strict";
      var _this=this;
      var ctx;
      var splits;
      var f;
      var colCount;
      
      //$LASTPOS=59002048;//kernel.PanelMod:2048
      ctx = _this.getContext();
      
      //$LASTPOS=59002075;//kernel.PanelMod:2075
      ctx.save();
      //$LASTPOS=59002092;//kernel.PanelMod:2092
      text=text+"";
      //$LASTPOS=59002111;//kernel.PanelMod:2111
      splits = text.split("\n");
      
      //$LASTPOS=59002197;//kernel.PanelMod:2197
      ctx.textAlign=align||"center";
      //$LASTPOS=59002236;//kernel.PanelMod:2236
      size=size||15;
      //$LASTPOS=59002256;//kernel.PanelMod:2256
      ctx.fillStyle=_this.fillStyle+"";
      //$LASTPOS=59002289;//kernel.PanelMod:2289
      f = ctx.font.replace(/^[0-9\.]+/,"");
      
      //$LASTPOS=59002334;//kernel.PanelMod:2334
      ctx.font=size+f;
      //$LASTPOS=59002356;//kernel.PanelMod:2356
      //$LASTPOS=59002360;//kernel.PanelMod:2360
      colCount = 0;
      for (; colCount<splits.length ; colCount++) {
        {
          //$LASTPOS=59002420;//kernel.PanelMod:2420
          ctx.fillText(splits[colCount],x,y);
          //$LASTPOS=59002465;//kernel.PanelMod:2465
          y+=size;
        }
      }
      //$LASTPOS=59002486;//kernel.PanelMod:2486
      ctx.restore();
    },
    fiber$fillText :function _trc_PanelMod_f_fillText(_thread,text,x,y,size,align) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      var splits;
      var f;
      var colCount;
      
      
      _thread.enter(function _trc_PanelMod_ent_fillText(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=59002048;//kernel.PanelMod:2048
            _this.fiber$getContext(_thread);
            __pc=1;return;
          case 1:
            ctx=_thread.retVal;
            
            //$LASTPOS=59002075;//kernel.PanelMod:2075
            ctx.save();
            //$LASTPOS=59002092;//kernel.PanelMod:2092
            text=text+"";
            //$LASTPOS=59002111;//kernel.PanelMod:2111
            splits = text.split("\n");
            
            //$LASTPOS=59002197;//kernel.PanelMod:2197
            ctx.textAlign=align||"center";
            //$LASTPOS=59002236;//kernel.PanelMod:2236
            size=size||15;
            //$LASTPOS=59002256;//kernel.PanelMod:2256
            ctx.fillStyle=_this.fillStyle+"";
            //$LASTPOS=59002289;//kernel.PanelMod:2289
            f = ctx.font.replace(/^[0-9\.]+/,"");
            
            //$LASTPOS=59002334;//kernel.PanelMod:2334
            ctx.font=size+f;
            //$LASTPOS=59002356;//kernel.PanelMod:2356
            //$LASTPOS=59002360;//kernel.PanelMod:2360
            colCount = 0;
            for (; colCount<splits.length ; colCount++) {
              {
                //$LASTPOS=59002420;//kernel.PanelMod:2420
                ctx.fillText(splits[colCount],x,y);
                //$LASTPOS=59002465;//kernel.PanelMod:2465
                y+=size;
              }
            }
            //$LASTPOS=59002486;//kernel.PanelMod:2486
            ctx.restore();
            _thread.exit(_this);return;
          }
        }
      });
    },
    clearRect :function _trc_PanelMod_clearRect(clearX,clearY,clearW,clearH) {
      "use strict";
      var _this=this;
      var ctx;
      
      //$LASTPOS=59002551;//kernel.PanelMod:2551
      ctx = _this.getContext();
      
      //$LASTPOS=59002578;//kernel.PanelMod:2578
      ctx.save();
      //$LASTPOS=59002595;//kernel.PanelMod:2595
      ctx.clearRect(clearX||0,clearY||0,clearW||_this.width,clearH||_this.height);
      //$LASTPOS=59002665;//kernel.PanelMod:2665
      ctx.restore();
      //$LASTPOS=59002685;//kernel.PanelMod:2685
      if (arguments.length==0) {
        //$LASTPOS=59002710;//kernel.PanelMod:2710
        _this._drawn=false;
      }
    },
    fiber$clearRect :function _trc_PanelMod_f_clearRect(_thread,clearX,clearY,clearW,clearH) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      
      
      _thread.enter(function _trc_PanelMod_ent_clearRect(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=59002551;//kernel.PanelMod:2551
            _this.fiber$getContext(_thread);
            __pc=1;return;
          case 1:
            ctx=_thread.retVal;
            
            //$LASTPOS=59002578;//kernel.PanelMod:2578
            ctx.save();
            //$LASTPOS=59002595;//kernel.PanelMod:2595
            ctx.clearRect(clearX||0,clearY||0,clearW||_this.width,clearH||_this.height);
            //$LASTPOS=59002665;//kernel.PanelMod:2665
            ctx.restore();
            //$LASTPOS=59002685;//kernel.PanelMod:2685
            if (_arguments.length==0) {
              //$LASTPOS=59002710;//kernel.PanelMod:2710
              _this._drawn=false;
            }
            _thread.exit(_this);return;
          }
        }
      });
    },
    getPixel :function _trc_PanelMod_getPixel(getX,getY) {
      "use strict";
      var _this=this;
      var ctx;
      var imagedata;
      var colordata;
      
      
      //$LASTPOS=59002789;//kernel.PanelMod:2789
      if (typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY)) {
        //$LASTPOS=59002887;//kernel.PanelMod:2887
        ctx=_this.getContext();
        //$LASTPOS=59002914;//kernel.PanelMod:2914
        imagedata=ctx.getImageData(getX,getY,1,1);
        //$LASTPOS=59002966;//kernel.PanelMod:2966
        colordata=[imagedata.data[0],imagedata.data[1],imagedata.data[2],imagedata.data[3]];
        
      } else {
        //$LASTPOS=59003106;//kernel.PanelMod:3106
        colordata=[0,0,0,0];
        
      }
      return (colordata);
    },
    fiber$getPixel :function _trc_PanelMod_f_getPixel(_thread,getX,getY) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      var imagedata;
      var colordata;
      
      
      
      _thread.enter(function _trc_PanelMod_ent_getPixel(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=59002789;//kernel.PanelMod:2789
            if (!(typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY))) { __pc=2     ; break; }
            //$LASTPOS=59002887;//kernel.PanelMod:2887
            _this.fiber$getContext(_thread);
            __pc=1;return;
          case 1:
            ctx=_thread.retVal;
            
            //$LASTPOS=59002914;//kernel.PanelMod:2914
            imagedata=ctx.getImageData(getX,getY,1,1);
            //$LASTPOS=59002966;//kernel.PanelMod:2966
            colordata=[imagedata.data[0],imagedata.data[1],imagedata.data[2],imagedata.data[3]];
            __pc=3     ;break;
          case 2     :
            {
              //$LASTPOS=59003106;//kernel.PanelMod:3106
              colordata=[0,0,0,0];
            }
          case 3     :
            
            _thread.exit((colordata));return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    scroll :function _trc_PanelMod_scroll(scrollX,scrollY) {
      "use strict";
      var _this=this;
      var ctx;
      var imagedata;
      
      //$LASTPOS=59003193;//kernel.PanelMod:3193
      ctx = _this.getContext();
      
      //$LASTPOS=59003220;//kernel.PanelMod:3220
      ctx.save();
      //$LASTPOS=59003237;//kernel.PanelMod:3237
      imagedata = ctx.getImageData(0,0,_this.width,_this.height);
      
      //$LASTPOS=59003302;//kernel.PanelMod:3302
      _this.clearRect(0,0,_this.width,_this.height);
      //$LASTPOS=59003336;//kernel.PanelMod:3336
      ctx.putImageData(imagedata,- scrollX,- scrollY);
      //$LASTPOS=59003388;//kernel.PanelMod:3388
      ctx.restore();
    },
    fiber$scroll :function _trc_PanelMod_f_scroll(_thread,scrollX,scrollY) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      var imagedata;
      
      
      _thread.enter(function _trc_PanelMod_ent_scroll(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=59003193;//kernel.PanelMod:3193
            _this.fiber$getContext(_thread);
            __pc=1;return;
          case 1:
            ctx=_thread.retVal;
            
            //$LASTPOS=59003220;//kernel.PanelMod:3220
            ctx.save();
            //$LASTPOS=59003237;//kernel.PanelMod:3237
            imagedata = ctx.getImageData(0,0,_this.width,_this.height);
            
            //$LASTPOS=59003302;//kernel.PanelMod:3302
            _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height);
            __pc=2;return;
          case 2:
            
            //$LASTPOS=59003336;//kernel.PanelMod:3336
            ctx.putImageData(imagedata,- scrollX,- scrollY);
            //$LASTPOS=59003388;//kernel.PanelMod:3388
            ctx.restore();
            _thread.exit(_this);return;
          }
        }
      });
    },
    draw :function _trc_PanelMod_draw(ctx) {
      "use strict";
      var _this=this;
      var pImg;
      
      //$LASTPOS=59003424;//kernel.PanelMod:3424
      if (_this._drawn) {
        //$LASTPOS=59003445;//kernel.PanelMod:3445
        pImg = _this.canvas;
        
        //$LASTPOS=59003471;//kernel.PanelMod:3471
        ctx.save();
        //$LASTPOS=59003492;//kernel.PanelMod:3492
        if (_this.align=="left") {
          //$LASTPOS=59003524;//kernel.PanelMod:3524
          ctx.translate(_this.x+_this.width/2,_this.y+_this.height/2);
          
        } else {
          //$LASTPOS=59003576;//kernel.PanelMod:3576
          if (_this.align=="center") {
            //$LASTPOS=59003610;//kernel.PanelMod:3610
            ctx.translate(_this.x,_this.y);
            
          } else {
            //$LASTPOS=59003645;//kernel.PanelMod:3645
            if (_this.align=="right") {
              //$LASTPOS=59003678;//kernel.PanelMod:3678
              ctx.translate(_this.x-_this.width/2,_this.y-_this.height/2);
              
            }
          }
        }
        //$LASTPOS=59003735;//kernel.PanelMod:3735
        if (_this.rotation!=0) {
          //$LASTPOS=59003770;//kernel.PanelMod:3770
          ctx.rotate(_this.rotation/180*Math.PI);
          
        } else {
          //$LASTPOS=59003838;//kernel.PanelMod:3838
          ctx.rotate(_this.rotate/180*Math.PI);
          
        }
        //$LASTPOS=59003895;//kernel.PanelMod:3895
        if (typeof  _this.scaleY==="undefined") {
          //$LASTPOS=59003947;//kernel.PanelMod:3947
          ctx.scale(_this.scaleX,_this.scaleX);
          
        } else {
          //$LASTPOS=59004012;//kernel.PanelMod:4012
          ctx.scale(_this.scaleX,_this.scaleY);
          
        }
        //$LASTPOS=59004068;//kernel.PanelMod:4068
        ctx.globalAlpha=_this.alpha/255;
        //$LASTPOS=59004109;//kernel.PanelMod:4109
        ctx.drawImage(pImg,0,0,_this.width,_this.height,- _this.width/2,- _this.height/2,_this.width,_this.height);
        //$LASTPOS=59004213;//kernel.PanelMod:4213
        ctx.restore();
        
      }
    },
    drawSprite :function _trc_PanelMod_drawSprite(x,y,p,options) {
      "use strict";
      var _this=this;
      var pImg;
      var scaleX;
      var scaleY;
      var rotation;
      var ctx;
      
      //$LASTPOS=59004280;//kernel.PanelMod:4280
      pImg = Tonyu.globals.$imageList[p];
      
      //$LASTPOS=59004309;//kernel.PanelMod:4309
      if (! pImg) {
        return _this;
      }
      //$LASTPOS=59004333;//kernel.PanelMod:4333
      if (options===true) {
        //$LASTPOS=59004353;//kernel.PanelMod:4353
        options={f: true};
      }
      //$LASTPOS=59004376;//kernel.PanelMod:4376
      options=options||{};
      //$LASTPOS=59004402;//kernel.PanelMod:4402
      scaleX = typeof  (options.scaleX)==="number"?options.scaleX:1;
      
      //$LASTPOS=59004471;//kernel.PanelMod:4471
      scaleY = typeof  (options.scaleY)==="number"?options.scaleY:scaleX;
      
      //$LASTPOS=59004545;//kernel.PanelMod:4545
      rotation = options.rotation||options.angle||0;
      
      //$LASTPOS=59004599;//kernel.PanelMod:4599
      ctx = _this.context;
      
      //$LASTPOS=59004621;//kernel.PanelMod:4621
      if (options.f) {
        //$LASTPOS=59004636;//kernel.PanelMod:4636
        scaleX*=- 1;
      }
      //$LASTPOS=59004655;//kernel.PanelMod:4655
      ctx.save();
      //$LASTPOS=59004672;//kernel.PanelMod:4672
      ctx.translate(x,y);
      //$LASTPOS=59004697;//kernel.PanelMod:4697
      ctx.rotate(rotation/180*Math.PI);
      //$LASTPOS=59004736;//kernel.PanelMod:4736
      ctx.scale(scaleX,scaleY);
      //$LASTPOS=59004767;//kernel.PanelMod:4767
      ctx.drawImage(pImg.image,pImg.x,pImg.y,pImg.width,pImg.height,- pImg.width/2,- pImg.height/2,pImg.width,pImg.height);
      //$LASTPOS=59004907;//kernel.PanelMod:4907
      ctx.restore();
    },
    copy :function _trc_PanelMod_copy() {
      "use strict";
      var _this=this;
      var sx;
      var sy;
      var sw;
      var sh;
      var dx;
      var dy;
      var dw;
      var dh;
      var a;
      var srcPanel;
      var params;
      
      
      //$LASTPOS=59005145;//kernel.PanelMod:5145
      a = new Tonyu.classes.kernel.ArgParser(arguments);
      
      //$LASTPOS=59005182;//kernel.PanelMod:5182
      srcPanel = a.shift(Tonyu.classes.kernel.Panel)||_this;
      
      //$LASTPOS=59005224;//kernel.PanelMod:5224
      if (a.length<=4) {
        //$LASTPOS=59005252;//kernel.PanelMod:5252
        dx=a.shift();
        //$LASTPOS=59005275;//kernel.PanelMod:5275
        dy=a.shift();
        //$LASTPOS=59005298;//kernel.PanelMod:5298
        if (a.length==0) {
          //$LASTPOS=59005330;//kernel.PanelMod:5330
          _this.context.drawImage(srcPanel.image,dx,dy);
          
        } else {
          //$LASTPOS=59005403;//kernel.PanelMod:5403
          dw=a.shift();
          //$LASTPOS=59005430;//kernel.PanelMod:5430
          dh=a.shift();
          //$LASTPOS=59005457;//kernel.PanelMod:5457
          if (dw*dh!=0) {
            //$LASTPOS=59005490;//kernel.PanelMod:5490
            _this.context.drawImage(srcPanel.image,dx,dy,dw,dh);
            
          }
          
        }
        
      } else {
        //$LASTPOS=59005586;//kernel.PanelMod:5586
        sx=a.shift();
        //$LASTPOS=59005609;//kernel.PanelMod:5609
        sy=a.shift();
        //$LASTPOS=59005632;//kernel.PanelMod:5632
        sw=a.shift();
        //$LASTPOS=59005655;//kernel.PanelMod:5655
        sh=a.shift();
        //$LASTPOS=59005678;//kernel.PanelMod:5678
        dx=a.shift();
        //$LASTPOS=59005701;//kernel.PanelMod:5701
        if (typeof  dx==="object") {
          //$LASTPOS=59005742;//kernel.PanelMod:5742
          params = dx;
          
          
        }
        //$LASTPOS=59005828;//kernel.PanelMod:5828
        dy=a.shift();
        //$LASTPOS=59005851;//kernel.PanelMod:5851
        dw=a.shift()||sw;
        //$LASTPOS=59005880;//kernel.PanelMod:5880
        dh=a.shift()||sh;
        //$LASTPOS=59005959;//kernel.PanelMod:5959
        if (sw*sh*dw*dh!=0) {
          //$LASTPOS=59005994;//kernel.PanelMod:5994
          _this.context.drawImage(srcPanel.image,sx,sy,sw,sh,dx,dy,dw,dh);
          
        }
        
      }
    },
    drawLine :function _trc_PanelMod_drawLine(x,y,dx,dy) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59006110;//kernel.PanelMod:6110
      if (dx==null&&dy==null) {
        //$LASTPOS=59006147;//kernel.PanelMod:6147
        if (x==null&&y==null) {
          //$LASTPOS=59006186;//kernel.PanelMod:6186
          _this.px=null;
          //$LASTPOS=59006194;//kernel.PanelMod:6194
          _this.py=null;
          return _this;
          
        }
        //$LASTPOS=59006230;//kernel.PanelMod:6230
        if (_this.px==null&&_this.py==null) {
          //$LASTPOS=59006271;//kernel.PanelMod:6271
          _this.px=x;
          //$LASTPOS=59006276;//kernel.PanelMod:6276
          _this.py=y;
          return _this;
          
        }
        //$LASTPOS=59006309;//kernel.PanelMod:6309
        dx=x;
        //$LASTPOS=59006314;//kernel.PanelMod:6314
        dy=y;
        //$LASTPOS=59006319;//kernel.PanelMod:6319
        x=_this.px;
        //$LASTPOS=59006324;//kernel.PanelMod:6324
        y=_this.py;
        //$LASTPOS=59006329;//kernel.PanelMod:6329
        _this.px=dx;
        //$LASTPOS=59006335;//kernel.PanelMod:6335
        _this.py=dy;
        
      }
      //$LASTPOS=59006354;//kernel.PanelMod:6354
      _this.context.beginPath();
      //$LASTPOS=59006380;//kernel.PanelMod:6380
      _this.context.moveTo(x,y);
      //$LASTPOS=59006406;//kernel.PanelMod:6406
      _this.context.lineTo(dx,dy);
      //$LASTPOS=59006434;//kernel.PanelMod:6434
      _this.context.stroke();
    },
    fiber$drawLine :function _trc_PanelMod_f_drawLine(_thread,x,y,dx,dy) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=59006110;//kernel.PanelMod:6110
      if (dx==null&&dy==null) {
        //$LASTPOS=59006147;//kernel.PanelMod:6147
        if (x==null&&y==null) {
          //$LASTPOS=59006186;//kernel.PanelMod:6186
          _this.px=null;
          //$LASTPOS=59006194;//kernel.PanelMod:6194
          _this.py=null;
          _thread.retVal=_this;return;
          
          
        }
        //$LASTPOS=59006230;//kernel.PanelMod:6230
        if (_this.px==null&&_this.py==null) {
          //$LASTPOS=59006271;//kernel.PanelMod:6271
          _this.px=x;
          //$LASTPOS=59006276;//kernel.PanelMod:6276
          _this.py=y;
          _thread.retVal=_this;return;
          
          
        }
        //$LASTPOS=59006309;//kernel.PanelMod:6309
        dx=x;
        //$LASTPOS=59006314;//kernel.PanelMod:6314
        dy=y;
        //$LASTPOS=59006319;//kernel.PanelMod:6319
        x=_this.px;
        //$LASTPOS=59006324;//kernel.PanelMod:6324
        y=_this.py;
        //$LASTPOS=59006329;//kernel.PanelMod:6329
        _this.px=dx;
        //$LASTPOS=59006335;//kernel.PanelMod:6335
        _this.py=dy;
        
      }
      //$LASTPOS=59006354;//kernel.PanelMod:6354
      _this.context.beginPath();
      //$LASTPOS=59006380;//kernel.PanelMod:6380
      _this.context.moveTo(x,y);
      //$LASTPOS=59006406;//kernel.PanelMod:6406
      _this.context.lineTo(dx,dy);
      //$LASTPOS=59006434;//kernel.PanelMod:6434
      _this.context.stroke();
      
      _thread.retVal=_this;return;
    },
    slicePattern :function _trc_PanelMod_slicePattern(x,y,width,height) {
      "use strict";
      var _this=this;
      
      return {image: _this.canvas,x: x,y: y,width: width,height: height};
    },
    fiber$slicePattern :function _trc_PanelMod_f_slicePattern(_thread,x,y,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal={image: _this.canvas,x: x,y: y,width: width,height: height};return;
      
      
      _thread.retVal=_this;return;
    },
    addPattern :function _trc_PanelMod_addPattern(x,y,width,height) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59006576;//kernel.PanelMod:6576
      Tonyu.globals.$imageList.push(_this.slicePattern(x,y,width,height));
      return Tonyu.globals.$imageList.length-1;
    },
    fiber$addPattern :function _trc_PanelMod_f_addPattern(_thread,x,y,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=59006576;//kernel.PanelMod:6576
      Tonyu.globals.$imageList.push(_this.slicePattern(x,y,width,height));
      _thread.retVal=Tonyu.globals.$imageList.length-1;return;
      
      
      _thread.retVal=_this;return;
    },
    getImageData :function _trc_PanelMod_getImageData(x,y,width,height) {
      "use strict";
      var _this=this;
      
      return _this.context.getImageData(x,y,width,height);
    },
    fiber$getImageData :function _trc_PanelMod_f_getImageData(_thread,x,y,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.context.getImageData(x,y,width,height);return;
      
      
      _thread.retVal=_this;return;
    },
    putImageData :function _trc_PanelMod_putImageData(data,x,y) {
      "use strict";
      var _this=this;
      
      return _this.context.putImageData(data,x,y);
    },
    fiber$putImageData :function _trc_PanelMod_f_putImageData(_thread,data,x,y) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.context.putImageData(data,x,y);return;
      
      
      _thread.retVal=_this;return;
    },
    save :function _trc_PanelMod_save(fn) {
      "use strict";
      var _this=this;
      var url;
      
      //$LASTPOS=59006845;//kernel.PanelMod:6845
      url = _this.canvas.toDataURL();
      
      //$LASTPOS=59006878;//kernel.PanelMod:6878
      if (typeof  fn==="string") {
        //$LASTPOS=59006904;//kernel.PanelMod:6904
        fn=_this.file(fn);
      }
      return fn.text(url);
    },
    fiber$save :function _trc_PanelMod_f_save(_thread,fn) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var url;
      
      //$LASTPOS=59006845;//kernel.PanelMod:6845
      url = _this.canvas.toDataURL();
      
      
      _thread.enter(function _trc_PanelMod_ent_save(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=59006878;//kernel.PanelMod:6878
            if (!(typeof  fn==="string")) { __pc=2     ; break; }
            //$LASTPOS=59006904;//kernel.PanelMod:6904
            _this.fiber$file(_thread, fn);
            __pc=1;return;
          case 1:
            fn=_thread.retVal;
            
          case 2     :
            
            _thread.exit(fn.text(url));return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    load :function _trc_PanelMod_load(fn) {
      "use strict";
      var _this=this;
      var d;
      var url;
      var element;
      
      //$LASTPOS=59006966;//kernel.PanelMod:6966
      if (typeof  fn==="string") {
        //$LASTPOS=59006992;//kernel.PanelMod:6992
        fn=_this.file(fn);
      }
      //$LASTPOS=59007010;//kernel.PanelMod:7010
      d = new $.Deferred();
      
      //$LASTPOS=59007039;//kernel.PanelMod:7039
      url = fn.text();
      
      //$LASTPOS=59007063;//kernel.PanelMod:7063
      element = $("<img>").css({display: "none"}).appendTo("body");
      
      //$LASTPOS=59007129;//kernel.PanelMod:7129
      element.on("load",(function anonymous_7148() {
        var img;
        var width;
        var height;
        
        //$LASTPOS=59007160;//kernel.PanelMod:7160
        img = new Image();
        
        //$LASTPOS=59007192;//kernel.PanelMod:7192
        img.src=element.attr('src');
        //$LASTPOS=59007232;//kernel.PanelMod:7232
        width = img.width;
        
        //$LASTPOS=59007264;//kernel.PanelMod:7264
        height = img.height;
        
        //$LASTPOS=59007330;//kernel.PanelMod:7330
        _this.resize(width,height);
        //$LASTPOS=59007361;//kernel.PanelMod:7361
        _this.context.drawImage(img,0,0);
        //$LASTPOS=59007399;//kernel.PanelMod:7399
        d.resolve(_this);
      }));
      //$LASTPOS=59007429;//kernel.PanelMod:7429
      element.attr({src: url});
      return d.promise();
    },
    fiber$load :function _trc_PanelMod_f_load(_thread,fn) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var d;
      var url;
      var element;
      
      
      _thread.enter(function _trc_PanelMod_ent_load(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=59006966;//kernel.PanelMod:6966
            if (!(typeof  fn==="string")) { __pc=2     ; break; }
            //$LASTPOS=59006992;//kernel.PanelMod:6992
            _this.fiber$file(_thread, fn);
            __pc=1;return;
          case 1:
            fn=_thread.retVal;
            
          case 2     :
            
            //$LASTPOS=59007010;//kernel.PanelMod:7010
            d = new $.Deferred();
            
            //$LASTPOS=59007039;//kernel.PanelMod:7039
            url = fn.text();
            
            //$LASTPOS=59007063;//kernel.PanelMod:7063
            element = $("<img>").css({display: "none"}).appendTo("body");
            
            //$LASTPOS=59007129;//kernel.PanelMod:7129
            element.on("load",(function anonymous_7148() {
              var img;
              var width;
              var height;
              
              //$LASTPOS=59007160;//kernel.PanelMod:7160
              img = new Image();
              
              //$LASTPOS=59007192;//kernel.PanelMod:7192
              img.src=element.attr('src');
              //$LASTPOS=59007232;//kernel.PanelMod:7232
              width = img.width;
              
              //$LASTPOS=59007264;//kernel.PanelMod:7264
              height = img.height;
              
              //$LASTPOS=59007330;//kernel.PanelMod:7330
              _this.resize(width,height);
              //$LASTPOS=59007361;//kernel.PanelMod:7361
              _this.context.drawImage(img,0,0);
              //$LASTPOS=59007399;//kernel.PanelMod:7399
              d.resolve(_this);
            }));
            //$LASTPOS=59007429;//kernel.PanelMod:7429
            element.attr({src: url});
            _thread.exit(d.promise());return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    __setter__imageSmoothingEnabled :function _trc_PanelMod___setter__imageSmoothingEnabled(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59007513;//kernel.PanelMod:7513
      if (typeof  _this.context.msImageSmoothingEnabled==="boolean") {
        //$LASTPOS=59007580;//kernel.PanelMod:7580
        _this.context.msImageSmoothingEnabled=v;
        
      } else {
        //$LASTPOS=59007638;//kernel.PanelMod:7638
        _this.context.imageSmoothingEnabled=v;
        
      }
    },
    __getter__imageSmoothingEnabled :function _trc_PanelMod___getter__imageSmoothingEnabled() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=59007712;//kernel.PanelMod:7712
      if (typeof  _this.context.msImageSmoothingEnabled==="boolean") {
        return _this.context.msImageSmoothingEnabled;
        
      } else {
        return _this.context.imageSmoothingEnabled;
        
      }
    },
    replaceColor :function _trc_PanelMod_replaceColor() {
      "use strict";
      var _this=this;
      var a;
      var top;
      var left;
      var w;
      var h;
      var func;
      var ctx;
      var data;
      var i;
      var j;
      
      //$LASTPOS=59007914;//kernel.PanelMod:7914
      a = new Tonyu.classes.kernel.ArgParser(arguments);
      
      //$LASTPOS=59007951;//kernel.PanelMod:7951
      top = 0;
      left = 0;
      
      //$LASTPOS=59007974;//kernel.PanelMod:7974
      w = _this.width;
      h = _this.height;
      
      //$LASTPOS=59008002;//kernel.PanelMod:8002
      if (a.length>=4) {
        //$LASTPOS=59008030;//kernel.PanelMod:8030
        left=a.shift();
        //$LASTPOS=59008055;//kernel.PanelMod:8055
        top=a.shift();
        //$LASTPOS=59008079;//kernel.PanelMod:8079
        w=a.shift();
        //$LASTPOS=59008101;//kernel.PanelMod:8101
        h=a.shift();
        
      }
      //$LASTPOS=59008126;//kernel.PanelMod:8126
      func = a.shift();
      
      //$LASTPOS=59008151;//kernel.PanelMod:8151
      if (typeof  func!=="function") {
        //$LASTPOS=59008192;//kernel.PanelMod:8192
        ctx = _this.context;
        
        //$LASTPOS=59008218;//kernel.PanelMod:8218
        ctx.save();
        //$LASTPOS=59008239;//kernel.PanelMod:8239
        ctx.beginPath();
        //$LASTPOS=59008265;//kernel.PanelMod:8265
        ctx.moveTo(left,top);
        //$LASTPOS=59008296;//kernel.PanelMod:8296
        ctx.lineTo(left+w,top);
        //$LASTPOS=59008329;//kernel.PanelMod:8329
        ctx.lineTo(left+w,top+h);
        //$LASTPOS=59008364;//kernel.PanelMod:8364
        ctx.lineTo(left,top+h);
        //$LASTPOS=59008397;//kernel.PanelMod:8397
        ctx.closePath();
        //$LASTPOS=59008423;//kernel.PanelMod:8423
        ctx.clip();
        //$LASTPOS=59008444;//kernel.PanelMod:8444
        ctx.globalCompositeOperation="source-in";
        //$LASTPOS=59008495;//kernel.PanelMod:8495
        if (func) {
          //$LASTPOS=59008505;//kernel.PanelMod:8505
          _this.fillStyle=func;
        }
        //$LASTPOS=59008530;//kernel.PanelMod:8530
        ctx.fillRect(left,top,w,h);
        //$LASTPOS=59008567;//kernel.PanelMod:8567
        ctx.restore();
        return _this;
        
      }
      //$LASTPOS=59008611;//kernel.PanelMod:8611
      data = _this.getImageData(left,top,w,h);
      
      //$LASTPOS=59008653;//kernel.PanelMod:8653
      //$LASTPOS=59008658;//kernel.PanelMod:8658
      i = 0;
      for (; i<h ; i++) {
        {
          //$LASTPOS=59008686;//kernel.PanelMod:8686
          //$LASTPOS=59008691;//kernel.PanelMod:8691
          j = 0;
          for (; j<w ; j++) {
            {
              //$LASTPOS=59008723;//kernel.PanelMod:8723
              func(new Tonyu.classes.kernel.Color(data,j,i),left+j,top+i);
            }
          }
        }
      }
      //$LASTPOS=59008786;//kernel.PanelMod:8786
      _this.putImageData(data,left,top);
    },
    fiber$replaceColor :function _trc_PanelMod_f_replaceColor(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      var top;
      var left;
      var w;
      var h;
      var func;
      var ctx;
      var data;
      var i;
      var j;
      
      //$LASTPOS=59007914;//kernel.PanelMod:7914
      a = new Tonyu.classes.kernel.ArgParser(_arguments);
      
      //$LASTPOS=59007951;//kernel.PanelMod:7951
      top = 0;
      left = 0;
      
      //$LASTPOS=59007974;//kernel.PanelMod:7974
      w = _this.width;
      h = _this.height;
      
      //$LASTPOS=59008002;//kernel.PanelMod:8002
      if (a.length>=4) {
        //$LASTPOS=59008030;//kernel.PanelMod:8030
        left=a.shift();
        //$LASTPOS=59008055;//kernel.PanelMod:8055
        top=a.shift();
        //$LASTPOS=59008079;//kernel.PanelMod:8079
        w=a.shift();
        //$LASTPOS=59008101;//kernel.PanelMod:8101
        h=a.shift();
        
      }
      //$LASTPOS=59008126;//kernel.PanelMod:8126
      func = a.shift();
      
      //$LASTPOS=59008151;//kernel.PanelMod:8151
      if (typeof  func!=="function") {
        //$LASTPOS=59008192;//kernel.PanelMod:8192
        ctx = _this.context;
        
        //$LASTPOS=59008218;//kernel.PanelMod:8218
        ctx.save();
        //$LASTPOS=59008239;//kernel.PanelMod:8239
        ctx.beginPath();
        //$LASTPOS=59008265;//kernel.PanelMod:8265
        ctx.moveTo(left,top);
        //$LASTPOS=59008296;//kernel.PanelMod:8296
        ctx.lineTo(left+w,top);
        //$LASTPOS=59008329;//kernel.PanelMod:8329
        ctx.lineTo(left+w,top+h);
        //$LASTPOS=59008364;//kernel.PanelMod:8364
        ctx.lineTo(left,top+h);
        //$LASTPOS=59008397;//kernel.PanelMod:8397
        ctx.closePath();
        //$LASTPOS=59008423;//kernel.PanelMod:8423
        ctx.clip();
        //$LASTPOS=59008444;//kernel.PanelMod:8444
        ctx.globalCompositeOperation="source-in";
        //$LASTPOS=59008495;//kernel.PanelMod:8495
        if (func) {
          //$LASTPOS=59008505;//kernel.PanelMod:8505
          _this.fillStyle=func;
        }
        //$LASTPOS=59008530;//kernel.PanelMod:8530
        ctx.fillRect(left,top,w,h);
        //$LASTPOS=59008567;//kernel.PanelMod:8567
        ctx.restore();
        _thread.retVal=_this;return;
        
        
      }
      
      _thread.enter(function _trc_PanelMod_ent_replaceColor(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=59008611;//kernel.PanelMod:8611
            _this.fiber$getImageData(_thread, left, top, w, h);
            __pc=1;return;
          case 1:
            data=_thread.retVal;
            
            //$LASTPOS=59008653;//kernel.PanelMod:8653
            //$LASTPOS=59008658;//kernel.PanelMod:8658
            i = 0;
            for (; i<h ; i++) {
              {
                //$LASTPOS=59008686;//kernel.PanelMod:8686
                //$LASTPOS=59008691;//kernel.PanelMod:8691
                j = 0;
                for (; j<w ; j++) {
                  {
                    //$LASTPOS=59008723;//kernel.PanelMod:8723
                    func(new Tonyu.classes.kernel.Color(data,j,i),left+j,top+i);
                  }
                }
              }
            }
            //$LASTPOS=59008786;//kernel.PanelMod:8786
            _this.fiber$putImageData(_thread, data, left, top);
            __pc=2;return;
          case 2:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"initPanelMod":{"nowait":false},"setPanel":{"nowait":false},"resize":{"nowait":false},"getContext":{"nowait":false},"__getter__context":{"nowait":true},"__getter__image":{"nowait":true},"setFillStyle":{"nowait":false},"__getter__fillStyle":{"nowait":true},"__setter__fillStyle":{"nowait":true},"__setter__strokeStyle":{"nowait":true},"__setter__lineWidth":{"nowait":true},"fillCircle":{"nowait":false},"fillRect":{"nowait":false},"fillText":{"nowait":false},"clearRect":{"nowait":false},"getPixel":{"nowait":false},"scroll":{"nowait":false},"draw":{"nowait":true},"drawSprite":{"nowait":true},"copy":{"nowait":true},"drawLine":{"nowait":false},"slicePattern":{"nowait":false},"addPattern":{"nowait":false},"getImageData":{"nowait":false},"putImageData":{"nowait":false},"save":{"nowait":false},"load":{"nowait":false},"__setter__imageSmoothingEnabled":{"nowait":true},"__getter__imageSmoothingEnabled":{"nowait":true},"replaceColor":{"nowait":false}},"fields":{"canvas":{},"_drawn":{},"_fillStyle":{},"px":{},"py":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.PlayMod',
  shortName: 'PlayMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.SchedulerMod,Tonyu.classes.kernel.LifeCycleMod],
  methods: {
    main :function _trc_PlayMod_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=60000063;//kernel.PlayMod:63
      "field strict";
      
    },
    fiber$main :function _trc_PlayMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=60000063;//kernel.PlayMod:63
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    initMML :function _trc_PlayMod_initMML() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=60000129;//kernel.PlayMod:129
      if (_this.mmlInited) {
        return _this;
      }
      //$LASTPOS=60000157;//kernel.PlayMod:157
      _this.mmlInited=true;
      //$LASTPOS=60000178;//kernel.PlayMod:178
      Tonyu.globals.$currentProject.requestPlugin("timbre");
      //$LASTPOS=60000224;//kernel.PlayMod:224
      if (! Tonyu.globals.$MMLS) {
        //$LASTPOS=60000246;//kernel.PlayMod:246
        Tonyu.globals.$MMLS={};
        //$LASTPOS=60000264;//kernel.PlayMod:264
        Tonyu.globals.$WaveTable=new Tonyu.classes.kernel.WaveTable;
        //$LASTPOS=60000298;//kernel.PlayMod:298
        Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseMML));
        
      }
      //$LASTPOS=60000340;//kernel.PlayMod:340
      _this.on("die",(function anonymous_350() {
        
        //$LASTPOS=60000356;//kernel.PlayMod:356
        _this.play().stop();
      }));
    },
    releaseMML :function _trc_PlayMod_releaseMML() {
      "use strict";
      var _this=this;
      var k;
      var v;
      var _it_532;
      
      //$LASTPOS=60000406;//kernel.PlayMod:406
      if (Tonyu.globals.$MMLS) {
        //$LASTPOS=60000427;//kernel.PlayMod:427
        _it_532=Tonyu.iterator(Tonyu.globals.$MMLS,2);
        while(_it_532.next()) {
          k=_it_532[0];
          v=_it_532[1];
          
          //$LASTPOS=60000463;//kernel.PlayMod:463
          v.stop();
          
        }
        //$LASTPOS=60000491;//kernel.PlayMod:491
        Tonyu.globals.$MMLS=null;
        
      }
      //$LASTPOS=60000515;//kernel.PlayMod:515
      if (Tonyu.globals.$WaveTable) {
        //$LASTPOS=60000541;//kernel.PlayMod:541
        Tonyu.globals.$WaveTable.stop();
        //$LASTPOS=60000568;//kernel.PlayMod:568
        Tonyu.globals.$WaveTable=null;
        
      }
    },
    play :function _trc_PlayMod_play() {
      "use strict";
      var _this=this;
      var mmls;
      var i;
      
      //$LASTPOS=60000611;//kernel.PlayMod:611
      _this.initMML();
      //$LASTPOS=60000627;//kernel.PlayMod:627
      if (! _this._mml) {
        //$LASTPOS=60000638;//kernel.PlayMod:638
        _this._mml=new Tonyu.classes.kernel.MML;
      }
      //$LASTPOS=60000657;//kernel.PlayMod:657
      if (_this.isDead()||arguments.length==0) {
        return _this._mml;
      }
      //$LASTPOS=60000712;//kernel.PlayMod:712
      mmls = [];
      
      //$LASTPOS=60000730;//kernel.PlayMod:730
      //$LASTPOS=60000735;//kernel.PlayMod:735
      i = 0;
      for (; i<arguments.length ; i++) {
        {
          //$LASTPOS=60000780;//kernel.PlayMod:780
          mmls.push(arguments[i]);
        }
      }
      //$LASTPOS=60000817;//kernel.PlayMod:817
      _this._mml.play(mmls);
      //$LASTPOS=60000839;//kernel.PlayMod:839
      while (_this._mml.bufferCount()>2) {
        //$LASTPOS=60000879;//kernel.PlayMod:879
        _this.update();
        
      }
      return _this._mml;
    },
    fiber$play :function _trc_PlayMod_f_play(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var mmls;
      var i;
      
      //$LASTPOS=60000611;//kernel.PlayMod:611
      _this.initMML();
      //$LASTPOS=60000627;//kernel.PlayMod:627
      if (! _this._mml) {
        //$LASTPOS=60000638;//kernel.PlayMod:638
        _this._mml=new Tonyu.classes.kernel.MML;
      }
      //$LASTPOS=60000657;//kernel.PlayMod:657
      if (_this.isDead()||_arguments.length==0) {
        _thread.retVal=_this._mml;return;
        
      }
      //$LASTPOS=60000712;//kernel.PlayMod:712
      mmls = [];
      
      //$LASTPOS=60000730;//kernel.PlayMod:730
      //$LASTPOS=60000735;//kernel.PlayMod:735
      i = 0;
      for (; i<_arguments.length ; i++) {
        {
          //$LASTPOS=60000780;//kernel.PlayMod:780
          mmls.push(_arguments[i]);
        }
      }
      //$LASTPOS=60000817;//kernel.PlayMod:817
      _this._mml.play(mmls);
      
      _thread.enter(function _trc_PlayMod_ent_play(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=60000839;//kernel.PlayMod:839
          case 1:
            if (!(_this._mml.bufferCount()>2)) { __pc=3     ; break; }
            //$LASTPOS=60000879;//kernel.PlayMod:879
            _this.fiber$update(_thread);
            __pc=2;return;
          case 2:
            
            __pc=1;break;
          case 3     :
            
            _thread.exit(_this._mml);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    playSE :function _trc_PlayMod_playSE() {
      "use strict";
      var _this=this;
      var mml;
      var mmls;
      var i;
      
      //$LASTPOS=60000942;//kernel.PlayMod:942
      _this.initMML();
      //$LASTPOS=60000958;//kernel.PlayMod:958
      mml = new Tonyu.classes.kernel.MML;
      
      //$LASTPOS=60000980;//kernel.PlayMod:980
      mmls = [];
      
      //$LASTPOS=60000998;//kernel.PlayMod:998
      //$LASTPOS=60001003;//kernel.PlayMod:1003
      i = 0;
      for (; i<arguments.length ; i++) {
        {
          //$LASTPOS=60001048;//kernel.PlayMod:1048
          mmls.push(arguments[i]);
        }
      }
      //$LASTPOS=60001085;//kernel.PlayMod:1085
      mml.play(mmls);
      return mml;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"initMML":{"nowait":true},"releaseMML":{"nowait":true},"play":{"nowait":false},"playSE":{"nowait":true}},"fields":{"mmlInited":{},"_mml":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.InputMod',
  shortName: 'InputMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.QueryMod],
  methods: {
    main :function _trc_InputMod_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=61000045;//kernel.InputMod:45
      "field strict";
    },
    fiber$main :function _trc_InputMod_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=61000045;//kernel.InputMod:45
      "field strict";
      
      _thread.retVal=_this;return;
    },
    getkey :function _trc_InputMod_getkey(k) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$Keys.getkey(k);
    },
    waitInputDevice :function _trc_InputMod_waitInputDevice(fl) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=61000233;//kernel.InputMod:233
      _this.runAsync((function anonymous_242(f) {
        
        //$LASTPOS=61000257;//kernel.InputMod:257
        Tonyu.globals.$InputDevice.addOnetimeListener(f);
      }));
    },
    fiber$waitInputDevice :function _trc_InputMod_f_waitInputDevice(_thread,fl) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_InputMod_ent_waitInputDevice(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=61000233;//kernel.InputMod:233
            _this.fiber$runAsync(_thread, (function anonymous_242(f) {
              
              //$LASTPOS=61000257;//kernel.InputMod:257
              Tonyu.globals.$InputDevice.addOnetimeListener(f);
            }));
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    findTouch :function _trc_InputMod_findTouch(params) {
      "use strict";
      var _this=this;
      var r;
      var res;
      
      //$LASTPOS=61000338;//kernel.InputMod:338
      if (typeof  params==="number") {
        //$LASTPOS=61000368;//kernel.InputMod:368
        params={scale: params};
      }
      //$LASTPOS=61000396;//kernel.InputMod:396
      params=params||{};
      
      //$LASTPOS=61000432;//kernel.InputMod:432
      if (params.width&&params.height) {
        //$LASTPOS=61000478;//kernel.InputMod:478
        r={x: _this.x,y: _this.y,width: params.width,height: params.height};
        
      } else {
        //$LASTPOS=61000551;//kernel.InputMod:551
        params.scale=params.scale||2;
        //$LASTPOS=61000590;//kernel.InputMod:590
        r=_this.getCrashShape();
        //$LASTPOS=61000639;//kernel.InputMod:639
        if (! r) {
          return null;
        }
        //$LASTPOS=61000669;//kernel.InputMod:669
        r={x: _this.x,y: _this.y,width: r.width*params.scale,height: r.height*params.scale};
        
      }
      //$LASTPOS=61000810;//kernel.InputMod:810
      res = Tonyu.globals.$touches.findTouch((function anonymous_837(t) {
        var tt;
        
        //$LASTPOS=61000853;//kernel.InputMod:853
        if (params.pickup||t.touched==1) {
          //$LASTPOS=61000903;//kernel.InputMod:903
          tt = Tonyu.globals.$Screen.convert(t,_this.layer);
          
          //$LASTPOS=61000949;//kernel.InputMod:949
          if (Math.abs(r.x-tt.x)<r.width/2&&Math.abs(r.y-tt.y)<r.height/2) {
            return true;
            
          }
          
        }
      }));
      
      //$LASTPOS=61001104;//kernel.InputMod:1104
      if (res) {
        //$LASTPOS=61001124;//kernel.InputMod:1124
        res.layer=_this.layer;
        return res;
        
      }
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"getkey":{"nowait":true},"waitInputDevice":{"nowait":false},"findTouch":{"nowait":true}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.BaseActor',
  shortName: 'BaseActor',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.ThreadGroupMod,Tonyu.classes.kernel.EventHandlerCaller,Tonyu.classes.kernel.DialogMod,Tonyu.classes.kernel.FileMod,Tonyu.classes.kernel.AnimMod,Tonyu.classes.kernel.SchedulerMod,Tonyu.classes.kernel.QueryMod,Tonyu.classes.kernel.InputMod,Tonyu.classes.kernel.LifeCycleMod,Tonyu.classes.kernel.SpriteMod,Tonyu.classes.kernel.ParallelMod,Tonyu.classes.kernel.PlayMod,Tonyu.classes.kernel.ParallelMod],
  methods: {
    main :function _trc_BaseActor_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=62000198;//kernel.BaseActor:198
      "field strict";
    },
    fiber$main :function _trc_BaseActor_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=62000198;//kernel.BaseActor:198
      "field strict";
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_BaseActor_initialize(x,y,p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=62000270;//kernel.BaseActor:270
      if (typeof  x=="object") {
        //$LASTPOS=62000294;//kernel.BaseActor:294
        Tonyu.extend(_this,x);
      } else {
        //$LASTPOS=62000326;//kernel.BaseActor:326
        if (typeof  x=="number") {
          //$LASTPOS=62000361;//kernel.BaseActor:361
          _this.x=x;
          //$LASTPOS=62000380;//kernel.BaseActor:380
          _this.y=y;
          //$LASTPOS=62000399;//kernel.BaseActor:399
          _this.p=p;
          
        }
      }
      //$LASTPOS=62000421;//kernel.BaseActor:421
      _this.initSchedulerMod();
      //$LASTPOS=62000446;//kernel.BaseActor:446
      _this.layer=_this.layer||_this.defaultLayer;
      //$LASTPOS=62000478;//kernel.BaseActor:478
      if (_this.layer.group instanceof Tonyu.classes.kernel.SpriteGroup) {
        //$LASTPOS=62000518;//kernel.BaseActor:518
        _this.layer=_this.layer.group;
      }
      //$LASTPOS=62000542;//kernel.BaseActor:542
      _this.crashScale=1;
      //$LASTPOS=62000561;//kernel.BaseActor:561
      _this.initSpriteMod();
      //$LASTPOS=62000583;//kernel.BaseActor:583
      if (Tonyu.runMode) {
        //$LASTPOS=62000602;//kernel.BaseActor:602
        _this.addToLayer();
      }
      //$LASTPOS=62000621;//kernel.BaseActor:621
      _this.initAnimMod();
    },
    extend :function _trc_BaseActor_extend(obj) {
      "use strict";
      var _this=this;
      
      return Tonyu.extend(_this,obj);
    },
    print :function _trc_BaseActor_print(pt) {
      "use strict";
      var _this=this;
      var mergedArg;
      var argCount;
      var splits;
      var printCount;
      
      //$LASTPOS=62000729;//kernel.BaseActor:729
      Tonyu.globals.$_printCount++;
      //$LASTPOS=62000745;//kernel.BaseActor:745
      if (Tonyu.globals.$_printCount>Tonyu.globals.$printLimit) {
        throw new Error("printをしすぎています.");
        
      }
      //$LASTPOS=62000815;//kernel.BaseActor:815
      console.log.apply(console,arguments);
      //$LASTPOS=62000858;//kernel.BaseActor:858
      mergedArg = "";
      
      //$LASTPOS=62000881;//kernel.BaseActor:881
      if (Tonyu.globals.$consolePanel) {
        //$LASTPOS=62000909;//kernel.BaseActor:909
        //$LASTPOS=62000913;//kernel.BaseActor:913
        argCount = 0;
        for (; argCount<arguments.length ; argCount++) {
          {
            //$LASTPOS=62000980;//kernel.BaseActor:980
            mergedArg=mergedArg+arguments[argCount]+" ";
          }
        }
        //$LASTPOS=62001045;//kernel.BaseActor:1045
        splits = mergedArg.split("\n");
        
        //$LASTPOS=62001088;//kernel.BaseActor:1088
        //$LASTPOS=62001092;//kernel.BaseActor:1092
        printCount = 0;
        for (; printCount<splits.length ; printCount++) {
          {
            //$LASTPOS=62001162;//kernel.BaseActor:1162
            Tonyu.globals.$consolePanel.scroll(0,20);
            //$LASTPOS=62001203;//kernel.BaseActor:1203
            Tonyu.globals.$consolePanel.setFillStyle("white");
            //$LASTPOS=62001253;//kernel.BaseActor:1253
            Tonyu.globals.$consolePanel.fillText(splits[printCount],0,Tonyu.globals.$consolePrintY,20,"left");
          }
        }
        
      }
    },
    loadPage :function _trc_BaseActor_loadPage() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=62001373;//kernel.BaseActor:1373
      Tonyu.globals.$Boot.loadPage.apply(Tonyu.globals.$Boot,arguments);
    },
    __getter__defaultLayer :function _trc_BaseActor___getter__defaultLayer() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$mainLayer;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"extend":{"nowait":true},"print":{"nowait":true},"loadPage":{"nowait":true},"__getter__defaultLayer":{"nowait":true}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.NoviceActor',
  shortName: 'NoviceActor',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.BaseActor,
  includes: [],
  methods: {
    main :function _trc_NoviceActor_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_NoviceActor_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    sleep :function _trc_NoviceActor_sleep(n) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=63000054;//kernel.NoviceActor:54
      if (! n) {
        //$LASTPOS=63000061;//kernel.NoviceActor:61
        n=1;
      }
      //$LASTPOS=63000071;//kernel.NoviceActor:71
      //$LASTPOS=63000075;//kernel.NoviceActor:75
      n;for (; n>0 ; n--) {
        //$LASTPOS=63000086;//kernel.NoviceActor:86
        _this.update();
      }
    },
    fiber$sleep :function _trc_NoviceActor_f_sleep(_thread,n) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=63000054;//kernel.NoviceActor:54
      if (! n) {
        //$LASTPOS=63000061;//kernel.NoviceActor:61
        n=1;
      }
      
      _thread.enter(function _trc_NoviceActor_ent_sleep(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=63000071;//kernel.NoviceActor:71
            //$LASTPOS=63000075;//kernel.NoviceActor:75
            n;
          case 1:
            if (!(n>0)) { __pc=4     ; break; }
            //$LASTPOS=63000086;//kernel.NoviceActor:86
            _this.fiber$update(_thread);
            __pc=2;return;
          case 2:
            
          case 3     :
            n--;
            __pc=1;break;
          case 4     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    initSprite :function _trc_NoviceActor_initSprite() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=63000121;//kernel.NoviceActor:121
      if (! _this._sprite) {
        //$LASTPOS=63000146;//kernel.NoviceActor:146
        _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});
        //$LASTPOS=63000217;//kernel.NoviceActor:217
        Tonyu.globals.$Sprites.add(_this);
        
      }
    },
    fiber$initSprite :function _trc_NoviceActor_f_initSprite(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=63000121;//kernel.NoviceActor:121
      if (! _this._sprite) {
        //$LASTPOS=63000146;//kernel.NoviceActor:146
        _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});
        //$LASTPOS=63000217;//kernel.NoviceActor:217
        Tonyu.globals.$Sprites.add(_this);
        
      }
      
      _thread.retVal=_this;return;
    },
    say :function _trc_NoviceActor_say(text,size) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=63000271;//kernel.NoviceActor:271
      if (! size) {
        //$LASTPOS=63000282;//kernel.NoviceActor:282
        size=15;
      }
      //$LASTPOS=63000296;//kernel.NoviceActor:296
      _this.initSprite();
      //$LASTPOS=63000315;//kernel.NoviceActor:315
      _this._sprite._fukidashi={text: text,size: size,c: 30};
    },
    fiber$say :function _trc_NoviceActor_f_say(_thread,text,size) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=63000271;//kernel.NoviceActor:271
      if (! size) {
        //$LASTPOS=63000282;//kernel.NoviceActor:282
        size=15;
      }
      
      _thread.enter(function _trc_NoviceActor_ent_say(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=63000296;//kernel.NoviceActor:296
            _this.fiber$initSprite(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=63000315;//kernel.NoviceActor:315
            _this._sprite._fukidashi={text: text,size: size,c: 30};
            _thread.exit(_this);return;
          }
        }
      });
    },
    sprite :function _trc_NoviceActor_sprite(x,y,p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=63000390;//kernel.NoviceActor:390
      _this.go(x,y,p);
    },
    fiber$sprite :function _trc_NoviceActor_f_sprite(_thread,x,y,p) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_NoviceActor_ent_sprite(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=63000390;//kernel.NoviceActor:390
            _this.fiber$go(_thread, x, y, p);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    show :function _trc_NoviceActor_show(x,y,p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=63000425;//kernel.NoviceActor:425
      _this.go(x,y,p);
    },
    draw :function _trc_NoviceActor_draw(ctx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=63000465;//kernel.NoviceActor:465
      _this._sprite.draw(ctx);
    },
    getCrashRect :function _trc_NoviceActor_getCrashRect() {
      "use strict";
      var _this=this;
      
      return _this._sprite.getCrashRect();
    },
    fiber$getCrashRect :function _trc_NoviceActor_f_getCrashRect(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this._sprite.getCrashRect();return;
      
      
      _thread.retVal=_this;return;
    },
    go :function _trc_NoviceActor_go(x,y,p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=63000564;//kernel.NoviceActor:564
      _this.initSprite();
      //$LASTPOS=63000583;//kernel.NoviceActor:583
      _this._sprite.x=x;
      //$LASTPOS=63000601;//kernel.NoviceActor:601
      _this._sprite.y=y;
      //$LASTPOS=63000619;//kernel.NoviceActor:619
      if (p!=null) {
        //$LASTPOS=63000632;//kernel.NoviceActor:632
        _this._sprite.p=p;
      }
    },
    fiber$go :function _trc_NoviceActor_f_go(_thread,x,y,p) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_NoviceActor_ent_go(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=63000564;//kernel.NoviceActor:564
            _this.fiber$initSprite(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=63000583;//kernel.NoviceActor:583
            _this._sprite.x=x;
            //$LASTPOS=63000601;//kernel.NoviceActor:601
            _this._sprite.y=y;
            //$LASTPOS=63000619;//kernel.NoviceActor:619
            if (p!=null) {
              //$LASTPOS=63000632;//kernel.NoviceActor:632
              _this._sprite.p=p;
            }
            _thread.exit(_this);return;
          }
        }
      });
    },
    change :function _trc_NoviceActor_change(p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=63000684;//kernel.NoviceActor:684
      _this.initSprite();
      //$LASTPOS=63000703;//kernel.NoviceActor:703
      _this._sprite.p=p;
    },
    fiber$change :function _trc_NoviceActor_f_change(_thread,p) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_NoviceActor_ent_change(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=63000684;//kernel.NoviceActor:684
            _this.fiber$initSprite(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=63000703;//kernel.NoviceActor:703
            _this._sprite.p=p;
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"sleep":{"nowait":false},"initSprite":{"nowait":false},"say":{"nowait":false},"sprite":{"nowait":false},"show":{"nowait":true},"draw":{"nowait":true},"getCrashRect":{"nowait":false},"go":{"nowait":false},"change":{"nowait":false}},"fields":{"_sprite":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Actor',
  shortName: 'Actor',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.BaseActor,
  includes: [Tonyu.classes.kernel.SpriteMod2D,Tonyu.classes.kernel.QueryMod2D,Tonyu.classes.kernel.OneframeSpriteMod],
  methods: {
    main :function _trc_Actor_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=64000072;//kernel.Actor:72
      "field strict";
    },
    fiber$main :function _trc_Actor_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=64000072;//kernel.Actor:72
      "field strict";
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.Actor3D',
  shortName: 'Actor3D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.BaseActor,
  includes: [Tonyu.classes.kernel.SpriteMod3D,Tonyu.classes.kernel.QueryMod3D],
  methods: {
    main :function _trc_Actor3D_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=65000054;//kernel.Actor3D:54
      "field strict";
      
    },
    fiber$main :function _trc_Actor3D_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=65000054;//kernel.Actor3D:54
      "field strict";
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Actor3D_initialize(params) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=65000134;//kernel.Actor3D:134
      Tonyu.extend(_this,params);
      //$LASTPOS=65000166;//kernel.Actor3D:166
      _this.initSchedulerMod();
      //$LASTPOS=65000191;//kernel.Actor3D:191
      _this.layer=_this.layer||_this.defaultLayer;
      //$LASTPOS=65000223;//kernel.Actor3D:223
      if (_this.layer.group instanceof Tonyu.classes.kernel.SpriteGroup) {
        //$LASTPOS=65000263;//kernel.Actor3D:263
        _this.layer=_this.layer.group;
      }
      //$LASTPOS=65000287;//kernel.Actor3D:287
      _this.crashScale=1;
      //$LASTPOS=65000306;//kernel.Actor3D:306
      _this.initSpriteMod();
      //$LASTPOS=65000401;//kernel.Actor3D:401
      _this.direction=new Tonyu.classes.kernel.Direction;
      //$LASTPOS=65000431;//kernel.Actor3D:431
      _this.transform=new Tonyu.classes.kernel.Transform({direction: _this.direction,position: _this.position,scale: (_this._prescale||1),actor: _this,parent: _this.layer.transform||Tonyu.classes.kernel.Transform.root});
      //$LASTPOS=65000589;//kernel.Actor3D:589
      if (Tonyu.runMode) {
        //$LASTPOS=65000608;//kernel.Actor3D:608
        _this.addToLayer();
      }
      //$LASTPOS=65000627;//kernel.Actor3D:627
      _this.initAnimMod();
    },
    rotate :function _trc_Actor3D_rotate(mode,angle,unit) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=65000678;//kernel.Actor3D:678
      _this.direction.rotate(mode,angle,unit);
      return _this;
    },
    fiber$rotate :function _trc_Actor3D_f_rotate(_thread,mode,angle,unit) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=65000678;//kernel.Actor3D:678
      _this.direction.rotate(mode,angle,unit);
      _thread.retVal=_this;return;
      
      
      _thread.retVal=_this;return;
    },
    __getter__defaultLayer :function _trc_Actor3D___getter__defaultLayer() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$mainLayer3D;
    },
    dist :function _trc_Actor3D_dist(dx,dy,dz) {
      "use strict";
      var _this=this;
      var t;
      
      //$LASTPOS=65000812;//kernel.Actor3D:812
      if (typeof  dx=="object") {
        //$LASTPOS=65000848;//kernel.Actor3D:848
        t = dx;
        
        //$LASTPOS=65000867;//kernel.Actor3D:867
        dx=t.x-_this.x;
        //$LASTPOS=65000876;//kernel.Actor3D:876
        dy=t.y-_this.y;
        //$LASTPOS=65000885;//kernel.Actor3D:885
        dz=t.z-_this.z;
        
      }
      //$LASTPOS=65000907;//kernel.Actor3D:907
      dz=dz||0;
      return _this.sqrt(dx*dx+dy*dy+dz*dz);
    },
    __getter__scale :function _trc_Actor3D___getter__scale() {
      "use strict";
      var _this=this;
      
      return _this.transform.scale;
    },
    __setter__scale :function _trc_Actor3D___setter__scale(s) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=65001016;//kernel.Actor3D:1016
      if (! _this.transform) {
        return _this._prescale=s;
      }
      //$LASTPOS=65001057;//kernel.Actor3D:1057
      _this.transform.scale=s;
    },
    addSubactor :function _trc_Actor3D_addSubactor(s) {
      "use strict";
      var _this=this;
      var pp;
      
      //$LASTPOS=65001103;//kernel.Actor3D:1103
      if (_this.p instanceof Tonyu.classes.kernel.Sprites3D) {
        //$LASTPOS=65001134;//kernel.Actor3D:1134
        _this.p.add(s);
        //$LASTPOS=65001153;//kernel.Actor3D:1153
        if (s.transform) {
          //$LASTPOS=65001170;//kernel.Actor3D:1170
          s.transform.parent=_this.p.transform;
        }
        //$LASTPOS=65001211;//kernel.Actor3D:1211
        if (! s.lifeKeeper) {
          //$LASTPOS=65001230;//kernel.Actor3D:1230
          s.lifeKeeper=_this;
        }
        
      } else {
        //$LASTPOS=65001272;//kernel.Actor3D:1272
        pp = _this.p;
        
        //$LASTPOS=65001291;//kernel.Actor3D:1291
        _this.p=new Tonyu.classes.kernel.Sprites3D({layer: _this,transform: _this.transform});
        //$LASTPOS=65001339;//kernel.Actor3D:1339
        if (pp!=null) {
          //$LASTPOS=65001368;//kernel.Actor3D:1368
          new Tonyu.classes.kernel.Actor3D({x: 0,y: 0,p: pp,scale: _this.scale,scaleX: _this.scaleX,scaleY: _this.scaleY,alpha: _this.alpha,layer: _this.p});
          
        }
        //$LASTPOS=65001449;//kernel.Actor3D:1449
        _this.addSubactor(s);
        
      }
    },
    fiber$addSubactor :function _trc_Actor3D_f_addSubactor(_thread,s) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var pp;
      
      
      _thread.enter(function _trc_Actor3D_ent_addSubactor(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=65001103;//kernel.Actor3D:1103
            if (!(_this.p instanceof Tonyu.classes.kernel.Sprites3D)) { __pc=1     ; break; }
            {
              //$LASTPOS=65001134;//kernel.Actor3D:1134
              _this.p.add(s);
              //$LASTPOS=65001153;//kernel.Actor3D:1153
              if (s.transform) {
                //$LASTPOS=65001170;//kernel.Actor3D:1170
                s.transform.parent=_this.p.transform;
              }
              //$LASTPOS=65001211;//kernel.Actor3D:1211
              if (! s.lifeKeeper) {
                //$LASTPOS=65001230;//kernel.Actor3D:1230
                s.lifeKeeper=_this;
              }
            }
            __pc=3     ;break;
          case 1     :
            //$LASTPOS=65001272;//kernel.Actor3D:1272
            pp = _this.p;
            
            //$LASTPOS=65001291;//kernel.Actor3D:1291
            _this.p=new Tonyu.classes.kernel.Sprites3D({layer: _this,transform: _this.transform});
            //$LASTPOS=65001339;//kernel.Actor3D:1339
            if (pp!=null) {
              //$LASTPOS=65001368;//kernel.Actor3D:1368
              new Tonyu.classes.kernel.Actor3D({x: 0,y: 0,p: pp,scale: _this.scale,scaleX: _this.scaleX,scaleY: _this.scaleY,alpha: _this.alpha,layer: _this.p});
              
            }
            //$LASTPOS=65001449;//kernel.Actor3D:1449
            _this.fiber$addSubactor(_thread, s);
            __pc=2;return;
          case 2:
            
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"rotate":{"nowait":false},"__getter__defaultLayer":{"nowait":true},"dist":{"nowait":true},"__getter__scale":{"nowait":true},"__setter__scale":{"nowait":true},"addSubactor":{"nowait":false}},"fields":{"z":{},"direction":{},"_prescale":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Camera3D',
  shortName: 'Camera3D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor3D,
  includes: [],
  methods: {
    main :function _trc_Camera3D_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=66000018;//kernel.Camera3D:18
      "field strict";
      
      
      
      
      
    },
    fiber$main :function _trc_Camera3D_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=66000018;//kernel.Camera3D:18
      "field strict";
      
      
      
      
      
      
      _thread.retVal=_this;return;
    },
    addSprite2D :function _trc_Camera3D_addSprite2D(s) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=66000343;//kernel.Camera3D:343
      _this.sprites2D.push(s);
    },
    fiber$addSprite2D :function _trc_Camera3D_f_addSprite2D(_thread,s) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=66000343;//kernel.Camera3D:343
      _this.sprites2D.push(s);
      
      _thread.retVal=_this;return;
    },
    addSprite3D :function _trc_Camera3D_addSprite3D(s) {
      "use strict";
      var _this=this;
      var scl;
      var svb;
      var e;
      var _it_552;
      var p;
      
      //$LASTPOS=66000486;//kernel.Camera3D:486
      scl = ((typeof  s.scale==="number")?s.scale:1);
      
      //$LASTPOS=66000544;//kernel.Camera3D:544
      if (s.p instanceof Tonyu.classes.kernel.Sprites3D&&s.transform) {
        //$LASTPOS=66000592;//kernel.Camera3D:592
        svb = _this.base;
        
        //$LASTPOS=66000615;//kernel.Camera3D:615
        _this.base=_this.base?_this.base.localToWorld(s.transform):s.transform;
        //$LASTPOS=66000678;//kernel.Camera3D:678
        _it_552=Tonyu.iterator(s.p.sprites,1);
        while(_it_552.next()) {
          e=_it_552[0];
          
          //$LASTPOS=66000720;//kernel.Camera3D:720
          _this.addSprite3D(e);
          
        }
        //$LASTPOS=66001087;//kernel.Camera3D:1087
        _this.base=svb;
        return _this;
        
      }
      //$LASTPOS=66001126;//kernel.Camera3D:1126
      if (s.p instanceof Tonyu.classes.kernel.Sprites3D&&! s.transform) {
        return _this;
        throw new Error("No transform");
        
        
      }
      //$LASTPOS=66001237;//kernel.Camera3D:1237
      p = _this.to2D(s.position||new Tonyu.classes.kernel.Vec3(s.x,s.y,s.z));
      
      //$LASTPOS=66001291;//kernel.Camera3D:1291
      if (p) {
        //$LASTPOS=66001309;//kernel.Camera3D:1309
        scl*=p.scale;
        //$LASTPOS=66001332;//kernel.Camera3D:1332
        if (s instanceof Tonyu.classes.kernel.ActorSprite) {
          //$LASTPOS=66001369;//kernel.Camera3D:1369
          s.x=p.x;
          //$LASTPOS=66001378;//kernel.Camera3D:1378
          s.y=p.y;
          //$LASTPOS=66001400;//kernel.Camera3D:1400
          s.zOrder=p.z;
          //$LASTPOS=66001427;//kernel.Camera3D:1427
          s.scaleX*=scl;
          //$LASTPOS=66001455;//kernel.Camera3D:1455
          if (typeof  s.scaleY==="number") {
            //$LASTPOS=66001487;//kernel.Camera3D:1487
            s.scaleY*=scl;
          }
          
        } else {
          //$LASTPOS=66001533;//kernel.Camera3D:1533
          s=new Tonyu.classes.kernel.ActorSprite({x: p.x,y: p.y,scaleX: (s.scaleX||1)*scl,scaleY: (s.scaleY||s.scaleX||1)*scl,p: s.p,text: s.text,fillStyle: s.fillStyle,rotation: s.rotation||0,alpha: s.alpha||255,zOrder: p.z});
          
        }
        //$LASTPOS=66001862;//kernel.Camera3D:1862
        _this.addSprite2D(s);
        
      }
    },
    fiber$addSprite3D :function _trc_Camera3D_f_addSprite3D(_thread,s) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var scl;
      var svb;
      var e;
      var _it_552;
      var p;
      
      //$LASTPOS=66000486;//kernel.Camera3D:486
      scl = ((typeof  s.scale==="number")?s.scale:1);
      
      
      _thread.enter(function _trc_Camera3D_ent_addSprite3D(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=66000544;//kernel.Camera3D:544
            if (!(s.p instanceof Tonyu.classes.kernel.Sprites3D&&s.transform)) { __pc=4     ; break; }
            //$LASTPOS=66000592;//kernel.Camera3D:592
            svb = _this.base;
            
            //$LASTPOS=66000615;//kernel.Camera3D:615
            _this.base=_this.base?_this.base.localToWorld(s.transform):s.transform;
            //$LASTPOS=66000678;//kernel.Camera3D:678
            _it_552=Tonyu.iterator(s.p.sprites,1);
          case 1:
            if (!(_it_552.next())) { __pc=3     ; break; }
            e=_it_552[0];
            
            //$LASTPOS=66000720;//kernel.Camera3D:720
            _this.fiber$addSprite3D(_thread, e);
            __pc=2;return;
          case 2:
            
            __pc=1;break;
          case 3     :
            
            //$LASTPOS=66001087;//kernel.Camera3D:1087
            _this.base=svb;
            _thread.exit(_this);return;
          case 4     :
            
            //$LASTPOS=66001126;//kernel.Camera3D:1126
            if (!(s.p instanceof Tonyu.classes.kernel.Sprites3D&&! s.transform)) { __pc=5     ; break; }
            _thread.exit(_this);return;
            throw new Error("No transform");
            
          case 5     :
            
            //$LASTPOS=66001237;//kernel.Camera3D:1237
            _this.fiber$to2D(_thread, s.position||new Tonyu.classes.kernel.Vec3(s.x,s.y,s.z));
            __pc=6;return;
          case 6:
            p=_thread.retVal;
            
            //$LASTPOS=66001291;//kernel.Camera3D:1291
            if (!(p)) { __pc=8     ; break; }
            //$LASTPOS=66001309;//kernel.Camera3D:1309
            scl*=p.scale;
            //$LASTPOS=66001332;//kernel.Camera3D:1332
            if (s instanceof Tonyu.classes.kernel.ActorSprite) {
              //$LASTPOS=66001369;//kernel.Camera3D:1369
              s.x=p.x;
              //$LASTPOS=66001378;//kernel.Camera3D:1378
              s.y=p.y;
              //$LASTPOS=66001400;//kernel.Camera3D:1400
              s.zOrder=p.z;
              //$LASTPOS=66001427;//kernel.Camera3D:1427
              s.scaleX*=scl;
              //$LASTPOS=66001455;//kernel.Camera3D:1455
              if (typeof  s.scaleY==="number") {
                //$LASTPOS=66001487;//kernel.Camera3D:1487
                s.scaleY*=scl;
              }
              
            } else {
              //$LASTPOS=66001533;//kernel.Camera3D:1533
              s=new Tonyu.classes.kernel.ActorSprite({x: p.x,y: p.y,scaleX: (s.scaleX||1)*scl,scaleY: (s.scaleY||s.scaleX||1)*scl,p: s.p,text: s.text,fillStyle: s.fillStyle,rotation: s.rotation||0,alpha: s.alpha||255,zOrder: p.z});
              
            }
            //$LASTPOS=66001862;//kernel.Camera3D:1862
            _this.fiber$addSprite2D(_thread, s);
            __pc=7;return;
          case 7:
            
          case 8     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    initialize :function _trc_Camera3D_initialize(p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=66001904;//kernel.Camera3D:1904
      Tonyu.classes.kernel.Actor3D.apply( _this, [p]);
      //$LASTPOS=66001919;//kernel.Camera3D:1919
      _this.spx=_this.spx||Tonyu.globals.$screenWidth/2;
      //$LASTPOS=66001949;//kernel.Camera3D:1949
      _this.spy=_this.spy||Tonyu.globals.$screenHeight/2;
      //$LASTPOS=66001980;//kernel.Camera3D:1980
      _this.z1=_this.z1||Tonyu.globals.$screenWidth/2;
      //$LASTPOS=66002008;//kernel.Camera3D:2008
      _this.z=- _this.z1;
    },
    to2D :function _trc_Camera3D_to2D(pos) {
      "use strict";
      var _this=this;
      var c;
      var x;
      var y;
      var z;
      
      //$LASTPOS=66002085;//kernel.Camera3D:2085
      if (_this.base) {
        //$LASTPOS=66002095;//kernel.Camera3D:2095
        pos=_this.base.localToWorld(pos);
      }
      //$LASTPOS=66002128;//kernel.Camera3D:2128
      c = _this.transform.worldToLocal(pos);
      
      //$LASTPOS=66002168;//kernel.Camera3D:2168
      x = c.x;
      
      //$LASTPOS=66002184;//kernel.Camera3D:2184
      y = c.y;
      
      //$LASTPOS=66002200;//kernel.Camera3D:2200
      z = c.z;
      
      //$LASTPOS=66002216;//kernel.Camera3D:2216
      if (z<=0) {
        return null;
      }
      //$LASTPOS=66002244;//kernel.Camera3D:2244
      x=x*_this.z1/z+_this.spx;
      //$LASTPOS=66002263;//kernel.Camera3D:2263
      y=y*_this.z1/z+_this.spy;
      return {x: x,y: y,z: z,scale: _this.z1/z};
    },
    fiber$to2D :function _trc_Camera3D_f_to2D(_thread,pos) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var c;
      var x;
      var y;
      var z;
      
      //$LASTPOS=66002085;//kernel.Camera3D:2085
      if (_this.base) {
        //$LASTPOS=66002095;//kernel.Camera3D:2095
        pos=_this.base.localToWorld(pos);
      }
      //$LASTPOS=66002128;//kernel.Camera3D:2128
      c = _this.transform.worldToLocal(pos);
      
      //$LASTPOS=66002168;//kernel.Camera3D:2168
      x = c.x;
      
      //$LASTPOS=66002184;//kernel.Camera3D:2184
      y = c.y;
      
      //$LASTPOS=66002200;//kernel.Camera3D:2200
      z = c.z;
      
      //$LASTPOS=66002216;//kernel.Camera3D:2216
      if (z<=0) {
        _thread.retVal=null;return;
        
      }
      //$LASTPOS=66002244;//kernel.Camera3D:2244
      x=x*_this.z1/z+_this.spx;
      //$LASTPOS=66002263;//kernel.Camera3D:2263
      y=y*_this.z1/z+_this.spy;
      _thread.retVal={x: x,y: y,z: z,scale: _this.z1/z};return;
      
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_Camera3D_draw(ctx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=66002331;//kernel.Camera3D:2331
      _this.group.draw(ctx,_this);
    },
    fiber$draw :function _trc_Camera3D_f_draw(_thread,ctx) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=66002331;//kernel.Camera3D:2331
      _this.group.draw(ctx,_this);
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"addSprite2D":{"nowait":false},"addSprite3D":{"nowait":false},"new":{"nowait":false},"to2D":{"nowait":false},"draw":{"nowait":false}},"fields":{"group":{},"sprites2D":{},"z1":{},"spx":{},"spy":{},"base":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.GameScreen',
  shortName: 'GameScreen',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_GameScreen_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_GameScreen_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_GameScreen_initialize(opt) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=67000113;//kernel.GameScreen:113
      _this.extend(opt);
      //$LASTPOS=67000131;//kernel.GameScreen:131
      _this.resize(_this.width,_this.height);
      //$LASTPOS=67000159;//kernel.GameScreen:159
      _this.bgColor="rgb(20,80,180)";
      //$LASTPOS=67000195;//kernel.GameScreen:195
      _this.isDrawGrid=Tonyu.globals.$Sprites.isDrawGrid;
    },
    resize :function _trc_GameScreen_resize(width,height) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=67000260;//kernel.GameScreen:260
      _this.width=width;
      //$LASTPOS=67000283;//kernel.GameScreen:283
      _this.height=height;
      //$LASTPOS=67000308;//kernel.GameScreen:308
      _this.buf=$("<canvas>").attr({width: width,height: height});
      //$LASTPOS=67000351;//kernel.GameScreen:351
      _this.ctx=_this.buf[0].getContext("2d");
      //$LASTPOS=67000385;//kernel.GameScreen:385
      _this.fireEvent("resize",width,height);
    },
    fiber$resize :function _trc_GameScreen_f_resize(_thread,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=67000260;//kernel.GameScreen:260
      _this.width=width;
      //$LASTPOS=67000283;//kernel.GameScreen:283
      _this.height=height;
      //$LASTPOS=67000308;//kernel.GameScreen:308
      _this.buf=$("<canvas>").attr({width: width,height: height});
      //$LASTPOS=67000351;//kernel.GameScreen:351
      _this.ctx=_this.buf[0].getContext("2d");
      //$LASTPOS=67000385;//kernel.GameScreen:385
      _this.fireEvent("resize",width,height);
      
      _thread.retVal=_this;return;
    },
    setBounds :function _trc_GameScreen_setBounds(b) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=67000620;//kernel.GameScreen:620
      _this.bounds=b;
    },
    fiber$setBounds :function _trc_GameScreen_f_setBounds(_thread,b) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=67000620;//kernel.GameScreen:620
      _this.bounds=b;
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_GameScreen_draw(cctx) {
      "use strict";
      var _this=this;
      var b;
      
      //$LASTPOS=67000653;//kernel.GameScreen:653
      b = _this.bounds;
      
      //$LASTPOS=67000672;//kernel.GameScreen:672
      _this.fillCanvas();
      //$LASTPOS=67000691;//kernel.GameScreen:691
      _this.sprites.draw(_this.buf[0]);
      //$LASTPOS=67000718;//kernel.GameScreen:718
      cctx.drawImage(_this.buf[0],0,0,_this.width,_this.height,b.left,b.top,b.width,b.height);
    },
    canvas2buf :function _trc_GameScreen_canvas2buf(point) {
      "use strict";
      var _this=this;
      var b;
      
      //$LASTPOS=67000856;//kernel.GameScreen:856
      b = _this.bounds;
      
      //$LASTPOS=67000875;//kernel.GameScreen:875
      if (! b) {
        return point;
      }
      return {x: (point.x-b.left)/b.width*_this.width,y: (point.y-b.top)/b.height*_this.height};
    },
    fiber$canvas2buf :function _trc_GameScreen_f_canvas2buf(_thread,point) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var b;
      
      //$LASTPOS=67000856;//kernel.GameScreen:856
      b = _this.bounds;
      
      //$LASTPOS=67000875;//kernel.GameScreen:875
      if (! b) {
        _thread.retVal=point;return;
        
      }
      _thread.retVal={x: (point.x-b.left)/b.width*_this.width,y: (point.y-b.top)/b.height*_this.height};return;
      
      
      _thread.retVal=_this;return;
    },
    setBGColor :function _trc_GameScreen_setBGColor(c) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=67001012;//kernel.GameScreen:1012
      _this.bgColor=c;
    },
    fiber$setBGColor :function _trc_GameScreen_f_setBGColor(_thread,c) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=67001012;//kernel.GameScreen:1012
      _this.bgColor=c;
      
      _thread.retVal=_this;return;
    },
    fillCanvas :function _trc_GameScreen_fillCanvas() {
      "use strict";
      var _this=this;
      var ctx;
      
      //$LASTPOS=67001052;//kernel.GameScreen:1052
      ctx = _this.buf[0].getContext("2d");
      
      //$LASTPOS=67001090;//kernel.GameScreen:1090
      ctx.save();
      //$LASTPOS=67001107;//kernel.GameScreen:1107
      ctx.fillStyle=_this.bgColor+"";
      //$LASTPOS=67001138;//kernel.GameScreen:1138
      ctx.fillRect(0,0,_this.width,_this.height);
      //$LASTPOS=67001212;//kernel.GameScreen:1212
      ctx.restore();
    },
    fiber$fillCanvas :function _trc_GameScreen_f_fillCanvas(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      
      //$LASTPOS=67001052;//kernel.GameScreen:1052
      ctx = _this.buf[0].getContext("2d");
      
      //$LASTPOS=67001090;//kernel.GameScreen:1090
      ctx.save();
      //$LASTPOS=67001107;//kernel.GameScreen:1107
      ctx.fillStyle=_this.bgColor+"";
      //$LASTPOS=67001138;//kernel.GameScreen:1138
      ctx.fillRect(0,0,_this.width,_this.height);
      //$LASTPOS=67001212;//kernel.GameScreen:1212
      ctx.restore();
      
      _thread.retVal=_this;return;
    },
    scrollTo :function _trc_GameScreen_scrollTo(scrollX,scrollY) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=67001264;//kernel.GameScreen:1264
      _this.sprites.scrollTo(scrollX,scrollY);
    },
    fiber$scrollTo :function _trc_GameScreen_f_scrollTo(_thread,scrollX,scrollY) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=67001264;//kernel.GameScreen:1264
      _this.sprites.scrollTo(scrollX,scrollY);
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"resize":{"nowait":false},"setBounds":{"nowait":false},"draw":{"nowait":true},"canvas2buf":{"nowait":false},"setBGColor":{"nowait":false},"fillCanvas":{"nowait":false},"scrollTo":{"nowait":false}},"fields":{"isDrawGrid":{},"buf":{},"ctx":{},"bounds":{},"sprites":{},"bgColor":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Map',
  shortName: 'Map',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_Map_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_Map_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Map_initialize(param) {
      "use strict";
      var _this=this;
      var j;
      var i;
      
      //$LASTPOS=68000077;//kernel.Map:77
      _this.sx=0;
      //$LASTPOS=68000088;//kernel.Map:88
      _this.sy=0;
      //$LASTPOS=68000099;//kernel.Map:99
      _this.alpha=255;
      //$LASTPOS=68000115;//kernel.Map:115
      Tonyu.classes.kernel.Actor.apply( _this, [param]);
      //$LASTPOS=68000134;//kernel.Map:134
      _this.chipWidth=_this.chipWidth||32;
      //$LASTPOS=68000164;//kernel.Map:164
      _this.chipHeight=_this.chipHeight||_this.chipWidth||32;
      //$LASTPOS=68000207;//kernel.Map:207
      if (typeof  _this.col!=="number") {
        //$LASTPOS=68000234;//kernel.Map:234
        _this.col=Tonyu.globals.$screenWidth/_this.chipWidth;
      }
      //$LASTPOS=68000267;//kernel.Map:267
      if (typeof  _this.row!=="number") {
        //$LASTPOS=68000294;//kernel.Map:294
        _this.row=Tonyu.globals.$screenHeight/_this.chipHeight;
      }
      //$LASTPOS=68000329;//kernel.Map:329
      _this.col=_this.floor(_this.col);
      //$LASTPOS=68000344;//kernel.Map:344
      _this.row=_this.floor(_this.row);
      //$LASTPOS=68000365;//kernel.Map:365
      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
      //$LASTPOS=68000437;//kernel.Map:437
      _this.mapObj=true;
      //$LASTPOS=68000455;//kernel.Map:455
      _this.mapTable=[];
      //$LASTPOS=68000475;//kernel.Map:475
      _this.mapOnTable=[];
      //$LASTPOS=68000497;//kernel.Map:497
      //$LASTPOS=68000501;//kernel.Map:501
      j = 0;
      for (; j<_this.row ; j++) {
        {
          //$LASTPOS=68000530;//kernel.Map:530
          _this.rows=[];
          //$LASTPOS=68000550;//kernel.Map:550
          //$LASTPOS=68000554;//kernel.Map:554
          i = 0;
          for (; i<_this.col ; i++) {
            {
              //$LASTPOS=68000587;//kernel.Map:587
              _this.rows.push(- 1);
            }
          }
          //$LASTPOS=68000622;//kernel.Map:622
          _this.mapTable.push(_this.rows);
        }
      }
      //$LASTPOS=68000655;//kernel.Map:655
      //$LASTPOS=68000659;//kernel.Map:659
      j = 0;
      for (; j<_this.row ; j++) {
        {
          //$LASTPOS=68000688;//kernel.Map:688
          _this.rows=[];
          //$LASTPOS=68000708;//kernel.Map:708
          //$LASTPOS=68000712;//kernel.Map:712
          i = 0;
          for (; i<_this.col ; i++) {
            {
              //$LASTPOS=68000745;//kernel.Map:745
              _this.rows.push(- 1);
            }
          }
          //$LASTPOS=68000780;//kernel.Map:780
          _this.mapOnTable.push(_this.rows);
        }
      }
      //$LASTPOS=68000880;//kernel.Map:880
      _this.initMap();
    },
    initMap :function _trc_Map_initMap() {
      "use strict";
      var _this=this;
      var i;
      var j;
      
      //$LASTPOS=68000912;//kernel.Map:912
      if (! _this.mapData) {
        return _this;
      }
      //$LASTPOS=68000938;//kernel.Map:938
      //$LASTPOS=68000942;//kernel.Map:942
      i = 0;
      for (; i<_this.row ; i++) {
        {
          //$LASTPOS=68000971;//kernel.Map:971
          //$LASTPOS=68000975;//kernel.Map:975
          j = 0;
          for (; j<_this.col ; j++) {
            {
              //$LASTPOS=68001008;//kernel.Map:1008
              _this.set(j,i,_this.mapData[i][j]);
            }
          }
        }
      }
      //$LASTPOS=68001055;//kernel.Map:1055
      if (! _this.mapOnData) {
        return _this;
      }
      //$LASTPOS=68001083;//kernel.Map:1083
      //$LASTPOS=68001087;//kernel.Map:1087
      i = 0;
      for (; i<_this.row ; i++) {
        {
          //$LASTPOS=68001116;//kernel.Map:1116
          //$LASTPOS=68001120;//kernel.Map:1120
          j = 0;
          for (; j<_this.col ; j++) {
            {
              //$LASTPOS=68001153;//kernel.Map:1153
              _this.setOn(j,i,_this.mapOnData[i][j]);
            }
          }
        }
      }
    },
    fiber$initMap :function _trc_Map_f_initMap(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var i;
      var j;
      
      //$LASTPOS=68000912;//kernel.Map:912
      if (! _this.mapData) {
        _thread.retVal=_this;return;
        
      }
      
      _thread.enter(function _trc_Map_ent_initMap(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=68000938;//kernel.Map:938
            //$LASTPOS=68000942;//kernel.Map:942
            i = 0;
            
          case 1:
            if (!(i<_this.row)) { __pc=7     ; break; }
            //$LASTPOS=68000971;//kernel.Map:971
            //$LASTPOS=68000975;//kernel.Map:975
            j = 0;
            
          case 2:
            if (!(j<_this.col)) { __pc=5     ; break; }
            //$LASTPOS=68001008;//kernel.Map:1008
            _this.fiber$set(_thread, j, i, _this.mapData[i][j]);
            __pc=3;return;
          case 3:
            
          case 4     :
            j++;
            __pc=2;break;
          case 5     :
            
          case 6     :
            i++;
            __pc=1;break;
          case 7     :
            
            //$LASTPOS=68001055;//kernel.Map:1055
            if (!(! _this.mapOnData)) { __pc=8     ; break; }
            _thread.exit(_this);return;
          case 8     :
            
            //$LASTPOS=68001083;//kernel.Map:1083
            //$LASTPOS=68001087;//kernel.Map:1087
            i = 0;
            
          case 9:
            if (!(i<_this.row)) { __pc=15    ; break; }
            //$LASTPOS=68001116;//kernel.Map:1116
            //$LASTPOS=68001120;//kernel.Map:1120
            j = 0;
            
          case 10:
            if (!(j<_this.col)) { __pc=13    ; break; }
            //$LASTPOS=68001153;//kernel.Map:1153
            _this.fiber$setOn(_thread, j, i, _this.mapOnData[i][j]);
            __pc=11;return;
          case 11:
            
          case 12    :
            j++;
            __pc=10;break;
          case 13    :
            
          case 14    :
            i++;
            __pc=9;break;
          case 15    :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    redrawMap :function _trc_Map_redrawMap() {
      "use strict";
      var _this=this;
      
      return _this.redraw();
    },
    fiber$redrawMap :function _trc_Map_f_redrawMap(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Map_ent_redrawMap(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$redraw(_thread);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    redraw :function _trc_Map_redraw() {
      "use strict";
      var _this=this;
      var i;
      var j;
      
      //$LASTPOS=68001260;//kernel.Map:1260
      if (! _this.mapTable) {
        return _this;
      }
      //$LASTPOS=68001287;//kernel.Map:1287
      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
      //$LASTPOS=68001359;//kernel.Map:1359
      //$LASTPOS=68001363;//kernel.Map:1363
      i = 0;
      for (; i<_this.row ; i++) {
        {
          //$LASTPOS=68001392;//kernel.Map:1392
          //$LASTPOS=68001396;//kernel.Map:1396
          j = 0;
          for (; j<_this.col ; j++) {
            {
              //$LASTPOS=68001429;//kernel.Map:1429
              _this.set(j,i,_this.mapTable[i][j]);
            }
          }
        }
      }
      //$LASTPOS=68001477;//kernel.Map:1477
      if (! _this.mapOnTable) {
        return _this;
      }
      //$LASTPOS=68001506;//kernel.Map:1506
      //$LASTPOS=68001510;//kernel.Map:1510
      i = 0;
      for (; i<_this.row ; i++) {
        {
          //$LASTPOS=68001539;//kernel.Map:1539
          //$LASTPOS=68001543;//kernel.Map:1543
          j = 0;
          for (; j<_this.col ; j++) {
            {
              //$LASTPOS=68001576;//kernel.Map:1576
              _this.setOn(j,i,_this.mapOnTable[i][j]);
            }
          }
        }
      }
    },
    fiber$redraw :function _trc_Map_f_redraw(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var i;
      var j;
      
      //$LASTPOS=68001260;//kernel.Map:1260
      if (! _this.mapTable) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=68001287;//kernel.Map:1287
      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
      
      _thread.enter(function _trc_Map_ent_redraw(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=68001359;//kernel.Map:1359
            //$LASTPOS=68001363;//kernel.Map:1363
            i = 0;
            
          case 1:
            if (!(i<_this.row)) { __pc=7     ; break; }
            //$LASTPOS=68001392;//kernel.Map:1392
            //$LASTPOS=68001396;//kernel.Map:1396
            j = 0;
            
          case 2:
            if (!(j<_this.col)) { __pc=5     ; break; }
            //$LASTPOS=68001429;//kernel.Map:1429
            _this.fiber$set(_thread, j, i, _this.mapTable[i][j]);
            __pc=3;return;
          case 3:
            
          case 4     :
            j++;
            __pc=2;break;
          case 5     :
            
          case 6     :
            i++;
            __pc=1;break;
          case 7     :
            
            //$LASTPOS=68001477;//kernel.Map:1477
            if (!(! _this.mapOnTable)) { __pc=8     ; break; }
            _thread.exit(_this);return;
          case 8     :
            
            //$LASTPOS=68001506;//kernel.Map:1506
            //$LASTPOS=68001510;//kernel.Map:1510
            i = 0;
            
          case 9:
            if (!(i<_this.row)) { __pc=15    ; break; }
            //$LASTPOS=68001539;//kernel.Map:1539
            //$LASTPOS=68001543;//kernel.Map:1543
            j = 0;
            
          case 10:
            if (!(j<_this.col)) { __pc=13    ; break; }
            //$LASTPOS=68001576;//kernel.Map:1576
            _this.fiber$setOn(_thread, j, i, _this.mapOnTable[i][j]);
            __pc=11;return;
          case 11:
            
          case 12    :
            j++;
            __pc=10;break;
          case 13    :
            
          case 14    :
            i++;
            __pc=9;break;
          case 15    :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    load :function _trc_Map_load(dataFile) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=68001651;//kernel.Map:1651
      _this.baseData=_this.file("../maps/").rel(dataFile).obj();
      //$LASTPOS=68001703;//kernel.Map:1703
      if (! _this.baseData) {
        //$LASTPOS=68001717;//kernel.Map:1717
        _this.baseData=_this.file(dataFile).obj();
      }
      //$LASTPOS=68001753;//kernel.Map:1753
      _this.mapTable=_this.baseData[0];
      //$LASTPOS=68001780;//kernel.Map:1780
      _this.mapData=_this.mapTable;
      //$LASTPOS=68001803;//kernel.Map:1803
      _this.row=_this.mapTable.length;
      //$LASTPOS=68001829;//kernel.Map:1829
      _this.col=_this.mapTable[0].length;
      //$LASTPOS=68001858;//kernel.Map:1858
      _this.mapOnTable=_this.baseData[1];
      //$LASTPOS=68001887;//kernel.Map:1887
      _this.mapOnData=_this.mapOnTable;
      //$LASTPOS=68001914;//kernel.Map:1914
      if (typeof  Number(_this.baseData[2])=="number") {
        //$LASTPOS=68001956;//kernel.Map:1956
        _this.chipWidth=Number(_this.baseData[2]);
      }
      //$LASTPOS=68001992;//kernel.Map:1992
      if (typeof  Number(_this.baseData[3])=="number") {
        //$LASTPOS=68002034;//kernel.Map:2034
        _this.chipHeight=Number(_this.baseData[3]);
      }
      //$LASTPOS=68002071;//kernel.Map:2071
      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
      //$LASTPOS=68002143;//kernel.Map:2143
      _this.initMap();
    },
    fiber$load :function _trc_Map_f_load(_thread,dataFile) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=68001651;//kernel.Map:1651
      _this.baseData=_this.file("../maps/").rel(dataFile).obj();
      //$LASTPOS=68001703;//kernel.Map:1703
      if (! _this.baseData) {
        //$LASTPOS=68001717;//kernel.Map:1717
        _this.baseData=_this.file(dataFile).obj();
      }
      //$LASTPOS=68001753;//kernel.Map:1753
      _this.mapTable=_this.baseData[0];
      //$LASTPOS=68001780;//kernel.Map:1780
      _this.mapData=_this.mapTable;
      //$LASTPOS=68001803;//kernel.Map:1803
      _this.row=_this.mapTable.length;
      //$LASTPOS=68001829;//kernel.Map:1829
      _this.col=_this.mapTable[0].length;
      //$LASTPOS=68001858;//kernel.Map:1858
      _this.mapOnTable=_this.baseData[1];
      //$LASTPOS=68001887;//kernel.Map:1887
      _this.mapOnData=_this.mapOnTable;
      //$LASTPOS=68001914;//kernel.Map:1914
      if (typeof  Number(_this.baseData[2])=="number") {
        //$LASTPOS=68001956;//kernel.Map:1956
        _this.chipWidth=Number(_this.baseData[2]);
      }
      //$LASTPOS=68001992;//kernel.Map:1992
      if (typeof  Number(_this.baseData[3])=="number") {
        //$LASTPOS=68002034;//kernel.Map:2034
        _this.chipHeight=Number(_this.baseData[3]);
      }
      //$LASTPOS=68002071;//kernel.Map:2071
      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
      
      _thread.enter(function _trc_Map_ent_load(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=68002143;//kernel.Map:2143
            _this.fiber$initMap(_thread);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    save :function _trc_Map_save(saveFileName) {
      "use strict";
      var _this=this;
      var saveDataFile;
      var data;
      
      //$LASTPOS=68002185;//kernel.Map:2185
      saveDataFile = _this.file("../maps/").rel(saveFileName);
      
      //$LASTPOS=68002243;//kernel.Map:2243
      data = [_this.mapTable,_this.mapOnTable,_this.chipWidth,_this.chipHeight];
      
      //$LASTPOS=68002301;//kernel.Map:2301
      saveDataFile.obj(data);
    },
    fiber$save :function _trc_Map_f_save(_thread,saveFileName) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var saveDataFile;
      var data;
      
      //$LASTPOS=68002185;//kernel.Map:2185
      saveDataFile = _this.file("../maps/").rel(saveFileName);
      
      //$LASTPOS=68002243;//kernel.Map:2243
      data = [_this.mapTable,_this.mapOnTable,_this.chipWidth,_this.chipHeight];
      
      //$LASTPOS=68002301;//kernel.Map:2301
      saveDataFile.obj(data);
      
      _thread.retVal=_this;return;
    },
    set :function _trc_Map_set(setCol,setRow,p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=68002357;//kernel.Map:2357
      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
        return _this;
      }
      //$LASTPOS=68002425;//kernel.Map:2425
      _this.mapTable[setRow][setCol]=p;
      //$LASTPOS=68002496;//kernel.Map:2496
      _this.ctx=_this.buf[0].getContext("2d");
      //$LASTPOS=68002530;//kernel.Map:2530
      p=Math.floor(p);
      //$LASTPOS=68002552;//kernel.Map:2552
      _this.pImg=Tonyu.globals.$imageList[p];
      //$LASTPOS=68002577;//kernel.Map:2577
      if (! _this.pImg) {
        //$LASTPOS=68002599;//kernel.Map:2599
        _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);
        return _this;
        
      }
      //$LASTPOS=68002700;//kernel.Map:2700
      _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);
      //$LASTPOS=68002777;//kernel.Map:2777
      _this.ctx.save();
      //$LASTPOS=68002948;//kernel.Map:2948
      _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);
      //$LASTPOS=68003092;//kernel.Map:3092
      _this.ctx.restore();
    },
    fiber$set :function _trc_Map_f_set(_thread,setCol,setRow,p) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=68002357;//kernel.Map:2357
      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=68002425;//kernel.Map:2425
      _this.mapTable[setRow][setCol]=p;
      //$LASTPOS=68002496;//kernel.Map:2496
      _this.ctx=_this.buf[0].getContext("2d");
      //$LASTPOS=68002530;//kernel.Map:2530
      p=Math.floor(p);
      //$LASTPOS=68002552;//kernel.Map:2552
      _this.pImg=Tonyu.globals.$imageList[p];
      //$LASTPOS=68002577;//kernel.Map:2577
      if (! _this.pImg) {
        //$LASTPOS=68002599;//kernel.Map:2599
        _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);
        _thread.retVal=_this;return;
        
        
      }
      //$LASTPOS=68002700;//kernel.Map:2700
      _this.ctx.clearRect(setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);
      //$LASTPOS=68002777;//kernel.Map:2777
      _this.ctx.save();
      //$LASTPOS=68002948;//kernel.Map:2948
      _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);
      //$LASTPOS=68003092;//kernel.Map:3092
      _this.ctx.restore();
      
      _thread.retVal=_this;return;
    },
    setOn :function _trc_Map_setOn(setCol,setRow,p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=68003141;//kernel.Map:3141
      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
        return _this;
      }
      //$LASTPOS=68003209;//kernel.Map:3209
      _this.set(setCol,setRow,_this.mapTable[setRow][setCol]);
      //$LASTPOS=68003259;//kernel.Map:3259
      _this.mapOnTable[setRow][setCol]=p;
      //$LASTPOS=68003294;//kernel.Map:3294
      _this.ctx=_this.buf[0].getContext("2d");
      //$LASTPOS=68003328;//kernel.Map:3328
      p=Math.floor(p);
      //$LASTPOS=68003350;//kernel.Map:3350
      _this.pImg=Tonyu.globals.$imageList[p];
      //$LASTPOS=68003375;//kernel.Map:3375
      if (! _this.pImg) {
        return _this;
      }
      //$LASTPOS=68003399;//kernel.Map:3399
      _this.ctx.save();
      //$LASTPOS=68003416;//kernel.Map:3416
      _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);
      //$LASTPOS=68003560;//kernel.Map:3560
      _this.ctx.restore();
    },
    fiber$setOn :function _trc_Map_f_setOn(_thread,setCol,setRow,p) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=68003141;//kernel.Map:3141
      if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
        _thread.retVal=_this;return;
        
      }
      
      _thread.enter(function _trc_Map_ent_setOn(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=68003209;//kernel.Map:3209
            _this.fiber$set(_thread, setCol, setRow, _this.mapTable[setRow][setCol]);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=68003259;//kernel.Map:3259
            _this.mapOnTable[setRow][setCol]=p;
            //$LASTPOS=68003294;//kernel.Map:3294
            _this.ctx=_this.buf[0].getContext("2d");
            //$LASTPOS=68003328;//kernel.Map:3328
            p=Math.floor(p);
            //$LASTPOS=68003350;//kernel.Map:3350
            _this.pImg=Tonyu.globals.$imageList[p];
            //$LASTPOS=68003375;//kernel.Map:3375
            if (!(! _this.pImg)) { __pc=2     ; break; }
            _thread.exit(_this);return;
          case 2     :
            
            //$LASTPOS=68003399;//kernel.Map:3399
            _this.ctx.save();
            //$LASTPOS=68003416;//kernel.Map:3416
            _this.ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,setCol*_this.chipWidth,setRow*_this.chipHeight,_this.chipWidth,_this.chipHeight);
            //$LASTPOS=68003560;//kernel.Map:3560
            _this.ctx.restore();
            _thread.exit(_this);return;
          }
        }
      });
    },
    setOnAt :function _trc_Map_setOnAt(setX,setY,p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=68003607;//kernel.Map:3607
      _this.setOn(Math.floor((setX-_this.sx)/_this.chipWidth),Math.floor((setY-_this.sy)/_this.chipHeight),p);
    },
    fiber$setOnAt :function _trc_Map_f_setOnAt(_thread,setX,setY,p) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Map_ent_setOnAt(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=68003607;//kernel.Map:3607
            _this.fiber$setOn(_thread, Math.floor((setX-_this.sx)/_this.chipWidth), Math.floor((setY-_this.sy)/_this.chipHeight), p);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    setAt :function _trc_Map_setAt(setX,setY,p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=68003712;//kernel.Map:3712
      _this.set(Math.floor((setX-_this.sx)/_this.chipWidth),Math.floor((setY-_this.sy)/_this.chipHeight),p);
    },
    fiber$setAt :function _trc_Map_f_setAt(_thread,setX,setY,p) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Map_ent_setAt(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=68003712;//kernel.Map:3712
            _this.fiber$set(_thread, Math.floor((setX-_this.sx)/_this.chipWidth), Math.floor((setY-_this.sy)/_this.chipHeight), p);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    get :function _trc_Map_get(getCol,getRow) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=68003815;//kernel.Map:3815
      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {
        return _this.mapTable[getRow][getCol];
      }
      return - 1;
    },
    fiber$get :function _trc_Map_f_get(_thread,getCol,getRow) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=68003815;//kernel.Map:3815
      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {
        _thread.retVal=_this.mapTable[getRow][getCol];return;
        
      }
      _thread.retVal=- 1;return;
      
      
      _thread.retVal=_this;return;
    },
    getAt :function _trc_Map_getAt(getX,getY) {
      "use strict";
      var _this=this;
      
      return _this.get(Math.floor((getX-_this.sx)/_this.chipWidth),Math.floor((getY-_this.sy)/_this.chipHeight));
    },
    fiber$getAt :function _trc_Map_f_getAt(_thread,getX,getY) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Map_ent_getAt(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$get(_thread, Math.floor((getX-_this.sx)/_this.chipWidth), Math.floor((getY-_this.sy)/_this.chipHeight));
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    getOn :function _trc_Map_getOn(getCol,getRow) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=68004057;//kernel.Map:4057
      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {
        return _this.mapOnTable[getRow][getCol];
      }
      return - 1;
    },
    fiber$getOn :function _trc_Map_f_getOn(_thread,getCol,getRow) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=68004057;//kernel.Map:4057
      if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {
        _thread.retVal=_this.mapOnTable[getRow][getCol];return;
        
      }
      _thread.retVal=- 1;return;
      
      
      _thread.retVal=_this;return;
    },
    getOnAt :function _trc_Map_getOnAt(getX,getY) {
      "use strict";
      var _this=this;
      
      return _this.getOn(Math.floor((getX-_this.sx)/_this.chipWidth),Math.floor((getY-_this.sy)/_this.chipHeight));
    },
    fiber$getOnAt :function _trc_Map_f_getOnAt(_thread,getX,getY) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Map_ent_getOnAt(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$getOn(_thread, Math.floor((getX-_this.sx)/_this.chipWidth), Math.floor((getY-_this.sy)/_this.chipHeight));
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    scrollTo :function _trc_Map_scrollTo(scrollX,scrollY) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=68004310;//kernel.Map:4310
      _this.sx=- scrollX;
      //$LASTPOS=68004328;//kernel.Map:4328
      _this.sy=- scrollY;
    },
    fiber$scrollTo :function _trc_Map_f_scrollTo(_thread,scrollX,scrollY) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=68004310;//kernel.Map:4310
      _this.sx=- scrollX;
      //$LASTPOS=68004328;//kernel.Map:4328
      _this.sy=- scrollY;
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_Map_draw(ctx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=68004363;//kernel.Map:4363
      _this.pImg=_this.buf[0];
      //$LASTPOS=68004381;//kernel.Map:4381
      ctx.save();
      //$LASTPOS=68004398;//kernel.Map:4398
      ctx.globalAlpha=_this.alpha/255;
      //$LASTPOS=68004430;//kernel.Map:4430
      ctx.drawImage(_this.pImg,0,0,_this.col*_this.chipWidth,_this.row*_this.chipHeight,_this.sx,_this.sy,_this.col*_this.chipWidth,_this.row*_this.chipHeight);
      //$LASTPOS=68004542;//kernel.Map:4542
      ctx.restore();
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"initMap":{"nowait":false},"redrawMap":{"nowait":false},"redraw":{"nowait":false},"load":{"nowait":false},"save":{"nowait":false},"set":{"nowait":false},"setOn":{"nowait":false},"setOnAt":{"nowait":false},"setAt":{"nowait":false},"get":{"nowait":false},"getAt":{"nowait":false},"getOn":{"nowait":false},"getOnAt":{"nowait":false},"scrollTo":{"nowait":false},"draw":{"nowait":true}},"fields":{"sx":{},"sy":{},"chipWidth":{},"chipHeight":{},"col":{},"row":{},"buf":{},"mapObj":{},"mapTable":{},"mapOnTable":{},"rows":{},"mapData":{},"mapOnData":{},"baseData":{},"ctx":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Panel',
  shortName: 'Panel',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_Panel_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_Panel_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Panel_initialize(opt) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69002897;//kernel.Panel:2897
      Tonyu.classes.kernel.Actor.apply( _this, [opt]);
      //$LASTPOS=69002966;//kernel.Panel:2966
      if (_this.canvas) {
        //$LASTPOS=69002989;//kernel.Panel:2989
        _this.width=_this.canvas.width;
        //$LASTPOS=69003018;//kernel.Panel:3018
        _this.height=_this.canvas.height;
        //$LASTPOS=69003049;//kernel.Panel:3049
        _this.parallel("watchResize");
        
      } else {
        //$LASTPOS=69003097;//kernel.Panel:3097
        _this.setPanel(_this.width||Tonyu.globals.$screenWidth||465,_this.height||Tonyu.globals.$screenHeight||465);
        
      }
      //$LASTPOS=69003221;//kernel.Panel:3221
      if (_this._fillStyle&&_this.canvas) {
        //$LASTPOS=69003247;//kernel.Panel:3247
        _this.canvas.getContext("2d").fillStyle=_this._fillStyle+"";
      }
      //$LASTPOS=69003301;//kernel.Panel:3301
      _this.x=_this.x||_this.width/2;
      //$LASTPOS=69003320;//kernel.Panel:3320
      _this.y=_this.y||_this.height/2;
      //$LASTPOS=69003340;//kernel.Panel:3340
      if (_this.align==null) {
        //$LASTPOS=69003356;//kernel.Panel:3356
        _this.align="center";
      }
      //$LASTPOS=69003377;//kernel.Panel:3377
      if (_this.alpha==null) {
        //$LASTPOS=69003393;//kernel.Panel:3393
        _this.alpha=255;
      }
      //$LASTPOS=69003409;//kernel.Panel:3409
      if (_this._drawn==null) {
        //$LASTPOS=69003426;//kernel.Panel:3426
        _this._drawn=false;
      }
    },
    watchResize :function _trc_Panel_watchResize() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69003466;//kernel.Panel:3466
      while (true) {
        //$LASTPOS=69003489;//kernel.Panel:3489
        if (_this.width!=_this.canvas.width||_this.height!=_this.canvas.height) {
          //$LASTPOS=69003554;//kernel.Panel:3554
          _this.width=_this.canvas.width;
          //$LASTPOS=69003573;//kernel.Panel:3573
          _this.height=_this.canvas.height;
          //$LASTPOS=69003608;//kernel.Panel:3608
          _this.fireEvent("resize",{width: _this.width,height: _this.height});
          
        }
        //$LASTPOS=69003664;//kernel.Panel:3664
        _this.update();
        
      }
    },
    fiber$watchResize :function _trc_Panel_f_watchResize(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Panel_ent_watchResize(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=69003466;//kernel.Panel:3466
          case 1:
            //$LASTPOS=69003489;//kernel.Panel:3489
            if (_this.width!=_this.canvas.width||_this.height!=_this.canvas.height) {
              //$LASTPOS=69003554;//kernel.Panel:3554
              _this.width=_this.canvas.width;
              //$LASTPOS=69003573;//kernel.Panel:3573
              _this.height=_this.canvas.height;
              //$LASTPOS=69003608;//kernel.Panel:3608
              _this.fireEvent("resize",{width: _this.width,height: _this.height});
              
            }
            //$LASTPOS=69003664;//kernel.Panel:3664
            _this.fiber$update(_thread);
            __pc=2;return;
          case 2:
            
            __pc=1;break;
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    setPanel :function _trc_Panel_setPanel(width,height) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69003744;//kernel.Panel:3744
      _this.width=_this.trunc(width);
      //$LASTPOS=69003774;//kernel.Panel:3774
      _this.height=_this.trunc(height);
      //$LASTPOS=69003806;//kernel.Panel:3806
      _this.buf=$("<canvas>").attr({width: width,height: height});
      //$LASTPOS=69003849;//kernel.Panel:3849
      _this.canvas=_this.buf[0];
      //$LASTPOS=69003869;//kernel.Panel:3869
      _this.imageSmoothingEnabled=! Tonyu.globals.$imageSmoothingDisabled;
      //$LASTPOS=69003922;//kernel.Panel:3922
      _this._drawn=false;
      //$LASTPOS=69003941;//kernel.Panel:3941
      _this.fireEvent("resize",{width: width,height: height,force: true});
    },
    fiber$setPanel :function _trc_Panel_f_setPanel(_thread,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=69003744;//kernel.Panel:3744
      _this.width=_this.trunc(width);
      //$LASTPOS=69003774;//kernel.Panel:3774
      _this.height=_this.trunc(height);
      //$LASTPOS=69003806;//kernel.Panel:3806
      _this.buf=$("<canvas>").attr({width: width,height: height});
      //$LASTPOS=69003849;//kernel.Panel:3849
      _this.canvas=_this.buf[0];
      //$LASTPOS=69003869;//kernel.Panel:3869
      _this.imageSmoothingEnabled=! Tonyu.globals.$imageSmoothingDisabled;
      //$LASTPOS=69003922;//kernel.Panel:3922
      _this._drawn=false;
      //$LASTPOS=69003941;//kernel.Panel:3941
      _this.fireEvent("resize",{width: width,height: height,force: true});
      
      _thread.retVal=_this;return;
    },
    resize :function _trc_Panel_resize(width,height) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69004020;//kernel.Panel:4020
      if (_this.width==width&&_this.height==height) {
        return _this;
      }
      //$LASTPOS=69004079;//kernel.Panel:4079
      _this.setPanel(width,height);
    },
    fiber$resize :function _trc_Panel_f_resize(_thread,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=69004020;//kernel.Panel:4020
      if (_this.width==width&&_this.height==height) {
        _thread.retVal=_this;return;
        
      }
      
      _thread.enter(function _trc_Panel_ent_resize(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=69004079;//kernel.Panel:4079
            _this.fiber$setPanel(_thread, width, height);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    getContext :function _trc_Panel_getContext() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69004127;//kernel.Panel:4127
      _this._drawn=true;
      return _this.canvas.getContext("2d");
    },
    fiber$getContext :function _trc_Panel_f_getContext(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=69004127;//kernel.Panel:4127
      _this._drawn=true;
      _thread.retVal=_this.canvas.getContext("2d");return;
      
      
      _thread.retVal=_this;return;
    },
    __getter__context :function _trc_Panel___getter__context() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69004197;//kernel.Panel:4197
      _this._drawn=true;
      return _this.canvas.getContext("2d");
    },
    __getter__image :function _trc_Panel___getter__image() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69004265;//kernel.Panel:4265
      _this._drawn=true;
      return _this.canvas;
    },
    setFillStyle :function _trc_Panel_setFillStyle(color) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69004329;//kernel.Panel:4329
      _this.fillStyle=color;
    },
    fiber$setFillStyle :function _trc_Panel_f_setFillStyle(_thread,color) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=69004329;//kernel.Panel:4329
      _this.fillStyle=color;
      
      _thread.retVal=_this;return;
    },
    __getter__fillStyle :function _trc_Panel___getter__fillStyle() {
      "use strict";
      var _this=this;
      
      return _this._fillStyle;
    },
    __setter__fillStyle :function _trc_Panel___setter__fillStyle(val) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69004413;//kernel.Panel:4413
      _this._fillStyle=val;
      //$LASTPOS=69004434;//kernel.Panel:4434
      if (! _this.canvas) {
        return _this;
      }
      //$LASTPOS=69004460;//kernel.Panel:4460
      _this.context.fillStyle=val+"";
    },
    __setter__strokeStyle :function _trc_Panel___setter__strokeStyle(val) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69004514;//kernel.Panel:4514
      _this.context.strokeStyle=val+"";
    },
    __setter__lineWidth :function _trc_Panel___setter__lineWidth(val) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69004568;//kernel.Panel:4568
      _this.context.lineWidth=val;
    },
    fillCircle :function _trc_Panel_fillCircle(x,y,r) {
      "use strict";
      var _this=this;
      var ctx;
      
      //$LASTPOS=69004621;//kernel.Panel:4621
      ctx = _this.context;
      
      //$LASTPOS=69004643;//kernel.Panel:4643
      ctx.fillStyle=_this.fillStyle+"";
      //$LASTPOS=69004676;//kernel.Panel:4676
      ctx.beginPath();
      //$LASTPOS=69004698;//kernel.Panel:4698
      ctx.arc(x,y,r,0,2*Tonyu.globals.$Math.PI);
      //$LASTPOS=69004732;//kernel.Panel:4732
      ctx.closePath();
      //$LASTPOS=69004754;//kernel.Panel:4754
      ctx.fill();
    },
    fiber$fillCircle :function _trc_Panel_f_fillCircle(_thread,x,y,r) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      
      //$LASTPOS=69004621;//kernel.Panel:4621
      ctx = _this.context;
      
      //$LASTPOS=69004643;//kernel.Panel:4643
      ctx.fillStyle=_this.fillStyle+"";
      //$LASTPOS=69004676;//kernel.Panel:4676
      ctx.beginPath();
      //$LASTPOS=69004698;//kernel.Panel:4698
      ctx.arc(x,y,r,0,2*Tonyu.globals.$Math.PI);
      //$LASTPOS=69004732;//kernel.Panel:4732
      ctx.closePath();
      //$LASTPOS=69004754;//kernel.Panel:4754
      ctx.fill();
      
      _thread.retVal=_this;return;
    },
    fillRect :function _trc_Panel_fillRect(x,y,w,h) {
      "use strict";
      var _this=this;
      var ctx;
      
      //$LASTPOS=69004795;//kernel.Panel:4795
      ctx = _this.getContext();
      
      //$LASTPOS=69004876;//kernel.Panel:4876
      ctx.fillRect(x,y,w,h);
    },
    fillText :function _trc_Panel_fillText(text,x,y,size,align) {
      "use strict";
      var _this=this;
      var ctx;
      var splits;
      var f;
      var colCount;
      
      //$LASTPOS=69004962;//kernel.Panel:4962
      ctx = _this.getContext();
      
      //$LASTPOS=69004989;//kernel.Panel:4989
      ctx.save();
      //$LASTPOS=69005006;//kernel.Panel:5006
      text=text+"";
      //$LASTPOS=69005025;//kernel.Panel:5025
      splits = text.split("\n");
      
      //$LASTPOS=69005111;//kernel.Panel:5111
      ctx.textAlign=align||"center";
      //$LASTPOS=69005150;//kernel.Panel:5150
      size=size||15;
      //$LASTPOS=69005170;//kernel.Panel:5170
      ctx.fillStyle=_this.fillStyle+"";
      //$LASTPOS=69005203;//kernel.Panel:5203
      f = ctx.font.replace(/^[0-9\.]+/,"");
      
      //$LASTPOS=69005248;//kernel.Panel:5248
      ctx.font=size+f;
      //$LASTPOS=69005270;//kernel.Panel:5270
      //$LASTPOS=69005274;//kernel.Panel:5274
      colCount = 0;
      for (; colCount<splits.length ; colCount++) {
        {
          //$LASTPOS=69005334;//kernel.Panel:5334
          ctx.fillText(splits[colCount],x,y);
          //$LASTPOS=69005379;//kernel.Panel:5379
          y+=size;
        }
      }
      //$LASTPOS=69005400;//kernel.Panel:5400
      ctx.restore();
    },
    fiber$fillText :function _trc_Panel_f_fillText(_thread,text,x,y,size,align) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      var splits;
      var f;
      var colCount;
      
      
      _thread.enter(function _trc_Panel_ent_fillText(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=69004962;//kernel.Panel:4962
            _this.fiber$getContext(_thread);
            __pc=1;return;
          case 1:
            ctx=_thread.retVal;
            
            //$LASTPOS=69004989;//kernel.Panel:4989
            ctx.save();
            //$LASTPOS=69005006;//kernel.Panel:5006
            text=text+"";
            //$LASTPOS=69005025;//kernel.Panel:5025
            splits = text.split("\n");
            
            //$LASTPOS=69005111;//kernel.Panel:5111
            ctx.textAlign=align||"center";
            //$LASTPOS=69005150;//kernel.Panel:5150
            size=size||15;
            //$LASTPOS=69005170;//kernel.Panel:5170
            ctx.fillStyle=_this.fillStyle+"";
            //$LASTPOS=69005203;//kernel.Panel:5203
            f = ctx.font.replace(/^[0-9\.]+/,"");
            
            //$LASTPOS=69005248;//kernel.Panel:5248
            ctx.font=size+f;
            //$LASTPOS=69005270;//kernel.Panel:5270
            //$LASTPOS=69005274;//kernel.Panel:5274
            colCount = 0;
            for (; colCount<splits.length ; colCount++) {
              {
                //$LASTPOS=69005334;//kernel.Panel:5334
                ctx.fillText(splits[colCount],x,y);
                //$LASTPOS=69005379;//kernel.Panel:5379
                y+=size;
              }
            }
            //$LASTPOS=69005400;//kernel.Panel:5400
            ctx.restore();
            _thread.exit(_this);return;
          }
        }
      });
    },
    clearRect :function _trc_Panel_clearRect(clearX,clearY,clearW,clearH) {
      "use strict";
      var _this=this;
      var ctx;
      
      //$LASTPOS=69005465;//kernel.Panel:5465
      ctx = _this.getContext();
      
      //$LASTPOS=69005492;//kernel.Panel:5492
      ctx.save();
      //$LASTPOS=69005509;//kernel.Panel:5509
      ctx.clearRect(clearX||0,clearY||0,clearW||_this.width,clearH||_this.height);
      //$LASTPOS=69005579;//kernel.Panel:5579
      ctx.restore();
      //$LASTPOS=69005599;//kernel.Panel:5599
      if (arguments.length==0) {
        //$LASTPOS=69005624;//kernel.Panel:5624
        _this._drawn=false;
      }
    },
    fiber$clearRect :function _trc_Panel_f_clearRect(_thread,clearX,clearY,clearW,clearH) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      
      
      _thread.enter(function _trc_Panel_ent_clearRect(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=69005465;//kernel.Panel:5465
            _this.fiber$getContext(_thread);
            __pc=1;return;
          case 1:
            ctx=_thread.retVal;
            
            //$LASTPOS=69005492;//kernel.Panel:5492
            ctx.save();
            //$LASTPOS=69005509;//kernel.Panel:5509
            ctx.clearRect(clearX||0,clearY||0,clearW||_this.width,clearH||_this.height);
            //$LASTPOS=69005579;//kernel.Panel:5579
            ctx.restore();
            //$LASTPOS=69005599;//kernel.Panel:5599
            if (_arguments.length==0) {
              //$LASTPOS=69005624;//kernel.Panel:5624
              _this._drawn=false;
            }
            _thread.exit(_this);return;
          }
        }
      });
    },
    getPixel :function _trc_Panel_getPixel(getX,getY) {
      "use strict";
      var _this=this;
      var ctx;
      
      
      //$LASTPOS=69005683;//kernel.Panel:5683
      if (typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY)) {
        //$LASTPOS=69005781;//kernel.Panel:5781
        ctx=_this.getContext();
        //$LASTPOS=69005808;//kernel.Panel:5808
        _this.imagedata=ctx.getImageData(getX,getY,1,1);
        //$LASTPOS=69005860;//kernel.Panel:5860
        _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];
        
      } else {
        //$LASTPOS=69006000;//kernel.Panel:6000
        _this.colordata=[0,0,0,0];
        
      }
      return (_this.colordata);
    },
    fiber$getPixel :function _trc_Panel_f_getPixel(_thread,getX,getY) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      
      
      
      _thread.enter(function _trc_Panel_ent_getPixel(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=69005683;//kernel.Panel:5683
            if (!(typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY))) { __pc=2     ; break; }
            //$LASTPOS=69005781;//kernel.Panel:5781
            _this.fiber$getContext(_thread);
            __pc=1;return;
          case 1:
            ctx=_thread.retVal;
            
            //$LASTPOS=69005808;//kernel.Panel:5808
            _this.imagedata=ctx.getImageData(getX,getY,1,1);
            //$LASTPOS=69005860;//kernel.Panel:5860
            _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];
            __pc=3     ;break;
          case 2     :
            {
              //$LASTPOS=69006000;//kernel.Panel:6000
              _this.colordata=[0,0,0,0];
            }
          case 3     :
            
            _thread.exit((_this.colordata));return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    scroll :function _trc_Panel_scroll(scrollX,scrollY) {
      "use strict";
      var _this=this;
      var ctx;
      
      //$LASTPOS=69006087;//kernel.Panel:6087
      ctx = _this.getContext();
      
      //$LASTPOS=69006114;//kernel.Panel:6114
      ctx.save();
      //$LASTPOS=69006131;//kernel.Panel:6131
      _this.imagedata=ctx.getImageData(0,0,_this.width,_this.height);
      //$LASTPOS=69006192;//kernel.Panel:6192
      _this.clearRect(0,0,_this.width,_this.height);
      //$LASTPOS=69006226;//kernel.Panel:6226
      ctx.putImageData(_this.imagedata,- scrollX,- scrollY);
      //$LASTPOS=69006278;//kernel.Panel:6278
      ctx.restore();
    },
    fiber$scroll :function _trc_Panel_f_scroll(_thread,scrollX,scrollY) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      
      
      _thread.enter(function _trc_Panel_ent_scroll(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=69006087;//kernel.Panel:6087
            _this.fiber$getContext(_thread);
            __pc=1;return;
          case 1:
            ctx=_thread.retVal;
            
            //$LASTPOS=69006114;//kernel.Panel:6114
            ctx.save();
            //$LASTPOS=69006131;//kernel.Panel:6131
            _this.imagedata=ctx.getImageData(0,0,_this.width,_this.height);
            //$LASTPOS=69006192;//kernel.Panel:6192
            _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height);
            __pc=2;return;
          case 2:
            
            //$LASTPOS=69006226;//kernel.Panel:6226
            ctx.putImageData(_this.imagedata,- scrollX,- scrollY);
            //$LASTPOS=69006278;//kernel.Panel:6278
            ctx.restore();
            _thread.exit(_this);return;
          }
        }
      });
    },
    draw :function _trc_Panel_draw(ctx) {
      "use strict";
      var _this=this;
      var pImg;
      
      //$LASTPOS=69006314;//kernel.Panel:6314
      if (_this._drawn) {
        //$LASTPOS=69006335;//kernel.Panel:6335
        pImg = _this.canvas;
        
        //$LASTPOS=69006361;//kernel.Panel:6361
        ctx.save();
        //$LASTPOS=69006382;//kernel.Panel:6382
        if (_this.align=="left") {
          //$LASTPOS=69006414;//kernel.Panel:6414
          ctx.translate(_this.x+_this.width/2,_this.y+_this.height/2);
          
        } else {
          //$LASTPOS=69006466;//kernel.Panel:6466
          if (_this.align=="center") {
            //$LASTPOS=69006500;//kernel.Panel:6500
            ctx.translate(_this.x,_this.y);
            
          } else {
            //$LASTPOS=69006535;//kernel.Panel:6535
            if (_this.align=="right") {
              //$LASTPOS=69006568;//kernel.Panel:6568
              ctx.translate(_this.x-_this.width/2,_this.y-_this.height/2);
              
            }
          }
        }
        //$LASTPOS=69006625;//kernel.Panel:6625
        if (_this.rotation!=0) {
          //$LASTPOS=69006660;//kernel.Panel:6660
          ctx.rotate(_this.rotation/180*Math.PI);
          
        } else {
          //$LASTPOS=69006728;//kernel.Panel:6728
          ctx.rotate(_this.rotate/180*Math.PI);
          
        }
        //$LASTPOS=69006785;//kernel.Panel:6785
        if (typeof  _this.scaleY==="undefined") {
          //$LASTPOS=69006837;//kernel.Panel:6837
          ctx.scale(_this.scaleX,_this.scaleX);
          
        } else {
          //$LASTPOS=69006902;//kernel.Panel:6902
          ctx.scale(_this.scaleX,_this.scaleY);
          
        }
        //$LASTPOS=69006958;//kernel.Panel:6958
        ctx.globalAlpha=_this.alpha/255;
        //$LASTPOS=69006999;//kernel.Panel:6999
        ctx.drawImage(pImg,0,0,_this.width,_this.height,- _this.width/2,- _this.height/2,_this.width,_this.height);
        //$LASTPOS=69007103;//kernel.Panel:7103
        ctx.restore();
        
      }
    },
    drawSprite :function _trc_Panel_drawSprite(x,y,p,options) {
      "use strict";
      var _this=this;
      var pImg;
      var scaleX;
      var scaleY;
      var rotation;
      var ctx;
      
      //$LASTPOS=69007170;//kernel.Panel:7170
      pImg = Tonyu.globals.$imageList[p];
      
      //$LASTPOS=69007199;//kernel.Panel:7199
      if (! pImg) {
        return _this;
      }
      //$LASTPOS=69007223;//kernel.Panel:7223
      if (options===true) {
        //$LASTPOS=69007243;//kernel.Panel:7243
        options={f: true};
      }
      //$LASTPOS=69007266;//kernel.Panel:7266
      options=options||{};
      //$LASTPOS=69007292;//kernel.Panel:7292
      scaleX = typeof  (options.scaleX)==="number"?options.scaleX:1;
      
      //$LASTPOS=69007361;//kernel.Panel:7361
      scaleY = typeof  (options.scaleY)==="number"?options.scaleY:scaleX;
      
      //$LASTPOS=69007435;//kernel.Panel:7435
      rotation = options.rotation||options.angle||0;
      
      //$LASTPOS=69007489;//kernel.Panel:7489
      ctx = _this.context;
      
      //$LASTPOS=69007511;//kernel.Panel:7511
      if (options.f) {
        //$LASTPOS=69007526;//kernel.Panel:7526
        scaleX*=- 1;
      }
      //$LASTPOS=69007545;//kernel.Panel:7545
      ctx.save();
      //$LASTPOS=69007562;//kernel.Panel:7562
      ctx.translate(x,y);
      //$LASTPOS=69007587;//kernel.Panel:7587
      ctx.rotate(rotation/180*Math.PI);
      //$LASTPOS=69007626;//kernel.Panel:7626
      ctx.scale(scaleX,scaleY);
      //$LASTPOS=69007657;//kernel.Panel:7657
      ctx.drawImage(pImg.image,pImg.x,pImg.y,pImg.width,pImg.height,- pImg.width/2,- pImg.height/2,pImg.width,pImg.height);
      //$LASTPOS=69007797;//kernel.Panel:7797
      ctx.restore();
    },
    copy :function _trc_Panel_copy() {
      "use strict";
      var _this=this;
      var sx;
      var sy;
      var sw;
      var sh;
      var dx;
      var dy;
      var dw;
      var dh;
      var a;
      var srcPanel;
      var params;
      
      
      //$LASTPOS=69008035;//kernel.Panel:8035
      a = new Tonyu.classes.kernel.ArgParser(arguments);
      
      //$LASTPOS=69008072;//kernel.Panel:8072
      srcPanel = a.shift(Tonyu.classes.kernel.Panel)||_this;
      
      //$LASTPOS=69008114;//kernel.Panel:8114
      if (a.length<=4) {
        //$LASTPOS=69008142;//kernel.Panel:8142
        dx=a.shift();
        //$LASTPOS=69008165;//kernel.Panel:8165
        dy=a.shift();
        //$LASTPOS=69008188;//kernel.Panel:8188
        if (a.length==0) {
          //$LASTPOS=69008220;//kernel.Panel:8220
          _this.context.drawImage(srcPanel.image,dx,dy);
          
        } else {
          //$LASTPOS=69008293;//kernel.Panel:8293
          dw=a.shift();
          //$LASTPOS=69008320;//kernel.Panel:8320
          dh=a.shift();
          //$LASTPOS=69008347;//kernel.Panel:8347
          if (dw*dh!=0) {
            //$LASTPOS=69008380;//kernel.Panel:8380
            _this.context.drawImage(srcPanel.image,dx,dy,dw,dh);
            
          }
          
        }
        
      } else {
        //$LASTPOS=69008476;//kernel.Panel:8476
        sx=a.shift();
        //$LASTPOS=69008499;//kernel.Panel:8499
        sy=a.shift();
        //$LASTPOS=69008522;//kernel.Panel:8522
        sw=a.shift();
        //$LASTPOS=69008545;//kernel.Panel:8545
        sh=a.shift();
        //$LASTPOS=69008568;//kernel.Panel:8568
        dx=a.shift();
        //$LASTPOS=69008591;//kernel.Panel:8591
        if (typeof  dx==="object") {
          //$LASTPOS=69008632;//kernel.Panel:8632
          params = dx;
          
          
        }
        //$LASTPOS=69008718;//kernel.Panel:8718
        dy=a.shift();
        //$LASTPOS=69008741;//kernel.Panel:8741
        dw=a.shift()||sw;
        //$LASTPOS=69008770;//kernel.Panel:8770
        dh=a.shift()||sh;
        //$LASTPOS=69008849;//kernel.Panel:8849
        if (sw*sh*dw*dh!=0) {
          //$LASTPOS=69008884;//kernel.Panel:8884
          _this.context.drawImage(srcPanel.image,sx,sy,sw,sh,dx,dy,dw,dh);
          
        }
        
      }
    },
    convert :function _trc_Panel_convert(obj,toLayer) {
      "use strict";
      var _this=this;
      var fromLayer;
      var scaleY;
      var dx;
      var dy;
      var rt;
      var x;
      var y;
      
      //$LASTPOS=69009402;//kernel.Panel:9402
      fromLayer = obj.layer;
      
      //$LASTPOS=69009432;//kernel.Panel:9432
      if (fromLayer==null&&toLayer==null) {
        //$LASTPOS=69009481;//kernel.Panel:9481
        fromLayer=_this;
        //$LASTPOS=69009496;//kernel.Panel:9496
        toLayer=_this.layer;
        
      } else {
        //$LASTPOS=69009523;//kernel.Panel:9523
        if (fromLayer==null&&toLayer===_this.layer) {
          //$LASTPOS=69009574;//kernel.Panel:9574
          fromLayer=_this;
          
        } else {
          //$LASTPOS=69009602;//kernel.Panel:9602
          if (fromLayer===_this&&toLayer==null) {
            //$LASTPOS=69009652;//kernel.Panel:9652
            toLayer=_this.layer;
            
          } else {
            //$LASTPOS=69009679;//kernel.Panel:9679
            if (fromLayer==null&&toLayer===_this) {
              //$LASTPOS=69009729;//kernel.Panel:9729
              fromLayer=_this.layer;
              
            } else {
              //$LASTPOS=69009758;//kernel.Panel:9758
              if (fromLayer===_this.layer&&toLayer==null) {
                //$LASTPOS=69009809;//kernel.Panel:9809
                toLayer=_this;
                
              }
            }
          }
        }
      }
      //$LASTPOS=69009835;//kernel.Panel:9835
      if (fromLayer===toLayer) {
        return obj;
      }
      //$LASTPOS=69009877;//kernel.Panel:9877
      scaleY = _this.scaleY||_this.scaleX;
      
      //$LASTPOS=69009914;//kernel.Panel:9914
      if (fromLayer==null||toLayer==null) {
        throw new Error("layer not set");
        
      }
      //$LASTPOS=69009991;//kernel.Panel:9991
      if (fromLayer===_this&&toLayer===_this.layer) {
        //$LASTPOS=69010072;//kernel.Panel:10072
        dx = obj.x-_this.width/2;
        
        //$LASTPOS=69010103;//kernel.Panel:10103
        dy = obj.y-_this.height/2;
        
        //$LASTPOS=69010135;//kernel.Panel:10135
        rt = _this.rotation;
        
        //$LASTPOS=69010333;//kernel.Panel:10333
        x = _this.x+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)*_this.scaleX;
        
        //$LASTPOS=69010390;//kernel.Panel:10390
        y = _this.y+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)*scaleY;
        
        return {x: x,y: y,rotation: obj.rotation,scale: obj.scale,layer: toLayer};
        
      } else {
        //$LASTPOS=69010577;//kernel.Panel:10577
        if (fromLayer===_this.layer&&toLayer===_this) {
          //$LASTPOS=69010658;//kernel.Panel:10658
          rt = - _this.rotation;
          
          //$LASTPOS=69010685;//kernel.Panel:10685
          dx = obj.x-(_this.x);
          
          //$LASTPOS=69010717;//kernel.Panel:10717
          dy = obj.y-(_this.y);
          
          //$LASTPOS=69010973;//kernel.Panel:10973
          x = _this.width/2+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)/_this.scaleX;
          
          //$LASTPOS=69011033;//kernel.Panel:11033
          y = _this.height/2+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)/scaleY;
          
          return {x: x,y: y,rotation: rt,scale: 1/_this.scaleX,layer: toLayer};
          
        } else {
          //$LASTPOS=69011224;//kernel.Panel:11224
          _this.print("no support",obj.layer,toLayer);
          throw new Error("not support");
          
          
        }
      }
    },
    fiber$convert :function _trc_Panel_f_convert(_thread,obj,toLayer) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var fromLayer;
      var scaleY;
      var dx;
      var dy;
      var rt;
      var x;
      var y;
      
      //$LASTPOS=69009402;//kernel.Panel:9402
      fromLayer = obj.layer;
      
      //$LASTPOS=69009432;//kernel.Panel:9432
      if (fromLayer==null&&toLayer==null) {
        //$LASTPOS=69009481;//kernel.Panel:9481
        fromLayer=_this;
        //$LASTPOS=69009496;//kernel.Panel:9496
        toLayer=_this.layer;
        
      } else {
        //$LASTPOS=69009523;//kernel.Panel:9523
        if (fromLayer==null&&toLayer===_this.layer) {
          //$LASTPOS=69009574;//kernel.Panel:9574
          fromLayer=_this;
          
        } else {
          //$LASTPOS=69009602;//kernel.Panel:9602
          if (fromLayer===_this&&toLayer==null) {
            //$LASTPOS=69009652;//kernel.Panel:9652
            toLayer=_this.layer;
            
          } else {
            //$LASTPOS=69009679;//kernel.Panel:9679
            if (fromLayer==null&&toLayer===_this) {
              //$LASTPOS=69009729;//kernel.Panel:9729
              fromLayer=_this.layer;
              
            } else {
              //$LASTPOS=69009758;//kernel.Panel:9758
              if (fromLayer===_this.layer&&toLayer==null) {
                //$LASTPOS=69009809;//kernel.Panel:9809
                toLayer=_this;
                
              }
            }
          }
        }
      }
      //$LASTPOS=69009835;//kernel.Panel:9835
      if (fromLayer===toLayer) {
        _thread.retVal=obj;return;
        
      }
      //$LASTPOS=69009877;//kernel.Panel:9877
      scaleY = _this.scaleY||_this.scaleX;
      
      //$LASTPOS=69009914;//kernel.Panel:9914
      if (fromLayer==null||toLayer==null) {
        throw new Error("layer not set");
        
      }
      //$LASTPOS=69009991;//kernel.Panel:9991
      if (fromLayer===_this&&toLayer===_this.layer) {
        //$LASTPOS=69010072;//kernel.Panel:10072
        dx = obj.x-_this.width/2;
        
        //$LASTPOS=69010103;//kernel.Panel:10103
        dy = obj.y-_this.height/2;
        
        //$LASTPOS=69010135;//kernel.Panel:10135
        rt = _this.rotation;
        
        //$LASTPOS=69010333;//kernel.Panel:10333
        x = _this.x+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)*_this.scaleX;
        
        //$LASTPOS=69010390;//kernel.Panel:10390
        y = _this.y+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)*scaleY;
        
        _thread.retVal={x: x,y: y,rotation: obj.rotation,scale: obj.scale,layer: toLayer};return;
        
        
      } else {
        //$LASTPOS=69010577;//kernel.Panel:10577
        if (fromLayer===_this.layer&&toLayer===_this) {
          //$LASTPOS=69010658;//kernel.Panel:10658
          rt = - _this.rotation;
          
          //$LASTPOS=69010685;//kernel.Panel:10685
          dx = obj.x-(_this.x);
          
          //$LASTPOS=69010717;//kernel.Panel:10717
          dy = obj.y-(_this.y);
          
          //$LASTPOS=69010973;//kernel.Panel:10973
          x = _this.width/2+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)/_this.scaleX;
          
          //$LASTPOS=69011033;//kernel.Panel:11033
          y = _this.height/2+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)/scaleY;
          
          _thread.retVal={x: x,y: y,rotation: rt,scale: 1/_this.scaleX,layer: toLayer};return;
          
          
        } else {
          //$LASTPOS=69011224;//kernel.Panel:11224
          _this.print("no support",obj.layer,toLayer);
          throw new Error("not support");
          
          
        }
      }
      
      _thread.retVal=_this;return;
    },
    drawLine :function _trc_Panel_drawLine(x,y,dx,dy) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69011344;//kernel.Panel:11344
      if (dx==null&&dy==null) {
        //$LASTPOS=69011381;//kernel.Panel:11381
        if (x==null&&y==null) {
          //$LASTPOS=69011420;//kernel.Panel:11420
          _this.px=null;
          //$LASTPOS=69011428;//kernel.Panel:11428
          _this.py=null;
          return _this;
          
        }
        //$LASTPOS=69011464;//kernel.Panel:11464
        if (_this.px==null&&_this.py==null) {
          //$LASTPOS=69011505;//kernel.Panel:11505
          _this.px=x;
          //$LASTPOS=69011510;//kernel.Panel:11510
          _this.py=y;
          return _this;
          
        }
        //$LASTPOS=69011543;//kernel.Panel:11543
        dx=x;
        //$LASTPOS=69011548;//kernel.Panel:11548
        dy=y;
        //$LASTPOS=69011553;//kernel.Panel:11553
        x=_this.px;
        //$LASTPOS=69011558;//kernel.Panel:11558
        y=_this.py;
        //$LASTPOS=69011563;//kernel.Panel:11563
        _this.px=dx;
        //$LASTPOS=69011569;//kernel.Panel:11569
        _this.py=dy;
        
      }
      //$LASTPOS=69011588;//kernel.Panel:11588
      _this.context.beginPath();
      //$LASTPOS=69011614;//kernel.Panel:11614
      _this.context.moveTo(x,y);
      //$LASTPOS=69011640;//kernel.Panel:11640
      _this.context.lineTo(dx,dy);
      //$LASTPOS=69011668;//kernel.Panel:11668
      _this.context.stroke();
    },
    slicePattern :function _trc_Panel_slicePattern(x,y,width,height) {
      "use strict";
      var _this=this;
      
      return {image: _this.canvas,x: x,y: y,width: width,height: height};
    },
    fiber$slicePattern :function _trc_Panel_f_slicePattern(_thread,x,y,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal={image: _this.canvas,x: x,y: y,width: width,height: height};return;
      
      
      _thread.retVal=_this;return;
    },
    addPattern :function _trc_Panel_addPattern(x,y,width,height) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69011810;//kernel.Panel:11810
      Tonyu.globals.$imageList.push(_this.slicePattern(x,y,width,height));
      return Tonyu.globals.$imageList.length-1;
    },
    fiber$addPattern :function _trc_Panel_f_addPattern(_thread,x,y,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=69011810;//kernel.Panel:11810
      Tonyu.globals.$imageList.push(_this.slicePattern(x,y,width,height));
      _thread.retVal=Tonyu.globals.$imageList.length-1;return;
      
      
      _thread.retVal=_this;return;
    },
    getImageData :function _trc_Panel_getImageData(x,y,width,height) {
      "use strict";
      var _this=this;
      
      return _this.context.getImageData(x,y,width,height);
    },
    fiber$getImageData :function _trc_Panel_f_getImageData(_thread,x,y,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.context.getImageData(x,y,width,height);return;
      
      
      _thread.retVal=_this;return;
    },
    putImageData :function _trc_Panel_putImageData(data,x,y) {
      "use strict";
      var _this=this;
      
      return _this.context.putImageData(data,x,y);
    },
    fiber$putImageData :function _trc_Panel_f_putImageData(_thread,data,x,y) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.context.putImageData(data,x,y);return;
      
      
      _thread.retVal=_this;return;
    },
    replace :function _trc_Panel_replace(x,y,width,height,replacement) {
      "use strict";
      var _this=this;
      
    },
    fiber$replace :function _trc_Panel_f_replace(_thread,x,y,width,height,replacement) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    save :function _trc_Panel_save(fn) {
      "use strict";
      var _this=this;
      var url;
      
      //$LASTPOS=69012126;//kernel.Panel:12126
      url = _this.buf[0].toDataURL();
      
      //$LASTPOS=69012159;//kernel.Panel:12159
      if (typeof  fn==="string") {
        //$LASTPOS=69012185;//kernel.Panel:12185
        fn=_this.file(fn);
      }
      return fn.text(url);
    },
    fiber$save :function _trc_Panel_f_save(_thread,fn) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var url;
      
      //$LASTPOS=69012126;//kernel.Panel:12126
      url = _this.buf[0].toDataURL();
      
      
      _thread.enter(function _trc_Panel_ent_save(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=69012159;//kernel.Panel:12159
            if (!(typeof  fn==="string")) { __pc=2     ; break; }
            //$LASTPOS=69012185;//kernel.Panel:12185
            _this.fiber$file(_thread, fn);
            __pc=1;return;
          case 1:
            fn=_thread.retVal;
            
          case 2     :
            
            _thread.exit(fn.text(url));return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    load :function _trc_Panel_load(fn) {
      "use strict";
      var _this=this;
      var d;
      var url;
      var element;
      
      //$LASTPOS=69012247;//kernel.Panel:12247
      if (typeof  fn==="string") {
        //$LASTPOS=69012273;//kernel.Panel:12273
        fn=_this.file(fn);
      }
      //$LASTPOS=69012291;//kernel.Panel:12291
      d = new $.Deferred();
      
      //$LASTPOS=69012320;//kernel.Panel:12320
      url = fn.text();
      
      //$LASTPOS=69012344;//kernel.Panel:12344
      element = $("<img>").css({display: "none"}).appendTo("body");
      
      //$LASTPOS=69012410;//kernel.Panel:12410
      element.on("load",(function anonymous_12429() {
        var img;
        var width;
        var height;
        
        //$LASTPOS=69012441;//kernel.Panel:12441
        img = new Image();
        
        //$LASTPOS=69012473;//kernel.Panel:12473
        img.src=element.attr('src');
        //$LASTPOS=69012513;//kernel.Panel:12513
        width = img.width;
        
        //$LASTPOS=69012545;//kernel.Panel:12545
        height = img.height;
        
        //$LASTPOS=69012611;//kernel.Panel:12611
        _this.resize(width,height);
        //$LASTPOS=69012642;//kernel.Panel:12642
        _this.context.drawImage(img,0,0);
        //$LASTPOS=69012680;//kernel.Panel:12680
        d.resolve(_this);
      }));
      //$LASTPOS=69012710;//kernel.Panel:12710
      element.attr({src: url});
      return d.promise();
    },
    fiber$load :function _trc_Panel_f_load(_thread,fn) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var d;
      var url;
      var element;
      
      
      _thread.enter(function _trc_Panel_ent_load(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=69012247;//kernel.Panel:12247
            if (!(typeof  fn==="string")) { __pc=2     ; break; }
            //$LASTPOS=69012273;//kernel.Panel:12273
            _this.fiber$file(_thread, fn);
            __pc=1;return;
          case 1:
            fn=_thread.retVal;
            
          case 2     :
            
            //$LASTPOS=69012291;//kernel.Panel:12291
            d = new $.Deferred();
            
            //$LASTPOS=69012320;//kernel.Panel:12320
            url = fn.text();
            
            //$LASTPOS=69012344;//kernel.Panel:12344
            element = $("<img>").css({display: "none"}).appendTo("body");
            
            //$LASTPOS=69012410;//kernel.Panel:12410
            element.on("load",(function anonymous_12429() {
              var img;
              var width;
              var height;
              
              //$LASTPOS=69012441;//kernel.Panel:12441
              img = new Image();
              
              //$LASTPOS=69012473;//kernel.Panel:12473
              img.src=element.attr('src');
              //$LASTPOS=69012513;//kernel.Panel:12513
              width = img.width;
              
              //$LASTPOS=69012545;//kernel.Panel:12545
              height = img.height;
              
              //$LASTPOS=69012611;//kernel.Panel:12611
              _this.resize(width,height);
              //$LASTPOS=69012642;//kernel.Panel:12642
              _this.context.drawImage(img,0,0);
              //$LASTPOS=69012680;//kernel.Panel:12680
              d.resolve(_this);
            }));
            //$LASTPOS=69012710;//kernel.Panel:12710
            element.attr({src: url});
            _thread.exit(d.promise());return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    __setter__imageSmoothingEnabled :function _trc_Panel___setter__imageSmoothingEnabled(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69012794;//kernel.Panel:12794
      if (typeof  _this.context.msImageSmoothingEnabled==="boolean") {
        //$LASTPOS=69012861;//kernel.Panel:12861
        _this.context.msImageSmoothingEnabled=v;
        
      } else {
        //$LASTPOS=69012919;//kernel.Panel:12919
        _this.context.imageSmoothingEnabled=v;
        
      }
    },
    __getter__imageSmoothingEnabled :function _trc_Panel___getter__imageSmoothingEnabled() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=69012993;//kernel.Panel:12993
      if (typeof  _this.context.msImageSmoothingEnabled==="boolean") {
        return _this.context.msImageSmoothingEnabled;
        
      } else {
        return _this.context.imageSmoothingEnabled;
        
      }
    },
    replaceColor :function _trc_Panel_replaceColor() {
      "use strict";
      var _this=this;
      var a;
      var top;
      var left;
      var w;
      var h;
      var func;
      var ctx;
      var data;
      var i;
      var j;
      
      //$LASTPOS=69013195;//kernel.Panel:13195
      a = new Tonyu.classes.kernel.ArgParser(arguments);
      
      //$LASTPOS=69013232;//kernel.Panel:13232
      top = 0;
      left = 0;
      
      //$LASTPOS=69013255;//kernel.Panel:13255
      w = _this.width;
      h = _this.height;
      
      //$LASTPOS=69013283;//kernel.Panel:13283
      if (a.length>=4) {
        //$LASTPOS=69013311;//kernel.Panel:13311
        left=a.shift();
        //$LASTPOS=69013336;//kernel.Panel:13336
        top=a.shift();
        //$LASTPOS=69013360;//kernel.Panel:13360
        w=a.shift();
        //$LASTPOS=69013382;//kernel.Panel:13382
        h=a.shift();
        
      }
      //$LASTPOS=69013407;//kernel.Panel:13407
      func = a.shift();
      
      //$LASTPOS=69013432;//kernel.Panel:13432
      if (typeof  func!=="function") {
        //$LASTPOS=69013473;//kernel.Panel:13473
        ctx = _this.context;
        
        //$LASTPOS=69013499;//kernel.Panel:13499
        ctx.save();
        //$LASTPOS=69013520;//kernel.Panel:13520
        ctx.beginPath();
        //$LASTPOS=69013546;//kernel.Panel:13546
        ctx.moveTo(left,top);
        //$LASTPOS=69013577;//kernel.Panel:13577
        ctx.lineTo(left+w,top);
        //$LASTPOS=69013610;//kernel.Panel:13610
        ctx.lineTo(left+w,top+h);
        //$LASTPOS=69013645;//kernel.Panel:13645
        ctx.lineTo(left,top+h);
        //$LASTPOS=69013678;//kernel.Panel:13678
        ctx.closePath();
        //$LASTPOS=69013704;//kernel.Panel:13704
        ctx.clip();
        //$LASTPOS=69013725;//kernel.Panel:13725
        ctx.globalCompositeOperation="source-in";
        //$LASTPOS=69013776;//kernel.Panel:13776
        if (func) {
          //$LASTPOS=69013786;//kernel.Panel:13786
          _this.fillStyle=func;
        }
        //$LASTPOS=69013811;//kernel.Panel:13811
        ctx.fillRect(left,top,w,h);
        //$LASTPOS=69013848;//kernel.Panel:13848
        ctx.restore();
        return _this;
        
      }
      //$LASTPOS=69013892;//kernel.Panel:13892
      data = _this.getImageData(left,top,w,h);
      
      //$LASTPOS=69013934;//kernel.Panel:13934
      //$LASTPOS=69013939;//kernel.Panel:13939
      i = 0;
      for (; i<h ; i++) {
        {
          //$LASTPOS=69013967;//kernel.Panel:13967
          //$LASTPOS=69013972;//kernel.Panel:13972
          j = 0;
          for (; j<w ; j++) {
            {
              //$LASTPOS=69014004;//kernel.Panel:14004
              func(new Tonyu.classes.kernel.Color(data,j,i),left+j,top+i);
            }
          }
        }
      }
      //$LASTPOS=69014067;//kernel.Panel:14067
      _this.putImageData(data,left,top);
    },
    fiber$replaceColor :function _trc_Panel_f_replaceColor(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      var top;
      var left;
      var w;
      var h;
      var func;
      var ctx;
      var data;
      var i;
      var j;
      
      //$LASTPOS=69013195;//kernel.Panel:13195
      a = new Tonyu.classes.kernel.ArgParser(_arguments);
      
      //$LASTPOS=69013232;//kernel.Panel:13232
      top = 0;
      left = 0;
      
      //$LASTPOS=69013255;//kernel.Panel:13255
      w = _this.width;
      h = _this.height;
      
      //$LASTPOS=69013283;//kernel.Panel:13283
      if (a.length>=4) {
        //$LASTPOS=69013311;//kernel.Panel:13311
        left=a.shift();
        //$LASTPOS=69013336;//kernel.Panel:13336
        top=a.shift();
        //$LASTPOS=69013360;//kernel.Panel:13360
        w=a.shift();
        //$LASTPOS=69013382;//kernel.Panel:13382
        h=a.shift();
        
      }
      //$LASTPOS=69013407;//kernel.Panel:13407
      func = a.shift();
      
      //$LASTPOS=69013432;//kernel.Panel:13432
      if (typeof  func!=="function") {
        //$LASTPOS=69013473;//kernel.Panel:13473
        ctx = _this.context;
        
        //$LASTPOS=69013499;//kernel.Panel:13499
        ctx.save();
        //$LASTPOS=69013520;//kernel.Panel:13520
        ctx.beginPath();
        //$LASTPOS=69013546;//kernel.Panel:13546
        ctx.moveTo(left,top);
        //$LASTPOS=69013577;//kernel.Panel:13577
        ctx.lineTo(left+w,top);
        //$LASTPOS=69013610;//kernel.Panel:13610
        ctx.lineTo(left+w,top+h);
        //$LASTPOS=69013645;//kernel.Panel:13645
        ctx.lineTo(left,top+h);
        //$LASTPOS=69013678;//kernel.Panel:13678
        ctx.closePath();
        //$LASTPOS=69013704;//kernel.Panel:13704
        ctx.clip();
        //$LASTPOS=69013725;//kernel.Panel:13725
        ctx.globalCompositeOperation="source-in";
        //$LASTPOS=69013776;//kernel.Panel:13776
        if (func) {
          //$LASTPOS=69013786;//kernel.Panel:13786
          _this.fillStyle=func;
        }
        //$LASTPOS=69013811;//kernel.Panel:13811
        ctx.fillRect(left,top,w,h);
        //$LASTPOS=69013848;//kernel.Panel:13848
        ctx.restore();
        _thread.retVal=_this;return;
        
        
      }
      
      _thread.enter(function _trc_Panel_ent_replaceColor(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=69013892;//kernel.Panel:13892
            _this.fiber$getImageData(_thread, left, top, w, h);
            __pc=1;return;
          case 1:
            data=_thread.retVal;
            
            //$LASTPOS=69013934;//kernel.Panel:13934
            //$LASTPOS=69013939;//kernel.Panel:13939
            i = 0;
            for (; i<h ; i++) {
              {
                //$LASTPOS=69013967;//kernel.Panel:13967
                //$LASTPOS=69013972;//kernel.Panel:13972
                j = 0;
                for (; j<w ; j++) {
                  {
                    //$LASTPOS=69014004;//kernel.Panel:14004
                    func(new Tonyu.classes.kernel.Color(data,j,i),left+j,top+i);
                  }
                }
              }
            }
            //$LASTPOS=69014067;//kernel.Panel:14067
            _this.fiber$putImageData(_thread, data, left, top);
            __pc=2;return;
          case 2:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"watchResize":{"nowait":false},"setPanel":{"nowait":false},"resize":{"nowait":false},"getContext":{"nowait":false},"__getter__context":{"nowait":true},"__getter__image":{"nowait":true},"setFillStyle":{"nowait":false},"__getter__fillStyle":{"nowait":true},"__setter__fillStyle":{"nowait":true},"__setter__strokeStyle":{"nowait":true},"__setter__lineWidth":{"nowait":true},"fillCircle":{"nowait":false},"fillRect":{"nowait":true},"fillText":{"nowait":false},"clearRect":{"nowait":false},"getPixel":{"nowait":false},"scroll":{"nowait":false},"draw":{"nowait":true},"drawSprite":{"nowait":true},"copy":{"nowait":true},"convert":{"nowait":false},"drawLine":{"nowait":true},"slicePattern":{"nowait":false},"addPattern":{"nowait":false},"getImageData":{"nowait":false},"putImageData":{"nowait":false},"replace":{"nowait":false},"save":{"nowait":false},"load":{"nowait":false},"__setter__imageSmoothingEnabled":{"nowait":true},"__getter__imageSmoothingEnabled":{"nowait":true},"replaceColor":{"nowait":false}},"fields":{"canvas":{},"_fillStyle":{},"_drawn":{},"buf":{},"imagedata":{},"colordata":{},"px":{},"py":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ScaledCanvas',
  shortName: 'ScaledCanvas',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_ScaledCanvas_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_ScaledCanvas_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_ScaledCanvas_initialize(opt) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=70000095;//kernel.ScaledCanvas:95
      _this.extend(opt);
      //$LASTPOS=70000142;//kernel.ScaledCanvas:142
      _this.resize(_this.width,_this.height);
      //$LASTPOS=70000170;//kernel.ScaledCanvas:170
      _this.cw=_this.canvas.width();
      //$LASTPOS=70000194;//kernel.ScaledCanvas:194
      _this.ch=_this.canvas.height();
      //$LASTPOS=70000219;//kernel.ScaledCanvas:219
      _this.cctx=_this.canvas[0].getContext("2d");
      //$LASTPOS=70000257;//kernel.ScaledCanvas:257
      _this._color="rgb(20,80,180)";
      //$LASTPOS=70000292;//kernel.ScaledCanvas:292
      _this.sx=0;
      //$LASTPOS=70000303;//kernel.ScaledCanvas:303
      _this.sy=0;
      //$LASTPOS=70000314;//kernel.ScaledCanvas:314
      _this.isDrawGrid=Tonyu.globals.$Sprites.isDrawGrid;
    },
    resize :function _trc_ScaledCanvas_resize(width,height) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=70000379;//kernel.ScaledCanvas:379
      _this.width=width;
      //$LASTPOS=70000402;//kernel.ScaledCanvas:402
      _this.height=height;
      //$LASTPOS=70000427;//kernel.ScaledCanvas:427
      _this.buf=$("<canvas>").attr({width: width,height: height});
      //$LASTPOS=70000470;//kernel.ScaledCanvas:470
      _this.ctx=_this.buf[0].getContext("2d");
      //$LASTPOS=70000504;//kernel.ScaledCanvas:504
      Tonyu.globals.$screenWidth=width;
      //$LASTPOS=70000529;//kernel.ScaledCanvas:529
      Tonyu.globals.$screenHeight=height;
      //$LASTPOS=70000556;//kernel.ScaledCanvas:556
      if (Tonyu.globals.$panel) {
        //$LASTPOS=70000577;//kernel.ScaledCanvas:577
        Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
        //$LASTPOS=70000631;//kernel.ScaledCanvas:631
        Tonyu.globals.$panel.x=Tonyu.globals.$screenWidth/2;
        //$LASTPOS=70000665;//kernel.ScaledCanvas:665
        Tonyu.globals.$panel.y=Tonyu.globals.$screenHeight/2;
        
      }
      //$LASTPOS=70000703;//kernel.ScaledCanvas:703
      if (Tonyu.globals.$consolePanel) {
        //$LASTPOS=70000731;//kernel.ScaledCanvas:731
        Tonyu.globals.$consolePanel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
        //$LASTPOS=70000792;//kernel.ScaledCanvas:792
        Tonyu.globals.$consolePanel.x=Tonyu.globals.$screenWidth/2;
        //$LASTPOS=70000833;//kernel.ScaledCanvas:833
        Tonyu.globals.$consolePanel.y=Tonyu.globals.$screenHeight/2;
        //$LASTPOS=70000875;//kernel.ScaledCanvas:875
        Tonyu.globals.$consolePrintY=Tonyu.globals.$screenHeight-15;
        
      }
    },
    fiber$resize :function _trc_ScaledCanvas_f_resize(_thread,width,height) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=70000379;//kernel.ScaledCanvas:379
      _this.width=width;
      //$LASTPOS=70000402;//kernel.ScaledCanvas:402
      _this.height=height;
      //$LASTPOS=70000427;//kernel.ScaledCanvas:427
      _this.buf=$("<canvas>").attr({width: width,height: height});
      //$LASTPOS=70000470;//kernel.ScaledCanvas:470
      _this.ctx=_this.buf[0].getContext("2d");
      //$LASTPOS=70000504;//kernel.ScaledCanvas:504
      Tonyu.globals.$screenWidth=width;
      //$LASTPOS=70000529;//kernel.ScaledCanvas:529
      Tonyu.globals.$screenHeight=height;
      //$LASTPOS=70000556;//kernel.ScaledCanvas:556
      if (Tonyu.globals.$panel) {
        //$LASTPOS=70000577;//kernel.ScaledCanvas:577
        Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
        //$LASTPOS=70000631;//kernel.ScaledCanvas:631
        Tonyu.globals.$panel.x=Tonyu.globals.$screenWidth/2;
        //$LASTPOS=70000665;//kernel.ScaledCanvas:665
        Tonyu.globals.$panel.y=Tonyu.globals.$screenHeight/2;
        
      }
      //$LASTPOS=70000703;//kernel.ScaledCanvas:703
      if (Tonyu.globals.$consolePanel) {
        //$LASTPOS=70000731;//kernel.ScaledCanvas:731
        Tonyu.globals.$consolePanel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
        //$LASTPOS=70000792;//kernel.ScaledCanvas:792
        Tonyu.globals.$consolePanel.x=Tonyu.globals.$screenWidth/2;
        //$LASTPOS=70000833;//kernel.ScaledCanvas:833
        Tonyu.globals.$consolePanel.y=Tonyu.globals.$screenHeight/2;
        //$LASTPOS=70000875;//kernel.ScaledCanvas:875
        Tonyu.globals.$consolePrintY=Tonyu.globals.$screenHeight-15;
        
      }
      
      _thread.retVal=_this;return;
    },
    shouldDraw1x1 :function _trc_ScaledCanvas_shouldDraw1x1(srcw,srch,dstw,dsth) {
      "use strict";
      var _this=this;
      var larger;
      var smaller;
      
      //$LASTPOS=70000997;//kernel.ScaledCanvas:997
      larger = 200;
      
      //$LASTPOS=70001018;//kernel.ScaledCanvas:1018
      smaller = 5;
      
      return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;
    },
    fiber$shouldDraw1x1 :function _trc_ScaledCanvas_f_shouldDraw1x1(_thread,srcw,srch,dstw,dsth) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var larger;
      var smaller;
      
      //$LASTPOS=70000997;//kernel.ScaledCanvas:997
      larger = 200;
      
      //$LASTPOS=70001018;//kernel.ScaledCanvas:1018
      smaller = 5;
      
      _thread.retVal=srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;return;
      
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_ScaledCanvas_draw() {
      "use strict";
      var _this=this;
      var calcw;
      var calch;
      var marginw;
      var marginh;
      
      //$LASTPOS=70001153;//kernel.ScaledCanvas:1153
      _this.cw=_this.canvas.width();
      //$LASTPOS=70001177;//kernel.ScaledCanvas:1177
      _this.ch=_this.canvas.height();
      //$LASTPOS=70001202;//kernel.ScaledCanvas:1202
      calcw = _this.ch/_this.height*_this.width;
      
      //$LASTPOS=70001246;//kernel.ScaledCanvas:1246
      calch = _this.cw/_this.width*_this.height;
      
      //$LASTPOS=70001290;//kernel.ScaledCanvas:1290
      if (calch>_this.ch) {
        //$LASTPOS=70001304;//kernel.ScaledCanvas:1304
        calch=_this.ch;
      }
      //$LASTPOS=70001319;//kernel.ScaledCanvas:1319
      if (calcw>_this.cw) {
        //$LASTPOS=70001333;//kernel.ScaledCanvas:1333
        calcw=_this.cw;
      }
      //$LASTPOS=70001348;//kernel.ScaledCanvas:1348
      _this.cctx.clearRect(0,0,_this.cw,_this.ch);
      //$LASTPOS=70001380;//kernel.ScaledCanvas:1380
      if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {
        //$LASTPOS=70001436;//kernel.ScaledCanvas:1436
        calcw=_this.width;
        //$LASTPOS=70001448;//kernel.ScaledCanvas:1448
        calch=_this.height;
        
      }
      //$LASTPOS=70001474;//kernel.ScaledCanvas:1474
      marginw = Math.floor((_this.cw-calcw)/2);
      
      //$LASTPOS=70001517;//kernel.ScaledCanvas:1517
      marginh = Math.floor((_this.ch-calch)/2);
      
      //$LASTPOS=70001560;//kernel.ScaledCanvas:1560
      _this.cctx.drawImage(_this.buf[0],0,0,_this.width,_this.height,marginw,marginh,calcw,calch);
    },
    canvas2buf :function _trc_ScaledCanvas_canvas2buf(point) {
      "use strict";
      var _this=this;
      var calcw;
      var calch;
      var marginw;
      var marginh;
      
      //$LASTPOS=70001674;//kernel.ScaledCanvas:1674
      calcw = _this.ch/_this.height*_this.width;
      
      //$LASTPOS=70001718;//kernel.ScaledCanvas:1718
      calch = _this.cw/_this.width*_this.height;
      
      //$LASTPOS=70001762;//kernel.ScaledCanvas:1762
      if (calch>_this.ch) {
        //$LASTPOS=70001776;//kernel.ScaledCanvas:1776
        calch=_this.ch;
      }
      //$LASTPOS=70001791;//kernel.ScaledCanvas:1791
      if (calcw>_this.cw) {
        //$LASTPOS=70001805;//kernel.ScaledCanvas:1805
        calcw=_this.cw;
      }
      //$LASTPOS=70001820;//kernel.ScaledCanvas:1820
      if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {
        //$LASTPOS=70001876;//kernel.ScaledCanvas:1876
        calcw=_this.width;
        //$LASTPOS=70001888;//kernel.ScaledCanvas:1888
        calch=_this.height;
        
      }
      //$LASTPOS=70001914;//kernel.ScaledCanvas:1914
      marginw = Math.floor((_this.cw-calcw)/2);
      
      //$LASTPOS=70001957;//kernel.ScaledCanvas:1957
      marginh = Math.floor((_this.ch-calch)/2);
      
      //$LASTPOS=70002053;//kernel.ScaledCanvas:2053
      _this._ret="("+point.x+"-"+marginw+")/"+calcw+"*"+_this.width+",";
      return {x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};
    },
    fiber$canvas2buf :function _trc_ScaledCanvas_f_canvas2buf(_thread,point) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var calcw;
      var calch;
      var marginw;
      var marginh;
      
      //$LASTPOS=70001674;//kernel.ScaledCanvas:1674
      calcw = _this.ch/_this.height*_this.width;
      
      //$LASTPOS=70001718;//kernel.ScaledCanvas:1718
      calch = _this.cw/_this.width*_this.height;
      
      //$LASTPOS=70001762;//kernel.ScaledCanvas:1762
      if (calch>_this.ch) {
        //$LASTPOS=70001776;//kernel.ScaledCanvas:1776
        calch=_this.ch;
      }
      //$LASTPOS=70001791;//kernel.ScaledCanvas:1791
      if (calcw>_this.cw) {
        //$LASTPOS=70001805;//kernel.ScaledCanvas:1805
        calcw=_this.cw;
      }
      //$LASTPOS=70001820;//kernel.ScaledCanvas:1820
      if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {
        //$LASTPOS=70001876;//kernel.ScaledCanvas:1876
        calcw=_this.width;
        //$LASTPOS=70001888;//kernel.ScaledCanvas:1888
        calch=_this.height;
        
      }
      //$LASTPOS=70001914;//kernel.ScaledCanvas:1914
      marginw = Math.floor((_this.cw-calcw)/2);
      
      //$LASTPOS=70001957;//kernel.ScaledCanvas:1957
      marginh = Math.floor((_this.ch-calch)/2);
      
      //$LASTPOS=70002053;//kernel.ScaledCanvas:2053
      _this._ret="("+point.x+"-"+marginw+")/"+calcw+"*"+_this.width+",";
      _thread.retVal={x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};return;
      
      
      _thread.retVal=_this;return;
    },
    setBGColor :function _trc_ScaledCanvas_setBGColor(color) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=70002225;//kernel.ScaledCanvas:2225
      _this._color=color;
    },
    fiber$setBGColor :function _trc_ScaledCanvas_f_setBGColor(_thread,color) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=70002225;//kernel.ScaledCanvas:2225
      _this._color=color;
      
      _thread.retVal=_this;return;
    },
    fillCanvas :function _trc_ScaledCanvas_fillCanvas(cv) {
      "use strict";
      var _this=this;
      var ctx;
      
      //$LASTPOS=70002270;//kernel.ScaledCanvas:2270
      ctx = cv.getContext("2d");
      
      //$LASTPOS=70002304;//kernel.ScaledCanvas:2304
      ctx.save();
      //$LASTPOS=70002321;//kernel.ScaledCanvas:2321
      ctx.fillStyle=_this._color+"";
      //$LASTPOS=70002351;//kernel.ScaledCanvas:2351
      ctx.fillRect(0,0,cv.width,cv.height);
      //$LASTPOS=70002394;//kernel.ScaledCanvas:2394
      if (_this.isDrawGrid) {
        //$LASTPOS=70002410;//kernel.ScaledCanvas:2410
        _this.drawGrid(cv);
      }
      //$LASTPOS=70002429;//kernel.ScaledCanvas:2429
      ctx.restore();
    },
    fiber$fillCanvas :function _trc_ScaledCanvas_f_fillCanvas(_thread,cv) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var ctx;
      
      //$LASTPOS=70002270;//kernel.ScaledCanvas:2270
      ctx = cv.getContext("2d");
      
      //$LASTPOS=70002304;//kernel.ScaledCanvas:2304
      ctx.save();
      //$LASTPOS=70002321;//kernel.ScaledCanvas:2321
      ctx.fillStyle=_this._color+"";
      //$LASTPOS=70002351;//kernel.ScaledCanvas:2351
      ctx.fillRect(0,0,cv.width,cv.height);
      //$LASTPOS=70002394;//kernel.ScaledCanvas:2394
      if (_this.isDrawGrid) {
        //$LASTPOS=70002410;//kernel.ScaledCanvas:2410
        _this.drawGrid(cv);
      }
      //$LASTPOS=70002429;//kernel.ScaledCanvas:2429
      ctx.restore();
      
      _thread.retVal=_this;return;
    },
    scrollTo :function _trc_ScaledCanvas_scrollTo(scrollX,scrollY) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=70002773;//kernel.ScaledCanvas:2773
      Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);
    },
    fiber$scrollTo :function _trc_ScaledCanvas_f_scrollTo(_thread,scrollX,scrollY) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=70002773;//kernel.ScaledCanvas:2773
      Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"resize":{"nowait":false},"shouldDraw1x1":{"nowait":false},"draw":{"nowait":true},"canvas2buf":{"nowait":false},"setBGColor":{"nowait":false},"fillCanvas":{"nowait":false},"scrollTo":{"nowait":false}},"fields":{"cw":{},"canvas":{},"ch":{},"cctx":{},"sx":{},"sy":{},"isDrawGrid":{},"buf":{},"ctx":{},"_ret":{},"_color":{},"drawGrid":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Screen',
  shortName: 'Screen',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Panel,
  includes: [],
  methods: {
    main :function _trc_Screen_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_Screen_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Screen_initialize(opt) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=71000031;//kernel.Screen:31
      _this.layers=[];
      //$LASTPOS=71000046;//kernel.Screen:46
      _this._color="black";
      //$LASTPOS=71000066;//kernel.Screen:66
      _this.camera={screen: _this};
      //$LASTPOS=71000092;//kernel.Screen:92
      Tonyu.classes.kernel.Panel.apply( _this, [opt]);
    },
    drawLayers :function _trc_Screen_drawLayers() {
      "use strict";
      var _this=this;
      var c;
      var i;
      var l;
      
      //$LASTPOS=71000127;//kernel.Screen:127
      if (! _this._drawing) {
        //$LASTPOS=71000152;//kernel.Screen:152
        if (! _this.canvas) {
          throw new Error("canvas is null");
          
          
        }
        //$LASTPOS=71000232;//kernel.Screen:232
        _this._drawing=true;
        //$LASTPOS=71000255;//kernel.Screen:255
        if (_this.clearBG) {
          //$LASTPOS=71000282;//kernel.Screen:282
          _this.clearRect(0,0,_this.width,_this.height);
          
        }
        //$LASTPOS=71000329;//kernel.Screen:329
        _this.fillStyle=_this._color+"";
        //$LASTPOS=71000358;//kernel.Screen:358
        _this.fillRect(0,0,_this.width,_this.height);
        //$LASTPOS=71000394;//kernel.Screen:394
        c = _this.getContext();
        
        //$LASTPOS=71000422;//kernel.Screen:422
        //$LASTPOS=71000427;//kernel.Screen:427
        i = _this.layers.length-1;
        for (; i>=0 ; i--) {
          {
            //$LASTPOS=71000473;//kernel.Screen:473
            l = _this.layers[i];
            
            //$LASTPOS=71000502;//kernel.Screen:502
            l.draw(c);
          }
        }
        //$LASTPOS=71000531;//kernel.Screen:531
        _this._drawing=false;
        
      }
    },
    fiber$drawLayers :function _trc_Screen_f_drawLayers(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var c;
      var i;
      var l;
      
      
      _thread.enter(function _trc_Screen_ent_drawLayers(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=71000127;//kernel.Screen:127
            if (!(! _this._drawing)) { __pc=4     ; break; }
            //$LASTPOS=71000152;//kernel.Screen:152
            if (! _this.canvas) {
              throw new Error("canvas is null");
              
              
            }
            //$LASTPOS=71000232;//kernel.Screen:232
            _this._drawing=true;
            //$LASTPOS=71000255;//kernel.Screen:255
            if (!(_this.clearBG)) { __pc=2     ; break; }
            //$LASTPOS=71000282;//kernel.Screen:282
            _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height);
            __pc=1;return;
          case 1:
            
          case 2     :
            
            //$LASTPOS=71000329;//kernel.Screen:329
            _this.fillStyle=_this._color+"";
            //$LASTPOS=71000358;//kernel.Screen:358
            _this.fillRect(0,0,_this.width,_this.height);
            //$LASTPOS=71000394;//kernel.Screen:394
            _this.fiber$getContext(_thread);
            __pc=3;return;
          case 3:
            c=_thread.retVal;
            
            //$LASTPOS=71000422;//kernel.Screen:422
            //$LASTPOS=71000427;//kernel.Screen:427
            i = _this.layers.length-1;
            for (; i>=0 ; i--) {
              {
                //$LASTPOS=71000473;//kernel.Screen:473
                l = _this.layers[i];
                
                //$LASTPOS=71000502;//kernel.Screen:502
                l.draw(c);
              }
            }
            //$LASTPOS=71000531;//kernel.Screen:531
            _this._drawing=false;
          case 4     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    draw :function _trc_Screen_draw(ctx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=71000572;//kernel.Screen:572
      _this.drawLayers();
      //$LASTPOS=71000590;//kernel.Screen:590
      Tonyu.classes.kernel.Panel.prototype.draw.apply( _this, [ctx]);
    },
    addLayer :function _trc_Screen_addLayer(group,at) {
      "use strict";
      var _this=this;
      var layer;
      
      
      //$LASTPOS=71000650;//kernel.Screen:650
      if (group instanceof Tonyu.classes.kernel.Sprites3D) {
        //$LASTPOS=71000684;//kernel.Screen:684
        layer=new Tonyu.classes.kernel.Camera3D({group: group});
        
      } else {
        //$LASTPOS=71000732;//kernel.Screen:732
        group=group||new Tonyu.classes.kernel.Sprites;
        //$LASTPOS=71000839;//kernel.Screen:839
        layer=new Tonyu.classes.kernel.Layer2D({spx: 0,spy: 0,wpx: 0,wpy: 0,rotation: 0,scale: 1,group: group,screen: _this,index: _this.layers.length});
        
      }
      //$LASTPOS=71000998;//kernel.Screen:998
      if (at==null) {
        //$LASTPOS=71001012;//kernel.Screen:1012
        _this.layers.push(layer);
      } else {
        //$LASTPOS=71001051;//kernel.Screen:1051
        if (at<0) {
          //$LASTPOS=71001061;//kernel.Screen:1061
          at=_this.layers.length-at;
        }
        //$LASTPOS=71001090;//kernel.Screen:1090
        _this.layers.splice(at,0,layer);
        
      }
      //$LASTPOS=71001127;//kernel.Screen:1127
      if (_this.layers.length==1&&_this.index==null) {
        //$LASTPOS=71001174;//kernel.Screen:1174
        _this.selectLayer(layer);
        
      }
      return layer;
    },
    fiber$addLayer :function _trc_Screen_f_addLayer(_thread,group,at) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var layer;
      
      
      //$LASTPOS=71000650;//kernel.Screen:650
      if (group instanceof Tonyu.classes.kernel.Sprites3D) {
        //$LASTPOS=71000684;//kernel.Screen:684
        layer=new Tonyu.classes.kernel.Camera3D({group: group});
        
      } else {
        //$LASTPOS=71000732;//kernel.Screen:732
        group=group||new Tonyu.classes.kernel.Sprites;
        //$LASTPOS=71000839;//kernel.Screen:839
        layer=new Tonyu.classes.kernel.Layer2D({spx: 0,spy: 0,wpx: 0,wpy: 0,rotation: 0,scale: 1,group: group,screen: _this,index: _this.layers.length});
        
      }
      //$LASTPOS=71000998;//kernel.Screen:998
      if (at==null) {
        //$LASTPOS=71001012;//kernel.Screen:1012
        _this.layers.push(layer);
      } else {
        //$LASTPOS=71001051;//kernel.Screen:1051
        if (at<0) {
          //$LASTPOS=71001061;//kernel.Screen:1061
          at=_this.layers.length-at;
        }
        //$LASTPOS=71001090;//kernel.Screen:1090
        _this.layers.splice(at,0,layer);
        
      }
      
      _thread.enter(function _trc_Screen_ent_addLayer(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=71001127;//kernel.Screen:1127
            if (!(_this.layers.length==1&&_this.index==null)) { __pc=2     ; break; }
            //$LASTPOS=71001174;//kernel.Screen:1174
            _this.fiber$selectLayer(_thread, layer);
            __pc=1;return;
          case 1:
            
          case 2     :
            
            _thread.exit(layer);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    selectLayer :function _trc_Screen_selectLayer(i) {
      "use strict";
      var _this=this;
      var r;
      
      //$LASTPOS=71001242;//kernel.Screen:1242
      r = _this.findLayer(i);
      
      //$LASTPOS=71001266;//kernel.Screen:1266
      if (r!=null) {
        //$LASTPOS=71001279;//kernel.Screen:1279
        _this.index=r;
      }
    },
    fiber$selectLayer :function _trc_Screen_f_selectLayer(_thread,i) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      
      
      _thread.enter(function _trc_Screen_ent_selectLayer(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=71001242;//kernel.Screen:1242
            _this.fiber$findLayer(_thread, i);
            __pc=1;return;
          case 1:
            r=_thread.retVal;
            
            //$LASTPOS=71001266;//kernel.Screen:1266
            if (r!=null) {
              //$LASTPOS=71001279;//kernel.Screen:1279
              _this.index=r;
            }
            _thread.exit(_this);return;
          }
        }
      });
    },
    findLayer :function _trc_Screen_findLayer(i) {
      "use strict";
      var _this=this;
      var j;
      
      //$LASTPOS=71001310;//kernel.Screen:1310
      if (typeof  i=="number") {
        //$LASTPOS=71001344;//kernel.Screen:1344
        if (_this.layers[i]) {
          return i;
        }
        
      } else {
        //$LASTPOS=71001390;//kernel.Screen:1390
        //$LASTPOS=71001395;//kernel.Screen:1395
        j = 0;
        for (; j<_this.layers.length ; j++) {
          {
            //$LASTPOS=71001439;//kernel.Screen:1439
            if (_this.layers[j]==i||_this.layers[j].group==i) {
              return j;
              
            }
          }
        }
        
      }
    },
    fiber$findLayer :function _trc_Screen_f_findLayer(_thread,i) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var j;
      
      //$LASTPOS=71001310;//kernel.Screen:1310
      if (typeof  i=="number") {
        //$LASTPOS=71001344;//kernel.Screen:1344
        if (_this.layers[i]) {
          _thread.retVal=i;return;
          
        }
        
      } else {
        //$LASTPOS=71001390;//kernel.Screen:1390
        //$LASTPOS=71001395;//kernel.Screen:1395
        j = 0;
        for (; j<_this.layers.length ; j++) {
          {
            //$LASTPOS=71001439;//kernel.Screen:1439
            if (_this.layers[j]==i||_this.layers[j].group==i) {
              _thread.retVal=j;return;
              
              
            }
          }
        }
        
      }
      
      _thread.retVal=_this;return;
    },
    setPivot :function _trc_Screen_setPivot(x,y) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=71001560;//kernel.Screen:1560
      _this.layers[_this.index].spx=x;
      //$LASTPOS=71001585;//kernel.Screen:1585
      _this.layers[_this.index].spy=y;
    },
    fiber$setPivot :function _trc_Screen_f_setPivot(_thread,x,y) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=71001560;//kernel.Screen:1560
      _this.layers[_this.index].spx=x;
      //$LASTPOS=71001585;//kernel.Screen:1585
      _this.layers[_this.index].spy=y;
      
      _thread.retVal=_this;return;
    },
    scrollTo :function _trc_Screen_scrollTo(x,y,scl,rot) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=71001637;//kernel.Screen:1637
      _this.layers[_this.index].wpx=x;
      //$LASTPOS=71001662;//kernel.Screen:1662
      _this.layers[_this.index].wpy=y;
      //$LASTPOS=71001687;//kernel.Screen:1687
      if (typeof  scl=="number") {
        //$LASTPOS=71001713;//kernel.Screen:1713
        _this.layers[_this.index].scale=scl;
      }
      //$LASTPOS=71001742;//kernel.Screen:1742
      if (typeof  rot=="number") {
        //$LASTPOS=71001768;//kernel.Screen:1768
        _this.layers[_this.index].rotation=rot;
      }
    },
    fiber$scrollTo :function _trc_Screen_f_scrollTo(_thread,x,y,scl,rot) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=71001637;//kernel.Screen:1637
      _this.layers[_this.index].wpx=x;
      //$LASTPOS=71001662;//kernel.Screen:1662
      _this.layers[_this.index].wpy=y;
      //$LASTPOS=71001687;//kernel.Screen:1687
      if (typeof  scl=="number") {
        //$LASTPOS=71001713;//kernel.Screen:1713
        _this.layers[_this.index].scale=scl;
      }
      //$LASTPOS=71001742;//kernel.Screen:1742
      if (typeof  rot=="number") {
        //$LASTPOS=71001768;//kernel.Screen:1768
        _this.layers[_this.index].rotation=rot;
      }
      
      _thread.retVal=_this;return;
    },
    canvas2buf :function _trc_Screen_canvas2buf(p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=71001819;//kernel.Screen:1819
      p.layer=_this.layer;
      return _this.convert(p,_this);
    },
    fiber$canvas2buf :function _trc_Screen_f_canvas2buf(_thread,p) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=71001819;//kernel.Screen:1819
      p.layer=_this.layer;
      
      _thread.enter(function _trc_Screen_ent_canvas2buf(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$convert(_thread, p, _this);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    convert :function _trc_Screen_convert(obj,toLayer) {
      "use strict";
      var _this=this;
      var p;
      var l;
      var dx;
      var dy;
      var rt;
      var x;
      var y;
      
      //$LASTPOS=71002050;//kernel.Screen:2050
      if (toLayer==null) {
        //$LASTPOS=71002069;//kernel.Screen:2069
        toLayer=_this;
      }
      //$LASTPOS=71002087;//kernel.Screen:2087
      if (! obj.layer) {
        //$LASTPOS=71002103;//kernel.Screen:2103
        obj.layer=_this;
      }
      //$LASTPOS=71002159;//kernel.Screen:2159
      if (obj.layer===toLayer) {
        return obj;
      }
      //$LASTPOS=71002200;//kernel.Screen:2200
      if (obj.layer!==_this&&toLayer!==_this) {
        //$LASTPOS=71002250;//kernel.Screen:2250
        p = _this.convert(obj,_this);
        
        return _this.convert(p,toLayer);
        
      } else {
        //$LASTPOS=71002321;//kernel.Screen:2321
        if (obj.layer!==_this&&toLayer===_this) {
          //$LASTPOS=71002371;//kernel.Screen:2371
          l = _this.findLayer(obj.layer);
          
          //$LASTPOS=71002407;//kernel.Screen:2407
          if (l!=null) {
            //$LASTPOS=71002465;//kernel.Screen:2465
            l=_this.layers[l];
            return l.world2screen(obj);
            //$LASTPOS=71002530;//kernel.Screen:2530
            dx = obj.x-l.wpx;
            
            //$LASTPOS=71002562;//kernel.Screen:2562
            dy = obj.y-l.wpy;
            
            //$LASTPOS=71002594;//kernel.Screen:2594
            rt = l.rotation;
            
            //$LASTPOS=71002806;//kernel.Screen:2806
            x = l.spx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)*l.scale;
            
            //$LASTPOS=71002868;//kernel.Screen:2868
            y = l.spy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)*l.scale;
            
            return {x: x,y: y,rotation: obj.rotation,scale: obj.scale,layer: _this};
            
          } else {
            return Tonyu.classes.kernel.Panel.prototype.convert.apply( _this, [obj,_this]);
            
          }
          
        } else {
          //$LASTPOS=71003139;//kernel.Screen:3139
          if (obj.layer===_this&&toLayer!==_this) {
            //$LASTPOS=71003189;//kernel.Screen:3189
            l = _this.findLayer(toLayer);
            
            //$LASTPOS=71003223;//kernel.Screen:3223
            if (l!=null) {
              //$LASTPOS=71003281;//kernel.Screen:3281
              l=_this.layers[l];
              return l.screen2world(obj);
              //$LASTPOS=71003346;//kernel.Screen:3346
              rt = - l.rotation;
              
              //$LASTPOS=71003378;//kernel.Screen:3378
              dx = obj.x-l.spx;
              
              //$LASTPOS=71003410;//kernel.Screen:3410
              dy = obj.y-l.spy;
              
              //$LASTPOS=71003623;//kernel.Screen:3623
              x = l.wpx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)/l.scale;
              
              //$LASTPOS=71003685;//kernel.Screen:3685
              y = l.wpy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)/l.scale;
              
              return {x: x,y: y,rotation: rt,scale: 1/l.scale,layer: toLayer};
              
            } else {
              return Tonyu.classes.kernel.Panel.prototype.convert.apply( _this, [obj,toLayer]);
              
            }
            
          } else {
            return obj;
          }
        }
      }
    },
    fiber$convert :function _trc_Screen_f_convert(_thread,obj,toLayer) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var p;
      var l;
      var dx;
      var dy;
      var rt;
      var x;
      var y;
      
      //$LASTPOS=71002050;//kernel.Screen:2050
      if (toLayer==null) {
        //$LASTPOS=71002069;//kernel.Screen:2069
        toLayer=_this;
      }
      //$LASTPOS=71002087;//kernel.Screen:2087
      if (! obj.layer) {
        //$LASTPOS=71002103;//kernel.Screen:2103
        obj.layer=_this;
      }
      //$LASTPOS=71002159;//kernel.Screen:2159
      if (obj.layer===toLayer) {
        _thread.retVal=obj;return;
        
      }
      
      _thread.enter(function _trc_Screen_ent_convert(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=71002200;//kernel.Screen:2200
            if (!(obj.layer!==_this&&toLayer!==_this)) { __pc=3     ; break; }
            //$LASTPOS=71002250;//kernel.Screen:2250
            _this.fiber$convert(_thread, obj, _this);
            __pc=1;return;
          case 1:
            p=_thread.retVal;
            
            _this.fiber$convert(_thread, p, toLayer);
            __pc=2;return;
          case 2:
            _thread.exit(_thread.retVal);return;
            
            __pc=14    ;break;
          case 3     :
            //$LASTPOS=71002321;//kernel.Screen:2321
            if (!(obj.layer!==_this&&toLayer===_this)) { __pc=7     ; break; }
            //$LASTPOS=71002371;//kernel.Screen:2371
            _this.fiber$findLayer(_thread, obj.layer);
            __pc=4;return;
          case 4:
            l=_thread.retVal;
            
            //$LASTPOS=71002407;//kernel.Screen:2407
            if (!(l!=null)) { __pc=5     ; break; }
            //$LASTPOS=71002465;//kernel.Screen:2465
            l=_this.layers[l];
            _thread.exit(l.world2screen(obj));return;
            //$LASTPOS=71002530;//kernel.Screen:2530
            dx = obj.x-l.wpx;
            
            //$LASTPOS=71002562;//kernel.Screen:2562
            dy = obj.y-l.wpy;
            
            //$LASTPOS=71002594;//kernel.Screen:2594
            rt = l.rotation;
            
            //$LASTPOS=71002806;//kernel.Screen:2806
            x = l.spx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)*l.scale;
            
            //$LASTPOS=71002868;//kernel.Screen:2868
            y = l.spy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)*l.scale;
            
            _thread.exit({x: x,y: y,rotation: obj.rotation,scale: obj.scale,layer: _this});return;
            __pc=6     ;break;
          case 5     :
            _thread.exit(Tonyu.classes.kernel.Panel.prototype.convert.apply( _this, [obj,_this]));return;
          case 6     :
            
            __pc=13    ;break;
          case 7     :
            //$LASTPOS=71003139;//kernel.Screen:3139
            if (!(obj.layer===_this&&toLayer!==_this)) { __pc=11    ; break; }
            //$LASTPOS=71003189;//kernel.Screen:3189
            _this.fiber$findLayer(_thread, toLayer);
            __pc=8;return;
          case 8:
            l=_thread.retVal;
            
            //$LASTPOS=71003223;//kernel.Screen:3223
            if (!(l!=null)) { __pc=9     ; break; }
            //$LASTPOS=71003281;//kernel.Screen:3281
            l=_this.layers[l];
            _thread.exit(l.screen2world(obj));return;
            //$LASTPOS=71003346;//kernel.Screen:3346
            rt = - l.rotation;
            
            //$LASTPOS=71003378;//kernel.Screen:3378
            dx = obj.x-l.spx;
            
            //$LASTPOS=71003410;//kernel.Screen:3410
            dy = obj.y-l.spy;
            
            //$LASTPOS=71003623;//kernel.Screen:3623
            x = l.wpx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)/l.scale;
            
            //$LASTPOS=71003685;//kernel.Screen:3685
            y = l.wpy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)/l.scale;
            
            _thread.exit({x: x,y: y,rotation: rt,scale: 1/l.scale,layer: toLayer});return;
            __pc=10    ;break;
          case 9     :
            _thread.exit(Tonyu.classes.kernel.Panel.prototype.convert.apply( _this, [obj,toLayer]));return;
          case 10    :
            
            __pc=12    ;break;
          case 11    :
            _thread.exit(obj);return;
          case 12    :
            
          case 13    :
            
          case 14    :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    setBGColor :function _trc_Screen_setBGColor(color) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=71003990;//kernel.Screen:3990
      _this._color=color;
    },
    fiber$setBGColor :function _trc_Screen_f_setBGColor(_thread,color) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=71003990;//kernel.Screen:3990
      _this._color=color;
      
      _thread.retVal=_this;return;
    },
    all :function _trc_Screen_all() {
      "use strict";
      var _this=this;
      var res;
      var l;
      var _it_647;
      var q;
      
      //$LASTPOS=71004024;//kernel.Screen:4024
      res = new Tonyu.classes.kernel.TQuery({screen: _this});
      
      //$LASTPOS=71004061;//kernel.Screen:4061
      _it_647=Tonyu.iterator(_this.layers,1);
      while(_it_647.next()) {
        l=_it_647[0];
        
        //$LASTPOS=71004093;//kernel.Screen:4093
        q = l.group.all.apply(l.group,arguments);
        
        //$LASTPOS=71004145;//kernel.Screen:4145
        res.push(q);
        
      }
      return res;
    },
    touchedFingers :function _trc_Screen_touchedFingers(q,options) {
      "use strict";
      var _this=this;
      var res;
      var e;
      var _it_652;
      var r;
      var i;
      var t;
      var p;
      
      //$LASTPOS=71004251;//kernel.Screen:4251
      res = [];
      
      //$LASTPOS=71004267;//kernel.Screen:4267
      options=options||{};
      //$LASTPOS=71004292;//kernel.Screen:4292
      _it_652=Tonyu.iterator(q,1);
      while(_it_652.next()) {
        e=_it_652[0];
        
        //$LASTPOS=71004319;//kernel.Screen:4319
        r = e.getCrashRect();
        
        //$LASTPOS=71004351;//kernel.Screen:4351
        //$LASTPOS=71004356;//kernel.Screen:4356
        i = 0;
        for (; i<Tonyu.globals.$touches.length ; i++) {
          {
            //$LASTPOS=71004401;//kernel.Screen:4401
            t = Tonyu.globals.$touches[i];
            
            //$LASTPOS=71004432;//kernel.Screen:4432
            if (t.touched==1) {
              //$LASTPOS=71004468;//kernel.Screen:4468
              p = _this.convert(t,e.layer);
              
              //$LASTPOS=71004510;//kernel.Screen:4510
              if (p.x>=r.x-r.width/2&&p.x<=r.x+r.width/2&&p.y>=r.y-r.height/2&&p.y<=r.y+r.height/2) {
                //$LASTPOS=71004640;//kernel.Screen:4640
                t.captured=e;
                //$LASTPOS=71004674;//kernel.Screen:4674
                res.push(t);
                
              }
              
            }
          }
        }
        
      }
      return res;
    },
    fiber$touchedFingers :function _trc_Screen_f_touchedFingers(_thread,q,options) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var e;
      var _it_652;
      var r;
      var i;
      var t;
      var p;
      
      //$LASTPOS=71004251;//kernel.Screen:4251
      res = [];
      
      //$LASTPOS=71004267;//kernel.Screen:4267
      options=options||{};
      
      _thread.enter(function _trc_Screen_ent_touchedFingers(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=71004292;//kernel.Screen:4292
            _it_652=Tonyu.iterator(q,1);
          case 1:
            if (!(_it_652.next())) { __pc=7     ; break; }
            e=_it_652[0];
            
            //$LASTPOS=71004319;//kernel.Screen:4319
            r = e.getCrashRect();
            
            //$LASTPOS=71004351;//kernel.Screen:4351
            //$LASTPOS=71004356;//kernel.Screen:4356
            i = 0;
            
          case 2:
            if (!(i<Tonyu.globals.$touches.length)) { __pc=6     ; break; }
            //$LASTPOS=71004401;//kernel.Screen:4401
            t = Tonyu.globals.$touches[i];
            
            //$LASTPOS=71004432;//kernel.Screen:4432
            if (!(t.touched==1)) { __pc=4     ; break; }
            //$LASTPOS=71004468;//kernel.Screen:4468
            _this.fiber$convert(_thread, t, e.layer);
            __pc=3;return;
          case 3:
            p=_thread.retVal;
            
            //$LASTPOS=71004510;//kernel.Screen:4510
            if (p.x>=r.x-r.width/2&&p.x<=r.x+r.width/2&&p.y>=r.y-r.height/2&&p.y<=r.y+r.height/2) {
              //$LASTPOS=71004640;//kernel.Screen:4640
              t.captured=e;
              //$LASTPOS=71004674;//kernel.Screen:4674
              res.push(t);
              
            }
          case 4     :
            
          case 5     :
            i++;
            __pc=2;break;
          case 6     :
            
            __pc=1;break;
          case 7     :
            
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"drawLayers":{"nowait":false},"draw":{"nowait":true},"addLayer":{"nowait":false},"selectLayer":{"nowait":false},"findLayer":{"nowait":false},"setPivot":{"nowait":false},"scrollTo":{"nowait":false},"canvas2buf":{"nowait":false},"convert":{"nowait":false},"setBGColor":{"nowait":false},"all":{"nowait":true},"touchedFingers":{"nowait":false}},"fields":{"layers":{},"_color":{},"camera":{},"_drawing":{},"clearBG":{},"index":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.BodyActor',
  shortName: 'BodyActor',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [Tonyu.classes.kernel.T2Mod],
  methods: {
    main :function _trc_BodyActor_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_BodyActor_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_BodyActor_initialize(p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=72000065;//kernel.BodyActor:65
      Tonyu.classes.kernel.Actor.apply( _this, [p]);
      //$LASTPOS=72000080;//kernel.BodyActor:80
      _this._th.on("end",Tonyu.bindFunc(_this,_this.initBody));
    },
    getWorld :function _trc_BodyActor_getWorld() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=72000128;//kernel.BodyActor:128
      if (Tonyu.globals.$t2World) {
        return Tonyu.globals.$t2World;
      }
      //$LASTPOS=72000164;//kernel.BodyActor:164
      Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;
      return Tonyu.globals.$t2World;
    },
    fiber$getWorld :function _trc_BodyActor_f_getWorld(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=72000128;//kernel.BodyActor:128
      if (Tonyu.globals.$t2World) {
        _thread.retVal=Tonyu.globals.$t2World;return;
        
      }
      //$LASTPOS=72000164;//kernel.BodyActor:164
      Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;
      _thread.retVal=Tonyu.globals.$t2World;return;
      
      
      _thread.retVal=_this;return;
    },
    update :function _trc_BodyActor_update() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=72000229;//kernel.BodyActor:229
      _this.initBody();
      //$LASTPOS=72000246;//kernel.BodyActor:246
      Tonyu.classes.kernel.Actor.prototype.update.apply( _this, []);
    },
    fiber$update :function _trc_BodyActor_f_update(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_BodyActor_ent_update(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=72000229;//kernel.BodyActor:229
            _this.fiber$initBody(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=72000246;//kernel.BodyActor:246
            Tonyu.classes.kernel.Actor.prototype.fiber$update.apply( _this, [_thread]);
            __pc=2;return;
          case 2:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    initBody :function _trc_BodyActor_initBody() {
      "use strict";
      var _this=this;
      var wworld;
      var b2Vec2;
      var b2BodyDef;
      var b2Body;
      var b2FixtureDef;
      var b2Fixture;
      var b2PolygonShape;
      var b2CircleShape;
      var fixDef;
      var bodyDef;
      var w;
      var h;
      var fps;
      var r;
      var ve;
      var vr;
      
      //$LASTPOS=72000285;//kernel.BodyActor:285
      if (_this.body) {
        return _this;
      }
      //$LASTPOS=72000308;//kernel.BodyActor:308
      wworld = _this.getWorld();
      
      //$LASTPOS=72000336;//kernel.BodyActor:336
      _this.world=wworld.world;
      //$LASTPOS=72000361;//kernel.BodyActor:361
      _this.scale=wworld.scale;
      //$LASTPOS=72000386;//kernel.BodyActor:386
      b2Vec2 = Box2D.Common.Math.b2Vec2;
      
      //$LASTPOS=72000430;//kernel.BodyActor:430
      b2BodyDef = Box2D.Dynamics.b2BodyDef;
      
      //$LASTPOS=72000477;//kernel.BodyActor:477
      b2Body = Box2D.Dynamics.b2Body;
      
      //$LASTPOS=72000518;//kernel.BodyActor:518
      b2FixtureDef = Box2D.Dynamics.b2FixtureDef;
      
      //$LASTPOS=72000571;//kernel.BodyActor:571
      b2Fixture = Box2D.Dynamics.b2Fixture;
      
      //$LASTPOS=72000618;//kernel.BodyActor:618
      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;
      
      //$LASTPOS=72000683;//kernel.BodyActor:683
      b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;
      
      //$LASTPOS=72000748;//kernel.BodyActor:748
      fixDef = new b2FixtureDef;
      
      //$LASTPOS=72000784;//kernel.BodyActor:784
      fixDef.density=_this.defv(_this.density,1);
      //$LASTPOS=72000826;//kernel.BodyActor:826
      fixDef.friction=_this.defv(_this.friction,0.5);
      //$LASTPOS=72000870;//kernel.BodyActor:870
      fixDef.restitution=_this.defv(_this.restitution,0.2);
      //$LASTPOS=72000922;//kernel.BodyActor:922
      bodyDef = new b2BodyDef;
      
      //$LASTPOS=72000956;//kernel.BodyActor:956
      bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;
      //$LASTPOS=72001040;//kernel.BodyActor:1040
      bodyDef.position.x=_this.x/_this.scale;
      //$LASTPOS=72001076;//kernel.BodyActor:1076
      bodyDef.position.y=_this.y/_this.scale;
      //$LASTPOS=72001112;//kernel.BodyActor:1112
      _this.shape=_this.shape||(_this.radius?"circle":"box");
      //$LASTPOS=72001161;//kernel.BodyActor:1161
      w = _this.width;
      h = _this.height;
      
      //$LASTPOS=72001188;//kernel.BodyActor:1188
      if (! w) {
        //$LASTPOS=72001207;//kernel.BodyActor:1207
        _this.detectShape();
        //$LASTPOS=72001231;//kernel.BodyActor:1231
        w=_this.width*(_this.scaleX||1);
        //$LASTPOS=72001261;//kernel.BodyActor:1261
        h=_this.height*(_this.scaleY||_this.scaleX||1);
        
      }
      //$LASTPOS=72001303;//kernel.BodyActor:1303
      if (_this.shape=="box") {
        //$LASTPOS=72001332;//kernel.BodyActor:1332
        if (! h) {
          //$LASTPOS=72001340;//kernel.BodyActor:1340
          h=w;
        }
        //$LASTPOS=72001354;//kernel.BodyActor:1354
        fixDef.shape=new b2PolygonShape;
        //$LASTPOS=72001398;//kernel.BodyActor:1398
        fixDef.shape.SetAsOrientedBox(w/2/_this.scale,h/2/_this.scale,new b2Vec2(0,0),0);
        
      } else {
        //$LASTPOS=72001502;//kernel.BodyActor:1502
        _this.radius=_this.radius||w/2||16;
        //$LASTPOS=72001539;//kernel.BodyActor:1539
        fixDef.shape=new b2CircleShape(_this.radius/_this.scale);
        //$LASTPOS=72001616;//kernel.BodyActor:1616
        _this.width=_this.height=_this.radius*2;
        
      }
      //$LASTPOS=72001651;//kernel.BodyActor:1651
      fps = wworld.fps;
      
      //$LASTPOS=72001676;//kernel.BodyActor:1676
      r = _this.rotation;
      ve = _this.bvec(_this.defv(_this.vx*fps,0),_this.defv(_this.vy*fps,0));
      vr = _this.defv(_this.vrotation,0);
      
      //$LASTPOS=72001758;//kernel.BodyActor:1758
      _this.body=_this.world.CreateBody(bodyDef);
      //$LASTPOS=72001795;//kernel.BodyActor:1795
      _this.body.CreateFixture(fixDef);
      //$LASTPOS=72001828;//kernel.BodyActor:1828
      _this.body.SetUserData(_this);
      //$LASTPOS=72001857;//kernel.BodyActor:1857
      _this.body.SetLinearVelocity(ve);
      //$LASTPOS=72001890;//kernel.BodyActor:1890
      _this.rotation=r;
      //$LASTPOS=72001907;//kernel.BodyActor:1907
      _this.vrotation=vr;
      //$LASTPOS=72001926;//kernel.BodyActor:1926
      _this.fireEvent("createBody");
    },
    fiber$initBody :function _trc_BodyActor_f_initBody(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var wworld;
      var b2Vec2;
      var b2BodyDef;
      var b2Body;
      var b2FixtureDef;
      var b2Fixture;
      var b2PolygonShape;
      var b2CircleShape;
      var fixDef;
      var bodyDef;
      var w;
      var h;
      var fps;
      var r;
      var ve;
      var vr;
      
      //$LASTPOS=72000285;//kernel.BodyActor:285
      if (_this.body) {
        _thread.retVal=_this;return;
        
      }
      
      _thread.enter(function _trc_BodyActor_ent_initBody(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=72000308;//kernel.BodyActor:308
            _this.fiber$getWorld(_thread);
            __pc=1;return;
          case 1:
            wworld=_thread.retVal;
            
            //$LASTPOS=72000336;//kernel.BodyActor:336
            _this.world=wworld.world;
            //$LASTPOS=72000361;//kernel.BodyActor:361
            _this.scale=wworld.scale;
            //$LASTPOS=72000386;//kernel.BodyActor:386
            b2Vec2 = Box2D.Common.Math.b2Vec2;
            
            //$LASTPOS=72000430;//kernel.BodyActor:430
            b2BodyDef = Box2D.Dynamics.b2BodyDef;
            
            //$LASTPOS=72000477;//kernel.BodyActor:477
            b2Body = Box2D.Dynamics.b2Body;
            
            //$LASTPOS=72000518;//kernel.BodyActor:518
            b2FixtureDef = Box2D.Dynamics.b2FixtureDef;
            
            //$LASTPOS=72000571;//kernel.BodyActor:571
            b2Fixture = Box2D.Dynamics.b2Fixture;
            
            //$LASTPOS=72000618;//kernel.BodyActor:618
            b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;
            
            //$LASTPOS=72000683;//kernel.BodyActor:683
            b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;
            
            //$LASTPOS=72000748;//kernel.BodyActor:748
            fixDef = new b2FixtureDef;
            
            //$LASTPOS=72000784;//kernel.BodyActor:784
            _this.fiber$defv(_thread, _this.density, 1);
            __pc=2;return;
          case 2:
            fixDef.density=_thread.retVal;
            
            //$LASTPOS=72000826;//kernel.BodyActor:826
            _this.fiber$defv(_thread, _this.friction, 0.5);
            __pc=3;return;
          case 3:
            fixDef.friction=_thread.retVal;
            
            //$LASTPOS=72000870;//kernel.BodyActor:870
            _this.fiber$defv(_thread, _this.restitution, 0.2);
            __pc=4;return;
          case 4:
            fixDef.restitution=_thread.retVal;
            
            //$LASTPOS=72000922;//kernel.BodyActor:922
            bodyDef = new b2BodyDef;
            
            //$LASTPOS=72000956;//kernel.BodyActor:956
            bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;
            //$LASTPOS=72001040;//kernel.BodyActor:1040
            bodyDef.position.x=_this.x/_this.scale;
            //$LASTPOS=72001076;//kernel.BodyActor:1076
            bodyDef.position.y=_this.y/_this.scale;
            //$LASTPOS=72001112;//kernel.BodyActor:1112
            _this.shape=_this.shape||(_this.radius?"circle":"box");
            //$LASTPOS=72001161;//kernel.BodyActor:1161
            w = _this.width;
            h = _this.height;
            
            //$LASTPOS=72001188;//kernel.BodyActor:1188
            if (! w) {
              //$LASTPOS=72001207;//kernel.BodyActor:1207
              _this.detectShape();
              //$LASTPOS=72001231;//kernel.BodyActor:1231
              w=_this.width*(_this.scaleX||1);
              //$LASTPOS=72001261;//kernel.BodyActor:1261
              h=_this.height*(_this.scaleY||_this.scaleX||1);
              
            }
            //$LASTPOS=72001303;//kernel.BodyActor:1303
            if (_this.shape=="box") {
              //$LASTPOS=72001332;//kernel.BodyActor:1332
              if (! h) {
                //$LASTPOS=72001340;//kernel.BodyActor:1340
                h=w;
              }
              //$LASTPOS=72001354;//kernel.BodyActor:1354
              fixDef.shape=new b2PolygonShape;
              //$LASTPOS=72001398;//kernel.BodyActor:1398
              fixDef.shape.SetAsOrientedBox(w/2/_this.scale,h/2/_this.scale,new b2Vec2(0,0),0);
              
            } else {
              //$LASTPOS=72001502;//kernel.BodyActor:1502
              _this.radius=_this.radius||w/2||16;
              //$LASTPOS=72001539;//kernel.BodyActor:1539
              fixDef.shape=new b2CircleShape(_this.radius/_this.scale);
              //$LASTPOS=72001616;//kernel.BodyActor:1616
              _this.width=_this.height=_this.radius*2;
              
            }
            //$LASTPOS=72001651;//kernel.BodyActor:1651
            fps = wworld.fps;
            
            //$LASTPOS=72001676;//kernel.BodyActor:1676
            r = _this.rotation;
            _this.fiber$bvec(_thread, _this.defv(_this.vx*fps,0), _this.defv(_this.vy*fps,0));
            __pc=5;return;
          case 5:
            ve=_thread.retVal;
            _this.fiber$defv(_thread, _this.vrotation, 0);
            __pc=6;return;
          case 6:
            vr=_thread.retVal;
            
            //$LASTPOS=72001758;//kernel.BodyActor:1758
            _this.body=_this.world.CreateBody(bodyDef);
            //$LASTPOS=72001795;//kernel.BodyActor:1795
            _this.body.CreateFixture(fixDef);
            //$LASTPOS=72001828;//kernel.BodyActor:1828
            _this.body.SetUserData(_this);
            //$LASTPOS=72001857;//kernel.BodyActor:1857
            _this.body.SetLinearVelocity(ve);
            //$LASTPOS=72001890;//kernel.BodyActor:1890
            _this.rotation=r;
            //$LASTPOS=72001907;//kernel.BodyActor:1907
            _this.vrotation=vr;
            //$LASTPOS=72001926;//kernel.BodyActor:1926
            _this.fireEvent("createBody");
            _thread.exit(_this);return;
          }
        }
      });
    },
    allContactPoints :function _trc_BodyActor_allContactPoints(klass) {
      "use strict";
      var _this=this;
      var res;
      var m;
      var point;
      var w;
      var c;
      var a;
      var b;
      
      //$LASTPOS=72001987;//kernel.BodyActor:1987
      _this.initBody();
      //$LASTPOS=72002004;//kernel.BodyActor:2004
      res = [];
      
      //$LASTPOS=72002029;//kernel.BodyActor:2029
      w = _this.getWorld();
      
      //$LASTPOS=72002052;//kernel.BodyActor:2052
      //$LASTPOS=72002057;//kernel.BodyActor:2057
      c = _this.world.GetContactList();
      for (; c ; c=c.GetNext()) {
        {
          //$LASTPOS=72002114;//kernel.BodyActor:2114
          if (c.IsTouching()) {
            //$LASTPOS=72002146;//kernel.BodyActor:2146
            c.GetWorldManifold(m=new Box2D.Collision.b2WorldManifold);
            //$LASTPOS=72002218;//kernel.BodyActor:2218
            if (m.m_points[0]) {
              //$LASTPOS=72002256;//kernel.BodyActor:2256
              if (m.m_points[1]&&m.m_points[1].x&&m.m_points[1].y) {
                //$LASTPOS=72002330;//kernel.BodyActor:2330
                point={x: (m.m_points[0].x+m.m_points[1].x)/2*w.scale,y: (m.m_points[0].y+m.m_points[1].y)/2*w.scale};
                
              } else {
                //$LASTPOS=72002504;//kernel.BodyActor:2504
                point={x: m.m_points[0].x*w.scale,y: m.m_points[0].y*w.scale};
                
              }
              
            } else {
              //$LASTPOS=72002605;//kernel.BodyActor:2605
              point={x: _this.x,y: _this.y};
            }
            //$LASTPOS=72002631;//kernel.BodyActor:2631
            a = c.GetFixtureA().GetBody().GetUserData();
            
            //$LASTPOS=72002691;//kernel.BodyActor:2691
            b = c.GetFixtureB().GetBody().GetUserData();
            
            //$LASTPOS=72002751;//kernel.BodyActor:2751
            if (a===_this) {
              //$LASTPOS=72002784;//kernel.BodyActor:2784
              if (! klass||b===klass||b instanceof klass) {
                //$LASTPOS=72002854;//kernel.BodyActor:2854
                res.push({target: b,manifold: m,x: point.x,y: point.y});
                
              }
              
            } else {
              //$LASTPOS=72002947;//kernel.BodyActor:2947
              if (b===_this) {
                //$LASTPOS=72002980;//kernel.BodyActor:2980
                if (! klass||a===klass||a instanceof klass) {
                  //$LASTPOS=72003050;//kernel.BodyActor:3050
                  res.push({target: a,manifold: m,x: point.x,y: point.y});
                  
                }
                
              }
            }
            
          }
        }
      }
      return res;
    },
    fiber$allContactPoints :function _trc_BodyActor_f_allContactPoints(_thread,klass) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var m;
      var point;
      var w;
      var c;
      var a;
      var b;
      
      
      _thread.enter(function _trc_BodyActor_ent_allContactPoints(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=72001987;//kernel.BodyActor:1987
            _this.fiber$initBody(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=72002004;//kernel.BodyActor:2004
            res = [];
            
            //$LASTPOS=72002029;//kernel.BodyActor:2029
            _this.fiber$getWorld(_thread);
            __pc=2;return;
          case 2:
            w=_thread.retVal;
            
            //$LASTPOS=72002052;//kernel.BodyActor:2052
            //$LASTPOS=72002057;//kernel.BodyActor:2057
            c = _this.world.GetContactList();
            for (; c ; c=c.GetNext()) {
              {
                //$LASTPOS=72002114;//kernel.BodyActor:2114
                if (c.IsTouching()) {
                  //$LASTPOS=72002146;//kernel.BodyActor:2146
                  c.GetWorldManifold(m=new Box2D.Collision.b2WorldManifold);
                  //$LASTPOS=72002218;//kernel.BodyActor:2218
                  if (m.m_points[0]) {
                    //$LASTPOS=72002256;//kernel.BodyActor:2256
                    if (m.m_points[1]&&m.m_points[1].x&&m.m_points[1].y) {
                      //$LASTPOS=72002330;//kernel.BodyActor:2330
                      point={x: (m.m_points[0].x+m.m_points[1].x)/2*w.scale,y: (m.m_points[0].y+m.m_points[1].y)/2*w.scale};
                      
                    } else {
                      //$LASTPOS=72002504;//kernel.BodyActor:2504
                      point={x: m.m_points[0].x*w.scale,y: m.m_points[0].y*w.scale};
                      
                    }
                    
                  } else {
                    //$LASTPOS=72002605;//kernel.BodyActor:2605
                    point={x: _this.x,y: _this.y};
                  }
                  //$LASTPOS=72002631;//kernel.BodyActor:2631
                  a = c.GetFixtureA().GetBody().GetUserData();
                  
                  //$LASTPOS=72002691;//kernel.BodyActor:2691
                  b = c.GetFixtureB().GetBody().GetUserData();
                  
                  //$LASTPOS=72002751;//kernel.BodyActor:2751
                  if (a===_this) {
                    //$LASTPOS=72002784;//kernel.BodyActor:2784
                    if (! klass||b===klass||b instanceof klass) {
                      //$LASTPOS=72002854;//kernel.BodyActor:2854
                      res.push({target: b,manifold: m,x: point.x,y: point.y});
                      
                    }
                    
                  } else {
                    //$LASTPOS=72002947;//kernel.BodyActor:2947
                    if (b===_this) {
                      //$LASTPOS=72002980;//kernel.BodyActor:2980
                      if (! klass||a===klass||a instanceof klass) {
                        //$LASTPOS=72003050;//kernel.BodyActor:3050
                        res.push({target: a,manifold: m,x: point.x,y: point.y});
                        
                      }
                      
                    }
                  }
                  
                }
              }
            }
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    contactPoint :function _trc_BodyActor_contactPoint(klass) {
      "use strict";
      var _this=this;
      
      return _this.allContactPoints(klass)[0];
    },
    fiber$contactPoint :function _trc_BodyActor_f_contactPoint(_thread,klass) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.allContactPoints(klass)[0];return;
      
      
      _thread.retVal=_this;return;
    },
    allContact :function _trc_BodyActor_allContact(klass) {
      "use strict";
      var _this=this;
      
      return _this.allContacts(klass);
    },
    fiber$allContact :function _trc_BodyActor_f_allContact(_thread,klass) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_BodyActor_ent_allContact(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            _this.fiber$allContacts(_thread, klass);
            __pc=1;return;
          case 1:
            _thread.exit(_thread.retVal);return;
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    allContacts :function _trc_BodyActor_allContacts(klass) {
      "use strict";
      var _this=this;
      var res;
      var c;
      var a;
      var b;
      
      //$LASTPOS=72003326;//kernel.BodyActor:3326
      _this.initBody();
      //$LASTPOS=72003343;//kernel.BodyActor:3343
      res = [];
      
      //$LASTPOS=72003360;//kernel.BodyActor:3360
      //$LASTPOS=72003365;//kernel.BodyActor:3365
      c = _this.world.GetContactList();
      for (; c ; c=c.GetNext()) {
        {
          //$LASTPOS=72003422;//kernel.BodyActor:3422
          if (c.IsTouching()) {
            //$LASTPOS=72003457;//kernel.BodyActor:3457
            a = c.GetFixtureA().GetBody().GetUserData();
            
            //$LASTPOS=72003517;//kernel.BodyActor:3517
            b = c.GetFixtureB().GetBody().GetUserData();
            
            //$LASTPOS=72003577;//kernel.BodyActor:3577
            if (a===_this) {
              //$LASTPOS=72003610;//kernel.BodyActor:3610
              if (! klass||b===klass||b instanceof klass) {
                //$LASTPOS=72003680;//kernel.BodyActor:3680
                res.push(b);
                
              }
              
            } else {
              //$LASTPOS=72003732;//kernel.BodyActor:3732
              if (b===_this) {
                //$LASTPOS=72003765;//kernel.BodyActor:3765
                if (! klass||a===klass||a instanceof klass) {
                  //$LASTPOS=72003835;//kernel.BodyActor:3835
                  res.push(a);
                  
                }
                
              }
            }
            
          }
        }
      }
      return res;
    },
    fiber$allContacts :function _trc_BodyActor_f_allContacts(_thread,klass) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var c;
      var a;
      var b;
      
      
      _thread.enter(function _trc_BodyActor_ent_allContacts(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=72003326;//kernel.BodyActor:3326
            _this.fiber$initBody(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=72003343;//kernel.BodyActor:3343
            res = [];
            
            //$LASTPOS=72003360;//kernel.BodyActor:3360
            //$LASTPOS=72003365;//kernel.BodyActor:3365
            c = _this.world.GetContactList();
            for (; c ; c=c.GetNext()) {
              {
                //$LASTPOS=72003422;//kernel.BodyActor:3422
                if (c.IsTouching()) {
                  //$LASTPOS=72003457;//kernel.BodyActor:3457
                  a = c.GetFixtureA().GetBody().GetUserData();
                  
                  //$LASTPOS=72003517;//kernel.BodyActor:3517
                  b = c.GetFixtureB().GetBody().GetUserData();
                  
                  //$LASTPOS=72003577;//kernel.BodyActor:3577
                  if (a===_this) {
                    //$LASTPOS=72003610;//kernel.BodyActor:3610
                    if (! klass||b===klass||b instanceof klass) {
                      //$LASTPOS=72003680;//kernel.BodyActor:3680
                      res.push(b);
                      
                    }
                    
                  } else {
                    //$LASTPOS=72003732;//kernel.BodyActor:3732
                    if (b===_this) {
                      //$LASTPOS=72003765;//kernel.BodyActor:3765
                      if (! klass||a===klass||a instanceof klass) {
                        //$LASTPOS=72003835;//kernel.BodyActor:3835
                        res.push(a);
                        
                      }
                      
                    }
                  }
                  
                }
              }
            }
            _thread.exit(res);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    applyForce :function _trc_BodyActor_applyForce(fx,fy,px,py) {
      "use strict";
      var _this=this;
      var b2Vec2;
      var scale;
      var fps;
      
      //$LASTPOS=72003953;//kernel.BodyActor:3953
      _this.initBody();
      //$LASTPOS=72003970;//kernel.BodyActor:3970
      b2Vec2 = Box2D.Common.Math.b2Vec2;
      
      //$LASTPOS=72004014;//kernel.BodyActor:4014
      scale = _this.getWorld().scale;
      
      //$LASTPOS=72004047;//kernel.BodyActor:4047
      fps = 60;
      
      //$LASTPOS=72004064;//kernel.BodyActor:4064
      _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());
    },
    fiber$applyForce :function _trc_BodyActor_f_applyForce(_thread,fx,fy,px,py) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var b2Vec2;
      var scale;
      var fps;
      
      
      _thread.enter(function _trc_BodyActor_ent_applyForce(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=72003953;//kernel.BodyActor:3953
            _this.fiber$initBody(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=72003970;//kernel.BodyActor:3970
            b2Vec2 = Box2D.Common.Math.b2Vec2;
            
            //$LASTPOS=72004014;//kernel.BodyActor:4014
            scale = _this.getWorld().scale;
            
            //$LASTPOS=72004047;//kernel.BodyActor:4047
            fps = 60;
            
            //$LASTPOS=72004064;//kernel.BodyActor:4064
            _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());
            _thread.exit(_this);return;
          }
        }
      });
    },
    applyImpulse :function _trc_BodyActor_applyImpulse(fx,fy,px,py) {
      "use strict";
      var _this=this;
      var b2Vec2;
      var scale;
      var fps;
      
      //$LASTPOS=72004158;//kernel.BodyActor:4158
      _this.initBody();
      //$LASTPOS=72004175;//kernel.BodyActor:4175
      b2Vec2 = Box2D.Common.Math.b2Vec2;
      
      //$LASTPOS=72004219;//kernel.BodyActor:4219
      scale = _this.getWorld().scale;
      
      //$LASTPOS=72004252;//kernel.BodyActor:4252
      fps = 60;
      
      //$LASTPOS=72004269;//kernel.BodyActor:4269
      _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());
    },
    fiber$applyImpulse :function _trc_BodyActor_f_applyImpulse(_thread,fx,fy,px,py) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var b2Vec2;
      var scale;
      var fps;
      
      
      _thread.enter(function _trc_BodyActor_ent_applyImpulse(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=72004158;//kernel.BodyActor:4158
            _this.fiber$initBody(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=72004175;//kernel.BodyActor:4175
            b2Vec2 = Box2D.Common.Math.b2Vec2;
            
            //$LASTPOS=72004219;//kernel.BodyActor:4219
            scale = _this.getWorld().scale;
            
            //$LASTPOS=72004252;//kernel.BodyActor:4252
            fps = 60;
            
            //$LASTPOS=72004269;//kernel.BodyActor:4269
            _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());
            _thread.exit(_this);return;
          }
        }
      });
    },
    applyTorque :function _trc_BodyActor_applyTorque(a) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=72004356;//kernel.BodyActor:4356
      _this.initBody();
      //$LASTPOS=72004373;//kernel.BodyActor:4373
      _this.body.ApplyTorque(a);
    },
    fiber$applyTorque :function _trc_BodyActor_f_applyTorque(_thread,a) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_BodyActor_ent_applyTorque(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=72004356;//kernel.BodyActor:4356
            _this.fiber$initBody(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=72004373;//kernel.BodyActor:4373
            _this.body.ApplyTorque(a);
            _thread.exit(_this);return;
          }
        }
      });
    },
    moveBy :function _trc_BodyActor_moveBy(dx,dy) {
      "use strict";
      var _this=this;
      var pos;
      
      //$LASTPOS=72004420;//kernel.BodyActor:4420
      _this.initBody();
      //$LASTPOS=72004437;//kernel.BodyActor:4437
      pos = _this.body.GetPosition();
      
      //$LASTPOS=72004470;//kernel.BodyActor:4470
      pos.x+=dx/_this.scale;
      //$LASTPOS=72004492;//kernel.BodyActor:4492
      pos.y+=dy/_this.scale;
      //$LASTPOS=72004514;//kernel.BodyActor:4514
      _this.body.SetPosition(pos);
    },
    fiber$moveBy :function _trc_BodyActor_f_moveBy(_thread,dx,dy) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var pos;
      
      
      _thread.enter(function _trc_BodyActor_ent_moveBy(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=72004420;//kernel.BodyActor:4420
            _this.fiber$initBody(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=72004437;//kernel.BodyActor:4437
            pos = _this.body.GetPosition();
            
            //$LASTPOS=72004470;//kernel.BodyActor:4470
            pos.x+=dx/_this.scale;
            //$LASTPOS=72004492;//kernel.BodyActor:4492
            pos.y+=dy/_this.scale;
            //$LASTPOS=72004514;//kernel.BodyActor:4514
            _this.body.SetPosition(pos);
            _thread.exit(_this);return;
          }
        }
      });
    },
    contactTo :function _trc_BodyActor_contactTo(t) {
      "use strict";
      var _this=this;
      
      return _this.allContact(t)[0];
    },
    fiber$contactTo :function _trc_BodyActor_f_contactTo(_thread,t) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.allContact(t)[0];return;
      
      
      _thread.retVal=_this;return;
    },
    die :function _trc_BodyActor_die() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=72004605;//kernel.BodyActor:4605
      Tonyu.classes.kernel.Actor.prototype.die.apply( _this, []);
      //$LASTPOS=72004623;//kernel.BodyActor:4623
      if (_this.world) {
        //$LASTPOS=72004634;//kernel.BodyActor:4634
        _this.world.DestroyBody(_this.body);
      }
    },
    addRevoluteJoint :function _trc_BodyActor_addRevoluteJoint(params) {
      "use strict";
      var _this=this;
      var px;
      var py;
      var wworld;
      var scale;
      var world;
      var b2BodyDef;
      var b2Body;
      var JDC;
      var jd;
      var bodyB;
      var bodyDef;
      var b2Vec2;
      
      //$LASTPOS=72004696;//kernel.BodyActor:4696
      _this.initBody();
      //$LASTPOS=72004743;//kernel.BodyActor:4743
      params=params||{};
      //$LASTPOS=72004767;//kernel.BodyActor:4767
      px = params.x||_this.x;
      
      //$LASTPOS=72004792;//kernel.BodyActor:4792
      py = params.y||_this.y;
      
      //$LASTPOS=72004817;//kernel.BodyActor:4817
      wworld = _this.getWorld();
      
      //$LASTPOS=72004859;//kernel.BodyActor:4859
      scale = wworld.scale;
      
      //$LASTPOS=72004888;//kernel.BodyActor:4888
      world = wworld.world;
      
      //$LASTPOS=72004917;//kernel.BodyActor:4917
      b2BodyDef = Box2D.Dynamics.b2BodyDef;
      
      //$LASTPOS=72004964;//kernel.BodyActor:4964
      b2Body = Box2D.Dynamics.b2Body;
      
      //$LASTPOS=72005005;//kernel.BodyActor:5005
      JDC = Box2D.Dynamics.Joints.b2RevoluteJointDef;
      
      //$LASTPOS=72005060;//kernel.BodyActor:5060
      jd = new JDC;
      
      
      //$LASTPOS=72005097;//kernel.BodyActor:5097
      if (params.other&&params.other instanceof Tonyu.classes.kernel.BodyActor) {
        //$LASTPOS=72005155;//kernel.BodyActor:5155
        params.other.initBody();
        //$LASTPOS=72005189;//kernel.BodyActor:5189
        bodyB=params.other.body;
        
      } else {
        //$LASTPOS=72005237;//kernel.BodyActor:5237
        bodyDef = new b2BodyDef;
        
        //$LASTPOS=72005275;//kernel.BodyActor:5275
        bodyDef.type=b2Body.b2_staticBody;
        //$LASTPOS=72005321;//kernel.BodyActor:5321
        bodyDef.position.x=px/scale;
        //$LASTPOS=72005362;//kernel.BodyActor:5362
        bodyDef.position.y=py/scale;
        //$LASTPOS=72005403;//kernel.BodyActor:5403
        bodyB=world.CreateBody(bodyDef);
        
      }
      //$LASTPOS=72005448;//kernel.BodyActor:5448
      b2Vec2 = Box2D.Common.Math.b2Vec2;
      
      //$LASTPOS=72005492;//kernel.BodyActor:5492
      jd.Initialize(_this.body,bodyB,new b2Vec2(px/scale,py/scale));
      //$LASTPOS=72005555;//kernel.BodyActor:5555
      if (params.lowerAngle&&params.upperAngle) {
        //$LASTPOS=72005609;//kernel.BodyActor:5609
        jd.lowerAngle=_this.rad(params.lowerAngle);
        //$LASTPOS=72005657;//kernel.BodyActor:5657
        jd.upperAngle=_this.rad(params.upperAngle);
        //$LASTPOS=72005705;//kernel.BodyActor:5705
        jd.enableLimit=true;
        
      }
      //$LASTPOS=72005740;//kernel.BodyActor:5740
      world.CreateJoint(jd);
    },
    fiber$addRevoluteJoint :function _trc_BodyActor_f_addRevoluteJoint(_thread,params) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var px;
      var py;
      var wworld;
      var scale;
      var world;
      var b2BodyDef;
      var b2Body;
      var JDC;
      var jd;
      var bodyB;
      var bodyDef;
      var b2Vec2;
      
      
      _thread.enter(function _trc_BodyActor_ent_addRevoluteJoint(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=72004696;//kernel.BodyActor:4696
            _this.fiber$initBody(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=72004743;//kernel.BodyActor:4743
            params=params||{};
            //$LASTPOS=72004767;//kernel.BodyActor:4767
            px = params.x||_this.x;
            
            //$LASTPOS=72004792;//kernel.BodyActor:4792
            py = params.y||_this.y;
            
            //$LASTPOS=72004817;//kernel.BodyActor:4817
            _this.fiber$getWorld(_thread);
            __pc=2;return;
          case 2:
            wworld=_thread.retVal;
            
            //$LASTPOS=72004859;//kernel.BodyActor:4859
            scale = wworld.scale;
            
            //$LASTPOS=72004888;//kernel.BodyActor:4888
            world = wworld.world;
            
            //$LASTPOS=72004917;//kernel.BodyActor:4917
            b2BodyDef = Box2D.Dynamics.b2BodyDef;
            
            //$LASTPOS=72004964;//kernel.BodyActor:4964
            b2Body = Box2D.Dynamics.b2Body;
            
            //$LASTPOS=72005005;//kernel.BodyActor:5005
            JDC = Box2D.Dynamics.Joints.b2RevoluteJointDef;
            
            //$LASTPOS=72005060;//kernel.BodyActor:5060
            jd = new JDC;
            
            
            //$LASTPOS=72005097;//kernel.BodyActor:5097
            if (params.other&&params.other instanceof Tonyu.classes.kernel.BodyActor) {
              //$LASTPOS=72005155;//kernel.BodyActor:5155
              params.other.initBody();
              //$LASTPOS=72005189;//kernel.BodyActor:5189
              bodyB=params.other.body;
              
            } else {
              //$LASTPOS=72005237;//kernel.BodyActor:5237
              bodyDef = new b2BodyDef;
              
              //$LASTPOS=72005275;//kernel.BodyActor:5275
              bodyDef.type=b2Body.b2_staticBody;
              //$LASTPOS=72005321;//kernel.BodyActor:5321
              bodyDef.position.x=px/scale;
              //$LASTPOS=72005362;//kernel.BodyActor:5362
              bodyDef.position.y=py/scale;
              //$LASTPOS=72005403;//kernel.BodyActor:5403
              bodyB=world.CreateBody(bodyDef);
              
            }
            //$LASTPOS=72005448;//kernel.BodyActor:5448
            b2Vec2 = Box2D.Common.Math.b2Vec2;
            
            //$LASTPOS=72005492;//kernel.BodyActor:5492
            jd.Initialize(_this.body,bodyB,new b2Vec2(px/scale,py/scale));
            //$LASTPOS=72005555;//kernel.BodyActor:5555
            if (params.lowerAngle&&params.upperAngle) {
              //$LASTPOS=72005609;//kernel.BodyActor:5609
              jd.lowerAngle=_this.rad(params.lowerAngle);
              //$LASTPOS=72005657;//kernel.BodyActor:5657
              jd.upperAngle=_this.rad(params.upperAngle);
              //$LASTPOS=72005705;//kernel.BodyActor:5705
              jd.enableLimit=true;
              
            }
            //$LASTPOS=72005740;//kernel.BodyActor:5740
            world.CreateJoint(jd);
            _thread.exit(_this);return;
          }
        }
      });
    },
    __getter__rotation :function _trc_BodyActor___getter__rotation() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=72005784;//kernel.BodyActor:5784
      if (! _this.body||_this.manualRotation) {
        return _this._rotation;
      }
      return _this.deg(_this.body.GetAngle());
    },
    __setter__rotation :function _trc_BodyActor___setter__rotation(r) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=72005888;//kernel.BodyActor:5888
      r=r||0;
      //$LASTPOS=72005901;//kernel.BodyActor:5901
      if (! _this.body||_this.manualRotation) {
        return _this._rotation=r;
      }
      //$LASTPOS=72005955;//kernel.BodyActor:5955
      _this.body.SetAngle(_this.rad(r));
    },
    __getter__x :function _trc_BodyActor___getter__x() {
      "use strict";
      var _this=this;
      var pos;
      
      //$LASTPOS=72005994;//kernel.BodyActor:5994
      if (! _this.body) {
        return _this._x;
      }
      //$LASTPOS=72006021;//kernel.BodyActor:6021
      pos = _this.body.GetPosition();
      
      return pos.x*_this.scale;
    },
    __setter__x :function _trc_BodyActor___setter__x(v) {
      "use strict";
      var _this=this;
      var pos;
      
      //$LASTPOS=72006090;//kernel.BodyActor:6090
      if (! _this.body) {
        return _this._x=v;
      }
      //$LASTPOS=72006119;//kernel.BodyActor:6119
      v=v||0;
      //$LASTPOS=72006132;//kernel.BodyActor:6132
      pos = _this.body.GetPosition();
      
      //$LASTPOS=72006165;//kernel.BodyActor:6165
      pos.x=v/_this.scale;
      //$LASTPOS=72006185;//kernel.BodyActor:6185
      _this.body.SetPosition(pos);
    },
    __getter__y :function _trc_BodyActor___getter__y() {
      "use strict";
      var _this=this;
      var pos;
      
      //$LASTPOS=72006222;//kernel.BodyActor:6222
      if (! _this.body) {
        return _this._y;
      }
      //$LASTPOS=72006249;//kernel.BodyActor:6249
      pos = _this.body.GetPosition();
      
      return pos.y*_this.scale;
    },
    __setter__y :function _trc_BodyActor___setter__y(v) {
      "use strict";
      var _this=this;
      var pos;
      
      //$LASTPOS=72006318;//kernel.BodyActor:6318
      if (! _this.body) {
        return _this._y=v;
      }
      //$LASTPOS=72006347;//kernel.BodyActor:6347
      v=v||0;
      //$LASTPOS=72006360;//kernel.BodyActor:6360
      pos = _this.body.GetPosition();
      
      //$LASTPOS=72006393;//kernel.BodyActor:6393
      pos.y=v/_this.scale;
      //$LASTPOS=72006413;//kernel.BodyActor:6413
      _this.body.SetPosition(pos);
    },
    __getter__vx :function _trc_BodyActor___getter__vx() {
      "use strict";
      var _this=this;
      var v;
      
      //$LASTPOS=72006453;//kernel.BodyActor:6453
      if (! _this.body) {
        return _this._vx;
      }
      //$LASTPOS=72006481;//kernel.BodyActor:6481
      v = _this.body.GetLinearVelocity();
      
      return v.x*_this.scale/_this.getWorld().fps;
    },
    __setter__vx :function _trc_BodyActor___setter__vx(v) {
      "use strict";
      var _this=this;
      var ve;
      
      //$LASTPOS=72006568;//kernel.BodyActor:6568
      if (! _this.body) {
        return _this._vx=v;
      }
      //$LASTPOS=72006598;//kernel.BodyActor:6598
      v=v||0;
      //$LASTPOS=72006611;//kernel.BodyActor:6611
      ve = _this.body.GetLinearVelocity();
      
      //$LASTPOS=72006649;//kernel.BodyActor:6649
      ve.x=v/_this.scale*_this.getWorld().fps;
      //$LASTPOS=72006683;//kernel.BodyActor:6683
      if (v) {
        //$LASTPOS=72006690;//kernel.BodyActor:6690
        _this.body.SetAwake(true);
      }
      //$LASTPOS=72006716;//kernel.BodyActor:6716
      _this.body.SetLinearVelocity(ve);
    },
    __getter__vy :function _trc_BodyActor___getter__vy() {
      "use strict";
      var _this=this;
      var v;
      
      //$LASTPOS=72006761;//kernel.BodyActor:6761
      if (! _this.body) {
        return _this._vy;
      }
      //$LASTPOS=72006789;//kernel.BodyActor:6789
      v = _this.body.GetLinearVelocity();
      
      return v.y*_this.scale/_this.getWorld().fps;
    },
    __setter__vy :function _trc_BodyActor___setter__vy(v) {
      "use strict";
      var _this=this;
      var ve;
      
      //$LASTPOS=72006876;//kernel.BodyActor:6876
      if (! _this.body) {
        return _this._vy=v;
      }
      //$LASTPOS=72006906;//kernel.BodyActor:6906
      ve = _this.body.GetLinearVelocity();
      
      //$LASTPOS=72006944;//kernel.BodyActor:6944
      ve.y=v/_this.scale*_this.getWorld().fps;
      //$LASTPOS=72006978;//kernel.BodyActor:6978
      if (v) {
        //$LASTPOS=72006985;//kernel.BodyActor:6985
        _this.body.SetAwake(true);
      }
      //$LASTPOS=72007011;//kernel.BodyActor:7011
      _this.body.SetLinearVelocity(ve);
    },
    __getter__vrotation :function _trc_BodyActor___getter__vrotation() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=72007061;//kernel.BodyActor:7061
      if (! _this.body) {
        return _this._vr;
      }
      return _this.deg(_this.body.GetAngularVelocity()/_this.getWorld().fps);
    },
    __setter__vrotation :function _trc_BodyActor___setter__vrotation(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=72007167;//kernel.BodyActor:7167
      if (! _this.body) {
        return _this._vr=v;
      }
      //$LASTPOS=72007197;//kernel.BodyActor:7197
      v=v||0;
      //$LASTPOS=72007210;//kernel.BodyActor:7210
      if (v) {
        //$LASTPOS=72007217;//kernel.BodyActor:7217
        _this.body.SetAwake(true);
      }
      //$LASTPOS=72007243;//kernel.BodyActor:7243
      _this.body.SetAngularVelocity(_this.rad(v*_this.getWorld().fps));
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"getWorld":{"nowait":false},"update":{"nowait":false},"initBody":{"nowait":false},"allContactPoints":{"nowait":false},"contactPoint":{"nowait":false},"allContact":{"nowait":false},"allContacts":{"nowait":false},"applyForce":{"nowait":false},"applyImpulse":{"nowait":false},"applyTorque":{"nowait":false},"moveBy":{"nowait":false},"contactTo":{"nowait":false},"die":{"nowait":true},"addRevoluteJoint":{"nowait":false},"__getter__rotation":{"nowait":true},"__setter__rotation":{"nowait":true},"__getter__x":{"nowait":true},"__setter__x":{"nowait":true},"__getter__y":{"nowait":true},"__setter__y":{"nowait":true},"__getter__vx":{"nowait":true},"__setter__vx":{"nowait":true},"__getter__vy":{"nowait":true},"__setter__vy":{"nowait":true},"__getter__vrotation":{"nowait":true},"__setter__vrotation":{"nowait":true}},"fields":{"body":{},"world":{},"density":{},"friction":{},"restitution":{},"isStatic":{},"shape":{},"manualRotation":{},"_rotation":{},"_x":{},"_y":{},"_vx":{},"_vy":{},"_vr":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T2Body',
  shortName: 'T2Body',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.BodyActor,
  includes: [],
  methods: {
    main :function _trc_T2Body_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_T2Body_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.T2World',
  shortName: 'T2World',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [Tonyu.classes.kernel.T2Mod],
  methods: {
    main :function _trc_T2World_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=73000150;//kernel.T2World:150
      _this.loop();
    },
    fiber$main :function _trc_T2World_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_T2World_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=73000150;//kernel.T2World:150
            _this.fiber$loop(_thread);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    onAppear :function _trc_T2World_onAppear() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=73000086;//kernel.T2World:86
      Tonyu.globals.$currentProject.requestPlugin("box2d");
      //$LASTPOS=73000133;//kernel.T2World:133
      _this.initWorld();
    },
    fiber$onAppear :function _trc_T2World_f_onAppear(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=73000086;//kernel.T2World:86
      Tonyu.globals.$currentProject.requestPlugin("box2d");
      
      _thread.enter(function _trc_T2World_ent_onAppear(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=73000133;//kernel.T2World:133
            _this.fiber$initWorld(_thread);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    initWorld :function _trc_T2World_initWorld() {
      "use strict";
      var _this=this;
      var b2World;
      var b2Vec2;
      
      //$LASTPOS=73000183;//kernel.T2World:183
      _this.gravity=_this.defv(_this.gravity,9.8);
      //$LASTPOS=73000216;//kernel.T2World:216
      _this.gravityX=_this.defv(_this.gravityX,0);
      //$LASTPOS=73000249;//kernel.T2World:249
      _this.fps=Tonyu.globals.$Boot.getFrameRate();
      //$LASTPOS=73000280;//kernel.T2World:280
      b2World = Box2D.Dynamics.b2World;
      
      //$LASTPOS=73000323;//kernel.T2World:323
      b2Vec2 = Box2D.Common.Math.b2Vec2;
      
      //$LASTPOS=73000367;//kernel.T2World:367
      _this.scale=_this.scale||32;
      //$LASTPOS=73000391;//kernel.T2World:391
      _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);
      //$LASTPOS=73000516;//kernel.T2World:516
      Tonyu.globals.$t2World=_this;
      //$LASTPOS=73000536;//kernel.T2World:536
      Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));
      //$LASTPOS=73000572;//kernel.T2World:572
      _this.on("die",Tonyu.bindFunc(_this,_this.releaseWorld));
    },
    fiber$initWorld :function _trc_T2World_f_initWorld(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var b2World;
      var b2Vec2;
      
      
      _thread.enter(function _trc_T2World_ent_initWorld(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=73000183;//kernel.T2World:183
            _this.fiber$defv(_thread, _this.gravity, 9.8);
            __pc=1;return;
          case 1:
            _this.gravity=_thread.retVal;
            
            //$LASTPOS=73000216;//kernel.T2World:216
            _this.fiber$defv(_thread, _this.gravityX, 0);
            __pc=2;return;
          case 2:
            _this.gravityX=_thread.retVal;
            
            //$LASTPOS=73000249;//kernel.T2World:249
            _this.fps=Tonyu.globals.$Boot.getFrameRate();
            //$LASTPOS=73000280;//kernel.T2World:280
            b2World = Box2D.Dynamics.b2World;
            
            //$LASTPOS=73000323;//kernel.T2World:323
            b2Vec2 = Box2D.Common.Math.b2Vec2;
            
            //$LASTPOS=73000367;//kernel.T2World:367
            _this.scale=_this.scale||32;
            //$LASTPOS=73000391;//kernel.T2World:391
            _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);
            //$LASTPOS=73000516;//kernel.T2World:516
            Tonyu.globals.$t2World=_this;
            //$LASTPOS=73000536;//kernel.T2World:536
            Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));
            //$LASTPOS=73000572;//kernel.T2World:572
            _this.on("die",Tonyu.bindFunc(_this,_this.releaseWorld));
            _thread.exit(_this);return;
          }
        }
      });
    },
    releaseWorld :function _trc_T2World_releaseWorld() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=73000623;//kernel.T2World:623
      if (Tonyu.globals.$t2World===_this) {
        //$LASTPOS=73000644;//kernel.T2World:644
        Tonyu.globals.$t2World=null;
      }
    },
    fiber$releaseWorld :function _trc_T2World_f_releaseWorld(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=73000623;//kernel.T2World:623
      if (Tonyu.globals.$t2World===_this) {
        //$LASTPOS=73000644;//kernel.T2World:644
        Tonyu.globals.$t2World=null;
      }
      
      _thread.retVal=_this;return;
    },
    loop :function _trc_T2World_loop() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=73000680;//kernel.T2World:680
      while (true) {
        //$LASTPOS=73000703;//kernel.T2World:703
        _this.fps=Tonyu.globals.$Boot.getFrameRate();
        //$LASTPOS=73000738;//kernel.T2World:738
        _this.world.Step(1/_this.fps,10,10);
        //$LASTPOS=73000922;//kernel.T2World:922
        _this.world.ClearForces();
        //$LASTPOS=73000976;//kernel.T2World:976
        _this.update();
        
      }
    },
    fiber$loop :function _trc_T2World_f_loop(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_T2World_ent_loop(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=73000680;//kernel.T2World:680
          case 1:
            //$LASTPOS=73000703;//kernel.T2World:703
            _this.fps=Tonyu.globals.$Boot.getFrameRate();
            //$LASTPOS=73000738;//kernel.T2World:738
            _this.world.Step(1/_this.fps,10,10);
            //$LASTPOS=73000922;//kernel.T2World:922
            _this.world.ClearForces();
            //$LASTPOS=73000976;//kernel.T2World:976
            _this.fiber$update(_thread);
            __pc=2;return;
          case 2:
            
            __pc=1;break;
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    updatePos :function _trc_T2World_updatePos() {
      "use strict";
      var _this=this;
      var b;
      var d;
      
      //$LASTPOS=73001017;//kernel.T2World:1017
      //$LASTPOS=73001022;//kernel.T2World:1022
      b = _this.world.GetBodyList();
      for (; b ; b=b.GetNext()) {
        {
          //$LASTPOS=73001076;//kernel.T2World:1076
          d = b.GetUserData();
          
          //$LASTPOS=73001108;//kernel.T2World:1108
          if (d) {
            //$LASTPOS=73001114;//kernel.T2World:1114
            d.updatePos();
          }
        }
      }
    },
    fiber$updatePos :function _trc_T2World_f_updatePos(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var b;
      var d;
      
      //$LASTPOS=73001017;//kernel.T2World:1017
      //$LASTPOS=73001022;//kernel.T2World:1022
      b = _this.world.GetBodyList();
      for (; b ; b=b.GetNext()) {
        {
          //$LASTPOS=73001076;//kernel.T2World:1076
          d = b.GetUserData();
          
          //$LASTPOS=73001108;//kernel.T2World:1108
          if (d) {
            //$LASTPOS=73001114;//kernel.T2World:1114
            d.updatePos();
          }
        }
      }
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"onAppear":{"nowait":false},"initWorld":{"nowait":false},"releaseWorld":{"nowait":false},"loop":{"nowait":false},"updatePos":{"nowait":false}},"fields":{"gravity":{},"gravityX":{},"fps":{},"world":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T2MediaPlayer',
  shortName: 'T2MediaPlayer',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_T2MediaPlayer_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_T2MediaPlayer_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_T2MediaPlayer_initialize() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74000086;//kernel.T2MediaPlayer:86
      _this.initT2MediaPlayer();
    },
    initT2MediaPlayer :function _trc_T2MediaPlayer_initT2MediaPlayer() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74000141;//kernel.T2MediaPlayer:141
      if (! Tonyu.globals.$t2MediaLib) {
        //$LASTPOS=74000170;//kernel.T2MediaPlayer:170
        Tonyu.globals.$t2MediaLib=new T2MediaLib();
        
      }
      //$LASTPOS=74000214;//kernel.T2MediaPlayer:214
      _this.bgmPlayerMax=Tonyu.globals.$t2MediaLib.bgmPlayerMax;
    },
    fiber$initT2MediaPlayer :function _trc_T2MediaPlayer_f_initT2MediaPlayer(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74000141;//kernel.T2MediaPlayer:141
      if (! Tonyu.globals.$t2MediaLib) {
        //$LASTPOS=74000170;//kernel.T2MediaPlayer:170
        Tonyu.globals.$t2MediaLib=new T2MediaLib();
        
      }
      //$LASTPOS=74000214;//kernel.T2MediaPlayer:214
      _this.bgmPlayerMax=Tonyu.globals.$t2MediaLib.bgmPlayerMax;
      
      _thread.retVal=_this;return;
    },
    allClearSoundData :function _trc_T2MediaPlayer_allClearSoundData() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74000289;//kernel.T2MediaPlayer:289
      Tonyu.globals.$t2MediaLib.allResetBGM();
      //$LASTPOS=74000321;//kernel.T2MediaPlayer:321
      Tonyu.globals.$t2MediaLib.allClearSoundData();
    },
    fiber$allClearSoundData :function _trc_T2MediaPlayer_f_allClearSoundData(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74000289;//kernel.T2MediaPlayer:289
      Tonyu.globals.$t2MediaLib.allResetBGM();
      //$LASTPOS=74000321;//kernel.T2MediaPlayer:321
      Tonyu.globals.$t2MediaLib.allClearSoundData();
      
      _thread.retVal=_this;return;
    },
    clearSoundData :function _trc_T2MediaPlayer_clearSoundData(idx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74000388;//kernel.T2MediaPlayer:388
      Tonyu.globals.$t2MediaLib.clearSoundData(idx);
    },
    fiber$clearSoundData :function _trc_T2MediaPlayer_f_clearSoundData(_thread,idx) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74000388;//kernel.T2MediaPlayer:388
      Tonyu.globals.$t2MediaLib.clearSoundData(idx);
      
      _thread.retVal=_this;return;
    },
    allRemoveDecodedSoundData :function _trc_T2MediaPlayer_allRemoveDecodedSoundData() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74000463;//kernel.T2MediaPlayer:463
      Tonyu.globals.$t2MediaLib.allRemoveDecodedSoundData();
    },
    fiber$allRemoveDecodedSoundData :function _trc_T2MediaPlayer_f_allRemoveDecodedSoundData(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74000463;//kernel.T2MediaPlayer:463
      Tonyu.globals.$t2MediaLib.allRemoveDecodedSoundData();
      
      _thread.retVal=_this;return;
    },
    removeDecodedSoundData :function _trc_T2MediaPlayer_removeDecodedSoundData(idx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74000546;//kernel.T2MediaPlayer:546
      Tonyu.globals.$t2MediaLib.removeDecodedSoundData(idx);
    },
    fiber$removeDecodedSoundData :function _trc_T2MediaPlayer_f_removeDecodedSoundData(_thread,idx) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74000546;//kernel.T2MediaPlayer:546
      Tonyu.globals.$t2MediaLib.removeDecodedSoundData(idx);
      
      _thread.retVal=_this;return;
    },
    getMasterVolume :function _trc_T2MediaPlayer_getMasterVolume() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getMasterVolume()*128;
    },
    fiber$getMasterVolume :function _trc_T2MediaPlayer_f_getMasterVolume(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getMasterVolume()*128;return;
      
      
      _thread.retVal=_this;return;
    },
    setMasterVolume :function _trc_T2MediaPlayer_setMasterVolume(vol) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74000698;//kernel.T2MediaPlayer:698
      if (typeof  vol==="number") {
        //$LASTPOS=74000738;//kernel.T2MediaPlayer:738
        vol/=128;
        //$LASTPOS=74000759;//kernel.T2MediaPlayer:759
        if (vol<0) {
          //$LASTPOS=74000774;//kernel.T2MediaPlayer:774
          vol=0;
        }
        
      } else {
        return Tonyu.globals.$t2MediaLib.setMasterVolume(Tonyu.globals.$t2MediaLib.getMasterVolume());
        
      }
      return Tonyu.globals.$t2MediaLib.setMasterVolume(vol);
    },
    fiber$setMasterVolume :function _trc_T2MediaPlayer_f_setMasterVolume(_thread,vol) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74000698;//kernel.T2MediaPlayer:698
      if (typeof  vol==="number") {
        //$LASTPOS=74000738;//kernel.T2MediaPlayer:738
        vol/=128;
        //$LASTPOS=74000759;//kernel.T2MediaPlayer:759
        if (vol<0) {
          //$LASTPOS=74000774;//kernel.T2MediaPlayer:774
          vol=0;
        }
        
      } else {
        _thread.retVal=Tonyu.globals.$t2MediaLib.setMasterVolume(Tonyu.globals.$t2MediaLib.getMasterVolume());return;
        
        
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.setMasterVolume(vol);return;
      
      
      _thread.retVal=_this;return;
    },
    loadSound :function _trc_T2MediaPlayer_loadSound(idx,src,callbacks) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74000983;//kernel.T2MediaPlayer:983
      Tonyu.globals.$t2MediaLib.loadSound(idx,src,callbacks);
    },
    fiber$loadSound :function _trc_T2MediaPlayer_f_loadSound(_thread,idx,src,callbacks) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74000983;//kernel.T2MediaPlayer:983
      Tonyu.globals.$t2MediaLib.loadSound(idx,src,callbacks);
      
      _thread.retVal=_this;return;
    },
    __getter__available :function _trc_T2MediaPlayer___getter__available() {
      "use strict";
      var _this=this;
      
      return ! ! Tonyu.globals.$t2MediaLib.context;
    },
    loadFromProject :function _trc_T2MediaPlayer_loadFromProject(prj) {
      "use strict";
      var _this=this;
      var r;
      var jobs;
      var cnt;
      var callbacks;
      var s;
      var name;
      var url;
      var func;
      var i;
      
      //$LASTPOS=74001126;//kernel.T2MediaPlayer:1126
      if (! _this.available) {
        return _this;
      }
      //$LASTPOS=74001155;//kernel.T2MediaPlayer:1155
      r = prj.getResource();
      
      //$LASTPOS=74001185;//kernel.T2MediaPlayer:1185
      if (! r||! r.sounds) {
        return _this;
      }
      //$LASTPOS=74001219;//kernel.T2MediaPlayer:1219
      if (r.sounds<=0) {
        return _this;
      }
      //$LASTPOS=74001253;//kernel.T2MediaPlayer:1253
      _this.progressNoLog("Loading sounds...[0/"+r.sounds.length+"]");
      //$LASTPOS=74001334;//kernel.T2MediaPlayer:1334
      jobs = 6;
      
      //$LASTPOS=74001351;//kernel.T2MediaPlayer:1351
      cnt = 0;
      
      //$LASTPOS=74001367;//kernel.T2MediaPlayer:1367
      callbacks = {};
      
      
      //$LASTPOS=74001413;//kernel.T2MediaPlayer:1413
      func = (function anonymous_1424(idx,errorID) {
        var s;
        var name;
        var url;
        
        //$LASTPOS=74001457;//kernel.T2MediaPlayer:1457
        if (errorID) {
          //$LASTPOS=74001485;//kernel.T2MediaPlayer:1485
          console.log(errorID);
          //$LASTPOS=74001564;//kernel.T2MediaPlayer:1564
          Tonyu.setGlobal(idx,"ERROR");
          
        } else {
          //$LASTPOS=74001672;//kernel.T2MediaPlayer:1672
          Tonyu.setGlobal(idx,idx);
          
        }
        //$LASTPOS=74001721;//kernel.T2MediaPlayer:1721
        cnt++;
        //$LASTPOS=74001738;//kernel.T2MediaPlayer:1738
        if (cnt>=r.sounds.length) {
          return _this;
        }
        //$LASTPOS=74001783;//kernel.T2MediaPlayer:1783
        _this.progressNoLog("Loading sounds...["+(cnt+1)+"/"+r.sounds.length+"]");
        //$LASTPOS=74001861;//kernel.T2MediaPlayer:1861
        s = r.sounds[cnt];
        
        //$LASTPOS=74001893;//kernel.T2MediaPlayer:1893
        name = s.name;
        
        //$LASTPOS=74001919;//kernel.T2MediaPlayer:1919
        url = Tonyu.Assets.resolve(s.url,prj);
        
        //$LASTPOS=74001970;//kernel.T2MediaPlayer:1970
        _this.loadSound(name,url,callbacks);
      });
      
      //$LASTPOS=74002016;//kernel.T2MediaPlayer:2016
      callbacks.succ=func;
      //$LASTPOS=74002042;//kernel.T2MediaPlayer:2042
      callbacks.err=func;
      //$LASTPOS=74002067;//kernel.T2MediaPlayer:2067
      //$LASTPOS=74002072;//kernel.T2MediaPlayer:2072
      i = 0;
      for (; i<jobs ; i++) {
        {
          //$LASTPOS=74002105;//kernel.T2MediaPlayer:2105
          if (i>=r.sounds.length) {
            break;
            
          }
          //$LASTPOS=74002147;//kernel.T2MediaPlayer:2147
          s=r.sounds[i];
          //$LASTPOS=74002173;//kernel.T2MediaPlayer:2173
          name=s.name;
          //$LASTPOS=74002195;//kernel.T2MediaPlayer:2195
          url=Tonyu.Assets.resolve(s.url,prj);
          //$LASTPOS=74002242;//kernel.T2MediaPlayer:2242
          _this.loadSound(name,url,callbacks);
        }
      }
      //$LASTPOS=74002287;//kernel.T2MediaPlayer:2287
      while (cnt<r.sounds.length) {
        //$LASTPOS=74002328;//kernel.T2MediaPlayer:2328
        _this.update();
        
      }
    },
    fiber$loadFromProject :function _trc_T2MediaPlayer_f_loadFromProject(_thread,prj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var r;
      var jobs;
      var cnt;
      var callbacks;
      var s;
      var name;
      var url;
      var func;
      var i;
      
      //$LASTPOS=74001126;//kernel.T2MediaPlayer:1126
      if (! _this.available) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=74001155;//kernel.T2MediaPlayer:1155
      r = prj.getResource();
      
      //$LASTPOS=74001185;//kernel.T2MediaPlayer:1185
      if (! r||! r.sounds) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=74001219;//kernel.T2MediaPlayer:1219
      if (r.sounds<=0) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=74001253;//kernel.T2MediaPlayer:1253
      _this.progressNoLog("Loading sounds...[0/"+r.sounds.length+"]");
      //$LASTPOS=74001334;//kernel.T2MediaPlayer:1334
      jobs = 6;
      
      //$LASTPOS=74001351;//kernel.T2MediaPlayer:1351
      cnt = 0;
      
      //$LASTPOS=74001367;//kernel.T2MediaPlayer:1367
      callbacks = {};
      
      
      
      _thread.enter(function _trc_T2MediaPlayer_ent_loadFromProject(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=74001413;//kernel.T2MediaPlayer:1413
            func = (function anonymous_1424(idx,errorID) {
              var s;
              var name;
              var url;
              
              //$LASTPOS=74001457;//kernel.T2MediaPlayer:1457
              if (errorID) {
                //$LASTPOS=74001485;//kernel.T2MediaPlayer:1485
                console.log(errorID);
                //$LASTPOS=74001564;//kernel.T2MediaPlayer:1564
                Tonyu.setGlobal(idx,"ERROR");
                
              } else {
                //$LASTPOS=74001672;//kernel.T2MediaPlayer:1672
                Tonyu.setGlobal(idx,idx);
                
              }
              //$LASTPOS=74001721;//kernel.T2MediaPlayer:1721
              cnt++;
              //$LASTPOS=74001738;//kernel.T2MediaPlayer:1738
              if (cnt>=r.sounds.length) {
                return _this;
              }
              //$LASTPOS=74001783;//kernel.T2MediaPlayer:1783
              _this.progressNoLog("Loading sounds...["+(cnt+1)+"/"+r.sounds.length+"]");
              //$LASTPOS=74001861;//kernel.T2MediaPlayer:1861
              s = r.sounds[cnt];
              
              //$LASTPOS=74001893;//kernel.T2MediaPlayer:1893
              name = s.name;
              
              //$LASTPOS=74001919;//kernel.T2MediaPlayer:1919
              url = Tonyu.Assets.resolve(s.url,prj);
              
              //$LASTPOS=74001970;//kernel.T2MediaPlayer:1970
              _this.loadSound(name,url,callbacks);
            });
            
            //$LASTPOS=74002016;//kernel.T2MediaPlayer:2016
            callbacks.succ=func;
            //$LASTPOS=74002042;//kernel.T2MediaPlayer:2042
            callbacks.err=func;
            //$LASTPOS=74002067;//kernel.T2MediaPlayer:2067
            //$LASTPOS=74002072;//kernel.T2MediaPlayer:2072
            i = 0;
            
          case 1:
            if (!(i<jobs)) { __pc=5     ; break; }
            //$LASTPOS=74002105;//kernel.T2MediaPlayer:2105
            if (!(i>=r.sounds.length)) { __pc=2     ; break; }
            __pc=5     ; break;
            
          case 2     :
            
            //$LASTPOS=74002147;//kernel.T2MediaPlayer:2147
            s=r.sounds[i];
            //$LASTPOS=74002173;//kernel.T2MediaPlayer:2173
            name=s.name;
            //$LASTPOS=74002195;//kernel.T2MediaPlayer:2195
            url=Tonyu.Assets.resolve(s.url,prj);
            //$LASTPOS=74002242;//kernel.T2MediaPlayer:2242
            _this.fiber$loadSound(_thread, name, url, callbacks);
            __pc=3;return;
          case 3:
            
          case 4     :
            i++;
            __pc=1;break;
          case 5     :
            
            //$LASTPOS=74002287;//kernel.T2MediaPlayer:2287
          case 6:
            if (!(cnt<r.sounds.length)) { __pc=8     ; break; }
            //$LASTPOS=74002328;//kernel.T2MediaPlayer:2328
            _this.fiber$update(_thread);
            __pc=7;return;
          case 7:
            
            __pc=6;break;
          case 8     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    decodeSound :function _trc_T2MediaPlayer_decodeSound(idx,callbacks) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74002412;//kernel.T2MediaPlayer:2412
      Tonyu.globals.$t2MediaLib.decodeSound(idx,callbacks);
    },
    fiber$decodeSound :function _trc_T2MediaPlayer_f_decodeSound(_thread,idx,callbacks) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74002412;//kernel.T2MediaPlayer:2412
      Tonyu.globals.$t2MediaLib.decodeSound(idx,callbacks);
      
      _thread.retVal=_this;return;
    },
    getSoundFileData :function _trc_T2MediaPlayer_getSoundFileData(idx) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getSoundFileData(idx);
    },
    fiber$getSoundFileData :function _trc_T2MediaPlayer_f_getSoundFileData(_thread,idx) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getSoundFileData(idx);return;
      
      
      _thread.retVal=_this;return;
    },
    getSoundDecodedData :function _trc_T2MediaPlayer_getSoundDecodedData(idx) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getSoundDecodedData(idx);
    },
    fiber$getSoundDecodedData :function _trc_T2MediaPlayer_f_getSoundDecodedData(_thread,idx) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getSoundDecodedData(idx);return;
      
      
      _thread.retVal=_this;return;
    },
    getCurrentTime :function _trc_T2MediaPlayer_getCurrentTime() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getCurrentTime();
    },
    fiber$getCurrentTime :function _trc_T2MediaPlayer_f_getCurrentTime(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getCurrentTime();return;
      
      
      _thread.retVal=_this;return;
    },
    getContext :function _trc_T2MediaPlayer_getContext() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.context;
    },
    fiber$getContext :function _trc_T2MediaPlayer_f_getContext(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.context;return;
      
      
      _thread.retVal=_this;return;
    },
    playSE :function _trc_T2MediaPlayer_playSE(idx,vol,pan,rate,offset,loop,loopStart,loopEnd,start,duration) {
      "use strict";
      var _this=this;
      var o;
      
      //$LASTPOS=74002908;//kernel.T2MediaPlayer:2908
      if (_this.mute) {
        return _this;
      }
      //$LASTPOS=74002931;//kernel.T2MediaPlayer:2931
      if (vol&&typeof  vol==="object") {
        //$LASTPOS=74002986;//kernel.T2MediaPlayer:2986
        o = vol;
        
        //$LASTPOS=74003006;//kernel.T2MediaPlayer:3006
        vol=o.vol;
        //$LASTPOS=74003026;//kernel.T2MediaPlayer:3026
        pan=o.pan;
        //$LASTPOS=74003046;//kernel.T2MediaPlayer:3046
        rate=o.rate;
        //$LASTPOS=74003068;//kernel.T2MediaPlayer:3068
        offset=o.offset;
        //$LASTPOS=74003094;//kernel.T2MediaPlayer:3094
        loop=o.loop;
        //$LASTPOS=74003116;//kernel.T2MediaPlayer:3116
        loopStart=o.loopStart;
        //$LASTPOS=74003148;//kernel.T2MediaPlayer:3148
        loopEnd=o.loopEnd;
        //$LASTPOS=74003176;//kernel.T2MediaPlayer:3176
        start=o.start;
        //$LASTPOS=74003200;//kernel.T2MediaPlayer:3200
        duration=o.duration;
        
      }
      //$LASTPOS=74003368;//kernel.T2MediaPlayer:3368
      if (vol==null) {
        //$LASTPOS=74003385;//kernel.T2MediaPlayer:3385
        vol=128;
      }
      //$LASTPOS=74003401;//kernel.T2MediaPlayer:3401
      if (typeof  vol==="number") {
        //$LASTPOS=74003441;//kernel.T2MediaPlayer:3441
        vol/=128;
        //$LASTPOS=74003462;//kernel.T2MediaPlayer:3462
        if (vol<0) {
          //$LASTPOS=74003477;//kernel.T2MediaPlayer:3477
          vol=0;
        }
        
      } else {
        //$LASTPOS=74003511;//kernel.T2MediaPlayer:3511
        vol=1;
        
      }
      return Tonyu.globals.$t2MediaLib.playSE(idx,vol,pan,rate,offset,loop,loopStart,loopEnd,start,duration);
    },
    stopSE :function _trc_T2MediaPlayer_stopSE(sourceObj) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.stopSE(sourceObj);
    },
    fiber$stopSE :function _trc_T2MediaPlayer_f_stopSE(_thread,sourceObj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.stopSE(sourceObj);return;
      
      
      _thread.retVal=_this;return;
    },
    stopAllSE :function _trc_T2MediaPlayer_stopAllSE() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.stopAllSE();
    },
    fiber$stopAllSE :function _trc_T2MediaPlayer_f_stopAllSE(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.stopAllSE();return;
      
      
      _thread.retVal=_this;return;
    },
    getSEMasterVolume :function _trc_T2MediaPlayer_getSEMasterVolume() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getSEMasterVolume()*128;
    },
    fiber$getSEMasterVolume :function _trc_T2MediaPlayer_f_getSEMasterVolume(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getSEMasterVolume()*128;return;
      
      
      _thread.retVal=_this;return;
    },
    setSEMasterVolume :function _trc_T2MediaPlayer_setSEMasterVolume(vol) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74003884;//kernel.T2MediaPlayer:3884
      if (typeof  vol==="number") {
        //$LASTPOS=74003924;//kernel.T2MediaPlayer:3924
        vol/=128;
        //$LASTPOS=74003945;//kernel.T2MediaPlayer:3945
        if (vol<0) {
          //$LASTPOS=74003960;//kernel.T2MediaPlayer:3960
          vol=0;
        }
        
      } else {
        return Tonyu.globals.$t2MediaLib.setSEMasterVolume(Tonyu.globals.$t2MediaLib.getSEMasterVolume());
        
      }
      return Tonyu.globals.$t2MediaLib.setSEMasterVolume(vol);
    },
    fiber$setSEMasterVolume :function _trc_T2MediaPlayer_f_setSEMasterVolume(_thread,vol) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74003884;//kernel.T2MediaPlayer:3884
      if (typeof  vol==="number") {
        //$LASTPOS=74003924;//kernel.T2MediaPlayer:3924
        vol/=128;
        //$LASTPOS=74003945;//kernel.T2MediaPlayer:3945
        if (vol<0) {
          //$LASTPOS=74003960;//kernel.T2MediaPlayer:3960
          vol=0;
        }
        
      } else {
        _thread.retVal=Tonyu.globals.$t2MediaLib.setSEMasterVolume(Tonyu.globals.$t2MediaLib.getSEMasterVolume());return;
        
        
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.setSEMasterVolume(vol);return;
      
      
      _thread.retVal=_this;return;
    },
    getSEVolume :function _trc_T2MediaPlayer_getSEVolume(sourceObj) {
      "use strict";
      var _this=this;
      var vol;
      
      //$LASTPOS=74004194;//kernel.T2MediaPlayer:4194
      vol = Tonyu.globals.$t2MediaLib.getSEVolume(sourceObj);
      
      return typeof  vol==="number"?vol*128:vol;
    },
    fiber$getSEVolume :function _trc_T2MediaPlayer_f_getSEVolume(_thread,sourceObj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var vol;
      
      //$LASTPOS=74004194;//kernel.T2MediaPlayer:4194
      vol = Tonyu.globals.$t2MediaLib.getSEVolume(sourceObj);
      
      _thread.retVal=typeof  vol==="number"?vol*128:vol;return;
      
      
      _thread.retVal=_this;return;
    },
    setSEVolume :function _trc_T2MediaPlayer_setSEVolume(sourceObj,vol) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74004337;//kernel.T2MediaPlayer:4337
      if (typeof  vol==="number") {
        //$LASTPOS=74004377;//kernel.T2MediaPlayer:4377
        vol/=128;
        //$LASTPOS=74004398;//kernel.T2MediaPlayer:4398
        if (vol<0) {
          //$LASTPOS=74004413;//kernel.T2MediaPlayer:4413
          vol=0;
        }
        
      } else {
        return Tonyu.globals.$t2MediaLib.setSEVolume(sourceObj,Tonyu.globals.$t2MediaLib.getSEVolume(sourceObj));
        
      }
      return Tonyu.globals.$t2MediaLib.setSEVolume(sourceObj,vol);
    },
    fiber$setSEVolume :function _trc_T2MediaPlayer_f_setSEVolume(_thread,sourceObj,vol) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74004337;//kernel.T2MediaPlayer:4337
      if (typeof  vol==="number") {
        //$LASTPOS=74004377;//kernel.T2MediaPlayer:4377
        vol/=128;
        //$LASTPOS=74004398;//kernel.T2MediaPlayer:4398
        if (vol<0) {
          //$LASTPOS=74004413;//kernel.T2MediaPlayer:4413
          vol=0;
        }
        
      } else {
        _thread.retVal=Tonyu.globals.$t2MediaLib.setSEVolume(sourceObj,Tonyu.globals.$t2MediaLib.getSEVolume(sourceObj));return;
        
        
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.setSEVolume(sourceObj,vol);return;
      
      
      _thread.retVal=_this;return;
    },
    getSERate :function _trc_T2MediaPlayer_getSERate(sourceObj) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getSERate(sourceObj);
    },
    fiber$getSERate :function _trc_T2MediaPlayer_f_getSERate(_thread,sourceObj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getSERate(sourceObj);return;
      
      
      _thread.retVal=_this;return;
    },
    setSERate :function _trc_T2MediaPlayer_setSERate(sourceObj,rate) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setSERate(sourceObj,rate);
    },
    fiber$setSERate :function _trc_T2MediaPlayer_f_setSERate(_thread,sourceObj,rate) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setSERate(sourceObj,rate);return;
      
      
      _thread.retVal=_this;return;
    },
    getSEPan :function _trc_T2MediaPlayer_getSEPan(sourceObj) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getSEPan(sourceObj);
    },
    fiber$getSEPan :function _trc_T2MediaPlayer_f_getSEPan(_thread,sourceObj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getSEPan(sourceObj);return;
      
      
      _thread.retVal=_this;return;
    },
    setSEPan :function _trc_T2MediaPlayer_setSEPan(sourceObj,pan) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setSEPan(sourceObj,pan);
    },
    fiber$setSEPan :function _trc_T2MediaPlayer_f_setSEPan(_thread,sourceObj,pan) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setSEPan(sourceObj,pan);return;
      
      
      _thread.retVal=_this;return;
    },
    isSELoop :function _trc_T2MediaPlayer_isSELoop(sourceObj) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.isSELoop(sourceObj);
    },
    fiber$isSELoop :function _trc_T2MediaPlayer_f_isSELoop(_thread,sourceObj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.isSELoop(sourceObj);return;
      
      
      _thread.retVal=_this;return;
    },
    setSELoop :function _trc_T2MediaPlayer_setSELoop(sourceObj,loop) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setSELoop(sourceObj,loop);
    },
    fiber$setSELoop :function _trc_T2MediaPlayer_f_setSELoop(_thread,sourceObj,loop) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setSELoop(sourceObj,loop);return;
      
      
      _thread.retVal=_this;return;
    },
    getSELoopStartTime :function _trc_T2MediaPlayer_getSELoopStartTime(sourceObj) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getSELoopStartTime(sourceObj);
    },
    fiber$getSELoopStartTime :function _trc_T2MediaPlayer_f_getSELoopStartTime(_thread,sourceObj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getSELoopStartTime(sourceObj);return;
      
      
      _thread.retVal=_this;return;
    },
    setSELoopStartTime :function _trc_T2MediaPlayer_setSELoopStartTime(sourceObj,loopStart) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setSELoopStartTime(Tonyu.bindFunc(_this,_this.setSELoopStartTime),loopStart);
    },
    fiber$setSELoopStartTime :function _trc_T2MediaPlayer_f_setSELoopStartTime(_thread,sourceObj,loopStart) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setSELoopStartTime(Tonyu.bindFunc(_this,_this.setSELoopStartTime),loopStart);return;
      
      
      _thread.retVal=_this;return;
    },
    getSELoopEndTime :function _trc_T2MediaPlayer_getSELoopEndTime(sourceObj) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getSELoopEndTime(sourceObj);
    },
    fiber$getSELoopEndTime :function _trc_T2MediaPlayer_f_getSELoopEndTime(_thread,sourceObj) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getSELoopEndTime(sourceObj);return;
      
      
      _thread.retVal=_this;return;
    },
    setSELoopEndTime :function _trc_T2MediaPlayer_setSELoopEndTime(sourceObj,loopEnd) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setSELoopEndTime(Tonyu.bindFunc(_this,_this.setSELoopStartTime),loopEnd);
    },
    fiber$setSELoopEndTime :function _trc_T2MediaPlayer_f_setSELoopEndTime(_thread,sourceObj,loopEnd) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setSELoopEndTime(Tonyu.bindFunc(_this,_this.setSELoopStartTime),loopEnd);return;
      
      
      _thread.retVal=_this;return;
    },
    playBGM :function _trc_T2MediaPlayer_playBGM(idx,loop,offset,loopStart,loopEnd) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74005609;//kernel.T2MediaPlayer:5609
      if (_this.mute) {
        return _this;
      }
      //$LASTPOS=74005632;//kernel.T2MediaPlayer:5632
      if (loop==null) {
        //$LASTPOS=74005650;//kernel.T2MediaPlayer:5650
        loop=false;
      }
      //$LASTPOS=74005669;//kernel.T2MediaPlayer:5669
      if (offset==null) {
        //$LASTPOS=74005689;//kernel.T2MediaPlayer:5689
        offset=0;
      }
      return Tonyu.globals.$t2MediaLib.playBGM(0,idx,loop,offset,loopStart,loopEnd);
    },
    fiber$playBGM :function _trc_T2MediaPlayer_f_playBGM(_thread,idx,loop,offset,loopStart,loopEnd) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74005609;//kernel.T2MediaPlayer:5609
      if (_this.mute) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=74005632;//kernel.T2MediaPlayer:5632
      if (loop==null) {
        //$LASTPOS=74005650;//kernel.T2MediaPlayer:5650
        loop=false;
      }
      //$LASTPOS=74005669;//kernel.T2MediaPlayer:5669
      if (offset==null) {
        //$LASTPOS=74005689;//kernel.T2MediaPlayer:5689
        offset=0;
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.playBGM(0,idx,loop,offset,loopStart,loopEnd);return;
      
      
      _thread.retVal=_this;return;
    },
    stopBGM :function _trc_T2MediaPlayer_stopBGM() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.stopBGM(0);
    },
    fiber$stopBGM :function _trc_T2MediaPlayer_f_stopBGM(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.stopBGM(0);return;
      
      
      _thread.retVal=_this;return;
    },
    pauseBGM :function _trc_T2MediaPlayer_pauseBGM() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.pauseBGM(0);
    },
    fiber$pauseBGM :function _trc_T2MediaPlayer_f_pauseBGM(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.pauseBGM(0);return;
      
      
      _thread.retVal=_this;return;
    },
    resumeBGM :function _trc_T2MediaPlayer_resumeBGM() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74005914;//kernel.T2MediaPlayer:5914
      if (_this.mute) {
        return _this;
      }
      return Tonyu.globals.$t2MediaLib.resumeBGM(0);
    },
    fiber$resumeBGM :function _trc_T2MediaPlayer_f_resumeBGM(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74005914;//kernel.T2MediaPlayer:5914
      if (_this.mute) {
        _thread.retVal=_this;return;
        
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.resumeBGM(0);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMMasterVolume :function _trc_T2MediaPlayer_getBGMMasterVolume() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMMasterVolume()*128;
    },
    fiber$getBGMMasterVolume :function _trc_T2MediaPlayer_f_getBGMMasterVolume(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMMasterVolume()*128;return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMMasterVolume :function _trc_T2MediaPlayer_setBGMMasterVolume(vol) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74006090;//kernel.T2MediaPlayer:6090
      if (typeof  vol==="number") {
        //$LASTPOS=74006130;//kernel.T2MediaPlayer:6130
        vol/=128;
        //$LASTPOS=74006151;//kernel.T2MediaPlayer:6151
        if (vol<0) {
          //$LASTPOS=74006166;//kernel.T2MediaPlayer:6166
          vol=0;
        }
        
      } else {
        return Tonyu.globals.$t2MediaLib.setBGMMasterVolume(Tonyu.globals.$t2MediaLib.getBGMMasterVolume());
        
      }
      return Tonyu.globals.$t2MediaLib.setBGMMasterVolume(vol);
    },
    fiber$setBGMMasterVolume :function _trc_T2MediaPlayer_f_setBGMMasterVolume(_thread,vol) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74006090;//kernel.T2MediaPlayer:6090
      if (typeof  vol==="number") {
        //$LASTPOS=74006130;//kernel.T2MediaPlayer:6130
        vol/=128;
        //$LASTPOS=74006151;//kernel.T2MediaPlayer:6151
        if (vol<0) {
          //$LASTPOS=74006166;//kernel.T2MediaPlayer:6166
          vol=0;
        }
        
      } else {
        _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMMasterVolume(Tonyu.globals.$t2MediaLib.getBGMMasterVolume());return;
        
        
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMMasterVolume(vol);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMVolume :function _trc_T2MediaPlayer_getBGMVolume() {
      "use strict";
      var _this=this;
      var vol;
      
      //$LASTPOS=74006395;//kernel.T2MediaPlayer:6395
      vol = Tonyu.globals.$t2MediaLib.getBGMVolume(0);
      
      return typeof  vol==="number"?vol*128:vol;
    },
    fiber$getBGMVolume :function _trc_T2MediaPlayer_f_getBGMVolume(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var vol;
      
      //$LASTPOS=74006395;//kernel.T2MediaPlayer:6395
      vol = Tonyu.globals.$t2MediaLib.getBGMVolume(0);
      
      _thread.retVal=typeof  vol==="number"?vol*128:vol;return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMVolume :function _trc_T2MediaPlayer_setBGMVolume(vol) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74006617;//kernel.T2MediaPlayer:6617
      if (typeof  vol==="number") {
        //$LASTPOS=74006657;//kernel.T2MediaPlayer:6657
        vol/=128;
        //$LASTPOS=74006678;//kernel.T2MediaPlayer:6678
        if (vol<0) {
          //$LASTPOS=74006693;//kernel.T2MediaPlayer:6693
          vol=0;
        }
        
      } else {
        return Tonyu.globals.$t2MediaLib.setBGMVolume(0,Tonyu.globals.$t2MediaLib.getBGMVolume(0));
        
      }
      return Tonyu.globals.$t2MediaLib.setBGMVolume(0,vol);
    },
    fiber$setBGMVolume :function _trc_T2MediaPlayer_f_setBGMVolume(_thread,vol) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74006617;//kernel.T2MediaPlayer:6617
      if (typeof  vol==="number") {
        //$LASTPOS=74006657;//kernel.T2MediaPlayer:6657
        vol/=128;
        //$LASTPOS=74006678;//kernel.T2MediaPlayer:6678
        if (vol<0) {
          //$LASTPOS=74006693;//kernel.T2MediaPlayer:6693
          vol=0;
        }
        
      } else {
        _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMVolume(0,Tonyu.globals.$t2MediaLib.getBGMVolume(0));return;
        
        
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMVolume(0,vol);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMTempo :function _trc_T2MediaPlayer_getBGMTempo() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMTempo(0);
    },
    fiber$getBGMTempo :function _trc_T2MediaPlayer_f_getBGMTempo(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMTempo(0);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMTempo :function _trc_T2MediaPlayer_setBGMTempo(tempo) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setBGMTempo(0,tempo);
    },
    fiber$setBGMTempo :function _trc_T2MediaPlayer_f_setBGMTempo(_thread,tempo) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMTempo(0,tempo);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMPan :function _trc_T2MediaPlayer_getBGMPan() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMPan(0);
    },
    fiber$getBGMPan :function _trc_T2MediaPlayer_f_getBGMPan(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMPan(0);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMPan :function _trc_T2MediaPlayer_setBGMPan(pan) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setBGMPan(0,pan);
    },
    fiber$setBGMPan :function _trc_T2MediaPlayer_f_setBGMPan(_thread,pan) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMPan(0,pan);return;
      
      
      _thread.retVal=_this;return;
    },
    isBGMLoop :function _trc_T2MediaPlayer_isBGMLoop() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.isBGMLoop(0);
    },
    fiber$isBGMLoop :function _trc_T2MediaPlayer_f_isBGMLoop(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.isBGMLoop(0);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMLoop :function _trc_T2MediaPlayer_setBGMLoop(loop) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setBGMLoop(0,loop);
    },
    fiber$setBGMLoop :function _trc_T2MediaPlayer_f_setBGMLoop(_thread,loop) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMLoop(0,loop);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMLoopStartTime :function _trc_T2MediaPlayer_getBGMLoopStartTime() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMLoopStartTime(0);
    },
    fiber$getBGMLoopStartTime :function _trc_T2MediaPlayer_f_getBGMLoopStartTime(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMLoopStartTime(0);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMLoopStartTime :function _trc_T2MediaPlayer_setBGMLoopStartTime(loopStart) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setBGMLoopStartTime(0,loopStart);
    },
    fiber$setBGMLoopStartTime :function _trc_T2MediaPlayer_f_setBGMLoopStartTime(_thread,loopStart) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMLoopStartTime(0,loopStart);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMLoopEndTime :function _trc_T2MediaPlayer_getBGMLoopEndTime() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMLoopEndTime(0);
    },
    fiber$getBGMLoopEndTime :function _trc_T2MediaPlayer_f_getBGMLoopEndTime(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMLoopEndTime(0);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMLoopEndTime :function _trc_T2MediaPlayer_setBGMLoopEndTime(loopEnd) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setBGMLoopEndTime(0,loopEnd);
    },
    fiber$setBGMLoopEndTime :function _trc_T2MediaPlayer_f_setBGMLoopEndTime(_thread,loopEnd) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMLoopEndTime(0,loopEnd);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMCurrentTime :function _trc_T2MediaPlayer_getBGMCurrentTime() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMCurrentTime(0);
    },
    fiber$getBGMCurrentTime :function _trc_T2MediaPlayer_f_getBGMCurrentTime(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMCurrentTime(0);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMLength :function _trc_T2MediaPlayer_getBGMLength() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMLength(0);
    },
    fiber$getBGMLength :function _trc_T2MediaPlayer_f_getBGMLength(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMLength(0);return;
      
      
      _thread.retVal=_this;return;
    },
    getPlayingBGMName :function _trc_T2MediaPlayer_getPlayingBGMName() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getPlayingBGMName(0);
    },
    fiber$getPlayingBGMName :function _trc_T2MediaPlayer_f_getPlayingBGMName(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getPlayingBGMName(0);return;
      
      
      _thread.retVal=_this;return;
    },
    setOnBGMEndListener :function _trc_T2MediaPlayer_setOnBGMEndListener() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setOnBGMEndListener(0);
    },
    fiber$setOnBGMEndListener :function _trc_T2MediaPlayer_f_setOnBGMEndListener(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setOnBGMEndListener(0);return;
      
      
      _thread.retVal=_this;return;
    },
    getPlayingBGMState :function _trc_T2MediaPlayer_getPlayingBGMState(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getPlayingBGMState(id);
    },
    fiber$getPlayingBGMState :function _trc_T2MediaPlayer_f_getPlayingBGMState(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getPlayingBGMState(id);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMPicoAudio :function _trc_T2MediaPlayer_getBGMPicoAudio(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMPicoAudio(id);
    },
    fiber$getBGMPicoAudio :function _trc_T2MediaPlayer_f_getBGMPicoAudio(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMPicoAudio(id);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMPlayerMax :function _trc_T2MediaPlayer_getBGMPlayerMax() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMPlayerMax();
    },
    fiber$getBGMPlayerMax :function _trc_T2MediaPlayer_f_getBGMPlayerMax(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMPlayerMax();return;
      
      
      _thread.retVal=_this;return;
    },
    allStopBGM :function _trc_T2MediaPlayer_allStopBGM() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74008159;//kernel.T2MediaPlayer:8159
      Tonyu.globals.$t2MediaLib.allStopBGM();
    },
    fiber$allStopBGM :function _trc_T2MediaPlayer_f_allStopBGM(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74008159;//kernel.T2MediaPlayer:8159
      Tonyu.globals.$t2MediaLib.allStopBGM();
      
      _thread.retVal=_this;return;
    },
    allResetBGM :function _trc_T2MediaPlayer_allResetBGM() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74008213;//kernel.T2MediaPlayer:8213
      Tonyu.globals.$t2MediaLib.allResetBGM();
    },
    fiber$allResetBGM :function _trc_T2MediaPlayer_f_allResetBGM(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74008213;//kernel.T2MediaPlayer:8213
      Tonyu.globals.$t2MediaLib.allResetBGM();
      
      _thread.retVal=_this;return;
    },
    playBGMID :function _trc_T2MediaPlayer_playBGMID(id,idx,loop,offset,loopStart,loopEnd) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74008323;//kernel.T2MediaPlayer:8323
      if (_this.mute) {
        return _this;
      }
      //$LASTPOS=74008346;//kernel.T2MediaPlayer:8346
      if (loop==null) {
        //$LASTPOS=74008364;//kernel.T2MediaPlayer:8364
        loop=false;
      }
      //$LASTPOS=74008383;//kernel.T2MediaPlayer:8383
      if (offset==null) {
        //$LASTPOS=74008403;//kernel.T2MediaPlayer:8403
        offset=0;
      }
      return Tonyu.globals.$t2MediaLib.playBGM(id,idx,loop,offset,loopStart,loopEnd);
    },
    fiber$playBGMID :function _trc_T2MediaPlayer_f_playBGMID(_thread,id,idx,loop,offset,loopStart,loopEnd) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74008323;//kernel.T2MediaPlayer:8323
      if (_this.mute) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=74008346;//kernel.T2MediaPlayer:8346
      if (loop==null) {
        //$LASTPOS=74008364;//kernel.T2MediaPlayer:8364
        loop=false;
      }
      //$LASTPOS=74008383;//kernel.T2MediaPlayer:8383
      if (offset==null) {
        //$LASTPOS=74008403;//kernel.T2MediaPlayer:8403
        offset=0;
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.playBGM(id,idx,loop,offset,loopStart,loopEnd);return;
      
      
      _thread.retVal=_this;return;
    },
    stopBGMID :function _trc_T2MediaPlayer_stopBGMID(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.stopBGM(id);
    },
    fiber$stopBGMID :function _trc_T2MediaPlayer_f_stopBGMID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.stopBGM(id);return;
      
      
      _thread.retVal=_this;return;
    },
    pauseBGMID :function _trc_T2MediaPlayer_pauseBGMID(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.pauseBGM(id);
    },
    fiber$pauseBGMID :function _trc_T2MediaPlayer_f_pauseBGMID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.pauseBGM(id);return;
      
      
      _thread.retVal=_this;return;
    },
    resumeBGMID :function _trc_T2MediaPlayer_resumeBGMID(id) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74008643;//kernel.T2MediaPlayer:8643
      if (_this.mute) {
        return _this;
      }
      return Tonyu.globals.$t2MediaLib.resumeBGM(id);
    },
    fiber$resumeBGMID :function _trc_T2MediaPlayer_f_resumeBGMID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74008643;//kernel.T2MediaPlayer:8643
      if (_this.mute) {
        _thread.retVal=_this;return;
        
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.resumeBGM(id);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMVolumeID :function _trc_T2MediaPlayer_getBGMVolumeID(id) {
      "use strict";
      var _this=this;
      var vol;
      
      //$LASTPOS=74008733;//kernel.T2MediaPlayer:8733
      vol = Tonyu.globals.$t2MediaLib.getBGMVolume(id);
      
      return typeof  vol==="number"?vol*128:vol;
    },
    fiber$getBGMVolumeID :function _trc_T2MediaPlayer_f_getBGMVolumeID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var vol;
      
      //$LASTPOS=74008733;//kernel.T2MediaPlayer:8733
      vol = Tonyu.globals.$t2MediaLib.getBGMVolume(id);
      
      _thread.retVal=typeof  vol==="number"?vol*128:vol;return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMVolumeID :function _trc_T2MediaPlayer_setBGMVolumeID(id,vol) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74008962;//kernel.T2MediaPlayer:8962
      if (typeof  vol==="number") {
        //$LASTPOS=74009002;//kernel.T2MediaPlayer:9002
        vol/=128;
        //$LASTPOS=74009023;//kernel.T2MediaPlayer:9023
        if (vol<0) {
          //$LASTPOS=74009038;//kernel.T2MediaPlayer:9038
          vol=0;
        }
        
      } else {
        return Tonyu.globals.$t2MediaLib.setBGMVolume(id,Tonyu.globals.$t2MediaLib.getBGMVolume(id));
        
      }
      return Tonyu.globals.$t2MediaLib.setBGMVolume(id,vol);
    },
    fiber$setBGMVolumeID :function _trc_T2MediaPlayer_f_setBGMVolumeID(_thread,id,vol) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74008962;//kernel.T2MediaPlayer:8962
      if (typeof  vol==="number") {
        //$LASTPOS=74009002;//kernel.T2MediaPlayer:9002
        vol/=128;
        //$LASTPOS=74009023;//kernel.T2MediaPlayer:9023
        if (vol<0) {
          //$LASTPOS=74009038;//kernel.T2MediaPlayer:9038
          vol=0;
        }
        
      } else {
        _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMVolume(id,Tonyu.globals.$t2MediaLib.getBGMVolume(id));return;
        
        
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMVolume(id,vol);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMTempoID :function _trc_T2MediaPlayer_getBGMTempoID(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMTempo(id);
    },
    fiber$getBGMTempoID :function _trc_T2MediaPlayer_f_getBGMTempoID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMTempo(id);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMTempoID :function _trc_T2MediaPlayer_setBGMTempoID(id,tempo) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setBGMTempo(id,tempo);
    },
    fiber$setBGMTempoID :function _trc_T2MediaPlayer_f_setBGMTempoID(_thread,id,tempo) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMTempo(id,tempo);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMPanID :function _trc_T2MediaPlayer_getBGMPanID(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMPan(id);
    },
    fiber$getBGMPanID :function _trc_T2MediaPlayer_f_getBGMPanID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMPan(id);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMPanID :function _trc_T2MediaPlayer_setBGMPanID(id,pan) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setBGMPan(id,pan);
    },
    fiber$setBGMPanID :function _trc_T2MediaPlayer_f_setBGMPanID(_thread,id,pan) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMPan(id,pan);return;
      
      
      _thread.retVal=_this;return;
    },
    isBGMLoopID :function _trc_T2MediaPlayer_isBGMLoopID(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.isBGMLoop(id);
    },
    fiber$isBGMLoopID :function _trc_T2MediaPlayer_f_isBGMLoopID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.isBGMLoop(id);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMLoopID :function _trc_T2MediaPlayer_setBGMLoopID(id,loop) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setBGMLoop(id,loop);
    },
    fiber$setBGMLoopID :function _trc_T2MediaPlayer_f_setBGMLoopID(_thread,id,loop) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMLoop(id,loop);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMLoopStartTimeID :function _trc_T2MediaPlayer_getBGMLoopStartTimeID(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMLoopStartTime(id);
    },
    fiber$getBGMLoopStartTimeID :function _trc_T2MediaPlayer_f_getBGMLoopStartTimeID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMLoopStartTime(id);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMLoopStartTimeID :function _trc_T2MediaPlayer_setBGMLoopStartTimeID(id,loopStart) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setBGMLoopStartTime(id,loopStart);
    },
    fiber$setBGMLoopStartTimeID :function _trc_T2MediaPlayer_f_setBGMLoopStartTimeID(_thread,id,loopStart) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMLoopStartTime(id,loopStart);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMLoopEndTimeID :function _trc_T2MediaPlayer_getBGMLoopEndTimeID(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMLoopEndTime(id);
    },
    fiber$getBGMLoopEndTimeID :function _trc_T2MediaPlayer_f_getBGMLoopEndTimeID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMLoopEndTime(id);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMLoopEndTimeID :function _trc_T2MediaPlayer_setBGMLoopEndTimeID(id,loopEnd) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setBGMLoopEndTime(id,loopEnd);
    },
    fiber$setBGMLoopEndTimeID :function _trc_T2MediaPlayer_f_setBGMLoopEndTimeID(_thread,id,loopEnd) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setBGMLoopEndTime(id,loopEnd);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMCurrentTimeID :function _trc_T2MediaPlayer_getBGMCurrentTimeID(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMCurrentTime(id);
    },
    fiber$getBGMCurrentTimeID :function _trc_T2MediaPlayer_f_getBGMCurrentTimeID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMCurrentTime(id);return;
      
      
      _thread.retVal=_this;return;
    },
    getBGMLengthID :function _trc_T2MediaPlayer_getBGMLengthID(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getBGMLength(id);
    },
    fiber$getBGMLengthID :function _trc_T2MediaPlayer_f_getBGMLengthID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getBGMLength(id);return;
      
      
      _thread.retVal=_this;return;
    },
    getPlayingBGMNameID :function _trc_T2MediaPlayer_getPlayingBGMNameID(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getPlayingBGMName(id);
    },
    fiber$getPlayingBGMNameID :function _trc_T2MediaPlayer_f_getPlayingBGMNameID(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getPlayingBGMName(id);return;
      
      
      _thread.retVal=_this;return;
    },
    setBGMOnSongEndListener :function _trc_T2MediaPlayer_setBGMOnSongEndListener(id) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setOnBGMEndListener(id);
    },
    fiber$setBGMOnSongEndListener :function _trc_T2MediaPlayer_f_setBGMOnSongEndListener(_thread,id) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setOnBGMEndListener(id);return;
      
      
      _thread.retVal=_this;return;
    },
    loadAudio :function _trc_T2MediaPlayer_loadAudio(idx,src) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74010565;//kernel.T2MediaPlayer:10565
      Tonyu.globals.$t2MediaLib.loadAudio(idx,src);
      //$LASTPOS=74010628;//kernel.T2MediaPlayer:10628
      while (Tonyu.globals.$t2MediaLib.getAudioData(idx)==null) {
        //$LASTPOS=74010674;//kernel.T2MediaPlayer:10674
        _this.update();
      }
    },
    fiber$loadAudio :function _trc_T2MediaPlayer_f_loadAudio(_thread,idx,src) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74010565;//kernel.T2MediaPlayer:10565
      Tonyu.globals.$t2MediaLib.loadAudio(idx,src);
      
      _thread.enter(function _trc_T2MediaPlayer_ent_loadAudio(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=74010628;//kernel.T2MediaPlayer:10628
          case 1:
            if (!(Tonyu.globals.$t2MediaLib.getAudioData(idx)==null)) { __pc=3     ; break; }
            //$LASTPOS=74010674;//kernel.T2MediaPlayer:10674
            _this.fiber$update(_thread);
            __pc=2;return;
          case 2:
            
            __pc=1;break;
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    playAudio :function _trc_T2MediaPlayer_playAudio(idx,loop,startTime) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74010730;//kernel.T2MediaPlayer:10730
      if (_this.mute) {
        return _this;
      }
      //$LASTPOS=74010753;//kernel.T2MediaPlayer:10753
      if (loop==null) {
        //$LASTPOS=74010771;//kernel.T2MediaPlayer:10771
        loop=false;
      }
      //$LASTPOS=74010790;//kernel.T2MediaPlayer:10790
      if (startTime==null) {
        //$LASTPOS=74010813;//kernel.T2MediaPlayer:10813
        startTime=0;
      }
      return Tonyu.globals.$t2MediaLib.playAudio(idx,loop,startTime);
    },
    fiber$playAudio :function _trc_T2MediaPlayer_f_playAudio(_thread,idx,loop,startTime) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74010730;//kernel.T2MediaPlayer:10730
      if (_this.mute) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=74010753;//kernel.T2MediaPlayer:10753
      if (loop==null) {
        //$LASTPOS=74010771;//kernel.T2MediaPlayer:10771
        loop=false;
      }
      //$LASTPOS=74010790;//kernel.T2MediaPlayer:10790
      if (startTime==null) {
        //$LASTPOS=74010813;//kernel.T2MediaPlayer:10813
        startTime=0;
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.playAudio(idx,loop,startTime);return;
      
      
      _thread.retVal=_this;return;
    },
    stopAudio :function _trc_T2MediaPlayer_stopAudio() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.stopAudio();
    },
    fiber$stopAudio :function _trc_T2MediaPlayer_f_stopAudio(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.stopAudio();return;
      
      
      _thread.retVal=_this;return;
    },
    pauseAudio :function _trc_T2MediaPlayer_pauseAudio() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.pauseAudio();
    },
    fiber$pauseAudio :function _trc_T2MediaPlayer_f_pauseAudio(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.pauseAudio();return;
      
      
      _thread.retVal=_this;return;
    },
    resumeAudio :function _trc_T2MediaPlayer_resumeAudio() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74011031;//kernel.T2MediaPlayer:11031
      if (_this.mute) {
        return _this;
      }
      return Tonyu.globals.$t2MediaLib.resumeAudio();
    },
    fiber$resumeAudio :function _trc_T2MediaPlayer_f_resumeAudio(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74011031;//kernel.T2MediaPlayer:11031
      if (_this.mute) {
        _thread.retVal=_this;return;
        
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.resumeAudio();return;
      
      
      _thread.retVal=_this;return;
    },
    setAudioVolume :function _trc_T2MediaPlayer_setAudioVolume(vol) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74011122;//kernel.T2MediaPlayer:11122
      vol=vol/128;
      //$LASTPOS=74011144;//kernel.T2MediaPlayer:11144
      if (vol>1) {
        //$LASTPOS=74011164;//kernel.T2MediaPlayer:11164
        vol=1;
      } else {
        //$LASTPOS=74011185;//kernel.T2MediaPlayer:11185
        if (vol<0) {
          //$LASTPOS=74011200;//kernel.T2MediaPlayer:11200
          vol=0;
        }
      }
      return Tonyu.globals.$t2MediaLib.setAudioVolume(vol);
    },
    fiber$setAudioVolume :function _trc_T2MediaPlayer_f_setAudioVolume(_thread,vol) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74011122;//kernel.T2MediaPlayer:11122
      vol=vol/128;
      //$LASTPOS=74011144;//kernel.T2MediaPlayer:11144
      if (vol>1) {
        //$LASTPOS=74011164;//kernel.T2MediaPlayer:11164
        vol=1;
      } else {
        //$LASTPOS=74011185;//kernel.T2MediaPlayer:11185
        if (vol<0) {
          //$LASTPOS=74011200;//kernel.T2MediaPlayer:11200
          vol=0;
        }
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.setAudioVolume(vol);return;
      
      
      _thread.retVal=_this;return;
    },
    setAudioTempo :function _trc_T2MediaPlayer_setAudioTempo(tempo) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=74011291;//kernel.T2MediaPlayer:11291
      if (tempo>4) {
        //$LASTPOS=74011313;//kernel.T2MediaPlayer:11313
        tempo=4;
      } else {
        //$LASTPOS=74011336;//kernel.T2MediaPlayer:11336
        if (tempo<0.5) {
          //$LASTPOS=74011353;//kernel.T2MediaPlayer:11353
          tempo=0.5;
        }
      }
      return Tonyu.globals.$t2MediaLib.setAudioTempo(tempo);
    },
    fiber$setAudioTempo :function _trc_T2MediaPlayer_f_setAudioTempo(_thread,tempo) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=74011291;//kernel.T2MediaPlayer:11291
      if (tempo>4) {
        //$LASTPOS=74011313;//kernel.T2MediaPlayer:11313
        tempo=4;
      } else {
        //$LASTPOS=74011336;//kernel.T2MediaPlayer:11336
        if (tempo<0.5) {
          //$LASTPOS=74011353;//kernel.T2MediaPlayer:11353
          tempo=0.5;
        }
      }
      _thread.retVal=Tonyu.globals.$t2MediaLib.setAudioTempo(tempo);return;
      
      
      _thread.retVal=_this;return;
    },
    setAudioPosition :function _trc_T2MediaPlayer_setAudioPosition(time) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.setAudioPosition(time);
    },
    fiber$setAudioPosition :function _trc_T2MediaPlayer_f_setAudioPosition(_thread,time) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.setAudioPosition(time);return;
      
      
      _thread.retVal=_this;return;
    },
    getAudioCurrentTime :function _trc_T2MediaPlayer_getAudioCurrentTime() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getAudioCurrentTime();
    },
    fiber$getAudioCurrentTime :function _trc_T2MediaPlayer_f_getAudioCurrentTime(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getAudioCurrentTime();return;
      
      
      _thread.retVal=_this;return;
    },
    getAudioLength :function _trc_T2MediaPlayer_getAudioLength() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getAudioLength();
    },
    fiber$getAudioLength :function _trc_T2MediaPlayer_f_getAudioLength(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getAudioLength();return;
      
      
      _thread.retVal=_this;return;
    },
    getAudioData :function _trc_T2MediaPlayer_getAudioData(idx) {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$t2MediaLib.getAudioData(idx);
    },
    fiber$getAudioData :function _trc_T2MediaPlayer_f_getAudioData(_thread,idx) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$t2MediaLib.getAudioData(idx);return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"initT2MediaPlayer":{"nowait":false},"allClearSoundData":{"nowait":false},"clearSoundData":{"nowait":false},"allRemoveDecodedSoundData":{"nowait":false},"removeDecodedSoundData":{"nowait":false},"getMasterVolume":{"nowait":false},"setMasterVolume":{"nowait":false},"loadSound":{"nowait":false},"__getter__available":{"nowait":true},"loadFromProject":{"nowait":false},"decodeSound":{"nowait":false},"getSoundFileData":{"nowait":false},"getSoundDecodedData":{"nowait":false},"getCurrentTime":{"nowait":false},"getContext":{"nowait":false},"playSE":{"nowait":true},"stopSE":{"nowait":false},"stopAllSE":{"nowait":false},"getSEMasterVolume":{"nowait":false},"setSEMasterVolume":{"nowait":false},"getSEVolume":{"nowait":false},"setSEVolume":{"nowait":false},"getSERate":{"nowait":false},"setSERate":{"nowait":false},"getSEPan":{"nowait":false},"setSEPan":{"nowait":false},"isSELoop":{"nowait":false},"setSELoop":{"nowait":false},"getSELoopStartTime":{"nowait":false},"setSELoopStartTime":{"nowait":false},"getSELoopEndTime":{"nowait":false},"setSELoopEndTime":{"nowait":false},"playBGM":{"nowait":false},"stopBGM":{"nowait":false},"pauseBGM":{"nowait":false},"resumeBGM":{"nowait":false},"getBGMMasterVolume":{"nowait":false},"setBGMMasterVolume":{"nowait":false},"getBGMVolume":{"nowait":false},"setBGMVolume":{"nowait":false},"getBGMTempo":{"nowait":false},"setBGMTempo":{"nowait":false},"getBGMPan":{"nowait":false},"setBGMPan":{"nowait":false},"isBGMLoop":{"nowait":false},"setBGMLoop":{"nowait":false},"getBGMLoopStartTime":{"nowait":false},"setBGMLoopStartTime":{"nowait":false},"getBGMLoopEndTime":{"nowait":false},"setBGMLoopEndTime":{"nowait":false},"getBGMCurrentTime":{"nowait":false},"getBGMLength":{"nowait":false},"getPlayingBGMName":{"nowait":false},"setOnBGMEndListener":{"nowait":false},"getPlayingBGMState":{"nowait":false},"getBGMPicoAudio":{"nowait":false},"getBGMPlayerMax":{"nowait":false},"allStopBGM":{"nowait":false},"allResetBGM":{"nowait":false},"playBGMID":{"nowait":false},"stopBGMID":{"nowait":false},"pauseBGMID":{"nowait":false},"resumeBGMID":{"nowait":false},"getBGMVolumeID":{"nowait":false},"setBGMVolumeID":{"nowait":false},"getBGMTempoID":{"nowait":false},"setBGMTempoID":{"nowait":false},"getBGMPanID":{"nowait":false},"setBGMPanID":{"nowait":false},"isBGMLoopID":{"nowait":false},"setBGMLoopID":{"nowait":false},"getBGMLoopStartTimeID":{"nowait":false},"setBGMLoopStartTimeID":{"nowait":false},"getBGMLoopEndTimeID":{"nowait":false},"setBGMLoopEndTimeID":{"nowait":false},"getBGMCurrentTimeID":{"nowait":false},"getBGMLengthID":{"nowait":false},"getPlayingBGMNameID":{"nowait":false},"setBGMOnSongEndListener":{"nowait":false},"loadAudio":{"nowait":false},"playAudio":{"nowait":false},"stopAudio":{"nowait":false},"pauseAudio":{"nowait":false},"resumeAudio":{"nowait":false},"setAudioVolume":{"nowait":false},"setAudioTempo":{"nowait":false},"setAudioPosition":{"nowait":false},"getAudioCurrentTime":{"nowait":false},"getAudioLength":{"nowait":false},"getAudioData":{"nowait":false}},"fields":{"bgmPlayerMax":{},"progressNoLog":{},"mute":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.PlainChar',
  shortName: 'PlainChar',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_PlainChar_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_PlainChar_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_PlainChar_initialize(x,y,p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=75000066;//kernel.PlainChar:66
      _this.layer=_this.layer||Tonyu.globals.$mainLayer;
      //$LASTPOS=75000096;//kernel.PlainChar:96
      if (Tonyu.runMode) {
        //$LASTPOS=75000126;//kernel.PlainChar:126
        _this._th=Tonyu.globals.$Boot.schedule(_this,"tMain",[]);
        //$LASTPOS=75000172;//kernel.PlainChar:172
        _this.addToLayer();
        
      }
      //$LASTPOS=75000198;//kernel.PlainChar:198
      _this._scheduler=_this._scheduler||Tonyu.globals.$Scheduler;
      //$LASTPOS=75000238;//kernel.PlainChar:238
      _this.crashScale=1;
      //$LASTPOS=75000257;//kernel.PlainChar:257
      if (typeof  x=="object") {
        //$LASTPOS=75000281;//kernel.PlainChar:281
        Tonyu.extend(_this,x);
      } else {
        //$LASTPOS=75000313;//kernel.PlainChar:313
        if (typeof  x=="number") {
          //$LASTPOS=75000348;//kernel.PlainChar:348
          _this.x=x;
          //$LASTPOS=75000367;//kernel.PlainChar:367
          _this.y=y;
          //$LASTPOS=75000386;//kernel.PlainChar:386
          _this.p=p;
          
        }
      }
    },
    draw :function _trc_PlainChar_draw(c) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=75000423;//kernel.PlainChar:423
      _this.onDraw();
      //$LASTPOS=75000438;//kernel.PlainChar:438
      if (_this._isInvisible) {
        return _this;
      }
    },
    setVisible :function _trc_PlainChar_setVisible(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=75000512;//kernel.PlainChar:512
      _this._isInvisible=! v;
    },
    fiber$setVisible :function _trc_PlainChar_f_setVisible(_thread,v) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=75000512;//kernel.PlainChar:512
      _this._isInvisible=! v;
      
      _thread.retVal=_this;return;
    },
    onDraw :function _trc_PlainChar_onDraw() {
      "use strict";
      var _this=this;
      
    },
    fiber$onDraw :function _trc_PlainChar_f_onDraw(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    update :function _trc_PlainChar_update() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=75000568;//kernel.PlainChar:568
      _this.onUpdate();
      //$LASTPOS=75000585;//kernel.PlainChar:585
      Tonyu.classes.kernel.Actor.prototype.update.apply( _this, []);
    },
    fiber$update :function _trc_PlainChar_f_update(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=75000568;//kernel.PlainChar:568
      _this.onUpdate();
      
      _thread.enter(function _trc_PlainChar_ent_update(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=75000585;//kernel.PlainChar:585
            Tonyu.classes.kernel.Actor.prototype.fiber$update.apply( _this, [_thread]);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    onUpdate :function _trc_PlainChar_onUpdate() {
      "use strict";
      var _this=this;
      
    },
    tMain :function _trc_PlainChar_tMain() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=75000641;//kernel.PlainChar:641
      _this.main();
      //$LASTPOS=75000654;//kernel.PlainChar:654
      _this.die();
    },
    fiber$tMain :function _trc_PlainChar_f_tMain(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_PlainChar_ent_tMain(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=75000641;//kernel.PlainChar:641
            _this.fiber$main(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=75000654;//kernel.PlainChar:654
            _this.die();
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true},"setVisible":{"nowait":false},"onDraw":{"nowait":false},"update":{"nowait":false},"onUpdate":{"nowait":true},"tMain":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.SecretChar',
  shortName: 'SecretChar',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.PlainChar,
  includes: [],
  methods: {
    main :function _trc_SecretChar_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_SecretChar_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_SecretChar_draw(c) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=76000038;//kernel.SecretChar:38
      _this.onDraw();
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"draw":{"nowait":true}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.SpriteChar',
  shortName: 'SpriteChar',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.PlainChar,
  includes: [],
  methods: {
    main :function _trc_SpriteChar_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_SpriteChar_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_SpriteChar_initialize(x,y,p,f) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=77000043;//kernel.SpriteChar:43
      Tonyu.classes.kernel.PlainChar.apply( _this, [x,y,p]);
      //$LASTPOS=77000062;//kernel.SpriteChar:62
      _this.f=f;
      //$LASTPOS=77000077;//kernel.SpriteChar:77
      if (! _this.x) {
        //$LASTPOS=77000090;//kernel.SpriteChar:90
        _this.x=0;
      }
      //$LASTPOS=77000105;//kernel.SpriteChar:105
      if (! _this.y) {
        //$LASTPOS=77000118;//kernel.SpriteChar:118
        _this.y=0;
      }
      //$LASTPOS=77000133;//kernel.SpriteChar:133
      if (! _this.p) {
        //$LASTPOS=77000146;//kernel.SpriteChar:146
        _this.p=0;
      }
      //$LASTPOS=77000161;//kernel.SpriteChar:161
      if (typeof  _this.scaleX!="number") {
        //$LASTPOS=77000190;//kernel.SpriteChar:190
        _this.scaleX=1;
      }
    },
    draw :function _trc_SpriteChar_draw(c) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=77000220;//kernel.SpriteChar:220
      if (_this._isInvisible) {
        return _this;
      }
      //$LASTPOS=77000251;//kernel.SpriteChar:251
      _this.onDraw();
      //$LASTPOS=77000266;//kernel.SpriteChar:266
      _this.detectShape();
      //$LASTPOS=77000286;//kernel.SpriteChar:286
      _this.drawSprite(_this.x,_this.y,_this.p,_this.f,_this.zOrder);
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}},"fields":{"f":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Map',
  shortName: 'T1Map',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Map,
  includes: [],
  methods: {
    main :function _trc_T1Map_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_T1Map_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    setBGColor :function _trc_T1Map_setBGColor(c) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=78000064;//kernel.T1Map:64
      Tonyu.globals.$Screen.setBGColor(c);
    },
    fiber$setBGColor :function _trc_T1Map_f_setBGColor(_thread,c) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=78000064;//kernel.T1Map:64
      Tonyu.globals.$Screen.setBGColor(c);
      
      _thread.retVal=_this;return;
    },
    load :function _trc_T1Map_load(fileName) {
      "use strict";
      var _this=this;
      var f;
      var o;
      
      //$LASTPOS=78000469;//kernel.T1Map:469
      f = _this.file("../maps/").rel(fileName);
      
      //$LASTPOS=78000512;//kernel.T1Map:512
      o = f.obj();
      
      //$LASTPOS=78000532;//kernel.T1Map:532
      _this.chipWidth=o.chipWidth;
      //$LASTPOS=78000560;//kernel.T1Map:560
      _this.chipHeight=o.chipHeight;
      //$LASTPOS=78000590;//kernel.T1Map:590
      _this.baseData=o.baseData;
      //$LASTPOS=78000616;//kernel.T1Map:616
      _this.mapTable=_this.conv(_this.baseData[0],o.pTable);
      //$LASTPOS=78000658;//kernel.T1Map:658
      _this.mapData=_this.mapTable;
      //$LASTPOS=78000681;//kernel.T1Map:681
      _this.row=_this.mapTable.length;
      //$LASTPOS=78000707;//kernel.T1Map:707
      _this.col=_this.mapTable[0].length;
      //$LASTPOS=78000736;//kernel.T1Map:736
      _this.mapOnTable=_this.conv(_this.baseData[1],o.pTable);
      //$LASTPOS=78000780;//kernel.T1Map:780
      _this.mapOnData=_this.mapOnTable;
      //$LASTPOS=78000813;//kernel.T1Map:813
      _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
      //$LASTPOS=78000885;//kernel.T1Map:885
      _this.initMap();
    },
    fiber$load :function _trc_T1Map_f_load(_thread,fileName) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var f;
      var o;
      
      //$LASTPOS=78000469;//kernel.T1Map:469
      f = _this.file("../maps/").rel(fileName);
      
      //$LASTPOS=78000512;//kernel.T1Map:512
      o = f.obj();
      
      //$LASTPOS=78000532;//kernel.T1Map:532
      _this.chipWidth=o.chipWidth;
      //$LASTPOS=78000560;//kernel.T1Map:560
      _this.chipHeight=o.chipHeight;
      //$LASTPOS=78000590;//kernel.T1Map:590
      _this.baseData=o.baseData;
      
      _thread.enter(function _trc_T1Map_ent_load(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=78000616;//kernel.T1Map:616
            _this.fiber$conv(_thread, _this.baseData[0], o.pTable);
            __pc=1;return;
          case 1:
            _this.mapTable=_thread.retVal;
            
            //$LASTPOS=78000658;//kernel.T1Map:658
            _this.mapData=_this.mapTable;
            //$LASTPOS=78000681;//kernel.T1Map:681
            _this.row=_this.mapTable.length;
            //$LASTPOS=78000707;//kernel.T1Map:707
            _this.col=_this.mapTable[0].length;
            //$LASTPOS=78000736;//kernel.T1Map:736
            _this.fiber$conv(_thread, _this.baseData[1], o.pTable);
            __pc=2;return;
          case 2:
            _this.mapOnTable=_thread.retVal;
            
            //$LASTPOS=78000780;//kernel.T1Map:780
            _this.mapOnData=_this.mapOnTable;
            //$LASTPOS=78000813;//kernel.T1Map:813
            _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
            //$LASTPOS=78000885;//kernel.T1Map:885
            _this.fiber$initMap(_thread);
            __pc=3;return;
          case 3:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    conv :function _trc_T1Map_conv(mat,tbl) {
      "use strict";
      var _this=this;
      var res;
      
      //$LASTPOS=78000926;//kernel.T1Map:926
      res = [];
      
      //$LASTPOS=78000943;//kernel.T1Map:943
      mat.forEach((function anonymous_955(row) {
        var rrow;
        
        //$LASTPOS=78000973;//kernel.T1Map:973
        rrow = [];
        
        //$LASTPOS=78000995;//kernel.T1Map:995
        res.push(rrow);
        //$LASTPOS=78001020;//kernel.T1Map:1020
        row.forEach((function anonymous_1032(dat) {
          var t;
          
          //$LASTPOS=78001067;//kernel.T1Map:1067
          t = tbl[dat[0]];
          
          //$LASTPOS=78001099;//kernel.T1Map:1099
          if (t) {
            //$LASTPOS=78001106;//kernel.T1Map:1106
            rrow.push(Tonyu.globals[t.name]+dat[1]);
          } else {
            //$LASTPOS=78001165;//kernel.T1Map:1165
            rrow.push(dat[1]);
          }
        }));
      }));
      return res;
    },
    fiber$conv :function _trc_T1Map_f_conv(_thread,mat,tbl) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      
      //$LASTPOS=78000926;//kernel.T1Map:926
      res = [];
      
      //$LASTPOS=78000943;//kernel.T1Map:943
      mat.forEach((function anonymous_955(row) {
        var rrow;
        
        //$LASTPOS=78000973;//kernel.T1Map:973
        rrow = [];
        
        //$LASTPOS=78000995;//kernel.T1Map:995
        res.push(rrow);
        //$LASTPOS=78001020;//kernel.T1Map:1020
        row.forEach((function anonymous_1032(dat) {
          var t;
          
          //$LASTPOS=78001067;//kernel.T1Map:1067
          t = tbl[dat[0]];
          
          //$LASTPOS=78001099;//kernel.T1Map:1099
          if (t) {
            //$LASTPOS=78001106;//kernel.T1Map:1106
            rrow.push(Tonyu.globals[t.name]+dat[1]);
          } else {
            //$LASTPOS=78001165;//kernel.T1Map:1165
            rrow.push(dat[1]);
          }
        }));
      }));
      _thread.retVal=res;return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"setBGColor":{"nowait":false},"load":{"nowait":false},"conv":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Page',
  shortName: 'T1Page',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.PlainChar,
  includes: [],
  methods: {
    main :function _trc_T1Page_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_T1Page_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initGlobals :function _trc_T1Page_initGlobals() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=79000044;//kernel.T1Page:44
      Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;
      //$LASTPOS=79000074;//kernel.T1Page:74
      Tonyu.globals.$Boot.setFrameRate(60);
      //$LASTPOS=79000103;//kernel.T1Page:103
      Tonyu.globals.$clBlack=_this.color(0,0,0);
      //$LASTPOS=79000131;//kernel.T1Page:131
      Tonyu.globals.$clRed=_this.color(255,0,0);
      //$LASTPOS=79000159;//kernel.T1Page:159
      Tonyu.globals.$clGreen=_this.color(0,255,0);
      //$LASTPOS=79000189;//kernel.T1Page:189
      Tonyu.globals.$clYellow=_this.color(255,255,0);
      //$LASTPOS=79000222;//kernel.T1Page:222
      Tonyu.globals.$clBlue=_this.color(0,0,255);
      //$LASTPOS=79000251;//kernel.T1Page:251
      Tonyu.globals.$clPink=_this.color(255,0,255);
      //$LASTPOS=79000282;//kernel.T1Page:282
      Tonyu.globals.$clAqua=_this.color(0,255,255);
      //$LASTPOS=79000313;//kernel.T1Page:313
      Tonyu.globals.$clWhite=_this.color(255,255,255);
      //$LASTPOS=79000347;//kernel.T1Page:347
      Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;
    },
    fiber$initGlobals :function _trc_T1Page_f_initGlobals(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=79000044;//kernel.T1Page:44
      Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;
      //$LASTPOS=79000074;//kernel.T1Page:74
      Tonyu.globals.$Boot.setFrameRate(60);
      //$LASTPOS=79000103;//kernel.T1Page:103
      Tonyu.globals.$clBlack=_this.color(0,0,0);
      //$LASTPOS=79000131;//kernel.T1Page:131
      Tonyu.globals.$clRed=_this.color(255,0,0);
      //$LASTPOS=79000159;//kernel.T1Page:159
      Tonyu.globals.$clGreen=_this.color(0,255,0);
      //$LASTPOS=79000189;//kernel.T1Page:189
      Tonyu.globals.$clYellow=_this.color(255,255,0);
      //$LASTPOS=79000222;//kernel.T1Page:222
      Tonyu.globals.$clBlue=_this.color(0,0,255);
      //$LASTPOS=79000251;//kernel.T1Page:251
      Tonyu.globals.$clPink=_this.color(255,0,255);
      //$LASTPOS=79000282;//kernel.T1Page:282
      Tonyu.globals.$clAqua=_this.color(0,255,255);
      //$LASTPOS=79000313;//kernel.T1Page:313
      Tonyu.globals.$clWhite=_this.color(255,255,255);
      //$LASTPOS=79000347;//kernel.T1Page:347
      Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"initGlobals":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.TextChar',
  shortName: 'TextChar',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.PlainChar,
  includes: [],
  methods: {
    main :function _trc_TextChar_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_TextChar_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_TextChar_initialize(xx,yy,t,c,s) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=80000072;//kernel.TextChar:72
      Tonyu.classes.kernel.PlainChar.apply( _this, [xx,yy]);
      //$LASTPOS=80000091;//kernel.TextChar:91
      _this.text=_this.text||"";
      //$LASTPOS=80000111;//kernel.TextChar:111
      _this.col=Tonyu.globals.$clWhite;
      //$LASTPOS=80000130;//kernel.TextChar:130
      _this.size=20;
      //$LASTPOS=80000144;//kernel.TextChar:144
      if (! _this.x) {
        //$LASTPOS=80000157;//kernel.TextChar:157
        _this.x=0;
      }
      //$LASTPOS=80000172;//kernel.TextChar:172
      if (! _this.y) {
        //$LASTPOS=80000185;//kernel.TextChar:185
        _this.y=0;
      }
      //$LASTPOS=80000200;//kernel.TextChar:200
      if (t) {
        //$LASTPOS=80000207;//kernel.TextChar:207
        _this.text=t;
      }
      //$LASTPOS=80000220;//kernel.TextChar:220
      if (c) {
        //$LASTPOS=80000227;//kernel.TextChar:227
        _this.fillStyle=c;
      }
      //$LASTPOS=80000245;//kernel.TextChar:245
      if (s) {
        //$LASTPOS=80000252;//kernel.TextChar:252
        _this.size=s;
      }
    },
    draw :function _trc_TextChar_draw(ctx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=80000282;//kernel.TextChar:282
      if (_this._isInvisible) {
        return _this;
      }
      //$LASTPOS=80000313;//kernel.TextChar:313
      _this.onDraw();
      //$LASTPOS=80000328;//kernel.TextChar:328
      _this.drawText(_this.x,_this.y,_this.text,_this.col,_this.size);
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}},"fields":{"col":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.APad',
  shortName: 'APad',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_APad_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=81000862;//kernel.APad:862
      if (! _this.auto) {
        //$LASTPOS=81000873;//kernel.APad:873
        _this.loop();
      }
    },
    fiber$main :function _trc_APad_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_APad_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=81000862;//kernel.APad:862
            if (!(! _this.auto)) { __pc=2     ; break; }
            //$LASTPOS=81000873;//kernel.APad:873
            _this.fiber$loop(_thread);
            __pc=1;return;
          case 1:
            
          case 2     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    initialize :function _trc_APad_initialize(p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=81000033;//kernel.APad:33
      p=p||{};
      //$LASTPOS=81000047;//kernel.APad:47
      if (! p.alpha) {
        //$LASTPOS=81000061;//kernel.APad:61
        p.alpha=128;
      }
      //$LASTPOS=81000079;//kernel.APad:79
      Tonyu.classes.kernel.Actor.apply( _this, [p]);
      //$LASTPOS=81000094;//kernel.APad:94
      _this.vx=0;
      //$LASTPOS=81000099;//kernel.APad:99
      _this.vy=0;
      //$LASTPOS=81000110;//kernel.APad:110
      _this.outerRadius=_this.outerRadius||50;
      //$LASTPOS=81000144;//kernel.APad:144
      _this.fillStyle=_this.fillStyle||"white";
      //$LASTPOS=81000179;//kernel.APad:179
      _this.strokeStyle=_this.strokeStyle||"white";
      //$LASTPOS=81000218;//kernel.APad:218
      _this.innerRadius=_this.innerRadius||10;
      //$LASTPOS=81000252;//kernel.APad:252
      if (typeof  _this.keys==="object") {
        //$LASTPOS=81000291;//kernel.APad:291
        _this.leftKey=_this.keys.left;
        //$LASTPOS=81000319;//kernel.APad:319
        _this.rightKey=_this.keys.right;
        //$LASTPOS=81000349;//kernel.APad:349
        _this.upKey=_this.keys.up;
        //$LASTPOS=81000373;//kernel.APad:373
        _this.downKey=_this.keys.down;
        
      }
      //$LASTPOS=81000404;//kernel.APad:404
      _this.keySpeed=_this.keySpeed||15/50;
      //$LASTPOS=81000435;//kernel.APad:435
      _this.leftKey=_this.leftKey||"left";
      //$LASTPOS=81000465;//kernel.APad:465
      _this.rightKey=_this.rightKey||"right";
      //$LASTPOS=81000498;//kernel.APad:498
      _this.upKey=_this.upKey||"up";
      //$LASTPOS=81000522;//kernel.APad:522
      _this.downKey=_this.downKey||"down";
      //$LASTPOS=81000552;//kernel.APad:552
      _this.decay=_this.decay||0.8;
      //$LASTPOS=81000575;//kernel.APad:575
      _this.velocity=new Tonyu.classes.kernel.Vec3View(_this,{x: "vx",y: "vy",z: "vz"});
      //$LASTPOS=81000632;//kernel.APad:632
      if ((typeof  _this.x!=="number")||_this.x!==_this.x) {
        //$LASTPOS=81000679;//kernel.APad:679
        _this.x=Tonyu.globals.$screenWidth/2;
        
      }
      //$LASTPOS=81000709;//kernel.APad:709
      if ((typeof  _this.y!=="number")||_this.y!==_this.y) {
        //$LASTPOS=81000756;//kernel.APad:756
        _this.y=Tonyu.globals.$screenHeight-_this.outerRadius-_this.innerRadius;
        
      }
      //$LASTPOS=81000847;//kernel.APad:847
      _this.ix=_this.x;
      //$LASTPOS=81000852;//kernel.APad:852
      _this.iy=_this.y;
    },
    __getter__defaultLayer :function _trc_APad___getter__defaultLayer() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$frontLayer;
    },
    draw :function _trc_APad_draw(ctx) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=81000968;//kernel.APad:968
      if (_this.auto) {
        //$LASTPOS=81000989;//kernel.APad:989
        _this.ix=_this.x+_this.vx*_this.outerRadius;
        //$LASTPOS=81001019;//kernel.APad:1019
        _this.iy=_this.y+_this.vy*_this.outerRadius;
        
      }
      //$LASTPOS=81001052;//kernel.APad:1052
      ctx.globalAlpha=_this.alpha/255;
      //$LASTPOS=81001084;//kernel.APad:1084
      ctx.fillStyle=_this.fillStyle+"";
      //$LASTPOS=81001117;//kernel.APad:1117
      ctx.beginPath();
      //$LASTPOS=81001139;//kernel.APad:1139
      ctx.arc(_this.ix,_this.iy,_this.innerRadius,0,Tonyu.globals.$Math.PI*2);
      //$LASTPOS=81001185;//kernel.APad:1185
      ctx.closePath();
      //$LASTPOS=81001207;//kernel.APad:1207
      ctx.fill();
      //$LASTPOS=81001224;//kernel.APad:1224
      ctx.strokeStyle=_this.strokeStyle;
      //$LASTPOS=81001258;//kernel.APad:1258
      ctx.beginPath();
      //$LASTPOS=81001280;//kernel.APad:1280
      ctx.arc(_this.x,_this.y,_this.outerRadius,0,Tonyu.globals.$Math.PI*2);
      //$LASTPOS=81001324;//kernel.APad:1324
      ctx.closePath();
      //$LASTPOS=81001346;//kernel.APad:1346
      ctx.stroke();
    },
    findTouch :function _trc_APad_findTouch() {
      "use strict";
      var _this=this;
      var t;
      var _it_743;
      
      //$LASTPOS=81001384;//kernel.APad:1384
      _it_743=Tonyu.iterator(Tonyu.globals.$touches,1);
      while(_it_743.next()) {
        t=_it_743[0];
        
        //$LASTPOS=81001419;//kernel.APad:1419
        if ((! _this.touchRadius||_this.dist(t)<_this.touchRadius)&&t.touched==1) {
          return t;
          
        }
        
      }
    },
    loop :function _trc_APad_loop() {
      "use strict";
      var _this=this;
      var vx;
      var vy;
      
      //$LASTPOS=81001544;//kernel.APad:1544
      vx = 0;
      vy = 0;
      
      //$LASTPOS=81001564;//kernel.APad:1564
      while (true) {
        //$LASTPOS=81001587;//kernel.APad:1587
        if (! _this.t||_this.t.ended) {
          //$LASTPOS=81001606;//kernel.APad:1606
          _this.t=_this.findTouch();
        }
        //$LASTPOS=81001630;//kernel.APad:1630
        if (_this.t) {
          //$LASTPOS=81001652;//kernel.APad:1652
          vx+=_this.t.vx;
          //$LASTPOS=81001675;//kernel.APad:1675
          vy+=_this.t.vy;
          
        } else {
          //$LASTPOS=81001716;//kernel.APad:1716
          vx*=_this.decay;
          //$LASTPOS=81001740;//kernel.APad:1740
          vy*=_this.decay;
          
        }
        //$LASTPOS=81001835;//kernel.APad:1835
        if (_this.getkey(_this.leftKey)) {
          //$LASTPOS=81001856;//kernel.APad:1856
          vx-=_this.keySpeed*_this.outerRadius;
        }
        //$LASTPOS=81001891;//kernel.APad:1891
        if (_this.getkey(_this.rightKey)) {
          //$LASTPOS=81001913;//kernel.APad:1913
          vx+=_this.keySpeed*_this.outerRadius;
        }
        //$LASTPOS=81001948;//kernel.APad:1948
        if (_this.getkey(_this.upKey)) {
          //$LASTPOS=81001967;//kernel.APad:1967
          vy-=_this.keySpeed*_this.outerRadius;
        }
        //$LASTPOS=81002002;//kernel.APad:2002
        if (_this.getkey(_this.downKey)) {
          //$LASTPOS=81002023;//kernel.APad:2023
          vy+=_this.keySpeed*_this.outerRadius;
        }
        //$LASTPOS=81002058;//kernel.APad:2058
        _this.d=_this.dist(vx,vy);
        //$LASTPOS=81002082;//kernel.APad:2082
        if (_this.d>_this.outerRadius) {
          //$LASTPOS=81002116;//kernel.APad:2116
          vx=vx/_this.d*_this.outerRadius;
          //$LASTPOS=81002150;//kernel.APad:2150
          vy=vy/_this.d*_this.outerRadius;
          
        }
        //$LASTPOS=81002191;//kernel.APad:2191
        _this.ix=_this.x+vx;
        //$LASTPOS=81002209;//kernel.APad:2209
        _this.iy=_this.y+vy;
        //$LASTPOS=81002227;//kernel.APad:2227
        _this.vx=_this.clamp(vx/_this.outerRadius,- 1,1);
        //$LASTPOS=81002272;//kernel.APad:2272
        _this.vy=_this.clamp(vy/_this.outerRadius,- 1,1);
        //$LASTPOS=81002317;//kernel.APad:2317
        _this.update();
        
      }
    },
    fiber$loop :function _trc_APad_f_loop(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var vx;
      var vy;
      
      //$LASTPOS=81001544;//kernel.APad:1544
      vx = 0;
      vy = 0;
      
      
      _thread.enter(function _trc_APad_ent_loop(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=81001564;//kernel.APad:1564
          case 1:
            //$LASTPOS=81001587;//kernel.APad:1587
            if (! _this.t||_this.t.ended) {
              //$LASTPOS=81001606;//kernel.APad:1606
              _this.t=_this.findTouch();
            }
            //$LASTPOS=81001630;//kernel.APad:1630
            if (_this.t) {
              //$LASTPOS=81001652;//kernel.APad:1652
              vx+=_this.t.vx;
              //$LASTPOS=81001675;//kernel.APad:1675
              vy+=_this.t.vy;
              
            } else {
              //$LASTPOS=81001716;//kernel.APad:1716
              vx*=_this.decay;
              //$LASTPOS=81001740;//kernel.APad:1740
              vy*=_this.decay;
              
            }
            //$LASTPOS=81001835;//kernel.APad:1835
            if (_this.getkey(_this.leftKey)) {
              //$LASTPOS=81001856;//kernel.APad:1856
              vx-=_this.keySpeed*_this.outerRadius;
            }
            //$LASTPOS=81001891;//kernel.APad:1891
            if (_this.getkey(_this.rightKey)) {
              //$LASTPOS=81001913;//kernel.APad:1913
              vx+=_this.keySpeed*_this.outerRadius;
            }
            //$LASTPOS=81001948;//kernel.APad:1948
            if (_this.getkey(_this.upKey)) {
              //$LASTPOS=81001967;//kernel.APad:1967
              vy-=_this.keySpeed*_this.outerRadius;
            }
            //$LASTPOS=81002002;//kernel.APad:2002
            if (_this.getkey(_this.downKey)) {
              //$LASTPOS=81002023;//kernel.APad:2023
              vy+=_this.keySpeed*_this.outerRadius;
            }
            //$LASTPOS=81002058;//kernel.APad:2058
            _this.d=_this.dist(vx,vy);
            //$LASTPOS=81002082;//kernel.APad:2082
            if (_this.d>_this.outerRadius) {
              //$LASTPOS=81002116;//kernel.APad:2116
              vx=vx/_this.d*_this.outerRadius;
              //$LASTPOS=81002150;//kernel.APad:2150
              vy=vy/_this.d*_this.outerRadius;
              
            }
            //$LASTPOS=81002191;//kernel.APad:2191
            _this.ix=_this.x+vx;
            //$LASTPOS=81002209;//kernel.APad:2209
            _this.iy=_this.y+vy;
            //$LASTPOS=81002227;//kernel.APad:2227
            _this.vx=_this.clamp(vx/_this.outerRadius,- 1,1);
            //$LASTPOS=81002272;//kernel.APad:2272
            _this.vy=_this.clamp(vy/_this.outerRadius,- 1,1);
            //$LASTPOS=81002317;//kernel.APad:2317
            _this.fiber$update(_thread);
            __pc=2;return;
          case 2:
            
            __pc=1;break;
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __getter__speed :function _trc_APad___getter__speed() {
      "use strict";
      var _this=this;
      
      return _this.sqrt(_this.vx*_this.vx+_this.vy*_this.vy);
    },
    __getter__direction :function _trc_APad___getter__direction() {
      "use strict";
      var _this=this;
      
      return _this.atanxy(_this.vx,_this.vy);
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"__getter__defaultLayer":{"nowait":true},"draw":{"nowait":true},"findTouch":{"nowait":true},"loop":{"nowait":false},"__getter__speed":{"nowait":true},"__getter__direction":{"nowait":true}},"fields":{"auto":{},"vx":{},"vy":{},"outerRadius":{},"strokeStyle":{},"innerRadius":{},"keys":{},"leftKey":{},"rightKey":{},"upKey":{},"downKey":{},"keySpeed":{},"decay":{},"velocity":{},"ix":{},"iy":{},"touchRadius":{},"t":{},"d":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Button',
  shortName: 'Button',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_Button_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=82000575;//kernel.Button:575
      while (true) {
        //$LASTPOS=82000594;//kernel.Button:594
        if (! _this.disabled) {
          //$LASTPOS=82000620;//kernel.Button:620
          _this.clicked=_this.checkTouch();
          //$LASTPOS=82000651;//kernel.Button:651
          if (_this.clicked==1) {
            //$LASTPOS=82000682;//kernel.Button:682
            Tonyu.classes.kernel.Button.last=_this;
            //$LASTPOS=82000713;//kernel.Button:713
            if (_this.onClick) {
              //$LASTPOS=82000726;//kernel.Button:726
              _this.onClick(_this);
            }
            
          }
          
        } else {
          //$LASTPOS=82000775;//kernel.Button:775
          _this.clicked=0;
          
        }
        //$LASTPOS=82000798;//kernel.Button:798
        _this.update();
        
      }
    },
    fiber$main :function _trc_Button_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Button_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=82000575;//kernel.Button:575
          case 1:
            //$LASTPOS=82000594;//kernel.Button:594
            if (!(! _this.disabled)) { __pc=3     ; break; }
            //$LASTPOS=82000620;//kernel.Button:620
            _this.fiber$checkTouch(_thread);
            __pc=2;return;
          case 2:
            _this.clicked=_thread.retVal;
            
            //$LASTPOS=82000651;//kernel.Button:651
            if (_this.clicked==1) {
              //$LASTPOS=82000682;//kernel.Button:682
              Tonyu.classes.kernel.Button.last=_this;
              //$LASTPOS=82000713;//kernel.Button:713
              if (_this.onClick) {
                //$LASTPOS=82000726;//kernel.Button:726
                _this.onClick(_this);
              }
              
            }
            __pc=4     ;break;
          case 3     :
            {
              //$LASTPOS=82000775;//kernel.Button:775
              _this.clicked=0;
            }
          case 4     :
            
            //$LASTPOS=82000798;//kernel.Button:798
            _this.fiber$update(_thread);
            __pc=5;return;
          case 5:
            
            __pc=1;break;
          case 6     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    initialize :function _trc_Button_initialize(options) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=82000121;//kernel.Button:121
      options.layer=options.layer||Tonyu.globals.$frontLayer;
      //$LASTPOS=82000168;//kernel.Button:168
      Tonyu.classes.kernel.Actor.apply( _this, [options]);
      //$LASTPOS=82000189;//kernel.Button:189
      _this.fillStyle=_this.fillStyle||"rgb(179,255,142)";
      //$LASTPOS=82000235;//kernel.Button:235
      _this.strokeStyle=_this.strokeStyle||"black";
      //$LASTPOS=82000274;//kernel.Button:274
      _this.clickedStyle=_this.clickedStyle||"white";
      //$LASTPOS=82000315;//kernel.Button:315
      _this.disabledStrokeStyle=_this.disabledStrokeStyle||"#ddd";
      //$LASTPOS=82000369;//kernel.Button:369
      _this.alpha=typeof  (_this.alpha)=="number"?_this.alpha:255;
      //$LASTPOS=82000415;//kernel.Button:415
      _this.padding=typeof  (_this.padding)=="number"?_this.padding:5;
      //$LASTPOS=82000466;//kernel.Button:466
      _this.width=_this.width||Tonyu.globals.$screenWidth-100;
      //$LASTPOS=82000506;//kernel.Button:506
      _this.height=_this.height||50;
      //$LASTPOS=82000534;//kernel.Button:534
      _this.left=typeof  (_this.left)=="number"?_this.left:50;
    },
    checkTouch :function _trc_Button_checkTouch() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=82000833;//kernel.Button:833
      //$LASTPOS=82000838;//kernel.Button:838
      _this.i=0;for (; _this.i<2 ; _this.i++) {
        {
          //$LASTPOS=82000865;//kernel.Button:865
          if (Tonyu.globals.$touches[_this.i].touched>0&&_this.inRect(Tonyu.globals.$touches[_this.i])) {
            return Tonyu.globals.$touches[_this.i].touched;
            
          }
        }
      }
      //$LASTPOS=82000981;//kernel.Button:981
      if (_this.key) {
        return _this.getkey(_this.key);
      }
      return 0;
    },
    fiber$checkTouch :function _trc_Button_f_checkTouch(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=82000833;//kernel.Button:833
      //$LASTPOS=82000838;//kernel.Button:838
      _this.i=0;for (; _this.i<2 ; _this.i++) {
        {
          //$LASTPOS=82000865;//kernel.Button:865
          if (Tonyu.globals.$touches[_this.i].touched>0&&_this.inRect(Tonyu.globals.$touches[_this.i])) {
            _thread.retVal=Tonyu.globals.$touches[_this.i].touched;return;
            
            
          }
        }
      }
      //$LASTPOS=82000981;//kernel.Button:981
      if (_this.key) {
        _thread.retVal=_this.getkey(_this.key);return;
        
      }
      _thread.retVal=0;return;
      
      
      _thread.retVal=_this;return;
    },
    inRect :function _trc_Button_inRect(p) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=82001047;//kernel.Button:1047
      p=Tonyu.globals.$Screen.convert(p,_this.layer);
      return p.x>=_this.left&&p.x<=_this.left+_this.width&&p.y>=_this.top&&p.y<=_this.top+_this.height;
    },
    fiber$inRect :function _trc_Button_f_inRect(_thread,p) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=82001047;//kernel.Button:1047
      p=Tonyu.globals.$Screen.convert(p,_this.layer);
      _thread.retVal=p.x>=_this.left&&p.x<=_this.left+_this.width&&p.y>=_this.top&&p.y<=_this.top+_this.height;return;
      
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_Button_draw(c) {
      "use strict";
      var _this=this;
      var size;
      var f;
      var r;
      
      //$LASTPOS=82001168;//kernel.Button:1168
      c.globalAlpha=_this.alpha/255;
      //$LASTPOS=82001198;//kernel.Button:1198
      c.fillStyle=_this.fillStyle?_this.fillStyle+"":"gray";
      //$LASTPOS=82001250;//kernel.Button:1250
      c.strokeStyle=_this.strokeStyle?_this.strokeStyle+"":"black";
      //$LASTPOS=82001309;//kernel.Button:1309
      if (_this.disabled) {
        //$LASTPOS=82001323;//kernel.Button:1323
        c.strokeStyle=_this.disabledStrokeStyle+"";
      }
      //$LASTPOS=82001366;//kernel.Button:1366
      c.fillRect(_this.left,_this.top,_this.width,_this.height);
      //$LASTPOS=82001409;//kernel.Button:1409
      c.strokeRect(_this.left,_this.top,_this.width,_this.height);
      //$LASTPOS=82001454;//kernel.Button:1454
      size = _this.height-_this.padding*2;
      
      //$LASTPOS=82001486;//kernel.Button:1486
      f = c.font.replace(/^[0-9]+px /,"");
      
      //$LASTPOS=82001530;//kernel.Button:1530
      c.font=size+"px "+f;
      //$LASTPOS=82001569;//kernel.Button:1569
      c.textBaseline="top";
      //$LASTPOS=82001596;//kernel.Button:1596
      c.fillStyle=_this.clicked?_this.clickedStyle+"":_this.disabled?_this.disabledStrokeStyle+"":_this.strokeStyle+"";
      //$LASTPOS=82001691;//kernel.Button:1691
      r = c.measureText(_this.text);
      
      //$LASTPOS=82001723;//kernel.Button:1723
      c.fillText(_this.text,_this.left+_this.width/2-r.width/2,_this.top+_this.padding);
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"checkTouch":{"nowait":false},"inRect":{"nowait":false},"draw":{"nowait":true}},"fields":{"disabled":{},"clicked":{},"onClick":{},"strokeStyle":{},"clickedStyle":{},"disabledStrokeStyle":{},"padding":{},"left":{},"i":{},"key":{},"top":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.GameConsole',
  shortName: 'GameConsole',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_GameConsole_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_GameConsole_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_GameConsole_initialize(opt) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=83000084;//kernel.GameConsole:84
      _this.extend(opt);
      //$LASTPOS=83000102;//kernel.GameConsole:102
      _this.cw=_this.canvas.width();
      //$LASTPOS=83000126;//kernel.GameConsole:126
      _this.ch=_this.canvas.height();
      //$LASTPOS=83000151;//kernel.GameConsole:151
      Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites;
      //$LASTPOS=83000178;//kernel.GameConsole:178
      Tonyu.globals.$Screen=_this.gameScreen=new Tonyu.classes.kernel.GameScreen({width: 465,height: 465,sprites: Tonyu.globals.$Sprites});
      //$LASTPOS=83000259;//kernel.GameConsole:259
      Tonyu.globals.$FrontSprites=_this.sprites=new Tonyu.classes.kernel.Sprites;
      //$LASTPOS=83000299;//kernel.GameConsole:299
      _this.sprites.add(_this.gameScreen);
      //$LASTPOS=83000329;//kernel.GameConsole:329
      _this.cctx=_this.canvas[0].getContext("2d");
    },
    shouldDraw1x1 :function _trc_GameConsole_shouldDraw1x1(srcw,srch,dstw,dsth) {
      "use strict";
      var _this=this;
      var larger;
      var smaller;
      
      //$LASTPOS=83000448;//kernel.GameConsole:448
      larger = 200;
      
      //$LASTPOS=83000469;//kernel.GameConsole:469
      smaller = 5;
      
      return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;
    },
    fiber$shouldDraw1x1 :function _trc_GameConsole_f_shouldDraw1x1(_thread,srcw,srch,dstw,dsth) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var larger;
      var smaller;
      
      //$LASTPOS=83000448;//kernel.GameConsole:448
      larger = 200;
      
      //$LASTPOS=83000469;//kernel.GameConsole:469
      smaller = 5;
      
      _thread.retVal=srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;return;
      
      
      _thread.retVal=_this;return;
    },
    layout :function _trc_GameConsole_layout() {
      "use strict";
      var _this=this;
      var width;
      var height;
      var calcw;
      var calch;
      var marginw;
      var marginh;
      
      //$LASTPOS=83000606;//kernel.GameConsole:606
      _this.cw=_this.canvas.width();
      //$LASTPOS=83000630;//kernel.GameConsole:630
      _this.ch=_this.canvas.height();
      //$LASTPOS=83000655;//kernel.GameConsole:655
      width = _this.gameScreen.width;
      
      //$LASTPOS=83000688;//kernel.GameConsole:688
      height = _this.gameScreen.height;
      
      //$LASTPOS=83000723;//kernel.GameConsole:723
      calcw = _this.ch/height*width;
      
      //$LASTPOS=83000767;//kernel.GameConsole:767
      calch = _this.cw/width*height;
      
      //$LASTPOS=83000811;//kernel.GameConsole:811
      if (calch>_this.ch) {
        //$LASTPOS=83000825;//kernel.GameConsole:825
        calch=_this.ch;
      }
      //$LASTPOS=83000840;//kernel.GameConsole:840
      if (calcw>_this.cw) {
        //$LASTPOS=83000854;//kernel.GameConsole:854
        calcw=_this.cw;
      }
      //$LASTPOS=83000869;//kernel.GameConsole:869
      if (_this.shouldDraw1x1(width,height,calcw,calch)) {
        //$LASTPOS=83000925;//kernel.GameConsole:925
        calcw=width;
        //$LASTPOS=83000937;//kernel.GameConsole:937
        calch=height;
        
      }
      //$LASTPOS=83000963;//kernel.GameConsole:963
      marginw = Math.floor((_this.cw-calcw)/2);
      
      //$LASTPOS=83001006;//kernel.GameConsole:1006
      marginh = Math.floor((_this.ch-calch)/2);
      
      //$LASTPOS=83001049;//kernel.GameConsole:1049
      _this.gameScreen.setBounds({left: marginw,top: marginh,width: calcw,height: calch});
    },
    fiber$layout :function _trc_GameConsole_f_layout(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var width;
      var height;
      var calcw;
      var calch;
      var marginw;
      var marginh;
      
      //$LASTPOS=83000606;//kernel.GameConsole:606
      _this.cw=_this.canvas.width();
      //$LASTPOS=83000630;//kernel.GameConsole:630
      _this.ch=_this.canvas.height();
      //$LASTPOS=83000655;//kernel.GameConsole:655
      width = _this.gameScreen.width;
      
      //$LASTPOS=83000688;//kernel.GameConsole:688
      height = _this.gameScreen.height;
      
      //$LASTPOS=83000723;//kernel.GameConsole:723
      calcw = _this.ch/height*width;
      
      //$LASTPOS=83000767;//kernel.GameConsole:767
      calch = _this.cw/width*height;
      
      //$LASTPOS=83000811;//kernel.GameConsole:811
      if (calch>_this.ch) {
        //$LASTPOS=83000825;//kernel.GameConsole:825
        calch=_this.ch;
      }
      //$LASTPOS=83000840;//kernel.GameConsole:840
      if (calcw>_this.cw) {
        //$LASTPOS=83000854;//kernel.GameConsole:854
        calcw=_this.cw;
      }
      //$LASTPOS=83000869;//kernel.GameConsole:869
      if (_this.shouldDraw1x1(width,height,calcw,calch)) {
        //$LASTPOS=83000925;//kernel.GameConsole:925
        calcw=width;
        //$LASTPOS=83000937;//kernel.GameConsole:937
        calch=height;
        
      }
      //$LASTPOS=83000963;//kernel.GameConsole:963
      marginw = Math.floor((_this.cw-calcw)/2);
      
      //$LASTPOS=83001006;//kernel.GameConsole:1006
      marginh = Math.floor((_this.ch-calch)/2);
      
      //$LASTPOS=83001049;//kernel.GameConsole:1049
      _this.gameScreen.setBounds({left: marginw,top: marginh,width: calcw,height: calch});
      
      _thread.retVal=_this;return;
    },
    draw :function _trc_GameConsole_draw() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=83001144;//kernel.GameConsole:1144
      _this.layout();
      //$LASTPOS=83001159;//kernel.GameConsole:1159
      _this.sprites.draw(_this.canvas[0]);
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"shouldDraw1x1":{"nowait":false},"layout":{"nowait":false},"draw":{"nowait":true}},"fields":{"cw":{},"canvas":{},"ch":{},"gameScreen":{},"sprites":{},"cctx":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Label',
  shortName: 'Label',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_Label_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_Label_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_Label_initialize(x,y,f) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=84000049;//kernel.Label:49
      if (typeof  x=="object") {
        //$LASTPOS=84000084;//kernel.Label:84
        x.layer=x.layer||Tonyu.globals.$frontLayer;
        
      }
      //$LASTPOS=84000126;//kernel.Label:126
      Tonyu.classes.kernel.Actor.apply( _this, [x,y,- 1]);
      //$LASTPOS=84000146;//kernel.Label:146
      if (x==null) {
        //$LASTPOS=84000159;//kernel.Label:159
        x=50;
      }
      //$LASTPOS=84000170;//kernel.Label:170
      if (y==null) {
        //$LASTPOS=84000183;//kernel.Label:183
        y=50;
      }
      //$LASTPOS=84000194;//kernel.Label:194
      if (typeof  _this.template!=="string"&&_this._text==null) {
        //$LASTPOS=84000252;//kernel.Label:252
        _this.text="text";
        
      }
    },
    __getter__text :function _trc_Label___getter__text() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=84000289;//kernel.Label:289
      if (typeof  _this.template!=="string") {
        return _this._text;
      }
      return _this.template.replace(/[\$\@][A-Za-z0-9\.]* ?/g,(function anonymous_391(v) {
        
        //$LASTPOS=84000407;//kernel.Label:407
        v=v.replace(/ $/,"");
        //$LASTPOS=84000438;//kernel.Label:438
        if (v=="") {
          return "$";
        }
        //$LASTPOS=84000470;//kernel.Label:470
        if (v.match(/^@/)) {
          return _this.exapndVal(_this.target,v.substring(1).split("."));
          
        } else {
          return _this.expandVal(Tonyu.globals,v.split("."));
          
        }
      }));
    },
    expandVal :function _trc_Label_expandVal(obj,flds) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=84000685;//kernel.Label:685
      while (flds.length>0) {
        //$LASTPOS=84000718;//kernel.Label:718
        if (! obj) {
          return "";
        }
        //$LASTPOS=84000748;//kernel.Label:748
        obj=obj[flds.shift()];
        
      }
      return obj;
    },
    fiber$expandVal :function _trc_Label_f_expandVal(_thread,obj,flds) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Label_ent_expandVal(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=84000685;//kernel.Label:685
          case 1:
            if (!(flds.length>0)) { __pc=3     ; break; }
            //$LASTPOS=84000718;//kernel.Label:718
            if (!(! obj)) { __pc=2     ; break; }
            _thread.exit("");return;
          case 2     :
            
            //$LASTPOS=84000748;//kernel.Label:748
            obj=obj[flds.shift()];
            __pc=1;break;
          case 3     :
            
            _thread.exit(obj);return;
            _thread.exit(_this);return;
          }
        }
      });
    },
    __setter__text :function _trc_Label___setter__text(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=84000814;//kernel.Label:814
      delete _this.template;
      //$LASTPOS=84000836;//kernel.Label:836
      _this._text=v;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"__getter__text":{"nowait":true},"expandVal":{"nowait":false},"__setter__text":{"nowait":true}},"fields":{"template":{},"_text":{},"exapndVal":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MapEditor',
  shortName: 'MapEditor',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_MapEditor_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=85000049;//kernel.MapEditor:49
      Tonyu.globals.$Screen.resize(480,640);
      //$LASTPOS=85000075;//kernel.MapEditor:75
      _this.loadMode=false;
      //$LASTPOS=85000092;//kernel.MapEditor:92
      _this.fileExist=false;
      //$LASTPOS=85000110;//kernel.MapEditor:110
      Tonyu.globals.$Boot.on("stop",(function anonymous_127(e) {
        
        //$LASTPOS=85000179;//kernel.MapEditor:179
        if (_this.modified) {
          //$LASTPOS=85000204;//kernel.MapEditor:204
          e.preventDefault();
          //$LASTPOS=85000233;//kernel.MapEditor:233
          _this.parallel(Tonyu.bindFunc(_this,_this.st),e);
          
        }
      }));
      //$LASTPOS=85000646;//kernel.MapEditor:646
      _this.print("map file(s)");
      //$LASTPOS=85000694;//kernel.MapEditor:694
      _this.fileList=_this.file("../maps/");
      //$LASTPOS=85000722;//kernel.MapEditor:722
      if (_this.fileList.exists()) {
        //$LASTPOS=85000750;//kernel.MapEditor:750
        _this.fileList.recursive((function a(f) {
          
          //$LASTPOS=85000844;//kernel.MapEditor:844
          _this.print(f.name());
          //$LASTPOS=85000900;//kernel.MapEditor:900
          _this.fileExist=true;
        }));
        
      }
      //$LASTPOS=85000943;//kernel.MapEditor:943
      if (_this.fileExist) {
        //$LASTPOS=85000963;//kernel.MapEditor:963
        _this.print("Load Data?: Y or N");
        //$LASTPOS=85000997;//kernel.MapEditor:997
        while (true) {
          //$LASTPOS=85001019;//kernel.MapEditor:1019
          if (_this.getkey("y")>0) {
            //$LASTPOS=85001051;//kernel.MapEditor:1051
            _this.loadMode=true;
            break;
            
            
          }
          //$LASTPOS=85001106;//kernel.MapEditor:1106
          if (_this.getkey("n")>0) {
            //$LASTPOS=85001138;//kernel.MapEditor:1138
            _this.loadMode=false;
            break;
            
            
          }
          //$LASTPOS=85001194;//kernel.MapEditor:1194
          _this.update();
          
        }
        //$LASTPOS=85001216;//kernel.MapEditor:1216
        if (_this.loadMode) {
          //$LASTPOS=85001239;//kernel.MapEditor:1239
          _this.fileName=_this.prompt("Input json file (*.json)","map.json");
          //$LASTPOS=85001304;//kernel.MapEditor:1304
          if (_this.fileName) {
            //$LASTPOS=85001331;//kernel.MapEditor:1331
            _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
            
          }
          //$LASTPOS=85001395;//kernel.MapEditor:1395
          if (_this.mapDataFile.obj()) {
            //$LASTPOS=85001431;//kernel.MapEditor:1431
            _this.baseData=_this.mapDataFile.obj();
            //$LASTPOS=85001472;//kernel.MapEditor:1472
            _this.loadedFile=_this.fileName;
            
          } else {
            //$LASTPOS=85001522;//kernel.MapEditor:1522
            _this.mapDataFile=_this.file(_this.fileName);
            //$LASTPOS=85001563;//kernel.MapEditor:1563
            if (_this.mapDataFile.obj()) {
              //$LASTPOS=85001603;//kernel.MapEditor:1603
              _this.baseData=_this.mapDataFile.obj();
              //$LASTPOS=85001648;//kernel.MapEditor:1648
              _this.loadedFile=_this.fileName;
              
            }
            
          }
          //$LASTPOS=85001704;//kernel.MapEditor:1704
          if (_this.baseData==undefined) {
            //$LASTPOS=85001742;//kernel.MapEditor:1742
            _this.print("Load failed");
            //$LASTPOS=85001777;//kernel.MapEditor:1777
            _this.loadMode=false;
            
          } else {
            //$LASTPOS=85001808;//kernel.MapEditor:1808
            if (_this.baseData[0]&&_this.baseData[1]) {
              //$LASTPOS=85001853;//kernel.MapEditor:1853
              _this.modified=false;
              //$LASTPOS=85001882;//kernel.MapEditor:1882
              _this.mapData=_this.baseData[0];
              //$LASTPOS=85001916;//kernel.MapEditor:1916
              _this.mapOnData=_this.baseData[1];
              //$LASTPOS=85001952;//kernel.MapEditor:1952
              if (_this.baseData.length>2) {
                //$LASTPOS=85001992;//kernel.MapEditor:1992
                _this.chipWidth=_this.baseData[_this.baseData.length-2];
                //$LASTPOS=85002048;//kernel.MapEditor:2048
                _this.chipHeight=_this.baseData[_this.baseData.length-1];
                
              }
              
            }
          }
          
        }
        
      }
      //$LASTPOS=85002125;//kernel.MapEditor:2125
      _this.update();
      //$LASTPOS=85002170;//kernel.MapEditor:2170
      if (! _this.loadMode) {
        //$LASTPOS=85002190;//kernel.MapEditor:2190
        _this.row=_this.prompt("input row");
        //$LASTPOS=85002220;//kernel.MapEditor:2220
        _this.row=(_this.row-0)||50;
        //$LASTPOS=85002242;//kernel.MapEditor:2242
        _this.col=_this.prompt("input col");
        //$LASTPOS=85002272;//kernel.MapEditor:2272
        _this.col=(_this.col-0)||50;
        //$LASTPOS=85002294;//kernel.MapEditor:2294
        _this.chipWidth=_this.prompt("input chipWidth");
        //$LASTPOS=85002336;//kernel.MapEditor:2336
        _this.chipHeight=_this.prompt("input chipHeight");
        //$LASTPOS=85002380;//kernel.MapEditor:2380
        _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
        //$LASTPOS=85002445;//kernel.MapEditor:2445
        _this.panel.x=_this.panel.width/2+40;
        //$LASTPOS=85002476;//kernel.MapEditor:2476
        _this.panel.y=_this.panel.height/2+40;
        //$LASTPOS=85002508;//kernel.MapEditor:2508
        _this.panel.setFillStyle("cyan");
        //$LASTPOS=85002541;//kernel.MapEditor:2541
        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
        //$LASTPOS=85002592;//kernel.MapEditor:2592
        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});
        
      } else {
        //$LASTPOS=85002903;//kernel.MapEditor:2903
        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({chipWidth: 32,chipHeight: 32});
        //$LASTPOS=85002950;//kernel.MapEditor:2950
        Tonyu.globals.$map.load(_this.fileName);
        //$LASTPOS=85002976;//kernel.MapEditor:2976
        _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
        //$LASTPOS=85003072;//kernel.MapEditor:3072
        _this.panel.x=_this.panel.width/2+40;
        //$LASTPOS=85003103;//kernel.MapEditor:3103
        _this.panel.y=_this.panel.height/2+40;
        //$LASTPOS=85003135;//kernel.MapEditor:3135
        _this.panel.setFillStyle("cyan");
        //$LASTPOS=85003168;//kernel.MapEditor:3168
        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
        
      }
      //$LASTPOS=85003235;//kernel.MapEditor:3235
      _this.mIW=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip].image.width;
      //$LASTPOS=85003278;//kernel.MapEditor:3278
      _this.mIH=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip].image.height;
      //$LASTPOS=85003322;//kernel.MapEditor:3322
      _this.mCW=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip+0].width;
      //$LASTPOS=85003361;//kernel.MapEditor:3361
      _this.mCH=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip+0].height;
      //$LASTPOS=85003401;//kernel.MapEditor:3401
      Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: _this.floor(_this.mIH/_this.mCH),col: _this.floor(_this.mIW/_this.mCW),chipWidth: _this.mCW,chipHeight: _this.mCH});
      //$LASTPOS=85003483;//kernel.MapEditor:3483
      _this.counter=0;
      //$LASTPOS=85003495;//kernel.MapEditor:3495
      //$LASTPOS=85003499;//kernel.MapEditor:3499
      _this.i = 0;
      for (; _this.i<Tonyu.globals.$mp.row ; _this.i++) {
        {
          //$LASTPOS=85003528;//kernel.MapEditor:3528
          //$LASTPOS=85003532;//kernel.MapEditor:3532
          _this.j = 0;
          for (; _this.j<Tonyu.globals.$mp.col ; _this.j++) {
            {
              //$LASTPOS=85003565;//kernel.MapEditor:3565
              Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
              //$LASTPOS=85003609;//kernel.MapEditor:3609
              _this.counter++;
            }
          }
        }
      }
      //$LASTPOS=85003633;//kernel.MapEditor:3633
      Tonyu.globals.$consolePanel.clearRect(0,0,Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
      //$LASTPOS=85003713;//kernel.MapEditor:3713
      _this.mode="get";
      //$LASTPOS=85003726;//kernel.MapEditor:3726
      _this.prevMode="set";
      //$LASTPOS=85003743;//kernel.MapEditor:3743
      _this.mapp=0;
      //$LASTPOS=85003752;//kernel.MapEditor:3752
      _this.maponp=- 1;
      //$LASTPOS=85003764;//kernel.MapEditor:3764
      _this.mx=- 40;
      //$LASTPOS=85003773;//kernel.MapEditor:3773
      _this.my=- 40;
      //$LASTPOS=85003782;//kernel.MapEditor:3782
      _this.chipX=- 40;
      //$LASTPOS=85003794;//kernel.MapEditor:3794
      _this.chipY=- 40;
      //$LASTPOS=85003806;//kernel.MapEditor:3806
      _this.x=Tonyu.globals.$screenWidth-_this.chipWidth/2;
      //$LASTPOS=85003835;//kernel.MapEditor:3835
      _this.y=Tonyu.globals.$screenHeight-_this.chipHeight/2;
      //$LASTPOS=85003866;//kernel.MapEditor:3866
      Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
      //$LASTPOS=85003891;//kernel.MapEditor:3891
      _this.initialWidth=Tonyu.globals.$map.chipWidth;
      //$LASTPOS=85003921;//kernel.MapEditor:3921
      _this.initialHeight=Tonyu.globals.$map.chipHeight;
      //$LASTPOS=85003953;//kernel.MapEditor:3953
      _this.layers=["base","on","all"];
      //$LASTPOS=85003982;//kernel.MapEditor:3982
      _this.lc=0;
      //$LASTPOS=85003989;//kernel.MapEditor:3989
      _this.selectedLayer=_this.layers[_this.lc];
      //$LASTPOS=85004016;//kernel.MapEditor:4016
      _this.drawPanel();
      //$LASTPOS=85004030;//kernel.MapEditor:4030
      _this.drawLetter(_this.mode);
      //$LASTPOS=85004051;//kernel.MapEditor:4051
      while (true) {
        //$LASTPOS=85004069;//kernel.MapEditor:4069
        _this.p=_this.mapp;
        //$LASTPOS=85004082;//kernel.MapEditor:4082
        if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640) {
          //$LASTPOS=85004201;//kernel.MapEditor:4201
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=85004235;//kernel.MapEditor:4235
          _this.mode="erase";
          //$LASTPOS=85004290;//kernel.MapEditor:4290
          _this.drawLetter(_this.mode);
          
        }
        //$LASTPOS=85004320;//kernel.MapEditor:4320
        if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
          //$LASTPOS=85004439;//kernel.MapEditor:4439
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=85004473;//kernel.MapEditor:4473
          _this.mode="set";
          //$LASTPOS=85004494;//kernel.MapEditor:4494
          _this.drawLetter(_this.mode);
          
        }
        //$LASTPOS=85004524;//kernel.MapEditor:4524
        if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
          //$LASTPOS=85004645;//kernel.MapEditor:4645
          _this.lc++;
          //$LASTPOS=85004660;//kernel.MapEditor:4660
          _this.selectedLayer=_this.layers[_this.lc%3];
          //$LASTPOS=85004697;//kernel.MapEditor:4697
          _this.drawPanel();
          //$LASTPOS=85004751;//kernel.MapEditor:4751
          _this.drawLetter(_this.mode);
          
        }
        //$LASTPOS=85004874;//kernel.MapEditor:4874
        if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>240&&Tonyu.globals.$touches[0].x<360&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
          //$LASTPOS=85004995;//kernel.MapEditor:4995
          if (_this.mode!="get") {
            //$LASTPOS=85005025;//kernel.MapEditor:5025
            _this.prevMode=_this.mode;
            //$LASTPOS=85005053;//kernel.MapEditor:5053
            Tonyu.globals.$mp.scrollTo(- 40,- 40);
            //$LASTPOS=85005089;//kernel.MapEditor:5089
            _this.mode="get";
            //$LASTPOS=85005114;//kernel.MapEditor:5114
            _this.chipX=- 40;
            //$LASTPOS=85005138;//kernel.MapEditor:5138
            _this.chipY=- 40;
            
          } else {
            //$LASTPOS=85005178;//kernel.MapEditor:5178
            Tonyu.globals.$mp.scrollTo(1000,1000);
            //$LASTPOS=85005216;//kernel.MapEditor:5216
            _this.mode=_this.prevMode;
            
          }
          //$LASTPOS=85005283;//kernel.MapEditor:5283
          _this.drawLetter(_this.mode);
          
        }
        //$LASTPOS=85005313;//kernel.MapEditor:5313
        if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>360&&Tonyu.globals.$touches[0].x<480&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
          //$LASTPOS=85005449;//kernel.MapEditor:5449
          if (_this.loadedFile) {
            //$LASTPOS=85005478;//kernel.MapEditor:5478
            _this.saveFileName=_this.prompt("input json file(*.json)",_this.loadedFile);
            
          } else {
            //$LASTPOS=85005566;//kernel.MapEditor:5566
            _this.saveFileName=_this.prompt("input json file(*.json)","map.json");
            
          }
          //$LASTPOS=85005660;//kernel.MapEditor:5660
          if (_this.saveFileName) {
            //$LASTPOS=85005691;//kernel.MapEditor:5691
            _this.save(_this.saveFileName);
            
          }
          
        }
        //$LASTPOS=85005991;//kernel.MapEditor:5991
        if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640) {
          //$LASTPOS=85006112;//kernel.MapEditor:6112
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=85006146;//kernel.MapEditor:6146
          _this.mode="copy";
          //$LASTPOS=85006200;//kernel.MapEditor:6200
          _this.drawLetter(_this.mode);
          
        }
        //$LASTPOS=85006230;//kernel.MapEditor:6230
        if (_this.mode!="get") {
          //$LASTPOS=85006256;//kernel.MapEditor:6256
          if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
            //$LASTPOS=85006362;//kernel.MapEditor:6362
            _this.mx=_this.mx-8;
          }
          //$LASTPOS=85006380;//kernel.MapEditor:6380
          if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
            //$LASTPOS=85006511;//kernel.MapEditor:6511
            _this.mx=_this.mx+8;
          }
          //$LASTPOS=85006529;//kernel.MapEditor:6529
          if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
            //$LASTPOS=85006642;//kernel.MapEditor:6642
            _this.my=_this.my-8;
          }
          //$LASTPOS=85006660;//kernel.MapEditor:6660
          if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
            //$LASTPOS=85006795;//kernel.MapEditor:6795
            _this.my=_this.my+8;
          }
          //$LASTPOS=85006813;//kernel.MapEditor:6813
          Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
          
        } else {
          //$LASTPOS=85006856;//kernel.MapEditor:6856
          if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
            //$LASTPOS=85006962;//kernel.MapEditor:6962
            _this.chipX=_this.chipX-8;
          }
          //$LASTPOS=85006986;//kernel.MapEditor:6986
          if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
            //$LASTPOS=85007117;//kernel.MapEditor:7117
            _this.chipX=_this.chipX+8;
          }
          //$LASTPOS=85007141;//kernel.MapEditor:7141
          if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
            //$LASTPOS=85007254;//kernel.MapEditor:7254
            _this.chipY=_this.chipY-8;
          }
          //$LASTPOS=85007278;//kernel.MapEditor:7278
          if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
            //$LASTPOS=85007413;//kernel.MapEditor:7413
            _this.chipY=_this.chipY+8;
          }
          //$LASTPOS=85007437;//kernel.MapEditor:7437
          Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
          
        }
        //$LASTPOS=85007506;//kernel.MapEditor:7506
        if (_this.getkey("i")==1) {
          //$LASTPOS=85007535;//kernel.MapEditor:7535
          if (Tonyu.globals.$map.chipWidth<_this.initialWidth) {
            //$LASTPOS=85007567;//kernel.MapEditor:7567
            Tonyu.globals.$map.chipWidth+=4;
          }
          //$LASTPOS=85007595;//kernel.MapEditor:7595
          if (Tonyu.globals.$map.chipHeight<_this.initialHeight) {
            //$LASTPOS=85007629;//kernel.MapEditor:7629
            Tonyu.globals.$map.chipHeight+=4;
          }
          //$LASTPOS=85007658;//kernel.MapEditor:7658
          Tonyu.globals.$map.redrawMap();
          //$LASTPOS=85007685;//kernel.MapEditor:7685
          _this.panel.die();
          //$LASTPOS=85007707;//kernel.MapEditor:7707
          _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
          //$LASTPOS=85007807;//kernel.MapEditor:7807
          _this.panel.x=_this.panel.width/2+40;
          //$LASTPOS=85007842;//kernel.MapEditor:7842
          _this.panel.y=_this.panel.height/2+40;
          //$LASTPOS=85007878;//kernel.MapEditor:7878
          _this.panel.setFillStyle("cyan");
          //$LASTPOS=85007915;//kernel.MapEditor:7915
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          
        }
        //$LASTPOS=85007973;//kernel.MapEditor:7973
        if (_this.getkey("o")==1) {
          //$LASTPOS=85008002;//kernel.MapEditor:8002
          if (Tonyu.globals.$map.chipWidth>4) {
            //$LASTPOS=85008023;//kernel.MapEditor:8023
            Tonyu.globals.$map.chipWidth-=4;
          }
          //$LASTPOS=85008051;//kernel.MapEditor:8051
          if (Tonyu.globals.$map.chipHeight>4) {
            //$LASTPOS=85008073;//kernel.MapEditor:8073
            Tonyu.globals.$map.chipHeight-=4;
          }
          //$LASTPOS=85008102;//kernel.MapEditor:8102
          Tonyu.globals.$map.redrawMap();
          //$LASTPOS=85008129;//kernel.MapEditor:8129
          _this.panel.die();
          //$LASTPOS=85008151;//kernel.MapEditor:8151
          _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
          //$LASTPOS=85008251;//kernel.MapEditor:8251
          _this.panel.x=_this.panel.width/2+40;
          //$LASTPOS=85008286;//kernel.MapEditor:8286
          _this.panel.y=_this.panel.height/2+40;
          //$LASTPOS=85008322;//kernel.MapEditor:8322
          _this.panel.setFillStyle("cyan");
          //$LASTPOS=85008359;//kernel.MapEditor:8359
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          
        }
        //$LASTPOS=85008443;//kernel.MapEditor:8443
        _this.panel.x=_this.panel.width/2-_this.mx;
        //$LASTPOS=85008474;//kernel.MapEditor:8474
        _this.panel.y=_this.panel.height/2-_this.my;
        //$LASTPOS=85008506;//kernel.MapEditor:8506
        if (_this.mode=="set"&&_this.getkey(1)>0&&_this.inRect()) {
          //$LASTPOS=85008559;//kernel.MapEditor:8559
          if (_this.selectedLayer=="base") {
            //$LASTPOS=85008599;//kernel.MapEditor:8599
            _this.tmpon=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
            //$LASTPOS=85008649;//kernel.MapEditor:8649
            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
            //$LASTPOS=85008696;//kernel.MapEditor:8696
            Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.tmpon);
            
          } else {
            //$LASTPOS=85008748;//kernel.MapEditor:8748
            if (_this.selectedLayer=="on") {
              //$LASTPOS=85008786;//kernel.MapEditor:8786
              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
              
            } else {
              //$LASTPOS=85008851;//kernel.MapEditor:8851
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
              //$LASTPOS=85008898;//kernel.MapEditor:8898
              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.maponp);
              
            }
          }
          //$LASTPOS=85008956;//kernel.MapEditor:8956
          _this.modified=true;
          
        } else {
          //$LASTPOS=85008982;//kernel.MapEditor:8982
          if (_this.mode=="erase"&&_this.getkey(1)>0&&_this.inRect()) {
            //$LASTPOS=85009037;//kernel.MapEditor:9037
            if (_this.selectedLayer=="base") {
              //$LASTPOS=85009077;//kernel.MapEditor:9077
              _this.tmpon=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
              //$LASTPOS=85009127;//kernel.MapEditor:9127
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
              //$LASTPOS=85009172;//kernel.MapEditor:9172
              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.tmpon);
              
            } else {
              //$LASTPOS=85009224;//kernel.MapEditor:9224
              if (_this.selectedLayer=="on") {
                //$LASTPOS=85009262;//kernel.MapEditor:9262
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                
              } else {
                //$LASTPOS=85009325;//kernel.MapEditor:9325
                Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                //$LASTPOS=85009370;//kernel.MapEditor:9370
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                
              }
            }
            //$LASTPOS=85009424;//kernel.MapEditor:9424
            _this.modified=true;
            
          } else {
            //$LASTPOS=85009450;//kernel.MapEditor:9450
            if (_this.mode=="get"&&_this.getkey(1)>0&&_this.inRect()) {
              //$LASTPOS=85009503;//kernel.MapEditor:9503
              _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
              //$LASTPOS=85009571;//kernel.MapEditor:9571
              _this.mode="set";
              //$LASTPOS=85009592;//kernel.MapEditor:9592
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=85009658;//kernel.MapEditor:9658
              _this.drawLetter(_this.mode);
              //$LASTPOS=85009685;//kernel.MapEditor:9685
              _this.updateEx(10);
              
            } else {
              //$LASTPOS=85009710;//kernel.MapEditor:9710
              if (_this.mode=="setOn"&&_this.getkey(1)>0&&_this.inRect()) {
                //$LASTPOS=85009765;//kernel.MapEditor:9765
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
                //$LASTPOS=85009810;//kernel.MapEditor:9810
                _this.modified=true;
                
              } else {
                //$LASTPOS=85009836;//kernel.MapEditor:9836
                if (_this.mode=="copy"&&_this.getkey(1)>0&&_this.inRect()) {
                  //$LASTPOS=85009890;//kernel.MapEditor:9890
                  if (_this.selectedLayer=="base") {
                    //$LASTPOS=85009930;//kernel.MapEditor:9930
                    _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                    //$LASTPOS=85009977;//kernel.MapEditor:9977
                    _this.maponp=- 1;
                    
                  } else {
                    //$LASTPOS=85010003;//kernel.MapEditor:10003
                    if (_this.selectedLayer=="on") {
                      //$LASTPOS=85010041;//kernel.MapEditor:10041
                      _this.mapp=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                      
                    } else {
                      //$LASTPOS=85010106;//kernel.MapEditor:10106
                      _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                      //$LASTPOS=85010153;//kernel.MapEditor:10153
                      _this.maponp=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                      
                    }
                  }
                  //$LASTPOS=85010258;//kernel.MapEditor:10258
                  _this.mode="set";
                  //$LASTPOS=85010311;//kernel.MapEditor:10311
                  _this.drawLetter(_this.mode);
                  //$LASTPOS=85010338;//kernel.MapEditor:10338
                  _this.updateEx(10);
                  
                }
              }
            }
          }
        }
        //$LASTPOS=85010364;//kernel.MapEditor:10364
        _this.update();
        
      }
    },
    fiber$main :function _trc_MapEditor_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=85000049;//kernel.MapEditor:49
      Tonyu.globals.$Screen.resize(480,640);
      //$LASTPOS=85000075;//kernel.MapEditor:75
      _this.loadMode=false;
      //$LASTPOS=85000092;//kernel.MapEditor:92
      _this.fileExist=false;
      //$LASTPOS=85000110;//kernel.MapEditor:110
      Tonyu.globals.$Boot.on("stop",(function anonymous_127(e) {
        
        //$LASTPOS=85000179;//kernel.MapEditor:179
        if (_this.modified) {
          //$LASTPOS=85000204;//kernel.MapEditor:204
          e.preventDefault();
          //$LASTPOS=85000233;//kernel.MapEditor:233
          _this.parallel(Tonyu.bindFunc(_this,_this.st),e);
          
        }
      }));
      //$LASTPOS=85000646;//kernel.MapEditor:646
      _this.print("map file(s)");
      
      _thread.enter(function _trc_MapEditor_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=85000694;//kernel.MapEditor:694
            _this.fiber$file(_thread, "../maps/");
            __pc=1;return;
          case 1:
            _this.fileList=_thread.retVal;
            
            //$LASTPOS=85000722;//kernel.MapEditor:722
            if (_this.fileList.exists()) {
              //$LASTPOS=85000750;//kernel.MapEditor:750
              _this.fileList.recursive((function a(f) {
                
                //$LASTPOS=85000844;//kernel.MapEditor:844
                _this.print(f.name());
                //$LASTPOS=85000900;//kernel.MapEditor:900
                _this.fileExist=true;
              }));
              
            }
            //$LASTPOS=85000943;//kernel.MapEditor:943
            if (!(_this.fileExist)) { __pc=12    ; break; }
            //$LASTPOS=85000963;//kernel.MapEditor:963
            _this.print("Load Data?: Y or N");
            //$LASTPOS=85000997;//kernel.MapEditor:997
          case 2:
            //$LASTPOS=85001019;//kernel.MapEditor:1019
            if (!(_this.getkey("y")>0)) { __pc=3     ; break; }
            //$LASTPOS=85001051;//kernel.MapEditor:1051
            _this.loadMode=true;
            __pc=6     ; break;
            
          case 3     :
            
            //$LASTPOS=85001106;//kernel.MapEditor:1106
            if (!(_this.getkey("n")>0)) { __pc=4     ; break; }
            //$LASTPOS=85001138;//kernel.MapEditor:1138
            _this.loadMode=false;
            __pc=6     ; break;
            
          case 4     :
            
            //$LASTPOS=85001194;//kernel.MapEditor:1194
            _this.fiber$update(_thread);
            __pc=5;return;
          case 5:
            
            __pc=2;break;
          case 6     :
            
            //$LASTPOS=85001216;//kernel.MapEditor:1216
            if (!(_this.loadMode)) { __pc=11    ; break; }
            //$LASTPOS=85001239;//kernel.MapEditor:1239
            _this.fiber$prompt(_thread, "Input json file (*.json)", "map.json");
            __pc=7;return;
          case 7:
            _this.fileName=_thread.retVal;
            
            //$LASTPOS=85001304;//kernel.MapEditor:1304
            if (_this.fileName) {
              //$LASTPOS=85001331;//kernel.MapEditor:1331
              _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
              
            }
            //$LASTPOS=85001395;//kernel.MapEditor:1395
            if (!(_this.mapDataFile.obj())) { __pc=8     ; break; }
            {
              //$LASTPOS=85001431;//kernel.MapEditor:1431
              _this.baseData=_this.mapDataFile.obj();
              //$LASTPOS=85001472;//kernel.MapEditor:1472
              _this.loadedFile=_this.fileName;
            }
            __pc=10    ;break;
          case 8     :
            //$LASTPOS=85001522;//kernel.MapEditor:1522
            _this.fiber$file(_thread, _this.fileName);
            __pc=9;return;
          case 9:
            _this.mapDataFile=_thread.retVal;
            
            //$LASTPOS=85001563;//kernel.MapEditor:1563
            if (_this.mapDataFile.obj()) {
              //$LASTPOS=85001603;//kernel.MapEditor:1603
              _this.baseData=_this.mapDataFile.obj();
              //$LASTPOS=85001648;//kernel.MapEditor:1648
              _this.loadedFile=_this.fileName;
              
            }
          case 10    :
            
            //$LASTPOS=85001704;//kernel.MapEditor:1704
            if (_this.baseData==undefined) {
              //$LASTPOS=85001742;//kernel.MapEditor:1742
              _this.print("Load failed");
              //$LASTPOS=85001777;//kernel.MapEditor:1777
              _this.loadMode=false;
              
            } else {
              //$LASTPOS=85001808;//kernel.MapEditor:1808
              if (_this.baseData[0]&&_this.baseData[1]) {
                //$LASTPOS=85001853;//kernel.MapEditor:1853
                _this.modified=false;
                //$LASTPOS=85001882;//kernel.MapEditor:1882
                _this.mapData=_this.baseData[0];
                //$LASTPOS=85001916;//kernel.MapEditor:1916
                _this.mapOnData=_this.baseData[1];
                //$LASTPOS=85001952;//kernel.MapEditor:1952
                if (_this.baseData.length>2) {
                  //$LASTPOS=85001992;//kernel.MapEditor:1992
                  _this.chipWidth=_this.baseData[_this.baseData.length-2];
                  //$LASTPOS=85002048;//kernel.MapEditor:2048
                  _this.chipHeight=_this.baseData[_this.baseData.length-1];
                  
                }
                
              }
            }
          case 11    :
            
          case 12    :
            
            //$LASTPOS=85002125;//kernel.MapEditor:2125
            _this.fiber$update(_thread);
            __pc=13;return;
          case 13:
            
            //$LASTPOS=85002170;//kernel.MapEditor:2170
            if (!(! _this.loadMode)) { __pc=18    ; break; }
            //$LASTPOS=85002190;//kernel.MapEditor:2190
            _this.fiber$prompt(_thread, "input row");
            __pc=14;return;
          case 14:
            _this.row=_thread.retVal;
            
            //$LASTPOS=85002220;//kernel.MapEditor:2220
            _this.row=(_this.row-0)||50;
            //$LASTPOS=85002242;//kernel.MapEditor:2242
            _this.fiber$prompt(_thread, "input col");
            __pc=15;return;
          case 15:
            _this.col=_thread.retVal;
            
            //$LASTPOS=85002272;//kernel.MapEditor:2272
            _this.col=(_this.col-0)||50;
            //$LASTPOS=85002294;//kernel.MapEditor:2294
            _this.fiber$prompt(_thread, "input chipWidth");
            __pc=16;return;
          case 16:
            _this.chipWidth=_thread.retVal;
            
            //$LASTPOS=85002336;//kernel.MapEditor:2336
            _this.fiber$prompt(_thread, "input chipHeight");
            __pc=17;return;
          case 17:
            _this.chipHeight=_thread.retVal;
            
            //$LASTPOS=85002380;//kernel.MapEditor:2380
            _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
            //$LASTPOS=85002445;//kernel.MapEditor:2445
            _this.panel.x=_this.panel.width/2+40;
            //$LASTPOS=85002476;//kernel.MapEditor:2476
            _this.panel.y=_this.panel.height/2+40;
            //$LASTPOS=85002508;//kernel.MapEditor:2508
            _this.panel.setFillStyle("cyan");
            //$LASTPOS=85002541;//kernel.MapEditor:2541
            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            //$LASTPOS=85002592;//kernel.MapEditor:2592
            Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});
            __pc=19    ;break;
          case 18    :
            {
              //$LASTPOS=85002903;//kernel.MapEditor:2903
              Tonyu.globals.$map=new Tonyu.classes.kernel.Map({chipWidth: 32,chipHeight: 32});
              //$LASTPOS=85002950;//kernel.MapEditor:2950
              Tonyu.globals.$map.load(_this.fileName);
              //$LASTPOS=85002976;//kernel.MapEditor:2976
              _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
              //$LASTPOS=85003072;//kernel.MapEditor:3072
              _this.panel.x=_this.panel.width/2+40;
              //$LASTPOS=85003103;//kernel.MapEditor:3103
              _this.panel.y=_this.panel.height/2+40;
              //$LASTPOS=85003135;//kernel.MapEditor:3135
              _this.panel.setFillStyle("cyan");
              //$LASTPOS=85003168;//kernel.MapEditor:3168
              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            }
          case 19    :
            
            //$LASTPOS=85003235;//kernel.MapEditor:3235
            _this.mIW=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip].image.width;
            //$LASTPOS=85003278;//kernel.MapEditor:3278
            _this.mIH=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip].image.height;
            //$LASTPOS=85003322;//kernel.MapEditor:3322
            _this.mCW=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip+0].width;
            //$LASTPOS=85003361;//kernel.MapEditor:3361
            _this.mCH=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip+0].height;
            //$LASTPOS=85003401;//kernel.MapEditor:3401
            Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: _this.floor(_this.mIH/_this.mCH),col: _this.floor(_this.mIW/_this.mCW),chipWidth: _this.mCW,chipHeight: _this.mCH});
            //$LASTPOS=85003483;//kernel.MapEditor:3483
            _this.counter=0;
            //$LASTPOS=85003495;//kernel.MapEditor:3495
            //$LASTPOS=85003499;//kernel.MapEditor:3499
            _this.i = 0;
            for (; _this.i<Tonyu.globals.$mp.row ; _this.i++) {
              {
                //$LASTPOS=85003528;//kernel.MapEditor:3528
                //$LASTPOS=85003532;//kernel.MapEditor:3532
                _this.j = 0;
                for (; _this.j<Tonyu.globals.$mp.col ; _this.j++) {
                  {
                    //$LASTPOS=85003565;//kernel.MapEditor:3565
                    Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
                    //$LASTPOS=85003609;//kernel.MapEditor:3609
                    _this.counter++;
                  }
                }
              }
            }
            //$LASTPOS=85003633;//kernel.MapEditor:3633
            Tonyu.globals.$consolePanel.clearRect(0,0,Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
            //$LASTPOS=85003713;//kernel.MapEditor:3713
            _this.mode="get";
            //$LASTPOS=85003726;//kernel.MapEditor:3726
            _this.prevMode="set";
            //$LASTPOS=85003743;//kernel.MapEditor:3743
            _this.mapp=0;
            //$LASTPOS=85003752;//kernel.MapEditor:3752
            _this.maponp=- 1;
            //$LASTPOS=85003764;//kernel.MapEditor:3764
            _this.mx=- 40;
            //$LASTPOS=85003773;//kernel.MapEditor:3773
            _this.my=- 40;
            //$LASTPOS=85003782;//kernel.MapEditor:3782
            _this.chipX=- 40;
            //$LASTPOS=85003794;//kernel.MapEditor:3794
            _this.chipY=- 40;
            //$LASTPOS=85003806;//kernel.MapEditor:3806
            _this.x=Tonyu.globals.$screenWidth-_this.chipWidth/2;
            //$LASTPOS=85003835;//kernel.MapEditor:3835
            _this.y=Tonyu.globals.$screenHeight-_this.chipHeight/2;
            //$LASTPOS=85003866;//kernel.MapEditor:3866
            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
            //$LASTPOS=85003891;//kernel.MapEditor:3891
            _this.initialWidth=Tonyu.globals.$map.chipWidth;
            //$LASTPOS=85003921;//kernel.MapEditor:3921
            _this.initialHeight=Tonyu.globals.$map.chipHeight;
            //$LASTPOS=85003953;//kernel.MapEditor:3953
            _this.layers=["base","on","all"];
            //$LASTPOS=85003982;//kernel.MapEditor:3982
            _this.lc=0;
            //$LASTPOS=85003989;//kernel.MapEditor:3989
            _this.selectedLayer=_this.layers[_this.lc];
            //$LASTPOS=85004016;//kernel.MapEditor:4016
            _this.fiber$drawPanel(_thread);
            __pc=20;return;
          case 20:
            
            //$LASTPOS=85004030;//kernel.MapEditor:4030
            _this.fiber$drawLetter(_thread, _this.mode);
            __pc=21;return;
          case 21:
            
            //$LASTPOS=85004051;//kernel.MapEditor:4051
          case 22:
            //$LASTPOS=85004069;//kernel.MapEditor:4069
            _this.p=_this.mapp;
            //$LASTPOS=85004082;//kernel.MapEditor:4082
            if (!(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) { __pc=24    ; break; }
            //$LASTPOS=85004201;//kernel.MapEditor:4201
            Tonyu.globals.$mp.scrollTo(1000,1000);
            //$LASTPOS=85004235;//kernel.MapEditor:4235
            _this.mode="erase";
            //$LASTPOS=85004290;//kernel.MapEditor:4290
            _this.fiber$drawLetter(_thread, _this.mode);
            __pc=23;return;
          case 23:
            
          case 24    :
            
            //$LASTPOS=85004320;//kernel.MapEditor:4320
            if (!(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) { __pc=26    ; break; }
            //$LASTPOS=85004439;//kernel.MapEditor:4439
            Tonyu.globals.$mp.scrollTo(1000,1000);
            //$LASTPOS=85004473;//kernel.MapEditor:4473
            _this.mode="set";
            //$LASTPOS=85004494;//kernel.MapEditor:4494
            _this.fiber$drawLetter(_thread, _this.mode);
            __pc=25;return;
          case 25:
            
          case 26    :
            
            //$LASTPOS=85004524;//kernel.MapEditor:4524
            if (!(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) { __pc=29    ; break; }
            //$LASTPOS=85004645;//kernel.MapEditor:4645
            _this.lc++;
            //$LASTPOS=85004660;//kernel.MapEditor:4660
            _this.selectedLayer=_this.layers[_this.lc%3];
            //$LASTPOS=85004697;//kernel.MapEditor:4697
            _this.fiber$drawPanel(_thread);
            __pc=27;return;
          case 27:
            
            //$LASTPOS=85004751;//kernel.MapEditor:4751
            _this.fiber$drawLetter(_thread, _this.mode);
            __pc=28;return;
          case 28:
            
          case 29    :
            
            //$LASTPOS=85004874;//kernel.MapEditor:4874
            if (!(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>240&&Tonyu.globals.$touches[0].x<360&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) { __pc=31    ; break; }
            //$LASTPOS=85004995;//kernel.MapEditor:4995
            if (_this.mode!="get") {
              //$LASTPOS=85005025;//kernel.MapEditor:5025
              _this.prevMode=_this.mode;
              //$LASTPOS=85005053;//kernel.MapEditor:5053
              Tonyu.globals.$mp.scrollTo(- 40,- 40);
              //$LASTPOS=85005089;//kernel.MapEditor:5089
              _this.mode="get";
              //$LASTPOS=85005114;//kernel.MapEditor:5114
              _this.chipX=- 40;
              //$LASTPOS=85005138;//kernel.MapEditor:5138
              _this.chipY=- 40;
              
            } else {
              //$LASTPOS=85005178;//kernel.MapEditor:5178
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=85005216;//kernel.MapEditor:5216
              _this.mode=_this.prevMode;
              
            }
            //$LASTPOS=85005283;//kernel.MapEditor:5283
            _this.fiber$drawLetter(_thread, _this.mode);
            __pc=30;return;
          case 30:
            
          case 31    :
            
            //$LASTPOS=85005313;//kernel.MapEditor:5313
            if (!(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>360&&Tonyu.globals.$touches[0].x<480&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) { __pc=38    ; break; }
            //$LASTPOS=85005449;//kernel.MapEditor:5449
            if (!(_this.loadedFile)) { __pc=33    ; break; }
            //$LASTPOS=85005478;//kernel.MapEditor:5478
            _this.fiber$prompt(_thread, "input json file(*.json)", _this.loadedFile);
            __pc=32;return;
          case 32:
            _this.saveFileName=_thread.retVal;
            
            __pc=35    ;break;
          case 33    :
            //$LASTPOS=85005566;//kernel.MapEditor:5566
            _this.fiber$prompt(_thread, "input json file(*.json)", "map.json");
            __pc=34;return;
          case 34:
            _this.saveFileName=_thread.retVal;
            
          case 35    :
            
            //$LASTPOS=85005660;//kernel.MapEditor:5660
            if (!(_this.saveFileName)) { __pc=37    ; break; }
            //$LASTPOS=85005691;//kernel.MapEditor:5691
            _this.fiber$save(_thread, _this.saveFileName);
            __pc=36;return;
          case 36:
            
          case 37    :
            
          case 38    :
            
            //$LASTPOS=85005991;//kernel.MapEditor:5991
            if (!(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) { __pc=40    ; break; }
            //$LASTPOS=85006112;//kernel.MapEditor:6112
            Tonyu.globals.$mp.scrollTo(1000,1000);
            //$LASTPOS=85006146;//kernel.MapEditor:6146
            _this.mode="copy";
            //$LASTPOS=85006200;//kernel.MapEditor:6200
            _this.fiber$drawLetter(_thread, _this.mode);
            __pc=39;return;
          case 39:
            
          case 40    :
            
            //$LASTPOS=85006230;//kernel.MapEditor:6230
            if (_this.mode!="get") {
              //$LASTPOS=85006256;//kernel.MapEditor:6256
              if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
                //$LASTPOS=85006362;//kernel.MapEditor:6362
                _this.mx=_this.mx-8;
              }
              //$LASTPOS=85006380;//kernel.MapEditor:6380
              if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
                //$LASTPOS=85006511;//kernel.MapEditor:6511
                _this.mx=_this.mx+8;
              }
              //$LASTPOS=85006529;//kernel.MapEditor:6529
              if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
                //$LASTPOS=85006642;//kernel.MapEditor:6642
                _this.my=_this.my-8;
              }
              //$LASTPOS=85006660;//kernel.MapEditor:6660
              if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
                //$LASTPOS=85006795;//kernel.MapEditor:6795
                _this.my=_this.my+8;
              }
              //$LASTPOS=85006813;//kernel.MapEditor:6813
              Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
              
            } else {
              //$LASTPOS=85006856;//kernel.MapEditor:6856
              if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
                //$LASTPOS=85006962;//kernel.MapEditor:6962
                _this.chipX=_this.chipX-8;
              }
              //$LASTPOS=85006986;//kernel.MapEditor:6986
              if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
                //$LASTPOS=85007117;//kernel.MapEditor:7117
                _this.chipX=_this.chipX+8;
              }
              //$LASTPOS=85007141;//kernel.MapEditor:7141
              if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
                //$LASTPOS=85007254;//kernel.MapEditor:7254
                _this.chipY=_this.chipY-8;
              }
              //$LASTPOS=85007278;//kernel.MapEditor:7278
              if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
                //$LASTPOS=85007413;//kernel.MapEditor:7413
                _this.chipY=_this.chipY+8;
              }
              //$LASTPOS=85007437;//kernel.MapEditor:7437
              Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
              
            }
            //$LASTPOS=85007506;//kernel.MapEditor:7506
            if (_this.getkey("i")==1) {
              //$LASTPOS=85007535;//kernel.MapEditor:7535
              if (Tonyu.globals.$map.chipWidth<_this.initialWidth) {
                //$LASTPOS=85007567;//kernel.MapEditor:7567
                Tonyu.globals.$map.chipWidth+=4;
              }
              //$LASTPOS=85007595;//kernel.MapEditor:7595
              if (Tonyu.globals.$map.chipHeight<_this.initialHeight) {
                //$LASTPOS=85007629;//kernel.MapEditor:7629
                Tonyu.globals.$map.chipHeight+=4;
              }
              //$LASTPOS=85007658;//kernel.MapEditor:7658
              Tonyu.globals.$map.redrawMap();
              //$LASTPOS=85007685;//kernel.MapEditor:7685
              _this.panel.die();
              //$LASTPOS=85007707;//kernel.MapEditor:7707
              _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
              //$LASTPOS=85007807;//kernel.MapEditor:7807
              _this.panel.x=_this.panel.width/2+40;
              //$LASTPOS=85007842;//kernel.MapEditor:7842
              _this.panel.y=_this.panel.height/2+40;
              //$LASTPOS=85007878;//kernel.MapEditor:7878
              _this.panel.setFillStyle("cyan");
              //$LASTPOS=85007915;//kernel.MapEditor:7915
              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
              
            }
            //$LASTPOS=85007973;//kernel.MapEditor:7973
            if (_this.getkey("o")==1) {
              //$LASTPOS=85008002;//kernel.MapEditor:8002
              if (Tonyu.globals.$map.chipWidth>4) {
                //$LASTPOS=85008023;//kernel.MapEditor:8023
                Tonyu.globals.$map.chipWidth-=4;
              }
              //$LASTPOS=85008051;//kernel.MapEditor:8051
              if (Tonyu.globals.$map.chipHeight>4) {
                //$LASTPOS=85008073;//kernel.MapEditor:8073
                Tonyu.globals.$map.chipHeight-=4;
              }
              //$LASTPOS=85008102;//kernel.MapEditor:8102
              Tonyu.globals.$map.redrawMap();
              //$LASTPOS=85008129;//kernel.MapEditor:8129
              _this.panel.die();
              //$LASTPOS=85008151;//kernel.MapEditor:8151
              _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
              //$LASTPOS=85008251;//kernel.MapEditor:8251
              _this.panel.x=_this.panel.width/2+40;
              //$LASTPOS=85008286;//kernel.MapEditor:8286
              _this.panel.y=_this.panel.height/2+40;
              //$LASTPOS=85008322;//kernel.MapEditor:8322
              _this.panel.setFillStyle("cyan");
              //$LASTPOS=85008359;//kernel.MapEditor:8359
              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
              
            }
            //$LASTPOS=85008443;//kernel.MapEditor:8443
            _this.panel.x=_this.panel.width/2-_this.mx;
            //$LASTPOS=85008474;//kernel.MapEditor:8474
            _this.panel.y=_this.panel.height/2-_this.my;
            //$LASTPOS=85008506;//kernel.MapEditor:8506
            if (!(_this.mode=="set"&&_this.getkey(1)>0&&_this.inRect())) { __pc=41    ; break; }
            {
              //$LASTPOS=85008559;//kernel.MapEditor:8559
              if (_this.selectedLayer=="base") {
                //$LASTPOS=85008599;//kernel.MapEditor:8599
                _this.tmpon=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                //$LASTPOS=85008649;//kernel.MapEditor:8649
                Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
                //$LASTPOS=85008696;//kernel.MapEditor:8696
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.tmpon);
                
              } else {
                //$LASTPOS=85008748;//kernel.MapEditor:8748
                if (_this.selectedLayer=="on") {
                  //$LASTPOS=85008786;//kernel.MapEditor:8786
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
                  
                } else {
                  //$LASTPOS=85008851;//kernel.MapEditor:8851
                  Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
                  //$LASTPOS=85008898;//kernel.MapEditor:8898
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.maponp);
                  
                }
              }
              //$LASTPOS=85008956;//kernel.MapEditor:8956
              _this.modified=true;
            }
            __pc=53    ;break;
          case 41    :
            //$LASTPOS=85008982;//kernel.MapEditor:8982
            if (!(_this.mode=="erase"&&_this.getkey(1)>0&&_this.inRect())) { __pc=42    ; break; }
            {
              //$LASTPOS=85009037;//kernel.MapEditor:9037
              if (_this.selectedLayer=="base") {
                //$LASTPOS=85009077;//kernel.MapEditor:9077
                _this.tmpon=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                //$LASTPOS=85009127;//kernel.MapEditor:9127
                Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                //$LASTPOS=85009172;//kernel.MapEditor:9172
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.tmpon);
                
              } else {
                //$LASTPOS=85009224;//kernel.MapEditor:9224
                if (_this.selectedLayer=="on") {
                  //$LASTPOS=85009262;//kernel.MapEditor:9262
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                  
                } else {
                  //$LASTPOS=85009325;//kernel.MapEditor:9325
                  Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                  //$LASTPOS=85009370;//kernel.MapEditor:9370
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                  
                }
              }
              //$LASTPOS=85009424;//kernel.MapEditor:9424
              _this.modified=true;
            }
            __pc=52    ;break;
          case 42    :
            //$LASTPOS=85009450;//kernel.MapEditor:9450
            if (!(_this.mode=="get"&&_this.getkey(1)>0&&_this.inRect())) { __pc=45    ; break; }
            //$LASTPOS=85009503;//kernel.MapEditor:9503
            _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
            //$LASTPOS=85009571;//kernel.MapEditor:9571
            _this.mode="set";
            //$LASTPOS=85009592;//kernel.MapEditor:9592
            Tonyu.globals.$mp.scrollTo(1000,1000);
            //$LASTPOS=85009658;//kernel.MapEditor:9658
            _this.fiber$drawLetter(_thread, _this.mode);
            __pc=43;return;
          case 43:
            
            //$LASTPOS=85009685;//kernel.MapEditor:9685
            _this.fiber$updateEx(_thread, 10);
            __pc=44;return;
          case 44:
            
            __pc=51    ;break;
          case 45    :
            //$LASTPOS=85009710;//kernel.MapEditor:9710
            if (!(_this.mode=="setOn"&&_this.getkey(1)>0&&_this.inRect())) { __pc=46    ; break; }
            {
              //$LASTPOS=85009765;//kernel.MapEditor:9765
              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
              //$LASTPOS=85009810;//kernel.MapEditor:9810
              _this.modified=true;
            }
            __pc=50    ;break;
          case 46    :
            //$LASTPOS=85009836;//kernel.MapEditor:9836
            if (!(_this.mode=="copy"&&_this.getkey(1)>0&&_this.inRect())) { __pc=49    ; break; }
            //$LASTPOS=85009890;//kernel.MapEditor:9890
            if (_this.selectedLayer=="base") {
              //$LASTPOS=85009930;//kernel.MapEditor:9930
              _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
              //$LASTPOS=85009977;//kernel.MapEditor:9977
              _this.maponp=- 1;
              
            } else {
              //$LASTPOS=85010003;//kernel.MapEditor:10003
              if (_this.selectedLayer=="on") {
                //$LASTPOS=85010041;//kernel.MapEditor:10041
                _this.mapp=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                
              } else {
                //$LASTPOS=85010106;//kernel.MapEditor:10106
                _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                //$LASTPOS=85010153;//kernel.MapEditor:10153
                _this.maponp=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                
              }
            }
            //$LASTPOS=85010258;//kernel.MapEditor:10258
            _this.mode="set";
            //$LASTPOS=85010311;//kernel.MapEditor:10311
            _this.fiber$drawLetter(_thread, _this.mode);
            __pc=47;return;
          case 47:
            
            //$LASTPOS=85010338;//kernel.MapEditor:10338
            _this.fiber$updateEx(_thread, 10);
            __pc=48;return;
          case 48:
            
          case 49    :
            
          case 50    :
            
          case 51    :
            
          case 52    :
            
          case 53    :
            
            //$LASTPOS=85010364;//kernel.MapEditor:10364
            _this.fiber$update(_thread);
            __pc=54;return;
          case 54:
            
            __pc=22;break;
          case 55    :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    getCurFileName :function _trc_MapEditor_getCurFileName() {
      "use strict";
      var _this=this;
      
      return _this.saveFileName||_this.loadedFile;
    },
    fiber$getCurFileName :function _trc_MapEditor_f_getCurFileName(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.saveFileName||_this.loadedFile;return;
      
      
      _thread.retVal=_this;return;
    },
    st :function _trc_MapEditor_st(e) {
      "use strict";
      var _this=this;
      var curFileName;
      var r;
      
      //$LASTPOS=85000337;//kernel.MapEditor:337
      curFileName = _this.getCurFileName()||"map.json";
      
      //$LASTPOS=85000388;//kernel.MapEditor:388
      r = _this.confirm("Save "+curFileName+"?");
      
      //$LASTPOS=85000433;//kernel.MapEditor:433
      if (r) {
        //$LASTPOS=85000451;//kernel.MapEditor:451
        _this.save(curFileName);
        //$LASTPOS=85000479;//kernel.MapEditor:479
        _this.update();
        //$LASTPOS=85000498;//kernel.MapEditor:498
        e.die();
        
      } else {
        //$LASTPOS=85000530;//kernel.MapEditor:530
        r=_this.confirm("Discard changes?");
        //$LASTPOS=85000570;//kernel.MapEditor:570
        if (r) {
          //$LASTPOS=85000592;//kernel.MapEditor:592
          _this.update();
          //$LASTPOS=85000615;//kernel.MapEditor:615
          e.die();
          
        }
        
      }
    },
    fiber$st :function _trc_MapEditor_f_st(_thread,e) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var curFileName;
      var r;
      
      //$LASTPOS=85000337;//kernel.MapEditor:337
      curFileName = _this.getCurFileName()||"map.json";
      
      
      _thread.enter(function _trc_MapEditor_ent_st(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=85000388;//kernel.MapEditor:388
            _this.fiber$confirm(_thread, "Save "+curFileName+"?");
            __pc=1;return;
          case 1:
            r=_thread.retVal;
            
            //$LASTPOS=85000433;//kernel.MapEditor:433
            if (!(r)) { __pc=4     ; break; }
            //$LASTPOS=85000451;//kernel.MapEditor:451
            _this.fiber$save(_thread, curFileName);
            __pc=2;return;
          case 2:
            
            //$LASTPOS=85000479;//kernel.MapEditor:479
            _this.fiber$update(_thread);
            __pc=3;return;
          case 3:
            
            //$LASTPOS=85000498;//kernel.MapEditor:498
            e.die();
            __pc=8     ;break;
          case 4     :
            //$LASTPOS=85000530;//kernel.MapEditor:530
            _this.fiber$confirm(_thread, "Discard changes?");
            __pc=5;return;
          case 5:
            r=_thread.retVal;
            
            //$LASTPOS=85000570;//kernel.MapEditor:570
            if (!(r)) { __pc=7     ; break; }
            //$LASTPOS=85000592;//kernel.MapEditor:592
            _this.fiber$update(_thread);
            __pc=6;return;
          case 6:
            
            //$LASTPOS=85000615;//kernel.MapEditor:615
            e.die();
          case 7     :
            
          case 8     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    save :function _trc_MapEditor_save(fileName) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=85010401;//kernel.MapEditor:10401
      _this.saveDataFile=_this.file("../maps/").rel(fileName);
      //$LASTPOS=85010451;//kernel.MapEditor:10451
      _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable,Tonyu.globals.$map.chipWidth,Tonyu.globals.$map.chipHeight];
      //$LASTPOS=85010525;//kernel.MapEditor:10525
      _this.saveDataFile.obj(_this.data);
      //$LASTPOS=85010554;//kernel.MapEditor:10554
      _this.modified=false;
      //$LASTPOS=85010575;//kernel.MapEditor:10575
      _this.print(fileName+" Saved");
    },
    fiber$save :function _trc_MapEditor_f_save(_thread,fileName) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=85010401;//kernel.MapEditor:10401
      _this.saveDataFile=_this.file("../maps/").rel(fileName);
      //$LASTPOS=85010451;//kernel.MapEditor:10451
      _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable,Tonyu.globals.$map.chipWidth,Tonyu.globals.$map.chipHeight];
      //$LASTPOS=85010525;//kernel.MapEditor:10525
      _this.saveDataFile.obj(_this.data);
      //$LASTPOS=85010554;//kernel.MapEditor:10554
      _this.modified=false;
      //$LASTPOS=85010575;//kernel.MapEditor:10575
      _this.print(fileName+" Saved");
      
      _thread.retVal=_this;return;
    },
    inRect :function _trc_MapEditor_inRect() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$mouseX>40&&Tonyu.globals.$mouseX<Tonyu.globals.$screenWidth-40&&Tonyu.globals.$mouseY>40&&Tonyu.globals.$mouseY<Tonyu.globals.$screenHeight-200;
    },
    fiber$inRect :function _trc_MapEditor_f_inRect(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$mouseX>40&&Tonyu.globals.$mouseX<Tonyu.globals.$screenWidth-40&&Tonyu.globals.$mouseY>40&&Tonyu.globals.$mouseY<Tonyu.globals.$screenHeight-200;return;
      
      
      _thread.retVal=_this;return;
    },
    drawPanel :function _trc_MapEditor_drawPanel() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=85010762;//kernel.MapEditor:10762
      Tonyu.globals.$panel.setFillStyle("gray");
      //$LASTPOS=85010796;//kernel.MapEditor:10796
      Tonyu.globals.$panel.alpha=128;
      //$LASTPOS=85010819;//kernel.MapEditor:10819
      Tonyu.globals.$panel.fillRect(0,0,Tonyu.globals.$screenWidth,40);
      //$LASTPOS=85010862;//kernel.MapEditor:10862
      Tonyu.globals.$panel.fillRect(0,0,40,Tonyu.globals.$screenHeight-160);
      //$LASTPOS=85010910;//kernel.MapEditor:10910
      Tonyu.globals.$panel.fillRect(Tonyu.globals.$screenWidth-40,0,40,Tonyu.globals.$screenHeight-160);
      //$LASTPOS=85010972;//kernel.MapEditor:10972
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-200,Tonyu.globals.$screenWidth,40);
      //$LASTPOS=85011031;//kernel.MapEditor:11031
      Tonyu.globals.$panel.alpha=255;
      //$LASTPOS=85011054;//kernel.MapEditor:11054
      Tonyu.globals.$panel.setFillStyle("black");
      //$LASTPOS=85011108;//kernel.MapEditor:11108
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=85011158;//kernel.MapEditor:11158
      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=85011210;//kernel.MapEditor:11210
      Tonyu.globals.$panel.fillRect(240,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=85011262;//kernel.MapEditor:11262
      Tonyu.globals.$panel.fillRect(360,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=85011314;//kernel.MapEditor:11314
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-80,120,80);
      //$LASTPOS=85011363;//kernel.MapEditor:11363
      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-80,120,80);
      //$LASTPOS=85011414;//kernel.MapEditor:11414
      Tonyu.globals.$panel.setFillStyle("white");
      //$LASTPOS=85011449;//kernel.MapEditor:11449
      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=85011500;//kernel.MapEditor:11500
      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=85011552;//kernel.MapEditor:11552
      Tonyu.globals.$panel.fillRect(250,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=85011604;//kernel.MapEditor:11604
      Tonyu.globals.$panel.fillRect(370,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=85011656;//kernel.MapEditor:11656
      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-70,100,60);
      //$LASTPOS=85011706;//kernel.MapEditor:11706
      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-70,100,60);
      //$LASTPOS=85011757;//kernel.MapEditor:11757
      Tonyu.globals.$panel.setFillStyle("black");
      //$LASTPOS=85011803;//kernel.MapEditor:11803
      Tonyu.globals.$panel.fillText("↑",Tonyu.globals.$screenWidth/2,30,40,"center");
      //$LASTPOS=85011860;//kernel.MapEditor:11860
      Tonyu.globals.$panel.fillText("←",20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
      //$LASTPOS=85011924;//kernel.MapEditor:11924
      Tonyu.globals.$panel.fillText("↓",Tonyu.globals.$screenWidth/2,Tonyu.globals.$screenHeight-160-10,40,"center");
      //$LASTPOS=85011999;//kernel.MapEditor:11999
      Tonyu.globals.$panel.fillText("→",Tonyu.globals.$screenWidth-20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
      //$LASTPOS=85012104;//kernel.MapEditor:12104
      Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=85012181;//kernel.MapEditor:12181
      Tonyu.globals.$panel.fillText(_this.selectedLayer,Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
      //$LASTPOS=85012266;//kernel.MapEditor:12266
      Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=85012343;//kernel.MapEditor:12343
      Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=85012419;//kernel.MapEditor:12419
      Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
      //$LASTPOS=85012497;//kernel.MapEditor:12497
      Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
    },
    fiber$drawPanel :function _trc_MapEditor_f_drawPanel(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=85010762;//kernel.MapEditor:10762
      Tonyu.globals.$panel.setFillStyle("gray");
      //$LASTPOS=85010796;//kernel.MapEditor:10796
      Tonyu.globals.$panel.alpha=128;
      //$LASTPOS=85010819;//kernel.MapEditor:10819
      Tonyu.globals.$panel.fillRect(0,0,Tonyu.globals.$screenWidth,40);
      //$LASTPOS=85010862;//kernel.MapEditor:10862
      Tonyu.globals.$panel.fillRect(0,0,40,Tonyu.globals.$screenHeight-160);
      //$LASTPOS=85010910;//kernel.MapEditor:10910
      Tonyu.globals.$panel.fillRect(Tonyu.globals.$screenWidth-40,0,40,Tonyu.globals.$screenHeight-160);
      //$LASTPOS=85010972;//kernel.MapEditor:10972
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-200,Tonyu.globals.$screenWidth,40);
      //$LASTPOS=85011031;//kernel.MapEditor:11031
      Tonyu.globals.$panel.alpha=255;
      //$LASTPOS=85011054;//kernel.MapEditor:11054
      Tonyu.globals.$panel.setFillStyle("black");
      //$LASTPOS=85011108;//kernel.MapEditor:11108
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=85011158;//kernel.MapEditor:11158
      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=85011210;//kernel.MapEditor:11210
      Tonyu.globals.$panel.fillRect(240,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=85011262;//kernel.MapEditor:11262
      Tonyu.globals.$panel.fillRect(360,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=85011314;//kernel.MapEditor:11314
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-80,120,80);
      //$LASTPOS=85011363;//kernel.MapEditor:11363
      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-80,120,80);
      //$LASTPOS=85011414;//kernel.MapEditor:11414
      Tonyu.globals.$panel.setFillStyle("white");
      //$LASTPOS=85011449;//kernel.MapEditor:11449
      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=85011500;//kernel.MapEditor:11500
      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=85011552;//kernel.MapEditor:11552
      Tonyu.globals.$panel.fillRect(250,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=85011604;//kernel.MapEditor:11604
      Tonyu.globals.$panel.fillRect(370,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=85011656;//kernel.MapEditor:11656
      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-70,100,60);
      //$LASTPOS=85011706;//kernel.MapEditor:11706
      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-70,100,60);
      //$LASTPOS=85011757;//kernel.MapEditor:11757
      Tonyu.globals.$panel.setFillStyle("black");
      //$LASTPOS=85011803;//kernel.MapEditor:11803
      Tonyu.globals.$panel.fillText("↑",Tonyu.globals.$screenWidth/2,30,40,"center");
      //$LASTPOS=85011860;//kernel.MapEditor:11860
      Tonyu.globals.$panel.fillText("←",20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
      //$LASTPOS=85011924;//kernel.MapEditor:11924
      Tonyu.globals.$panel.fillText("↓",Tonyu.globals.$screenWidth/2,Tonyu.globals.$screenHeight-160-10,40,"center");
      //$LASTPOS=85011999;//kernel.MapEditor:11999
      Tonyu.globals.$panel.fillText("→",Tonyu.globals.$screenWidth-20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
      //$LASTPOS=85012104;//kernel.MapEditor:12104
      Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=85012181;//kernel.MapEditor:12181
      Tonyu.globals.$panel.fillText(_this.selectedLayer,Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
      //$LASTPOS=85012266;//kernel.MapEditor:12266
      Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=85012343;//kernel.MapEditor:12343
      Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=85012419;//kernel.MapEditor:12419
      Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
      //$LASTPOS=85012497;//kernel.MapEditor:12497
      Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
      
      _thread.retVal=_this;return;
    },
    drawLetter :function _trc_MapEditor_drawLetter(mode) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=85012605;//kernel.MapEditor:12605
      if (mode=="set") {
        //$LASTPOS=85012621;//kernel.MapEditor:12621
        Tonyu.globals.$panel.setFillStyle("red");
      } else {
        //$LASTPOS=85012659;//kernel.MapEditor:12659
        Tonyu.globals.$panel.setFillStyle("black");
      }
      //$LASTPOS=85012694;//kernel.MapEditor:12694
      Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=85012771;//kernel.MapEditor:12771
      if (mode=="get") {
        //$LASTPOS=85012787;//kernel.MapEditor:12787
        Tonyu.globals.$panel.setFillStyle("red");
      } else {
        //$LASTPOS=85012825;//kernel.MapEditor:12825
        Tonyu.globals.$panel.setFillStyle("black");
      }
      //$LASTPOS=85012860;//kernel.MapEditor:12860
      Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=85012937;//kernel.MapEditor:12937
      if (mode=="erase") {
        //$LASTPOS=85012955;//kernel.MapEditor:12955
        Tonyu.globals.$panel.setFillStyle("red");
      } else {
        //$LASTPOS=85012993;//kernel.MapEditor:12993
        Tonyu.globals.$panel.setFillStyle("black");
      }
      //$LASTPOS=85013028;//kernel.MapEditor:13028
      Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
      //$LASTPOS=85013106;//kernel.MapEditor:13106
      if (mode=="copy") {
        //$LASTPOS=85013123;//kernel.MapEditor:13123
        Tonyu.globals.$panel.setFillStyle("red");
      } else {
        //$LASTPOS=85013161;//kernel.MapEditor:13161
        Tonyu.globals.$panel.setFillStyle("black");
      }
      //$LASTPOS=85013196;//kernel.MapEditor:13196
      Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
      //$LASTPOS=85013273;//kernel.MapEditor:13273
      Tonyu.globals.$panel.setFillStyle("black");
      //$LASTPOS=85013308;//kernel.MapEditor:13308
      Tonyu.globals.$panel.fillText(_this.selectedLayer,Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
      //$LASTPOS=85013393;//kernel.MapEditor:13393
      Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
    },
    fiber$drawLetter :function _trc_MapEditor_f_drawLetter(_thread,mode) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=85012605;//kernel.MapEditor:12605
      if (mode=="set") {
        //$LASTPOS=85012621;//kernel.MapEditor:12621
        Tonyu.globals.$panel.setFillStyle("red");
      } else {
        //$LASTPOS=85012659;//kernel.MapEditor:12659
        Tonyu.globals.$panel.setFillStyle("black");
      }
      //$LASTPOS=85012694;//kernel.MapEditor:12694
      Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=85012771;//kernel.MapEditor:12771
      if (mode=="get") {
        //$LASTPOS=85012787;//kernel.MapEditor:12787
        Tonyu.globals.$panel.setFillStyle("red");
      } else {
        //$LASTPOS=85012825;//kernel.MapEditor:12825
        Tonyu.globals.$panel.setFillStyle("black");
      }
      //$LASTPOS=85012860;//kernel.MapEditor:12860
      Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=85012937;//kernel.MapEditor:12937
      if (mode=="erase") {
        //$LASTPOS=85012955;//kernel.MapEditor:12955
        Tonyu.globals.$panel.setFillStyle("red");
      } else {
        //$LASTPOS=85012993;//kernel.MapEditor:12993
        Tonyu.globals.$panel.setFillStyle("black");
      }
      //$LASTPOS=85013028;//kernel.MapEditor:13028
      Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
      //$LASTPOS=85013106;//kernel.MapEditor:13106
      if (mode=="copy") {
        //$LASTPOS=85013123;//kernel.MapEditor:13123
        Tonyu.globals.$panel.setFillStyle("red");
      } else {
        //$LASTPOS=85013161;//kernel.MapEditor:13161
        Tonyu.globals.$panel.setFillStyle("black");
      }
      //$LASTPOS=85013196;//kernel.MapEditor:13196
      Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
      //$LASTPOS=85013273;//kernel.MapEditor:13273
      Tonyu.globals.$panel.setFillStyle("black");
      //$LASTPOS=85013308;//kernel.MapEditor:13308
      Tonyu.globals.$panel.fillText(_this.selectedLayer,Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
      //$LASTPOS=85013393;//kernel.MapEditor:13393
      Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"getCurFileName":{"nowait":false},"st":{"nowait":false},"save":{"nowait":false},"inRect":{"nowait":false},"drawPanel":{"nowait":false},"drawLetter":{"nowait":false}},"fields":{"i":{},"j":{},"loadMode":{},"fileExist":{},"modified":{},"fileList":{},"fileName":{},"mapDataFile":{},"baseData":{},"loadedFile":{},"mapData":{},"mapOnData":{},"chipWidth":{},"chipHeight":{},"row":{},"col":{},"panel":{},"mIW":{},"mIH":{},"mCW":{},"mCH":{},"counter":{},"mode":{},"prevMode":{},"mapp":{},"maponp":{},"mx":{},"my":{},"chipX":{},"chipY":{},"initialWidth":{},"initialHeight":{},"layers":{},"lc":{},"selectedLayer":{},"saveFileName":{},"tmpon":{},"saveDataFile":{},"data":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MapEditorOLD',
  shortName: 'MapEditorOLD',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_MapEditorOLD_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=86000032;//kernel.MapEditorOLD:32
      _this.loadMode=false;
      //$LASTPOS=86000049;//kernel.MapEditorOLD:49
      _this.print("Load Data?: Y or N");
      //$LASTPOS=86000079;//kernel.MapEditorOLD:79
      while (true) {
        //$LASTPOS=86000097;//kernel.MapEditorOLD:97
        if (_this.getkey("y")>0) {
          //$LASTPOS=86000125;//kernel.MapEditorOLD:125
          _this.loadMode=true;
          break;
          
          
        }
        //$LASTPOS=86000168;//kernel.MapEditorOLD:168
        if (_this.getkey("n")>0) {
          //$LASTPOS=86000196;//kernel.MapEditorOLD:196
          _this.loadMode=false;
          break;
          
          
        }
        //$LASTPOS=86000240;//kernel.MapEditorOLD:240
        _this.update();
        
      }
      //$LASTPOS=86000254;//kernel.MapEditorOLD:254
      if (_this.loadMode) {
        //$LASTPOS=86000273;//kernel.MapEditorOLD:273
        _this.fileName=prompt("Input json file (*.json)","map.json");
        //$LASTPOS=86000334;//kernel.MapEditorOLD:334
        if (_this.fileName) {
          //$LASTPOS=86000357;//kernel.MapEditorOLD:357
          _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
          
        }
        //$LASTPOS=86000413;//kernel.MapEditorOLD:413
        if (_this.mapDataFile.obj()) {
          //$LASTPOS=86000445;//kernel.MapEditorOLD:445
          _this.baseData=_this.mapDataFile.obj();
          
        } else {
          //$LASTPOS=86000494;//kernel.MapEditorOLD:494
          _this.mapDataFile=_this.file(_this.fileName);
          //$LASTPOS=86000531;//kernel.MapEditorOLD:531
          if (_this.mapDataFile.obj()) {
            //$LASTPOS=86000567;//kernel.MapEditorOLD:567
            _this.baseData=_this.mapDataFile.obj();
            
          }
          
        }
        //$LASTPOS=86000618;//kernel.MapEditorOLD:618
        if (_this.baseData==undefined) {
          //$LASTPOS=86000652;//kernel.MapEditorOLD:652
          _this.print("Load failed");
          //$LASTPOS=86000683;//kernel.MapEditorOLD:683
          _this.loadMode=false;
          
        } else {
          //$LASTPOS=86000710;//kernel.MapEditorOLD:710
          if (_this.baseData[0]&&_this.baseData[1]) {
            //$LASTPOS=86000751;//kernel.MapEditorOLD:751
            _this.mapData=_this.baseData[0];
            //$LASTPOS=86000781;//kernel.MapEditorOLD:781
            _this.mapOnData=_this.baseData[1];
            
          }
        }
        
      }
      //$LASTPOS=86000815;//kernel.MapEditorOLD:815
      _this.update();
      //$LASTPOS=86001093;//kernel.MapEditorOLD:1093
      if (! _this.loadMode) {
        //$LASTPOS=86001113;//kernel.MapEditorOLD:1113
        _this.row=prompt("input row");
        //$LASTPOS=86001143;//kernel.MapEditorOLD:1143
        _this.update();
        //$LASTPOS=86001158;//kernel.MapEditorOLD:1158
        _this.col=prompt("input col");
        //$LASTPOS=86001188;//kernel.MapEditorOLD:1188
        _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});
        //$LASTPOS=86001238;//kernel.MapEditorOLD:1238
        _this.panel.x=_this.panel.width/2+10;
        //$LASTPOS=86001269;//kernel.MapEditorOLD:1269
        _this.panel.y=_this.panel.height/2;
        //$LASTPOS=86001298;//kernel.MapEditorOLD:1298
        _this.panel.setFillStyle("cyan");
        //$LASTPOS=86001331;//kernel.MapEditorOLD:1331
        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
        //$LASTPOS=86001382;//kernel.MapEditorOLD:1382
        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});
        
      } else {
        //$LASTPOS=86001445;//kernel.MapEditorOLD:1445
        if (! _this.mapOnData) {
          //$LASTPOS=86001470;//kernel.MapEditorOLD:1470
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});
          
        } else {
          //$LASTPOS=86001582;//kernel.MapEditorOLD:1582
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});
          
        }
        //$LASTPOS=86001695;//kernel.MapEditorOLD:1695
        _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});
        //$LASTPOS=86001766;//kernel.MapEditorOLD:1766
        _this.panel.x=_this.panel.width/2;
        //$LASTPOS=86001794;//kernel.MapEditorOLD:1794
        _this.panel.y=_this.panel.height/2;
        //$LASTPOS=86001823;//kernel.MapEditorOLD:1823
        _this.panel.setFillStyle("cyan");
        //$LASTPOS=86001856;//kernel.MapEditorOLD:1856
        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
        
      }
      //$LASTPOS=86001906;//kernel.MapEditorOLD:1906
      Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});
      //$LASTPOS=86001961;//kernel.MapEditorOLD:1961
      _this.counter=0;
      //$LASTPOS=86001973;//kernel.MapEditorOLD:1973
      //$LASTPOS=86001977;//kernel.MapEditorOLD:1977
      _this.i = 0;
      for (; _this.i<16 ; _this.i++) {
        {
          //$LASTPOS=86002001;//kernel.MapEditorOLD:2001
          //$LASTPOS=86002005;//kernel.MapEditorOLD:2005
          _this.j = 0;
          for (; _this.j<8 ; _this.j++) {
            {
              //$LASTPOS=86002032;//kernel.MapEditorOLD:2032
              Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
              //$LASTPOS=86002076;//kernel.MapEditorOLD:2076
              _this.counter++;
            }
          }
        }
      }
      //$LASTPOS=86002098;//kernel.MapEditorOLD:2098
      _this.mode="get";
      //$LASTPOS=86002111;//kernel.MapEditorOLD:2111
      _this.prevMode="set";
      //$LASTPOS=86002128;//kernel.MapEditorOLD:2128
      _this.mapp=0;
      //$LASTPOS=86002137;//kernel.MapEditorOLD:2137
      _this.mx=0;
      //$LASTPOS=86002144;//kernel.MapEditorOLD:2144
      _this.my=0;
      //$LASTPOS=86002151;//kernel.MapEditorOLD:2151
      _this.chipX=0;
      //$LASTPOS=86002161;//kernel.MapEditorOLD:2161
      _this.chipY=0;
      //$LASTPOS=86002171;//kernel.MapEditorOLD:2171
      _this.x=Tonyu.globals.$screenWidth-16;
      //$LASTPOS=86002191;//kernel.MapEditorOLD:2191
      _this.y=Tonyu.globals.$screenHeight-16;
      //$LASTPOS=86002212;//kernel.MapEditorOLD:2212
      while (true) {
        //$LASTPOS=86002230;//kernel.MapEditorOLD:2230
        _this.p=_this.mapp;
        //$LASTPOS=86002243;//kernel.MapEditorOLD:2243
        if (_this.getkey("e")==1) {
          //$LASTPOS=86002272;//kernel.MapEditorOLD:2272
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=86002306;//kernel.MapEditorOLD:2306
          _this.mode="erase";
          //$LASTPOS=86002329;//kernel.MapEditorOLD:2329
          _this.print(_this.mode+" mode");
          
        }
        //$LASTPOS=86002362;//kernel.MapEditorOLD:2362
        if (_this.getkey("s")==1) {
          //$LASTPOS=86002391;//kernel.MapEditorOLD:2391
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=86002425;//kernel.MapEditorOLD:2425
          if (_this.mode=="set") {
            //$LASTPOS=86002455;//kernel.MapEditorOLD:2455
            _this.mode="setOn";
            
          } else {
            //$LASTPOS=86002498;//kernel.MapEditorOLD:2498
            _this.mode="set";
            
          }
          //$LASTPOS=86002530;//kernel.MapEditorOLD:2530
          _this.print(_this.mode+" mode");
          
        }
        //$LASTPOS=86002563;//kernel.MapEditorOLD:2563
        if (_this.getkey("o")==1) {
          //$LASTPOS=86002592;//kernel.MapEditorOLD:2592
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=86002626;//kernel.MapEditorOLD:2626
          _this.mode="setOn";
          
        }
        //$LASTPOS=86002652;//kernel.MapEditorOLD:2652
        if (_this.getkey("g")==1) {
          //$LASTPOS=86002681;//kernel.MapEditorOLD:2681
          if (_this.mode!="get") {
            //$LASTPOS=86002711;//kernel.MapEditorOLD:2711
            _this.prevMode=_this.mode;
            //$LASTPOS=86002739;//kernel.MapEditorOLD:2739
            Tonyu.globals.$mp.scrollTo(0,0);
            //$LASTPOS=86002771;//kernel.MapEditorOLD:2771
            _this.mode="get";
            //$LASTPOS=86002796;//kernel.MapEditorOLD:2796
            _this.chipX=0;
            //$LASTPOS=86002818;//kernel.MapEditorOLD:2818
            _this.chipY=0;
            
          } else {
            //$LASTPOS=86002856;//kernel.MapEditorOLD:2856
            Tonyu.globals.$mp.scrollTo(1000,1000);
            //$LASTPOS=86002894;//kernel.MapEditorOLD:2894
            _this.mode=_this.prevMode;
            
          }
          //$LASTPOS=86002929;//kernel.MapEditorOLD:2929
          _this.print(_this.mode+" mode");
          
        }
        //$LASTPOS=86002962;//kernel.MapEditorOLD:2962
        if (_this.getkey("p")==1) {
          //$LASTPOS=86003006;//kernel.MapEditorOLD:3006
          _this.saveFileName=prompt("input json file(*.json)","map.json");
          //$LASTPOS=86003495;//kernel.MapEditorOLD:3495
          _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);
          //$LASTPOS=86003553;//kernel.MapEditorOLD:3553
          _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];
          //$LASTPOS=86003668;//kernel.MapEditorOLD:3668
          _this.saveDataFile.obj(_this.data);
          //$LASTPOS=86003701;//kernel.MapEditorOLD:3701
          _this.print(_this.saveFileName+" Saved");
          
        }
        //$LASTPOS=86003793;//kernel.MapEditorOLD:3793
        if (_this.getkey("c")==1) {
          //$LASTPOS=86003822;//kernel.MapEditorOLD:3822
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=86003856;//kernel.MapEditorOLD:3856
          _this.mode="spuit";
          //$LASTPOS=86003879;//kernel.MapEditorOLD:3879
          _this.print(_this.mode+" mode");
          
        }
        //$LASTPOS=86003912;//kernel.MapEditorOLD:3912
        if (_this.mode!="get") {
          //$LASTPOS=86003938;//kernel.MapEditorOLD:3938
          if (_this.getkey("left")>0) {
            //$LASTPOS=86003959;//kernel.MapEditorOLD:3959
            _this.mx=_this.mx+8;
          }
          //$LASTPOS=86003977;//kernel.MapEditorOLD:3977
          if (_this.getkey("right")>0) {
            //$LASTPOS=86003999;//kernel.MapEditorOLD:3999
            _this.mx=_this.mx-8;
          }
          //$LASTPOS=86004017;//kernel.MapEditorOLD:4017
          if (_this.getkey("up")>0) {
            //$LASTPOS=86004036;//kernel.MapEditorOLD:4036
            _this.my=_this.my+8;
          }
          //$LASTPOS=86004054;//kernel.MapEditorOLD:4054
          if (_this.getkey("down")>0) {
            //$LASTPOS=86004075;//kernel.MapEditorOLD:4075
            _this.my=_this.my-8;
          }
          //$LASTPOS=86004093;//kernel.MapEditorOLD:4093
          Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
          
        } else {
          //$LASTPOS=86004136;//kernel.MapEditorOLD:4136
          if (_this.getkey("left")>0) {
            //$LASTPOS=86004157;//kernel.MapEditorOLD:4157
            _this.chipX=_this.chipX+8;
          }
          //$LASTPOS=86004181;//kernel.MapEditorOLD:4181
          if (_this.getkey("right")>0) {
            //$LASTPOS=86004203;//kernel.MapEditorOLD:4203
            _this.chipX=_this.chipX-8;
          }
          //$LASTPOS=86004227;//kernel.MapEditorOLD:4227
          if (_this.getkey("up")>0) {
            //$LASTPOS=86004246;//kernel.MapEditorOLD:4246
            _this.chipY=_this.chipY+8;
          }
          //$LASTPOS=86004270;//kernel.MapEditorOLD:4270
          if (_this.getkey("down")>0) {
            //$LASTPOS=86004291;//kernel.MapEditorOLD:4291
            _this.chipY=_this.chipY-8;
          }
          //$LASTPOS=86004315;//kernel.MapEditorOLD:4315
          Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
          
        }
        //$LASTPOS=86004354;//kernel.MapEditorOLD:4354
        _this.panel.x=_this.panel.width/2-_this.mx;
        //$LASTPOS=86004385;//kernel.MapEditorOLD:4385
        _this.panel.y=_this.panel.height/2-_this.my;
        //$LASTPOS=86004417;//kernel.MapEditorOLD:4417
        if (_this.mode=="set"&&_this.getkey(1)>0) {
          //$LASTPOS=86004458;//kernel.MapEditorOLD:4458
          Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
          //$LASTPOS=86004507;//kernel.MapEditorOLD:4507
          Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
          
        } else {
          //$LASTPOS=86004558;//kernel.MapEditorOLD:4558
          if (_this.mode=="erase"&&_this.getkey(1)>0) {
            //$LASTPOS=86004601;//kernel.MapEditorOLD:4601
            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
            
          } else {
            //$LASTPOS=86004650;//kernel.MapEditorOLD:4650
            if (_this.mode=="get"&&_this.getkey(1)>0) {
              //$LASTPOS=86004691;//kernel.MapEditorOLD:4691
              _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);
              //$LASTPOS=86004745;//kernel.MapEditorOLD:4745
              _this.mode=_this.prevMode;
              //$LASTPOS=86004769;//kernel.MapEditorOLD:4769
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=86004803;//kernel.MapEditorOLD:4803
              _this.print(_this.mode+" mode");
              //$LASTPOS=86004833;//kernel.MapEditorOLD:4833
              _this.updateEx(10);
              
            } else {
              //$LASTPOS=86004858;//kernel.MapEditorOLD:4858
              if (_this.mode=="setOn"&&_this.getkey(1)>0) {
                //$LASTPOS=86004901;//kernel.MapEditorOLD:4901
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
                
              } else {
                //$LASTPOS=86004954;//kernel.MapEditorOLD:4954
                if (_this.mode=="spuit"&&_this.getkey(1)>0) {
                  //$LASTPOS=86004997;//kernel.MapEditorOLD:4997
                  _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);
                  //$LASTPOS=86005046;//kernel.MapEditorOLD:5046
                  _this.mode="set";
                  //$LASTPOS=86005067;//kernel.MapEditorOLD:5067
                  _this.print(_this.mode+" mode");
                  //$LASTPOS=86005097;//kernel.MapEditorOLD:5097
                  _this.updateEx(10);
                  
                }
              }
            }
          }
        }
        //$LASTPOS=86005123;//kernel.MapEditorOLD:5123
        _this.update();
        
      }
    },
    fiber$main :function _trc_MapEditorOLD_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=86000032;//kernel.MapEditorOLD:32
      _this.loadMode=false;
      //$LASTPOS=86000049;//kernel.MapEditorOLD:49
      _this.print("Load Data?: Y or N");
      
      _thread.enter(function _trc_MapEditorOLD_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=86000079;//kernel.MapEditorOLD:79
          case 1:
            //$LASTPOS=86000097;//kernel.MapEditorOLD:97
            if (!(_this.getkey("y")>0)) { __pc=2     ; break; }
            //$LASTPOS=86000125;//kernel.MapEditorOLD:125
            _this.loadMode=true;
            __pc=5     ; break;
            
          case 2     :
            
            //$LASTPOS=86000168;//kernel.MapEditorOLD:168
            if (!(_this.getkey("n")>0)) { __pc=3     ; break; }
            //$LASTPOS=86000196;//kernel.MapEditorOLD:196
            _this.loadMode=false;
            __pc=5     ; break;
            
          case 3     :
            
            //$LASTPOS=86000240;//kernel.MapEditorOLD:240
            _this.fiber$update(_thread);
            __pc=4;return;
          case 4:
            
            __pc=1;break;
          case 5     :
            
            //$LASTPOS=86000254;//kernel.MapEditorOLD:254
            if (!(_this.loadMode)) { __pc=9     ; break; }
            //$LASTPOS=86000273;//kernel.MapEditorOLD:273
            _this.fileName=prompt("Input json file (*.json)","map.json");
            //$LASTPOS=86000334;//kernel.MapEditorOLD:334
            if (_this.fileName) {
              //$LASTPOS=86000357;//kernel.MapEditorOLD:357
              _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
              
            }
            //$LASTPOS=86000413;//kernel.MapEditorOLD:413
            if (!(_this.mapDataFile.obj())) { __pc=6     ; break; }
            {
              //$LASTPOS=86000445;//kernel.MapEditorOLD:445
              _this.baseData=_this.mapDataFile.obj();
            }
            __pc=8     ;break;
          case 6     :
            //$LASTPOS=86000494;//kernel.MapEditorOLD:494
            _this.fiber$file(_thread, _this.fileName);
            __pc=7;return;
          case 7:
            _this.mapDataFile=_thread.retVal;
            
            //$LASTPOS=86000531;//kernel.MapEditorOLD:531
            if (_this.mapDataFile.obj()) {
              //$LASTPOS=86000567;//kernel.MapEditorOLD:567
              _this.baseData=_this.mapDataFile.obj();
              
            }
          case 8     :
            
            //$LASTPOS=86000618;//kernel.MapEditorOLD:618
            if (_this.baseData==undefined) {
              //$LASTPOS=86000652;//kernel.MapEditorOLD:652
              _this.print("Load failed");
              //$LASTPOS=86000683;//kernel.MapEditorOLD:683
              _this.loadMode=false;
              
            } else {
              //$LASTPOS=86000710;//kernel.MapEditorOLD:710
              if (_this.baseData[0]&&_this.baseData[1]) {
                //$LASTPOS=86000751;//kernel.MapEditorOLD:751
                _this.mapData=_this.baseData[0];
                //$LASTPOS=86000781;//kernel.MapEditorOLD:781
                _this.mapOnData=_this.baseData[1];
                
              }
            }
          case 9     :
            
            //$LASTPOS=86000815;//kernel.MapEditorOLD:815
            _this.fiber$update(_thread);
            __pc=10;return;
          case 10:
            
            //$LASTPOS=86001093;//kernel.MapEditorOLD:1093
            if (!(! _this.loadMode)) { __pc=12    ; break; }
            //$LASTPOS=86001113;//kernel.MapEditorOLD:1113
            _this.row=prompt("input row");
            //$LASTPOS=86001143;//kernel.MapEditorOLD:1143
            _this.fiber$update(_thread);
            __pc=11;return;
          case 11:
            
            //$LASTPOS=86001158;//kernel.MapEditorOLD:1158
            _this.col=prompt("input col");
            //$LASTPOS=86001188;//kernel.MapEditorOLD:1188
            _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});
            //$LASTPOS=86001238;//kernel.MapEditorOLD:1238
            _this.panel.x=_this.panel.width/2+10;
            //$LASTPOS=86001269;//kernel.MapEditorOLD:1269
            _this.panel.y=_this.panel.height/2;
            //$LASTPOS=86001298;//kernel.MapEditorOLD:1298
            _this.panel.setFillStyle("cyan");
            //$LASTPOS=86001331;//kernel.MapEditorOLD:1331
            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            //$LASTPOS=86001382;//kernel.MapEditorOLD:1382
            Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});
            __pc=13    ;break;
          case 12    :
            {
              //$LASTPOS=86001445;//kernel.MapEditorOLD:1445
              if (! _this.mapOnData) {
                //$LASTPOS=86001470;//kernel.MapEditorOLD:1470
                Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});
                
              } else {
                //$LASTPOS=86001582;//kernel.MapEditorOLD:1582
                Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});
                
              }
              //$LASTPOS=86001695;//kernel.MapEditorOLD:1695
              _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});
              //$LASTPOS=86001766;//kernel.MapEditorOLD:1766
              _this.panel.x=_this.panel.width/2;
              //$LASTPOS=86001794;//kernel.MapEditorOLD:1794
              _this.panel.y=_this.panel.height/2;
              //$LASTPOS=86001823;//kernel.MapEditorOLD:1823
              _this.panel.setFillStyle("cyan");
              //$LASTPOS=86001856;//kernel.MapEditorOLD:1856
              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            }
          case 13    :
            
            //$LASTPOS=86001906;//kernel.MapEditorOLD:1906
            Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});
            //$LASTPOS=86001961;//kernel.MapEditorOLD:1961
            _this.counter=0;
            //$LASTPOS=86001973;//kernel.MapEditorOLD:1973
            //$LASTPOS=86001977;//kernel.MapEditorOLD:1977
            _this.i = 0;
            for (; _this.i<16 ; _this.i++) {
              {
                //$LASTPOS=86002001;//kernel.MapEditorOLD:2001
                //$LASTPOS=86002005;//kernel.MapEditorOLD:2005
                _this.j = 0;
                for (; _this.j<8 ; _this.j++) {
                  {
                    //$LASTPOS=86002032;//kernel.MapEditorOLD:2032
                    Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
                    //$LASTPOS=86002076;//kernel.MapEditorOLD:2076
                    _this.counter++;
                  }
                }
              }
            }
            //$LASTPOS=86002098;//kernel.MapEditorOLD:2098
            _this.mode="get";
            //$LASTPOS=86002111;//kernel.MapEditorOLD:2111
            _this.prevMode="set";
            //$LASTPOS=86002128;//kernel.MapEditorOLD:2128
            _this.mapp=0;
            //$LASTPOS=86002137;//kernel.MapEditorOLD:2137
            _this.mx=0;
            //$LASTPOS=86002144;//kernel.MapEditorOLD:2144
            _this.my=0;
            //$LASTPOS=86002151;//kernel.MapEditorOLD:2151
            _this.chipX=0;
            //$LASTPOS=86002161;//kernel.MapEditorOLD:2161
            _this.chipY=0;
            //$LASTPOS=86002171;//kernel.MapEditorOLD:2171
            _this.x=Tonyu.globals.$screenWidth-16;
            //$LASTPOS=86002191;//kernel.MapEditorOLD:2191
            _this.y=Tonyu.globals.$screenHeight-16;
            //$LASTPOS=86002212;//kernel.MapEditorOLD:2212
          case 14:
            //$LASTPOS=86002230;//kernel.MapEditorOLD:2230
            _this.p=_this.mapp;
            //$LASTPOS=86002243;//kernel.MapEditorOLD:2243
            if (_this.getkey("e")==1) {
              //$LASTPOS=86002272;//kernel.MapEditorOLD:2272
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=86002306;//kernel.MapEditorOLD:2306
              _this.mode="erase";
              //$LASTPOS=86002329;//kernel.MapEditorOLD:2329
              _this.print(_this.mode+" mode");
              
            }
            //$LASTPOS=86002362;//kernel.MapEditorOLD:2362
            if (_this.getkey("s")==1) {
              //$LASTPOS=86002391;//kernel.MapEditorOLD:2391
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=86002425;//kernel.MapEditorOLD:2425
              if (_this.mode=="set") {
                //$LASTPOS=86002455;//kernel.MapEditorOLD:2455
                _this.mode="setOn";
                
              } else {
                //$LASTPOS=86002498;//kernel.MapEditorOLD:2498
                _this.mode="set";
                
              }
              //$LASTPOS=86002530;//kernel.MapEditorOLD:2530
              _this.print(_this.mode+" mode");
              
            }
            //$LASTPOS=86002563;//kernel.MapEditorOLD:2563
            if (_this.getkey("o")==1) {
              //$LASTPOS=86002592;//kernel.MapEditorOLD:2592
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=86002626;//kernel.MapEditorOLD:2626
              _this.mode="setOn";
              
            }
            //$LASTPOS=86002652;//kernel.MapEditorOLD:2652
            if (_this.getkey("g")==1) {
              //$LASTPOS=86002681;//kernel.MapEditorOLD:2681
              if (_this.mode!="get") {
                //$LASTPOS=86002711;//kernel.MapEditorOLD:2711
                _this.prevMode=_this.mode;
                //$LASTPOS=86002739;//kernel.MapEditorOLD:2739
                Tonyu.globals.$mp.scrollTo(0,0);
                //$LASTPOS=86002771;//kernel.MapEditorOLD:2771
                _this.mode="get";
                //$LASTPOS=86002796;//kernel.MapEditorOLD:2796
                _this.chipX=0;
                //$LASTPOS=86002818;//kernel.MapEditorOLD:2818
                _this.chipY=0;
                
              } else {
                //$LASTPOS=86002856;//kernel.MapEditorOLD:2856
                Tonyu.globals.$mp.scrollTo(1000,1000);
                //$LASTPOS=86002894;//kernel.MapEditorOLD:2894
                _this.mode=_this.prevMode;
                
              }
              //$LASTPOS=86002929;//kernel.MapEditorOLD:2929
              _this.print(_this.mode+" mode");
              
            }
            //$LASTPOS=86002962;//kernel.MapEditorOLD:2962
            if (_this.getkey("p")==1) {
              //$LASTPOS=86003006;//kernel.MapEditorOLD:3006
              _this.saveFileName=prompt("input json file(*.json)","map.json");
              //$LASTPOS=86003495;//kernel.MapEditorOLD:3495
              _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);
              //$LASTPOS=86003553;//kernel.MapEditorOLD:3553
              _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];
              //$LASTPOS=86003668;//kernel.MapEditorOLD:3668
              _this.saveDataFile.obj(_this.data);
              //$LASTPOS=86003701;//kernel.MapEditorOLD:3701
              _this.print(_this.saveFileName+" Saved");
              
            }
            //$LASTPOS=86003793;//kernel.MapEditorOLD:3793
            if (_this.getkey("c")==1) {
              //$LASTPOS=86003822;//kernel.MapEditorOLD:3822
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=86003856;//kernel.MapEditorOLD:3856
              _this.mode="spuit";
              //$LASTPOS=86003879;//kernel.MapEditorOLD:3879
              _this.print(_this.mode+" mode");
              
            }
            //$LASTPOS=86003912;//kernel.MapEditorOLD:3912
            if (_this.mode!="get") {
              //$LASTPOS=86003938;//kernel.MapEditorOLD:3938
              if (_this.getkey("left")>0) {
                //$LASTPOS=86003959;//kernel.MapEditorOLD:3959
                _this.mx=_this.mx+8;
              }
              //$LASTPOS=86003977;//kernel.MapEditorOLD:3977
              if (_this.getkey("right")>0) {
                //$LASTPOS=86003999;//kernel.MapEditorOLD:3999
                _this.mx=_this.mx-8;
              }
              //$LASTPOS=86004017;//kernel.MapEditorOLD:4017
              if (_this.getkey("up")>0) {
                //$LASTPOS=86004036;//kernel.MapEditorOLD:4036
                _this.my=_this.my+8;
              }
              //$LASTPOS=86004054;//kernel.MapEditorOLD:4054
              if (_this.getkey("down")>0) {
                //$LASTPOS=86004075;//kernel.MapEditorOLD:4075
                _this.my=_this.my-8;
              }
              //$LASTPOS=86004093;//kernel.MapEditorOLD:4093
              Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
              
            } else {
              //$LASTPOS=86004136;//kernel.MapEditorOLD:4136
              if (_this.getkey("left")>0) {
                //$LASTPOS=86004157;//kernel.MapEditorOLD:4157
                _this.chipX=_this.chipX+8;
              }
              //$LASTPOS=86004181;//kernel.MapEditorOLD:4181
              if (_this.getkey("right")>0) {
                //$LASTPOS=86004203;//kernel.MapEditorOLD:4203
                _this.chipX=_this.chipX-8;
              }
              //$LASTPOS=86004227;//kernel.MapEditorOLD:4227
              if (_this.getkey("up")>0) {
                //$LASTPOS=86004246;//kernel.MapEditorOLD:4246
                _this.chipY=_this.chipY+8;
              }
              //$LASTPOS=86004270;//kernel.MapEditorOLD:4270
              if (_this.getkey("down")>0) {
                //$LASTPOS=86004291;//kernel.MapEditorOLD:4291
                _this.chipY=_this.chipY-8;
              }
              //$LASTPOS=86004315;//kernel.MapEditorOLD:4315
              Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
              
            }
            //$LASTPOS=86004354;//kernel.MapEditorOLD:4354
            _this.panel.x=_this.panel.width/2-_this.mx;
            //$LASTPOS=86004385;//kernel.MapEditorOLD:4385
            _this.panel.y=_this.panel.height/2-_this.my;
            //$LASTPOS=86004417;//kernel.MapEditorOLD:4417
            if (!(_this.mode=="set"&&_this.getkey(1)>0)) { __pc=15    ; break; }
            {
              //$LASTPOS=86004458;//kernel.MapEditorOLD:4458
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
              //$LASTPOS=86004507;//kernel.MapEditorOLD:4507
              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
            }
            __pc=25    ;break;
          case 15    :
            //$LASTPOS=86004558;//kernel.MapEditorOLD:4558
            if (!(_this.mode=="erase"&&_this.getkey(1)>0)) { __pc=16    ; break; }
            {
              //$LASTPOS=86004601;//kernel.MapEditorOLD:4601
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
            }
            __pc=24    ;break;
          case 16    :
            //$LASTPOS=86004650;//kernel.MapEditorOLD:4650
            if (!(_this.mode=="get"&&_this.getkey(1)>0)) { __pc=18    ; break; }
            //$LASTPOS=86004691;//kernel.MapEditorOLD:4691
            _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);
            //$LASTPOS=86004745;//kernel.MapEditorOLD:4745
            _this.mode=_this.prevMode;
            //$LASTPOS=86004769;//kernel.MapEditorOLD:4769
            Tonyu.globals.$mp.scrollTo(1000,1000);
            //$LASTPOS=86004803;//kernel.MapEditorOLD:4803
            _this.print(_this.mode+" mode");
            //$LASTPOS=86004833;//kernel.MapEditorOLD:4833
            _this.fiber$updateEx(_thread, 10);
            __pc=17;return;
          case 17:
            
            __pc=23    ;break;
          case 18    :
            //$LASTPOS=86004858;//kernel.MapEditorOLD:4858
            if (!(_this.mode=="setOn"&&_this.getkey(1)>0)) { __pc=19    ; break; }
            {
              //$LASTPOS=86004901;//kernel.MapEditorOLD:4901
              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
            }
            __pc=22    ;break;
          case 19    :
            //$LASTPOS=86004954;//kernel.MapEditorOLD:4954
            if (!(_this.mode=="spuit"&&_this.getkey(1)>0)) { __pc=21    ; break; }
            //$LASTPOS=86004997;//kernel.MapEditorOLD:4997
            _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);
            //$LASTPOS=86005046;//kernel.MapEditorOLD:5046
            _this.mode="set";
            //$LASTPOS=86005067;//kernel.MapEditorOLD:5067
            _this.print(_this.mode+" mode");
            //$LASTPOS=86005097;//kernel.MapEditorOLD:5097
            _this.fiber$updateEx(_thread, 10);
            __pc=20;return;
          case 20:
            
          case 21    :
            
          case 22    :
            
          case 23    :
            
          case 24    :
            
          case 25    :
            
            //$LASTPOS=86005123;//kernel.MapEditorOLD:5123
            _this.fiber$update(_thread);
            __pc=26;return;
          case 26:
            
            __pc=14;break;
          case 27    :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false}},"fields":{"i":{},"j":{},"loadMode":{},"fileName":{},"mapDataFile":{},"baseData":{},"mapData":{},"mapOnData":{},"row":{},"col":{},"panel":{},"counter":{},"mode":{},"prevMode":{},"mapp":{},"mx":{},"my":{},"chipX":{},"chipY":{},"saveFileName":{},"saveDataFile":{},"data":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MapEditorOLD2',
  shortName: 'MapEditorOLD2',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_MapEditorOLD2_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=87000032;//kernel.MapEditorOLD2:32
      Tonyu.globals.$Screen.resize(480,640);
      //$LASTPOS=87000058;//kernel.MapEditorOLD2:58
      _this.loadMode=false;
      //$LASTPOS=87000075;//kernel.MapEditorOLD2:75
      _this.fileExist=false;
      //$LASTPOS=87000093;//kernel.MapEditorOLD2:93
      _this.print("map file(s)");
      //$LASTPOS=87000116;//kernel.MapEditorOLD2:116
      _this.fileList=_this.file("../maps/");
      //$LASTPOS=87000144;//kernel.MapEditorOLD2:144
      if (_this.fileList.exists()) {
        //$LASTPOS=87000168;//kernel.MapEditorOLD2:168
        _this.fileList.recursive((function a(f) {
          
          //$LASTPOS=87000207;//kernel.MapEditorOLD2:207
          f=f+"";
          //$LASTPOS=87000220;//kernel.MapEditorOLD2:220
          _this.fNames=f.split("/");
          //$LASTPOS=87000246;//kernel.MapEditorOLD2:246
          _this.print(_this.fNames[_this.fNames.length-1]);
          //$LASTPOS=87000283;//kernel.MapEditorOLD2:283
          _this.fileExist=true;
        }));
        
      }
      //$LASTPOS=87000308;//kernel.MapEditorOLD2:308
      if (_this.fileExist) {
        //$LASTPOS=87000328;//kernel.MapEditorOLD2:328
        _this.print("Load Data?: Y or N");
        //$LASTPOS=87000362;//kernel.MapEditorOLD2:362
        while (true) {
          //$LASTPOS=87000384;//kernel.MapEditorOLD2:384
          if (_this.getkey("y")>0) {
            //$LASTPOS=87000416;//kernel.MapEditorOLD2:416
            _this.loadMode=true;
            break;
            
            
          }
          //$LASTPOS=87000471;//kernel.MapEditorOLD2:471
          if (_this.getkey("n")>0) {
            //$LASTPOS=87000503;//kernel.MapEditorOLD2:503
            _this.loadMode=false;
            break;
            
            
          }
          //$LASTPOS=87000559;//kernel.MapEditorOLD2:559
          _this.update();
          
        }
        //$LASTPOS=87000581;//kernel.MapEditorOLD2:581
        if (_this.loadMode) {
          //$LASTPOS=87000604;//kernel.MapEditorOLD2:604
          _this.fileName=prompt("Input json file (*.json)","map.json");
          //$LASTPOS=87000669;//kernel.MapEditorOLD2:669
          if (_this.fileName) {
            //$LASTPOS=87000696;//kernel.MapEditorOLD2:696
            _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
            
          }
          //$LASTPOS=87000760;//kernel.MapEditorOLD2:760
          if (_this.mapDataFile.obj()) {
            //$LASTPOS=87000796;//kernel.MapEditorOLD2:796
            _this.baseData=_this.mapDataFile.obj();
            //$LASTPOS=87000837;//kernel.MapEditorOLD2:837
            _this.loadedFile=_this.fileName;
            
          } else {
            //$LASTPOS=87000887;//kernel.MapEditorOLD2:887
            _this.mapDataFile=_this.file(_this.fileName);
            //$LASTPOS=87000928;//kernel.MapEditorOLD2:928
            if (_this.mapDataFile.obj()) {
              //$LASTPOS=87000968;//kernel.MapEditorOLD2:968
              _this.baseData=_this.mapDataFile.obj();
              //$LASTPOS=87001013;//kernel.MapEditorOLD2:1013
              _this.loadedFile=_this.fileName;
              
            }
            
          }
          //$LASTPOS=87001069;//kernel.MapEditorOLD2:1069
          if (_this.baseData==undefined) {
            //$LASTPOS=87001107;//kernel.MapEditorOLD2:1107
            _this.print("Load failed");
            //$LASTPOS=87001142;//kernel.MapEditorOLD2:1142
            _this.loadMode=false;
            
          } else {
            //$LASTPOS=87001173;//kernel.MapEditorOLD2:1173
            if (_this.baseData[0]&&_this.baseData[1]) {
              //$LASTPOS=87001218;//kernel.MapEditorOLD2:1218
              _this.mapData=_this.baseData[0];
              //$LASTPOS=87001252;//kernel.MapEditorOLD2:1252
              _this.mapOnData=_this.baseData[1];
              //$LASTPOS=87001288;//kernel.MapEditorOLD2:1288
              if (_this.baseData.length>2) {
                //$LASTPOS=87001328;//kernel.MapEditorOLD2:1328
                _this.chipWidth=_this.baseData[_this.baseData.length-2];
                //$LASTPOS=87001384;//kernel.MapEditorOLD2:1384
                _this.chipHeight=_this.baseData[_this.baseData.length-1];
                
              }
              
            }
          }
          
        }
        
      }
      //$LASTPOS=87001461;//kernel.MapEditorOLD2:1461
      _this.update();
      //$LASTPOS=87001739;//kernel.MapEditorOLD2:1739
      if (! _this.loadMode) {
        //$LASTPOS=87001759;//kernel.MapEditorOLD2:1759
        _this.row=prompt("input row");
        //$LASTPOS=87001789;//kernel.MapEditorOLD2:1789
        _this.col=prompt("input col");
        //$LASTPOS=87001819;//kernel.MapEditorOLD2:1819
        _this.chipWidth=prompt("input chipWidth");
        //$LASTPOS=87001861;//kernel.MapEditorOLD2:1861
        _this.chipHeight=prompt("input chipHeight");
        //$LASTPOS=87001905;//kernel.MapEditorOLD2:1905
        _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
        //$LASTPOS=87001970;//kernel.MapEditorOLD2:1970
        _this.panel.x=_this.panel.width/2+40;
        //$LASTPOS=87002001;//kernel.MapEditorOLD2:2001
        _this.panel.y=_this.panel.height/2+40;
        //$LASTPOS=87002033;//kernel.MapEditorOLD2:2033
        _this.panel.setFillStyle("cyan");
        //$LASTPOS=87002066;//kernel.MapEditorOLD2:2066
        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
        //$LASTPOS=87002117;//kernel.MapEditorOLD2:2117
        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});
        
      } else {
        //$LASTPOS=87002428;//kernel.MapEditorOLD2:2428
        Tonyu.globals.$map=new Tonyu.classes.kernel.Map({chipWidth: 32,chipHeight: 32});
        //$LASTPOS=87002475;//kernel.MapEditorOLD2:2475
        Tonyu.globals.$map.load(_this.fileName);
        //$LASTPOS=87002501;//kernel.MapEditorOLD2:2501
        _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
        //$LASTPOS=87002597;//kernel.MapEditorOLD2:2597
        _this.panel.x=_this.panel.width/2+40;
        //$LASTPOS=87002628;//kernel.MapEditorOLD2:2628
        _this.panel.y=_this.panel.height/2+40;
        //$LASTPOS=87002660;//kernel.MapEditorOLD2:2660
        _this.panel.setFillStyle("cyan");
        //$LASTPOS=87002693;//kernel.MapEditorOLD2:2693
        _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
        
      }
      //$LASTPOS=87002743;//kernel.MapEditorOLD2:2743
      _this.mIW=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip].image.width;
      //$LASTPOS=87002799;//kernel.MapEditorOLD2:2799
      _this.mIH=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip].image.height;
      //$LASTPOS=87002856;//kernel.MapEditorOLD2:2856
      _this.mCW=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip+0].width;
      //$LASTPOS=87002908;//kernel.MapEditorOLD2:2908
      _this.mCH=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip+0].height;
      //$LASTPOS=87002961;//kernel.MapEditorOLD2:2961
      Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: _this.floor(_this.mIH/_this.mCH),col: _this.floor(_this.mIW/_this.mCW),chipWidth: _this.mCW,chipHeight: _this.mCH});
      //$LASTPOS=87003043;//kernel.MapEditorOLD2:3043
      _this.counter=0;
      //$LASTPOS=87003055;//kernel.MapEditorOLD2:3055
      //$LASTPOS=87003059;//kernel.MapEditorOLD2:3059
      _this.i = 0;
      for (; _this.i<Tonyu.globals.$mp.row ; _this.i++) {
        {
          //$LASTPOS=87003088;//kernel.MapEditorOLD2:3088
          //$LASTPOS=87003092;//kernel.MapEditorOLD2:3092
          _this.j = 0;
          for (; _this.j<Tonyu.globals.$mp.col ; _this.j++) {
            {
              //$LASTPOS=87003125;//kernel.MapEditorOLD2:3125
              Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
              //$LASTPOS=87003169;//kernel.MapEditorOLD2:3169
              _this.counter++;
            }
          }
        }
      }
      //$LASTPOS=87003191;//kernel.MapEditorOLD2:3191
      _this.drawPanel();
      //$LASTPOS=87003205;//kernel.MapEditorOLD2:3205
      _this.mode="get";
      //$LASTPOS=87003218;//kernel.MapEditorOLD2:3218
      _this.prevMode="set";
      //$LASTPOS=87003235;//kernel.MapEditorOLD2:3235
      _this.mapp=0;
      //$LASTPOS=87003244;//kernel.MapEditorOLD2:3244
      _this.mx=- 40;
      //$LASTPOS=87003253;//kernel.MapEditorOLD2:3253
      _this.my=- 40;
      //$LASTPOS=87003262;//kernel.MapEditorOLD2:3262
      _this.chipX=- 40;
      //$LASTPOS=87003274;//kernel.MapEditorOLD2:3274
      _this.chipY=- 40;
      //$LASTPOS=87003286;//kernel.MapEditorOLD2:3286
      _this.x=Tonyu.globals.$screenWidth-_this.chipWidth/2;
      //$LASTPOS=87003315;//kernel.MapEditorOLD2:3315
      _this.y=Tonyu.globals.$screenHeight-_this.chipHeight/2;
      //$LASTPOS=87003346;//kernel.MapEditorOLD2:3346
      Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
      //$LASTPOS=87003369;//kernel.MapEditorOLD2:3369
      while (true) {
        //$LASTPOS=87003387;//kernel.MapEditorOLD2:3387
        _this.p=_this.mapp;
        //$LASTPOS=87003400;//kernel.MapEditorOLD2:3400
        if (_this.getkey("e")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {
          //$LASTPOS=87003539;//kernel.MapEditorOLD2:3539
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=87003573;//kernel.MapEditorOLD2:3573
          _this.mode="erase";
          //$LASTPOS=87003596;//kernel.MapEditorOLD2:3596
          _this.print(_this.mode+" mode");
          
        }
        //$LASTPOS=87003629;//kernel.MapEditorOLD2:3629
        if (_this.getkey("s")==1) {
          //$LASTPOS=87003658;//kernel.MapEditorOLD2:3658
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=87003692;//kernel.MapEditorOLD2:3692
          if (_this.mode=="set") {
            //$LASTPOS=87003722;//kernel.MapEditorOLD2:3722
            _this.mode="setOn";
            
          } else {
            //$LASTPOS=87003765;//kernel.MapEditorOLD2:3765
            _this.mode="set";
            
          }
          //$LASTPOS=87003797;//kernel.MapEditorOLD2:3797
          _this.print(_this.mode+" mode");
          
        }
        //$LASTPOS=87003830;//kernel.MapEditorOLD2:3830
        if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
          //$LASTPOS=87003949;//kernel.MapEditorOLD2:3949
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=87003983;//kernel.MapEditorOLD2:3983
          _this.mode="set";
          //$LASTPOS=87004004;//kernel.MapEditorOLD2:4004
          _this.print(_this.mode+" mode");
          
        }
        //$LASTPOS=87004037;//kernel.MapEditorOLD2:4037
        if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
          //$LASTPOS=87004158;//kernel.MapEditorOLD2:4158
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=87004192;//kernel.MapEditorOLD2:4192
          _this.mode="setOn";
          //$LASTPOS=87004215;//kernel.MapEditorOLD2:4215
          _this.print(_this.mode+" mode");
          
        }
        //$LASTPOS=87004341;//kernel.MapEditorOLD2:4341
        if (_this.getkey("g")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>240&&Tonyu.globals.$touches[0].x<360&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {
          //$LASTPOS=87004482;//kernel.MapEditorOLD2:4482
          if (_this.mode!="get") {
            //$LASTPOS=87004512;//kernel.MapEditorOLD2:4512
            _this.prevMode=_this.mode;
            //$LASTPOS=87004540;//kernel.MapEditorOLD2:4540
            Tonyu.globals.$mp.scrollTo(- 40,- 40);
            //$LASTPOS=87004576;//kernel.MapEditorOLD2:4576
            _this.mode="get";
            //$LASTPOS=87004601;//kernel.MapEditorOLD2:4601
            _this.chipX=- 40;
            //$LASTPOS=87004625;//kernel.MapEditorOLD2:4625
            _this.chipY=- 40;
            
          } else {
            //$LASTPOS=87004665;//kernel.MapEditorOLD2:4665
            Tonyu.globals.$mp.scrollTo(1000,1000);
            //$LASTPOS=87004703;//kernel.MapEditorOLD2:4703
            _this.mode=_this.prevMode;
            
          }
          //$LASTPOS=87004738;//kernel.MapEditorOLD2:4738
          _this.print(_this.mode+" mode");
          
        }
        //$LASTPOS=87004771;//kernel.MapEditorOLD2:4771
        if (_this.getkey("p")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>360&&Tonyu.globals.$touches[0].x<480&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {
          //$LASTPOS=87004927;//kernel.MapEditorOLD2:4927
          if (_this.loadedFile) {
            //$LASTPOS=87004956;//kernel.MapEditorOLD2:4956
            _this.saveFileName=prompt("input json file(*.json)",_this.loadedFile);
            
          } else {
            //$LASTPOS=87005044;//kernel.MapEditorOLD2:5044
            _this.saveFileName=prompt("input json file(*.json)","map.json");
            
          }
          //$LASTPOS=87005544;//kernel.MapEditorOLD2:5544
          if (_this.saveFileName) {
            //$LASTPOS=87005575;//kernel.MapEditorOLD2:5575
            _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);
            //$LASTPOS=87005637;//kernel.MapEditorOLD2:5637
            _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable,Tonyu.globals.$map.chipWidth,Tonyu.globals.$map.chipHeight];
            //$LASTPOS=87005799;//kernel.MapEditorOLD2:5799
            _this.saveDataFile.obj(_this.data);
            //$LASTPOS=87005836;//kernel.MapEditorOLD2:5836
            _this.print(_this.saveFileName+" Saved");
            
          }
          
        }
        //$LASTPOS=87005943;//kernel.MapEditorOLD2:5943
        if (_this.getkey("c")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {
          //$LASTPOS=87006084;//kernel.MapEditorOLD2:6084
          Tonyu.globals.$mp.scrollTo(1000,1000);
          //$LASTPOS=87006118;//kernel.MapEditorOLD2:6118
          _this.mode="copy";
          //$LASTPOS=87006140;//kernel.MapEditorOLD2:6140
          _this.print(_this.mode+" mode");
          
        }
        //$LASTPOS=87006173;//kernel.MapEditorOLD2:6173
        if (_this.mode!="get") {
          //$LASTPOS=87006199;//kernel.MapEditorOLD2:6199
          if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
            //$LASTPOS=87006305;//kernel.MapEditorOLD2:6305
            _this.mx=_this.mx+8;
          }
          //$LASTPOS=87006323;//kernel.MapEditorOLD2:6323
          if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
            //$LASTPOS=87006454;//kernel.MapEditorOLD2:6454
            _this.mx=_this.mx-8;
          }
          //$LASTPOS=87006472;//kernel.MapEditorOLD2:6472
          if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
            //$LASTPOS=87006585;//kernel.MapEditorOLD2:6585
            _this.my=_this.my+8;
          }
          //$LASTPOS=87006603;//kernel.MapEditorOLD2:6603
          if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
            //$LASTPOS=87006738;//kernel.MapEditorOLD2:6738
            _this.my=_this.my-8;
          }
          //$LASTPOS=87006756;//kernel.MapEditorOLD2:6756
          Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
          
        } else {
          //$LASTPOS=87006799;//kernel.MapEditorOLD2:6799
          if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
            //$LASTPOS=87006905;//kernel.MapEditorOLD2:6905
            _this.chipX=_this.chipX+8;
          }
          //$LASTPOS=87006929;//kernel.MapEditorOLD2:6929
          if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
            //$LASTPOS=87007060;//kernel.MapEditorOLD2:7060
            _this.chipX=_this.chipX-8;
          }
          //$LASTPOS=87007084;//kernel.MapEditorOLD2:7084
          if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
            //$LASTPOS=87007197;//kernel.MapEditorOLD2:7197
            _this.chipY=_this.chipY+8;
          }
          //$LASTPOS=87007221;//kernel.MapEditorOLD2:7221
          if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
            //$LASTPOS=87007356;//kernel.MapEditorOLD2:7356
            _this.chipY=_this.chipY-8;
          }
          //$LASTPOS=87007380;//kernel.MapEditorOLD2:7380
          Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
          
        }
        //$LASTPOS=87007453;//kernel.MapEditorOLD2:7453
        if (_this.getkey("i")==1) {
          //$LASTPOS=87007482;//kernel.MapEditorOLD2:7482
          Tonyu.globals.$map.chipWidth+=4;
          //$LASTPOS=87007510;//kernel.MapEditorOLD2:7510
          Tonyu.globals.$map.chipHeight+=4;
          //$LASTPOS=87007539;//kernel.MapEditorOLD2:7539
          Tonyu.globals.$map.redrawMap();
          //$LASTPOS=87007566;//kernel.MapEditorOLD2:7566
          _this.panel.die();
          //$LASTPOS=87007588;//kernel.MapEditorOLD2:7588
          _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
          //$LASTPOS=87007688;//kernel.MapEditorOLD2:7688
          _this.panel.x=_this.panel.width/2+40;
          //$LASTPOS=87007723;//kernel.MapEditorOLD2:7723
          _this.panel.y=_this.panel.height/2+40;
          //$LASTPOS=87007759;//kernel.MapEditorOLD2:7759
          _this.panel.setFillStyle("cyan");
          //$LASTPOS=87007796;//kernel.MapEditorOLD2:7796
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          
        }
        //$LASTPOS=87007854;//kernel.MapEditorOLD2:7854
        if (_this.getkey("o")==1) {
          //$LASTPOS=87007883;//kernel.MapEditorOLD2:7883
          Tonyu.globals.$map.chipWidth-=4;
          //$LASTPOS=87007911;//kernel.MapEditorOLD2:7911
          Tonyu.globals.$map.chipHeight-=4;
          //$LASTPOS=87007940;//kernel.MapEditorOLD2:7940
          Tonyu.globals.$map.redrawMap();
          //$LASTPOS=87007967;//kernel.MapEditorOLD2:7967
          _this.panel.die();
          //$LASTPOS=87007989;//kernel.MapEditorOLD2:7989
          _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
          //$LASTPOS=87008089;//kernel.MapEditorOLD2:8089
          _this.panel.x=_this.panel.width/2+40;
          //$LASTPOS=87008124;//kernel.MapEditorOLD2:8124
          _this.panel.y=_this.panel.height/2+40;
          //$LASTPOS=87008160;//kernel.MapEditorOLD2:8160
          _this.panel.setFillStyle("cyan");
          //$LASTPOS=87008197;//kernel.MapEditorOLD2:8197
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          
        }
        //$LASTPOS=87008289;//kernel.MapEditorOLD2:8289
        _this.panel.x=_this.panel.width/2-_this.mx;
        //$LASTPOS=87008320;//kernel.MapEditorOLD2:8320
        _this.panel.y=_this.panel.height/2-_this.my;
        //$LASTPOS=87008352;//kernel.MapEditorOLD2:8352
        if (_this.mode=="set"&&_this.getkey(1)>0&&_this.inRect()) {
          //$LASTPOS=87008405;//kernel.MapEditorOLD2:8405
          Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
          //$LASTPOS=87008454;//kernel.MapEditorOLD2:8454
          Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
          
        } else {
          //$LASTPOS=87008505;//kernel.MapEditorOLD2:8505
          if (_this.mode=="erase"&&_this.getkey(1)>0&&_this.inRect()) {
            //$LASTPOS=87008560;//kernel.MapEditorOLD2:8560
            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
            
          } else {
            //$LASTPOS=87008609;//kernel.MapEditorOLD2:8609
            if (_this.mode=="get"&&_this.getkey(1)>0&&_this.inRect()) {
              //$LASTPOS=87008662;//kernel.MapEditorOLD2:8662
              _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);
              //$LASTPOS=87008716;//kernel.MapEditorOLD2:8716
              _this.mode=_this.prevMode;
              //$LASTPOS=87008740;//kernel.MapEditorOLD2:8740
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=87008774;//kernel.MapEditorOLD2:8774
              _this.print(_this.mode+" mode");
              //$LASTPOS=87008804;//kernel.MapEditorOLD2:8804
              _this.updateEx(10);
              
            } else {
              //$LASTPOS=87008829;//kernel.MapEditorOLD2:8829
              if (_this.mode=="setOn"&&_this.getkey(1)>0&&_this.inRect()) {
                //$LASTPOS=87008884;//kernel.MapEditorOLD2:8884
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
                
              } else {
                //$LASTPOS=87008937;//kernel.MapEditorOLD2:8937
                if (_this.mode=="copy"&&_this.getkey(1)>0&&_this.inRect()) {
                  //$LASTPOS=87008991;//kernel.MapEditorOLD2:8991
                  _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);
                  //$LASTPOS=87009040;//kernel.MapEditorOLD2:9040
                  _this.mode="set";
                  //$LASTPOS=87009061;//kernel.MapEditorOLD2:9061
                  _this.print(_this.mode+" mode");
                  //$LASTPOS=87009091;//kernel.MapEditorOLD2:9091
                  _this.updateEx(10);
                  
                }
              }
            }
          }
        }
        //$LASTPOS=87009117;//kernel.MapEditorOLD2:9117
        _this.update();
        
      }
    },
    fiber$main :function _trc_MapEditorOLD2_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=87000032;//kernel.MapEditorOLD2:32
      Tonyu.globals.$Screen.resize(480,640);
      //$LASTPOS=87000058;//kernel.MapEditorOLD2:58
      _this.loadMode=false;
      //$LASTPOS=87000075;//kernel.MapEditorOLD2:75
      _this.fileExist=false;
      //$LASTPOS=87000093;//kernel.MapEditorOLD2:93
      _this.print("map file(s)");
      
      _thread.enter(function _trc_MapEditorOLD2_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=87000116;//kernel.MapEditorOLD2:116
            _this.fiber$file(_thread, "../maps/");
            __pc=1;return;
          case 1:
            _this.fileList=_thread.retVal;
            
            //$LASTPOS=87000144;//kernel.MapEditorOLD2:144
            if (_this.fileList.exists()) {
              //$LASTPOS=87000168;//kernel.MapEditorOLD2:168
              _this.fileList.recursive((function a(f) {
                
                //$LASTPOS=87000207;//kernel.MapEditorOLD2:207
                f=f+"";
                //$LASTPOS=87000220;//kernel.MapEditorOLD2:220
                _this.fNames=f.split("/");
                //$LASTPOS=87000246;//kernel.MapEditorOLD2:246
                _this.print(_this.fNames[_this.fNames.length-1]);
                //$LASTPOS=87000283;//kernel.MapEditorOLD2:283
                _this.fileExist=true;
              }));
              
            }
            //$LASTPOS=87000308;//kernel.MapEditorOLD2:308
            if (!(_this.fileExist)) { __pc=11    ; break; }
            //$LASTPOS=87000328;//kernel.MapEditorOLD2:328
            _this.print("Load Data?: Y or N");
            //$LASTPOS=87000362;//kernel.MapEditorOLD2:362
          case 2:
            //$LASTPOS=87000384;//kernel.MapEditorOLD2:384
            if (!(_this.getkey("y")>0)) { __pc=3     ; break; }
            //$LASTPOS=87000416;//kernel.MapEditorOLD2:416
            _this.loadMode=true;
            __pc=6     ; break;
            
          case 3     :
            
            //$LASTPOS=87000471;//kernel.MapEditorOLD2:471
            if (!(_this.getkey("n")>0)) { __pc=4     ; break; }
            //$LASTPOS=87000503;//kernel.MapEditorOLD2:503
            _this.loadMode=false;
            __pc=6     ; break;
            
          case 4     :
            
            //$LASTPOS=87000559;//kernel.MapEditorOLD2:559
            _this.fiber$update(_thread);
            __pc=5;return;
          case 5:
            
            __pc=2;break;
          case 6     :
            
            //$LASTPOS=87000581;//kernel.MapEditorOLD2:581
            if (!(_this.loadMode)) { __pc=10    ; break; }
            //$LASTPOS=87000604;//kernel.MapEditorOLD2:604
            _this.fileName=prompt("Input json file (*.json)","map.json");
            //$LASTPOS=87000669;//kernel.MapEditorOLD2:669
            if (_this.fileName) {
              //$LASTPOS=87000696;//kernel.MapEditorOLD2:696
              _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
              
            }
            //$LASTPOS=87000760;//kernel.MapEditorOLD2:760
            if (!(_this.mapDataFile.obj())) { __pc=7     ; break; }
            {
              //$LASTPOS=87000796;//kernel.MapEditorOLD2:796
              _this.baseData=_this.mapDataFile.obj();
              //$LASTPOS=87000837;//kernel.MapEditorOLD2:837
              _this.loadedFile=_this.fileName;
            }
            __pc=9     ;break;
          case 7     :
            //$LASTPOS=87000887;//kernel.MapEditorOLD2:887
            _this.fiber$file(_thread, _this.fileName);
            __pc=8;return;
          case 8:
            _this.mapDataFile=_thread.retVal;
            
            //$LASTPOS=87000928;//kernel.MapEditorOLD2:928
            if (_this.mapDataFile.obj()) {
              //$LASTPOS=87000968;//kernel.MapEditorOLD2:968
              _this.baseData=_this.mapDataFile.obj();
              //$LASTPOS=87001013;//kernel.MapEditorOLD2:1013
              _this.loadedFile=_this.fileName;
              
            }
          case 9     :
            
            //$LASTPOS=87001069;//kernel.MapEditorOLD2:1069
            if (_this.baseData==undefined) {
              //$LASTPOS=87001107;//kernel.MapEditorOLD2:1107
              _this.print("Load failed");
              //$LASTPOS=87001142;//kernel.MapEditorOLD2:1142
              _this.loadMode=false;
              
            } else {
              //$LASTPOS=87001173;//kernel.MapEditorOLD2:1173
              if (_this.baseData[0]&&_this.baseData[1]) {
                //$LASTPOS=87001218;//kernel.MapEditorOLD2:1218
                _this.mapData=_this.baseData[0];
                //$LASTPOS=87001252;//kernel.MapEditorOLD2:1252
                _this.mapOnData=_this.baseData[1];
                //$LASTPOS=87001288;//kernel.MapEditorOLD2:1288
                if (_this.baseData.length>2) {
                  //$LASTPOS=87001328;//kernel.MapEditorOLD2:1328
                  _this.chipWidth=_this.baseData[_this.baseData.length-2];
                  //$LASTPOS=87001384;//kernel.MapEditorOLD2:1384
                  _this.chipHeight=_this.baseData[_this.baseData.length-1];
                  
                }
                
              }
            }
          case 10    :
            
          case 11    :
            
            //$LASTPOS=87001461;//kernel.MapEditorOLD2:1461
            _this.fiber$update(_thread);
            __pc=12;return;
          case 12:
            
            //$LASTPOS=87001739;//kernel.MapEditorOLD2:1739
            if (! _this.loadMode) {
              //$LASTPOS=87001759;//kernel.MapEditorOLD2:1759
              _this.row=prompt("input row");
              //$LASTPOS=87001789;//kernel.MapEditorOLD2:1789
              _this.col=prompt("input col");
              //$LASTPOS=87001819;//kernel.MapEditorOLD2:1819
              _this.chipWidth=prompt("input chipWidth");
              //$LASTPOS=87001861;//kernel.MapEditorOLD2:1861
              _this.chipHeight=prompt("input chipHeight");
              //$LASTPOS=87001905;//kernel.MapEditorOLD2:1905
              _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
              //$LASTPOS=87001970;//kernel.MapEditorOLD2:1970
              _this.panel.x=_this.panel.width/2+40;
              //$LASTPOS=87002001;//kernel.MapEditorOLD2:2001
              _this.panel.y=_this.panel.height/2+40;
              //$LASTPOS=87002033;//kernel.MapEditorOLD2:2033
              _this.panel.setFillStyle("cyan");
              //$LASTPOS=87002066;//kernel.MapEditorOLD2:2066
              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
              //$LASTPOS=87002117;//kernel.MapEditorOLD2:2117
              Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});
              
            } else {
              //$LASTPOS=87002428;//kernel.MapEditorOLD2:2428
              Tonyu.globals.$map=new Tonyu.classes.kernel.Map({chipWidth: 32,chipHeight: 32});
              //$LASTPOS=87002475;//kernel.MapEditorOLD2:2475
              Tonyu.globals.$map.load(_this.fileName);
              //$LASTPOS=87002501;//kernel.MapEditorOLD2:2501
              _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
              //$LASTPOS=87002597;//kernel.MapEditorOLD2:2597
              _this.panel.x=_this.panel.width/2+40;
              //$LASTPOS=87002628;//kernel.MapEditorOLD2:2628
              _this.panel.y=_this.panel.height/2+40;
              //$LASTPOS=87002660;//kernel.MapEditorOLD2:2660
              _this.panel.setFillStyle("cyan");
              //$LASTPOS=87002693;//kernel.MapEditorOLD2:2693
              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
              
            }
            //$LASTPOS=87002743;//kernel.MapEditorOLD2:2743
            _this.mIW=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip].image.width;
            //$LASTPOS=87002799;//kernel.MapEditorOLD2:2799
            _this.mIH=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip].image.height;
            //$LASTPOS=87002856;//kernel.MapEditorOLD2:2856
            _this.mCW=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip+0].width;
            //$LASTPOS=87002908;//kernel.MapEditorOLD2:2908
            _this.mCH=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip+0].height;
            //$LASTPOS=87002961;//kernel.MapEditorOLD2:2961
            Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: _this.floor(_this.mIH/_this.mCH),col: _this.floor(_this.mIW/_this.mCW),chipWidth: _this.mCW,chipHeight: _this.mCH});
            //$LASTPOS=87003043;//kernel.MapEditorOLD2:3043
            _this.counter=0;
            //$LASTPOS=87003055;//kernel.MapEditorOLD2:3055
            //$LASTPOS=87003059;//kernel.MapEditorOLD2:3059
            _this.i = 0;
            for (; _this.i<Tonyu.globals.$mp.row ; _this.i++) {
              {
                //$LASTPOS=87003088;//kernel.MapEditorOLD2:3088
                //$LASTPOS=87003092;//kernel.MapEditorOLD2:3092
                _this.j = 0;
                for (; _this.j<Tonyu.globals.$mp.col ; _this.j++) {
                  {
                    //$LASTPOS=87003125;//kernel.MapEditorOLD2:3125
                    Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
                    //$LASTPOS=87003169;//kernel.MapEditorOLD2:3169
                    _this.counter++;
                  }
                }
              }
            }
            //$LASTPOS=87003191;//kernel.MapEditorOLD2:3191
            _this.fiber$drawPanel(_thread);
            __pc=13;return;
          case 13:
            
            //$LASTPOS=87003205;//kernel.MapEditorOLD2:3205
            _this.mode="get";
            //$LASTPOS=87003218;//kernel.MapEditorOLD2:3218
            _this.prevMode="set";
            //$LASTPOS=87003235;//kernel.MapEditorOLD2:3235
            _this.mapp=0;
            //$LASTPOS=87003244;//kernel.MapEditorOLD2:3244
            _this.mx=- 40;
            //$LASTPOS=87003253;//kernel.MapEditorOLD2:3253
            _this.my=- 40;
            //$LASTPOS=87003262;//kernel.MapEditorOLD2:3262
            _this.chipX=- 40;
            //$LASTPOS=87003274;//kernel.MapEditorOLD2:3274
            _this.chipY=- 40;
            //$LASTPOS=87003286;//kernel.MapEditorOLD2:3286
            _this.x=Tonyu.globals.$screenWidth-_this.chipWidth/2;
            //$LASTPOS=87003315;//kernel.MapEditorOLD2:3315
            _this.y=Tonyu.globals.$screenHeight-_this.chipHeight/2;
            //$LASTPOS=87003346;//kernel.MapEditorOLD2:3346
            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
            //$LASTPOS=87003369;//kernel.MapEditorOLD2:3369
          case 14:
            //$LASTPOS=87003387;//kernel.MapEditorOLD2:3387
            _this.p=_this.mapp;
            //$LASTPOS=87003400;//kernel.MapEditorOLD2:3400
            if (_this.getkey("e")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {
              //$LASTPOS=87003539;//kernel.MapEditorOLD2:3539
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=87003573;//kernel.MapEditorOLD2:3573
              _this.mode="erase";
              //$LASTPOS=87003596;//kernel.MapEditorOLD2:3596
              _this.print(_this.mode+" mode");
              
            }
            //$LASTPOS=87003629;//kernel.MapEditorOLD2:3629
            if (_this.getkey("s")==1) {
              //$LASTPOS=87003658;//kernel.MapEditorOLD2:3658
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=87003692;//kernel.MapEditorOLD2:3692
              if (_this.mode=="set") {
                //$LASTPOS=87003722;//kernel.MapEditorOLD2:3722
                _this.mode="setOn";
                
              } else {
                //$LASTPOS=87003765;//kernel.MapEditorOLD2:3765
                _this.mode="set";
                
              }
              //$LASTPOS=87003797;//kernel.MapEditorOLD2:3797
              _this.print(_this.mode+" mode");
              
            }
            //$LASTPOS=87003830;//kernel.MapEditorOLD2:3830
            if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
              //$LASTPOS=87003949;//kernel.MapEditorOLD2:3949
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=87003983;//kernel.MapEditorOLD2:3983
              _this.mode="set";
              //$LASTPOS=87004004;//kernel.MapEditorOLD2:4004
              _this.print(_this.mode+" mode");
              
            }
            //$LASTPOS=87004037;//kernel.MapEditorOLD2:4037
            if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
              //$LASTPOS=87004158;//kernel.MapEditorOLD2:4158
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=87004192;//kernel.MapEditorOLD2:4192
              _this.mode="setOn";
              //$LASTPOS=87004215;//kernel.MapEditorOLD2:4215
              _this.print(_this.mode+" mode");
              
            }
            //$LASTPOS=87004341;//kernel.MapEditorOLD2:4341
            if (_this.getkey("g")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>240&&Tonyu.globals.$touches[0].x<360&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {
              //$LASTPOS=87004482;//kernel.MapEditorOLD2:4482
              if (_this.mode!="get") {
                //$LASTPOS=87004512;//kernel.MapEditorOLD2:4512
                _this.prevMode=_this.mode;
                //$LASTPOS=87004540;//kernel.MapEditorOLD2:4540
                Tonyu.globals.$mp.scrollTo(- 40,- 40);
                //$LASTPOS=87004576;//kernel.MapEditorOLD2:4576
                _this.mode="get";
                //$LASTPOS=87004601;//kernel.MapEditorOLD2:4601
                _this.chipX=- 40;
                //$LASTPOS=87004625;//kernel.MapEditorOLD2:4625
                _this.chipY=- 40;
                
              } else {
                //$LASTPOS=87004665;//kernel.MapEditorOLD2:4665
                Tonyu.globals.$mp.scrollTo(1000,1000);
                //$LASTPOS=87004703;//kernel.MapEditorOLD2:4703
                _this.mode=_this.prevMode;
                
              }
              //$LASTPOS=87004738;//kernel.MapEditorOLD2:4738
              _this.print(_this.mode+" mode");
              
            }
            //$LASTPOS=87004771;//kernel.MapEditorOLD2:4771
            if (_this.getkey("p")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>360&&Tonyu.globals.$touches[0].x<480&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {
              //$LASTPOS=87004927;//kernel.MapEditorOLD2:4927
              if (_this.loadedFile) {
                //$LASTPOS=87004956;//kernel.MapEditorOLD2:4956
                _this.saveFileName=prompt("input json file(*.json)",_this.loadedFile);
                
              } else {
                //$LASTPOS=87005044;//kernel.MapEditorOLD2:5044
                _this.saveFileName=prompt("input json file(*.json)","map.json");
                
              }
              //$LASTPOS=87005544;//kernel.MapEditorOLD2:5544
              if (_this.saveFileName) {
                //$LASTPOS=87005575;//kernel.MapEditorOLD2:5575
                _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);
                //$LASTPOS=87005637;//kernel.MapEditorOLD2:5637
                _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable,Tonyu.globals.$map.chipWidth,Tonyu.globals.$map.chipHeight];
                //$LASTPOS=87005799;//kernel.MapEditorOLD2:5799
                _this.saveDataFile.obj(_this.data);
                //$LASTPOS=87005836;//kernel.MapEditorOLD2:5836
                _this.print(_this.saveFileName+" Saved");
                
              }
              
            }
            //$LASTPOS=87005943;//kernel.MapEditorOLD2:5943
            if (_this.getkey("c")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {
              //$LASTPOS=87006084;//kernel.MapEditorOLD2:6084
              Tonyu.globals.$mp.scrollTo(1000,1000);
              //$LASTPOS=87006118;//kernel.MapEditorOLD2:6118
              _this.mode="copy";
              //$LASTPOS=87006140;//kernel.MapEditorOLD2:6140
              _this.print(_this.mode+" mode");
              
            }
            //$LASTPOS=87006173;//kernel.MapEditorOLD2:6173
            if (_this.mode!="get") {
              //$LASTPOS=87006199;//kernel.MapEditorOLD2:6199
              if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
                //$LASTPOS=87006305;//kernel.MapEditorOLD2:6305
                _this.mx=_this.mx+8;
              }
              //$LASTPOS=87006323;//kernel.MapEditorOLD2:6323
              if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
                //$LASTPOS=87006454;//kernel.MapEditorOLD2:6454
                _this.mx=_this.mx-8;
              }
              //$LASTPOS=87006472;//kernel.MapEditorOLD2:6472
              if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
                //$LASTPOS=87006585;//kernel.MapEditorOLD2:6585
                _this.my=_this.my+8;
              }
              //$LASTPOS=87006603;//kernel.MapEditorOLD2:6603
              if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
                //$LASTPOS=87006738;//kernel.MapEditorOLD2:6738
                _this.my=_this.my-8;
              }
              //$LASTPOS=87006756;//kernel.MapEditorOLD2:6756
              Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
              
            } else {
              //$LASTPOS=87006799;//kernel.MapEditorOLD2:6799
              if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
                //$LASTPOS=87006905;//kernel.MapEditorOLD2:6905
                _this.chipX=_this.chipX+8;
              }
              //$LASTPOS=87006929;//kernel.MapEditorOLD2:6929
              if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
                //$LASTPOS=87007060;//kernel.MapEditorOLD2:7060
                _this.chipX=_this.chipX-8;
              }
              //$LASTPOS=87007084;//kernel.MapEditorOLD2:7084
              if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
                //$LASTPOS=87007197;//kernel.MapEditorOLD2:7197
                _this.chipY=_this.chipY+8;
              }
              //$LASTPOS=87007221;//kernel.MapEditorOLD2:7221
              if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
                //$LASTPOS=87007356;//kernel.MapEditorOLD2:7356
                _this.chipY=_this.chipY-8;
              }
              //$LASTPOS=87007380;//kernel.MapEditorOLD2:7380
              Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
              
            }
            //$LASTPOS=87007453;//kernel.MapEditorOLD2:7453
            if (_this.getkey("i")==1) {
              //$LASTPOS=87007482;//kernel.MapEditorOLD2:7482
              Tonyu.globals.$map.chipWidth+=4;
              //$LASTPOS=87007510;//kernel.MapEditorOLD2:7510
              Tonyu.globals.$map.chipHeight+=4;
              //$LASTPOS=87007539;//kernel.MapEditorOLD2:7539
              Tonyu.globals.$map.redrawMap();
              //$LASTPOS=87007566;//kernel.MapEditorOLD2:7566
              _this.panel.die();
              //$LASTPOS=87007588;//kernel.MapEditorOLD2:7588
              _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
              //$LASTPOS=87007688;//kernel.MapEditorOLD2:7688
              _this.panel.x=_this.panel.width/2+40;
              //$LASTPOS=87007723;//kernel.MapEditorOLD2:7723
              _this.panel.y=_this.panel.height/2+40;
              //$LASTPOS=87007759;//kernel.MapEditorOLD2:7759
              _this.panel.setFillStyle("cyan");
              //$LASTPOS=87007796;//kernel.MapEditorOLD2:7796
              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
              
            }
            //$LASTPOS=87007854;//kernel.MapEditorOLD2:7854
            if (_this.getkey("o")==1) {
              //$LASTPOS=87007883;//kernel.MapEditorOLD2:7883
              Tonyu.globals.$map.chipWidth-=4;
              //$LASTPOS=87007911;//kernel.MapEditorOLD2:7911
              Tonyu.globals.$map.chipHeight-=4;
              //$LASTPOS=87007940;//kernel.MapEditorOLD2:7940
              Tonyu.globals.$map.redrawMap();
              //$LASTPOS=87007967;//kernel.MapEditorOLD2:7967
              _this.panel.die();
              //$LASTPOS=87007989;//kernel.MapEditorOLD2:7989
              _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
              //$LASTPOS=87008089;//kernel.MapEditorOLD2:8089
              _this.panel.x=_this.panel.width/2+40;
              //$LASTPOS=87008124;//kernel.MapEditorOLD2:8124
              _this.panel.y=_this.panel.height/2+40;
              //$LASTPOS=87008160;//kernel.MapEditorOLD2:8160
              _this.panel.setFillStyle("cyan");
              //$LASTPOS=87008197;//kernel.MapEditorOLD2:8197
              _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
              
            }
            //$LASTPOS=87008289;//kernel.MapEditorOLD2:8289
            _this.panel.x=_this.panel.width/2-_this.mx;
            //$LASTPOS=87008320;//kernel.MapEditorOLD2:8320
            _this.panel.y=_this.panel.height/2-_this.my;
            //$LASTPOS=87008352;//kernel.MapEditorOLD2:8352
            if (!(_this.mode=="set"&&_this.getkey(1)>0&&_this.inRect())) { __pc=15    ; break; }
            {
              //$LASTPOS=87008405;//kernel.MapEditorOLD2:8405
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
              //$LASTPOS=87008454;//kernel.MapEditorOLD2:8454
              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
            }
            __pc=25    ;break;
          case 15    :
            //$LASTPOS=87008505;//kernel.MapEditorOLD2:8505
            if (!(_this.mode=="erase"&&_this.getkey(1)>0&&_this.inRect())) { __pc=16    ; break; }
            {
              //$LASTPOS=87008560;//kernel.MapEditorOLD2:8560
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
            }
            __pc=24    ;break;
          case 16    :
            //$LASTPOS=87008609;//kernel.MapEditorOLD2:8609
            if (!(_this.mode=="get"&&_this.getkey(1)>0&&_this.inRect())) { __pc=18    ; break; }
            //$LASTPOS=87008662;//kernel.MapEditorOLD2:8662
            _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);
            //$LASTPOS=87008716;//kernel.MapEditorOLD2:8716
            _this.mode=_this.prevMode;
            //$LASTPOS=87008740;//kernel.MapEditorOLD2:8740
            Tonyu.globals.$mp.scrollTo(1000,1000);
            //$LASTPOS=87008774;//kernel.MapEditorOLD2:8774
            _this.print(_this.mode+" mode");
            //$LASTPOS=87008804;//kernel.MapEditorOLD2:8804
            _this.fiber$updateEx(_thread, 10);
            __pc=17;return;
          case 17:
            
            __pc=23    ;break;
          case 18    :
            //$LASTPOS=87008829;//kernel.MapEditorOLD2:8829
            if (!(_this.mode=="setOn"&&_this.getkey(1)>0&&_this.inRect())) { __pc=19    ; break; }
            {
              //$LASTPOS=87008884;//kernel.MapEditorOLD2:8884
              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
            }
            __pc=22    ;break;
          case 19    :
            //$LASTPOS=87008937;//kernel.MapEditorOLD2:8937
            if (!(_this.mode=="copy"&&_this.getkey(1)>0&&_this.inRect())) { __pc=21    ; break; }
            //$LASTPOS=87008991;//kernel.MapEditorOLD2:8991
            _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);
            //$LASTPOS=87009040;//kernel.MapEditorOLD2:9040
            _this.mode="set";
            //$LASTPOS=87009061;//kernel.MapEditorOLD2:9061
            _this.print(_this.mode+" mode");
            //$LASTPOS=87009091;//kernel.MapEditorOLD2:9091
            _this.fiber$updateEx(_thread, 10);
            __pc=20;return;
          case 20:
            
          case 21    :
            
          case 22    :
            
          case 23    :
            
          case 24    :
            
          case 25    :
            
            //$LASTPOS=87009117;//kernel.MapEditorOLD2:9117
            _this.fiber$update(_thread);
            __pc=26;return;
          case 26:
            
            __pc=14;break;
          case 27    :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    inRect :function _trc_MapEditorOLD2_inRect() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$mouseX>40&&Tonyu.globals.$mouseX<Tonyu.globals.$screenWidth-40&&Tonyu.globals.$mouseY>40&&Tonyu.globals.$mouseY<Tonyu.globals.$screenHeight-200;
    },
    fiber$inRect :function _trc_MapEditorOLD2_f_inRect(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=Tonyu.globals.$mouseX>40&&Tonyu.globals.$mouseX<Tonyu.globals.$screenWidth-40&&Tonyu.globals.$mouseY>40&&Tonyu.globals.$mouseY<Tonyu.globals.$screenHeight-200;return;
      
      
      _thread.retVal=_this;return;
    },
    drawPanel :function _trc_MapEditorOLD2_drawPanel() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=87009289;//kernel.MapEditorOLD2:9289
      Tonyu.globals.$panel.setFillStyle("gray");
      //$LASTPOS=87009323;//kernel.MapEditorOLD2:9323
      Tonyu.globals.$panel.alpha=128;
      //$LASTPOS=87009346;//kernel.MapEditorOLD2:9346
      Tonyu.globals.$panel.fillRect(0,0,Tonyu.globals.$screenWidth,40);
      //$LASTPOS=87009389;//kernel.MapEditorOLD2:9389
      Tonyu.globals.$panel.fillRect(0,0,40,Tonyu.globals.$screenHeight-160);
      //$LASTPOS=87009437;//kernel.MapEditorOLD2:9437
      Tonyu.globals.$panel.fillRect(Tonyu.globals.$screenWidth-40,0,40,Tonyu.globals.$screenHeight-160);
      //$LASTPOS=87009499;//kernel.MapEditorOLD2:9499
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-200,Tonyu.globals.$screenWidth,40);
      //$LASTPOS=87009558;//kernel.MapEditorOLD2:9558
      Tonyu.globals.$panel.alpha=255;
      //$LASTPOS=87009581;//kernel.MapEditorOLD2:9581
      Tonyu.globals.$panel.setFillStyle("black");
      //$LASTPOS=87009635;//kernel.MapEditorOLD2:9635
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=87009685;//kernel.MapEditorOLD2:9685
      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=87009737;//kernel.MapEditorOLD2:9737
      Tonyu.globals.$panel.fillRect(240,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=87009789;//kernel.MapEditorOLD2:9789
      Tonyu.globals.$panel.fillRect(360,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=87009841;//kernel.MapEditorOLD2:9841
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-80,120,80);
      //$LASTPOS=87009890;//kernel.MapEditorOLD2:9890
      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-80,120,80);
      //$LASTPOS=87009941;//kernel.MapEditorOLD2:9941
      Tonyu.globals.$panel.setFillStyle("white");
      //$LASTPOS=87009976;//kernel.MapEditorOLD2:9976
      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=87010027;//kernel.MapEditorOLD2:10027
      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=87010079;//kernel.MapEditorOLD2:10079
      Tonyu.globals.$panel.fillRect(250,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=87010131;//kernel.MapEditorOLD2:10131
      Tonyu.globals.$panel.fillRect(370,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=87010183;//kernel.MapEditorOLD2:10183
      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-70,100,60);
      //$LASTPOS=87010233;//kernel.MapEditorOLD2:10233
      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-70,100,60);
      //$LASTPOS=87010284;//kernel.MapEditorOLD2:10284
      Tonyu.globals.$panel.setFillStyle("black");
      //$LASTPOS=87010330;//kernel.MapEditorOLD2:10330
      Tonyu.globals.$panel.fillText("↑",Tonyu.globals.$screenWidth/2,30,40,"center");
      //$LASTPOS=87010387;//kernel.MapEditorOLD2:10387
      Tonyu.globals.$panel.fillText("←",20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
      //$LASTPOS=87010451;//kernel.MapEditorOLD2:10451
      Tonyu.globals.$panel.fillText("↓",Tonyu.globals.$screenWidth/2,Tonyu.globals.$screenHeight-160-10,40,"center");
      //$LASTPOS=87010526;//kernel.MapEditorOLD2:10526
      Tonyu.globals.$panel.fillText("→",Tonyu.globals.$screenWidth-20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
      //$LASTPOS=87010631;//kernel.MapEditorOLD2:10631
      Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=87010708;//kernel.MapEditorOLD2:10708
      Tonyu.globals.$panel.fillText("setOn",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
      //$LASTPOS=87010787;//kernel.MapEditorOLD2:10787
      Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=87010864;//kernel.MapEditorOLD2:10864
      Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=87010940;//kernel.MapEditorOLD2:10940
      Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
      //$LASTPOS=87011018;//kernel.MapEditorOLD2:11018
      Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
    },
    fiber$drawPanel :function _trc_MapEditorOLD2_f_drawPanel(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=87009289;//kernel.MapEditorOLD2:9289
      Tonyu.globals.$panel.setFillStyle("gray");
      //$LASTPOS=87009323;//kernel.MapEditorOLD2:9323
      Tonyu.globals.$panel.alpha=128;
      //$LASTPOS=87009346;//kernel.MapEditorOLD2:9346
      Tonyu.globals.$panel.fillRect(0,0,Tonyu.globals.$screenWidth,40);
      //$LASTPOS=87009389;//kernel.MapEditorOLD2:9389
      Tonyu.globals.$panel.fillRect(0,0,40,Tonyu.globals.$screenHeight-160);
      //$LASTPOS=87009437;//kernel.MapEditorOLD2:9437
      Tonyu.globals.$panel.fillRect(Tonyu.globals.$screenWidth-40,0,40,Tonyu.globals.$screenHeight-160);
      //$LASTPOS=87009499;//kernel.MapEditorOLD2:9499
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-200,Tonyu.globals.$screenWidth,40);
      //$LASTPOS=87009558;//kernel.MapEditorOLD2:9558
      Tonyu.globals.$panel.alpha=255;
      //$LASTPOS=87009581;//kernel.MapEditorOLD2:9581
      Tonyu.globals.$panel.setFillStyle("black");
      //$LASTPOS=87009635;//kernel.MapEditorOLD2:9635
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=87009685;//kernel.MapEditorOLD2:9685
      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=87009737;//kernel.MapEditorOLD2:9737
      Tonyu.globals.$panel.fillRect(240,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=87009789;//kernel.MapEditorOLD2:9789
      Tonyu.globals.$panel.fillRect(360,Tonyu.globals.$screenHeight-160,120,80);
      //$LASTPOS=87009841;//kernel.MapEditorOLD2:9841
      Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-80,120,80);
      //$LASTPOS=87009890;//kernel.MapEditorOLD2:9890
      Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-80,120,80);
      //$LASTPOS=87009941;//kernel.MapEditorOLD2:9941
      Tonyu.globals.$panel.setFillStyle("white");
      //$LASTPOS=87009976;//kernel.MapEditorOLD2:9976
      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=87010027;//kernel.MapEditorOLD2:10027
      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=87010079;//kernel.MapEditorOLD2:10079
      Tonyu.globals.$panel.fillRect(250,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=87010131;//kernel.MapEditorOLD2:10131
      Tonyu.globals.$panel.fillRect(370,Tonyu.globals.$screenHeight-150,100,60);
      //$LASTPOS=87010183;//kernel.MapEditorOLD2:10183
      Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-70,100,60);
      //$LASTPOS=87010233;//kernel.MapEditorOLD2:10233
      Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-70,100,60);
      //$LASTPOS=87010284;//kernel.MapEditorOLD2:10284
      Tonyu.globals.$panel.setFillStyle("black");
      //$LASTPOS=87010330;//kernel.MapEditorOLD2:10330
      Tonyu.globals.$panel.fillText("↑",Tonyu.globals.$screenWidth/2,30,40,"center");
      //$LASTPOS=87010387;//kernel.MapEditorOLD2:10387
      Tonyu.globals.$panel.fillText("←",20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
      //$LASTPOS=87010451;//kernel.MapEditorOLD2:10451
      Tonyu.globals.$panel.fillText("↓",Tonyu.globals.$screenWidth/2,Tonyu.globals.$screenHeight-160-10,40,"center");
      //$LASTPOS=87010526;//kernel.MapEditorOLD2:10526
      Tonyu.globals.$panel.fillText("→",Tonyu.globals.$screenWidth-20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
      //$LASTPOS=87010631;//kernel.MapEditorOLD2:10631
      Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=87010708;//kernel.MapEditorOLD2:10708
      Tonyu.globals.$panel.fillText("setOn",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
      //$LASTPOS=87010787;//kernel.MapEditorOLD2:10787
      Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=87010864;//kernel.MapEditorOLD2:10864
      Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
      //$LASTPOS=87010940;//kernel.MapEditorOLD2:10940
      Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
      //$LASTPOS=87011018;//kernel.MapEditorOLD2:11018
      Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"inRect":{"nowait":false},"drawPanel":{"nowait":false}},"fields":{"i":{},"j":{},"loadMode":{},"fileExist":{},"fileList":{},"fNames":{},"fileName":{},"mapDataFile":{},"baseData":{},"loadedFile":{},"mapData":{},"mapOnData":{},"chipWidth":{},"chipHeight":{},"row":{},"col":{},"panel":{},"mIW":{},"mIH":{},"mCW":{},"mCH":{},"counter":{},"mode":{},"prevMode":{},"mapp":{},"mx":{},"my":{},"chipX":{},"chipY":{},"saveFileName":{},"saveDataFile":{},"data":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Pad',
  shortName: 'Pad',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_Pad_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=88001202;//kernel.Pad:1202
      _this.APAD_DIAG_SIZE=96;
      //$LASTPOS=88003465;//kernel.Pad:3465
      while (true) {
        //$LASTPOS=88003484;//kernel.Pad:3484
        _this.padUpdate();
        //$LASTPOS=88003502;//kernel.Pad:3502
        _this.update();
        
      }
    },
    fiber$main :function _trc_Pad_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=88001202;//kernel.Pad:1202
      _this.APAD_DIAG_SIZE=96;
      
      _thread.enter(function _trc_Pad_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=88003465;//kernel.Pad:3465
          case 1:
            //$LASTPOS=88003484;//kernel.Pad:3484
            _this.fiber$padUpdate(_thread);
            __pc=2;return;
          case 2:
            
            //$LASTPOS=88003502;//kernel.Pad:3502
            _this.fiber$update(_thread);
            __pc=3;return;
          case 3:
            
            __pc=1;break;
          case 4     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    initialize :function _trc_Pad_initialize(opt) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=88000033;//kernel.Pad:33
      Tonyu.classes.kernel.Actor.apply( _this, [opt]);
      //$LASTPOS=88000050;//kernel.Pad:50
      _this.padImageP=Tonyu.globals.$pat_inputPad;
      //$LASTPOS=88000082;//kernel.Pad:82
      _this.jujiKey=new Tonyu.classes.kernel.Actor({x: 96+1,y: Tonyu.globals.$screenHeight-96-1,p: _this.padImageP+0,zOrder: - 9,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=88000183;//kernel.Pad:183
      _this.no1Key=new Tonyu.classes.kernel.Actor({x: Tonyu.globals.$screenWidth-96,y: Tonyu.globals.$screenHeight-96,p: _this.padImageP+1,zOrder: - 9,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=88000292;//kernel.Pad:292
      _this.jujiKey.show();
      //$LASTPOS=88000313;//kernel.Pad:313
      _this.no1Key.show();
      //$LASTPOS=88000339;//kernel.Pad:339
      _this.jujiKeyPushU=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y-60,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=88000446;//kernel.Pad:446
      _this.jujiKeyPushL=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x-60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=88000553;//kernel.Pad:553
      _this.jujiKeyPushR=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x+60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=88000660;//kernel.Pad:660
      _this.jujiKeyPushD=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y+60,p: _this.padImageP+2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=88000767;//kernel.Pad:767
      _this.jujiKeyPush1=new Tonyu.classes.kernel.Actor({x: _this.no1Key.x,y: _this.no1Key.y,p: _this.padImageP+2,scaleX: 2,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=88000879;//kernel.Pad:879
      _this.jujiKeyPushU.hide();
      //$LASTPOS=88000905;//kernel.Pad:905
      _this.jujiKeyPushL.hide();
      //$LASTPOS=88000931;//kernel.Pad:931
      _this.jujiKeyPushR.hide();
      //$LASTPOS=88000957;//kernel.Pad:957
      _this.jujiKeyPushD.hide();
      //$LASTPOS=88000983;//kernel.Pad:983
      _this.jujiKeyPush1.hide();
    },
    die :function _trc_Pad_die() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=88001021;//kernel.Pad:1021
      _this.jujiKey.die();
      //$LASTPOS=88001041;//kernel.Pad:1041
      _this.no1Key.die();
      //$LASTPOS=88001060;//kernel.Pad:1060
      _this.jujiKeyPushU.die();
      //$LASTPOS=88001085;//kernel.Pad:1085
      _this.jujiKeyPushL.die();
      //$LASTPOS=88001110;//kernel.Pad:1110
      _this.jujiKeyPushR.die();
      //$LASTPOS=88001135;//kernel.Pad:1135
      _this.jujiKeyPushD.die();
      //$LASTPOS=88001160;//kernel.Pad:1160
      _this.jujiKeyPush1.die();
      //$LASTPOS=88001185;//kernel.Pad:1185
      Tonyu.classes.kernel.Actor.prototype.die.apply( _this, []);
    },
    padUpdate :function _trc_Pad_padUpdate() {
      "use strict";
      var _this=this;
      var i;
      var t;
      
      //$LASTPOS=88001258;//kernel.Pad:1258
      _this.keyPushL=0;
      //$LASTPOS=88001277;//kernel.Pad:1277
      _this.keyPushR=0;
      //$LASTPOS=88001296;//kernel.Pad:1296
      _this.keyPushU=0;
      //$LASTPOS=88001315;//kernel.Pad:1315
      _this.keyPushD=0;
      //$LASTPOS=88001334;//kernel.Pad:1334
      _this.keyPush1=0;
      //$LASTPOS=88001359;//kernel.Pad:1359
      _this.padKeyNotapCnt++;
      //$LASTPOS=88001383;//kernel.Pad:1383
      //$LASTPOS=88001388;//kernel.Pad:1388
      i = 0;
      for (; i<5 ; i++) {
        {
          //$LASTPOS=88001436;//kernel.Pad:1436
          t = Tonyu.globals.$touches[i];
          
          //$LASTPOS=88001466;//kernel.Pad:1466
          if (t.touched) {
            //$LASTPOS=88001496;//kernel.Pad:1496
            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {
              //$LASTPOS=88001593;//kernel.Pad:1593
              _this.keyPushU=1;
            }
            //$LASTPOS=88001620;//kernel.Pad:1620
            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {
              //$LASTPOS=88001717;//kernel.Pad:1717
              _this.keyPushD=1;
            }
            //$LASTPOS=88001744;//kernel.Pad:1744
            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {
              //$LASTPOS=88001841;//kernel.Pad:1841
              _this.keyPushL=1;
            }
            //$LASTPOS=88001868;//kernel.Pad:1868
            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {
              //$LASTPOS=88001965;//kernel.Pad:1965
              _this.keyPushR=1;
            }
            //$LASTPOS=88001992;//kernel.Pad:1992
            if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {
              //$LASTPOS=88002054;//kernel.Pad:2054
              _this.keyPush1=1;
            }
            //$LASTPOS=88002081;//kernel.Pad:2081
            _this.padKeySW=1;
            //$LASTPOS=88002108;//kernel.Pad:2108
            _this.padKeyNotapCnt=0;
            
          }
        }
      }
      //$LASTPOS=88002173;//kernel.Pad:2173
      if (_this.keyPushL) {
        //$LASTPOS=88002187;//kernel.Pad:2187
        _this.keyCntL++;
      } else {
        //$LASTPOS=88002204;//kernel.Pad:2204
        _this.keyCntL=0;
      }
      //$LASTPOS=88002222;//kernel.Pad:2222
      if (_this.keyPushR) {
        //$LASTPOS=88002236;//kernel.Pad:2236
        _this.keyCntR++;
      } else {
        //$LASTPOS=88002253;//kernel.Pad:2253
        _this.keyCntR=0;
      }
      //$LASTPOS=88002271;//kernel.Pad:2271
      if (_this.keyPushU) {
        //$LASTPOS=88002285;//kernel.Pad:2285
        _this.keyCntU++;
      } else {
        //$LASTPOS=88002302;//kernel.Pad:2302
        _this.keyCntU=0;
      }
      //$LASTPOS=88002320;//kernel.Pad:2320
      if (_this.keyPushD) {
        //$LASTPOS=88002334;//kernel.Pad:2334
        _this.keyCntD++;
      } else {
        //$LASTPOS=88002351;//kernel.Pad:2351
        _this.keyCntD=0;
      }
      //$LASTPOS=88002369;//kernel.Pad:2369
      if (_this.keyPush1) {
        //$LASTPOS=88002383;//kernel.Pad:2383
        _this.keyCnt1++;
      } else {
        //$LASTPOS=88002400;//kernel.Pad:2400
        _this.keyCnt1=0;
      }
      //$LASTPOS=88002435;//kernel.Pad:2435
      if (_this.keyPushL) {
        //$LASTPOS=88002449;//kernel.Pad:2449
        _this.jujiKeyPushL.show();
      } else {
        //$LASTPOS=88002475;//kernel.Pad:2475
        _this.jujiKeyPushL.hide();
      }
      //$LASTPOS=88002501;//kernel.Pad:2501
      if (_this.keyPushR) {
        //$LASTPOS=88002515;//kernel.Pad:2515
        _this.jujiKeyPushR.show();
      } else {
        //$LASTPOS=88002541;//kernel.Pad:2541
        _this.jujiKeyPushR.hide();
      }
      //$LASTPOS=88002567;//kernel.Pad:2567
      if (_this.keyPushU) {
        //$LASTPOS=88002581;//kernel.Pad:2581
        _this.jujiKeyPushU.show();
      } else {
        //$LASTPOS=88002607;//kernel.Pad:2607
        _this.jujiKeyPushU.hide();
      }
      //$LASTPOS=88002633;//kernel.Pad:2633
      if (_this.keyPushD) {
        //$LASTPOS=88002647;//kernel.Pad:2647
        _this.jujiKeyPushD.show();
      } else {
        //$LASTPOS=88002673;//kernel.Pad:2673
        _this.jujiKeyPushD.hide();
      }
      //$LASTPOS=88002699;//kernel.Pad:2699
      if (_this.keyPush1) {
        //$LASTPOS=88002713;//kernel.Pad:2713
        _this.jujiKeyPush1.show();
      } else {
        //$LASTPOS=88002739;//kernel.Pad:2739
        _this.jujiKeyPush1.hide();
      }
    },
    fiber$padUpdate :function _trc_Pad_f_padUpdate(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var i;
      var t;
      
      //$LASTPOS=88001258;//kernel.Pad:1258
      _this.keyPushL=0;
      //$LASTPOS=88001277;//kernel.Pad:1277
      _this.keyPushR=0;
      //$LASTPOS=88001296;//kernel.Pad:1296
      _this.keyPushU=0;
      //$LASTPOS=88001315;//kernel.Pad:1315
      _this.keyPushD=0;
      //$LASTPOS=88001334;//kernel.Pad:1334
      _this.keyPush1=0;
      //$LASTPOS=88001359;//kernel.Pad:1359
      _this.padKeyNotapCnt++;
      //$LASTPOS=88001383;//kernel.Pad:1383
      //$LASTPOS=88001388;//kernel.Pad:1388
      i = 0;
      for (; i<5 ; i++) {
        {
          //$LASTPOS=88001436;//kernel.Pad:1436
          t = Tonyu.globals.$touches[i];
          
          //$LASTPOS=88001466;//kernel.Pad:1466
          if (t.touched) {
            //$LASTPOS=88001496;//kernel.Pad:1496
            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {
              //$LASTPOS=88001593;//kernel.Pad:1593
              _this.keyPushU=1;
            }
            //$LASTPOS=88001620;//kernel.Pad:1620
            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {
              //$LASTPOS=88001717;//kernel.Pad:1717
              _this.keyPushD=1;
            }
            //$LASTPOS=88001744;//kernel.Pad:1744
            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {
              //$LASTPOS=88001841;//kernel.Pad:1841
              _this.keyPushL=1;
            }
            //$LASTPOS=88001868;//kernel.Pad:1868
            if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {
              //$LASTPOS=88001965;//kernel.Pad:1965
              _this.keyPushR=1;
            }
            //$LASTPOS=88001992;//kernel.Pad:1992
            if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {
              //$LASTPOS=88002054;//kernel.Pad:2054
              _this.keyPush1=1;
            }
            //$LASTPOS=88002081;//kernel.Pad:2081
            _this.padKeySW=1;
            //$LASTPOS=88002108;//kernel.Pad:2108
            _this.padKeyNotapCnt=0;
            
          }
        }
      }
      //$LASTPOS=88002173;//kernel.Pad:2173
      if (_this.keyPushL) {
        //$LASTPOS=88002187;//kernel.Pad:2187
        _this.keyCntL++;
      } else {
        //$LASTPOS=88002204;//kernel.Pad:2204
        _this.keyCntL=0;
      }
      //$LASTPOS=88002222;//kernel.Pad:2222
      if (_this.keyPushR) {
        //$LASTPOS=88002236;//kernel.Pad:2236
        _this.keyCntR++;
      } else {
        //$LASTPOS=88002253;//kernel.Pad:2253
        _this.keyCntR=0;
      }
      //$LASTPOS=88002271;//kernel.Pad:2271
      if (_this.keyPushU) {
        //$LASTPOS=88002285;//kernel.Pad:2285
        _this.keyCntU++;
      } else {
        //$LASTPOS=88002302;//kernel.Pad:2302
        _this.keyCntU=0;
      }
      //$LASTPOS=88002320;//kernel.Pad:2320
      if (_this.keyPushD) {
        //$LASTPOS=88002334;//kernel.Pad:2334
        _this.keyCntD++;
      } else {
        //$LASTPOS=88002351;//kernel.Pad:2351
        _this.keyCntD=0;
      }
      //$LASTPOS=88002369;//kernel.Pad:2369
      if (_this.keyPush1) {
        //$LASTPOS=88002383;//kernel.Pad:2383
        _this.keyCnt1++;
      } else {
        //$LASTPOS=88002400;//kernel.Pad:2400
        _this.keyCnt1=0;
      }
      //$LASTPOS=88002435;//kernel.Pad:2435
      if (_this.keyPushL) {
        //$LASTPOS=88002449;//kernel.Pad:2449
        _this.jujiKeyPushL.show();
      } else {
        //$LASTPOS=88002475;//kernel.Pad:2475
        _this.jujiKeyPushL.hide();
      }
      //$LASTPOS=88002501;//kernel.Pad:2501
      if (_this.keyPushR) {
        //$LASTPOS=88002515;//kernel.Pad:2515
        _this.jujiKeyPushR.show();
      } else {
        //$LASTPOS=88002541;//kernel.Pad:2541
        _this.jujiKeyPushR.hide();
      }
      //$LASTPOS=88002567;//kernel.Pad:2567
      if (_this.keyPushU) {
        //$LASTPOS=88002581;//kernel.Pad:2581
        _this.jujiKeyPushU.show();
      } else {
        //$LASTPOS=88002607;//kernel.Pad:2607
        _this.jujiKeyPushU.hide();
      }
      //$LASTPOS=88002633;//kernel.Pad:2633
      if (_this.keyPushD) {
        //$LASTPOS=88002647;//kernel.Pad:2647
        _this.jujiKeyPushD.show();
      } else {
        //$LASTPOS=88002673;//kernel.Pad:2673
        _this.jujiKeyPushD.hide();
      }
      //$LASTPOS=88002699;//kernel.Pad:2699
      if (_this.keyPush1) {
        //$LASTPOS=88002713;//kernel.Pad:2713
        _this.jujiKeyPush1.show();
      } else {
        //$LASTPOS=88002739;//kernel.Pad:2739
        _this.jujiKeyPush1.hide();
      }
      
      _thread.retVal=_this;return;
    },
    getPadUp :function _trc_Pad_getPadUp() {
      "use strict";
      var _this=this;
      
      return _this.keyCntU;
    },
    fiber$getPadUp :function _trc_Pad_f_getPadUp(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.keyCntU;return;
      
      
      _thread.retVal=_this;return;
    },
    getPadDown :function _trc_Pad_getPadDown() {
      "use strict";
      var _this=this;
      
      return _this.keyCntD;
    },
    fiber$getPadDown :function _trc_Pad_f_getPadDown(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.keyCntD;return;
      
      
      _thread.retVal=_this;return;
    },
    getPadLeft :function _trc_Pad_getPadLeft() {
      "use strict";
      var _this=this;
      
      return _this.keyCntL;
    },
    fiber$getPadLeft :function _trc_Pad_f_getPadLeft(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.keyCntL;return;
      
      
      _thread.retVal=_this;return;
    },
    getPadRight :function _trc_Pad_getPadRight() {
      "use strict";
      var _this=this;
      
      return _this.keyCntR;
    },
    fiber$getPadRight :function _trc_Pad_f_getPadRight(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.keyCntR;return;
      
      
      _thread.retVal=_this;return;
    },
    getPadButton :function _trc_Pad_getPadButton(i) {
      "use strict";
      var _this=this;
      var value;
      
      
      //$LASTPOS=88002956;//kernel.Pad:2956
      if (i==0) {
        //$LASTPOS=88002968;//kernel.Pad:2968
        value=_this.keyCnt1;
      }
      return value;
    },
    fiber$getPadButton :function _trc_Pad_f_getPadButton(_thread,i) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var value;
      
      
      //$LASTPOS=88002956;//kernel.Pad:2956
      if (i==0) {
        //$LASTPOS=88002968;//kernel.Pad:2968
        value=_this.keyCnt1;
      }
      _thread.retVal=value;return;
      
      
      _thread.retVal=_this;return;
    },
    getUp :function _trc_Pad_getUp() {
      "use strict";
      var _this=this;
      
      return _this.keyCntU;
    },
    fiber$getUp :function _trc_Pad_f_getUp(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.keyCntU;return;
      
      
      _thread.retVal=_this;return;
    },
    getDown :function _trc_Pad_getDown() {
      "use strict";
      var _this=this;
      
      return _this.keyCntD;
    },
    fiber$getDown :function _trc_Pad_f_getDown(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.keyCntD;return;
      
      
      _thread.retVal=_this;return;
    },
    getLeft :function _trc_Pad_getLeft() {
      "use strict";
      var _this=this;
      
      return _this.keyCntL;
    },
    fiber$getLeft :function _trc_Pad_f_getLeft(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.keyCntL;return;
      
      
      _thread.retVal=_this;return;
    },
    getRight :function _trc_Pad_getRight() {
      "use strict";
      var _this=this;
      
      return _this.keyCntR;
    },
    fiber$getRight :function _trc_Pad_f_getRight(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=_this.keyCntR;return;
      
      
      _thread.retVal=_this;return;
    },
    getButton :function _trc_Pad_getButton(i) {
      "use strict";
      var _this=this;
      var value;
      
      
      //$LASTPOS=88003179;//kernel.Pad:3179
      if (i==0) {
        //$LASTPOS=88003191;//kernel.Pad:3191
        value=_this.keyCnt1;
      }
      return value;
    },
    fiber$getButton :function _trc_Pad_f_getButton(_thread,i) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var value;
      
      
      //$LASTPOS=88003179;//kernel.Pad:3179
      if (i==0) {
        //$LASTPOS=88003191;//kernel.Pad:3191
        value=_this.keyCnt1;
      }
      _thread.retVal=value;return;
      
      
      _thread.retVal=_this;return;
    },
    isOnRect :function _trc_Pad_isOnRect(mx,my,rx,ry,rx2,ry2) {
      "use strict";
      var _this=this;
      
      return (rx<=mx&&mx<rx2&&ry<=my&&my<ry2);
    },
    fiber$isOnRect :function _trc_Pad_f_isOnRect(_thread,mx,my,rx,ry,rx2,ry2) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=(rx<=mx&&mx<rx2&&ry<=my&&my<ry2);return;
      
      
      _thread.retVal=_this;return;
    },
    isOnRectWH :function _trc_Pad_isOnRectWH(mx,my,rx,ry,rw,rh) {
      "use strict";
      var _this=this;
      
      return (rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);
    },
    fiber$isOnRectWH :function _trc_Pad_f_isOnRectWH(_thread,mx,my,rx,ry,rw,rh) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      _thread.retVal=(rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"die":{"nowait":true},"padUpdate":{"nowait":false},"getPadUp":{"nowait":false},"getPadDown":{"nowait":false},"getPadLeft":{"nowait":false},"getPadRight":{"nowait":false},"getPadButton":{"nowait":false},"getUp":{"nowait":false},"getDown":{"nowait":false},"getLeft":{"nowait":false},"getRight":{"nowait":false},"getButton":{"nowait":false},"isOnRect":{"nowait":false},"isOnRectWH":{"nowait":false}},"fields":{"APAD_DIAG_SIZE":{},"padImageP":{},"jujiKey":{},"no1Key":{},"jujiKeyPushU":{},"jujiKeyPushL":{},"jujiKeyPushR":{},"jujiKeyPushD":{},"jujiKeyPush1":{},"keyPushL":{},"keyPushR":{},"keyPushU":{},"keyPushD":{},"keyPush1":{},"padKeyNotapCnt":{},"padKeySW":{},"keyCntL":{},"keyCntR":{},"keyCntU":{},"keyCntD":{},"keyCnt1":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.UILayout',
  shortName: 'UILayout',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_UILayout_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=89000018;//kernel.UILayout:18
      _this.doLayout();
      //$LASTPOS=89000031;//kernel.UILayout:31
      Tonyu.globals.$Screen.on("resize",Tonyu.bindFunc(_this,_this.doLayout));
      //$LASTPOS=89000063;//kernel.UILayout:63
      Tonyu.globals.$uiScreen.on("resize",Tonyu.bindFunc(_this,_this.doLayout));
    },
    fiber$main :function _trc_UILayout_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_UILayout_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=89000018;//kernel.UILayout:18
            _this.fiber$doLayout(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=89000031;//kernel.UILayout:31
            Tonyu.globals.$Screen.on("resize",Tonyu.bindFunc(_this,_this.doLayout));
            //$LASTPOS=89000063;//kernel.UILayout:63
            Tonyu.globals.$uiScreen.on("resize",Tonyu.bindFunc(_this,_this.doLayout));
            _thread.exit(_this);return;
          }
        }
      });
    },
    doLayout :function _trc_UILayout_doLayout() {
      "use strict";
      var _this=this;
      var cw;
      var ch;
      var width;
      var height;
      var calcw;
      var calch;
      var scl;
      var isPC;
      
      //$LASTPOS=89000116;//kernel.UILayout:116
      cw = Tonyu.globals.$uiScreen.width;
      
      //$LASTPOS=89000145;//kernel.UILayout:145
      ch = Tonyu.globals.$uiScreen.height;
      
      //$LASTPOS=89000175;//kernel.UILayout:175
      width = Tonyu.globals.$Screen.width;
      
      //$LASTPOS=89000205;//kernel.UILayout:205
      height = Tonyu.globals.$Screen.height;
      
      //$LASTPOS=89000243;//kernel.UILayout:243
      calcw = ch/height*width;
      
      //$LASTPOS=89000295;//kernel.UILayout:295
      calch = cw/width*height;
      
      //$LASTPOS=89000347;//kernel.UILayout:347
      if (calch>ch) {
        //$LASTPOS=89000361;//kernel.UILayout:361
        calch=ch;
      }
      //$LASTPOS=89000376;//kernel.UILayout:376
      if (calcw>cw) {
        //$LASTPOS=89000390;//kernel.UILayout:390
        calcw=cw;
      }
      //$LASTPOS=89000405;//kernel.UILayout:405
      scl = 1;
      
      //$LASTPOS=89000421;//kernel.UILayout:421
      isPC = ! (Tonyu.globals.$Navigator.isTablet()||Tonyu.globals.$Navigator.isMobile());
      
      //$LASTPOS=89000486;//kernel.UILayout:486
      if (isPC&&_this.shouldDraw1x1(width,height,calcw,calch)) {
        //$LASTPOS=89000548;//kernel.UILayout:548
        calcw=width;
        //$LASTPOS=89000560;//kernel.UILayout:560
        calch=height;
        //$LASTPOS=89000583;//kernel.UILayout:583
        Tonyu.globals.$Screen.scaleX=1;
        
      } else {
        //$LASTPOS=89000624;//kernel.UILayout:624
        Tonyu.globals.$Screen.scaleX=calcw/width;
        
      }
      //$LASTPOS=89000668;//kernel.UILayout:668
      Tonyu.globals.$Screen.x=_this.trunc(cw/2)+width/2%1;
      //$LASTPOS=89000706;//kernel.UILayout:706
      Tonyu.globals.$Screen.y=_this.trunc(ch/2)+height/2%1;
    },
    fiber$doLayout :function _trc_UILayout_f_doLayout(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var cw;
      var ch;
      var width;
      var height;
      var calcw;
      var calch;
      var scl;
      var isPC;
      
      //$LASTPOS=89000116;//kernel.UILayout:116
      cw = Tonyu.globals.$uiScreen.width;
      
      //$LASTPOS=89000145;//kernel.UILayout:145
      ch = Tonyu.globals.$uiScreen.height;
      
      //$LASTPOS=89000175;//kernel.UILayout:175
      width = Tonyu.globals.$Screen.width;
      
      //$LASTPOS=89000205;//kernel.UILayout:205
      height = Tonyu.globals.$Screen.height;
      
      //$LASTPOS=89000243;//kernel.UILayout:243
      calcw = ch/height*width;
      
      //$LASTPOS=89000295;//kernel.UILayout:295
      calch = cw/width*height;
      
      //$LASTPOS=89000347;//kernel.UILayout:347
      if (calch>ch) {
        //$LASTPOS=89000361;//kernel.UILayout:361
        calch=ch;
      }
      //$LASTPOS=89000376;//kernel.UILayout:376
      if (calcw>cw) {
        //$LASTPOS=89000390;//kernel.UILayout:390
        calcw=cw;
      }
      //$LASTPOS=89000405;//kernel.UILayout:405
      scl = 1;
      
      //$LASTPOS=89000421;//kernel.UILayout:421
      isPC = ! (Tonyu.globals.$Navigator.isTablet()||Tonyu.globals.$Navigator.isMobile());
      
      //$LASTPOS=89000486;//kernel.UILayout:486
      if (isPC&&_this.shouldDraw1x1(width,height,calcw,calch)) {
        //$LASTPOS=89000548;//kernel.UILayout:548
        calcw=width;
        //$LASTPOS=89000560;//kernel.UILayout:560
        calch=height;
        //$LASTPOS=89000583;//kernel.UILayout:583
        Tonyu.globals.$Screen.scaleX=1;
        
      } else {
        //$LASTPOS=89000624;//kernel.UILayout:624
        Tonyu.globals.$Screen.scaleX=calcw/width;
        
      }
      //$LASTPOS=89000668;//kernel.UILayout:668
      Tonyu.globals.$Screen.x=_this.trunc(cw/2)+width/2%1;
      //$LASTPOS=89000706;//kernel.UILayout:706
      Tonyu.globals.$Screen.y=_this.trunc(ch/2)+height/2%1;
      
      _thread.retVal=_this;return;
    },
    shouldDraw1x1 :function _trc_UILayout_shouldDraw1x1(srcw,srch,dstw,dsth) {
      "use strict";
      var _this=this;
      var larger;
      var smaller;
      
      //$LASTPOS=89000832;//kernel.UILayout:832
      larger = 100;
      
      //$LASTPOS=89000853;//kernel.UILayout:853
      smaller = 0;
      
      return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;
    },
    fiber$shouldDraw1x1 :function _trc_UILayout_f_shouldDraw1x1(_thread,srcw,srch,dstw,dsth) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var larger;
      var smaller;
      
      //$LASTPOS=89000832;//kernel.UILayout:832
      larger = 100;
      
      //$LASTPOS=89000853;//kernel.UILayout:853
      smaller = 0;
      
      _thread.retVal=srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;return;
      
      
      _thread.retVal=_this;return;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"doLayout":{"nowait":false},"shouldDraw1x1":{"nowait":false}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.WebPage',
  shortName: 'WebPage',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: {
    main :function _trc_WebPage_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=90000080;//kernel.WebPage:80
      _this.eventWindowOpen=(function anonymous_98(e) {
        
        //$LASTPOS=90000161;//kernel.WebPage:161
        window.open(_this.postUrl);
        //$LASTPOS=90000188;//kernel.WebPage:188
        if (_this.canvas.removeEventListener) {
          //$LASTPOS=90000231;//kernel.WebPage:231
          _this.canvas.removeEventListener("click",_this.eventWindowOpen,false);
          //$LASTPOS=90000301;//kernel.WebPage:301
          _this.canvas.removeEventListener("touchend",_this.eventWindowOpen,false);
          //$LASTPOS=90000374;//kernel.WebPage:374
          _this.listenerExists=false;
          
        } else {
          //$LASTPOS=90000410;//kernel.WebPage:410
          if (_this.canvas.detachEvent) {
            //$LASTPOS=90000444;//kernel.WebPage:444
            _this.canvas.detachEvent("onclick",_this.eventWindowOpen);
            //$LASTPOS=90000501;//kernel.WebPage:501
            _this.canvas.detachEvent("touchend",_this.eventWindowOpen);
            //$LASTPOS=90000559;//kernel.WebPage:559
            _this.listenerExists=false;
            
          }
        }
      });
    },
    fiber$main :function _trc_WebPage_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=90000080;//kernel.WebPage:80
      _this.eventWindowOpen=(function anonymous_98(e) {
        
        //$LASTPOS=90000161;//kernel.WebPage:161
        window.open(_this.postUrl);
        //$LASTPOS=90000188;//kernel.WebPage:188
        if (_this.canvas.removeEventListener) {
          //$LASTPOS=90000231;//kernel.WebPage:231
          _this.canvas.removeEventListener("click",_this.eventWindowOpen,false);
          //$LASTPOS=90000301;//kernel.WebPage:301
          _this.canvas.removeEventListener("touchend",_this.eventWindowOpen,false);
          //$LASTPOS=90000374;//kernel.WebPage:374
          _this.listenerExists=false;
          
        } else {
          //$LASTPOS=90000410;//kernel.WebPage:410
          if (_this.canvas.detachEvent) {
            //$LASTPOS=90000444;//kernel.WebPage:444
            _this.canvas.detachEvent("onclick",_this.eventWindowOpen);
            //$LASTPOS=90000501;//kernel.WebPage:501
            _this.canvas.detachEvent("touchend",_this.eventWindowOpen);
            //$LASTPOS=90000559;//kernel.WebPage:559
            _this.listenerExists=false;
            
          }
        }
      });
      
      _thread.retVal=_this;return;
    },
    openNewWindow :function _trc_WebPage_openNewWindow(url) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=90000624;//kernel.WebPage:624
      _this.postUrl=url;
      //$LASTPOS=90000704;//kernel.WebPage:704
      _this.canvas=document.getElementsByTagName("canvas")[0];
      //$LASTPOS=90000760;//kernel.WebPage:760
      if (! _this.listenerExists) {
        //$LASTPOS=90000792;//kernel.WebPage:792
        if (_this.canvas.addEventListener) {
          //$LASTPOS=90000836;//kernel.WebPage:836
          _this.canvas.addEventListener("click",_this.eventWindowOpen,false);
          //$LASTPOS=90000907;//kernel.WebPage:907
          _this.canvas.addEventListener("touchend",_this.eventWindowOpen,false);
          //$LASTPOS=90001050;//kernel.WebPage:1050
          _this.listenerExists=true;
          
        } else {
          //$LASTPOS=90001089;//kernel.WebPage:1089
          if (_this.canvas.attachEvent) {
            //$LASTPOS=90001127;//kernel.WebPage:1127
            _this.canvas.attachEvent("onclick",_this.eventWindowOpen);
            //$LASTPOS=90001188;//kernel.WebPage:1188
            _this.canvas.attachEvent("touchend",_this.eventWindowOpen);
            //$LASTPOS=90001250;//kernel.WebPage:1250
            _this.listenerExists=true;
            
          }
        }
        
      }
    },
    fiber$openNewWindow :function _trc_WebPage_f_openNewWindow(_thread,url) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=90000624;//kernel.WebPage:624
      _this.postUrl=url;
      //$LASTPOS=90000704;//kernel.WebPage:704
      _this.canvas=document.getElementsByTagName("canvas")[0];
      //$LASTPOS=90000760;//kernel.WebPage:760
      if (! _this.listenerExists) {
        //$LASTPOS=90000792;//kernel.WebPage:792
        if (_this.canvas.addEventListener) {
          //$LASTPOS=90000836;//kernel.WebPage:836
          _this.canvas.addEventListener("click",_this.eventWindowOpen,false);
          //$LASTPOS=90000907;//kernel.WebPage:907
          _this.canvas.addEventListener("touchend",_this.eventWindowOpen,false);
          //$LASTPOS=90001050;//kernel.WebPage:1050
          _this.listenerExists=true;
          
        } else {
          //$LASTPOS=90001089;//kernel.WebPage:1089
          if (_this.canvas.attachEvent) {
            //$LASTPOS=90001127;//kernel.WebPage:1127
            _this.canvas.attachEvent("onclick",_this.eventWindowOpen);
            //$LASTPOS=90001188;//kernel.WebPage:1188
            _this.canvas.attachEvent("touchend",_this.eventWindowOpen);
            //$LASTPOS=90001250;//kernel.WebPage:1250
            _this.listenerExists=true;
            
          }
        }
        
      }
      
      _thread.retVal=_this;return;
    },
    openPage :function _trc_WebPage_openPage(url) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=90001319;//kernel.WebPage:1319
      window.location.href=url;
    },
    fiber$openPage :function _trc_WebPage_f_openPage(_thread,url) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=90001319;//kernel.WebPage:1319
      window.location.href=url;
      
      _thread.retVal=_this;return;
    },
    openTweet :function _trc_WebPage_openTweet(text,url,hashtags,via,related,tl) {
      "use strict";
      var _this=this;
      var sendUrl;
      
      //$LASTPOS=90001902;//kernel.WebPage:1902
      sendUrl = "https://twitter.com/intent/tweet?";
      
      //$LASTPOS=90001958;//kernel.WebPage:1958
      sendUrl+="text="+encodeURIComponent(text);
      //$LASTPOS=90002010;//kernel.WebPage:2010
      if (url!=null) {
        //$LASTPOS=90002038;//kernel.WebPage:2038
        sendUrl+="&";
        //$LASTPOS=90002063;//kernel.WebPage:2063
        sendUrl+="url="+encodeURIComponent(url);
        
      }
      //$LASTPOS=90002120;//kernel.WebPage:2120
      if (hashtags!=null) {
        //$LASTPOS=90002153;//kernel.WebPage:2153
        sendUrl+="&";
        //$LASTPOS=90002178;//kernel.WebPage:2178
        sendUrl+="hashtags="+encodeURIComponent(hashtags);
        
      }
      //$LASTPOS=90002245;//kernel.WebPage:2245
      if (via!=null) {
        //$LASTPOS=90002273;//kernel.WebPage:2273
        sendUrl+="&";
        //$LASTPOS=90002298;//kernel.WebPage:2298
        sendUrl+="via="+encodeURIComponent(via);
        
      }
      //$LASTPOS=90002355;//kernel.WebPage:2355
      if (related!=null) {
        //$LASTPOS=90002387;//kernel.WebPage:2387
        sendUrl+="&";
        //$LASTPOS=90002412;//kernel.WebPage:2412
        sendUrl+="related="+encodeURIComponent(related);
        
      }
      //$LASTPOS=90002477;//kernel.WebPage:2477
      if (tl) {
        //$LASTPOS=90002496;//kernel.WebPage:2496
        sendUrl+="&";
        //$LASTPOS=90002521;//kernel.WebPage:2521
        sendUrl+="source=webclient";
        
      }
      //$LASTPOS=90002564;//kernel.WebPage:2564
      _this.openNewWindow(sendUrl);
    },
    fiber$openTweet :function _trc_WebPage_f_openTweet(_thread,text,url,hashtags,via,related,tl) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var sendUrl;
      
      //$LASTPOS=90001902;//kernel.WebPage:1902
      sendUrl = "https://twitter.com/intent/tweet?";
      
      //$LASTPOS=90001958;//kernel.WebPage:1958
      sendUrl+="text="+encodeURIComponent(text);
      //$LASTPOS=90002010;//kernel.WebPage:2010
      if (url!=null) {
        //$LASTPOS=90002038;//kernel.WebPage:2038
        sendUrl+="&";
        //$LASTPOS=90002063;//kernel.WebPage:2063
        sendUrl+="url="+encodeURIComponent(url);
        
      }
      //$LASTPOS=90002120;//kernel.WebPage:2120
      if (hashtags!=null) {
        //$LASTPOS=90002153;//kernel.WebPage:2153
        sendUrl+="&";
        //$LASTPOS=90002178;//kernel.WebPage:2178
        sendUrl+="hashtags="+encodeURIComponent(hashtags);
        
      }
      //$LASTPOS=90002245;//kernel.WebPage:2245
      if (via!=null) {
        //$LASTPOS=90002273;//kernel.WebPage:2273
        sendUrl+="&";
        //$LASTPOS=90002298;//kernel.WebPage:2298
        sendUrl+="via="+encodeURIComponent(via);
        
      }
      //$LASTPOS=90002355;//kernel.WebPage:2355
      if (related!=null) {
        //$LASTPOS=90002387;//kernel.WebPage:2387
        sendUrl+="&";
        //$LASTPOS=90002412;//kernel.WebPage:2412
        sendUrl+="related="+encodeURIComponent(related);
        
      }
      //$LASTPOS=90002477;//kernel.WebPage:2477
      if (tl) {
        //$LASTPOS=90002496;//kernel.WebPage:2496
        sendUrl+="&";
        //$LASTPOS=90002521;//kernel.WebPage:2521
        sendUrl+="source=webclient";
        
      }
      
      _thread.enter(function _trc_WebPage_ent_openTweet(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=90002564;//kernel.WebPage:2564
            _this.fiber$openNewWindow(_thread, sendUrl);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    openShareTweet :function _trc_WebPage_openShareTweet(text,url,hashtags,via,related,tl) {
      "use strict";
      var _this=this;
      var sendUrl;
      var tempText;
      
      //$LASTPOS=90003505;//kernel.WebPage:3505
      sendUrl = "https://twitter.com/intent/tweet?";
      
      //$LASTPOS=90003620;//kernel.WebPage:3620
      if (arguments.length==2) {
        //$LASTPOS=90003656;//kernel.WebPage:3656
        if (text==null||text.match(/^http/)) {
          //$LASTPOS=90003710;//kernel.WebPage:3710
          tempText = text;
          
          //$LASTPOS=90003742;//kernel.WebPage:3742
          text=url;
          //$LASTPOS=90003751;//kernel.WebPage:3751
          url=tempText;
          
        }
        
      }
      //$LASTPOS=90003788;//kernel.WebPage:3788
      sendUrl+="text="+encodeURIComponent(text);
      //$LASTPOS=90003840;//kernel.WebPage:3840
      sendUrl+="&";
      //$LASTPOS=90003861;//kernel.WebPage:3861
      if (url==null) {
        //$LASTPOS=90003889;//kernel.WebPage:3889
        sendUrl+="url="+window.location.href;
        
      } else {
        //$LASTPOS=90003954;//kernel.WebPage:3954
        sendUrl+="url="+encodeURIComponent(url);
        
      }
      //$LASTPOS=90004011;//kernel.WebPage:4011
      if (hashtags!=null) {
        //$LASTPOS=90004044;//kernel.WebPage:4044
        sendUrl+="&";
        //$LASTPOS=90004069;//kernel.WebPage:4069
        sendUrl+="hashtags="+encodeURIComponent(hashtags);
        
      }
      //$LASTPOS=90004136;//kernel.WebPage:4136
      if (via!=null) {
        //$LASTPOS=90004164;//kernel.WebPage:4164
        sendUrl+="&";
        //$LASTPOS=90004189;//kernel.WebPage:4189
        sendUrl+="via="+encodeURIComponent(via);
        
      }
      //$LASTPOS=90004246;//kernel.WebPage:4246
      if (related!=null) {
        //$LASTPOS=90004278;//kernel.WebPage:4278
        sendUrl+="&";
        //$LASTPOS=90004303;//kernel.WebPage:4303
        sendUrl+="related="+encodeURIComponent(related);
        
      }
      //$LASTPOS=90004368;//kernel.WebPage:4368
      if (tl) {
        //$LASTPOS=90004387;//kernel.WebPage:4387
        sendUrl+="&";
        //$LASTPOS=90004412;//kernel.WebPage:4412
        sendUrl+="source=webclient";
        
      }
      //$LASTPOS=90004455;//kernel.WebPage:4455
      _this.openNewWindow(sendUrl);
    },
    fiber$openShareTweet :function _trc_WebPage_f_openShareTweet(_thread,text,url,hashtags,via,related,tl) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var sendUrl;
      var tempText;
      
      //$LASTPOS=90003505;//kernel.WebPage:3505
      sendUrl = "https://twitter.com/intent/tweet?";
      
      //$LASTPOS=90003620;//kernel.WebPage:3620
      if (_arguments.length==2) {
        //$LASTPOS=90003656;//kernel.WebPage:3656
        if (text==null||text.match(/^http/)) {
          //$LASTPOS=90003710;//kernel.WebPage:3710
          tempText = text;
          
          //$LASTPOS=90003742;//kernel.WebPage:3742
          text=url;
          //$LASTPOS=90003751;//kernel.WebPage:3751
          url=tempText;
          
        }
        
      }
      //$LASTPOS=90003788;//kernel.WebPage:3788
      sendUrl+="text="+encodeURIComponent(text);
      //$LASTPOS=90003840;//kernel.WebPage:3840
      sendUrl+="&";
      //$LASTPOS=90003861;//kernel.WebPage:3861
      if (url==null) {
        //$LASTPOS=90003889;//kernel.WebPage:3889
        sendUrl+="url="+window.location.href;
        
      } else {
        //$LASTPOS=90003954;//kernel.WebPage:3954
        sendUrl+="url="+encodeURIComponent(url);
        
      }
      //$LASTPOS=90004011;//kernel.WebPage:4011
      if (hashtags!=null) {
        //$LASTPOS=90004044;//kernel.WebPage:4044
        sendUrl+="&";
        //$LASTPOS=90004069;//kernel.WebPage:4069
        sendUrl+="hashtags="+encodeURIComponent(hashtags);
        
      }
      //$LASTPOS=90004136;//kernel.WebPage:4136
      if (via!=null) {
        //$LASTPOS=90004164;//kernel.WebPage:4164
        sendUrl+="&";
        //$LASTPOS=90004189;//kernel.WebPage:4189
        sendUrl+="via="+encodeURIComponent(via);
        
      }
      //$LASTPOS=90004246;//kernel.WebPage:4246
      if (related!=null) {
        //$LASTPOS=90004278;//kernel.WebPage:4278
        sendUrl+="&";
        //$LASTPOS=90004303;//kernel.WebPage:4303
        sendUrl+="related="+encodeURIComponent(related);
        
      }
      //$LASTPOS=90004368;//kernel.WebPage:4368
      if (tl) {
        //$LASTPOS=90004387;//kernel.WebPage:4387
        sendUrl+="&";
        //$LASTPOS=90004412;//kernel.WebPage:4412
        sendUrl+="source=webclient";
        
      }
      
      _thread.enter(function _trc_WebPage_ent_openShareTweet(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=90004455;//kernel.WebPage:4455
            _this.fiber$openNewWindow(_thread, sendUrl);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"openNewWindow":{"nowait":false},"openPage":{"nowait":false},"openTweet":{"nowait":false},"openShareTweet":{"nowait":false}},"fields":{"eventWindowOpen":{},"postUrl":{},"canvas":{},"listenerExists":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Boot',
  shortName: 'Boot',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [Tonyu.classes.kernel.T2MediaPlayer],
  methods: {
    main :function _trc_Boot_main() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91000250;//kernel.Boot:250
      Tonyu.resetLoopCheck(10000);
      //$LASTPOS=91000280;//kernel.Boot:280
      Tonyu.globals.$Boot=_this;
      //$LASTPOS=91000293;//kernel.Boot:293
      _this._scheduler=Tonyu.globals.$Scheduler=new Tonyu.classes.kernel.Scheduler;
      //$LASTPOS=91000331;//kernel.Boot:331
      _this.initGlobals();
      //$LASTPOS=91000347;//kernel.Boot:347
      _this.initEvents();
      //$LASTPOS=91000362;//kernel.Boot:362
      _this.initLayers();
      //$LASTPOS=91000377;//kernel.Boot:377
      _this.initPeripherals();
      //$LASTPOS=91000397;//kernel.Boot:397
      _this.loadPlugins();
      //$LASTPOS=91000413;//kernel.Boot:413
      _this.loadImages();
      //$LASTPOS=91000428;//kernel.Boot:428
      _this.loadSounds();
      //$LASTPOS=91000443;//kernel.Boot:443
      _this.createMainObject();
      //$LASTPOS=91000464;//kernel.Boot:464
      _this.progress();
      //$LASTPOS=91000477;//kernel.Boot:477
      _this.mainLoop();
    },
    fiber$main :function _trc_Boot_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=91000250;//kernel.Boot:250
      Tonyu.resetLoopCheck(10000);
      //$LASTPOS=91000280;//kernel.Boot:280
      Tonyu.globals.$Boot=_this;
      //$LASTPOS=91000293;//kernel.Boot:293
      _this._scheduler=Tonyu.globals.$Scheduler=new Tonyu.classes.kernel.Scheduler;
      
      _thread.enter(function _trc_Boot_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91000331;//kernel.Boot:331
            _this.fiber$initGlobals(_thread);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=91000347;//kernel.Boot:347
            _this.fiber$initEvents(_thread);
            __pc=2;return;
          case 2:
            
            //$LASTPOS=91000362;//kernel.Boot:362
            _this.fiber$initLayers(_thread);
            __pc=3;return;
          case 3:
            
            //$LASTPOS=91000377;//kernel.Boot:377
            _this.fiber$initPeripherals(_thread);
            __pc=4;return;
          case 4:
            
            //$LASTPOS=91000397;//kernel.Boot:397
            _this.fiber$loadPlugins(_thread);
            __pc=5;return;
          case 5:
            
            //$LASTPOS=91000413;//kernel.Boot:413
            _this.fiber$loadImages(_thread);
            __pc=6;return;
          case 6:
            
            //$LASTPOS=91000428;//kernel.Boot:428
            _this.fiber$loadSounds(_thread);
            __pc=7;return;
          case 7:
            
            //$LASTPOS=91000443;//kernel.Boot:443
            _this.fiber$createMainObject(_thread);
            __pc=8;return;
          case 8:
            
            //$LASTPOS=91000464;//kernel.Boot:464
            _this.fiber$progress(_thread);
            __pc=9;return;
          case 9:
            
            //$LASTPOS=91000477;//kernel.Boot:477
            _this.fiber$mainLoop(_thread);
            __pc=10;return;
          case 10:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    initialize :function _trc_Boot_initialize(param) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91000511;//kernel.Boot:511
      _this.extend(param);
      //$LASTPOS=91000531;//kernel.Boot:531
      _this.initSymbol();
      //$LASTPOS=91000550;//kernel.Boot:550
      _this._th=Tonyu.thread();
      //$LASTPOS=91000575;//kernel.Boot:575
      _this._th.apply(_this,"main");
      //$LASTPOS=91000604;//kernel.Boot:604
      _this._th.stepsLoop();
      //$LASTPOS=91000626;//kernel.Boot:626
      _this.on("die",(function anonymous_637() {
        
        //$LASTPOS=91000649;//kernel.Boot:649
        if (_this._th) {
          //$LASTPOS=91000658;//kernel.Boot:658
          _this._th.kill();
        }
      }));
    },
    initSymbol :function _trc_Boot_initSymbol() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91000703;//kernel.Boot:703
      Tonyu.globals.$Symbol={subActors: "__SUBACTOR"};
    },
    fiber$initSymbol :function _trc_Boot_f_initSymbol(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=91000703;//kernel.Boot:703
      Tonyu.globals.$Symbol={subActors: "__SUBACTOR"};
      
      _thread.retVal=_this;return;
    },
    timeStop :function _trc_Boot_timeStop(except) {
      "use strict";
      var _this=this;
      var oldS;
      var newS;
      var res;
      
      //$LASTPOS=91000782;//kernel.Boot:782
      oldS = _this._scheduler;
      
      //$LASTPOS=91000808;//kernel.Boot:808
      _this._scheduler=Tonyu.globals.$Scheduler=new Tonyu.classes.kernel.Scheduler;
      //$LASTPOS=91000850;//kernel.Boot:850
      newS = _this._scheduler;
      
      //$LASTPOS=91000876;//kernel.Boot:876
      res = {release: (function anonymous_904(a) {
        
        //$LASTPOS=91000924;//kernel.Boot:924
        a._scheduler=newS;
        //$LASTPOS=91000956;//kernel.Boot:956
        oldS.findByThreadGroup(a).forEach((function anonymous_990(th) {
          
          //$LASTPOS=91001015;//kernel.Boot:1015
          if (th.scheduled===newS) {
            return _this;
          }
          //$LASTPOS=91001065;//kernel.Boot:1065
          th.scheduled=null;
          //$LASTPOS=91001101;//kernel.Boot:1101
          newS.addToNext(th);
        }));
      }),releaseAll: (function anonymous_1170() {
        var a;
        var e;
        var _it_788;
        
        //$LASTPOS=91001186;//kernel.Boot:1186
        a = Tonyu.globals.$Screen.all();
        
        //$LASTPOS=91001220;//kernel.Boot:1220
        _it_788=Tonyu.iterator(a,1);
        while(_it_788.next()) {
          e=_it_788[0];
          
          //$LASTPOS=91001256;//kernel.Boot:1256
          res.release(e);
          
        }
      })};
      
      //$LASTPOS=91001311;//kernel.Boot:1311
      res.release(except);
      return res;
    },
    fiber$timeStop :function _trc_Boot_f_timeStop(_thread,except) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var oldS;
      var newS;
      var res;
      
      //$LASTPOS=91000782;//kernel.Boot:782
      oldS = _this._scheduler;
      
      //$LASTPOS=91000808;//kernel.Boot:808
      _this._scheduler=Tonyu.globals.$Scheduler=new Tonyu.classes.kernel.Scheduler;
      //$LASTPOS=91000850;//kernel.Boot:850
      newS = _this._scheduler;
      
      //$LASTPOS=91000876;//kernel.Boot:876
      res = {release: (function anonymous_904(a) {
        
        //$LASTPOS=91000924;//kernel.Boot:924
        a._scheduler=newS;
        //$LASTPOS=91000956;//kernel.Boot:956
        oldS.findByThreadGroup(a).forEach((function anonymous_990(th) {
          
          //$LASTPOS=91001015;//kernel.Boot:1015
          if (th.scheduled===newS) {
            return _this;
          }
          //$LASTPOS=91001065;//kernel.Boot:1065
          th.scheduled=null;
          //$LASTPOS=91001101;//kernel.Boot:1101
          newS.addToNext(th);
        }));
      }),releaseAll: (function anonymous_1170() {
        var a;
        var e;
        var _it_788;
        
        //$LASTPOS=91001186;//kernel.Boot:1186
        a = Tonyu.globals.$Screen.all();
        
        //$LASTPOS=91001220;//kernel.Boot:1220
        _it_788=Tonyu.iterator(a,1);
        while(_it_788.next()) {
          e=_it_788[0];
          
          //$LASTPOS=91001256;//kernel.Boot:1256
          res.release(e);
          
        }
      })};
      
      //$LASTPOS=91001311;//kernel.Boot:1311
      res.release(except);
      _thread.retVal=res;return;
      
      
      _thread.retVal=_this;return;
    },
    update :function _trc_Boot_update() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91001370;//kernel.Boot:1370
      _this.waitFor(Tonyu.timeout(50));
    },
    fiber$update :function _trc_Boot_f_update(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Boot_ent_update(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91001370;//kernel.Boot:1370
            _this.fiber$waitFor(_thread, Tonyu.timeout(50));
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    initGlobals :function _trc_Boot_initGlobals() {
      "use strict";
      var _this=this;
      var opt;
      var g;
      var name;
      var _it_792;
      
      //$LASTPOS=91001449;//kernel.Boot:1449
      opt = Tonyu.currentProject.getOptions();
      
      //$LASTPOS=91001495;//kernel.Boot:1495
      if (opt.run&&opt.run.globals) {
        //$LASTPOS=91001534;//kernel.Boot:1534
        g = opt.run.globals;
        
        //$LASTPOS=91001562;//kernel.Boot:1562
        _it_792=Tonyu.iterator(g,1);
        while(_it_792.next()) {
          name=_it_792[0];
          
          //$LASTPOS=91001591;//kernel.Boot:1591
          Tonyu.setGlobal(name,g[name]);
          
        }
        
      }
      //$LASTPOS=91001638;//kernel.Boot:1638
      Tonyu.globals.$fixProductOrder=true;
    },
    fiber$initGlobals :function _trc_Boot_f_initGlobals(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var opt;
      var g;
      var name;
      var _it_792;
      
      //$LASTPOS=91001449;//kernel.Boot:1449
      opt = Tonyu.currentProject.getOptions();
      
      //$LASTPOS=91001495;//kernel.Boot:1495
      if (opt.run&&opt.run.globals) {
        //$LASTPOS=91001534;//kernel.Boot:1534
        g = opt.run.globals;
        
        //$LASTPOS=91001562;//kernel.Boot:1562
        _it_792=Tonyu.iterator(g,1);
        while(_it_792.next()) {
          name=_it_792[0];
          
          //$LASTPOS=91001591;//kernel.Boot:1591
          Tonyu.setGlobal(name,g[name]);
          
        }
        
      }
      //$LASTPOS=91001638;//kernel.Boot:1638
      Tonyu.globals.$fixProductOrder=true;
      
      _thread.retVal=_this;return;
    },
    initEvents :function _trc_Boot_initEvents() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91001711;//kernel.Boot:1711
      _this.eventTypes={"screenOut": Tonyu.classes.kernel.ScreenOutHandler,"crashTo": Tonyu.classes.kernel.CrashToHandler,"within": Tonyu.classes.kernel.WithinHandler};
    },
    fiber$initEvents :function _trc_Boot_f_initEvents(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=91001711;//kernel.Boot:1711
      _this.eventTypes={"screenOut": Tonyu.classes.kernel.ScreenOutHandler,"crashTo": Tonyu.classes.kernel.CrashToHandler,"within": Tonyu.classes.kernel.WithinHandler};
      
      _thread.retVal=_this;return;
    },
    initPeripherals :function _trc_Boot_initPeripherals() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91001868;//kernel.Boot:1868
      Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;
      //$LASTPOS=91001903;//kernel.Boot:1903
      Tonyu.globals.$InputBox=UIDiag;
      //$LASTPOS=91001926;//kernel.Boot:1926
      Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);
      //$LASTPOS=91001967;//kernel.Boot:1967
      Tonyu.globals.$ObjectPool=new Tonyu.classes.kernel.ObjectPool;
      //$LASTPOS=91002000;//kernel.Boot:2000
      Tonyu.globals.$pat_fruits=30;
      //$LASTPOS=91002021;//kernel.Boot:2021
      Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;
      //$LASTPOS=91002042;//kernel.Boot:2042
      Tonyu.globals.$Math=Math;
      //$LASTPOS=91002059;//kernel.Boot:2059
      Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.Panel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=91002173;//kernel.Boot:2173
      Tonyu.globals.$consolePrintY=465-15;
      //$LASTPOS=91002201;//kernel.Boot:2201
      Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=91002345;//kernel.Boot:2345
      _this.initFPSParams();
      //$LASTPOS=91002367;//kernel.Boot:2367
      Tonyu.globals.$WebPage=new Tonyu.classes.kernel.WebPage;
      //$LASTPOS=91002394;//kernel.Boot:2394
      Tonyu.globals.$Navigator=new Tonyu.classes.kernel.Navigator;
      //$LASTPOS=91002425;//kernel.Boot:2425
      Tonyu.globals.$mouseX=Tonyu.globals.$mouseX||0;
      //$LASTPOS=91002450;//kernel.Boot:2450
      Tonyu.globals.$mouseY=Tonyu.globals.$mouseY||0;
      //$LASTPOS=91002475;//kernel.Boot:2475
      _this.debugCnt=50;
      //$LASTPOS=91002493;//kernel.Boot:2493
      _this.newLimit=1000;
      //$LASTPOS=91002513;//kernel.Boot:2513
      Tonyu.globals.$printLimit=100;
    },
    fiber$initPeripherals :function _trc_Boot_f_initPeripherals(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=91001868;//kernel.Boot:1868
      Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;
      //$LASTPOS=91001903;//kernel.Boot:1903
      Tonyu.globals.$InputBox=UIDiag;
      //$LASTPOS=91001926;//kernel.Boot:1926
      Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);
      //$LASTPOS=91001967;//kernel.Boot:1967
      Tonyu.globals.$ObjectPool=new Tonyu.classes.kernel.ObjectPool;
      //$LASTPOS=91002000;//kernel.Boot:2000
      Tonyu.globals.$pat_fruits=30;
      //$LASTPOS=91002021;//kernel.Boot:2021
      Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;
      //$LASTPOS=91002042;//kernel.Boot:2042
      Tonyu.globals.$Math=Math;
      //$LASTPOS=91002059;//kernel.Boot:2059
      Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.Panel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=91002173;//kernel.Boot:2173
      Tonyu.globals.$consolePrintY=465-15;
      //$LASTPOS=91002201;//kernel.Boot:2201
      Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});
      //$LASTPOS=91002345;//kernel.Boot:2345
      _this.initFPSParams();
      //$LASTPOS=91002367;//kernel.Boot:2367
      Tonyu.globals.$WebPage=new Tonyu.classes.kernel.WebPage;
      //$LASTPOS=91002394;//kernel.Boot:2394
      Tonyu.globals.$Navigator=new Tonyu.classes.kernel.Navigator;
      //$LASTPOS=91002425;//kernel.Boot:2425
      Tonyu.globals.$mouseX=Tonyu.globals.$mouseX||0;
      //$LASTPOS=91002450;//kernel.Boot:2450
      Tonyu.globals.$mouseY=Tonyu.globals.$mouseY||0;
      //$LASTPOS=91002475;//kernel.Boot:2475
      _this.debugCnt=50;
      //$LASTPOS=91002493;//kernel.Boot:2493
      _this.newLimit=1000;
      //$LASTPOS=91002513;//kernel.Boot:2513
      Tonyu.globals.$printLimit=100;
      
      _thread.retVal=_this;return;
    },
    initLayers :function _trc_Boot_initLayers() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91002555;//kernel.Boot:2555
      Tonyu.globals.$screenWidth=465;
      //$LASTPOS=91002578;//kernel.Boot:2578
      Tonyu.globals.$screenHeight=465;
      //$LASTPOS=91002602;//kernel.Boot:2602
      Tonyu.globals.$mainLayer=Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites();
      //$LASTPOS=91002642;//kernel.Boot:2642
      Tonyu.globals.$frontLayer=Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites();
      //$LASTPOS=91002688;//kernel.Boot:2688
      Tonyu.globals.$backLayer=new Tonyu.classes.kernel.Sprites();
      //$LASTPOS=91002719;//kernel.Boot:2719
      Tonyu.globals.$uiLayer=new Tonyu.classes.kernel.Sprites();
      //$LASTPOS=91002748;//kernel.Boot:2748
      Tonyu.globals.$mainLayer3D=new Tonyu.classes.kernel.Sprites3D();
      //$LASTPOS=91002783;//kernel.Boot:2783
      _this.cvj=Tonyu.globals.$mainCanvas||$("canvas");
      //$LASTPOS=91002818;//kernel.Boot:2818
      Tonyu.globals.$Screen=new Tonyu.classes.kernel.Screen({width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,layer: Tonyu.globals.$uiLayer});
      //$LASTPOS=91002901;//kernel.Boot:2901
      Tonyu.globals.$Screen.on("resize",(function anonymous_2922() {
        
        //$LASTPOS=91002934;//kernel.Boot:2934
        Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;
        //$LASTPOS=91002971;//kernel.Boot:2971
        Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;
        //$LASTPOS=91003010;//kernel.Boot:3010
        if (Tonyu.globals.$panel) {
          //$LASTPOS=91003035;//kernel.Boot:3035
          Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
          //$LASTPOS=91003093;//kernel.Boot:3093
          Tonyu.globals.$panel.x=Tonyu.globals.$screenWidth/2;
          //$LASTPOS=91003131;//kernel.Boot:3131
          Tonyu.globals.$panel.y=Tonyu.globals.$screenHeight/2;
          
        }
        //$LASTPOS=91003177;//kernel.Boot:3177
        if (Tonyu.globals.$consolePanel) {
          //$LASTPOS=91003209;//kernel.Boot:3209
          Tonyu.globals.$consolePanel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
          //$LASTPOS=91003274;//kernel.Boot:3274
          Tonyu.globals.$consolePanel.x=Tonyu.globals.$screenWidth/2;
          //$LASTPOS=91003319;//kernel.Boot:3319
          Tonyu.globals.$consolePanel.y=Tonyu.globals.$screenHeight/2;
          //$LASTPOS=91003365;//kernel.Boot:3365
          Tonyu.globals.$consolePrintY=Tonyu.globals.$screenHeight-15;
          
        }
      }));
      //$LASTPOS=91003422;//kernel.Boot:3422
      Tonyu.globals.$Screen.addLayer(Tonyu.globals.$frontLayer);
      //$LASTPOS=91003458;//kernel.Boot:3458
      Tonyu.globals.$camera2D=Tonyu.globals.$Screen.addLayer(Tonyu.globals.$mainLayer);
      //$LASTPOS=91003503;//kernel.Boot:3503
      Tonyu.globals.$camera3D=Tonyu.globals.$Screen.addLayer(Tonyu.globals.$mainLayer3D);
      //$LASTPOS=91003550;//kernel.Boot:3550
      Tonyu.globals.$Screen.addLayer(Tonyu.globals.$backLayer);
      //$LASTPOS=91003585;//kernel.Boot:3585
      Tonyu.globals.$Screen.setBGColor("rgb(20,80,180)");
      //$LASTPOS=91003628;//kernel.Boot:3628
      Tonyu.globals.$Screen.selectLayer(Tonyu.globals.$mainLayer);
      //$LASTPOS=91003666;//kernel.Boot:3666
      Tonyu.globals.$rootLayer=new Tonyu.classes.kernel.Sprites();
      //$LASTPOS=91003697;//kernel.Boot:3697
      Tonyu.globals.$uiScreen=new Tonyu.classes.kernel.Screen({canvas: _this.cvj[0],layer: Tonyu.globals.$rootLayer});
      //$LASTPOS=91003756;//kernel.Boot:3756
      Tonyu.globals.$uiScreen.setBGColor("#888");
      //$LASTPOS=91003791;//kernel.Boot:3791
      Tonyu.globals.$uiScreen.addLayer(Tonyu.globals.$uiLayer);
      //$LASTPOS=91003826;//kernel.Boot:3826
      Tonyu.globals.$layoutManager=new Tonyu.classes.kernel.UILayout({layer: Tonyu.globals.$uiLayer});
    },
    fiber$initLayers :function _trc_Boot_f_initLayers(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=91002555;//kernel.Boot:2555
      Tonyu.globals.$screenWidth=465;
      //$LASTPOS=91002578;//kernel.Boot:2578
      Tonyu.globals.$screenHeight=465;
      //$LASTPOS=91002602;//kernel.Boot:2602
      Tonyu.globals.$mainLayer=Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites();
      //$LASTPOS=91002642;//kernel.Boot:2642
      Tonyu.globals.$frontLayer=Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites();
      //$LASTPOS=91002688;//kernel.Boot:2688
      Tonyu.globals.$backLayer=new Tonyu.classes.kernel.Sprites();
      //$LASTPOS=91002719;//kernel.Boot:2719
      Tonyu.globals.$uiLayer=new Tonyu.classes.kernel.Sprites();
      //$LASTPOS=91002748;//kernel.Boot:2748
      Tonyu.globals.$mainLayer3D=new Tonyu.classes.kernel.Sprites3D();
      //$LASTPOS=91002783;//kernel.Boot:2783
      _this.cvj=Tonyu.globals.$mainCanvas||$("canvas");
      //$LASTPOS=91002818;//kernel.Boot:2818
      Tonyu.globals.$Screen=new Tonyu.classes.kernel.Screen({width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,layer: Tonyu.globals.$uiLayer});
      //$LASTPOS=91002901;//kernel.Boot:2901
      Tonyu.globals.$Screen.on("resize",(function anonymous_2922() {
        
        //$LASTPOS=91002934;//kernel.Boot:2934
        Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;
        //$LASTPOS=91002971;//kernel.Boot:2971
        Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;
        //$LASTPOS=91003010;//kernel.Boot:3010
        if (Tonyu.globals.$panel) {
          //$LASTPOS=91003035;//kernel.Boot:3035
          Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
          //$LASTPOS=91003093;//kernel.Boot:3093
          Tonyu.globals.$panel.x=Tonyu.globals.$screenWidth/2;
          //$LASTPOS=91003131;//kernel.Boot:3131
          Tonyu.globals.$panel.y=Tonyu.globals.$screenHeight/2;
          
        }
        //$LASTPOS=91003177;//kernel.Boot:3177
        if (Tonyu.globals.$consolePanel) {
          //$LASTPOS=91003209;//kernel.Boot:3209
          Tonyu.globals.$consolePanel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
          //$LASTPOS=91003274;//kernel.Boot:3274
          Tonyu.globals.$consolePanel.x=Tonyu.globals.$screenWidth/2;
          //$LASTPOS=91003319;//kernel.Boot:3319
          Tonyu.globals.$consolePanel.y=Tonyu.globals.$screenHeight/2;
          //$LASTPOS=91003365;//kernel.Boot:3365
          Tonyu.globals.$consolePrintY=Tonyu.globals.$screenHeight-15;
          
        }
      }));
      //$LASTPOS=91003422;//kernel.Boot:3422
      Tonyu.globals.$Screen.addLayer(Tonyu.globals.$frontLayer);
      //$LASTPOS=91003458;//kernel.Boot:3458
      Tonyu.globals.$camera2D=Tonyu.globals.$Screen.addLayer(Tonyu.globals.$mainLayer);
      //$LASTPOS=91003503;//kernel.Boot:3503
      Tonyu.globals.$camera3D=Tonyu.globals.$Screen.addLayer(Tonyu.globals.$mainLayer3D);
      //$LASTPOS=91003550;//kernel.Boot:3550
      Tonyu.globals.$Screen.addLayer(Tonyu.globals.$backLayer);
      //$LASTPOS=91003585;//kernel.Boot:3585
      Tonyu.globals.$Screen.setBGColor("rgb(20,80,180)");
      //$LASTPOS=91003628;//kernel.Boot:3628
      Tonyu.globals.$Screen.selectLayer(Tonyu.globals.$mainLayer);
      //$LASTPOS=91003666;//kernel.Boot:3666
      Tonyu.globals.$rootLayer=new Tonyu.classes.kernel.Sprites();
      //$LASTPOS=91003697;//kernel.Boot:3697
      Tonyu.globals.$uiScreen=new Tonyu.classes.kernel.Screen({canvas: _this.cvj[0],layer: Tonyu.globals.$rootLayer});
      //$LASTPOS=91003756;//kernel.Boot:3756
      Tonyu.globals.$uiScreen.setBGColor("#888");
      //$LASTPOS=91003791;//kernel.Boot:3791
      Tonyu.globals.$uiScreen.addLayer(Tonyu.globals.$uiLayer);
      //$LASTPOS=91003826;//kernel.Boot:3826
      Tonyu.globals.$layoutManager=new Tonyu.classes.kernel.UILayout({layer: Tonyu.globals.$uiLayer});
      
      _thread.retVal=_this;return;
    },
    debug :function _trc_Boot_debug() {
      "use strict";
      var _this=this;
      var a;
      
      //$LASTPOS=91003911;//kernel.Boot:3911
      if (! _this.debugCnt) {
        return _this;
      }
      //$LASTPOS=91003939;//kernel.Boot:3939
      _this.debugCnt--;
      //$LASTPOS=91003956;//kernel.Boot:3956
      a = Array.prototype.slice.call(arguments);
      
      //$LASTPOS=91004006;//kernel.Boot:4006
      a.unshift(_this.debugCnt);
      //$LASTPOS=91004032;//kernel.Boot:4032
      a.unshift("DEBUG");
      //$LASTPOS=91004057;//kernel.Boot:4057
      console.log.apply(console,a);
    },
    fiber$debug :function _trc_Boot_f_debug(_thread) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var a;
      
      //$LASTPOS=91003911;//kernel.Boot:3911
      if (! _this.debugCnt) {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=91003939;//kernel.Boot:3939
      _this.debugCnt--;
      //$LASTPOS=91003956;//kernel.Boot:3956
      a = Array.prototype.slice.call(_arguments);
      
      //$LASTPOS=91004006;//kernel.Boot:4006
      a.unshift(_this.debugCnt);
      //$LASTPOS=91004032;//kernel.Boot:4032
      a.unshift("DEBUG");
      //$LASTPOS=91004057;//kernel.Boot:4057
      console.log.apply(console,a);
      
      _thread.retVal=_this;return;
    },
    loadPlugins :function _trc_Boot_loadPlugins() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91004398;//kernel.Boot:4398
      _this.progress("Loading plugins..");
      //$LASTPOS=91004434;//kernel.Boot:4434
      _this.runAsync((function anonymous_4443(r) {
        
        //$LASTPOS=91004459;//kernel.Boot:4459
        Tonyu.globals.$currentProject.loadPlugins(r);
      }));
      //$LASTPOS=91004504;//kernel.Boot:4504
      _this.progress("Loading plugins done");
    },
    fiber$loadPlugins :function _trc_Boot_f_loadPlugins(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Boot_ent_loadPlugins(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91004398;//kernel.Boot:4398
            _this.fiber$progress(_thread, "Loading plugins..");
            __pc=1;return;
          case 1:
            
            //$LASTPOS=91004434;//kernel.Boot:4434
            _this.fiber$runAsync(_thread, (function anonymous_4443(r) {
              
              //$LASTPOS=91004459;//kernel.Boot:4459
              Tonyu.globals.$currentProject.loadPlugins(r);
            }));
            __pc=2;return;
          case 2:
            
            //$LASTPOS=91004504;//kernel.Boot:4504
            _this.fiber$progress(_thread, "Loading plugins done");
            __pc=3;return;
          case 3:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    loadImages :function _trc_Boot_loadImages() {
      "use strict";
      var _this=this;
      var rs;
      var r;
      var name;
      var val;
      var _it_799;
      
      //$LASTPOS=91004563;//kernel.Boot:4563
      _this.progress("Loading pats..");
      //$LASTPOS=91004596;//kernel.Boot:4596
      rs = Tonyu.globals.$currentProject.getResource();
      
      
      //$LASTPOS=91004651;//kernel.Boot:4651
      r=_this.runAsync((function anonymous_4662(succ) {
        
        //$LASTPOS=91004681;//kernel.Boot:4681
        ImageList.load(rs.images,succ,{baseDir: Tonyu.globals.$currentProject.getDir(),prj: Tonyu.globals.$currentProject});
      }));
      //$LASTPOS=91004840;//kernel.Boot:4840
      Tonyu.globals.$imageList=r[0];
      //$LASTPOS=91004898;//kernel.Boot:4898
      _it_799=Tonyu.iterator(r[0].names,2);
      while(_it_799.next()) {
        name=_it_799[0];
        val=_it_799[1];
        
        //$LASTPOS=91004942;//kernel.Boot:4942
        Tonyu.setGlobal(name,val);
        
      }
      //$LASTPOS=91004982;//kernel.Boot:4982
      _this.progress("Loading pats done.");
    },
    fiber$loadImages :function _trc_Boot_f_loadImages(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var rs;
      var r;
      var name;
      var val;
      var _it_799;
      
      
      _thread.enter(function _trc_Boot_ent_loadImages(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91004563;//kernel.Boot:4563
            _this.fiber$progress(_thread, "Loading pats..");
            __pc=1;return;
          case 1:
            
            //$LASTPOS=91004596;//kernel.Boot:4596
            rs = Tonyu.globals.$currentProject.getResource();
            
            
            //$LASTPOS=91004651;//kernel.Boot:4651
            _this.fiber$runAsync(_thread, (function anonymous_4662(succ) {
              
              //$LASTPOS=91004681;//kernel.Boot:4681
              ImageList.load(rs.images,succ,{baseDir: Tonyu.globals.$currentProject.getDir(),prj: Tonyu.globals.$currentProject});
            }));
            __pc=2;return;
          case 2:
            r=_thread.retVal;
            
            //$LASTPOS=91004840;//kernel.Boot:4840
            Tonyu.globals.$imageList=r[0];
            //$LASTPOS=91004898;//kernel.Boot:4898
            _it_799=Tonyu.iterator(r[0].names,2);
            while(_it_799.next()) {
              name=_it_799[0];
              val=_it_799[1];
              
              //$LASTPOS=91004942;//kernel.Boot:4942
              Tonyu.setGlobal(name,val);
              
            }
            //$LASTPOS=91004982;//kernel.Boot:4982
            _this.fiber$progress(_thread, "Loading pats done.");
            __pc=3;return;
          case 3:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    loadSounds :function _trc_Boot_loadSounds() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91005039;//kernel.Boot:5039
      _this.progress("Loading sounds...");
      //$LASTPOS=91005075;//kernel.Boot:5075
      _this.initT2MediaPlayer();
      //$LASTPOS=91005101;//kernel.Boot:5101
      _this.loadFromProject(Tonyu.globals.$currentProject);
      //$LASTPOS=91005140;//kernel.Boot:5140
      _this.progress("Loading sounds done.");
      //$LASTPOS=91005179;//kernel.Boot:5179
      _this.on("stop",(function anonymous_5189() {
        
        //$LASTPOS=91005201;//kernel.Boot:5201
        _this.allClearSoundData();
      }));
      //$LASTPOS=91005235;//kernel.Boot:5235
      Tonyu.globals.$sound=_this;
    },
    fiber$loadSounds :function _trc_Boot_f_loadSounds(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Boot_ent_loadSounds(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91005039;//kernel.Boot:5039
            _this.fiber$progress(_thread, "Loading sounds...");
            __pc=1;return;
          case 1:
            
            //$LASTPOS=91005075;//kernel.Boot:5075
            _this.fiber$initT2MediaPlayer(_thread);
            __pc=2;return;
          case 2:
            
            //$LASTPOS=91005101;//kernel.Boot:5101
            _this.fiber$loadFromProject(_thread, Tonyu.globals.$currentProject);
            __pc=3;return;
          case 3:
            
            //$LASTPOS=91005140;//kernel.Boot:5140
            _this.fiber$progress(_thread, "Loading sounds done.");
            __pc=4;return;
          case 4:
            
            //$LASTPOS=91005179;//kernel.Boot:5179
            _this.on("stop",(function anonymous_5189() {
              
              //$LASTPOS=91005201;//kernel.Boot:5201
              _this.allClearSoundData();
            }));
            //$LASTPOS=91005235;//kernel.Boot:5235
            Tonyu.globals.$sound=_this;
            _thread.exit(_this);return;
          }
        }
      });
    },
    createMainObject :function _trc_Boot_createMainObject() {
      "use strict";
      var _this=this;
      var o;
      var mainClassName;
      
      //$LASTPOS=91005281;//kernel.Boot:5281
      o = Tonyu.currentProject.getOptions();
      
      //$LASTPOS=91005327;//kernel.Boot:5327
      mainClassName = o.run.mainClass;
      
      //$LASTPOS=91005367;//kernel.Boot:5367
      _this.progress("MainClass= "+mainClassName);
      //$LASTPOS=91005411;//kernel.Boot:5411
      _this.mainClass=Tonyu.getClass(mainClassName);
      //$LASTPOS=91005457;//kernel.Boot:5457
      if (! _this.mainClass) {
        throw new Error(mainClassName+" というクラスはありません");
        
        
      }
      //$LASTPOS=91005545;//kernel.Boot:5545
      Tonyu.globals.$excludeFromAll=Tonyu.globals.$Screen.all();
      //$LASTPOS=91005581;//kernel.Boot:5581
      new _this.mainClass();
    },
    fiber$createMainObject :function _trc_Boot_f_createMainObject(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var o;
      var mainClassName;
      
      //$LASTPOS=91005281;//kernel.Boot:5281
      o = Tonyu.currentProject.getOptions();
      
      //$LASTPOS=91005327;//kernel.Boot:5327
      mainClassName = o.run.mainClass;
      
      
      _thread.enter(function _trc_Boot_ent_createMainObject(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91005367;//kernel.Boot:5367
            _this.fiber$progress(_thread, "MainClass= "+mainClassName);
            __pc=1;return;
          case 1:
            
            //$LASTPOS=91005411;//kernel.Boot:5411
            _this.mainClass=Tonyu.getClass(mainClassName);
            //$LASTPOS=91005457;//kernel.Boot:5457
            if (! _this.mainClass) {
              throw new Error(mainClassName+" というクラスはありません");
              
              
            }
            //$LASTPOS=91005545;//kernel.Boot:5545
            Tonyu.globals.$excludeFromAll=Tonyu.globals.$Screen.all();
            //$LASTPOS=91005581;//kernel.Boot:5581
            new _this.mainClass();
            _thread.exit(_this);return;
          }
        }
      });
    },
    loadPage :function _trc_Boot_loadPage(page,arg) {
      "use strict";
      var _this=this;
      var a;
      
      //$LASTPOS=91005629;//kernel.Boot:5629
      a = Tonyu.globals.$Screen.all();
      
      //$LASTPOS=91005655;//kernel.Boot:5655
      a=a.find((function anonymous_5664(e) {
        
        return ! Tonyu.globals.$excludeFromAll.contains(e);
      }));
      //$LASTPOS=91005716;//kernel.Boot:5716
      a.die();
      //$LASTPOS=91005730;//kernel.Boot:5730
      new page(arg);
    },
    stop :function _trc_Boot_stop() {
      "use strict";
      var _this=this;
      var res;
      var evt;
      var e;
      var r;
      
      //$LASTPOS=91005764;//kernel.Boot:5764
      res = new $.Deferred();
      
      //$LASTPOS=91005795;//kernel.Boot:5795
      evt = {die: (function anonymous_5819() {
        
        //$LASTPOS=91005835;//kernel.Boot:5835
        _this.die();
        //$LASTPOS=91005855;//kernel.Boot:5855
        res.resolve();
      }),preventDefault: (function anonymous_5907() {
        
        //$LASTPOS=91005909;//kernel.Boot:5909
        evt.defaultPrevented=true;
      })};
      
      try {
        //$LASTPOS=91005965;//kernel.Boot:5965
        Tonyu.globals.$sound.stopAllSE();
        
      } catch (e) {
        //$LASTPOS=91006012;//kernel.Boot:6012
        console.error(e.stack);
        
      }
      //$LASTPOS=91006048;//kernel.Boot:6048
      r = _this.fireEvent("stop",evt);
      
      //$LASTPOS=91006082;//kernel.Boot:6082
      if (! evt.defaultPrevented) {
        //$LASTPOS=91006119;//kernel.Boot:6119
        evt.die();
        //$LASTPOS=91006139;//kernel.Boot:6139
        res.resolve();
        
      }
      return res;
    },
    fiber$stop :function _trc_Boot_f_stop(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var res;
      var evt;
      var e;
      var r;
      
      //$LASTPOS=91005764;//kernel.Boot:5764
      res = new $.Deferred();
      
      //$LASTPOS=91005795;//kernel.Boot:5795
      evt = {die: (function anonymous_5819() {
        
        //$LASTPOS=91005835;//kernel.Boot:5835
        _this.die();
        //$LASTPOS=91005855;//kernel.Boot:5855
        res.resolve();
      }),preventDefault: (function anonymous_5907() {
        
        //$LASTPOS=91005909;//kernel.Boot:5909
        evt.defaultPrevented=true;
      })};
      
      try {
        //$LASTPOS=91005965;//kernel.Boot:5965
        Tonyu.globals.$sound.stopAllSE();
        
      } catch (e) {
        //$LASTPOS=91006012;//kernel.Boot:6012
        console.error(e.stack);
        
      }
      //$LASTPOS=91006048;//kernel.Boot:6048
      r = _this.fireEvent("stop",evt);
      
      //$LASTPOS=91006082;//kernel.Boot:6082
      if (! evt.defaultPrevented) {
        //$LASTPOS=91006119;//kernel.Boot:6119
        evt.die();
        //$LASTPOS=91006139;//kernel.Boot:6139
        res.resolve();
        
      }
      _thread.retVal=res;return;
      
      
      _thread.retVal=_this;return;
    },
    hide :function _trc_Boot_hide() {
      "use strict";
      var _this=this;
      
    },
    schedule :function _trc_Boot_schedule(obj,method,args) {
      "use strict";
      var _this=this;
      var s;
      var th;
      
      //$LASTPOS=91006230;//kernel.Boot:6230
      if (! method) {
        throw new Error("指定されたメソッドは定義されていません:"+method);
        
      }
      //$LASTPOS=91006296;//kernel.Boot:6296
      args=args||[];
      //$LASTPOS=91006316;//kernel.Boot:6316
      s = obj._scheduler||_this._scheduler;
      
      //$LASTPOS=91006355;//kernel.Boot:6355
      th = s.newThread(obj,method,args);
      
      //$LASTPOS=91006399;//kernel.Boot:6399
      obj.setThreadGroup(_this);
      //$LASTPOS=91006430;//kernel.Boot:6430
      th.setThreadGroup(obj);
      return th;
    },
    fiber$schedule :function _trc_Boot_f_schedule(_thread,obj,method,args) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var s;
      var th;
      
      //$LASTPOS=91006230;//kernel.Boot:6230
      if (! method) {
        throw new Error("指定されたメソッドは定義されていません:"+method);
        
      }
      //$LASTPOS=91006296;//kernel.Boot:6296
      args=args||[];
      //$LASTPOS=91006316;//kernel.Boot:6316
      s = obj._scheduler||_this._scheduler;
      
      //$LASTPOS=91006355;//kernel.Boot:6355
      th = s.newThread(obj,method,args);
      
      //$LASTPOS=91006399;//kernel.Boot:6399
      obj.setThreadGroup(_this);
      //$LASTPOS=91006430;//kernel.Boot:6430
      th.setThreadGroup(obj);
      _thread.retVal=th;return;
      
      
      _thread.retVal=_this;return;
    },
    progress :function _trc_Boot_progress(m) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91006494;//kernel.Boot:6494
      if (typeof  SplashScreen=="undefined") {
        return _this;
      }
      //$LASTPOS=91006545;//kernel.Boot:6545
      if (m) {
        //$LASTPOS=91006563;//kernel.Boot:6563
        console.log.apply(console,arguments);
        //$LASTPOS=91006610;//kernel.Boot:6610
        SplashScreen.progress(m);
        
      } else {
        //$LASTPOS=91006648;//kernel.Boot:6648
        SplashScreen.hide();
      }
    },
    fiber$progress :function _trc_Boot_f_progress(_thread,m) {
      "use strict";
      var _this=this;
      var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=91006494;//kernel.Boot:6494
      if (typeof  SplashScreen=="undefined") {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=91006545;//kernel.Boot:6545
      if (m) {
        //$LASTPOS=91006563;//kernel.Boot:6563
        console.log.apply(console,_arguments);
        //$LASTPOS=91006610;//kernel.Boot:6610
        SplashScreen.progress(m);
        
      } else {
        //$LASTPOS=91006648;//kernel.Boot:6648
        SplashScreen.hide();
      }
      
      _thread.retVal=_this;return;
    },
    progressNoLog :function _trc_Boot_progressNoLog(m) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91006698;//kernel.Boot:6698
      if (typeof  SplashScreen=="undefined") {
        return _this;
      }
      //$LASTPOS=91006749;//kernel.Boot:6749
      if (m) {
        //$LASTPOS=91006767;//kernel.Boot:6767
        SplashScreen.progress(m);
        
      } else {
        //$LASTPOS=91006805;//kernel.Boot:6805
        SplashScreen.hide();
      }
    },
    fiber$progressNoLog :function _trc_Boot_f_progressNoLog(_thread,m) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=91006698;//kernel.Boot:6698
      if (typeof  SplashScreen=="undefined") {
        _thread.retVal=_this;return;
        
      }
      //$LASTPOS=91006749;//kernel.Boot:6749
      if (m) {
        //$LASTPOS=91006767;//kernel.Boot:6767
        SplashScreen.progress(m);
        
      } else {
        //$LASTPOS=91006805;//kernel.Boot:6805
        SplashScreen.hide();
      }
      
      _thread.retVal=_this;return;
    },
    mainLoop :function _trc_Boot_mainLoop() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91006851;//kernel.Boot:6851
      Tonyu.globals.$frameCount=0;
      //$LASTPOS=91006871;//kernel.Boot:6871
      Tonyu.globals.$drawnFrameCount=0;
      //$LASTPOS=91006896;//kernel.Boot:6896
      while (true) {
        //$LASTPOS=91006917;//kernel.Boot:6917
        if (_this._useRAF) {
          //$LASTPOS=91006930;//kernel.Boot:6930
          _this.loopRAF();
        } else {
          //$LASTPOS=91006952;//kernel.Boot:6952
          _this.loopTimer();
        }
        //$LASTPOS=91006974;//kernel.Boot:6974
        _this.measureFps();
        //$LASTPOS=91006994;//kernel.Boot:6994
        _this.handlePause();
        //$LASTPOS=91007018;//kernel.Boot:7018
        Tonyu.globals.$drawnFrameCount++;
        
      }
    },
    fiber$mainLoop :function _trc_Boot_f_mainLoop(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=91006851;//kernel.Boot:6851
      Tonyu.globals.$frameCount=0;
      //$LASTPOS=91006871;//kernel.Boot:6871
      Tonyu.globals.$drawnFrameCount=0;
      
      _thread.enter(function _trc_Boot_ent_mainLoop(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91006896;//kernel.Boot:6896
          case 1:
            //$LASTPOS=91006917;//kernel.Boot:6917
            if (!(_this._useRAF)) { __pc=3     ; break; }
            //$LASTPOS=91006930;//kernel.Boot:6930
            _this.fiber$loopRAF(_thread);
            __pc=2;return;
          case 2:
            
            __pc=5     ;break;
          case 3     :
            //$LASTPOS=91006952;//kernel.Boot:6952
            _this.fiber$loopTimer(_thread);
            __pc=4;return;
          case 4:
            
          case 5     :
            
            //$LASTPOS=91006974;//kernel.Boot:6974
            _this.measureFps();
            //$LASTPOS=91006994;//kernel.Boot:6994
            _this.fiber$handlePause(_thread);
            __pc=6;return;
          case 6:
            
            //$LASTPOS=91007018;//kernel.Boot:7018
            Tonyu.globals.$drawnFrameCount++;
            __pc=1;break;
          case 7     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    loopRAF :function _trc_Boot_loopRAF() {
      "use strict";
      var _this=this;
      var nowTime;
      var frameTime;
      var moves;
      var bufferTime;
      
      //$LASTPOS=91007067;//kernel.Boot:7067
      nowTime = _this.now();
      
      //$LASTPOS=91007108;//kernel.Boot:7108
      frameTime = 1000/_this._fps;
      
      //$LASTPOS=91007152;//kernel.Boot:7152
      moves = 0;
      
      
      //$LASTPOS=91007231;//kernel.Boot:7231
      _this.subTime=_this.trunc(nowTime-_this.rafProcNowTime);
      //$LASTPOS=91007279;//kernel.Boot:7279
      _this.procCnt=_this.subTime/frameTime;
      //$LASTPOS=91007331;//kernel.Boot:7331
      bufferTime=(0.5*_this._fps/60);
      //$LASTPOS=91007424;//kernel.Boot:7424
      if (_this.procCnt>=1-bufferTime&&_this.procCnt<=1+bufferTime) {
        //$LASTPOS=91007484;//kernel.Boot:7484
        _this.procCnt=1;
      }
      //$LASTPOS=91007504;//kernel.Boot:7504
      _this.procCnt=_this.floor(_this.procCnt);
      //$LASTPOS=91007535;//kernel.Boot:7535
      if (_this.procCnt>_this.maxFrameSkip) {
        //$LASTPOS=91007574;//kernel.Boot:7574
        _this.procCnt=_this.maxFrameSkip;
        //$LASTPOS=91007607;//kernel.Boot:7607
        _this.rafProcNowTime=nowTime;
        
      } else {
        //$LASTPOS=91007656;//kernel.Boot:7656
        _this.rafProcNowTime+=_this.procCnt*frameTime;
        
      }
      //$LASTPOS=91007753;//kernel.Boot:7753
      while (moves<_this.procCnt) {
        //$LASTPOS=91007779;//kernel.Boot:7779
        _this.moveFrame();
        //$LASTPOS=91007795;//kernel.Boot:7795
        moves++;
        //$LASTPOS=91007810;//kernel.Boot:7810
        if (moves<_this.procCnt) {
          //$LASTPOS=91007829;//kernel.Boot:7829
          _this.afterDraw({drawn: false});
        }
        
      }
      //$LASTPOS=91007888;//kernel.Boot:7888
      if (moves>0) {
        //$LASTPOS=91007914;//kernel.Boot:7914
        _this.drawFrame();
        //$LASTPOS=91007936;//kernel.Boot:7936
        _this.afterDraw({drawn: false});
        
      }
      //$LASTPOS=91008000;//kernel.Boot:8000
      _this.waitRAF();
    },
    fiber$loopRAF :function _trc_Boot_f_loopRAF(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var nowTime;
      var frameTime;
      var moves;
      var bufferTime;
      
      //$LASTPOS=91007067;//kernel.Boot:7067
      nowTime = _this.now();
      
      //$LASTPOS=91007108;//kernel.Boot:7108
      frameTime = 1000/_this._fps;
      
      //$LASTPOS=91007152;//kernel.Boot:7152
      moves = 0;
      
      
      //$LASTPOS=91007231;//kernel.Boot:7231
      _this.subTime=_this.trunc(nowTime-_this.rafProcNowTime);
      //$LASTPOS=91007279;//kernel.Boot:7279
      _this.procCnt=_this.subTime/frameTime;
      //$LASTPOS=91007331;//kernel.Boot:7331
      bufferTime=(0.5*_this._fps/60);
      //$LASTPOS=91007424;//kernel.Boot:7424
      if (_this.procCnt>=1-bufferTime&&_this.procCnt<=1+bufferTime) {
        //$LASTPOS=91007484;//kernel.Boot:7484
        _this.procCnt=1;
      }
      //$LASTPOS=91007504;//kernel.Boot:7504
      _this.procCnt=_this.floor(_this.procCnt);
      //$LASTPOS=91007535;//kernel.Boot:7535
      if (_this.procCnt>_this.maxFrameSkip) {
        //$LASTPOS=91007574;//kernel.Boot:7574
        _this.procCnt=_this.maxFrameSkip;
        //$LASTPOS=91007607;//kernel.Boot:7607
        _this.rafProcNowTime=nowTime;
        
      } else {
        //$LASTPOS=91007656;//kernel.Boot:7656
        _this.rafProcNowTime+=_this.procCnt*frameTime;
        
      }
      
      _thread.enter(function _trc_Boot_ent_loopRAF(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91007753;//kernel.Boot:7753
          case 1:
            if (!(moves<_this.procCnt)) { __pc=2     ; break; }
            {
              //$LASTPOS=91007779;//kernel.Boot:7779
              _this.moveFrame();
              //$LASTPOS=91007795;//kernel.Boot:7795
              moves++;
              //$LASTPOS=91007810;//kernel.Boot:7810
              if (moves<_this.procCnt) {
                //$LASTPOS=91007829;//kernel.Boot:7829
                _this.afterDraw({drawn: false});
              }
            }
            __pc=1;break;
          case 2     :
            
            //$LASTPOS=91007888;//kernel.Boot:7888
            if (moves>0) {
              //$LASTPOS=91007914;//kernel.Boot:7914
              _this.drawFrame();
              //$LASTPOS=91007936;//kernel.Boot:7936
              _this.afterDraw({drawn: false});
              
            }
            //$LASTPOS=91008000;//kernel.Boot:8000
            _this.fiber$waitRAF(_thread);
            __pc=3;return;
          case 3:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    waitRAF :function _trc_Boot_waitRAF() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91008439;//kernel.Boot:8439
      _this.waitFor(Tonyu.animationFrame());
    },
    fiber$waitRAF :function _trc_Boot_f_waitRAF(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Boot_ent_waitRAF(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91008439;//kernel.Boot:8439
            _this.fiber$waitFor(_thread, Tonyu.animationFrame());
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    loopTimer :function _trc_Boot_loopTimer() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91009385;//kernel.Boot:9385
      _this.moveFrame();
      //$LASTPOS=91009403;//kernel.Boot:9403
      _this.doDraw=_this.now()<_this.deadLine;
      //$LASTPOS=91009431;//kernel.Boot:9431
      if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {
        //$LASTPOS=91009485;//kernel.Boot:9485
        _this.doDraw=true;
        //$LASTPOS=91009507;//kernel.Boot:9507
        _this.resetDeadLine();
        
      }
      //$LASTPOS=91009536;//kernel.Boot:9536
      if (_this.doDraw) {
        //$LASTPOS=91009573;//kernel.Boot:9573
        _this.drawFrame();
        //$LASTPOS=91009595;//kernel.Boot:9595
        _this.frameSkipped=0;
        
      } else {
        //$LASTPOS=91009634;//kernel.Boot:9634
        _this.frameSkipped++;
        
      }
      //$LASTPOS=91009662;//kernel.Boot:9662
      _this.afterDraw({drawn: _this.doDraw});
      //$LASTPOS=91009692;//kernel.Boot:9692
      _this.waitFrame();
    },
    fiber$loopTimer :function _trc_Boot_f_loopTimer(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      //$LASTPOS=91009385;//kernel.Boot:9385
      _this.moveFrame();
      //$LASTPOS=91009403;//kernel.Boot:9403
      _this.doDraw=_this.now()<_this.deadLine;
      //$LASTPOS=91009431;//kernel.Boot:9431
      if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {
        //$LASTPOS=91009485;//kernel.Boot:9485
        _this.doDraw=true;
        //$LASTPOS=91009507;//kernel.Boot:9507
        _this.resetDeadLine();
        
      }
      //$LASTPOS=91009536;//kernel.Boot:9536
      if (_this.doDraw) {
        //$LASTPOS=91009573;//kernel.Boot:9573
        _this.drawFrame();
        //$LASTPOS=91009595;//kernel.Boot:9595
        _this.frameSkipped=0;
        
      } else {
        //$LASTPOS=91009634;//kernel.Boot:9634
        _this.frameSkipped++;
        
      }
      //$LASTPOS=91009662;//kernel.Boot:9662
      _this.afterDraw({drawn: _this.doDraw});
      
      _thread.enter(function _trc_Boot_ent_loopTimer(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91009692;//kernel.Boot:9692
            _this.fiber$waitFrame(_thread);
            __pc=1;return;
          case 1:
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    handlePause :function _trc_Boot_handlePause() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91009740;//kernel.Boot:9740
      while (_this.paused) {
        //$LASTPOS=91009765;//kernel.Boot:9765
        _this.waitFor(Tonyu.timeout(1));
        //$LASTPOS=91009801;//kernel.Boot:9801
        if (! _this.paused) {
          //$LASTPOS=91009814;//kernel.Boot:9814
          _this.resetDeadLine();
        }
        
      }
    },
    fiber$handlePause :function _trc_Boot_f_handlePause(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.enter(function _trc_Boot_ent_handlePause(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91009740;//kernel.Boot:9740
          case 1:
            if (!(_this.paused)) { __pc=3     ; break; }
            //$LASTPOS=91009765;//kernel.Boot:9765
            _this.fiber$waitFor(_thread, Tonyu.timeout(1));
            __pc=2;return;
          case 2:
            
            //$LASTPOS=91009801;//kernel.Boot:9801
            if (! _this.paused) {
              //$LASTPOS=91009814;//kernel.Boot:9814
              _this.resetDeadLine();
            }
            __pc=1;break;
          case 3     :
            
            _thread.exit(_this);return;
          }
        }
      });
    },
    drawFrame :function _trc_Boot_drawFrame() {
      "use strict";
      var _this=this;
      var s;
      
      //$LASTPOS=91009869;//kernel.Boot:9869
      s = _this.now();
      
      //$LASTPOS=91009887;//kernel.Boot:9887
      Tonyu.globals.$uiScreen.drawLayers();
      //$LASTPOS=91009916;//kernel.Boot:9916
      _this.drawTime=_this.now()-s;
      //$LASTPOS=91009939;//kernel.Boot:9939
      _this.fps_fpsCnt++;
    },
    moveFrame :function _trc_Boot_moveFrame() {
      "use strict";
      var _this=this;
      var s;
      
      //$LASTPOS=91010268;//kernel.Boot:10268
      s = _this.now();
      
      //$LASTPOS=91010286;//kernel.Boot:10286
      Tonyu.globals.$_printCount=0;
      //$LASTPOS=91010307;//kernel.Boot:10307
      Tonyu.resetLoopCheck();
      //$LASTPOS=91010336;//kernel.Boot:10336
      if (_this.newLimit) {
        //$LASTPOS=91010350;//kernel.Boot:10350
        _this.newLimitCount=_this.newLimit;
      }
      //$LASTPOS=91010408;//kernel.Boot:10408
      _this._scheduler.stepsAll();
      //$LASTPOS=91010465;//kernel.Boot:10465
      Tonyu.globals.$Keys.update();
      //$LASTPOS=91010515;//kernel.Boot:10515
      Tonyu.globals.$InputDevice.update();
      //$LASTPOS=91010572;//kernel.Boot:10572
      Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;
      //$LASTPOS=91010605;//kernel.Boot:10605
      Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;
      //$LASTPOS=91010640;//kernel.Boot:10640
      _this.moveTime=_this.now()-s;
      //$LASTPOS=91010663;//kernel.Boot:10663
      _this.fps_rpsCnt++;
      //$LASTPOS=91010683;//kernel.Boot:10683
      Tonyu.globals.$frameCount++;
    },
    afterDraw :function _trc_Boot_afterDraw(e) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91010856;//kernel.Boot:10856
      Tonyu.globals.$Sprites.checkHit();
      //$LASTPOS=91010911;//kernel.Boot:10911
      Tonyu.globals.$Sprites.removeOneframes(e.drawn);
      //$LASTPOS=91010951;//kernel.Boot:10951
      _this.sendEvent("afterDraw",e);
    },
    initFPSParams :function _trc_Boot_initFPSParams() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91011060;//kernel.Boot:11060
      _this._fps=Tonyu.globals.$defaultFPS||30;
      //$LASTPOS=91011091;//kernel.Boot:11091
      _this.maxFrameSkip=5;
      //$LASTPOS=91011114;//kernel.Boot:11114
      _this.minFrameSkip=1;
      //$LASTPOS=91011164;//kernel.Boot:11164
      _this.frameCnt=0;
      //$LASTPOS=91011183;//kernel.Boot:11183
      _this.resetDeadLine();
      //$LASTPOS=91011205;//kernel.Boot:11205
      _this.lastMeasured=_this.now();
      //$LASTPOS=91011230;//kernel.Boot:11230
      _this.fps_fps=_this.fps_rps=_this.fps_fpsCnt=_this.fps_rpsCnt=0;
      //$LASTPOS=91011276;//kernel.Boot:11276
      _this.drawTime=5;
      //$LASTPOS=91011287;//kernel.Boot:11287
      _this.moveTime=5;
      //$LASTPOS=91011345;//kernel.Boot:11345
      _this._useRAF=true;
      //$LASTPOS=91011399;//kernel.Boot:11399
      _this.rafProcNowTime=_this.now();
    },
    now :function _trc_Boot_now() {
      "use strict";
      var _this=this;
      
      return new Date().getTime();
    },
    resetDeadLine :function _trc_Boot_resetDeadLine() {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91011510;//kernel.Boot:11510
      _this.deadLine=_this.now()+1000/_this._fps;
      //$LASTPOS=91011541;//kernel.Boot:11541
      _this.frameSkipped=0;
    },
    waitFrame :function _trc_Boot_waitFrame() {
      "use strict";
      var _this=this;
      var wt;
      
      //$LASTPOS=91011585;//kernel.Boot:11585
      wt = _this.deadLine-_this.now();
      
      //$LASTPOS=91011613;//kernel.Boot:11613
      if (wt<1) {
        //$LASTPOS=91011634;//kernel.Boot:11634
        if (wt<- 1000) {
          //$LASTPOS=91011648;//kernel.Boot:11648
          _this.resetDeadLine();
        }
        //$LASTPOS=91011674;//kernel.Boot:11674
        wt=1;
        
      }
      //$LASTPOS=91011692;//kernel.Boot:11692
      wt=_this.floor(wt);
      //$LASTPOS=91011711;//kernel.Boot:11711
      _this.waitFor(Tonyu.timeout(wt));
      //$LASTPOS=91011744;//kernel.Boot:11744
      _this.deadLine+=1000/_this._fps;
    },
    fiber$waitFrame :function _trc_Boot_f_waitFrame(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      var wt;
      
      //$LASTPOS=91011585;//kernel.Boot:11585
      wt = _this.deadLine-_this.now();
      
      //$LASTPOS=91011613;//kernel.Boot:11613
      if (wt<1) {
        //$LASTPOS=91011634;//kernel.Boot:11634
        if (wt<- 1000) {
          //$LASTPOS=91011648;//kernel.Boot:11648
          _this.resetDeadLine();
        }
        //$LASTPOS=91011674;//kernel.Boot:11674
        wt=1;
        
      }
      //$LASTPOS=91011692;//kernel.Boot:11692
      wt=_this.floor(wt);
      
      _thread.enter(function _trc_Boot_ent_waitFrame(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=91011711;//kernel.Boot:11711
            _this.fiber$waitFor(_thread, Tonyu.timeout(wt));
            __pc=1;return;
          case 1:
            
            //$LASTPOS=91011744;//kernel.Boot:11744
            _this.deadLine+=1000/_this._fps;
            _thread.exit(_this);return;
          }
        }
      });
    },
    getFrameRate :function _trc_Boot_getFrameRate() {
      "use strict";
      var _this=this;
      
      return _this._fps;
    },
    setFrameRate :function _trc_Boot_setFrameRate(fps,maxFrameSkip) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91012028;//kernel.Boot:12028
      _this._fps=fps;
      //$LASTPOS=91012045;//kernel.Boot:12045
      if (typeof  maxFrameSkip!="number") {
        //$LASTPOS=91012080;//kernel.Boot:12080
        maxFrameSkip=5;
      }
      //$LASTPOS=91012101;//kernel.Boot:12101
      if (maxFrameSkip<=0) {
        //$LASTPOS=91012122;//kernel.Boot:12122
        maxFrameSkip=1;
      }
      //$LASTPOS=91012143;//kernel.Boot:12143
      _this.maxFrameSkip=maxFrameSkip;
      //$LASTPOS=91012182;//kernel.Boot:12182
      _this.resetDeadLine();
    },
    __getter__useRAF :function _trc_Boot___getter__useRAF() {
      "use strict";
      var _this=this;
      
      return _this._useRAF;
    },
    __setter__useRAF :function _trc_Boot___setter__useRAF(v) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=91012286;//kernel.Boot:12286
      if (v) {
        //$LASTPOS=91012304;//kernel.Boot:12304
        _this.rafProcNowTime=_this.now();
        
      } else {
        //$LASTPOS=91012349;//kernel.Boot:12349
        _this.resetDeadLine();
        
      }
      return _this._useRAF=v;
    },
    getMeasuredFps :function _trc_Boot_getMeasuredFps() {
      "use strict";
      var _this=this;
      
      return _this.fps_fps;
    },
    getMeasuredRps :function _trc_Boot_getMeasuredRps() {
      "use strict";
      var _this=this;
      
      return _this.fps_rps;
    },
    measureFps :function _trc_Boot_measureFps() {
      "use strict";
      var _this=this;
      var nowTime;
      
      //$LASTPOS=91012587;//kernel.Boot:12587
      nowTime = _this.now();
      
      //$LASTPOS=91012613;//kernel.Boot:12613
      if (nowTime>=_this.lastMeasured+1000) {
        //$LASTPOS=91012656;//kernel.Boot:12656
        _this.fps_fps=_this.fps_fpsCnt;
        //$LASTPOS=91012685;//kernel.Boot:12685
        _this.fps_rps=_this.fps_rpsCnt;
        //$LASTPOS=91012714;//kernel.Boot:12714
        _this.fps_fpsCnt=0;
        //$LASTPOS=91012737;//kernel.Boot:12737
        _this.fps_rpsCnt=0;
        //$LASTPOS=91012760;//kernel.Boot:12760
        _this.lastMeasured=nowTime;
        
      }
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"initSymbol":{"nowait":false},"timeStop":{"nowait":false},"update":{"nowait":false},"initGlobals":{"nowait":false},"initEvents":{"nowait":false},"initPeripherals":{"nowait":false},"initLayers":{"nowait":false},"debug":{"nowait":false},"loadPlugins":{"nowait":false},"loadImages":{"nowait":false},"loadSounds":{"nowait":false},"createMainObject":{"nowait":false},"loadPage":{"nowait":true},"stop":{"nowait":false},"hide":{"nowait":true},"schedule":{"nowait":false},"progress":{"nowait":false},"progressNoLog":{"nowait":false},"mainLoop":{"nowait":false},"loopRAF":{"nowait":false},"waitRAF":{"nowait":false},"loopTimer":{"nowait":false},"handlePause":{"nowait":false},"drawFrame":{"nowait":true},"moveFrame":{"nowait":true},"afterDraw":{"nowait":true},"initFPSParams":{"nowait":true},"now":{"nowait":true},"resetDeadLine":{"nowait":true},"waitFrame":{"nowait":false},"getFrameRate":{"nowait":true},"setFrameRate":{"nowait":true},"__getter__useRAF":{"nowait":true},"__setter__useRAF":{"nowait":true},"getMeasuredFps":{"nowait":true},"getMeasuredRps":{"nowait":true},"measureFps":{"nowait":true}},"fields":{"eventTypes":{},"cvj":{},"debugCnt":{},"newLimit":{},"mainClass":{},"_useRAF":{},"_fps":{},"subTime":{},"rafProcNowTime":{},"procCnt":{},"maxFrameSkip":{},"doDraw":{},"deadLine":{},"frameSkipped":{},"paused":{},"drawTime":{},"fps_fpsCnt":{},"newLimitCount":{},"moveTime":{},"fps_rpsCnt":{},"minFrameSkip":{},"frameCnt":{},"lastMeasured":{},"fps_fps":{},"fps_rps":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.FadeEffect',
  shortName: 'FadeEffect',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Panel,
  includes: [],
  methods: {
    main :function _trc_FadeEffect_main() {
      "use strict";
      var _this=this;
      
      
      
      
      //$LASTPOS=92000070;//kernel.FadeEffect:70
      _this.fillStyle = _this.fillStyle||"black";
      
      
      
      //$LASTPOS=92000159;//kernel.FadeEffect:159
      _this.duration = _this.duration||30;
      
      switch (_this.type) {
      case "in":
        //$LASTPOS=92000228;//kernel.FadeEffect:228
        _this.alpha=255;
        //$LASTPOS=92000238;//kernel.FadeEffect:238
        _this.alphaTo=0;
        break;
        
      case "out":
        //$LASTPOS=92000275;//kernel.FadeEffect:275
        _this.alpha=0;
        //$LASTPOS=92000283;//kernel.FadeEffect:283
        _this.alphaTo=255;
        break;
        
      }
      //$LASTPOS=92000304;//kernel.FadeEffect:304
      _this.fillRect(0,0,Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
      //$LASTPOS=92000346;//kernel.FadeEffect:346
      _this.sa=_this.alpha;
      //$LASTPOS=92000356;//kernel.FadeEffect:356
      //$LASTPOS=92000361;//kernel.FadeEffect:361
      _this.i=0;for (; _this.i<_this.duration ; _this.i++) {
        {
          //$LASTPOS=92000387;//kernel.FadeEffect:387
          _this.progress=_this.i/(_this.duration-1);
          //$LASTPOS=92000416;//kernel.FadeEffect:416
          _this.alpha=_this.alphaTo*_this.progress+_this.sa*(1-_this.progress);
          //$LASTPOS=92000460;//kernel.FadeEffect:460
          _this.update();
        }
      }
      //$LASTPOS=92000472;//kernel.FadeEffect:472
      _this.sendEvent("complete");
      //$LASTPOS=92000495;//kernel.FadeEffect:495
      if (_this.page) {
        //$LASTPOS=92000511;//kernel.FadeEffect:511
        _this.loadPage(_this.page,_this.params||{});
        
      }
    },
    fiber$main :function _trc_FadeEffect_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      
      
      //$LASTPOS=92000070;//kernel.FadeEffect:70
      _this.fillStyle = _this.fillStyle||"black";
      
      
      
      //$LASTPOS=92000159;//kernel.FadeEffect:159
      _this.duration = _this.duration||30;
      
      switch (_this.type) {
      case "in":
        //$LASTPOS=92000228;//kernel.FadeEffect:228
        _this.alpha=255;
        //$LASTPOS=92000238;//kernel.FadeEffect:238
        _this.alphaTo=0;
        break;
        
      case "out":
        //$LASTPOS=92000275;//kernel.FadeEffect:275
        _this.alpha=0;
        //$LASTPOS=92000283;//kernel.FadeEffect:283
        _this.alphaTo=255;
        break;
        
      }
      //$LASTPOS=92000304;//kernel.FadeEffect:304
      _this.fillRect(0,0,Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
      //$LASTPOS=92000346;//kernel.FadeEffect:346
      _this.sa=_this.alpha;
      
      _thread.enter(function _trc_FadeEffect_ent_main(_thread) {
        if (_thread.lastEx) __pc=_thread.catchPC;
        for(var __cnt=100 ; __cnt--;) {
          switch (__pc) {
          case 0:
            //$LASTPOS=92000356;//kernel.FadeEffect:356
            //$LASTPOS=92000361;//kernel.FadeEffect:361
            _this.i=0;
          case 1:
            if (!(_this.i<_this.duration)) { __pc=4     ; break; }
            //$LASTPOS=92000387;//kernel.FadeEffect:387
            _this.progress=_this.i/(_this.duration-1);
            //$LASTPOS=92000416;//kernel.FadeEffect:416
            _this.alpha=_this.alphaTo*_this.progress+_this.sa*(1-_this.progress);
            //$LASTPOS=92000460;//kernel.FadeEffect:460
            _this.fiber$update(_thread);
            __pc=2;return;
          case 2:
            
          case 3     :
            _this.i++;
            __pc=1;break;
          case 4     :
            
            //$LASTPOS=92000472;//kernel.FadeEffect:472
            _this.sendEvent("complete");
            //$LASTPOS=92000495;//kernel.FadeEffect:495
            if (_this.page) {
              //$LASTPOS=92000511;//kernel.FadeEffect:511
              _this.loadPage(_this.page,_this.params||{});
              
            }
            _thread.exit(_this);return;
          }
        }
      });
    },
    __getter__defaultLayer :function _trc_FadeEffect___getter__defaultLayer() {
      "use strict";
      var _this=this;
      
      return Tonyu.globals.$frontLayer;
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"__getter__defaultLayer":{"nowait":true}},"fields":{"type":{},"alphaTo":{},"alpha":{},"fillStyle":{},"page":{},"params":{},"duration":{},"sa":{},"i":{},"progress":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.DxChar',
  shortName: 'DxChar',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.SpriteChar,
  includes: [],
  methods: {
    main :function _trc_DxChar_main() {
      "use strict";
      var _this=this;
      
    },
    fiber$main :function _trc_DxChar_f_main(_thread) {
      "use strict";
      var _this=this;
      //var _arguments=Tonyu.A(arguments);
      var __pc=0;
      
      
      _thread.retVal=_this;return;
    },
    initialize :function _trc_DxChar_initialize(xx,yy,pp,ff,sz,rt,al) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=93000057;//kernel.DxChar:57
      Tonyu.classes.kernel.SpriteChar.apply( _this, [xx,yy,pp,ff]);
      //$LASTPOS=93000082;//kernel.DxChar:82
      _this.scaleX=1;
      //$LASTPOS=93000097;//kernel.DxChar:97
      if (sz) {
        //$LASTPOS=93000105;//kernel.DxChar:105
        _this.scaleX=sz;
      }
      //$LASTPOS=93000121;//kernel.DxChar:121
      _this.angle=0;
      //$LASTPOS=93000135;//kernel.DxChar:135
      if (rt) {
        //$LASTPOS=93000143;//kernel.DxChar:143
        _this.angle=rt;
      }
      //$LASTPOS=93000158;//kernel.DxChar:158
      _this.alpha=255;
      //$LASTPOS=93000174;//kernel.DxChar:174
      if (al) {
        //$LASTPOS=93000182;//kernel.DxChar:182
        _this.alpha=al;
      }
    },
    draw :function _trc_DxChar_draw(c) {
      "use strict";
      var _this=this;
      
      //$LASTPOS=93000212;//kernel.DxChar:212
      if (_this._isInvisible) {
        return _this;
      }
      //$LASTPOS=93000243;//kernel.DxChar:243
      _this.onDraw();
      //$LASTPOS=93000258;//kernel.DxChar:258
      _this.detectShape();
      //$LASTPOS=93000278;//kernel.DxChar:278
      _this.drawDxSprite(_this.x,_this.y,_this.p,_this.f,_this.zOrder,_this.angle,_this.alpha,_this.scaleX,_this.scaleY);
    },
    __dummy: false
  },
  decls: {"methods":{"main":{"nowait":false},"new":{"nowait":false},"draw":{"nowait":true}},"fields":{"angle":{}}}
});

//# sourceMappingURL=concat.js.map