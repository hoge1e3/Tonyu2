if(!Tonyu.load)Tonyu.load=(_,f)=>f();
Tonyu.load({"dontFix":true,"compiler":{"noLoopCheck":true,"namespace":"kernel","commentLastPos":true,"outputFile":"js/concat.js","requireFieldDecl":false,"field_strict":false,"defaultSuperClass":"","typeCheck":true,"dependingProjects":[]},"run":{"bootClass":"kernel.Boot","mainClass":"kernel.KernelDemo"},"social":{"prjName":"Kernel","title":"Kernel","whenPrjDirExists":"selectPolicy"}}, ()=>{
Tonyu.klass.define({
  fullName: 'kernel.EventHandlerCaller',
  shortName: 'EventHandlerCaller',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_EventHandlerCaller_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_EventHandlerCaller_f_main(_thread) {
        var _this=this;
        
        
      },
      callEventHandler :function _trc_EventHandlerCaller_callEventHandler(h,args) {
        var _this=this;
        var t;
        
        
        if (h["fiber"]) {
          t=Tonyu.thread();
          t.apply(_this.target,h,args);
          t.stepsLoop();
          
        } else {
          return h.apply(_this.target,args);
          
        }
      },
      fiber$callEventHandler :function* _trc_EventHandlerCaller_f_callEventHandler(_thread,h,args) {
        var _this=this;
        var t;
        
        
        if (h["fiber"]) {
          t=Tonyu.thread();
          t.apply(_this.target,h,args);
          t.stepsLoop();
          
        } else {
          return h.apply(_this.target,args);
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"callEventHandler":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"target":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.EventMod',
  shortName: 'EventMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_EventMod_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_EventMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initEventMod :function _trc_EventMod_initEventMod() {
        var _this=this;
        
        if (_this._eventHandlers) {
          return _this;
        }
        _this._eventHandlers={};
        _this.on("die",Tonyu.bindFunc(_this,_this.releaseEventMod));
      },
      releaseEventMod :function _trc_EventMod_releaseEventMod() {
        var _this=this;
        var k;
        var v;
        
        for ([k, v] of Tonyu.iterator2(_this._eventHandlers,2)) {
          v.release();
          
        }
      },
      parseEventArgs :function _trc_EventMod_parseEventArgs(a) {
        var _this=this;
        var res;
        var i;
        
        res = {type: a[0],args: []};
        
        for (i = 1;
         i<a.length ; i++) {
          {
            res.args.push(a[i]);
          }
        }
        return res;
      },
      findEventHandlerClass :function _trc_EventMod_findEventHandlerClass(type) {
        var _this=this;
        
        return Tonyu.classes.kernel.EventHandler;
      },
      registerEventHandler :function _trc_EventMod_registerEventHandler(type,obj) {
        var _this=this;
        var cl;
        
        _this.initEventMod();
        if (typeof  type=="function") {
          obj=obj||new type({target: _this});
          type=obj.getClassInfo().fullName;
          
        } else {
          if (! obj) {
            cl = _this.findEventHandlerClass(type);
            
            obj=new cl({target: _this});
            
          }
          
        }
        return _this._eventHandlers[type]=obj;
      },
      getEventHandler :function _trc_EventMod_getEventHandler(type) {
        var _this=this;
        var res;
        
        _this.initEventMod();
        if (typeof  type=="function") {
          type=type.meta.fullName;
          
        }
        res = _this._eventHandlers[type];
        
        return res;
      },
      getOrRegisterEventHandler :function _trc_EventMod_getOrRegisterEventHandler(type) {
        var _this=this;
        var res;
        
        res = _this.getEventHandler(type)||_this.registerEventHandler(type);
        
        return res;
      },
      on :function _trc_EventMod_on() {
        var _this=this;
        var a;
        var h;
        
        a = _this.parseEventArgs(arguments);
        
        h = _this.getOrRegisterEventHandler(a.type);
        
        return h.addListener.apply(h,a.args);
      },
      fireEvent :function _trc_EventMod_fireEvent(type,arg) {
        var _this=this;
        var h;
        
        if (! _this._eventHandlers) {
          return _this;
        }
        h = _this.getEventHandler(type);
        
        if (h) {
          h.fire([arg]);
        }
      },
      sendEvent :function _trc_EventMod_sendEvent(type,arg) {
        var _this=this;
        
        _this.fireEvent(type,arg);
      },
      waitEvent :function _trc_EventMod_waitEvent() {
        var _this=this;
        var args;
        var act;
        
        if (null) {
          args = new Tonyu.classes.kernel.ArgParser(arguments);
          
          act = args.shift(Tonyu.classes.kernel.EventMod)||_this;
          
          args.trimUndefs();
          null.waitEvent(act,args.toArray());
          null;
          return null.retVal;
          
        }
      },
      fiber$waitEvent :function* _trc_EventMod_f_waitEvent(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var args;
        var act;
        
        if (_thread) {
          args = new Tonyu.classes.kernel.ArgParser(_arguments);
          
          act = args.shift(Tonyu.classes.kernel.EventMod)||_this;
          
          args.trimUndefs();
          _thread.waitEvent(act,args.toArray());
          (yield* _thread.await(null));
          return _thread.retVal;
          
        }
        
      },
      waitFor :function _trc_EventMod_waitFor(f) {
        var _this=this;
        var r;
        
        if (null) {
          if (Tonyu.supports_await) {
            return f;
            
          }
          r = null.waitFor(f);
          
          return r;
          
        }
        return f;
      },
      fiber$waitFor :function* _trc_EventMod_f_waitFor(_thread,f) {
        var _this=this;
        var r;
        
        if (_thread) {
          if (Tonyu.supports_await) {
            return (yield* _thread.await(f));
            
          }
          r = _thread.waitFor(f);
          
          return r;
          
        }
        return f;
        
      },
      runPromise :function _trc_EventMod_runPromise(f) {
        var _this=this;
        var pr;
        
        pr = new Promise(f);
        
        if (! null) {
          return pr;
          
        } else {
          return _this.waitFor(pr);
          
        }
      },
      fiber$runPromise :function* _trc_EventMod_f_runPromise(_thread,f) {
        var _this=this;
        var pr;
        
        pr = new Promise(f);
        
        if (! _thread) {
          return pr;
          
        } else {
          return yield* _this.fiber$waitFor(_thread, pr);
          
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"initEventMod":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"releaseEventMod":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"parseEventArgs":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"findEventHandlerClass":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"registerEventHandler":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getEventHandler":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getOrRegisterEventHandler":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"on":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"fireEvent":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"sendEvent":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"waitEvent":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"waitFor":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"runPromise":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"_eventHandlers":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.OneframeSpriteMod',
  shortName: 'OneframeSpriteMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_OneframeSpriteMod_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_OneframeSpriteMod_f_main(_thread) {
        var _this=this;
        
        
      },
      drawText :function _trc_OneframeSpriteMod_drawText(x,y,text,fillStyle,size,zOrder) {
        var _this=this;
        
        if (! size) {
          size=15;
        }
        if (! fillStyle) {
          fillStyle="white";
        }
        _this.appear(Tonyu.classes.kernel.T1Text,{x: x,y: y,text: text,fillStyle: fillStyle,size: size,zOrder: zOrder,owner: _this});
      },
      centerText :function _trc_OneframeSpriteMod_centerText(x,y,text,fillStyle,size,zOrder) {
        var _this=this;
        
        if (! size) {
          size=15;
        }
        if (! fillStyle) {
          fillStyle="white";
        }
        _this.appear(Tonyu.classes.kernel.T1Text,{x: x,y: y,text: text,fillStyle: fillStyle,size: size,zOrder: zOrder,owner: _this,align: new Tonyu.classes.kernel.Align2D("center")});
      },
      drawTextEx :function _trc_OneframeSpriteMod_drawTextEx(o) {
        var _this=this;
        
        if (typeof  o!="object") {
          return _this;
        }
        if (! o.size) {
          o.size=15;
        }
        if (! o.fillStyle) {
          o.fillStyle="white";
        }
        if (! o.align) {
          o.align="left";
        }
        if (o.alpha==null) {
          o.alpha=255;
        }
        _this.appear(Tonyu.classes.kernel.T1Text,{x: o.x,y: o.y,text: o.text,fillStyle: o.fillStyle,size: o.size,zOrder: o.zOrder,owner: _this,align: new Tonyu.classes.kernel.Align2D(o.align),alpha: o.alpha,font: o.font});
      },
      drawLine :function _trc_OneframeSpriteMod_drawLine(x,y,tx,ty,col,zOrder) {
        var _this=this;
        
        if (! col) {
          col="white";
        }
        _this.appear(Tonyu.classes.kernel.T1Line,{x: x,y: y,tx: tx,ty: ty,col: col,zOrder: zOrder,owner: _this});
      },
      drawRect :function _trc_OneframeSpriteMod_drawRect(x,y,w,h,col,zOrder) {
        var _this=this;
        
        _this.appear(Tonyu.classes.kernel.T1Rect,{x: x,y: y,w: w,h: h,col: col,zOrder: zOrder,fill: false,owner: _this});
      },
      drawRectT1 :function _trc_OneframeSpriteMod_drawRectT1(x,y,tx,ty,col,zOrder) {
        var _this=this;
        
        _this.appear(Tonyu.classes.kernel.T1Rect,{x: x,y: y,w: tx-x,h: ty-y,col: col,zOrder: zOrder,fill: false,owner: _this});
      },
      fillRect :function _trc_OneframeSpriteMod_fillRect(x,y,w,h,col,zOrder) {
        var _this=this;
        
        _this.appear(Tonyu.classes.kernel.T1Rect,{x: x,y: y,w: w,h: h,col: col,zOrder: zOrder,fill: true,owner: _this});
      },
      fillRectT1 :function _trc_OneframeSpriteMod_fillRectT1(x,y,tx,ty,col,zOrder) {
        var _this=this;
        
        _this.appear(Tonyu.classes.kernel.T1Rect,{x: x,y: y,w: tx-x,h: ty-y,col: col,zOrder: zOrder,fill: true,owner: _this});
      },
      drawSprite :function _trc_OneframeSpriteMod_drawSprite(x,y,p,f,zOrder) {
        var _this=this;
        
        _this.drawDxSprite(x,y,p,f,zOrder,0,255,1,1);
      },
      drawDxSprite :function _trc_OneframeSpriteMod_drawDxSprite(x,y,p,f,zOrder,angle,alpha,scaleX,scaleY) {
        var _this=this;
        
        _this.appear(Tonyu.classes.kernel.T1Sprite,{x: x,y: y,p: p,f: f,zOrder: zOrder,angle: angle,alpha: alpha,scaleX: scaleX,scaleY: scaleY,owner: _this});
      },
      setPolygon :function _trc_OneframeSpriteMod_setPolygon(seq,x,y) {
        var _this=this;
        
        if (seq<0||seq>=100) {
          return _this;
        }
        if (! Tonyu.globals.$_setPolygonTempAry) {
          Tonyu.globals.$_setPolygonTempAry=new Array(2*100);
        }
        Tonyu.globals.$_setPolygonTempAry[seq*2]=x;
        Tonyu.globals.$_setPolygonTempAry[seq*2+1]=y;
      },
      fillPolygon :function _trc_OneframeSpriteMod_fillPolygon(x,y,posCnt,col,zOrder,alpha) {
        var _this=this;
        var startPos;
        var i;
        var endPos;
        
        if (! (Tonyu.globals.$_setPolygonTempAry instanceof Array)) {
          return _this;
        }
        if (posCnt>100) {
          posCnt=100;
        }
        if (alpha==null) {
          alpha=255;
        }
        if (! Tonyu.globals.$_setPolygonDrawAry) {
          Tonyu.globals.$_setPolygonDrawAry=[];
          Tonyu.globals.$_setPolygonDrawIdx=0;
          Tonyu.globals.$_setPolygonDrawFrame=- 1;
          
        }
        if (Tonyu.globals.$_setPolygonDrawFrame!=Tonyu.globals.$frameCount) {
          Tonyu.globals.$_setPolygonDrawFrame=Tonyu.globals.$frameCount;
          Tonyu.globals.$_setPolygonDrawIdx=0;
          
        }
        startPos = Tonyu.globals.$_setPolygonDrawIdx;
        
        for (i = 0;
         i<posCnt ; i++) {
          {
            Tonyu.globals.$_setPolygonDrawAry[Tonyu.globals.$_setPolygonDrawIdx]=Tonyu.globals.$_setPolygonTempAry[i*2];
            Tonyu.globals.$_setPolygonDrawAry[Tonyu.globals.$_setPolygonDrawIdx+1]=Tonyu.globals.$_setPolygonTempAry[i*2+1];
            Tonyu.globals.$_setPolygonDrawIdx+=2;
          }
        }
        endPos = Tonyu.globals.$_setPolygonDrawIdx;
        
        _this.appear(Tonyu.classes.kernel.T1FillPolygon,{x: x,y: y,startPos: startPos,endPos: endPos,col: col,zOrder: zOrder,alpha: alpha,owner: _this});
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"drawText":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"centerText":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"drawTextEx":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"drawLine":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"drawRect":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"drawRectT1":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"fillRect":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"fillRectT1":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"drawSprite":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}},"drawDxSprite":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null],"returnValue":null}},"setPolygon":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"fillPolygon":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}}},"fields":{"appear":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.SpriteMod',
  shortName: 'SpriteMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_SpriteMod_main() {
        var _this=this;
        
        "field strict";
        
        
        
      },
      fiber$main :function* _trc_SpriteMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
      },
      initSpriteMod :function _trc_SpriteMod_initSpriteMod() {
        var _this=this;
        
        _this.position=new Tonyu.classes.kernel.Vec3View(_this);
        if (_this.scaleX==null) {
          _this.scaleX=1;
        }
        if (_this.rotation==null) {
          _this.rotation=0;
        }
        if (_this.alpha==null) {
          _this.alpha=255;
        }
        if (_this.zOrder==null) {
          _this.zOrder=0;
        }
        _this.initTransform();
      },
      fiber$initSpriteMod :function* _trc_SpriteMod_f_initSpriteMod(_thread) {
        var _this=this;
        
        _this.position=new Tonyu.classes.kernel.Vec3View(_this);
        if (_this.scaleX==null) {
          _this.scaleX=1;
        }
        if (_this.rotation==null) {
          _this.rotation=0;
        }
        if (_this.alpha==null) {
          _this.alpha=255;
        }
        if (_this.zOrder==null) {
          _this.zOrder=0;
        }
        (yield* _this.fiber$initTransform(_thread));
        
      },
      initTransform :function _trc_SpriteMod_initTransform() {
        var _this=this;
        
      },
      fiber$initTransform :function* _trc_SpriteMod_f_initTransform(_thread) {
        var _this=this;
        
        
      },
      __getter__align :function _trc_SpriteMod___getter__align() {
        var _this=this;
        
        return _this._alignVal;
      },
      prepareImage :function _trc_SpriteMod_prepareImage() {
        var _this=this;
        
        if (typeof  _this.p!="number") {
          _this.p=(_this.p-0)||0;
          
        }
        _this.p=Math.floor(_this.p);
        _this.pImg=Tonyu.globals.$imageList[_this.p];
        if (! _this.pImg) {
          return _this;
        }
        _this.width=_this.pImg.width;
        _this.height=_this.pImg.height;
      },
      color :function _trc_SpriteMod_color(r,g,b) {
        var _this=this;
        
        return "rgb("+[r,g,b].join(",")+")";
      },
      colorHSL :function _trc_SpriteMod_colorHSL(iroai,azayakasa,akarusa) {
        var _this=this;
        var r;
        var g;
        var b;
        var a;
        
        
        r=Math.abs(120-((Math.trunc(iroai+0.5)%240)%240))*6-240;
        g=Math.abs(120-((Math.trunc(iroai+160.5)%240)%240))*6-240;
        b=Math.abs(120-((Math.trunc(iroai+80.5)%240)%240))*6-240;
        r=Math.trunc(r*1.0625+0.5);
        g=Math.trunc(g*1.0625+0.5);
        b=Math.trunc(b*1.0625+0.5);
        if (r>255) {
          r=255;
        }
        if (g>255) {
          g=255;
        }
        if (b>255) {
          b=255;
        }
        if (r<0) {
          r=0;
        }
        if (g<0) {
          g=0;
        }
        if (b<0) {
          b=0;
        }
        if (azayakasa==null) {
          return _this.color(r,g,b);
        }
        r=Math.trunc(127.5+(r-127)/240*azayakasa);
        g=Math.trunc(127.5+(g-127)/240*azayakasa);
        b=Math.trunc(127.5+(b-127)/240*azayakasa);
        if (akarusa==null) {
          return _this.color(r,g,b);
        }
        if (akarusa<120) {
          r=Math.trunc(0.5+r/120*akarusa);
          g=Math.trunc(0.5+g/120*akarusa);
          b=Math.trunc(0.5+b/120*akarusa);
          
        }
        if (akarusa>120) {
          r+=Math.trunc(0.5+(255-r)/120*(akarusa-120));
          g+=Math.trunc(0.5+(255-g)/120*(akarusa-120));
          b+=Math.trunc(0.5+(255-b)/120*(akarusa-120));
          
        }
        if (r>255) {
          r=255;
        }
        if (g>255) {
          g=255;
        }
        if (b>255) {
          b=255;
        }
        if (r<0) {
          r=0;
        }
        if (g<0) {
          g=0;
        }
        if (b<0) {
          b=0;
        }
        return _this.color(r,g,b);
      },
      setVisible :function _trc_SpriteMod_setVisible(v) {
        var _this=this;
        
        _this._isInvisible=! v;
      },
      fiber$setVisible :function* _trc_SpriteMod_f_setVisible(_thread,v) {
        var _this=this;
        
        _this._isInvisible=! v;
        
      },
      detectSpriteType :function _trc_SpriteMod_detectSpriteType() {
        var _this=this;
        
        if (_this.text!=null) {
          return "Text";
          
        } else {
          if (_this.fillStyle!=null) {
            return "Shape";
            
          } else {
            if (_this.p&&typeof  _this.p.draw==="function") {
              return "Custom";
              
            } else {
              return "Image";
              
            }
          }
        }
      },
      fiber$detectSpriteType :function* _trc_SpriteMod_f_detectSpriteType(_thread) {
        var _this=this;
        
        if (_this.text!=null) {
          return "Text";
          
        } else {
          if (_this.fillStyle!=null) {
            return "Shape";
            
          } else {
            if (_this.p&&typeof  _this.p.draw==="function") {
              return "Custom";
              
            } else {
              return "Image";
              
            }
          }
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"initSpriteMod":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initTransform":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__align":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"prepareImage":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"color":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"colorHSL":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"setVisible":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"detectSpriteType":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"p":{},"pImg":{},"text":{},"size":{},"font":{},"align":{},"fillStyle":{},"scaleX":{},"scaleY":{},"width":{},"height":{},"radius":{},"rotation":{},"alpha":{},"position":{},"zOrder":{},"_isInvisible":{},"subsprites":{},"_alignVal":{},"_align":{},"__addedToSprites":{"vtype":"kernel.Sprites"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.SpriteMod3D',
  shortName: 'SpriteMod3D',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.SpriteMod],
  methods: function (__superClass) {
    return {
      main :function _trc_SpriteMod3D_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_SpriteMod3D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      detectSpriteType :function _trc_SpriteMod3D_detectSpriteType() {
        var _this=this;
        var t;
        
        t = __superClass.prototype.detectSpriteType.apply( _this, []);
        
        if (t==="Image"&&_this.p&&_this.p.draw3D) {
          return "Custom";
        }
        return t;
      },
      fiber$detectSpriteType :function* _trc_SpriteMod3D_f_detectSpriteType(_thread) {
        var _this=this;
        var t;
        
        t = __superClass.prototype.detectSpriteType.apply( _this, []);
        
        if (t==="Image"&&_this.p&&_this.p.draw3D) {
          return "Custom";
        }
        return t;
        
      },
      initTransform :function _trc_SpriteMod3D_initTransform() {
        var _this=this;
        var givenTransform;
        
        if (_this.direction) {
          _this.direction=_this.direction.clone();
        } else {
          _this.direction=new Tonyu.classes.kernel.Direction;
        }
        givenTransform = _this.transform;
        
        _this.transform=new Tonyu.classes.kernel.Transform({direction: _this.direction,position: _this.position,scale: (_this._prescale||1),actor: _this});
        if (givenTransform) {
          _this.transform.set(givenTransform);
        }
      },
      fiber$initTransform :function* _trc_SpriteMod3D_f_initTransform(_thread) {
        var _this=this;
        var givenTransform;
        
        if (_this.direction) {
          _this.direction=_this.direction.clone();
        } else {
          _this.direction=new Tonyu.classes.kernel.Direction;
        }
        givenTransform = _this.transform;
        
        _this.transform=new Tonyu.classes.kernel.Transform({direction: _this.direction,position: _this.position,scale: (_this._prescale||1),actor: _this});
        if (givenTransform) {
          _this.transform.set(givenTransform);
        }
        
      },
      __getter__scale :function _trc_SpriteMod3D___getter__scale() {
        var _this=this;
        
        if (! _this.transform) {
          return _this._prescale;
        }
        return _this.transform.scale;
      },
      __setter__scale :function _trc_SpriteMod3D___setter__scale(s) {
        var _this=this;
        
        if (! _this.transform) {
          return _this._prescale=s;
        }
        _this.transform.scale=s;
      },
      draw3D :function _trc_SpriteMod3D_draw3D(ctx3d) {
        var _this=this;
        var t;
        
        t = _this.detectSpriteType();
        
        if (t==="Image") {
          _this.prepareImage();
        }
        if (_this.p&&_this.p.draw3D) {
          ctx3d.save();
          ctx3d.transform(_this.transform);
          _this.p.draw3D(ctx3d);
          ctx3d.restore();
          
        } else {
          ctx3d.addSprite3D(_this);
          
        }
        if (_this.subsprites&&_this.subsprites.draw3D) {
          ctx3d.save();
          ctx3d.transform(_this.transform);
          _this.subsprites.draw3D(ctx3d);
          ctx3d.restore();
          
        }
      },
      fiber$draw3D :function* _trc_SpriteMod3D_f_draw3D(_thread,ctx3d) {
        var _this=this;
        var t;
        
        t=yield* _this.fiber$detectSpriteType(_thread);
        
        if (t==="Image") {
          _this.prepareImage();
        }
        if (_this.p&&_this.p.draw3D) {
          ctx3d.save();
          ctx3d.transform(_this.transform);
          _this.p.draw3D(ctx3d);
          ctx3d.restore();
          
        } else {
          ctx3d.addSprite3D(_this);
          
        }
        if (_this.subsprites&&_this.subsprites.draw3D) {
          ctx3d.save();
          ctx3d.transform(_this.transform);
          _this.subsprites.draw3D(ctx3d);
          ctx3d.restore();
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"detectSpriteType":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initTransform":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__scale":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__scale":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"draw3D":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"x":{},"y":{},"z":{},"direction":{},"transform":{},"_prescale":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TextRectMod',
  shortName: 'TextRectMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_TextRectMod_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_TextRectMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      drawTextRect :function _trc_TextRectMod_drawTextRect(ctx,text,x,topY,h,align,type) {
        var _this=this;
        var met;
        var res;
        var r;
        
        if (! align) {
          align=new Tonyu.classes.kernel.Align2D;
        }
        ctx.textBaseline=(align.v==="center"?"middle":align.v==="default"?"top":align.v);
        _this.setFontSize(ctx,h);
        met = ctx.measureText(text);
        
        res = {y: topY,w: met.width,h: h};
        
        r = align.getDrawRect({width: met.width,height: h});
        
        res.x=x+r.x-r.width/2;
        if (type=="fill") {
          ctx.fillText(text,res.x,topY);
        }
        if (type=="stroke") {
          ctx.strokeText(text,res.x,topY);
        }
        return res;
      },
      setFontSize :function _trc_TextRectMod_setFontSize(ctx,sz) {
        var _this=this;
        var post;
        
        post = ctx.font.replace(/^[0-9\.]+/,"");
        
        ctx.font=sz+post;
      },
      fukidashi :function _trc_TextRectMod_fukidashi(ctx,text,x,y,sz) {
        var _this=this;
        var align;
        var theight;
        var margin;
        var r;
        var fs;
        
        align = "c";
        
        theight = 20;
        
        margin = 5;
        
        r = _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align);
        
        ctx.beginPath();
        ctx.moveTo(x,y);
        ctx.lineTo(x+margin,y-theight);
        ctx.lineTo(x+r.w/2+margin,y-theight);
        ctx.lineTo(x+r.w/2+margin,y-theight-r.h-margin*2);
        ctx.lineTo(x-r.w/2-margin,y-theight-r.h-margin*2);
        ctx.lineTo(x-r.w/2-margin,y-theight);
        ctx.lineTo(x-margin,y-theight);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        fs = ctx.fillStyle;
        
        ctx.fillStyle=ctx.strokeStyle;
        _this.drawTextRect(ctx,text,x,y-theight-margin-sz,sz,align,"fill");
        ctx.fillStyle=fs;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"drawTextRect":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,"kernel.Align2D",null],"returnValue":null}},"setFontSize":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"fukidashi":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.TD_P',
  shortName: 'TD_P',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_TD_P_main() {
        var _this=this;
        
        
        
      },
      fiber$main :function* _trc_TD_P_f_main(_thread) {
        var _this=this;
        
        
        
        
      },
      initialize :function _trc_TD_P_initialize(xxx,yyy,zzz) {
        var _this=this;
        
        _this.x=xxx;
        _this.y=yyy;
        _this.z=zzz;
        _this.gp=0;
        _this.gxz=0;
        _this.gxy=0;
        _this.gyz=0;
        _this.ggx=0;
        _this.ggy=0;
        _this.ggz=0;
        _this.x2=0;
        _this.y2=0;
        _this.z2=0;
      },
      zikuSet :function _trc_TD_P_zikuSet(ggp,xxx,yyy,zzz) {
        var _this=this;
        
        _this.gp=ggp;
        _this.x2=xxx;
        _this.y2=yyy;
        _this.z2=zzz;
      },
      fiber$zikuSet :function* _trc_TD_P_f_zikuSet(_thread,ggp,xxx,yyy,zzz) {
        var _this=this;
        
        _this.gp=ggp;
        _this.x2=xxx;
        _this.y2=yyy;
        _this.z2=zzz;
        
      },
      kaiten :function _trc_TD_P_kaiten(xx,yy,zz,ax,ay,az,axz,ayz,axy,xzsin,yzsin,xysin,xzcos,yzcos,xycos,z_x,z_y,z_z,k_xzsin,k_yzsin,k_xysin,k_xzcos,k_yzcos,k_xycos) {
        var _this=this;
        var kx;
        var ky;
        var gxzsin;
        var gyzsin;
        var gxysin;
        var gxzcos;
        var gyzcos;
        var gxycos;
        var wx;
        var wy;
        var wz;
        
        
        if (Tonyu.is(_this.gp,Tonyu.classes.kernel.TD_P)) {
          _this.sx=_this.gp.x;
          _this.sy=_this.gp.y;
          _this.sz=_this.gp.z;
          
        } else {
          _this.sx=_this.x;
          _this.sy=- _this.y;
          _this.sz=_this.z;
          
        }
        if (Tonyu.is(_this.gp,Tonyu.classes.kernel.TD_P)) {
          wx=_this.x2;
          wy=- _this.y2;
          wz=_this.z2;
          gxzsin=Tonyu.globals.$TD_Z.rsin(_this.gxz);
          gyzsin=Tonyu.globals.$TD_Z.rsin(_this.gyz);
          gxysin=Tonyu.globals.$TD_Z.rsin(_this.gxy);
          gxzcos=Tonyu.globals.$TD_Z.rcos(_this.gxz);
          gyzcos=Tonyu.globals.$TD_Z.rcos(_this.gyz);
          gxycos=Tonyu.globals.$TD_Z.rcos(_this.gxy);
          kx=wx*gxycos-wy*gxysin;
          wy=wy*gxycos+wx*gxysin;
          wx=kx;
          ky=wy*gyzcos-wz*gyzsin;
          wz=wz*gyzcos+wy*gyzsin;
          wy=ky;
          kx=wx*gxzcos+wz*gxzsin;
          wz=wz*gxzcos-wx*gxzsin;
          wx=kx;
          _this.sx+=wx;
          _this.sy+=wy;
          _this.sz+=wz;
          _this.x=_this.sx;
          _this.y=_this.sy;
          _this.z=_this.sz;
          
        }
        _this.sx-=ax;
        _this.sy+=ay;
        _this.sz-=az;
        kx=_this.sx*xycos-_this.sy*xysin;
        _this.sy=_this.sy*xycos+_this.sx*xysin;
        _this.sx=kx;
        ky=_this.sy*yzcos-_this.sz*yzsin;
        _this.sz=_this.sz*yzcos+_this.sy*yzsin;
        _this.sy=ky;
        kx=_this.sx*xzcos+_this.sz*xzsin;
        _this.sz=_this.sz*xzcos-_this.sx*xzsin;
        _this.sx=kx;
        _this.sx+=ax;
        _this.sy-=ay;
        _this.sz+=az;
        _this.sx+=xx-z_x;
        _this.sy+=yy+z_y;
        _this.sz+=zz-z_z;
        kx=_this.sx*k_xzcos-_this.sz*k_xzsin;
        _this.sz=_this.sz*k_xzcos+_this.sx*k_xzsin;
        _this.sx=kx;
        ky=_this.sy*k_yzcos+_this.sz*k_yzsin;
        _this.sz=_this.sz*k_yzcos-_this.sy*k_yzsin;
        _this.sy=ky;
        kx=_this.sx*k_xycos+_this.sy*k_xysin;
        _this.sy=_this.sy*k_xycos-_this.sx*k_xysin;
        _this.sx=kx;
      },
      fiber$kaiten :function* _trc_TD_P_f_kaiten(_thread,xx,yy,zz,ax,ay,az,axz,ayz,axy,xzsin,yzsin,xysin,xzcos,yzcos,xycos,z_x,z_y,z_z,k_xzsin,k_yzsin,k_xysin,k_xzcos,k_yzcos,k_xycos) {
        var _this=this;
        var kx;
        var ky;
        var gxzsin;
        var gyzsin;
        var gxysin;
        var gxzcos;
        var gyzcos;
        var gxycos;
        var wx;
        var wy;
        var wz;
        
        
        if (Tonyu.is(_this.gp,Tonyu.classes.kernel.TD_P)) {
          _this.sx=_this.gp.x;
          _this.sy=_this.gp.y;
          _this.sz=_this.gp.z;
          
        } else {
          _this.sx=_this.x;
          _this.sy=- _this.y;
          _this.sz=_this.z;
          
        }
        if (Tonyu.is(_this.gp,Tonyu.classes.kernel.TD_P)) {
          wx=_this.x2;
          wy=- _this.y2;
          wz=_this.z2;
          gxzsin=Tonyu.globals.$TD_Z.rsin(_this.gxz);
          gyzsin=Tonyu.globals.$TD_Z.rsin(_this.gyz);
          gxysin=Tonyu.globals.$TD_Z.rsin(_this.gxy);
          gxzcos=Tonyu.globals.$TD_Z.rcos(_this.gxz);
          gyzcos=Tonyu.globals.$TD_Z.rcos(_this.gyz);
          gxycos=Tonyu.globals.$TD_Z.rcos(_this.gxy);
          kx=wx*gxycos-wy*gxysin;
          wy=wy*gxycos+wx*gxysin;
          wx=kx;
          ky=wy*gyzcos-wz*gyzsin;
          wz=wz*gyzcos+wy*gyzsin;
          wy=ky;
          kx=wx*gxzcos+wz*gxzsin;
          wz=wz*gxzcos-wx*gxzsin;
          wx=kx;
          _this.sx+=wx;
          _this.sy+=wy;
          _this.sz+=wz;
          _this.x=_this.sx;
          _this.y=_this.sy;
          _this.z=_this.sz;
          
        }
        _this.sx-=ax;
        _this.sy+=ay;
        _this.sz-=az;
        kx=_this.sx*xycos-_this.sy*xysin;
        _this.sy=_this.sy*xycos+_this.sx*xysin;
        _this.sx=kx;
        ky=_this.sy*yzcos-_this.sz*yzsin;
        _this.sz=_this.sz*yzcos+_this.sy*yzsin;
        _this.sy=ky;
        kx=_this.sx*xzcos+_this.sz*xzsin;
        _this.sz=_this.sz*xzcos-_this.sx*xzsin;
        _this.sx=kx;
        _this.sx+=ax;
        _this.sy-=ay;
        _this.sz+=az;
        _this.sx+=xx-z_x;
        _this.sy+=yy+z_y;
        _this.sz+=zz-z_z;
        kx=_this.sx*k_xzcos-_this.sz*k_xzsin;
        _this.sz=_this.sz*k_xzcos+_this.sx*k_xzsin;
        _this.sx=kx;
        ky=_this.sy*k_yzcos+_this.sz*k_yzsin;
        _this.sz=_this.sz*k_yzcos-_this.sy*k_yzsin;
        _this.sy=ky;
        kx=_this.sx*k_xycos+_this.sy*k_xysin;
        _this.sy=_this.sy*k_xycos-_this.sx*k_xysin;
        _this.sx=kx;
        
      },
      henkan2D :function _trc_TD_P_henkan2D(kk,zk,hw,hh) {
        var _this=this;
        
        if (_this.sz>=0) {
          if (zk!=0) {
            _this.k=(_this.sz+kk)/zk;
          }
          _this.xx=_this.sx/_this.k+hw;
          _this.yy=_this.sy/_this.k+hh;
          
        }
      },
      fiber$henkan2D :function* _trc_TD_P_f_henkan2D(_thread,kk,zk,hw,hh) {
        var _this=this;
        
        if (_this.sz>=0) {
          if (zk!=0) {
            _this.k=(_this.sz+kk)/zk;
          }
          _this.xx=_this.sx/_this.k+hw;
          _this.yy=_this.sy/_this.k+hh;
          
        }
        
      },
      xyzSet :function _trc_TD_P_xyzSet(x,y,z) {
        var _this=this;
        
        _this.x=x;
        _this.y=y;
        _this.z=z;
      },
      fiber$xyzSet :function* _trc_TD_P_f_xyzSet(_thread,x,y,z) {
        var _this=this;
        
        _this.x=x;
        _this.y=y;
        _this.z=z;
        
      },
      sxyzSet :function _trc_TD_P_sxyzSet(sx,sy,sz) {
        var _this=this;
        
        _this.sx=sx;
        _this.sy=sy;
        _this.sz=sz;
      },
      fiber$sxyzSet :function* _trc_TD_P_f_sxyzSet(_thread,sx,sy,sz) {
        var _this=this;
        
        _this.sx=sx;
        _this.sy=sy;
        _this.sz=sz;
        
      },
      xySet :function _trc_TD_P_xySet(xx,yy) {
        var _this=this;
        
        _this.xx=xx;
        _this.yy=yy;
      },
      fiber$xySet :function* _trc_TD_P_f_xySet(_thread,xx,yy) {
        var _this=this;
        
        _this.xx=xx;
        _this.yy=yy;
        
      },
      xyzSetP :function _trc_TD_P_xyzSetP(p) {
        var _this=this;
        
        _this.x=p.x;
        _this.y=p.y;
        _this.z=p.z;
      },
      fiber$xyzSetP :function* _trc_TD_P_f_xyzSetP(_thread,p) {
        var _this=this;
        
        _this.x=p.x;
        _this.y=p.y;
        _this.z=p.z;
        
      },
      sxyzSetP :function _trc_TD_P_sxyzSetP(p) {
        var _this=this;
        
        _this.sx=p.sx;
        _this.sy=p.sy;
        _this.sz=p.sz;
      },
      fiber$sxyzSetP :function* _trc_TD_P_f_sxyzSetP(_thread,p) {
        var _this=this;
        
        _this.sx=p.sx;
        _this.sy=p.sy;
        _this.sz=p.sz;
        
      },
      xySetP :function _trc_TD_P_xySetP(p) {
        var _this=this;
        
        _this.xx=p.xx;
        _this.yy=p.yy;
      },
      fiber$xySetP :function* _trc_TD_P_f_xySetP(_thread,p) {
        var _this=this;
        
        _this.xx=p.xx;
        _this.yy=p.yy;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"zikuSet":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"kaiten":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"henkan2D":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"xyzSet":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"sxyzSet":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"xySet":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"xyzSetP":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"sxyzSetP":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"xySetP":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"x":{},"y":{},"z":{},"gp":{},"gxz":{},"gxy":{},"gyz":{},"ggx":{},"ggy":{},"ggz":{},"x2":{},"y2":{},"z2":{},"sx":{},"sy":{},"sz":{},"k":{},"xx":{},"yy":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T2Mod',
  shortName: 'T2Mod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_T2Mod_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_T2Mod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      bvec :function _trc_T2Mod_bvec(tx,ty) {
        var _this=this;
        var b2Vec2;
        
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        return new b2Vec2(tx/_this.wscale,ty/_this.wscale);
      },
      fiber$bvec :function* _trc_T2Mod_f_bvec(_thread,tx,ty) {
        var _this=this;
        var b2Vec2;
        
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        return new b2Vec2(tx/_this.wscale,ty/_this.wscale);
        
      },
      defv :function _trc_T2Mod_defv(t,d) {
        var _this=this;
        
        return (t===t&&(typeof  t)==="number")?t:d;
      },
      fiber$defv :function* _trc_T2Mod_f_defv(_thread,t,d) {
        var _this=this;
        
        return (t===t&&(typeof  t)==="number")?t:d;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"bvec":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"defv":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"wscale":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.PrintMod',
  shortName: 'PrintMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_PrintMod_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_PrintMod_f_main(_thread) {
        var _this=this;
        
        
      },
      print :function _trc_PrintMod_print() {
        var _this=this;
        
        Tonyu.globals.$_printCount++;
        if (Tonyu.globals.$_printCount>Tonyu.globals.$printLimit) {
          throw new Error("printをしすぎています.\n"+"       $printLimitの値を変更すると、1フレーム間にできるprint回数を変更できます\n"+"       $printLimit="+Tonyu.globals.$printLimit+"; // 現在のprint回数の限度\n"+"       [参考] https://edit.tonyu.jp/doc/limitations.html\n");
          
        }
        console.log.apply(console,arguments);
        if (Tonyu.globals.$consolePanel) {
          Tonyu.globals.$consolePanel.print.apply(Tonyu.globals.$consolePanel,arguments);
          
        }
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"print":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.MediaPlayer',
  shortName: 'MediaPlayer',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_MediaPlayer_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_MediaPlayer_f_main(_thread) {
        var _this=this;
        
        
      },
      play :function _trc_MediaPlayer_play(s) {
        var _this=this;
        
        Tonyu.globals.$sound.playBGM(s);
      },
      fiber$play :function* _trc_MediaPlayer_f_play(_thread,s) {
        var _this=this;
        
        Tonyu.globals.$sound.playBGM(s);
        
      },
      stop :function _trc_MediaPlayer_stop() {
        var _this=this;
        
        Tonyu.globals.$sound.stopBGM(_this.s);
      },
      fiber$stop :function* _trc_MediaPlayer_f_stop(_thread) {
        var _this=this;
        
        Tonyu.globals.$sound.stopBGM(_this.s);
        
      },
      playSE :function _trc_MediaPlayer_playSE() {
        var _this=this;
        
        Tonyu.globals.$sound.playSE(_this.s);
      },
      fiber$playSE :function* _trc_MediaPlayer_f_playSE(_thread) {
        var _this=this;
        
        Tonyu.globals.$sound.playSE(_this.s);
        
      },
      setDelay :function _trc_MediaPlayer_setDelay() {
        var _this=this;
        
      },
      fiber$setDelay :function* _trc_MediaPlayer_f_setDelay(_thread) {
        var _this=this;
        
        
      },
      setVolume :function _trc_MediaPlayer_setVolume() {
        var _this=this;
        
      },
      fiber$setVolume :function* _trc_MediaPlayer_f_setVolume(_thread) {
        var _this=this;
        
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"play":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"stop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"playSE":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setDelay":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setVolume":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"s":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Array',
  shortName: 'T1Array',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_T1Array_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T1Array_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_T1Array_initialize() {
        var _this=this;
        
        _this.data=[];
      },
      ary :function _trc_T1Array_ary() {
        var _this=this;
        
        return _this.data;
      },
      fiber$ary :function* _trc_T1Array_f_ary(_thread) {
        var _this=this;
        
        return _this.data;
        
      },
      add :function _trc_T1Array_add(d) {
        var _this=this;
        
        _this.data.push(d);
      },
      fiber$add :function* _trc_T1Array_f_add(_thread,d) {
        var _this=this;
        
        _this.data.push(d);
        
      },
      clear :function _trc_T1Array_clear() {
        var _this=this;
        
        _this.data.splice(0);
      },
      fiber$clear :function* _trc_T1Array_f_clear(_thread) {
        var _this=this;
        
        _this.data.splice(0);
        
      },
      _delete :function _trc_T1Array__delete(i) {
        var _this=this;
        
        _this.data.splice(i,1);
      },
      fiber$_delete :function* _trc_T1Array_f__delete(_thread,i) {
        var _this=this;
        
        _this.data.splice(i,1);
        
      },
      get :function _trc_T1Array_get(i) {
        var _this=this;
        
        return _this.data[i];
      },
      fiber$get :function* _trc_T1Array_f_get(_thread,i) {
        var _this=this;
        
        return _this.data[i];
        
      },
      indexOf :function _trc_T1Array_indexOf(d) {
        var _this=this;
        
        _this.data.indexOf(d);
      },
      fiber$indexOf :function* _trc_T1Array_f_indexOf(_thread,d) {
        var _this=this;
        
        _this.data.indexOf(d);
        
      },
      insert :function _trc_T1Array_insert(i,d) {
        var _this=this;
        
        _this.data.splice(i,0,d);
      },
      fiber$insert :function* _trc_T1Array_f_insert(_thread,i,d) {
        var _this=this;
        
        _this.data.splice(i,0,d);
        
      },
      lightIndexOf :function _trc_T1Array_lightIndexOf() {
        var _this=this;
        
        _this.data.indexOf(_this.d);
      },
      fiber$lightIndexOf :function* _trc_T1Array_f_lightIndexOf(_thread) {
        var _this=this;
        
        _this.data.indexOf(_this.d);
        
      },
      load :function _trc_T1Array_load() {
        var _this=this;
        
      },
      fiber$load :function* _trc_T1Array_f_load(_thread) {
        var _this=this;
        
        
      },
      remove :function _trc_T1Array_remove() {
        var _this=this;
        var i;
        
        i = _this.data.indexOf(_this.d);
        
        _this.data.splice(i,1);
      },
      fiber$remove :function* _trc_T1Array_f_remove(_thread) {
        var _this=this;
        var i;
        
        i = _this.data.indexOf(_this.d);
        
        _this.data.splice(i,1);
        
      },
      save :function _trc_T1Array_save() {
        var _this=this;
        
      },
      fiber$save :function* _trc_T1Array_f_save(_thread) {
        var _this=this;
        
        
      },
      set :function _trc_T1Array_set(i,d) {
        var _this=this;
        
        _this.data[i]=d;
      },
      fiber$set :function* _trc_T1Array_f_set(_thread,i,d) {
        var _this=this;
        
        _this.data[i]=d;
        
      },
      size :function _trc_T1Array_size() {
        var _this=this;
        
        return _this.data.length;
      },
      fiber$size :function* _trc_T1Array_f_size(_thread) {
        var _this=this;
        
        return _this.data.length;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"ary":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"add":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"clear":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"_delete":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"get":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"indexOf":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"insert":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"lightIndexOf":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"load":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"remove":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"save":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"set":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"size":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"data":{},"d":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ParallelMod',
  shortName: 'ParallelMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ParallelMod_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_ParallelMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      parallel :function _trc_ParallelMod_parallel() {
        var _this=this;
        var args;
        var i;
        var name;
        var th;
        
        args = [];
        
        for (i = 1;
         i<arguments.length ; i++) {
          {
            args.push(arguments[i]);
          }
        }
        name = arguments[0];
        
        
        th=Tonyu.globals.$Boot.schedule(_this,name,args);
        return th;
      },
      para_no_op :function _trc_ParallelMod_para_no_op() {
        var _this=this;
        
      },
      fiber$para_no_op :function* _trc_ParallelMod_f_para_no_op(_thread) {
        var _this=this;
        
        
      },
      call :function _trc_ParallelMod_call() {
        var _this=this;
        var a;
        var t;
        var n;
        var f;
        var th;
        var ag2;
        var e;
        
        if (! null) {
          throw new Error("callは待機可能モードで呼び出してください");
          
        }
        a = new Tonyu.classes.kernel.ArgParser(arguments);
        
        t = a.shift();
        
        n = a.shift();
        
        if (n&&n.methodInfo) {
          n=n.methodInfo.name;
          
        }
        f = t["fiber$"+n];
        
        if (! f) {
          throw new Error("メソッド"+n+"が見つかりません");
          
          
        }
        th = Tonyu.thread();
        
        ag2 = a.toArray();
        
        th.apply(t,n,ag2);
        th.setThreadGroup(null);
        try {
          th.stepsLoop();
          return th.promise();
          
        } catch (e) {
          if (e.isKilled) {
            null.kill();
          } else {
            throw e;
            
          }
          
        }
      },
      fiber$call :function* _trc_ParallelMod_f_call(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var a;
        var t;
        var n;
        var f;
        var th;
        var ag2;
        var e;
        
        if (! _thread) {
          throw new Error("callは待機可能モードで呼び出してください");
          
        }
        a = new Tonyu.classes.kernel.ArgParser(_arguments);
        
        t = a.shift();
        
        n = a.shift();
        
        if (n&&n.methodInfo) {
          n=n.methodInfo.name;
          
        }
        f = t["fiber$"+n];
        
        if (! f) {
          throw new Error("メソッド"+n+"が見つかりません");
          
          
        }
        th = Tonyu.thread();
        
        ag2 = a.toArray();
        
        th.apply(t,n,ag2);
        th.setThreadGroup(_thread);
        try {
          th.stepsLoop();
          return (yield* _thread.await(th.promise()));
          
        } catch (e) {
          if (e.isKilled) {
            _thread.kill();
          } else {
            throw e;
            
          }
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"parallel":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"para_no_op":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"call":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.SchedulerMod',
  shortName: 'SchedulerMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_SchedulerMod_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_SchedulerMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      __getter__resolvedScheduler :function _trc_SchedulerMod___getter__resolvedScheduler() {
        var _this=this;
        
        if (! _this._scheduler) {
          return _this._scheduler;
        }
        while (_this._scheduler.newScheduler) {
          _this._scheduler=_this._scheduler.newScheduler;
          
        }
        return _this._scheduler;
      },
      initSchedulerMod :function _trc_SchedulerMod_initSchedulerMod() {
        var _this=this;
        
        _this._scheduler=_this._scheduler||Tonyu.globals.$Scheduler;
        _this._th=Tonyu.globals.$Boot.schedule(_this,"main",[]);
      },
      fiber$initSchedulerMod :function* _trc_SchedulerMod_f_initSchedulerMod(_thread) {
        var _this=this;
        
        _this._scheduler=_this._scheduler||Tonyu.globals.$Scheduler;
        _this._th=Tonyu.globals.$Boot.schedule(_this,"main",[]);
        
      },
      update :function _trc_SchedulerMod_update() {
        var _this=this;
        
        if (! _this._updating) {
          _this._updating=true;
          _this.onUpdate();
          _this._updating=false;
          
        }
        let sched = _this.resolvedScheduler;
        
        if (null) {
          if (sched) {
            sched.addToNext(null);
          }
          null.suspend();
          null;
          
        } else {
          if (sched) {
            sched.checkTimeout();
          }
          
        }
      },
      fiber$update :function* _trc_SchedulerMod_f_update(_thread) {
        var _this=this;
        
        if (! _this._updating) {
          _this._updating=true;
          (yield* _this.fiber$onUpdate(_thread));
          _this._updating=false;
          
        }
        let sched = _this.resolvedScheduler;
        
        if (_thread) {
          if (sched) {
            sched.addToNext(_thread);
          }
          _thread.suspend();
          (yield* _thread.await(null));
          
        } else {
          if (sched) {
            sched.checkTimeout();
          }
          
        }
        
      },
      onUpdate :function _trc_SchedulerMod_onUpdate() {
        var _this=this;
        
      },
      fiber$onUpdate :function* _trc_SchedulerMod_f_onUpdate(_thread) {
        var _this=this;
        
        
      },
      updateEx :function _trc_SchedulerMod_updateEx(updateT) {
        var _this=this;
        
        if (! null) {
          return _this.update();
          
        }
        if (updateT<0) {
          updateT=0;
        }
        for (null._updateExc=(null._updateExc||0)+updateT; null._updateExc>=1 ; null._updateExc--) {
          {
            _this.update();
          }
        }
      },
      fiber$updateEx :function* _trc_SchedulerMod_f_updateEx(_thread,updateT) {
        var _this=this;
        
        if (! _thread) {
          return yield* _this.fiber$update(_thread);
          
          
        }
        if (updateT<0) {
          updateT=0;
        }
        for (_thread._updateExc=(_thread._updateExc||0)+updateT; _thread._updateExc>=1 ; _thread._updateExc--) {
          {
            (yield* _this.fiber$update(_thread));
          }
        }
        
      },
      wait :function _trc_SchedulerMod_wait(t) {
        var _this=this;
        
        if (null) {
          let sched = _this.resolvedScheduler;
          
          null.suspend();
          if (t) {
            null.waitCount=t;
            if (sched) {
              sched.addToNext(null);
            }
            
          }
          null;
          
        } else {
          if (_this._th) {
            if (t) {
              _this._th.waitCount=t;
              
            } else {
              if (_this._th.scheduled) {
                _this._th.scheduled.unschedule(_this._th);
              }
              
            }
            
          }
        }
      },
      fiber$wait :function* _trc_SchedulerMod_f_wait(_thread,t) {
        var _this=this;
        
        if (_thread) {
          let sched = _this.resolvedScheduler;
          
          _thread.suspend();
          if (t) {
            _thread.waitCount=t;
            if (sched) {
              sched.addToNext(_thread);
            }
            
          }
          (yield* _thread.await(null));
          
        } else {
          if (_this._th) {
            if (t) {
              _this._th.waitCount=t;
              
            } else {
              if (_this._th.scheduled) {
                _this._th.scheduled.unschedule(_this._th);
              }
              
            }
            
          }
        }
        
      },
      notify :function _trc_SchedulerMod_notify() {
        var _this=this;
        
        if (_this._th) {
          if (_this._th.scheduled) {
            _this._th.waitCount=0;
            
          } else {
            let sched = _this.resolvedScheduler;
            
            if (sched) {
              sched.addToCur(_this._th);
            }
            
          }
          
        }
      },
      timeStop :function _trc_SchedulerMod_timeStop() {
        var _this=this;
        
        return Tonyu.globals.$Boot.timeStop(_this);
      },
      fiber$timeStop :function* _trc_SchedulerMod_f_timeStop(_thread) {
        var _this=this;
        
        return Tonyu.globals.$Boot.timeStop(_this);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"__getter__resolvedScheduler":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initSchedulerMod":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"update":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"onUpdate":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"updateEx":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"wait":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"notify":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"timeStop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"_scheduler":{},"_th":{},"_updating":{},"_updateExc":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ThreadGroupMod',
  shortName: 'ThreadGroupMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ThreadGroupMod_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_ThreadGroupMod_f_main(_thread) {
        var _this=this;
        
        
      },
      isDeadThreadGroup :function _trc_ThreadGroupMod_isDeadThreadGroup() {
        var _this=this;
        
        return _this._isDeadThreadGroup=_this._isDeadThreadGroup||(_this._threadGroup&&(_this._threadGroup.objectPoolAge!=_this.tGrpObjectPoolAge||_this._threadGroup.isDeadThreadGroup()));
      },
      fiber$isDeadThreadGroup :function* _trc_ThreadGroupMod_f_isDeadThreadGroup(_thread) {
        var _this=this;
        
        return _this._isDeadThreadGroup=_this._isDeadThreadGroup||(_this._threadGroup&&(_this._threadGroup.objectPoolAge!=_this.tGrpObjectPoolAge||_this._threadGroup.isDeadThreadGroup()));
        
      },
      setThreadGroup :function _trc_ThreadGroupMod_setThreadGroup(g) {
        var _this=this;
        
        _this._threadGroup=g;
        _this.tGrpObjectPoolAge=g.objectPoolAge;
      },
      fiber$setThreadGroup :function* _trc_ThreadGroupMod_f_setThreadGroup(_thread,g) {
        var _this=this;
        
        _this._threadGroup=g;
        _this.tGrpObjectPoolAge=g.objectPoolAge;
        
      },
      killThreadGroup :function _trc_ThreadGroupMod_killThreadGroup() {
        var _this=this;
        
        _this._isDeadThreadGroup=true;
      },
      fiber$killThreadGroup :function* _trc_ThreadGroupMod_f_killThreadGroup(_thread) {
        var _this=this;
        
        _this._isDeadThreadGroup=true;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"isDeadThreadGroup":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setThreadGroup":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"killThreadGroup":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"_isDeadThreadGroup":{},"_threadGroup":{},"tGrpObjectPoolAge":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.DraggableMod',
  shortName: 'DraggableMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.SpriteMod,Tonyu.classes.kernel.EventMod],
  methods: function (__superClass) {
    return {
      main :function _trc_DraggableMod_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_DraggableMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      enableDrag :function _trc_DraggableMod_enableDrag(options) {
        var _this=this;
        
        options=options||{};
        options=Object.assign({},options);
        _this.on("touch",(function anonymous_186(e) {
          
          let f = e.finger;
          
          let startCancelled;
          e.end=(function anonymous_262() {
            
            startCancelled=true;
          });
          if (typeof  options.start==="function") {
            options.start(e);
            
          }
          if (startCancelled) {
            return _this;
          }
          let cloned = _this.parseCloneDescriptor(options.clone,f);
          
          options.sourceActor=_this;
          cloned.startDrag(e,options);
        }));
        return options;
      },
      fiber$enableDrag :function* _trc_DraggableMod_f_enableDrag(_thread,options) {
        var _this=this;
        
        options=options||{};
        options=Object.assign({},options);
        _this.on("touch",(function anonymous_186(e) {
          
          let f = e.finger;
          
          let startCancelled;
          e.end=(function anonymous_262() {
            
            startCancelled=true;
          });
          if (typeof  options.start==="function") {
            options.start(e);
            
          }
          if (startCancelled) {
            return _this;
          }
          let cloned = _this.parseCloneDescriptor(options.clone,f);
          
          options.sourceActor=_this;
          cloned.startDrag(e,options);
        }));
        return options;
        
      },
      parseCloneDescriptor :function _trc_DraggableMod_parseCloneDescriptor(desc,finger) {
        var _this=this;
        
        if (typeof  desc==="function") {
          return desc({actor: _this,finger: finger});
          
        }
        if (! desc||typeof  desc!=="object") {
          return _this;
        }
        let clo = Object.assign({},desc);
        
        let cl = clo.class||Tonyu.classes.kernel.Actor;
        
        if (clo.layer) {
          let tolp = clo.layer.defaultLayerPath;
          
          let lp = finger.layerPath.convert({x: _this.x,y: _this.y},tolp);
          
          clo.x=lp.x;
          clo.y=lp.y;
          finger.layerPath=tolp;
          
        }
        delete clo.class;
        for (let [k] of Tonyu.iterator2(["x","y","p","layer","fillStyle","alpha","rotation","scaleX","scaleY","radius","width","height"],1)) {
          clo[k]=clo[k]||_this[k];
          
        }
        let cloned = new cl(clo);
        
        return cloned;
      },
      fiber$parseCloneDescriptor :function* _trc_DraggableMod_f_parseCloneDescriptor(_thread,desc,finger) {
        var _this=this;
        
        if (typeof  desc==="function") {
          return desc({actor: _this,finger: finger});
          
        }
        if (! desc||typeof  desc!=="object") {
          return _this;
        }
        let clo = Object.assign({},desc);
        
        let cl = clo.class||Tonyu.classes.kernel.Actor;
        
        if (clo.layer) {
          let tolp = clo.layer.defaultLayerPath;
          
          let lp = finger.layerPath.convert({x: _this.x,y: _this.y},tolp);
          
          clo.x=lp.x;
          clo.y=lp.y;
          finger.layerPath=tolp;
          
        }
        delete clo.class;
        for (let [k] of Tonyu.iterator2(["x","y","p","layer","fillStyle","alpha","rotation","scaleX","scaleY","radius","width","height"],1)) {
          clo[k]=clo[k]||_this[k];
          
        }
        let cloned = new cl(clo);
        
        return cloned;
        
      },
      startDrag :function _trc_DraggableMod_startDrag(e,options) {
        var _this=this;
        function forceEnd() {
          
          evm.remove();
          eve.remove();
          e.forceEnded=true;
          handleEnd(e);
        }function handleEnd(e) {
          
          let dropped = _this.parseCloneDescriptor(options.end,f);
          
          if (options.sourceActor!=_this&&Tonyu.is(dropped,Tonyu.classes.kernel.Actor)&&dropped!=_this) {
            _this.die();
            
          }
        }
        options=options||{};
        let a = _this;
        
        let f = e.finger;
        
        let sx = f.x-_this.x;
        let sy = f.y-_this.y;
        
        let relative = options.relative;
        
        
        
        let evm;let eve;
        evm=f.on("move",(function anonymous_2734(eo) {
          
          let e = {cancel: (function anonymous_2849() {
            
            e.cancelled=true;
          }),end: forceEnd};
          
          e.px=_this.x;
          e.py=_this.y;
          if (relative) {
            e.vx=eo.vx;
            e.vy=eo.vy;
            e.x=e.px+e.vx;
            e.y=e.py+e.vy;
            
          } else {
            e.x=f.x-sx;
            e.y=f.y-sy;
            e.vx=e.x-e.px;
            e.vy=e.y-e.py;
            
          }
          e.actor=_this;
          _this.x=e.x;
          _this.y=e.y;
          if (typeof  options.valid==="function") {
            if (! options.valid()) {
              _this.y=e.y;
              _this.x=e.px;
              if (! options.valid()) {
                _this.y=e.py;
                _this.x=e.x;
                if (! options.valid()) {
                  _this.y=e.py;
                  _this.x=e.px;
                  
                }
                
              }
              
            }
            
          }
          if (typeof  options.move==="function") {
            options.move(e);
            if (e.cancelled) {
              a.x=e.px;
              a.y=e.py;
              
            }
            
          }
        }));
        eve=f.on("end",handleEnd);
      },
      fiber$startDrag :function* _trc_DraggableMod_f_startDrag(_thread,e,options) {
        var _this=this;
        function forceEnd() {
          
          evm.remove();
          eve.remove();
          e.forceEnded=true;
          handleEnd(e);
        }function handleEnd(e) {
          
          let dropped = _this.parseCloneDescriptor(options.end,f);
          
          if (options.sourceActor!=_this&&Tonyu.is(dropped,Tonyu.classes.kernel.Actor)&&dropped!=_this) {
            _this.die();
            
          }
        }
        options=options||{};
        let a = _this;
        
        let f = e.finger;
        
        let sx = f.x-_this.x;
        let sy = f.y-_this.y;
        
        let relative = options.relative;
        
        
        
        let evm;let eve;
        evm=f.on("move",(function anonymous_2734(eo) {
          
          let e = {cancel: (function anonymous_2849() {
            
            e.cancelled=true;
          }),end: forceEnd};
          
          e.px=_this.x;
          e.py=_this.y;
          if (relative) {
            e.vx=eo.vx;
            e.vy=eo.vy;
            e.x=e.px+e.vx;
            e.y=e.py+e.vy;
            
          } else {
            e.x=f.x-sx;
            e.y=f.y-sy;
            e.vx=e.x-e.px;
            e.vy=e.y-e.py;
            
          }
          e.actor=_this;
          _this.x=e.x;
          _this.y=e.y;
          if (typeof  options.valid==="function") {
            if (! options.valid()) {
              _this.y=e.y;
              _this.x=e.px;
              if (! options.valid()) {
                _this.y=e.py;
                _this.x=e.x;
                if (! options.valid()) {
                  _this.y=e.py;
                  _this.x=e.px;
                  
                }
                
              }
              
            }
            
          }
          if (typeof  options.move==="function") {
            options.move(e);
            if (e.cancelled) {
              a.x=e.px;
              a.y=e.py;
              
            }
            
          }
        }));
        eve=f.on("end",handleEnd);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"enableDrag":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"parseCloneDescriptor":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"startDrag":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"x":{},"y":{},"layer":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.API',
  shortName: 'API',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_API_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_API_f_main(_thread) {
        var _this=this;
        
        
      },
      info :function _trc_API_info() {
        var _this=this;
        var ide;
        
        ide = Tonyu.globals.$Boot.getIDE();
        
        if (ide) {
          return Promise.resolve(ide.getAPIInfo());
          
        } else {
          return Promise.resolve($.get("https://run.tonyu.jp/apiInfo.php",{url: location.href}));
          
        }
      },
      fiber$info :function* _trc_API_f_info(_thread) {
        var _this=this;
        var ide;
        
        ide = Tonyu.globals.$Boot.getIDE();
        
        if (ide) {
          return Promise.resolve(ide.getAPIInfo());
          
        } else {
          return Promise.resolve($.get("https://run.tonyu.jp/apiInfo.php",{url: location.href}));
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"info":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.ArgParser',
  shortName: 'ArgParser',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ArgParser_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_ArgParser_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_ArgParser_initialize(asrc) {
        var _this=this;
        var i;
        
        if (! asrc) {
          throw new Error("Use as: new ArgParser(arguments)");
          
        }
        _this.length=0;
        _this.a=_this;
        for (i = 0;
         i<asrc.length ; i++) {
          _this.push(asrc[i]);
        }
      },
      push :function _trc_ArgParser_push(v) {
        var _this=this;
        
        _this.a[_this.length++]=v;
      },
      fiber$push :function* _trc_ArgParser_f_push(_thread,v) {
        var _this=this;
        
        _this.a[_this.length++]=v;
        
      },
      trimUndefs :function _trc_ArgParser_trimUndefs() {
        var _this=this;
        
        while (_this.length>0) {
          if (_this.a[_this.length-1]!==_this._undef) {
            break;
            
          }
          _this.length--;
          delete _this.a[_this.length];
          
        }
      },
      fiber$trimUndefs :function* _trc_ArgParser_f_trimUndefs(_thread) {
        var _this=this;
        
        while (_this.length>0) {
          if (_this.a[_this.length-1]!==_this._undef) {
            break;
            
          }
          _this.length--;
          delete _this.a[_this.length];
          
        }
        
      },
      peek :function _trc_ArgParser_peek(i) {
        var _this=this;
        
        return _this.a[i||0];
      },
      fiber$peek :function* _trc_ArgParser_f_peek(_thread,i) {
        var _this=this;
        
        return _this.a[i||0];
        
      },
      shift :function _trc_ArgParser_shift(type) {
        var _this=this;
        var res;
        var i;
        
        if (typeof  type=="number") {
          res = [];
          
          for (i = 0;
           i<type ; i++) {
            res.push(_this.shift());
          }
          return res;
          
        } else {
          if (typeof  type=="string") {
            if (_this.a[0]==null) {
              return _this._undef;
            }
            if (typeof  _this.a[0]===type) {
              return _this.shift();
            }
            return _this._undef;
            
          } else {
            if (type) {
              if (Tonyu.is(_this.a[0],type)) {
                return _this.shift();
              }
              return _this._undef;
              
            }
          }
        }
        res = _this.a[0];
        
        for (i = 1;
         i<_this.length ; i++) {
          {
            _this.a[i-1]=_this.a[i];
          }
        }
        _this.length--;
        delete _this.a[_this.length];
        return res;
      },
      fiber$shift :function* _trc_ArgParser_f_shift(_thread,type) {
        var _this=this;
        var res;
        var i;
        
        if (typeof  type=="number") {
          res = [];
          
          for (i = 0;
           i<type ; i++) {
            res.push(_this.shift());
          }
          return res;
          
        } else {
          if (typeof  type=="string") {
            if (_this.a[0]==null) {
              return _this._undef;
            }
            if (typeof  _this.a[0]===type) {
              return yield* _this.fiber$shift(_thread);
              
            }
            return _this._undef;
            
          } else {
            if (type) {
              if (Tonyu.is(_this.a[0],type)) {
                return yield* _this.fiber$shift(_thread);
                
              }
              return _this._undef;
              
            }
          }
        }
        res = _this.a[0];
        
        for (i = 1;
         i<_this.length ; i++) {
          {
            _this.a[i-1]=_this.a[i];
          }
        }
        _this.length--;
        delete _this.a[_this.length];
        return res;
        
      },
      isPlainObject :function _trc_ArgParser_isPlainObject(o) {
        var _this=this;
        
        return o&&o["constructor"]===Object;
      },
      fiber$isPlainObject :function* _trc_ArgParser_f_isPlainObject(_thread,o) {
        var _this=this;
        
        return o&&o["constructor"]===Object;
        
      },
      shiftOptions :function _trc_ArgParser_shiftOptions(...names) {
        var _this=this;
        
        let res = {};
        
        for (let [name] of Tonyu.iterator2(names,1)) {
          if (_this.length==1&&_this.isPlainObject(_this.peek())) {
            Object.assign(res,_this.shift());
            break;
            
            
          } else {
            res[name]=_this.shift();
            
          }
          
        }
        return res;
      },
      fiber$shiftOptions :function* _trc_ArgParser_f_shiftOptions(_thread,...names) {
        var _this=this;
        
        let res = {};
        
        for (let [name] of Tonyu.iterator2(names,1)) {
          if (_this.length==1&&_this.isPlainObject(_this.peek())) {
            Object.assign(res,_this.shift());
            break;
            
            
          } else {
            res[name]=(yield* _this.fiber$shift(_thread));
            
          }
          
        }
        return res;
        
      },
      toArray :function _trc_ArgParser_toArray() {
        var _this=this;
        var res;
        var i;
        
        res = [];
        
        for (i = 0;
         i<_this.a.length ; i++) {
          res.push(_this.a[i]);
        }
        return res;
      },
      fiber$toArray :function* _trc_ArgParser_f_toArray(_thread) {
        var _this=this;
        var res;
        var i;
        
        res = [];
        
        for (i = 0;
         i<_this.a.length ; i++) {
          res.push(_this.a[i]);
        }
        return res;
        
      },
      parseOptions :function _trc_ArgParser_parseOptions(spec) {
        var _this=this;
        var speca;
        var res;
        var name;
        var opt;
        var notOption;
        var k;
        var v;
        
        speca = spec.split(",");
        
        res = {};
        
        if (_this.length>speca.length) {
          throw new Error("# of arguments("+_this.length+") is more than spec("+speca.length+").");
          
          
        }
        while (_this.length>1) {
          name = speca.shift();
          
          res[name]=_this.shift();
          
        }
        opt = _this.shift();
        
        if (typeof  opt!=="object") {
          notOption=true;
          
        } else {
          for ([k, v] of Tonyu.iterator2(opt,2)) {
            if (speca.indexOf(k)<0) {
              notOption=true;
              break;
              
              
            }
            
          }
          
        }
        if (notOption) {
          res[speca.shift()]=opt;
          
        } else {
          for ([k, v] of Tonyu.iterator2(opt,2)) {
            res[k]=v;
            
          }
          
        }
        return res;
      },
      fiber$parseOptions :function* _trc_ArgParser_f_parseOptions(_thread,spec) {
        var _this=this;
        var speca;
        var res;
        var name;
        var opt;
        var notOption;
        var k;
        var v;
        
        speca = spec.split(",");
        
        res = {};
        
        if (_this.length>speca.length) {
          throw new Error("# of arguments("+_this.length+") is more than spec("+speca.length+").");
          
          
        }
        while (_this.length>1) {
          name = speca.shift();
          
          res[name]=(yield* _this.fiber$shift(_thread));
          
        }
        opt=yield* _this.fiber$shift(_thread);
        
        if (typeof  opt!=="object") {
          notOption=true;
          
        } else {
          for ([k, v] of Tonyu.iterator2(opt,2)) {
            if (speca.indexOf(k)<0) {
              notOption=true;
              break;
              
              
            }
            
          }
          
        }
        if (notOption) {
          res[speca.shift()]=opt;
          
        } else {
          for ([k, v] of Tonyu.iterator2(opt,2)) {
            res[k]=v;
            
          }
          
        }
        return res;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"push":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"trimUndefs":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"peek":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"shift":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"isPlainObject":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"shiftOptions":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"toArray":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"parseOptions":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"length":{},"a":{},"_undef":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.AssertionMod',
  shortName: 'AssertionMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_AssertionMod_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_AssertionMod_f_main(_thread) {
        var _this=this;
        
        
      },
      assertIs :function _trc_AssertionMod_assertIs(obj,klass,label) {
        var _this=this;
        
        if (Tonyu.is(obj,klass)) {
          return obj;
        }
        if (label) {
          label=['(',label,')'].join('');
        } else {
          label="";
        }
        throw _this.newError("notA",obj,label,klass);
        
      },
      fiber$assertIs :function* _trc_AssertionMod_f_assertIs(_thread,obj,klass,label) {
        var _this=this;
        
        if (Tonyu.is(obj,klass)) {
          return obj;
        }
        if (label) {
          label=['(',label,')'].join('');
        } else {
          label="";
        }
        throw _this.newError("notA",obj,label,klass);
        
        
      },
      assertEq :function _trc_AssertionMod_assertEq(a,b,al,bl) {
        var _this=this;
        
        if (a===b) {
          return a;
        }
        throw _this.newErrr("notEq",al||a,bl||b);
        
      },
      fiber$assertEq :function* _trc_AssertionMod_f_assertEq(_thread,a,b,al,bl) {
        var _this=this;
        
        if (a===b) {
          return a;
        }
        throw _this.newErrr("notEq",al||a,bl||b);
        
        
      },
      newError :function _trc_AssertionMod_newError(mesg,...args) {
        var _this=this;
        
        console.error(mesg,_this,...args);
        return new Error(_this+": "+Tonyu.globals.$Boot.R(mesg,...args));
      },
      fiber$newError :function* _trc_AssertionMod_f_newError(_thread,mesg,...args) {
        var _this=this;
        
        console.error(mesg,_this,...args);
        return new Error(_this+": "+Tonyu.globals.$Boot.R(mesg,...args));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"assertIs":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"assertEq":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"newError":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"newErrr":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.FileMod',
  shortName: 'FileMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_FileMod_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_FileMod_f_main(_thread) {
        var _this=this;
        
        
      },
      file :function _trc_FileMod_file(path) {
        var _this=this;
        var d;
        var files;
        
        d = Tonyu.globals.$currentProject.getDir();
        
        if (path.isSFile&&path.isSFile()) {
          return path;
        }
        files = d.rel("files/");
        
        return files.rel(path).setPolicy({topDir: d});
      },
      fiber$file :function* _trc_FileMod_f_file(_thread,path) {
        var _this=this;
        var d;
        var files;
        
        d = Tonyu.globals.$currentProject.getDir();
        
        if (path.isSFile&&path.isSFile()) {
          return path;
        }
        files = d.rel("files/");
        
        return files.rel(path).setPolicy({topDir: d});
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"file":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.GeneratorMod',
  shortName: 'GeneratorMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_GeneratorMod_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_GeneratorMod_f_main(_thread) {
        var _this=this;
        
        
      },
      generator :function _trc_GeneratorMod_generator() {
        var _this=this;
        var a;
        var methodName;
        var th;
        var res;
        
        a = new Tonyu.classes.kernel.ArgParser(arguments);
        
        methodName = a.shift();
        
        th = Tonyu.thread();
        
        a = a.toArray();
        
        a.unshift(_this.yielder);
        res = {tonyuIterator: (function anonymous_214() {
          
        })};
        
        th.apply(_this,methodName,a);
      },
      fiber$generator :function* _trc_GeneratorMod_f_generator(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var a;
        var methodName;
        var th;
        var res;
        
        a = new Tonyu.classes.kernel.ArgParser(_arguments);
        
        methodName = a.shift();
        
        th = Tonyu.thread();
        
        a = a.toArray();
        
        a.unshift(_this.yielder);
        res = {tonyuIterator: (function anonymous_214() {
          
        })};
        
        th.apply(_this,methodName,a);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"generator":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"yielder":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MathMod',
  shortName: 'MathMod',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_MathMod_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_MathMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      sin :function _trc_MathMod_sin(d) {
        var _this=this;
        
        if (d%90==0) {
          d=_this.amod(d,360);
          return [0,1,0,- 1][_this.floor(d/90)];
          
        }
        return Math.sin(_this.rad(d));
      },
      cos :function _trc_MathMod_cos(d) {
        var _this=this;
        
        if (d%90==0) {
          d=_this.amod(d,360);
          return [1,0,- 1,0][_this.floor(d/90)];
          
        }
        return Math.cos(_this.rad(d));
      },
      rad :function _trc_MathMod_rad(d) {
        var _this=this;
        
        return d/180*Math.PI;
      },
      deg :function _trc_MathMod_deg(d) {
        var _this=this;
        
        return d/Math.PI*180;
      },
      abs :function _trc_MathMod_abs(v) {
        var _this=this;
        
        return Math.abs(v);
      },
      sgn :function _trc_MathMod_sgn(v,base) {
        var _this=this;
        
        base=base||0;
        return (v>base?1:v<- base?- 1:0);
      },
      atan2 :function _trc_MathMod_atan2(y,x) {
        var _this=this;
        
        return _this.deg(Math.atan2(y,x));
      },
      atanxy :function _trc_MathMod_atanxy(x,y) {
        var _this=this;
        
        return _this.atan2(y,x);
      },
      floor :function _trc_MathMod_floor(x) {
        var _this=this;
        
        return Math.floor(x);
      },
      angleDiff :function _trc_MathMod_angleDiff(a,b) {
        var _this=this;
        var c;
        
        
        a=_this.floor(a);
        b=_this.floor(b);
        if (a>=b) {
          c=(a-b)%360;
          if (c>=180) {
            c-=360;
          }
          
        } else {
          c=- ((b-a)%360);
          if (c<- 180) {
            c+=360;
          }
          
        }
        return c;
      },
      sqrt :function _trc_MathMod_sqrt(t) {
        var _this=this;
        
        return Math.sqrt(t);
      },
      dist :function _trc_MathMod_dist(dx,dy,dz) {
        var _this=this;
        
        dz=dz||0;
        return _this.sqrt(dx*dx+dy*dy+dz*dz);
      },
      trunc :function _trc_MathMod_trunc(f) {
        var _this=this;
        
        if (f>=0) {
          return Math.floor(f);
        } else {
          return Math.ceil(f);
        }
      },
      ceil :function _trc_MathMod_ceil(f) {
        var _this=this;
        
        return Math.ceil(f);
      },
      rndFloat :function _trc_MathMod_rndFloat(r,m) {
        var _this=this;
        
        if (typeof  r!=="number") {
          r=0;
        }
        if (typeof  m!=="number") {
          m=1;
        }
        if (r<m) {
          return _this.rnd()*(m-r)+r;
          
        } else {
          return _this.rnd()*(r-m)+m;
          
        }
      },
      rnd :function _trc_MathMod_rnd(r,m) {
        var _this=this;
        var res;
        
        
        if (Tonyu.is(Tonyu.globals.$random,Tonyu.classes.kernel.Random)) {
          res=Tonyu.globals.$random.next01();
        } else {
          res=Math.random();
        }
        if (typeof  r=="number") {
          if (typeof  m=="number") {
            if (r<m) {
              return Math.floor(res*(m-r)+r);
              
            } else {
              return Math.floor(res*(r-m)+m);
              
            }
            
          } else {
            return Math.floor(res*(r>0?r:0));
            
          }
          
        }
        return res;
      },
      randomize :function _trc_MathMod_randomize(s) {
        var _this=this;
        
        Tonyu.globals.$random=new Tonyu.classes.kernel.Random(s);
      },
      parseFloat :function _trc_MathMod_parseFloat(s) {
        var _this=this;
        
        return parseFloat(s);
      },
      clamp :function _trc_MathMod_clamp(v,min,max) {
        var _this=this;
        
        if (min>max) {
          return _this.clamp(v,max,min);
        }
        return v<min?min:v>max?max:v;
      },
      clamped :function _trc_MathMod_clamped(v,min,max) {
        var _this=this;
        
        return _this.clamp(v,min,max)-v;
      },
      min :function _trc_MathMod_min() {
        var _this=this;
        
        return Math.min.apply(Math,arguments);
      },
      max :function _trc_MathMod_max() {
        var _this=this;
        
        return Math.max.apply(Math,arguments);
      },
      amod :function _trc_MathMod_amod(v,d) {
        var _this=this;
        
        return (v%d+d)%d;
      },
      log :function _trc_MathMod_log(n) {
        var _this=this;
        
        return Math.log(n);
      },
      fiber$log :function* _trc_MathMod_f_log(_thread,n) {
        var _this=this;
        
        return Math.log(n);
        
      },
      round :function _trc_MathMod_round(x,q,r) {
        var _this=this;
        
        q=q||1;
        r=r||0;
        let k = Math.round((x-r)/q);
        
        return k*q+r;
      },
      fiber$round :function* _trc_MathMod_f_round(_thread,x,q,r) {
        var _this=this;
        
        q=q||1;
        r=r||0;
        let k = Math.round((x-r)/q);
        
        return k*q+r;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"sin":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"cos":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"rad":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"deg":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"abs":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"sgn":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"atan2":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"atanxy":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"floor":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"angleDiff":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"sqrt":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"dist":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"trunc":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"ceil":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"rndFloat":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"rnd":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"randomize":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"parseFloat":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"clamp":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"clamped":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"min":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"max":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"amod":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"log":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"round":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.MessageResource',
  shortName: 'MessageResource',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_MessageResource_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_MessageResource_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_MessageResource_initialize() {
        var _this=this;
        
        _this.R=Tonyu.messages;
        let ja = {"notA": "{1}{2}は{3}ではありません．","netEQ": "{1}!=={2}","noPushedPages": "loadPageで戻る先のページがありません．引数にページ名を忘れているかもしれません．"};
        
        let en = {"notA": "{1}{2} is not a {3}.","netEQ": "{1}!=={2}","noPushedPages": "loadPage(Pop page) failed. You should push page (or you forgot Page argument?)",screenConvertFailed: "Screen::conv invalid from {2} to {3}",cannotGetNeighborTarget: "Cannot get neighbor target {1} {2}",worldToChipInvalidArgs: "Map2::worldToChip: invalid args ({1},{2})",touchFingerSetLayerFailed: "Cannot set layer: toLayer={1}",touchFingerSetLayerPathFailed: "layerPath convert failed: to= {1}",invalidLayer: "Invalid layer: {1}",alreadyAdded: "Layer {1} is already added"};
        
        for (let [k, v] of Tonyu.iterator2(en,2)) {
          if (! ja[k]) {
            ja[k]=v;
          }
        }
        Object.assign(_this.R.dicts.ja,ja);
        Object.assign(_this.R.dicts.en,en);
      },
      r :function _trc_MessageResource_r(name,...args) {
        var _this=this;
        
        return _this.R(name,...args);
      },
      fiber$r :function* _trc_MessageResource_f_r(_thread,name,...args) {
        var _this=this;
        
        return _this.R(name,...args);
        
      },
      register :function _trc_MessageResource_register(name,mesgs) {
        var _this=this;
        
        if (mesgs.ja) {
          _this.R.dicts.ja[name]=mesgs.ja;
        }
        if (mesgs.en) {
          _this.R.dicts.en[name]=mesgs.en;
        }
      },
      fiber$register :function* _trc_MessageResource_f_register(_thread,name,mesgs) {
        var _this=this;
        
        if (mesgs.ja) {
          _this.R.dicts.ja[name]=mesgs.ja;
        }
        if (mesgs.en) {
          _this.R.dicts.en[name]=mesgs.en;
        }
        
      },
      functionShortcut :function _trc_MessageResource_functionShortcut() {
        var _this=this;
        
        let R = (function anonymous_1205(...args) {
          
          return _this.r(...args);
        });
        
        R.register=(function anonymous_1254(...args) {
          
          return _this.register(...args);
        });
        R.self=_this;
        return R;
      },
      fiber$functionShortcut :function* _trc_MessageResource_f_functionShortcut(_thread) {
        var _this=this;
        
        let R = (function anonymous_1205(...args) {
          
          return _this.r(...args);
        });
        
        R.register=(function anonymous_1254(...args) {
          
          return _this.register(...args);
        });
        R.self=_this;
        return R;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"r":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"register":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"functionShortcut":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"R":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Navigator',
  shortName: 'Navigator',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Navigator_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_Navigator_f_main(_thread) {
        var _this=this;
        
        
      },
      getUserAgent :function _trc_Navigator_getUserAgent() {
        var _this=this;
        
        return navigator.userAgent;
      },
      fiber$getUserAgent :function* _trc_Navigator_f_getUserAgent(_thread) {
        var _this=this;
        
        return navigator.userAgent;
        
      },
      isNW :function _trc_Navigator_isNW() {
        var _this=this;
        
        return typeof  process!=="undefined";
      },
      fiber$isNW :function* _trc_Navigator_f_isNW(_thread) {
        var _this=this;
        
        return typeof  process!=="undefined";
        
      },
      isTablet :function _trc_Navigator_isTablet() {
        var _this=this;
        var u;
        var isIPad;
        
        u = _this.getUserAgent().toLowerCase();
        
        isIPad = u.indexOf("ipad")!=- 1||(u.indexOf("macintosh")!=- 1&&document.ontouchend);
        
        return ((u.indexOf("windows")!=- 1&&u.indexOf("touch")!=- 1&&u.indexOf("tablet pc")==- 1)||isIPad!=- 1||(u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1&&u.indexOf("mobile")==- 1)||(u.indexOf("firefox")!=- 1&&u.indexOf("tablet")!=- 1)||u.indexOf("kindle")!=- 1||u.indexOf("silk")!=- 1||u.indexOf("playbook")!=- 1||u.indexOf('a1_07')!=- 1||u.indexOf('sc-01c')!=- 1);
      },
      fiber$isTablet :function* _trc_Navigator_f_isTablet(_thread) {
        var _this=this;
        var u;
        var isIPad;
        
        u = _this.getUserAgent().toLowerCase();
        
        isIPad = u.indexOf("ipad")!=- 1||(u.indexOf("macintosh")!=- 1&&document.ontouchend);
        
        return ((u.indexOf("windows")!=- 1&&u.indexOf("touch")!=- 1&&u.indexOf("tablet pc")==- 1)||isIPad!=- 1||(u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1&&u.indexOf("mobile")==- 1)||(u.indexOf("firefox")!=- 1&&u.indexOf("tablet")!=- 1)||u.indexOf("kindle")!=- 1||u.indexOf("silk")!=- 1||u.indexOf("playbook")!=- 1||u.indexOf('a1_07')!=- 1||u.indexOf('sc-01c')!=- 1);
        
      },
      isMobile :function _trc_Navigator_isMobile() {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return ((u.indexOf("windows")!=- 1&&u.indexOf("phone")!=- 1)||u.indexOf("iphone")!=- 1||u.indexOf("ipod")!=- 1||(u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1&&u.indexOf("mobile")!=- 1)||(u.indexOf("firefox")!=- 1&&u.indexOf("mobile")!=- 1)||(u.indexOf("blackberry")!=- 1||(u.indexOf("bb10")!=- 1&&u.indexOf("mobile")!=- 1)));
      },
      fiber$isMobile :function* _trc_Navigator_f_isMobile(_thread) {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return ((u.indexOf("windows")!=- 1&&u.indexOf("phone")!=- 1)||u.indexOf("iphone")!=- 1||u.indexOf("ipod")!=- 1||(u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1&&u.indexOf("mobile")!=- 1)||(u.indexOf("firefox")!=- 1&&u.indexOf("mobile")!=- 1)||(u.indexOf("blackberry")!=- 1||(u.indexOf("bb10")!=- 1&&u.indexOf("mobile")!=- 1)));
        
      },
      isWindows :function _trc_Navigator_isWindows() {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return u.indexOf("windows")!=- 1;
      },
      fiber$isWindows :function* _trc_Navigator_f_isWindows(_thread) {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return u.indexOf("windows")!=- 1;
        
      },
      isAndroid :function _trc_Navigator_isAndroid() {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return (u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1);
      },
      fiber$isAndroid :function* _trc_Navigator_f_isAndroid(_thread) {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return (u.indexOf("android")!=- 1&&u.indexOf("windows")==- 1);
        
      },
      isIOS :function _trc_Navigator_isIOS() {
        var _this=this;
        var u;
        var isIPad;
        
        u = _this.getUserAgent().toLowerCase();
        
        isIPad = u.indexOf("ipad")!=- 1||(u.indexOf("macintosh")!=- 1&&document.ontouchend);
        
        return (u.indexOf("iphone")!=- 1||isIPad||u.indexOf("ipod")!=- 1);
      },
      fiber$isIOS :function* _trc_Navigator_f_isIOS(_thread) {
        var _this=this;
        var u;
        var isIPad;
        
        u = _this.getUserAgent().toLowerCase();
        
        isIPad = u.indexOf("ipad")!=- 1||(u.indexOf("macintosh")!=- 1&&document.ontouchend);
        
        return (u.indexOf("iphone")!=- 1||isIPad||u.indexOf("ipod")!=- 1);
        
      },
      isFirefoxOS :function _trc_Navigator_isFirefoxOS() {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return u.indexOf("firefox")!=1;
      },
      fiber$isFirefoxOS :function* _trc_Navigator_f_isFirefoxOS(_thread) {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return u.indexOf("firefox")!=1;
        
      },
      isKindle :function _trc_Navigator_isKindle() {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return (u.indexOf("kindle")!=- 1||u.indexOf("silk")!=- 1);
      },
      fiber$isKindle :function* _trc_Navigator_f_isKindle(_thread) {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return (u.indexOf("kindle")!=- 1||u.indexOf("silk")!=- 1);
        
      },
      isBlackBerry :function _trc_Navigator_isBlackBerry() {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return (u.indexOf("blackberry")!=- 1||u.indexOf("playbook")!=- 1||(u.indexOf("bb10")!=- 1&&u.indexOf("mobile")!=- 1));
      },
      fiber$isBlackBerry :function* _trc_Navigator_f_isBlackBerry(_thread) {
        var _this=this;
        var u;
        
        u = _this.getUserAgent().toLowerCase();
        
        return (u.indexOf("blackberry")!=- 1||u.indexOf("playbook")!=- 1||(u.indexOf("bb10")!=- 1&&u.indexOf("mobile")!=- 1));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"getUserAgent":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isNW":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isTablet":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isMobile":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isWindows":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isAndroid":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isIOS":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isFirefoxOS":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isKindle":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isBlackBerry":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.ObjectPool',
  shortName: 'ObjectPool',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ObjectPool_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_ObjectPool_f_main(_thread) {
        var _this=this;
        
        
      },
      pool :function _trc_ObjectPool_pool(key,o) {
        var _this=this;
        var list;
        
        list = _this.poolList(key);
        
        o.objectPoolAge=(o.objectPoolAge||0)+1;
        list.push(o);
      },
      fiber$pool :function* _trc_ObjectPool_f_pool(_thread,key,o) {
        var _this=this;
        var list;
        
        list=yield* _this.fiber$poolList(_thread, key);
        
        o.objectPoolAge=(o.objectPoolAge||0)+1;
        list.push(o);
        
      },
      withdraw :function _trc_ObjectPool_withdraw(key) {
        var _this=this;
        var list;
        
        list = _this.poolList(key);
        
        return list.shift();
      },
      fiber$withdraw :function* _trc_ObjectPool_f_withdraw(_thread,key) {
        var _this=this;
        var list;
        
        list=yield* _this.fiber$poolList(_thread, key);
        
        return list.shift();
        
      },
      poolList :function _trc_ObjectPool_poolList(key) {
        var _this=this;
        
        _this.lists=_this.lists||{};
        return _this.lists[key]=_this.lists[key]||[];
      },
      fiber$poolList :function* _trc_ObjectPool_f_poolList(_thread,key) {
        var _this=this;
        
        _this.lists=_this.lists||{};
        return _this.lists[key]=_this.lists[key]||[];
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"pool":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"withdraw":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"poolList":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"lists":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TObject',
  shortName: 'TObject',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.PrintMod,Tonyu.classes.kernel.AssertionMod],
  methods: function (__superClass) {
    return {
      main :function _trc_TObject_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_TObject_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_TObject_initialize(options) {
        var _this=this;
        
        if (typeof  options=="object") {
          _this.extend(options);
        }
        _this.main();
      },
      extend :function _trc_TObject_extend(obj) {
        var _this=this;
        
        return Tonyu.extend(_this,obj);
      },
      toString :function _trc_TObject_toString() {
        var _this=this;
        
        return ['[',_this.getClassInfo().fullName,']'].join('');
      },
      fiber$toString :function* _trc_TObject_f_toString(_thread) {
        var _this=this;
        
        return ['[',_this.getClassInfo().fullName,']'].join('');
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"extend":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"toString":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"getClassInfo":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TQuery',
  shortName: 'TQuery',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_TQuery_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_TQuery_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initialize :function _trc_TQuery_initialize(context) {
        var _this=this;
        
        _this.length=0;
        if (Tonyu.is(context,Tonyu.classes.kernel.BaseActor)) {
          context={actor: context};
        }
        if (Tonyu.is(context,Tonyu.classes.kernel.Screen)) {
          context={screen: context};
        }
        context=context||{};
        context.is3D=(Tonyu.is(context.actor,Tonyu.classes.kernel.Actor3D));
        context.screen=context.screen||Tonyu.globals.$Screen;
        _this.context=context;
      },
      __getter__parent :function _trc_TQuery___getter__parent() {
        var _this=this;
        
        return _this.context.actor;
      },
      create :function _trc_TQuery_create() {
        var _this=this;
        
        return new Tonyu.classes.kernel.TQuery(_this.context);
      },
      fiber$create :function* _trc_TQuery_f_create(_thread) {
        var _this=this;
        
        return new Tonyu.classes.kernel.TQuery(_this.context);
        
      },
      contains :function _trc_TQuery_contains(t) {
        var _this=this;
        var o;
        
        for ([o] of Tonyu.iterator2(_this,1)) {
          if (o===t) {
            return true;
          }
          
        }
        return false;
      },
      fiber$contains :function* _trc_TQuery_f_contains(_thread,t) {
        var _this=this;
        var o;
        
        for ([o] of Tonyu.iterator2(_this,1)) {
          if (o===t) {
            return true;
          }
          
        }
        return false;
        
      },
      tonyuIterator :function _trc_TQuery_tonyuIterator(arity) {
        var _this=this;
        var res;
        
        res = {};
        
        res.i=0;
        if (arity==1) {
          res.next=(function anonymous_656() {
            
            if (res.i<_this.length) {
              res[0]=_this[res.i];
              res.i++;
              return true;
              
            }
            return false;
          });
          
        } else {
          res.next=(function anonymous_887() {
            
            if (res.i<_this.length) {
              res[0]=res.i;
              res[1]=_this[res.i];
              res.i++;
              return true;
              
            }
            return false;
          });
          
        }
        return res;
      },
      fiber$tonyuIterator :function* _trc_TQuery_f_tonyuIterator(_thread,arity) {
        var _this=this;
        var res;
        
        res = {};
        
        res.i=0;
        if (arity==1) {
          res.next=(function anonymous_656() {
            
            if (res.i<_this.length) {
              res[0]=_this[res.i];
              res.i++;
              return true;
              
            }
            return false;
          });
          
        } else {
          res.next=(function anonymous_887() {
            
            if (res.i<_this.length) {
              res[0]=res.i;
              res[1]=_this[res.i];
              res.i++;
              return true;
              
            }
            return false;
          });
          
        }
        return res;
        
      },
      attr :function _trc_TQuery_attr() {
        var _this=this;
        var values;
        var i;
        var e;
        
        
        if (_this.length==0) {
          return _this;
        }
        if (arguments.length==1&&typeof  arguments[0]=="string") {
          return _this[0][arguments[0]];
          
        }
        if (arguments.length>=2) {
          values={};
          for (i = 0;
           i<arguments.length-1 ; i+=2) {
            {
              values[arguments[i]]=arguments[i+1];
            }
          }
          
        } else {
          values=arguments[0];
          
        }
        if (values) {
          for ([e] of Tonyu.iterator2(_this,1)) {
            e.extend(values);
            
          }
          
        }
      },
      fiber$attr :function* _trc_TQuery_f_attr(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var values;
        var i;
        var e;
        
        
        if (_this.length==0) {
          return _this;
        }
        if (_arguments.length==1&&typeof  _arguments[0]=="string") {
          return _this[0][_arguments[0]];
          
        }
        if (_arguments.length>=2) {
          values={};
          for (i = 0;
           i<_arguments.length-1 ; i+=2) {
            {
              values[_arguments[i]]=_arguments[i+1];
            }
          }
          
        } else {
          values=_arguments[0];
          
        }
        if (values) {
          for ([e] of Tonyu.iterator2(_this,1)) {
            e.extend(values);
            
          }
          
        }
        
      },
      genKeyfunc :function _trc_TQuery_genKeyfunc(key) {
        var _this=this;
        
        if (typeof  key!="function") {
          return (function anonymous_1703(o) {
            
            return o[key];
          });
          
        } else {
          return key;
          
        }
      },
      fiber$genKeyfunc :function* _trc_TQuery_f_genKeyfunc(_thread,key) {
        var _this=this;
        
        if (typeof  key!="function") {
          return (function anonymous_1703(o) {
            
            return o[key];
          });
          
        } else {
          return key;
          
        }
        
      },
      applyArrayMethod :function _trc_TQuery_applyArrayMethod(name,args) {
        var _this=this;
        var res;
        var a;
        var r;
        
        res = _this.create();
        
        a = _this.toArray();
        
        r = a[name].apply(a,args);
        
        res.push(r);
        return res;
      },
      fiber$applyArrayMethod :function* _trc_TQuery_f_applyArrayMethod(_thread,name,args) {
        var _this=this;
        var res;
        var a;
        var r;
        
        res=yield* _this.fiber$create(_thread);
        
        a=yield* _this.fiber$toArray(_thread);
        
        r = a[name].apply(a,args);
        
        res.push(r);
        return res;
        
      },
      toArray :function _trc_TQuery_toArray() {
        var _this=this;
        var res;
        var i;
        
        res = [];
        
        for (i = 0;
         i<_this.length ; i++) {
          res.push(_this[i]);
        }
        return res;
      },
      fiber$toArray :function* _trc_TQuery_f_toArray(_thread) {
        var _this=this;
        var res;
        var i;
        
        res = [];
        
        for (i = 0;
         i<_this.length ; i++) {
          res.push(_this[i]);
        }
        return res;
        
      },
      sort :function _trc_TQuery_sort() {
        var _this=this;
        
        return _this.applyArrayMethod("sort",arguments);
      },
      fiber$sort :function* _trc_TQuery_f_sort(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        
        return yield* _this.fiber$applyArrayMethod(_thread, "sort", _arguments);
        
        
      },
      slice :function _trc_TQuery_slice() {
        var _this=this;
        
        return _this.applyArrayMethod("slice",arguments);
      },
      fiber$slice :function* _trc_TQuery_f_slice(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        
        return yield* _this.fiber$applyArrayMethod(_thread, "slice", _arguments);
        
        
      },
      maxs :function _trc_TQuery_maxs(key) {
        var _this=this;
        var f;
        var res;
        var reso;
        var o;
        var v;
        
        f = _this.genKeyfunc(key);
        
        reso = _this.create();
        
        for ([o] of Tonyu.iterator2(_this,1)) {
          v = f(o);
          
          if (res==null||v>=res) {
            if (v>res) {
              reso=_this.create();
            }
            reso.push(o);
            res=v;
            
          }
          
        }
        return reso;
      },
      fiber$maxs :function* _trc_TQuery_f_maxs(_thread,key) {
        var _this=this;
        var f;
        var res;
        var reso;
        var o;
        var v;
        
        f=yield* _this.fiber$genKeyfunc(_thread, key);
        
        reso=yield* _this.fiber$create(_thread);
        
        for ([o] of Tonyu.iterator2(_this,1)) {
          v = f(o);
          
          if (res==null||v>=res) {
            if (v>res) {
              reso=(yield* _this.fiber$create(_thread));
            }
            reso.push(o);
            res=v;
            
          }
          
        }
        return reso;
        
      },
      mins :function _trc_TQuery_mins(key) {
        var _this=this;
        var f;
        var res;
        var reso;
        var o;
        var v;
        
        f = _this.genKeyfunc(key);
        
        reso = _this.create();
        
        for ([o] of Tonyu.iterator2(_this,1)) {
          v = f(o);
          
          if (res==null||v<=res) {
            if (v<res) {
              reso=_this.create();
            }
            reso.push(o);
            res=v;
            
          }
          
        }
        return reso;
      },
      fiber$mins :function* _trc_TQuery_f_mins(_thread,key) {
        var _this=this;
        var f;
        var res;
        var reso;
        var o;
        var v;
        
        f=yield* _this.fiber$genKeyfunc(_thread, key);
        
        reso=yield* _this.fiber$create(_thread);
        
        for ([o] of Tonyu.iterator2(_this,1)) {
          v = f(o);
          
          if (res==null||v<=res) {
            if (v<res) {
              reso=(yield* _this.fiber$create(_thread));
            }
            reso.push(o);
            res=v;
            
          }
          
        }
        return reso;
        
      },
      minObj :function _trc_TQuery_minObj(key) {
        var _this=this;
        
        return _this.mins(key)[0];
      },
      fiber$minObj :function* _trc_TQuery_f_minObj(_thread,key) {
        var _this=this;
        
        return _this.mins(key)[0];
        
      },
      maxObj :function _trc_TQuery_maxObj(key) {
        var _this=this;
        
        return _this.maxs(key)[0];
      },
      fiber$maxObj :function* _trc_TQuery_f_maxObj(_thread,key) {
        var _this=this;
        
        return _this.maxs(key)[0];
        
      },
      nearests :function _trc_TQuery_nearests(x,y) {
        var _this=this;
        var z;
        
        
        if (x==null) {
          if (! _this.parent) {
            throw new Error("nearests: 座標を指定してください");
            
          }
          x=_this.parent.x;
          y=_this.parent.y;
          if (_this.context.is3D) {
            z=_this.parent.z;
          }
          
        }
        if (typeof  x=="object") {
          y=x.y;
          x=x.x;
          
        }
        if (_this.context.is3D) {
          return _this.mins((function anonymous_3077(o) {
            
            return _this.context.actor.dist(o);
          }));
          
        }
        return _this.mins((function anonymous_3163(o) {
          
          return _this.dist(o.x-x,o.y-y);
        }));
      },
      fiber$nearests :function* _trc_TQuery_f_nearests(_thread,x,y) {
        var _this=this;
        var z;
        
        
        if (x==null) {
          if (! _this.parent) {
            throw new Error("nearests: 座標を指定してください");
            
          }
          x=_this.parent.x;
          y=_this.parent.y;
          if (_this.context.is3D) {
            z=_this.parent.z;
          }
          
        }
        if (typeof  x=="object") {
          y=x.y;
          x=x.x;
          
        }
        if (_this.context.is3D) {
          return yield* _this.fiber$mins(_thread, (function anonymous_3077(o) {
            
            return _this.context.actor.dist(o);
          }));
          
          
        }
        return yield* _this.fiber$mins(_thread, (function anonymous_3163(o) {
          
          return _this.dist(o.x-x,o.y-y);
        }));
        
        
      },
      nearest :function _trc_TQuery_nearest(x,y) {
        var _this=this;
        
        return _this.nearests(x,y)[0];
      },
      fiber$nearest :function* _trc_TQuery_f_nearest(_thread,x,y) {
        var _this=this;
        
        return _this.nearests(x,y)[0];
        
      },
      withins :function _trc_TQuery_withins(xo,yd,d) {
        var _this=this;
        var x;
        var y;
        var z;
        
        
        if (arguments.length==1) {
          if (! _this.parent) {
            throw new Error("withins: 座標を指定してください");
            
          }
          x=_this.parent.x;
          y=_this.parent.y;
          if (_this.context.is3D) {
            z=_this.parent.z;
          }
          d=xo;
          
        } else {
          if (typeof  xo=="object") {
            x=xo.x;
            y=xo.y;
            d=yd;
            
          } else {
            x=xo;
            y=yd;
            
          }
        }
        if (_this.context.is3D) {
          return _this.find((function anonymous_3649(o) {
            
            return _this.context.actor.dist(o)<=d;
          }));
          
        }
        return _this.find((function anonymous_3742(o) {
          
          return _this.dist(o.x-x,o.y-y)<=d;
        }));
      },
      fiber$withins :function* _trc_TQuery_f_withins(_thread,xo,yd,d) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var x;
        var y;
        var z;
        
        
        if (_arguments.length==1) {
          if (! _this.parent) {
            throw new Error("withins: 座標を指定してください");
            
          }
          x=_this.parent.x;
          y=_this.parent.y;
          if (_this.context.is3D) {
            z=_this.parent.z;
          }
          d=xo;
          
        } else {
          if (typeof  xo=="object") {
            x=xo.x;
            y=xo.y;
            d=yd;
            
          } else {
            x=xo;
            y=yd;
            
          }
        }
        if (_this.context.is3D) {
          return yield* _this.fiber$find(_thread, (function anonymous_3649(o) {
            
            return _this.context.actor.dist(o)<=d;
          }));
          
          
        }
        return yield* _this.fiber$find(_thread, (function anonymous_3742(o) {
          
          return _this.dist(o.x-x,o.y-y)<=d;
        }));
        
        
      },
      within :function _trc_TQuery_within(xo,yd,d) {
        var _this=this;
        
        return _this.withins(xo,yd,d).nearest();
      },
      fiber$within :function* _trc_TQuery_f_within(_thread,xo,yd,d) {
        var _this=this;
        
        return _this.withins(xo,yd,d).nearest();
        
      },
      max :function _trc_TQuery_max(key) {
        var _this=this;
        var f;
        var res;
        var o;
        var v;
        
        f = _this.genKeyfunc(key);
        
        
        for ([o] of Tonyu.iterator2(_this,1)) {
          v = f(o);
          
          if (res==null||v>res) {
            res=v;
          }
          
        }
        return res;
      },
      min :function _trc_TQuery_min(key) {
        var _this=this;
        var f;
        var res;
        var o;
        var v;
        
        f = _this.genKeyfunc(key);
        
        
        for ([o] of Tonyu.iterator2(_this,1)) {
          v = f(o);
          
          if (res==null||v<res) {
            res=v;
          }
          
        }
        return res;
      },
      push :function _trc_TQuery_push(e) {
        var _this=this;
        var ee;
        
        if (Tonyu.is(e,Tonyu.classes.kernel.TQuery)||Tonyu.is(e,Array)) {
          for ([ee] of Tonyu.iterator2(e,1)) {
            _this.push(ee);
          }
          
        } else {
          _this[_this.length]=e;
          _this.length++;
          
        }
      },
      fiber$push :function* _trc_TQuery_f_push(_thread,e) {
        var _this=this;
        var ee;
        
        if (Tonyu.is(e,Tonyu.classes.kernel.TQuery)||Tonyu.is(e,Array)) {
          for ([ee] of Tonyu.iterator2(e,1)) {
            (yield* _this.fiber$push(_thread, ee));
          }
          
        } else {
          _this[_this.length]=e;
          _this.length++;
          
        }
        
      },
      size :function _trc_TQuery_size() {
        var _this=this;
        
        return _this.length;
      },
      fiber$size :function* _trc_TQuery_f_size(_thread) {
        var _this=this;
        
        return _this.length;
        
      },
      find :function _trc_TQuery_find(f) {
        var _this=this;
        var no;
        var q;
        var o;
        
        no = _this.create();
        
        if (typeof  f==="object") {
          q = f;
          
          f=(function anonymous_4483(o) {
            var k;
            var v;
            
            for ([k, v] of Tonyu.iterator2(q,2)) {
              if (o[k]!==v) {
                return false;
              }
              
            }
            return true;
          });
          
        }
        for ([o] of Tonyu.iterator2(_this,1)) {
          if (f(o)) {
            no.push(o);
          }
          
        }
        return no;
      },
      fiber$find :function* _trc_TQuery_f_find(_thread,f) {
        var _this=this;
        var no;
        var q;
        var o;
        
        no=yield* _this.fiber$create(_thread);
        
        if (typeof  f==="object") {
          q = f;
          
          f=(function anonymous_4483(o) {
            var k;
            var v;
            
            for ([k, v] of Tonyu.iterator2(q,2)) {
              if (o[k]!==v) {
                return false;
              }
              
            }
            return true;
          });
          
        }
        for ([o] of Tonyu.iterator2(_this,1)) {
          if (f(o)) {
            no.push(o);
          }
          
        }
        return no;
        
      },
      find1 :function _trc_TQuery_find1(f) {
        var _this=this;
        
        return _this.find(f)[0];
      },
      fiber$find1 :function* _trc_TQuery_f_find1(_thread,f) {
        var _this=this;
        
        return _this.find(f)[0];
        
      },
      filter :function _trc_TQuery_filter(f) {
        var _this=this;
        
        return _this.find(f);
      },
      fiber$filter :function* _trc_TQuery_f_filter(_thread,f) {
        var _this=this;
        
        return yield* _this.fiber$find(_thread, f);
        
        
      },
      random :function _trc_TQuery_random() {
        var _this=this;
        
        if (_this.length===0) {
          return null;
        }
        return _this[_this.rnd(_this.length)];
      },
      fiber$random :function* _trc_TQuery_f_random(_thread) {
        var _this=this;
        
        if (_this.length===0) {
          return null;
        }
        return _this[_this.rnd(_this.length)];
        
      },
      apply :function _trc_TQuery_apply(name,args) {
        var _this=this;
        var res;
        var o;
        var f;
        
        
        if (! args) {
          args=[];
        }
        for ([o] of Tonyu.iterator2(_this,1)) {
          f = o[name];
          
          if (typeof  f=="function") {
            res=f.apply(o,args);
            
          }
          
        }
        return res;
      },
      fiber$apply :function* _trc_TQuery_f_apply(_thread,name,args) {
        var _this=this;
        var res;
        var o;
        var f;
        
        
        if (! args) {
          args=[];
        }
        for ([o] of Tonyu.iterator2(_this,1)) {
          f = o[name];
          
          if (typeof  f=="function") {
            res=f.apply(o,args);
            
          }
          
        }
        return res;
        
      },
      alive :function _trc_TQuery_alive() {
        var _this=this;
        
        return _this.find((function anonymous_5179(o) {
          
          return ! o.isDead();
        }));
      },
      fiber$alive :function* _trc_TQuery_f_alive(_thread) {
        var _this=this;
        
        return yield* _this.fiber$find(_thread, (function anonymous_5179(o) {
          
          return ! o.isDead();
        }));
        
        
      },
      die :function _trc_TQuery_die() {
        var _this=this;
        var a;
        
        a = _this.alive();
        
        if (a.length==0) {
          return false;
        }
        a.apply("die");
        return true;
      },
      fiber$die :function* _trc_TQuery_f_die(_thread) {
        var _this=this;
        var a;
        
        a=yield* _this.fiber$alive(_thread);
        
        if (a.length==0) {
          return false;
        }
        a.apply("die");
        return true;
        
      },
      klass :function _trc_TQuery_klass(k) {
        var _this=this;
        
        return _this.find((function anonymous_5366(o) {
          
          return o instanceof k;
        }));
      },
      fiber$klass :function* _trc_TQuery_f_klass(_thread,k) {
        var _this=this;
        
        return yield* _this.fiber$find(_thread, (function anonymous_5366(o) {
          
          return o instanceof k;
        }));
        
        
      },
      sendEvent :function _trc_TQuery_sendEvent() {
        var _this=this;
        
        return Tonyu.bindFunc(_this,_this.apply).apply(_this,["sendEvent",arguments]);
      },
      fiber$sendEvent :function* _trc_TQuery_f_sendEvent(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        
        return Tonyu.bindFunc(_this,_this.apply).apply(_this,["sendEvent",_arguments]);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__parent":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"create":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"contains":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"tonyuIterator":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"attr":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"genKeyfunc":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"applyArrayMethod":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"toArray":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"sort":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"slice":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"maxs":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"mins":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"minObj":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"maxObj":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"nearests":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"nearest":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"withins":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"within":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"max":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"min":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"push":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"size":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"find":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"find1":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"filter":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"random":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"apply":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"alive":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"die":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"klass":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"sendEvent":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"length":{},"context":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Zip',
  shortName: 'Zip',
  namespace: 'kernel',
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Zip_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_Zip_f_main(_thread) {
        var _this=this;
        
        
      },
      zip :function _trc_Zip_zip(srcdir,zipfile) {
        var _this=this;
        
        Tonyu.globals.$currentProject.requestPlugin("JSZip");
        FS.zip.setJSZip(JSZip);
        return FS.zip.zip(srcdir,zipfile);
      },
      fiber$zip :function* _trc_Zip_f_zip(_thread,srcdir,zipfile) {
        var _this=this;
        
        Tonyu.globals.$currentProject.requestPlugin("JSZip");
        FS.zip.setJSZip(JSZip);
        return FS.zip.zip(srcdir,zipfile);
        
      },
      unzip :function _trc_Zip_unzip(zipfile,dstdir) {
        var _this=this;
        
        Tonyu.globals.$currentProject.requestPlugin("JSZip");
        FS.zip.setJSZip(JSZip);
        return FS.zip.unzip(zipfile,dstdir);
      },
      fiber$unzip :function* _trc_Zip_f_unzip(_thread,zipfile,dstdir) {
        var _this=this;
        
        Tonyu.globals.$currentProject.requestPlugin("JSZip");
        FS.zip.setJSZip(JSZip);
        return FS.zip.unzip(zipfile,dstdir);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"zip":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"unzip":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.EventHandler',
  shortName: 'EventHandler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.EventHandlerCaller],
  methods: function (__superClass) {
    return {
      main :function _trc_EventHandler_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_EventHandler_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initialize :function _trc_EventHandler_initialize(param) {
        var _this=this;
        
        __superClass.apply( _this, [param]);
        _this.listeners=[];
      },
      toListener :function _trc_EventHandler_toListener(f) {
        var _this=this;
        
        if (_this.target&&(typeof  f)=="string") {
          f=_this.target[f];
          
        }
        if (typeof  f!="function") {
          throw new Error("Not a event listener: "+_this.target+" / "+f);
          
        }
        return f;
      },
      newListener :function _trc_EventHandler_newListener(f) {
        var _this=this;
        var listener;
        
        listener = {action: f};
        
        return listener;
      },
      addListener :function _trc_EventHandler_addListener() {
        var _this=this;
        var a;
        var f;
        var listener;
        
        a = new Tonyu.classes.kernel.ArgParser(arguments).toArray();
        
        f = a.pop();
        
        f=_this.toListener(f);
        a.push(f);
        listener = Tonyu.bindFunc(_this,_this.newListener).apply(_this,a);
        
        listener.remove=(function anonymous_700() {
          
          _this.removeListener(listener);
        });
        listener.dispose=listener.dispose||(function anonymous_786() {
          
        });
        listener.action=listener.action||f;
        _this.listeners.push(listener);
        return listener;
      },
      doDispose :function _trc_EventHandler_doDispose(listener) {
        var _this=this;
        
        if (typeof  listener.dispose==="function") {
          listener.dispose({last: _this.listeners.length==0,listener: listener});
          
        }
      },
      removeListener :function _trc_EventHandler_removeListener(listener) {
        var _this=this;
        var i;
        
        i = _this.listeners.indexOf(listener);
        
        if (i>=0) {
          _this.listeners.splice(i,1);
          _this.doDispose(listener);
          
        }
      },
      removeAllListeners :function _trc_EventHandler_removeAllListeners() {
        var _this=this;
        var listener;
        
        
        while (listener=_this.listeners.shift()) {
          _this.doDispose(listener);
          
        }
      },
      fire :function _trc_EventHandler_fire(args) {
        var _this=this;
        var listener;
        
        if (_this.released) {
          return _this;
        }
        for ([listener] of Tonyu.iterator2(_this.listeners.slice(),1)) {
          _this.callEventHandler(listener.action,args);
          
        }
      },
      fiber$fire :function* _trc_EventHandler_f_fire(_thread,args) {
        var _this=this;
        var listener;
        
        if (_this.released) {
          return _this;
        }
        for ([listener] of Tonyu.iterator2(_this.listeners.slice(),1)) {
          (yield* _this.fiber$callEventHandler(_thread, listener.action, args));
          
        }
        
      },
      release :function _trc_EventHandler_release() {
        var _this=this;
        
        _this.released=true;
        _this.removeAllListeners();
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"toListener":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"newListener":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"addListener":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"doDispose":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"removeListener":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"removeAllListeners":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"fire":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"release":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"listeners":{},"target":{},"released":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ScreenOutHandler',
  shortName: 'ScreenOutHandler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.EventHandler,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ScreenOutHandler_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_ScreenOutHandler_f_main(_thread) {
        var _this=this;
        
        
      },
      addListener :function _trc_ScreenOutHandler_addListener(d,f) {
        var _this=this;
        var retThread;
        
        retThread = _this.target.parallel("screenOutChecker",d,_this.toListener(f));
        
        return {remove: (function anonymous_147() {
          
          retThread.kill();
        })};
      },
      initialize :function _trc_ScreenOutHandler_initialize(param) {
        var _this=this;
        
        __superClass.apply( _this, [param]);
        _this.id=(Tonyu.globals.$idseq=(Tonyu.globals.$idseq||0)+1);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"addListener":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.WithinHandler',
  shortName: 'WithinHandler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.EventHandler,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_WithinHandler_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_WithinHandler_f_main(_thread) {
        var _this=this;
        
        
      },
      addListener :function _trc_WithinHandler_addListener(d,r,f) {
        var _this=this;
        var retThread;
        
        retThread = _this.target.parallel("withinChecker",d,r,_this.toListener(f));
        
        return {remove: (function anonymous_149() {
          
          retThread.kill();
        })};
      },
      initialize :function _trc_WithinHandler_initialize(param) {
        var _this=this;
        
        __superClass.apply( _this, [param]);
        _this.id=(Tonyu.globals.$idseq=(Tonyu.globals.$idseq||0)+1);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"addListener":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.AbstractShape',
  shortName: 'AbstractShape',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_AbstractShape_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_AbstractShape_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      __getter__order :function _trc_AbstractShape___getter__order() {
        var _this=this;
        
        return 0;
      },
      clone :function _trc_AbstractShape_clone(value) {
        var _this=this;
        
        throw new Error("clone::abstract");
        
      },
      fiber$clone :function* _trc_AbstractShape_f_clone(_thread,value) {
        var _this=this;
        
        throw new Error("clone::abstract");
        
        
      },
      changeLayer :function _trc_AbstractShape_changeLayer(value) {
        var _this=this;
        
        _this.layer=value;
      },
      fiber$changeLayer :function* _trc_AbstractShape_f_changeLayer(_thread,value) {
        var _this=this;
        
        _this.layer=value;
        
      },
      changeLayerPath :function _trc_AbstractShape_changeLayerPath(value) {
        var _this=this;
        
        throw new Error("changeLayerPath::abstract");
        
      },
      fiber$changeLayerPath :function* _trc_AbstractShape_f_changeLayerPath(_thread,value) {
        var _this=this;
        
        throw new Error("changeLayerPath::abstract");
        
        
      },
      intersects :function _trc_AbstractShape_intersects(s) {
        var _this=this;
        
        if (! s) {
          return false;
        }
        if (s.layerPath===_this.layerPath||! s.layerPath||! _this.layerPath) {
          return _this.intersectsRaw(s);
          
        }
        return _this.intersectsRaw(s.layerPathChanged(_this.layerPath));
      },
      fiber$intersects :function* _trc_AbstractShape_f_intersects(_thread,s) {
        var _this=this;
        
        if (! s) {
          return false;
        }
        if (s.layerPath===_this.layerPath||! s.layerPath||! _this.layerPath) {
          return yield* _this.fiber$intersectsRaw(_thread, s);
          
          
        }
        return yield* _this.fiber$intersectsRaw(_thread, s.layerPathChanged(_this.layerPath));
        
        
      },
      intersectsRaw :function _trc_AbstractShape_intersectsRaw(s) {
        var _this=this;
        
        if (Tonyu.is(s,Tonyu.classes.kernel.PointShape)) {
          return _this.containsRaw(s);
          
        }
        if (s.order>_this.order) {
          return s.intersectsRaw(_this);
          
        }
        throw new Error("intersectsRaw::abstract");
        
      },
      fiber$intersectsRaw :function* _trc_AbstractShape_f_intersectsRaw(_thread,s) {
        var _this=this;
        
        if (Tonyu.is(s,Tonyu.classes.kernel.PointShape)) {
          return yield* _this.fiber$containsRaw(_thread, s);
          
          
        }
        if (s.order>_this.order) {
          return s.intersectsRaw(_this);
          
        }
        throw new Error("intersectsRaw::abstract");
        
        
      },
      contains :function _trc_AbstractShape_contains(s) {
        var _this=this;
        
        if (! s) {
          return false;
        }
        if (s.layerPath===_this.layerPath||! s.layerPath||! _this.layerPath) {
          return _this.containsRaw(s);
          
        }
        return _this.containsRaw(s.layerPathChanged(_this.layerPath));
      },
      fiber$contains :function* _trc_AbstractShape_f_contains(_thread,s) {
        var _this=this;
        
        if (! s) {
          return false;
        }
        if (s.layerPath===_this.layerPath||! s.layerPath||! _this.layerPath) {
          return yield* _this.fiber$containsRaw(_thread, s);
          
          
        }
        return yield* _this.fiber$containsRaw(_thread, s.layerPathChanged(_this.layerPath));
        
        
      },
      containsRaw :function _trc_AbstractShape_containsRaw(s) {
        var _this=this;
        
        throw new Error("containsRaw::abstract");
        
      },
      fiber$containsRaw :function* _trc_AbstractShape_f_containsRaw(_thread,s) {
        var _this=this;
        
        throw new Error("containsRaw::abstract");
        
        
      },
      layerPathChanged :function _trc_AbstractShape_layerPathChanged(layerPath) {
        var _this=this;
        var res;
        
        res = _this.clone();
        
        res.layerPath=layerPath;
        return res;
      },
      fiber$layerPathChanged :function* _trc_AbstractShape_f_layerPathChanged(_thread,layerPath) {
        var _this=this;
        var res;
        
        res=yield* _this.fiber$clone(_thread);
        
        res.layerPath=layerPath;
        return res;
        
      },
      layerPathFromLayer :function _trc_AbstractShape_layerPathFromLayer(layer) {
        var _this=this;
        
        if (Tonyu.is(layer,Tonyu.classes.kernel.LayerPath)) {
          return layer;
        }
        let nl = (_this._layerPath&&_this._layerPath.withNeighborTarget(layer))||layer.defaultLayerPath;
        
        return _this.assertIs(nl,Tonyu.classes.kernel.LayerPath);
      },
      fiber$layerPathFromLayer :function* _trc_AbstractShape_f_layerPathFromLayer(_thread,layer) {
        var _this=this;
        
        if (Tonyu.is(layer,Tonyu.classes.kernel.LayerPath)) {
          return layer;
        }
        let nl = (_this._layerPath&&_this._layerPath.withNeighborTarget(layer))||layer.defaultLayerPath;
        
        return yield* _this.fiber$assertIs(_thread, nl, Tonyu.classes.kernel.LayerPath);
        
        
      },
      layerChanged :function _trc_AbstractShape_layerChanged(layer) {
        var _this=this;
        
        let nl = _this.layerPathFromLayer(layer);
        
        return _this.layerPathChanged(nl);
      },
      fiber$layerChanged :function* _trc_AbstractShape_f_layerChanged(_thread,layer) {
        var _this=this;
        
        let nl=yield* _this.fiber$layerPathFromLayer(_thread, layer);
        
        return yield* _this.fiber$layerPathChanged(_thread, nl);
        
        
      },
      __getter__layer :function _trc_AbstractShape___getter__layer() {
        var _this=this;
        
        return _this._layerPath&&_this._layerPath.target;
      },
      __setter__layer :function _trc_AbstractShape___setter__layer(value) {
        var _this=this;
        
        _this.layerPath=_this.layerPathFromLayer(value);
      },
      __setter__layerPath :function _trc_AbstractShape___setter__layerPath(value) {
        var _this=this;
        
        if (! _this._layerPath||_this._layerPath===value) {
          _this._layerPath=value;
        } else {
          _this.changeLayerPath(value);
        }
      },
      __getter__layerPath :function _trc_AbstractShape___getter__layerPath() {
        var _this=this;
        
        return _this._layerPath;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"__getter__order":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clone":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"changeLayer":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"changeLayerPath":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"intersects":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.AbstractShape"],"returnValue":null}},"intersectsRaw":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.AbstractShape"],"returnValue":null}},"contains":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.AbstractShape"],"returnValue":null}},"containsRaw":{"nowait":false,"isMain":false,"vtype":{"params":["Object"],"returnValue":null}},"layerPathChanged":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"layerPathFromLayer":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"layerChanged":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__layer":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__layer":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__layerPath":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__layerPath":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"_layerPath":{"vtype":"kernel.LayerPath"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.CircleShape',
  shortName: 'CircleShape',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.AbstractShape,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_CircleShape_main() {
        var _this=this;
        
        "field strict";
        
        
      },
      fiber$main :function* _trc_CircleShape_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
      },
      __getter__order :function _trc_CircleShape___getter__order() {
        var _this=this;
        
        return 3;
      },
      containsRaw :function _trc_CircleShape_containsRaw(shape) {
        var _this=this;
        
        return _this.dist(shape.x-_this.x,shape.y-_this.y)<=_this.radius;
      },
      fiber$containsRaw :function* _trc_CircleShape_f_containsRaw(_thread,shape) {
        var _this=this;
        
        return _this.dist(shape.x-_this.x,shape.y-_this.y)<=_this.radius;
        
      },
      intersectsRaw :function _trc_CircleShape_intersectsRaw(shape) {
        var _this=this;
        
        if (Tonyu.is(shape,Tonyu.classes.kernel.RectShape)) {
          return _this.isRectangleCircleCollision(shape,_this);
          
        }
        if (Tonyu.is(shape,Tonyu.classes.kernel.CircleShape)) {
          let c = shape;
          
          return _this.dist(c.x-_this.x,c.y-_this.y)<=c.radius+_this.radius;
          
        }
        return __superClass.prototype.intersectsRaw.apply( _this, [shape]);
      },
      fiber$intersectsRaw :function* _trc_CircleShape_f_intersectsRaw(_thread,shape) {
        var _this=this;
        
        if (Tonyu.is(shape,Tonyu.classes.kernel.RectShape)) {
          return yield* _this.fiber$isRectangleCircleCollision(_thread, shape, _this);
          
          
        }
        if (Tonyu.is(shape,Tonyu.classes.kernel.CircleShape)) {
          let c = shape;
          
          return _this.dist(c.x-_this.x,c.y-_this.y)<=c.radius+_this.radius;
          
        }
        return __superClass.prototype.intersectsRaw.apply( _this, [shape]);
        
      },
      isRectangleCircleCollision :function _trc_CircleShape_isRectangleCircleCollision(rect,circle) {
        var _this=this;
        
        let rectCenterX = rect.x;
        
        let rectCenterY = rect.y;
        
        let circleCenterX = circle.x;
        
        let circleCenterY = circle.y;
        
        let deltaX = _this.abs(circleCenterX-rectCenterX);
        
        let deltaY = _this.abs(circleCenterY-rectCenterY);
        
        if (deltaX>rect.width/2+circle.radius||deltaY>rect.height/2+circle.radius) {
          return false;
          
        }
        if (deltaX<=rect.width/2||deltaY<=rect.height/2) {
          return true;
          
        }
        let cornerDistanceSquared = Tonyu.globals.$Math.pow(deltaX-rect.width/2,2)+Tonyu.globals.$Math.pow((deltaY-rect.height/2),2);
        
        return cornerDistanceSquared<=Tonyu.globals.$Math.pow(circle.radius,2);
      },
      fiber$isRectangleCircleCollision :function* _trc_CircleShape_f_isRectangleCircleCollision(_thread,rect,circle) {
        var _this=this;
        
        let rectCenterX = rect.x;
        
        let rectCenterY = rect.y;
        
        let circleCenterX = circle.x;
        
        let circleCenterY = circle.y;
        
        let deltaX = _this.abs(circleCenterX-rectCenterX);
        
        let deltaY = _this.abs(circleCenterY-rectCenterY);
        
        if (deltaX>rect.width/2+circle.radius||deltaY>rect.height/2+circle.radius) {
          return false;
          
        }
        if (deltaX<=rect.width/2||deltaY<=rect.height/2) {
          return true;
          
        }
        let cornerDistanceSquared = Tonyu.globals.$Math.pow(deltaX-rect.width/2,2)+Tonyu.globals.$Math.pow((deltaY-rect.height/2),2);
        
        return cornerDistanceSquared<=Tonyu.globals.$Math.pow(circle.radius,2);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"__getter__order":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"containsRaw":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.PointShape"],"returnValue":null}},"intersectsRaw":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.AbstractShape"],"returnValue":null}},"isRectangleCircleCollision":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.RectShape","kernel.CircleShape"],"returnValue":null}}},"fields":{"radius":{},"x":{},"y":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.CubeShape',
  shortName: 'CubeShape',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_CubeShape_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_CubeShape_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      intersects :function _trc_CubeShape_intersects(s) {
        var _this=this;
        
        return s&&Math.abs(_this.x-s.x)*2<_this.width+s.width&&Math.abs(_this.y-s.y)*2<_this.height+s.height&&Math.abs(_this.z-s.z)*2<_this.depth+s.depth;
      },
      fiber$intersects :function* _trc_CubeShape_f_intersects(_thread,s) {
        var _this=this;
        
        return s&&Math.abs(_this.x-s.x)*2<_this.width+s.width&&Math.abs(_this.y-s.y)*2<_this.height+s.height&&Math.abs(_this.z-s.z)*2<_this.depth+s.depth;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"intersects":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.CubeShape"],"returnValue":null}}},"fields":{"x":{},"y":{},"z":{},"width":{},"height":{},"depth":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Direction',
  shortName: 'Direction',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Direction_main() {
        var _this=this;
        
        "field strict";
        
        
      },
      fiber$main :function* _trc_Direction_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
      },
      initAxis :function _trc_Direction_initAxis() {
        var _this=this;
        
        if (! Tonyu.classes.kernel.Direction.axis) {
          Tonyu.classes.kernel.Direction.axis={roll: new Tonyu.classes.kernel.Vec3(0,0,1),pitch: new Tonyu.classes.kernel.Vec3(1,0,0),yaw: new Tonyu.classes.kernel.Vec3(0,1,0)};
          
        }
      },
      fiber$initAxis :function* _trc_Direction_f_initAxis(_thread) {
        var _this=this;
        
        if (! Tonyu.classes.kernel.Direction.axis) {
          Tonyu.classes.kernel.Direction.axis={roll: new Tonyu.classes.kernel.Vec3(0,0,1),pitch: new Tonyu.classes.kernel.Vec3(1,0,0),yaw: new Tonyu.classes.kernel.Vec3(0,1,0)};
          
        }
        
      },
      clone :function _trc_Direction_clone() {
        var _this=this;
        
        return new Tonyu.classes.kernel.Direction().set(_this);
      },
      fiber$clone :function* _trc_Direction_f_clone(_thread) {
        var _this=this;
        
        return new Tonyu.classes.kernel.Direction().set(_this);
        
      },
      set :function _trc_Direction_set(d) {
        var _this=this;
        
        _this.quaternion.set(d.quaternion);
        return _this;
      },
      fiber$set :function* _trc_Direction_f_set(_thread,d) {
        var _this=this;
        
        _this.quaternion.set(d.quaternion);
        return _this;
        
      },
      initialize :function _trc_Direction_initialize(p) {
        var _this=this;
        
        _this.initAxis();
        __superClass.apply( _this, [p]);
        _this.quaternion=new Tonyu.classes.kernel.Quaternion;
        _this.forward=new Tonyu.classes.kernel.ComputedVec3((function anonymous_565(t) {
          var r;
          
          r = _this.quaternion.rotate(Tonyu.classes.kernel.Direction.axis.roll);
          
          return t.keep(r);
        }));
        _this.down=new Tonyu.classes.kernel.ComputedVec3((function anonymous_689(t) {
          var r;
          
          r = _this.quaternion.rotate(Tonyu.classes.kernel.Direction.axis.yaw);
          
          return t.keep(r);
        }));
        _this.right=new Tonyu.classes.kernel.ComputedVec3((function anonymous_813(t) {
          var r;
          
          r = _this.quaternion.rotate(Tonyu.classes.kernel.Direction.axis.pitch);
          
          return t.keep(r);
        }));
        _this.back=new Tonyu.classes.kernel.ComputedVec3((function anonymous_938(t) {
          
          return _this.forward.mul(- 1);
        }));
        _this.up=new Tonyu.classes.kernel.ComputedVec3((function anonymous_1011(t) {
          
          return _this.down.mul(- 1);
        }));
        _this.left=new Tonyu.classes.kernel.ComputedVec3((function anonymous_1083(t) {
          
          return _this.right.mul(- 1);
        }));
      },
      rotate :function _trc_Direction_rotate(mode,angle,unit) {
        var _this=this;
        var x;
        var y;
        var nx;
        var ny;
        var axis;
        
        
        if (Tonyu.is(mode,Tonyu.classes.kernel.Vec3)) {
          axis=mode;
        } else {
          axis=Tonyu.classes.kernel.Direction.axis[mode];
        }
        if (! axis) {
          _this.quaternion.set(new Tonyu.classes.kernel.Quaternion);
          
        } else {
          _this.quaternion.product(new Tonyu.classes.kernel.Quaternion({axis: axis,r: angle}),_this.quaternion);
          
        }
        _this.forward.requestCompute();
        _this.down.requestCompute();
        _this.right.requestCompute();
        return _this;
      },
      fiber$rotate :function* _trc_Direction_f_rotate(_thread,mode,angle,unit) {
        var _this=this;
        var x;
        var y;
        var nx;
        var ny;
        var axis;
        
        
        if (Tonyu.is(mode,Tonyu.classes.kernel.Vec3)) {
          axis=mode;
        } else {
          axis=Tonyu.classes.kernel.Direction.axis[mode];
        }
        if (! axis) {
          _this.quaternion.set(new Tonyu.classes.kernel.Quaternion);
          
        } else {
          _this.quaternion.product(new Tonyu.classes.kernel.Quaternion({axis: axis,r: angle}),_this.quaternion);
          
        }
        _this.forward.requestCompute();
        _this.down.requestCompute();
        _this.right.requestCompute();
        return _this;
        
      },
      localToWorld :function _trc_Direction_localToWorld(local,dst) {
        var _this=this;
        
        return _this.quaternion.rotate(local,dst);
      },
      fiber$localToWorld :function* _trc_Direction_f_localToWorld(_thread,local,dst) {
        var _this=this;
        
        return _this.quaternion.rotate(local,dst);
        
      },
      worldToLocal :function _trc_Direction_worldToLocal(world,dst) {
        var _this=this;
        
        return _this.quaternion.inverse.rotate(world,dst);
      },
      fiber$worldToLocal :function* _trc_Direction_f_worldToLocal(_thread,world,dst) {
        var _this=this;
        
        return _this.quaternion.inverse.rotate(world,dst);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"initAxis":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clone":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"set":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Direction"],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"rotate":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"localToWorld":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"worldToLocal":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"forward":{},"down":{},"right":{},"back":{},"up":{},"left":{},"quaternion":{"vtype":"kernel.Quaternion"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ParentChanger',
  shortName: 'ParentChanger',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ParentChanger_main() {
        var _this=this;
        
        "field strict";
        
        
      },
      fiber$main :function* _trc_ParentChanger_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
      },
      initialize :function _trc_ParentChanger_initialize(dstParent) {
        var _this=this;
        var cnode;
        var t;
        
        
        _this.nodes={};
        dstParent=dstParent||Tonyu.classes.kernel.Transform.root;
        _this.dstParent=dstParent;
        _this.nodes[dstParent.id]=cnode=_this.cn({transform: dstParent,isDst: true});
        for (t = dstParent.parent;
         t ; t=t.parent) {
          {
            cnode=_this.cn({transform: t,next: cnode,relation: "child"});
            _this.nodes[t.id]=cnode;
          }
        }
      },
      cn :function _trc_ParentChanger_cn(n) {
        var _this=this;
        
        switch (n.relation) {
        case "parent":
          _this.chk(n.next.transform.isParentOf(n.transform),"cn::parent not match");
          break;
          
        case "child":
          _this.chk(n.next.transform.isChildOf(n.transform),"cn::child not match");
          break;
          
        case "sibling":
          _this.chk(n.next.transform.isSibling(n.transform),"cn::sibling not match");
          break;
          
        default:
          _this.chk(n.isDst,"cn::relation not set");
        }
        return n;
      },
      fiber$cn :function* _trc_ParentChanger_f_cn(_thread,n) {
        var _this=this;
        
        switch (n.relation) {
        case "parent":
          (yield* _this.fiber$chk(_thread, n.next.transform.isParentOf(n.transform), "cn::parent not match"));
          break;
          
        case "child":
          (yield* _this.fiber$chk(_thread, n.next.transform.isChildOf(n.transform), "cn::child not match"));
          break;
          
        case "sibling":
          (yield* _this.fiber$chk(_thread, n.next.transform.isSibling(n.transform), "cn::sibling not match"));
          break;
          
        default:
          (yield* _this.fiber$chk(_thread, n.isDst, "cn::relation not set"));
        }
        return n;
        
      },
      chk :function _trc_ParentChanger_chk(b,mesg) {
        var _this=this;
        
        if (! b) {
          throw new Error("ParentChanger::"+mesg);
          
        }
      },
      fiber$chk :function* _trc_ParentChanger_f_chk(_thread,b,mesg) {
        var _this=this;
        
        if (! b) {
          throw new Error("ParentChanger::"+mesg);
          
        }
        
      },
      getNode :function _trc_ParentChanger_getNode(tt) {
        var _this=this;
        var cnode;
        var prev;
        var path;
        var t;
        
        if (_this.nodes[tt.id]) {
          return _this.nodes[tt.id];
        }
        
        path = [];
        
        t = tt;
        
        while (true) {
          _this.chk(t,"t reached to root(null)");
          cnode=_this.nodes[t.id];
          if (cnode) {
            break;
            
            
          }
          path.unshift(t);
          t=t.parent;
          
        }
        if (cnode.relation==="child") {
          t=path.shift();
          cnode=_this.nodes[t.id]=_this.cn({next: cnode.next,relation: "sibling",transform: t});
          
        }
        while (t=path.shift()) {
          _this.chk(t.parent===cnode.transform,"getNode cnode parent not match");
          cnode=_this.nodes[t.id]=_this.cn({next: cnode,relation: "parent",transform: t});
          
        }
        _this.chk(cnode.transform===tt,"getNode cnode not match");
        return cnode;
      },
      fiber$getNode :function* _trc_ParentChanger_f_getNode(_thread,tt) {
        var _this=this;
        var cnode;
        var prev;
        var path;
        var t;
        
        if (_this.nodes[tt.id]) {
          return _this.nodes[tt.id];
        }
        
        path = [];
        
        t = tt;
        
        while (true) {
          (yield* _this.fiber$chk(_thread, t, "t reached to root(null)"));
          cnode=_this.nodes[t.id];
          if (cnode) {
            break;
            
            
          }
          path.unshift(t);
          t=t.parent;
          
        }
        if (cnode.relation==="child") {
          t=path.shift();
          cnode=_this.nodes[t.id]=_this.cn({next: cnode.next,relation: "sibling",transform: t});
          
        }
        while (t=path.shift()) {
          (yield* _this.fiber$chk(_thread, t.parent===cnode.transform, "getNode cnode parent not match"));
          cnode=_this.nodes[t.id]=_this.cn({next: cnode,relation: "parent",transform: t});
          
        }
        (yield* _this.fiber$chk(_thread, cnode.transform===tt, "getNode cnode not match"));
        return cnode;
        
      },
      change :function _trc_ParentChanger_change(t,res) {
        var _this=this;
        var n;
        var dstNode;
        
        res=res||new Tonyu.classes.kernel.Transform;
        res.set(t);
        if (res.parent===_this.dstParent) {
          return res;
        }
        n = _this.getNode(res.parent);
        
        dstNode = _this.getNode(_this.dstParent);
        
        while (n!==dstNode) {
          _this.chk(res.parent===n.transform,"convert not match ");
          switch (n.relation) {
          case "parent":
            n.transform.childToSibling(res,res);
            break;
            
          case "child":
            _this.chk(n.next.transform.isSibling(res),"convert::child not match");
            n.next.transform.siblingToChild(res,res);
            break;
            
          case "sibling":
            n.transform.childToSibling(res,res);
            _this.chk(n.next.transform.isSibling(res),"convert::sibling not match");
            n.next.transform.siblingToChild(res,res);
            break;
            
          default:
            _this.chk(false,"Unknown relation:"+n.relation+"/"+n.transform.id+"/"+_this.dstParent.id);
          }
          n=n.next;
          
        }
        _this.chk(res.parent===_this.dstParent,"change::fail");
        return res;
      },
      fiber$change :function* _trc_ParentChanger_f_change(_thread,t,res) {
        var _this=this;
        var n;
        var dstNode;
        
        res=res||new Tonyu.classes.kernel.Transform;
        res.set(t);
        if (res.parent===_this.dstParent) {
          return res;
        }
        n=yield* _this.fiber$getNode(_thread, res.parent);
        
        dstNode=yield* _this.fiber$getNode(_thread, _this.dstParent);
        
        while (n!==dstNode) {
          (yield* _this.fiber$chk(_thread, res.parent===n.transform, "convert not match "));
          switch (n.relation) {
          case "parent":
            n.transform.childToSibling(res,res);
            break;
            
          case "child":
            (yield* _this.fiber$chk(_thread, n.next.transform.isSibling(res), "convert::child not match"));
            n.next.transform.siblingToChild(res,res);
            break;
            
          case "sibling":
            n.transform.childToSibling(res,res);
            (yield* _this.fiber$chk(_thread, n.next.transform.isSibling(res), "convert::sibling not match"));
            n.next.transform.siblingToChild(res,res);
            break;
            
          default:
            (yield* _this.fiber$chk(_thread, false, "Unknown relation:"+n.relation+"/"+n.transform.id+"/"+_this.dstParent.id));
          }
          n=n.next;
          
        }
        (yield* _this.fiber$chk(_thread, res.parent===_this.dstParent, "change::fail"));
        return res;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Transform"],"returnValue":null}},"cn":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"chk":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getNode":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Transform"],"returnValue":null}},"change":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Transform","kernel.Transform"],"returnValue":null}}},"fields":{"dstParent":{"vtype":"kernel.Transform"},"nodes":{"vtype":"Object"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.PointShape',
  shortName: 'PointShape',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.AbstractShape,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_PointShape_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_PointShape_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      __getter__order :function _trc_PointShape___getter__order() {
        var _this=this;
        
        return 1;
      },
      clone :function _trc_PointShape_clone() {
        var _this=this;
        
        return new Tonyu.classes.kernel.PointShape({x: _this.x,y: _this.y,_layerPath: _this._layerPath});
      },
      fiber$clone :function* _trc_PointShape_f_clone(_thread) {
        var _this=this;
        
        return new Tonyu.classes.kernel.PointShape({x: _this.x,y: _this.y,_layerPath: _this._layerPath});
        
      },
      changeLayerPath :function _trc_PointShape_changeLayerPath(newLayerPath) {
        var _this=this;
        var c;
        
        c = _this._layerPath.convert({x: _this.x,y: _this.y},newLayerPath);
        
        _this.x=c.x;
        _this.y=c.y;
        _this._layerPath=newLayerPath;
      },
      fiber$changeLayerPath :function* _trc_PointShape_f_changeLayerPath(_thread,newLayerPath) {
        var _this=this;
        var c;
        
        c = _this._layerPath.convert({x: _this.x,y: _this.y},newLayerPath);
        
        _this.x=c.x;
        _this.y=c.y;
        _this._layerPath=newLayerPath;
        
      },
      intersectsRaw :function _trc_PointShape_intersectsRaw(s) {
        var _this=this;
        
        return s.containsRaw(_this);
      },
      fiber$intersectsRaw :function* _trc_PointShape_f_intersectsRaw(_thread,s) {
        var _this=this;
        
        return s.containsRaw(_this);
        
      },
      containsRaw :function _trc_PointShape_containsRaw(p) {
        var _this=this;
        
        return p.x===_this.x&&p.y===_this.y;
      },
      fiber$containsRaw :function* _trc_PointShape_f_containsRaw(_thread,p) {
        var _this=this;
        
        return p.x===_this.x&&p.y===_this.y;
        
      },
      __getter__xmin :function _trc_PointShape___getter__xmin() {
        var _this=this;
        
        return _this.x;
      },
      __getter__xmax :function _trc_PointShape___getter__xmax() {
        var _this=this;
        
        return _this.x;
      },
      __getter__ymin :function _trc_PointShape___getter__ymin() {
        var _this=this;
        
        return _this.y;
      },
      __getter__ymax :function _trc_PointShape___getter__ymax() {
        var _this=this;
        
        return _this.y;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"__getter__order":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clone":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"changeLayerPath":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"intersectsRaw":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.AbstractShape"],"returnValue":null}},"containsRaw":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__xmin":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__xmax":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__ymin":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__ymax":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"x":{},"y":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Quaternion',
  shortName: 'Quaternion',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Quaternion_main() {
        var _this=this;
        
        "field strict";
        
        
      },
      fiber$main :function* _trc_Quaternion_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
      },
      initialize :function _trc_Quaternion_initialize(p) {
        var _this=this;
        var v;
        
        __superClass.apply( _this, [p]);
        if (_this.axis&&typeof  _this.r==="number") {
          _this.theta=_this.r/2;
          v = _this.axis.normalize(_this.sin(_this.theta));
          
          _this.x=v.x;
          _this.y=v.y;
          _this.z=v.z;
          _this.w=_this.cos(_this.theta);
          
        } else {
          _this.x=_this.x||0;
          _this.y=_this.y||0;
          _this.z=_this.z||0;
          if (_this.w==null) {
            _this.w=1;
          }
          
        }
      },
      set :function _trc_Quaternion_set(q) {
        var _this=this;
        
        _this.x=q.x;
        _this.y=q.y;
        _this.z=q.z;
        _this.w=q.w;
        return _this;
      },
      fiber$set :function* _trc_Quaternion_f_set(_thread,q) {
        var _this=this;
        
        _this.x=q.x;
        _this.y=q.y;
        _this.z=q.z;
        _this.w=q.w;
        return _this;
        
      },
      __getter__length :function _trc_Quaternion___getter__length() {
        var _this=this;
        
        return _this.sqrt(_this.lengthSQ);
      },
      __getter__lengthSQ :function _trc_Quaternion___getter__lengthSQ() {
        var _this=this;
        
        return _this.x*_this.x+_this.y*_this.y+_this.z*_this.z+_this.w*_this.w;
      },
      clone :function _trc_Quaternion_clone() {
        var _this=this;
        
        return new Tonyu.classes.kernel.Quaternion({x: _this.x,y: _this.y,z: _this.z,w: _this.w});
      },
      fiber$clone :function* _trc_Quaternion_f_clone(_thread) {
        var _this=this;
        
        return new Tonyu.classes.kernel.Quaternion({x: _this.x,y: _this.y,z: _this.z,w: _this.w});
        
      },
      addX :function _trc_Quaternion_addX(q) {
        var _this=this;
        
        _this.x+=q.x;
        _this.y+=q.y;
        _this.z+=q.z;
        _this.w+=q.w;
        return _this;
      },
      fiber$addX :function* _trc_Quaternion_f_addX(_thread,q) {
        var _this=this;
        
        _this.x+=q.x;
        _this.y+=q.y;
        _this.z+=q.z;
        _this.w+=q.w;
        return _this;
        
      },
      add :function _trc_Quaternion_add(q) {
        var _this=this;
        
        return _this.clone().addX(q);
      },
      fiber$add :function* _trc_Quaternion_f_add(_thread,q) {
        var _this=this;
        
        return _this.clone().addX(q);
        
      },
      subX :function _trc_Quaternion_subX(q) {
        var _this=this;
        
        _this.x-=q.x;
        _this.y-=q.y;
        _this.z-=q.z;
        _this.w-=q.w;
        return _this;
      },
      fiber$subX :function* _trc_Quaternion_f_subX(_thread,q) {
        var _this=this;
        
        _this.x-=q.x;
        _this.y-=q.y;
        _this.z-=q.z;
        _this.w-=q.w;
        return _this;
        
      },
      sub :function _trc_Quaternion_sub(q) {
        var _this=this;
        
        return _this.clone().subX(q);
      },
      fiber$sub :function* _trc_Quaternion_f_sub(_thread,q) {
        var _this=this;
        
        return _this.clone().subX(q);
        
      },
      mulX :function _trc_Quaternion_mulX(k) {
        var _this=this;
        
        _this.x*=k;
        _this.y*=k;
        _this.z*=k;
        _this.w*=k;
        return _this;
      },
      fiber$mulX :function* _trc_Quaternion_f_mulX(_thread,k) {
        var _this=this;
        
        _this.x*=k;
        _this.y*=k;
        _this.z*=k;
        _this.w*=k;
        return _this;
        
      },
      mul :function _trc_Quaternion_mul(k) {
        var _this=this;
        
        return _this.clone().mulX(k);
      },
      fiber$mul :function* _trc_Quaternion_f_mul(_thread,k) {
        var _this=this;
        
        return _this.clone().mulX(k);
        
      },
      product :function _trc_Quaternion_product(b,dst) {
        var _this=this;
        var a;
        var qax;
        var qay;
        var qaz;
        var qaw;
        var qbx;
        var qby;
        var qbz;
        var qbw;
        
        a = _this;
        
        qax = a.x;
        qay = a.y;
        qaz = a.z;
        qaw = a.w;
        
        qbx = b.x;
        qby = b.y;
        qbz = b.z;
        qbw = b.w;
        
        if (! dst) {
          dst=new Tonyu.classes.kernel.Quaternion;
        }
        dst.x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;
        dst.y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;
        dst.z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;
        dst.w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;
        return dst;
      },
      fiber$product :function* _trc_Quaternion_f_product(_thread,b,dst) {
        var _this=this;
        var a;
        var qax;
        var qay;
        var qaz;
        var qaw;
        var qbx;
        var qby;
        var qbz;
        var qbw;
        
        a = _this;
        
        qax = a.x;
        qay = a.y;
        qaz = a.z;
        qaw = a.w;
        
        qbx = b.x;
        qby = b.y;
        qbz = b.z;
        qbw = b.w;
        
        if (! dst) {
          dst=new Tonyu.classes.kernel.Quaternion;
        }
        dst.x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;
        dst.y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;
        dst.z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;
        dst.w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;
        return dst;
        
      },
      __getter__inverse :function _trc_Quaternion___getter__inverse() {
        var _this=this;
        
        return _this.conjugate.mulX(1/_this.lengthSQ);
      },
      __getter__conjugate :function _trc_Quaternion___getter__conjugate() {
        var _this=this;
        
        return new Tonyu.classes.kernel.Quaternion({x: - _this.x,y: - _this.y,z: - _this.z,w: _this.w});
      },
      rotate :function _trc_Quaternion_rotate(p,dst) {
        var _this=this;
        var x;
        var y;
        var z;
        var q;
        var qx;
        var qy;
        var qz;
        var qw;
        var ix;
        var iy;
        var iz;
        var iw;
        
        x = p.x;
        y = p.y;
        z = p.z;
        
        q = _this;
        
        qx = q.x;
        qy = q.y;
        qz = q.z;
        qw = q.w;
        
        ix = qw*x+qy*z-qz*y;
        
        iy = qw*y+qz*x-qx*z;
        
        iz = qw*z+qx*y-qy*x;
        
        iw = - qx*x-qy*y-qz*z;
        
        if (! dst) {
          dst=new Tonyu.classes.kernel.Vec3;
          
        }
        dst.x=ix*qw+iw*- qx+iy*- qz-iz*- qy;
        dst.y=iy*qw+iw*- qy+iz*- qx-ix*- qz;
        dst.z=iz*qw+iw*- qz+ix*- qy-iy*- qx;
        return dst;
      },
      fiber$rotate :function* _trc_Quaternion_f_rotate(_thread,p,dst) {
        var _this=this;
        var x;
        var y;
        var z;
        var q;
        var qx;
        var qy;
        var qz;
        var qw;
        var ix;
        var iy;
        var iz;
        var iw;
        
        x = p.x;
        y = p.y;
        z = p.z;
        
        q = _this;
        
        qx = q.x;
        qy = q.y;
        qz = q.z;
        qw = q.w;
        
        ix = qw*x+qy*z-qz*y;
        
        iy = qw*y+qz*x-qx*z;
        
        iz = qw*z+qx*y-qy*x;
        
        iw = - qx*x-qy*y-qz*z;
        
        if (! dst) {
          dst=new Tonyu.classes.kernel.Vec3;
          
        }
        dst.x=ix*qw+iw*- qx+iy*- qz-iz*- qy;
        dst.y=iy*qw+iw*- qy+iz*- qx-ix*- qz;
        dst.z=iz*qw+iw*- qz+ix*- qy-iy*- qx;
        return dst;
        
      },
      calcTheta :function _trc_Quaternion_calcTheta() {
        var _this=this;
        
        _this.theta=_this.atanxy(_this.w,_this.sqrt(_this.x*_this.x+_this.y*_this.y+_this.z*_this.z));
        _this.r=_this.theta*2;
        return _this.theta;
      },
      fiber$calcTheta :function* _trc_Quaternion_f_calcTheta(_thread) {
        var _this=this;
        
        _this.theta=_this.atanxy(_this.w,_this.sqrt(_this.x*_this.x+_this.y*_this.y+_this.z*_this.z));
        _this.r=_this.theta*2;
        return _this.theta;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"set":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Quaternion"],"returnValue":null}},"__getter__length":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__lengthSQ":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clone":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"addX":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Quaternion"],"returnValue":null}},"add":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Quaternion"],"returnValue":null}},"subX":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Quaternion"],"returnValue":null}},"sub":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Quaternion"],"returnValue":null}},"mulX":{"nowait":false,"isMain":false,"vtype":{"params":["Number"],"returnValue":null}},"mul":{"nowait":false,"isMain":false,"vtype":{"params":["Number"],"returnValue":null}},"product":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Quaternion","kernel.Quaternion"],"returnValue":null}},"__getter__inverse":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__conjugate":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"rotate":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Vec3","kernel.Vec3"],"returnValue":null}},"calcTheta":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"x":{"vtype":"Number"},"y":{"vtype":"Number"},"z":{"vtype":"Number"},"w":{"vtype":"Number"},"axis":{"vtype":"kernel.Vec3"},"r":{"vtype":"Number"},"theta":{"vtype":"Number"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.RectShape',
  shortName: 'RectShape',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.AbstractShape,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_RectShape_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_RectShape_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      __getter__order :function _trc_RectShape___getter__order() {
        var _this=this;
        
        return 2;
      },
      clone :function _trc_RectShape_clone() {
        var _this=this;
        
        return new Tonyu.classes.kernel.RectShape({x: _this.x,y: _this.y,width: _this.width,height: _this.height,_layerPath: _this._layerPath});
      },
      fiber$clone :function* _trc_RectShape_f_clone(_thread) {
        var _this=this;
        
        return new Tonyu.classes.kernel.RectShape({x: _this.x,y: _this.y,width: _this.width,height: _this.height,_layerPath: _this._layerPath});
        
      },
      changeLayerPath :function _trc_RectShape_changeLayerPath(newLayerPath) {
        var _this=this;
        var c;
        var rb;
        
        c = _this.layerPath.convert({x: _this.x,y: _this.y},newLayerPath);
        
        rb = _this.layerPath.convert({x: _this.x+_this.width,y: _this.y+_this.height},newLayerPath);
        
        _this.x=c.x;
        _this.y=c.y;
        _this.width=(rb.x-c.x);
        _this.height=(rb.y-c.y);
        _this._layerPath=newLayerPath;
      },
      fiber$changeLayerPath :function* _trc_RectShape_f_changeLayerPath(_thread,newLayerPath) {
        var _this=this;
        var c;
        var rb;
        
        c = _this.layerPath.convert({x: _this.x,y: _this.y},newLayerPath);
        
        rb = _this.layerPath.convert({x: _this.x+_this.width,y: _this.y+_this.height},newLayerPath);
        
        _this.x=c.x;
        _this.y=c.y;
        _this.width=(rb.x-c.x);
        _this.height=(rb.y-c.y);
        _this._layerPath=newLayerPath;
        
      },
      intersectsRaw :function _trc_RectShape_intersectsRaw(s) {
        var _this=this;
        
        if (Tonyu.is(s,Tonyu.classes.kernel.RectShape)) {
          return Math.abs(_this.x-s.x)*2<_this.width+s.width&&Math.abs(_this.y-s.y)*2<_this.height+s.height;
          
        }
        return __superClass.prototype.intersectsRaw.apply( _this, [s]);
      },
      fiber$intersectsRaw :function* _trc_RectShape_f_intersectsRaw(_thread,s) {
        var _this=this;
        
        if (Tonyu.is(s,Tonyu.classes.kernel.RectShape)) {
          return Math.abs(_this.x-s.x)*2<_this.width+s.width&&Math.abs(_this.y-s.y)*2<_this.height+s.height;
          
        }
        return __superClass.prototype.intersectsRaw.apply( _this, [s]);
        
      },
      containsRaw :function _trc_RectShape_containsRaw(p) {
        var _this=this;
        
        return p.x>=_this.xmin&&p.x<=_this.xmax&&p.y>=_this.ymin&&p.y<=_this.ymax;
      },
      fiber$containsRaw :function* _trc_RectShape_f_containsRaw(_thread,p) {
        var _this=this;
        
        return p.x>=_this.xmin&&p.x<=_this.xmax&&p.y>=_this.ymin&&p.y<=_this.ymax;
        
      },
      __getter__xmin :function _trc_RectShape___getter__xmin() {
        var _this=this;
        
        return _this.x-_this.width/2;
      },
      __getter__xmax :function _trc_RectShape___getter__xmax() {
        var _this=this;
        
        return _this.x+_this.width/2;
      },
      __getter__ymin :function _trc_RectShape___getter__ymin() {
        var _this=this;
        
        return _this.y-_this.height/2;
      },
      __getter__ymax :function _trc_RectShape___getter__ymax() {
        var _this=this;
        
        return _this.y+_this.height/2;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"__getter__order":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clone":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"changeLayerPath":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"intersectsRaw":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.RectShape"],"returnValue":null}},"containsRaw":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__xmin":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__xmax":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__ymin":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__ymax":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"x":{},"y":{},"width":{},"height":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Transform',
  shortName: 'Transform',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Transform_main() {
        var _this=this;
        
        "field strict";
        
        
        
        
        
      },
      fiber$main :function* _trc_Transform_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        
      },
      _static :function _trc_Transform__static() {
        var _this=this;
        
        if (! Tonyu.classes.kernel.Transform._static) {
          Tonyu.classes.kernel.Transform._static=true;
          Tonyu.classes.kernel.Transform.IDSEQ=1;
          Tonyu.classes.kernel.Transform.root=new Tonyu.classes.kernel.Transform;
          
        }
      },
      fiber$_static :function* _trc_Transform_f__static(_thread) {
        var _this=this;
        
        if (! Tonyu.classes.kernel.Transform._static) {
          Tonyu.classes.kernel.Transform._static=true;
          Tonyu.classes.kernel.Transform.IDSEQ=1;
          Tonyu.classes.kernel.Transform.root=new Tonyu.classes.kernel.Transform;
          
        }
        
      },
      __setter__parent :function _trc_Transform___setter__parent(p) {
        var _this=this;
        
        if (_this._parent===p) {
          return _this;
        }
        _this._parent=p;
      },
      __getter__parent :function _trc_Transform___getter__parent() {
        var _this=this;
        
        return _this._parent;
      },
      __getter__quaternion :function _trc_Transform___getter__quaternion() {
        var _this=this;
        
        return _this.direction.quaternion;
      },
      initialize :function _trc_Transform_initialize(param) {
        var _this=this;
        
        _this._static();
        __superClass.apply( _this, [param]);
        _this.id=Tonyu.classes.kernel.Transform.IDSEQ++;
        _this.scale=_this.scale||1;
        _this.direction=_this.direction||new Tonyu.classes.kernel.Direction;
        _this.position=_this.position||new Tonyu.classes.kernel.Vec3(0,0,0);
      },
      child :function _trc_Transform_child(param) {
        var _this=this;
        
        param.parent=_this;
        return new Tonyu.classes.kernel.Transform(param);
      },
      fiber$child :function* _trc_Transform_f_child(_thread,param) {
        var _this=this;
        
        param.parent=_this;
        return new Tonyu.classes.kernel.Transform(param);
        
      },
      __getter__isRoot :function _trc_Transform___getter__isRoot() {
        var _this=this;
        
        return _this===Tonyu.classes.kernel.Transform.root;
      },
      clone :function _trc_Transform_clone() {
        var _this=this;
        
        return new Tonyu.classes.kernel.Transform().set(_this);
      },
      fiber$clone :function* _trc_Transform_f_clone(_thread) {
        var _this=this;
        
        return new Tonyu.classes.kernel.Transform().set(_this);
        
      },
      set :function _trc_Transform_set(t) {
        var _this=this;
        
        _this.position.set(t.position);
        _this.direction.set(t.direction);
        _this.scale=t.scale;
        _this._parent=t.parent;
        return _this;
      },
      fiber$set :function* _trc_Transform_f_set(_thread,t) {
        var _this=this;
        
        _this.position.set(t.position);
        _this.direction.set(t.direction);
        _this.scale=t.scale;
        _this._parent=t.parent;
        return _this;
        
      },
      product :function _trc_Transform_product(t,dst) {
        var _this=this;
        var writeToThis;
        
        
        if (dst===_this) {
          writeToThis=true;
          dst=false;
          
        }
        if (! dst) {
          dst=new Tonyu.classes.kernel.Transform;
        }
        _this.quaternion.product(t.quaternion,dst.quaternion);
        dst.scale=_this.scale*t.scale;
        _this.localToWorld(t.position,dst.position);
        if (writeToThis) {
          _this.set(dst);
          return _this;
          
        }
        return dst;
      },
      fiber$product :function* _trc_Transform_f_product(_thread,t,dst) {
        var _this=this;
        var writeToThis;
        
        
        if (dst===_this) {
          writeToThis=true;
          dst=false;
          
        }
        if (! dst) {
          dst=new Tonyu.classes.kernel.Transform;
        }
        _this.quaternion.product(t.quaternion,dst.quaternion);
        dst.scale=_this.scale*t.scale;
        (yield* _this.fiber$localToWorld(_thread, t.position, dst.position));
        if (writeToThis) {
          (yield* _this.fiber$set(_thread, dst));
          return _this;
          
        }
        return dst;
        
      },
      parentChanged :function _trc_Transform_parentChanged(to,dst) {
        var _this=this;
        var p;
        
        p = new Tonyu.classes.kernel.ParentChanger(to);
        
        return p.change(_this,dst);
      },
      fiber$parentChanged :function* _trc_Transform_f_parentChanged(_thread,to,dst) {
        var _this=this;
        var p;
        
        p = new Tonyu.classes.kernel.ParentChanger(to);
        
        return p.change(_this,dst);
        
      },
      changeParent :function _trc_Transform_changeParent(to) {
        var _this=this;
        var c;
        
        c = _this.parentChanged(to);
        
        return _this.set(c);
      },
      fiber$changeParent :function* _trc_Transform_f_changeParent(_thread,to) {
        var _this=this;
        var c;
        
        c=yield* _this.fiber$parentChanged(_thread, to);
        
        return yield* _this.fiber$set(_thread, c);
        
        
      },
      localToWorld :function _trc_Transform_localToWorld(local,dst) {
        var _this=this;
        
        return _this.childToSibling(local,dst);
      },
      fiber$localToWorld :function* _trc_Transform_f_localToWorld(_thread,local,dst) {
        var _this=this;
        
        return yield* _this.fiber$childToSibling(_thread, local, dst);
        
        
      },
      childToSibling :function _trc_Transform_childToSibling(child,dst) {
        var _this=this;
        var res;
        
        if (Tonyu.is(child,Tonyu.classes.kernel.Transform)) {
          res = _this.product(child,dst);
          
          res._parent=_this.parent;
          return res;
          
        }
        dst=_this.direction.localToWorld(child,dst);
        dst.mulX(_this.scale);
        dst.addX_v(_this.position);
        return dst;
      },
      fiber$childToSibling :function* _trc_Transform_f_childToSibling(_thread,child,dst) {
        var _this=this;
        var res;
        
        if (Tonyu.is(child,Tonyu.classes.kernel.Transform)) {
          res=yield* _this.fiber$product(_thread, child, dst);
          
          res._parent=_this.parent;
          return res;
          
        }
        dst=_this.direction.localToWorld(child,dst);
        dst.mulX(_this.scale);
        dst.addX_v(_this.position);
        return dst;
        
      },
      worldToLocal :function _trc_Transform_worldToLocal(local,dst) {
        var _this=this;
        
        return _this.siblingToChild(local,dst);
      },
      fiber$worldToLocal :function* _trc_Transform_f_worldToLocal(_thread,local,dst) {
        var _this=this;
        
        return yield* _this.fiber$siblingToChild(_thread, local, dst);
        
        
      },
      siblingToChild :function _trc_Transform_siblingToChild(sibling,dst) {
        var _this=this;
        var copyToSibling;
        
        
        if (Tonyu.is(sibling,Tonyu.classes.kernel.Transform)) {
          if (dst===sibling) {
            copyToSibling=true;
            dst=null;
            
          }
          if (! dst) {
            dst=new Tonyu.classes.kernel.Transform;
          }
          _this.siblingToChild(sibling.position,dst.position);
          _this.quaternion.inverse.product(sibling.quaternion,dst.quaternion);
          dst.scale=sibling.scale/_this.scale;
          dst._parent=_this;
          if (copyToSibling) {
            sibling.set(dst);
            return sibling;
            
          }
          return dst;
          
        }
        if (! dst) {
          dst=new Tonyu.classes.kernel.Vec3(0,0,0);
        }
        dst.set(sibling);
        dst.subX_v(_this.position);
        _this.direction.worldToLocal(dst,dst);
        dst.divX(_this.scale);
        return dst;
      },
      fiber$siblingToChild :function* _trc_Transform_f_siblingToChild(_thread,sibling,dst) {
        var _this=this;
        var copyToSibling;
        
        
        if (Tonyu.is(sibling,Tonyu.classes.kernel.Transform)) {
          if (dst===sibling) {
            copyToSibling=true;
            dst=null;
            
          }
          if (! dst) {
            dst=new Tonyu.classes.kernel.Transform;
          }
          (yield* _this.fiber$siblingToChild(_thread, sibling.position, dst.position));
          _this.quaternion.inverse.product(sibling.quaternion,dst.quaternion);
          dst.scale=sibling.scale/_this.scale;
          dst._parent=_this;
          if (copyToSibling) {
            sibling.set(dst);
            return sibling;
            
          }
          return dst;
          
        }
        if (! dst) {
          dst=new Tonyu.classes.kernel.Vec3(0,0,0);
        }
        dst.set(sibling);
        dst.subX_v(_this.position);
        _this.direction.worldToLocal(dst,dst);
        dst.divX(_this.scale);
        return dst;
        
      },
      changeScale :function _trc_Transform_changeScale(vec,by) {
        var _this=this;
        
        return vec.mulX(by);
      },
      fiber$changeScale :function* _trc_Transform_f_changeScale(_thread,vec,by) {
        var _this=this;
        
        return vec.mulX(by);
        
      },
      isSibling :function _trc_Transform_isSibling(sib) {
        var _this=this;
        
        return sib.parent===_this.parent;
      },
      fiber$isSibling :function* _trc_Transform_f_isSibling(_thread,sib) {
        var _this=this;
        
        return sib.parent===_this.parent;
        
      },
      isParentOf :function _trc_Transform_isParentOf(child) {
        var _this=this;
        
        return child.parent===_this;
      },
      fiber$isParentOf :function* _trc_Transform_f_isParentOf(_thread,child) {
        var _this=this;
        
        return child.parent===_this;
        
      },
      isChildOf :function _trc_Transform_isChildOf(parent) {
        var _this=this;
        
        return _this.parent===parent;
      },
      fiber$isChildOf :function* _trc_Transform_f_isChildOf(_thread,parent) {
        var _this=this;
        
        return _this.parent===parent;
        
      },
      __getter__inverse :function _trc_Transform___getter__inverse() {
        var _this=this;
        
        return _this.siblingToChild(new Tonyu.classes.kernel.Transform());
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"_static":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__parent":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__parent":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__quaternion":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"child":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__isRoot":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clone":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"set":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Transform"],"returnValue":null}},"product":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Transform","kernel.Transform"],"returnValue":null}},"parentChanged":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Transform","kernel.Transform"],"returnValue":null}},"changeParent":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Transform"],"returnValue":null}},"localToWorld":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"childToSibling":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"worldToLocal":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"siblingToChild":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"changeScale":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"isSibling":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"isParentOf":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"isChildOf":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__inverse":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"actor":{"vtype":"kernel.Actor3D"},"_parent":{"vtype":"kernel.Transform"},"direction":{},"position":{},"scale":{},"id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Transform2D',
  shortName: 'Transform2D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Transform2D_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_Transform2D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initialize :function _trc_Transform2D_initialize(actor) {
        var _this=this;
        
        _this.actor=actor;
      },
      __getter__position :function _trc_Transform2D___getter__position() {
        var _this=this;
        
        return _this.actor.position;
      },
      __getter__scale :function _trc_Transform2D___getter__scale() {
        var _this=this;
        var x;
        var y;
        
        x = _this.actor.scaleX;
        y = _this.actor.scaleY;
        
        x=(typeof  x==="number"&&x==x)?x:1;
        y=(typeof  y==="number"&&y==y)?y:x;
        return {x: x,y: y};
      },
      __getter__rotation :function _trc_Transform2D___getter__rotation() {
        var _this=this;
        
        return _this.actor.rotation;
      },
      __getter__base :function _trc_Transform2D___getter__base() {
        var _this=this;
        var s;
        
        s = _this.scale;
        
        return {x: new Tonyu.classes.kernel.Vec3(_this.cos(_this.rotation)*s.x,_this.sin(_this.rotation)*s.x),y: new Tonyu.classes.kernel.Vec3(_this.cos(_this.rotation+90)*s.y,_this.sin(_this.rotation+90)*s.y)};
      },
      localToWorld :function _trc_Transform2D_localToWorld(pos) {
        var _this=this;
        var b;
        
        b = _this.base;
        
        return b.x.mul(pos.x).addX(b.y.mul(pos.y)).addX(_this.position);
      },
      fiber$localToWorld :function* _trc_Transform2D_f_localToWorld(_thread,pos) {
        var _this=this;
        var b;
        
        b = _this.base;
        
        return b.x.mul(pos.x).addX(b.y.mul(pos.y)).addX(_this.position);
        
      },
      worldToLocal :function _trc_Transform2D_worldToLocal(pos) {
        var _this=this;
        var b;
        var det;
        
        b = _this.base;
        
        pos.z=pos.z||0;
        pos=_this.position.mul(- 1).addX(pos);
        det = b.x.x*b.y.y-b.y.x*b.x.y;
        
        return new Tonyu.classes.kernel.Vec3(b.y.y*pos.x-b.y.x*pos.y,- b.x.y*pos.x+b.x.x*pos.y).divX(det);
      },
      fiber$worldToLocal :function* _trc_Transform2D_f_worldToLocal(_thread,pos) {
        var _this=this;
        var b;
        var det;
        
        b = _this.base;
        
        pos.z=pos.z||0;
        pos=_this.position.mul(- 1).addX(pos);
        det = b.x.x*b.y.y-b.y.x*b.x.y;
        
        return new Tonyu.classes.kernel.Vec3(b.y.y*pos.x-b.y.x*pos.y,- b.x.y*pos.x+b.x.x*pos.y).divX(det);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Actor"],"returnValue":null}},"__getter__position":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__scale":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__rotation":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__base":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"localToWorld":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"worldToLocal":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"actor":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Vec3',
  shortName: 'Vec3',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Vec3_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_Vec3_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_Vec3_initialize(x,y,z) {
        var _this=this;
        
        if (typeof  x==="object") {
          z=x.z;
          y=x.y;
          x=x.x;
          
        }
        _this.x=(typeof  x==="number")?x:0;
        _this.y=(typeof  y==="number")?y:0;
        _this.z=(typeof  z==="number")?z:0;
      },
      checkNum :function _trc_Vec3_checkNum(o) {
        var _this=this;
        var name;
        var val;
        
        for ([name, val] of Tonyu.iterator2(o,2)) {
          if (typeof  val!=="number") {
            throw new Error(name+"("+val+")は数値ではありません．");
            
            
          }
          
        }
      },
      fiber$checkNum :function* _trc_Vec3_f_checkNum(_thread,o) {
        var _this=this;
        var name;
        var val;
        
        for ([name, val] of Tonyu.iterator2(o,2)) {
          if (typeof  val!=="number") {
            throw new Error(name+"("+val+")は数値ではありません．");
            
            
          }
          
        }
        
      },
      parsePointArgs :function _trc_Vec3_parsePointArgs(args) {
        var _this=this;
        var a;
        var p;
        
        a = new Tonyu.classes.kernel.ArgParser(args);
        
        p = a.shift(Object);
        
        if (! p) {
          p={};
          p.x=a.shift();
          p.y=a.shift();
          p.z=a.shift();
          
        }
        if (typeof  p.z!=="number"||p.z!==p.z) {
          p.z=0;
          
        }
        return p;
      },
      fiber$parsePointArgs :function* _trc_Vec3_f_parsePointArgs(_thread,args) {
        var _this=this;
        var a;
        var p;
        
        a = new Tonyu.classes.kernel.ArgParser(args);
        
        p = a.shift(Object);
        
        if (! p) {
          p={};
          p.x=a.shift();
          p.y=a.shift();
          p.z=a.shift();
          
        }
        if (typeof  p.z!=="number"||p.z!==p.z) {
          p.z=0;
          
        }
        return p;
        
      },
      addX :function _trc_Vec3_addX() {
        var _this=this;
        var p;
        
        p = _this.parsePointArgs(arguments);
        
        _this.x+=p.x;
        _this.y+=p.y;
        _this.z+=p.z;
        return _this;
      },
      fiber$addX :function* _trc_Vec3_f_addX(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var p;
        
        p=yield* _this.fiber$parsePointArgs(_thread, _arguments);
        
        _this.x+=p.x;
        _this.y+=p.y;
        _this.z+=p.z;
        return _this;
        
      },
      addX_v :function _trc_Vec3_addX_v(p) {
        var _this=this;
        
        _this.x+=p.x;
        _this.y+=p.y;
        _this.z+=p.z;
        return _this;
      },
      fiber$addX_v :function* _trc_Vec3_f_addX_v(_thread,p) {
        var _this=this;
        
        _this.x+=p.x;
        _this.y+=p.y;
        _this.z+=p.z;
        return _this;
        
      },
      subX :function _trc_Vec3_subX() {
        var _this=this;
        var p;
        
        p = _this.parsePointArgs(arguments);
        
        _this.x-=p.x;
        _this.y-=p.y;
        _this.z-=p.z;
        return _this;
      },
      fiber$subX :function* _trc_Vec3_f_subX(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var p;
        
        p=yield* _this.fiber$parsePointArgs(_thread, _arguments);
        
        _this.x-=p.x;
        _this.y-=p.y;
        _this.z-=p.z;
        return _this;
        
      },
      subX_v :function _trc_Vec3_subX_v(p) {
        var _this=this;
        
        _this.x-=p.x;
        _this.y-=p.y;
        _this.z-=p.z;
        return _this;
      },
      fiber$subX_v :function* _trc_Vec3_f_subX_v(_thread,p) {
        var _this=this;
        
        _this.x-=p.x;
        _this.y-=p.y;
        _this.z-=p.z;
        return _this;
        
      },
      mulX :function _trc_Vec3_mulX(k) {
        var _this=this;
        
        _this.x=_this.x*k;
        _this.y=_this.y*k;
        _this.z=_this.z*k;
        return _this;
      },
      fiber$mulX :function* _trc_Vec3_f_mulX(_thread,k) {
        var _this=this;
        
        _this.x=_this.x*k;
        _this.y=_this.y*k;
        _this.z=_this.z*k;
        return _this;
        
      },
      divX :function _trc_Vec3_divX(k) {
        var _this=this;
        
        _this.x=_this.x/k;
        _this.y=_this.y/k;
        _this.z=_this.z/k;
        return _this;
      },
      fiber$divX :function* _trc_Vec3_f_divX(_thread,k) {
        var _this=this;
        
        _this.x=_this.x/k;
        _this.y=_this.y/k;
        _this.z=_this.z/k;
        return _this;
        
      },
      add :function _trc_Vec3_add(x,y,z) {
        var _this=this;
        
        return _this.clone().addX(x,y,z);
      },
      fiber$add :function* _trc_Vec3_f_add(_thread,x,y,z) {
        var _this=this;
        
        return _this.clone().addX(x,y,z);
        
      },
      sub :function _trc_Vec3_sub(x,y,z) {
        var _this=this;
        
        return _this.clone().subX(x,y,z);
      },
      fiber$sub :function* _trc_Vec3_f_sub(_thread,x,y,z) {
        var _this=this;
        
        return _this.clone().subX(x,y,z);
        
      },
      mul :function _trc_Vec3_mul(k) {
        var _this=this;
        
        return _this.clone().mulX(k);
      },
      fiber$mul :function* _trc_Vec3_f_mul(_thread,k) {
        var _this=this;
        
        return _this.clone().mulX(k);
        
      },
      div :function _trc_Vec3_div(k) {
        var _this=this;
        
        return _this.clone().divX(k);
      },
      fiber$div :function* _trc_Vec3_f_div(_thread,k) {
        var _this=this;
        
        return _this.clone().divX(k);
        
      },
      clone :function _trc_Vec3_clone() {
        var _this=this;
        
        return new Tonyu.classes.kernel.Vec3(_this.x,_this.y,_this.z);
      },
      fiber$clone :function* _trc_Vec3_f_clone(_thread) {
        var _this=this;
        
        return new Tonyu.classes.kernel.Vec3(_this.x,_this.y,_this.z);
        
      },
      set :function _trc_Vec3_set() {
        var _this=this;
        var p;
        
        p = _this.parsePointArgs(arguments);
        
        _this.x=p.x;
        _this.y=p.y;
        _this.z=p.z;
        return _this;
      },
      fiber$set :function* _trc_Vec3_f_set(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var p;
        
        p=yield* _this.fiber$parsePointArgs(_thread, _arguments);
        
        _this.x=p.x;
        _this.y=p.y;
        _this.z=p.z;
        return _this;
        
      },
      setTo :function _trc_Vec3_setTo(t) {
        var _this=this;
        
        t.x=_this.x;
        t.y=_this.y;
        t.z=_this.z;
      },
      fiber$setTo :function* _trc_Vec3_f_setTo(_thread,t) {
        var _this=this;
        
        t.x=_this.x;
        t.y=_this.y;
        t.z=_this.z;
        
      },
      addTo :function _trc_Vec3_addTo(t) {
        var _this=this;
        
        t.x+=_this.x;
        t.y+=_this.y;
        t.z+=_this.z;
      },
      fiber$addTo :function* _trc_Vec3_f_addTo(_thread,t) {
        var _this=this;
        
        t.x+=_this.x;
        t.y+=_this.y;
        t.z+=_this.z;
        
      },
      dist :function _trc_Vec3_dist(vec) {
        var _this=this;
        var dx;
        var dy;
        var dz;
        
        if (vec) {
          dx = vec.x-_this.x;
          
          dy = vec.y-_this.y;
          
          dz = vec.z-_this.z;
          
          return _this.sqrt(dx*dx+dy*dy+dz*dz);
          
        }
        return _this.sqrt(_this.x*_this.x+_this.y*_this.y+_this.z*_this.z);
      },
      __getter__length :function _trc_Vec3___getter__length() {
        var _this=this;
        
        return _this.sqrt(_this.x*_this.x+_this.y*_this.y+_this.z*_this.z);
      },
      __setter__length :function _trc_Vec3___setter__length(l) {
        var _this=this;
        
        return _this.normalizeX(l);
      },
      lerp :function _trc_Vec3_lerp(to,t) {
        var _this=this;
        
        return _this.mul(1-t).addX_v(to.mul(t));
      },
      fiber$lerp :function* _trc_Vec3_f_lerp(_thread,to,t) {
        var _this=this;
        
        return _this.mul(1-t).addX_v(to.mul(t));
        
      },
      slerp :function _trc_Vec3_slerp(to,t) {
        var _this=this;
        
        return _this.mul(1-t).addX_v(to.mul(t));
      },
      fiber$slerp :function* _trc_Vec3_f_slerp(_thread,to,t) {
        var _this=this;
        
        return _this.mul(1-t).addX_v(to.mul(t));
        
      },
      normalizeX :function _trc_Vec3_normalizeX(len) {
        var _this=this;
        var l;
        
        l = _this.length;
        
        if (l==0) {
          return _this;
        }
        len=(typeof  len==="number")?len:1;
        _this.x*=len/l;
        _this.y*=len/l;
        _this.z*=len/l;
        return _this;
      },
      fiber$normalizeX :function* _trc_Vec3_f_normalizeX(_thread,len) {
        var _this=this;
        var l;
        
        l = _this.length;
        
        if (l==0) {
          return _this;
        }
        len=(typeof  len==="number")?len:1;
        _this.x*=len/l;
        _this.y*=len/l;
        _this.z*=len/l;
        return _this;
        
      },
      normalize :function _trc_Vec3_normalize(len) {
        var _this=this;
        
        return _this.clone().normalizeX(len);
      },
      fiber$normalize :function* _trc_Vec3_f_normalize(_thread,len) {
        var _this=this;
        
        return _this.clone().normalizeX(len);
        
      },
      productX :function _trc_Vec3_productX() {
        var _this=this;
        var a;
        var b;
        var i;
        var j;
        var k;
        
        a = _this;
        
        b = _this.parsePointArgs(arguments);
        
        i = a.y*b.z-a.z*b.y;
        
        j = a.z*b.x-a.x*b.z;
        
        k = a.x*b.y-a.y*b.x;
        
        a.x=i;
        a.y=j;
        a.z=k;
        if (Tonyu.globals.$fixProductOrder) {
          return a;
        }
        return a.mul(- 1);
      },
      fiber$productX :function* _trc_Vec3_f_productX(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var a;
        var b;
        var i;
        var j;
        var k;
        
        a = _this;
        
        b=yield* _this.fiber$parsePointArgs(_thread, _arguments);
        
        i = a.y*b.z-a.z*b.y;
        
        j = a.z*b.x-a.x*b.z;
        
        k = a.x*b.y-a.y*b.x;
        
        a.x=i;
        a.y=j;
        a.z=k;
        if (Tonyu.globals.$fixProductOrder) {
          return a;
        }
        return a.mul(- 1);
        
      },
      product :function _trc_Vec3_product(x,y,z) {
        var _this=this;
        
        return _this.clone().productX(x,y,z);
      },
      fiber$product :function* _trc_Vec3_f_product(_thread,x,y,z) {
        var _this=this;
        
        return _this.clone().productX(x,y,z);
        
      },
      innerProduct :function _trc_Vec3_innerProduct() {
        var _this=this;
        var a;
        
        a = _this.parsePointArgs(arguments);
        
        return _this.x*a.x+_this.y*a.y+_this.z*a.z;
      },
      fiber$innerProduct :function* _trc_Vec3_f_innerProduct(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var a;
        
        a=yield* _this.fiber$parsePointArgs(_thread, _arguments);
        
        return _this.x*a.x+_this.y*a.y+_this.z*a.z;
        
      },
      __getter__angleXY :function _trc_Vec3___getter__angleXY() {
        var _this=this;
        
        return _this.atanxy(_this.x,_this.y);
      },
      __setter__angleXY :function _trc_Vec3___setter__angleXY(a) {
        var _this=this;
        var l;
        
        l = Tonyu.globals.$Math.sqrt(_this.x*_this.x+_this.y*_this.y);
        
        _this.x=_this.cos(a)*l;
        _this.y=_this.sin(a)*l;
        return a;
      },
      rotate :function _trc_Vec3_rotate(angle,axis) {
        var _this=this;
        var v90;
        
        if (! axis) {
          axis=new Tonyu.classes.kernel.Vec3(0,0,Tonyu.globals.$fixProductOrder?- 1:1);
        }
        v90 = _this.product(axis);
        
        v90.length=_this.length;
        return _this.mul(_this.cos(angle)).add(v90.mul(_this.sin(angle)));
      },
      fiber$rotate :function* _trc_Vec3_f_rotate(_thread,angle,axis) {
        var _this=this;
        var v90;
        
        if (! axis) {
          axis=new Tonyu.classes.kernel.Vec3(0,0,Tonyu.globals.$fixProductOrder?- 1:1);
        }
        v90=yield* _this.fiber$product(_thread, axis);
        
        v90.length=_this.length;
        return _this.mul(_this.cos(angle)).add(v90.mul(_this.sin(angle)));
        
      },
      rotateX :function _trc_Vec3_rotateX(angle,axis) {
        var _this=this;
        
        return _this.set(_this.rotate(angle,axis));
      },
      fiber$rotateX :function* _trc_Vec3_f_rotateX(_thread,angle,axis) {
        var _this=this;
        
        return yield* _this.fiber$set(_thread, _this.rotate(angle,axis));
        
        
      },
      toString :function _trc_Vec3_toString() {
        var _this=this;
        
        return "("+[_this.x,_this.y,_this.z].join(",")+")";
      },
      fiber$toString :function* _trc_Vec3_f_toString(_thread) {
        var _this=this;
        
        return "("+[_this.x,_this.y,_this.z].join(",")+")";
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"checkNum":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"parsePointArgs":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"addX":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"addX_v":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Vec3"],"returnValue":null}},"subX":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"subX_v":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"mulX":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"divX":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"add":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"sub":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"mul":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"div":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"clone":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"set":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setTo":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"addTo":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"dist":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__length":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__length":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"lerp":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"slerp":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"normalizeX":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"normalize":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"productX":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"product":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"innerProduct":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__angleXY":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__angleXY":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"rotate":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"rotateX":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"toString":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"x":{},"y":{},"z":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Vec3View',
  shortName: 'Vec3View',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Vec3,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Vec3View_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_Vec3View_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_Vec3View_initialize(target,attrs) {
        var _this=this;
        
        _this.target=target;
        _this.attrs=attrs||{x: "x",y: "y",z: "z"};
      },
      __getter__x :function _trc_Vec3View___getter__x() {
        var _this=this;
        
        return _this.target[_this.attrs.x]||0;
      },
      __getter__y :function _trc_Vec3View___getter__y() {
        var _this=this;
        
        return _this.target[_this.attrs.y]||0;
      },
      __getter__z :function _trc_Vec3View___getter__z() {
        var _this=this;
        
        return _this.target[_this.attrs.z]||0;
      },
      __setter__x :function _trc_Vec3View___setter__x(v) {
        var _this=this;
        
        return _this.target[_this.attrs.x]=v;
      },
      __setter__y :function _trc_Vec3View___setter__y(v) {
        var _this=this;
        
        return _this.target[_this.attrs.y]=v;
      },
      __setter__z :function _trc_Vec3View___setter__z(v) {
        var _this=this;
        
        return _this.target[_this.attrs.z]=v;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"__getter__x":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__y":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__z":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__x":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__y":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__z":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"target":{},"attrs":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ActorTouch',
  shortName: 'ActorTouch',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.EventHandler,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ActorTouch_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_ActorTouch_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      newListener :function _trc_ActorTouch_newListener(...args) {
        var _this=this;
        var ts;
        
        let screen;
        if (Tonyu.is(args[0],Tonyu.classes.kernel.Screen)) {
          screen=args[0];
        } else {
          screen=_this.defaultScreen()||Tonyu.globals.$Screen;
        }
        ts = screen.getMultiLayerTouches();
        
        ts.add(_this.target);
        return {dispose: (function anonymous_286() {
          
          ts.remove(_this.target);
        })};
      },
      defaultScreen :function _trc_ActorTouch_defaultScreen() {
        var _this=this;
        
        let dp = _this.target.layer.defaultLayerPath;
        
        if (! dp) {
          return null;
        }
        let p = dp.closest(Tonyu.classes.kernel.Screen);
        
        if (! p) {
          return null;
        }
        return p.target;
      },
      fiber$defaultScreen :function* _trc_ActorTouch_f_defaultScreen(_thread) {
        var _this=this;
        
        let dp = _this.target.layer.defaultLayerPath;
        
        if (! dp) {
          return null;
        }
        let p = dp.closest(Tonyu.classes.kernel.Screen);
        
        if (! p) {
          return null;
        }
        return p.target;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"newListener":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"defaultScreen":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"target":{"vtype":"kernel.Actor"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Align2D',
  shortName: 'Align2D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Align2D_main() {
        var _this=this;
        
        "field strict";
        
        
        
      },
      fiber$main :function* _trc_Align2D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
      },
      initialize :function _trc_Align2D_initialize() {
        var _this=this;
        var params;
        var p;
        
        
        if (arguments.length>=2) {
          params=Array.prototype.slice.call(arguments);
        } else {
          params=arguments[0];
        }
        params=params||["center","middle"];
        
        switch (typeof  params) {
        case "string":
          params=params.split(/[ ,]+/).map((function anonymous_446(s) {
            var n;
            
            n = s-0;
            
            if (n===n) {
              return n;
            }
            return s;
          }));
        case "object":
          if (typeof  params.shift==="function") {
            while (params.length) {
              p=params.shift();
              switch (typeof  p) {
              case "string":
                if (_this.h==null) {
                  _this.h=p;
                } else {
                  _this.v=p;
                }
                break;
                
              case "number":
                _this.offset=_this.offset||{};
                if (_this.offset.x==null) {
                  _this.offset.x=p;
                } else {
                  _this.offset.y=p;
                }
                break;
                
              case "object":
                if (_this.h==null) {
                  _this.h=p.h||p[0];
                  _this.v=p.v||p[1];
                  
                } else {
                  _this.offset=_this.offset||{};
                  _this.offset.x=p.x||p[0];
                  _this.offset.y=p.y||p[1];
                  
                }
                break;
                
              }
              
            }
            
          } else {
            _this.h=params.h;
            _this.v=params.v;
            _this.offset=params.offset||params.ofs;
            if (typeof  _this.offset.shift==="function") {
              _this.offset.x=_this.offset[0]||0;
              _this.offset.y=_this.offset[1]||0;
              
            }
            if (! _this.offset) {
              _this.offset=_this.offset||{};
              _this.offset.x=params.offsetX||params.ofsX||params.ox||params.x;
              _this.offset.y=params.offsetY||params.ofsY||params.oy||params.y;
              
            }
            
          }
          break;
          
        }
        _this.h=_this.h||"center";
        _this.v=_this.v||"default";
        _this.offset=_this.offset||{};
        _this.offset.x=_this.offset.x||0;
        _this.offset.y=_this.offset.y||0;
        if (_this.v=="center") {
          _this.v="middle";
        }
      },
      __getter__isOriginPivot :function _trc_Align2D___getter__isOriginPivot() {
        var _this=this;
        
        return _this.h=="center"&&(_this.v=="middle"||_this.v=="default")&&_this.offset.x==0&&_this.offset.y==0;
      },
      getDrawRect :function _trc_Align2D_getDrawRect(obj) {
        var _this=this;
        var width;
        var height;
        var res;
        
        width = obj.width;
        
        height = obj.height;
        
        res = {x: - _this.offset.x,y: - _this.offset.y,width: width,height: height};
        
        switch (_this.h) {
        case "left":
          res.x+=res.width/2;
          break;
          
        case "right":
          res.x-=res.width/2;
          break;
          
        }
        switch (_this.v) {
        case "top":
          res.y+=res.height/2;
          break;
          
        case "bottom":
          res.y-=res.height/2;
          break;
          
        }
        return res;
      },
      fiber$getDrawRect :function* _trc_Align2D_f_getDrawRect(_thread,obj) {
        var _this=this;
        var width;
        var height;
        var res;
        
        width = obj.width;
        
        height = obj.height;
        
        res = {x: - _this.offset.x,y: - _this.offset.y,width: width,height: height};
        
        switch (_this.h) {
        case "left":
          res.x+=res.width/2;
          break;
          
        case "right":
          res.x-=res.width/2;
          break;
          
        }
        switch (_this.v) {
        case "top":
          res.y+=res.height/2;
          break;
          
        case "bottom":
          res.y-=res.height/2;
          break;
          
        }
        return res;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__isOriginPivot":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getDrawRect":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"h":{},"v":{},"offset":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.AnimMod',
  shortName: 'AnimMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.SpriteMod,Tonyu.classes.kernel.SchedulerMod,Tonyu.classes.kernel.ParallelMod],
  methods: function (__superClass) {
    return {
      main :function _trc_AnimMod_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_AnimMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initAnimMod :function _trc_AnimMod_initAnimMod() {
        var _this=this;
        
        if (_this.anim instanceof Array) {
          _this.startAnim();
          
        } else {
          _this.animMode=false;
          
        }
        if (_this.animFps==null) {
          _this.animFps=1;
        }
      },
      fiber$initAnimMod :function* _trc_AnimMod_f_initAnimMod(_thread) {
        var _this=this;
        
        if (_this.anim instanceof Array) {
          _this.startAnim();
          
        } else {
          _this.animMode=false;
          
        }
        if (_this.animFps==null) {
          _this.animFps=1;
        }
        
      },
      setAnimFps :function _trc_AnimMod_setAnimFps(f) {
        var _this=this;
        
        _this.animFps=f;
        _this.animFrame=0;
        _this.startAnim();
      },
      startAnim :function _trc_AnimMod_startAnim() {
        var _this=this;
        
        if (! _this.animMode) {
          _this.animMode=_this.parallel(Tonyu.bindFunc(_this,_this._animation));
          _this.animFrame=_this.animFrame||0;
          
        }
      },
      stopAnim :function _trc_AnimMod_stopAnim() {
        var _this=this;
        
        if (_this.animMode) {
          _this.animMode.kill();
          _this.animMode=null;
          
        }
      },
      _animation :function _trc_AnimMod__animation() {
        var _this=this;
        var age;
        
        age = 0;
        
        while (true) {
          age++;
          if (age%_this.animFps==0&&_this.anim instanceof Array) {
            _this.p=_this.anim[_this.animFrame%_this.anim.length];
            _this.animFrame++;
            
          }
          _this.update();
          
        }
      },
      fiber$_animation :function* _trc_AnimMod_f__animation(_thread) {
        var _this=this;
        var age;
        
        age = 0;
        
        while (true) {
          age++;
          if (age%_this.animFps==0&&_this.anim instanceof Array) {
            _this.p=_this.anim[_this.animFrame%_this.anim.length];
            _this.animFrame++;
            
          }
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"initAnimMod":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setAnimFps":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"startAnim":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"stopAnim":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"_animation":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"anim":{},"animMode":{},"animFrame":{},"animFps":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Color',
  shortName: 'Color',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Color_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_Color_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_Color_initialize() {
        var _this=this;
        var a;
        var s;
        var rgba;
        var p;
        var x;
        var y;
        
        a = new Tonyu.classes.kernel.ArgParser(arguments);
        
        
        
        _this.maxs={r: 255,g: 255,b: 255,a: 255,h: 360,s: 1,l: 1};
        p = a.peek(0);
        
        if (p&&p.height&&p.width&&p.data) {
          _this.imageData=a.shift();
          x = a.shift();
          
          y = a.shift();
          
          _this.index=(x+y*p.width)*4;
          _this.value={};
          return _this;
          
        }
        if (s=a.shift("string")) {
          _this.type="name";
          _this.value={name: s};
          
        } else {
          if (s=a.shift("object")) {
            if (typeof  s.r=="number") {
              _this.type="rgba";
              _this.value=s;
              _this.fillNum("g","b","a");
              
            } else {
              if (typeof  s.h=="number") {
                _this.type="hsl";
                _this.value=s;
                _this.fillNum("s","l","a");
                
              } else {
                throw new Error("Invalid color spec");
                
                
              }
            }
            
          } else {
            if ((s=a.shift("number"))!=null) {
              _this.type="rgba";
              _this.value={r: s};
              _this.value.g=a.shift();
              _this.value.b=a.shift();
              _this.value.a=a.shift();
              _this.fillNum("g","b","a");
              
            } else {
              throw new Error("Invalid color spec");
              
              
            }
          }
        }
      },
      fillNum :function _trc_Color_fillNum() {
        var _this=this;
        var a;
        var k;
        
        a = new Tonyu.classes.kernel.ArgParser(arguments);
        
        for ([k] of Tonyu.iterator2(a.toArray(),1)) {
          if (_this.value[k]==null) {
            _this.value[k]=(k=="a"?_this.maxs.a:0);
          }
          
        }
      },
      fiber$fillNum :function* _trc_Color_f_fillNum(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var a;
        var k;
        
        a = new Tonyu.classes.kernel.ArgParser(_arguments);
        
        for ([k] of Tonyu.iterator2(a.toArray(),1)) {
          if (_this.value[k]==null) {
            _this.value[k]=(k=="a"?_this.maxs.a:0);
          }
          
        }
        
      },
      __getter__r :function _trc_Color___getter__r() {
        var _this=this;
        
        _this.makeRGBA();
        if (_this.imageData) {
          return _this.imageData.data[_this.index];
        }
        return _this.value.r;
      },
      __getter__g :function _trc_Color___getter__g() {
        var _this=this;
        
        _this.makeRGBA();
        if (_this.imageData) {
          return _this.imageData.data[_this.index+1];
        }
        return _this.value.g;
      },
      __getter__b :function _trc_Color___getter__b() {
        var _this=this;
        
        _this.makeRGBA();
        if (_this.imageData) {
          return _this.imageData.data[_this.index+2];
        }
        return _this.value.b;
      },
      __getter__a :function _trc_Color___getter__a() {
        var _this=this;
        
        if (_this.imageData) {
          return _this.imageData.data[_this.index+3];
        }
        return _this.value.a;
      },
      __setter__a :function _trc_Color___setter__a(v) {
        var _this=this;
        
        _this.clearName();
        v=_this.clamp(v,0,_this.maxs.a);
        if (_this.imageData) {
          _this.imageData.data[_this.index+3]=v;
        } else {
          _this.value.a=v;
        }
      },
      __setter__r :function _trc_Color___setter__r(v) {
        var _this=this;
        
        _this.makeRGBA();
        _this.clearName();
        _this.clearHSLA();
        v=_this.clamp(v,0,_this.maxs.r);
        if (_this.imageData) {
          _this.imageData.data[_this.index]=v;
        } else {
          _this.value.r=v;
        }
      },
      __setter__g :function _trc_Color___setter__g(v) {
        var _this=this;
        
        _this.makeRGBA();
        _this.clearName();
        _this.clearHSLA();
        v=_this.clamp(v,0,_this.maxs.g);
        if (_this.imageData) {
          _this.imageData.data[_this.index+1]=v;
        }
        _this.value.g=v;
      },
      __setter__b :function _trc_Color___setter__b(v) {
        var _this=this;
        
        _this.makeRGBA();
        _this.clearName();
        _this.clearHSLA();
        v=_this.clamp(v,0,_this.maxs.b);
        if (_this.imageData) {
          _this.imageData.data[_this.index+2]=v;
        }
        _this.value.b=v;
      },
      __getter__h :function _trc_Color___getter__h() {
        var _this=this;
        
        _this.makeHSLA();
        return _this.value.h;
      },
      __getter__s :function _trc_Color___getter__s() {
        var _this=this;
        
        _this.makeHSLA();
        return _this.value.s;
      },
      __getter__l :function _trc_Color___getter__l() {
        var _this=this;
        
        _this.makeHSLA();
        return _this.value.l;
      },
      __setter__h :function _trc_Color___setter__h(v) {
        var _this=this;
        
        _this.makeHSLA();
        _this.clearName();
        _this.value.h=_this.amod(v,360);
        if (_this.imageData) {
          _this.makeRGBA(true);
        } else {
          _this.clearRGBA();
        }
      },
      __setter__s :function _trc_Color___setter__s(v) {
        var _this=this;
        
        _this.makeHSLA();
        _this.clearName();
        _this.value.s=_this.clamp(v,0,_this.maxs.s);
        if (_this.imageData) {
          _this.makeRGBA(true);
        } else {
          _this.clearRGBA();
        }
      },
      __setter__l :function _trc_Color___setter__l(v) {
        var _this=this;
        
        _this.makeHSLA();
        _this.clearName();
        _this.value.l=_this.clamp(v,0,_this.maxs.l);
        if (_this.imageData) {
          _this.makeRGBA(true);
        } else {
          _this.clearRGBA();
        }
      },
      setHSLA :function _trc_Color_setHSLA(h,s,l,a) {
        var _this=this;
        
        _this.value.h=h;
        _this.value.s=s;
        _this.value.l=l;
        if (typeof  a==="number") {
          if (_this.imageData) {
            _this.imageData.data[_this.index+3]=a;
            
          } else {
            _this.value.a=a;
          }
          
        }
        if (_this.imageData) {
          _this.makeRGBA(true);
        } else {
          _this.clearRGBA();
        }
        return true;
      },
      fiber$setHSLA :function* _trc_Color_f_setHSLA(_thread,h,s,l,a) {
        var _this=this;
        
        _this.value.h=h;
        _this.value.s=s;
        _this.value.l=l;
        if (typeof  a==="number") {
          if (_this.imageData) {
            _this.imageData.data[_this.index+3]=a;
            
          } else {
            _this.value.a=a;
          }
          
        }
        if (_this.imageData) {
          (yield* _this.fiber$makeRGBA(_thread, true));
        } else {
          (yield* _this.fiber$clearRGBA(_thread));
        }
        return true;
        
      },
      setRGBA :function _trc_Color_setRGBA(r,g,b,a) {
        var _this=this;
        var n;
        var i;
        
        if (_this.imageData) {
          n = ((typeof  a==="number")?4:3);
          
          for (i = 0;
           i<n ; i++) {
            _this.imageData.data[_this.index+i]=[r,g,b,a][i];
          }
          
        } else {
          _this.value.r=r;
          _this.value.g=g;
          _this.value.b=b;
          if (typeof  a==="number") {
            _this.value.a=a;
          }
          _this.clearHSLA();
          _this.clearName();
          
        }
      },
      fiber$setRGBA :function* _trc_Color_f_setRGBA(_thread,r,g,b,a) {
        var _this=this;
        var n;
        var i;
        
        if (_this.imageData) {
          n = ((typeof  a==="number")?4:3);
          
          for (i = 0;
           i<n ; i++) {
            _this.imageData.data[_this.index+i]=[r,g,b,a][i];
          }
          
        } else {
          _this.value.r=r;
          _this.value.g=g;
          _this.value.b=b;
          if (typeof  a==="number") {
            _this.value.a=a;
          }
          (yield* _this.fiber$clearHSLA(_thread));
          (yield* _this.fiber$clearName(_thread));
          
        }
        
      },
      hasRGBA :function _trc_Color_hasRGBA() {
        var _this=this;
        
        return _this.imageData||typeof  (_this.value.r)==="number";
      },
      fiber$hasRGBA :function* _trc_Color_f_hasRGBA(_thread) {
        var _this=this;
        
        return _this.imageData||typeof  (_this.value.r)==="number";
        
      },
      hasHSLA :function _trc_Color_hasHSLA() {
        var _this=this;
        
        return typeof  (_this.value.h)==="number";
      },
      fiber$hasHSLA :function* _trc_Color_f_hasHSLA(_thread) {
        var _this=this;
        
        return typeof  (_this.value.h)==="number";
        
      },
      hasName :function _trc_Color_hasName() {
        var _this=this;
        
        return typeof  (_this.value.name)==="string";
      },
      fiber$hasName :function* _trc_Color_f_hasName(_thread) {
        var _this=this;
        
        return typeof  (_this.value.name)==="string";
        
      },
      clearRGBA :function _trc_Color_clearRGBA() {
        var _this=this;
        
        delete _this.value.r;
      },
      fiber$clearRGBA :function* _trc_Color_f_clearRGBA(_thread) {
        var _this=this;
        
        delete _this.value.r;
        
      },
      clearHSLA :function _trc_Color_clearHSLA() {
        var _this=this;
        
        delete _this.value.h;
      },
      fiber$clearHSLA :function* _trc_Color_f_clearHSLA(_thread) {
        var _this=this;
        
        delete _this.value.h;
        
      },
      clearName :function _trc_Color_clearName() {
        var _this=this;
        
        delete _this.value.name;
      },
      fiber$clearName :function* _trc_Color_f_clearName(_thread) {
        var _this=this;
        
        delete _this.value.name;
        
      },
      lerpRGBA :function _trc_Color_lerpRGBA(c,t) {
        var _this=this;
        
        t=t||0;
        return new Tonyu.classes.kernel.Color(_this.r*(1-t)+c.r*t,_this.g*(1-t)+c.g*t,_this.b*(1-t)+c.b*t,_this.a*(1-t)+c.a*t);
      },
      fiber$lerpRGBA :function* _trc_Color_f_lerpRGBA(_thread,c,t) {
        var _this=this;
        
        t=t||0;
        return new Tonyu.classes.kernel.Color(_this.r*(1-t)+c.r*t,_this.g*(1-t)+c.g*t,_this.b*(1-t)+c.b*t,_this.a*(1-t)+c.a*t);
        
      },
      distRGBA :function _trc_Color_distRGBA(other) {
        var _this=this;
        var dr;
        var dg;
        var db;
        var da;
        
        if (Tonyu.is(other,Tonyu.classes.kernel.Color)) {
          
          
        } else {
          other=new Tonyu.classes.kernel.Color(other+"");
          
        }
        dr = (_this.r/_this.maxs.r-other.r/other.maxs.r);
        
        dg = (_this.g/_this.maxs.g-other.g/other.maxs.g);
        
        db = (_this.b/_this.maxs.b-other.b/other.maxs.b);
        
        da = (_this.a/_this.maxs.a-other.a/other.maxs.a);
        
        return _this.sqrt(dr*dr+dg*dg+db*db+da*da);
      },
      fiber$distRGBA :function* _trc_Color_f_distRGBA(_thread,other) {
        var _this=this;
        var dr;
        var dg;
        var db;
        var da;
        
        if (Tonyu.is(other,Tonyu.classes.kernel.Color)) {
          
          
        } else {
          other=new Tonyu.classes.kernel.Color(other+"");
          
        }
        dr = (_this.r/_this.maxs.r-other.r/other.maxs.r);
        
        dg = (_this.g/_this.maxs.g-other.g/other.maxs.g);
        
        db = (_this.b/_this.maxs.b-other.b/other.maxs.b);
        
        da = (_this.a/_this.maxs.a-other.a/other.maxs.a);
        
        return _this.sqrt(dr*dr+dg*dg+db*db+da*da);
        
      },
      distHSLA :function _trc_Color_distHSLA(other) {
        var _this=this;
        var dh;
        var ds;
        var dl;
        var da;
        
        if (Tonyu.is(other,Tonyu.classes.kernel.Color)) {
          
          
        } else {
          other=new Tonyu.classes.kernel.Color(other+"");
          
        }
        dh = _this.angleDiff(_this.h,other.h)/180;
        
        ds = (_this.s/_this.maxs.s-other.s/other.maxs.s);
        
        dl = (_this.l/_this.maxs.l-other.l/other.maxs.l);
        
        da = (_this.a/_this.maxs.a-other.a/other.maxs.a);
        
        return _this.sqrt(dh*dh+ds*ds+dl*dl+da*da);
      },
      fiber$distHSLA :function* _trc_Color_f_distHSLA(_thread,other) {
        var _this=this;
        var dh;
        var ds;
        var dl;
        var da;
        
        if (Tonyu.is(other,Tonyu.classes.kernel.Color)) {
          
          
        } else {
          other=new Tonyu.classes.kernel.Color(other+"");
          
        }
        dh = _this.angleDiff(_this.h,other.h)/180;
        
        ds = (_this.s/_this.maxs.s-other.s/other.maxs.s);
        
        dl = (_this.l/_this.maxs.l-other.l/other.maxs.l);
        
        da = (_this.a/_this.maxs.a-other.a/other.maxs.a);
        
        return _this.sqrt(dh*dh+ds*ds+dl*dl+da*da);
        
      },
      makeRGBA :function _trc_Color_makeRGBA(force) {
        var _this=this;
        var rgb;
        var i;
        
        if (! force&&_this.hasRGBA()) {
          return _this;
        }
        if (_this.hasHSLA()) {
          rgb = _this.HSLToRGB(_this.value.h,_this.value.s,_this.value.l);
          
          if (_this.imageData) {
            for (i = 0;
             i<3 ; i++) {
              _this.imageData.data[_this.index+i]=rgb[i]*_this.maxs.r;
            }
            
          } else {
            _this.value.r=rgb[0]*_this.maxs.r;
            _this.value.g=rgb[1]*_this.maxs.g;
            _this.value.b=rgb[2]*_this.maxs.b;
            
          }
          return _this;
          
        }
        _this.nameToRGB();
      },
      fiber$makeRGBA :function* _trc_Color_f_makeRGBA(_thread,force) {
        var _this=this;
        var rgb;
        var i;
        
        if (! force&&_this.hasRGBA()) {
          return _this;
        }
        if (_this.hasHSLA()) {
          rgb=yield* _this.fiber$HSLToRGB(_thread, _this.value.h, _this.value.s, _this.value.l);
          
          if (_this.imageData) {
            for (i = 0;
             i<3 ; i++) {
              _this.imageData.data[_this.index+i]=rgb[i]*_this.maxs.r;
            }
            
          } else {
            _this.value.r=rgb[0]*_this.maxs.r;
            _this.value.g=rgb[1]*_this.maxs.g;
            _this.value.b=rgb[2]*_this.maxs.b;
            
          }
          return _this;
          
        }
        (yield* _this.fiber$nameToRGB(_thread));
        
      },
      nameToRGB :function _trc_Color_nameToRGB() {
        var _this=this;
        var ctx;
        var d;
        var i;
        
        ctx = _this.tmpCanvas();
        
        ctx.fillStyle=_this.value.name;
        ctx.fillRect(0,0,1,1);
        d = ctx.getImageData(0,0,1,1);
        
        d=d.data;
        if (_this.imageData) {
          for (i = 0;
           i<4 ; i++) {
            _this.imageData.data[_this.index+i]=d[i];
          }
          
        } else {
          _this.value.r=d[0];
          _this.value.g=d[1];
          _this.value.b=d[2];
          _this.value.a=d[3];
          
        }
      },
      fiber$nameToRGB :function* _trc_Color_f_nameToRGB(_thread) {
        var _this=this;
        var ctx;
        var d;
        var i;
        
        ctx=yield* _this.fiber$tmpCanvas(_thread);
        
        ctx.fillStyle=_this.value.name;
        ctx.fillRect(0,0,1,1);
        d = ctx.getImageData(0,0,1,1);
        
        d=d.data;
        if (_this.imageData) {
          for (i = 0;
           i<4 ; i++) {
            _this.imageData.data[_this.index+i]=d[i];
          }
          
        } else {
          _this.value.r=d[0];
          _this.value.g=d[1];
          _this.value.b=d[2];
          _this.value.a=d[3];
          
        }
        
      },
      makeHSLA :function _trc_Color_makeHSLA() {
        var _this=this;
        var hsl;
        
        if (_this.hasHSLA()) {
          return _this;
        }
        if (! _this.hasRGBA()) {
          _this.nameToRGB();
        }
        
        if (_this.imageData) {
          hsl=_this.RGBToHSL(_this.imageData.data[_this.index]/_this.maxs.r,_this.imageData.data[_this.index+1]/_this.maxs.g,_this.imageData.data[_this.index+2]/_this.maxs.b);
          
        } else {
          hsl=_this.RGBToHSL(_this.value.r/_this.maxs.r,_this.value.g/_this.maxs.g,_this.value.b/_this.maxs.b);
          
        }
        _this.value.h=hsl[0];
        _this.value.s=hsl[1];
        _this.value.l=hsl[2];
        return _this;
      },
      fiber$makeHSLA :function* _trc_Color_f_makeHSLA(_thread) {
        var _this=this;
        var hsl;
        
        if (_this.hasHSLA()) {
          return _this;
        }
        if (! _this.hasRGBA()) {
          (yield* _this.fiber$nameToRGB(_thread));
        }
        
        if (_this.imageData) {
          hsl=(yield* _this.fiber$RGBToHSL(_thread, _this.imageData.data[_this.index]/_this.maxs.r, _this.imageData.data[_this.index+1]/_this.maxs.g, _this.imageData.data[_this.index+2]/_this.maxs.b));
          
        } else {
          hsl=(yield* _this.fiber$RGBToHSL(_thread, _this.value.r/_this.maxs.r, _this.value.g/_this.maxs.g, _this.value.b/_this.maxs.b));
          
        }
        _this.value.h=hsl[0];
        _this.value.s=hsl[1];
        _this.value.l=hsl[2];
        return _this;
        
      },
      makeName :function _trc_Color_makeName(type) {
        var _this=this;
        function p(r) {
          
          return _this.floor(r*100)+"%";
        }
        if (_this.hasName()) {
          return _this;
        }
        type=type||"rgb";
        if (type=="rgb") {
          _this.makeRGBA();
          if (_this.imageData) {
            _this.value.name="rgba("+[_this.floor(_this.imageData.data[_this.index]),_this.floor(_this.imageData.data[_this.index+1]),_this.floor(_this.imageData.data[_this.index+2]),_this.imageData.data[_this.index+3]/_this.maxs.a].join(",")+")";
            
          } else {
            _this.value.name="rgba("+[_this.floor(_this.value.r),_this.floor(_this.value.g),_this.floor(_this.value.b),_this.value.a/_this.maxs.a].join(",")+")";
            
          }
          
        }
        if (type=="hsl") {
          _this.makeHSLA();
          _this.value.name="hsla("+[_this.floor(_this.value.h),p(_this.value.s),p(_this.value.l),_this.value.a/_this.maxs.a].join(",")+")";
          
        }
        
      },
      fiber$makeName :function* _trc_Color_f_makeName(_thread,type) {
        var _this=this;
        function p(r) {
          
          return _this.floor(r*100)+"%";
        }
        if (_this.hasName()) {
          return _this;
        }
        type=type||"rgb";
        if (type=="rgb") {
          (yield* _this.fiber$makeRGBA(_thread));
          if (_this.imageData) {
            _this.value.name="rgba("+[_this.floor(_this.imageData.data[_this.index]),_this.floor(_this.imageData.data[_this.index+1]),_this.floor(_this.imageData.data[_this.index+2]),_this.imageData.data[_this.index+3]/_this.maxs.a].join(",")+")";
            
          } else {
            _this.value.name="rgba("+[_this.floor(_this.value.r),_this.floor(_this.value.g),_this.floor(_this.value.b),_this.value.a/_this.maxs.a].join(",")+")";
            
          }
          
        }
        if (type=="hsl") {
          (yield* _this.fiber$makeHSLA(_thread));
          _this.value.name="hsla("+[_this.floor(_this.value.h),p(_this.value.s),p(_this.value.l),_this.value.a/_this.maxs.a].join(",")+")";
          
        }
        
        
      },
      toString :function _trc_Color_toString() {
        var _this=this;
        
        _this.makeName();
        return _this.value.name;
      },
      tmpCanvas :function _trc_Color_tmpCanvas() {
        var _this=this;
        var cv;
        
        if (Tonyu.classes.kernel.Color.ctx) {
          return Tonyu.classes.kernel.Color.ctx;
        }
        cv = $("<canvas>").attr({width: 1,height: 1}).css({display: "none"}).appendTo("body");
        
        Tonyu.classes.kernel.Color.ctx=cv[0].getContext("2d");
        return Tonyu.classes.kernel.Color.ctx;
      },
      fiber$tmpCanvas :function* _trc_Color_f_tmpCanvas(_thread) {
        var _this=this;
        var cv;
        
        if (Tonyu.classes.kernel.Color.ctx) {
          return Tonyu.classes.kernel.Color.ctx;
        }
        cv = $("<canvas>").attr({width: 1,height: 1}).css({display: "none"}).appendTo("body");
        
        Tonyu.classes.kernel.Color.ctx=cv[0].getContext("2d");
        return Tonyu.classes.kernel.Color.ctx;
        
      },
      RGBToHSL :function _trc_Color_RGBToHSL(r,g,b) {
        var _this=this;
        var min;
        var max;
        var diff;
        var h;
        var s;
        var l;
        
        min = Tonyu.globals.$Math.min(r,g,b);
        max = Tonyu.globals.$Math.max(r,g,b);
        diff = max-min;
        h = 0;
        s = 0;
        l = (min+max)/2;
        
        if (diff!=0) {
          s=l<0.5?diff/(max+min):diff/(2-max-min);
          h=(r==max?(g-b)/diff:g==max?2+(b-r)/diff:4+(r-g)/diff)*60;
          
        }
        return [h,s,l];
      },
      fiber$RGBToHSL :function* _trc_Color_f_RGBToHSL(_thread,r,g,b) {
        var _this=this;
        var min;
        var max;
        var diff;
        var h;
        var s;
        var l;
        
        min = Tonyu.globals.$Math.min(r,g,b);
        max = Tonyu.globals.$Math.max(r,g,b);
        diff = max-min;
        h = 0;
        s = 0;
        l = (min+max)/2;
        
        if (diff!=0) {
          s=l<0.5?diff/(max+min):diff/(2-max-min);
          h=(r==max?(g-b)/diff:g==max?2+(b-r)/diff:4+(r-g)/diff)*60;
          
        }
        return [h,s,l];
        
      },
      HSLToRGB :function _trc_Color_HSLToRGB(h,s,l) {
        var _this=this;
        var temp2;
        var temp1;
        var rtemp;
        var gtemp;
        var btemp;
        var rgb;
        var i;
        
        if (s==0) {
          return [l,l,l];
          
        }
        temp2 = l<0.5?l*(1+s):l+s-l*s;
        
        temp1 = 2*l-temp2;
        
        h/=360;
        rtemp = (h+1/3)%1;
        gtemp = h;
        btemp = (h+2/3)%1;
        rgb = [rtemp,gtemp,btemp];
        i = 0;
        
        ;
        
        while(i<3) {
          {
            rgb[i]=rgb[i]<1/6?temp1+(temp2-temp1)*6*rgb[i]:rgb[i]<1/2?temp2:rgb[i]<2/3?temp1+(temp2-temp1)*6*(2/3-rgb[i]):temp1;
          }
          ++ i;
        }
        return rgb;
      },
      fiber$HSLToRGB :function* _trc_Color_f_HSLToRGB(_thread,h,s,l) {
        var _this=this;
        var temp2;
        var temp1;
        var rtemp;
        var gtemp;
        var btemp;
        var rgb;
        var i;
        
        if (s==0) {
          return [l,l,l];
          
        }
        temp2 = l<0.5?l*(1+s):l+s-l*s;
        
        temp1 = 2*l-temp2;
        
        h/=360;
        rtemp = (h+1/3)%1;
        gtemp = h;
        btemp = (h+2/3)%1;
        rgb = [rtemp,gtemp,btemp];
        i = 0;
        
        ;
        
        while(i<3) {
          {
            rgb[i]=rgb[i]<1/6?temp1+(temp2-temp1)*6*rgb[i]:rgb[i]<1/2?temp2:rgb[i]<2/3?temp1+(temp2-temp1)*6*(2/3-rgb[i]):temp1;
          }
          ++ i;
        }
        return rgb;
        
      },
      __getter__name :function _trc_Color___getter__name() {
        var _this=this;
        
        _this.makeName();
        return _this.value.name;
      },
      __setter__name :function _trc_Color___setter__name(v) {
        var _this=this;
        
        _this.value.name=v;
        _this.nameToRGB();
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"fillNum":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__r":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__g":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__b":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__a":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__a":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__r":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__g":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__b":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__h":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__s":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__l":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__h":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__s":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__l":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setHSLA":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"setRGBA":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"hasRGBA":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"hasHSLA":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"hasName":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clearRGBA":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clearHSLA":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clearName":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"lerpRGBA":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"distRGBA":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"distHSLA":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"makeRGBA":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"nameToRGB":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"makeHSLA":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"makeName":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"toString":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"tmpCanvas":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"RGBToHSL":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"HSLToRGB":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"__getter__name":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__name":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"maxs":{},"imageData":{},"index":{},"value":{},"type":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Context3D',
  shortName: 'Context3D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Context3D_main() {
        var _this=this;
        
        "field strict";
        
        
        
        
      },
      fiber$main :function* _trc_Context3D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
        
      },
      addSprite2D :function _trc_Context3D_addSprite2D(s) {
        var _this=this;
        
        if (! (Tonyu.is(s,Tonyu.classes.kernel.ActorSprite))) {
          s=new Tonyu.classes.kernel.ActorSprite(s);
        }
        _this.sprites2D.push(s);
      },
      fiber$addSprite2D :function* _trc_Context3D_f_addSprite2D(_thread,s) {
        var _this=this;
        
        if (! (Tonyu.is(s,Tonyu.classes.kernel.ActorSprite))) {
          s=new Tonyu.classes.kernel.ActorSprite(s);
        }
        _this.sprites2D.push(s);
        
      },
      addSprite3D :function _trc_Context3D_addSprite3D(s) {
        var _this=this;
        var pos3d;
        var pt;
        var scl;
        
        pos3d = s.transform?s.transform.position:(s.position||new Tonyu.classes.kernel.Vec3(s.x||0,s.y||0,s.z||0));
        
        pt = _this.to2D(pos3d);
        
        if (pt) {
          scl = (s.transform?s.transform.scale:(s.scale||1))*pt.scale;
          
          _this.addSprite2D({x: pt.x,y: pt.y,zOrder: pt.z,scaleX: (s.scaleX||1)*scl,scaleY: (s.scaleY||s.scaleX||1)*scl,p: s.p,text: s.text,fillStyle: s.fillStyle,width: s.width,height: s.height,radius: s.radius,rotation: s.rotation||0,alpha: s.alpha||255});
          
        }
      },
      fiber$addSprite3D :function* _trc_Context3D_f_addSprite3D(_thread,s) {
        var _this=this;
        var pos3d;
        var pt;
        var scl;
        
        pos3d = s.transform?s.transform.position:(s.position||new Tonyu.classes.kernel.Vec3(s.x||0,s.y||0,s.z||0));
        
        pt=yield* _this.fiber$to2D(_thread, pos3d);
        
        if (pt) {
          scl = (s.transform?s.transform.scale:(s.scale||1))*pt.scale;
          
          (yield* _this.fiber$addSprite2D(_thread, {x: pt.x,y: pt.y,zOrder: pt.z,scaleX: (s.scaleX||1)*scl,scaleY: (s.scaleY||s.scaleX||1)*scl,p: s.p,text: s.text,fillStyle: s.fillStyle,width: s.width,height: s.height,radius: s.radius,rotation: s.rotation||0,alpha: s.alpha||255}));
          
        }
        
      },
      initialize :function _trc_Context3D_initialize(p) {
        var _this=this;
        
        __superClass.apply( _this, [p]);
        _this.sprites2D=[];
        _this.curTransform=_this.camera.transform.inverse;
        _this.stack=[];
      },
      to2D :function _trc_Context3D_to2D(pos) {
        var _this=this;
        
        if (! pos) {
          return _this.camera.to2D(_this.curTransform.position);
          
        }
        return _this.camera.to2D(_this.curTransform.childToSibling(pos));
      },
      fiber$to2D :function* _trc_Context3D_f_to2D(_thread,pos) {
        var _this=this;
        
        if (! pos) {
          return _this.camera.to2D(_this.curTransform.position);
          
        }
        return _this.camera.to2D(_this.curTransform.childToSibling(pos));
        
      },
      setTransform :function _trc_Context3D_setTransform(t) {
        var _this=this;
        
        _this.curTransform=t;
      },
      fiber$setTransform :function* _trc_Context3D_f_setTransform(_thread,t) {
        var _this=this;
        
        _this.curTransform=t;
        
      },
      transform :function _trc_Context3D_transform(t) {
        var _this=this;
        
        _this.curTransform=_this.curTransform.childToSibling(t);
      },
      fiber$transform :function* _trc_Context3D_f_transform(_thread,t) {
        var _this=this;
        
        _this.curTransform=_this.curTransform.childToSibling(t);
        
      },
      save :function _trc_Context3D_save() {
        var _this=this;
        
        _this.stack.push({curTransform: _this.curTransform});
      },
      fiber$save :function* _trc_Context3D_f_save(_thread) {
        var _this=this;
        
        _this.stack.push({curTransform: _this.curTransform});
        
      },
      restore :function _trc_Context3D_restore() {
        var _this=this;
        
        _this.extend(_this.stack.pop());
      },
      fiber$restore :function* _trc_Context3D_f_restore(_thread) {
        var _this=this;
        
        _this.extend(_this.stack.pop());
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"addSprite2D":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"addSprite3D":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"to2D":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setTransform":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"transform":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"save":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"restore":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"camera":{"vtype":"kernel.Camera3D"},"sprites2D":{"vtype":"Array"},"curTransform":{},"stack":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.GIFWriter',
  shortName: 'GIFWriter',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.ParallelMod,Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.FileMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.ThreadGroupMod],
  methods: function (__superClass) {
    return {
      main :function _trc_GIFWriter_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_GIFWriter_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_GIFWriter_initialize(params) {
        var _this=this;
        var cnt;
        var wevt;
        
        __superClass.apply( _this, [params]);
        Tonyu.globals.$currentProject.requestPlugin("gif");
        _this.target=_this.target||Tonyu.globals.$Screen;
        _this.fps=_this.fps||15;
        _this.interval=_this.interval||_this.floor(Tonyu.globals.$Boot.getFrameRate()/_this.fps);
        _this.duration=(1000/Tonyu.globals.$Boot.getFrameRate())*_this.interval;
        if (! _this.manual) {
          if (_this.delay) {
            cnt = 0;
            
            
            wevt=Tonyu.globals.$Boot.on("afterDraw",(function anonymous_637() {
              
              cnt++;
              if (cnt>=_this.delay) {
                wevt.remove();
                _this.start();
                
              }
            }));
            
          } else {
            _this.start();
          }
          
        }
      },
      start :function _trc_GIFWriter_start() {
        var _this=this;
        var cnt;
        
        if (_this.e) {
          return _this;
        }
        _this.frames=[];
        _this.e=new GIF({workerScript: GIF_WORKER_URL,workers: 2,quality: 10});
        _this.encoded=0;
        if (! _this.manual) {
          cnt = 0;
          
          _this.evt=Tonyu.globals.$Boot.on("afterDraw",(function anonymous_1221(e) {
            var drawn;
            
            drawn = e.drawn;
            
            cnt++;
            if (cnt>=_this.interval) {
              cnt=0;
              _this.addFrame();
              
            }
            if (typeof  _this.length==="number") {
              _this.length--;
              if (_this.length<=0) {
                switch (_this.after) {
                case "save":
                  return _this.save()["catch"]((function anonymous_1583(e) {
                    
                    console.error(e);
                  }));
                case "download":
                  return _this.download();
                }
                
              }
              
            }
          }));
          
        }
      },
      fiber$start :function* _trc_GIFWriter_f_start(_thread) {
        var _this=this;
        var cnt;
        
        if (_this.e) {
          return _this;
        }
        _this.frames=[];
        _this.e=new GIF({workerScript: GIF_WORKER_URL,workers: 2,quality: 10});
        _this.encoded=0;
        if (! _this.manual) {
          cnt = 0;
          
          _this.evt=Tonyu.globals.$Boot.on("afterDraw",(function anonymous_1221(e) {
            var drawn;
            
            drawn = e.drawn;
            
            cnt++;
            if (cnt>=_this.interval) {
              cnt=0;
              _this.addFrame();
              
            }
            if (typeof  _this.length==="number") {
              _this.length--;
              if (_this.length<=0) {
                switch (_this.after) {
                case "save":
                  return _this.save()["catch"]((function anonymous_1583(e) {
                    
                    console.error(e);
                  }));
                case "download":
                  return _this.download();
                }
                
              }
              
            }
          }));
          
        }
        
      },
      addFrame :function _trc_GIFWriter_addFrame() {
        var _this=this;
        
        if (! _this.e) {
          _this.start();
        }
        _this.e.addFrame(_this.target.image,{delay: _this.duration,copy: true});
      },
      fiber$addFrame :function* _trc_GIFWriter_f_addFrame(_thread) {
        var _this=this;
        
        if (! _this.e) {
          (yield* _this.fiber$start(_thread));
        }
        _this.e.addFrame(_this.target.image,{delay: _this.duration,copy: true});
        
      },
      finish :function _trc_GIFWriter_finish() {
        var _this=this;
        var r;
        
        r = _this.runPromise((function anonymous_2016(onFinish,fail) {
          
          if (_this.evt) {
            _this.evt.remove();
            _this.evt=null;
            
          }
          _this.e.on('finished',onFinish);
          _this.e.render();
        }));
        
        return r;
      },
      fiber$finish :function* _trc_GIFWriter_f_finish(_thread) {
        var _this=this;
        var r;
        
        r=yield* _this.fiber$runPromise(_thread, (function anonymous_2016(onFinish,fail) {
          
          if (_this.evt) {
            _this.evt.remove();
            _this.evt=null;
            
          }
          _this.e.on('finished',onFinish);
          _this.e.render();
        }));
        
        return r;
        
      },
      download :function _trc_GIFWriter_download(f) {
        var _this=this;
        var r;
        
        f=f||_this.filename||"download.gif";
        console.log("DL",f);
        r = _this.runPromise((function anonymous_2300(succ,err) {
          
          _this.finish().then((function anonymous_2337(blob) {
            
            FS.Content.download(blob,f);
            _this.e=null;
          })).then((function anonymous_2427() {
            
            console.log("DL OK");
          }),err);
        }));
        
        return r;
      },
      fiber$download :function* _trc_GIFWriter_f_download(_thread,f) {
        var _this=this;
        var r;
        
        f=f||_this.filename||"download.gif";
        console.log("DL",f);
        r=yield* _this.fiber$runPromise(_thread, (function anonymous_2300(succ,err) {
          
          _this.finish().then((function anonymous_2337(blob) {
            
            FS.Content.download(blob,f);
            _this.e=null;
          })).then((function anonymous_2427() {
            
            console.log("DL OK");
          }),err);
        }));
        
        return r;
        
      },
      save :function _trc_GIFWriter_save(f) {
        var _this=this;
        var r;
        
        console.log("Save",f);
        r = _this.runPromise((function anonymous_2547(succ,err) {
          
          _this.finish().then((function anonymous_2584(blob) {
            
            f=_this.file(f||_this.filename);
            return f.setBlob(blob);
          })).then((function anonymous_2681() {
            
            _this.e=null;
            succ();
          })).then((function anonymous_2743() {
            
            console.log("Save OK");
          }),err);
        }));
        
        return r;
      },
      fiber$save :function* _trc_GIFWriter_f_save(_thread,f) {
        var _this=this;
        var r;
        
        console.log("Save",f);
        r=yield* _this.fiber$runPromise(_thread, (function anonymous_2547(succ,err) {
          
          _this.finish().then((function anonymous_2584(blob) {
            
            f=_this.file(f||_this.filename);
            return f.setBlob(blob);
          })).then((function anonymous_2681() {
            
            _this.e=null;
            succ();
          })).then((function anonymous_2743() {
            
            console.log("Save OK");
          }),err);
        }));
        
        return r;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"start":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"addFrame":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"finish":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"download":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"save":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"target":{},"fps":{},"interval":{},"duration":{},"manual":{},"delay":{},"e":{},"frames":{},"encoded":{},"evt":{},"length":{},"after":{},"filename":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.LayerPath',
  shortName: 'LayerPath',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_LayerPath_main() {
        var _this=this;
        
        
        
      },
      fiber$main :function* _trc_LayerPath_f_main(_thread) {
        var _this=this;
        
        
        
        
      },
      convert :function _trc_LayerPath_convert(obj,to) {
        var _this=this;
        
        _this.assertIs(to,Tonyu.classes.kernel.LayerPath);
        let a = _this.commonAncestor(to);
        
        let tg = (function anonymous_266(p) {
          
          return p.target;
        });
        
        let up = _this.pathTo(a).map(tg);
        
        let down = to.pathTo(a).map(tg).reverse();
        
        let res = obj;
        
        for (let i = 0;
         i<up.length-1 ; i++) {
          {
            res=up[i].convert(res,up[i],up[i+1]);
          }
        }
        for (let i = 0;
         i<down.length-1 ; i++) {
          {
            res=down[i].convert(res,down[i],down[i+1]);
          }
        }
        if (res===obj&&res.layerPath!==to) {
          res={x: res.x,y: res.y};
        }
        res.layerPath=to;
        return res;
      },
      fiber$convert :function* _trc_LayerPath_f_convert(_thread,obj,to) {
        var _this=this;
        
        (yield* _this.fiber$assertIs(_thread, to, Tonyu.classes.kernel.LayerPath));
        let a=yield* _this.fiber$commonAncestor(_thread, to);
        
        let tg = (function anonymous_266(p) {
          
          return p.target;
        });
        
        let up = _this.pathTo(a).map(tg);
        
        let down = to.pathTo(a).map(tg).reverse();
        
        let res = obj;
        
        for (let i = 0;
         i<up.length-1 ; i++) {
          {
            res=up[i].convert(res,up[i],up[i+1]);
          }
        }
        for (let i = 0;
         i<down.length-1 ; i++) {
          {
            res=down[i].convert(res,down[i],down[i+1]);
          }
        }
        if (res===obj&&res.layerPath!==to) {
          res={x: res.x,y: res.y};
        }
        res.layerPath=to;
        return res;
        
      },
      pathTo :function _trc_LayerPath_pathTo(a) {
        var _this=this;
        
        let res = [];
        
        for (let p = _this;
         p ; p=p.parent) {
          {
            res.push(p);
            if (p===a) {
              return res;
            }
          }
        }
        return res;
      },
      fiber$pathTo :function* _trc_LayerPath_f_pathTo(_thread,a) {
        var _this=this;
        
        let res = [];
        
        for (let p = _this;
         p ; p=p.parent) {
          {
            res.push(p);
            if (p===a) {
              return res;
            }
          }
        }
        return res;
        
      },
      commonAncestor :function _trc_LayerPath_commonAncestor(to) {
        var _this=this;
        
        let s = new Set;
        
        for (let p = _this;
         p ; p=p.parent) {
          {
            s.add(p);
          }
        }
        for (let p = to;
         p ; p=p.parent) {
          {
            if (s.has(p)) {
              return p;
            }
          }
        }
        throw new Error("No common Ancestor");
        
      },
      fiber$commonAncestor :function* _trc_LayerPath_f_commonAncestor(_thread,to) {
        var _this=this;
        
        let s = new Set;
        
        for (let p = _this;
         p ; p=p.parent) {
          {
            s.add(p);
          }
        }
        for (let p = to;
         p ; p=p.parent) {
          {
            if (s.has(p)) {
              return p;
            }
          }
        }
        throw new Error("No common Ancestor");
        
        
      },
      add :function _trc_LayerPath_add(target) {
        var _this=this;
        
        if (Tonyu.is(target,Tonyu.classes.kernel.Sprites)) {
          if (Tonyu.is(_this.target,Tonyu.classes.kernel.Screen)) {
            target=_this.target.findLayer(target);
            
          }
          
        }
        if (Tonyu.is(target,Tonyu.classes.kernel.Screen)||Tonyu.is(target,Tonyu.classes.kernel.ScreenLayer)||Tonyu.is(target,Tonyu.classes.kernel.Panel)) {
          return new Tonyu.classes.kernel.LayerPath({parent: _this,target: target});
          
        }
        console.log("Invalid target ",target);
        throw new Error("Invalid target "+target);
        
      },
      fiber$add :function* _trc_LayerPath_f_add(_thread,target) {
        var _this=this;
        
        if (Tonyu.is(target,Tonyu.classes.kernel.Sprites)) {
          if (Tonyu.is(_this.target,Tonyu.classes.kernel.Screen)) {
            target=_this.target.findLayer(target);
            
          }
          
        }
        if (Tonyu.is(target,Tonyu.classes.kernel.Screen)||Tonyu.is(target,Tonyu.classes.kernel.ScreenLayer)||Tonyu.is(target,Tonyu.classes.kernel.Panel)) {
          return new Tonyu.classes.kernel.LayerPath({parent: _this,target: target});
          
        }
        console.log("Invalid target ",target);
        throw new Error("Invalid target "+target);
        
        
      },
      withNeighborTarget :function _trc_LayerPath_withNeighborTarget(t) {
        var _this=this;
        
        if (Tonyu.is(_this.target,Tonyu.classes.kernel.Screen)) {
          let l = _this.target.findLayer(t);
          
          if (l) {
            return _this.add(l);
            
          }
          
        } else {
          if (Tonyu.is(_this.target,Tonyu.classes.kernel.ScreenLayer)&&Tonyu.is(t,Tonyu.classes.kernel.Panel)) {
            let s = _this.target.group;
            
            if (s.has(t)) {
              return _this.add(t);
              
            }
            
          }
        }
        for (let p = _this;
         p ; p=p.parent) {
          {
            if (p.target===t) {
              return p;
              
            }
          }
        }
        return null;
      },
      fiber$withNeighborTarget :function* _trc_LayerPath_f_withNeighborTarget(_thread,t) {
        var _this=this;
        
        if (Tonyu.is(_this.target,Tonyu.classes.kernel.Screen)) {
          let l = _this.target.findLayer(t);
          
          if (l) {
            return yield* _this.fiber$add(_thread, l);
            
            
          }
          
        } else {
          if (Tonyu.is(_this.target,Tonyu.classes.kernel.ScreenLayer)&&Tonyu.is(t,Tonyu.classes.kernel.Panel)) {
            let s = _this.target.group;
            
            if (s.has(t)) {
              return yield* _this.fiber$add(_thread, t);
              
              
            }
            
          }
        }
        for (let p = _this;
         p ; p=p.parent) {
          {
            if (p.target===t) {
              return p;
              
            }
          }
        }
        return null;
        
      },
      closest :function _trc_LayerPath_closest(klass) {
        var _this=this;
        
        for (let p = _this;
         p ; p=p.parent) {
          {
            if (Tonyu.is(p.target,klass)) {
              return p;
            }
          }
        }
        return null;
      },
      fiber$closest :function* _trc_LayerPath_f_closest(_thread,klass) {
        var _this=this;
        
        for (let p = _this;
         p ; p=p.parent) {
          {
            if (Tonyu.is(p.target,klass)) {
              return p;
            }
          }
        }
        return null;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"convert":{"nowait":false,"isMain":false,"vtype":{"params":[null,"kernel.LayerPath"],"returnValue":null}},"pathTo":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.LayerPath"],"returnValue":{"element":"kernel.LayerPath"}}},"commonAncestor":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.LayerPath"],"returnValue":"kernel.LayerPath"}},"add":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":"kernel.LayerPath"}},"withNeighborTarget":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"closest":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":"kernel.LayerPath"}}},"fields":{"parent":{"vtype":"kernel.LayerPath"},"target":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MapChip',
  shortName: 'MapChip',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_MapChip_main() {
        var _this=this;
        
        "field strict";
        
        
      },
      fiber$main :function* _trc_MapChip_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
      },
      initialize :function _trc_MapChip_initialize(params) {
        var _this=this;
        var l;
        
        if (params.layer) {
          params.layers=[params.layer];
        }
        if (typeof  params.layers==="string") {
          params.layers=[params.layers];
        }
        __superClass.apply( _this, [params]);
        if (! _this.layers) {
          _this.layers=_this.map.allLayerNames;
        }
        for ([l] of Tonyu.iterator2(_this.layers,1)) {
          if (typeof  l!=="string") {
            console.log(_this.layers);
            throw new Error("Invalid layer spec"+l);
            
            
          }
          
        }
      },
      moved :function _trc_MapChip_moved(x,y) {
        var _this=this;
        
        return new Tonyu.classes.kernel.MapChip({map: _this.map,x: x,y: y,layers: _this.layers});
      },
      fiber$moved :function* _trc_MapChip_f_moved(_thread,x,y) {
        var _this=this;
        
        return new Tonyu.classes.kernel.MapChip({map: _this.map,x: x,y: y,layers: _this.layers});
        
      },
      movedBy :function _trc_MapChip_movedBy(dx,dy) {
        var _this=this;
        
        return _this.moved(_this.x+dx,_this.y+dy);
      },
      fiber$movedBy :function* _trc_MapChip_f_movedBy(_thread,dx,dy) {
        var _this=this;
        
        return yield* _this.fiber$moved(_thread, _this.x+dx, _this.y+dy);
        
        
      },
      withLayers :function _trc_MapChip_withLayers() {
        var _this=this;
        var a;
        var nl;
        
        a = Array.prototype.slice.call(arguments);
        
        
        if (a.length===0) {
          nl=_this.map.allLayerNames;
          
        } else {
          if (a.length==1&&typeof  a[0]!=="string") {
            nl=a[0];
            
          } else {
            nl=a;
            
          }
        }
        return new Tonyu.classes.kernel.MapChip({map: _this.map,x: _this.x,y: _this.y,layers: nl});
      },
      fiber$withLayers :function* _trc_MapChip_f_withLayers(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var a;
        var nl;
        
        a = Array.prototype.slice.call(_arguments);
        
        
        if (a.length===0) {
          nl=_this.map.allLayerNames;
          
        } else {
          if (a.length==1&&typeof  a[0]!=="string") {
            nl=a[0];
            
          } else {
            nl=a;
            
          }
        }
        return new Tonyu.classes.kernel.MapChip({map: _this.map,x: _this.x,y: _this.y,layers: nl});
        
      },
      __getter__pAll :function _trc_MapChip___getter__pAll() {
        var _this=this;
        var res;
        var l;
        
        res = {};
        
        for ([l] of Tonyu.iterator2(_this.layers,1)) {
          res[l]=_this.map.getWithLayerName(l,_this.x,_this.y);
          
        }
        return res;
      },
      __setter__pAll :function _trc_MapChip___setter__pAll(vals) {
        var _this=this;
        var l;
        var val;
        
        for ([l, val] of Tonyu.iterator2(vals,2)) {
          _this.map.setWithLayerName(l,_this.x,_this.y,val);
          
        }
      },
      __getter__p :function _trc_MapChip___getter__p() {
        var _this=this;
        
        return _this.map.getWithLayerName(_this.layers[0],_this.x,_this.y);
      },
      __setter__p :function _trc_MapChip___setter__p(val) {
        var _this=this;
        
        if (typeof  val==="object") {
          return _this.pAll=val;
        }
        return _this.map.setWithLayerName(_this.layers[0],_this.x,_this.y,val);
      },
      has :function _trc_MapChip_has(p) {
        var _this=this;
        var chipLayer;
        
        if (p==null) {
          return _this.hasExcept(- 1);
        }
        if (typeof  p==="number") {
          p=[p];
        }
        for ([chipLayer] of Tonyu.iterator2(_this.layers,1)) {
          if (p.indexOf(_this.map.getWithLayerName(chipLayer,_this.x,_this.y))>=0) {
            return _this.withLayers(chipLayer);
            
          }
          
        }
        return null;
      },
      fiber$has :function* _trc_MapChip_f_has(_thread,p) {
        var _this=this;
        var chipLayer;
        
        if (p==null) {
          return yield* _this.fiber$hasExcept(_thread, - 1);
          
        }
        if (typeof  p==="number") {
          p=[p];
        }
        for ([chipLayer] of Tonyu.iterator2(_this.layers,1)) {
          if (p.indexOf(_this.map.getWithLayerName(chipLayer,_this.x,_this.y))>=0) {
            return yield* _this.fiber$withLayers(_thread, chipLayer);
            
            
          }
          
        }
        return null;
        
      },
      hasExcept :function _trc_MapChip_hasExcept(p) {
        var _this=this;
        var chipLayer;
        
        if (typeof  p==="number") {
          p=[p];
        }
        for ([chipLayer] of Tonyu.iterator2(_this.layers,1)) {
          if (p.indexOf(_this.map.getWithLayerName(chipLayer,_this.x,_this.y))<0) {
            return _this.withLayers(chipLayer);
            
          }
          
        }
        return null;
      },
      fiber$hasExcept :function* _trc_MapChip_f_hasExcept(_thread,p) {
        var _this=this;
        var chipLayer;
        
        if (typeof  p==="number") {
          p=[p];
        }
        for ([chipLayer] of Tonyu.iterator2(_this.layers,1)) {
          if (p.indexOf(_this.map.getWithLayerName(chipLayer,_this.x,_this.y))<0) {
            return yield* _this.fiber$withLayers(_thread, chipLayer);
            
            
          }
          
        }
        return null;
        
      },
      toActor :function _trc_MapChip_toActor(options,params) {
        var _this=this;
        var klass;
        var w;
        var res;
        
        if (typeof  options==="function") {
          options={class: options};
          
        }
        klass = options.class;
        
        params=params||options.params||{};
        w = _this.toWorld();
        
        params.x=w.x;
        params.y=w.y;
        params.p=_this.p;
        res = new klass(params);
        
        _this.p=- 1;
        return res;
      },
      fiber$toActor :function* _trc_MapChip_f_toActor(_thread,options,params) {
        var _this=this;
        var klass;
        var w;
        var res;
        
        if (typeof  options==="function") {
          options={class: options};
          
        }
        klass = options.class;
        
        params=params||options.params||{};
        w=yield* _this.fiber$toWorld(_thread);
        
        params.x=w.x;
        params.y=w.y;
        params.p=_this.p;
        res = new klass(params);
        
        _this.p=- 1;
        return res;
        
      },
      toWorld :function _trc_MapChip_toWorld(align) {
        var _this=this;
        
        return _this.map.chipToWorld(_this.x,_this.y,align);
      },
      fiber$toWorld :function* _trc_MapChip_f_toWorld(_thread,align) {
        var _this=this;
        
        return _this.map.chipToWorld(_this.x,_this.y,align);
        
      },
      getBuffer :function _trc_MapChip_getBuffer() {
        var _this=this;
        
        return _this.map.getBuf(_this.x,_this.y);
      },
      fiber$getBuffer :function* _trc_MapChip_f_getBuffer(_thread) {
        var _this=this;
        
        return _this.map.getBuf(_this.x,_this.y);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"moved":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"movedBy":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"withLayers":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__pAll":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__pAll":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__p":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__p":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"has":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":"kernel.MapChip"}},"hasExcept":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":"kernel.MapChip"}},"toActor":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"toWorld":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBuffer":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"map":{},"x":{},"y":{},"layers":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MapCodec',
  shortName: 'MapCodec',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_MapCodec_main() {
        var _this=this;
        
        "field strict";
        
        _this.resc = Tonyu.globals.$currentProject.getResource().images;
        
        _this.patVals = [];
        
        _this.c2p = [];
        
        _this.cNumberSeq = 0;
        
        _this.entire = {version: 2};
        
        
        for ([_this.r] of Tonyu.iterator2(_this.resc,1)) {
          _this.patVals.unshift({name: _this.r.name,value: Tonyu.getGlobal(_this.r.name)});
          
        }
      },
      fiber$main :function* _trc_MapCodec_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        _this.resc = Tonyu.globals.$currentProject.getResource().images;
        
        _this.patVals = [];
        
        _this.c2p = [];
        
        _this.cNumberSeq = 0;
        
        _this.entire = {version: 2};
        
        
        for ([_this.r] of Tonyu.iterator2(_this.resc,1)) {
          _this.patVals.unshift({name: _this.r.name,value: Tonyu.getGlobal(_this.r.name)});
          
        }
        
      },
      ignoreCheck :function _trc_MapCodec_ignoreCheck() {
        var _this=this;
        
        _this.noCheck=true;
        return _this;
      },
      genHeader :function _trc_MapCodec_genHeader() {
        var _this=this;
        var header;
        var l;
        
        header = {size: {row: _this.map.row,col: _this.map.col,w: _this.map.chipWidth,h: _this.map.chipHeight},expand: _this.map._expand||{},layerNames: [],e2c: {}};
        
        _this.entire.header=header;
        for ([l] of Tonyu.iterator2(_this.map.chipLayers,1)) {
          header.layerNames.push(l.name);
          
        }
      },
      loadHeader :function _trc_MapCodec_loadHeader() {
        var _this=this;
        var header;
        var e2c;
        var e;
        var c;
        var layerNames;
        
        header = _this.entire.header;
        
        e2c = header.e2c;
        
        _this.map.row=header.size.row;
        _this.map.col=header.size.col;
        _this.map.chipWidth=header.size.w||_this.map.chipWidth||32;
        _this.map.chipHeight=header.size.h||_this.map.chipHeight||32;
        _this.map._expand=header.expand;
        for ([e, c] of Tonyu.iterator2(e2c,2)) {
          _this.checkExprValidity(e);
          _this.c2p[c]=_this.exprToPat(e);
          
        }
        layerNames = _this.entire.header.layerNames;
        
        _this.map.chipLayers=layerNames.map((function anonymous_1615(layerName) {
          var m;
          
          m = new Tonyu.classes.kernel.Matrix;
          
          m.name=layerName;
          return m;
        }));
      },
      checkExprValidity :function _trc_MapCodec_checkExprValidity(e) {
        var _this=this;
        var p;
        var re;
        
        p = _this.exprToPat(e);
        
        if (p<0) {
          return _this;
        }
        re = _this.patToExpr(p);
        
        _this.assert(re===e,R("invalidPatExpr",e));
      },
      assert :function _trc_MapCodec_assert(b,mesg) {
        var _this=this;
        
        if (! b&&! _this.noCheck) {
          throw new Error(mesg);
          
          
        }
      },
      genChip :function _trc_MapCodec_genChip() {
        var _this=this;
        var header;
        
        header = _this.entire.header;
        
        _this.entire.chip=header.layerNames.map((function anonymous_2096(layerName) {
          var mat;
          var i;
          var row;
          var j;
          var e;
          var c;
          
          mat = [];
          
          for (i = 0;
           i<_this.map.row ; i++) {
            {
              row = [];
              
              mat.push(row);
              for (j = 0;
               j<_this.map.col ; j++) {
                {
                  e = _this.exprAt(j,i,layerName);
                  
                  c = _this.exprTocNumber(e);
                  
                  row.push(c);
                }
              }
            }
          }
          return mat;
        }));
      },
      loadChip :function _trc_MapCodec_loadChip() {
        var _this=this;
        var c;
        var layerNames;
        var k;
        var i;
        var j;
        var cNumber;
        var p;
        
        c = _this.entire.chip;
        
        layerNames = _this.entire.header.layerNames;
        
        for (k = 0;
         k<c.length ; k++) {
          {
            for (i = 0;
             i<c[k].length ; i++) {
              {
                for (j = 0;
                 j<c[k][i].length ; j++) {
                  {
                    cNumber = c[k][i][j];
                    
                    p = _this.c2p[cNumber];
                    
                    _this.map.chipLayers[k].set(j,i,p);
                  }
                }
              }
            }
          }
        }
      },
      genEntire :function _trc_MapCodec_genEntire() {
        var _this=this;
        
        _this.entire={version: 2.1};
        _this.genHeader();
        _this.genChip();
      },
      save :function _trc_MapCodec_save(file) {
        var _this=this;
        
        _this.genEntire();
        file.obj(_this.entire);
      },
      exprTocNumber :function _trc_MapCodec_exprTocNumber(expr) {
        var _this=this;
        var e2c;
        
        e2c = _this.entire.header.e2c;
        
        if (e2c[expr]!=null) {
          return e2c[expr];
        }
        e2c[expr]=_this.cNumberSeq;
        _this.cNumberSeq++;
        return e2c[expr];
      },
      exprAt :function _trc_MapCodec_exprAt(x,y,layer) {
        var _this=this;
        
        return _this.patToExpr(_this.map.getWithLayerName(layer,x,y));
      },
      patToExpr :function _trc_MapCodec_patToExpr(p) {
        var _this=this;
        var r;
        
        for ([r] of Tonyu.iterator2(_this.patVals,1)) {
          if (p>=r.value) {
            return r.name+"+"+(p-r.value);
          }
          
        }
        return "e";
      },
      exprToPat :function _trc_MapCodec_exprToPat(name) {
        var _this=this;
        var ns;
        var g;
        
        if (name==="e") {
          return - 1;
        }
        ns = name.split("+");
        
        g = Tonyu.getGlobal(ns[0]);
        
        if (g==null) {
          throw new Error(R("noSuchPat",ns[0]));
          
        }
        return g+(ns[1]-0);
      },
      load :function _trc_MapCodec_load(file) {
        var _this=this;
        
        _this.entire=file.obj();
        if (_this.entire.version>=2) {
          _this.loadVer2();
        } else {
          _this.loadVer1(_this.entire);
        }
      },
      loadVer1 :function _trc_MapCodec_loadVer1(baseData) {
        var _this=this;
        var mapTable;
        var mapOnTable;
        var mapMat;
        var mapOnMat;
        
        mapTable = baseData[0];
        
        mapOnTable = baseData[1];
        
        if (baseData[2]) {
          _this.map.chipWidth=(baseData[2]-0)||_this.map.chipWidth||32;
        }
        if (baseData[3]) {
          _this.map.chipHeight=(baseData[3]-0)||_this.map.chipHeight||32;
        }
        mapMat = new Tonyu.classes.kernel.Matrix;
        
        mapMat.fromArray(mapTable);
        mapMat.name="base";
        mapOnMat = new Tonyu.classes.kernel.Matrix;
        
        mapOnMat.fromArray(mapOnTable);
        mapOnMat.name="on";
        _this.map.chipLayers=[mapMat,mapOnMat];
        _this.map.pack();
      },
      saveVer1 :function _trc_MapCodec_saveVer1(saveDataFile) {
        var _this=this;
        var chipLayers;
        var data;
        
        chipLayers = _this.map.chipLayers;
        
        data = [chipLayers[0].toArray(),chipLayers[1].toArray(),_this.map.chipWidth,_this.map.chipHeight];
        
        saveDataFile.obj(data);
      },
      loadVer2 :function _trc_MapCodec_loadVer2() {
        var _this=this;
        
        _this.loadHeader();
        _this.loadChip();
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"ignoreCheck":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"genHeader":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loadHeader":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"checkExprValidity":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"assert":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"genChip":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loadChip":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"genEntire":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"save":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"exprTocNumber":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"exprAt":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"patToExpr":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"exprToPat":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"load":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"loadVer1":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"saveVer1":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"loadVer2":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"map":{},"resc":{},"patVals":{},"c2p":{},"cNumberSeq":{"vtype":"Number"},"entire":{},"noCheck":{},"r":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MultiLayerTouches',
  shortName: 'MultiLayerTouches',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_MultiLayerTouches_main() {
        var _this=this;
        
        "field strict";
        
        
        _this.layers = new WeakMap;
        
      },
      fiber$main :function* _trc_MultiLayerTouches_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        _this.layers = new WeakMap;
        
        
      },
      initialize :function _trc_MultiLayerTouches_initialize(param) {
        var _this=this;
        
        __superClass.apply( _this, [param]);
        if (! _this.screen) {
          _this.screen=_this.assertIs(_this.layerPath.target,Tonyu.classes.kernel.Screen);
        }
        if (! _this.layerPath) {
          _this.layerPath=_this.assertIs(_this.screen.defaultLayerPath,Tonyu.classes.kernel.LayerPath);
        }
        _this.assertEq(_this.layerPath.target,_this.screen);
      },
      add :function _trc_MultiLayerTouches_add(a) {
        var _this=this;
        var layer;
        var ts;
        
        layer = _this.screen.findLayer(a.getSpriteGroup());
        
        if (! layer) {
          return _this;
        }
        ts = _this.getOrNewTouchables(layer);
        
        if (ts.indexOf(a)<0) {
          ts.push(a);
        }
      },
      fiber$add :function* _trc_MultiLayerTouches_f_add(_thread,a) {
        var _this=this;
        var layer;
        var ts;
        
        layer = _this.screen.findLayer(a.getSpriteGroup());
        
        if (! layer) {
          return _this;
        }
        ts=yield* _this.fiber$getOrNewTouchables(_thread, layer);
        
        if (ts.indexOf(a)<0) {
          ts.push(a);
        }
        
      },
      remove :function _trc_MultiLayerTouches_remove(a) {
        var _this=this;
        var layer;
        var ts;
        var idx;
        
        layer = _this.screen.findLayer(a.getSpriteGroup());
        
        if (! layer) {
          return _this;
        }
        ts = _this.getOrNewTouchables(layer);
        
        idx = ts.indexOf(a);
        
        if (idx>=0) {
          ts.splice(idx,1);
        }
      },
      fiber$remove :function* _trc_MultiLayerTouches_f_remove(_thread,a) {
        var _this=this;
        var layer;
        var ts;
        var idx;
        
        layer = _this.screen.findLayer(a.getSpriteGroup());
        
        if (! layer) {
          return _this;
        }
        ts=yield* _this.fiber$getOrNewTouchables(_thread, layer);
        
        idx = ts.indexOf(a);
        
        if (idx>=0) {
          ts.splice(idx,1);
        }
        
      },
      getOrNewTouchables :function _trc_MultiLayerTouches_getOrNewTouchables(layer) {
        var _this=this;
        var res;
        
        if (! layer) {
          throw new Error("No layer set: "+layer);
          
        }
        res = _this.getTouchables(layer);
        
        if (res) {
          return res;
        }
        res=[];
        _this.layers.set(layer,res);
        return res;
      },
      fiber$getOrNewTouchables :function* _trc_MultiLayerTouches_f_getOrNewTouchables(_thread,layer) {
        var _this=this;
        var res;
        
        if (! layer) {
          throw new Error("No layer set: "+layer);
          
        }
        res=yield* _this.fiber$getTouchables(_thread, layer);
        
        if (res) {
          return res;
        }
        res=[];
        _this.layers.set(layer,res);
        return res;
        
      },
      getTouchables :function _trc_MultiLayerTouches_getTouchables(layer) {
        var _this=this;
        
        return _this.layers.get(layer);
      },
      fiber$getTouchables :function* _trc_MultiLayerTouches_f_getTouchables(_thread,layer) {
        var _this=this;
        
        return _this.layers.get(layer);
        
      },
      findActor :function _trc_MultiLayerTouches_findActor(shape) {
        var _this=this;
        var cands;
        var i;
        var ts;
        var localShape;
        var t;
        var c;
        var ch;
        var shape;
        var j;
        var cmp;
        function compZ(a,b) {
          var c;
          
          c = a.zOrderLayer-b.zOrderLayer;
          
          if (c) {
            return c;
          }
          return a.zOrder-b.zOrder;
        }
        cands = [];
        i = 0;
        
        for (i = 0;
         i<_this.screen.layers.length ; i++) {
          {
            let layer = _this.screen.layers[i];
            
            let slp = _this.layerPath.add(_this.screen.layers[i]);
            
            ts = _this.getTouchables(layer);
            
            if (! ts) {
              continue;
              
            }
            localShape = shape.layerPathChanged(slp);
            
            for ([t] of Tonyu.iterator2(ts,1)) {
              c = t.getTouchShape();
              
              if (c.intersects(localShape)) {
                ch = c.layerPathChanged(shape.layerPath);
                
                cands.push({actor: t,shape: ch,zOrder: t.zOrder,zOrderLayer: i,dist: _this.dist(shape.x-ch.x,shape.y-ch.y)});
                
              }
              
            }
          }
        }
        for (i = 0;
         i<cands.length ; i++) {
          {
            shape = cands[i].shape;
            
            for (j = i+1;
             j<cands.length ; j++) {
              {
                if (shape.intersects(cands[j].shape)) {
                  cmp = compZ(cands[j],cands[i]);
                  
                  if (cmp>0) {
                    cands[j].dead=true;
                    
                  }
                  if (cmp<0) {
                    cands[i].dead=true;
                    
                  }
                  
                }
              }
            }
          }
        }
        
        cands=cands.filter((function anonymous_2583(e) {
          
          return ! e.dead;
        }));
        cands.sort((function anonymous_2621(a,b) {
          
          return a.dist-b.dist;
        }));
        return cands[0]&&cands[0].actor;
      },
      fiber$findActor :function* _trc_MultiLayerTouches_f_findActor(_thread,shape) {
        var _this=this;
        var cands;
        var i;
        var ts;
        var localShape;
        var t;
        var c;
        var ch;
        var shape;
        var j;
        var cmp;
        function compZ(a,b) {
          var c;
          
          c = a.zOrderLayer-b.zOrderLayer;
          
          if (c) {
            return c;
          }
          return a.zOrder-b.zOrder;
        }
        cands = [];
        i = 0;
        
        for (i = 0;
         i<_this.screen.layers.length ; i++) {
          {
            let layer = _this.screen.layers[i];
            
            let slp = _this.layerPath.add(_this.screen.layers[i]);
            
            ts=yield* _this.fiber$getTouchables(_thread, layer);
            
            if (! ts) {
              continue;
              
            }
            localShape = shape.layerPathChanged(slp);
            
            for ([t] of Tonyu.iterator2(ts,1)) {
              c = t.getTouchShape();
              
              if (c.intersects(localShape)) {
                ch = c.layerPathChanged(shape.layerPath);
                
                cands.push({actor: t,shape: ch,zOrder: t.zOrder,zOrderLayer: i,dist: _this.dist(shape.x-ch.x,shape.y-ch.y)});
                
              }
              
            }
          }
        }
        for (i = 0;
         i<cands.length ; i++) {
          {
            shape = cands[i].shape;
            
            for (j = i+1;
             j<cands.length ; j++) {
              {
                if (shape.intersects(cands[j].shape)) {
                  cmp = compZ(cands[j],cands[i]);
                  
                  if (cmp>0) {
                    cands[j].dead=true;
                    
                  }
                  if (cmp<0) {
                    cands[i].dead=true;
                    
                  }
                  
                }
              }
            }
          }
        }
        
        cands=cands.filter((function anonymous_2583(e) {
          
          return ! e.dead;
        }));
        cands.sort((function anonymous_2621(a,b) {
          
          return a.dist-b.dist;
        }));
        return cands[0]&&cands[0].actor;
        
      },
      saveAndClear :function _trc_MultiLayerTouches_saveAndClear() {
        var _this=this;
        var saved;
        
        saved = _this.layers;
        
        _this.layers=new WeakMap;
        return saved;
      },
      fiber$saveAndClear :function* _trc_MultiLayerTouches_f_saveAndClear(_thread) {
        var _this=this;
        var saved;
        
        saved = _this.layers;
        
        _this.layers=new WeakMap;
        return saved;
        
      },
      restore :function _trc_MultiLayerTouches_restore(saved) {
        var _this=this;
        
        _this.layers=saved;
      },
      fiber$restore :function* _trc_MultiLayerTouches_f_restore(_thread,saved) {
        var _this=this;
        
        _this.layers=saved;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"add":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Actor"],"returnValue":null}},"remove":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Actor"],"returnValue":null}},"getOrNewTouchables":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getTouchables":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"findActor":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.AbstractShape"],"returnValue":null}},"saveAndClear":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"restore":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"layerPath":{"vtype":"kernel.LayerPath"},"screen":{"vtype":"kernel.Screen"},"layers":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.OneframeSprite',
  shortName: 'OneframeSprite',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_OneframeSprite_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_OneframeSprite_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_OneframeSprite_initialize(params) {
        var _this=this;
        
        _this.extend(params);
        if (_this.layer&&typeof  _this.layer.add=="function") {
          _this.layer.add(_this);
          
        } else {
          Tonyu.globals.$Sprites.add(_this);
          
        }
      },
      die :function _trc_OneframeSprite_die() {
        var _this=this;
        
      },
      fiber$die :function* _trc_OneframeSprite_f_die(_thread) {
        var _this=this;
        
        
      },
      isDead :function _trc_OneframeSprite_isDead() {
        var _this=this;
        
      },
      fiber$isDead :function* _trc_OneframeSprite_f_isDead(_thread) {
        var _this=this;
        
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"die":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isDead":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"layer":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.PanelTouchStart',
  shortName: 'PanelTouchStart',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.EventHandler,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_PanelTouchStart_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_PanelTouchStart_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      newListener :function _trc_PanelTouchStart_newListener(f) {
        var _this=this;
        var h;
        
        h = Tonyu.globals.$InputDevice.on("touchstart",(function anonymous_118(e) {
          
          e.finger.layer=_this.target;
          return f(e);
        }));
        
        return {dispose: (function anonymous_382(e) {
          
          h.remove();
        }),action: (function anonymous_442() {
          
        })};
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"newListener":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.ScreenLayer',
  shortName: 'ScreenLayer',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.EventMod],
  methods: function (__superClass) {
    return {
      main :function _trc_ScreenLayer_main() {
        var _this=this;
        
        
        
      },
      fiber$main :function* _trc_ScreenLayer_f_main(_thread) {
        var _this=this;
        
        
        
        
      },
      initialize :function _trc_ScreenLayer_initialize(p) {
        var _this=this;
        
        __superClass.apply( _this, [p]);
      },
      addSubsprite :function _trc_ScreenLayer_addSubsprite() {
        var _this=this;
        
        return _this.group.addSubsprite.apply(_this.group,arguments);
      },
      fiber$addSubsprite :function* _trc_ScreenLayer_f_addSubsprite(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        
        return _this.group.addSubsprite.apply(_this.group,_arguments);
        
      },
      all :function _trc_ScreenLayer_all() {
        var _this=this;
        
        return _this.group.all.apply(_this.group,arguments);
      },
      fiber$all :function* _trc_ScreenLayer_f_all(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        
        return _this.group.all.apply(_this.group,_arguments);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"addSubsprite":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"all":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"group":{},"screen":{},"name":{"vtype":"String"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.SpriteGroup',
  shortName: 'SpriteGroup',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_SpriteGroup_main() {
        var _this=this;
        
        
        
        
      },
      fiber$main :function* _trc_SpriteGroup_f_main(_thread) {
        var _this=this;
        
        
        
        
        
      },
      get :function _trc_SpriteGroup_get(i) {
        var _this=this;
        
        return _this.sprites[i];
      },
      fiber$get :function* _trc_SpriteGroup_f_get(_thread,i) {
        var _this=this;
        
        return _this.sprites[i];
        
      },
      addSubsprite :function _trc_SpriteGroup_addSubsprite() {
        var _this=this;
        
        return Tonyu.bindFunc(_this,_this.add).apply(_this,arguments);
      },
      fiber$addSubsprite :function* _trc_SpriteGroup_f_addSubsprite(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        
        return Tonyu.bindFunc(_this,_this.add).apply(_this,_arguments);
        
      },
      add :function _trc_SpriteGroup_add() {
        var _this=this;
        
        throw new Error("SpriteGroup::add abstract");
        
      },
      fiber$add :function* _trc_SpriteGroup_f_add(_thread) {
        var _this=this;
        
        throw new Error("SpriteGroup::add abstract");
        
        
      },
      has :function _trc_SpriteGroup_has(a) {
        var _this=this;
        
        return _this.sprites.indexOf(a)>=0;
      },
      fiber$has :function* _trc_SpriteGroup_f_has(_thread,a) {
        var _this=this;
        
        return _this.sprites.indexOf(a)>=0;
        
      },
      saveAndClear :function _trc_SpriteGroup_saveAndClear(excludes) {
        var _this=this;
        var saved;
        
        saved = _this.sprites;
        
        _this.sprites=_this.sprites.filter((function anonymous_448(s) {
          
          return excludes.indexOf(s)>=0;
        }));
        if (! saved) {
          throw new Error("Invalid saved data "+saved);
          
        }
        return saved;
      },
      fiber$saveAndClear :function* _trc_SpriteGroup_f_saveAndClear(_thread,excludes) {
        var _this=this;
        var saved;
        
        saved = _this.sprites;
        
        _this.sprites=_this.sprites.filter((function anonymous_448(s) {
          
          return excludes.indexOf(s)>=0;
        }));
        if (! saved) {
          throw new Error("Invalid saved data "+saved);
          
        }
        return saved;
        
      },
      restore :function _trc_SpriteGroup_restore(saved) {
        var _this=this;
        
        if (! saved) {
          throw new Error("Invalid data "+saved);
          
        }
        _this.sprites=saved;
      },
      fiber$restore :function* _trc_SpriteGroup_f_restore(_thread,saved) {
        var _this=this;
        
        if (! saved) {
          throw new Error("Invalid data "+saved);
          
        }
        _this.sprites=saved;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"get":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"addSubsprite":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"add":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"has":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Actor"],"returnValue":null}},"saveAndClear":{"nowait":false,"isMain":false,"vtype":{"params":["Array"],"returnValue":null}},"restore":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"sprites":{"vtype":"Array"},"transform":{"vtype":"kernel.Transform"},"name":{"vtype":"String"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.SpriteMod2D',
  shortName: 'SpriteMod2D',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.SpriteMod,Tonyu.classes.kernel.TextRectMod],
  methods: function (__superClass) {
    return {
      main :function _trc_SpriteMod2D_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_SpriteMod2D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initSpriteMod :function _trc_SpriteMod2D_initSpriteMod() {
        var _this=this;
        
        __superClass.prototype.initSpriteMod.apply( _this, []);
        _this._align=_this._align||new Tonyu.classes.kernel.Align2D();
      },
      fiber$initSpriteMod :function* _trc_SpriteMod2D_f_initSpriteMod(_thread) {
        var _this=this;
        
        (yield* __superClass.prototype.fiber$initSpriteMod.apply( _this, [_thread]));
        _this._align=_this._align||new Tonyu.classes.kernel.Align2D();
        
      },
      __setter__align :function _trc_SpriteMod2D___setter__align(v) {
        var _this=this;
        
        _this._alignVal=v;
        _this._align=new Tonyu.classes.kernel.Align2D(v);
      },
      initTransform :function _trc_SpriteMod2D_initTransform() {
        var _this=this;
        
        _this.transform=new Tonyu.classes.kernel.Transform2D(_this);
      },
      fiber$initTransform :function* _trc_SpriteMod2D_f_initTransform(_thread) {
        var _this=this;
        
        _this.transform=new Tonyu.classes.kernel.Transform2D(_this);
        
      },
      performTransform :function _trc_SpriteMod2D_performTransform(ctx) {
        var _this=this;
        
        if (_this.x!==_this.x||_this.y!==_this.y||_this.x==null||_this.y==null) {
          
          
        }
        ctx.translate(_this.x,_this.y);
        if (_this.rotation!=0) {
          ctx.rotate(_this.rotation/180*Math.PI);
          
        } else {
          ctx.rotate(_this.rotate/180*Math.PI);
          
        }
        if (typeof  _this.scaleY==="undefined") {
          ctx.scale(_this.scaleX,_this.scaleX);
          
        } else {
          ctx.scale(_this.scaleX,_this.scaleY);
          
        }
        ctx.globalAlpha=(_this.alpha<0?0:_this.alpha>255?255:_this.alpha)/255;
      },
      draw :function _trc_SpriteMod2D_draw(ctx) {
        var _this=this;
        var t;
        
        if (_this.x==null||_this.y==null||_this._isInvisible) {
          return _this;
        }
        t = _this.detectSpriteType();
        
        _this["drawAs"+t](ctx);
        if (_this.subsprites&&_this.subsprites.draw) {
          ctx.save();
          _this.performTransform(ctx);
          _this.subsprites.draw(ctx);
          ctx.restore();
          
        }
      },
      drawAsText :function _trc_SpriteMod2D_drawAsText(ctx) {
        var _this=this;
        var splitsText;
        var drawY;
        var textCount;
        var rect;
        
        ctx.save();
        splitsText = (_this.text+"").split("\n");
        
        drawY = _this.y;
        
        if (! _this.size) {
          _this.size=15;
        }
        if (! _this.fillStyle) {
          _this.fillStyle="white";
        }
        if (_this.font) {
          ctx.font=_this.size+"px "+_this.font;
        }
        ctx.fillStyle=_this.fillStyle+"";
        ctx.globalAlpha=_this.alpha/255;
        _this.height=0;
        _this.width=0;
        for (textCount = 0;
         textCount<splitsText.length ; textCount++) {
          {
            rect = _this.drawTextRect(ctx,splitsText[textCount],_this.x,drawY,_this.size,_this._align,"fill");
            
            if (_this.width<rect.w) {
              _this.width=rect.w;
            }
            _this.height+=rect.h;
            drawY+=_this.size;
          }
        }
        ctx.restore();
      },
      drawAsShape :function _trc_SpriteMod2D_drawAsShape(ctx) {
        var _this=this;
        var r;
        
        ctx.save();
        _this.performTransform(ctx);
        ctx.fillStyle=_this.fillStyle+"";
        if (_this._align.isOriginPivot) {
          if (_this.radius&&_this.radius>0) {
            ctx.beginPath();
            ctx.arc(0,0,_this.radius,0,2*Math.PI);
            ctx.fill();
            
          } else {
            ctx.fillRect(- _this.width/2,- _this.height/2,_this.width,_this.height);
            
          }
          
        } else {
          if (_this.radius&&_this.radius>0) {
            r = _this._align.getDrawRect({width: _this.radius*2,height: _this.radius*2});
            
            ctx.beginPath();
            ctx.arc(r.x,r.y,_this.radius,0,2*Math.PI);
            ctx.fill();
            
          } else {
            r = _this._align.getDrawRect(_this);
            
            ctx.fillRect(r.x-_this.width/2,r.y-_this.height/2,_this.width,_this.height);
            
          }
          
        }
        ctx.restore();
      },
      fiber$drawAsShape :function* _trc_SpriteMod2D_f_drawAsShape(_thread,ctx) {
        var _this=this;
        var r;
        
        ctx.save();
        _this.performTransform(ctx);
        ctx.fillStyle=_this.fillStyle+"";
        if (_this._align.isOriginPivot) {
          if (_this.radius&&_this.radius>0) {
            ctx.beginPath();
            ctx.arc(0,0,_this.radius,0,2*Math.PI);
            ctx.fill();
            
          } else {
            ctx.fillRect(- _this.width/2,- _this.height/2,_this.width,_this.height);
            
          }
          
        } else {
          if (_this.radius&&_this.radius>0) {
            r = _this._align.getDrawRect({width: _this.radius*2,height: _this.radius*2});
            
            ctx.beginPath();
            ctx.arc(r.x,r.y,_this.radius,0,2*Math.PI);
            ctx.fill();
            
          } else {
            r = _this._align.getDrawRect(_this);
            
            ctx.fillRect(r.x-_this.width/2,r.y-_this.height/2,_this.width,_this.height);
            
          }
          
        }
        ctx.restore();
        
      },
      drawAsCustom :function _trc_SpriteMod2D_drawAsCustom(ctx) {
        var _this=this;
        
        ctx.save();
        _this.performTransform(ctx);
        _this.p.draw(ctx);
        ctx.restore();
        if (_this.p.width*_this.p.height>0) {
          _this.width=_this.p.width;
          _this.height=_this.p.height;
          
        }
      },
      fiber$drawAsCustom :function* _trc_SpriteMod2D_f_drawAsCustom(_thread,ctx) {
        var _this=this;
        
        ctx.save();
        _this.performTransform(ctx);
        _this.p.draw(ctx);
        ctx.restore();
        if (_this.p.width*_this.p.height>0) {
          _this.width=_this.p.width;
          _this.height=_this.p.height;
          
        }
        
      },
      drawAsImage :function _trc_SpriteMod2D_drawAsImage(ctx) {
        var _this=this;
        var r;
        
        _this.prepareImage();
        if (_this.pImg) {
          ctx.save();
          _this.performTransform(ctx);
          if (_this._align.isOriginPivot) {
            ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.width/2,- _this.height/2,_this.width,_this.height);
            
          } else {
            r = _this._align.getDrawRect(_this);
            
            ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,r.x-r.width/2,r.y-r.height/2,r.width,r.height);
            
          }
          ctx.restore();
          
        }
      },
      fiber$drawAsImage :function* _trc_SpriteMod2D_f_drawAsImage(_thread,ctx) {
        var _this=this;
        var r;
        
        _this.prepareImage();
        if (_this.pImg) {
          ctx.save();
          _this.performTransform(ctx);
          if (_this._align.isOriginPivot) {
            ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.width/2,- _this.height/2,_this.width,_this.height);
            
          } else {
            r = _this._align.getDrawRect(_this);
            
            ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,r.x-r.width/2,r.y-r.height/2,r.width,r.height);
            
          }
          ctx.restore();
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"initSpriteMod":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__align":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"initTransform":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"performTransform":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"drawAsText":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"drawAsShape":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"drawAsCustom":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"drawAsImage":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"x":{},"y":{},"transform":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Sprites',
  shortName: 'Sprites',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.SpriteGroup,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Sprites_main() {
        var _this=this;
        
        "field strict";
        
        
        
      },
      fiber$main :function* _trc_Sprites_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
      },
      initialize :function _trc_Sprites_initialize(params) {
        var _this=this;
        
        __superClass.apply( _this, [params]);
        _this.sprites=[];
        _this.imageList=[];
        _this.hitWatchers=[];
        _this.sx=0;
        _this.sy=0;
        _this.objId=0;
      },
      add :function _trc_Sprites_add(s) {
        var _this=this;
        
        if (Tonyu.globals.$Boot.newLimit) {
          Tonyu.globals.$Boot.newLimitCount--;
          if (Tonyu.globals.$Boot.newLimitCount<=0) {
            throw new Error("一度にたくさんのオブジェクトを作りすぎています\n"+"       $Boot.newLimitの値を変更すると、1フレーム間に生成できる オブジェクト+スレッドの合計数 を変更できます\n"+"       $Boot.newLimit="+Tonyu.globals.$Boot.newLimit+"; // 現在の オブジェクト数+スレッド数 の限度\n"+"       update(); // 次フレームから適用されます\n"+"       [参考] https://edit.tonyu.jp/doc/limitations.html\n");
            
          }
          
        }
        if (s.__addedToSprites) {
          return _this;
        }
        if (s instanceof Tonyu.classes.kernel.PlainChar) {
          _this.t1Sprites=_this.t1Sprites||[];
          
        }
        if (_this.drawing) {
          s.draw(_this.drawing);
          return _this;
          
        }
        _this.sprites.push(s);
        if (s.__genId==null) {
          s.__genId=_this.objId;
          _this.objId++;
          
        }
        s.__addedToSprites=_this;
        return s;
      },
      fiber$add :function* _trc_Sprites_f_add(_thread,s) {
        var _this=this;
        
        if (Tonyu.globals.$Boot.newLimit) {
          Tonyu.globals.$Boot.newLimitCount--;
          if (Tonyu.globals.$Boot.newLimitCount<=0) {
            throw new Error("一度にたくさんのオブジェクトを作りすぎています\n"+"       $Boot.newLimitの値を変更すると、1フレーム間に生成できる オブジェクト+スレッドの合計数 を変更できます\n"+"       $Boot.newLimit="+Tonyu.globals.$Boot.newLimit+"; // 現在の オブジェクト数+スレッド数 の限度\n"+"       update(); // 次フレームから適用されます\n"+"       [参考] https://edit.tonyu.jp/doc/limitations.html\n");
            
          }
          
        }
        if (s.__addedToSprites) {
          return _this;
        }
        if (s instanceof Tonyu.classes.kernel.PlainChar) {
          _this.t1Sprites=_this.t1Sprites||[];
          
        }
        if (_this.drawing) {
          s.draw(_this.drawing);
          return _this;
          
        }
        _this.sprites.push(s);
        if (s.__genId==null) {
          s.__genId=_this.objId;
          _this.objId++;
          
        }
        s.__addedToSprites=_this;
        return s;
        
      },
      remove :function _trc_Sprites_remove(s) {
        var _this=this;
        var idx;
        
        idx = _this.sprites.indexOf(s);
        
        if (idx<0) {
          return _this;
        }
        _this.sprites.splice(idx,1);
        delete s.__addedToSprites;
      },
      fiber$remove :function* _trc_Sprites_f_remove(_thread,s) {
        var _this=this;
        var idx;
        
        idx = _this.sprites.indexOf(s);
        
        if (idx<0) {
          return _this;
        }
        _this.sprites.splice(idx,1);
        delete s.__addedToSprites;
        
      },
      has :function _trc_Sprites_has(s) {
        var _this=this;
        
        if (s.__addedToSprites===_this) {
          return s;
          
        }
        return false;
      },
      fiber$has :function* _trc_Sprites_f_has(_thread,s) {
        var _this=this;
        
        if (s.__addedToSprites===_this) {
          return s;
          
        }
        return false;
        
      },
      removeOneframes :function _trc_Sprites_removeOneframes(drawn) {
        var _this=this;
        var s;
        var i;
        
        
        for (i = _this.sprites.length-1;
         i>=0 ; i--) {
          {
            s=_this.sprites[i];
            if (Tonyu.is(s,Tonyu.classes.kernel.OneframeSprite)&&(! drawn||s.drawn)) {
              Tonyu.globals.$ObjectPool.poolList(s.getClassInfo().fullName).push(s);
              _this.sprites.splice(i,1);
              
            }
          }
        }
      },
      fiber$removeOneframes :function* _trc_Sprites_f_removeOneframes(_thread,drawn) {
        var _this=this;
        var s;
        var i;
        
        
        for (i = _this.sprites.length-1;
         i>=0 ; i--) {
          {
            s=_this.sprites[i];
            if (Tonyu.is(s,Tonyu.classes.kernel.OneframeSprite)&&(! drawn||s.drawn)) {
              Tonyu.globals.$ObjectPool.poolList(s.getClassInfo().fullName).push(s);
              _this.sprites.splice(i,1);
              
            }
          }
        }
        
      },
      clear :function _trc_Sprites_clear() {
        var _this=this;
        
        _this.sprites.splice(0,_this.sprites.length);
      },
      fiber$clear :function* _trc_Sprites_f_clear(_thread) {
        var _this=this;
        
        _this.sprites.splice(0,_this.sprites.length);
        
      },
      compOrder :function _trc_Sprites_compOrder(obj1,obj2) {
        var _this=this;
        var val1;
        var val2;
        
        val1 = obj1.zOrder||0;
        
        val2 = obj2.zOrder||0;
        
        if (val1>val2) {
          return - 1;
          
        } else {
          if (val1<val2) {
            return 1;
            
          } else {
            if (val1==val2) {
              if (obj1.__genId>obj2.__genId) {
                return 1;
                
              } else {
                return - 1;
                
              }
              return 0;
              
            }
          }
        }
      },
      fiber$compOrder :function* _trc_Sprites_f_compOrder(_thread,obj1,obj2) {
        var _this=this;
        var val1;
        var val2;
        
        val1 = obj1.zOrder||0;
        
        val2 = obj2.zOrder||0;
        
        if (val1>val2) {
          return - 1;
          
        } else {
          if (val1<val2) {
            return 1;
            
          } else {
            if (val1==val2) {
              if (obj1.__genId>obj2.__genId) {
                return 1;
                
              } else {
                return - 1;
                
              }
              return 0;
              
            }
          }
        }
        
      },
      draw :function _trc_Sprites_draw(ctx,camera) {
        var _this=this;
        var orderArray;
        
        ctx.save();
        orderArray = [];
        
        if (_this.t1Sprites) {
          _this.sprites.forEach((function anonymous_2393(s) {
            
            if (s instanceof Tonyu.classes.kernel.PlainChar) {
              s.draw();
              
            }
          }));
          _this.sprites.forEach((function anonymous_2522(s) {
            
            if (s instanceof Tonyu.classes.kernel.PlainChar) {
              
              
            } else {
              orderArray.push(s);
            }
          }));
          
        } else {
          orderArray=_this.sprites.slice();
          
        }
        orderArray.sort(Tonyu.bindFunc(_this,_this.compOrder));
        ctx.translate(- _this.sx,- _this.sy);
        _this.drawing=ctx;
        orderArray.forEach((function anonymous_2786(s) {
          
          s.draw(ctx,camera);
        }));
        _this.drawing=null;
        ctx.restore();
      },
      fiber$draw :function* _trc_Sprites_f_draw(_thread,ctx,camera) {
        var _this=this;
        var orderArray;
        
        ctx.save();
        orderArray = [];
        
        if (_this.t1Sprites) {
          _this.sprites.forEach((function anonymous_2393(s) {
            
            if (s instanceof Tonyu.classes.kernel.PlainChar) {
              s.draw();
              
            }
          }));
          _this.sprites.forEach((function anonymous_2522(s) {
            
            if (s instanceof Tonyu.classes.kernel.PlainChar) {
              
              
            } else {
              orderArray.push(s);
            }
          }));
          
        } else {
          orderArray=_this.sprites.slice();
          
        }
        orderArray.sort(Tonyu.bindFunc(_this,_this.compOrder));
        ctx.translate(- _this.sx,- _this.sy);
        _this.drawing=ctx;
        orderArray.forEach((function anonymous_2786(s) {
          
          s.draw(ctx,camera);
        }));
        _this.drawing=null;
        ctx.restore();
        
      },
      checkHit :function _trc_Sprites_checkHit() {
        var _this=this;
        
        _this.hitWatchers.forEach((function anonymous_2952(w) {
          
          _this.sprites.forEach((function anonymous_2992(a) {
            var a_owner;
            
            a_owner = a;
            
            if (! (a_owner instanceof w.A)) {
              return _this;
            }
            _this.sprites.forEach((function anonymous_3175(b) {
              var b_owner;
              
              b_owner = b;
              
              if (a===b) {
                return _this;
              }
              if (! (b_owner instanceof w.B)) {
                return _this;
              }
              if (a.crashTo1(b)) {
                w.h(a_owner,b_owner);
                
              }
            }));
          }));
        }));
      },
      fiber$checkHit :function* _trc_Sprites_f_checkHit(_thread) {
        var _this=this;
        
        _this.hitWatchers.forEach((function anonymous_2952(w) {
          
          _this.sprites.forEach((function anonymous_2992(a) {
            var a_owner;
            
            a_owner = a;
            
            if (! (a_owner instanceof w.A)) {
              return _this;
            }
            _this.sprites.forEach((function anonymous_3175(b) {
              var b_owner;
              
              b_owner = b;
              
              if (a===b) {
                return _this;
              }
              if (! (b_owner instanceof w.B)) {
                return _this;
              }
              if (a.crashTo1(b)) {
                w.h(a_owner,b_owner);
                
              }
            }));
          }));
        }));
        
      },
      watchHit :function _trc_Sprites_watchHit(typeA,typeB,onHit) {
        var _this=this;
        var p;
        
        p = {A: typeA,B: typeB,h: onHit};
        
        _this.hitWatchers.push(p);
      },
      fiber$watchHit :function* _trc_Sprites_f_watchHit(_thread,typeA,typeB,onHit) {
        var _this=this;
        var p;
        
        p = {A: typeA,B: typeB,h: onHit};
        
        _this.hitWatchers.push(p);
        
      },
      drawGrid :function _trc_Sprites_drawGrid(c) {
        var _this=this;
        var ctx;
        var i;
        
        ctx = c.getContext("2d");
        
        ctx.textBaseline="top";
        ctx.save();
        ctx.strokeStyle="rgb(40,100,200)";
        for (i = 0;
         i<c.width ; i+=10) {
          {
            ctx.beginPath();
            ctx.lineWidth=(i%100==0?4:1);
            ctx.moveTo(i,0);
            ctx.lineTo(i,c.height);
            ctx.closePath();
            ctx.stroke();
          }
        }
        for (i = 0;
         i<c.height ; i+=10) {
          {
            ctx.beginPath();
            ctx.lineWidth=(i%100==0?4:1);
            ctx.moveTo(0,i);
            ctx.lineTo(c.width,i);
            ctx.closePath();
            ctx.stroke();
          }
        }
        ctx.fillStyle="white";
        ctx.font="15px monospaced";
        for (i = 100;
         i<c.width ; i+=100) {
          {
            ctx.fillText(i,i,0);
          }
        }
        for (i = 100;
         i<c.height ; i+=100) {
          {
            ctx.fillText(i,0,i);
          }
        }
        ctx.restore();
      },
      fiber$drawGrid :function* _trc_Sprites_f_drawGrid(_thread,c) {
        var _this=this;
        var ctx;
        var i;
        
        ctx = c.getContext("2d");
        
        ctx.textBaseline="top";
        ctx.save();
        ctx.strokeStyle="rgb(40,100,200)";
        for (i = 0;
         i<c.width ; i+=10) {
          {
            ctx.beginPath();
            ctx.lineWidth=(i%100==0?4:1);
            ctx.moveTo(i,0);
            ctx.lineTo(i,c.height);
            ctx.closePath();
            ctx.stroke();
          }
        }
        for (i = 0;
         i<c.height ; i+=10) {
          {
            ctx.beginPath();
            ctx.lineWidth=(i%100==0?4:1);
            ctx.moveTo(0,i);
            ctx.lineTo(c.width,i);
            ctx.closePath();
            ctx.stroke();
          }
        }
        ctx.fillStyle="white";
        ctx.font="15px monospaced";
        for (i = 100;
         i<c.width ; i+=100) {
          {
            ctx.fillText(i,i,0);
          }
        }
        for (i = 100;
         i<c.height ; i+=100) {
          {
            ctx.fillText(i,0,i);
          }
        }
        ctx.restore();
        
      },
      scrollTo :function _trc_Sprites_scrollTo(scrollX,scrollY) {
        var _this=this;
        
        _this.sx=scrollX;
        _this.sy=scrollY;
      },
      fiber$scrollTo :function* _trc_Sprites_f_scrollTo(_thread,scrollX,scrollY) {
        var _this=this;
        
        _this.sx=scrollX;
        _this.sy=scrollY;
        
      },
      all :function _trc_Sprites_all(c) {
        var _this=this;
        var res;
        
        res = new Tonyu.classes.kernel.TQuery;
        
        if (arguments.length>0&&typeof  c!="function") {
          return res;
          
        }
        _this.sprites.forEach((function anonymous_4788(s) {
          
          if (s===_this) {
            return _this;
          }
          if (! c||s instanceof c) {
            res.push(s);
            
          }
        }));
        return res;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"add":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"remove":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"has":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Actor"],"returnValue":null}},"removeOneframes":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"clear":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"compOrder":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"draw":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"checkHit":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"watchHit":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"drawGrid":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"scrollTo":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"all":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"imageList":{},"hitWatchers":{},"objId":{},"t1Sprites":{},"drawing":{},"sx":{},"sy":{},"defaultLayerPath":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Sprites3D',
  shortName: 'Sprites3D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.SpriteGroup,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Sprites3D_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_Sprites3D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      initialize :function _trc_Sprites3D_initialize(p) {
        var _this=this;
        
        __superClass.apply( _this, [p]);
        _this.sprites=[];
        _this.transform=_this.transform||new Tonyu.classes.kernel.Transform;
      },
      add :function _trc_Sprites3D_add(a) {
        var _this=this;
        var curLayer;
        
        curLayer = a.getSpriteGroup();
        
        if (curLayer) {
          curLayer.remove(a);
          
        }
        if (! a.transform.parent) {
          a.transform.parent=_this.transform;
          
        } else {
          a.transform.changeParent(_this.transform);
          
        }
        _this.sprites.push(a);
        a.__addedToSprites=_this;
      },
      fiber$add :function* _trc_Sprites3D_f_add(_thread,a) {
        var _this=this;
        var curLayer;
        
        curLayer = a.getSpriteGroup();
        
        if (curLayer) {
          curLayer.remove(a);
          
        }
        if (! a.transform.parent) {
          a.transform.parent=_this.transform;
          
        } else {
          a.transform.changeParent(_this.transform);
          
        }
        _this.sprites.push(a);
        a.__addedToSprites=_this;
        
      },
      draw3D :function _trc_Sprites3D_draw3D(ctx) {
        var _this=this;
        var s;
        
        for ([s] of Tonyu.iterator2(_this.sprites,1)) {
          s.draw3D(ctx);
          
        }
      },
      fiber$draw3D :function* _trc_Sprites3D_f_draw3D(_thread,ctx) {
        var _this=this;
        var s;
        
        for ([s] of Tonyu.iterator2(_this.sprites,1)) {
          s.draw3D(ctx);
          
        }
        
      },
      remove :function _trc_Sprites3D_remove(s) {
        var _this=this;
        var idx;
        
        idx = _this.sprites.indexOf(s);
        
        if (idx<0) {
          return _this;
        }
        _this.sprites.splice(idx,1);
        delete s.__addedToSprites;
      },
      all :function _trc_Sprites3D_all(c) {
        var _this=this;
        var res;
        
        res = new Tonyu.classes.kernel.TQuery;
        
        if (arguments.length>0&&typeof  c!="function") {
          return res;
          
        }
        _this.sprites.forEach((function anonymous_1131(s) {
          
          if (s===_this) {
            return _this;
          }
          if (! c||s instanceof c) {
            res.push(s);
            
          }
        }));
        return res;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"add":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Actor3D"],"returnValue":null}},"draw3D":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Context3D"],"returnValue":null}},"remove":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"all":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.M_T2Room',
  shortName: 'M_T2Room',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.EventMod],
  methods: function (__superClass) {
    return {
      main :function _trc_M_T2Room_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_M_T2Room_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      enter :function _trc_M_T2Room_enter() {
        var _this=this;
        
        return new Promise((function anonymous_182(s,e) {
          
          _this.m=new Tonyu.classes.kernel.T2WebSocket();
          _this.m.on("open",(function anonymous_243() {
            
          }));
          _this.m.on("error",e);
          _this.m.on("message",(function anonymous_306(me) {
            var data;
            var i;
            var newMember;
            var leftMember;
            
            data = me.data;
            
            if (data) {
              switch (data.mes) {
              case "_start":
                _this.myId=data.playerNo;
                _this.members=[];
                for (i = 0;
                 i<data.playerCnt ; i++) {
                  {
                    _this.members.push({id: i});
                  }
                }
                _this.keepAlive();
                s(_this);
                break;
                
              case "_connection":
                newMember = {id: data.playerNo};
                
                if (! _this.members.some((function anonymous_857(m) {
                  
                  return m.id===newMember.id;
                }))) {
                  _this.members.push(newMember);
                  _this.fireEvent("member_join",newMember);
                  
                }
                break;
                
              case "_close":
                for (i = _this.members.length-1;
                 i>=0 ; i--) {
                  {
                    if (_this.members[i].id===data.playerNo) {
                      leftMember = _this.members.splice(i,1);
                      
                      _this.fireEvent("member_leave",leftMember[0]);
                      
                    }
                  }
                }
                break;
                
              default:
                if (data[_this.SYM_CLIENTID]!=null) {
                  me=_this.cloneEvent(me);
                  me.clientId=data[_this.SYM_CLIENTID];
                  delete data[_this.SYM_CLIENTID];
                  
                }
                _this.fireEvent("message",me);
              }
              
            }
          }));
          _this.m.connect(_this.url);
        }));
      },
      fiber$enter :function* _trc_M_T2Room_f_enter(_thread) {
        var _this=this;
        
        return new Promise((function anonymous_182(s,e) {
          
          _this.m=new Tonyu.classes.kernel.T2WebSocket();
          _this.m.on("open",(function anonymous_243() {
            
          }));
          _this.m.on("error",e);
          _this.m.on("message",(function anonymous_306(me) {
            var data;
            var i;
            var newMember;
            var leftMember;
            
            data = me.data;
            
            if (data) {
              switch (data.mes) {
              case "_start":
                _this.myId=data.playerNo;
                _this.members=[];
                for (i = 0;
                 i<data.playerCnt ; i++) {
                  {
                    _this.members.push({id: i});
                  }
                }
                _this.keepAlive();
                s(_this);
                break;
                
              case "_connection":
                newMember = {id: data.playerNo};
                
                if (! _this.members.some((function anonymous_857(m) {
                  
                  return m.id===newMember.id;
                }))) {
                  _this.members.push(newMember);
                  _this.fireEvent("member_join",newMember);
                  
                }
                break;
                
              case "_close":
                for (i = _this.members.length-1;
                 i>=0 ; i--) {
                  {
                    if (_this.members[i].id===data.playerNo) {
                      leftMember = _this.members.splice(i,1);
                      
                      _this.fireEvent("member_leave",leftMember[0]);
                      
                    }
                  }
                }
                break;
                
              default:
                if (data[_this.SYM_CLIENTID]!=null) {
                  me=_this.cloneEvent(me);
                  me.clientId=data[_this.SYM_CLIENTID];
                  delete data[_this.SYM_CLIENTID];
                  
                }
                _this.fireEvent("message",me);
              }
              
            }
          }));
          _this.m.connect(_this.url);
        }));
        
      },
      close :function _trc_M_T2Room_close() {
        var _this=this;
        
        _this.m.close();
      },
      fiber$close :function* _trc_M_T2Room_f_close(_thread) {
        var _this=this;
        
        _this.m.close();
        
      },
      getMembers :function _trc_M_T2Room_getMembers() {
        var _this=this;
        
        return Promise.resolve(_this.members);
      },
      fiber$getMembers :function* _trc_M_T2Room_f_getMembers(_thread) {
        var _this=this;
        
        return Promise.resolve(_this.members);
        
      },
      cloneEvent :function _trc_M_T2Room_cloneEvent(ev) {
        var _this=this;
        
        return Object.assign({},ev);
      },
      fiber$cloneEvent :function* _trc_M_T2Room_f_cloneEvent(_thread,ev) {
        var _this=this;
        
        return Object.assign({},ev);
        
      },
      send :function _trc_M_T2Room_send(mesg) {
        var _this=this;
        
        mesg=_this.cloneEvent(mesg);
        mesg[_this.SYM_CLIENTID]=_this.myId;
        _this.m.send(mesg);
        _this.keepAlive();
      },
      fiber$send :function* _trc_M_T2Room_f_send(_thread,mesg) {
        var _this=this;
        
        mesg=(yield* _this.fiber$cloneEvent(_thread, mesg));
        mesg[_this.SYM_CLIENTID]=_this.myId;
        _this.m.send(mesg);
        (yield* _this.fiber$keepAlive(_thread));
        
      },
      keepAlive :function _trc_M_T2Room_keepAlive() {
        var _this=this;
        
        if (_this.timer) {
          clearTimeout(_this.timer);
        }
        _this.timer=setTimeout((function anonymous_2105() {
          
          _this.send({type: "keepalive"});
        }),25*1000);
      },
      fiber$keepAlive :function* _trc_M_T2Room_f_keepAlive(_thread) {
        var _this=this;
        
        if (_this.timer) {
          clearTimeout(_this.timer);
        }
        _this.timer=setTimeout((function anonymous_2105() {
          
          _this.send({type: "keepalive"});
        }),25*1000);
        
      },
      __getter__SYM_CLIENTID :function _trc_M_T2Room___getter__SYM_CLIENTID() {
        var _this=this;
        
        return "SYM_CLIENTID";
      },
      __getter__url :function _trc_M_T2Room___getter__url() {
        var _this=this;
        var wsProtocol;
        var wsHost;
        var wsPathName;
        var wsPort;
        var wsURL;
        
        wsProtocol = "wss";
        
        wsHost = "t2ws.mkbcr.net";
        
        wsPathName = _this.info.key;
        
        wsPort = 443;
        
        wsURL = wsProtocol+"://"+wsHost+":"+wsPort+"/"+wsPathName+"__"+_this.name;
        
        return wsURL;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"enter":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"close":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getMembers":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"cloneEvent":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"send":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"keepAlive":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__SYM_CLIENTID":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__url":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"m":{},"name":{},"info":{},"myId":{},"members":{},"timer":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.M_T2Web',
  shortName: 'M_T2Web',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_M_T2Web_main() {
        var _this=this;
        
        "field strict";
        
        
      },
      fiber$main :function* _trc_M_T2Web_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
      },
      connect :function _trc_M_T2Web_connect() {
        var _this=this;
        
        return Promise.resolve(_this);
      },
      fiber$connect :function* _trc_M_T2Web_f_connect(_thread) {
        var _this=this;
        
        return Promise.resolve(_this);
        
      },
      enterRoom :function _trc_M_T2Web_enterRoom(name) {
        var _this=this;
        var room;
        
        room = new Tonyu.classes.kernel.M_T2Room({info: _this.info,name: name});
        
        return room.enter();
      },
      fiber$enterRoom :function* _trc_M_T2Web_f_enterRoom(_thread,name) {
        var _this=this;
        var room;
        
        room = new Tonyu.classes.kernel.M_T2Room({info: _this.info,name: name});
        
        return room.enter();
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"connect":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"enterRoom":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"m":{},"info":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ScaledroneImpl',
  shortName: 'ScaledroneImpl',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ScaledroneImpl_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_ScaledroneImpl_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      loadScript :function _trc_ScaledroneImpl_loadScript() {
        var _this=this;
        
        if (typeof  Scaledrone==="undefined") {
          return $.getScript("https://cdn.scaledrone.com/scaledrone.min.js");
          
        } else {
          return Promise.resolve();
          
        }
      },
      fiber$loadScript :function* _trc_ScaledroneImpl_f_loadScript(_thread) {
        var _this=this;
        
        if (typeof  Scaledrone==="undefined") {
          return $.getScript("https://cdn.scaledrone.com/scaledrone.min.js");
          
        } else {
          return Promise.resolve();
          
        }
        
      },
      connect :function _trc_ScaledroneImpl_connect() {
        var _this=this;
        
        return _this.loadScript().then((function anonymous_344() {
          
          console.log("KEY",_this.info.key);
          _this.drone=new Scaledrone(_this.info.key);
          return _this;
        }));
      },
      fiber$connect :function* _trc_ScaledroneImpl_f_connect(_thread) {
        var _this=this;
        
        return _this.loadScript().then((function anonymous_344() {
          
          console.log("KEY",_this.info.key);
          _this.drone=new Scaledrone(_this.info.key);
          return _this;
        }));
        
      },
      newRoom :function _trc_ScaledroneImpl_newRoom(name) {
        var _this=this;
        
        return _this.enterRoom(name);
      },
      fiber$newRoom :function* _trc_ScaledroneImpl_f_newRoom(_thread,name) {
        var _this=this;
        
        return yield* _this.fiber$enterRoom(_thread, name);
        
        
      },
      enterRoom :function _trc_ScaledroneImpl_enterRoom(name) {
        var _this=this;
        var observable;
        var res;
        
        return new Promise((function anonymous_553(s,e) {
          var observable;
          var res;
          
          observable = true;
          
          console.log("clientId",_this.drone.clientId);
          res = new Tonyu.classes.kernel.ScaledroneRoom({drone: _this.drone,observable: observable,name: name,myId: _this.drone.clientId});
          
          res.on('open',(function anonymous_743(error) {
            
            console.log("coned",error);
            if (error) {
              return e(error);
              
            }
            s(res);
          }));
        }));
      },
      fiber$enterRoom :function* _trc_ScaledroneImpl_f_enterRoom(_thread,name) {
        var _this=this;
        var observable;
        var res;
        
        return new Promise((function anonymous_553(s,e) {
          var observable;
          var res;
          
          observable = true;
          
          console.log("clientId",_this.drone.clientId);
          res = new Tonyu.classes.kernel.ScaledroneRoom({drone: _this.drone,observable: observable,name: name,myId: _this.drone.clientId});
          
          res.on('open',(function anonymous_743(error) {
            
            console.log("coned",error);
            if (error) {
              return e(error);
              
            }
            s(res);
          }));
        }));
        
      },
      initialize :function _trc_ScaledroneImpl_initialize(params) {
        var _this=this;
        
        __superClass.apply( _this, [params]);
        if (! _this.info) {
          throw new Error("Info is not set");
          
        }
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"loadScript":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"connect":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"newRoom":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"enterRoom":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"info":{},"drone":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ScaledroneRoom',
  shortName: 'ScaledroneRoom',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.EventMod],
  methods: function (__superClass) {
    return {
      main :function _trc_ScaledroneRoom_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_ScaledroneRoom_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      __getter__rawName :function _trc_ScaledroneRoom___getter__rawName() {
        var _this=this;
        
        return (_this.observable?"observable-":"")+_this.name;
      },
      initialize :function _trc_ScaledroneRoom_initialize(params) {
        var _this=this;
        
        __superClass.apply( _this, [params]);
        _this.room=_this.drone.subscribe(_this.rawName);
        _this.room.on("open",(function anonymous_267(error) {
          
          _this.fireEvent("open",error);
        }));
        _this.room.on("message",(function anonymous_341(mesg) {
          
          _this.fireEvent("message",mesg);
        }));
        _this.room.on("members",(function anonymous_417(members) {
          
          _this.members=members;
          _this.fireEvent("members_list",members);
        }));
        _this.room.on('member_join',(function anonymous_537(member) {
          
          _this.members.push(member);
          _this.fireEvent("member_join",member);
        }));
        _this.room.on('member_leave',(function anonymous_668(member) {
          var i;
          
          for (i = _this.members.length-1;
           i>=0 ; i--) {
            {
              if (member.id===_this.members[i].id) {
                _this.members.splice(i,1);
                
              }
            }
          }
          _this.fireEvent("member_leave",member);
        }));
      },
      close :function _trc_ScaledroneRoom_close() {
        var _this=this;
        
        _this.drone.close();
      },
      fiber$close :function* _trc_ScaledroneRoom_f_close(_thread) {
        var _this=this;
        
        _this.drone.close();
        
      },
      send :function _trc_ScaledroneRoom_send(message) {
        var _this=this;
        
        return _this.drone.publish({room: _this.rawName,message: message});
      },
      fiber$send :function* _trc_ScaledroneRoom_f_send(_thread,message) {
        var _this=this;
        
        return _this.drone.publish({room: _this.rawName,message: message});
        
      },
      getMembers :function _trc_ScaledroneRoom_getMembers() {
        var _this=this;
        
        if (_this.members) {
          return Promise.resolve(_this.members);
          
        }
        return new Promise((function anonymous_1151(s) {
          
          _this.on("members_list",(function anonymous_1185(members) {
            
            s(members);
          }));
        }));
      },
      fiber$getMembers :function* _trc_ScaledroneRoom_f_getMembers(_thread) {
        var _this=this;
        
        if (_this.members) {
          return Promise.resolve(_this.members);
          
        }
        return new Promise((function anonymous_1151(s) {
          
          _this.on("members_list",(function anonymous_1185(members) {
            
            s(members);
          }));
        }));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"__getter__rawName":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"close":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"send":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getMembers":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"drone":{},"room":{},"name":{},"myId":{},"members":{},"observable":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T2WebSocket',
  shortName: 'T2WebSocket',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.EventMod],
  methods: function (__superClass) {
    return {
      main :function _trc_T2WebSocket_main() {
        var _this=this;
        
        "field strict";
        _this.sock = null;
        
      },
      fiber$main :function* _trc_T2WebSocket_f_main(_thread) {
        var _this=this;
        
        "field strict";
        _this.sock = null;
        
        
      },
      connect :function _trc_T2WebSocket_connect(url) {
        var _this=this;
        var e;
        
        if (_this.sock) {
          return _this;
        }
        try {
          _this.sock=new WebSocket(url);
          _this.sock.addEventListener("open",(function anonymous_501(e) {
            
            console.log("Connected to ",url);
            _this.fireEvent("open",e);
          }));
          _this.sock.addEventListener("message",(function anonymous_644(e) {
            
            _this.recv(e);
          }));
          _this.sock.addEventListener("close",(function anonymous_765(e) {
            
            _this.fireEvent("close",e);
            _this.sock=null;
          }));
          _this.sock.addEventListener("error",(function anonymous_886(e) {
            
            _this.fireEvent("error",e);
          }));
          
        } catch (e) {
          _this.fireEvent("error",e);
          console.log("websocket connect error",e);
          
        }
      },
      fiber$connect :function* _trc_T2WebSocket_f_connect(_thread,url) {
        var _this=this;
        var e;
        
        if (_this.sock) {
          return _this;
        }
        try {
          _this.sock=new WebSocket(url);
          _this.sock.addEventListener("open",(function anonymous_501(e) {
            
            console.log("Connected to ",url);
            _this.fireEvent("open",e);
          }));
          _this.sock.addEventListener("message",(function anonymous_644(e) {
            
            _this.recv(e);
          }));
          _this.sock.addEventListener("close",(function anonymous_765(e) {
            
            _this.fireEvent("close",e);
            _this.sock=null;
          }));
          _this.sock.addEventListener("error",(function anonymous_886(e) {
            
            _this.fireEvent("error",e);
          }));
          
        } catch (e) {
          _this.fireEvent("error",e);
          console.log("websocket connect error",e);
          
        }
        
      },
      close :function _trc_T2WebSocket_close() {
        var _this=this;
        
        if (_this.sock) {
          _this.sock.close();
          _this.sock=null;
          
        }
      },
      fiber$close :function* _trc_T2WebSocket_f_close(_thread) {
        var _this=this;
        
        if (_this.sock) {
          _this.sock.close();
          _this.sock=null;
          
        }
        
      },
      send :function _trc_T2WebSocket_send(d) {
        var _this=this;
        
        if (_this.sock&&_this.sock.readyState==1) {
          if (Tonyu.is(d,String)||Tonyu.is(d,ArrayBuffer)||Tonyu.is(d,Blob)||_this._isTypedArray(d)) {
            _this.sock.send(d);
            
          } else {
            if (Tonyu.is(d,Object)) {
              _this.sock.send(JSON.stringify(d));
              
            } else {
              _this.sock.send(d);
              
            }
          }
          
        } else {
          console.log("Websocket not ready",_this.sock);
          
        }
      },
      fiber$send :function* _trc_T2WebSocket_f_send(_thread,d) {
        var _this=this;
        
        if (_this.sock&&_this.sock.readyState==1) {
          if (Tonyu.is(d,String)||Tonyu.is(d,ArrayBuffer)||Tonyu.is(d,Blob)||_this._isTypedArray(d)) {
            _this.sock.send(d);
            
          } else {
            if (Tonyu.is(d,Object)) {
              _this.sock.send(JSON.stringify(d));
              
            } else {
              _this.sock.send(d);
              
            }
          }
          
        } else {
          console.log("Websocket not ready",_this.sock);
          
        }
        
      },
      recv :function _trc_T2WebSocket_recv(e) {
        var _this=this;
        var d;
        var obj;
        var ne;
        var e;
        
        try {
          d = e.data;
          
          obj = JSON.parse(d);
          
          ne = Object.assign({},e);
          
          ne.data=obj;
          _this.fireEvent("message",ne);
          
        } catch (e) {
          _this.fireEvent("message",e);
          
        }
      },
      fiber$recv :function* _trc_T2WebSocket_f_recv(_thread,e) {
        var _this=this;
        var d;
        var obj;
        var ne;
        var e;
        
        try {
          d = e.data;
          
          obj = JSON.parse(d);
          
          ne = Object.assign({},e);
          
          ne.data=obj;
          _this.fireEvent("message",ne);
          
        } catch (e) {
          _this.fireEvent("message",e);
          
        }
        
      },
      _isTypedArray :function _trc_T2WebSocket__isTypedArray(value) {
        var _this=this;
        
        return ArrayBuffer.isView(value)&&! (value instanceof DataView);
      },
      fiber$_isTypedArray :function* _trc_T2WebSocket_f__isTypedArray(_thread,value) {
        var _this=this;
        
        return ArrayBuffer.isView(value)&&! (value instanceof DataView);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"connect":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"close":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"send":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"recv":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"_isTypedArray":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"sock":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.WebSocket',
  shortName: 'WebSocket',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_WebSocket_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_WebSocket_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      getConnectionInfo :function _trc_WebSocket_getConnectionInfo() {
        var _this=this;
        var re;
        
        return Tonyu.globals.$API.info().then((function anonymous_110(r) {
          var re;
          
          re = r.webSocket;
          
          if (! re) {
            throw new Error("Websocket の設定をしてください．ウィンドウ→プロジェクトオプション→API");
            
            
          }
          return re;
        }));
      },
      fiber$getConnectionInfo :function* _trc_WebSocket_f_getConnectionInfo(_thread) {
        var _this=this;
        var re;
        
        return Tonyu.globals.$API.info().then((function anonymous_110(r) {
          var re;
          
          re = r.webSocket;
          
          if (! re) {
            throw new Error("Websocket の設定をしてください．ウィンドウ→プロジェクトオプション→API");
            
            
          }
          return re;
        }));
        
      },
      connect :function _trc_WebSocket_connect() {
        var _this=this;
        var services;
        var S;
        
        if (_this.impl) {
          return Promise.resolve(_this.impl);
        }
        services = {Scaledrone: Tonyu.classes.kernel.ScaledroneImpl,T2WebSocket: Tonyu.classes.kernel.M_T2Web};
        
        return _this.getConnectionInfo().then((function anonymous_438(info) {
          var S;
          
          S = services[info.service];
          
          if (! S) {
            throw new Error(info.service+"には対応していません");
            
          }
          _this.impl=new S({info: info});
          return _this.impl.connect();
        }));
      },
      fiber$connect :function* _trc_WebSocket_f_connect(_thread) {
        var _this=this;
        var services;
        var S;
        
        if (_this.impl) {
          return Promise.resolve(_this.impl);
        }
        services = {Scaledrone: Tonyu.classes.kernel.ScaledroneImpl,T2WebSocket: Tonyu.classes.kernel.M_T2Web};
        
        return _this.getConnectionInfo().then((function anonymous_438(info) {
          var S;
          
          S = services[info.service];
          
          if (! S) {
            throw new Error(info.service+"には対応していません");
            
          }
          _this.impl=new S({info: info});
          return _this.impl.connect();
        }));
        
      },
      enterRoom :function _trc_WebSocket_enterRoom(name) {
        var _this=this;
        
        return _this.connect().then((function anonymous_750() {
          
          return _this.impl.enterRoom(name);
        })).then((function anonymous_806(r) {
          
          r.webSocket=_this;
          return r;
        }));
      },
      fiber$enterRoom :function* _trc_WebSocket_f_enterRoom(_thread,name) {
        var _this=this;
        
        return _this.connect().then((function anonymous_750() {
          
          return _this.impl.enterRoom(name);
        })).then((function anonymous_806(r) {
          
          r.webSocket=_this;
          return r;
        }));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"getConnectionInfo":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"connect":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"enterRoom":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"impl":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Beep',
  shortName: 'Beep',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Beep_main() {
        var _this=this;
        
        "field strict";
        
        
        
        
        
      },
      fiber$main :function* _trc_Beep_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        
      },
      init :function _trc_Beep_init() {
        var _this=this;
        var chd;
        var i;
        
        if (_this.buffer) {
          return true;
        }
        if (! _this.context) {
          return false;
        }
        _this.sampleRate=_this.context.sampleRate;
        _this.buflen=_this.buflen||1024;
        _this.buffer=_this.context.createBuffer(1,_this.buflen,_this.sampleRate);
        chd = _this.buffer.getChannelData(0);
        
        for (i = 0;
         i<_this.buflen ; i++) {
          {
            chd[i]=i<_this.buflen/2?- 0.05:0.05;
          }
        }
        _this.delay=_this.delay||2/60;
        _this.gainNode=_this.context.createGain();
        _this.gainNode.connect(_this.context.destination);
        _this.gainNode.gain.value=0;
        _this.createSource();
        _this.source.start();
        _this.mmTimer=_this.mmTimer||Tonyu.globals.$sound.mmTimer;
        if (_this.mmTimer) {
          _this.mmTimer.on("beforeInterval",(function anonymous_735(e) {
            
            _this.time=e.time;
          }));
        }
        _this.time=_this.context.currentTime;
        Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.die));
        return true;
      },
      fiber$init :function* _trc_Beep_f_init(_thread) {
        var _this=this;
        var chd;
        var i;
        
        if (_this.buffer) {
          return true;
        }
        if (! _this.context) {
          return false;
        }
        _this.sampleRate=_this.context.sampleRate;
        _this.buflen=_this.buflen||1024;
        _this.buffer=_this.context.createBuffer(1,_this.buflen,_this.sampleRate);
        chd = _this.buffer.getChannelData(0);
        
        for (i = 0;
         i<_this.buflen ; i++) {
          {
            chd[i]=i<_this.buflen/2?- 0.05:0.05;
          }
        }
        _this.delay=_this.delay||2/60;
        _this.gainNode=_this.context.createGain();
        _this.gainNode.connect(_this.context.destination);
        _this.gainNode.gain.value=0;
        (yield* _this.fiber$createSource(_thread));
        _this.source.start();
        _this.mmTimer=_this.mmTimer||Tonyu.globals.$sound.mmTimer;
        if (_this.mmTimer) {
          _this.mmTimer.on("beforeInterval",(function anonymous_735(e) {
            
            _this.time=e.time;
          }));
        }
        _this.time=_this.context.currentTime;
        Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.die));
        return true;
        
      },
      createSource :function _trc_Beep_createSource() {
        var _this=this;
        
        _this.source=_this.context.createBufferSource();
        _this.source.buffer=_this.buffer;
        _this.source.loop=true;
        _this.source.connect(_this.gainNode);
      },
      fiber$createSource :function* _trc_Beep_f_createSource(_thread) {
        var _this=this;
        
        _this.source=_this.context.createBufferSource();
        _this.source.buffer=_this.buffer;
        _this.source.loop=true;
        _this.source.connect(_this.gainNode);
        
      },
      initScaleTable :function _trc_Beep_initScaleTable() {
        var _this=this;
        
        return Tonyu.globals.$sound.m2t=Tonyu.globals.$sound.m2t||[3421,3228,3047,2876,2715,2562,2419,2283,2155,2034,1920,1812,1711,1614,1524,1438,1358,1281,1210,1142,1078,1017,960,906,855,807,762,719,679,641,605,571,539,509,480,453,428,404,381,360,339,320,302,285,269,254,240,227,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,76,71,67,64,60,57,53,50,48,45,42,40,38,36,34,32,30,28,27,25,24,22,21,20,19,18,17,16,15,14].map((function anonymous_1701(e) {
          
          return 111860.78125/e;
        }));
      },
      fiber$initScaleTable :function* _trc_Beep_f_initScaleTable(_thread) {
        var _this=this;
        
        return Tonyu.globals.$sound.m2t=Tonyu.globals.$sound.m2t||[3421,3228,3047,2876,2715,2562,2419,2283,2155,2034,1920,1812,1711,1614,1524,1438,1358,1281,1210,1142,1078,1017,960,906,855,807,762,719,679,641,605,571,539,509,480,453,428,404,381,360,339,320,302,285,269,254,240,227,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,76,71,67,64,60,57,53,50,48,45,42,40,38,36,34,32,30,28,27,25,24,22,21,20,19,18,17,16,15,14].map((function anonymous_1701(e) {
          
          return 111860.78125/e;
        }));
        
      },
      setScale :function _trc_Beep_setScale(scale,detune) {
        var _this=this;
        
        let s = _this.initScaleTable();
        
        if (detune>0) {
          _this.setFreq(s[scale]*(1-detune)+s[scale+1]*detune);
          
        } else {
          if (detune<0) {
            _this.setFreq(s[scale]*(1+detune)-s[scale-1]*detune);
            
          } else {
            _this.setFreq(s[scale]);
            
          }
        }
      },
      fiber$setScale :function* _trc_Beep_f_setScale(_thread,scale,detune) {
        var _this=this;
        
        let s=yield* _this.fiber$initScaleTable(_thread);
        
        if (detune>0) {
          (yield* _this.fiber$setFreq(_thread, s[scale]*(1-detune)+s[scale+1]*detune));
          
        } else {
          if (detune<0) {
            (yield* _this.fiber$setFreq(_thread, s[scale]*(1+detune)-s[scale-1]*detune));
            
          } else {
            (yield* _this.fiber$setFreq(_thread, s[scale]));
            
          }
        }
        
      },
      set :function _trc_Beep_set(options) {
        var _this=this;
        
        if (options.reset) {
          let curs = _this.source;
          
          curs.stop(_this.time+_this.delay);
          setTimeout((function anonymous_2141() {
            
            curs.disconnect();
          }),(_this.time+_this.delay)*1000+100);
          _this.createSource();
          _this.source.start(_this.time+_this.delay);
          
        }
        if (typeof  options.vol==="number") {
          _this.setVolume(options.vol);
        }
        if (typeof  options.freq==="number") {
          _this.setFreq(options.freq);
        }
        if (typeof  options.scale==="number") {
          _this.setScale(options.scale);
        }
      },
      fiber$set :function* _trc_Beep_f_set(_thread,options) {
        var _this=this;
        
        if (options.reset) {
          let curs = _this.source;
          
          curs.stop(_this.time+_this.delay);
          setTimeout((function anonymous_2141() {
            
            curs.disconnect();
          }),(_this.time+_this.delay)*1000+100);
          (yield* _this.fiber$createSource(_thread));
          _this.source.start(_this.time+_this.delay);
          
        }
        if (typeof  options.vol==="number") {
          (yield* _this.fiber$setVolume(_thread, options.vol));
        }
        if (typeof  options.freq==="number") {
          (yield* _this.fiber$setFreq(_thread, options.freq));
        }
        if (typeof  options.scale==="number") {
          (yield* _this.fiber$setScale(_thread, options.scale));
        }
        
      },
      setFreq :function _trc_Beep_setFreq(f) {
        var _this=this;
        
        if (! _this.init()) {
          return _this;
        }
        if (typeof  f!=="number"||f!==f) {
          return _this;
        }
        _this.source.playbackRate.setValueAtTime(_this.hzToRate(f),_this.time+_this.delay);
      },
      fiber$setFreq :function* _trc_Beep_f_setFreq(_thread,f) {
        var _this=this;
        
        if (! _this.init()) {
          return _this;
        }
        if (typeof  f!=="number"||f!==f) {
          return _this;
        }
        _this.source.playbackRate.setValueAtTime(_this.hzToRate(f),_this.time+_this.delay);
        
      },
      setVolume :function _trc_Beep_setVolume(v) {
        var _this=this;
        
        if (! _this.init()) {
          return _this;
        }
        if (typeof  v!=="number"||v!==v) {
          return _this;
        }
        v=_this.clamp(v,0,128);
        _this.gainNode.gain.setValueAtTime(v/128,_this.time+_this.delay);
      },
      fiber$setVolume :function* _trc_Beep_f_setVolume(_thread,v) {
        var _this=this;
        
        if (! _this.init()) {
          return _this;
        }
        if (typeof  v!=="number"||v!==v) {
          return _this;
        }
        v=_this.clamp(v,0,128);
        _this.gainNode.gain.setValueAtTime(v/128,_this.time+_this.delay);
        
      },
      hzToRate :function _trc_Beep_hzToRate(hz) {
        var _this=this;
        
        return hz/_this.sampleRate*_this.buflen;
      },
      fiber$hzToRate :function* _trc_Beep_f_hzToRate(_thread,hz) {
        var _this=this;
        
        return hz/_this.sampleRate*_this.buflen;
        
      },
      __getter__context :function _trc_Beep___getter__context() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.context;
      },
      dieAfter :function _trc_Beep_dieAfter(after) {
        var _this=this;
        
        _this.source.stop(_this.time+_this.delay+after);
        setTimeout(Tonyu.bindFunc(_this,_this.die),(_this.delay+after)*1000);
      },
      fiber$dieAfter :function* _trc_Beep_f_dieAfter(_thread,after) {
        var _this=this;
        
        _this.source.stop(_this.time+_this.delay+after);
        setTimeout(Tonyu.bindFunc(_this,_this.die),(_this.delay+after)*1000);
        
      },
      die :function _trc_Beep_die() {
        var _this=this;
        
        _this.gainNode.disconnect();
      },
      fiber$die :function* _trc_Beep_f_die(_thread) {
        var _this=this;
        
        _this.gainNode.disconnect();
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"init":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"createSource":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initScaleTable":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setScale":{"nowait":false,"isMain":false,"vtype":{"params":["Number","Number"],"returnValue":null}},"set":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setFreq":{"nowait":false,"isMain":false,"vtype":{"params":["Number"],"returnValue":null}},"setVolume":{"nowait":false,"isMain":false,"vtype":{"params":["Number"],"returnValue":null}},"hzToRate":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__context":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"dieAfter":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"die":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"delay":{"vtype":"Number"},"time":{"vtype":"Number"},"gainNode":{},"buffer":{},"buflen":{},"source":{},"sampleRate":{},"mmTimer":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MML',
  shortName: 'MML',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_MML_main() {
        var _this=this;
        
        _this.mmlBuf=[];
      },
      fiber$main :function* _trc_MML_f_main(_thread) {
        var _this=this;
        
        _this.mmlBuf=[];
        
      },
      play :function _trc_MML_play(mmls) {
        var _this=this;
        
        _this.mmlBuf.push(mmls);
        if (! _this.isPlaying()) {
          _this.playNext();
          
        }
      },
      fiber$play :function* _trc_MML_f_play(_thread,mmls) {
        var _this=this;
        
        _this.mmlBuf.push(mmls);
        if (! _this.isPlaying()) {
          (yield* _this.fiber$playNext(_thread));
          
        }
        
      },
      playNext :function _trc_MML_playNext() {
        var _this=this;
        var mml;
        
        if (_this.cTimeBase==null) {
          _this.cTimeBase=0;
        }
        if (_this.m) {
          _this.cTimeBase+=_this.m.currentTime;
          
        }
        mml = _this.mmlBuf.shift();
        
        if (! mml) {
          _this.m=null;
          _this.cTimeBase=0;
          return _this;
          
        }
        _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();
        _this.m=T("mml",{mml: mml},_this.mwav);
        _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));
        _this.m.start();
        Tonyu.globals.$MMLS[_this.id()]=_this;
      },
      fiber$playNext :function* _trc_MML_f_playNext(_thread) {
        var _this=this;
        var mml;
        
        if (_this.cTimeBase==null) {
          _this.cTimeBase=0;
        }
        if (_this.m) {
          _this.cTimeBase+=_this.m.currentTime;
          
        }
        mml = _this.mmlBuf.shift();
        
        if (! mml) {
          _this.m=null;
          _this.cTimeBase=0;
          return _this;
          
        }
        _this.mwav=Tonyu.globals.$WaveTable.get(0,0).play();
        _this.m=T("mml",{mml: mml},_this.mwav);
        _this.m.on("ended",Tonyu.bindFunc(_this,_this.playNext));
        _this.m.start();
        Tonyu.globals.$MMLS[_this.id()]=_this;
        
      },
      id :function _trc_MML_id() {
        var _this=this;
        
        if (! _this._id) {
          _this._id=_this.rnd()+"";
        }
        return _this._id;
      },
      fiber$id :function* _trc_MML_f_id(_thread) {
        var _this=this;
        
        if (! _this._id) {
          _this._id=_this.rnd()+"";
        }
        return _this._id;
        
      },
      bufferCount :function _trc_MML_bufferCount() {
        var _this=this;
        
        return _this.mmlBuf.length;
      },
      fiber$bufferCount :function* _trc_MML_f_bufferCount(_thread) {
        var _this=this;
        
        return _this.mmlBuf.length;
        
      },
      isPlaying :function _trc_MML_isPlaying() {
        var _this=this;
        
        return _this.m;
      },
      fiber$isPlaying :function* _trc_MML_f_isPlaying(_thread) {
        var _this=this;
        
        return _this.m;
        
      },
      currentTime :function _trc_MML_currentTime() {
        var _this=this;
        
        if (_this.m) {
          return _this.m.currentTime+_this.cTimeBase;
        }
        return - 1;
      },
      fiber$currentTime :function* _trc_MML_f_currentTime(_thread) {
        var _this=this;
        
        if (_this.m) {
          return _this.m.currentTime+_this.cTimeBase;
        }
        return - 1;
        
      },
      stop :function _trc_MML_stop() {
        var _this=this;
        
        if (_this.m) {
          if (_this.mwav) {
            _this.mwav.pause();
            _this.mwav.stop();
            
          }
          _this.m.pause();
          _this.m.stop();
          _this.m=null;
          _this.mmlBuf=[];
          delete Tonyu.globals.$MMLS[_this.id()];
          
        }
      },
      fiber$stop :function* _trc_MML_f_stop(_thread) {
        var _this=this;
        
        if (_this.m) {
          if (_this.mwav) {
            _this.mwav.pause();
            _this.mwav.stop();
            
          }
          _this.m.pause();
          _this.m.stop();
          _this.m=null;
          _this.mmlBuf=[];
          delete Tonyu.globals.$MMLS[_this.id()];
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"play":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"playNext":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"id":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"bufferCount":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isPlaying":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"currentTime":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"stop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"mmlBuf":{},"cTimeBase":{},"m":{},"mwav":{},"_id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MMTimer',
  shortName: 'MMTimer',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.EventMod],
  methods: function (__superClass) {
    return {
      main :function _trc_MMTimer_main() {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        _this.interval=_this.interval||1/60;
        _this.next=_this.context.currentTime+_this.interval;
        Tonyu.globals.$Boot.on("stop",(function anonymous_259() {
          
          _this.isDead=true;
        }));
        _this.check();
      },
      fiber$main :function* _trc_MMTimer_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        _this.interval=_this.interval||1/60;
        _this.next=_this.context.currentTime+_this.interval;
        Tonyu.globals.$Boot.on("stop",(function anonymous_259() {
          
          _this.isDead=true;
        }));
        (yield* _this.fiber$check(_thread));
        
      },
      check :function _trc_MMTimer_check() {
        var _this=this;
        
        if (_this.isDead) {
          return _this;
        }
        let c = _this.context.currentTime;
        
        if (c>=_this.next) {
          _this.proc();
          
        } else {
          clearTimeout(_this.htimi);
          _this.htimi=setTimeout(Tonyu.bindFunc(_this,_this.proc),_this.floor((_this.next-c)*1000));
          
        }
      },
      fiber$check :function* _trc_MMTimer_f_check(_thread) {
        var _this=this;
        
        if (_this.isDead) {
          return _this;
        }
        let c = _this.context.currentTime;
        
        if (c>=_this.next) {
          (yield* _this.fiber$proc(_thread));
          
        } else {
          clearTimeout(_this.htimi);
          _this.htimi=setTimeout(Tonyu.bindFunc(_this,_this.proc),_this.floor((_this.next-c)*1000));
          
        }
        
      },
      proc :function _trc_MMTimer_proc() {
        var _this=this;
        
        Tonyu.resetLoopCheck();
        if (_this.isDead) {
          return _this;
        }
        _this.fireEvent("beforeInterval",{time: _this.next,context: _this.context});
        _this.fireEvent("interval",{time: _this.next,context: _this.context});
        _this.next+=_this.interval;
        _this.check();
      },
      fiber$proc :function* _trc_MMTimer_f_proc(_thread) {
        var _this=this;
        
        Tonyu.resetLoopCheck();
        if (_this.isDead) {
          return _this;
        }
        _this.fireEvent("beforeInterval",{time: _this.next,context: _this.context});
        _this.fireEvent("interval",{time: _this.next,context: _this.context});
        _this.next+=_this.interval;
        (yield* _this.fiber$check(_thread));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"check":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"proc":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"context":{},"interval":{"vtype":"Number"},"next":{"vtype":"Number"},"htimi":{},"isDead":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.WaveTable',
  shortName: 'WaveTable',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_WaveTable_main() {
        var _this=this;
        
        _this.wav={};
        _this.env={};
        if (typeof  T!=="undefined") {
          _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});
          _this.setEnv(0,_this.env);
          _this.setWav(0,T("pulse"));
          
        }
      },
      fiber$main :function* _trc_WaveTable_f_main(_thread) {
        var _this=this;
        
        _this.wav={};
        _this.env={};
        if (typeof  T!=="undefined") {
          _this.env=T("env",{table: [1,[0.6,50],[0,100]],releaseNode: 2});
          (yield* _this.fiber$setEnv(_thread, 0, _this.env));
          (yield* _this.fiber$setWav(_thread, 0, T("pulse")));
          
        }
        
      },
      setWav :function _trc_WaveTable_setWav(num,synth) {
        var _this=this;
        
        _this.wav[num]=synth;
      },
      fiber$setWav :function* _trc_WaveTable_f_setWav(_thread,num,synth) {
        var _this=this;
        
        _this.wav[num]=synth;
        
      },
      setEnv :function _trc_WaveTable_setEnv(num,synth) {
        var _this=this;
        
        _this.env[num]=synth;
      },
      fiber$setEnv :function* _trc_WaveTable_f_setEnv(_thread,num,synth) {
        var _this=this;
        
        _this.env[num]=synth;
        
      },
      get :function _trc_WaveTable_get(w,e) {
        var _this=this;
        var synth;
        
        synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});
        
        return synth;
      },
      fiber$get :function* _trc_WaveTable_f_get(_thread,w,e) {
        var _this=this;
        var synth;
        
        synth = T("OscGen",{osc: _this.wav[w],env: _this.env[e],mul: 0.25});
        
        return synth;
        
      },
      stop :function _trc_WaveTable_stop() {
        var _this=this;
        
      },
      fiber$stop :function* _trc_WaveTable_f_stop(_thread) {
        var _this=this;
        
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"setWav":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"setEnv":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"get":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"stop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"wav":{},"env":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1FillPolygon',
  shortName: 'T1FillPolygon',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.OneframeSprite,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_T1FillPolygon_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T1FillPolygon_f_main(_thread) {
        var _this=this;
        
        
      },
      draw :function _trc_T1FillPolygon_draw(ctx) {
        var _this=this;
        var i;
        var xx;
        var yy;
        
        ctx.save();
        ctx.lineWidth=0;
        ctx.fillStyle=_this.col+"";
        ctx.beginPath();
        for (i = _this.startPos;
         i<_this.endPos ; i+=2) {
          {
            xx = Tonyu.globals.$_setPolygonDrawAry[i];
            
            yy = Tonyu.globals.$_setPolygonDrawAry[i+1];
            
            if (i==_this.startPos) {
              ctx.moveTo(_this.x+xx,_this.y+yy);
            } else {
              ctx.lineTo(_this.x+xx,_this.y+yy);
            }
          }
        }
        ctx.closePath();
        ctx.globalAlpha=_this.alpha/255;
        ctx.fill();
        ctx.restore();
        _this.drawn=true;
      },
      fiber$draw :function* _trc_T1FillPolygon_f_draw(_thread,ctx) {
        var _this=this;
        var i;
        var xx;
        var yy;
        
        ctx.save();
        ctx.lineWidth=0;
        ctx.fillStyle=_this.col+"";
        ctx.beginPath();
        for (i = _this.startPos;
         i<_this.endPos ; i+=2) {
          {
            xx = Tonyu.globals.$_setPolygonDrawAry[i];
            
            yy = Tonyu.globals.$_setPolygonDrawAry[i+1];
            
            if (i==_this.startPos) {
              ctx.moveTo(_this.x+xx,_this.y+yy);
            } else {
              ctx.lineTo(_this.x+xx,_this.y+yy);
            }
          }
        }
        ctx.closePath();
        ctx.globalAlpha=_this.alpha/255;
        ctx.fill();
        ctx.restore();
        _this.drawn=true;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"col":{},"startPos":{},"endPos":{},"x":{},"y":{},"alpha":{},"drawn":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Line',
  shortName: 'T1Line',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.OneframeSprite,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_T1Line_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T1Line_f_main(_thread) {
        var _this=this;
        
        
      },
      draw :function _trc_T1Line_draw(ctx) {
        var _this=this;
        var bx;
        var by;
        
        bx = 0.5;
        by = 0.5;
        
        ctx.save();
        ctx.lineWidth=1;
        ctx.strokeStyle=_this.col+"";
        ctx.beginPath();
        if (_this.x==_this.tx) {
          by=0;
        }
        if (_this.y==_this.ty) {
          bx=0;
        }
        ctx.moveTo(_this.x+bx,_this.y+by);
        ctx.lineTo(_this.tx+bx,_this.ty+by);
        ctx.stroke();
        ctx.restore();
        _this.drawn=true;
      },
      fiber$draw :function* _trc_T1Line_f_draw(_thread,ctx) {
        var _this=this;
        var bx;
        var by;
        
        bx = 0.5;
        by = 0.5;
        
        ctx.save();
        ctx.lineWidth=1;
        ctx.strokeStyle=_this.col+"";
        ctx.beginPath();
        if (_this.x==_this.tx) {
          by=0;
        }
        if (_this.y==_this.ty) {
          bx=0;
        }
        ctx.moveTo(_this.x+bx,_this.y+by);
        ctx.lineTo(_this.tx+bx,_this.ty+by);
        ctx.stroke();
        ctx.restore();
        _this.drawn=true;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"col":{},"x":{},"tx":{},"y":{},"ty":{},"drawn":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Rect',
  shortName: 'T1Rect',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.OneframeSprite,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_T1Rect_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T1Rect_f_main(_thread) {
        var _this=this;
        
        
      },
      draw :function _trc_T1Rect_draw(ctx) {
        var _this=this;
        
        ctx.save();
        if (_this.fill) {
          ctx.lineWidth=0;
          ctx.fillStyle=_this.col+"";
          ctx.fillRect(_this.x,_this.y,_this.w,_this.h);
          
        } else {
          ctx.lineWidth=1;
          ctx.strokeStyle=_this.col+"";
          ctx.strokeRect(_this.x+0.5,_this.y+0.5,_this.w,_this.h);
          
        }
        ctx.restore();
        _this.drawn=true;
      },
      fiber$draw :function* _trc_T1Rect_f_draw(_thread,ctx) {
        var _this=this;
        
        ctx.save();
        if (_this.fill) {
          ctx.lineWidth=0;
          ctx.fillStyle=_this.col+"";
          ctx.fillRect(_this.x,_this.y,_this.w,_this.h);
          
        } else {
          ctx.lineWidth=1;
          ctx.strokeStyle=_this.col+"";
          ctx.strokeRect(_this.x+0.5,_this.y+0.5,_this.w,_this.h);
          
        }
        ctx.restore();
        _this.drawn=true;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"fill":{},"col":{},"x":{},"y":{},"w":{},"h":{},"drawn":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Sprite',
  shortName: 'T1Sprite',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.OneframeSprite,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_T1Sprite_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T1Sprite_f_main(_thread) {
        var _this=this;
        
        
      },
      draw :function _trc_T1Sprite_draw(ctx) {
        var _this=this;
        var sgn;
        
        _this.pImg=Tonyu.globals.$imageList[Math.floor(_this.p||0)];
        if (! _this.pImg) {
          return _this;
        }
        ctx.save();
        ctx.translate(_this.x,_this.y);
        ctx.rotate(_this.angle/180*Math.PI);
        sgn = (_this.f?- 1:1);
        
        if (typeof  _this.scaleY==="undefined") {
          ctx.scale(_this.scaleX*sgn,_this.scaleX);
          
        } else {
          ctx.scale(_this.scaleX*sgn,_this.scaleY);
          
        }
        ctx.globalAlpha=_this.alpha/255;
        ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.pImg.width/2,- _this.pImg.height/2,_this.pImg.width,_this.pImg.height);
        ctx.restore();
        _this.drawn=true;
      },
      fiber$draw :function* _trc_T1Sprite_f_draw(_thread,ctx) {
        var _this=this;
        var sgn;
        
        _this.pImg=Tonyu.globals.$imageList[Math.floor(_this.p||0)];
        if (! _this.pImg) {
          return _this;
        }
        ctx.save();
        ctx.translate(_this.x,_this.y);
        ctx.rotate(_this.angle/180*Math.PI);
        sgn = (_this.f?- 1:1);
        
        if (typeof  _this.scaleY==="undefined") {
          ctx.scale(_this.scaleX*sgn,_this.scaleX);
          
        } else {
          ctx.scale(_this.scaleX*sgn,_this.scaleY);
          
        }
        ctx.globalAlpha=_this.alpha/255;
        ctx.drawImage(_this.pImg.image,_this.pImg.x,_this.pImg.y,_this.pImg.width,_this.pImg.height,- _this.pImg.width/2,- _this.pImg.height/2,_this.pImg.width,_this.pImg.height);
        ctx.restore();
        _this.drawn=true;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"pImg":{},"p":{},"x":{},"y":{},"f":{},"drawn":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Text',
  shortName: 'T1Text',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.OneframeSprite,
  includes: [Tonyu.classes.kernel.TextRectMod],
  methods: function (__superClass) {
    return {
      main :function _trc_T1Text_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T1Text_f_main(_thread) {
        var _this=this;
        
        
      },
      draw :function _trc_T1Text_draw(ctx) {
        var _this=this;
        var splitsText;
        var drawY;
        var textCount;
        var rect;
        
        if (! _this.font) {
          _this.font="ＭＳ Ｐゴシック";
        }
        ctx.save();
        ctx.font=_this.size+"px '"+_this.font+"'";
        splitsText = (_this.text+"").split("\n");
        
        drawY = _this.y;
        
        if (! _this.size) {
          _this.size=15;
        }
        if (! _this.align) {
          _this.align=new Tonyu.classes.kernel.Align2D("left");
        }
        if (! _this.fillStyle) {
          _this.fillStyle="white";
        }
        if (_this.alpha==null) {
          _this.alpha=255;
        }
        ctx.fillStyle=_this.fillStyle+"";
        ctx.globalAlpha=_this.alpha/255;
        _this.height=0;
        _this.width=0;
        for (textCount = 0;
         textCount<splitsText.length ; textCount++) {
          {
            rect = _this.drawTextRect(ctx,splitsText[textCount],_this.x,drawY,_this.size,_this.align,"fill");
            
            if (_this.width<rect.w) {
              _this.width=rect.w;
            }
            _this.height+=rect.h;
            drawY+=_this.size;
          }
        }
        _this.owner.width=_this.width;
        _this.owner.height=_this.height;
        ctx.restore();
        _this.drawn=true;
      },
      fiber$draw :function* _trc_T1Text_f_draw(_thread,ctx) {
        var _this=this;
        var splitsText;
        var drawY;
        var textCount;
        var rect;
        
        if (! _this.font) {
          _this.font="ＭＳ Ｐゴシック";
        }
        ctx.save();
        ctx.font=_this.size+"px '"+_this.font+"'";
        splitsText = (_this.text+"").split("\n");
        
        drawY = _this.y;
        
        if (! _this.size) {
          _this.size=15;
        }
        if (! _this.align) {
          _this.align=new Tonyu.classes.kernel.Align2D("left");
        }
        if (! _this.fillStyle) {
          _this.fillStyle="white";
        }
        if (_this.alpha==null) {
          _this.alpha=255;
        }
        ctx.fillStyle=_this.fillStyle+"";
        ctx.globalAlpha=_this.alpha/255;
        _this.height=0;
        _this.width=0;
        for (textCount = 0;
         textCount<splitsText.length ; textCount++) {
          {
            rect = _this.drawTextRect(ctx,splitsText[textCount],_this.x,drawY,_this.size,_this.align,"fill");
            
            if (_this.width<rect.w) {
              _this.width=rect.w;
            }
            _this.height+=rect.h;
            drawY+=_this.size;
          }
        }
        _this.owner.width=_this.width;
        _this.owner.height=_this.height;
        ctx.restore();
        _this.drawn=true;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"font":{},"size":{},"text":{},"y":{},"align":{},"fillStyle":{},"alpha":{},"height":{},"width":{},"x":{},"owner":{},"drawn":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Scheduler',
  shortName: 'Scheduler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.EventMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Scheduler_main() {
        var _this=this;
        
        "field strict";
        
        if (typeof  performance==="undefined") {
          window.performance={};
          
        }
        if (! performance.now) {
          performance.now=(function now() {
            
            return Date.now();
          });
          
        }
        _this.cur = [];
        
        _this.next = [];
        
        
      },
      fiber$main :function* _trc_Scheduler_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        if (typeof  performance==="undefined") {
          window.performance={};
          
        }
        if (! performance.now) {
          performance.now=(function now() {
            
            return Date.now();
          });
          
        }
        _this.cur = [];
        
        _this.next = [];
        
        
        
      },
      addObj :function _trc_Scheduler_addObj(obj,name,args) {
        var _this=this;
        
        return _this.newThread(obj,name,args);
      },
      fiber$addObj :function* _trc_Scheduler_f_addObj(_thread,obj,name,args) {
        var _this=this;
        
        return yield* _this.fiber$newThread(_thread, obj, name, args);
        
        
      },
      newThread :function _trc_Scheduler_newThread(obj,name,args,options) {
        var _this=this;
        var th;
        
        name=name||"main";
        args=args||[];
        th = Tonyu.thread();
        
        th.apply(obj,name,args);
        th.name=(obj.getClassInfo?obj.getClassInfo().shortName:"Unknown")+"::"+name;
        _this.addToCur(th);
        return th;
      },
      fiber$newThread :function* _trc_Scheduler_f_newThread(_thread,obj,name,args,options) {
        var _this=this;
        var th;
        
        name=name||"main";
        args=args||[];
        th = Tonyu.thread();
        
        th.apply(obj,name,args);
        th.name=(obj.getClassInfo?obj.getClassInfo().shortName:"Unknown")+"::"+name;
        (yield* _this.fiber$addToCur(_thread, th));
        return th;
        
      },
      addToCur :function _trc_Scheduler_addToCur(th) {
        var _this=this;
        
        if (th.scheduled) {
          return _this;
        }
        _this.cur.push(th);
        th.scheduled=_this;
        if (Tonyu.globals.$Boot.newLimit) {
          Tonyu.globals.$Boot.newLimitCount--;
          if (Tonyu.globals.$Boot.newLimitCount<=0) {
            throw new Error("一度にたくさんのスレッドを作りすぎています\n"+"       $Boot.newLimitの値を変更すると、1フレーム間に生成できる オブジェクト+スレッドの合計数 を変更できます\n"+"       $Boot.newLimit="+Tonyu.globals.$Boot.newLimit+"; // 現在の オブジェクト数+スレッド数 の限度\n"+"       update(); // 次フレームから適用されます\n"+"       [参考] https://edit.tonyu.jp/doc/limitations.html\n");
            
          }
          
        }
      },
      fiber$addToCur :function* _trc_Scheduler_f_addToCur(_thread,th) {
        var _this=this;
        
        if (th.scheduled) {
          return _this;
        }
        _this.cur.push(th);
        th.scheduled=_this;
        if (Tonyu.globals.$Boot.newLimit) {
          Tonyu.globals.$Boot.newLimitCount--;
          if (Tonyu.globals.$Boot.newLimitCount<=0) {
            throw new Error("一度にたくさんのスレッドを作りすぎています\n"+"       $Boot.newLimitの値を変更すると、1フレーム間に生成できる オブジェクト+スレッドの合計数 を変更できます\n"+"       $Boot.newLimit="+Tonyu.globals.$Boot.newLimit+"; // 現在の オブジェクト数+スレッド数 の限度\n"+"       update(); // 次フレームから適用されます\n"+"       [参考] https://edit.tonyu.jp/doc/limitations.html\n");
            
          }
          
        }
        
      },
      addToNext :function _trc_Scheduler_addToNext(th) {
        var _this=this;
        
        if (th.scheduled) {
          return _this;
        }
        if (_this.newScheduler) {
          return _this.newScheduler.addToNext(th);
          
        }
        _this.next.push(th);
        th.scheduled=_this;
      },
      fiber$addToNext :function* _trc_Scheduler_f_addToNext(_thread,th) {
        var _this=this;
        
        if (th.scheduled) {
          return _this;
        }
        if (_this.newScheduler) {
          return _this.newScheduler.addToNext(th);
          
        }
        _this.next.push(th);
        th.scheduled=_this;
        
      },
      unschedule :function _trc_Scheduler_unschedule(th) {
        var _this=this;
        var i;
        
        i = _this.cur.indexOf(th);
        
        if (i>=0) {
          _this.cur.splice(i,1);
          delete th.scheduled;
          
        } else {
          i=_this.next.indexOf(th);
          if (i>=0) {
            _this.next.splice(i,1);
            delete th.scheduled;
            
          }
          
        }
      },
      fiber$unschedule :function* _trc_Scheduler_f_unschedule(_thread,th) {
        var _this=this;
        var i;
        
        i = _this.cur.indexOf(th);
        
        if (i>=0) {
          _this.cur.splice(i,1);
          delete th.scheduled;
          
        } else {
          i=_this.next.indexOf(th);
          if (i>=0) {
            _this.next.splice(i,1);
            delete th.scheduled;
            
          }
          
        }
        
      },
      checkTimeout :function _trc_Scheduler_checkTimeout() {
        var _this=this;
        var now;
        
        now = performance.now();
        
        if (now-_this.lastSteps>1000) {
          throw new Error("待機不能モードでupdateが呼ばれています．ブラウザが固まるのを防ぐために停止します．");
          
          
        }
      },
      fiber$checkTimeout :function* _trc_Scheduler_f_checkTimeout(_thread) {
        var _this=this;
        var now;
        
        now = performance.now();
        
        if (now-_this.lastSteps>1000) {
          throw new Error("待機不能モードでupdateが呼ばれています．ブラウザが固まるのを防ぐために停止します．");
          
          
        }
        
      },
      checkDuplicate :function _trc_Scheduler_checkDuplicate() {
        var _this=this;
        var dupc;
        var t;
        
        dupc = {};
        
        for ([t] of Tonyu.iterator2(_this.cur,1)) {
          if (dupc[t.id]) {
            console.log("WARNING","Scheduler: duplicate thread detected in cur",t);
            
          }
          dupc[t.id]="cur";
          
        }
        for ([t] of Tonyu.iterator2(_this.next,1)) {
          if (dupc[t.id]) {
            console.log("WARNING","Scheduler: duplicate thread detected in next and "+dupc[t.id],t);
            
          }
          dupc[t.id]="next";
          
        }
      },
      fiber$checkDuplicate :function* _trc_Scheduler_f_checkDuplicate(_thread) {
        var _this=this;
        var dupc;
        var t;
        
        dupc = {};
        
        for ([t] of Tonyu.iterator2(_this.cur,1)) {
          if (dupc[t.id]) {
            console.log("WARNING","Scheduler: duplicate thread detected in cur",t);
            
          }
          dupc[t.id]="cur";
          
        }
        for ([t] of Tonyu.iterator2(_this.next,1)) {
          if (dupc[t.id]) {
            console.log("WARNING","Scheduler: duplicate thread detected in next and "+dupc[t.id],t);
            
          }
          dupc[t.id]="next";
          
        }
        
      },
      doTimeStop :function _trc_Scheduler_doTimeStop(newS) {
        var _this=this;
        
        _this.newScheduler=newS;
        _this.next=_this.allThreads;
        _this.cur=[];
        return _this.next;
      },
      fiber$doTimeStop :function* _trc_Scheduler_f_doTimeStop(_thread,newS) {
        var _this=this;
        
        _this.newScheduler=newS;
        _this.next=_this.allThreads;
        _this.cur=[];
        return _this.next;
        
      },
      moveToNew :function _trc_Scheduler_moveToNew(th_ac) {
        var _this=this;
        
        if (! _this.newScheduler) {
          return _this;
        }
        return _this.moveTo(th_ac,_this.newScheduler);
      },
      fiber$moveToNew :function* _trc_Scheduler_f_moveToNew(_thread,th_ac) {
        var _this=this;
        
        if (! _this.newScheduler) {
          return _this;
        }
        return yield* _this.fiber$moveTo(_thread, th_ac, _this.newScheduler);
        
        
      },
      moveTo :function _trc_Scheduler_moveTo(th_ac,newS) {
        var _this=this;
        
        if (! newS) {
          return _this;
        }
        if (! th_ac) {
          for (let [th] of Tonyu.iterator2(_this.allThreads,1)) {
            _this.moveTo(th,newS);
            
          }
          return _this;
          
        }
        if (Tonyu.is(th_ac,Tonyu.classes.kernel.SchedulerMod)) {
          th_ac._scheduler=newS;
          for (let [th] of Tonyu.iterator2(_this.findByThreadGroup(th_ac),1)) {
            _this.moveTo(th,newS);
            
          }
          return _this;
          
        }
        let th = th_ac;
        
        if (Tonyu.is(th._threadGroup,Tonyu.classes.kernel.SchedulerMod)&&th._threadGroup._scheduler!=newS) {
          th._threadGroup._scheduler=newS;
          
        }
        if (th.scheduled===newS) {
          return _this;
        }
        _this.unschedule(th);
        newS.addToNext(th);
        newS.checkDuplicate();
      },
      fiber$moveTo :function* _trc_Scheduler_f_moveTo(_thread,th_ac,newS) {
        var _this=this;
        
        if (! newS) {
          return _this;
        }
        if (! th_ac) {
          for (let [th] of Tonyu.iterator2(_this.allThreads,1)) {
            (yield* _this.fiber$moveTo(_thread, th, newS));
            
          }
          return _this;
          
        }
        if (Tonyu.is(th_ac,Tonyu.classes.kernel.SchedulerMod)) {
          th_ac._scheduler=newS;
          for (let [th] of Tonyu.iterator2(_this.findByThreadGroup(th_ac),1)) {
            (yield* _this.fiber$moveTo(_thread, th, newS));
            
          }
          return _this;
          
        }
        let th = th_ac;
        
        if (Tonyu.is(th._threadGroup,Tonyu.classes.kernel.SchedulerMod)&&th._threadGroup._scheduler!=newS) {
          th._threadGroup._scheduler=newS;
          
        }
        if (th.scheduled===newS) {
          return _this;
        }
        (yield* _this.fiber$unschedule(_thread, th));
        newS.addToNext(th);
        newS.checkDuplicate();
        
      },
      resetLastSteps :function _trc_Scheduler_resetLastSteps() {
        var _this=this;
        
        _this.lastSteps=performance.now();
      },
      fiber$resetLastSteps :function* _trc_Scheduler_f_resetLastSteps(_thread) {
        var _this=this;
        
        _this.lastSteps=performance.now();
        
      },
      stepsAll :function _trc_Scheduler_stepsAll() {
        var _this=this;
        var dupc;
        var t;
        
        _this.resetLastSteps();
        dupc = {};
        
        _this.fireEvent("beforeSteps");
        while (_this.cur.length) {
          t = _this.cur.shift();
          
          if (dupc[t.id]) {
            console.log("WARNING","Scheduler: duplicate thread detected",t);
            continue;
            
            
          }
          dupc[t.id]=t;
          delete t.scheduled;
          if (t.waitCount) {
            t.waitCount--;
            _this.addToNext(t);
            
          } else {
            t.steps();
            if (t.preempted) {
              t.hadPreemption=true;
              Tonyu.globals.$Boot.fireEvent("preempted",{thread: t,scheduler: _this});
              _this.addToNext(t);
              
            } else {
              if (t.hadPreemption) {
                t.preemptionTime++;
              }
              t.hadPreemption=false;
              
            }
            
          }
          
        }
        _this.fireEvent("afterSteps");
        _this.cur=_this.next;
        _this.next=[];
        return _this.cur.length;
      },
      fiber$stepsAll :function* _trc_Scheduler_f_stepsAll(_thread) {
        var _this=this;
        var dupc;
        var t;
        
        (yield* _this.fiber$resetLastSteps(_thread));
        dupc = {};
        
        _this.fireEvent("beforeSteps");
        while (_this.cur.length) {
          t = _this.cur.shift();
          
          if (dupc[t.id]) {
            console.log("WARNING","Scheduler: duplicate thread detected",t);
            continue;
            
            
          }
          dupc[t.id]=t;
          delete t.scheduled;
          if (t.waitCount) {
            t.waitCount--;
            (yield* _this.fiber$addToNext(_thread, t));
            
          } else {
            t.steps();
            if (t.preempted) {
              t.hadPreemption=true;
              Tonyu.globals.$Boot.fireEvent("preempted",{thread: t,scheduler: _this});
              (yield* _this.fiber$addToNext(_thread, t));
              
            } else {
              if (t.hadPreemption) {
                t.preemptionTime++;
              }
              t.hadPreemption=false;
              
            }
            
          }
          
        }
        _this.fireEvent("afterSteps");
        _this.cur=_this.next;
        _this.next=[];
        return _this.cur.length;
        
      },
      __getter__allThreads :function _trc_Scheduler___getter__allThreads() {
        var _this=this;
        
        return _this.cur.concat(_this.next);
      },
      findByThreadGroup :function _trc_Scheduler_findByThreadGroup(o) {
        var _this=this;
        
        return _this.allThreads.filter((function anonymous_4442(t) {
          
          return t._threadGroup===o;
        }));
      },
      fiber$findByThreadGroup :function* _trc_Scheduler_f_findByThreadGroup(_thread,o) {
        var _this=this;
        
        return _this.allThreads.filter((function anonymous_4442(t) {
          
          return t._threadGroup===o;
        }));
        
      },
      __getter__isEmpty :function _trc_Scheduler___getter__isEmpty() {
        var _this=this;
        
        return _this.allThreads.length==0;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"addObj":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"newThread":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"addToCur":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"addToNext":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"unschedule":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"checkTimeout":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"checkDuplicate":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"doTimeStop":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"moveToNew":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"moveTo":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"resetLastSteps":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"stepsAll":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__allThreads":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"findByThreadGroup":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__isEmpty":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"newScheduler":{},"cur":{},"next":{},"lastSteps":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.DialogMod',
  shortName: 'DialogMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_DialogMod_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_DialogMod_f_main(_thread) {
        var _this=this;
        
        
      },
      prompt :function _trc_DialogMod_prompt(mesg,val,geom) {
        var _this=this;
        var r;
        
        Tonyu.globals.$currentProject.requestPlugin("jquery_ui");
        
        r=_this.waitFor(Tonyu.globals.$InputBox.prompt(mesg,val,geom));
        return r;
      },
      fiber$prompt :function* _trc_DialogMod_f_prompt(_thread,mesg,val,geom) {
        var _this=this;
        var r;
        
        Tonyu.globals.$currentProject.requestPlugin("jquery_ui");
        
        r=(yield* _this.fiber$waitFor(_thread, Tonyu.globals.$InputBox.prompt(mesg,val,geom)));
        return r;
        
      },
      waitInput :function _trc_DialogMod_waitInput(title,mesg,val,geom) {
        var _this=this;
        
        return _this.prompt({title: title,body: mesg},val,geom);
      },
      fiber$waitInput :function* _trc_DialogMod_f_waitInput(_thread,title,mesg,val,geom) {
        var _this=this;
        
        return yield* _this.fiber$prompt(_thread, {title: title,body: mesg}, val, geom);
        
        
      },
      promptNumber :function _trc_DialogMod_promptNumber(mesg,val,geom) {
        var _this=this;
        var r;
        
        
        r=_this.prompt(mesg,val,geom);
        return r-0;
      },
      fiber$promptNumber :function* _trc_DialogMod_f_promptNumber(_thread,mesg,val,geom) {
        var _this=this;
        var r;
        
        
        r=(yield* _this.fiber$prompt(_thread, mesg, val, geom));
        return r-0;
        
      },
      confirm :function _trc_DialogMod_confirm(mesg) {
        var _this=this;
        var r;
        
        
        Tonyu.globals.$currentProject.requestPlugin("jquery_ui");
        r=_this.waitFor(Tonyu.globals.$InputBox.confirm(mesg));
        return r;
      },
      fiber$confirm :function* _trc_DialogMod_f_confirm(_thread,mesg) {
        var _this=this;
        var r;
        
        
        Tonyu.globals.$currentProject.requestPlugin("jquery_ui");
        r=(yield* _this.fiber$waitFor(_thread, Tonyu.globals.$InputBox.confirm(mesg)));
        return r;
        
      },
      alert :function _trc_DialogMod_alert(mesg) {
        var _this=this;
        var r;
        
        
        Tonyu.globals.$currentProject.requestPlugin("jquery_ui");
        r=_this.waitFor(Tonyu.globals.$InputBox.alert(mesg));
        return r;
      },
      fiber$alert :function* _trc_DialogMod_f_alert(_thread,mesg) {
        var _this=this;
        var r;
        
        
        Tonyu.globals.$currentProject.requestPlugin("jquery_ui");
        r=(yield* _this.fiber$waitFor(_thread, Tonyu.globals.$InputBox.alert(mesg)));
        return r;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"prompt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"waitInput":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"promptNumber":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"confirm":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"alert":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.GamePad',
  shortName: 'GamePad',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_GamePad_main() {
        var _this=this;
        
        _this.available=false;
        _this.useGamePad=false;
        _this.enable=true;
        _this.gamepads=[];
        _this.gamepadones=[];
        _this.prevFrameCount=- 1;
      },
      fiber$main :function* _trc_GamePad_f_main(_thread) {
        var _this=this;
        
        _this.available=false;
        _this.useGamePad=false;
        _this.enable=true;
        _this.gamepads=[];
        _this.gamepadones=[];
        _this.prevFrameCount=- 1;
        
      },
      setEnable :function _trc_GamePad_setEnable(e) {
        var _this=this;
        
        _this.enable=e;
      },
      fiber$setEnable :function* _trc_GamePad_f_setEnable(_thread,e) {
        var _this=this;
        
        _this.enable=e;
        
      },
      enableGamePad :function _trc_GamePad_enableGamePad() {
        var _this=this;
        
        if (! _this.useGamePad) {
          _this.update();
          _this.useGamePad=true;
          
        }
      },
      fiber$enableGamePad :function* _trc_GamePad_f_enableGamePad(_thread) {
        var _this=this;
        
        if (! _this.useGamePad) {
          (yield* _this.fiber$update(_thread));
          _this.useGamePad=true;
          
        }
        
      },
      getGamepads :function _trc_GamePad_getGamepads() {
        var _this=this;
        var pads;
        
        _this.enableGamePad();
        pads = navigator.getGamepads?navigator.getGamepads():(navigator.webkitGetGamepads?navigator.webkitGetGamepads:[]);
        
        return pads;
      },
      fiber$getGamepads :function* _trc_GamePad_f_getGamepads(_thread) {
        var _this=this;
        var pads;
        
        (yield* _this.fiber$enableGamePad(_thread));
        pads = navigator.getGamepads?navigator.getGamepads():(navigator.webkitGetGamepads?navigator.webkitGetGamepads:[]);
        
        return pads;
        
      },
      get :function _trc_GamePad_get(no) {
        var _this=this;
        
        if (_this.gamepadones[no]==null) {
          _this.gamepadones[no]=new Tonyu.classes.kernel.GamePadOne(_this,no);
          
        }
        return _this.gamepadones[no];
      },
      fiber$get :function* _trc_GamePad_f_get(_thread,no) {
        var _this=this;
        
        if (_this.gamepadones[no]==null) {
          _this.gamepadones[no]=new Tonyu.classes.kernel.GamePadOne(_this,no);
          
        }
        return _this.gamepadones[no];
        
      },
      padsCount :function _trc_GamePad_padsCount() {
        var _this=this;
        var count;
        var i;
        
        _this.enableGamePad();
        count = 0;
        
        for (i = 0;
         i<_this.gamepads.length ; i++) {
          {
            if (_this.gamepads[i]) {
              count++;
            }
          }
        }
        return count;
      },
      fiber$padsCount :function* _trc_GamePad_f_padsCount(_thread) {
        var _this=this;
        var count;
        var i;
        
        (yield* _this.fiber$enableGamePad(_thread));
        count = 0;
        
        for (i = 0;
         i<_this.gamepads.length ; i++) {
          {
            if (_this.gamepads[i]) {
              count++;
            }
          }
        }
        return count;
        
      },
      getPad :function _trc_GamePad_getPad(index) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp) {
          return null;
        }
        return gp.pad;
      },
      fiber$getPad :function* _trc_GamePad_f_getPad(_thread,index) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp) {
          return null;
        }
        return gp.pad;
        
      },
      getPadId :function _trc_GamePad_getPadId(index) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad) {
          return null;
        }
        return gp.pad.id;
      },
      fiber$getPadId :function* _trc_GamePad_f_getPadId(_thread,index) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad) {
          return null;
        }
        return gp.pad.id;
        
      },
      isConnected :function _trc_GamePad_isConnected(index) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad) {
          return false;
        }
        return gp.pad.connected;
      },
      fiber$isConnected :function* _trc_GamePad_f_isConnected(_thread,index) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad) {
          return false;
        }
        return gp.pad.connected;
        
      },
      getMapping :function _trc_GamePad_getMapping(index) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad) {
          return null;
        }
        return gp.pad.mapping;
      },
      fiber$getMapping :function* _trc_GamePad_f_getMapping(_thread,index) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad) {
          return null;
        }
        return gp.pad.mapping;
        
      },
      getButton :function _trc_GamePad_getButton(index,no) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp||! gp.status||! gp.status[no]) {
          return 0;
        }
        return gp.status[no];
      },
      fiber$getButton :function* _trc_GamePad_f_getButton(_thread,index,no) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp||! gp.status||! gp.status[no]) {
          return 0;
        }
        return gp.status[no];
        
      },
      getButtonValue :function _trc_GamePad_getButtonValue(index,no) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad||! gp.pad.buttons||! gp.pad.buttons[no]) {
          return 0;
        }
        return gp.pad.buttons[no].value;
      },
      fiber$getButtonValue :function* _trc_GamePad_f_getButtonValue(_thread,index,no) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad||! gp.pad.buttons||! gp.pad.buttons[no]) {
          return 0;
        }
        return gp.pad.buttons[no].value;
        
      },
      getButtonCount :function _trc_GamePad_getButtonCount(index) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad||! gp.pad.buttons) {
          return 0;
        }
        return gp.pad.buttons.length;
      },
      fiber$getButtonCount :function* _trc_GamePad_f_getButtonCount(_thread,index) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad||! gp.pad.buttons) {
          return 0;
        }
        return gp.pad.buttons.length;
        
      },
      getAxis :function _trc_GamePad_getAxis(index,no) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad||! gp.pad.axes) {
          return 0;
        }
        return gp.pad.axes[no];
      },
      fiber$getAxis :function* _trc_GamePad_f_getAxis(_thread,index,no) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad||! gp.pad.axes) {
          return 0;
        }
        return gp.pad.axes[no];
        
      },
      getAxisCount :function _trc_GamePad_getAxisCount(index) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad||! gp.pad.axes) {
          return 0;
        }
        return gp.pad.axes.length;
      },
      fiber$getAxisCount :function* _trc_GamePad_f_getAxisCount(_thread,index) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp||! gp.pad||! gp.pad.axes) {
          return 0;
        }
        return gp.pad.axes.length;
        
      },
      getUp :function _trc_GamePad_getUp(index) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp) {
          return 0;
        }
        return gp.statusA1U;
      },
      fiber$getUp :function* _trc_GamePad_f_getUp(_thread,index) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp) {
          return 0;
        }
        return gp.statusA1U;
        
      },
      getDown :function _trc_GamePad_getDown(index) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp) {
          return 0;
        }
        return gp.statusA1D;
      },
      fiber$getDown :function* _trc_GamePad_f_getDown(_thread,index) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp) {
          return 0;
        }
        return gp.statusA1D;
        
      },
      getLeft :function _trc_GamePad_getLeft(index) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp) {
          return 0;
        }
        return gp.statusA1L;
      },
      fiber$getLeft :function* _trc_GamePad_f_getLeft(_thread,index) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp) {
          return 0;
        }
        return gp.statusA1L;
        
      },
      getRight :function _trc_GamePad_getRight(index) {
        var _this=this;
        var gp;
        
        _this.enableGamePad();
        gp = _this.gamepads[index];
        
        if (! gp) {
          return 0;
        }
        return gp.statusA1R;
      },
      fiber$getRight :function* _trc_GamePad_f_getRight(_thread,index) {
        var _this=this;
        var gp;
        
        (yield* _this.fiber$enableGamePad(_thread));
        gp = _this.gamepads[index];
        
        if (! gp) {
          return 0;
        }
        return gp.statusA1R;
        
      },
      update :function _trc_GamePad_update() {
        var _this=this;
        var pads;
        var i;
        var pad;
        var idx;
        var gamepad;
        var buttons;
        var j;
        var button;
        var pressed;
        var AXIS_NEUTRAL;
        var axisLR;
        var axisUD;
        
        if (! (window.Gamepad||navigator.getGamepads||navigator.webkitGetGamepads)) {
          _this.available=false;
          return _this;
          
        }
        _this.available=true;
        if (! _this.useGamePad) {
          return _this;
        }
        if (! _this.enable) {
          return _this;
        }
        if (_this.prevFrameCount==Tonyu.globals.$frameCount) {
          return _this;
        }
        pads = navigator.getGamepads?navigator.getGamepads():(navigator.webkitGetGamepads?navigator.webkitGetGamepads:[]);
        
        for (i = 0;
         i<pads.length ; i++) {
          {
            pad = pads[i];
            
            if (! pad) {
              continue;
              
              
            }
            idx = pad.index;
            
            if (! _this.gamepads[idx]) {
              _this.gamepads[idx]={updateFrame: Tonyu.globals.$frameCount,pad: pad,status: [],statusA1L: 0,statusA1R: 0,statusA1U: 0,statusA1D: 0};
              
            } else {
              _this.gamepads[idx].updateFrame=Tonyu.globals.$frameCount;
              _this.gamepads[idx].pad=pad;
              
            }
            gamepad = _this.gamepads[idx];
            
            buttons = pad.buttons;
            
            for (j = 0;
             j<buttons.length ; j++) {
              {
                button = buttons[j];
                
                pressed = button.pressed;
                
                if (gamepad.status[j]==null) {
                  gamepad.status[j]=0;
                  
                } else {
                  if (pressed) {
                    gamepad.status[j]++;
                    
                  } else {
                    gamepad.status[j]=0;
                    
                  }
                  
                }
              }
            }
            AXIS_NEUTRAL = 0.4;
            
            if (pad.axes.length>=2) {
              axisLR = pad.axes[0];
              
              axisUD = pad.axes[1];
              
              if (axisLR!=null&&axisUD!=null) {
                gamepad.statusA1L=(axisLR<=- AXIS_NEUTRAL)?gamepad.statusA1L+1:0;
                gamepad.statusA1R=(axisLR>=AXIS_NEUTRAL)?gamepad.statusA1R+1:0;
                gamepad.statusA1U=(axisUD<=- AXIS_NEUTRAL)?gamepad.statusA1U+1:0;
                gamepad.statusA1D=(axisUD>=AXIS_NEUTRAL)?gamepad.statusA1D+1:0;
                
              }
              
            }
          }
        }
        for (i = 0;
         i<_this.gamepads.length ; i++) {
          {
            pad = _this.gamepads[i];
            
            if (pad) {
              if (pad.updateFrame!=Tonyu.globals.$frameCount) {
                _this.gamepads[i]=null;
                
              }
              
            }
          }
        }
        _this.prevFrameCount=Tonyu.globals.$frameCount;
      },
      fiber$update :function* _trc_GamePad_f_update(_thread) {
        var _this=this;
        var pads;
        var i;
        var pad;
        var idx;
        var gamepad;
        var buttons;
        var j;
        var button;
        var pressed;
        var AXIS_NEUTRAL;
        var axisLR;
        var axisUD;
        
        if (! (window.Gamepad||navigator.getGamepads||navigator.webkitGetGamepads)) {
          _this.available=false;
          return _this;
          
        }
        _this.available=true;
        if (! _this.useGamePad) {
          return _this;
        }
        if (! _this.enable) {
          return _this;
        }
        if (_this.prevFrameCount==Tonyu.globals.$frameCount) {
          return _this;
        }
        pads = navigator.getGamepads?navigator.getGamepads():(navigator.webkitGetGamepads?navigator.webkitGetGamepads:[]);
        
        for (i = 0;
         i<pads.length ; i++) {
          {
            pad = pads[i];
            
            if (! pad) {
              continue;
              
              
            }
            idx = pad.index;
            
            if (! _this.gamepads[idx]) {
              _this.gamepads[idx]={updateFrame: Tonyu.globals.$frameCount,pad: pad,status: [],statusA1L: 0,statusA1R: 0,statusA1U: 0,statusA1D: 0};
              
            } else {
              _this.gamepads[idx].updateFrame=Tonyu.globals.$frameCount;
              _this.gamepads[idx].pad=pad;
              
            }
            gamepad = _this.gamepads[idx];
            
            buttons = pad.buttons;
            
            for (j = 0;
             j<buttons.length ; j++) {
              {
                button = buttons[j];
                
                pressed = button.pressed;
                
                if (gamepad.status[j]==null) {
                  gamepad.status[j]=0;
                  
                } else {
                  if (pressed) {
                    gamepad.status[j]++;
                    
                  } else {
                    gamepad.status[j]=0;
                    
                  }
                  
                }
              }
            }
            AXIS_NEUTRAL = 0.4;
            
            if (pad.axes.length>=2) {
              axisLR = pad.axes[0];
              
              axisUD = pad.axes[1];
              
              if (axisLR!=null&&axisUD!=null) {
                gamepad.statusA1L=(axisLR<=- AXIS_NEUTRAL)?gamepad.statusA1L+1:0;
                gamepad.statusA1R=(axisLR>=AXIS_NEUTRAL)?gamepad.statusA1R+1:0;
                gamepad.statusA1U=(axisUD<=- AXIS_NEUTRAL)?gamepad.statusA1U+1:0;
                gamepad.statusA1D=(axisUD>=AXIS_NEUTRAL)?gamepad.statusA1D+1:0;
                
              }
              
            }
          }
        }
        for (i = 0;
         i<_this.gamepads.length ; i++) {
          {
            pad = _this.gamepads[i];
            
            if (pad) {
              if (pad.updateFrame!=Tonyu.globals.$frameCount) {
                _this.gamepads[i]=null;
                
              }
              
            }
          }
        }
        _this.prevFrameCount=Tonyu.globals.$frameCount;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"setEnable":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"enableGamePad":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getGamepads":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"get":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"padsCount":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getPad":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getPadId":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"isConnected":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getMapping":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getButton":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getButtonValue":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getButtonCount":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getAxis":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getAxisCount":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getUp":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getDown":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getLeft":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getRight":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"update":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"available":{},"useGamePad":{},"enable":{},"gamepads":{},"gamepadones":{},"prevFrameCount":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.GamePadOne',
  shortName: 'GamePadOne',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_GamePadOne_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_GamePadOne_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_GamePadOne_initialize(gamePad,padNo) {
        var _this=this;
        
        _this.gamePad=gamePad;
        _this.padNo=padNo;
      },
      getGamePad :function _trc_GamePadOne_getGamePad() {
        var _this=this;
        
        return _this.gamePad;
      },
      fiber$getGamePad :function* _trc_GamePadOne_f_getGamePad(_thread) {
        var _this=this;
        
        return _this.gamePad;
        
      },
      getPadNo :function _trc_GamePadOne_getPadNo() {
        var _this=this;
        
        return _this.padNo;
      },
      fiber$getPadNo :function* _trc_GamePadOne_f_getPadNo(_thread) {
        var _this=this;
        
        return _this.padNo;
        
      },
      getPad :function _trc_GamePadOne_getPad() {
        var _this=this;
        
        return _this.gamePad.gamePadCount(_this.padNo);
      },
      fiber$getPad :function* _trc_GamePadOne_f_getPad(_thread) {
        var _this=this;
        
        return _this.gamePad.gamePadCount(_this.padNo);
        
      },
      getPadId :function _trc_GamePadOne_getPadId() {
        var _this=this;
        
        return _this.gamePad.getPadId(_this.padNo);
      },
      fiber$getPadId :function* _trc_GamePadOne_f_getPadId(_thread) {
        var _this=this;
        
        return _this.gamePad.getPadId(_this.padNo);
        
      },
      isConnected :function _trc_GamePadOne_isConnected() {
        var _this=this;
        
        return _this.gamePad.isConnected(_this.padNo);
      },
      fiber$isConnected :function* _trc_GamePadOne_f_isConnected(_thread) {
        var _this=this;
        
        return _this.gamePad.isConnected(_this.padNo);
        
      },
      getMapping :function _trc_GamePadOne_getMapping() {
        var _this=this;
        
        return _this.gamePad.getMapping(_this.padNo);
      },
      fiber$getMapping :function* _trc_GamePadOne_f_getMapping(_thread) {
        var _this=this;
        
        return _this.gamePad.getMapping(_this.padNo);
        
      },
      getButton :function _trc_GamePadOne_getButton(btnNo) {
        var _this=this;
        
        return _this.gamePad.getButton(_this.padNo,btnNo);
      },
      fiber$getButton :function* _trc_GamePadOne_f_getButton(_thread,btnNo) {
        var _this=this;
        
        return _this.gamePad.getButton(_this.padNo,btnNo);
        
      },
      getButtonValue :function _trc_GamePadOne_getButtonValue(btnNo) {
        var _this=this;
        
        return _this.gamePad.getButtonValue(_this.padNo,btnNo);
      },
      fiber$getButtonValue :function* _trc_GamePadOne_f_getButtonValue(_thread,btnNo) {
        var _this=this;
        
        return _this.gamePad.getButtonValue(_this.padNo,btnNo);
        
      },
      getButtonCount :function _trc_GamePadOne_getButtonCount() {
        var _this=this;
        
        return _this.gamePad.getButtonCount(_this.padNo);
      },
      fiber$getButtonCount :function* _trc_GamePadOne_f_getButtonCount(_thread) {
        var _this=this;
        
        return _this.gamePad.getButtonCount(_this.padNo);
        
      },
      getAxis :function _trc_GamePadOne_getAxis(btnNo) {
        var _this=this;
        
        return _this.gamePad.getAxis(_this.padNo,btnNo);
      },
      fiber$getAxis :function* _trc_GamePadOne_f_getAxis(_thread,btnNo) {
        var _this=this;
        
        return _this.gamePad.getAxis(_this.padNo,btnNo);
        
      },
      getAxisCount :function _trc_GamePadOne_getAxisCount() {
        var _this=this;
        
        return _this.gamePad.getAxisCount(_this.padNo);
      },
      fiber$getAxisCount :function* _trc_GamePadOne_f_getAxisCount(_thread) {
        var _this=this;
        
        return _this.gamePad.getAxisCount(_this.padNo);
        
      },
      getUp :function _trc_GamePadOne_getUp() {
        var _this=this;
        
        return _this.gamePad.getUp(_this.padNo);
      },
      fiber$getUp :function* _trc_GamePadOne_f_getUp(_thread) {
        var _this=this;
        
        return _this.gamePad.getUp(_this.padNo);
        
      },
      getDown :function _trc_GamePadOne_getDown() {
        var _this=this;
        
        return _this.gamePad.getDown(_this.padNo);
      },
      fiber$getDown :function* _trc_GamePadOne_f_getDown(_thread) {
        var _this=this;
        
        return _this.gamePad.getDown(_this.padNo);
        
      },
      getLeft :function _trc_GamePadOne_getLeft() {
        var _this=this;
        
        return _this.gamePad.getLeft(_this.padNo);
      },
      fiber$getLeft :function* _trc_GamePadOne_f_getLeft(_thread) {
        var _this=this;
        
        return _this.gamePad.getLeft(_this.padNo);
        
      },
      getRight :function _trc_GamePadOne_getRight() {
        var _this=this;
        
        return _this.gamePad.getRight(_this.padNo);
      },
      fiber$getRight :function* _trc_GamePadOne_f_getRight(_thread) {
        var _this=this;
        
        return _this.gamePad.getRight(_this.padNo);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getGamePad":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getPadNo":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getPad":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getPadId":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isConnected":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getMapping":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getButton":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getButtonValue":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getButtonCount":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getAxis":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getAxisCount":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getUp":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getDown":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getLeft":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getRight":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"gamePad":{},"padNo":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ExtLink',
  shortName: 'ExtLink',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ExtLink_main() {
        var _this=this;
        
        _this.exec = (WebSite.isNW?require('child_process').exec:(function anonymous_110() {
          
        }));
        
      },
      fiber$main :function* _trc_ExtLink_f_main(_thread) {
        var _this=this;
        
        _this.exec = (WebSite.isNW?require('child_process').exec:(function anonymous_110() {
          
        }));
        
        
      },
      getOpt :function _trc_ExtLink_getOpt(options) {
        var _this=this;
        var p;
        var afterClick;
        
        p = WebSite.platform;
        
        options=options||{};
        let href = options.href;
        
        options.on=options.on||{};
        afterClick = (options.onclick)||(function anonymous_451() {
          
        });
        
        if (p=="win32") {
          options.href="javascript:;";
          options.onclick=_this.ext("start",href,afterClick);
          
        } else {
          if (p=="darwin") {
            options.href="javascript:;";
            options.onclick=_this.ext("open",href,afterClick);
            
          } else {
            
            
          }
        }
        return options;
      },
      fiber$getOpt :function* _trc_ExtLink_f_getOpt(_thread,options) {
        var _this=this;
        var p;
        var afterClick;
        
        p = WebSite.platform;
        
        options=options||{};
        let href = options.href;
        
        options.on=options.on||{};
        afterClick = (options.onclick)||(function anonymous_451() {
          
        });
        
        if (p=="win32") {
          options.href="javascript:;";
          options.onclick=(yield* _this.fiber$ext(_thread, "start", href, afterClick));
          
        } else {
          if (p=="darwin") {
            options.href="javascript:;";
            options.onclick=(yield* _this.fiber$ext(_thread, "open", href, afterClick));
            
          } else {
            
            
          }
        }
        return options;
        
      },
      ext :function _trc_ExtLink_ext(cmd,href,afterClick) {
        var _this=this;
        
        return (function anonymous_902() {
          
          _this.exec(cmd+" "+href);
          if (afterClick) {
            afterClick();
          }
        });
      },
      fiber$ext :function* _trc_ExtLink_f_ext(_thread,cmd,href,afterClick) {
        var _this=this;
        
        return (function anonymous_902() {
          
          _this.exec(cmd+" "+href);
          if (afterClick) {
            afterClick();
          }
        });
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"getOpt":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"ext":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}}},"fields":{"exec":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.JQExpr',
  shortName: 'JQExpr',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.EventHandlerCaller],
  methods: function (__superClass) {
    return {
      main :function _trc_JQExpr_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_JQExpr_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      isArray :function _trc_JQExpr_isArray(e) {
        var _this=this;
        
        return e&&typeof  e.splice==="function";
      },
      fiber$isArray :function* _trc_JQExpr_f_isArray(_thread,e) {
        var _this=this;
        
        return e&&typeof  e.splice==="function";
        
      },
      isPlainObj :function _trc_JQExpr_isPlainObj(e) {
        var _this=this;
        
        return e&&! _this.isArray(e)&&typeof  e==="object";
      },
      fiber$isPlainObj :function* _trc_JQExpr_f_isPlainObj(_thread,e) {
        var _this=this;
        
        return e&&! _this.isArray(e)&&typeof  e==="object";
        
      },
      genid :function _trc_JQExpr_genid() {
        var _this=this;
        
        Tonyu.globals.$dom_idSeq=Tonyu.globals.$dom_idSeq||0;
        Tonyu.globals.$dom_idSeq++;
        return "JQExpr"+Tonyu.globals.$dom_idSeq;
      },
      fiber$genid :function* _trc_JQExpr_f_genid(_thread) {
        var _this=this;
        
        Tonyu.globals.$dom_idSeq=Tonyu.globals.$dom_idSeq||0;
        Tonyu.globals.$dom_idSeq++;
        return "JQExpr"+Tonyu.globals.$dom_idSeq;
        
      },
      isPrimitive :function _trc_JQExpr_isPrimitive(v) {
        var _this=this;
        
        return ({number: 1,string: 1,boolean: 1})[typeof  v];
      },
      fiber$isPrimitive :function* _trc_JQExpr_f_isPrimitive(_thread,v) {
        var _this=this;
        
        return ({number: 1,string: 1,boolean: 1})[typeof  v];
        
      },
      extLink :function _trc_JQExpr_extLink() {
        var _this=this;
        
        return Tonyu.globals.$JQEX_extLink||(Tonyu.globals.$JQEX_extLink=new Tonyu.classes.kernel.ExtLink);
      },
      fiber$extLink :function* _trc_JQExpr_f_extLink(_thread) {
        var _this=this;
        
        return Tonyu.globals.$JQEX_extLink||(Tonyu.globals.$JQEX_extLink=new Tonyu.classes.kernel.ExtLink);
        
      },
      add2 :function _trc_JQExpr_add2(parentID,expr) {
        var _this=this;
        var esc;
        var tagname;
        var elem;
        var id;
        var name;
        var attr;
        var r_evt;
        var svp;
        var e;
        
        if (! parentID) {
          throw new Error("parentID is not set for "+expr);
          
        }
        if (_this.isPrimitive(expr)) {
          expr=expr+"";
          esc = expr.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
          
          $("#"+parentID).append(esc);
          return parentID;
          
        }
        if (! expr.shift) {
          throw new Error(expr+" is not valid expression");
          
          
        }
        tagname = expr.shift();
        
        elem = $("<"+tagname+">").appendTo("#"+parentID);
        
        
        if (_this.isPlainObj(expr[0])) {
          attr = expr.shift();
          
          r_evt = /^on(.*)/i;
          
          if (tagname==="a") {
            attr=_this.extLink().getOpt(attr);
            
          }
          for (let [k, v] of Tonyu.iterator2(attr,2)) {
            let m = r_evt.exec(k);
            
            if (m) {
              if (typeof  v==="function") {
                elem.on(m[1],(function anonymous_1400(...args) {
                  
                  return _this.callEventHandler(v,args);
                }));
                
              }
              
            } else {
              if (_this.isPrimitive(v)) {
                if ((v+"").match(/^javascript:/)) {
                  v="javascript:;";
                }
                elem.attr(k,v);
                if (k==="id") {
                  id=v;
                }
                if (k==="name") {
                  name=v;
                }
                
              }
            }
            
          }
          
        }
        
        elem.on("focus",(function anonymous_1806() {
          
          svp=Tonyu.globals.$Keys.preventDefaults;
          Tonyu.globals.$Keys.preventDefaults={};
        }));
        elem.on("blur",(function anonymous_1909() {
          
          if (svp) {
            Tonyu.globals.$Keys.preventDefaults=svp;
          }
        }));
        if (! id) {
          id=_this.genid();
          elem.attr("id",id);
          
        }
        if (name) {
          _this.name2id=_this.name2id||{};
          _this.name2id[name]=id;
          
        }
        for ([e] of Tonyu.iterator2(expr,1)) {
          _this.add2(id,e);
          
        }
        return id;
      },
      fiber$add2 :function* _trc_JQExpr_f_add2(_thread,parentID,expr) {
        var _this=this;
        var esc;
        var tagname;
        var elem;
        var id;
        var name;
        var attr;
        var r_evt;
        var svp;
        var e;
        
        if (! parentID) {
          throw new Error("parentID is not set for "+expr);
          
        }
        if (_this.isPrimitive(expr)) {
          expr=expr+"";
          esc = expr.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
          
          $("#"+parentID).append(esc);
          return parentID;
          
        }
        if (! expr.shift) {
          throw new Error(expr+" is not valid expression");
          
          
        }
        tagname = expr.shift();
        
        elem = $("<"+tagname+">").appendTo("#"+parentID);
        
        
        if (_this.isPlainObj(expr[0])) {
          attr = expr.shift();
          
          r_evt = /^on(.*)/i;
          
          if (tagname==="a") {
            attr=_this.extLink().getOpt(attr);
            
          }
          for (let [k, v] of Tonyu.iterator2(attr,2)) {
            let m = r_evt.exec(k);
            
            if (m) {
              if (typeof  v==="function") {
                elem.on(m[1],(function anonymous_1400(...args) {
                  
                  return _this.callEventHandler(v,args);
                }));
                
              }
              
            } else {
              if (_this.isPrimitive(v)) {
                if ((v+"").match(/^javascript:/)) {
                  v="javascript:;";
                }
                elem.attr(k,v);
                if (k==="id") {
                  id=v;
                }
                if (k==="name") {
                  name=v;
                }
                
              }
            }
            
          }
          
        }
        
        elem.on("focus",(function anonymous_1806() {
          
          svp=Tonyu.globals.$Keys.preventDefaults;
          Tonyu.globals.$Keys.preventDefaults={};
        }));
        elem.on("blur",(function anonymous_1909() {
          
          if (svp) {
            Tonyu.globals.$Keys.preventDefaults=svp;
          }
        }));
        if (! id) {
          id=(yield* _this.fiber$genid(_thread));
          elem.attr("id",id);
          
        }
        if (name) {
          _this.name2id=_this.name2id||{};
          _this.name2id[name]=id;
          
        }
        for ([e] of Tonyu.iterator2(expr,1)) {
          (yield* _this.fiber$add2(_thread, id, e));
          
        }
        return id;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"isArray":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"isPlainObj":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"genid":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isPrimitive":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"extLink":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"add2":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"name2id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.InputDevice',
  shortName: 'InputDevice',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.AssertionMod],
  methods: function (__superClass) {
    return {
      main :function _trc_InputDevice_main() {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        
        
        
        
        
      },
      fiber$main :function* _trc_InputDevice_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        
        
        
        
        
        
      },
      initialize :function _trc_InputDevice_initialize() {
        var _this=this;
        
        _this.listeners=[];
        _this.touchEmu=true;
        _this.wheelVy=0;
        _this.defaultLayerPath=_this.assertIs(Tonyu.globals.$Screen.defaultLayerPath,Tonyu.classes.kernel.LayerPath,"$Screen.defaultLayerPath");
      },
      __getter__defaultLayer :function _trc_InputDevice___getter__defaultLayer() {
        var _this=this;
        
        if (Tonyu.is(_this.defaultLayerPath.target,Tonyu.classes.kernel.ScreenLayer)) {
          return _this.defaultLayerPath.target.group;
        }
        return _this.defaultLayerPath.target;
      },
      __setter__defaultLayer :function _trc_InputDevice___setter__defaultLayer(l) {
        var _this=this;
        
        _this.defaultLayerPath=_this.assertIs(l.defaultLayerPath,Tonyu.classes.kernel.LayerPath,"l.def");
      },
      handleListeners :function _trc_InputDevice_handleListeners(type,evt) {
        var _this=this;
        var l;
        
        l = _this.listeners;
        
        _this.listeners=[];
        while (l.length>0) {
          (l.shift())();
          
        }
        if (type&&evt) {
          evt.type=type;
          _this.fireEvent(type,evt);
          
        }
        if (Tonyu.globals.$Boot.economyMode&&! Tonyu.globals.$Boot.economyMode.manualDraw) {
          Tonyu.globals.$Boot.requestDrawFrame();
          
        }
      },
      fiber$handleListeners :function* _trc_InputDevice_f_handleListeners(_thread,type,evt) {
        var _this=this;
        var l;
        
        l = _this.listeners;
        
        _this.listeners=[];
        while (l.length>0) {
          (l.shift())();
          
        }
        if (type&&evt) {
          evt.type=type;
          _this.fireEvent(type,evt);
          
        }
        if (Tonyu.globals.$Boot.economyMode&&! Tonyu.globals.$Boot.economyMode.manualDraw) {
          Tonyu.globals.$Boot.requestDrawFrame();
          
        }
        
      },
      addOnetimeListener :function _trc_InputDevice_addOnetimeListener(l) {
        var _this=this;
        
        _this.listeners.push(l);
      },
      fiber$addOnetimeListener :function* _trc_InputDevice_f_addOnetimeListener(_thread,l) {
        var _this=this;
        
        _this.listeners.push(l);
        
      },
      changeTouchLayer :function _trc_InputDevice_changeTouchLayer(t,toLayer) {
        var _this=this;
        
        return t.layer=toLayer;
      },
      fiber$changeTouchLayer :function* _trc_InputDevice_f_changeTouchLayer(_thread,t,toLayer) {
        var _this=this;
        
        return t.layer=toLayer;
        
      },
      initCanvasEvents :function _trc_InputDevice_initCanvasEvents(cvj) {
        var _this=this;
        var cv;
        var ID_MOUSE;
        var bmap;
        var handleMouseDown;
        var handleMouseMove;
        var handleMouseUp;
        var handleTouchStart;
        var handleTouchMove;
        var handleTouchEnd;
        var handleWheel;
        var d;
        
        _this.rootCanvas=cvj;
        cv = cvj[0];
        
        ID_MOUSE = 31238612;
        
        bmap = [1,4,2];
        
        Tonyu.globals.$handleMouseDown=(function anonymous_1515(e) {
          var p;
          var mp;
          
          _this.debug("mouseDown",Tonyu.globals.$InputDevice.touchEmu,e);
          _this.mouseDownAtCV=true;
          Tonyu.resetLoopCheck();
          if (Tonyu.globals.$t2MediaLib) {
            Tonyu.globals.$t2MediaLib.activate();
          }
          e.preventDefault();
          window.focus();
          p = cvj.offset();
          
          mp = {x: e.clientX-p.left,y: e.clientY-p.top};
          
          mp=Tonyu.globals.$rootLayerPath.convert(mp,_this.defaultLayerPath);
          Tonyu.globals.$mouseX=mp.x;
          Tonyu.globals.$mouseY=mp.y;
          _this.mouseButton=_this.mouseButton|(1<<e.button);
          _this.isMouseDown=true;
          if (Tonyu.globals.$InputDevice.touchEmu) {
            Tonyu.globals.$handleTouchStart({preventDefault: (function anonymous_2361() {
              
            }),originalEvent: {changedTouches: [{identifier: ID_MOUSE+e.button,pageX: e.clientX,pageY: e.clientY}]},byMouse: bmap[e.button]||1});
            
          }
          _this.handleListeners();
        });
        Tonyu.globals.$handleMouseMove=(function anonymous_2707(e) {
          var p;
          var mp;
          var changedTouches;
          var btn;
          var bid;
          
          _this.debug("mouseMove",Tonyu.globals.$InputDevice.touchEmu,e);
          Tonyu.resetLoopCheck();
          if (_this.mouseDownAtCV) {
            e.preventDefault();
          }
          p = cvj.offset();
          
          mp = {x: e.clientX-p.left,y: e.clientY-p.top};
          
          mp=Tonyu.globals.$rootLayerPath.convert(mp,_this.defaultLayerPath);
          _this.fireEvent("mouseMove",{x: mp.x,y: mp.y,vx: Tonyu.globals.$mouseX==null?0:mp.x-Tonyu.globals.$mouseX,vy: Tonyu.globals.$mouseY==null?0:mp.y-Tonyu.globals.$mouseY});
          Tonyu.globals.$mouseX=mp.x;
          Tonyu.globals.$mouseY=mp.y;
          if (_this.isMouseDown&&Tonyu.globals.$InputDevice.touchEmu) {
            changedTouches = [];
            
            btn = _this.mouseButton;
            bid = 0;
            
            while (btn) {
              if (btn&1) {
                changedTouches.push({identifier: ID_MOUSE+bid,pageX: e.clientX,pageY: e.clientY});
                
              }
              btn=btn>>1;
              bid++;
              
            }
            Tonyu.globals.$handleTouchMove({preventDefault: (function anonymous_3822() {
              
            }),originalEvent: {changedTouches: changedTouches},byMouse: bmap[e.button]||1});
            
          }
          _this.handleListeners();
        });
        Tonyu.globals.$handleMouseUp=(function anonymous_4055(e) {
          
          _this.debug("mouseUp",Tonyu.globals.$InputDevice.touchEmu);
          Tonyu.resetLoopCheck();
          if (Tonyu.globals.$t2MediaLib) {
            Tonyu.globals.$t2MediaLib.activate();
          }
          if (_this.mouseDownAtCV) {
            e.preventDefault();
          }
          _this.mouseDownAtCV=false;
          _this.isMouseDown=false;
          _this.mouseButton=_this.mouseButton&~ (1<<e.button);
          if (Tonyu.globals.$InputDevice.touchEmu) {
            Tonyu.globals.$handleTouchEnd({preventDefault: (function anonymous_4496() {
              
            }),originalEvent: {changedTouches: [{identifier: ID_MOUSE+e.button,pageX: e.clientX,pageY: e.clientY}]},byMouse: bmap[e.button]||1});
            
          }
        });
        _this.touch=new Tonyu.classes.kernel.TouchFingers(_this);
        Tonyu.globals.$touches=_this.touch.fingerArray;
        Tonyu.globals.$handleTouchStart=(function anonymous_4894(e) {
          
          return _this.touch.handleStart(e);
        });
        Tonyu.globals.$handleTouchMove=(function anonymous_4978(e) {
          
          return _this.touch.handleMove(e);
        });
        Tonyu.globals.$handleTouchEnd=(function anonymous_5060(e) {
          
          return _this.touch.handleEnd(e);
        });
        Tonyu.globals.$handleWheel=(function anonymous_5138(e) {
          
          e=e.originalEvent;
          _this.wheelVy+=e.deltaY;
          _this.fireEvent("wheel",e);
          return false;
        });
        Tonyu.globals.$unsetTouchEmu=(function anonymous_5283() {
          
          Tonyu.resetLoopCheck();
          Tonyu.globals.$InputDevice.touchEmu=false;
          return _this.touch.unsetEmu();
        });
        handleMouseDown = (function anonymous_5436(e) {
          
          Tonyu.globals.$handleMouseDown(e);
        });
        
        handleMouseMove = (function anonymous_5489(e) {
          
          Tonyu.globals.$handleMouseMove(e);
        });
        
        handleMouseUp = (function anonymous_5540(e) {
          
          Tonyu.globals.$handleMouseUp(e);
        });
        
        handleTouchStart = (function anonymous_5592(e) {
          
          Tonyu.globals.$unsetTouchEmu();
          Tonyu.globals.$handleTouchStart(e);
        });
        
        handleTouchMove = (function anonymous_5663(e) {
          
          Tonyu.globals.$unsetTouchEmu();
          Tonyu.globals.$handleTouchMove(e);
        });
        
        handleTouchEnd = (function anonymous_5732(e) {
          
          Tonyu.globals.$unsetTouchEmu();
          Tonyu.globals.$handleTouchEnd(e);
        });
        
        handleWheel = (function anonymous_5797(e) {
          
          Tonyu.globals.$handleWheel(e);
        });
        
        d = $.data(cv,"events");
        
        if (! d) {
          $.data(cv,"events","true");
          cvj.mousedown(handleMouseDown);
          $(document).mousemove(handleMouseMove);
          $(document).mouseup(handleMouseUp);
          $(document).on("mouseleave",handleMouseUp);
          cvj.on("contextmenu",(function anonymous_6152(e) {
            
            e.stopPropagation();
            e.preventDefault();
          }));
          cvj.on("touchstart",handleTouchStart);
          cvj.on("touchmove",handleTouchMove);
          cvj.on("touchend",handleTouchEnd);
          cvj.on("touchcancel",handleTouchEnd);
          cvj.on("wheel",handleWheel);
          
        }
      },
      fiber$initCanvasEvents :function* _trc_InputDevice_f_initCanvasEvents(_thread,cvj) {
        var _this=this;
        var cv;
        var ID_MOUSE;
        var bmap;
        var handleMouseDown;
        var handleMouseMove;
        var handleMouseUp;
        var handleTouchStart;
        var handleTouchMove;
        var handleTouchEnd;
        var handleWheel;
        var d;
        
        _this.rootCanvas=cvj;
        cv = cvj[0];
        
        ID_MOUSE = 31238612;
        
        bmap = [1,4,2];
        
        Tonyu.globals.$handleMouseDown=(function anonymous_1515(e) {
          var p;
          var mp;
          
          _this.debug("mouseDown",Tonyu.globals.$InputDevice.touchEmu,e);
          _this.mouseDownAtCV=true;
          Tonyu.resetLoopCheck();
          if (Tonyu.globals.$t2MediaLib) {
            Tonyu.globals.$t2MediaLib.activate();
          }
          e.preventDefault();
          window.focus();
          p = cvj.offset();
          
          mp = {x: e.clientX-p.left,y: e.clientY-p.top};
          
          mp=Tonyu.globals.$rootLayerPath.convert(mp,_this.defaultLayerPath);
          Tonyu.globals.$mouseX=mp.x;
          Tonyu.globals.$mouseY=mp.y;
          _this.mouseButton=_this.mouseButton|(1<<e.button);
          _this.isMouseDown=true;
          if (Tonyu.globals.$InputDevice.touchEmu) {
            Tonyu.globals.$handleTouchStart({preventDefault: (function anonymous_2361() {
              
            }),originalEvent: {changedTouches: [{identifier: ID_MOUSE+e.button,pageX: e.clientX,pageY: e.clientY}]},byMouse: bmap[e.button]||1});
            
          }
          _this.handleListeners();
        });
        Tonyu.globals.$handleMouseMove=(function anonymous_2707(e) {
          var p;
          var mp;
          var changedTouches;
          var btn;
          var bid;
          
          _this.debug("mouseMove",Tonyu.globals.$InputDevice.touchEmu,e);
          Tonyu.resetLoopCheck();
          if (_this.mouseDownAtCV) {
            e.preventDefault();
          }
          p = cvj.offset();
          
          mp = {x: e.clientX-p.left,y: e.clientY-p.top};
          
          mp=Tonyu.globals.$rootLayerPath.convert(mp,_this.defaultLayerPath);
          _this.fireEvent("mouseMove",{x: mp.x,y: mp.y,vx: Tonyu.globals.$mouseX==null?0:mp.x-Tonyu.globals.$mouseX,vy: Tonyu.globals.$mouseY==null?0:mp.y-Tonyu.globals.$mouseY});
          Tonyu.globals.$mouseX=mp.x;
          Tonyu.globals.$mouseY=mp.y;
          if (_this.isMouseDown&&Tonyu.globals.$InputDevice.touchEmu) {
            changedTouches = [];
            
            btn = _this.mouseButton;
            bid = 0;
            
            while (btn) {
              if (btn&1) {
                changedTouches.push({identifier: ID_MOUSE+bid,pageX: e.clientX,pageY: e.clientY});
                
              }
              btn=btn>>1;
              bid++;
              
            }
            Tonyu.globals.$handleTouchMove({preventDefault: (function anonymous_3822() {
              
            }),originalEvent: {changedTouches: changedTouches},byMouse: bmap[e.button]||1});
            
          }
          _this.handleListeners();
        });
        Tonyu.globals.$handleMouseUp=(function anonymous_4055(e) {
          
          _this.debug("mouseUp",Tonyu.globals.$InputDevice.touchEmu);
          Tonyu.resetLoopCheck();
          if (Tonyu.globals.$t2MediaLib) {
            Tonyu.globals.$t2MediaLib.activate();
          }
          if (_this.mouseDownAtCV) {
            e.preventDefault();
          }
          _this.mouseDownAtCV=false;
          _this.isMouseDown=false;
          _this.mouseButton=_this.mouseButton&~ (1<<e.button);
          if (Tonyu.globals.$InputDevice.touchEmu) {
            Tonyu.globals.$handleTouchEnd({preventDefault: (function anonymous_4496() {
              
            }),originalEvent: {changedTouches: [{identifier: ID_MOUSE+e.button,pageX: e.clientX,pageY: e.clientY}]},byMouse: bmap[e.button]||1});
            
          }
        });
        _this.touch=new Tonyu.classes.kernel.TouchFingers(_this);
        Tonyu.globals.$touches=_this.touch.fingerArray;
        Tonyu.globals.$handleTouchStart=(function anonymous_4894(e) {
          
          return _this.touch.handleStart(e);
        });
        Tonyu.globals.$handleTouchMove=(function anonymous_4978(e) {
          
          return _this.touch.handleMove(e);
        });
        Tonyu.globals.$handleTouchEnd=(function anonymous_5060(e) {
          
          return _this.touch.handleEnd(e);
        });
        Tonyu.globals.$handleWheel=(function anonymous_5138(e) {
          
          e=e.originalEvent;
          _this.wheelVy+=e.deltaY;
          _this.fireEvent("wheel",e);
          return false;
        });
        Tonyu.globals.$unsetTouchEmu=(function anonymous_5283() {
          
          Tonyu.resetLoopCheck();
          Tonyu.globals.$InputDevice.touchEmu=false;
          return _this.touch.unsetEmu();
        });
        handleMouseDown = (function anonymous_5436(e) {
          
          Tonyu.globals.$handleMouseDown(e);
        });
        
        handleMouseMove = (function anonymous_5489(e) {
          
          Tonyu.globals.$handleMouseMove(e);
        });
        
        handleMouseUp = (function anonymous_5540(e) {
          
          Tonyu.globals.$handleMouseUp(e);
        });
        
        handleTouchStart = (function anonymous_5592(e) {
          
          Tonyu.globals.$unsetTouchEmu();
          Tonyu.globals.$handleTouchStart(e);
        });
        
        handleTouchMove = (function anonymous_5663(e) {
          
          Tonyu.globals.$unsetTouchEmu();
          Tonyu.globals.$handleTouchMove(e);
        });
        
        handleTouchEnd = (function anonymous_5732(e) {
          
          Tonyu.globals.$unsetTouchEmu();
          Tonyu.globals.$handleTouchEnd(e);
        });
        
        handleWheel = (function anonymous_5797(e) {
          
          Tonyu.globals.$handleWheel(e);
        });
        
        d = $.data(cv,"events");
        
        if (! d) {
          $.data(cv,"events","true");
          cvj.mousedown(handleMouseDown);
          $(document).mousemove(handleMouseMove);
          $(document).mouseup(handleMouseUp);
          $(document).on("mouseleave",handleMouseUp);
          cvj.on("contextmenu",(function anonymous_6152(e) {
            
            e.stopPropagation();
            e.preventDefault();
          }));
          cvj.on("touchstart",handleTouchStart);
          cvj.on("touchmove",handleTouchMove);
          cvj.on("touchend",handleTouchEnd);
          cvj.on("touchcancel",handleTouchEnd);
          cvj.on("wheel",handleWheel);
          
        }
        
      },
      update :function _trc_InputDevice_update() {
        var _this=this;
        
        _this.wheelVy=0;
        return _this.touch.updateFingers();
      },
      fiber$update :function* _trc_InputDevice_f_update(_thread) {
        var _this=this;
        
        _this.wheelVy=0;
        return _this.touch.updateFingers();
        
      },
      debug :function _trc_InputDevice_debug() {
        var _this=this;
        
        if (_this.debugFlag) {
          console.log.apply(console,arguments);
          
        }
      },
      fiber$debug :function* _trc_InputDevice_f_debug(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        
        if (_this.debugFlag) {
          console.log.apply(console,_arguments);
          
        }
        
      },
      reset :function _trc_InputDevice_reset() {
        var _this=this;
        
        _this.touch.reset();
      },
      fiber$reset :function* _trc_InputDevice_f_reset(_thread) {
        var _this=this;
        
        _this.touch.reset();
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__defaultLayer":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__defaultLayer":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"handleListeners":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"addOnetimeListener":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"changeTouchLayer":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"initCanvasEvents":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"update":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"debug":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"reset":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"defaultLayerPath":{"vtype":"kernel.LayerPath"},"listeners":{},"touchEmu":{"vtype":"Boolean"},"wheelVy":{"vtype":"Number"},"rootCanvas":{},"mouseDownAtCV":{"vtype":"Boolean"},"isMouseDown":{"vtype":"Boolean"},"mouseButton":{"vtype":"Number"},"touch":{"vtype":"kernel.TouchFingers"},"debugFlag":{"vtype":"Boolean"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.KeyDownHandler',
  shortName: 'KeyDownHandler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.EventHandler,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_KeyDownHandler_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_KeyDownHandler_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      createEvent :function _trc_KeyDownHandler_createEvent(raw) {
        var _this=this;
        var e;
        
        e = {};
        
        e.keyCode=e.code=raw.keyCode;
        e.keyName=e.name=Tonyu.globals.$Keys.codesRev[e.keyCode];
        if (! e.name) {
          e.keyName=e.name=e.code+"";
        }
        e.sendUps=[];
        e.on=(function anonymous_227(name,f) {
          
          if (name==="keyUp"||name==="up") {
            e.sendUps.push(f);
            
          }
        });
        e.sendUp=(function anonymous_345() {
          var f;
          
          for ([f] of Tonyu.iterator2(e.sendUps,1)) {
            f();
          }
        });
        return e;
      },
      fiber$createEvent :function* _trc_KeyDownHandler_f_createEvent(_thread,raw) {
        var _this=this;
        var e;
        
        e = {};
        
        e.keyCode=e.code=raw.keyCode;
        e.keyName=e.name=Tonyu.globals.$Keys.codesRev[e.keyCode];
        if (! e.name) {
          e.keyName=e.name=e.code+"";
        }
        e.sendUps=[];
        e.on=(function anonymous_227(name,f) {
          
          if (name==="keyUp"||name==="up") {
            e.sendUps.push(f);
            
          }
        });
        e.sendUp=(function anonymous_345() {
          var f;
          
          for ([f] of Tonyu.iterator2(e.sendUps,1)) {
            f();
          }
        });
        return e;
        
      },
      initialize :function _trc_KeyDownHandler_initialize() {
        var _this=this;
        
        __superClass.apply( _this, []);
        _this.handlers={};
        _this.pressState={};
        Tonyu.globals.$InputDevice.on("keyDownRaw",(function anonymous_532(raw) {
          var a;
          var e;
          var f;
          
          if (_this.pressState[raw.keyCode]) {
            return _this;
          }
          a = _this.pressState[raw.keyCode]=[];
          
          e = _this.createEvent(raw);
          
          a.push(e);
          if (_this.handlers[raw.keyCode]) {
            for ([f] of Tonyu.iterator2(_this.handlers[raw.keyCode],1)) {
              f(e);
              
            }
            
          }
          if (_this.handlers.all) {
            for ([f] of Tonyu.iterator2(_this.handlers.all,1)) {
              f(e);
              
            }
            
          }
        }));
        Tonyu.globals.$InputDevice.on("keyUpRaw",(function anonymous_968(e) {
          var a;
          var e;
          
          a = _this.pressState[e.keyCode]=_this.pressState[e.keyCode]||[];
          
          delete _this.pressState[e.keyCode];
          for ([e] of Tonyu.iterator2(a,1)) {
            e.sendUp();
            
          }
        }));
      },
      newListener :function _trc_KeyDownHandler_newListener(keyName,f) {
        var _this=this;
        var keyCode;
        var a;
        var i;
        
        keyCode = typeof  keyName==="number"?keyName:Tonyu.globals.$Keys.codes[keyName];
        
        
        if (! f) {
          f=keyName;
          a=_this.handlers.all=_this.handlers.all||[];
          
        } else {
          a=_this.handlers[keyCode]=_this.handlers[keyCode]||[];
          
        }
        a.push(f);
        return {dispose: (function anonymous_1449() {
          var i;
          
          i = a.indexOf(f);
          
          a.splice(i,1);
        })};
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"createEvent":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"newListener":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"handlers":{},"pressState":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Keys',
  shortName: 'Keys',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Keys_main() {
        var _this=this;
        
        _this.stats={};
        _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,esc: 27,bs: 8,del: 46,mouseleft: 1,mouseright: 2,mousewheel: 4};
        _this.preventDefaults={"37": true,"38": true,"39": true,"40": true,"32": true};
        for (_this.i = 65;
         _this.i<65+26 ; _this.i++) {
          {
            _this.codes[String.fromCharCode(_this.i).toLowerCase()]=_this.i;
          }
        }
        for (_this.i = 48;
         _this.i<58 ; _this.i++) {
          {
            _this.codes[String.fromCharCode(_this.i)]=_this.i;
          }
        }
        _this.codesRev={};
        for ([_this.k, _this.v] of Tonyu.iterator2(_this.codes,2)) {
          _this.codesRev[_this.v]=_this.k;
        }
        if (! $.data(document,"key_event")) {
          _this.bmap = [1,4,2];
          
          $.data(document,"key_event",true);
          $(document).keydown((function anonymous_710(e) {
            
            Tonyu.globals.$Keys.keydown(e);
          }));
          $(document).keyup((function anonymous_759(e) {
            
            Tonyu.globals.$Keys.keyup(e);
          }));
          $(document).mousedown((function anonymous_810(e) {
            
            _this.lastMouseDown=Tonyu.globals.$frameCount;
            Tonyu.globals.$Keys.keydown({keyCode: _this.bmap[e.button]||1});
          }));
          _this.up = (function anonymous_1059(e) {
            var a;
            
            a = (function anonymous_1081() {
              
              Tonyu.globals.$Keys.keyup({keyCode: _this.bmap[e.button]||1});
            });
            
            if (_this.lastMouseDown==Tonyu.globals.$frameCount&&! _this.reservedAction) {
              _this.reservedAction={at: Tonyu.globals.$frameCount+2,action: a};
              
            } else {
              a();
              
            }
          });
          
          $(document).mouseup(_this.up);
          $(document).on("mouseleave",_this.up);
          
        }
      },
      fiber$main :function* _trc_Keys_f_main(_thread) {
        var _this=this;
        
        _this.stats={};
        _this.codes={left: 37,up: 38,right: 39,down: 40,space: 32,enter: 13,shift: 16,ctrl: 17,alt: 18,esc: 27,bs: 8,del: 46,mouseleft: 1,mouseright: 2,mousewheel: 4};
        _this.preventDefaults={"37": true,"38": true,"39": true,"40": true,"32": true};
        for (_this.i = 65;
         _this.i<65+26 ; _this.i++) {
          {
            _this.codes[String.fromCharCode(_this.i).toLowerCase()]=_this.i;
          }
        }
        for (_this.i = 48;
         _this.i<58 ; _this.i++) {
          {
            _this.codes[String.fromCharCode(_this.i)]=_this.i;
          }
        }
        _this.codesRev={};
        for ([_this.k, _this.v] of Tonyu.iterator2(_this.codes,2)) {
          _this.codesRev[_this.v]=_this.k;
        }
        if (! $.data(document,"key_event")) {
          _this.bmap = [1,4,2];
          
          $.data(document,"key_event",true);
          $(document).keydown((function anonymous_710(e) {
            
            Tonyu.globals.$Keys.keydown(e);
          }));
          $(document).keyup((function anonymous_759(e) {
            
            Tonyu.globals.$Keys.keyup(e);
          }));
          $(document).mousedown((function anonymous_810(e) {
            
            _this.lastMouseDown=Tonyu.globals.$frameCount;
            Tonyu.globals.$Keys.keydown({keyCode: _this.bmap[e.button]||1});
          }));
          _this.up = (function anonymous_1059(e) {
            var a;
            
            a = (function anonymous_1081() {
              
              Tonyu.globals.$Keys.keyup({keyCode: _this.bmap[e.button]||1});
            });
            
            if (_this.lastMouseDown==Tonyu.globals.$frameCount&&! _this.reservedAction) {
              _this.reservedAction={at: Tonyu.globals.$frameCount+2,action: a};
              
            } else {
              a();
              
            }
          });
          
          $(document).mouseup(_this.up);
          $(document).on("mouseleave",_this.up);
          
        }
        
      },
      getkey :function _trc_Keys_getkey(code) {
        var _this=this;
        
        if (typeof  code=="string") {
          code=_this.codes[code.toLowerCase()];
          
        }
        if (! code) {
          return 0;
        }
        if (_this.stats[code]==- 1) {
          return 0;
        }
        if (! _this.stats[code]) {
          _this.stats[code]=0;
        }
        return _this.stats[code];
      },
      fiber$getkey :function* _trc_Keys_f_getkey(_thread,code) {
        var _this=this;
        
        if (typeof  code=="string") {
          code=_this.codes[code.toLowerCase()];
          
        }
        if (! code) {
          return 0;
        }
        if (_this.stats[code]==- 1) {
          return 0;
        }
        if (! _this.stats[code]) {
          _this.stats[code]=0;
        }
        return _this.stats[code];
        
      },
      update :function _trc_Keys_update() {
        var _this=this;
        var i;
        
        for ([i] of Tonyu.iterator2(_this.stats,1)) {
          if (_this.stats[i]>0) {
            _this.stats[i]++;
            
          }
          if (_this.stats[i]==- 1) {
            _this.stats[i]=1;
          }
          
        }
        if (_this.reservedAction&&_this.reservedAction.at==Tonyu.globals.$frameCount) {
          _this.reservedAction.action();
          _this.reservedAction=null;
          
        }
      },
      fiber$update :function* _trc_Keys_f_update(_thread) {
        var _this=this;
        var i;
        
        for ([i] of Tonyu.iterator2(_this.stats,1)) {
          if (_this.stats[i]>0) {
            _this.stats[i]++;
            
          }
          if (_this.stats[i]==- 1) {
            _this.stats[i]=1;
          }
          
        }
        if (_this.reservedAction&&_this.reservedAction.at==Tonyu.globals.$frameCount) {
          _this.reservedAction.action();
          _this.reservedAction=null;
          
        }
        
      },
      keydown :function _trc_Keys_keydown(e) {
        var _this=this;
        var s;
        
        if (_this.preventDefaults[e.keyCode+""]&&e.preventDefault) {
          e.preventDefault();
        }
        if (Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib.activate();
        }
        s = _this.stats[e.keyCode];
        
        if (! s) {
          _this.stats[e.keyCode]=1;
          
        }
        Tonyu.globals.$InputDevice.fireEvent("keyDownRaw",e);
        Tonyu.globals.$InputDevice.handleListeners();
      },
      fiber$keydown :function* _trc_Keys_f_keydown(_thread,e) {
        var _this=this;
        var s;
        
        if (_this.preventDefaults[e.keyCode+""]&&e.preventDefault) {
          e.preventDefault();
        }
        if (Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib.activate();
        }
        s = _this.stats[e.keyCode];
        
        if (! s) {
          _this.stats[e.keyCode]=1;
          
        }
        Tonyu.globals.$InputDevice.fireEvent("keyDownRaw",e);
        Tonyu.globals.$InputDevice.handleListeners();
        
      },
      keyup :function _trc_Keys_keyup(e) {
        var _this=this;
        
        if (_this.preventDefaults[e.keyCode+""]&&e.preventDefault) {
          e.preventDefault();
        }
        if (Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib.activate();
        }
        _this.stats[e.keyCode]=0;
        Tonyu.globals.$InputDevice.fireEvent("keyUpRaw",e);
        Tonyu.globals.$InputDevice.handleListeners();
      },
      fiber$keyup :function* _trc_Keys_f_keyup(_thread,e) {
        var _this=this;
        
        if (_this.preventDefaults[e.keyCode+""]&&e.preventDefault) {
          e.preventDefault();
        }
        if (Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib.activate();
        }
        _this.stats[e.keyCode]=0;
        Tonyu.globals.$InputDevice.fireEvent("keyUpRaw",e);
        Tonyu.globals.$InputDevice.handleListeners();
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"getkey":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"update":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"keydown":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"keyup":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"i":{"vtype":"Number"},"k":{},"v":{},"bmap":{},"up":{},"stats":{},"codes":{},"preventDefaults":{},"codesRev":{},"lastMouseDown":{},"reservedAction":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TouchFinger',
  shortName: 'TouchFinger',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.EventMod],
  methods: function (__superClass) {
    return {
      main :function _trc_TouchFinger_main() {
        var _this=this;
        
        "field strict";
        
        
        
      },
      fiber$main :function* _trc_TouchFinger_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
      },
      initialize :function _trc_TouchFinger_initialize(layerPath,index) {
        var _this=this;
        
        _this.reset();
        _this._layerPath=layerPath;
        Tonyu.classes.kernel.TouchFinger.seq=Tonyu.classes.kernel.TouchFinger.seq||0;
        _this.oid=Tonyu.classes.kernel.TouchFinger.seq++;
        _this.index=index;
      },
      reset :function _trc_TouchFinger_reset() {
        var _this=this;
        
        _this.identifier=- 1;
        _this.px=_this.py=0;
        _this.x=_this.y=_this.vx=_this.vy=_this.touched=0;
        _this.ended=false;
      },
      fiber$reset :function* _trc_TouchFinger_f_reset(_thread) {
        var _this=this;
        
        _this.identifier=- 1;
        _this.px=_this.py=0;
        _this.x=_this.y=_this.vx=_this.vy=_this.touched=0;
        _this.ended=false;
        
      },
      __getter__layer :function _trc_TouchFinger___getter__layer() {
        var _this=this;
        
        return _this.layerPath.target;
      },
      __setter__layer :function _trc_TouchFinger___setter__layer(toLayer) {
        var _this=this;
        
        let l = Tonyu.is(toLayer,Tonyu.classes.kernel.LayerPath)?toLayer:_this.layerPath.withNeighborTarget(toLayer);
        
        if (l) {
          _this.layerPath=l;
          
        } else {
          if (toLayer.defaultLayerPath) {
            _this.layerPath=toLayer.defaultLayerPath;
            
          } else {
            throw _this.newError("touchFingerSetLayerFailed",toLayer);
            
          }
        }
      },
      __getter__layerPath :function _trc_TouchFinger___getter__layerPath() {
        var _this=this;
        
        return _this._layerPath;
      },
      __setter__layerPath :function _trc_TouchFinger___setter__layerPath(toLayerPath) {
        var _this=this;
        var p;
        
        if (_this._layerPath===toLayerPath) {
          return _this;
        }
        p = _this._layerPath.convert(_this,toLayerPath);
        
        if (! p) {
          throw _this.newError("touchFingerSetLayerPathFailed",toLayerPath);
          
          
        }
        _this.x=p.x;
        _this.y=p.y;
        _this.px=_this.x;
        _this.py=_this.y;
        _this._layerPath=toLayerPath;
        _this.vx=_this.vy=0;
      },
      update :function _trc_TouchFinger_update() {
        var _this=this;
        
        if (_this.touched>0) {
          _this.touched++;
          
        } else {
          if (_this.touched==- 1) {
            _this.touched=1;
          } else {
            
            
          }
        }
        if (_this.touched>0) {
          if (typeof  _this.px=="number") {
            _this.vx=_this.x-_this.px||0;
            _this.vy=_this.y-_this.py||0;
            
          }
          _this.px=_this.x;
          _this.py=_this.y;
          
        }
      },
      fiber$update :function* _trc_TouchFinger_f_update(_thread) {
        var _this=this;
        
        if (_this.touched>0) {
          _this.touched++;
          
        } else {
          if (_this.touched==- 1) {
            _this.touched=1;
          } else {
            
            
          }
        }
        if (_this.touched>0) {
          if (typeof  _this.px=="number") {
            _this.vx=_this.x-_this.px||0;
            _this.vy=_this.y-_this.py||0;
            
          }
          _this.px=_this.x;
          _this.py=_this.y;
          
        }
        
      },
      show :function _trc_TouchFinger_show() {
        var _this=this;
        
        return "["+_this.oid+":"+_this.floor(_this.x*100)/100+","+_this.floor(_this.px*100)/100+"]";
      },
      fiber$show :function* _trc_TouchFinger_f_show(_thread) {
        var _this=this;
        
        return "["+_this.oid+":"+_this.floor(_this.x*100)/100+","+_this.floor(_this.px*100)/100+"]";
        
      },
      doStart :function _trc_TouchFinger_doStart(id,point) {
        var _this=this;
        
        _this.identifier=id;
        _this.px=_this.x=point.x;
        _this.py=_this.y=point.y;
        _this._layerPath=point.layerPath;
        _this.vx=_this.vy=0;
        _this.touched=1;
        _this.ended=false;
        if (_this.bound) {
          _this.bound.doStart(id,point);
          
        }
      },
      fiber$doStart :function* _trc_TouchFinger_f_doStart(_thread,id,point) {
        var _this=this;
        
        _this.identifier=id;
        _this.px=_this.x=point.x;
        _this.py=_this.y=point.y;
        _this._layerPath=point.layerPath;
        _this.vx=_this.vy=0;
        _this.touched=1;
        _this.ended=false;
        if (_this.bound) {
          _this.bound.doStart(id,point);
          
        }
        
      },
      doMove :function _trc_TouchFinger_doMove(point) {
        var _this=this;
        var p;
        var px;
        var py;
        var e;
        
        p = point.layerPath.convert(point,_this._layerPath);
        
        px = _this.x;
        py = _this.y;
        
        _this.x=p.x;
        _this.y=p.y;
        if (_this.bound) {
          _this.bound.doMove(p);
          
        }
        e = {px: px,py: py,x: _this.x,y: _this.y,vx: _this.x-px,vy: _this.y-py,finger: _this};
        
        _this.fireEvent("move",e);
      },
      fiber$doMove :function* _trc_TouchFinger_f_doMove(_thread,point) {
        var _this=this;
        var p;
        var px;
        var py;
        var e;
        
        p = point.layerPath.convert(point,_this._layerPath);
        
        px = _this.x;
        py = _this.y;
        
        _this.x=p.x;
        _this.y=p.y;
        if (_this.bound) {
          _this.bound.doMove(p);
          
        }
        e = {px: px,py: py,x: _this.x,y: _this.y,vx: _this.x-px,vy: _this.y-py,finger: _this};
        
        _this.fireEvent("move",e);
        
      },
      doEnd :function _trc_TouchFinger_doEnd() {
        var _this=this;
        
        _this.vx=_this.vy=_this.touched=0;
        _this.ended=true;
        if (_this.bound) {
          _this.bound.doEnd();
          delete _this.bound;
          
        }
        _this.fireEvent("end",{finger: _this,x: _this.x,y: _this.y});
      },
      fiber$doEnd :function* _trc_TouchFinger_f_doEnd(_thread) {
        var _this=this;
        
        _this.vx=_this.vy=_this.touched=0;
        _this.ended=true;
        if (_this.bound) {
          _this.bound.doEnd();
          delete _this.bound;
          
        }
        _this.fireEvent("end",{finger: _this,x: _this.x,y: _this.y});
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"reset":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__layer":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__layer":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__layerPath":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":"kernel.LayerPath"}},"__setter__layerPath":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"update":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"show":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"doStart":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"doMove":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"doEnd":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"identifier":{},"index":{},"oid":{},"bound":{},"px":{},"py":{},"x":{},"y":{},"vx":{},"vy":{},"touched":{},"ended":{},"_layerPath":{"vtype":"kernel.LayerPath"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TouchFingers',
  shortName: 'TouchFingers',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_TouchFingers_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_TouchFingers_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_TouchFingers_initialize(dev) {
        var _this=this;
        var i;
        
        _this.inputDevice=dev;
        _this.fingerSet={};
        _this.fingerArray=[];
        _this.fingerArray.findById=(function anonymous_202(id) {
          
          return _this.fingerSet[id];
        });
        _this.fingerArray.findWithin=(function anonymous_277(o,d) {
          var j;
          var t;
          
          for ([j, t] of Tonyu.iterator2(_this.fingerSet,2)) {
            if (o.within(t,d)) {
              return t;
              
            }
            
          }
        });
        _this.fingerArray.findTouch=(function anonymous_454(f) {
          var j;
          var t;
          
          for ([j, t] of Tonyu.iterator2(_this.fingerSet,2)) {
            if (f(t)) {
              return t;
              
            }
            
          }
        });
        for (i = 0;
         i<5 ; i++) {
          _this.fingerArray.push(new Tonyu.classes.kernel.TouchFinger(_this.inputDevice.defaultLayerPath,i));
        }
      },
      handleStart :function _trc_TouchFingers_handleStart(e) {
        var _this=this;
        var p;
        var ts;
        var dst;
        var i;
        var src;
        var j;
        var mp;
        
        Tonyu.resetLoopCheck();
        if (Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib.activate();
        }
        p = _this.inputDevice.rootCanvas.offset();
        
        e.preventDefault();
        ts = e.originalEvent.changedTouches;
        
        
        for (i = 0;
         i<ts.length ; i++) {
          {
            src = ts[i];
            
            dst=new Tonyu.classes.kernel.TouchFinger(_this.inputDevice.defaultLayerPath);
            _this.fingerSet[src.identifier]=dst;
            for (j = 0;
             j<_this.fingerArray.length ; j++) {
              {
                if (! _this.fingerArray[j].touched) {
                  dst.bound=_this.fingerArray[j];
                  break;
                  
                  
                }
              }
            }
            mp = {x: src.pageX-p.left,y: src.pageY-p.top};
            
            mp=Tonyu.globals.$rootLayerPath.convert(mp,_this.inputDevice.defaultLayerPath);
            dst.doStart(src.identifier,mp);
          }
        }
        Tonyu.globals.$mouseX=_this.fingerArray[0].x;
        Tonyu.globals.$mouseY=_this.fingerArray[0].y;
        _this.inputDevice.handleListeners("touchstart",{byMouse: e.byMouse,finger: dst,index: dst.bound&&dst.bound.index});
      },
      fiber$handleStart :function* _trc_TouchFingers_f_handleStart(_thread,e) {
        var _this=this;
        var p;
        var ts;
        var dst;
        var i;
        var src;
        var j;
        var mp;
        
        Tonyu.resetLoopCheck();
        if (Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib.activate();
        }
        p = _this.inputDevice.rootCanvas.offset();
        
        e.preventDefault();
        ts = e.originalEvent.changedTouches;
        
        
        for (i = 0;
         i<ts.length ; i++) {
          {
            src = ts[i];
            
            dst=new Tonyu.classes.kernel.TouchFinger(_this.inputDevice.defaultLayerPath);
            _this.fingerSet[src.identifier]=dst;
            for (j = 0;
             j<_this.fingerArray.length ; j++) {
              {
                if (! _this.fingerArray[j].touched) {
                  dst.bound=_this.fingerArray[j];
                  break;
                  
                  
                }
              }
            }
            mp = {x: src.pageX-p.left,y: src.pageY-p.top};
            
            mp=Tonyu.globals.$rootLayerPath.convert(mp,_this.inputDevice.defaultLayerPath);
            dst.doStart(src.identifier,mp);
          }
        }
        Tonyu.globals.$mouseX=_this.fingerArray[0].x;
        Tonyu.globals.$mouseY=_this.fingerArray[0].y;
        _this.inputDevice.handleListeners("touchstart",{byMouse: e.byMouse,finger: dst,index: dst.bound&&dst.bound.index});
        
      },
      handleMove :function _trc_TouchFingers_handleMove(e) {
        var _this=this;
        var p;
        var ts;
        var dst;
        var i;
        var src;
        
        Tonyu.resetLoopCheck();
        if (Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib.activate();
        }
        p = _this.inputDevice.rootCanvas.offset();
        
        e.preventDefault();
        ts = e.originalEvent.changedTouches;
        
        
        for (i = 0;
         i<ts.length ; i++) {
          {
            src = ts[i];
            
            dst = _this.fingerSet[src.identifier];
            
            if (dst) {
              _this.mp={x: src.pageX-p.left,y: src.pageY-p.top,layerPath: Tonyu.globals.$rootLayerPath};
              dst.doMove(_this.mp);
              _this.inputDevice.handleListeners("touchmove",{byMouse: e.byMouse,finger: dst,index: dst.bound&&dst.bound.index});
              
            }
          }
        }
        Tonyu.globals.$mouseX=_this.fingerArray[0].x;
        Tonyu.globals.$mouseY=_this.fingerArray[0].y;
      },
      fiber$handleMove :function* _trc_TouchFingers_f_handleMove(_thread,e) {
        var _this=this;
        var p;
        var ts;
        var dst;
        var i;
        var src;
        
        Tonyu.resetLoopCheck();
        if (Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib.activate();
        }
        p = _this.inputDevice.rootCanvas.offset();
        
        e.preventDefault();
        ts = e.originalEvent.changedTouches;
        
        
        for (i = 0;
         i<ts.length ; i++) {
          {
            src = ts[i];
            
            dst = _this.fingerSet[src.identifier];
            
            if (dst) {
              _this.mp={x: src.pageX-p.left,y: src.pageY-p.top,layerPath: Tonyu.globals.$rootLayerPath};
              dst.doMove(_this.mp);
              _this.inputDevice.handleListeners("touchmove",{byMouse: e.byMouse,finger: dst,index: dst.bound&&dst.bound.index});
              
            }
          }
        }
        Tonyu.globals.$mouseX=_this.fingerArray[0].x;
        Tonyu.globals.$mouseY=_this.fingerArray[0].y;
        
      },
      handleEnd :function _trc_TouchFingers_handleEnd(e) {
        var _this=this;
        var ts;
        var i;
        var src;
        var dst;
        
        Tonyu.resetLoopCheck();
        if (Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib.activate();
        }
        ts = e.originalEvent.changedTouches;
        
        for (i = 0;
         i<ts.length ; i++) {
          {
            src = ts[i];
            
            dst = _this.fingerSet[src.identifier];
            
            if (dst) {
              delete _this.fingerSet[src.identifier];
              dst.doEnd();
              _this.inputDevice.handleListeners("touchend",{byMouse: e.byMouse,finger: dst,index: dst.bound&&dst.bound.index});
              
            }
          }
        }
      },
      fiber$handleEnd :function* _trc_TouchFingers_f_handleEnd(_thread,e) {
        var _this=this;
        var ts;
        var i;
        var src;
        var dst;
        
        Tonyu.resetLoopCheck();
        if (Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib.activate();
        }
        ts = e.originalEvent.changedTouches;
        
        for (i = 0;
         i<ts.length ; i++) {
          {
            src = ts[i];
            
            dst = _this.fingerSet[src.identifier];
            
            if (dst) {
              delete _this.fingerSet[src.identifier];
              dst.doEnd();
              _this.inputDevice.handleListeners("touchend",{byMouse: e.byMouse,finger: dst,index: dst.bound&&dst.bound.index});
              
            }
          }
        }
        
      },
      unsetEmu :function _trc_TouchFingers_unsetEmu(ID_MOUSE) {
        var _this=this;
        var t;
        var i;
        
        for ([t] of Tonyu.iterator2(_this.fingerArray,1)) {
          if (t.identifier==ID_MOUSE) {
            t.reset();
            
          }
          
        }
        for ([i, t] of Tonyu.iterator2(_this.fingerSet,2)) {
          if (t.identifier==ID_MOUSE) {
            t.reset();
            
          }
          
        }
      },
      fiber$unsetEmu :function* _trc_TouchFingers_f_unsetEmu(_thread,ID_MOUSE) {
        var _this=this;
        var t;
        var i;
        
        for ([t] of Tonyu.iterator2(_this.fingerArray,1)) {
          if (t.identifier==ID_MOUSE) {
            t.reset();
            
          }
          
        }
        for ([i, t] of Tonyu.iterator2(_this.fingerSet,2)) {
          if (t.identifier==ID_MOUSE) {
            t.reset();
            
          }
          
        }
        
      },
      updateFingers :function _trc_TouchFingers_updateFingers() {
        var _this=this;
        var t;
        var i;
        
        for ([t] of Tonyu.iterator2(_this.fingerArray,1)) {
          t.update();
          
        }
        for ([i, t] of Tonyu.iterator2(_this.fingerSet,2)) {
          t.update();
          
        }
      },
      fiber$updateFingers :function* _trc_TouchFingers_f_updateFingers(_thread) {
        var _this=this;
        var t;
        var i;
        
        for ([t] of Tonyu.iterator2(_this.fingerArray,1)) {
          t.update();
          
        }
        for ([i, t] of Tonyu.iterator2(_this.fingerSet,2)) {
          t.update();
          
        }
        
      },
      reset :function _trc_TouchFingers_reset() {
        var _this=this;
        var t;
        
        for ([t] of Tonyu.iterator2(_this.fingerArray,1)) {
          t.reset();
          
        }
      },
      fiber$reset :function* _trc_TouchFingers_f_reset(_thread) {
        var _this=this;
        var t;
        
        for ([t] of Tonyu.iterator2(_this.fingerArray,1)) {
          t.reset();
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"handleStart":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"handleMove":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"handleEnd":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"unsetEmu":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"updateFingers":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"reset":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"inputDevice":{},"fingerSet":{},"fingerArray":{},"mp":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.LifeCycleMod',
  shortName: 'LifeCycleMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.EventHandlerCaller,Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.ThreadGroupMod],
  methods: function (__superClass) {
    return {
      main :function _trc_LifeCycleMod_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_LifeCycleMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      hide :function _trc_LifeCycleMod_hide() {
        var _this=this;
        
        if (Tonyu.is(_this.layer,Tonyu.classes.kernel.SpriteGroup)) {
          _this.layer.remove(_this);
          
        } else {
          if (Tonyu.is(_this.__addedToSprites,Tonyu.classes.kernel.SpriteGroup)) {
            _this.__addedToSprites.remove(_this);
            
          } else {
            
            
          }
        }
      },
      show :function _trc_LifeCycleMod_show(x,y,p) {
        var _this=this;
        
        _this.layer.add(_this);
        if (x!=null) {
          _this.x=x;
        }
        if (y!=null) {
          _this.y=y;
        }
        if (p!=null) {
          _this.p=p;
        }
      },
      die :function _trc_LifeCycleMod_die() {
        var _this=this;
        
        _this.killThreadGroup();
        _this.hide();
        if (! _this._isDead) {
          _this.fireEvent("die");
          _this._isDead=true;
          if (_this._poolArray) {
            _this._poolArray.push(_this);
            _this.objectPoolAge=(_this.objectPoolAge||0)+1;
            
          }
          
        }
      },
      __setter__lifeKeeper :function _trc_LifeCycleMod___setter__lifeKeeper(v) {
        var _this=this;
        
        _this._lifeKeeper=v;
        if (v&&typeof  v.on==="function") {
          v.on("die",Tonyu.bindFunc(_this,_this.die));
          
        }
      },
      __getter__lifeKeeper :function _trc_LifeCycleMod___getter__lifeKeeper() {
        var _this=this;
        
        return _this._lifeKeeper;
      },
      isDead :function _trc_LifeCycleMod_isDead() {
        var _this=this;
        
        return _this._isDead;
      },
      __setter__useObjectPool :function _trc_LifeCycleMod___setter__useObjectPool(value) {
        var _this=this;
        
        if (value) {
          _this._poolArray=Tonyu.globals.$ObjectPool.poolList(_this.getClassInfo().fullName);
          
        }
      },
      appear :function _trc_LifeCycleMod_appear(o,param) {
        var _this=this;
        var p;
        var k;
        
        if (typeof  o=="function") {
          if (param) {
            param.layer=param.layer||_this.layer;
            
          }
          p = Tonyu.globals.$ObjectPool.withdraw(o.meta.fullName);
          
          if (p) {
            for ([k] of Tonyu.iterator2(Object.keys(p),1)) {
              if (k!="objectPoolAge") {
                delete p[k];
              }
              
            }
            o.call(p,param);
            return p;
            
          } else {
            return new o(param);
            
          }
          
        } else {
          return o;
          
        }
      },
      fiber$appear :function* _trc_LifeCycleMod_f_appear(_thread,o,param) {
        var _this=this;
        var p;
        var k;
        
        if (typeof  o=="function") {
          if (param) {
            param.layer=param.layer||_this.layer;
            
          }
          p = Tonyu.globals.$ObjectPool.withdraw(o.meta.fullName);
          
          if (p) {
            for ([k] of Tonyu.iterator2(Object.keys(p),1)) {
              if (k!="objectPoolAge") {
                delete p[k];
              }
              
            }
            o.call(p,param);
            return p;
            
          } else {
            return new o(param);
            
          }
          
        } else {
          return o;
          
        }
        
      },
      getSpriteGroup :function _trc_LifeCycleMod_getSpriteGroup() {
        var _this=this;
        
        if (Tonyu.is(_this.__addedToSprites,Tonyu.classes.kernel.SpriteGroup)) {
          return _this.__addedToSprites;
          
        }
        if (Tonyu.is(_this.layer,Tonyu.classes.kernel.SpriteGroup)) {
          return _this.layer;
          
        }
        return null;
      },
      fiber$getSpriteGroup :function* _trc_LifeCycleMod_f_getSpriteGroup(_thread) {
        var _this=this;
        
        if (Tonyu.is(_this.__addedToSprites,Tonyu.classes.kernel.SpriteGroup)) {
          return _this.__addedToSprites;
          
        }
        if (Tonyu.is(_this.layer,Tonyu.classes.kernel.SpriteGroup)) {
          return _this.layer;
          
        }
        return null;
        
      },
      addToLayer :function _trc_LifeCycleMod_addToLayer() {
        var _this=this;
        
        if (_this.layer&&typeof  _this.layer.addSubsprite==="function") {
          _this.layer.addSubsprite(_this);
          
        } else {
          if (Tonyu.is(_this.layer,Tonyu.classes.kernel.SpriteGroup)) {
            _this.layer.add(_this);
            
          } else {
            if (Tonyu.is(_this.layer,Tonyu.classes.kernel.ScreenLayer)) {
              _this.layer.group.add(_this);
              
            } else {
              Tonyu.globals.$Sprites.add(_this);
              
            }
          }
        }
        _this.onAppear();
      },
      fiber$addToLayer :function* _trc_LifeCycleMod_f_addToLayer(_thread) {
        var _this=this;
        
        if (_this.layer&&typeof  _this.layer.addSubsprite==="function") {
          _this.layer.addSubsprite(_this);
          
        } else {
          if (Tonyu.is(_this.layer,Tonyu.classes.kernel.SpriteGroup)) {
            _this.layer.add(_this);
            
          } else {
            if (Tonyu.is(_this.layer,Tonyu.classes.kernel.ScreenLayer)) {
              _this.layer.group.add(_this);
              
            } else {
              Tonyu.globals.$Sprites.add(_this);
              
            }
          }
        }
        (yield* _this.fiber$onAppear(_thread));
        
      },
      changeLayer :function _trc_LifeCycleMod_changeLayer(l) {
        var _this=this;
        var curLayer;
        
        if (! l||typeof  l.addSubsprite!=="function") {
          return _this;
        }
        curLayer = _this.getSpriteGroup();
        
        if (curLayer) {
          curLayer.remove(_this);
          
        }
        l.addSubsprite(_this);
        _this.layer=l;
      },
      fiber$changeLayer :function* _trc_LifeCycleMod_f_changeLayer(_thread,l) {
        var _this=this;
        var curLayer;
        
        if (! l||typeof  l.addSubsprite!=="function") {
          return _this;
        }
        curLayer=yield* _this.fiber$getSpriteGroup(_thread);
        
        if (curLayer) {
          curLayer.remove(_this);
          
        }
        l.addSubsprite(_this);
        _this.layer=l;
        
      },
      onAppear :function _trc_LifeCycleMod_onAppear() {
        var _this=this;
        
      },
      fiber$onAppear :function* _trc_LifeCycleMod_f_onAppear(_thread) {
        var _this=this;
        
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"hide":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"show":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"die":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__lifeKeeper":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__lifeKeeper":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isDead":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__useObjectPool":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"appear":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getSpriteGroup":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"addToLayer":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"changeLayer":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"onAppear":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"layer":{},"_isDead":{},"_poolArray":{},"objectPoolAge":{},"_lifeKeeper":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Matrix',
  shortName: 'Matrix',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.FileMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Matrix_main() {
        var _this=this;
        
        
      },
      fiber$main :function* _trc_Matrix_f_main(_thread) {
        var _this=this;
        
        
        
      },
      initialize :function _trc_Matrix_initialize(d) {
        var _this=this;
        
        _this.data={}||d;
      },
      fromArray :function _trc_Matrix_fromArray(array) {
        var _this=this;
        var i;
        var row;
        var j;
        var val;
        
        for ([i, row] of Tonyu.iterator2(array,2)) {
          for ([j, val] of Tonyu.iterator2(row,2)) {
            _this.set(j,i,val);
            
          }
          
        }
      },
      fiber$fromArray :function* _trc_Matrix_f_fromArray(_thread,array) {
        var _this=this;
        var i;
        var row;
        var j;
        var val;
        
        for ([i, row] of Tonyu.iterator2(array,2)) {
          for ([j, val] of Tonyu.iterator2(row,2)) {
            (yield* _this.fiber$set(_thread, j, i, val));
            
          }
          
        }
        
      },
      toArray :function _trc_Matrix_toArray() {
        var _this=this;
        var res;
        var i;
        var row;
        var j;
        
        res = [];
        
        for (i = 0;
         i<=_this.ymax ; i++) {
          {
            row = [];
            
            res.push(row);
            for (j = 0;
             j<=_this.xmax ; j++) {
              {
                row.push(_this.get(j,i));
              }
            }
          }
        }
        return res;
      },
      fiber$toArray :function* _trc_Matrix_f_toArray(_thread) {
        var _this=this;
        var res;
        var i;
        var row;
        var j;
        
        res = [];
        
        for (i = 0;
         i<=_this.ymax ; i++) {
          {
            row = [];
            
            res.push(row);
            for (j = 0;
             j<=_this.xmax ; j++) {
              {
                row.push(_this.get(j,i));
              }
            }
          }
        }
        return res;
        
      },
      load :function _trc_Matrix_load(csvFile) {
        var _this=this;
        var f;
        var x;
        var y;
        var SEP;
        var lines;
        var l;
        
        f = _this.file(csvFile);
        
        x = 0;
        y = 0;
        
        SEP = ",";
        
        lines = f.lines();
        
        for ([l] of Tonyu.iterator2(lines,1)) {
          _this.row=l.split(SEP);
          x=0;
          for ([_this.cell] of Tonyu.iterator2(_this.row,1)) {
            _this.set(x,y,_this.cell);
            x++;
            
          }
          y++;
          
        }
      },
      fiber$load :function* _trc_Matrix_f_load(_thread,csvFile) {
        var _this=this;
        var f;
        var x;
        var y;
        var SEP;
        var lines;
        var l;
        
        f=yield* _this.fiber$file(_thread, csvFile);
        
        x = 0;
        y = 0;
        
        SEP = ",";
        
        lines = f.lines();
        
        for ([l] of Tonyu.iterator2(lines,1)) {
          _this.row=l.split(SEP);
          x=0;
          for ([_this.cell] of Tonyu.iterator2(_this.row,1)) {
            (yield* _this.fiber$set(_thread, x, y, _this.cell));
            x++;
            
          }
          y++;
          
        }
        
      },
      cross :function _trc_Matrix_cross(col,row) {
        var _this=this;
        var colr;
        var rowr;
        
        colr = _this.find(col);
        
        rowr = _this.find(row);
        
        return _this.get(colr.x,rowr.y);
      },
      fiber$cross :function* _trc_Matrix_f_cross(_thread,col,row) {
        var _this=this;
        var colr;
        var rowr;
        
        colr=yield* _this.fiber$find(_thread, col);
        
        rowr=yield* _this.fiber$find(_thread, row);
        
        return yield* _this.fiber$get(_thread, colr.x, rowr.y);
        
        
      },
      search :function _trc_Matrix_search(cell,options) {
        var _this=this;
        var k;
        var v;
        
        for ([k, v] of Tonyu.iterator2(_this.data,2)) {
          if (v===cell) {
            return _this.unkey(k);
            
          }
          
        }
      },
      fiber$search :function* _trc_Matrix_f_search(_thread,cell,options) {
        var _this=this;
        var k;
        var v;
        
        for ([k, v] of Tonyu.iterator2(_this.data,2)) {
          if (v===cell) {
            return yield* _this.fiber$unkey(_thread, k);
            
            
          }
          
        }
        
      },
      find :function _trc_Matrix_find() {
        var _this=this;
        var r;
        
        r = Tonyu.bindFunc(_this,_this.search).apply(_this,arguments);
        
        if (r==null) {
          throw new Error(arguments[0]+" not found.");
          
          
        }
        return r;
      },
      fiber$find :function* _trc_Matrix_f_find(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var r;
        
        r = Tonyu.bindFunc(_this,_this.search).apply(_this,_arguments);
        
        if (r==null) {
          throw new Error(_arguments[0]+" not found.");
          
          
        }
        return r;
        
      },
      clone :function _trc_Matrix_clone() {
        var _this=this;
        var nm;
        var x;
        var y;
        var c;
        
        nm = new Tonyu.classes.kernel.Matrix;
        
        for ([x, y, c] of Tonyu.iterator2(_this,3)) {
          nm.set(x,y,c);
          
        }
        return nm;
      },
      fiber$clone :function* _trc_Matrix_f_clone(_thread) {
        var _this=this;
        var nm;
        var x;
        var y;
        var c;
        
        nm = new Tonyu.classes.kernel.Matrix;
        
        for ([x, y, c] of Tonyu.iterator2(_this,3)) {
          nm.set(x,y,c);
          
        }
        return nm;
        
      },
      crop :function _trc_Matrix_crop() {
        var _this=this;
        var a;
        var o;
        var r;
        var y;
        var x;
        
        a = new Tonyu.classes.kernel.ArgParser(arguments);
        
        o = a.parseOptions("left,top,right,bottom,width,height,keepXY");
        
        r = new Tonyu.classes.kernel.Matrix;
        
        if (o.width) {
          o.right=o.left+o.width-1;
        }
        if (o.height) {
          o.bottom=o.top+o.height-1;
        }
        if (o.right==null) {
          o.right=_this.xmax;
        }
        if (o.bottom==null) {
          o.bottom=_this.ymax;
        }
        for (y = o.top;
         y<=o.bottom ; y++) {
          {
            for (x = o.left;
             x<=o.right ; x++) {
              {
                if (o.keepXY) {
                  r.set(x,y,_this.get(x,y));
                  
                } else {
                  r.set(x-o.left,y-o.top,_this.get(x,y));
                  
                }
              }
            }
          }
        }
        return r;
      },
      fiber$crop :function* _trc_Matrix_f_crop(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var a;
        var o;
        var r;
        var y;
        var x;
        
        a = new Tonyu.classes.kernel.ArgParser(_arguments);
        
        o = a.parseOptions("left,top,right,bottom,width,height,keepXY");
        
        r = new Tonyu.classes.kernel.Matrix;
        
        if (o.width) {
          o.right=o.left+o.width-1;
        }
        if (o.height) {
          o.bottom=o.top+o.height-1;
        }
        if (o.right==null) {
          o.right=_this.xmax;
        }
        if (o.bottom==null) {
          o.bottom=_this.ymax;
        }
        for (y = o.top;
         y<=o.bottom ; y++) {
          {
            for (x = o.left;
             x<=o.right ; x++) {
              {
                if (o.keepXY) {
                  r.set(x,y,_this.get(x,y));
                  
                } else {
                  r.set(x-o.left,y-o.top,_this.get(x,y));
                  
                }
              }
            }
          }
        }
        return r;
        
      },
      rev :function _trc_Matrix_rev(line) {
        var _this=this;
        var res;
        var e;
        
        res = [];
        
        for ([e] of Tonyu.iterator2(line,1)) {
          res.unshift(e);
          
        }
        return res;
      },
      fiber$rev :function* _trc_Matrix_f_rev(_thread,line) {
        var _this=this;
        var res;
        var e;
        
        res = [];
        
        for ([e] of Tonyu.iterator2(line,1)) {
          res.unshift(e);
          
        }
        return res;
        
      },
      keysIterator :function _trc_Matrix_keysIterator() {
        var _this=this;
        
        return {tonyuIterator: Tonyu.bindFunc(_this,_this.tonyuIteratorKeys)};
      },
      fiber$keysIterator :function* _trc_Matrix_f_keysIterator(_thread) {
        var _this=this;
        
        return {tonyuIterator: Tonyu.bindFunc(_this,_this.tonyuIteratorKeys)};
        
      },
      rectIterator :function _trc_Matrix_rectIterator() {
        var _this=this;
        
        return {tonyuIterator: Tonyu.bindFunc(_this,_this.tonyuIteratorRect)};
      },
      fiber$rectIterator :function* _trc_Matrix_f_rectIterator(_thread) {
        var _this=this;
        
        return {tonyuIterator: Tonyu.bindFunc(_this,_this.tonyuIteratorRect)};
        
      },
      tonyuIteratorKeys :function _trc_Matrix_tonyuIteratorKeys(arity) {
        var _this=this;
        var res;
        var k;
        var v;
        
        res = {i: 0,keys: []};
        
        for ([k, v] of Tonyu.iterator2(_this.data,2)) {
          res.keys.push(k);
          
        }
        switch (arity) {
        case 3:
          res.next=(function anonymous_2500() {
            var key;
            var xy;
            
            if (res.i>=res.keys.length) {
              return false;
            }
            key = res.keys[res.i];
            
            res.i++;
            xy = _this.unkey(key);
            
            res[0]=xy.x;
            res[1]=xy.y;
            res[2]=_this.data[key];
            return true;
          });
          break;
          
        default:
          throw new Error("Matrix: in の前には3つの変数が必要です");
          
        }
        return res;
      },
      fiber$tonyuIteratorKeys :function* _trc_Matrix_f_tonyuIteratorKeys(_thread,arity) {
        var _this=this;
        var res;
        var k;
        var v;
        
        res = {i: 0,keys: []};
        
        for ([k, v] of Tonyu.iterator2(_this.data,2)) {
          res.keys.push(k);
          
        }
        switch (arity) {
        case 3:
          res.next=(function anonymous_2500() {
            var key;
            var xy;
            
            if (res.i>=res.keys.length) {
              return false;
            }
            key = res.keys[res.i];
            
            res.i++;
            xy = _this.unkey(key);
            
            res[0]=xy.x;
            res[1]=xy.y;
            res[2]=_this.data[key];
            return true;
          });
          break;
          
        default:
          throw new Error("Matrix: in の前には3つの変数が必要です");
          
        }
        return res;
        
      },
      tonyuIterator :function _trc_Matrix_tonyuIterator(arity) {
        var _this=this;
        
        if (_this.iterateMode==="keys") {
          return _this.tonyuIteratorKeys(arity);
        }
        return _this.tonyuIteratorRect(arity);
      },
      fiber$tonyuIterator :function* _trc_Matrix_f_tonyuIterator(_thread,arity) {
        var _this=this;
        
        if (_this.iterateMode==="keys") {
          return yield* _this.fiber$tonyuIteratorKeys(_thread, arity);
          
        }
        return yield* _this.fiber$tonyuIteratorRect(_thread, arity);
        
        
      },
      tonyuIteratorRect :function _trc_Matrix_tonyuIteratorRect(arity) {
        var _this=this;
        var res;
        
        res = {x: _this.xmin,y: _this.ymin,cnt: 0};
        
        if (_this.xmin==null||_this.ymin==null||_this.xmax==null||_this.ymax==null) {
          res.next=(function anonymous_3159() {
            
            return false;
          });
          return res;
          
        }
        switch (arity) {
        case 3:
          res.next=(function anonymous_3261() {
            
            if (res.x>_this.xmax) {
              res.x=_this.xmin;
              res.y++;
              
            }
            if (res.y<=_this.ymax) {
              res[0]=res.x;
              res[1]=res.y;
              res[2]=_this.get(res.x,res.y);
              res.x++;
              return true;
              
            }
            return false;
          });
          break;
          
        default:
          throw new Error("Matrix: in の前には3つの変数が必要です");
          
        }
        return res;
      },
      fiber$tonyuIteratorRect :function* _trc_Matrix_f_tonyuIteratorRect(_thread,arity) {
        var _this=this;
        var res;
        
        res = {x: _this.xmin,y: _this.ymin,cnt: 0};
        
        if (_this.xmin==null||_this.ymin==null||_this.xmax==null||_this.ymax==null) {
          res.next=(function anonymous_3159() {
            
            return false;
          });
          return res;
          
        }
        switch (arity) {
        case 3:
          res.next=(function anonymous_3261() {
            
            if (res.x>_this.xmax) {
              res.x=_this.xmin;
              res.y++;
              
            }
            if (res.y<=_this.ymax) {
              res[0]=res.x;
              res[1]=res.y;
              res[2]=_this.get(res.x,res.y);
              res.x++;
              return true;
              
            }
            return false;
          });
          break;
          
        default:
          throw new Error("Matrix: in の前には3つの変数が必要です");
          
        }
        return res;
        
      },
      unkey :function _trc_Matrix_unkey(key) {
        var _this=this;
        var r;
        
        r = key.split(",");
        
        return {x: r[0]-0,y: r[1]-0};
      },
      fiber$unkey :function* _trc_Matrix_f_unkey(_thread,key) {
        var _this=this;
        var r;
        
        r = key.split(",");
        
        return {x: r[0]-0,y: r[1]-0};
        
      },
      key :function _trc_Matrix_key(x,y,updateRange) {
        var _this=this;
        
        x=_this.floor(x)||0;
        y=_this.floor(y)||0;
        if (updateRange) {
          if (_this.xmin==null||x<_this.xmin) {
            _this.xmin=x;
          }
          if (_this.xmax==null||x>_this.xmax) {
            _this.xmax=x;
          }
          if (_this.ymin==null||y<_this.ymin) {
            _this.ymin=y;
          }
          if (_this.ymax==null||y>_this.ymax) {
            _this.ymax=y;
          }
          
        }
        return x+","+y;
      },
      fiber$key :function* _trc_Matrix_f_key(_thread,x,y,updateRange) {
        var _this=this;
        
        x=_this.floor(x)||0;
        y=_this.floor(y)||0;
        if (updateRange) {
          if (_this.xmin==null||x<_this.xmin) {
            _this.xmin=x;
          }
          if (_this.xmax==null||x>_this.xmax) {
            _this.xmax=x;
          }
          if (_this.ymin==null||y<_this.ymin) {
            _this.ymin=y;
          }
          if (_this.ymax==null||y>_this.ymax) {
            _this.ymax=y;
          }
          
        }
        return x+","+y;
        
      },
      __getter__rows :function _trc_Matrix___getter__rows() {
        var _this=this;
        
        return _this.xmax-_this.xmin+1;
      },
      __getter__cols :function _trc_Matrix___getter__cols() {
        var _this=this;
        
        return _this.ymax-_this.ymin+1;
      },
      get :function _trc_Matrix_get(x,y) {
        var _this=this;
        var res;
        var e;
        
        res = _this.data[_this.key(x,y)];
        
        if (res===undefined) {
          e = {set: (function anonymous_4387(v) {
            
            e.value=v;
            _this.set(x,y,v);
          }),x: x,y: y};
          
          _this.sendEvent("newCell",e);
          return e.value;
          
        }
        return res;
      },
      fiber$get :function* _trc_Matrix_f_get(_thread,x,y) {
        var _this=this;
        var res;
        var e;
        
        res = _this.data[_this.key(x,y)];
        
        if (res===undefined) {
          e = {set: (function anonymous_4387(v) {
            
            e.value=v;
            _this.set(x,y,v);
          }),x: x,y: y};
          
          _this.sendEvent("newCell",e);
          return e.value;
          
        }
        return res;
        
      },
      exists :function _trc_Matrix_exists(x,y) {
        var _this=this;
        
        return _this.data[_this.key(x,y)]!==undefined;
      },
      fiber$exists :function* _trc_Matrix_f_exists(_thread,x,y) {
        var _this=this;
        
        return _this.data[_this.key(x,y)]!==undefined;
        
      },
      set :function _trc_Matrix_set(x,y,v) {
        var _this=this;
        var k;
        
        
        if (v===undefined) {
          k=_this.key(x,y);
          if (_this.data[k]===undefined) {
            return v;
          }
          _this.fireEvent("change",{x: x,y: y,value: v});
          delete _this.data[k];
          
        } else {
          k=_this.key(x,y,true);
          if (_this.data[k]===v) {
            return v;
          }
          _this.fireEvent("change",{x: x,y: y,value: v});
          return _this.data[k]=v;
          
        }
      },
      fiber$set :function* _trc_Matrix_f_set(_thread,x,y,v) {
        var _this=this;
        var k;
        
        
        if (v===undefined) {
          k=(yield* _this.fiber$key(_thread, x, y));
          if (_this.data[k]===undefined) {
            return v;
          }
          _this.fireEvent("change",{x: x,y: y,value: v});
          delete _this.data[k];
          
        } else {
          k=(yield* _this.fiber$key(_thread, x, y, true));
          if (_this.data[k]===v) {
            return v;
          }
          _this.fireEvent("change",{x: x,y: y,value: v});
          return _this.data[k]=v;
          
        }
        
      },
      neighbors :function _trc_Matrix_neighbors(x,y,options) {
        var _this=this;
        var dirs;
        var res;
        var dir;
        var i;
        var j;
        var r;
        
        options=options||{dirs: _this.neighborDirs};
        options.dirs=options.dirs||_this.neighborDirs||4;
        dirs = [[0,- 1],[1,- 1],[1,0],[1,1],[0,1],[- 1,1],[- 1,0],[- 1,- 1]];
        
        res = [];
        
        for ([dir] of Tonyu.iterator2(dirs,1)) {
          i = dir[1];
          j = dir[0];
          
          if (i==0&&j==0) {
            continue;
            
          }
          if (options.dirs==4) {
            if (i*j!=0) {
              continue;
              
            }
            
          }
          
          if (_this.exists(x+j,y+i)) {
            r=_this.get(x+j,y+i);
            res.push({x: x+j,y: y+i,ox: j,oy: i,value: r});
            
          } else {
            if (options.includeEmpty) {
              res.push({x: x+j,y: y+i,ox: j,oy: i});
              
            }
          }
          
        }
        return res;
      },
      fiber$neighbors :function* _trc_Matrix_f_neighbors(_thread,x,y,options) {
        var _this=this;
        var dirs;
        var res;
        var dir;
        var i;
        var j;
        var r;
        
        options=options||{dirs: _this.neighborDirs};
        options.dirs=options.dirs||_this.neighborDirs||4;
        dirs = [[0,- 1],[1,- 1],[1,0],[1,1],[0,1],[- 1,1],[- 1,0],[- 1,- 1]];
        
        res = [];
        
        for ([dir] of Tonyu.iterator2(dirs,1)) {
          i = dir[1];
          j = dir[0];
          
          if (i==0&&j==0) {
            continue;
            
          }
          if (options.dirs==4) {
            if (i*j!=0) {
              continue;
              
            }
            
          }
          
          if (_this.exists(x+j,y+i)) {
            r=(yield* _this.fiber$get(_thread, x+j, y+i));
            res.push({x: x+j,y: y+i,ox: j,oy: i,value: r});
            
          } else {
            if (options.includeEmpty) {
              res.push({x: x+j,y: y+i,ox: j,oy: i});
              
            }
          }
          
        }
        return res;
        
      },
      fill :function _trc_Matrix_fill(left,top,cols,rows,data) {
        var _this=this;
        var i;
        var j;
        var d;
        
        data=data||{};
        for (i = top;
         i<top+rows ; i++) {
          {
            for (j = left;
             j<left+cols ; j++) {
              {
                d = data;
                
                if (typeof  data==="object") {
                  d=Object.create(data);
                  
                } else {
                  if (typeof  data==="function") {
                    d=data(j,i);
                    
                  }
                }
                _this.set(j,i,d);
              }
            }
          }
        }
      },
      fiber$fill :function* _trc_Matrix_f_fill(_thread,left,top,cols,rows,data) {
        var _this=this;
        var i;
        var j;
        var d;
        
        data=data||{};
        for (i = top;
         i<top+rows ; i++) {
          {
            for (j = left;
             j<left+cols ; j++) {
              {
                d = data;
                
                if (typeof  data==="object") {
                  d=Object.create(data);
                  
                } else {
                  if (typeof  data==="function") {
                    d=data(j,i);
                    
                  }
                }
                (yield* _this.fiber$set(_thread, j, i, d));
              }
            }
          }
        }
        
      },
      pack :function _trc_Matrix_pack() {
        var _this=this;
        var t;
        var k;
        var v;
        var xy;
        var x;
        var y;
        
        
        t=_this.xmin;
        _this.xmin=_this.xmax;
        _this.xmax=t;
        t=_this.ymin;
        _this.ymin=_this.ymax;
        _this.ymax=t;
        for ([k, v] of Tonyu.iterator2(_this.data,2)) {
          xy = _this.unkey(k);
          
          x = xy.x;
          y = xy.y;
          
          if (x<_this.xmin) {
            _this.xmin=x;
            
          }
          if (y<_this.ymin) {
            _this.ymin=y;
            
          }
          if (x>_this.xmax) {
            _this.xmax=x;
            
          }
          if (y>_this.ymax) {
            _this.ymax=y;
            
          }
          
        }
      },
      fiber$pack :function* _trc_Matrix_f_pack(_thread) {
        var _this=this;
        var t;
        var k;
        var v;
        var xy;
        var x;
        var y;
        
        
        t=_this.xmin;
        _this.xmin=_this.xmax;
        _this.xmax=t;
        t=_this.ymin;
        _this.ymin=_this.ymax;
        _this.ymax=t;
        for ([k, v] of Tonyu.iterator2(_this.data,2)) {
          xy=yield* _this.fiber$unkey(_thread, k);
          
          x = xy.x;
          y = xy.y;
          
          if (x<_this.xmin) {
            _this.xmin=x;
            
          }
          if (y<_this.ymin) {
            _this.ymin=y;
            
          }
          if (x>_this.xmax) {
            _this.xmax=x;
            
          }
          if (y>_this.ymax) {
            _this.ymax=y;
            
          }
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"fromArray":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"toArray":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"load":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"cross":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"search":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"find":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clone":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"crop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"rev":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"keysIterator":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"rectIterator":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"tonyuIteratorKeys":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"tonyuIterator":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"tonyuIteratorRect":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"unkey":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"key":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"__getter__rows":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__cols":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"get":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"exists":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"set":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"neighbors":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"fill":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}},"pack":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"name":{"vtype":"String"},"data":{},"ymax":{},"xmax":{},"row":{},"cell":{},"iterateMode":{},"xmin":{},"ymin":{},"neighborDirs":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.QueryMod',
  shortName: 'QueryMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.SchedulerMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.EventHandlerCaller,Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.LifeCycleMod,Tonyu.classes.kernel.SpriteMod],
  methods: function (__superClass) {
    return {
      main :function _trc_QueryMod_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_QueryMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      hitTo :function _trc_QueryMod_hitTo(t) {
        var _this=this;
        
        return _this.crashTo(t);
      },
      all :function _trc_QueryMod_all(c) {
        var _this=this;
        var res;
        
        res = new Tonyu.classes.kernel.TQuery(_this);
        
        if (arguments.length>0&&typeof  c!="function") {
          return res;
          
        }
        _this.getSpriteGroup().sprites.forEach((function anonymous_516(s) {
          
          if (s===_this) {
            return _this;
          }
          if (! c||s instanceof c) {
            res.push(s);
            
          }
        }));
        return res;
      },
      allCrash :function _trc_QueryMod_allCrash(t) {
        var _this=this;
        var res;
        var sp;
        var t1;
        
        res = new Tonyu.classes.kernel.TQuery(_this);
        
        sp = _this;
        
        t1 = _this.getCrashShape();
        
        if (! t1) {
          return res;
        }
        _this.getSpriteGroup().sprites.forEach((function anonymous_826(s) {
          var t2;
          
          
          if (s!==_this&&s instanceof t&&(t2=s.getCrashShape())&&t1.intersects(t2)) {
            res.push(s);
            
          }
        }));
        return res;
      },
      getCrashShape :function _trc_QueryMod_getCrashShape() {
        var _this=this;
        
        throw new Error("getCrashShape::abstract");
        
      },
      fiber$getCrashShape :function* _trc_QueryMod_f_getCrashShape(_thread) {
        var _this=this;
        
        throw new Error("getCrashShape::abstract");
        
        
      },
      crashTo :function _trc_QueryMod_crashTo(t) {
        var _this=this;
        
        if (! t) {
          return false;
        }
        if (typeof  t=="function") {
          return _this.allCrash(t)[0];
          
        }
        return _this.crashTo1(t);
      },
      crashTo1 :function _trc_QueryMod_crashTo1(t) {
        var _this=this;
        var t1;
        var t2;
        
        if (! t||t._isDead) {
          return false;
        }
        t1 = _this.getCrashShape();
        
        t2 = t.getCrashShape();
        
        return t1&&t1.intersects(t2);
      },
      crashToChecker :function _trc_QueryMod_crashToChecker(d,f) {
        var _this=this;
        var obj;
        
        while (true) {
          if (typeof  d=="function") {
            for ([obj] of Tonyu.iterator2(_this.allCrash(d),1)) {
              _this.callEventHandler(f,[obj]);
              
            }
            
          } else {
            if (_this.crashTo(d)) {
              _this.callEventHandler(f,[d]);
              
            }
          }
          _this.update();
          
        }
      },
      fiber$crashToChecker :function* _trc_QueryMod_f_crashToChecker(_thread,d,f) {
        var _this=this;
        var obj;
        
        while (true) {
          if (typeof  d=="function") {
            for ([obj] of Tonyu.iterator2(_this.allCrash(d),1)) {
              (yield* _this.fiber$callEventHandler(_thread, f, [obj]));
              
            }
            
          } else {
            if (_this.crashTo(d)) {
              (yield* _this.fiber$callEventHandler(_thread, f, [d]));
              
            }
          }
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      allWithin :function _trc_QueryMod_allWithin(t,distance) {
        var _this=this;
        var res;
        var sp;
        
        res = new Tonyu.classes.kernel.TQuery(_this);
        
        sp = _this;
        
        if (typeof  t!=="function") {
          throw new Error("allWithinの第一引数はクラスにしてください");
          
        }
        _this.getSpriteGroup().sprites.forEach((function anonymous_1965(s) {
          
          if (s!==_this&&s instanceof t&&_this.dist(s)<distance) {
            res.push(s);
            
          }
        }));
        return res;
      },
      within :function _trc_QueryMod_within(t,distance) {
        var _this=this;
        
        if (! t) {
          return false;
        }
        if (typeof  t=="function") {
          return _this.allWithin(t,distance)[0];
          
        }
        return _this.within1(t,distance);
      },
      within1 :function _trc_QueryMod_within1(t,distance) {
        var _this=this;
        
        if (! t||t._isDead) {
          return false;
        }
        if (_this.dist(t)<distance) {
          return t;
          
        }
        return false;
      },
      withinChecker :function _trc_QueryMod_withinChecker(d,r,f) {
        var _this=this;
        var obj;
        
        while (true) {
          if (typeof  d=="function") {
            for ([obj] of Tonyu.iterator2(_this.allWithin(d,r),1)) {
              f(obj);
              
            }
            
          } else {
            if (_this.within(d,r)) {
              f(d);
              
            }
          }
          _this.update();
          
        }
      },
      fiber$withinChecker :function* _trc_QueryMod_f_withinChecker(_thread,d,r,f) {
        var _this=this;
        var obj;
        
        while (true) {
          if (typeof  d=="function") {
            for ([obj] of Tonyu.iterator2(_this.allWithin(d,r),1)) {
              f(obj);
              
            }
            
          } else {
            if (_this.within(d,r)) {
              f(d);
              
            }
          }
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      watchHit :function _trc_QueryMod_watchHit(typeA,typeB,onHit) {
        var _this=this;
        
        _this.getSpriteGroup().watchHit(typeA,typeB,(function anonymous_2942(a,b) {
          
          onHit.apply(_this,[a,b]);
        }));
      },
      screenOutChecker :function _trc_QueryMod_screenOutChecker(d,f) {
        var _this=this;
        
        while (true) {
          while (true) {
            if (_this.screenOut()>d) {
              f();
              break;
              
              
            }
            _this.update();
            
          }
          while (true) {
            if (_this.screenOut()<=d) {
              break;
              
              
            }
            _this.update();
            
          }
          _this.update();
          
        }
      },
      fiber$screenOutChecker :function* _trc_QueryMod_f_screenOutChecker(_thread,d,f) {
        var _this=this;
        
        while (true) {
          while (true) {
            if (_this.screenOut()>d) {
              f();
              break;
              
              
            }
            (yield* _this.fiber$update(_thread));
            
          }
          while (true) {
            if (_this.screenOut()<=d) {
              break;
              
              
            }
            (yield* _this.fiber$update(_thread));
            
          }
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      screenOut :function _trc_QueryMod_screenOut() {
        var _this=this;
        
        throw new Error("screenOut::abstract");
        
      },
      fiber$screenOut :function* _trc_QueryMod_f_screenOut(_thread) {
        var _this=this;
        
        throw new Error("screenOut::abstract");
        
        
      },
      findEventHandlerClass :function _trc_QueryMod_findEventHandlerClass(type) {
        var _this=this;
        var eventTypes;
        
        eventTypes = {"screenOut": Tonyu.classes.kernel.ScreenOutHandler,"crashTo": Tonyu.classes.kernel.CrashToHandler,"within": Tonyu.classes.kernel.WithinHandler};
        
        if (eventTypes[type]) {
          return eventTypes[type];
        }
        return __superClass.prototype.findEventHandlerClass.apply( _this, [type]);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"hitTo":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"all":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"allCrash":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getCrashShape":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"crashTo":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"crashTo1":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"crashToChecker":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"allWithin":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"within":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"within1":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"withinChecker":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"watchHit":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"screenOutChecker":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"screenOut":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"findEventHandlerClass":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"crashScale":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.QueryMod2D',
  shortName: 'QueryMod2D',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.QueryMod,Tonyu.classes.kernel.SpriteMod2D],
  methods: function (__superClass) {
    return {
      main :function _trc_QueryMod2D_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_QueryMod2D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      getCrashShape :function _trc_QueryMod2D_getCrashShape() {
        var _this=this;
        
        if (typeof  _this.radius=="number"&&_this.radius) {
          return new Tonyu.classes.kernel.CircleShape({x: _this.x,y: _this.y,radius: _this.radius*_this.crashScale});
          
        }
        return new Tonyu.classes.kernel.RectShape(_this.getCrashRect());
      },
      fiber$getCrashShape :function* _trc_QueryMod2D_f_getCrashShape(_thread) {
        var _this=this;
        
        if (typeof  _this.radius=="number"&&_this.radius) {
          return new Tonyu.classes.kernel.CircleShape({x: _this.x,y: _this.y,radius: _this.radius*_this.crashScale});
          
        }
        return new Tonyu.classes.kernel.RectShape(_this.getCrashRect());
        
      },
      dist :function _trc_QueryMod2D_dist(dx,dy,dz) {
        var _this=this;
        var t;
        
        if (typeof  dx=="object") {
          t = dx;
          
          dx=t.x-_this.x;
          dy=t.y-_this.y;
          dz=0;
          
        }
        return __superClass.prototype.dist.apply( _this, [dx,dy,dz]);
      },
      getCrashRect :function _trc_QueryMod2D_getCrashRect() {
        var _this=this;
        var scx;
        var scy;
        var r;
        var v;
        var actWidth;
        var actHeight;
        
        if (_this._align&&! _this._align.isOriginPivot) {
          scx = _this.scaleX;
          
          scy = (_this.scaleY==null?_this.scaleX:_this.scaleY);
          
          r = _this._align.getDrawRect({width: (_this.width||_this.radius*2),height: (_this.height||_this.radius*2)});
          
          v = new Tonyu.classes.kernel.Vec3(r.x*scx,r.y*scy);
          
          v.rotateX(_this.rotation).addX(_this.x,_this.y);
          return {x: v.x,y: v.y,width: _this.abs(r.width*scx*_this.crashScale),height: _this.abs(r.height*scy*_this.crashScale)};
          
        }
        actWidth = (_this.width||_this.radius*2)*_this.scaleX*_this.crashScale;
        
        if (typeof  _this.scaleY==="undefined") {
          actHeight=(_this.height||_this.radius*2)*_this.scaleX*_this.crashScale;
          
        } else {
          actHeight=(_this.height||_this.radius*2)*_this.scaleY*_this.crashScale;
          
        }
        return typeof  _this.x=="number"&&typeof  _this.y=="number"&&typeof  actWidth=="number"&&typeof  actHeight=="number"&&{x: _this.x,y: _this.y,width: Math.abs(actWidth),height: Math.abs(actHeight)};
      },
      getTouchShape :function _trc_QueryMod2D_getTouchShape() {
        var _this=this;
        
        return new Tonyu.classes.kernel.RectShape(_this.getTouchRect());
      },
      fiber$getTouchShape :function* _trc_QueryMod2D_f_getTouchShape(_thread) {
        var _this=this;
        
        return new Tonyu.classes.kernel.RectShape(_this.getTouchRect());
        
      },
      getTouchRect :function _trc_QueryMod2D_getTouchRect(scale) {
        var _this=this;
        
        return _this.getCrashRect();
      },
      fiber$getTouchRect :function* _trc_QueryMod2D_f_getTouchRect(_thread,scale) {
        var _this=this;
        
        return _this.getCrashRect();
        
      },
      screenOut :function _trc_QueryMod2D_screenOut(...args) {
        var _this=this;
        
        let a = 0;
        let sc = Tonyu.globals.$Screen;
        
        for (let [e] of Tonyu.iterator2(args,1)) {
          if (typeof  e==="number") {
            a=e;
            
          } else {
            if (Tonyu.is(e,Tonyu.classes.kernel.Screen)) {
              sc=e;
              
            }
          }
          
        }
        let cp = sc.convert(_this,sc);
        
        return _this.abs(_this.clamped(cp.x,- a,sc.width+a))+_this.abs(_this.clamped(cp.y,- a,sc.height+a));
      },
      fiber$screenOut :function* _trc_QueryMod2D_f_screenOut(_thread,...args) {
        var _this=this;
        
        let a = 0;
        let sc = Tonyu.globals.$Screen;
        
        for (let [e] of Tonyu.iterator2(args,1)) {
          if (typeof  e==="number") {
            a=e;
            
          } else {
            if (Tonyu.is(e,Tonyu.classes.kernel.Screen)) {
              sc=e;
              
            }
          }
          
        }
        let cp = sc.convert(_this,sc);
        
        return _this.abs(_this.clamped(cp.x,- a,sc.width+a))+_this.abs(_this.clamped(cp.y,- a,sc.height+a));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"getCrashShape":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"dist":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"getCrashRect":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getTouchShape":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getTouchRect":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"screenOut":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.QueryMod3D',
  shortName: 'QueryMod3D',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.QueryMod,Tonyu.classes.kernel.SpriteMod3D],
  methods: function (__superClass) {
    return {
      main :function _trc_QueryMod3D_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_QueryMod3D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      dist :function _trc_QueryMod3D_dist(dx,dy,dz) {
        var _this=this;
        var t;
        
        if (typeof  dx=="object") {
          t = dx;
          
          dx=t.x-_this.x;
          dy=t.y-_this.y;
          dz=t.z-_this.z;
          
        }
        return __superClass.prototype.dist.apply( _this, [dx,dy,dz]);
      },
      getCrashShape :function _trc_QueryMod3D_getCrashShape() {
        var _this=this;
        var actWidth;
        var actHeight;
        
        actWidth = (_this.width||_this.radius*2)*_this.scaleX*_this.crashScale;
        
        if (typeof  _this.scaleY==="undefined") {
          actHeight=(_this.height||_this.radius*2)*_this.scaleX*_this.crashScale;
          
        } else {
          actHeight=(_this.height||_this.radius*2)*_this.scaleY*_this.crashScale;
          
        }
        return typeof  _this.x=="number"&&typeof  _this.y=="number"&&typeof  actWidth=="number"&&typeof  actHeight=="number"&&new Tonyu.classes.kernel.CubeShape({x: _this.x,y: _this.y,z: _this.z,width: Math.abs(actWidth),height: Math.abs(actHeight),depth: (Math.abs(actWidth)+Math.abs(actHeight))/2});
      },
      fiber$getCrashShape :function* _trc_QueryMod3D_f_getCrashShape(_thread) {
        var _this=this;
        var actWidth;
        var actHeight;
        
        actWidth = (_this.width||_this.radius*2)*_this.scaleX*_this.crashScale;
        
        if (typeof  _this.scaleY==="undefined") {
          actHeight=(_this.height||_this.radius*2)*_this.scaleX*_this.crashScale;
          
        } else {
          actHeight=(_this.height||_this.radius*2)*_this.scaleY*_this.crashScale;
          
        }
        return typeof  _this.x=="number"&&typeof  _this.y=="number"&&typeof  actWidth=="number"&&typeof  actHeight=="number"&&new Tonyu.classes.kernel.CubeShape({x: _this.x,y: _this.y,z: _this.z,width: Math.abs(actWidth),height: Math.abs(actHeight),depth: (Math.abs(actWidth)+Math.abs(actHeight))/2});
        
      },
      screenOut :function _trc_QueryMod3D_screenOut(a) {
        var _this=this;
        var cp;
        
        if (! a) {
          a=0;
        }
        return false;
        cp = Tonyu.globals.$Screen.convert(_this,Tonyu.globals.$Screen);
        
        return _this.abs(_this.clamped(cp.x,- a,Tonyu.globals.$screenWidth+a))+_this.abs(_this.clamped(cp.y,- a,Tonyu.globals.$screenHeight+a));
      },
      fiber$screenOut :function* _trc_QueryMod3D_f_screenOut(_thread,a) {
        var _this=this;
        var cp;
        
        if (! a) {
          a=0;
        }
        return false;
        cp = Tonyu.globals.$Screen.convert(_this,Tonyu.globals.$Screen);
        
        return _this.abs(_this.clamped(cp.x,- a,Tonyu.globals.$screenWidth+a))+_this.abs(_this.clamped(cp.y,- a,Tonyu.globals.$screenHeight+a));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"dist":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"getCrashShape":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"screenOut":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.Random',
  shortName: 'Random',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Random_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_Random_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_Random_initialize(seed) {
        var _this=this;
        
        _this.setSeed(seed);
      },
      setSeed :function _trc_Random_setSeed(seed) {
        var _this=this;
        
        _this.x=123456789;
        _this.y=362436069;
        _this.z=521288629;
        _this.MAX=2147483648;
        _this.MIN=- _this.MAX;
        _this.w=seed||new Date().getTime();
      },
      next :function _trc_Random_next() {
        var _this=this;
        var t;
        
        t = _this.x^(_this.x<<11);
        
        _this.x=_this.y;
        _this.y=_this.z;
        _this.z=_this.w;
        return _this.w=(_this.w^(_this.w>>>19))^(t^(t>>>8));
      },
      nextInt :function _trc_Random_nextInt(min,max) {
        var _this=this;
        var res;
        
        res = _this.floor(min+_this.next01()*(max-min));
        
        return res;
      },
      next01 :function _trc_Random_next01() {
        var _this=this;
        
        return (_this.next()-_this.MIN)/(_this.MAX-_this.MIN);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setSeed":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"next":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"nextInt":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"next01":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"x":{},"y":{},"z":{},"MAX":{},"MIN":{},"w":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.CrashToHandler',
  shortName: 'CrashToHandler',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.EventHandler,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_CrashToHandler_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_CrashToHandler_f_main(_thread) {
        var _this=this;
        
        
      },
      addListener :function _trc_CrashToHandler_addListener(d,f) {
        var _this=this;
        var retThread;
        
        retThread = _this.target.parallel("crashToChecker",d,_this.toListener(f));
        
        return {remove: (function anonymous_145() {
          
          retThread.kill();
        })};
      },
      initialize :function _trc_CrashToHandler_initialize(param) {
        var _this=this;
        
        __superClass.apply( _this, [param]);
        _this.id=(Tonyu.globals.$idseq=(Tonyu.globals.$idseq||0)+1);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"addListener":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"id":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ComputedVec3',
  shortName: 'ComputedVec3',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Vec3,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_ComputedVec3_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_ComputedVec3_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_ComputedVec3_initialize(func) {
        var _this=this;
        
        _this.computer=func;
      },
      requestCompute :function _trc_ComputedVec3_requestCompute() {
        var _this=this;
        
        _this.computed=null;
      },
      fiber$requestCompute :function* _trc_ComputedVec3_f_requestCompute(_thread) {
        var _this=this;
        
        _this.computed=null;
        
      },
      compute :function _trc_ComputedVec3_compute() {
        var _this=this;
        var c;
        
        if (_this.computed) {
          return _this.computed;
        }
        c = _this.computer(_this);
        
        return _this.computed||c;
      },
      fiber$compute :function* _trc_ComputedVec3_f_compute(_thread) {
        var _this=this;
        var c;
        
        if (_this.computed) {
          return _this.computed;
        }
        c = _this.computer(_this);
        
        return _this.computed||c;
        
      },
      keep :function _trc_ComputedVec3_keep(c) {
        var _this=this;
        
        _this.computed=c;
        return c;
      },
      fiber$keep :function* _trc_ComputedVec3_f_keep(_thread,c) {
        var _this=this;
        
        _this.computed=c;
        return c;
        
      },
      __getter__x :function _trc_ComputedVec3___getter__x() {
        var _this=this;
        
        return _this.compute().x;
      },
      __getter__y :function _trc_ComputedVec3___getter__y() {
        var _this=this;
        
        return _this.compute().y;
      },
      __getter__z :function _trc_ComputedVec3___getter__z() {
        var _this=this;
        
        return _this.compute().z;
      },
      __setter__x :function _trc_ComputedVec3___setter__x(v) {
        var _this=this;
        
        throw new Error("ComputedVec3: read only");
        
      },
      __setter__y :function _trc_ComputedVec3___setter__y(v) {
        var _this=this;
        
        throw new Error("ComputedVec3: read only");
        
      },
      __setter__z :function _trc_ComputedVec3___setter__z(v) {
        var _this=this;
        
        throw new Error("ComputedVec3: read only");
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"requestCompute":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"compute":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"keep":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__x":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__y":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__z":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__x":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__y":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__z":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"computer":{},"computed":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ActorSprite',
  shortName: 'ActorSprite',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.SpriteMod2D],
  methods: function (__superClass) {
    return {
      main :function _trc_ActorSprite_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_ActorSprite_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_ActorSprite_initialize(param) {
        var _this=this;
        
        __superClass.apply( _this, [param]);
        _this.initSpriteMod();
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.Layer2D',
  shortName: 'Layer2D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.ScreenLayer,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Layer2D_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_Layer2D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      draw :function _trc_Layer2D_draw(c) {
        var _this=this;
        var rt;
        var sc;
        var wpOnSX;
        var wpOnSY;
        
        c.save();
        rt = _this.rotation;
        sc = _this.scale;
        
        wpOnSX = (_this.cos(rt)*_this.wpx+_this.cos(rt+90)*_this.wpy)*sc;
        
        wpOnSY = (_this.sin(rt)*_this.wpx+_this.sin(rt+90)*_this.wpy)*sc;
        
        c.translate(- wpOnSX+_this.spx,- wpOnSY+_this.spy);
        c.rotate(_this.rad(rt));
        c.scale(sc,sc);
        _this.group.draw(c,_this);
        c.restore();
      },
      fiber$draw :function* _trc_Layer2D_f_draw(_thread,c) {
        var _this=this;
        var rt;
        var sc;
        var wpOnSX;
        var wpOnSY;
        
        c.save();
        rt = _this.rotation;
        sc = _this.scale;
        
        wpOnSX = (_this.cos(rt)*_this.wpx+_this.cos(rt+90)*_this.wpy)*sc;
        
        wpOnSY = (_this.sin(rt)*_this.wpx+_this.sin(rt+90)*_this.wpy)*sc;
        
        c.translate(- wpOnSX+_this.spx,- wpOnSY+_this.spy);
        c.rotate(_this.rad(rt));
        c.scale(sc,sc);
        _this.group.draw(c,_this);
        c.restore();
        
      },
      world2screen :function _trc_Layer2D_world2screen(obj) {
        var _this=this;
        var dx;
        var dy;
        var rt;
        var x;
        var y;
        
        dx = obj.x-_this.wpx;
        
        dy = obj.y-_this.wpy;
        
        rt = _this.rotation;
        
        x = _this.spx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)*_this.scale;
        
        y = _this.spy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)*_this.scale;
        
        return {x: x,y: y,rotation: obj.rotation,scale: obj.scale,layer: _this.screen};
      },
      fiber$world2screen :function* _trc_Layer2D_f_world2screen(_thread,obj) {
        var _this=this;
        var dx;
        var dy;
        var rt;
        var x;
        var y;
        
        dx = obj.x-_this.wpx;
        
        dy = obj.y-_this.wpy;
        
        rt = _this.rotation;
        
        x = _this.spx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)*_this.scale;
        
        y = _this.spy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)*_this.scale;
        
        return {x: x,y: y,rotation: obj.rotation,scale: obj.scale,layer: _this.screen};
        
      },
      screen2world :function _trc_Layer2D_screen2world(obj) {
        var _this=this;
        var rt;
        var dx;
        var dy;
        var x;
        var y;
        
        rt = - _this.rotation;
        
        dx = obj.x-_this.spx;
        
        dy = obj.y-_this.spy;
        
        x = _this.wpx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)/_this.scale;
        
        y = _this.wpy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)/_this.scale;
        
        return {x: x,y: y,rotation: rt,scale: 1/_this.scale,layer: _this.group};
      },
      fiber$screen2world :function* _trc_Layer2D_f_screen2world(_thread,obj) {
        var _this=this;
        var rt;
        var dx;
        var dy;
        var x;
        var y;
        
        rt = - _this.rotation;
        
        dx = obj.x-_this.spx;
        
        dy = obj.y-_this.spy;
        
        x = _this.wpx+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)/_this.scale;
        
        y = _this.wpy+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)/_this.scale;
        
        return {x: x,y: y,rotation: rt,scale: 1/_this.scale,layer: _this.group};
        
      },
      convert :function _trc_Layer2D_convert(obj,fromLayer,toLayer) {
        var _this=this;
        
        if (toLayer==null) {
          toLayer=fromLayer;
          fromLayer=obj.layer;
          
        }
        if (Tonyu.is(toLayer,Tonyu.classes.kernel.Panel)) {
          return toLayer.convert(obj,fromLayer,toLayer);
          
        }
        _this.print("Layer2D::conv not support",fromLayer,toLayer);
        throw new Error("Layer2D::conv not support");
        
      },
      fiber$convert :function* _trc_Layer2D_f_convert(_thread,obj,fromLayer,toLayer) {
        var _this=this;
        
        if (toLayer==null) {
          toLayer=fromLayer;
          fromLayer=obj.layer;
          
        }
        if (Tonyu.is(toLayer,Tonyu.classes.kernel.Panel)) {
          return toLayer.convert(obj,fromLayer,toLayer);
          
        }
        _this.print("Layer2D::conv not support",fromLayer,toLayer);
        throw new Error("Layer2D::conv not support");
        
        
      },
      __getter__defaultLayerPath :function _trc_Layer2D___getter__defaultLayerPath() {
        var _this=this;
        
        return _this.screen.defaultLayerPath?_this.screen.defaultLayerPath.add(_this):null;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"world2screen":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"screen2world":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"convert":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"__getter__defaultLayerPath":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"spx":{},"spy":{},"wpx":{},"wpy":{},"rotation":{},"scale":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Layer3D',
  shortName: 'Layer3D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.ScreenLayer,
  includes: [Tonyu.classes.kernel.MathMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Layer3D_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_Layer3D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initialize :function _trc_Layer3D_initialize(p) {
        var _this=this;
        
        __superClass.apply( _this, [p]);
        _this.spx=_this.spx||Tonyu.globals.$screenWidth/2;
        _this.spy=_this.spy||Tonyu.globals.$screenHeight/2;
      },
      draw :function _trc_Layer3D_draw(c2) {
        var _this=this;
        var c3;
        var s2ds;
        var s2d;
        
        _this.spx=Tonyu.globals.$screenWidth/2;
        _this.spy=Tonyu.globals.$screenHeight/2;
        c3 = new Tonyu.classes.kernel.Context3D({camera: _this.camera});
        
        _this.group.draw3D(c3);
        s2ds = c3.sprites2D.sort((function anonymous_341(a,b) {
          
          return b.zOrder-a.zOrder;
        }));
        
        c2.save();
        c2.translate(_this.spx,_this.spy);
        for ([s2d] of Tonyu.iterator2(c3.sprites2D,1)) {
          s2d.draw(c2);
          
        }
        c2.restore();
      },
      fiber$draw :function* _trc_Layer3D_f_draw(_thread,c2) {
        var _this=this;
        var c3;
        var s2ds;
        var s2d;
        
        _this.spx=Tonyu.globals.$screenWidth/2;
        _this.spy=Tonyu.globals.$screenHeight/2;
        c3 = new Tonyu.classes.kernel.Context3D({camera: _this.camera});
        
        _this.group.draw3D(c3);
        s2ds = c3.sprites2D.sort((function anonymous_341(a,b) {
          
          return b.zOrder-a.zOrder;
        }));
        
        c2.save();
        c2.translate(_this.spx,_this.spy);
        for ([s2d] of Tonyu.iterator2(c3.sprites2D,1)) {
          s2d.draw(c2);
          
        }
        c2.restore();
        
      },
      world2screen :function _trc_Layer3D_world2screen(obj) {
        var _this=this;
        var r;
        
        _this.spx=Tonyu.globals.$screenWidth/2;
        _this.spy=Tonyu.globals.$screenHeight/2;
        r = _this.camera.to2D(_this.camera.transform.inverse.childToSibling(obj));
        
        r.x+=_this.spx;
        r.y+=_this.spy;
        return r;
      },
      fiber$world2screen :function* _trc_Layer3D_f_world2screen(_thread,obj) {
        var _this=this;
        var r;
        
        _this.spx=Tonyu.globals.$screenWidth/2;
        _this.spy=Tonyu.globals.$screenHeight/2;
        r = _this.camera.to2D(_this.camera.transform.inverse.childToSibling(obj));
        
        r.x+=_this.spx;
        r.y+=_this.spy;
        return r;
        
      },
      screen2world :function _trc_Layer3D_screen2world(obj) {
        var _this=this;
        
        throw new Error("cannot call screen2world for Layer3D");
        
      },
      fiber$screen2world :function* _trc_Layer3D_f_screen2world(_thread,obj) {
        var _this=this;
        
        throw new Error("cannot call screen2world for Layer3D");
        
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"draw":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"world2screen":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"screen2world":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"spx":{},"spy":{},"camera":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.PanelMod',
  shortName: 'PanelMod',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TObject,
  includes: [Tonyu.classes.kernel.FileMod,Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.SpriteMod2D,Tonyu.classes.kernel.EventMod],
  methods: function (__superClass) {
    return {
      main :function _trc_PanelMod_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_PanelMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initPanelMod :function _trc_PanelMod_initPanelMod() {
        var _this=this;
        
        throw "Check overrides in spritesmod /oneframeSpritemod";
        
        if (_this.canvas) {
          _this.width=_this.canvas.width;
          _this.height=_this.canvas.height;
          
        } else {
          _this.setPanel(_this.width||Tonyu.globals.$screenWidth||465,_this.height||Tonyu.globals.$screenHeight||465);
          
        }
        if (_this._fillStyle&&_this.canvas) {
          _this.canvas.getContext("2d").fillStyle=_this._fillStyle+"";
        }
        _this.x=_this.x||_this.width/2;
        _this.y=_this.y||_this.height/2;
        if (_this.align==null) {
          _this.align="center";
        }
        if (_this.alpha==null) {
          _this.alpha=255;
        }
        if (_this._drawn==null) {
          _this._drawn=false;
        }
      },
      fiber$initPanelMod :function* _trc_PanelMod_f_initPanelMod(_thread) {
        var _this=this;
        
        throw "Check overrides in spritesmod /oneframeSpritemod";
        
        if (_this.canvas) {
          _this.width=_this.canvas.width;
          _this.height=_this.canvas.height;
          
        } else {
          (yield* _this.fiber$setPanel(_thread, _this.width||Tonyu.globals.$screenWidth||465, _this.height||Tonyu.globals.$screenHeight||465));
          
        }
        if (_this._fillStyle&&_this.canvas) {
          _this.canvas.getContext("2d").fillStyle=_this._fillStyle+"";
        }
        _this.x=_this.x||_this.width/2;
        _this.y=_this.y||_this.height/2;
        if (_this.align==null) {
          _this.align="center";
        }
        if (_this.alpha==null) {
          _this.alpha=255;
        }
        if (_this._drawn==null) {
          _this._drawn=false;
        }
        
      },
      setPanel :function _trc_PanelMod_setPanel(width,height) {
        var _this=this;
        var buf;
        
        _this.width=_this.trunc(width);
        _this.height=_this.trunc(height);
        buf = $("<canvas>").attr({width: width,height: height});
        
        _this.canvas=buf[0];
        _this.imageSmoothingEnabled=! Tonyu.globals.$imageSmoothingDisabled;
        _this._drawn=false;
        _this.fireEvent("resize",{width: width,height: height,force: true});
      },
      fiber$setPanel :function* _trc_PanelMod_f_setPanel(_thread,width,height) {
        var _this=this;
        var buf;
        
        _this.width=_this.trunc(width);
        _this.height=_this.trunc(height);
        buf = $("<canvas>").attr({width: width,height: height});
        
        _this.canvas=buf[0];
        _this.imageSmoothingEnabled=! Tonyu.globals.$imageSmoothingDisabled;
        _this._drawn=false;
        _this.fireEvent("resize",{width: width,height: height,force: true});
        
      },
      resize :function _trc_PanelMod_resize(width,height) {
        var _this=this;
        
        if (_this.width==width&&_this.height==height) {
          return _this;
        }
        _this.setPanel(width,height);
      },
      fiber$resize :function* _trc_PanelMod_f_resize(_thread,width,height) {
        var _this=this;
        
        if (_this.width==width&&_this.height==height) {
          return _this;
        }
        (yield* _this.fiber$setPanel(_thread, width, height));
        
      },
      getContext :function _trc_PanelMod_getContext() {
        var _this=this;
        
        _this._drawn=true;
        return _this.canvas.getContext("2d");
      },
      fiber$getContext :function* _trc_PanelMod_f_getContext(_thread) {
        var _this=this;
        
        _this._drawn=true;
        return _this.canvas.getContext("2d");
        
      },
      __getter__context :function _trc_PanelMod___getter__context() {
        var _this=this;
        
        _this._drawn=true;
        return _this.canvas.getContext("2d");
      },
      __getter__image :function _trc_PanelMod___getter__image() {
        var _this=this;
        
        _this._drawn=true;
        return _this.canvas;
      },
      setFillStyle :function _trc_PanelMod_setFillStyle(color) {
        var _this=this;
        
        _this.fillStyle=color;
      },
      fiber$setFillStyle :function* _trc_PanelMod_f_setFillStyle(_thread,color) {
        var _this=this;
        
        _this.fillStyle=color;
        
      },
      __getter__fillStyle :function _trc_PanelMod___getter__fillStyle() {
        var _this=this;
        
        return _this._fillStyle;
      },
      __setter__fillStyle :function _trc_PanelMod___setter__fillStyle(val) {
        var _this=this;
        
        _this._fillStyle=val;
        if (! _this.canvas) {
          return _this;
        }
        _this.context.fillStyle=val+"";
      },
      __setter__strokeStyle :function _trc_PanelMod___setter__strokeStyle(val) {
        var _this=this;
        
        _this.context.strokeStyle=val+"";
      },
      __setter__lineWidth :function _trc_PanelMod___setter__lineWidth(val) {
        var _this=this;
        
        _this.context.lineWidth=val;
      },
      fillCircle :function _trc_PanelMod_fillCircle(x,y,r) {
        var _this=this;
        var ctx;
        
        ctx = _this.context;
        
        ctx.fillStyle=_this.fillStyle+"";
        ctx.beginPath();
        ctx.arc(x,y,r,0,2*Tonyu.globals.$Math.PI);
        ctx.closePath();
        ctx.fill();
      },
      fiber$fillCircle :function* _trc_PanelMod_f_fillCircle(_thread,x,y,r) {
        var _this=this;
        var ctx;
        
        ctx = _this.context;
        
        ctx.fillStyle=_this.fillStyle+"";
        ctx.beginPath();
        ctx.arc(x,y,r,0,2*Tonyu.globals.$Math.PI);
        ctx.closePath();
        ctx.fill();
        
      },
      fillRect :function _trc_PanelMod_fillRect(x,y,w,h) {
        var _this=this;
        var ctx;
        
        ctx = _this.getContext();
        
        ctx.fillRect(x,y,w,h);
      },
      fiber$fillRect :function* _trc_PanelMod_f_fillRect(_thread,x,y,w,h) {
        var _this=this;
        var ctx;
        
        ctx=yield* _this.fiber$getContext(_thread);
        
        ctx.fillRect(x,y,w,h);
        
      },
      fillText :function _trc_PanelMod_fillText(text,x,y,size,align) {
        var _this=this;
        var ctx;
        var splits;
        var f;
        var colCount;
        
        ctx = _this.getContext();
        
        ctx.save();
        text=text+"";
        splits = text.split("\n");
        
        ctx.textAlign=align||"center";
        size=size||15;
        ctx.fillStyle=_this.fillStyle+"";
        f = ctx.font.replace(/^[0-9\.]+/,"");
        
        ctx.font=size+f;
        for (colCount = 0;
         colCount<splits.length ; colCount++) {
          {
            ctx.fillText(splits[colCount],x,y);
            y+=size;
          }
        }
        ctx.restore();
      },
      fiber$fillText :function* _trc_PanelMod_f_fillText(_thread,text,x,y,size,align) {
        var _this=this;
        var ctx;
        var splits;
        var f;
        var colCount;
        
        ctx=yield* _this.fiber$getContext(_thread);
        
        ctx.save();
        text=text+"";
        splits = text.split("\n");
        
        ctx.textAlign=align||"center";
        size=size||15;
        ctx.fillStyle=_this.fillStyle+"";
        f = ctx.font.replace(/^[0-9\.]+/,"");
        
        ctx.font=size+f;
        for (colCount = 0;
         colCount<splits.length ; colCount++) {
          {
            ctx.fillText(splits[colCount],x,y);
            y+=size;
          }
        }
        ctx.restore();
        
      },
      clearRect :function _trc_PanelMod_clearRect(clearX,clearY,clearW,clearH) {
        var _this=this;
        var ctx;
        
        ctx = _this.getContext();
        
        ctx.save();
        ctx.clearRect(clearX||0,clearY||0,clearW||_this.width,clearH||_this.height);
        ctx.restore();
        if (arguments.length==0) {
          _this._drawn=false;
        }
      },
      fiber$clearRect :function* _trc_PanelMod_f_clearRect(_thread,clearX,clearY,clearW,clearH) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var ctx;
        
        ctx=yield* _this.fiber$getContext(_thread);
        
        ctx.save();
        ctx.clearRect(clearX||0,clearY||0,clearW||_this.width,clearH||_this.height);
        ctx.restore();
        if (_arguments.length==0) {
          _this._drawn=false;
        }
        
      },
      getPixel :function _trc_PanelMod_getPixel(getX,getY) {
        var _this=this;
        var ctx;
        var imagedata;
        var colordata;
        
        
        if (typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY)) {
          ctx=_this.getContext();
          imagedata=ctx.getImageData(getX,getY,1,1);
          colordata=[imagedata.data[0],imagedata.data[1],imagedata.data[2],imagedata.data[3]];
          
        } else {
          colordata=[0,0,0,0];
          
        }
        return (colordata);
      },
      fiber$getPixel :function* _trc_PanelMod_f_getPixel(_thread,getX,getY) {
        var _this=this;
        var ctx;
        var imagedata;
        var colordata;
        
        
        if (typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY)) {
          ctx=(yield* _this.fiber$getContext(_thread));
          imagedata=ctx.getImageData(getX,getY,1,1);
          colordata=[imagedata.data[0],imagedata.data[1],imagedata.data[2],imagedata.data[3]];
          
        } else {
          colordata=[0,0,0,0];
          
        }
        return (colordata);
        
      },
      scroll :function _trc_PanelMod_scroll(scrollX,scrollY) {
        var _this=this;
        var ctx;
        var imagedata;
        
        ctx = _this.getContext();
        
        ctx.save();
        imagedata = ctx.getImageData(0,0,_this.width,_this.height);
        
        _this.clearRect(0,0,_this.width,_this.height);
        ctx.putImageData(imagedata,- scrollX,- scrollY);
        ctx.restore();
      },
      fiber$scroll :function* _trc_PanelMod_f_scroll(_thread,scrollX,scrollY) {
        var _this=this;
        var ctx;
        var imagedata;
        
        ctx=yield* _this.fiber$getContext(_thread);
        
        ctx.save();
        imagedata = ctx.getImageData(0,0,_this.width,_this.height);
        
        (yield* _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height));
        ctx.putImageData(imagedata,- scrollX,- scrollY);
        ctx.restore();
        
      },
      draw :function _trc_PanelMod_draw(ctx) {
        var _this=this;
        var pImg;
        
        if (_this._drawn) {
          pImg = _this.canvas;
          
          ctx.save();
          if (_this.align=="left") {
            ctx.translate(_this.x+_this.width/2,_this.y+_this.height/2);
            
          } else {
            if (_this.align=="center") {
              ctx.translate(_this.x,_this.y);
              
            } else {
              if (_this.align=="right") {
                ctx.translate(_this.x-_this.width/2,_this.y-_this.height/2);
                
              }
            }
          }
          if (_this.rotation!=0) {
            ctx.rotate(_this.rotation/180*Math.PI);
            
          } else {
            ctx.rotate(_this.rotate/180*Math.PI);
            
          }
          if (typeof  _this.scaleY==="undefined") {
            ctx.scale(_this.scaleX,_this.scaleX);
            
          } else {
            ctx.scale(_this.scaleX,_this.scaleY);
            
          }
          ctx.globalAlpha=_this.alpha/255;
          ctx.drawImage(pImg,0,0,_this.width,_this.height,- _this.width/2,- _this.height/2,_this.width,_this.height);
          ctx.restore();
          
        }
      },
      drawSprite :function _trc_PanelMod_drawSprite(x,y,p,options) {
        var _this=this;
        var pImg;
        var scaleX;
        var scaleY;
        var rotation;
        var ctx;
        
        pImg = Tonyu.globals.$imageList[p];
        
        if (! pImg) {
          return _this;
        }
        if (options===true) {
          options={f: true};
        }
        options=options||{};
        scaleX = typeof  (options.scaleX)==="number"?options.scaleX:1;
        
        scaleY = typeof  (options.scaleY)==="number"?options.scaleY:scaleX;
        
        rotation = options.rotation||options.angle||0;
        
        ctx = _this.context;
        
        if (options.f) {
          scaleX*=- 1;
        }
        ctx.save();
        ctx.translate(x,y);
        ctx.rotate(rotation/180*Math.PI);
        ctx.scale(scaleX,scaleY);
        ctx.drawImage(pImg.image,pImg.x,pImg.y,pImg.width,pImg.height,- pImg.width/2,- pImg.height/2,pImg.width,pImg.height);
        ctx.restore();
      },
      copy :function _trc_PanelMod_copy() {
        var _this=this;
        var sx;
        var sy;
        var sw;
        var sh;
        var dx;
        var dy;
        var dw;
        var dh;
        var a;
        var srcPanel;
        var params;
        
        
        a = new Tonyu.classes.kernel.ArgParser(arguments);
        
        srcPanel = a.shift(Tonyu.classes.kernel.Panel)||_this;
        
        if (a.length<=4) {
          dx=a.shift();
          dy=a.shift();
          if (a.length==0) {
            _this.context.drawImage(srcPanel.image,dx,dy);
            
          } else {
            dw=a.shift();
            dh=a.shift();
            if (dw*dh!=0) {
              _this.context.drawImage(srcPanel.image,dx,dy,dw,dh);
              
            }
            
          }
          
        } else {
          sx=a.shift();
          sy=a.shift();
          sw=a.shift();
          sh=a.shift();
          dx=a.shift();
          if (typeof  dx==="object") {
            params = dx;
            
            
          }
          dy=a.shift();
          dw=a.shift()||sw;
          dh=a.shift()||sh;
          if (sw*sh*dw*dh!=0) {
            _this.context.drawImage(srcPanel.image,sx,sy,sw,sh,dx,dy,dw,dh);
            
          }
          
        }
      },
      drawLine :function _trc_PanelMod_drawLine(x,y,dx,dy) {
        var _this=this;
        
        if (dx==null&&dy==null) {
          if (x==null&&y==null) {
            _this.px=null;
            _this.py=null;
            return _this;
            
          }
          if (_this.px==null&&_this.py==null) {
            _this.px=x;
            _this.py=y;
            return _this;
            
          }
          dx=x;
          dy=y;
          x=_this.px;
          y=_this.py;
          _this.px=dx;
          _this.py=dy;
          
        }
        _this.context.beginPath();
        _this.context.moveTo(x,y);
        _this.context.lineTo(dx,dy);
        _this.context.stroke();
      },
      fiber$drawLine :function* _trc_PanelMod_f_drawLine(_thread,x,y,dx,dy) {
        var _this=this;
        
        if (dx==null&&dy==null) {
          if (x==null&&y==null) {
            _this.px=null;
            _this.py=null;
            return _this;
            
          }
          if (_this.px==null&&_this.py==null) {
            _this.px=x;
            _this.py=y;
            return _this;
            
          }
          dx=x;
          dy=y;
          x=_this.px;
          y=_this.py;
          _this.px=dx;
          _this.py=dy;
          
        }
        _this.context.beginPath();
        _this.context.moveTo(x,y);
        _this.context.lineTo(dx,dy);
        _this.context.stroke();
        
      },
      slicePattern :function _trc_PanelMod_slicePattern(x,y,width,height) {
        var _this=this;
        
        return {image: _this.canvas,x: x,y: y,width: width,height: height};
      },
      fiber$slicePattern :function* _trc_PanelMod_f_slicePattern(_thread,x,y,width,height) {
        var _this=this;
        
        return {image: _this.canvas,x: x,y: y,width: width,height: height};
        
      },
      addPattern :function _trc_PanelMod_addPattern(x,y,width,height) {
        var _this=this;
        
        Tonyu.globals.$imageList.push(_this.slicePattern(x,y,width,height));
        return Tonyu.globals.$imageList.length-1;
      },
      fiber$addPattern :function* _trc_PanelMod_f_addPattern(_thread,x,y,width,height) {
        var _this=this;
        
        Tonyu.globals.$imageList.push(_this.slicePattern(x,y,width,height));
        return Tonyu.globals.$imageList.length-1;
        
      },
      getImageData :function _trc_PanelMod_getImageData(x,y,width,height) {
        var _this=this;
        
        return _this.context.getImageData(x,y,width,height);
      },
      fiber$getImageData :function* _trc_PanelMod_f_getImageData(_thread,x,y,width,height) {
        var _this=this;
        
        return _this.context.getImageData(x,y,width,height);
        
      },
      putImageData :function _trc_PanelMod_putImageData(data,x,y) {
        var _this=this;
        
        return _this.context.putImageData(data,x,y);
      },
      fiber$putImageData :function* _trc_PanelMod_f_putImageData(_thread,data,x,y) {
        var _this=this;
        
        return _this.context.putImageData(data,x,y);
        
      },
      save :function _trc_PanelMod_save(fn) {
        var _this=this;
        var url;
        
        url = _this.canvas.toDataURL();
        
        if (typeof  fn==="string") {
          fn=_this.file(fn);
        }
        return fn.text(url);
      },
      fiber$save :function* _trc_PanelMod_f_save(_thread,fn) {
        var _this=this;
        var url;
        
        url = _this.canvas.toDataURL();
        
        if (typeof  fn==="string") {
          fn=(yield* _this.fiber$file(_thread, fn));
        }
        return fn.text(url);
        
      },
      load :function _trc_PanelMod_load(fn) {
        var _this=this;
        var url;
        var element;
        
        if (typeof  fn==="string") {
          fn=_this.file(fn);
        }
        return new Promise((function anonymous_7085(resolve) {
          var url;
          var element;
          
          url = fn.text();
          
          element = $("<img>").css({display: "none"}).appendTo("body");
          
          element.on("load",(function anonymous_7224() {
            var img;
            var width;
            var height;
            
            img = new Image();
            
            img.src=element.attr('src');
            width = img.width;
            
            height = img.height;
            
            _this.resize(width,height);
            _this.context.drawImage(img,0,0);
            resolve(_this);
          }));
          element.attr({src: url});
        }));
      },
      fiber$load :function* _trc_PanelMod_f_load(_thread,fn) {
        var _this=this;
        var url;
        var element;
        
        if (typeof  fn==="string") {
          fn=(yield* _this.fiber$file(_thread, fn));
        }
        return new Promise((function anonymous_7085(resolve) {
          var url;
          var element;
          
          url = fn.text();
          
          element = $("<img>").css({display: "none"}).appendTo("body");
          
          element.on("load",(function anonymous_7224() {
            var img;
            var width;
            var height;
            
            img = new Image();
            
            img.src=element.attr('src');
            width = img.width;
            
            height = img.height;
            
            _this.resize(width,height);
            _this.context.drawImage(img,0,0);
            resolve(_this);
          }));
          element.attr({src: url});
        }));
        
      },
      __setter__imageSmoothingEnabled :function _trc_PanelMod___setter__imageSmoothingEnabled(v) {
        var _this=this;
        
        if (typeof  _this.context.msImageSmoothingEnabled==="boolean") {
          _this.context.msImageSmoothingEnabled=v;
          
        } else {
          _this.context.imageSmoothingEnabled=v;
          
        }
      },
      __getter__imageSmoothingEnabled :function _trc_PanelMod___getter__imageSmoothingEnabled() {
        var _this=this;
        
        if (typeof  _this.context.msImageSmoothingEnabled==="boolean") {
          return _this.context.msImageSmoothingEnabled;
          
        } else {
          return _this.context.imageSmoothingEnabled;
          
        }
      },
      replaceColor :function _trc_PanelMod_replaceColor() {
        var _this=this;
        var a;
        var top;
        var left;
        var w;
        var h;
        var func;
        var ctx;
        var data;
        var i;
        var j;
        
        a = new Tonyu.classes.kernel.ArgParser(arguments);
        
        top = 0;
        left = 0;
        
        w = _this.width;
        h = _this.height;
        
        if (a.length>=4) {
          left=a.shift();
          top=a.shift();
          w=a.shift();
          h=a.shift();
          
        }
        func = a.shift();
        
        if (typeof  func!=="function") {
          ctx = _this.context;
          
          ctx.save();
          ctx.beginPath();
          ctx.moveTo(left,top);
          ctx.lineTo(left+w,top);
          ctx.lineTo(left+w,top+h);
          ctx.lineTo(left,top+h);
          ctx.closePath();
          ctx.clip();
          ctx.globalCompositeOperation="source-in";
          if (func) {
            _this.fillStyle=func;
          }
          ctx.fillRect(left,top,w,h);
          ctx.restore();
          return _this;
          
        }
        data = _this.getImageData(left,top,w,h);
        
        for (i = 0;
         i<h ; i++) {
          {
            for (j = 0;
             j<w ; j++) {
              {
                func(new Tonyu.classes.kernel.Color(data,j,i),left+j,top+i);
              }
            }
          }
        }
        _this.putImageData(data,left,top);
      },
      fiber$replaceColor :function* _trc_PanelMod_f_replaceColor(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var a;
        var top;
        var left;
        var w;
        var h;
        var func;
        var ctx;
        var data;
        var i;
        var j;
        
        a = new Tonyu.classes.kernel.ArgParser(_arguments);
        
        top = 0;
        left = 0;
        
        w = _this.width;
        h = _this.height;
        
        if (a.length>=4) {
          left=a.shift();
          top=a.shift();
          w=a.shift();
          h=a.shift();
          
        }
        func = a.shift();
        
        if (typeof  func!=="function") {
          ctx = _this.context;
          
          ctx.save();
          ctx.beginPath();
          ctx.moveTo(left,top);
          ctx.lineTo(left+w,top);
          ctx.lineTo(left+w,top+h);
          ctx.lineTo(left,top+h);
          ctx.closePath();
          ctx.clip();
          ctx.globalCompositeOperation="source-in";
          if (func) {
            _this.fillStyle=func;
          }
          ctx.fillRect(left,top,w,h);
          ctx.restore();
          return _this;
          
        }
        data=yield* _this.fiber$getImageData(_thread, left, top, w, h);
        
        for (i = 0;
         i<h ; i++) {
          {
            for (j = 0;
             j<w ; j++) {
              {
                func(new Tonyu.classes.kernel.Color(data,j,i),left+j,top+i);
              }
            }
          }
        }
        (yield* _this.fiber$putImageData(_thread, data, left, top));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"initPanelMod":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setPanel":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"resize":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getContext":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__context":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__image":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setFillStyle":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__fillStyle":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__fillStyle":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__strokeStyle":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__lineWidth":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"fillCircle":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"fillRect":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"fillText":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}},"clearRect":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"getPixel":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"scroll":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"drawSprite":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"copy":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"drawLine":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"slicePattern":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"addPattern":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"getImageData":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"putImageData":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"save":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"load":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__imageSmoothingEnabled":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__imageSmoothingEnabled":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"replaceColor":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"canvas":{},"_drawn":{},"_fillStyle":{},"px":{},"py":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.PlayMod',
  shortName: 'PlayMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.SchedulerMod,Tonyu.classes.kernel.LifeCycleMod],
  methods: function (__superClass) {
    return {
      main :function _trc_PlayMod_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_PlayMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initMML :function _trc_PlayMod_initMML() {
        var _this=this;
        
        if (_this.mmlInited) {
          return _this;
        }
        _this.mmlInited=true;
        Tonyu.globals.$currentProject.requestPlugin("timbre");
        if (! Tonyu.globals.$MMLS) {
          Tonyu.globals.$MMLS={};
          Tonyu.globals.$WaveTable=new Tonyu.classes.kernel.WaveTable;
          Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseMML));
          
        }
        _this.on("die",(function anonymous_353() {
          
          _this.play().stop();
        }));
      },
      releaseMML :function _trc_PlayMod_releaseMML() {
        var _this=this;
        var k;
        var v;
        
        if (Tonyu.globals.$MMLS) {
          for ([k, v] of Tonyu.iterator2(Tonyu.globals.$MMLS,2)) {
            v.stop();
            
          }
          Tonyu.globals.$MMLS=null;
          
        }
        if (Tonyu.globals.$WaveTable) {
          Tonyu.globals.$WaveTable.stop();
          Tonyu.globals.$WaveTable=null;
          
        }
      },
      play :function _trc_PlayMod_play() {
        var _this=this;
        var mmls;
        var i;
        
        _this.initMML();
        if (! _this._mml) {
          _this._mml=new Tonyu.classes.kernel.MML;
        }
        if (_this.isDead()||arguments.length==0) {
          return _this._mml;
        }
        mmls = [];
        
        for (i = 0;
         i<arguments.length ; i++) {
          {
            mmls.push(arguments[i]);
          }
        }
        _this._mml.play(mmls);
        while (_this._mml.bufferCount()>2) {
          _this.update();
          
        }
        return _this._mml;
      },
      fiber$play :function* _trc_PlayMod_f_play(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var mmls;
        var i;
        
        _this.initMML();
        if (! _this._mml) {
          _this._mml=new Tonyu.classes.kernel.MML;
        }
        if (_this.isDead()||_arguments.length==0) {
          return _this._mml;
        }
        mmls = [];
        
        for (i = 0;
         i<_arguments.length ; i++) {
          {
            mmls.push(_arguments[i]);
          }
        }
        _this._mml.play(mmls);
        while (_this._mml.bufferCount()>2) {
          (yield* _this.fiber$update(_thread));
          
        }
        return _this._mml;
        
      },
      playSE :function _trc_PlayMod_playSE() {
        var _this=this;
        var mml;
        var mmls;
        var i;
        
        _this.initMML();
        mml = new Tonyu.classes.kernel.MML;
        
        mmls = [];
        
        for (i = 0;
         i<arguments.length ; i++) {
          {
            mmls.push(arguments[i]);
          }
        }
        mml.play(mmls);
        return mml;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"initMML":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"releaseMML":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"play":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"playSE":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"mmlInited":{},"_mml":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.InputMod',
  shortName: 'InputMod',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.QueryMod],
  methods: function (__superClass) {
    return {
      main :function _trc_InputMod_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_InputMod_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      getkey :function _trc_InputMod_getkey(k) {
        var _this=this;
        
        return Tonyu.globals.$Keys.getkey(k);
      },
      waitInputDevice :function _trc_InputMod_waitInputDevice(fl) {
        var _this=this;
        
        _this.runPromise((function anonymous_244(f) {
          
          Tonyu.globals.$InputDevice.addOnetimeListener(f);
        }));
      },
      fiber$waitInputDevice :function* _trc_InputMod_f_waitInputDevice(_thread,fl) {
        var _this=this;
        
        (yield* _this.fiber$runPromise(_thread, (function anonymous_244(f) {
          
          Tonyu.globals.$InputDevice.addOnetimeListener(f);
        })));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"getkey":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"waitInputDevice":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.InputMod2D',
  shortName: 'InputMod2D',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.InputMod,Tonyu.classes.kernel.SpriteMod2D],
  methods: function (__superClass) {
    return {
      main :function _trc_InputMod2D_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_InputMod2D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      findTouch :function _trc_InputMod2D_findTouch(params) {
        var _this=this;
        var r;
        var res;
        
        if (typeof  params==="number") {
          params={scale: params};
        }
        params=params||{};
        
        if (params.width&&params.height) {
          r={x: _this.x,y: _this.y,width: params.width,height: params.height};
          
        } else {
          params.scale=params.scale||2;
          r=_this.getCrashShape();
          if (! r) {
            return null;
          }
          r={x: _this.x,y: _this.y,width: r.width*params.scale,height: r.height*params.scale};
          
        }
        res = Tonyu.globals.$touches.findTouch((function anonymous_578(t) {
          var tt;
          
          if (params.pickup||t.touched==1) {
            tt = Tonyu.globals.$Screen.convert(t,_this.layer);
            
            if (Tonyu.globals.$Math.abs(r.x-tt.x)<r.width/2&&Tonyu.globals.$Math.abs(r.y-tt.y)<r.height/2) {
              return true;
              
            }
            
          }
        }));
        
        if (res) {
          res.layer=_this.layer;
          return res;
          
        }
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"findTouch":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.BaseActor',
  shortName: 'BaseActor',
  namespace: 'kernel',
  includes: [Tonyu.classes.kernel.MathMod,Tonyu.classes.kernel.EventMod,Tonyu.classes.kernel.ThreadGroupMod,Tonyu.classes.kernel.EventHandlerCaller,Tonyu.classes.kernel.DialogMod,Tonyu.classes.kernel.FileMod,Tonyu.classes.kernel.AnimMod,Tonyu.classes.kernel.SchedulerMod,Tonyu.classes.kernel.QueryMod,Tonyu.classes.kernel.InputMod,Tonyu.classes.kernel.LifeCycleMod,Tonyu.classes.kernel.SpriteMod,Tonyu.classes.kernel.ParallelMod,Tonyu.classes.kernel.DraggableMod,Tonyu.classes.kernel.PlayMod,Tonyu.classes.kernel.ParallelMod,Tonyu.classes.kernel.PrintMod,Tonyu.classes.kernel.AssertionMod],
  methods: function (__superClass) {
    return {
      main :function _trc_BaseActor_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_BaseActor_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      initialize :function _trc_BaseActor_initialize(x,y,p) {
        var _this=this;
        
        if (typeof  x=="object") {
          Tonyu.extend(_this,x);
        } else {
          if (typeof  x=="number") {
            _this.x=x;
            _this.y=y;
            _this.p=p;
            
          }
        }
        _this.initSchedulerMod();
        _this.layer=_this.layer||_this.defaultLayer;
        if (_this.layer.group instanceof Tonyu.classes.kernel.SpriteGroup) {
          _this.layer=_this.layer.group;
        }
        _this.crashScale=1;
        if (_this.position) {
          _this.x=_this.position.x;
          _this.y=_this.position.y;
          
        }
        _this.initSpriteMod();
        _this.addToLayer();
        _this.initAnimMod();
      },
      extend :function _trc_BaseActor_extend(obj) {
        var _this=this;
        
        return Tonyu.extend(_this,obj);
      },
      loadPage :function _trc_BaseActor_loadPage() {
        var _this=this;
        
        Tonyu.globals.$Boot.loadPage.apply(Tonyu.globals.$Boot,arguments);
        _this.update();
      },
      fiber$loadPage :function* _trc_BaseActor_f_loadPage(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        
        Tonyu.globals.$Boot.loadPage.apply(Tonyu.globals.$Boot,_arguments);
        (yield* _this.fiber$update(_thread));
        
      },
      __getter__defaultLayer :function _trc_BaseActor___getter__defaultLayer() {
        var _this=this;
        
        return Tonyu.globals.$defaultLayer;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"extend":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"loadPage":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__defaultLayer":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.NoviceActor',
  shortName: 'NoviceActor',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.BaseActor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_NoviceActor_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_NoviceActor_f_main(_thread) {
        var _this=this;
        
        
      },
      sleep :function _trc_NoviceActor_sleep(n) {
        var _this=this;
        
        if (! n) {
          n=1;
        }
        for (n; n>0 ; n--) {
          _this.update();
        }
      },
      fiber$sleep :function* _trc_NoviceActor_f_sleep(_thread,n) {
        var _this=this;
        
        if (! n) {
          n=1;
        }
        for (n; n>0 ; n--) {
          (yield* _this.fiber$update(_thread));
        }
        
      },
      initSprite :function _trc_NoviceActor_initSprite() {
        var _this=this;
        
        if (! _this._sprite) {
          _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});
          Tonyu.globals.$Sprites.add(_this);
          
        }
      },
      fiber$initSprite :function* _trc_NoviceActor_f_initSprite(_thread) {
        var _this=this;
        
        if (! _this._sprite) {
          _this._sprite=new Tonyu.classes.kernel.BaseActor({owner: _this});
          Tonyu.globals.$Sprites.add(_this);
          
        }
        
      },
      say :function _trc_NoviceActor_say(text,size) {
        var _this=this;
        
        if (! size) {
          size=15;
        }
        _this.initSprite();
        _this._sprite._fukidashi={text: text,size: size,c: 30};
      },
      fiber$say :function* _trc_NoviceActor_f_say(_thread,text,size) {
        var _this=this;
        
        if (! size) {
          size=15;
        }
        (yield* _this.fiber$initSprite(_thread));
        _this._sprite._fukidashi={text: text,size: size,c: 30};
        
      },
      sprite :function _trc_NoviceActor_sprite(x,y,p) {
        var _this=this;
        
        _this.go(x,y,p);
      },
      fiber$sprite :function* _trc_NoviceActor_f_sprite(_thread,x,y,p) {
        var _this=this;
        
        (yield* _this.fiber$go(_thread, x, y, p));
        
      },
      show :function _trc_NoviceActor_show(x,y,p) {
        var _this=this;
        
        _this.go(x,y,p);
      },
      draw :function _trc_NoviceActor_draw(ctx) {
        var _this=this;
        
        _this._sprite.draw(ctx);
      },
      getCrashRect :function _trc_NoviceActor_getCrashRect() {
        var _this=this;
        
        return _this._sprite.getCrashRect();
      },
      fiber$getCrashRect :function* _trc_NoviceActor_f_getCrashRect(_thread) {
        var _this=this;
        
        return _this._sprite.getCrashRect();
        
      },
      go :function _trc_NoviceActor_go(x,y,p) {
        var _this=this;
        
        _this.initSprite();
        _this._sprite.x=x;
        _this._sprite.y=y;
        if (p!=null) {
          _this._sprite.p=p;
        }
      },
      fiber$go :function* _trc_NoviceActor_f_go(_thread,x,y,p) {
        var _this=this;
        
        (yield* _this.fiber$initSprite(_thread));
        _this._sprite.x=x;
        _this._sprite.y=y;
        if (p!=null) {
          _this._sprite.p=p;
        }
        
      },
      change :function _trc_NoviceActor_change(p) {
        var _this=this;
        
        _this.initSprite();
        _this._sprite.p=p;
      },
      fiber$change :function* _trc_NoviceActor_f_change(_thread,p) {
        var _this=this;
        
        (yield* _this.fiber$initSprite(_thread));
        _this._sprite.p=p;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"sleep":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"initSprite":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"say":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"sprite":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"show":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getCrashRect":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"go":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"change":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"_sprite":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Actor',
  shortName: 'Actor',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.BaseActor,
  includes: [Tonyu.classes.kernel.InputMod2D,Tonyu.classes.kernel.SpriteMod2D,Tonyu.classes.kernel.QueryMod2D,Tonyu.classes.kernel.OneframeSpriteMod],
  methods: function (__superClass) {
    return {
      main :function _trc_Actor_main() {
        var _this=this;
        
        "field strict";
      },
      fiber$main :function* _trc_Actor_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
      },
      addSubsprite :function _trc_Actor_addSubsprite(s) {
        var _this=this;
        
        _this.subsprites=_this.subsprites||new Tonyu.classes.kernel.Sprites({layer: _this});
        _this.subsprites.add(s);
        if (! s.lifeKeeper) {
          s.lifeKeeper=_this;
        }
      },
      fiber$addSubsprite :function* _trc_Actor_f_addSubsprite(_thread,s) {
        var _this=this;
        
        _this.subsprites=_this.subsprites||new Tonyu.classes.kernel.Sprites({layer: _this});
        _this.subsprites.add(s);
        if (! s.lifeKeeper) {
          s.lifeKeeper=_this;
        }
        
      },
      findEventHandlerClass :function _trc_Actor_findEventHandlerClass(type) {
        var _this=this;
        
        if (type==="touch") {
          return Tonyu.classes.kernel.ActorTouch;
        }
        if (type==="keyDown") {
          return Tonyu.classes.kernel.KeyDownHandler;
        }
        return __superClass.prototype.findEventHandlerClass.apply( _this, [type]);
      },
      toString :function _trc_Actor_toString() {
        var _this=this;
        
        let axis = "";
        
        if (typeof  _this.x==="number"&&typeof  _this.y==="number") {
          axis=[' (',_this.floor(_this.x),', ',_this.floor(_this.y),'),'].join('');
          
        }
        let image = _this.detectSpriteType();
        
        if (image=="Image") {
          image=typeof  _this.p=="number"?_this.p:"";
        }
        if (image.length>0) {
          image=" "+image;
        }
        return ['[',_this.getClassInfo().fullName,axis,image,']'].join('');
      },
      fiber$toString :function* _trc_Actor_f_toString(_thread) {
        var _this=this;
        
        let axis = "";
        
        if (typeof  _this.x==="number"&&typeof  _this.y==="number") {
          axis=[' (',_this.floor(_this.x),', ',_this.floor(_this.y),'),'].join('');
          
        }
        let image=yield* _this.fiber$detectSpriteType(_thread);
        
        if (image=="Image") {
          image=typeof  _this.p=="number"?_this.p:"";
        }
        if (image.length>0) {
          image=" "+image;
        }
        return ['[',_this.getClassInfo().fullName,axis,image,']'].join('');
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"addSubsprite":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"findEventHandlerClass":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"toString":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.Actor3D',
  shortName: 'Actor3D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.BaseActor,
  includes: [Tonyu.classes.kernel.SpriteMod3D,Tonyu.classes.kernel.QueryMod3D],
  methods: function (__superClass) {
    return {
      main :function _trc_Actor3D_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_Actor3D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initialize :function _trc_Actor3D_initialize(params) {
        var _this=this;
        
        Tonyu.extend(_this,params);
        _this.initSchedulerMod();
        _this.layer=_this.layer||_this.defaultLayer;
        _this.crashScale=1;
        if (_this.position) {
          _this.x=_this.position.x;
          _this.y=_this.position.y;
          _this.z=_this.position.z;
          
        }
        _this.initSpriteMod();
        _this.addToLayer();
        _this.initAnimMod();
      },
      rotate :function _trc_Actor3D_rotate(mode,angle,unit) {
        var _this=this;
        
        _this.direction.rotate(mode,angle,unit);
        return _this;
      },
      fiber$rotate :function* _trc_Actor3D_f_rotate(_thread,mode,angle,unit) {
        var _this=this;
        
        _this.direction.rotate(mode,angle,unit);
        return _this;
        
      },
      __getter__defaultLayer :function _trc_Actor3D___getter__defaultLayer() {
        var _this=this;
        
        return Tonyu.globals.$mainLayer3D;
      },
      dist :function _trc_Actor3D_dist(dx,dy,dz) {
        var _this=this;
        var t;
        
        if (typeof  dx=="object") {
          t = dx;
          
          dx=t.x-_this.x;
          dy=t.y-_this.y;
          dz=t.z-_this.z;
          
        }
        dz=dz||0;
        return _this.sqrt(dx*dx+dy*dy+dz*dz);
      },
      addSubsprite :function _trc_Actor3D_addSubsprite(s) {
        var _this=this;
        
        _this.subsprites=_this.subsprites||new Tonyu.classes.kernel.Sprites3D({layer: _this,transform: _this.transform});
        _this.subsprites.add(s);
        if (! s.lifeKeeper) {
          s.lifeKeeper=_this;
        }
      },
      fiber$addSubsprite :function* _trc_Actor3D_f_addSubsprite(_thread,s) {
        var _this=this;
        
        _this.subsprites=_this.subsprites||new Tonyu.classes.kernel.Sprites3D({layer: _this,transform: _this.transform});
        _this.subsprites.add(s);
        if (! s.lifeKeeper) {
          s.lifeKeeper=_this;
        }
        
      },
      localToWorld :function _trc_Actor3D_localToWorld(fru) {
        var _this=this;
        var res;
        var name;
        var k;
        var vec;
        
        res = _this.position.clone();
        
        for ([name, k] of Tonyu.iterator2(fru,2)) {
          vec = _this.direction[name];
          
          if (vec&&vec.mul) {
            res.addX_v(vec.mul(k));
          }
          
        }
        return res;
      },
      fiber$localToWorld :function* _trc_Actor3D_f_localToWorld(_thread,fru) {
        var _this=this;
        var res;
        var name;
        var k;
        var vec;
        
        res = _this.position.clone();
        
        for ([name, k] of Tonyu.iterator2(fru,2)) {
          vec = _this.direction[name];
          
          if (vec&&vec.mul) {
            res.addX_v(vec.mul(k));
          }
          
        }
        return res;
        
      },
      moveBy :function _trc_Actor3D_moveBy(by) {
        var _this=this;
        
        if (typeof  by==="number") {
          return _this.moveBy({forward: by});
        }
        _this.position.set(_this.localToWorld(by));
        return _this;
      },
      fiber$moveBy :function* _trc_Actor3D_f_moveBy(_thread,by) {
        var _this=this;
        
        if (typeof  by==="number") {
          return yield* _this.fiber$moveBy(_thread, {forward: by});
          
        }
        _this.position.set(_this.localToWorld(by));
        return _this;
        
      },
      toString :function _trc_Actor3D_toString() {
        var _this=this;
        
        return ['[',_this.getClassInfo().fullName,' (',_this.floor(_this.x),', ',_this.floor(_this.y),', ',_this.floor(_this.z),'), ',_this.floor(_this.p),']'].join('');
      },
      fiber$toString :function* _trc_Actor3D_f_toString(_thread) {
        var _this=this;
        
        return ['[',_this.getClassInfo().fullName,' (',_this.floor(_this.x),', ',_this.floor(_this.y),', ',_this.floor(_this.z),'), ',_this.floor(_this.p),']'].join('');
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"rotate":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"__getter__defaultLayer":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"dist":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"addSubsprite":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"localToWorld":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"moveBy":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"toString":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"z":{},"direction":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Camera3D',
  shortName: 'Camera3D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor3D,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Camera3D_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_Camera3D_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initialize :function _trc_Camera3D_initialize(p) {
        var _this=this;
        
        __superClass.apply( _this, [p]);
        _this.z1=_this.z1||Tonyu.globals.$screenWidth/2;
        _this.z=- _this.z1;
      },
      to2D :function _trc_Camera3D_to2D(pos) {
        var _this=this;
        var c;
        var x;
        var y;
        var z;
        
        c = pos;
        
        x = c.x;
        
        y = c.y;
        
        z = c.z;
        
        if (z<=0) {
          return null;
        }
        x=x*_this.z1/z;
        y=y*_this.z1/z;
        return {x: x,y: y,z: z,scale: _this.z1/z};
      },
      fiber$to2D :function* _trc_Camera3D_f_to2D(_thread,pos) {
        var _this=this;
        var c;
        var x;
        var y;
        var z;
        
        c = pos;
        
        x = c.x;
        
        y = c.y;
        
        z = c.z;
        
        if (z<=0) {
          return null;
        }
        x=x*_this.z1/z;
        y=y*_this.z1/z;
        return {x: x,y: y,z: z,scale: _this.z1/z};
        
      },
      draw3D :function _trc_Camera3D_draw3D(ctx3d) {
        var _this=this;
        
        if (ctx3d.camera===_this) {
          return _this;
        }
        __superClass.prototype.draw3D.apply( _this, [ctx3d]);
      },
      fiber$draw3D :function* _trc_Camera3D_f_draw3D(_thread,ctx3d) {
        var _this=this;
        
        if (ctx3d.camera===_this) {
          return _this;
        }
        (yield* __superClass.prototype.fiber$draw3D.apply( _this, [_thread, ctx3d]));
        
      },
      goBehind :function _trc_Camera3D_goBehind(target,dist) {
        var _this=this;
        
        if (! dist) {
          dist=_this.z1;
        }
        _this.position.set(target.position.sub(target.direction.forward.mul(dist)));
        _this.direction.set(target.direction);
      },
      fiber$goBehind :function* _trc_Camera3D_f_goBehind(_thread,target,dist) {
        var _this=this;
        
        if (! dist) {
          dist=_this.z1;
        }
        _this.position.set(target.position.sub(target.direction.forward.mul(dist)));
        _this.direction.set(target.direction);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"to2D":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.Vec3"],"returnValue":null}},"draw3D":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"goBehind":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"z1":{"vtype":"Number"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.GameScreen',
  shortName: 'GameScreen',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_GameScreen_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_GameScreen_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_GameScreen_initialize(opt) {
        var _this=this;
        
        _this.extend(opt);
        _this.resize(_this.width,_this.height);
        _this.bgColor="rgb(20,80,180)";
        _this.isDrawGrid=Tonyu.globals.$Sprites.isDrawGrid;
      },
      resize :function _trc_GameScreen_resize(width,height) {
        var _this=this;
        
        _this.width=width;
        _this.height=height;
        _this.buf=$("<canvas>").attr({width: width,height: height});
        _this.ctx=_this.buf[0].getContext("2d");
        _this.fireEvent("resize",width,height);
      },
      fiber$resize :function* _trc_GameScreen_f_resize(_thread,width,height) {
        var _this=this;
        
        _this.width=width;
        _this.height=height;
        _this.buf=$("<canvas>").attr({width: width,height: height});
        _this.ctx=_this.buf[0].getContext("2d");
        _this.fireEvent("resize",width,height);
        
      },
      setBounds :function _trc_GameScreen_setBounds(b) {
        var _this=this;
        
        _this.bounds=b;
      },
      fiber$setBounds :function* _trc_GameScreen_f_setBounds(_thread,b) {
        var _this=this;
        
        _this.bounds=b;
        
      },
      draw :function _trc_GameScreen_draw(cctx) {
        var _this=this;
        var b;
        
        b = _this.bounds;
        
        _this.fillCanvas();
        _this.sprites.draw(_this.buf[0]);
        cctx.drawImage(_this.buf[0],0,0,_this.width,_this.height,b.left,b.top,b.width,b.height);
      },
      canvas2buf :function _trc_GameScreen_canvas2buf(point) {
        var _this=this;
        var b;
        
        b = _this.bounds;
        
        if (! b) {
          return point;
        }
        return {x: (point.x-b.left)/b.width*_this.width,y: (point.y-b.top)/b.height*_this.height};
      },
      fiber$canvas2buf :function* _trc_GameScreen_f_canvas2buf(_thread,point) {
        var _this=this;
        var b;
        
        b = _this.bounds;
        
        if (! b) {
          return point;
        }
        return {x: (point.x-b.left)/b.width*_this.width,y: (point.y-b.top)/b.height*_this.height};
        
      },
      setBGColor :function _trc_GameScreen_setBGColor(c) {
        var _this=this;
        
        _this.bgColor=c;
      },
      fiber$setBGColor :function* _trc_GameScreen_f_setBGColor(_thread,c) {
        var _this=this;
        
        _this.bgColor=c;
        
      },
      fillCanvas :function _trc_GameScreen_fillCanvas() {
        var _this=this;
        var ctx;
        
        ctx = _this.buf[0].getContext("2d");
        
        ctx.save();
        ctx.fillStyle=_this.bgColor+"";
        ctx.fillRect(0,0,_this.width,_this.height);
        ctx.restore();
      },
      fiber$fillCanvas :function* _trc_GameScreen_f_fillCanvas(_thread) {
        var _this=this;
        var ctx;
        
        ctx = _this.buf[0].getContext("2d");
        
        ctx.save();
        ctx.fillStyle=_this.bgColor+"";
        ctx.fillRect(0,0,_this.width,_this.height);
        ctx.restore();
        
      },
      scrollTo :function _trc_GameScreen_scrollTo(scrollX,scrollY) {
        var _this=this;
        
        _this.sprites.scrollTo(scrollX,scrollY);
      },
      fiber$scrollTo :function* _trc_GameScreen_f_scrollTo(_thread,scrollX,scrollY) {
        var _this=this;
        
        _this.sprites.scrollTo(scrollX,scrollY);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"resize":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"setBounds":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"canvas2buf":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setBGColor":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"fillCanvas":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"scrollTo":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"isDrawGrid":{},"buf":{},"ctx":{},"bounds":{},"sprites":{},"bgColor":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Map',
  shortName: 'Map',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Map_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_Map_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_Map_initialize(param) {
        var _this=this;
        var j;
        var rows;
        var i;
        
        _this.bufSplit=1024;
        _this.sx=0;
        _this.sy=0;
        _this.alpha=255;
        __superClass.apply( _this, [param]);
        _this.chipWidth=_this.chipWidth||32;
        _this.chipHeight=_this.chipHeight||_this.chipWidth||32;
        if (typeof  _this.col!=="number") {
          _this.col=Tonyu.globals.$screenWidth/_this.chipWidth;
        }
        if (typeof  _this.row!=="number") {
          _this.row=Tonyu.globals.$screenHeight/_this.chipHeight;
        }
        _this.col=_this.floor(_this.col);
        _this.row=_this.floor(_this.row);
        _this.bufAry=_this.createBuf(_this.col*_this.chipWidth,_this.row*_this.chipHeight);
        _this.mapObj=true;
        _this.mapTable=[];
        _this.mapOnTable=[];
        for (j = 0;
         j<_this.row ; j++) {
          {
            rows = [];
            
            for (i = 0;
             i<_this.col ; i++) {
              {
                rows.push(- 1);
              }
            }
            _this.mapTable.push(rows);
          }
        }
        for (j = 0;
         j<_this.row ; j++) {
          {
            rows = [];
            
            for (i = 0;
             i<_this.col ; i++) {
              {
                rows.push(- 1);
              }
            }
            _this.mapOnTable.push(rows);
          }
        }
        _this.initMap();
      },
      createBuf :function _trc_Map_createBuf(width,height) {
        var _this=this;
        var rh;
        var ary;
        var j;
        var a;
        var h;
        var rw;
        var i;
        var w;
        
        rh = _this.floor(height);
        
        ary = [];
        
        for (j = 0;
         0<rh ; j++) {
          {
            a = [];
            
            h = rh;
            
            if (rh>_this.bufSplit) {
              h=_this.bufSplit;
            }
            if (rh<2) {
              h=2;
            }
            rw = _this.floor(width);
            
            for (i = 0;
             0<rw ; i++) {
              {
                w = rw;
                
                if (rw>_this.bufSplit) {
                  w=_this.bufSplit;
                }
                if (rw<2) {
                  w=2;
                }
                a.push($("<canvas>").attr({width: w,height: h}));
                rw-=_this.bufSplit;
              }
            }
            ary.push(a);
            rh-=_this.bufSplit;
          }
        }
        return ary;
      },
      fiber$createBuf :function* _trc_Map_f_createBuf(_thread,width,height) {
        var _this=this;
        var rh;
        var ary;
        var j;
        var a;
        var h;
        var rw;
        var i;
        var w;
        
        rh = _this.floor(height);
        
        ary = [];
        
        for (j = 0;
         0<rh ; j++) {
          {
            a = [];
            
            h = rh;
            
            if (rh>_this.bufSplit) {
              h=_this.bufSplit;
            }
            if (rh<2) {
              h=2;
            }
            rw = _this.floor(width);
            
            for (i = 0;
             0<rw ; i++) {
              {
                w = rw;
                
                if (rw>_this.bufSplit) {
                  w=_this.bufSplit;
                }
                if (rw<2) {
                  w=2;
                }
                a.push($("<canvas>").attr({width: w,height: h}));
                rw-=_this.bufSplit;
              }
            }
            ary.push(a);
            rh-=_this.bufSplit;
          }
        }
        return ary;
        
      },
      initMap :function _trc_Map_initMap() {
        var _this=this;
        var i;
        var j;
        
        if (! _this.mapData) {
          return _this;
        }
        if (! _this.mapOnData) {
          return _this;
        }
        for (i = 0;
         i<_this.row ; i++) {
          {
            for (j = 0;
             j<_this.col ; j++) {
              {
                _this.setAll(j,i,_this.mapData[i][j],_this.mapOnData[i][j]);
              }
            }
          }
        }
      },
      fiber$initMap :function* _trc_Map_f_initMap(_thread) {
        var _this=this;
        var i;
        var j;
        
        if (! _this.mapData) {
          return _this;
        }
        if (! _this.mapOnData) {
          return _this;
        }
        for (i = 0;
         i<_this.row ; i++) {
          {
            for (j = 0;
             j<_this.col ; j++) {
              {
                (yield* _this.fiber$setAll(_thread, j, i, _this.mapData[i][j], _this.mapOnData[i][j]));
              }
            }
          }
        }
        
      },
      redrawMap :function _trc_Map_redrawMap() {
        var _this=this;
        
        return _this.redraw();
      },
      fiber$redrawMap :function* _trc_Map_f_redrawMap(_thread) {
        var _this=this;
        
        return yield* _this.fiber$redraw(_thread);
        
        
      },
      redraw :function _trc_Map_redraw() {
        var _this=this;
        var i;
        var j;
        
        if (! _this.mapTable) {
          return _this;
        }
        _this.bufAry=_this.createBuf(_this.col*_this.chipWidth,_this.row*_this.chipHeight);
        for (i = 0;
         i<_this.row ; i++) {
          {
            for (j = 0;
             j<_this.col ; j++) {
              {
                _this.set(j,i,_this.mapTable[i][j]);
              }
            }
          }
        }
        if (! _this.mapOnTable) {
          return _this;
        }
        for (i = 0;
         i<_this.row ; i++) {
          {
            for (j = 0;
             j<_this.col ; j++) {
              {
                _this.setOn(j,i,_this.mapOnTable[i][j]);
              }
            }
          }
        }
      },
      fiber$redraw :function* _trc_Map_f_redraw(_thread) {
        var _this=this;
        var i;
        var j;
        
        if (! _this.mapTable) {
          return _this;
        }
        _this.bufAry=(yield* _this.fiber$createBuf(_thread, _this.col*_this.chipWidth, _this.row*_this.chipHeight));
        for (i = 0;
         i<_this.row ; i++) {
          {
            for (j = 0;
             j<_this.col ; j++) {
              {
                (yield* _this.fiber$set(_thread, j, i, _this.mapTable[i][j]));
              }
            }
          }
        }
        if (! _this.mapOnTable) {
          return _this;
        }
        for (i = 0;
         i<_this.row ; i++) {
          {
            for (j = 0;
             j<_this.col ; j++) {
              {
                (yield* _this.fiber$setOn(_thread, j, i, _this.mapOnTable[i][j]));
              }
            }
          }
        }
        
      },
      resolve :function _trc_Map_resolve(fileName,fallback) {
        var _this=this;
        var r;
        
        if (typeof  fileName==="string") {
          r = _this.file("../maps/").rel(fileName);
          
          if (! fallback||r.exists()) {
            return r;
          }
          r=_this.file(fileName);
          return r;
          
        }
        return fileName;
      },
      fiber$resolve :function* _trc_Map_f_resolve(_thread,fileName,fallback) {
        var _this=this;
        var r;
        
        if (typeof  fileName==="string") {
          r = _this.file("../maps/").rel(fileName);
          
          if (! fallback||r.exists()) {
            return r;
          }
          r=(yield* _this.fiber$file(_thread, fileName));
          return r;
          
        }
        return fileName;
        
      },
      load :function _trc_Map_load(dataFile) {
        var _this=this;
        
        dataFile=_this.resolve(dataFile,true);
        if (! dataFile||! dataFile.obj) {
          _this.print(dataFile);
          throw new Error(dataFile+" is not a file!");
          
          
        }
        _this.baseData=dataFile.obj();
        _this.loadFromBaseData(_this.baseData);
      },
      fiber$load :function* _trc_Map_f_load(_thread,dataFile) {
        var _this=this;
        
        dataFile=(yield* _this.fiber$resolve(_thread, dataFile, true));
        if (! dataFile||! dataFile.obj) {
          _this.print(dataFile);
          throw new Error(dataFile+" is not a file!");
          
          
        }
        _this.baseData=dataFile.obj();
        (yield* _this.fiber$loadFromBaseData(_thread, _this.baseData));
        
      },
      loadFromBaseData :function _trc_Map_loadFromBaseData(baseData) {
        var _this=this;
        
        _this.mapTable=baseData[0];
        _this.mapData=_this.mapTable;
        _this.row=_this.mapTable.length;
        _this.col=_this.mapTable[0].length;
        _this.mapOnTable=baseData[1];
        _this.mapOnData=_this.mapOnTable;
        if (baseData[2]) {
          _this.chipWidth=(baseData[2]-0)||_this.chipWidth||32;
        }
        if (baseData[3]) {
          _this.chipHeight=(baseData[3]-0)||_this.chipHeight||32;
        }
        _this.bufAry=_this.createBuf(_this.col*_this.chipWidth,_this.row*_this.chipHeight);
        _this.initMap();
      },
      fiber$loadFromBaseData :function* _trc_Map_f_loadFromBaseData(_thread,baseData) {
        var _this=this;
        
        _this.mapTable=baseData[0];
        _this.mapData=_this.mapTable;
        _this.row=_this.mapTable.length;
        _this.col=_this.mapTable[0].length;
        _this.mapOnTable=baseData[1];
        _this.mapOnData=_this.mapOnTable;
        if (baseData[2]) {
          _this.chipWidth=(baseData[2]-0)||_this.chipWidth||32;
        }
        if (baseData[3]) {
          _this.chipHeight=(baseData[3]-0)||_this.chipHeight||32;
        }
        _this.bufAry=(yield* _this.fiber$createBuf(_thread, _this.col*_this.chipWidth, _this.row*_this.chipHeight));
        (yield* _this.fiber$initMap(_thread));
        
      },
      save :function _trc_Map_save(saveFileName) {
        var _this=this;
        var saveDataFile;
        var data;
        
        saveDataFile = _this.resolve(saveFileName);
        
        data = [_this.mapTable,_this.mapOnTable,_this.chipWidth,_this.chipHeight];
        
        saveDataFile.obj(data);
      },
      fiber$save :function* _trc_Map_f_save(_thread,saveFileName) {
        var _this=this;
        var saveDataFile;
        var data;
        
        saveDataFile=yield* _this.fiber$resolve(_thread, saveFileName);
        
        data = [_this.mapTable,_this.mapOnTable,_this.chipWidth,_this.chipHeight];
        
        saveDataFile.obj(data);
        
      },
      setAll :function _trc_Map_setAll(setCol,setRow,p,onP) {
        var _this=this;
        var oldP;
        var oldOnP;
        var x1;
        var x2;
        var y1;
        var y2;
        var hs;
        var j;
        var ws;
        var i;
        var drawX;
        var drawY;
        var cv;
        var ctx;
        var pImg;
        
        if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
          return _this;
        }
        oldP = _this.mapTable[setRow][setCol];
        
        oldOnP = _this.mapOnTable[setRow][setCol];
        
        _this.mapTable[setRow][setCol]=p;
        _this.mapOnTable[setRow][setCol]=onP;
        x1 = _this.floor(setCol*_this.chipWidth/_this.bufSplit);
        
        x2 = _this.floor((setCol*_this.chipWidth+(_this.chipWidth-1))/_this.bufSplit);
        
        y1 = _this.floor(setRow*_this.chipHeight/_this.bufSplit);
        
        y2 = _this.floor((setRow*_this.chipHeight+(_this.chipHeight-1))/_this.bufSplit);
        
        hs = _this.bufAry.length;
        
        for (j = y1;
         j<=y2 ; j++) {
          {
            ws = _this.bufAry[j].length;
            
            for (i = x1;
             i<=x2 ; i++) {
              {
                drawX = setCol*_this.chipWidth-i*_this.bufSplit;
                
                drawY = setRow*_this.chipHeight-j*_this.bufSplit;
                
                cv = _this.bufAry[j][i];
                
                if (! cv) {
                  return _this;
                }
                ctx = cv[0].getContext("2d");
                
                if (! ctx) {
                  return _this;
                }
                p=Math.floor(p);
                pImg = Tonyu.globals.$imageList[p];
                
                ctx.clearRect(drawX,drawY,_this.chipWidth,_this.chipHeight);
                if (pImg) {
                  ctx.save();
                  ctx.drawImage(pImg.image,pImg.x,pImg.y,pImg.width,pImg.height,drawX,drawY,_this.chipWidth,_this.chipHeight);
                  ctx.restore();
                  
                }
                onP=Math.floor(onP);
                pImg=Tonyu.globals.$imageList[onP];
                if (pImg) {
                  ctx.save();
                  ctx.drawImage(pImg.image,pImg.x,pImg.y,pImg.width,pImg.height,drawX,drawY,_this.chipWidth,_this.chipHeight);
                  ctx.restore();
                  
                }
              }
            }
          }
        }
      },
      fiber$setAll :function* _trc_Map_f_setAll(_thread,setCol,setRow,p,onP) {
        var _this=this;
        var oldP;
        var oldOnP;
        var x1;
        var x2;
        var y1;
        var y2;
        var hs;
        var j;
        var ws;
        var i;
        var drawX;
        var drawY;
        var cv;
        var ctx;
        var pImg;
        
        if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
          return _this;
        }
        oldP = _this.mapTable[setRow][setCol];
        
        oldOnP = _this.mapOnTable[setRow][setCol];
        
        _this.mapTable[setRow][setCol]=p;
        _this.mapOnTable[setRow][setCol]=onP;
        x1 = _this.floor(setCol*_this.chipWidth/_this.bufSplit);
        
        x2 = _this.floor((setCol*_this.chipWidth+(_this.chipWidth-1))/_this.bufSplit);
        
        y1 = _this.floor(setRow*_this.chipHeight/_this.bufSplit);
        
        y2 = _this.floor((setRow*_this.chipHeight+(_this.chipHeight-1))/_this.bufSplit);
        
        hs = _this.bufAry.length;
        
        for (j = y1;
         j<=y2 ; j++) {
          {
            ws = _this.bufAry[j].length;
            
            for (i = x1;
             i<=x2 ; i++) {
              {
                drawX = setCol*_this.chipWidth-i*_this.bufSplit;
                
                drawY = setRow*_this.chipHeight-j*_this.bufSplit;
                
                cv = _this.bufAry[j][i];
                
                if (! cv) {
                  return _this;
                }
                ctx = cv[0].getContext("2d");
                
                if (! ctx) {
                  return _this;
                }
                p=Math.floor(p);
                pImg = Tonyu.globals.$imageList[p];
                
                ctx.clearRect(drawX,drawY,_this.chipWidth,_this.chipHeight);
                if (pImg) {
                  ctx.save();
                  ctx.drawImage(pImg.image,pImg.x,pImg.y,pImg.width,pImg.height,drawX,drawY,_this.chipWidth,_this.chipHeight);
                  ctx.restore();
                  
                }
                onP=Math.floor(onP);
                pImg=Tonyu.globals.$imageList[onP];
                if (pImg) {
                  ctx.save();
                  ctx.drawImage(pImg.image,pImg.x,pImg.y,pImg.width,pImg.height,drawX,drawY,_this.chipWidth,_this.chipHeight);
                  ctx.restore();
                  
                }
              }
            }
          }
        }
        
      },
      set :function _trc_Map_set(setCol,setRow,p) {
        var _this=this;
        
        if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
          return _this;
        }
        _this.setAll(setCol,setRow,p,_this.mapOnTable[setRow][setCol]);
      },
      fiber$set :function* _trc_Map_f_set(_thread,setCol,setRow,p) {
        var _this=this;
        
        if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
          return _this;
        }
        (yield* _this.fiber$setAll(_thread, setCol, setRow, p, _this.mapOnTable[setRow][setCol]));
        
      },
      setOn :function _trc_Map_setOn(setCol,setRow,onP) {
        var _this=this;
        
        if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
          return _this;
        }
        _this.setAll(setCol,setRow,_this.mapTable[setRow][setCol],onP);
      },
      fiber$setOn :function* _trc_Map_f_setOn(_thread,setCol,setRow,onP) {
        var _this=this;
        
        if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
          return _this;
        }
        (yield* _this.fiber$setAll(_thread, setCol, setRow, _this.mapTable[setRow][setCol], onP));
        
      },
      setOnAt :function _trc_Map_setOnAt(setX,setY,p) {
        var _this=this;
        
        _this.setOn(Math.floor((setX-_this.sx)/_this.chipWidth),Math.floor((setY-_this.sy)/_this.chipHeight),p);
      },
      fiber$setOnAt :function* _trc_Map_f_setOnAt(_thread,setX,setY,p) {
        var _this=this;
        
        (yield* _this.fiber$setOn(_thread, Math.floor((setX-_this.sx)/_this.chipWidth), Math.floor((setY-_this.sy)/_this.chipHeight), p));
        
      },
      setAt :function _trc_Map_setAt(setX,setY,p) {
        var _this=this;
        
        _this.set(Math.floor((setX-_this.sx)/_this.chipWidth),Math.floor((setY-_this.sy)/_this.chipHeight),p);
      },
      fiber$setAt :function* _trc_Map_f_setAt(_thread,setX,setY,p) {
        var _this=this;
        
        (yield* _this.fiber$set(_thread, Math.floor((setX-_this.sx)/_this.chipWidth), Math.floor((setY-_this.sy)/_this.chipHeight), p));
        
      },
      get :function _trc_Map_get(getCol,getRow) {
        var _this=this;
        
        if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {
          return _this.mapTable[getRow][getCol];
        }
        return - 1;
      },
      fiber$get :function* _trc_Map_f_get(_thread,getCol,getRow) {
        var _this=this;
        
        if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {
          return _this.mapTable[getRow][getCol];
        }
        return - 1;
        
      },
      getAt :function _trc_Map_getAt(getX,getY) {
        var _this=this;
        
        return _this.get(Math.floor((getX-_this.sx)/_this.chipWidth),Math.floor((getY-_this.sy)/_this.chipHeight));
      },
      fiber$getAt :function* _trc_Map_f_getAt(_thread,getX,getY) {
        var _this=this;
        
        return yield* _this.fiber$get(_thread, Math.floor((getX-_this.sx)/_this.chipWidth), Math.floor((getY-_this.sy)/_this.chipHeight));
        
        
      },
      getOn :function _trc_Map_getOn(getCol,getRow) {
        var _this=this;
        
        if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {
          return _this.mapOnTable[getRow][getCol];
        }
        return - 1;
      },
      fiber$getOn :function* _trc_Map_f_getOn(_thread,getCol,getRow) {
        var _this=this;
        
        if (getCol<_this.col&&getRow<_this.row&&getCol>=0&&getRow>=0) {
          return _this.mapOnTable[getRow][getCol];
        }
        return - 1;
        
      },
      getOnAt :function _trc_Map_getOnAt(getX,getY) {
        var _this=this;
        
        return _this.getOn(Math.floor((getX-_this.sx)/_this.chipWidth),Math.floor((getY-_this.sy)/_this.chipHeight));
      },
      fiber$getOnAt :function* _trc_Map_f_getOnAt(_thread,getX,getY) {
        var _this=this;
        
        return yield* _this.fiber$getOn(_thread, Math.floor((getX-_this.sx)/_this.chipWidth), Math.floor((getY-_this.sy)/_this.chipHeight));
        
        
      },
      scrollTo :function _trc_Map_scrollTo(scrollX,scrollY) {
        var _this=this;
        
        _this.sx=- scrollX;
        _this.sy=- scrollY;
      },
      fiber$scrollTo :function* _trc_Map_f_scrollTo(_thread,scrollX,scrollY) {
        var _this=this;
        
        _this.sx=- scrollX;
        _this.sy=- scrollY;
        
      },
      draw :function _trc_Map_draw(ctx) {
        var _this=this;
        var lay;
        var lsx;
        var lsy;
        var lwx;
        var lwy;
        var ls;
        var lr;
        var hs;
        var sum;
        var j;
        var ws;
        var i;
        var pCv;
        var pCtx;
        var dx;
        var dy;
        var dw;
        var dh;
        var mx1;
        var my1;
        var mx2;
        var my2;
        
        lay = Tonyu.globals.$Screen.findLayer(_this.layer);
        
        lsx = lay.spx;
        
        lsy = lay.spy;
        
        lwx = lay.wpx;
        
        lwy = lay.wpy;
        
        ls = (typeof  lay.scale=="number")?lay.scale:1;
        
        lr = (typeof  lay.rotation=="number")?lay.rotation:0;
        
        hs = _this.bufAry.length;
        
        sum = 0;
        
        ctx.save();
        for (j = 0;
         j<hs ; j++) {
          {
            ws = _this.bufAry[j].length;
            
            for (i = 0;
             i<ws ; i++) {
              {
                pCv = _this.bufAry[j][i];
                
                if (! pCv) {
                  return _this;
                }
                pCtx = pCv[0];
                
                if (! pCtx) {
                  return _this;
                }
                dx = _this.sx+i*_this.bufSplit;
                
                dy = _this.sy+j*_this.bufSplit;
                
                dw = pCtx.width;
                
                dh = pCtx.height;
                
                mx1 = lsx+(dx-lwx)*ls;
                
                my1 = lsy+(dy-lwy)*ls;
                
                mx2 = lsx+(dx-lwx+dw)*ls;
                
                my2 = lsy+(dy-lwy+dh)*ls;
                
                if (lr!=0||(0<=mx2&&mx1<Tonyu.globals.$screenWidth&&0<=my2&&my1<Tonyu.globals.$screenHeight)) {
                  ctx.globalAlpha=_this.alpha/255;
                  ctx.drawImage(pCtx,0,0,dw,dh,dx,dy,dw,dh);
                  sum++;
                  
                }
              }
            }
          }
        }
        ctx.restore();
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"createBuf":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"initMap":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"redrawMap":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"redraw":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"resolve":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"load":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"loadFromBaseData":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"save":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setAll":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"set":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"setOn":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"setOnAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"setAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"get":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getOn":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getOnAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"scrollTo":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"bufSplit":{},"sx":{},"sy":{},"chipWidth":{},"chipHeight":{},"col":{},"row":{},"bufAry":{},"mapObj":{},"mapTable":{},"mapOnTable":{},"mapData":{},"mapOnData":{},"baseData":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Map2',
  shortName: 'Map2',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Map2_main() {
        var _this=this;
        
        "field strict";
        
        
        
        
        
      },
      fiber$main :function* _trc_Map2_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        
      },
      getChipLayer :function _trc_Map2_getChipLayer(name) {
        var _this=this;
        var mp;
        
        for ([mp] of Tonyu.iterator2(_this.chipLayers,1)) {
          if (mp.name===name) {
            return mp;
          }
          
        }
        return null;
      },
      fiber$getChipLayer :function* _trc_Map2_f_getChipLayer(_thread,name) {
        var _this=this;
        var mp;
        
        for ([mp] of Tonyu.iterator2(_this.chipLayers,1)) {
          if (mp.name===name) {
            return mp;
          }
          
        }
        return null;
        
      },
      addChipLayer :function _trc_Map2_addChipLayer(name) {
        var _this=this;
        var res;
        
        res = new Tonyu.classes.kernel.Matrix;
        
        res.name=name;
        _this.chipLayers.push(res);
        return res;
      },
      fiber$addChipLayer :function* _trc_Map2_f_addChipLayer(_thread,name) {
        var _this=this;
        var res;
        
        res = new Tonyu.classes.kernel.Matrix;
        
        res.name=name;
        _this.chipLayers.push(res);
        return res;
        
      },
      __setter__expand :function _trc_Map2___setter__expand(v) {
        var _this=this;
        var k;
        
        switch (typeof  v) {
        case "string":
          v=v.split(/\s*[\s,]\s*/);
        case "object":
          if (v.join) {
            _this._expand={};
            for ([k] of Tonyu.iterator2(v,1)) {
              _this._expand[k]=true;
            }
            
          } else {
            _this._expand=v;
            
          }
          break;
          
        }
        if (_this._expand.all) {
          _this._expand={row: true,col: true};
        }
        if (_this._expand.row) {
          _this._expand.top=_this._expand.bottom=true;
          
        }
        if (_this._expand.col) {
          _this._expand.left=_this._expand.right=true;
          
        }
      },
      __getter__expand :function _trc_Map2___getter__expand() {
        var _this=this;
        
        return _this._expand;
      },
      initialize :function _trc_Map2_initialize(param) {
        var _this=this;
        
        _this._expand={};
        _this.chipLayers=[];
        param=param||{};
        _this.bufferSize=param.bufferSize||1024;
        _this.alpha=255;
        __superClass.apply( _this, [param]);
        _this.x=_this.x||0;
        _this.y=_this.y||0;
        if (! _this.align) {
          _this.align="left top";
        }
        if (typeof  _this.col==="number") {
          _this.col=_this.floor(_this.col);
          
        } else {
          _this.col=0;
          _this.expand.right=true;
          
        }
        if (typeof  _this.row==="number") {
          _this.row=_this.floor(_this.row);
          
        } else {
          _this.row=0;
          _this.expand.bottom=true;
          
        }
        _this.mapObj=true;
        _this.addChipLayer("base");
        _this.addChipLayer("on");
        _this.setWallFilter({layer: "on"});
      },
      setPivot :function _trc_Map2_setPivot(x,y) {
        var _this=this;
        
        _this.align=["left","top",x,y];
      },
      fiber$setPivot :function* _trc_Map2_f_setPivot(_thread,x,y) {
        var _this=this;
        
        _this.align=["left","top",x,y];
        
      },
      initBuf :function _trc_Map2_initBuf(p) {
        var _this=this;
        var pImg;
        
        if (_this.bufMat) {
          return _this;
        }
        _this.bufMat=new Tonyu.classes.kernel.Matrix;
        pImg = Tonyu.globals.$imageList[p];
        
        if (pImg) {
          _this.chipWidth=_this.chipWidth||pImg.width;
          _this.chipHeight=_this.chipHeight||pImg.height;
          
        } else {
          _this.chipWidth=_this.chipWidth||32;
          _this.chipHeight=_this.chipHeight||_this.chipWidth||32;
          
        }
        _this.parseBufferSize();
      },
      fiber$initBuf :function* _trc_Map2_f_initBuf(_thread,p) {
        var _this=this;
        var pImg;
        
        if (_this.bufMat) {
          return _this;
        }
        _this.bufMat=new Tonyu.classes.kernel.Matrix;
        pImg = Tonyu.globals.$imageList[p];
        
        if (pImg) {
          _this.chipWidth=_this.chipWidth||pImg.width;
          _this.chipHeight=_this.chipHeight||pImg.height;
          
        } else {
          _this.chipWidth=_this.chipWidth||32;
          _this.chipHeight=_this.chipHeight||_this.chipWidth||32;
          
        }
        (yield* _this.fiber$parseBufferSize(_thread));
        
      },
      parseBufferSize :function _trc_Map2_parseBufferSize() {
        var _this=this;
        function fitSize(size,unit) {
          
          size=_this.floor(size/unit)*unit;
          if (size<unit) {
            size=unit;
          }
          return size;
        }
        
        if (typeof  _this.bufferSize==="number") {
          _this.bufferSize={w: _this.bufferSize,h: _this.bufferSize};
          
        } else {
          _this.bufferSize.w=_this.bufferSize.w||_this.bufferSize.width||1024;
          _this.bufferSize.h=_this.bufferSize.h||_this.bufferSize.height||1024;
          
        }
        _this.bufferSize.w=fitSize(_this.bufferSize.w,_this.chipWidth);
        _this.bufferSize.h=fitSize(_this.bufferSize.h,_this.chipHeight);
      },
      fiber$parseBufferSize :function* _trc_Map2_f_parseBufferSize(_thread) {
        var _this=this;
        function fitSize(size,unit) {
          
          size=_this.floor(size/unit)*unit;
          if (size<unit) {
            size=unit;
          }
          return size;
        }
        
        if (typeof  _this.bufferSize==="number") {
          _this.bufferSize={w: _this.bufferSize,h: _this.bufferSize};
          
        } else {
          _this.bufferSize.w=_this.bufferSize.w||_this.bufferSize.width||1024;
          _this.bufferSize.h=_this.bufferSize.h||_this.bufferSize.height||1024;
          
        }
        _this.bufferSize.w=fitSize(_this.bufferSize.w,_this.chipWidth);
        _this.bufferSize.h=fitSize(_this.bufferSize.h,_this.chipHeight);
        
      },
      getBuf :function _trc_Map2_getBuf(col,row) {
        var _this=this;
        var w;
        var h;
        var cPerBuf;
        var rPerBuf;
        var bx;
        var by;
        var canvas;
        
        _this.initBuf();
        w = _this.bufferSize.w;
        
        h = _this.bufferSize.h;
        
        cPerBuf = _this.floor(w/_this.chipWidth);
        
        rPerBuf = _this.floor(h/_this.chipHeight);
        
        bx = _this.floor(col/cPerBuf);
        
        by = _this.floor(row/rPerBuf);
        
        canvas = _this.bufMat.get(bx,by);
        
        if (! canvas) {
          canvas=$("<canvas>").attr({width: w,height: h});
          _this.bufMat.set(bx,by,canvas);
          
        }
        return {canvas: canvas,context: canvas[0].getContext("2d"),bx: bx,by: by,left: (col%cPerBuf)*_this.chipWidth,top: (row%rPerBuf)*_this.chipHeight,width: _this.chipWidth,height: _this.chipHeight};
      },
      fiber$getBuf :function* _trc_Map2_f_getBuf(_thread,col,row) {
        var _this=this;
        var w;
        var h;
        var cPerBuf;
        var rPerBuf;
        var bx;
        var by;
        var canvas;
        
        (yield* _this.fiber$initBuf(_thread));
        w = _this.bufferSize.w;
        
        h = _this.bufferSize.h;
        
        cPerBuf = _this.floor(w/_this.chipWidth);
        
        rPerBuf = _this.floor(h/_this.chipHeight);
        
        bx = _this.floor(col/cPerBuf);
        
        by = _this.floor(row/rPerBuf);
        
        canvas = _this.bufMat.get(bx,by);
        
        if (! canvas) {
          canvas=$("<canvas>").attr({width: w,height: h});
          _this.bufMat.set(bx,by,canvas);
          
        }
        return {canvas: canvas,context: canvas[0].getContext("2d"),bx: bx,by: by,left: (col%cPerBuf)*_this.chipWidth,top: (row%rPerBuf)*_this.chipHeight,width: _this.chipWidth,height: _this.chipHeight};
        
      },
      pack :function _trc_Map2_pack() {
        var _this=this;
        var chipLayer;
        
        _this.row=_this.col=0;
        for ([chipLayer] of Tonyu.iterator2(_this.chipLayers,1)) {
          if (chipLayer.xmax+1>_this.col) {
            _this.col=chipLayer.xmax+1;
          }
          if (chipLayer.ymax+1>_this.row) {
            _this.row=chipLayer.ymax+1;
          }
          
        }
      },
      fiber$pack :function* _trc_Map2_f_pack(_thread) {
        var _this=this;
        var chipLayer;
        
        _this.row=_this.col=0;
        for ([chipLayer] of Tonyu.iterator2(_this.chipLayers,1)) {
          if (chipLayer.xmax+1>_this.col) {
            _this.col=chipLayer.xmax+1;
          }
          if (chipLayer.ymax+1>_this.row) {
            _this.row=chipLayer.ymax+1;
          }
          
        }
        
      },
      redraw :function _trc_Map2_redraw() {
        var _this=this;
        var i;
        var j;
        
        _this.initBuf();
        for (i = 0;
         i<_this.row ; i++) {
          {
            for (j = 0;
             j<_this.col ; j++) {
              {
                _this.redrawChip(j,i);
              }
            }
          }
        }
      },
      fiber$redraw :function* _trc_Map2_f_redraw(_thread) {
        var _this=this;
        var i;
        var j;
        
        (yield* _this.fiber$initBuf(_thread));
        for (i = 0;
         i<_this.row ; i++) {
          {
            for (j = 0;
             j<_this.col ; j++) {
              {
                (yield* _this.fiber$redrawChip(_thread, j, i));
              }
            }
          }
        }
        
      },
      resolve :function _trc_Map2_resolve(fileName,fallback) {
        var _this=this;
        var r;
        
        if (typeof  fileName==="string") {
          r = _this.file("../maps/").rel(fileName);
          
          if (! fallback||r.exists()) {
            return r;
          }
          r=_this.file(fileName);
          return r;
          
        }
        return fileName;
      },
      fiber$resolve :function* _trc_Map2_f_resolve(_thread,fileName,fallback) {
        var _this=this;
        var r;
        
        if (typeof  fileName==="string") {
          r = _this.file("../maps/").rel(fileName);
          
          if (! fallback||r.exists()) {
            return r;
          }
          r=(yield* _this.fiber$file(_thread, fileName));
          return r;
          
        }
        return fileName;
        
      },
      load :function _trc_Map2_load(dataFile) {
        var _this=this;
        var c;
        
        _this.bufMat=null;
        dataFile=_this.resolve(dataFile,true);
        if (! dataFile||! dataFile.obj) {
          _this.print(dataFile);
          throw new Error(dataFile+" is not a file!");
          
          
        }
        c = new Tonyu.classes.kernel.MapCodec({map: _this});
        
        c.load(dataFile);
        _this.redraw();
      },
      fiber$load :function* _trc_Map2_f_load(_thread,dataFile) {
        var _this=this;
        var c;
        
        _this.bufMat=null;
        dataFile=(yield* _this.fiber$resolve(_thread, dataFile, true));
        if (! dataFile||! dataFile.obj) {
          _this.print(dataFile);
          throw new Error(dataFile+" is not a file!");
          
          
        }
        c = new Tonyu.classes.kernel.MapCodec({map: _this});
        
        c.load(dataFile);
        (yield* _this.fiber$redraw(_thread));
        
      },
      save :function _trc_Map2_save(saveFileName) {
        var _this=this;
        var c;
        var saveDataFile;
        
        c = new Tonyu.classes.kernel.MapCodec({map: _this});
        
        saveDataFile = _this.resolve(saveFileName);
        
        c.save(saveDataFile);
      },
      fiber$save :function* _trc_Map2_f_save(_thread,saveFileName) {
        var _this=this;
        var c;
        var saveDataFile;
        
        c = new Tonyu.classes.kernel.MapCodec({map: _this});
        
        saveDataFile=yield* _this.fiber$resolve(_thread, saveFileName);
        
        c.save(saveDataFile);
        
      },
      redrawChip :function _trc_Map2_redrawChip(setCol,setRow) {
        var _this=this;
        var buf;
        var cv;
        var drawX;
        var drawY;
        var ctx;
        var w;
        var h;
        var l;
        var p;
        var pImg;
        
        buf = _this.getBuf(setCol,setRow);
        
        cv = buf.canvas;
        
        drawX = buf.left;
        
        drawY = buf.top;
        
        ctx = buf.context;
        
        w = buf.width;
        
        h = buf.height;
        
        ctx.clearRect(drawX,drawY,w,h);
        for ([l] of Tonyu.iterator2(_this.chipLayers,1)) {
          p = l.get(setCol,setRow);
          
          pImg = Tonyu.globals.$imageList[p];
          
          if (pImg) {
            ctx.save();
            ctx.drawImage(pImg.image,pImg.x,pImg.y,pImg.width,pImg.height,drawX,drawY,w,h);
            ctx.restore();
            
          }
          
        }
      },
      fiber$redrawChip :function* _trc_Map2_f_redrawChip(_thread,setCol,setRow) {
        var _this=this;
        var buf;
        var cv;
        var drawX;
        var drawY;
        var ctx;
        var w;
        var h;
        var l;
        var p;
        var pImg;
        
        buf=yield* _this.fiber$getBuf(_thread, setCol, setRow);
        
        cv = buf.canvas;
        
        drawX = buf.left;
        
        drawY = buf.top;
        
        ctx = buf.context;
        
        w = buf.width;
        
        h = buf.height;
        
        ctx.clearRect(drawX,drawY,w,h);
        for ([l] of Tonyu.iterator2(_this.chipLayers,1)) {
          p = l.get(setCol,setRow);
          
          pImg = Tonyu.globals.$imageList[p];
          
          if (pImg) {
            ctx.save();
            ctx.drawImage(pImg.image,pImg.x,pImg.y,pImg.width,pImg.height,drawX,drawY,w,h);
            ctx.restore();
            
          }
          
        }
        
      },
      setWithLayerName :function _trc_Map2_setWithLayerName(name,setCol,setRow,p) {
        var _this=this;
        var l;
        
        _this.initBuf(p);
        if (setCol>=_this.col&&! _this._expand.right||setRow>=_this.row&&! _this._expand.bottom||setCol<0&&! _this._expand.left||setRow<0&&! _this._expand.top) {
          return _this;
          
        }
        l = _this.getChipLayer(name);
        
        if (! l) {
          throw new Error("No such chipLayer "+name);
          
        }
        if (setRow>=_this.row) {
          _this.row=setRow+1;
        }
        if (setCol>=_this.col) {
          _this.col=setCol+1;
        }
        if (p<0) {
          p=undefined;
        }
        l.set(setCol,setRow,p);
        _this.redrawChip(setCol,setRow);
      },
      fiber$setWithLayerName :function* _trc_Map2_f_setWithLayerName(_thread,name,setCol,setRow,p) {
        var _this=this;
        var l;
        
        (yield* _this.fiber$initBuf(_thread, p));
        if (setCol>=_this.col&&! _this._expand.right||setRow>=_this.row&&! _this._expand.bottom||setCol<0&&! _this._expand.left||setRow<0&&! _this._expand.top) {
          return _this;
          
        }
        l=yield* _this.fiber$getChipLayer(_thread, name);
        
        if (! l) {
          throw new Error("No such chipLayer "+name);
          
        }
        if (setRow>=_this.row) {
          _this.row=setRow+1;
        }
        if (setCol>=_this.col) {
          _this.col=setCol+1;
        }
        if (p<0) {
          p=undefined;
        }
        l.set(setCol,setRow,p);
        (yield* _this.fiber$redrawChip(_thread, setCol, setRow));
        
      },
      range :function _trc_Map2_range(options) {
        var _this=this;
        var s;
        var world;
        var left;
        var top;
        var right;
        var width;
        var bottom;
        var height;
        var layers;
        var lt;
        var rb;
        var res;
        var i;
        var j;
        function n() {
          var a;
          var v;
          
          a = Array.prototype.slice.call(arguments);
          
          while (a.length) {
            v = a.shift();
            
            if (typeof  v==="number"&&v===v) {
              return v;
            }
            
          }
        }
        if (! _this.col||! _this.row) {
          return [];
        }
        options=options||{xmin: 0,ymin: 0,xmax: _this.col-1,ymax: _this.row-1};
        if (options.getCrashShape) {
          s = options.getCrashShape();
          
          options={world: true,xmin: s.xmin,xmax: s.xmax,ymin: s.ymin,ymax: s.ymax};
          
        }
        world = options.world;
        
        left = n(options.left,options.xmin,options.col,options.x);
        
        top = n(options.top,options.ymin,options.row,options.y);
        
        right = n(options.right,options.xmax,left+options.width-1,left);
        
        width = n(options.width,right-left+1);
        
        bottom = n(options.bottom,options.ymax,top+options.height-1,top);
        
        height = n(options.height,bottom-top+1);
        
        layers = options.layers||options.layer||_this.allLayerNames;
        
        if (world) {
          lt = _this.worldToChip({x: left,y: top});
          
          left=lt.x;
          top=lt.y;
          rb = _this.worldToChip({x: right,y: bottom});
          
          right=rb.x;
          bottom=rb.y;
          
        }
        res = [];
        
        for (i = top;
         i<=bottom ; i++) {
          {
            for (j = left;
             j<=right ; j++) {
              {
                res.push(_this.chip(j,i,layers));
              }
            }
          }
        }
        ;
        
        return res;
        
      },
      fiber$range :function* _trc_Map2_f_range(_thread,options) {
        var _this=this;
        var s;
        var world;
        var left;
        var top;
        var right;
        var width;
        var bottom;
        var height;
        var layers;
        var lt;
        var rb;
        var res;
        var i;
        var j;
        function n() {
          var a;
          var v;
          
          a = Array.prototype.slice.call(arguments);
          
          while (a.length) {
            v = a.shift();
            
            if (typeof  v==="number"&&v===v) {
              return v;
            }
            
          }
        }
        if (! _this.col||! _this.row) {
          return [];
        }
        options=options||{xmin: 0,ymin: 0,xmax: _this.col-1,ymax: _this.row-1};
        if (options.getCrashShape) {
          s = options.getCrashShape();
          
          options={world: true,xmin: s.xmin,xmax: s.xmax,ymin: s.ymin,ymax: s.ymax};
          
        }
        world = options.world;
        
        left = n(options.left,options.xmin,options.col,options.x);
        
        top = n(options.top,options.ymin,options.row,options.y);
        
        right = n(options.right,options.xmax,left+options.width-1,left);
        
        width = n(options.width,right-left+1);
        
        bottom = n(options.bottom,options.ymax,top+options.height-1,top);
        
        height = n(options.height,bottom-top+1);
        
        layers = options.layers||options.layer||_this.allLayerNames;
        
        if (world) {
          lt=yield* _this.fiber$worldToChip(_thread, {x: left,y: top});
          
          left=lt.x;
          top=lt.y;
          rb=yield* _this.fiber$worldToChip(_thread, {x: right,y: bottom});
          
          right=rb.x;
          bottom=rb.y;
          
        }
        res = [];
        
        for (i = top;
         i<=bottom ; i++) {
          {
            for (j = left;
             j<=right ; j++) {
              {
                res.push(_this.chip(j,i,layers));
              }
            }
          }
        }
        ;
        
        return res;
        
        
      },
      crashTo :function _trc_Map2_crashTo(actor,filter) {
        var _this=this;
        var r;
        var f;
        var re;
        var c;
        
        r = _this.range(actor);
        
        f = _this._wallFilter;
        
        if (filter) {
          f=_this.chipFilter(filter);
          
        }
        for ([re] of Tonyu.iterator2(r,1)) {
          c = f(re);
          
          if (c) {
            return c;
          }
          
        }
        return null;
      },
      isWallAt :function _trc_Map2_isWallAt(x,y) {
        var _this=this;
        var o;
        
        o = _this.worldToChip(x,y);
        
        return _this.isWall(o.x,o.y);
      },
      fiber$isWallAt :function* _trc_Map2_f_isWallAt(_thread,x,y) {
        var _this=this;
        var o;
        
        o=yield* _this.fiber$worldToChip(_thread, x, y);
        
        return yield* _this.fiber$isWall(_thread, o.x, o.y);
        
        
      },
      isWall :function _trc_Map2_isWall(cx,cy) {
        var _this=this;
        
        return _this._wallFilter(_this.chip(cx,cy));
      },
      fiber$isWall :function* _trc_Map2_f_isWall(_thread,cx,cy) {
        var _this=this;
        
        return _this._wallFilter(_this.chip(cx,cy));
        
      },
      chipFilter :function _trc_Map2_chipFilter(options) {
        var _this=this;
        var func;
        var p;
        var not;
        var layers;
        
        
        if (typeof  options==="function") {
          func=options;
          return func;
          
        } else {
          if (typeof  options==="number") {
            options={p: [options]};
            
          } else {
            if (options&&typeof  options.slice==="function") {
              options={p: options};
              
            }
          }
        }
        p = options.p;
        
        not = options.not;
        
        layers = options.layers||options.layer||_this.allLayerNames;
        
        if (p==null) {
          p=[- 1];
          not=true;
          
        }
        if (typeof  p==="number") {
          p=[p];
        }
        if (typeof  layers==="string") {
          layers=[layers];
        }
        if (not) {
          func=(function anonymous_8067(chip) {
            
            return chip.withLayers(layers).hasExcept(p);
          });
          
        } else {
          func=(function anonymous_8175(chip) {
            
            return chip.withLayers(layers).has(p);
          });
          
        }
        return func;
      },
      fiber$chipFilter :function* _trc_Map2_f_chipFilter(_thread,options) {
        var _this=this;
        var func;
        var p;
        var not;
        var layers;
        
        
        if (typeof  options==="function") {
          func=options;
          return func;
          
        } else {
          if (typeof  options==="number") {
            options={p: [options]};
            
          } else {
            if (options&&typeof  options.slice==="function") {
              options={p: options};
              
            }
          }
        }
        p = options.p;
        
        not = options.not;
        
        layers = options.layers||options.layer||_this.allLayerNames;
        
        if (p==null) {
          p=[- 1];
          not=true;
          
        }
        if (typeof  p==="number") {
          p=[p];
        }
        if (typeof  layers==="string") {
          layers=[layers];
        }
        if (not) {
          func=(function anonymous_8067(chip) {
            
            return chip.withLayers(layers).hasExcept(p);
          });
          
        } else {
          func=(function anonymous_8175(chip) {
            
            return chip.withLayers(layers).has(p);
          });
          
        }
        return func;
        
      },
      setWallFilter :function _trc_Map2_setWallFilter(options) {
        var _this=this;
        
        if (options.wall!=null) {
          options.p=options.wall;
          
        }
        if (options.path!=null) {
          options.p=options.path;
          options.not=true;
          
        }
        _this._wallFilter=_this.chipFilter(options);
      },
      fiber$setWallFilter :function* _trc_Map2_f_setWallFilter(_thread,options) {
        var _this=this;
        
        if (options.wall!=null) {
          options.p=options.wall;
          
        }
        if (options.path!=null) {
          options.p=options.path;
          options.not=true;
          
        }
        _this._wallFilter=(yield* _this.fiber$chipFilter(_thread, options));
        
      },
      set :function _trc_Map2_set(setCol,setRow,p) {
        var _this=this;
        
        _this.setWithLayerName("base",setCol,setRow,p);
      },
      fiber$set :function* _trc_Map2_f_set(_thread,setCol,setRow,p) {
        var _this=this;
        
        (yield* _this.fiber$setWithLayerName(_thread, "base", setCol, setRow, p));
        
      },
      setOn :function _trc_Map2_setOn(setCol,setRow,onP) {
        var _this=this;
        
        _this.setWithLayerName("on",setCol,setRow,onP);
      },
      fiber$setOn :function* _trc_Map2_f_setOn(_thread,setCol,setRow,onP) {
        var _this=this;
        
        (yield* _this.fiber$setWithLayerName(_thread, "on", setCol, setRow, onP));
        
      },
      worldToChip :function _trc_Map2_worldToChip(x,y) {
        var _this=this;
        var l;
        var r;
        
        let o;
        if (typeof  x==="object") {
          o=x;
        }
        if (typeof  x==="number"&&typeof  y==="number") {
          o={x: x,y: y};
          
        }
        if (! o||typeof  o!=="object") {
          throw _this.newError("worldToChipInvalidArgs",x,y);
          
          
        }
        l = _this.transform.worldToLocal(o);
        
        r = _this.getDrawRect();
        
        _this.initBuf();
        return {x: Math.floor((l.x-r.left)/_this.chipWidth),y: Math.floor((l.y-r.top)/_this.chipHeight)};
      },
      fiber$worldToChip :function* _trc_Map2_f_worldToChip(_thread,x,y) {
        var _this=this;
        var l;
        var r;
        
        let o;
        if (typeof  x==="object") {
          o=x;
        }
        if (typeof  x==="number"&&typeof  y==="number") {
          o={x: x,y: y};
          
        }
        if (! o||typeof  o!=="object") {
          throw _this.newError("worldToChipInvalidArgs",x,y);
          
          
        }
        l = _this.transform.worldToLocal(o);
        
        r=yield* _this.fiber$getDrawRect(_thread);
        
        (yield* _this.fiber$initBuf(_thread));
        return {x: Math.floor((l.x-r.left)/_this.chipWidth),y: Math.floor((l.y-r.top)/_this.chipHeight)};
        
      },
      chipToWorld :function _trc_Map2_chipToWorld(x,y) {
        var _this=this;
        var o;
        var r;
        var co;
        
        o = x;
        
        if (typeof  x==="number") {
          o={x: x,y: y};
          
        }
        r = _this.getDrawRect();
        
        _this.initBuf();
        co = {x: r.left+o.x*_this.chipWidth+_this.chipWidth/2,y: r.top+o.y*_this.chipHeight+_this.chipHeight/2};
        
        return _this.transform.localToWorld(co);
      },
      fiber$chipToWorld :function* _trc_Map2_f_chipToWorld(_thread,x,y) {
        var _this=this;
        var o;
        var r;
        var co;
        
        o = x;
        
        if (typeof  x==="number") {
          o={x: x,y: y};
          
        }
        r=yield* _this.fiber$getDrawRect(_thread);
        
        (yield* _this.fiber$initBuf(_thread));
        co = {x: r.left+o.x*_this.chipWidth+_this.chipWidth/2,y: r.top+o.y*_this.chipHeight+_this.chipHeight/2};
        
        return _this.transform.localToWorld(co);
        
      },
      setOnAt :function _trc_Map2_setOnAt(x,y,p) {
        var _this=this;
        var l;
        
        l = _this.worldToChip({x: x,y: y});
        
        _this.setOn(l.x,l.y,p);
      },
      fiber$setOnAt :function* _trc_Map2_f_setOnAt(_thread,x,y,p) {
        var _this=this;
        var l;
        
        l=yield* _this.fiber$worldToChip(_thread, {x: x,y: y});
        
        (yield* _this.fiber$setOn(_thread, l.x, l.y, p));
        
      },
      setAt :function _trc_Map2_setAt(x,y,p) {
        var _this=this;
        var l;
        
        l = _this.worldToChip({x: x,y: y});
        
        _this.set(l.x,l.y,p);
      },
      fiber$setAt :function* _trc_Map2_f_setAt(_thread,x,y,p) {
        var _this=this;
        var l;
        
        l=yield* _this.fiber$worldToChip(_thread, {x: x,y: y});
        
        (yield* _this.fiber$set(_thread, l.x, l.y, p));
        
      },
      getWithLayerName :function _trc_Map2_getWithLayerName(name,setCol,setRow) {
        var _this=this;
        var l;
        var r;
        
        if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
          return - 1;
        }
        l = _this.getChipLayer(name);
        
        if (! l) {
          throw new Error("No such chipLayer "+name);
          
        }
        r = l.get(setCol,setRow);
        
        return r==null?- 1:r;
      },
      fiber$getWithLayerName :function* _trc_Map2_f_getWithLayerName(_thread,name,setCol,setRow) {
        var _this=this;
        var l;
        var r;
        
        if (setCol>=_this.col||setRow>=_this.row||setCol<0||setRow<0) {
          return - 1;
        }
        l=yield* _this.fiber$getChipLayer(_thread, name);
        
        if (! l) {
          throw new Error("No such chipLayer "+name);
          
        }
        r = l.get(setCol,setRow);
        
        return r==null?- 1:r;
        
      },
      get :function _trc_Map2_get(getCol,getRow) {
        var _this=this;
        
        return _this.getWithLayerName("base",getCol,getRow);
      },
      fiber$get :function* _trc_Map2_f_get(_thread,getCol,getRow) {
        var _this=this;
        
        return yield* _this.fiber$getWithLayerName(_thread, "base", getCol, getRow);
        
        
      },
      getAt :function _trc_Map2_getAt(x,y) {
        var _this=this;
        var l;
        
        l = _this.worldToChip({x: x,y: y});
        
        return _this.get(l.x,l.y);
      },
      fiber$getAt :function* _trc_Map2_f_getAt(_thread,x,y) {
        var _this=this;
        var l;
        
        l=yield* _this.fiber$worldToChip(_thread, {x: x,y: y});
        
        return yield* _this.fiber$get(_thread, l.x, l.y);
        
        
      },
      getOn :function _trc_Map2_getOn(getCol,getRow) {
        var _this=this;
        
        return _this.getWithLayerName("on",getCol,getRow);
      },
      fiber$getOn :function* _trc_Map2_f_getOn(_thread,getCol,getRow) {
        var _this=this;
        
        return yield* _this.fiber$getWithLayerName(_thread, "on", getCol, getRow);
        
        
      },
      getOnAt :function _trc_Map2_getOnAt(x,y) {
        var _this=this;
        var l;
        
        l = _this.worldToChip({x: x,y: y});
        
        return _this.getOn(l.x,l.y);
      },
      fiber$getOnAt :function* _trc_Map2_f_getOnAt(_thread,x,y) {
        var _this=this;
        var l;
        
        l=yield* _this.fiber$worldToChip(_thread, {x: x,y: y});
        
        return yield* _this.fiber$getOn(_thread, l.x, l.y);
        
        
      },
      __getter__allLayerNames :function _trc_Map2___getter__allLayerNames() {
        var _this=this;
        
        return _this.chipLayers.map((function anonymous_10578(l) {
          
          return l.name;
        }));
      },
      chip :function _trc_Map2_chip(x,y,layers) {
        var _this=this;
        
        return new Tonyu.classes.kernel.MapChip({map: _this,x: x,y: y,layers: layers});
      },
      fiber$chip :function* _trc_Map2_f_chip(_thread,x,y,layers) {
        var _this=this;
        
        return new Tonyu.classes.kernel.MapChip({map: _this,x: x,y: y,layers: layers});
        
      },
      chipAt :function _trc_Map2_chipAt(x,y,layers) {
        var _this=this;
        var l;
        
        l = _this.worldToChip({x: x,y: y});
        
        return _this.chip(l.x,l.y,layers);
      },
      fiber$chipAt :function* _trc_Map2_f_chipAt(_thread,x,y,layers) {
        var _this=this;
        var l;
        
        l=yield* _this.fiber$worldToChip(_thread, {x: x,y: y});
        
        return yield* _this.fiber$chip(_thread, l.x, l.y, layers);
        
        
      },
      has :function _trc_Map2_has(x,y,p) {
        var _this=this;
        
        return _this.chip(x,y).has(p);
      },
      fiber$has :function* _trc_Map2_f_has(_thread,x,y,p) {
        var _this=this;
        
        return _this.chip(x,y).has(p);
        
      },
      hasAt :function _trc_Map2_hasAt(x,y,p) {
        var _this=this;
        var l;
        
        l = _this.worldToChip({x: x,y: y});
        
        return _this.has(l.x,l.y,p);
      },
      fiber$hasAt :function* _trc_Map2_f_hasAt(_thread,x,y,p) {
        var _this=this;
        var l;
        
        l=yield* _this.fiber$worldToChip(_thread, {x: x,y: y});
        
        return yield* _this.fiber$has(_thread, l.x, l.y, p);
        
        
      },
      scrollTo :function _trc_Map2_scrollTo(scrollX,scrollY) {
        var _this=this;
        
        _this.x=- scrollX;
        _this.y=- scrollY;
      },
      fiber$scrollTo :function* _trc_Map2_f_scrollTo(_thread,scrollX,scrollY) {
        var _this=this;
        
        _this.x=- scrollX;
        _this.y=- scrollY;
        
      },
      getDrawRect :function _trc_Map2_getDrawRect() {
        var _this=this;
        var r;
        
        _this.initBuf();
        r = _this._align.getDrawRect({width: _this.chipWidth*_this.col,height: _this.chipHeight*_this.row});
        
        r.left=r.x-r.width/2;
        r.top=r.y-r.height/2;
        return r;
      },
      fiber$getDrawRect :function* _trc_Map2_f_getDrawRect(_thread) {
        var _this=this;
        var r;
        
        (yield* _this.fiber$initBuf(_thread));
        r = _this._align.getDrawRect({width: _this.chipWidth*_this.col,height: _this.chipHeight*_this.row});
        
        r.left=r.x-r.width/2;
        r.top=r.y-r.height/2;
        return r;
        
      },
      draw :function _trc_Map2_draw(ctx) {
        var _this=this;
        var sum;
        var r;
        var sx;
        var sy;
        var j;
        var i;
        var pCv;
        var pCtx;
        var dx;
        var dy;
        var dw;
        var dh;
        
        if (! _this.bufMat) {
          return _this;
        }
        sum = 0;
        
        r = _this.getDrawRect();
        
        sx = r.left;
        
        sy = r.top;
        
        ctx.save();
        _this.performTransform(ctx);
        ctx.globalAlpha=_this.alpha/255;
        for ([j, i, pCv] of Tonyu.iterator2(_this.bufMat.keysIterator(),3)) {
          pCtx = pCv[0];
          
          if (! pCtx) {
            return _this;
          }
          dx = sx+j*_this.bufferSize.w;
          
          dy = sy+i*_this.bufferSize.h;
          
          dw = pCtx.width;
          
          dh = pCtx.height;
          
          ctx.drawImage(pCtx,0,0,dw,dh,dx,dy,dw,dh);
          sum++;
          
        }
        ctx.restore();
      },
      chipToActor :function _trc_Map2_chipToActor(options) {
        var _this=this;
        var p;
        var klass;
        var params;
        var r;
        var n;
        
        p = options.p;
        klass = options.class;
        params = options.params||{};
        
        if (typeof  p==="number") {
          p=[p];
          
        }
        for ([r] of Tonyu.iterator2(_this.range(),1)) {
          n = r.has(p);
          
          if (n) {
            n.toActor({class: klass,params: params});
            
          }
          
        }
      },
      fiber$chipToActor :function* _trc_Map2_f_chipToActor(_thread,options) {
        var _this=this;
        var p;
        var klass;
        var params;
        var r;
        var n;
        
        p = options.p;
        klass = options.class;
        params = options.params||{};
        
        if (typeof  p==="number") {
          p=[p];
          
        }
        for ([r] of Tonyu.iterator2(_this.range(),1)) {
          n = r.has(p);
          
          if (n) {
            n.toActor({class: klass,params: params});
            
          }
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"getChipLayer":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"addChipLayer":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__expand":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__expand":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setPivot":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"initBuf":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"parseBufferSize":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getBuf":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"pack":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"redraw":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"resolve":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"load":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"save":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"redrawChip":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"setWithLayerName":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"range":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"crashTo":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"isWallAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"isWall":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"chipFilter":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setWallFilter":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"set":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"setOn":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"worldToChip":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"chipToWorld":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"setOnAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"setAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"getWithLayerName":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"get":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getOn":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getOnAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"__getter__allLayerNames":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"chip":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"chipAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"has":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"hasAt":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"scrollTo":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getDrawRect":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"chipToActor":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"chipWidth":{},"chipHeight":{},"bufferSize":{},"bufMat":{},"row":{},"col":{},"chipLayers":{},"mapObj":{},"_expand":{},"_wallFilter":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Panel',
  shortName: 'Panel',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Panel_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_Panel_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_Panel_initialize(opt) {
        var _this=this;
        
        __superClass.apply( _this, [opt]);
        if (_this.canvas) {
          _this.width=_this.canvas.width;
          _this.height=_this.canvas.height;
          _this.parallel("watchResize");
          
        } else {
          _this.setPanel(_this.width||Tonyu.globals.$screenWidth||465,_this.height||Tonyu.globals.$screenHeight||465);
          
        }
        if (_this._fillStyle&&_this.canvas) {
          _this.canvas.getContext("2d").fillStyle=_this._fillStyle+"";
        }
        _this.x=typeof  _this.x==="number"?_this.x:_this.width/2;
        _this.y=typeof  _this.y==="number"?_this.y:_this.height/2;
        if (_this.alpha==null) {
          _this.alpha=255;
        }
        if (_this._drawn==null) {
          _this._drawn=false;
        }
        if (_this.layer&&_this.layer.defaultLayerPath) {
          _this.defaultLayerPath=_this.layer.defaultLayerPath.add(_this);
          
        }
        _this.registerEventHandler("touchstart",new Tonyu.classes.kernel.PanelTouchStart({target: _this}));
      },
      watchResize :function _trc_Panel_watchResize() {
        var _this=this;
        
        while (true) {
          if (_this.width!=_this.canvas.width||_this.height!=_this.canvas.height) {
            _this.width=_this.canvas.width;
            _this.height=_this.canvas.height;
            _this.fireEvent("resize",{width: _this.width,height: _this.height});
            
          }
          _this.runPromise(requestAnimationFrame);
          
        }
      },
      fiber$watchResize :function* _trc_Panel_f_watchResize(_thread) {
        var _this=this;
        
        while (true) {
          if (_this.width!=_this.canvas.width||_this.height!=_this.canvas.height) {
            _this.width=_this.canvas.width;
            _this.height=_this.canvas.height;
            _this.fireEvent("resize",{width: _this.width,height: _this.height});
            
          }
          (yield* _this.fiber$runPromise(_thread, requestAnimationFrame));
          
        }
        
      },
      setPanel :function _trc_Panel_setPanel(width,height) {
        var _this=this;
        
        if (! (width*height>0)) {
          throw new Error("Invalid Panel size: "+width+"x"+height);
          
          
        }
        _this.width=_this.trunc(width);
        _this.height=_this.trunc(height);
        _this.buf=$("<canvas>").attr({width: width,height: height});
        _this.canvas=_this.buf[0];
        _this.imageSmoothingEnabled=! Tonyu.globals.$imageSmoothingDisabled;
        _this._drawn=false;
        _this.fireEvent("resize",{width: width,height: height,force: true});
      },
      fiber$setPanel :function* _trc_Panel_f_setPanel(_thread,width,height) {
        var _this=this;
        
        if (! (width*height>0)) {
          throw new Error("Invalid Panel size: "+width+"x"+height);
          
          
        }
        _this.width=_this.trunc(width);
        _this.height=_this.trunc(height);
        _this.buf=$("<canvas>").attr({width: width,height: height});
        _this.canvas=_this.buf[0];
        _this.imageSmoothingEnabled=! Tonyu.globals.$imageSmoothingDisabled;
        _this._drawn=false;
        _this.fireEvent("resize",{width: width,height: height,force: true});
        
      },
      resize :function _trc_Panel_resize(width,height) {
        var _this=this;
        
        if (_this.width==width&&_this.height==height) {
          return _this;
        }
        _this.setPanel(width,height);
      },
      fiber$resize :function* _trc_Panel_f_resize(_thread,width,height) {
        var _this=this;
        
        if (_this.width==width&&_this.height==height) {
          return _this;
        }
        (yield* _this.fiber$setPanel(_thread, width, height));
        
      },
      getContext :function _trc_Panel_getContext() {
        var _this=this;
        
        _this._drawn=true;
        return _this.canvas.getContext("2d");
      },
      fiber$getContext :function* _trc_Panel_f_getContext(_thread) {
        var _this=this;
        
        _this._drawn=true;
        return _this.canvas.getContext("2d");
        
      },
      __getter__context :function _trc_Panel___getter__context() {
        var _this=this;
        
        _this._drawn=true;
        return _this.canvas.getContext("2d");
      },
      __getter__image :function _trc_Panel___getter__image() {
        var _this=this;
        
        _this._drawn=true;
        return _this.canvas;
      },
      setFillStyle :function _trc_Panel_setFillStyle(color) {
        var _this=this;
        
        _this.fillStyle=color;
      },
      fiber$setFillStyle :function* _trc_Panel_f_setFillStyle(_thread,color) {
        var _this=this;
        
        _this.fillStyle=color;
        
      },
      __getter__fillStyle :function _trc_Panel___getter__fillStyle() {
        var _this=this;
        
        return _this._fillStyle;
      },
      __setter__fillStyle :function _trc_Panel___setter__fillStyle(val) {
        var _this=this;
        
        _this._fillStyle=val;
        if (! _this.canvas) {
          return _this;
        }
        _this.context.fillStyle=val+"";
      },
      __setter__strokeStyle :function _trc_Panel___setter__strokeStyle(val) {
        var _this=this;
        
        _this.context.strokeStyle=val+"";
      },
      __setter__lineWidth :function _trc_Panel___setter__lineWidth(val) {
        var _this=this;
        
        _this.context.lineWidth=val;
      },
      fillCircle :function _trc_Panel_fillCircle(x,y,r) {
        var _this=this;
        var ctx;
        
        ctx = _this.context;
        
        ctx.fillStyle=_this.fillStyle+"";
        ctx.beginPath();
        ctx.arc(x,y,r,0,2*Tonyu.globals.$Math.PI);
        ctx.closePath();
        ctx.fill();
      },
      fiber$fillCircle :function* _trc_Panel_f_fillCircle(_thread,x,y,r) {
        var _this=this;
        var ctx;
        
        ctx = _this.context;
        
        ctx.fillStyle=_this.fillStyle+"";
        ctx.beginPath();
        ctx.arc(x,y,r,0,2*Tonyu.globals.$Math.PI);
        ctx.closePath();
        ctx.fill();
        
      },
      fillRect :function _trc_Panel_fillRect(x,y,w,h) {
        var _this=this;
        var ctx;
        
        ctx = _this.getContext();
        
        ctx.fillRect(x,y,w,h);
      },
      fillText :function _trc_Panel_fillText(text,x,y,size,align,baseline) {
        var _this=this;
        var ctx;
        var splits;
        var f;
        var colCount;
        
        ctx = _this.getContext();
        
        ctx.save();
        text=text+"";
        splits = text.split("\n");
        
        ctx.textAlign=align||"center";
        ctx.textBaseline=baseline||"alphabetic";
        size=size||15;
        ctx.fillStyle=_this.fillStyle+"";
        f = ctx.font.replace(/^[0-9\.]+/,"");
        
        ctx.font=size+f;
        for (colCount = 0;
         colCount<splits.length ; colCount++) {
          {
            ctx.fillText(splits[colCount],x,y);
            y+=size;
          }
        }
        ctx.restore();
      },
      fiber$fillText :function* _trc_Panel_f_fillText(_thread,text,x,y,size,align,baseline) {
        var _this=this;
        var ctx;
        var splits;
        var f;
        var colCount;
        
        ctx=yield* _this.fiber$getContext(_thread);
        
        ctx.save();
        text=text+"";
        splits = text.split("\n");
        
        ctx.textAlign=align||"center";
        ctx.textBaseline=baseline||"alphabetic";
        size=size||15;
        ctx.fillStyle=_this.fillStyle+"";
        f = ctx.font.replace(/^[0-9\.]+/,"");
        
        ctx.font=size+f;
        for (colCount = 0;
         colCount<splits.length ; colCount++) {
          {
            ctx.fillText(splits[colCount],x,y);
            y+=size;
          }
        }
        ctx.restore();
        
      },
      clearRect :function _trc_Panel_clearRect(clearX,clearY,clearW,clearH) {
        var _this=this;
        var ctx;
        
        ctx = _this.getContext();
        
        ctx.save();
        ctx.clearRect(clearX||0,clearY||0,clearW||_this.width,clearH||_this.height);
        ctx.restore();
        if (arguments.length==0) {
          _this._drawn=false;
        }
      },
      fiber$clearRect :function* _trc_Panel_f_clearRect(_thread,clearX,clearY,clearW,clearH) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var ctx;
        
        ctx=yield* _this.fiber$getContext(_thread);
        
        ctx.save();
        ctx.clearRect(clearX||0,clearY||0,clearW||_this.width,clearH||_this.height);
        ctx.restore();
        if (_arguments.length==0) {
          _this._drawn=false;
        }
        
      },
      getPixelColor :function _trc_Panel_getPixelColor(x,y) {
        var _this=this;
        var d;
        
        d = _this.getPixel(x,y);
        
        return new Tonyu.classes.kernel.Color(d[0],d[1],d[2],d[3]);
      },
      fiber$getPixelColor :function* _trc_Panel_f_getPixelColor(_thread,x,y) {
        var _this=this;
        var d;
        
        d=yield* _this.fiber$getPixel(_thread, x, y);
        
        return new Tonyu.classes.kernel.Color(d[0],d[1],d[2],d[3]);
        
      },
      getPixel :function _trc_Panel_getPixel(getX,getY) {
        var _this=this;
        var ctx;
        
        
        if (typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY)) {
          ctx=_this.getContext();
          _this.imagedata=ctx.getImageData(getX,getY,1,1);
          _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];
          
        } else {
          _this.colordata=[0,0,0,0];
          
        }
        return (_this.colordata);
      },
      fiber$getPixel :function* _trc_Panel_f_getPixel(_thread,getX,getY) {
        var _this=this;
        var ctx;
        
        
        if (typeof  getX=="number"&&! isNaN(getX)&&typeof  getY=="number"&&! isNaN(getY)) {
          ctx=(yield* _this.fiber$getContext(_thread));
          _this.imagedata=ctx.getImageData(getX,getY,1,1);
          _this.colordata=[_this.imagedata.data[0],_this.imagedata.data[1],_this.imagedata.data[2],_this.imagedata.data[3]];
          
        } else {
          _this.colordata=[0,0,0,0];
          
        }
        return (_this.colordata);
        
      },
      scroll :function _trc_Panel_scroll(scrollX,scrollY) {
        var _this=this;
        var ctx;
        
        ctx = _this.getContext();
        
        ctx.save();
        _this.imagedata=ctx.getImageData(0,0,_this.width,_this.height);
        _this.clearRect(0,0,_this.width,_this.height);
        ctx.putImageData(_this.imagedata,- scrollX,- scrollY);
        ctx.restore();
      },
      fiber$scroll :function* _trc_Panel_f_scroll(_thread,scrollX,scrollY) {
        var _this=this;
        var ctx;
        
        ctx=yield* _this.fiber$getContext(_thread);
        
        ctx.save();
        _this.imagedata=ctx.getImageData(0,0,_this.width,_this.height);
        (yield* _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height));
        ctx.putImageData(_this.imagedata,- scrollX,- scrollY);
        ctx.restore();
        
      },
      draw :function _trc_Panel_draw(ctx) {
        var _this=this;
        var pImg;
        var r;
        
        if (_this._drawn) {
          pImg = _this.canvas;
          
          ctx.save();
          _this.performTransform(ctx);
          r = _this._align.getDrawRect(_this);
          
          ctx.drawImage(pImg,0,0,_this.width,_this.height,r.x-r.width/2,r.y-r.height/2,_this.width,_this.height);
          ctx.restore();
          
        }
      },
      drawSprite :function _trc_Panel_drawSprite(x,y,p,options) {
        var _this=this;
        var pImg;
        var scaleX;
        var scaleY;
        var rotation;
        var ctx;
        
        pImg = Tonyu.globals.$imageList[p];
        
        if (! pImg) {
          return _this;
        }
        if (options===true) {
          options={f: true};
        }
        options=options||{};
        scaleX = typeof  (options.scaleX)==="number"?options.scaleX:1;
        
        scaleY = typeof  (options.scaleY)==="number"?options.scaleY:scaleX;
        
        rotation = options.rotation||options.angle||0;
        
        ctx = _this.context;
        
        if (options.f) {
          scaleX*=- 1;
        }
        ctx.save();
        ctx.translate(x,y);
        ctx.rotate(rotation/180*Math.PI);
        ctx.scale(scaleX,scaleY);
        ctx.drawImage(pImg.image,pImg.x,pImg.y,pImg.width,pImg.height,- pImg.width/2,- pImg.height/2,pImg.width,pImg.height);
        ctx.restore();
      },
      copy :function _trc_Panel_copy() {
        var _this=this;
        var sx;
        var sy;
        var sw;
        var sh;
        var dx;
        var dy;
        var dw;
        var dh;
        var a;
        var srcPanel;
        var params;
        
        
        a = new Tonyu.classes.kernel.ArgParser(arguments);
        
        srcPanel = a.shift(Tonyu.classes.kernel.Panel)||_this;
        
        if (a.length<=4) {
          dx=a.shift();
          dy=a.shift();
          if (a.length==0) {
            _this.context.drawImage(srcPanel.image,dx,dy);
            
          } else {
            dw=a.shift();
            dh=a.shift();
            if (dw*dh!=0) {
              _this.context.drawImage(srcPanel.image,dx,dy,dw,dh);
              
            }
            
          }
          
        } else {
          sx=a.shift();
          sy=a.shift();
          sw=a.shift();
          sh=a.shift();
          dx=a.shift();
          if (typeof  dx==="object") {
            params = dx;
            
            
          }
          dy=a.shift();
          dw=a.shift()||sw;
          dh=a.shift()||sh;
          if (sw*sh*dw*dh!=0) {
            _this.context.drawImage(srcPanel.image,sx,sy,sw,sh,dx,dy,dw,dh);
            
          }
          
        }
      },
      convert :function _trc_Panel_convert(obj,fromLayer,toLayer) {
        var _this=this;
        var scaleY;
        var r;
        var dx;
        var dy;
        var rt;
        var x;
        var y;
        
        if (toLayer==null) {
          toLayer=fromLayer;
          fromLayer=obj.layer;
          
        }
        if (Tonyu.is(fromLayer,Tonyu.classes.kernel.ScreenLayer)) {
          fromLayer=fromLayer.group;
        }
        if (Tonyu.is(toLayer,Tonyu.classes.kernel.ScreenLayer)) {
          toLayer=toLayer.group;
        }
        if (fromLayer==null&&toLayer==null) {
          fromLayer=_this;
          toLayer=_this.layer;
          
        } else {
          if (fromLayer==null&&toLayer===_this.layer) {
            fromLayer=_this;
            
          } else {
            if (fromLayer===_this&&toLayer==null) {
              toLayer=_this.layer;
              
            } else {
              if (fromLayer==null&&toLayer===_this) {
                fromLayer=_this.layer;
                
              } else {
                if (fromLayer===_this.layer&&toLayer==null) {
                  toLayer=_this;
                  
                }
              }
            }
          }
        }
        if (fromLayer===toLayer) {
          return obj;
        }
        scaleY = _this.scaleY||_this.scaleX;
        
        if (fromLayer==null||toLayer==null) {
          throw new Error("layer not set");
          
        }
        if (fromLayer===_this&&toLayer===_this.layer) {
          r = _this._align.getDrawRect(_this);
          
          dx = obj.x+r.x-r.width/2;
          
          dy = obj.y+r.y-r.height/2;
          
          rt = _this.rotation;
          
          x = _this.x+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)*_this.scaleX;
          
          y = _this.y+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)*scaleY;
          
          return {x: x,y: y,rotation: obj.rotation,scale: obj.scale,layer: toLayer};
          
        } else {
          if (fromLayer===_this.layer&&toLayer===_this) {
            r = _this._align.getDrawRect(_this);
            
            rt = - _this.rotation;
            
            dx = obj.x-(_this.x);
            
            dy = obj.y-(_this.y);
            
            x = r.width/2-r.x+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)/_this.scaleX;
            
            y = r.height/2-r.y+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)/scaleY;
            
            return {x: x,y: y,rotation: rt,scale: 1/_this.scaleX,layer: toLayer};
            
          } else {
            _this.print("Panel::conv not support",_this,fromLayer,toLayer);
            throw new Error("Panel::conv not support");
            
            
          }
        }
      },
      fiber$convert :function* _trc_Panel_f_convert(_thread,obj,fromLayer,toLayer) {
        var _this=this;
        var scaleY;
        var r;
        var dx;
        var dy;
        var rt;
        var x;
        var y;
        
        if (toLayer==null) {
          toLayer=fromLayer;
          fromLayer=obj.layer;
          
        }
        if (Tonyu.is(fromLayer,Tonyu.classes.kernel.ScreenLayer)) {
          fromLayer=fromLayer.group;
        }
        if (Tonyu.is(toLayer,Tonyu.classes.kernel.ScreenLayer)) {
          toLayer=toLayer.group;
        }
        if (fromLayer==null&&toLayer==null) {
          fromLayer=_this;
          toLayer=_this.layer;
          
        } else {
          if (fromLayer==null&&toLayer===_this.layer) {
            fromLayer=_this;
            
          } else {
            if (fromLayer===_this&&toLayer==null) {
              toLayer=_this.layer;
              
            } else {
              if (fromLayer==null&&toLayer===_this) {
                fromLayer=_this.layer;
                
              } else {
                if (fromLayer===_this.layer&&toLayer==null) {
                  toLayer=_this;
                  
                }
              }
            }
          }
        }
        if (fromLayer===toLayer) {
          return obj;
        }
        scaleY = _this.scaleY||_this.scaleX;
        
        if (fromLayer==null||toLayer==null) {
          throw new Error("layer not set");
          
        }
        if (fromLayer===_this&&toLayer===_this.layer) {
          r = _this._align.getDrawRect(_this);
          
          dx = obj.x+r.x-r.width/2;
          
          dy = obj.y+r.y-r.height/2;
          
          rt = _this.rotation;
          
          x = _this.x+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)*_this.scaleX;
          
          y = _this.y+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)*scaleY;
          
          return {x: x,y: y,rotation: obj.rotation,scale: obj.scale,layer: toLayer};
          
        } else {
          if (fromLayer===_this.layer&&toLayer===_this) {
            r = _this._align.getDrawRect(_this);
            
            rt = - _this.rotation;
            
            dx = obj.x-(_this.x);
            
            dy = obj.y-(_this.y);
            
            x = r.width/2-r.x+(_this.cos(rt)*dx+_this.cos(rt+90)*dy)/_this.scaleX;
            
            y = r.height/2-r.y+(_this.sin(rt)*dx+_this.sin(rt+90)*dy)/scaleY;
            
            return {x: x,y: y,rotation: rt,scale: 1/_this.scaleX,layer: toLayer};
            
          } else {
            _this.print("Panel::conv not support",_this,fromLayer,toLayer);
            throw new Error("Panel::conv not support");
            
            
          }
        }
        
      },
      drawLine :function _trc_Panel_drawLine(x,y,dx,dy) {
        var _this=this;
        
        if (dx==null&&dy==null) {
          if (x==null&&y==null) {
            _this.px=null;
            _this.py=null;
            return _this;
            
          }
          if (_this.px==null&&_this.py==null) {
            _this.px=x;
            _this.py=y;
            return _this;
            
          }
          dx=x;
          dy=y;
          x=_this.px;
          y=_this.py;
          _this.px=dx;
          _this.py=dy;
          
        }
        _this.context.beginPath();
        _this.context.moveTo(x,y);
        _this.context.lineTo(dx,dy);
        _this.context.stroke();
      },
      slicePattern :function _trc_Panel_slicePattern(x,y,width,height) {
        var _this=this;
        
        return {image: _this.canvas,x: x,y: y,width: width,height: height};
      },
      fiber$slicePattern :function* _trc_Panel_f_slicePattern(_thread,x,y,width,height) {
        var _this=this;
        
        return {image: _this.canvas,x: x,y: y,width: width,height: height};
        
      },
      addPattern :function _trc_Panel_addPattern(x,y,width,height) {
        var _this=this;
        
        Tonyu.globals.$imageList.push(_this.slicePattern(x,y,width,height));
        return Tonyu.globals.$imageList.length-1;
      },
      fiber$addPattern :function* _trc_Panel_f_addPattern(_thread,x,y,width,height) {
        var _this=this;
        
        Tonyu.globals.$imageList.push(_this.slicePattern(x,y,width,height));
        return Tonyu.globals.$imageList.length-1;
        
      },
      getImageData :function _trc_Panel_getImageData(x,y,width,height) {
        var _this=this;
        
        return _this.context.getImageData(x,y,width,height);
      },
      fiber$getImageData :function* _trc_Panel_f_getImageData(_thread,x,y,width,height) {
        var _this=this;
        
        return _this.context.getImageData(x,y,width,height);
        
      },
      putImageData :function _trc_Panel_putImageData(data,x,y) {
        var _this=this;
        
        return _this.context.putImageData(data,x,y);
      },
      fiber$putImageData :function* _trc_Panel_f_putImageData(_thread,data,x,y) {
        var _this=this;
        
        return _this.context.putImageData(data,x,y);
        
      },
      setAsText :function _trc_Panel_setAsText(text,options) {
        var _this=this;
        var padding;
        var f;
        var size;
        var a;
        var rect;
        var bg;
        
        options=options||{};
        padding = options.padding||0;
        
        switch (typeof  padding) {
        case "number":
          padding={left: padding,top: padding,right: padding,bottom: padding};
          break;
          
        case "string":
          padding=padding.split(/[ ,]+/);
          switch (padding.length) {
          case 1:
            padding={left: padding[0]-0,top: padding[0]-0,right: padding[0]-0,bottom: padding[0]-0};
            break;
            
          case 2:
            padding={left: padding[0]-0,top: padding[1]-0,right: padding[0]-0,bottom: padding[1]-0};
            break;
            
          default:
            padding={left: padding[0]-0,top: padding[1]-0,right: padding[2]-0,bottom: padding[3]-0};
          }
        }
        padding.left=padding.left||0;
        padding.right=padding.right||padding.left;
        padding.top=padding.top||0;
        padding.bottom=padding.bottom||padding.top;
        f = options.fillStyle||_this.fillStyle;
        
        size = options.size||15;
        
        a = new Tonyu.classes.kernel.Align2D("left top");
        
        rect = _this.drawTextRect(_this.context,text,padding.left,padding.top,size,a,"test");
        
        _this.resize(padding.left+rect.w+padding.right,padding.top+rect.h+padding.bottom);
        bg = options.background||options.bg||(function anonymous_11307() {
          
        });
        
        if (typeof  bg!=="function") {
          _this.fillStyle=bg;
          _this.fillRect(0,0,_this.width,_this.height);
          
        } else {
          bg(_this);
          
        }
        _this.fillStyle=f;
        rect = _this.drawTextRect(_this.context,text,padding.left,padding.top,size,a,"fill");
        
      },
      fiber$setAsText :function* _trc_Panel_f_setAsText(_thread,text,options) {
        var _this=this;
        var padding;
        var f;
        var size;
        var a;
        var rect;
        var bg;
        
        options=options||{};
        padding = options.padding||0;
        
        switch (typeof  padding) {
        case "number":
          padding={left: padding,top: padding,right: padding,bottom: padding};
          break;
          
        case "string":
          padding=padding.split(/[ ,]+/);
          switch (padding.length) {
          case 1:
            padding={left: padding[0]-0,top: padding[0]-0,right: padding[0]-0,bottom: padding[0]-0};
            break;
            
          case 2:
            padding={left: padding[0]-0,top: padding[1]-0,right: padding[0]-0,bottom: padding[1]-0};
            break;
            
          default:
            padding={left: padding[0]-0,top: padding[1]-0,right: padding[2]-0,bottom: padding[3]-0};
          }
        }
        padding.left=padding.left||0;
        padding.right=padding.right||padding.left;
        padding.top=padding.top||0;
        padding.bottom=padding.bottom||padding.top;
        f = options.fillStyle||_this.fillStyle;
        
        size = options.size||15;
        
        a = new Tonyu.classes.kernel.Align2D("left top");
        
        rect = _this.drawTextRect(_this.context,text,padding.left,padding.top,size,a,"test");
        
        (yield* _this.fiber$resize(_thread, padding.left+rect.w+padding.right, padding.top+rect.h+padding.bottom));
        bg = options.background||options.bg||(function anonymous_11307() {
          
        });
        
        if (typeof  bg!=="function") {
          _this.fillStyle=bg;
          _this.fillRect(0,0,_this.width,_this.height);
          
        } else {
          bg(_this);
          
        }
        _this.fillStyle=f;
        rect = _this.drawTextRect(_this.context,text,padding.left,padding.top,size,a,"fill");
        
        
      },
      replace :function _trc_Panel_replace(x,y,width,height,replacement) {
        var _this=this;
        
      },
      fiber$replace :function* _trc_Panel_f_replace(_thread,x,y,width,height,replacement) {
        var _this=this;
        
        
      },
      save :function _trc_Panel_save(fn) {
        var _this=this;
        var url;
        
        url = _this.buf[0].toDataURL();
        
        if (typeof  fn==="string") {
          fn=_this.file(fn);
        }
        return fn.text(url);
      },
      fiber$save :function* _trc_Panel_f_save(_thread,fn) {
        var _this=this;
        var url;
        
        url = _this.buf[0].toDataURL();
        
        if (typeof  fn==="string") {
          fn=(yield* _this.fiber$file(_thread, fn));
        }
        return fn.text(url);
        
      },
      download :function _trc_Panel_download(filename) {
        var _this=this;
        var url;
        
        filename=filename||"download.png";
        url = _this.buf[0].toDataURL();
        
        FS.Content.url(url).download(filename);
      },
      fiber$download :function* _trc_Panel_f_download(_thread,filename) {
        var _this=this;
        var url;
        
        filename=filename||"download.png";
        url = _this.buf[0].toDataURL();
        
        FS.Content.url(url).download(filename);
        
      },
      load :function _trc_Panel_load(fn) {
        var _this=this;
        var url;
        var element;
        
        if (typeof  fn==="string") {
          fn=_this.file(fn);
        }
        return new Promise((function anonymous_11948(resolve) {
          var url;
          var element;
          
          url = fn.text();
          
          element = $("<img>").css({display: "none"}).appendTo("body");
          
          element.on("load",(function anonymous_12087() {
            var img;
            var width;
            var height;
            
            img = new Image();
            
            img.src=element.attr('src');
            width = img.width;
            
            height = img.height;
            
            _this.resize(width,height);
            _this.context.drawImage(img,0,0);
            resolve(_this);
          }));
          element.attr({src: url});
        }));
      },
      fiber$load :function* _trc_Panel_f_load(_thread,fn) {
        var _this=this;
        var url;
        var element;
        
        if (typeof  fn==="string") {
          fn=(yield* _this.fiber$file(_thread, fn));
        }
        return new Promise((function anonymous_11948(resolve) {
          var url;
          var element;
          
          url = fn.text();
          
          element = $("<img>").css({display: "none"}).appendTo("body");
          
          element.on("load",(function anonymous_12087() {
            var img;
            var width;
            var height;
            
            img = new Image();
            
            img.src=element.attr('src');
            width = img.width;
            
            height = img.height;
            
            _this.resize(width,height);
            _this.context.drawImage(img,0,0);
            resolve(_this);
          }));
          element.attr({src: url});
        }));
        
      },
      __setter__imageSmoothingEnabled :function _trc_Panel___setter__imageSmoothingEnabled(v) {
        var _this=this;
        var context;
        
        context = _this.context;
        
        if (! context) {
          return _this;
        }
        if (typeof  context.msImageSmoothingEnabled==="boolean") {
          context.msImageSmoothingEnabled=v;
          
        } else {
          context.imageSmoothingEnabled=v;
          
        }
      },
      __getter__imageSmoothingEnabled :function _trc_Panel___getter__imageSmoothingEnabled() {
        var _this=this;
        var context;
        
        context = _this.context;
        
        if (! context) {
          return _this;
        }
        if (typeof  context.msImageSmoothingEnabled==="boolean") {
          return context.msImageSmoothingEnabled;
          
        } else {
          return context.imageSmoothingEnabled;
          
        }
      },
      replaceColor :function _trc_Panel_replaceColor() {
        var _this=this;
        var a;
        var top;
        var left;
        var w;
        var h;
        var func;
        var ctx;
        var data;
        var i;
        var j;
        
        a = new Tonyu.classes.kernel.ArgParser(arguments);
        
        top = 0;
        left = 0;
        
        w = _this.width;
        h = _this.height;
        
        if (a.length>=4) {
          left=a.shift();
          top=a.shift();
          w=a.shift();
          h=a.shift();
          
        }
        func = a.shift();
        
        if (typeof  func!=="function") {
          ctx = _this.context;
          
          ctx.save();
          ctx.beginPath();
          ctx.moveTo(left,top);
          ctx.lineTo(left+w,top);
          ctx.lineTo(left+w,top+h);
          ctx.lineTo(left,top+h);
          ctx.closePath();
          ctx.clip();
          ctx.globalCompositeOperation="source-in";
          if (func) {
            _this.fillStyle=func;
          }
          ctx.fillRect(left,top,w,h);
          ctx.restore();
          return _this;
          
        }
        data = _this.getImageData(left,top,w,h);
        
        for (i = 0;
         i<h ; i++) {
          {
            for (j = 0;
             j<w ; j++) {
              {
                func(new Tonyu.classes.kernel.Color(data,j,i),left+j,top+i);
              }
            }
          }
        }
        _this.putImageData(data,left,top);
      },
      fiber$replaceColor :function* _trc_Panel_f_replaceColor(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var a;
        var top;
        var left;
        var w;
        var h;
        var func;
        var ctx;
        var data;
        var i;
        var j;
        
        a = new Tonyu.classes.kernel.ArgParser(_arguments);
        
        top = 0;
        left = 0;
        
        w = _this.width;
        h = _this.height;
        
        if (a.length>=4) {
          left=a.shift();
          top=a.shift();
          w=a.shift();
          h=a.shift();
          
        }
        func = a.shift();
        
        if (typeof  func!=="function") {
          ctx = _this.context;
          
          ctx.save();
          ctx.beginPath();
          ctx.moveTo(left,top);
          ctx.lineTo(left+w,top);
          ctx.lineTo(left+w,top+h);
          ctx.lineTo(left,top+h);
          ctx.closePath();
          ctx.clip();
          ctx.globalCompositeOperation="source-in";
          if (func) {
            _this.fillStyle=func;
          }
          ctx.fillRect(left,top,w,h);
          ctx.restore();
          return _this;
          
        }
        data=yield* _this.fiber$getImageData(_thread, left, top, w, h);
        
        for (i = 0;
         i<h ; i++) {
          {
            for (j = 0;
             j<w ; j++) {
              {
                func(new Tonyu.classes.kernel.Color(data,j,i),left+j,top+i);
              }
            }
          }
        }
        (yield* _this.fiber$putImageData(_thread, data, left, top));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"watchResize":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setPanel":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"resize":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getContext":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__context":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__image":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setFillStyle":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__fillStyle":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__fillStyle":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__strokeStyle":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__lineWidth":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"fillCircle":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"fillRect":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"fillText":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"clearRect":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"getPixelColor":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getPixel":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"scroll":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"drawSprite":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"copy":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"convert":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"drawLine":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"slicePattern":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"addPattern":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"getImageData":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"putImageData":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"setAsText":{"nowait":false,"isMain":false,"vtype":{"params":["String",null],"returnValue":null}},"replace":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}},"save":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"download":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"load":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__setter__imageSmoothingEnabled":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__imageSmoothingEnabled":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"replaceColor":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"canvas":{},"_fillStyle":{},"_drawn":{},"defaultLayerPath":{},"buf":{},"imagedata":{},"colordata":{},"px":{},"py":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ScaledCanvas',
  shortName: 'ScaledCanvas',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ScaledCanvas_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_ScaledCanvas_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_ScaledCanvas_initialize(opt) {
        var _this=this;
        
        _this.extend(opt);
        _this.resize(_this.width,_this.height);
        _this.cw=_this.canvas.width();
        _this.ch=_this.canvas.height();
        _this.cctx=_this.canvas[0].getContext("2d");
        _this._color="rgb(20,80,180)";
        _this.sx=0;
        _this.sy=0;
        _this.isDrawGrid=Tonyu.globals.$Sprites.isDrawGrid;
      },
      resize :function _trc_ScaledCanvas_resize(width,height) {
        var _this=this;
        
        _this.width=width;
        _this.height=height;
        _this.buf=$("<canvas>").attr({width: width,height: height});
        _this.ctx=_this.buf[0].getContext("2d");
        Tonyu.globals.$screenWidth=width;
        Tonyu.globals.$screenHeight=height;
        if (Tonyu.globals.$panel) {
          Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
          Tonyu.globals.$panel.x=Tonyu.globals.$screenWidth/2;
          Tonyu.globals.$panel.y=Tonyu.globals.$screenHeight/2;
          
        }
        if (Tonyu.globals.$consolePanel) {
          Tonyu.globals.$consolePanel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
          Tonyu.globals.$consolePanel.x=Tonyu.globals.$screenWidth/2;
          Tonyu.globals.$consolePanel.y=Tonyu.globals.$screenHeight/2;
          Tonyu.globals.$consolePrintY=Tonyu.globals.$screenHeight;
          
        }
      },
      fiber$resize :function* _trc_ScaledCanvas_f_resize(_thread,width,height) {
        var _this=this;
        
        _this.width=width;
        _this.height=height;
        _this.buf=$("<canvas>").attr({width: width,height: height});
        _this.ctx=_this.buf[0].getContext("2d");
        Tonyu.globals.$screenWidth=width;
        Tonyu.globals.$screenHeight=height;
        if (Tonyu.globals.$panel) {
          Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
          Tonyu.globals.$panel.x=Tonyu.globals.$screenWidth/2;
          Tonyu.globals.$panel.y=Tonyu.globals.$screenHeight/2;
          
        }
        if (Tonyu.globals.$consolePanel) {
          Tonyu.globals.$consolePanel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
          Tonyu.globals.$consolePanel.x=Tonyu.globals.$screenWidth/2;
          Tonyu.globals.$consolePanel.y=Tonyu.globals.$screenHeight/2;
          Tonyu.globals.$consolePrintY=Tonyu.globals.$screenHeight;
          
        }
        
      },
      shouldDraw1x1 :function _trc_ScaledCanvas_shouldDraw1x1(srcw,srch,dstw,dsth) {
        var _this=this;
        var larger;
        var smaller;
        
        larger = 200;
        
        smaller = 5;
        
        return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;
      },
      fiber$shouldDraw1x1 :function* _trc_ScaledCanvas_f_shouldDraw1x1(_thread,srcw,srch,dstw,dsth) {
        var _this=this;
        var larger;
        var smaller;
        
        larger = 200;
        
        smaller = 5;
        
        return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;
        
      },
      draw :function _trc_ScaledCanvas_draw() {
        var _this=this;
        var calcw;
        var calch;
        var marginw;
        var marginh;
        
        _this.cw=_this.canvas.width();
        _this.ch=_this.canvas.height();
        calcw = _this.ch/_this.height*_this.width;
        
        calch = _this.cw/_this.width*_this.height;
        
        if (calch>_this.ch) {
          calch=_this.ch;
        }
        if (calcw>_this.cw) {
          calcw=_this.cw;
        }
        _this.cctx.clearRect(0,0,_this.cw,_this.ch);
        if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {
          calcw=_this.width;
          calch=_this.height;
          
        }
        marginw = Math.floor((_this.cw-calcw)/2);
        
        marginh = Math.floor((_this.ch-calch)/2);
        
        _this.cctx.drawImage(_this.buf[0],0,0,_this.width,_this.height,marginw,marginh,calcw,calch);
      },
      canvas2buf :function _trc_ScaledCanvas_canvas2buf(point) {
        var _this=this;
        var calcw;
        var calch;
        var marginw;
        var marginh;
        
        calcw = _this.ch/_this.height*_this.width;
        
        calch = _this.cw/_this.width*_this.height;
        
        if (calch>_this.ch) {
          calch=_this.ch;
        }
        if (calcw>_this.cw) {
          calcw=_this.cw;
        }
        if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {
          calcw=_this.width;
          calch=_this.height;
          
        }
        marginw = Math.floor((_this.cw-calcw)/2);
        
        marginh = Math.floor((_this.ch-calch)/2);
        
        _this._ret="("+point.x+"-"+marginw+")/"+calcw+"*"+_this.width+",";
        return {x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};
      },
      fiber$canvas2buf :function* _trc_ScaledCanvas_f_canvas2buf(_thread,point) {
        var _this=this;
        var calcw;
        var calch;
        var marginw;
        var marginh;
        
        calcw = _this.ch/_this.height*_this.width;
        
        calch = _this.cw/_this.width*_this.height;
        
        if (calch>_this.ch) {
          calch=_this.ch;
        }
        if (calcw>_this.cw) {
          calcw=_this.cw;
        }
        if (_this.shouldDraw1x1(_this.width,_this.height,calcw,calch)) {
          calcw=_this.width;
          calch=_this.height;
          
        }
        marginw = Math.floor((_this.cw-calcw)/2);
        
        marginh = Math.floor((_this.ch-calch)/2);
        
        _this._ret="("+point.x+"-"+marginw+")/"+calcw+"*"+_this.width+",";
        return {x: (point.x-marginw)/calcw*_this.width,y: (point.y-marginh)/calch*_this.height};
        
      },
      setBGColor :function _trc_ScaledCanvas_setBGColor(color) {
        var _this=this;
        
        _this._color=color;
      },
      fiber$setBGColor :function* _trc_ScaledCanvas_f_setBGColor(_thread,color) {
        var _this=this;
        
        _this._color=color;
        
      },
      fillCanvas :function _trc_ScaledCanvas_fillCanvas(cv) {
        var _this=this;
        var ctx;
        
        ctx = cv.getContext("2d");
        
        ctx.save();
        ctx.fillStyle=_this._color+"";
        ctx.fillRect(0,0,cv.width,cv.height);
        if (_this.isDrawGrid) {
          _this.drawGrid(cv);
        }
        ctx.restore();
      },
      fiber$fillCanvas :function* _trc_ScaledCanvas_f_fillCanvas(_thread,cv) {
        var _this=this;
        var ctx;
        
        ctx = cv.getContext("2d");
        
        ctx.save();
        ctx.fillStyle=_this._color+"";
        ctx.fillRect(0,0,cv.width,cv.height);
        if (_this.isDrawGrid) {
          _this.drawGrid(cv);
        }
        ctx.restore();
        
      },
      scrollTo :function _trc_ScaledCanvas_scrollTo(scrollX,scrollY) {
        var _this=this;
        
        Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);
      },
      fiber$scrollTo :function* _trc_ScaledCanvas_f_scrollTo(_thread,scrollX,scrollY) {
        var _this=this;
        
        Tonyu.globals.$Sprites.scrollTo(scrollX,scrollY);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"resize":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"shouldDraw1x1":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"canvas2buf":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setBGColor":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"fillCanvas":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"scrollTo":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"cw":{},"canvas":{},"ch":{},"cctx":{},"sx":{},"sy":{},"isDrawGrid":{},"buf":{},"ctx":{},"_ret":{},"_color":{},"drawGrid":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Screen',
  shortName: 'Screen',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Panel,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Screen_main() {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        
        
      },
      fiber$main :function* _trc_Screen_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        
        
        
      },
      initialize :function _trc_Screen_initialize(opt) {
        var _this=this;
        
        _this.layers=[];
        _this._color="black";
        _this.camera={screen: _this};
        __superClass.apply( _this, [opt]);
      },
      drawLayers :function _trc_Screen_drawLayers() {
        var _this=this;
        var c;
        var i;
        var l;
        
        if (! _this._drawing) {
          if (! _this.canvas) {
            throw new Error("canvas is null");
            
            
          }
          _this._drawing=true;
          if (_this.clearBG) {
            _this.clearRect(0,0,_this.width,_this.height);
            
          }
          _this.fillStyle=_this._color+"";
          _this.fillRect(0,0,_this.width,_this.height);
          c = _this.getContext();
          
          for (i = _this.layers.length-1;
           i>=0 ; i--) {
            {
              l = _this.layers[i];
              
              l.draw(c);
            }
          }
          _this._drawing=false;
          
        }
      },
      fiber$drawLayers :function* _trc_Screen_f_drawLayers(_thread) {
        var _this=this;
        var c;
        var i;
        var l;
        
        if (! _this._drawing) {
          if (! _this.canvas) {
            throw new Error("canvas is null");
            
            
          }
          _this._drawing=true;
          if (_this.clearBG) {
            (yield* _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height));
            
          }
          _this.fillStyle=_this._color+"";
          _this.fillRect(0,0,_this.width,_this.height);
          c=yield* _this.fiber$getContext(_thread);
          
          for (i = _this.layers.length-1;
           i>=0 ; i--) {
            {
              l = _this.layers[i];
              
              l.draw(c);
            }
          }
          _this._drawing=false;
          
        }
        
      },
      draw :function _trc_Screen_draw(ctx) {
        var _this=this;
        
        _this.drawLayers();
        __superClass.prototype.draw.apply( _this, [ctx]);
      },
      addLayer :function _trc_Screen_addLayer() {
        var _this=this;
        var layer;
        
        let a = new Tonyu.classes.kernel.ArgParser(arguments);
        
        let params = a.shiftOptions("layer","at","name");
        
        let group = params.layer;
        
        let at = params.at;
        
        let name = params.name;
        
        
        if (Tonyu.is(group,Tonyu.classes.kernel.ScreenLayer)) {
          if (! group.screen) {
            layer=group;
            layer.screen=_this;
            
          } else {
            if (group.screen!==_this) {
              group=group.group;
            } else {
              throw _this.newError("alreadyAdded",group);
              
            }
          }
          
        }
        if (group) {
          name=name||group.name;
        }
        if (! layer) {
          if (typeof  group==="string"&&! name) {
            name=group;
            group=null;
            
          }
          if (! group) {
            group=new Tonyu.classes.kernel.Sprites;
            group.name=name;
            
          }
          _this.assertIs(group,Tonyu.classes.kernel.SpriteGroup);
          layer=new Tonyu.classes.kernel.Layer2D({spx: 0,spy: 0,wpx: 0,wpy: 0,rotation: 0,scale: 1,group: group,screen: _this,index: _this.layers.length,name: name});
          
        } else {
          name=name||layer.name;
          
        }
        if (name&&_this.findLayerIndex(name)>=0) {
          throw _this.newError("alreadyAdded",name);
          
          
        }
        if (_this.findLayerIndex(layer)>=0) {
          throw _this.newError("alreadyAdded",group);
          
          
        }
        if (! group.defaultLayerPath&&_this.defaultLayerPath) {
          group.defaultLayerPath=_this.defaultLayerPath.add(layer);
          
        }
        if (at==null) {
          _this.layers.push(layer);
        } else {
          if (at<0) {
            at=_this.layers.length-at;
          }
          _this.layers.splice(at,0,layer);
          
        }
        if (_this.layers.length==1&&_this.index==null) {
          _this.selectLayer(layer);
          
        }
        return layer;
      },
      fiber$addLayer :function* _trc_Screen_f_addLayer(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var layer;
        
        let a = new Tonyu.classes.kernel.ArgParser(_arguments);
        
        let params = a.shiftOptions("layer","at","name");
        
        let group = params.layer;
        
        let at = params.at;
        
        let name = params.name;
        
        
        if (Tonyu.is(group,Tonyu.classes.kernel.ScreenLayer)) {
          if (! group.screen) {
            layer=group;
            layer.screen=_this;
            
          } else {
            if (group.screen!==_this) {
              group=group.group;
            } else {
              throw _this.newError("alreadyAdded",group);
              
            }
          }
          
        }
        if (group) {
          name=name||group.name;
        }
        if (! layer) {
          if (typeof  group==="string"&&! name) {
            name=group;
            group=null;
            
          }
          if (! group) {
            group=new Tonyu.classes.kernel.Sprites;
            group.name=name;
            
          }
          (yield* _this.fiber$assertIs(_thread, group, Tonyu.classes.kernel.SpriteGroup));
          layer=new Tonyu.classes.kernel.Layer2D({spx: 0,spy: 0,wpx: 0,wpy: 0,rotation: 0,scale: 1,group: group,screen: _this,index: _this.layers.length,name: name});
          
        } else {
          name=name||layer.name;
          
        }
        if (name&&_this.findLayerIndex(name)>=0) {
          throw _this.newError("alreadyAdded",name);
          
          
        }
        if (_this.findLayerIndex(layer)>=0) {
          throw _this.newError("alreadyAdded",group);
          
          
        }
        if (! group.defaultLayerPath&&_this.defaultLayerPath) {
          group.defaultLayerPath=_this.defaultLayerPath.add(layer);
          
        }
        if (at==null) {
          _this.layers.push(layer);
        } else {
          if (at<0) {
            at=_this.layers.length-at;
          }
          _this.layers.splice(at,0,layer);
          
        }
        if (_this.layers.length==1&&_this.index==null) {
          (yield* _this.fiber$selectLayer(_thread, layer));
          
        }
        return layer;
        
      },
      setDefaultLayer :function _trc_Screen_setDefaultLayer(l) {
        var _this=this;
        
        let layer = _this.findLayer(l);
        
        if (Tonyu.is(layer,Tonyu.classes.kernel.ScreenLayer)) {
          layer=layer.group;
        }
        if (! layer) {
          if (Tonyu.is(l,Tonyu.classes.kernel.ScreenLayer)) {
            layer=l.group;
          } else {
            if (Tonyu.is(l,Tonyu.classes.kernel.Sprites)) {
              layer=l;
            }
          }
          
        }
        if (! layer) {
          throw _this.newError("invalidLayer",l);
          
          
        }
        _this.assertIs(layer,Tonyu.classes.kernel.SpriteGroup);
        Tonyu.globals.$defaultLayer=layer;
      },
      fiber$setDefaultLayer :function* _trc_Screen_f_setDefaultLayer(_thread,l) {
        var _this=this;
        
        let layer=yield* _this.fiber$findLayer(_thread, l);
        
        if (Tonyu.is(layer,Tonyu.classes.kernel.ScreenLayer)) {
          layer=layer.group;
        }
        if (! layer) {
          if (Tonyu.is(l,Tonyu.classes.kernel.ScreenLayer)) {
            layer=l.group;
          } else {
            if (Tonyu.is(l,Tonyu.classes.kernel.Sprites)) {
              layer=l;
            }
          }
          
        }
        if (! layer) {
          throw _this.newError("invalidLayer",l);
          
          
        }
        (yield* _this.fiber$assertIs(_thread, layer, Tonyu.classes.kernel.SpriteGroup));
        Tonyu.globals.$defaultLayer=layer;
        
      },
      removeLayer :function _trc_Screen_removeLayer(i) {
        var _this=this;
        var r;
        
        r = _this.findLayerIndex(i);
        
        if (r<0) {
          return _this;
        }
        _this.layers.splice(r,1);
      },
      fiber$removeLayer :function* _trc_Screen_f_removeLayer(_thread,i) {
        var _this=this;
        var r;
        
        r=yield* _this.fiber$findLayerIndex(_thread, i);
        
        if (r<0) {
          return _this;
        }
        _this.layers.splice(r,1);
        
      },
      selectLayer :function _trc_Screen_selectLayer(i) {
        var _this=this;
        var r;
        
        r = _this.findLayerIndex(i);
        
        if (r>=0) {
          _this.index=r;
        }
      },
      fiber$selectLayer :function* _trc_Screen_f_selectLayer(_thread,i) {
        var _this=this;
        var r;
        
        r=yield* _this.fiber$findLayerIndex(_thread, i);
        
        if (r>=0) {
          _this.index=r;
        }
        
      },
      findLayerIndex :function _trc_Screen_findLayerIndex(i) {
        var _this=this;
        var j;
        
        if (typeof  i=="number") {
          if (_this.layers[i]) {
            return i;
          }
          
        } else {
          if (Tonyu.is(i,Tonyu.classes.kernel.ScreenLayer)) {
            i=i.group;
            
          }
          for (j = 0;
           j<_this.layers.length ; j++) {
            {
              if (_this.layers[j].group===i||_this.layers[j].name===i) {
                return j;
                
              }
            }
          }
          
        }
        return - 1;
      },
      fiber$findLayerIndex :function* _trc_Screen_f_findLayerIndex(_thread,i) {
        var _this=this;
        var j;
        
        if (typeof  i=="number") {
          if (_this.layers[i]) {
            return i;
          }
          
        } else {
          if (Tonyu.is(i,Tonyu.classes.kernel.ScreenLayer)) {
            i=i.group;
            
          }
          for (j = 0;
           j<_this.layers.length ; j++) {
            {
              if (_this.layers[j].group===i||_this.layers[j].name===i) {
                return j;
                
              }
            }
          }
          
        }
        return - 1;
        
      },
      findLayer :function _trc_Screen_findLayer(key) {
        var _this=this;
        var idx;
        
        idx = _this.findLayerIndex(key);
        
        if (idx>=0) {
          return _this.layers[idx];
        }
        return null;
      },
      fiber$findLayer :function* _trc_Screen_f_findLayer(_thread,key) {
        var _this=this;
        var idx;
        
        idx=yield* _this.fiber$findLayerIndex(_thread, key);
        
        if (idx>=0) {
          return _this.layers[idx];
        }
        return null;
        
      },
      setPivot :function _trc_Screen_setPivot(x,y) {
        var _this=this;
        
        if (! _this.layers[_this.index]) {
          throw _this.newError("layerIsNotSet",_this.index);
          
        }
        _this.layers[_this.index].spx=x;
        _this.layers[_this.index].spy=y;
      },
      fiber$setPivot :function* _trc_Screen_f_setPivot(_thread,x,y) {
        var _this=this;
        
        if (! _this.layers[_this.index]) {
          throw _this.newError("layerIsNotSet",_this.index);
          
        }
        _this.layers[_this.index].spx=x;
        _this.layers[_this.index].spy=y;
        
      },
      scrollTo :function _trc_Screen_scrollTo(x,y,scl,rot) {
        var _this=this;
        
        _this.layers[_this.index].wpx=x;
        _this.layers[_this.index].wpy=y;
        if (typeof  scl=="number") {
          _this.layers[_this.index].scale=scl;
        }
        if (typeof  rot=="number") {
          _this.layers[_this.index].rotation=rot;
        }
      },
      fiber$scrollTo :function* _trc_Screen_f_scrollTo(_thread,x,y,scl,rot) {
        var _this=this;
        
        _this.layers[_this.index].wpx=x;
        _this.layers[_this.index].wpy=y;
        if (typeof  scl=="number") {
          _this.layers[_this.index].scale=scl;
        }
        if (typeof  rot=="number") {
          _this.layers[_this.index].rotation=rot;
        }
        
      },
      scrollBy :function _trc_Screen_scrollBy(dx,dy) {
        var _this=this;
        
        _this.layers[_this.index].wpx+=dx;
        _this.layers[_this.index].wpy+=dy;
      },
      fiber$scrollBy :function* _trc_Screen_f_scrollBy(_thread,dx,dy) {
        var _this=this;
        
        _this.layers[_this.index].wpx+=dx;
        _this.layers[_this.index].wpy+=dy;
        
      },
      canvas2buf :function _trc_Screen_canvas2buf(p) {
        var _this=this;
        
        p.layer=_this.layer;
        return _this.convert(p,_this);
      },
      fiber$canvas2buf :function* _trc_Screen_f_canvas2buf(_thread,p) {
        var _this=this;
        
        p.layer=_this.layer;
        return yield* _this.fiber$convert(_thread, p, _this);
        
        
      },
      convert :function _trc_Screen_convert(obj,fromLayer,toLayer) {
        var _this=this;
        
        if (toLayer==null) {
          toLayer=fromLayer;
          fromLayer=obj.layer;
          
        }
        if (toLayer==null) {
          toLayer=_this;
        }
        if (fromLayer==null) {
          fromLayer=_this;
        }
        if (Tonyu.is(fromLayer,Tonyu.classes.kernel.ScreenLayer)) {
          fromLayer=fromLayer.group;
        }
        if (Tonyu.is(toLayer,Tonyu.classes.kernel.ScreenLayer)) {
          toLayer=toLayer.group;
        }
        if (fromLayer===toLayer) {
          return obj;
        }
        let scr;
        if (fromLayer===_this) {
          scr=obj;
          
        } else {
          if (fromLayer===_this.layer) {
            scr=__superClass.prototype.convert.apply( _this, [obj,_this.layer,_this]);
            
          } else {
            let myfl = _this.findLayer(fromLayer);
            
            if (myfl) {
              scr=myfl.world2screen(obj);
            } else {
              throw _this.newError("screenConvertFailed",fromLayer,toLayer);
              
              
            }
            
          }
        }
        if (toLayer===_this) {
          return scr;
          
        } else {
          if (toLayer===_this.layer) {
            return __superClass.prototype.convert.apply( _this, [scr,_this,_this.layer]);
            
          } else {
            let mytl = _this.findLayer(toLayer);
            
            if (mytl) {
              return mytl.screen2world(scr);
            } else {
              throw _this.newError("screenConvertFailed",fromLayer,toLayer);
              
              
            }
            
          }
        }
      },
      fiber$convert :function* _trc_Screen_f_convert(_thread,obj,fromLayer,toLayer) {
        var _this=this;
        
        if (toLayer==null) {
          toLayer=fromLayer;
          fromLayer=obj.layer;
          
        }
        if (toLayer==null) {
          toLayer=_this;
        }
        if (fromLayer==null) {
          fromLayer=_this;
        }
        if (Tonyu.is(fromLayer,Tonyu.classes.kernel.ScreenLayer)) {
          fromLayer=fromLayer.group;
        }
        if (Tonyu.is(toLayer,Tonyu.classes.kernel.ScreenLayer)) {
          toLayer=toLayer.group;
        }
        if (fromLayer===toLayer) {
          return obj;
        }
        let scr;
        if (fromLayer===_this) {
          scr=obj;
          
        } else {
          if (fromLayer===_this.layer) {
            scr=(yield* __superClass.prototype.fiber$convert.apply( _this, [_thread, obj, _this.layer, _this]));
            
          } else {
            let myfl=yield* _this.fiber$findLayer(_thread, fromLayer);
            
            if (myfl) {
              scr=myfl.world2screen(obj);
            } else {
              throw _this.newError("screenConvertFailed",fromLayer,toLayer);
              
              
            }
            
          }
        }
        if (toLayer===_this) {
          return scr;
          
        } else {
          if (toLayer===_this.layer) {
            return __superClass.prototype.convert.apply( _this, [scr,_this,_this.layer]);
            
          } else {
            let mytl=yield* _this.fiber$findLayer(_thread, toLayer);
            
            if (mytl) {
              return mytl.screen2world(scr);
            } else {
              throw _this.newError("screenConvertFailed",fromLayer,toLayer);
              
              
            }
            
          }
        }
        
      },
      setBGColor :function _trc_Screen_setBGColor(color) {
        var _this=this;
        
        _this._color=color;
      },
      fiber$setBGColor :function* _trc_Screen_f_setBGColor(_thread,color) {
        var _this=this;
        
        _this._color=color;
        
      },
      all :function _trc_Screen_all() {
        var _this=this;
        var res;
        var l;
        var q;
        
        res = new Tonyu.classes.kernel.TQuery({screen: _this});
        
        for ([l] of Tonyu.iterator2(_this.layers,1)) {
          q = l.group.all.apply(l.group,arguments);
          
          res.push(q);
          
        }
        return res;
      },
      saveAndClear :function _trc_Screen_saveAndClear(excludes) {
        var _this=this;
        var res;
        var l;
        
        res = [];
        
        excludes=excludes||Tonyu.globals.$excludeFromAll.toArray();
        for ([l] of Tonyu.iterator2(_this.layers,1)) {
          res.push(l.group.saveAndClear(excludes));
          
        }
        return {layers: res,multiLayerTouches: _this.multiLayerTouches&&_this.multiLayerTouches.saveAndClear()};
      },
      fiber$saveAndClear :function* _trc_Screen_f_saveAndClear(_thread,excludes) {
        var _this=this;
        var res;
        var l;
        
        res = [];
        
        excludes=excludes||Tonyu.globals.$excludeFromAll.toArray();
        for ([l] of Tonyu.iterator2(_this.layers,1)) {
          res.push(l.group.saveAndClear(excludes));
          
        }
        return {layers: res,multiLayerTouches: _this.multiLayerTouches&&_this.multiLayerTouches.saveAndClear()};
        
      },
      restore :function _trc_Screen_restore(saved) {
        var _this=this;
        var i;
        var l;
        
        i = 0;
        
        for ([l] of Tonyu.iterator2(_this.layers,1)) {
          l.group.restore(saved.layers[i]);
          i++;
          
        }
        if (_this.multiLayerTouches&&saved.multiLayerTouches) {
          _this.multiLayerTouches.restore(saved.multiLayerTouches);
          
        }
      },
      fiber$restore :function* _trc_Screen_f_restore(_thread,saved) {
        var _this=this;
        var i;
        var l;
        
        i = 0;
        
        for ([l] of Tonyu.iterator2(_this.layers,1)) {
          l.group.restore(saved.layers[i]);
          i++;
          
        }
        if (_this.multiLayerTouches&&saved.multiLayerTouches) {
          _this.multiLayerTouches.restore(saved.multiLayerTouches);
          
        }
        
      },
      touchedFingers :function _trc_Screen_touchedFingers(q,options) {
        var _this=this;
        var res;
        var e;
        var r;
        var i;
        var t;
        var p;
        
        res = [];
        
        options=options||{};
        for ([e] of Tonyu.iterator2(q,1)) {
          r = e.getCrashRect();
          
          for (i = 0;
           i<Tonyu.globals.$touches.length ; i++) {
            {
              t = Tonyu.globals.$touches[i];
              
              if (t.touched==1) {
                p = _this.convert(t,e.layer);
                
                if (p.x>=r.x-r.width/2&&p.x<=r.x+r.width/2&&p.y>=r.y-r.height/2&&p.y<=r.y+r.height/2) {
                  t.captured=e;
                  res.push(t);
                  
                }
                
              }
            }
          }
          
        }
        return res;
      },
      fiber$touchedFingers :function* _trc_Screen_f_touchedFingers(_thread,q,options) {
        var _this=this;
        var res;
        var e;
        var r;
        var i;
        var t;
        var p;
        
        res = [];
        
        options=options||{};
        for ([e] of Tonyu.iterator2(q,1)) {
          r = e.getCrashRect();
          
          for (i = 0;
           i<Tonyu.globals.$touches.length ; i++) {
            {
              t = Tonyu.globals.$touches[i];
              
              if (t.touched==1) {
                p=yield* _this.fiber$convert(_thread, t, e.layer);
                
                if (p.x>=r.x-r.width/2&&p.x<=r.x+r.width/2&&p.y>=r.y-r.height/2&&p.y<=r.y+r.height/2) {
                  t.captured=e;
                  res.push(t);
                  
                }
                
              }
            }
          }
          
        }
        return res;
        
      },
      getMultiLayerTouches :function _trc_Screen_getMultiLayerTouches() {
        var _this=this;
        
        if (_this.multiLayerTouches) {
          return _this.multiLayerTouches;
        }
        _this.multiLayerTouches=new Tonyu.classes.kernel.MultiLayerTouches({screen: _this});
        _this.on("touch",(function anonymous_6611(e) {
          
          let a = _this.multiLayerTouches.findActor(e.shape);
          
          let f = e.finger;
          
          if (a) {
            f.layer=_this;
            e.actor=a;
            let nlp = f.layerPath.withNeighborTarget(a.layer);
            
            if (! (Tonyu.is(nlp,Tonyu.classes.kernel.LayerPath))) {
              throw _this.newError("cannotGetNeighborTarget",f,a.layer);
              
              
            }
            f.layerPath=nlp;
            a.fireEvent("touch",e);
            
          } else {
            _this.fireEvent("touchBG",e);
            
          }
        }));
        return _this.multiLayerTouches;
      },
      fiber$getMultiLayerTouches :function* _trc_Screen_f_getMultiLayerTouches(_thread) {
        var _this=this;
        
        if (_this.multiLayerTouches) {
          return _this.multiLayerTouches;
        }
        _this.multiLayerTouches=new Tonyu.classes.kernel.MultiLayerTouches({screen: _this});
        _this.on("touch",(function anonymous_6611(e) {
          
          let a = _this.multiLayerTouches.findActor(e.shape);
          
          let f = e.finger;
          
          if (a) {
            f.layer=_this;
            e.actor=a;
            let nlp = f.layerPath.withNeighborTarget(a.layer);
            
            if (! (Tonyu.is(nlp,Tonyu.classes.kernel.LayerPath))) {
              throw _this.newError("cannotGetNeighborTarget",f,a.layer);
              
              
            }
            f.layerPath=nlp;
            a.fireEvent("touch",e);
            
          } else {
            _this.fireEvent("touchBG",e);
            
          }
        }));
        return _this.multiLayerTouches;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"drawLayers":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"addLayer":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setDefaultLayer":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"removeLayer":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"selectLayer":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"findLayerIndex":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"findLayer":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setPivot":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"scrollTo":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"scrollBy":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"canvas2buf":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"convert":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"setBGColor":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"all":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"saveAndClear":{"nowait":false,"isMain":false,"vtype":{"params":["Array"],"returnValue":null}},"restore":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"touchedFingers":{"nowait":false,"isMain":false,"vtype":{"params":["kernel.TQuery",null],"returnValue":null}},"getMultiLayerTouches":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"layers":{"vtype":{"element":"kernel.Layer2D"}},"_color":{},"camera":{},"_drawing":{"vtype":"Boolean"},"clearBG":{"vtype":"Boolean"},"index":{"vtype":"Number"},"multiLayerTouches":{"vtype":"kernel.MultiLayerTouches"}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TD_Z',
  shortName: 'TD_Z',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_TD_Z_main() {
        var _this=this;
        
        
        _this.updateEx();
      },
      fiber$main :function* _trc_TD_Z_f_main(_thread) {
        var _this=this;
        
        
        (yield* _this.fiber$updateEx(_thread));
        
      },
      initialize :function _trc_TD_Z_initialize() {
        var _this=this;
        
        _this.p=- 1;
        __superClass.apply( _this, []);
        Tonyu.globals.$TD_M_A3D=[];
        Tonyu.globals.$TD_M_ACM=[];
        Tonyu.globals.$TD_M_APL=[];
      },
      STARTING :function _trc_TD_Z_STARTING() {
        var _this=this;
        var t;
        
        
        Tonyu.globals.$TD_SC_B=10;
        Tonyu.globals.$TD_Z_hamidasiSyusei=1;
        Tonyu.globals.$TD_M_tenmetuKeigen=1;
        Tonyu.globals.$TD_M_multiGamen=1;
        Tonyu.globals.$TD_M_oyaObjMax=99999999;
        Tonyu.globals.$TD_M_koObjMax=99999999;
        Tonyu.globals.$TD_M_syoriMax=99999999;
        if (! (Tonyu.globals.$sinA instanceof Array)||! (Tonyu.globals.$cosA instanceof Array)||Tonyu.globals.$TD_SC_B!=Tonyu.globals.$TD_SC_B_k) {
          Tonyu.globals.$TD_SC_B_k=Tonyu.globals.$TD_SC_B;
          
        }
        Tonyu.globals.$TD_Z_x=0;
        Tonyu.globals.$TD_Z_y=0;
        Tonyu.globals.$TD_Z_z=0;
        Tonyu.globals.$TD_Z_xz=0;
        Tonyu.globals.$TD_Z_yz=0;
        Tonyu.globals.$TD_Z_xy=0;
        Tonyu.globals.$TD_Z_gk=0;
        Tonyu.globals.$TD_Z_k=Tonyu.globals.$screenWidth+Tonyu.globals.$TD_Z_gk;
        Tonyu.globals.$TD_Z_k_max=10;
        Tonyu.globals.$TD_G_GL=50;
        Tonyu.globals.$TD_G_GU=50;
        Tonyu.globals.$TD_G_GR=Tonyu.globals.$screenWidth-51;
        Tonyu.globals.$TD_G_GD=Tonyu.globals.$screenHeight-51;
        Tonyu.globals.$TD_K_k=Tonyu.globals.$TD_Z_k/Tonyu.globals.$TD_Z_k_max;
        Tonyu.globals.$TD_K_hw=Tonyu.globals.$screenWidth/2;
        Tonyu.globals.$TD_K_hh=Tonyu.globals.$screenHeight/2;
        Tonyu.globals.$TD_K_xzsin=0;
        Tonyu.globals.$TD_K_xzcos=0;
        Tonyu.globals.$TD_K_yzsin=0;
        Tonyu.globals.$TD_K_yzcos=0;
        Tonyu.globals.$TD_K_xysin=0;
        Tonyu.globals.$TD_K_xycos=0;
        Tonyu.globals.$TD_K_F=0;
        Tonyu.globals.$TD_FPS_fps=0;
        Tonyu.globals.$TD_FPS_fps2=0;
        Tonyu.globals.$TD_FPS_v=0;
        Tonyu.globals.$TD_FPS_dv=0;
        Tonyu.globals.$TD_FPS_gt=0;
        Tonyu.globals.$TD_FPS_dv2=0;
        Tonyu.globals.$TD_FPS_gt2=0;
        Tonyu.globals.$TD_FPS_fps3=0;
        Tonyu.globals.$TD_PS=new Tonyu.classes.kernel.TD_PS();
        Tonyu.globals.$TD_M_A3D_I=0;
        Tonyu.globals.$TD_M_A3D_S=0;
        Tonyu.globals.$TD_M_ACM_I=0;
        Tonyu.globals.$TD_M_ACM_S=0;
        Tonyu.globals.$TD_M_AP_I=0;
        Tonyu.globals.$TD_M_AP_S=0;
        Tonyu.globals.$TD_M_ADR_I=0;
        Tonyu.globals.$TD_M_ADR_S=0;
        Tonyu.globals.$TD_M_M=0;
        Tonyu.globals.$TD_M_O=null;
        Tonyu.globals.$TD_M_CM=null;
        Tonyu.globals.$TD_M_PL=null;
        Tonyu.globals.$TD_M_EOF=0;
      },
      fiber$STARTING :function* _trc_TD_Z_f_STARTING(_thread) {
        var _this=this;
        var t;
        
        
        Tonyu.globals.$TD_SC_B=10;
        Tonyu.globals.$TD_Z_hamidasiSyusei=1;
        Tonyu.globals.$TD_M_tenmetuKeigen=1;
        Tonyu.globals.$TD_M_multiGamen=1;
        Tonyu.globals.$TD_M_oyaObjMax=99999999;
        Tonyu.globals.$TD_M_koObjMax=99999999;
        Tonyu.globals.$TD_M_syoriMax=99999999;
        if (! (Tonyu.globals.$sinA instanceof Array)||! (Tonyu.globals.$cosA instanceof Array)||Tonyu.globals.$TD_SC_B!=Tonyu.globals.$TD_SC_B_k) {
          Tonyu.globals.$TD_SC_B_k=Tonyu.globals.$TD_SC_B;
          
        }
        Tonyu.globals.$TD_Z_x=0;
        Tonyu.globals.$TD_Z_y=0;
        Tonyu.globals.$TD_Z_z=0;
        Tonyu.globals.$TD_Z_xz=0;
        Tonyu.globals.$TD_Z_yz=0;
        Tonyu.globals.$TD_Z_xy=0;
        Tonyu.globals.$TD_Z_gk=0;
        Tonyu.globals.$TD_Z_k=Tonyu.globals.$screenWidth+Tonyu.globals.$TD_Z_gk;
        Tonyu.globals.$TD_Z_k_max=10;
        Tonyu.globals.$TD_G_GL=50;
        Tonyu.globals.$TD_G_GU=50;
        Tonyu.globals.$TD_G_GR=Tonyu.globals.$screenWidth-51;
        Tonyu.globals.$TD_G_GD=Tonyu.globals.$screenHeight-51;
        Tonyu.globals.$TD_K_k=Tonyu.globals.$TD_Z_k/Tonyu.globals.$TD_Z_k_max;
        Tonyu.globals.$TD_K_hw=Tonyu.globals.$screenWidth/2;
        Tonyu.globals.$TD_K_hh=Tonyu.globals.$screenHeight/2;
        Tonyu.globals.$TD_K_xzsin=0;
        Tonyu.globals.$TD_K_xzcos=0;
        Tonyu.globals.$TD_K_yzsin=0;
        Tonyu.globals.$TD_K_yzcos=0;
        Tonyu.globals.$TD_K_xysin=0;
        Tonyu.globals.$TD_K_xycos=0;
        Tonyu.globals.$TD_K_F=0;
        Tonyu.globals.$TD_FPS_fps=0;
        Tonyu.globals.$TD_FPS_fps2=0;
        Tonyu.globals.$TD_FPS_v=0;
        Tonyu.globals.$TD_FPS_dv=0;
        Tonyu.globals.$TD_FPS_gt=0;
        Tonyu.globals.$TD_FPS_dv2=0;
        Tonyu.globals.$TD_FPS_gt2=0;
        Tonyu.globals.$TD_FPS_fps3=0;
        Tonyu.globals.$TD_PS=new Tonyu.classes.kernel.TD_PS();
        Tonyu.globals.$TD_M_A3D_I=0;
        Tonyu.globals.$TD_M_A3D_S=0;
        Tonyu.globals.$TD_M_ACM_I=0;
        Tonyu.globals.$TD_M_ACM_S=0;
        Tonyu.globals.$TD_M_AP_I=0;
        Tonyu.globals.$TD_M_AP_S=0;
        Tonyu.globals.$TD_M_ADR_I=0;
        Tonyu.globals.$TD_M_ADR_S=0;
        Tonyu.globals.$TD_M_M=0;
        Tonyu.globals.$TD_M_O=null;
        Tonyu.globals.$TD_M_CM=null;
        Tonyu.globals.$TD_M_PL=null;
        Tonyu.globals.$TD_M_EOF=0;
        
      },
      RSC :function _trc_TD_Z_RSC() {
        var _this=this;
        
        Tonyu.globals.$TD_K_xzsin=_this.rsin(Tonyu.globals.$TD_Z_xz);
        Tonyu.globals.$TD_K_xzcos=_this.rcos(Tonyu.globals.$TD_Z_xz);
        Tonyu.globals.$TD_K_yzsin=_this.rsin(Tonyu.globals.$TD_Z_yz);
        Tonyu.globals.$TD_K_yzcos=_this.rcos(Tonyu.globals.$TD_Z_yz);
        Tonyu.globals.$TD_K_xysin=_this.rsin(Tonyu.globals.$TD_Z_xy);
        Tonyu.globals.$TD_K_xycos=_this.rcos(Tonyu.globals.$TD_Z_xy);
      },
      fiber$RSC :function* _trc_TD_Z_f_RSC(_thread) {
        var _this=this;
        
        Tonyu.globals.$TD_K_xzsin=(yield* _this.fiber$rsin(_thread, Tonyu.globals.$TD_Z_xz));
        Tonyu.globals.$TD_K_xzcos=(yield* _this.fiber$rcos(_thread, Tonyu.globals.$TD_Z_xz));
        Tonyu.globals.$TD_K_yzsin=(yield* _this.fiber$rsin(_thread, Tonyu.globals.$TD_Z_yz));
        Tonyu.globals.$TD_K_yzcos=(yield* _this.fiber$rcos(_thread, Tonyu.globals.$TD_Z_yz));
        Tonyu.globals.$TD_K_xysin=(yield* _this.fiber$rsin(_thread, Tonyu.globals.$TD_Z_xy));
        Tonyu.globals.$TD_K_xycos=(yield* _this.fiber$rcos(_thread, Tonyu.globals.$TD_Z_xy));
        
      },
      GKK :function _trc_TD_Z_GKK(zGL,zGU,zGR,zGD) {
        var _this=this;
        var ww;
        var hh;
        var GL;
        var GU;
        var GR;
        var GD;
        
        
        if (zGL==null) {
          GL=Tonyu.globals.$TD_G_GL;
        } else {
          GL=zGL;
        }
        if (zGU==null) {
          GU=Tonyu.globals.$TD_G_GU;
        } else {
          GU=zGU;
        }
        if (zGR==null) {
          GR=Tonyu.globals.$TD_G_GR;
        } else {
          GR=zGR;
        }
        if (zGD==null) {
          GD=Tonyu.globals.$TD_G_GD;
        } else {
          GD=zGD;
        }
        ww=GR-GL;
        hh=GD-GU;
        Tonyu.globals.$TD_K_hw=GL+ww/2;
        Tonyu.globals.$TD_K_hh=GU+hh/2;
        if (ww<=hh) {
          Tonyu.globals.$TD_Z_k=ww+Tonyu.globals.$TD_Z_gk;
        } else {
          Tonyu.globals.$TD_Z_k=hh+Tonyu.globals.$TD_Z_gk;
        }
        Tonyu.globals.$TD_K_k=Tonyu.globals.$TD_Z_k/Tonyu.globals.$TD_Z_k_max;
      },
      fiber$GKK :function* _trc_TD_Z_f_GKK(_thread,zGL,zGU,zGR,zGD) {
        var _this=this;
        var ww;
        var hh;
        var GL;
        var GU;
        var GR;
        var GD;
        
        
        if (zGL==null) {
          GL=Tonyu.globals.$TD_G_GL;
        } else {
          GL=zGL;
        }
        if (zGU==null) {
          GU=Tonyu.globals.$TD_G_GU;
        } else {
          GU=zGU;
        }
        if (zGR==null) {
          GR=Tonyu.globals.$TD_G_GR;
        } else {
          GR=zGR;
        }
        if (zGD==null) {
          GD=Tonyu.globals.$TD_G_GD;
        } else {
          GD=zGD;
        }
        ww=GR-GL;
        hh=GD-GU;
        Tonyu.globals.$TD_K_hw=GL+ww/2;
        Tonyu.globals.$TD_K_hh=GU+hh/2;
        if (ww<=hh) {
          Tonyu.globals.$TD_Z_k=ww+Tonyu.globals.$TD_Z_gk;
        } else {
          Tonyu.globals.$TD_Z_k=hh+Tonyu.globals.$TD_Z_gk;
        }
        Tonyu.globals.$TD_K_k=Tonyu.globals.$TD_Z_k/Tonyu.globals.$TD_Z_k_max;
        
      },
      FPS :function _trc_TD_Z_FPS(visible,x1,y1,x2,y2) {
        var _this=this;
        var col;
        
        
        if (performance.now()-Tonyu.globals.$TD_FPS_gt>=1000) {
          Tonyu.globals.$TD_FPS_fps=Tonyu.globals.$TD_FPS_dv;
          Tonyu.globals.$TD_FPS_fps2=Tonyu.globals.$TD_FPS_v;
          Tonyu.globals.$TD_FPS_gt=performance.now();
          Tonyu.globals.$TD_FPS_v=0;
          Tonyu.globals.$TD_FPS_dv=0;
          
        }
        Tonyu.globals.$TD_FPS_v++;
        Tonyu.globals.$TD_FPS_dv+=Tonyu.globals.$_doDraw?1:0;
        if (performance.now()-Tonyu.globals.$TD_FPS_gt2>=100) {
          Tonyu.globals.$TD_FPS_fps3=Tonyu.globals.$TD_FPS_dv2;
          Tonyu.globals.$TD_FPS_gt2=performance.now();
          Tonyu.globals.$TD_FPS_dv2=0;
          
        }
        Tonyu.globals.$TD_FPS_dv2+=Tonyu.globals.$_doDraw?1:0;
        if (visible) {
          if (x1==null) {
            x1=Tonyu.globals.$screenWidth-70;
          }
          if (y1==null) {
            y1=Tonyu.globals.$screenWidth-40;
          }
          if (x2==null) {
            x2=Tonyu.globals.$screenWidth-70;
          }
          if (y2==null) {
            y2=Tonyu.globals.$screenWidth-20;
          }
          _this.drawText(x1,y1,"FPS:"+Tonyu.globals.$TD_FPS_fps,_this.colorHSL(140-(Tonyu.globals.$TD_FPS_fps-1)*140/59,240,120),16,- 1);
          _this.drawText(x2,y2,"RPS:"+Tonyu.globals.$TD_FPS_fps2,_this.colorHSL(140-(Tonyu.globals.$TD_FPS_fps2-1)*140/59,240,120),16,- 1);
          
        }
      },
      fiber$FPS :function* _trc_TD_Z_f_FPS(_thread,visible,x1,y1,x2,y2) {
        var _this=this;
        var col;
        
        
        if (performance.now()-Tonyu.globals.$TD_FPS_gt>=1000) {
          Tonyu.globals.$TD_FPS_fps=Tonyu.globals.$TD_FPS_dv;
          Tonyu.globals.$TD_FPS_fps2=Tonyu.globals.$TD_FPS_v;
          Tonyu.globals.$TD_FPS_gt=performance.now();
          Tonyu.globals.$TD_FPS_v=0;
          Tonyu.globals.$TD_FPS_dv=0;
          
        }
        Tonyu.globals.$TD_FPS_v++;
        Tonyu.globals.$TD_FPS_dv+=Tonyu.globals.$_doDraw?1:0;
        if (performance.now()-Tonyu.globals.$TD_FPS_gt2>=100) {
          Tonyu.globals.$TD_FPS_fps3=Tonyu.globals.$TD_FPS_dv2;
          Tonyu.globals.$TD_FPS_gt2=performance.now();
          Tonyu.globals.$TD_FPS_dv2=0;
          
        }
        Tonyu.globals.$TD_FPS_dv2+=Tonyu.globals.$_doDraw?1:0;
        if (visible) {
          if (x1==null) {
            x1=Tonyu.globals.$screenWidth-70;
          }
          if (y1==null) {
            y1=Tonyu.globals.$screenWidth-40;
          }
          if (x2==null) {
            x2=Tonyu.globals.$screenWidth-70;
          }
          if (y2==null) {
            y2=Tonyu.globals.$screenWidth-20;
          }
          _this.drawText(x1,y1,"FPS:"+Tonyu.globals.$TD_FPS_fps,_this.colorHSL(140-(Tonyu.globals.$TD_FPS_fps-1)*140/59,240,120),16,- 1);
          _this.drawText(x2,y2,"RPS:"+Tonyu.globals.$TD_FPS_fps2,_this.colorHSL(140-(Tonyu.globals.$TD_FPS_fps2-1)*140/59,240,120),16,- 1);
          
        }
        
      },
      draw :function _trc_TD_Z_draw(ctx) {
        var _this=this;
        
      },
      draw3D :function _trc_TD_Z_draw3D() {
        var _this=this;
        var o;
        var ps;
        var i;
        
        
        if (Tonyu.globals.$TD_M_tenmetuKeigen!=1) {
          return _this;
        }
        if (! Tonyu.globals.$_doDraw) {
          return _this;
        }
        Tonyu.globals.$TD_M_M=0;
        Tonyu.globals.$TD_M_EOF=0;
        Tonyu.globals.$TD_M_A3D_I=0;
        Tonyu.globals.$TD_M_ACM_I=0;
        Tonyu.globals.$TD_M_AP_I=0;
        Tonyu.globals.$TD_M_ADR_I=0;
        Tonyu.globals.$TD_M_APL_I=0;
        Tonyu.globals.$TD_M_A3D_S=Tonyu.globals.$TD_M_A3D.length;
        Tonyu.globals.$TD_M_ACM_S=Tonyu.globals.$TD_M_ACM.length;
        if (Tonyu.globals.$TD_M_A3D_S<=0) {
          return _this;
        }
        Tonyu.globals.$TD_PS.run();
      },
      fiber$draw3D :function* _trc_TD_Z_f_draw3D(_thread) {
        var _this=this;
        var o;
        var ps;
        var i;
        
        
        if (Tonyu.globals.$TD_M_tenmetuKeigen!=1) {
          return _this;
        }
        if (! Tonyu.globals.$_doDraw) {
          return _this;
        }
        Tonyu.globals.$TD_M_M=0;
        Tonyu.globals.$TD_M_EOF=0;
        Tonyu.globals.$TD_M_A3D_I=0;
        Tonyu.globals.$TD_M_ACM_I=0;
        Tonyu.globals.$TD_M_AP_I=0;
        Tonyu.globals.$TD_M_ADR_I=0;
        Tonyu.globals.$TD_M_APL_I=0;
        Tonyu.globals.$TD_M_A3D_S=Tonyu.globals.$TD_M_A3D.length;
        Tonyu.globals.$TD_M_ACM_S=Tonyu.globals.$TD_M_ACM.length;
        if (Tonyu.globals.$TD_M_A3D_S<=0) {
          return _this;
        }
        Tonyu.globals.$TD_PS.run();
        
      },
      set :function _trc_TD_Z_set(b,h) {
        var _this=this;
        var t;
        var i;
        
        
        _this.sindata=[];
        _this.cosdata=[];
        _this.sindata.push(0);
        _this.sindata.push(0.0017453284);
        _this.sindata.push(0.0034906514);
        _this.sindata.push(0.0052359638);
        _this.sindata.push(0.0069812603);
        _this.sindata.push(0.0087265355);
        _this.sindata.push(0.0104717841);
        _this.sindata.push(0.0122170008);
        _this.sindata.push(0.0139621803);
        _this.sindata.push(0.0157073173);
        _this.sindata.push(0);
        _this.sindata.push(0.0001745329);
        _this.sindata.push(0.0003490658);
        _this.sindata.push(0.0005235988);
        _this.sindata.push(0.0006981316);
        _this.sindata.push(0.0008726645);
        _this.sindata.push(0.0010471974);
        _this.sindata.push(0.0012217302);
        _this.sindata.push(0.0013962629);
        _this.sindata.push(0.0015707957);
        _this.sindata.push(0);
        _this.sindata.push(0.0000174533);
        _this.sindata.push(0.0000349066);
        _this.sindata.push(0.0000523599);
        _this.sindata.push(0.0000698132);
        _this.sindata.push(0.0000872665);
        _this.sindata.push(0.0001047198);
        _this.sindata.push(0.000122173);
        _this.sindata.push(0.0001396263);
        _this.sindata.push(0.0001570796);
        _this.cosdata.push(1);
        _this.cosdata.push(0.999998477);
        _this.cosdata.push(0.999993908);
        _this.cosdata.push(0.999986292);
        _this.cosdata.push(0.999975631);
        _this.cosdata.push(0.999961923);
        _this.cosdata.push(0.999945169);
        _this.cosdata.push(0.99992537);
        _this.cosdata.push(0.999902524);
        _this.cosdata.push(0.999876632);
        _this.cosdata.push(1);
        _this.cosdata.push(0.999999985);
        _this.cosdata.push(0.999999939);
        _this.cosdata.push(0.999999863);
        _this.cosdata.push(0.999999756);
        _this.cosdata.push(0.999999619);
        _this.cosdata.push(0.999999452);
        _this.cosdata.push(0.999999254);
        _this.cosdata.push(0.999999025);
        _this.cosdata.push(0.999998766);
        _this.cosdata.push(1);
        _this.cosdata.push(1);
        _this.cosdata.push(0.999999999);
        _this.cosdata.push(0.999999999);
        _this.cosdata.push(0.999999998);
        _this.cosdata.push(0.999999996);
        _this.cosdata.push(0.999999995);
        _this.cosdata.push(0.999999993);
        _this.cosdata.push(0.99999999);
        _this.cosdata.push(0.999999988);
        Tonyu.globals.$sinA=[];
        Tonyu.globals.$cosA=[];
        for (i=0; i<360*b ; i++) {
          {
            Tonyu.globals.$sinA.push(_this.rsin2(i/b));
            Tonyu.globals.$cosA.push(_this.rcos2(i/b));
            if (h&&i%70==0) {
              _this.drawText(0,0,_this.trunc(i*100/(360*b))+"%",Tonyu.globals.$clWhite,50);
            }
          }
        }
      },
      fiber$set :function* _trc_TD_Z_f_set(_thread,b,h) {
        var _this=this;
        var t;
        var i;
        
        
        _this.sindata=[];
        _this.cosdata=[];
        _this.sindata.push(0);
        _this.sindata.push(0.0017453284);
        _this.sindata.push(0.0034906514);
        _this.sindata.push(0.0052359638);
        _this.sindata.push(0.0069812603);
        _this.sindata.push(0.0087265355);
        _this.sindata.push(0.0104717841);
        _this.sindata.push(0.0122170008);
        _this.sindata.push(0.0139621803);
        _this.sindata.push(0.0157073173);
        _this.sindata.push(0);
        _this.sindata.push(0.0001745329);
        _this.sindata.push(0.0003490658);
        _this.sindata.push(0.0005235988);
        _this.sindata.push(0.0006981316);
        _this.sindata.push(0.0008726645);
        _this.sindata.push(0.0010471974);
        _this.sindata.push(0.0012217302);
        _this.sindata.push(0.0013962629);
        _this.sindata.push(0.0015707957);
        _this.sindata.push(0);
        _this.sindata.push(0.0000174533);
        _this.sindata.push(0.0000349066);
        _this.sindata.push(0.0000523599);
        _this.sindata.push(0.0000698132);
        _this.sindata.push(0.0000872665);
        _this.sindata.push(0.0001047198);
        _this.sindata.push(0.000122173);
        _this.sindata.push(0.0001396263);
        _this.sindata.push(0.0001570796);
        _this.cosdata.push(1);
        _this.cosdata.push(0.999998477);
        _this.cosdata.push(0.999993908);
        _this.cosdata.push(0.999986292);
        _this.cosdata.push(0.999975631);
        _this.cosdata.push(0.999961923);
        _this.cosdata.push(0.999945169);
        _this.cosdata.push(0.99992537);
        _this.cosdata.push(0.999902524);
        _this.cosdata.push(0.999876632);
        _this.cosdata.push(1);
        _this.cosdata.push(0.999999985);
        _this.cosdata.push(0.999999939);
        _this.cosdata.push(0.999999863);
        _this.cosdata.push(0.999999756);
        _this.cosdata.push(0.999999619);
        _this.cosdata.push(0.999999452);
        _this.cosdata.push(0.999999254);
        _this.cosdata.push(0.999999025);
        _this.cosdata.push(0.999998766);
        _this.cosdata.push(1);
        _this.cosdata.push(1);
        _this.cosdata.push(0.999999999);
        _this.cosdata.push(0.999999999);
        _this.cosdata.push(0.999999998);
        _this.cosdata.push(0.999999996);
        _this.cosdata.push(0.999999995);
        _this.cosdata.push(0.999999993);
        _this.cosdata.push(0.99999999);
        _this.cosdata.push(0.999999988);
        Tonyu.globals.$sinA=[];
        Tonyu.globals.$cosA=[];
        for (i=0; i<360*b ; i++) {
          {
            Tonyu.globals.$sinA.push(_this.rsin2(i/b));
            Tonyu.globals.$cosA.push(_this.rcos2(i/b));
            if (h&&i%70==0) {
              _this.drawText(0,0,_this.trunc(i*100/(360*b))+"%",Tonyu.globals.$clWhite,50);
            }
          }
        }
        
      },
      rsin :function _trc_TD_Z_rsin(a) {
        var _this=this;
        
        return _this.sin(a);
      },
      fiber$rsin :function* _trc_TD_Z_f_rsin(_thread,a) {
        var _this=this;
        
        return _this.sin(a);
        
      },
      rcos :function _trc_TD_Z_rcos(a) {
        var _this=this;
        
        return _this.cos(a);
      },
      fiber$rcos :function* _trc_TD_Z_f_rcos(_thread,a) {
        var _this=this;
        
        return _this.cos(a);
        
      },
      rsin2 :function _trc_TD_Z_rsin2(theta,lev) {
        var _this=this;
        var value;
        var i;
        var alpha;
        var beta;
        var level;
        
        
        alpha=_this.floor(theta);
        beta=theta-alpha;
        if (lev==null) {
          value=_this.sin(alpha)*_this.rcos2(10*beta,1)+_this.cos(alpha)*_this.rsin2(10*beta,1);
          
        } else {
          level=lev;
          if (level<3) {
            value=_this.sindata[alpha+level*10-10]*_this.rcos2(10*beta,level+1)+_this.cosdata[alpha+level*10-10]*_this.rsin2(10*beta,level+1);
            
          } else {
            value=_this.sindata[alpha+level*10-10];
            
          }
          
        }
        return value;
      },
      fiber$rsin2 :function* _trc_TD_Z_f_rsin2(_thread,theta,lev) {
        var _this=this;
        var value;
        var i;
        var alpha;
        var beta;
        var level;
        
        
        alpha=_this.floor(theta);
        beta=theta-alpha;
        if (lev==null) {
          value=_this.sin(alpha)*_this.rcos2(10*beta,1)+_this.cos(alpha)*_this.rsin2(10*beta,1);
          
        } else {
          level=lev;
          if (level<3) {
            value=_this.sindata[alpha+level*10-10]*_this.rcos2(10*beta,level+1)+_this.cosdata[alpha+level*10-10]*_this.rsin2(10*beta,level+1);
            
          } else {
            value=_this.sindata[alpha+level*10-10];
            
          }
          
        }
        return value;
        
      },
      rcos2 :function _trc_TD_Z_rcos2(theta,lev) {
        var _this=this;
        var value;
        var i;
        var alpha;
        var beta;
        var level;
        
        
        alpha=_this.floor(theta);
        beta=theta-alpha;
        if (lev==null) {
          value=_this.cos(alpha)*_this.rcos2(10*beta,1)-_this.sin(alpha)*_this.rsin2(10*beta,1);
          
        } else {
          level=lev;
          if (level<3) {
            value=_this.cosdata[alpha+level*10-10]*_this.rcos2(10*beta,level+1)-_this.sindata.get(alpha+level*10-10)*_this.rsin2(10*beta,level+1);
            
          } else {
            value=_this.cosdata[alpha+level*10-10];
            
          }
          
        }
        return value;
      },
      fiber$rcos2 :function* _trc_TD_Z_f_rcos2(_thread,theta,lev) {
        var _this=this;
        var value;
        var i;
        var alpha;
        var beta;
        var level;
        
        
        alpha=_this.floor(theta);
        beta=theta-alpha;
        if (lev==null) {
          value=_this.cos(alpha)*_this.rcos2(10*beta,1)-_this.sin(alpha)*_this.rsin2(10*beta,1);
          
        } else {
          level=lev;
          if (level<3) {
            value=_this.cosdata[alpha+level*10-10]*_this.rcos2(10*beta,level+1)-_this.sindata.get(alpha+level*10-10)*_this.rsin2(10*beta,level+1);
            
          } else {
            value=_this.cosdata[alpha+level*10-10];
            
          }
          
        }
        return value;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"STARTING":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"RSC":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"GKK":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"FPS":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"draw3D":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"set":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"rsin":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"rcos":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"rsin2":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"rcos2":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"sindata":{},"cosdata":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.KernelDemo',
  shortName: 'KernelDemo',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_KernelDemo_main() {
        var _this=this;
        
        Error.stackTraceLimit=50;
        for (let [k, v] of Tonyu.iterator2(Tonyu.globals,2)) {
          if (v&&typeof  v==="object"&&! v.name) {
            v.name=k;
            
          }
          
        }
        _this.s=new Tonyu.classes.kernel.Screen({x: 200,y: 200,width: 200,height: 200});
        _this.s.setBGColor("#0aa");
        _this.l=_this.s.addLayer();
        _this.print(_this.l);
        for (let i = 0;
         i<5 ; i++) {
          {
            let a = new Tonyu.classes.kernel.Actor({x: 2+i*30,y: 50,layer: _this.l,radius: 4+i*3,fillStyle: "white"});
            
            a.enableDrag({clone: {alpha: 128,layer: Tonyu.globals.$mainLayer},end: (function anonymous_544(e) {
              
              let dup = e.actor;
              
              dup.alpha=255;
              if (dup.crashTo(_this.s)) {
                dup.die();
              }
              dup.enableDrag({valid: (function anonymous_709(e) {
                
                return ! dup.screenOut()&&! dup.crashTo(_this.s);
              }),move: (function anonymous_823(e) {
                
                dup.x=_this.round(dup.x,32,16);
                dup.y=_this.round(dup.y,32,16);
                if (dup.crashTo(_this.s)) {
                  e.cancel();
                  
                }
              }),relative: 0});
            })});
          }
        }
        _this.s.on("touchBG",(function anonymous_1967(e) {
          
          let f = e.finger;
          
          let sx = f.x;
          let sy = f.y;
          
          f.on("move",(function anonymous_2037() {
            
            f.update();
            _this.s.scrollBy(- f.vx,- f.vy);
          }));
        }));
      },
      fiber$main :function* _trc_KernelDemo_f_main(_thread) {
        var _this=this;
        
        Error.stackTraceLimit=50;
        for (let [k, v] of Tonyu.iterator2(Tonyu.globals,2)) {
          if (v&&typeof  v==="object"&&! v.name) {
            v.name=k;
            
          }
          
        }
        _this.s=new Tonyu.classes.kernel.Screen({x: 200,y: 200,width: 200,height: 200});
        _this.s.setBGColor("#0aa");
        _this.l=_this.s.addLayer();
        _this.print(_this.l);
        for (let i = 0;
         i<5 ; i++) {
          {
            let a = new Tonyu.classes.kernel.Actor({x: 2+i*30,y: 50,layer: _this.l,radius: 4+i*3,fillStyle: "white"});
            
            a.enableDrag({clone: {alpha: 128,layer: Tonyu.globals.$mainLayer},end: (function anonymous_544(e) {
              
              let dup = e.actor;
              
              dup.alpha=255;
              if (dup.crashTo(_this.s)) {
                dup.die();
              }
              dup.enableDrag({valid: (function anonymous_709(e) {
                
                return ! dup.screenOut()&&! dup.crashTo(_this.s);
              }),move: (function anonymous_823(e) {
                
                dup.x=_this.round(dup.x,32,16);
                dup.y=_this.round(dup.y,32,16);
                if (dup.crashTo(_this.s)) {
                  e.cancel();
                  
                }
              }),relative: 0});
            })});
          }
        }
        _this.s.on("touchBG",(function anonymous_1967(e) {
          
          let f = e.finger;
          
          let sx = f.x;
          let sy = f.y;
          
          f.on("move",(function anonymous_2037() {
            
            f.update();
            _this.s.scrollBy(- f.vx,- f.vy);
          }));
        }));
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}}},"fields":{"s":{},"l":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.BodyActor',
  shortName: 'BodyActor',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [Tonyu.classes.kernel.T2Mod],
  methods: function (__superClass) {
    return {
      main :function _trc_BodyActor_main() {
        var _this=this;
        
        "field strict";
        
        
        
        
        
      },
      fiber$main :function* _trc_BodyActor_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        
      },
      initialize :function _trc_BodyActor_initialize(p) {
        var _this=this;
        
        if (typeof  Box2D==="undefined") {
          Tonyu.globals.$currentProject.requestPlugin("box2d");
          
        }
        __superClass.apply( _this, [p]);
        _this._th.on("end",Tonyu.bindFunc(_this,_this.initBody));
      },
      getWorld :function _trc_BodyActor_getWorld() {
        var _this=this;
        
        if (Tonyu.is(_this.world,Tonyu.classes.kernel.T2World)) {
          return _this.world;
        }
        if (Tonyu.globals.$t2World) {
          return Tonyu.globals.$t2World;
        }
        Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;
        return Tonyu.globals.$t2World;
      },
      fiber$getWorld :function* _trc_BodyActor_f_getWorld(_thread) {
        var _this=this;
        
        if (Tonyu.is(_this.world,Tonyu.classes.kernel.T2World)) {
          return _this.world;
        }
        if (Tonyu.globals.$t2World) {
          return Tonyu.globals.$t2World;
        }
        Tonyu.globals.$t2World=new Tonyu.classes.kernel.T2World;
        return Tonyu.globals.$t2World;
        
      },
      update :function _trc_BodyActor_update() {
        var _this=this;
        
        _this.initBody();
        __superClass.prototype.update.apply( _this, []);
      },
      fiber$update :function* _trc_BodyActor_f_update(_thread) {
        var _this=this;
        
        (yield* _this.fiber$initBody(_thread));
        (yield* __superClass.prototype.fiber$update.apply( _this, [_thread]));
        
      },
      initBody :function _trc_BodyActor_initBody() {
        var _this=this;
        var wworld;
        var b2Vec2;
        var b2BodyDef;
        var b2Body;
        var b2FixtureDef;
        var b2Fixture;
        var b2PolygonShape;
        var b2CircleShape;
        var fixDef;
        var bodyDef;
        var w;
        var h;
        var t;
        var fps;
        var r;
        var ve;
        var vr;
        
        if (_this.isDead()) {
          return false;
        }
        if (_this.body) {
          return _this.body;
        }
        wworld = _this.getWorld();
        
        _this.b2world=wworld.world;
        _this.wscale=wworld.scale;
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        b2BodyDef = Box2D.Dynamics.b2BodyDef;
        
        b2Body = Box2D.Dynamics.b2Body;
        
        b2FixtureDef = Box2D.Dynamics.b2FixtureDef;
        
        b2Fixture = Box2D.Dynamics.b2Fixture;
        
        b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;
        
        b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;
        
        fixDef = new b2FixtureDef;
        
        fixDef.density=_this.defv(_this.density,1);
        fixDef.friction=_this.defv(_this.friction,0.5);
        fixDef.restitution=_this.defv(_this.restitution,0.2);
        bodyDef = new b2BodyDef;
        
        bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;
        bodyDef.position.x=_this.x/_this.wscale;
        bodyDef.position.y=_this.y/_this.wscale;
        _this.shape=_this.shape||(_this.radius?"circle":"box");
        w = _this.width;
        h = _this.height;
        
        if (! w) {
          t = _this.detectSpriteType();
          
          if (t==="Image") {
            _this.prepareImage();
          } else {
            if (t==="Custom") {
              if (_this.p.width*_this.p.height>0) {
                _this.width=_this.p.width;
                _this.height=_this.p.height;
                
              }
              
            }
          }
          w=_this.width*_this.abs(_this.scaleX||1);
          h=_this.height*_this.abs(_this.scaleY||_this.scaleX||1);
          
        }
        if (_this.shape=="box") {
          if (! w) {
            console.log(_this);
            throw new Error("BodyActor::width is not set");
            
            
          }
          if (! h) {
            h=w;
          }
          fixDef.shape=new b2PolygonShape;
          fixDef.shape.SetAsOrientedBox(w/2/_this.wscale,h/2/_this.wscale,new b2Vec2(0,0),0);
          
        } else {
          _this.radius=_this.radius||w/2||16;
          fixDef.shape=new b2CircleShape(_this.radius/_this.wscale);
          _this.width=_this.height=_this.radius*2;
          
        }
        fps = wworld.fps;
        
        r = _this.rotation;
        ve = _this.bvec(_this.defv(_this.vx*fps,0),_this.defv(_this.vy*fps,0));
        vr = _this.defv(_this.vrotation,0);
        
        _this.body=_this.b2world.CreateBody(bodyDef);
        _this.body.CreateFixture(fixDef);
        _this.body.SetUserData(_this);
        _this.body.SetLinearVelocity(ve);
        _this.rotation=r;
        _this.vrotation=vr;
        _this.fireEvent("createBody");
        return _this.body;
      },
      fiber$initBody :function* _trc_BodyActor_f_initBody(_thread) {
        var _this=this;
        var wworld;
        var b2Vec2;
        var b2BodyDef;
        var b2Body;
        var b2FixtureDef;
        var b2Fixture;
        var b2PolygonShape;
        var b2CircleShape;
        var fixDef;
        var bodyDef;
        var w;
        var h;
        var t;
        var fps;
        var r;
        var ve;
        var vr;
        
        if (_this.isDead()) {
          return false;
        }
        if (_this.body) {
          return _this.body;
        }
        wworld=yield* _this.fiber$getWorld(_thread);
        
        _this.b2world=wworld.world;
        _this.wscale=wworld.scale;
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        b2BodyDef = Box2D.Dynamics.b2BodyDef;
        
        b2Body = Box2D.Dynamics.b2Body;
        
        b2FixtureDef = Box2D.Dynamics.b2FixtureDef;
        
        b2Fixture = Box2D.Dynamics.b2Fixture;
        
        b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;
        
        b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;
        
        fixDef = new b2FixtureDef;
        
        fixDef.density=(yield* _this.fiber$defv(_thread, _this.density, 1));
        fixDef.friction=(yield* _this.fiber$defv(_thread, _this.friction, 0.5));
        fixDef.restitution=(yield* _this.fiber$defv(_thread, _this.restitution, 0.2));
        bodyDef = new b2BodyDef;
        
        bodyDef.type=_this.isStatic?b2Body.b2_staticBody:b2Body.b2_dynamicBody;
        bodyDef.position.x=_this.x/_this.wscale;
        bodyDef.position.y=_this.y/_this.wscale;
        _this.shape=_this.shape||(_this.radius?"circle":"box");
        w = _this.width;
        h = _this.height;
        
        if (! w) {
          t=yield* _this.fiber$detectSpriteType(_thread);
          
          if (t==="Image") {
            _this.prepareImage();
          } else {
            if (t==="Custom") {
              if (_this.p.width*_this.p.height>0) {
                _this.width=_this.p.width;
                _this.height=_this.p.height;
                
              }
              
            }
          }
          w=_this.width*_this.abs(_this.scaleX||1);
          h=_this.height*_this.abs(_this.scaleY||_this.scaleX||1);
          
        }
        if (_this.shape=="box") {
          if (! w) {
            console.log(_this);
            throw new Error("BodyActor::width is not set");
            
            
          }
          if (! h) {
            h=w;
          }
          fixDef.shape=new b2PolygonShape;
          fixDef.shape.SetAsOrientedBox(w/2/_this.wscale,h/2/_this.wscale,new b2Vec2(0,0),0);
          
        } else {
          _this.radius=_this.radius||w/2||16;
          fixDef.shape=new b2CircleShape(_this.radius/_this.wscale);
          _this.width=_this.height=_this.radius*2;
          
        }
        fps = wworld.fps;
        
        r = _this.rotation;
        ve=yield* _this.fiber$bvec(_thread, _this.defv(_this.vx*fps,0), _this.defv(_this.vy*fps,0));
        vr=yield* _this.fiber$defv(_thread, _this.vrotation, 0);
        
        _this.body=_this.b2world.CreateBody(bodyDef);
        _this.body.CreateFixture(fixDef);
        _this.body.SetUserData(_this);
        _this.body.SetLinearVelocity(ve);
        _this.rotation=r;
        _this.vrotation=vr;
        _this.fireEvent("createBody");
        return _this.body;
        
      },
      allContactPoints :function _trc_BodyActor_allContactPoints(klass) {
        var _this=this;
        var res;
        var m;
        var point;
        var w;
        var c;
        var a;
        var b;
        
        if (! _this.initBody()) {
          return [];
        }
        res = [];
        
        w = _this.getWorld();
        
        for (c = _this.b2world.GetContactList();
         c ; c=c.GetNext()) {
          {
            if (c.IsTouching()) {
              c.GetWorldManifold(m=new Box2D.Collision.b2WorldManifold);
              if (m.m_points[0]) {
                if (m.m_points[1]&&m.m_points[1].x&&m.m_points[1].y) {
                  point={x: (m.m_points[0].x+m.m_points[1].x)/2*w.scale,y: (m.m_points[0].y+m.m_points[1].y)/2*w.scale};
                  
                } else {
                  point={x: m.m_points[0].x*w.scale,y: m.m_points[0].y*w.scale};
                  
                }
                
              } else {
                point={x: _this.x,y: _this.y};
              }
              a = c.GetFixtureA().GetBody().GetUserData();
              
              b = c.GetFixtureB().GetBody().GetUserData();
              
              if (a===_this) {
                if (! klass||b===klass||b instanceof klass) {
                  res.push({target: b,manifold: m,x: point.x,y: point.y});
                  
                }
                
              } else {
                if (b===_this) {
                  if (! klass||a===klass||a instanceof klass) {
                    res.push({target: a,manifold: m,x: point.x,y: point.y});
                    
                  }
                  
                }
              }
              
            }
          }
        }
        return res;
      },
      fiber$allContactPoints :function* _trc_BodyActor_f_allContactPoints(_thread,klass) {
        var _this=this;
        var res;
        var m;
        var point;
        var w;
        var c;
        var a;
        var b;
        
        if (! _this.initBody()) {
          return [];
        }
        res = [];
        
        w=yield* _this.fiber$getWorld(_thread);
        
        for (c = _this.b2world.GetContactList();
         c ; c=c.GetNext()) {
          {
            if (c.IsTouching()) {
              c.GetWorldManifold(m=new Box2D.Collision.b2WorldManifold);
              if (m.m_points[0]) {
                if (m.m_points[1]&&m.m_points[1].x&&m.m_points[1].y) {
                  point={x: (m.m_points[0].x+m.m_points[1].x)/2*w.scale,y: (m.m_points[0].y+m.m_points[1].y)/2*w.scale};
                  
                } else {
                  point={x: m.m_points[0].x*w.scale,y: m.m_points[0].y*w.scale};
                  
                }
                
              } else {
                point={x: _this.x,y: _this.y};
              }
              a = c.GetFixtureA().GetBody().GetUserData();
              
              b = c.GetFixtureB().GetBody().GetUserData();
              
              if (a===_this) {
                if (! klass||b===klass||b instanceof klass) {
                  res.push({target: b,manifold: m,x: point.x,y: point.y});
                  
                }
                
              } else {
                if (b===_this) {
                  if (! klass||a===klass||a instanceof klass) {
                    res.push({target: a,manifold: m,x: point.x,y: point.y});
                    
                  }
                  
                }
              }
              
            }
          }
        }
        return res;
        
      },
      contactPoint :function _trc_BodyActor_contactPoint(klass) {
        var _this=this;
        
        return _this.allContactPoints(klass)[0];
      },
      fiber$contactPoint :function* _trc_BodyActor_f_contactPoint(_thread,klass) {
        var _this=this;
        
        return _this.allContactPoints(klass)[0];
        
      },
      allContact :function _trc_BodyActor_allContact(klass) {
        var _this=this;
        
        return _this.allContacts(klass);
      },
      fiber$allContact :function* _trc_BodyActor_f_allContact(_thread,klass) {
        var _this=this;
        
        return yield* _this.fiber$allContacts(_thread, klass);
        
        
      },
      allContacts :function _trc_BodyActor_allContacts(klass) {
        var _this=this;
        var res;
        var c;
        var a;
        var b;
        
        if (! _this.initBody()) {
          return [];
        }
        res = [];
        
        for (c = _this.b2world.GetContactList();
         c ; c=c.GetNext()) {
          {
            if (c.IsTouching()) {
              a = c.GetFixtureA().GetBody().GetUserData();
              
              b = c.GetFixtureB().GetBody().GetUserData();
              
              if (a===_this) {
                if (! klass||b===klass||b instanceof klass) {
                  res.push(b);
                  
                }
                
              } else {
                if (b===_this) {
                  if (! klass||a===klass||a instanceof klass) {
                    res.push(a);
                    
                  }
                  
                }
              }
              
            }
          }
        }
        return res;
      },
      fiber$allContacts :function* _trc_BodyActor_f_allContacts(_thread,klass) {
        var _this=this;
        var res;
        var c;
        var a;
        var b;
        
        if (! _this.initBody()) {
          return [];
        }
        res = [];
        
        for (c = _this.b2world.GetContactList();
         c ; c=c.GetNext()) {
          {
            if (c.IsTouching()) {
              a = c.GetFixtureA().GetBody().GetUserData();
              
              b = c.GetFixtureB().GetBody().GetUserData();
              
              if (a===_this) {
                if (! klass||b===klass||b instanceof klass) {
                  res.push(b);
                  
                }
                
              } else {
                if (b===_this) {
                  if (! klass||a===klass||a instanceof klass) {
                    res.push(a);
                    
                  }
                  
                }
              }
              
            }
          }
        }
        return res;
        
      },
      applyForce :function _trc_BodyActor_applyForce(fx,fy,px,py) {
        var _this=this;
        var b2Vec2;
        var scale;
        var fps;
        
        if (! _this.initBody()) {
          return _this;
        }
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        scale = _this.getWorld().scale;
        
        fps = 60;
        
        _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());
      },
      fiber$applyForce :function* _trc_BodyActor_f_applyForce(_thread,fx,fy,px,py) {
        var _this=this;
        var b2Vec2;
        var scale;
        var fps;
        
        if (! _this.initBody()) {
          return _this;
        }
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        scale = _this.getWorld().scale;
        
        fps = 60;
        
        _this.body.ApplyForce(new b2Vec2(fx,fy),_this.body.GetPosition());
        
      },
      applyImpulse :function _trc_BodyActor_applyImpulse(fx,fy,px,py) {
        var _this=this;
        var b2Vec2;
        var scale;
        var fps;
        
        if (! _this.initBody()) {
          return _this;
        }
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        scale = _this.getWorld().scale;
        
        fps = 60;
        
        _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());
      },
      fiber$applyImpulse :function* _trc_BodyActor_f_applyImpulse(_thread,fx,fy,px,py) {
        var _this=this;
        var b2Vec2;
        var scale;
        var fps;
        
        if (! _this.initBody()) {
          return _this;
        }
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        scale = _this.getWorld().scale;
        
        fps = 60;
        
        _this.body.ApplyImpulse(new b2Vec2(fx,fy),_this.body.GetPosition());
        
      },
      applyTorque :function _trc_BodyActor_applyTorque(a) {
        var _this=this;
        
        if (! _this.initBody()) {
          return _this;
        }
        _this.body.ApplyTorque(a);
      },
      fiber$applyTorque :function* _trc_BodyActor_f_applyTorque(_thread,a) {
        var _this=this;
        
        if (! _this.initBody()) {
          return _this;
        }
        _this.body.ApplyTorque(a);
        
      },
      moveBy :function _trc_BodyActor_moveBy(dx,dy) {
        var _this=this;
        var pos;
        
        if (! _this.initBody()) {
          return _this;
        }
        pos = _this.body.GetPosition();
        
        pos.x+=dx/_this.wscale;
        pos.y+=dy/_this.wscale;
        _this.body.SetPosition(pos);
      },
      fiber$moveBy :function* _trc_BodyActor_f_moveBy(_thread,dx,dy) {
        var _this=this;
        var pos;
        
        if (! _this.initBody()) {
          return _this;
        }
        pos = _this.body.GetPosition();
        
        pos.x+=dx/_this.wscale;
        pos.y+=dy/_this.wscale;
        _this.body.SetPosition(pos);
        
      },
      contactTo :function _trc_BodyActor_contactTo(t) {
        var _this=this;
        
        return _this.allContact(t)[0];
      },
      fiber$contactTo :function* _trc_BodyActor_f_contactTo(_thread,t) {
        var _this=this;
        
        return _this.allContact(t)[0];
        
      },
      die :function _trc_BodyActor_die() {
        var _this=this;
        
        __superClass.prototype.die.apply( _this, []);
        if (_this.b2world) {
          _this.b2world.DestroyBody(_this.body);
        }
      },
      addRevoluteJoint :function _trc_BodyActor_addRevoluteJoint(params) {
        var _this=this;
        var px;
        var py;
        var wworld;
        var scale;
        var b2world;
        var b2BodyDef;
        var b2Body;
        var JDC;
        var jd;
        var bodyB;
        var bodyDef;
        var b2Vec2;
        
        if (! _this.initBody()) {
          return _this;
        }
        params=params||{};
        px = params.x||_this.x;
        
        py = params.y||_this.y;
        
        wworld = _this.getWorld();
        
        scale = wworld.scale;
        
        b2world = wworld.world;
        
        b2BodyDef = Box2D.Dynamics.b2BodyDef;
        
        b2Body = Box2D.Dynamics.b2Body;
        
        JDC = Box2D.Dynamics.Joints.b2RevoluteJointDef;
        
        jd = new JDC;
        
        
        if (params.other&&Tonyu.is(params.other,Tonyu.classes.kernel.BodyActor)) {
          params.other.initBody();
          bodyB=params.other.body;
          
        } else {
          bodyDef = new b2BodyDef;
          
          bodyDef.type=b2Body.b2_staticBody;
          bodyDef.position.x=px/scale;
          bodyDef.position.y=py/scale;
          bodyB=b2world.CreateBody(bodyDef);
          
        }
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        jd.Initialize(_this.body,bodyB,new b2Vec2(px/scale,py/scale));
        if (params.lowerAngle&&params.upperAngle) {
          jd.lowerAngle=_this.rad(params.lowerAngle);
          jd.upperAngle=_this.rad(params.upperAngle);
          jd.enableLimit=true;
          
        }
        b2world.CreateJoint(jd);
      },
      fiber$addRevoluteJoint :function* _trc_BodyActor_f_addRevoluteJoint(_thread,params) {
        var _this=this;
        var px;
        var py;
        var wworld;
        var scale;
        var b2world;
        var b2BodyDef;
        var b2Body;
        var JDC;
        var jd;
        var bodyB;
        var bodyDef;
        var b2Vec2;
        
        if (! _this.initBody()) {
          return _this;
        }
        params=params||{};
        px = params.x||_this.x;
        
        py = params.y||_this.y;
        
        wworld=yield* _this.fiber$getWorld(_thread);
        
        scale = wworld.scale;
        
        b2world = wworld.world;
        
        b2BodyDef = Box2D.Dynamics.b2BodyDef;
        
        b2Body = Box2D.Dynamics.b2Body;
        
        JDC = Box2D.Dynamics.Joints.b2RevoluteJointDef;
        
        jd = new JDC;
        
        
        if (params.other&&Tonyu.is(params.other,Tonyu.classes.kernel.BodyActor)) {
          params.other.initBody();
          bodyB=params.other.body;
          
        } else {
          bodyDef = new b2BodyDef;
          
          bodyDef.type=b2Body.b2_staticBody;
          bodyDef.position.x=px/scale;
          bodyDef.position.y=py/scale;
          bodyB=b2world.CreateBody(bodyDef);
          
        }
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        jd.Initialize(_this.body,bodyB,new b2Vec2(px/scale,py/scale));
        if (params.lowerAngle&&params.upperAngle) {
          jd.lowerAngle=_this.rad(params.lowerAngle);
          jd.upperAngle=_this.rad(params.upperAngle);
          jd.enableLimit=true;
          
        }
        b2world.CreateJoint(jd);
        
      },
      __getter__rotation :function _trc_BodyActor___getter__rotation() {
        var _this=this;
        
        if (! _this.body||_this.manualRotation) {
          return _this._rotation;
        }
        return _this.deg(_this.body.GetAngle());
      },
      __setter__rotation :function _trc_BodyActor___setter__rotation(r) {
        var _this=this;
        
        r=r||0;
        if (! _this.body||_this.manualRotation) {
          return _this._rotation=r;
        }
        _this.body.SetAngle(_this.rad(r));
      },
      __getter__x :function _trc_BodyActor___getter__x() {
        var _this=this;
        var pos;
        
        if (! _this.body) {
          return _this._x;
        }
        pos = _this.body.GetPosition();
        
        return pos.x*_this.wscale;
      },
      __setter__x :function _trc_BodyActor___setter__x(v) {
        var _this=this;
        var pos;
        
        if (! _this.body) {
          return _this._x=v;
        }
        v=v||0;
        pos = _this.body.GetPosition();
        
        pos.x=v/_this.wscale;
        _this.body.SetPosition(pos);
      },
      __getter__y :function _trc_BodyActor___getter__y() {
        var _this=this;
        var pos;
        
        if (! _this.body) {
          return _this._y;
        }
        pos = _this.body.GetPosition();
        
        return pos.y*_this.wscale;
      },
      __setter__y :function _trc_BodyActor___setter__y(v) {
        var _this=this;
        var pos;
        
        if (! _this.body) {
          return _this._y=v;
        }
        v=v||0;
        pos = _this.body.GetPosition();
        
        pos.y=v/_this.wscale;
        _this.body.SetPosition(pos);
      },
      __getter__vx :function _trc_BodyActor___getter__vx() {
        var _this=this;
        var v;
        
        if (! _this.body) {
          return _this._vx;
        }
        v = _this.body.GetLinearVelocity();
        
        return v.x*_this.wscale/_this.getWorld().fps;
      },
      __setter__vx :function _trc_BodyActor___setter__vx(v) {
        var _this=this;
        var ve;
        
        if (! _this.body) {
          return _this._vx=v;
        }
        v=v||0;
        ve = _this.body.GetLinearVelocity();
        
        ve.x=v/_this.wscale*_this.getWorld().fps;
        if (v) {
          _this.body.SetAwake(true);
        }
        _this.body.SetLinearVelocity(ve);
      },
      __getter__vy :function _trc_BodyActor___getter__vy() {
        var _this=this;
        var v;
        
        if (! _this.body) {
          return _this._vy;
        }
        v = _this.body.GetLinearVelocity();
        
        return v.y*_this.wscale/_this.getWorld().fps;
      },
      __setter__vy :function _trc_BodyActor___setter__vy(v) {
        var _this=this;
        var ve;
        
        if (! _this.body) {
          return _this._vy=v;
        }
        ve = _this.body.GetLinearVelocity();
        
        ve.y=v/_this.wscale*_this.getWorld().fps;
        if (v) {
          _this.body.SetAwake(true);
        }
        _this.body.SetLinearVelocity(ve);
      },
      __getter__vrotation :function _trc_BodyActor___getter__vrotation() {
        var _this=this;
        
        if (! _this.body) {
          return _this._vr;
        }
        return _this.deg(_this.body.GetAngularVelocity()/_this.getWorld().fps);
      },
      __setter__vrotation :function _trc_BodyActor___setter__vrotation(v) {
        var _this=this;
        
        if (! _this.body) {
          return _this._vr=v;
        }
        v=v||0;
        if (v) {
          _this.body.SetAwake(true);
        }
        _this.body.SetAngularVelocity(_this.rad(v*_this.getWorld().fps));
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getWorld":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"update":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initBody":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"allContactPoints":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"contactPoint":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"allContact":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"allContacts":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"applyForce":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"applyImpulse":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"applyTorque":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"moveBy":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"contactTo":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"die":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"addRevoluteJoint":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__rotation":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__rotation":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__x":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__x":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__y":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__y":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__vx":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__vx":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__vy":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__vy":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__vrotation":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__vrotation":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"body":{},"wscale":{},"b2world":{},"world":{"vtype":"kernel.T2World"},"isStatic":{},"shape":{},"manualRotation":{},"density":{},"friction":{},"restitution":{},"radius":{},"width":{},"height":{},"_x":{},"_y":{},"_vx":{},"_vy":{},"_rotation":{},"_vr":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T2Body',
  shortName: 'T2Body',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.BodyActor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_T2Body_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T2Body_f_main(_thread) {
        var _this=this;
        
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.T2World',
  shortName: 'T2World',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [Tonyu.classes.kernel.T2Mod],
  methods: function (__superClass) {
    return {
      main :function _trc_T2World_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T2World_f_main(_thread) {
        var _this=this;
        
        
      },
      onAppear :function _trc_T2World_onAppear() {
        var _this=this;
        
        Tonyu.globals.$currentProject.requestPlugin("box2d");
        _this.initWorld();
        _this.fm=new Tonyu.classes.kernel.FrameManager({_scheduler: _this._scheduler,afterMove: Tonyu.bindFunc(_this,_this.afterMove)});
      },
      fiber$onAppear :function* _trc_T2World_f_onAppear(_thread) {
        var _this=this;
        
        Tonyu.globals.$currentProject.requestPlugin("box2d");
        (yield* _this.fiber$initWorld(_thread));
        _this.fm=new Tonyu.classes.kernel.FrameManager({_scheduler: _this._scheduler,afterMove: Tonyu.bindFunc(_this,_this.afterMove)});
        
      },
      initWorld :function _trc_T2World_initWorld() {
        var _this=this;
        var b2World;
        var b2Vec2;
        
        _this.gravity=_this.defv(_this.gravity,9.8);
        _this.gravityX=_this.defv(_this.gravityX,0);
        _this.fps=Tonyu.globals.$Boot.getFrameRate();
        b2World = Box2D.Dynamics.b2World;
        
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        _this.scale=_this.scale||32;
        _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);
        if (_this.name!==null) {
          _this.name=_this.name||"$t2World";
          Tonyu.setGlobal(_this.name,_this);
          
        }
        Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));
        _this.on("die",Tonyu.bindFunc(_this,_this.releaseWorld));
      },
      fiber$initWorld :function* _trc_T2World_f_initWorld(_thread) {
        var _this=this;
        var b2World;
        var b2Vec2;
        
        _this.gravity=(yield* _this.fiber$defv(_thread, _this.gravity, 9.8));
        _this.gravityX=(yield* _this.fiber$defv(_thread, _this.gravityX, 0));
        _this.fps=Tonyu.globals.$Boot.getFrameRate();
        b2World = Box2D.Dynamics.b2World;
        
        b2Vec2 = Box2D.Common.Math.b2Vec2;
        
        _this.scale=_this.scale||32;
        _this.world=new b2World(new b2Vec2(_this.gravityX,_this.gravity),true);
        if (_this.name!==null) {
          _this.name=_this.name||"$t2World";
          Tonyu.setGlobal(_this.name,_this);
          
        }
        Tonyu.globals.$Boot.on("stop",Tonyu.bindFunc(_this,_this.releaseWorld));
        _this.on("die",Tonyu.bindFunc(_this,_this.releaseWorld));
        
      },
      releaseWorld :function _trc_T2World_releaseWorld() {
        var _this=this;
        
        if (Tonyu.globals.$t2World===_this) {
          Tonyu.globals.$t2World=null;
        }
      },
      fiber$releaseWorld :function* _trc_T2World_f_releaseWorld(_thread) {
        var _this=this;
        
        if (Tonyu.globals.$t2World===_this) {
          Tonyu.globals.$t2World=null;
        }
        
      },
      afterMove :function _trc_T2World_afterMove() {
        var _this=this;
        
        _this.fps=Tonyu.globals.$Boot.getFrameRate();
        _this.world.Step(1/_this.fps,10,10);
        _this.world.ClearForces();
      },
      fiber$afterMove :function* _trc_T2World_f_afterMove(_thread) {
        var _this=this;
        
        _this.fps=Tonyu.globals.$Boot.getFrameRate();
        _this.world.Step(1/_this.fps,10,10);
        _this.world.ClearForces();
        
      },
      loop :function _trc_T2World_loop() {
        var _this=this;
        
        while (true) {
          _this.fps=Tonyu.globals.$Boot.getFrameRate();
          _this.world.Step(1/_this.fps,10,10);
          _this.world.ClearForces();
          _this.update();
          
        }
      },
      fiber$loop :function* _trc_T2World_f_loop(_thread) {
        var _this=this;
        
        while (true) {
          _this.fps=Tonyu.globals.$Boot.getFrameRate();
          _this.world.Step(1/_this.fps,10,10);
          _this.world.ClearForces();
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      updatePos :function _trc_T2World_updatePos() {
        var _this=this;
        var b;
        var d;
        
        for (b = _this.world.GetBodyList();
         b ; b=b.GetNext()) {
          {
            d = b.GetUserData();
            
            if (d) {
              d.updatePos();
            }
          }
        }
      },
      fiber$updatePos :function* _trc_T2World_f_updatePos(_thread) {
        var _this=this;
        var b;
        var d;
        
        for (b = _this.world.GetBodyList();
         b ; b=b.GetNext()) {
          {
            d = b.GetUserData();
            
            if (d) {
              d.updatePos();
            }
          }
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"onAppear":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initWorld":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"releaseWorld":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"afterMove":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"updatePos":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"fm":{},"gravity":{},"gravityX":{},"fps":{},"scale":{},"world":{},"name":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T2MediaPlayer',
  shortName: 'T2MediaPlayer',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_T2MediaPlayer_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T2MediaPlayer_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_T2MediaPlayer_initialize() {
        var _this=this;
        
        _this.initT2MediaPlayer();
      },
      initT2MediaPlayer :function _trc_T2MediaPlayer_initT2MediaPlayer() {
        var _this=this;
        
        if (! Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib=new T2MediaLib();
          
        }
        _this.resetSEFrame();
        _this.bgmPlayerMax=Tonyu.globals.$t2MediaLib.bgmPlayerMax;
      },
      fiber$initT2MediaPlayer :function* _trc_T2MediaPlayer_f_initT2MediaPlayer(_thread) {
        var _this=this;
        
        if (! Tonyu.globals.$t2MediaLib) {
          Tonyu.globals.$t2MediaLib=new T2MediaLib();
          
        }
        (yield* _this.fiber$resetSEFrame(_thread));
        _this.bgmPlayerMax=Tonyu.globals.$t2MediaLib.bgmPlayerMax;
        
      },
      allClearSoundData :function _trc_T2MediaPlayer_allClearSoundData() {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.allResetBGM();
        Tonyu.globals.$t2MediaLib.allClearSoundData();
      },
      fiber$allClearSoundData :function* _trc_T2MediaPlayer_f_allClearSoundData(_thread) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.allResetBGM();
        Tonyu.globals.$t2MediaLib.allClearSoundData();
        
      },
      clearSoundData :function _trc_T2MediaPlayer_clearSoundData(idx) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.clearSoundData(idx);
      },
      fiber$clearSoundData :function* _trc_T2MediaPlayer_f_clearSoundData(_thread,idx) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.clearSoundData(idx);
        
      },
      allRemoveDecodedSoundData :function _trc_T2MediaPlayer_allRemoveDecodedSoundData() {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.allRemoveDecodedSoundData();
      },
      fiber$allRemoveDecodedSoundData :function* _trc_T2MediaPlayer_f_allRemoveDecodedSoundData(_thread) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.allRemoveDecodedSoundData();
        
      },
      removeDecodedSoundData :function _trc_T2MediaPlayer_removeDecodedSoundData(idx) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.removeDecodedSoundData(idx);
      },
      fiber$removeDecodedSoundData :function* _trc_T2MediaPlayer_f_removeDecodedSoundData(_thread,idx) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.removeDecodedSoundData(idx);
        
      },
      getMasterVolume :function _trc_T2MediaPlayer_getMasterVolume() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getMasterVolume()*128;
      },
      fiber$getMasterVolume :function* _trc_T2MediaPlayer_f_getMasterVolume(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getMasterVolume()*128;
        
      },
      setMasterVolume :function _trc_T2MediaPlayer_setMasterVolume(vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setMasterVolume(Tonyu.globals.$t2MediaLib.getMasterVolume());
          
        }
        return Tonyu.globals.$t2MediaLib.setMasterVolume(vol);
      },
      fiber$setMasterVolume :function* _trc_T2MediaPlayer_f_setMasterVolume(_thread,vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setMasterVolume(Tonyu.globals.$t2MediaLib.getMasterVolume());
          
        }
        return Tonyu.globals.$t2MediaLib.setMasterVolume(vol);
        
      },
      loadSound :function _trc_T2MediaPlayer_loadSound(idx,src,callbacks) {
        var _this=this;
        var isLoadAndDecode;
        
        isLoadAndDecode = Tonyu.globals.$soundLoadAndDecode||false;
        
        Tonyu.globals.$t2MediaLib.loadSound(idx,src,callbacks,isLoadAndDecode);
      },
      fiber$loadSound :function* _trc_T2MediaPlayer_f_loadSound(_thread,idx,src,callbacks) {
        var _this=this;
        var isLoadAndDecode;
        
        isLoadAndDecode = Tonyu.globals.$soundLoadAndDecode||false;
        
        Tonyu.globals.$t2MediaLib.loadSound(idx,src,callbacks,isLoadAndDecode);
        
      },
      __getter__available :function _trc_T2MediaPlayer___getter__available() {
        var _this=this;
        
        return ! ! Tonyu.globals.$t2MediaLib.context;
      },
      loadFromProject :function _trc_T2MediaPlayer_loadFromProject(prj) {
        var _this=this;
        var r;
        var jobs;
        var cnt;
        var s;
        var name;
        var url;
        var func;
        var callbacks;
        var reqP;
        var i;
        
        if (! _this.available) {
          return _this;
        }
        r = prj.getResource();
        
        if (! r||! r.sounds) {
          return _this;
        }
        if (r.sounds<=0) {
          return _this;
        }
        _this.progressNoLog("Loading sounds...[0/"+r.sounds.length+"]");
        jobs = 6;
        
        cnt = 0;
        
        
        func = (function anonymous_1544(seName,errorID) {
          var nextIdx;
          var s;
          var name;
          var url;
          
          if (errorID) {
            console.log(seName,errorID);
            Tonyu.setGlobal(seName,"ERROR");
            
          } else {
            Tonyu.setGlobal(seName,seName);
            
          }
          nextIdx = cnt+jobs;
          
          cnt++;
          _this.progressNoLog("Loading sounds...["+(cnt)+"/"+r.sounds.length+"]");
          if (nextIdx>=r.sounds.length) {
            return _this;
          }
          s = r.sounds[nextIdx];
          
          name = s.name;
          
          url = Tonyu.Assets.resolve(s.url,prj);
          
          _this.loadSound(name,url,callbacks);
        });
        
        callbacks = {};
        
        callbacks.succ=func;
        callbacks.err=func;
        
        for ([s] of Tonyu.iterator2(r.sounds,1)) {
          url=s.url;
          if (url.match(/\.midi?$/)) {
            reqP=true;
          }
          url=Tonyu.Assets.resolve(url,prj);
          if (url.match(/\.midi?$/)) {
            reqP=true;
          }
          
        }
        if (reqP) {
          Tonyu.globals.$currentProject.requestPlugin("PicoAudio");
        }
        for (i = 0;
         i<jobs ; i++) {
          {
            if (i>=r.sounds.length) {
              break;
              
            }
            s=r.sounds[i];
            name=s.name;
            url=Tonyu.Assets.resolve(s.url,prj);
            _this.loadSound(name,url,callbacks);
          }
        }
        while (cnt<r.sounds.length) {
          _this.update();
          
        }
      },
      fiber$loadFromProject :function* _trc_T2MediaPlayer_f_loadFromProject(_thread,prj) {
        var _this=this;
        var r;
        var jobs;
        var cnt;
        var s;
        var name;
        var url;
        var func;
        var callbacks;
        var reqP;
        var i;
        
        if (! _this.available) {
          return _this;
        }
        r = prj.getResource();
        
        if (! r||! r.sounds) {
          return _this;
        }
        if (r.sounds<=0) {
          return _this;
        }
        _this.progressNoLog("Loading sounds...[0/"+r.sounds.length+"]");
        jobs = 6;
        
        cnt = 0;
        
        
        func = (function anonymous_1544(seName,errorID) {
          var nextIdx;
          var s;
          var name;
          var url;
          
          if (errorID) {
            console.log(seName,errorID);
            Tonyu.setGlobal(seName,"ERROR");
            
          } else {
            Tonyu.setGlobal(seName,seName);
            
          }
          nextIdx = cnt+jobs;
          
          cnt++;
          _this.progressNoLog("Loading sounds...["+(cnt)+"/"+r.sounds.length+"]");
          if (nextIdx>=r.sounds.length) {
            return _this;
          }
          s = r.sounds[nextIdx];
          
          name = s.name;
          
          url = Tonyu.Assets.resolve(s.url,prj);
          
          _this.loadSound(name,url,callbacks);
        });
        
        callbacks = {};
        
        callbacks.succ=func;
        callbacks.err=func;
        
        for ([s] of Tonyu.iterator2(r.sounds,1)) {
          url=s.url;
          if (url.match(/\.midi?$/)) {
            reqP=true;
          }
          url=Tonyu.Assets.resolve(url,prj);
          if (url.match(/\.midi?$/)) {
            reqP=true;
          }
          
        }
        if (reqP) {
          Tonyu.globals.$currentProject.requestPlugin("PicoAudio");
        }
        for (i = 0;
         i<jobs ; i++) {
          {
            if (i>=r.sounds.length) {
              break;
              
            }
            s=r.sounds[i];
            name=s.name;
            url=Tonyu.Assets.resolve(s.url,prj);
            (yield* _this.fiber$loadSound(_thread, name, url, callbacks));
          }
        }
        while (cnt<r.sounds.length) {
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      decodeSound :function _trc_T2MediaPlayer_decodeSound(idx,callbacks) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.decodeSound(idx,callbacks);
      },
      fiber$decodeSound :function* _trc_T2MediaPlayer_f_decodeSound(_thread,idx,callbacks) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.decodeSound(idx,callbacks);
        
      },
      getSoundFileData :function _trc_T2MediaPlayer_getSoundFileData(idx) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSoundFileData(idx);
      },
      fiber$getSoundFileData :function* _trc_T2MediaPlayer_f_getSoundFileData(_thread,idx) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSoundFileData(idx);
        
      },
      getSoundDecodedData :function _trc_T2MediaPlayer_getSoundDecodedData(idx) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSoundDecodedData(idx);
      },
      fiber$getSoundDecodedData :function* _trc_T2MediaPlayer_f_getSoundDecodedData(_thread,idx) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSoundDecodedData(idx);
        
      },
      getCurrentTime :function _trc_T2MediaPlayer_getCurrentTime() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getCurrentTime();
      },
      fiber$getCurrentTime :function* _trc_T2MediaPlayer_f_getCurrentTime(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getCurrentTime();
        
      },
      getContext :function _trc_T2MediaPlayer_getContext() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.context;
      },
      fiber$getContext :function* _trc_T2MediaPlayer_f_getContext(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.context;
        
      },
      playSE :function _trc_T2MediaPlayer_playSE(idx,vol,pan,rate,offset,loop,loopStart,loopEnd,start,duration) {
        var _this=this;
        var o;
        
        if (_this.mute) {
          return null;
        }
        if (vol&&typeof  vol==="object") {
          o = vol;
          
          vol=o.vol;
          pan=o.pan;
          rate=o.rate;
          offset=o.offset;
          loop=o.loop;
          loopStart=o.loopStart;
          loopEnd=o.loopEnd;
          start=o.start;
          duration=o.duration;
          
        }
        if (vol==null) {
          vol=128;
        }
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          vol=1;
          
        }
        if (! start&&_this.seStaredAtThisFrame[idx]) {
          return null;
        }
        _this.seStaredAtThisFrame[idx]=true;
        return Tonyu.globals.$t2MediaLib.playSE(idx,vol,pan,rate,offset,loop,loopStart,loopEnd,start,duration);
      },
      stopSE :function _trc_T2MediaPlayer_stopSE(sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.stopSE(sourceObj);
      },
      fiber$stopSE :function* _trc_T2MediaPlayer_f_stopSE(_thread,sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.stopSE(sourceObj);
        
      },
      stopAllSE :function _trc_T2MediaPlayer_stopAllSE() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.stopAllSE();
      },
      fiber$stopAllSE :function* _trc_T2MediaPlayer_f_stopAllSE(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.stopAllSE();
        
      },
      getSEMasterVolume :function _trc_T2MediaPlayer_getSEMasterVolume() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSEMasterVolume()*128;
      },
      fiber$getSEMasterVolume :function* _trc_T2MediaPlayer_f_getSEMasterVolume(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSEMasterVolume()*128;
        
      },
      setSEMasterVolume :function _trc_T2MediaPlayer_setSEMasterVolume(vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setSEMasterVolume(Tonyu.globals.$t2MediaLib.getSEMasterVolume());
          
        }
        return Tonyu.globals.$t2MediaLib.setSEMasterVolume(vol);
      },
      fiber$setSEMasterVolume :function* _trc_T2MediaPlayer_f_setSEMasterVolume(_thread,vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setSEMasterVolume(Tonyu.globals.$t2MediaLib.getSEMasterVolume());
          
        }
        return Tonyu.globals.$t2MediaLib.setSEMasterVolume(vol);
        
      },
      getSEVolume :function _trc_T2MediaPlayer_getSEVolume(sourceObj) {
        var _this=this;
        var vol;
        
        vol = Tonyu.globals.$t2MediaLib.getSEVolume(sourceObj);
        
        return typeof  vol==="number"?vol*128:vol;
      },
      fiber$getSEVolume :function* _trc_T2MediaPlayer_f_getSEVolume(_thread,sourceObj) {
        var _this=this;
        var vol;
        
        vol = Tonyu.globals.$t2MediaLib.getSEVolume(sourceObj);
        
        return typeof  vol==="number"?vol*128:vol;
        
      },
      setSEVolume :function _trc_T2MediaPlayer_setSEVolume(sourceObj,vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setSEVolume(sourceObj,Tonyu.globals.$t2MediaLib.getSEVolume(sourceObj));
          
        }
        return Tonyu.globals.$t2MediaLib.setSEVolume(sourceObj,vol);
      },
      fiber$setSEVolume :function* _trc_T2MediaPlayer_f_setSEVolume(_thread,sourceObj,vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setSEVolume(sourceObj,Tonyu.globals.$t2MediaLib.getSEVolume(sourceObj));
          
        }
        return Tonyu.globals.$t2MediaLib.setSEVolume(sourceObj,vol);
        
      },
      getSERate :function _trc_T2MediaPlayer_getSERate(sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSERate(sourceObj);
      },
      fiber$getSERate :function* _trc_T2MediaPlayer_f_getSERate(_thread,sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSERate(sourceObj);
        
      },
      setSERate :function _trc_T2MediaPlayer_setSERate(sourceObj,rate) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setSERate(sourceObj,rate);
      },
      fiber$setSERate :function* _trc_T2MediaPlayer_f_setSERate(_thread,sourceObj,rate) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setSERate(sourceObj,rate);
        
      },
      getSEPan :function _trc_T2MediaPlayer_getSEPan(sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSEPan(sourceObj);
      },
      fiber$getSEPan :function* _trc_T2MediaPlayer_f_getSEPan(_thread,sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSEPan(sourceObj);
        
      },
      setSEPan :function _trc_T2MediaPlayer_setSEPan(sourceObj,pan) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setSEPan(sourceObj,pan);
      },
      fiber$setSEPan :function* _trc_T2MediaPlayer_f_setSEPan(_thread,sourceObj,pan) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setSEPan(sourceObj,pan);
        
      },
      isSELoop :function _trc_T2MediaPlayer_isSELoop(sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.isSELoop(sourceObj);
      },
      fiber$isSELoop :function* _trc_T2MediaPlayer_f_isSELoop(_thread,sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.isSELoop(sourceObj);
        
      },
      setSELoop :function _trc_T2MediaPlayer_setSELoop(sourceObj,loop) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setSELoop(sourceObj,loop);
      },
      fiber$setSELoop :function* _trc_T2MediaPlayer_f_setSELoop(_thread,sourceObj,loop) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setSELoop(sourceObj,loop);
        
      },
      getSELoopStartTime :function _trc_T2MediaPlayer_getSELoopStartTime(sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSELoopStartTime(sourceObj);
      },
      fiber$getSELoopStartTime :function* _trc_T2MediaPlayer_f_getSELoopStartTime(_thread,sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSELoopStartTime(sourceObj);
        
      },
      setSELoopStartTime :function _trc_T2MediaPlayer_setSELoopStartTime(sourceObj,loopStart) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setSELoopStartTime(sourceObj,loopStart);
      },
      fiber$setSELoopStartTime :function* _trc_T2MediaPlayer_f_setSELoopStartTime(_thread,sourceObj,loopStart) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setSELoopStartTime(sourceObj,loopStart);
        
      },
      getSELoopEndTime :function _trc_T2MediaPlayer_getSELoopEndTime(sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSELoopEndTime(sourceObj);
      },
      fiber$getSELoopEndTime :function* _trc_T2MediaPlayer_f_getSELoopEndTime(_thread,sourceObj) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getSELoopEndTime(sourceObj);
        
      },
      setSELoopEndTime :function _trc_T2MediaPlayer_setSELoopEndTime(sourceObj,loopEnd) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setSELoopEndTime(sourceObj,loopEnd);
      },
      fiber$setSELoopEndTime :function* _trc_T2MediaPlayer_f_setSELoopEndTime(_thread,sourceObj,loopEnd) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setSELoopEndTime(sourceObj,loopEnd);
        
      },
      playBGM :function _trc_T2MediaPlayer_playBGM(idx,loop,offset,loopStart,loopEnd) {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        if (loop==null) {
          loop=false;
        }
        if (offset==null) {
          offset=0;
        }
        return Tonyu.globals.$t2MediaLib.playBGM(0,idx,loop,offset,loopStart,loopEnd);
      },
      fiber$playBGM :function* _trc_T2MediaPlayer_f_playBGM(_thread,idx,loop,offset,loopStart,loopEnd) {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        if (loop==null) {
          loop=false;
        }
        if (offset==null) {
          offset=0;
        }
        return Tonyu.globals.$t2MediaLib.playBGM(0,idx,loop,offset,loopStart,loopEnd);
        
      },
      stopBGM :function _trc_T2MediaPlayer_stopBGM() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.stopBGM(0);
      },
      fiber$stopBGM :function* _trc_T2MediaPlayer_f_stopBGM(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.stopBGM(0);
        
      },
      pauseBGM :function _trc_T2MediaPlayer_pauseBGM() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.pauseBGM(0);
      },
      fiber$pauseBGM :function* _trc_T2MediaPlayer_f_pauseBGM(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.pauseBGM(0);
        
      },
      resumeBGM :function _trc_T2MediaPlayer_resumeBGM() {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        return Tonyu.globals.$t2MediaLib.resumeBGM(0);
      },
      fiber$resumeBGM :function* _trc_T2MediaPlayer_f_resumeBGM(_thread) {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        return Tonyu.globals.$t2MediaLib.resumeBGM(0);
        
      },
      getBGMMasterVolume :function _trc_T2MediaPlayer_getBGMMasterVolume() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMMasterVolume()*128;
      },
      fiber$getBGMMasterVolume :function* _trc_T2MediaPlayer_f_getBGMMasterVolume(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMMasterVolume()*128;
        
      },
      setBGMMasterVolume :function _trc_T2MediaPlayer_setBGMMasterVolume(vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setBGMMasterVolume(Tonyu.globals.$t2MediaLib.getBGMMasterVolume());
          
        }
        return Tonyu.globals.$t2MediaLib.setBGMMasterVolume(vol);
      },
      fiber$setBGMMasterVolume :function* _trc_T2MediaPlayer_f_setBGMMasterVolume(_thread,vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setBGMMasterVolume(Tonyu.globals.$t2MediaLib.getBGMMasterVolume());
          
        }
        return Tonyu.globals.$t2MediaLib.setBGMMasterVolume(vol);
        
      },
      getBGMVolume :function _trc_T2MediaPlayer_getBGMVolume() {
        var _this=this;
        var vol;
        
        vol = Tonyu.globals.$t2MediaLib.getBGMVolume(0);
        
        return typeof  vol==="number"?vol*128:vol;
      },
      fiber$getBGMVolume :function* _trc_T2MediaPlayer_f_getBGMVolume(_thread) {
        var _this=this;
        var vol;
        
        vol = Tonyu.globals.$t2MediaLib.getBGMVolume(0);
        
        return typeof  vol==="number"?vol*128:vol;
        
      },
      setBGMVolume :function _trc_T2MediaPlayer_setBGMVolume(vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setBGMVolume(0,Tonyu.globals.$t2MediaLib.getBGMVolume(0));
          
        }
        return Tonyu.globals.$t2MediaLib.setBGMVolume(0,vol);
      },
      fiber$setBGMVolume :function* _trc_T2MediaPlayer_f_setBGMVolume(_thread,vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setBGMVolume(0,Tonyu.globals.$t2MediaLib.getBGMVolume(0));
          
        }
        return Tonyu.globals.$t2MediaLib.setBGMVolume(0,vol);
        
      },
      getBGMTempo :function _trc_T2MediaPlayer_getBGMTempo() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMTempo(0);
      },
      fiber$getBGMTempo :function* _trc_T2MediaPlayer_f_getBGMTempo(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMTempo(0);
        
      },
      setBGMTempo :function _trc_T2MediaPlayer_setBGMTempo(tempo) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMTempo(0,tempo);
      },
      fiber$setBGMTempo :function* _trc_T2MediaPlayer_f_setBGMTempo(_thread,tempo) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMTempo(0,tempo);
        
      },
      getBGMPan :function _trc_T2MediaPlayer_getBGMPan() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMPan(0);
      },
      fiber$getBGMPan :function* _trc_T2MediaPlayer_f_getBGMPan(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMPan(0);
        
      },
      setBGMPan :function _trc_T2MediaPlayer_setBGMPan(pan) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMPan(0,pan);
      },
      fiber$setBGMPan :function* _trc_T2MediaPlayer_f_setBGMPan(_thread,pan) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMPan(0,pan);
        
      },
      isBGMLoop :function _trc_T2MediaPlayer_isBGMLoop() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.isBGMLoop(0);
      },
      fiber$isBGMLoop :function* _trc_T2MediaPlayer_f_isBGMLoop(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.isBGMLoop(0);
        
      },
      setBGMLoop :function _trc_T2MediaPlayer_setBGMLoop(loop) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoop(0,loop);
      },
      fiber$setBGMLoop :function* _trc_T2MediaPlayer_f_setBGMLoop(_thread,loop) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoop(0,loop);
        
      },
      getBGMLoopStartTime :function _trc_T2MediaPlayer_getBGMLoopStartTime() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLoopStartTime(0);
      },
      fiber$getBGMLoopStartTime :function* _trc_T2MediaPlayer_f_getBGMLoopStartTime(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLoopStartTime(0);
        
      },
      setBGMLoopStartTime :function _trc_T2MediaPlayer_setBGMLoopStartTime(loopStart) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoopStartTime(0,loopStart);
      },
      fiber$setBGMLoopStartTime :function* _trc_T2MediaPlayer_f_setBGMLoopStartTime(_thread,loopStart) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoopStartTime(0,loopStart);
        
      },
      getBGMLoopEndTime :function _trc_T2MediaPlayer_getBGMLoopEndTime() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLoopEndTime(0);
      },
      fiber$getBGMLoopEndTime :function* _trc_T2MediaPlayer_f_getBGMLoopEndTime(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLoopEndTime(0);
        
      },
      setBGMLoopEndTime :function _trc_T2MediaPlayer_setBGMLoopEndTime(loopEnd) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoopEndTime(0,loopEnd);
      },
      fiber$setBGMLoopEndTime :function* _trc_T2MediaPlayer_f_setBGMLoopEndTime(_thread,loopEnd) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoopEndTime(0,loopEnd);
        
      },
      getBGMCurrentTime :function _trc_T2MediaPlayer_getBGMCurrentTime() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMCurrentTime(0);
      },
      fiber$getBGMCurrentTime :function* _trc_T2MediaPlayer_f_getBGMCurrentTime(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMCurrentTime(0);
        
      },
      getBGMLength :function _trc_T2MediaPlayer_getBGMLength() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLength(0);
      },
      fiber$getBGMLength :function* _trc_T2MediaPlayer_f_getBGMLength(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLength(0);
        
      },
      getPlayingBGMName :function _trc_T2MediaPlayer_getPlayingBGMName() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getPlayingBGMName(0);
      },
      fiber$getPlayingBGMName :function* _trc_T2MediaPlayer_f_getPlayingBGMName(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getPlayingBGMName(0);
        
      },
      setOnBGMEndListener :function _trc_T2MediaPlayer_setOnBGMEndListener() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setOnBGMEndListener(0);
      },
      fiber$setOnBGMEndListener :function* _trc_T2MediaPlayer_f_setOnBGMEndListener(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setOnBGMEndListener(0);
        
      },
      getPlayingBGMState :function _trc_T2MediaPlayer_getPlayingBGMState() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getPlayingBGMState(0);
      },
      fiber$getPlayingBGMState :function* _trc_T2MediaPlayer_f_getPlayingBGMState(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getPlayingBGMState(0);
        
      },
      getBGMPicoAudio :function _trc_T2MediaPlayer_getBGMPicoAudio() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMPicoAudio(0);
      },
      fiber$getBGMPicoAudio :function* _trc_T2MediaPlayer_f_getBGMPicoAudio(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMPicoAudio(0);
        
      },
      isTagLoop :function _trc_T2MediaPlayer_isTagLoop() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.isTagLoop(0);
      },
      fiber$isTagLoop :function* _trc_T2MediaPlayer_f_isTagLoop(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.isTagLoop(0);
        
      },
      setTagLoop :function _trc_T2MediaPlayer_setTagLoop(isTagLoop) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setTagLoop(0,isTagLoop);
      },
      fiber$setTagLoop :function* _trc_T2MediaPlayer_f_setTagLoop(_thread,isTagLoop) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setTagLoop(0,isTagLoop);
        
      },
      getBGMPlayerMax :function _trc_T2MediaPlayer_getBGMPlayerMax() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMPlayerMax();
      },
      fiber$getBGMPlayerMax :function* _trc_T2MediaPlayer_f_getBGMPlayerMax(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMPlayerMax();
        
      },
      allStopBGM :function _trc_T2MediaPlayer_allStopBGM() {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.allStopBGM();
      },
      fiber$allStopBGM :function* _trc_T2MediaPlayer_f_allStopBGM(_thread) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.allStopBGM();
        
      },
      allResetBGM :function _trc_T2MediaPlayer_allResetBGM() {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.allResetBGM();
      },
      fiber$allResetBGM :function* _trc_T2MediaPlayer_f_allResetBGM(_thread) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.allResetBGM();
        
      },
      playBGMID :function _trc_T2MediaPlayer_playBGMID(id,idx,loop,offset,loopStart,loopEnd) {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        if (loop==null) {
          loop=false;
        }
        if (offset==null) {
          offset=0;
        }
        return Tonyu.globals.$t2MediaLib.playBGM(id,idx,loop,offset,loopStart,loopEnd);
      },
      fiber$playBGMID :function* _trc_T2MediaPlayer_f_playBGMID(_thread,id,idx,loop,offset,loopStart,loopEnd) {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        if (loop==null) {
          loop=false;
        }
        if (offset==null) {
          offset=0;
        }
        return Tonyu.globals.$t2MediaLib.playBGM(id,idx,loop,offset,loopStart,loopEnd);
        
      },
      stopBGMID :function _trc_T2MediaPlayer_stopBGMID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.stopBGM(id);
      },
      fiber$stopBGMID :function* _trc_T2MediaPlayer_f_stopBGMID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.stopBGM(id);
        
      },
      pauseBGMID :function _trc_T2MediaPlayer_pauseBGMID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.pauseBGM(id);
      },
      fiber$pauseBGMID :function* _trc_T2MediaPlayer_f_pauseBGMID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.pauseBGM(id);
        
      },
      resumeBGMID :function _trc_T2MediaPlayer_resumeBGMID(id) {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        return Tonyu.globals.$t2MediaLib.resumeBGM(id);
      },
      fiber$resumeBGMID :function* _trc_T2MediaPlayer_f_resumeBGMID(_thread,id) {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        return Tonyu.globals.$t2MediaLib.resumeBGM(id);
        
      },
      getBGMVolumeID :function _trc_T2MediaPlayer_getBGMVolumeID(id) {
        var _this=this;
        var vol;
        
        vol = Tonyu.globals.$t2MediaLib.getBGMVolume(id);
        
        return typeof  vol==="number"?vol*128:vol;
      },
      fiber$getBGMVolumeID :function* _trc_T2MediaPlayer_f_getBGMVolumeID(_thread,id) {
        var _this=this;
        var vol;
        
        vol = Tonyu.globals.$t2MediaLib.getBGMVolume(id);
        
        return typeof  vol==="number"?vol*128:vol;
        
      },
      setBGMVolumeID :function _trc_T2MediaPlayer_setBGMVolumeID(id,vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setBGMVolume(id,Tonyu.globals.$t2MediaLib.getBGMVolume(id));
          
        }
        return Tonyu.globals.$t2MediaLib.setBGMVolume(id,vol);
      },
      fiber$setBGMVolumeID :function* _trc_T2MediaPlayer_f_setBGMVolumeID(_thread,id,vol) {
        var _this=this;
        
        if (typeof  vol==="number") {
          vol/=128;
          if (vol<0) {
            vol=0;
          }
          
        } else {
          return Tonyu.globals.$t2MediaLib.setBGMVolume(id,Tonyu.globals.$t2MediaLib.getBGMVolume(id));
          
        }
        return Tonyu.globals.$t2MediaLib.setBGMVolume(id,vol);
        
      },
      getBGMTempoID :function _trc_T2MediaPlayer_getBGMTempoID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMTempo(id);
      },
      fiber$getBGMTempoID :function* _trc_T2MediaPlayer_f_getBGMTempoID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMTempo(id);
        
      },
      setBGMTempoID :function _trc_T2MediaPlayer_setBGMTempoID(id,tempo) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMTempo(id,tempo);
      },
      fiber$setBGMTempoID :function* _trc_T2MediaPlayer_f_setBGMTempoID(_thread,id,tempo) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMTempo(id,tempo);
        
      },
      getBGMPanID :function _trc_T2MediaPlayer_getBGMPanID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMPan(id);
      },
      fiber$getBGMPanID :function* _trc_T2MediaPlayer_f_getBGMPanID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMPan(id);
        
      },
      setBGMPanID :function _trc_T2MediaPlayer_setBGMPanID(id,pan) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMPan(id,pan);
      },
      fiber$setBGMPanID :function* _trc_T2MediaPlayer_f_setBGMPanID(_thread,id,pan) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMPan(id,pan);
        
      },
      isBGMLoopID :function _trc_T2MediaPlayer_isBGMLoopID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.isBGMLoop(id);
      },
      fiber$isBGMLoopID :function* _trc_T2MediaPlayer_f_isBGMLoopID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.isBGMLoop(id);
        
      },
      setBGMLoopID :function _trc_T2MediaPlayer_setBGMLoopID(id,loop) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoop(id,loop);
      },
      fiber$setBGMLoopID :function* _trc_T2MediaPlayer_f_setBGMLoopID(_thread,id,loop) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoop(id,loop);
        
      },
      getBGMLoopStartTimeID :function _trc_T2MediaPlayer_getBGMLoopStartTimeID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLoopStartTime(id);
      },
      fiber$getBGMLoopStartTimeID :function* _trc_T2MediaPlayer_f_getBGMLoopStartTimeID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLoopStartTime(id);
        
      },
      setBGMLoopStartTimeID :function _trc_T2MediaPlayer_setBGMLoopStartTimeID(id,loopStart) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoopStartTime(id,loopStart);
      },
      fiber$setBGMLoopStartTimeID :function* _trc_T2MediaPlayer_f_setBGMLoopStartTimeID(_thread,id,loopStart) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoopStartTime(id,loopStart);
        
      },
      getBGMLoopEndTimeID :function _trc_T2MediaPlayer_getBGMLoopEndTimeID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLoopEndTime(id);
      },
      fiber$getBGMLoopEndTimeID :function* _trc_T2MediaPlayer_f_getBGMLoopEndTimeID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLoopEndTime(id);
        
      },
      setBGMLoopEndTimeID :function _trc_T2MediaPlayer_setBGMLoopEndTimeID(id,loopEnd) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoopEndTime(id,loopEnd);
      },
      fiber$setBGMLoopEndTimeID :function* _trc_T2MediaPlayer_f_setBGMLoopEndTimeID(_thread,id,loopEnd) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setBGMLoopEndTime(id,loopEnd);
        
      },
      getBGMCurrentTimeID :function _trc_T2MediaPlayer_getBGMCurrentTimeID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMCurrentTime(id);
      },
      fiber$getBGMCurrentTimeID :function* _trc_T2MediaPlayer_f_getBGMCurrentTimeID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMCurrentTime(id);
        
      },
      getBGMLengthID :function _trc_T2MediaPlayer_getBGMLengthID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLength(id);
      },
      fiber$getBGMLengthID :function* _trc_T2MediaPlayer_f_getBGMLengthID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMLength(id);
        
      },
      getPlayingBGMNameID :function _trc_T2MediaPlayer_getPlayingBGMNameID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getPlayingBGMName(id);
      },
      fiber$getPlayingBGMNameID :function* _trc_T2MediaPlayer_f_getPlayingBGMNameID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getPlayingBGMName(id);
        
      },
      setOnBGMEndListenerID :function _trc_T2MediaPlayer_setOnBGMEndListenerID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setOnBGMEndListener(id);
      },
      fiber$setOnBGMEndListenerID :function* _trc_T2MediaPlayer_f_setOnBGMEndListenerID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setOnBGMEndListener(id);
        
      },
      getPlayingBGMStateID :function _trc_T2MediaPlayer_getPlayingBGMStateID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getPlayingBGMState(id);
      },
      fiber$getPlayingBGMStateID :function* _trc_T2MediaPlayer_f_getPlayingBGMStateID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getPlayingBGMState(id);
        
      },
      getBGMPicoAudioID :function _trc_T2MediaPlayer_getBGMPicoAudioID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMPicoAudio(id);
      },
      fiber$getBGMPicoAudioID :function* _trc_T2MediaPlayer_f_getBGMPicoAudioID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getBGMPicoAudio(id);
        
      },
      isTagLoopID :function _trc_T2MediaPlayer_isTagLoopID(id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.isTagLoop(id);
      },
      fiber$isTagLoopID :function* _trc_T2MediaPlayer_f_isTagLoopID(_thread,id) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.isTagLoop(id);
        
      },
      setTagLoopID :function _trc_T2MediaPlayer_setTagLoopID(id,isTagLoop) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setTagLoop(id,isTagLoop);
      },
      fiber$setTagLoopID :function* _trc_T2MediaPlayer_f_setTagLoopID(_thread,id,isTagLoop) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setTagLoop(id,isTagLoop);
        
      },
      loadAudio :function _trc_T2MediaPlayer_loadAudio(idx,src) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.loadAudio(idx,src);
        while (Tonyu.globals.$t2MediaLib.getAudioData(idx)==null) {
          _this.update();
        }
      },
      fiber$loadAudio :function* _trc_T2MediaPlayer_f_loadAudio(_thread,idx,src) {
        var _this=this;
        
        Tonyu.globals.$t2MediaLib.loadAudio(idx,src);
        while (Tonyu.globals.$t2MediaLib.getAudioData(idx)==null) {
          (yield* _this.fiber$update(_thread));
        }
        
      },
      playAudio :function _trc_T2MediaPlayer_playAudio(idx,loop,startTime) {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        if (loop==null) {
          loop=false;
        }
        if (startTime==null) {
          startTime=0;
        }
        return Tonyu.globals.$t2MediaLib.playAudio(idx,loop,startTime);
      },
      fiber$playAudio :function* _trc_T2MediaPlayer_f_playAudio(_thread,idx,loop,startTime) {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        if (loop==null) {
          loop=false;
        }
        if (startTime==null) {
          startTime=0;
        }
        return Tonyu.globals.$t2MediaLib.playAudio(idx,loop,startTime);
        
      },
      stopAudio :function _trc_T2MediaPlayer_stopAudio() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.stopAudio();
      },
      fiber$stopAudio :function* _trc_T2MediaPlayer_f_stopAudio(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.stopAudio();
        
      },
      pauseAudio :function _trc_T2MediaPlayer_pauseAudio() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.pauseAudio();
      },
      fiber$pauseAudio :function* _trc_T2MediaPlayer_f_pauseAudio(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.pauseAudio();
        
      },
      resumeAudio :function _trc_T2MediaPlayer_resumeAudio() {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        return Tonyu.globals.$t2MediaLib.resumeAudio();
      },
      fiber$resumeAudio :function* _trc_T2MediaPlayer_f_resumeAudio(_thread) {
        var _this=this;
        
        if (_this.mute) {
          return _this;
        }
        return Tonyu.globals.$t2MediaLib.resumeAudio();
        
      },
      setAudioVolume :function _trc_T2MediaPlayer_setAudioVolume(vol) {
        var _this=this;
        
        vol=vol/128;
        if (vol>1) {
          vol=1;
        } else {
          if (vol<0) {
            vol=0;
          }
        }
        return Tonyu.globals.$t2MediaLib.setAudioVolume(vol);
      },
      fiber$setAudioVolume :function* _trc_T2MediaPlayer_f_setAudioVolume(_thread,vol) {
        var _this=this;
        
        vol=vol/128;
        if (vol>1) {
          vol=1;
        } else {
          if (vol<0) {
            vol=0;
          }
        }
        return Tonyu.globals.$t2MediaLib.setAudioVolume(vol);
        
      },
      setAudioTempo :function _trc_T2MediaPlayer_setAudioTempo(tempo) {
        var _this=this;
        
        if (tempo>4) {
          tempo=4;
        } else {
          if (tempo<0.5) {
            tempo=0.5;
          }
        }
        return Tonyu.globals.$t2MediaLib.setAudioTempo(tempo);
      },
      fiber$setAudioTempo :function* _trc_T2MediaPlayer_f_setAudioTempo(_thread,tempo) {
        var _this=this;
        
        if (tempo>4) {
          tempo=4;
        } else {
          if (tempo<0.5) {
            tempo=0.5;
          }
        }
        return Tonyu.globals.$t2MediaLib.setAudioTempo(tempo);
        
      },
      setAudioPosition :function _trc_T2MediaPlayer_setAudioPosition(time) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setAudioPosition(time);
      },
      fiber$setAudioPosition :function* _trc_T2MediaPlayer_f_setAudioPosition(_thread,time) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.setAudioPosition(time);
        
      },
      getAudioCurrentTime :function _trc_T2MediaPlayer_getAudioCurrentTime() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getAudioCurrentTime();
      },
      fiber$getAudioCurrentTime :function* _trc_T2MediaPlayer_f_getAudioCurrentTime(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getAudioCurrentTime();
        
      },
      getAudioLength :function _trc_T2MediaPlayer_getAudioLength() {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getAudioLength();
      },
      fiber$getAudioLength :function* _trc_T2MediaPlayer_f_getAudioLength(_thread) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getAudioLength();
        
      },
      getAudioData :function _trc_T2MediaPlayer_getAudioData(idx) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getAudioData(idx);
      },
      fiber$getAudioData :function* _trc_T2MediaPlayer_f_getAudioData(_thread,idx) {
        var _this=this;
        
        return Tonyu.globals.$t2MediaLib.getAudioData(idx);
        
      },
      resetSEFrame :function _trc_T2MediaPlayer_resetSEFrame() {
        var _this=this;
        
        _this.seStaredAtThisFrame={};
      },
      fiber$resetSEFrame :function* _trc_T2MediaPlayer_f_resetSEFrame(_thread) {
        var _this=this;
        
        _this.seStaredAtThisFrame={};
        
      },
      initMMTimer :function _trc_T2MediaPlayer_initMMTimer() {
        var _this=this;
        
        if (_this.mmTimer) {
          return _this.mmTimer;
        }
        if (! _this.available) {
          return false;
        }
        _this.mmTimer=new Tonyu.classes.kernel.MMTimer({context: Tonyu.globals.$t2MediaLib.context});
        _this.mmTimer.on("interval",(function anonymous_12886(e) {
          
          _this.fireEvent("interval",e);
        }));
        return _this.mmTimer;
      },
      fiber$initMMTimer :function* _trc_T2MediaPlayer_f_initMMTimer(_thread) {
        var _this=this;
        
        if (_this.mmTimer) {
          return _this.mmTimer;
        }
        if (! _this.available) {
          return false;
        }
        _this.mmTimer=new Tonyu.classes.kernel.MMTimer({context: Tonyu.globals.$t2MediaLib.context});
        _this.mmTimer.on("interval",(function anonymous_12886(e) {
          
          _this.fireEvent("interval",e);
        }));
        return _this.mmTimer;
        
      },
      beep :function _trc_T2MediaPlayer_beep(options) {
        var _this=this;
        
        if (! _this.initMMTimer()) {
          return _this;
        }
        options=options||{};
        let b = new Tonyu.classes.kernel.Beep({mmTimer: _this.mmTimer});
        
        b.setVolume(options.vol||64);
        if (options.freq) {
          b.setFreq(options.freq);
        } else {
          if (options.scale) {
            b.setScale(options.scale);
          }
        }
        if (options.duration) {
          b.dieAfter(options.duration);
        }
        return b;
      },
      fiber$beep :function* _trc_T2MediaPlayer_f_beep(_thread,options) {
        var _this=this;
        
        if (! _this.initMMTimer()) {
          return _this;
        }
        options=options||{};
        let b = new Tonyu.classes.kernel.Beep({mmTimer: _this.mmTimer});
        
        b.setVolume(options.vol||64);
        if (options.freq) {
          b.setFreq(options.freq);
        } else {
          if (options.scale) {
            b.setScale(options.scale);
          }
        }
        if (options.duration) {
          b.dieAfter(options.duration);
        }
        return b;
        
      },
      checkTimer :function _trc_T2MediaPlayer_checkTimer() {
        var _this=this;
        
        if (_this.mmTimer) {
          _this.mmTimer.check();
        }
      },
      fiber$checkTimer :function* _trc_T2MediaPlayer_f_checkTimer(_thread) {
        var _this=this;
        
        if (_this.mmTimer) {
          _this.mmTimer.check();
        }
        
      },
      findEventHandlerClass :function _trc_T2MediaPlayer_findEventHandlerClass(type) {
        var _this=this;
        
        if (type==="interval") {
          _this.initMMTimer();
        }
        return __superClass.prototype.findEventHandlerClass.apply( _this, [type]);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initT2MediaPlayer":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"allClearSoundData":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"clearSoundData":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"allRemoveDecodedSoundData":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"removeDecodedSoundData":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getMasterVolume":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setMasterVolume":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"loadSound":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"__getter__available":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loadFromProject":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"decodeSound":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getSoundFileData":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getSoundDecodedData":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getCurrentTime":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getContext":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"playSE":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"stopSE":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"stopAllSE":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getSEMasterVolume":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setSEMasterVolume":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getSEVolume":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setSEVolume":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getSERate":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setSERate":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getSEPan":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setSEPan":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"isSELoop":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setSELoop":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getSELoopStartTime":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setSELoopStartTime":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getSELoopEndTime":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setSELoopEndTime":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"playBGM":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}},"stopBGM":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"pauseBGM":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"resumeBGM":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getBGMMasterVolume":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setBGMMasterVolume":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBGMVolume":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setBGMVolume":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBGMTempo":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setBGMTempo":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBGMPan":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setBGMPan":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"isBGMLoop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setBGMLoop":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBGMLoopStartTime":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setBGMLoopStartTime":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBGMLoopEndTime":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setBGMLoopEndTime":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBGMCurrentTime":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getBGMLength":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getPlayingBGMName":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setOnBGMEndListener":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getPlayingBGMState":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getBGMPicoAudio":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isTagLoop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setTagLoop":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBGMPlayerMax":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"allStopBGM":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"allResetBGM":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"playBGMID":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"stopBGMID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"pauseBGMID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"resumeBGMID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBGMVolumeID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setBGMVolumeID":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getBGMTempoID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setBGMTempoID":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getBGMPanID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setBGMPanID":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"isBGMLoopID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setBGMLoopID":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getBGMLoopStartTimeID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setBGMLoopStartTimeID":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getBGMLoopEndTimeID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setBGMLoopEndTimeID":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"getBGMCurrentTimeID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBGMLengthID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getPlayingBGMNameID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setOnBGMEndListenerID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getPlayingBGMStateID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getBGMPicoAudioID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"isTagLoopID":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setTagLoopID":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"loadAudio":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"playAudio":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"stopAudio":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"pauseAudio":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"resumeAudio":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setAudioVolume":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setAudioTempo":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setAudioPosition":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getAudioCurrentTime":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getAudioLength":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getAudioData":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"resetSEFrame":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initMMTimer":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"beep":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"checkTimer":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"findEventHandlerClass":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"bgmPlayerMax":{},"progressNoLog":{},"mute":{},"seStaredAtThisFrame":{},"mmTimer":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.PlainChar',
  shortName: 'PlainChar',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_PlainChar_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_PlainChar_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_PlainChar_initialize(x,y,p) {
        var _this=this;
        
        _this.layer=_this.layer||Tonyu.globals.$defaultLayer||Tonyu.globals.$mainLayer;
        _this._th=Tonyu.globals.$Boot.schedule(_this,"tMain",[]);
        _this.addToLayer();
        _this._scheduler=_this._scheduler||Tonyu.globals.$Scheduler;
        _this.crashScale=1;
        if (typeof  x=="object") {
          Tonyu.extend(_this,x);
        } else {
          if (typeof  x=="number") {
            _this.x=x;
            _this.y=y;
            _this.p=p;
            
          }
        }
      },
      draw :function _trc_PlainChar_draw(c) {
        var _this=this;
        
        _this.onDraw();
        if (_this._isInvisible) {
          return _this;
        }
      },
      setVisible :function _trc_PlainChar_setVisible(v) {
        var _this=this;
        
        _this._isInvisible=! v;
      },
      fiber$setVisible :function* _trc_PlainChar_f_setVisible(_thread,v) {
        var _this=this;
        
        _this._isInvisible=! v;
        
      },
      onDraw :function _trc_PlainChar_onDraw() {
        var _this=this;
        
      },
      fiber$onDraw :function* _trc_PlainChar_f_onDraw(_thread) {
        var _this=this;
        
        
      },
      update :function _trc_PlainChar_update() {
        var _this=this;
        
        _this.onUpdate();
        __superClass.prototype.update.apply( _this, []);
      },
      fiber$update :function* _trc_PlainChar_f_update(_thread) {
        var _this=this;
        
        (yield* _this.fiber$onUpdate(_thread));
        (yield* __superClass.prototype.fiber$update.apply( _this, [_thread]));
        
      },
      onUpdate :function _trc_PlainChar_onUpdate() {
        var _this=this;
        
      },
      fiber$onUpdate :function* _trc_PlainChar_f_onUpdate(_thread) {
        var _this=this;
        
        
      },
      tMain :function _trc_PlainChar_tMain() {
        var _this=this;
        
        _this.main();
        _this.die();
      },
      fiber$tMain :function* _trc_PlainChar_f_tMain(_thread) {
        var _this=this;
        
        (yield* _this.fiber$main(_thread));
        _this.die();
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setVisible":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"onDraw":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"update":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"onUpdate":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"tMain":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.SecretChar',
  shortName: 'SecretChar',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.PlainChar,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_SecretChar_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_SecretChar_f_main(_thread) {
        var _this=this;
        
        
      },
      draw :function _trc_SecretChar_draw(c) {
        var _this=this;
        
        _this.onDraw();
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.SpriteChar',
  shortName: 'SpriteChar',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.PlainChar,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_SpriteChar_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_SpriteChar_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_SpriteChar_initialize(x,y,p,f) {
        var _this=this;
        
        __superClass.apply( _this, [x,y,p]);
        _this.f=f;
        if (! _this.x) {
          _this.x=0;
        }
        if (! _this.y) {
          _this.y=0;
        }
        if (! _this.p) {
          _this.p=0;
        }
        if (typeof  _this.scaleX!="number") {
          _this.scaleX=1;
        }
      },
      draw :function _trc_SpriteChar_draw(c) {
        var _this=this;
        
        if (_this._isInvisible) {
          return _this;
        }
        _this.onDraw();
        _this.prepareImage();
        _this.drawSprite(_this.x,_this.y,_this.p,_this.f,_this.zOrder);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"f":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Map',
  shortName: 'T1Map',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Map,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_T1Map_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T1Map_f_main(_thread) {
        var _this=this;
        
        
      },
      setBGColor :function _trc_T1Map_setBGColor(c) {
        var _this=this;
        
        Tonyu.globals.$Screen.setBGColor(c);
      },
      fiber$setBGColor :function* _trc_T1Map_f_setBGColor(_thread,c) {
        var _this=this;
        
        Tonyu.globals.$Screen.setBGColor(c);
        
      },
      load :function _trc_T1Map_load(fileName) {
        var _this=this;
        var f;
        var o;
        
        f = _this.file("../maps/").rel(fileName);
        
        o = f.obj();
        
        _this.chipWidth=o.chipWidth;
        _this.chipHeight=o.chipHeight;
        _this.baseData=o.baseData;
        _this.mapTable=_this.conv(_this.baseData[0],o.pTable);
        _this.mapData=_this.mapTable;
        _this.row=_this.mapTable.length;
        _this.col=_this.mapTable[0].length;
        _this.mapOnTable=_this.conv(_this.baseData[1],o.pTable);
        _this.mapOnData=_this.mapOnTable;
        _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
        _this.initMap();
      },
      fiber$load :function* _trc_T1Map_f_load(_thread,fileName) {
        var _this=this;
        var f;
        var o;
        
        f = _this.file("../maps/").rel(fileName);
        
        o = f.obj();
        
        _this.chipWidth=o.chipWidth;
        _this.chipHeight=o.chipHeight;
        _this.baseData=o.baseData;
        _this.mapTable=(yield* _this.fiber$conv(_thread, _this.baseData[0], o.pTable));
        _this.mapData=_this.mapTable;
        _this.row=_this.mapTable.length;
        _this.col=_this.mapTable[0].length;
        _this.mapOnTable=(yield* _this.fiber$conv(_thread, _this.baseData[1], o.pTable));
        _this.mapOnData=_this.mapOnTable;
        _this.buf=$("<canvas>").attr({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
        (yield* _this.fiber$initMap(_thread));
        
      },
      conv :function _trc_T1Map_conv(mat,tbl) {
        var _this=this;
        var res;
        
        res = [];
        
        mat.forEach((function anonymous_955(row) {
          var rrow;
          
          rrow = [];
          
          res.push(rrow);
          row.forEach((function anonymous_1032(dat) {
            var t;
            
            t = tbl[dat[0]];
            
            if (t) {
              rrow.push(Tonyu.globals[t.name]+dat[1]);
            } else {
              rrow.push(dat[1]);
            }
          }));
        }));
        return res;
      },
      fiber$conv :function* _trc_T1Map_f_conv(_thread,mat,tbl) {
        var _this=this;
        var res;
        
        res = [];
        
        mat.forEach((function anonymous_955(row) {
          var rrow;
          
          rrow = [];
          
          res.push(rrow);
          row.forEach((function anonymous_1032(dat) {
            var t;
            
            t = tbl[dat[0]];
            
            if (t) {
              rrow.push(Tonyu.globals[t.name]+dat[1]);
            } else {
              rrow.push(dat[1]);
            }
          }));
        }));
        return res;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"setBGColor":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"load":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"conv":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"buf":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.T1Page',
  shortName: 'T1Page',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.PlainChar,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_T1Page_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_T1Page_f_main(_thread) {
        var _this=this;
        
        
      },
      initGlobals :function _trc_T1Page_initGlobals() {
        var _this=this;
        
        Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;
        Tonyu.globals.$Boot.setFrameRate(60);
        Tonyu.globals.$clBlack=_this.color(0,0,0);
        Tonyu.globals.$clRed=_this.color(255,0,0);
        Tonyu.globals.$clGreen=_this.color(0,255,0);
        Tonyu.globals.$clYellow=_this.color(255,255,0);
        Tonyu.globals.$clBlue=_this.color(0,0,255);
        Tonyu.globals.$clPink=_this.color(255,0,255);
        Tonyu.globals.$clAqua=_this.color(0,255,255);
        Tonyu.globals.$clWhite=_this.color(255,255,255);
        Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;
      },
      fiber$initGlobals :function* _trc_T1Page_f_initGlobals(_thread) {
        var _this=this;
        
        Tonyu.globals.$chars=Tonyu.globals.$Sprites.sprites;
        Tonyu.globals.$Boot.setFrameRate(60);
        Tonyu.globals.$clBlack=_this.color(0,0,0);
        Tonyu.globals.$clRed=_this.color(255,0,0);
        Tonyu.globals.$clGreen=_this.color(0,255,0);
        Tonyu.globals.$clYellow=_this.color(255,255,0);
        Tonyu.globals.$clBlue=_this.color(0,0,255);
        Tonyu.globals.$clPink=_this.color(255,0,255);
        Tonyu.globals.$clAqua=_this.color(0,255,255);
        Tonyu.globals.$clWhite=_this.color(255,255,255);
        Tonyu.globals.$mplayer=new Tonyu.classes.kernel.MediaPlayer;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"initGlobals":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.TextChar',
  shortName: 'TextChar',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.PlainChar,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_TextChar_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_TextChar_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_TextChar_initialize(xx,yy,t,c,s) {
        var _this=this;
        
        __superClass.apply( _this, [xx,yy]);
        _this.text=_this.text||"";
        _this.col=Tonyu.globals.$clWhite;
        _this.size=20;
        if (! _this.x) {
          _this.x=0;
        }
        if (! _this.y) {
          _this.y=0;
        }
        if (t) {
          _this.text=t;
        }
        if (c) {
          _this.fillStyle=c;
        }
        if (s) {
          _this.size=s;
        }
      },
      draw :function _trc_TextChar_draw(ctx) {
        var _this=this;
        
        if (_this._isInvisible) {
          return _this;
        }
        _this.onDraw();
        _this.drawText(_this.x,_this.y,_this.text,_this.col,_this.size);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"col":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.FrameManager',
  shortName: 'FrameManager',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [Tonyu.classes.kernel.SchedulerMod,Tonyu.classes.kernel.ParallelMod],
  methods: function (__superClass) {
    return {
      main :function _trc_FrameManager_main() {
        var _this=this;
        
        "field strict";
        
        
      },
      fiber$main :function* _trc_FrameManager_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
      },
      initialize :function _trc_FrameManager_initialize(params) {
        var _this=this;
        
        __superClass.apply( _this, [params]);
        _this.initSchedulerMod();
        _this.onStart();
        _this.parallel("loop_sched");
      },
      loop_sched :function _trc_FrameManager_loop_sched() {
        var _this=this;
        
        while (true) {
          _this.update();
        }
      },
      fiber$loop_sched :function* _trc_FrameManager_f_loop_sched(_thread) {
        var _this=this;
        
        while (true) {
          (yield* _this.fiber$update(_thread));
        }
        
      },
      setHandlers :function _trc_FrameManager_setHandlers() {
        var _this=this;
        
        if (_this.hBefore) {
          _this.hBefore.remove();
        }
        if (_this.hAfter) {
          _this.hAfter.remove();
        }
        _this.hBefore=_this._scheduler.on("beforeSteps",Tonyu.bindFunc(_this,_this.onBeforeMove));
        _this.hAfter=_this._scheduler.on("afterSteps",Tonyu.bindFunc(_this,_this.onAfterMove));
      },
      fiber$setHandlers :function* _trc_FrameManager_f_setHandlers(_thread) {
        var _this=this;
        
        if (_this.hBefore) {
          _this.hBefore.remove();
        }
        if (_this.hAfter) {
          _this.hAfter.remove();
        }
        _this.hBefore=_this._scheduler.on("beforeSteps",Tonyu.bindFunc(_this,_this.onBeforeMove));
        _this.hAfter=_this._scheduler.on("afterSteps",Tonyu.bindFunc(_this,_this.onAfterMove));
        
      },
      __setter___scheduler :function _trc_FrameManager___setter___scheduler(v) {
        var _this=this;
        
        if (_this.__scheduler===v) {
          return _this;
        }
        _this.__scheduler=v;
        _this.setHandlers();
      },
      __getter___scheduler :function _trc_FrameManager___getter___scheduler() {
        var _this=this;
        
        return _this.__scheduler;
      },
      onStart :function _trc_FrameManager_onStart() {
        var _this=this;
        
        if (typeof  _this.start==="function") {
          _this.start();
        }
      },
      fiber$onStart :function* _trc_FrameManager_f_onStart(_thread) {
        var _this=this;
        
        if (typeof  _this.start==="function") {
          _this.start();
        }
        
      },
      onBeforeMove :function _trc_FrameManager_onBeforeMove() {
        var _this=this;
        
        if (typeof  _this.beforeMove==="function") {
          _this.beforeMove();
        }
      },
      fiber$onBeforeMove :function* _trc_FrameManager_f_onBeforeMove(_thread) {
        var _this=this;
        
        if (typeof  _this.beforeMove==="function") {
          _this.beforeMove();
        }
        
      },
      onAfterMove :function _trc_FrameManager_onAfterMove() {
        var _this=this;
        
        if (typeof  _this.afterMove==="function") {
          _this.afterMove();
        }
      },
      fiber$onAfterMove :function* _trc_FrameManager_f_onAfterMove(_thread) {
        var _this=this;
        
        if (typeof  _this.afterMove==="function") {
          _this.afterMove();
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"loop_sched":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setHandlers":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter___scheduler":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter___scheduler":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"onStart":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"onBeforeMove":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"onAfterMove":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"__scheduler":{},"beforeMove":{},"afterMove":{},"start":{},"hBefore":{},"hAfter":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.APad',
  shortName: 'APad',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_APad_main() {
        var _this=this;
        
        if (! _this.auto) {
          _this.loop();
        }
      },
      fiber$main :function* _trc_APad_f_main(_thread) {
        var _this=this;
        
        if (! _this.auto) {
          (yield* _this.fiber$loop(_thread));
        }
        
      },
      initialize :function _trc_APad_initialize(p) {
        var _this=this;
        
        p=p||{};
        if (! p.alpha) {
          p.alpha=128;
        }
        __superClass.apply( _this, [p]);
        _this.vx=0;
        _this.vy=0;
        _this.outerRadius=_this.outerRadius||50;
        _this.fillStyle=_this.fillStyle||"white";
        _this.strokeStyle=_this.strokeStyle||"white";
        _this.innerRadius=_this.innerRadius||10;
        if (typeof  _this.keys==="object") {
          _this.leftKey=_this.keys.left;
          _this.rightKey=_this.keys.right;
          _this.upKey=_this.keys.up;
          _this.downKey=_this.keys.down;
          
        }
        _this.keySpeed=_this.keySpeed||15/50;
        _this.leftKey=_this.leftKey||"left";
        _this.rightKey=_this.rightKey||"right";
        _this.upKey=_this.upKey||"up";
        _this.downKey=_this.downKey||"down";
        _this.decay=(typeof  _this.decay)==="number"?_this.decay:0.8;
        _this.velocity=new Tonyu.classes.kernel.Vec3View(_this,{x: "vx",y: "vy",z: "vz"});
        if ((typeof  _this.x!=="number")||_this.x!==_this.x) {
          _this.x=Tonyu.globals.$screenWidth/2;
          
        }
        if ((typeof  _this.y!=="number")||_this.y!==_this.y) {
          _this.y=Tonyu.globals.$screenHeight-_this.outerRadius-_this.innerRadius;
          
        }
        _this.ix=_this.x;
        _this.iy=_this.y;
      },
      __getter__defaultLayer :function _trc_APad___getter__defaultLayer() {
        var _this=this;
        
        return Tonyu.globals.$frontLayer;
      },
      draw :function _trc_APad_draw(ctx) {
        var _this=this;
        
        if (_this.auto) {
          _this.ix=_this.x+_this.vx*_this.outerRadius;
          _this.iy=_this.y+_this.vy*_this.outerRadius;
          
        }
        ctx.save();
        ctx.globalAlpha=_this.alpha/255;
        ctx.fillStyle=_this.fillStyle+"";
        ctx.beginPath();
        ctx.arc(_this.ix,_this.iy,_this.innerRadius,0,Tonyu.globals.$Math.PI*2);
        ctx.closePath();
        ctx.fill();
        ctx.strokeStyle=_this.strokeStyle;
        ctx.beginPath();
        ctx.arc(_this.x,_this.y,_this.outerRadius,0,Tonyu.globals.$Math.PI*2);
        ctx.closePath();
        ctx.stroke();
        ctx.restore();
      },
      findTouch :function _trc_APad_findTouch() {
        var _this=this;
        var t;
        
        for ([t] of Tonyu.iterator2(Tonyu.globals.$touches,1)) {
          if ((! _this.touchRadius||_this.dist(t)<_this.touchRadius)&&t.touched==1) {
            return t;
            
          }
          
        }
      },
      loop :function _trc_APad_loop() {
        var _this=this;
        var vx;
        var vy;
        
        vx = 0;
        vy = 0;
        
        while (true) {
          if (! _this.t||_this.t.ended) {
            _this.t=_this.findTouch();
          }
          if (_this.t) {
            vx+=_this.t.vx;
            vy+=_this.t.vy;
            
          } else {
            vx*=_this.decay;
            vy*=_this.decay;
            
          }
          if (_this.getkey(_this.leftKey)) {
            vx-=_this.keySpeed*_this.outerRadius;
          }
          if (_this.getkey(_this.rightKey)) {
            vx+=_this.keySpeed*_this.outerRadius;
          }
          if (_this.getkey(_this.upKey)) {
            vy-=_this.keySpeed*_this.outerRadius;
          }
          if (_this.getkey(_this.downKey)) {
            vy+=_this.keySpeed*_this.outerRadius;
          }
          _this.d=_this.dist(vx,vy);
          if (_this.d>_this.outerRadius) {
            vx=vx/_this.d*_this.outerRadius;
            vy=vy/_this.d*_this.outerRadius;
            
          }
          _this.ix=_this.x+vx;
          _this.iy=_this.y+vy;
          _this.vx=_this.clamp(vx/_this.outerRadius,- 1,1);
          _this.vy=_this.clamp(vy/_this.outerRadius,- 1,1);
          _this.update();
          
        }
      },
      fiber$loop :function* _trc_APad_f_loop(_thread) {
        var _this=this;
        var vx;
        var vy;
        
        vx = 0;
        vy = 0;
        
        while (true) {
          if (! _this.t||_this.t.ended) {
            _this.t=_this.findTouch();
          }
          if (_this.t) {
            vx+=_this.t.vx;
            vy+=_this.t.vy;
            
          } else {
            vx*=_this.decay;
            vy*=_this.decay;
            
          }
          if (_this.getkey(_this.leftKey)) {
            vx-=_this.keySpeed*_this.outerRadius;
          }
          if (_this.getkey(_this.rightKey)) {
            vx+=_this.keySpeed*_this.outerRadius;
          }
          if (_this.getkey(_this.upKey)) {
            vy-=_this.keySpeed*_this.outerRadius;
          }
          if (_this.getkey(_this.downKey)) {
            vy+=_this.keySpeed*_this.outerRadius;
          }
          _this.d=_this.dist(vx,vy);
          if (_this.d>_this.outerRadius) {
            vx=vx/_this.d*_this.outerRadius;
            vy=vy/_this.d*_this.outerRadius;
            
          }
          _this.ix=_this.x+vx;
          _this.iy=_this.y+vy;
          _this.vx=_this.clamp(vx/_this.outerRadius,- 1,1);
          _this.vy=_this.clamp(vy/_this.outerRadius,- 1,1);
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      __getter__speed :function _trc_APad___getter__speed() {
        var _this=this;
        
        return _this.sqrt(_this.vx*_this.vx+_this.vy*_this.vy);
      },
      __getter__direction :function _trc_APad___getter__direction() {
        var _this=this;
        
        return _this.atanxy(_this.vx,_this.vy);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__defaultLayer":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"findTouch":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__speed":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__direction":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"auto":{},"vx":{},"vy":{},"outerRadius":{},"strokeStyle":{},"innerRadius":{},"keys":{},"leftKey":{},"rightKey":{},"upKey":{},"downKey":{},"keySpeed":{},"decay":{},"velocity":{},"ix":{},"iy":{},"touchRadius":{},"t":{},"d":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Button',
  shortName: 'Button',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Button_main() {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        
        if (_this.key) {
          _this.on("keyDown",_this.key,(function anonymous_1776(keyEvent) {
            
            if (_this.disabled) {
              return _this;
            }
            _this.doStartClick();
            keyEvent.on("up",Tonyu.bindFunc(_this,_this.doEndClick));
          }));
          
        }
        _this.on("touch",(function anonymous_1909(touchEvent) {
          var f;
          
          if (_this.disabled) {
            return _this;
          }
          f = touchEvent.finger;
          
          _this.doStartClick();
          f.on("end",Tonyu.bindFunc(_this,_this.doEndClick));
        }));
      },
      fiber$main :function* _trc_Button_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
        
        
        
        if (_this.key) {
          _this.on("keyDown",_this.key,(function anonymous_1776(keyEvent) {
            
            if (_this.disabled) {
              return _this;
            }
            _this.doStartClick();
            keyEvent.on("up",Tonyu.bindFunc(_this,_this.doEndClick));
          }));
          
        }
        _this.on("touch",(function anonymous_1909(touchEvent) {
          var f;
          
          if (_this.disabled) {
            return _this;
          }
          f = touchEvent.finger;
          
          _this.doStartClick();
          f.on("end",Tonyu.bindFunc(_this,_this.doEndClick));
        }));
        
      },
      __getter__clickedStyle :function _trc_Button___getter__clickedStyle() {
        var _this=this;
        
        return (_this.clickedEffect&&_this.clickedEffect.strokeStyle);
      },
      __setter__clickedStyle :function _trc_Button___setter__clickedStyle(v) {
        var _this=this;
        
        _this.clickedEffect=_this.clickedEffect||{};
        _this.clickedEffect.strokeStyle=v;
      },
      __getter__effect :function _trc_Button___getter__effect() {
        var _this=this;
        
        return _this.clickedEffect;
      },
      __setter__effect :function _trc_Button___setter__effect(v) {
        var _this=this;
        
        _this.clickedEffect=v;
      },
      __getter__disabledStrokeStyle :function _trc_Button___getter__disabledStrokeStyle() {
        var _this=this;
        
        return (_this.disabledEffect&&_this.disabledEffect.strokeStyle);
      },
      __setter__disabledStrokeStyle :function _trc_Button___setter__disabledStrokeStyle(v) {
        var _this=this;
        
        _this.disabledEffect=_this.disabledEffect||{};
        _this.disabledEffect.strokeStyle=v;
      },
      initialize :function _trc_Button_initialize(options) {
        var _this=this;
        
        options=options||{};
        options.layer=options.layer||Tonyu.globals.$frontLayer;
        __superClass.apply( _this, [options]);
        _this.fillStyle=_this.fillStyle||"rgb(179,255,142)";
        _this.strokeStyle=_this.strokeStyle||"black";
        _this.alpha=typeof  (_this.alpha)=="number"?_this.alpha:255;
        _this.padding=typeof  (_this.padding)=="number"?_this.padding:5;
        _this.width=_this.width||Tonyu.globals.$screenWidth-100;
        _this.height=_this.height||50;
        _this.left=typeof  (_this.left)=="number"?_this.left:typeof  (_this.x)=="number"?_this.x-_this.width/2:50;
        _this.top=typeof  (_this.top)=="number"?_this.top:typeof  (_this.y)=="number"?_this.y-_this.height/2:50;
        _this.x=_this.left+_this.width/2;
        _this.y=_this.top+_this.height/2;
        _this.clickedEffect=_this.clickedEffect||{strokeStyle: "white"};
        _this.disabledEffect=_this.disabledEffect||{strokeStyle: "#ddd"};
        _this.__binited=true;
      },
      __getter__curEffect :function _trc_Button___getter__curEffect() {
        var _this=this;
        var base;
        
        base = {fillStyle: _this.fillStyle,strokeStyle: _this.strokeStyle,alpha: _this.alpha,padding: _this.padding,width: _this.width,height: _this.height};
        
        if (_this.disabled) {
          Tonyu.extend(base,_this.disabledEffect);
          
        } else {
          if (_this.clicked) {
            Tonyu.extend(base,_this.clickedEffect);
            
          }
        }
        return base;
      },
      handleClickEvent :function _trc_Button_handleClickEvent() {
        var _this=this;
        
        _this.fireEvent("click");
        if (typeof  _this.onClick==="function") {
          _this.onClick(_this);
        }
      },
      fiber$handleClickEvent :function* _trc_Button_f_handleClickEvent(_thread) {
        var _this=this;
        
        _this.fireEvent("click");
        if (typeof  _this.onClick==="function") {
          _this.onClick(_this);
        }
        
      },
      doStartClick :function _trc_Button_doStartClick() {
        var _this=this;
        
        _this._clicked=Tonyu.globals.$frameCount;
        Tonyu.classes.kernel.Button.last=_this;
        if (_this.clickTiming!=="release") {
          _this.handleClickEvent();
        }
        if (_this.autoRepeat) {
          if (_this._arth) {
            _this._arth.kill();
          }
          _this._arth=_this.parallel("procAR");
          
        }
      },
      fiber$doStartClick :function* _trc_Button_f_doStartClick(_thread) {
        var _this=this;
        
        _this._clicked=Tonyu.globals.$frameCount;
        Tonyu.classes.kernel.Button.last=_this;
        if (_this.clickTiming!=="release") {
          (yield* _this.fiber$handleClickEvent(_thread));
        }
        if (_this.autoRepeat) {
          if (_this._arth) {
            _this._arth.kill();
          }
          _this._arth=_this.parallel("procAR");
          
        }
        
      },
      doEndClick :function _trc_Button_doEndClick() {
        var _this=this;
        
        _this.fireEvent("release");
        if (_this.clickTiming==="release") {
          _this.handleClickEvent();
        }
        _this._clicked=0;
        if (_this._arth) {
          _this._arth.kill();
        }
      },
      fiber$doEndClick :function* _trc_Button_f_doEndClick(_thread) {
        var _this=this;
        
        _this.fireEvent("release");
        if (_this.clickTiming==="release") {
          (yield* _this.fiber$handleClickEvent(_thread));
        }
        _this._clicked=0;
        if (_this._arth) {
          _this._arth.kill();
        }
        
      },
      procAR :function _trc_Button_procAR() {
        var _this=this;
        
        _this.updateEx(_this.autoRepeat);
        while (true) {
          _this.handleClickEvent();
          _this.update();
          
        }
      },
      fiber$procAR :function* _trc_Button_f_procAR(_thread) {
        var _this=this;
        
        (yield* _this.fiber$updateEx(_thread, _this.autoRepeat));
        while (true) {
          (yield* _this.fiber$handleClickEvent(_thread));
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      getCrashRect :function _trc_Button_getCrashRect() {
        var _this=this;
        
        return {x: _this.left+_this.width/2,y: _this.top+_this.height/2,width: _this.width,height: _this.height};
      },
      draw :function _trc_Button_draw(c) {
        var _this=this;
        var e;
        var eleft;
        var etop;
        var size;
        var f;
        var r;
        
        e = _this.curEffect;
        
        c.globalAlpha=e.alpha/255;
        c.fillStyle=e.fillStyle?e.fillStyle+"":"gray";
        c.strokeStyle=e.strokeStyle?e.strokeStyle+"":"black";
        eleft = _this.left;
        etop = _this.top;
        
        if (e.move) {
          eleft+=e.move.x||0;
          etop+=e.move.y||0;
          
        }
        c.fillRect(eleft,etop,e.width,e.height);
        c.strokeRect(eleft,etop,e.width,e.height);
        for (let i = 0;
         i<2 ; i++) {
          {
            size = e.height-e.padding*2;
            
            f = c.font.replace(/^[0-9\.]+px /,"");
            
            c.font=size+"px "+f;
            c.textBaseline="top";
            c.fillStyle=e.strokeStyle;
            r = c.measureText(_this.text);
            
            let maxWidth = e.width-e.padding*2;
            
            if (i>=1||r.width<=maxWidth) {
              break;
              
            }
            e.padding+=size/2*(1-maxWidth/r.width);
          }
        }
        c.fillText(_this.text,eleft+e.width/2-r.width/2,etop+e.padding);
      },
      __getter__clicked :function _trc_Button___getter__clicked() {
        var _this=this;
        
        if (! _this._clicked) {
          return 0;
        }
        return Tonyu.globals.$frameCount-_this._clicked+1;
      },
      __getter__x :function _trc_Button___getter__x() {
        var _this=this;
        
        if (_this.__binited) {
          _this._x=_this.left+_this.width/2;
        }
        return _this._x;
      },
      __setter__x :function _trc_Button___setter__x(val) {
        var _this=this;
        
        if (_this.__binited) {
          _this.left+=(val-_this.x);
        }
        _this._x=val;
      },
      __getter__y :function _trc_Button___getter__y() {
        var _this=this;
        
        if (_this.__binited) {
          _this._y=_this.top+_this.height/2;
        }
        return _this._y;
      },
      __setter__y :function _trc_Button___setter__y(val) {
        var _this=this;
        
        if (_this.__binited) {
          _this.top+=val-_this.y;
        }
        _this._y=val;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"__getter__clickedStyle":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__clickedStyle":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__effect":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__effect":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__disabledStrokeStyle":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__disabledStrokeStyle":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__curEffect":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"handleClickEvent":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"doStartClick":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"doEndClick":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"procAR":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getCrashRect":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__clicked":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__x":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__x":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"__getter__y":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__y":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"padding":{},"left":{},"top":{},"width":{},"height":{},"text":{},"fillStyle":{},"strokeStyle":{},"clickedEffect":{},"disabledEffect":{},"disabled":{},"key":{},"autoRepeat":{},"onClick":{},"clickTiming":{},"_clicked":{},"_arth":{},"__binited":{},"_x":{},"_y":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.GameConsole',
  shortName: 'GameConsole',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_GameConsole_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_GameConsole_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_GameConsole_initialize(opt) {
        var _this=this;
        
        _this.extend(opt);
        _this.cw=_this.canvas.width();
        _this.ch=_this.canvas.height();
        Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites;
        Tonyu.globals.$Screen=_this.gameScreen=new Tonyu.classes.kernel.GameScreen({width: 465,height: 465,sprites: Tonyu.globals.$Sprites});
        Tonyu.globals.$FrontSprites=_this.sprites=new Tonyu.classes.kernel.Sprites;
        _this.sprites.add(_this.gameScreen);
        _this.cctx=_this.canvas[0].getContext("2d");
      },
      shouldDraw1x1 :function _trc_GameConsole_shouldDraw1x1(srcw,srch,dstw,dsth) {
        var _this=this;
        var larger;
        var smaller;
        
        larger = 200;
        
        smaller = 5;
        
        return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;
      },
      fiber$shouldDraw1x1 :function* _trc_GameConsole_f_shouldDraw1x1(_thread,srcw,srch,dstw,dsth) {
        var _this=this;
        var larger;
        var smaller;
        
        larger = 200;
        
        smaller = 5;
        
        return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;
        
      },
      layout :function _trc_GameConsole_layout() {
        var _this=this;
        var width;
        var height;
        var calcw;
        var calch;
        var marginw;
        var marginh;
        
        _this.cw=_this.canvas.width();
        _this.ch=_this.canvas.height();
        width = _this.gameScreen.width;
        
        height = _this.gameScreen.height;
        
        calcw = _this.ch/height*width;
        
        calch = _this.cw/width*height;
        
        if (calch>_this.ch) {
          calch=_this.ch;
        }
        if (calcw>_this.cw) {
          calcw=_this.cw;
        }
        if (_this.shouldDraw1x1(width,height,calcw,calch)) {
          calcw=width;
          calch=height;
          
        }
        marginw = Math.floor((_this.cw-calcw)/2);
        
        marginh = Math.floor((_this.ch-calch)/2);
        
        _this.gameScreen.setBounds({left: marginw,top: marginh,width: calcw,height: calch});
      },
      fiber$layout :function* _trc_GameConsole_f_layout(_thread) {
        var _this=this;
        var width;
        var height;
        var calcw;
        var calch;
        var marginw;
        var marginh;
        
        _this.cw=_this.canvas.width();
        _this.ch=_this.canvas.height();
        width = _this.gameScreen.width;
        
        height = _this.gameScreen.height;
        
        calcw = _this.ch/height*width;
        
        calch = _this.cw/width*height;
        
        if (calch>_this.ch) {
          calch=_this.ch;
        }
        if (calcw>_this.cw) {
          calcw=_this.cw;
        }
        if (_this.shouldDraw1x1(width,height,calcw,calch)) {
          calcw=width;
          calch=height;
          
        }
        marginw = Math.floor((_this.cw-calcw)/2);
        
        marginh = Math.floor((_this.ch-calch)/2);
        
        _this.gameScreen.setBounds({left: marginw,top: marginh,width: calcw,height: calch});
        
      },
      draw :function _trc_GameConsole_draw() {
        var _this=this;
        
        _this.layout();
        _this.sprites.draw(_this.canvas[0]);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"shouldDraw1x1":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"layout":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"cw":{},"canvas":{},"ch":{},"gameScreen":{},"sprites":{},"cctx":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.HTMLUI',
  shortName: 'HTMLUI',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [Tonyu.classes.kernel.JQExpr],
  methods: function (__superClass) {
    return {
      main :function _trc_HTMLUI_main() {
        var _this=this;
        
        "field strict";
        
        
      },
      fiber$main :function* _trc_HTMLUI_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
        
      },
      add :function _trc_HTMLUI_add(expr) {
        var _this=this;
        var expr;
        
        expr = new Tonyu.classes.kernel.ArgParser(arguments).toArray();
        
        if (expr.length==1&&_this.isArray(expr[0])) {
          expr=expr[0];
        }
        return _this.add2(_this.id,expr);
      },
      fiber$add :function* _trc_HTMLUI_f_add(_thread,expr) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var expr;
        
        expr = new Tonyu.classes.kernel.ArgParser(_arguments).toArray();
        
        if (expr.length==1&&_this.isArray(expr[0])) {
          expr=expr[0];
        }
        return yield* _this.fiber$add2(_thread, _this.id, expr);
        
        
      },
      initialize :function _trc_HTMLUI_initialize(param) {
        var _this=this;
        var body;
        var bid;
        
        __superClass.apply( _this, [param]);
        _this.screen=_this.screen||Tonyu.globals.$Screen;
        body = $(document.body);
        
        if (! body.attr("id")) {
          body.attr({id: _this.genid()});
        }
        bid = body.attr("id");
        
        if (! _this.content) {
          _this.id=_this.add2(bid,["div"]);
        } else {
          if (typeof  _this.content==="string") {
            _this.id=_this.add2(bid,[_this.content]);
          } else {
            _this.id=_this.add2(bid,_this.content);
          }
        }
        document.body.appendChild($("#"+_this.id)[0]);
        _this.fit();
        Tonyu.globals.$uiScreen.on("resize",(function anonymous_908() {
          
          _this.fit();
        }));
      },
      toUI :function _trc_HTMLUI_toUI(x,y) {
        var _this=this;
        var sc;
        var scale;
        var left;
        var top;
        
        sc = _this.screen;
        
        scale = sc.scaleX;
        
        left = sc.x+((- sc.width/2+x)*scale);
        
        top = sc.y+((- sc.height/2+y)*scale);
        
        return {left: left,top: top};
      },
      fiber$toUI :function* _trc_HTMLUI_f_toUI(_thread,x,y) {
        var _this=this;
        var sc;
        var scale;
        var left;
        var top;
        
        sc = _this.screen;
        
        scale = sc.scaleX;
        
        left = sc.x+((- sc.width/2+x)*scale);
        
        top = sc.y+((- sc.height/2+y)*scale);
        
        return {left: left,top: top};
        
      },
      fit :function _trc_HTMLUI_fit() {
        var _this=this;
        var sc;
        var scale;
        var u1;
        var u2;
        var c;
        var left;
        var top;
        
        sc = _this.screen;
        
        scale = sc.scaleX;
        
        u1 = _this.toUI(_this.left,_this.top);
        
        u2 = _this.toUI(_this.left+_this.width,_this.top+_this.height);
        
        c = {left: (u1.left+u2.left)/2,top: (u1.top+u2.top)/2};
        
        left = c.left-(u2.left-u1.left)/2/scale;
        
        top = c.top-(u2.top-u1.top)/2/scale;
        
        $("#"+_this.id).css({position: "absolute",width: (_this.width)+"px",height: (_this.height)+"px",left: left,top: top,transform: "scale("+scale+")"});
      },
      fiber$fit :function* _trc_HTMLUI_f_fit(_thread) {
        var _this=this;
        var sc;
        var scale;
        var u1;
        var u2;
        var c;
        var left;
        var top;
        
        sc = _this.screen;
        
        scale = sc.scaleX;
        
        u1=yield* _this.fiber$toUI(_thread, _this.left, _this.top);
        
        u2=yield* _this.fiber$toUI(_thread, _this.left+_this.width, _this.top+_this.height);
        
        c = {left: (u1.left+u2.left)/2,top: (u1.top+u2.top)/2};
        
        left = c.left-(u2.left-u1.left)/2/scale;
        
        top = c.top-(u2.top-u1.top)/2/scale;
        
        $("#"+_this.id).css({position: "absolute",width: (_this.width)+"px",height: (_this.height)+"px",left: left,top: top,transform: "scale("+scale+")"});
        
      },
      checkExists :function _trc_HTMLUI_checkExists(name) {
        var _this=this;
        
        if (! _this.name2id[name]) {
          _this.print(_this.name2id);
          throw new Error("name="+name+" is not found");
          
          
        }
        return $("#"+_this.name2id[name]);
      },
      fiber$checkExists :function* _trc_HTMLUI_f_checkExists(_thread,name) {
        var _this=this;
        
        if (! _this.name2id[name]) {
          _this.print(_this.name2id);
          throw new Error("name="+name+" is not found");
          
          
        }
        return $("#"+_this.name2id[name]);
        
      },
      getValue :function _trc_HTMLUI_getValue(name) {
        var _this=this;
        
        if (! _this.name2id) {
          return "";
        }
        return _this.checkExists(name).val();
      },
      fiber$getValue :function* _trc_HTMLUI_f_getValue(_thread,name) {
        var _this=this;
        
        if (! _this.name2id) {
          return "";
        }
        return _this.checkExists(name).val();
        
      },
      setValue :function _trc_HTMLUI_setValue(name,value) {
        var _this=this;
        
        if (! _this.name2id) {
          return "";
        }
        return _this.checkExists(name).val(value);
      },
      fiber$setValue :function* _trc_HTMLUI_f_setValue(_thread,name,value) {
        var _this=this;
        
        if (! _this.name2id) {
          return "";
        }
        return _this.checkExists(name).val(value);
        
      },
      hasFile :function _trc_HTMLUI_hasFile(name) {
        var _this=this;
        
        if (! _this.name2id) {
          return "";
        }
        let files = _this.checkExists(name)[0].files;
        
        if (! files) {
          return 0;
        }
        return files.length;
      },
      fiber$hasFile :function* _trc_HTMLUI_f_hasFile(_thread,name) {
        var _this=this;
        
        if (! _this.name2id) {
          return "";
        }
        let files = _this.checkExists(name)[0].files;
        
        if (! files) {
          return 0;
        }
        return files.length;
        
      },
      getFile :function _trc_HTMLUI_getFile(name) {
        var _this=this;
        
        if (! _this.name2id) {
          return "";
        }
        return new Promise((function anonymous_2338(s) {
          
          let files = _this.checkExists(name)[0].files;
          
          if (! files) {
            s();
          }
          let f = files[0];
          
          if (! f) {
            s();
          }
          let rd = new FileReader;
          
          rd.onload=(function anonymous_2517(e) {
            
            s({name: f.name,dataURL: e.target.result});
          });
          rd.readAsDataURL(f);
        }));
      },
      fiber$getFile :function* _trc_HTMLUI_f_getFile(_thread,name) {
        var _this=this;
        
        if (! _this.name2id) {
          return "";
        }
        return new Promise((function anonymous_2338(s) {
          
          let files = _this.checkExists(name)[0].files;
          
          if (! files) {
            s();
          }
          let f = files[0];
          
          if (! f) {
            s();
          }
          let rd = new FileReader;
          
          rd.onload=(function anonymous_2517(e) {
            
            s({name: f.name,dataURL: e.target.result});
          });
          rd.readAsDataURL(f);
        }));
        
      },
      copyToClipboard :function _trc_HTMLUI_copyToClipboard(name) {
        var _this=this;
        
        navigator.clipboard.writeText(_this.getValue(name));
      },
      fiber$copyToClipboard :function* _trc_HTMLUI_f_copyToClipboard(_thread,name) {
        var _this=this;
        
        navigator.clipboard.writeText(_this.getValue(name));
        
      },
      die :function _trc_HTMLUI_die() {
        var _this=this;
        
        __superClass.prototype.die.apply( _this, []);
        $("#"+_this.id).remove();
      },
      loop :function _trc_HTMLUI_loop() {
        var _this=this;
        var k;
        
        k = _this.toUI(_this.left,_this.top);
        
        while (true) {
          _this.fit();
          _this.update();
          
        }
      },
      fiber$loop :function* _trc_HTMLUI_f_loop(_thread) {
        var _this=this;
        var k;
        
        k=yield* _this.fiber$toUI(_thread, _this.left, _this.top);
        
        while (true) {
          (yield* _this.fiber$fit(_thread));
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"add":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"toUI":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"fit":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"checkExists":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getValue":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"setValue":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"hasFile":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getFile":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"copyToClipboard":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"die":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"left":{},"top":{},"width":{},"height":{},"screen":{},"id":{},"content":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Label',
  shortName: 'Label',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Label_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_Label_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_Label_initialize(x,y,f) {
        var _this=this;
        
        __superClass.apply( _this, [x,y,- 1]);
        if (x==null) {
          x=50;
        }
        if (y==null) {
          y=50;
        }
        if (typeof  _this.template!=="string"&&_this._text==null) {
          _this.text="text";
          
        }
      },
      __getter__defaultLayer :function _trc_Label___getter__defaultLayer() {
        var _this=this;
        
        return Tonyu.globals.$frontLayer;
      },
      __getter__text :function _trc_Label___getter__text() {
        var _this=this;
        
        if (typeof  _this.template!=="string") {
          return _this._text;
        }
        return _this.template.replace(/[\$\@][A-Za-z0-9_\.]* ?/g,(function anonymous_440(v) {
          
          v=v.replace(/ $/,"");
          if (v=="") {
            return "$";
          }
          if (v.match(/^@/)) {
            return _this.exapndVal(_this.target,v.substring(1).split("."));
            
          } else {
            return _this.expandVal(Tonyu.globals,v.split("."));
            
          }
        }));
      },
      expandVal :function _trc_Label_expandVal(obj,flds) {
        var _this=this;
        
        while (flds.length>0) {
          if (! obj) {
            return "";
          }
          obj=obj[flds.shift()];
          
        }
        return obj;
      },
      fiber$expandVal :function* _trc_Label_f_expandVal(_thread,obj,flds) {
        var _this=this;
        
        while (flds.length>0) {
          if (! obj) {
            return "";
          }
          obj=obj[flds.shift()];
          
        }
        return obj;
        
      },
      __setter__text :function _trc_Label___setter__text(v) {
        var _this=this;
        
        delete _this.template;
        _this._text=v;
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"__getter__defaultLayer":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__getter__text":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"expandVal":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"__setter__text":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"template":{},"_text":{},"exapndVal":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MapEditor',
  shortName: 'MapEditor',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_MapEditor_main() {
        var _this=this;
        
        Tonyu.globals.$Screen.resize(480,640);
        _this.loadMode=false;
        _this.fileExist=false;
        Tonyu.globals.$Boot.on("stop",(function anonymous_127(e) {
          
          if (_this.modified) {
            e.preventDefault();
            _this.parallel(Tonyu.bindFunc(_this,_this.st),e);
            
          }
        }));
        _this.print("map file(s)");
        _this.fileList=_this.file("../maps/");
        if (_this.fileList.exists()) {
          _this.fileList.recursive((function a(f) {
            
            _this.print(f.name());
            _this.fileExist=true;
          }));
          
        }
        if (_this.fileExist) {
          _this.print("Load Data?: Y or N");
          while (true) {
            if (_this.getkey("y")>0) {
              _this.loadMode=true;
              break;
              
              
            }
            if (_this.getkey("n")>0) {
              _this.loadMode=false;
              break;
              
              
            }
            _this.update();
            
          }
          if (_this.loadMode) {
            _this.fileName=_this.prompt("Input json file (*.json)","map.json");
            if (_this.fileName) {
              _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
              
            }
            if (_this.mapDataFile.obj()) {
              _this.baseData=_this.mapDataFile.obj();
              _this.loadedFile=_this.fileName;
              
            } else {
              _this.mapDataFile=_this.file(_this.fileName);
              if (_this.mapDataFile.obj()) {
                _this.baseData=_this.mapDataFile.obj();
                _this.loadedFile=_this.fileName;
                
              }
              
            }
            if (_this.baseData==undefined) {
              _this.print("Load failed");
              _this.loadMode=false;
              
            } else {
              if (_this.baseData[0]&&_this.baseData[1]) {
                _this.modified=false;
                _this.mapData=_this.baseData[0];
                _this.mapOnData=_this.baseData[1];
                if (_this.baseData.length>2) {
                  _this.chipWidth=_this.baseData[_this.baseData.length-2];
                  _this.chipHeight=_this.baseData[_this.baseData.length-1];
                  
                } else {
                  _this.chipWidth=32;
                  _this.chipHeight=32;
                  
                }
                
              }
            }
            
          }
          
        }
        _this.update();
        if (! _this.loadMode) {
          _this.row=_this.prompt("input row");
          _this.row=(_this.row-0)||50;
          _this.col=_this.prompt("input col");
          _this.col=(_this.col-0)||50;
          _this.chipWidth=_this.prompt("input chipWidth");
          _this.chipHeight=_this.prompt("input chipHeight");
          _this.chipWidth=(_this.chipWidth-0)||32;
          _this.chipHeight=(_this.chipHeight-0)||32;
          _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
          _this.panel.x=_this.panel.width/2+40;
          _this.panel.y=_this.panel.height/2+40;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});
          
        } else {
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});
          Tonyu.globals.$map.load(_this.fileName);
          _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
          _this.panel.x=_this.panel.width/2+40;
          _this.panel.y=_this.panel.height/2+40;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          
        }
        _this.mIW=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip].image.width;
        _this.mIH=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip].image.height;
        _this.mCW=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip+0].width;
        _this.mCH=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip+0].height;
        Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: _this.floor(_this.mIH/_this.mCH),col: _this.floor(_this.mIW/_this.mCW),chipWidth: _this.mCW,chipHeight: _this.mCH});
        _this.counter=0;
        for (_this.i = 0;
         _this.i<Tonyu.globals.$mp.row ; _this.i++) {
          {
            for (_this.j = 0;
             _this.j<Tonyu.globals.$mp.col ; _this.j++) {
              {
                Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
                _this.counter++;
              }
            }
          }
        }
        Tonyu.globals.$consolePanel.clearRect(0,0,Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
        _this.mode="get";
        _this.prevMode="set";
        _this.mapp=0;
        _this.maponp=- 1;
        _this.mx=- 40;
        _this.my=- 40;
        _this.chipX=- 40;
        _this.chipY=- 40;
        _this.x=Tonyu.globals.$screenWidth-_this.chipWidth/2;
        _this.y=Tonyu.globals.$screenHeight-_this.chipHeight/2;
        Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
        _this.initialWidth=Tonyu.globals.$map.chipWidth;
        _this.initialHeight=Tonyu.globals.$map.chipHeight;
        _this.layers=["base","on","all"];
        _this.lc=0;
        _this.selectedLayer=_this.layers[_this.lc];
        _this.drawPanel();
        _this.drawLetter(_this.mode);
        while (true) {
          _this.p=_this.mapp;
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="erase";
            _this.drawLetter(_this.mode);
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="set";
            _this.drawLetter(_this.mode);
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            _this.lc++;
            _this.selectedLayer=_this.layers[_this.lc%3];
            _this.drawPanel();
            _this.drawLetter(_this.mode);
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>240&&Tonyu.globals.$touches[0].x<360&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            if (_this.mode!="get") {
              _this.prevMode=_this.mode;
              Tonyu.globals.$mp.scrollTo(- 40,- 40);
              _this.mode="get";
              _this.chipX=- 40;
              _this.chipY=- 40;
              
            } else {
              Tonyu.globals.$mp.scrollTo(1000,1000);
              _this.mode=_this.prevMode;
              
            }
            _this.drawLetter(_this.mode);
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>360&&Tonyu.globals.$touches[0].x<480&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            if (_this.loadedFile) {
              _this.saveFileName=_this.prompt("input json file(*.json)",_this.loadedFile);
              
            } else {
              _this.saveFileName=_this.prompt("input json file(*.json)","map.json");
              
            }
            if (_this.saveFileName) {
              _this.save(_this.saveFileName);
              
            }
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="copy";
            _this.drawLetter(_this.mode);
            
          }
          if (_this.mode!="get") {
            if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
              _this.mx=_this.mx-8;
            }
            if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
              _this.mx=_this.mx+8;
            }
            if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
              _this.my=_this.my-8;
            }
            if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
              _this.my=_this.my+8;
            }
            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
            
          } else {
            if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
              _this.chipX=_this.chipX-8;
            }
            if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
              _this.chipX=_this.chipX+8;
            }
            if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
              _this.chipY=_this.chipY-8;
            }
            if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
              _this.chipY=_this.chipY+8;
            }
            Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
            
          }
          if (_this.getkey("i")==1) {
            if (Tonyu.globals.$map.chipWidth<_this.initialWidth) {
              Tonyu.globals.$map.chipWidth+=4;
            }
            if (Tonyu.globals.$map.chipHeight<_this.initialHeight) {
              Tonyu.globals.$map.chipHeight+=4;
            }
            Tonyu.globals.$map.redrawMap();
            _this.panel.die();
            _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
            _this.panel.x=_this.panel.width/2+40;
            _this.panel.y=_this.panel.height/2+40;
            _this.panel.setFillStyle("cyan");
            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            
          }
          if (_this.getkey("o")==1) {
            if (Tonyu.globals.$map.chipWidth>4) {
              Tonyu.globals.$map.chipWidth-=4;
            }
            if (Tonyu.globals.$map.chipHeight>4) {
              Tonyu.globals.$map.chipHeight-=4;
            }
            Tonyu.globals.$map.redrawMap();
            _this.panel.die();
            _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
            _this.panel.x=_this.panel.width/2+40;
            _this.panel.y=_this.panel.height/2+40;
            _this.panel.setFillStyle("cyan");
            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            
          }
          _this.panel.x=_this.panel.width/2-_this.mx;
          _this.panel.y=_this.panel.height/2-_this.my;
          if (_this.mode=="set"&&_this.getkey(1)>0&&_this.inRect()) {
            if (_this.selectedLayer=="base") {
              _this.tmpon=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.tmpon);
              
            } else {
              if (_this.selectedLayer=="on") {
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
                
              } else {
                Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.maponp);
                
              }
            }
            _this.modified=true;
            
          } else {
            if (_this.mode=="erase"&&_this.getkey(1)>0&&_this.inRect()) {
              if (_this.selectedLayer=="base") {
                _this.tmpon=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.tmpon);
                
              } else {
                if (_this.selectedLayer=="on") {
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                  
                } else {
                  Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                  
                }
              }
              _this.modified=true;
              
            } else {
              if (_this.mode=="get"&&_this.getkey(1)>0&&_this.inRect()) {
                _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                _this.mode="set";
                Tonyu.globals.$mp.scrollTo(1000,1000);
                _this.drawLetter(_this.mode);
                _this.updateEx(10);
                
              } else {
                if (_this.mode=="setOn"&&_this.getkey(1)>0&&_this.inRect()) {
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
                  _this.modified=true;
                  
                } else {
                  if (_this.mode=="copy"&&_this.getkey(1)>0&&_this.inRect()) {
                    if (_this.selectedLayer=="base") {
                      _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                      _this.maponp=- 1;
                      
                    } else {
                      if (_this.selectedLayer=="on") {
                        _this.mapp=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                        
                      } else {
                        _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                        _this.maponp=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                        
                      }
                    }
                    _this.mode="set";
                    _this.drawLetter(_this.mode);
                    _this.updateEx(10);
                    
                  }
                }
              }
            }
          }
          _this.update();
          
        }
      },
      fiber$main :function* _trc_MapEditor_f_main(_thread) {
        var _this=this;
        
        Tonyu.globals.$Screen.resize(480,640);
        _this.loadMode=false;
        _this.fileExist=false;
        Tonyu.globals.$Boot.on("stop",(function anonymous_127(e) {
          
          if (_this.modified) {
            e.preventDefault();
            _this.parallel(Tonyu.bindFunc(_this,_this.st),e);
            
          }
        }));
        _this.print("map file(s)");
        _this.fileList=(yield* _this.fiber$file(_thread, "../maps/"));
        if (_this.fileList.exists()) {
          _this.fileList.recursive((function a(f) {
            
            _this.print(f.name());
            _this.fileExist=true;
          }));
          
        }
        if (_this.fileExist) {
          _this.print("Load Data?: Y or N");
          while (true) {
            if (_this.getkey("y")>0) {
              _this.loadMode=true;
              break;
              
              
            }
            if (_this.getkey("n")>0) {
              _this.loadMode=false;
              break;
              
              
            }
            (yield* _this.fiber$update(_thread));
            
          }
          if (_this.loadMode) {
            _this.fileName=(yield* _this.fiber$prompt(_thread, "Input json file (*.json)", "map.json"));
            if (_this.fileName) {
              _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
              
            }
            if (_this.mapDataFile.obj()) {
              _this.baseData=_this.mapDataFile.obj();
              _this.loadedFile=_this.fileName;
              
            } else {
              _this.mapDataFile=(yield* _this.fiber$file(_thread, _this.fileName));
              if (_this.mapDataFile.obj()) {
                _this.baseData=_this.mapDataFile.obj();
                _this.loadedFile=_this.fileName;
                
              }
              
            }
            if (_this.baseData==undefined) {
              _this.print("Load failed");
              _this.loadMode=false;
              
            } else {
              if (_this.baseData[0]&&_this.baseData[1]) {
                _this.modified=false;
                _this.mapData=_this.baseData[0];
                _this.mapOnData=_this.baseData[1];
                if (_this.baseData.length>2) {
                  _this.chipWidth=_this.baseData[_this.baseData.length-2];
                  _this.chipHeight=_this.baseData[_this.baseData.length-1];
                  
                } else {
                  _this.chipWidth=32;
                  _this.chipHeight=32;
                  
                }
                
              }
            }
            
          }
          
        }
        (yield* _this.fiber$update(_thread));
        if (! _this.loadMode) {
          _this.row=(yield* _this.fiber$prompt(_thread, "input row"));
          _this.row=(_this.row-0)||50;
          _this.col=(yield* _this.fiber$prompt(_thread, "input col"));
          _this.col=(_this.col-0)||50;
          _this.chipWidth=(yield* _this.fiber$prompt(_thread, "input chipWidth"));
          _this.chipHeight=(yield* _this.fiber$prompt(_thread, "input chipHeight"));
          _this.chipWidth=(_this.chipWidth-0)||32;
          _this.chipHeight=(_this.chipHeight-0)||32;
          _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
          _this.panel.x=_this.panel.width/2+40;
          _this.panel.y=_this.panel.height/2+40;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});
          
        } else {
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});
          Tonyu.globals.$map.load(_this.fileName);
          _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
          _this.panel.x=_this.panel.width/2+40;
          _this.panel.y=_this.panel.height/2+40;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          
        }
        _this.mIW=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip].image.width;
        _this.mIH=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip].image.height;
        _this.mCW=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip+0].width;
        _this.mCH=Tonyu.globals.$imageList[Tonyu.globals.$pat_mapchip+0].height;
        Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: _this.floor(_this.mIH/_this.mCH),col: _this.floor(_this.mIW/_this.mCW),chipWidth: _this.mCW,chipHeight: _this.mCH});
        _this.counter=0;
        for (_this.i = 0;
         _this.i<Tonyu.globals.$mp.row ; _this.i++) {
          {
            for (_this.j = 0;
             _this.j<Tonyu.globals.$mp.col ; _this.j++) {
              {
                Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
                _this.counter++;
              }
            }
          }
        }
        Tonyu.globals.$consolePanel.clearRect(0,0,Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
        _this.mode="get";
        _this.prevMode="set";
        _this.mapp=0;
        _this.maponp=- 1;
        _this.mx=- 40;
        _this.my=- 40;
        _this.chipX=- 40;
        _this.chipY=- 40;
        _this.x=Tonyu.globals.$screenWidth-_this.chipWidth/2;
        _this.y=Tonyu.globals.$screenHeight-_this.chipHeight/2;
        Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
        _this.initialWidth=Tonyu.globals.$map.chipWidth;
        _this.initialHeight=Tonyu.globals.$map.chipHeight;
        _this.layers=["base","on","all"];
        _this.lc=0;
        _this.selectedLayer=_this.layers[_this.lc];
        (yield* _this.fiber$drawPanel(_thread));
        (yield* _this.fiber$drawLetter(_thread, _this.mode));
        while (true) {
          _this.p=_this.mapp;
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="erase";
            (yield* _this.fiber$drawLetter(_thread, _this.mode));
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="set";
            (yield* _this.fiber$drawLetter(_thread, _this.mode));
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            _this.lc++;
            _this.selectedLayer=_this.layers[_this.lc%3];
            (yield* _this.fiber$drawPanel(_thread));
            (yield* _this.fiber$drawLetter(_thread, _this.mode));
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>240&&Tonyu.globals.$touches[0].x<360&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            if (_this.mode!="get") {
              _this.prevMode=_this.mode;
              Tonyu.globals.$mp.scrollTo(- 40,- 40);
              _this.mode="get";
              _this.chipX=- 40;
              _this.chipY=- 40;
              
            } else {
              Tonyu.globals.$mp.scrollTo(1000,1000);
              _this.mode=_this.prevMode;
              
            }
            (yield* _this.fiber$drawLetter(_thread, _this.mode));
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>360&&Tonyu.globals.$touches[0].x<480&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            if (_this.loadedFile) {
              _this.saveFileName=(yield* _this.fiber$prompt(_thread, "input json file(*.json)", _this.loadedFile));
              
            } else {
              _this.saveFileName=(yield* _this.fiber$prompt(_thread, "input json file(*.json)", "map.json"));
              
            }
            if (_this.saveFileName) {
              (yield* _this.fiber$save(_thread, _this.saveFileName));
              
            }
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="copy";
            (yield* _this.fiber$drawLetter(_thread, _this.mode));
            
          }
          if (_this.mode!="get") {
            if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
              _this.mx=_this.mx-8;
            }
            if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
              _this.mx=_this.mx+8;
            }
            if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
              _this.my=_this.my-8;
            }
            if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
              _this.my=_this.my+8;
            }
            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
            
          } else {
            if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
              _this.chipX=_this.chipX-8;
            }
            if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
              _this.chipX=_this.chipX+8;
            }
            if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
              _this.chipY=_this.chipY-8;
            }
            if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
              _this.chipY=_this.chipY+8;
            }
            Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
            
          }
          if (_this.getkey("i")==1) {
            if (Tonyu.globals.$map.chipWidth<_this.initialWidth) {
              Tonyu.globals.$map.chipWidth+=4;
            }
            if (Tonyu.globals.$map.chipHeight<_this.initialHeight) {
              Tonyu.globals.$map.chipHeight+=4;
            }
            Tonyu.globals.$map.redrawMap();
            _this.panel.die();
            _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
            _this.panel.x=_this.panel.width/2+40;
            _this.panel.y=_this.panel.height/2+40;
            _this.panel.setFillStyle("cyan");
            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            
          }
          if (_this.getkey("o")==1) {
            if (Tonyu.globals.$map.chipWidth>4) {
              Tonyu.globals.$map.chipWidth-=4;
            }
            if (Tonyu.globals.$map.chipHeight>4) {
              Tonyu.globals.$map.chipHeight-=4;
            }
            Tonyu.globals.$map.redrawMap();
            _this.panel.die();
            _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
            _this.panel.x=_this.panel.width/2+40;
            _this.panel.y=_this.panel.height/2+40;
            _this.panel.setFillStyle("cyan");
            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            
          }
          _this.panel.x=_this.panel.width/2-_this.mx;
          _this.panel.y=_this.panel.height/2-_this.my;
          if (_this.mode=="set"&&_this.getkey(1)>0&&_this.inRect()) {
            if (_this.selectedLayer=="base") {
              _this.tmpon=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
              Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.tmpon);
              
            } else {
              if (_this.selectedLayer=="on") {
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
                
              } else {
                Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.maponp);
                
              }
            }
            _this.modified=true;
            
          } else {
            if (_this.mode=="erase"&&_this.getkey(1)>0&&_this.inRect()) {
              if (_this.selectedLayer=="base") {
                _this.tmpon=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.tmpon);
                
              } else {
                if (_this.selectedLayer=="on") {
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                  
                } else {
                  Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,- 1);
                  
                }
              }
              _this.modified=true;
              
            } else {
              if (_this.mode=="get"&&_this.getkey(1)>0&&_this.inRect()) {
                _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                _this.mode="set";
                Tonyu.globals.$mp.scrollTo(1000,1000);
                (yield* _this.fiber$drawLetter(_thread, _this.mode));
                (yield* _this.fiber$updateEx(_thread, 10));
                
              } else {
                if (_this.mode=="setOn"&&_this.getkey(1)>0&&_this.inRect()) {
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY,_this.mapp);
                  _this.modified=true;
                  
                } else {
                  if (_this.mode=="copy"&&_this.getkey(1)>0&&_this.inRect()) {
                    if (_this.selectedLayer=="base") {
                      _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                      _this.maponp=- 1;
                      
                    } else {
                      if (_this.selectedLayer=="on") {
                        _this.mapp=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                        
                      } else {
                        _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                        _this.maponp=Tonyu.globals.$map.getOnAt(Tonyu.globals.$mouseX,Tonyu.globals.$mouseY);
                        
                      }
                    }
                    _this.mode="set";
                    (yield* _this.fiber$drawLetter(_thread, _this.mode));
                    (yield* _this.fiber$updateEx(_thread, 10));
                    
                  }
                }
              }
            }
          }
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      getCurFileName :function _trc_MapEditor_getCurFileName() {
        var _this=this;
        
        return _this.saveFileName||_this.loadedFile;
      },
      fiber$getCurFileName :function* _trc_MapEditor_f_getCurFileName(_thread) {
        var _this=this;
        
        return _this.saveFileName||_this.loadedFile;
        
      },
      st :function _trc_MapEditor_st(e) {
        var _this=this;
        var curFileName;
        var r;
        
        curFileName = _this.getCurFileName()||"map.json";
        
        r = _this.confirm("Save "+curFileName+"?");
        
        if (r) {
          _this.save(curFileName);
          _this.update();
          e.die();
          
        } else {
          r=_this.confirm("Discard changes?");
          if (r) {
            _this.update();
            e.die();
            
          }
          
        }
      },
      fiber$st :function* _trc_MapEditor_f_st(_thread,e) {
        var _this=this;
        var curFileName;
        var r;
        
        curFileName = _this.getCurFileName()||"map.json";
        
        r=yield* _this.fiber$confirm(_thread, "Save "+curFileName+"?");
        
        if (r) {
          (yield* _this.fiber$save(_thread, curFileName));
          (yield* _this.fiber$update(_thread));
          e.die();
          
        } else {
          r=(yield* _this.fiber$confirm(_thread, "Discard changes?"));
          if (r) {
            (yield* _this.fiber$update(_thread));
            e.die();
            
          }
          
        }
        
      },
      save :function _trc_MapEditor_save(fileName) {
        var _this=this;
        
        _this.saveDataFile=_this.file("../maps/").rel(fileName);
        _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable,Tonyu.globals.$map.chipWidth,Tonyu.globals.$map.chipHeight];
        _this.saveDataFile.obj(_this.data);
        _this.modified=false;
        _this.print(fileName+" Saved");
      },
      fiber$save :function* _trc_MapEditor_f_save(_thread,fileName) {
        var _this=this;
        
        _this.saveDataFile=_this.file("../maps/").rel(fileName);
        _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable,Tonyu.globals.$map.chipWidth,Tonyu.globals.$map.chipHeight];
        _this.saveDataFile.obj(_this.data);
        _this.modified=false;
        _this.print(fileName+" Saved");
        
      },
      inRect :function _trc_MapEditor_inRect() {
        var _this=this;
        
        return Tonyu.globals.$mouseX>40&&Tonyu.globals.$mouseX<Tonyu.globals.$screenWidth-40&&Tonyu.globals.$mouseY>40&&Tonyu.globals.$mouseY<Tonyu.globals.$screenHeight-200;
      },
      fiber$inRect :function* _trc_MapEditor_f_inRect(_thread) {
        var _this=this;
        
        return Tonyu.globals.$mouseX>40&&Tonyu.globals.$mouseX<Tonyu.globals.$screenWidth-40&&Tonyu.globals.$mouseY>40&&Tonyu.globals.$mouseY<Tonyu.globals.$screenHeight-200;
        
      },
      drawPanel :function _trc_MapEditor_drawPanel() {
        var _this=this;
        
        Tonyu.globals.$panel.setFillStyle("gray");
        Tonyu.globals.$panel.alpha=128;
        Tonyu.globals.$panel.fillRect(0,0,Tonyu.globals.$screenWidth,40);
        Tonyu.globals.$panel.fillRect(0,0,40,Tonyu.globals.$screenHeight-160);
        Tonyu.globals.$panel.fillRect(Tonyu.globals.$screenWidth-40,0,40,Tonyu.globals.$screenHeight-160);
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-200,Tonyu.globals.$screenWidth,40);
        Tonyu.globals.$panel.alpha=255;
        Tonyu.globals.$panel.setFillStyle("black");
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(240,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(360,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-80,120,80);
        Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-80,120,80);
        Tonyu.globals.$panel.setFillStyle("white");
        Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(250,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(370,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-70,100,60);
        Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-70,100,60);
        Tonyu.globals.$panel.setFillStyle("black");
        Tonyu.globals.$panel.fillText("↑",Tonyu.globals.$screenWidth/2,30,40,"center");
        Tonyu.globals.$panel.fillText("←",20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
        Tonyu.globals.$panel.fillText("↓",Tonyu.globals.$screenWidth/2,Tonyu.globals.$screenHeight-160-10,40,"center");
        Tonyu.globals.$panel.fillText("→",Tonyu.globals.$screenWidth-20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
        Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText(_this.selectedLayer,Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
        Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
        Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
      },
      fiber$drawPanel :function* _trc_MapEditor_f_drawPanel(_thread) {
        var _this=this;
        
        Tonyu.globals.$panel.setFillStyle("gray");
        Tonyu.globals.$panel.alpha=128;
        Tonyu.globals.$panel.fillRect(0,0,Tonyu.globals.$screenWidth,40);
        Tonyu.globals.$panel.fillRect(0,0,40,Tonyu.globals.$screenHeight-160);
        Tonyu.globals.$panel.fillRect(Tonyu.globals.$screenWidth-40,0,40,Tonyu.globals.$screenHeight-160);
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-200,Tonyu.globals.$screenWidth,40);
        Tonyu.globals.$panel.alpha=255;
        Tonyu.globals.$panel.setFillStyle("black");
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(240,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(360,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-80,120,80);
        Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-80,120,80);
        Tonyu.globals.$panel.setFillStyle("white");
        Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(250,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(370,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-70,100,60);
        Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-70,100,60);
        Tonyu.globals.$panel.setFillStyle("black");
        Tonyu.globals.$panel.fillText("↑",Tonyu.globals.$screenWidth/2,30,40,"center");
        Tonyu.globals.$panel.fillText("←",20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
        Tonyu.globals.$panel.fillText("↓",Tonyu.globals.$screenWidth/2,Tonyu.globals.$screenHeight-160-10,40,"center");
        Tonyu.globals.$panel.fillText("→",Tonyu.globals.$screenWidth-20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
        Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText(_this.selectedLayer,Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
        Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
        Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
        
      },
      drawLetter :function _trc_MapEditor_drawLetter(mode) {
        var _this=this;
        
        if (mode=="set") {
          Tonyu.globals.$panel.setFillStyle("red");
        } else {
          Tonyu.globals.$panel.setFillStyle("black");
        }
        Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
        if (mode=="get") {
          Tonyu.globals.$panel.setFillStyle("red");
        } else {
          Tonyu.globals.$panel.setFillStyle("black");
        }
        Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
        if (mode=="erase") {
          Tonyu.globals.$panel.setFillStyle("red");
        } else {
          Tonyu.globals.$panel.setFillStyle("black");
        }
        Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
        if (mode=="copy") {
          Tonyu.globals.$panel.setFillStyle("red");
        } else {
          Tonyu.globals.$panel.setFillStyle("black");
        }
        Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
        Tonyu.globals.$panel.setFillStyle("black");
        Tonyu.globals.$panel.fillText(_this.selectedLayer,Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
        Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
      },
      fiber$drawLetter :function* _trc_MapEditor_f_drawLetter(_thread,mode) {
        var _this=this;
        
        if (mode=="set") {
          Tonyu.globals.$panel.setFillStyle("red");
        } else {
          Tonyu.globals.$panel.setFillStyle("black");
        }
        Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
        if (mode=="get") {
          Tonyu.globals.$panel.setFillStyle("red");
        } else {
          Tonyu.globals.$panel.setFillStyle("black");
        }
        Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
        if (mode=="erase") {
          Tonyu.globals.$panel.setFillStyle("red");
        } else {
          Tonyu.globals.$panel.setFillStyle("black");
        }
        Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
        if (mode=="copy") {
          Tonyu.globals.$panel.setFillStyle("red");
        } else {
          Tonyu.globals.$panel.setFillStyle("black");
        }
        Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
        Tonyu.globals.$panel.setFillStyle("black");
        Tonyu.globals.$panel.fillText(_this.selectedLayer,Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
        Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"getCurFileName":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"st":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"save":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"inRect":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"drawPanel":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"drawLetter":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"i":{"vtype":"Number"},"j":{"vtype":"Number"},"loadMode":{},"fileExist":{},"modified":{},"fileList":{},"fileName":{},"mapDataFile":{},"baseData":{},"loadedFile":{},"mapData":{},"mapOnData":{},"chipWidth":{},"chipHeight":{},"row":{},"col":{},"panel":{},"mIW":{},"mIH":{},"mCW":{},"mCH":{},"counter":{},"mode":{},"prevMode":{},"mapp":{},"maponp":{},"mx":{},"my":{},"chipX":{},"chipY":{},"initialWidth":{},"initialHeight":{},"layers":{},"lc":{},"selectedLayer":{},"saveFileName":{},"tmpon":{},"saveDataFile":{},"data":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MapEditorOLD',
  shortName: 'MapEditorOLD',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_MapEditorOLD_main() {
        var _this=this;
        
        _this.loadMode=false;
        _this.print("Load Data?: Y or N");
        while (true) {
          if (_this.getkey("y")>0) {
            _this.loadMode=true;
            break;
            
            
          }
          if (_this.getkey("n")>0) {
            _this.loadMode=false;
            break;
            
            
          }
          _this.update();
          
        }
        if (_this.loadMode) {
          _this.fileName=prompt("Input json file (*.json)","map.json");
          if (_this.fileName) {
            _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
            
          }
          if (_this.mapDataFile.obj()) {
            _this.baseData=_this.mapDataFile.obj();
            
          } else {
            _this.mapDataFile=_this.file(_this.fileName);
            if (_this.mapDataFile.obj()) {
              _this.baseData=_this.mapDataFile.obj();
              
            }
            
          }
          if (_this.baseData==undefined) {
            _this.print("Load failed");
            _this.loadMode=false;
            
          } else {
            if (_this.baseData[0]&&_this.baseData[1]) {
              _this.mapData=_this.baseData[0];
              _this.mapOnData=_this.baseData[1];
              
            }
          }
          
        }
        _this.update();
        if (! _this.loadMode) {
          _this.row=prompt("input row");
          _this.update();
          _this.col=prompt("input col");
          _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});
          _this.panel.x=_this.panel.width/2+10;
          _this.panel.y=_this.panel.height/2;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});
          
        } else {
          if (! _this.mapOnData) {
            Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});
            
          } else {
            Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});
            
          }
          _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});
          _this.panel.x=_this.panel.width/2;
          _this.panel.y=_this.panel.height/2;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          
        }
        Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});
        _this.counter=0;
        for (_this.i = 0;
         _this.i<16 ; _this.i++) {
          {
            for (_this.j = 0;
             _this.j<8 ; _this.j++) {
              {
                Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
                _this.counter++;
              }
            }
          }
        }
        _this.mode="get";
        _this.prevMode="set";
        _this.mapp=0;
        _this.mx=0;
        _this.my=0;
        _this.chipX=0;
        _this.chipY=0;
        _this.x=Tonyu.globals.$screenWidth-16;
        _this.y=Tonyu.globals.$screenHeight-16;
        while (true) {
          _this.p=_this.mapp;
          if (_this.getkey("e")==1) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="erase";
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("s")==1) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            if (_this.mode=="set") {
              _this.mode="setOn";
              
            } else {
              _this.mode="set";
              
            }
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("o")==1) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="setOn";
            
          }
          if (_this.getkey("g")==1) {
            if (_this.mode!="get") {
              _this.prevMode=_this.mode;
              Tonyu.globals.$mp.scrollTo(0,0);
              _this.mode="get";
              _this.chipX=0;
              _this.chipY=0;
              
            } else {
              Tonyu.globals.$mp.scrollTo(1000,1000);
              _this.mode=_this.prevMode;
              
            }
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("p")==1) {
            _this.saveFileName=prompt("input json file(*.json)","map.json");
            _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);
            _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];
            _this.saveDataFile.obj(_this.data);
            _this.print(_this.saveFileName+" Saved");
            
          }
          if (_this.getkey("c")==1) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="spuit";
            _this.print(_this.mode+" mode");
            
          }
          if (_this.mode!="get") {
            if (_this.getkey("left")>0) {
              _this.mx=_this.mx+8;
            }
            if (_this.getkey("right")>0) {
              _this.mx=_this.mx-8;
            }
            if (_this.getkey("up")>0) {
              _this.my=_this.my+8;
            }
            if (_this.getkey("down")>0) {
              _this.my=_this.my-8;
            }
            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
            
          } else {
            if (_this.getkey("left")>0) {
              _this.chipX=_this.chipX+8;
            }
            if (_this.getkey("right")>0) {
              _this.chipX=_this.chipX-8;
            }
            if (_this.getkey("up")>0) {
              _this.chipY=_this.chipY+8;
            }
            if (_this.getkey("down")>0) {
              _this.chipY=_this.chipY-8;
            }
            Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
            
          }
          _this.panel.x=_this.panel.width/2-_this.mx;
          _this.panel.y=_this.panel.height/2-_this.my;
          if (_this.mode=="set"&&_this.getkey(1)>0) {
            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
            Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
            
          } else {
            if (_this.mode=="erase"&&_this.getkey(1)>0) {
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
              
            } else {
              if (_this.mode=="get"&&_this.getkey(1)>0) {
                _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);
                _this.mode=_this.prevMode;
                Tonyu.globals.$mp.scrollTo(1000,1000);
                _this.print(_this.mode+" mode");
                _this.updateEx(10);
                
              } else {
                if (_this.mode=="setOn"&&_this.getkey(1)>0) {
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
                  
                } else {
                  if (_this.mode=="spuit"&&_this.getkey(1)>0) {
                    _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);
                    _this.mode="set";
                    _this.print(_this.mode+" mode");
                    _this.updateEx(10);
                    
                  }
                }
              }
            }
          }
          _this.update();
          
        }
      },
      fiber$main :function* _trc_MapEditorOLD_f_main(_thread) {
        var _this=this;
        
        _this.loadMode=false;
        _this.print("Load Data?: Y or N");
        while (true) {
          if (_this.getkey("y")>0) {
            _this.loadMode=true;
            break;
            
            
          }
          if (_this.getkey("n")>0) {
            _this.loadMode=false;
            break;
            
            
          }
          (yield* _this.fiber$update(_thread));
          
        }
        if (_this.loadMode) {
          _this.fileName=prompt("Input json file (*.json)","map.json");
          if (_this.fileName) {
            _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
            
          }
          if (_this.mapDataFile.obj()) {
            _this.baseData=_this.mapDataFile.obj();
            
          } else {
            _this.mapDataFile=(yield* _this.fiber$file(_thread, _this.fileName));
            if (_this.mapDataFile.obj()) {
              _this.baseData=_this.mapDataFile.obj();
              
            }
            
          }
          if (_this.baseData==undefined) {
            _this.print("Load failed");
            _this.loadMode=false;
            
          } else {
            if (_this.baseData[0]&&_this.baseData[1]) {
              _this.mapData=_this.baseData[0];
              _this.mapOnData=_this.baseData[1];
              
            }
          }
          
        }
        (yield* _this.fiber$update(_thread));
        if (! _this.loadMode) {
          _this.row=prompt("input row");
          (yield* _this.fiber$update(_thread));
          _this.col=prompt("input col");
          _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*32,height: _this.row*32});
          _this.panel.x=_this.panel.width/2+10;
          _this.panel.y=_this.panel.height/2;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: 32,chipHeight: 32});
          
        } else {
          if (! _this.mapOnData) {
            Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData});
            
          } else {
            Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.mapData.length,col: _this.mapData[0].length,chipWidth: 32,chipHeight: 32,mapData: _this.mapData,mapOnData: _this.mapOnData});
            
          }
          _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*32,height: Tonyu.globals.$map.row*32,zOrder: 100});
          _this.panel.x=_this.panel.width/2;
          _this.panel.y=_this.panel.height/2;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          
        }
        Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: 16,col: 8,chipWidth: 32,chipHeight: 32});
        _this.counter=0;
        for (_this.i = 0;
         _this.i<16 ; _this.i++) {
          {
            for (_this.j = 0;
             _this.j<8 ; _this.j++) {
              {
                Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
                _this.counter++;
              }
            }
          }
        }
        _this.mode="get";
        _this.prevMode="set";
        _this.mapp=0;
        _this.mx=0;
        _this.my=0;
        _this.chipX=0;
        _this.chipY=0;
        _this.x=Tonyu.globals.$screenWidth-16;
        _this.y=Tonyu.globals.$screenHeight-16;
        while (true) {
          _this.p=_this.mapp;
          if (_this.getkey("e")==1) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="erase";
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("s")==1) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            if (_this.mode=="set") {
              _this.mode="setOn";
              
            } else {
              _this.mode="set";
              
            }
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("o")==1) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="setOn";
            
          }
          if (_this.getkey("g")==1) {
            if (_this.mode!="get") {
              _this.prevMode=_this.mode;
              Tonyu.globals.$mp.scrollTo(0,0);
              _this.mode="get";
              _this.chipX=0;
              _this.chipY=0;
              
            } else {
              Tonyu.globals.$mp.scrollTo(1000,1000);
              _this.mode=_this.prevMode;
              
            }
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("p")==1) {
            _this.saveFileName=prompt("input json file(*.json)","map.json");
            _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);
            _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable];
            _this.saveDataFile.obj(_this.data);
            _this.print(_this.saveFileName+" Saved");
            
          }
          if (_this.getkey("c")==1) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="spuit";
            _this.print(_this.mode+" mode");
            
          }
          if (_this.mode!="get") {
            if (_this.getkey("left")>0) {
              _this.mx=_this.mx+8;
            }
            if (_this.getkey("right")>0) {
              _this.mx=_this.mx-8;
            }
            if (_this.getkey("up")>0) {
              _this.my=_this.my+8;
            }
            if (_this.getkey("down")>0) {
              _this.my=_this.my-8;
            }
            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
            
          } else {
            if (_this.getkey("left")>0) {
              _this.chipX=_this.chipX+8;
            }
            if (_this.getkey("right")>0) {
              _this.chipX=_this.chipX-8;
            }
            if (_this.getkey("up")>0) {
              _this.chipY=_this.chipY+8;
            }
            if (_this.getkey("down")>0) {
              _this.chipY=_this.chipY-8;
            }
            Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
            
          }
          _this.panel.x=_this.panel.width/2-_this.mx;
          _this.panel.y=_this.panel.height/2-_this.my;
          if (_this.mode=="set"&&_this.getkey(1)>0) {
            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
            Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
            
          } else {
            if (_this.mode=="erase"&&_this.getkey(1)>0) {
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
              
            } else {
              if (_this.mode=="get"&&_this.getkey(1)>0) {
                _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);
                _this.mode=_this.prevMode;
                Tonyu.globals.$mp.scrollTo(1000,1000);
                _this.print(_this.mode+" mode");
                (yield* _this.fiber$updateEx(_thread, 10));
                
              } else {
                if (_this.mode=="setOn"&&_this.getkey(1)>0) {
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
                  
                } else {
                  if (_this.mode=="spuit"&&_this.getkey(1)>0) {
                    _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);
                    _this.mode="set";
                    _this.print(_this.mode+" mode");
                    (yield* _this.fiber$updateEx(_thread, 10));
                    
                  }
                }
              }
            }
          }
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}}},"fields":{"i":{"vtype":"Number"},"j":{"vtype":"Number"},"loadMode":{},"fileName":{},"mapDataFile":{},"baseData":{},"mapData":{},"mapOnData":{},"row":{},"col":{},"panel":{},"counter":{},"mode":{},"prevMode":{},"mapp":{},"mx":{},"my":{},"chipX":{},"chipY":{},"saveFileName":{},"saveDataFile":{},"data":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.MapEditorOLD2',
  shortName: 'MapEditorOLD2',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_MapEditorOLD2_main() {
        var _this=this;
        
        Tonyu.globals.$Screen.resize(480,640);
        _this.loadMode=false;
        _this.fileExist=false;
        _this.print("map file(s)");
        _this.fileList=_this.file("../maps/");
        if (_this.fileList.exists()) {
          _this.fileList.recursive((function a(f) {
            
            f=f+"";
            _this.fNames=f.split("/");
            _this.print(_this.fNames[_this.fNames.length-1]);
            _this.fileExist=true;
          }));
          
        }
        if (_this.fileExist) {
          _this.print("Load Data?: Y or N");
          while (true) {
            if (_this.getkey("y")>0) {
              _this.loadMode=true;
              break;
              
              
            }
            if (_this.getkey("n")>0) {
              _this.loadMode=false;
              break;
              
              
            }
            _this.update();
            
          }
          if (_this.loadMode) {
            _this.fileName=prompt("Input json file (*.json)","map.json");
            if (_this.fileName) {
              _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
              
            }
            if (_this.mapDataFile.obj()) {
              _this.baseData=_this.mapDataFile.obj();
              _this.loadedFile=_this.fileName;
              
            } else {
              _this.mapDataFile=_this.file(_this.fileName);
              if (_this.mapDataFile.obj()) {
                _this.baseData=_this.mapDataFile.obj();
                _this.loadedFile=_this.fileName;
                
              }
              
            }
            if (_this.baseData==undefined) {
              _this.print("Load failed");
              _this.loadMode=false;
              
            } else {
              if (_this.baseData[0]&&_this.baseData[1]) {
                _this.mapData=_this.baseData[0];
                _this.mapOnData=_this.baseData[1];
                if (_this.baseData.length>2) {
                  _this.chipWidth=_this.baseData[_this.baseData.length-2];
                  _this.chipHeight=_this.baseData[_this.baseData.length-1];
                  
                }
                
              }
            }
            
          }
          
        }
        _this.update();
        if (! _this.loadMode) {
          _this.row=prompt("input row");
          _this.col=prompt("input col");
          _this.chipWidth=prompt("input chipWidth");
          _this.chipHeight=prompt("input chipHeight");
          _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
          _this.panel.x=_this.panel.width/2+40;
          _this.panel.y=_this.panel.height/2+40;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});
          
        } else {
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({chipWidth: 32,chipHeight: 32});
          Tonyu.globals.$map.load(_this.fileName);
          _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
          _this.panel.x=_this.panel.width/2+40;
          _this.panel.y=_this.panel.height/2+40;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          
        }
        _this.mIW=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip].image.width;
        _this.mIH=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip].image.height;
        _this.mCW=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip+0].width;
        _this.mCH=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip+0].height;
        Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: _this.floor(_this.mIH/_this.mCH),col: _this.floor(_this.mIW/_this.mCW),chipWidth: _this.mCW,chipHeight: _this.mCH});
        _this.counter=0;
        for (_this.i = 0;
         _this.i<Tonyu.globals.$mp.row ; _this.i++) {
          {
            for (_this.j = 0;
             _this.j<Tonyu.globals.$mp.col ; _this.j++) {
              {
                Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
                _this.counter++;
              }
            }
          }
        }
        _this.drawPanel();
        _this.mode="get";
        _this.prevMode="set";
        _this.mapp=0;
        _this.mx=- 40;
        _this.my=- 40;
        _this.chipX=- 40;
        _this.chipY=- 40;
        _this.x=Tonyu.globals.$screenWidth-_this.chipWidth/2;
        _this.y=Tonyu.globals.$screenHeight-_this.chipHeight/2;
        Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
        while (true) {
          _this.p=_this.mapp;
          if (_this.getkey("e")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="erase";
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("s")==1) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            if (_this.mode=="set") {
              _this.mode="setOn";
              
            } else {
              _this.mode="set";
              
            }
            _this.print(_this.mode+" mode");
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="set";
            _this.print(_this.mode+" mode");
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="setOn";
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("g")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>240&&Tonyu.globals.$touches[0].x<360&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {
            if (_this.mode!="get") {
              _this.prevMode=_this.mode;
              Tonyu.globals.$mp.scrollTo(- 40,- 40);
              _this.mode="get";
              _this.chipX=- 40;
              _this.chipY=- 40;
              
            } else {
              Tonyu.globals.$mp.scrollTo(1000,1000);
              _this.mode=_this.prevMode;
              
            }
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("p")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>360&&Tonyu.globals.$touches[0].x<480&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {
            if (_this.loadedFile) {
              _this.saveFileName=prompt("input json file(*.json)",_this.loadedFile);
              
            } else {
              _this.saveFileName=prompt("input json file(*.json)","map.json");
              
            }
            if (_this.saveFileName) {
              _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);
              _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable,Tonyu.globals.$map.chipWidth,Tonyu.globals.$map.chipHeight];
              _this.saveDataFile.obj(_this.data);
              _this.print(_this.saveFileName+" Saved");
              
            }
            
          }
          if (_this.getkey("c")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="copy";
            _this.print(_this.mode+" mode");
            
          }
          if (_this.mode!="get") {
            if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
              _this.mx=_this.mx+8;
            }
            if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
              _this.mx=_this.mx-8;
            }
            if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
              _this.my=_this.my+8;
            }
            if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
              _this.my=_this.my-8;
            }
            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
            
          } else {
            if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
              _this.chipX=_this.chipX+8;
            }
            if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
              _this.chipX=_this.chipX-8;
            }
            if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
              _this.chipY=_this.chipY+8;
            }
            if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
              _this.chipY=_this.chipY-8;
            }
            Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
            
          }
          if (_this.getkey("i")==1) {
            Tonyu.globals.$map.chipWidth+=4;
            Tonyu.globals.$map.chipHeight+=4;
            Tonyu.globals.$map.redrawMap();
            _this.panel.die();
            _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
            _this.panel.x=_this.panel.width/2+40;
            _this.panel.y=_this.panel.height/2+40;
            _this.panel.setFillStyle("cyan");
            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            
          }
          if (_this.getkey("o")==1) {
            Tonyu.globals.$map.chipWidth-=4;
            Tonyu.globals.$map.chipHeight-=4;
            Tonyu.globals.$map.redrawMap();
            _this.panel.die();
            _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
            _this.panel.x=_this.panel.width/2+40;
            _this.panel.y=_this.panel.height/2+40;
            _this.panel.setFillStyle("cyan");
            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            
          }
          _this.panel.x=_this.panel.width/2-_this.mx;
          _this.panel.y=_this.panel.height/2-_this.my;
          if (_this.mode=="set"&&_this.getkey(1)>0&&_this.inRect()) {
            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
            Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
            
          } else {
            if (_this.mode=="erase"&&_this.getkey(1)>0&&_this.inRect()) {
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
              
            } else {
              if (_this.mode=="get"&&_this.getkey(1)>0&&_this.inRect()) {
                _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);
                _this.mode=_this.prevMode;
                Tonyu.globals.$mp.scrollTo(1000,1000);
                _this.print(_this.mode+" mode");
                _this.updateEx(10);
                
              } else {
                if (_this.mode=="setOn"&&_this.getkey(1)>0&&_this.inRect()) {
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
                  
                } else {
                  if (_this.mode=="copy"&&_this.getkey(1)>0&&_this.inRect()) {
                    _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);
                    _this.mode="set";
                    _this.print(_this.mode+" mode");
                    _this.updateEx(10);
                    
                  }
                }
              }
            }
          }
          _this.update();
          
        }
      },
      fiber$main :function* _trc_MapEditorOLD2_f_main(_thread) {
        var _this=this;
        
        Tonyu.globals.$Screen.resize(480,640);
        _this.loadMode=false;
        _this.fileExist=false;
        _this.print("map file(s)");
        _this.fileList=(yield* _this.fiber$file(_thread, "../maps/"));
        if (_this.fileList.exists()) {
          _this.fileList.recursive((function a(f) {
            
            f=f+"";
            _this.fNames=f.split("/");
            _this.print(_this.fNames[_this.fNames.length-1]);
            _this.fileExist=true;
          }));
          
        }
        if (_this.fileExist) {
          _this.print("Load Data?: Y or N");
          while (true) {
            if (_this.getkey("y")>0) {
              _this.loadMode=true;
              break;
              
              
            }
            if (_this.getkey("n")>0) {
              _this.loadMode=false;
              break;
              
              
            }
            (yield* _this.fiber$update(_thread));
            
          }
          if (_this.loadMode) {
            _this.fileName=prompt("Input json file (*.json)","map.json");
            if (_this.fileName) {
              _this.mapDataFile=_this.file("../maps/").rel(_this.fileName);
              
            }
            if (_this.mapDataFile.obj()) {
              _this.baseData=_this.mapDataFile.obj();
              _this.loadedFile=_this.fileName;
              
            } else {
              _this.mapDataFile=(yield* _this.fiber$file(_thread, _this.fileName));
              if (_this.mapDataFile.obj()) {
                _this.baseData=_this.mapDataFile.obj();
                _this.loadedFile=_this.fileName;
                
              }
              
            }
            if (_this.baseData==undefined) {
              _this.print("Load failed");
              _this.loadMode=false;
              
            } else {
              if (_this.baseData[0]&&_this.baseData[1]) {
                _this.mapData=_this.baseData[0];
                _this.mapOnData=_this.baseData[1];
                if (_this.baseData.length>2) {
                  _this.chipWidth=_this.baseData[_this.baseData.length-2];
                  _this.chipHeight=_this.baseData[_this.baseData.length-1];
                  
                }
                
              }
            }
            
          }
          
        }
        (yield* _this.fiber$update(_thread));
        if (! _this.loadMode) {
          _this.row=prompt("input row");
          _this.col=prompt("input col");
          _this.chipWidth=prompt("input chipWidth");
          _this.chipHeight=prompt("input chipHeight");
          _this.panel=new Tonyu.classes.kernel.Panel({width: _this.col*_this.chipWidth,height: _this.row*_this.chipHeight});
          _this.panel.x=_this.panel.width/2+40;
          _this.panel.y=_this.panel.height/2+40;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({row: _this.row,col: _this.col,chipWidth: _this.chipWidth,chipHeight: _this.chipHeight});
          
        } else {
          Tonyu.globals.$map=new Tonyu.classes.kernel.Map({chipWidth: 32,chipHeight: 32});
          Tonyu.globals.$map.load(_this.fileName);
          _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
          _this.panel.x=_this.panel.width/2+40;
          _this.panel.y=_this.panel.height/2+40;
          _this.panel.setFillStyle("cyan");
          _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
          
        }
        _this.mIW=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip].image.width;
        _this.mIH=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip].image.height;
        _this.mCW=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip+0].width;
        _this.mCH=Tonyu.globals.$Sprites.getImageList()[Tonyu.globals.$pat_mapchip+0].height;
        Tonyu.globals.$mp=new Tonyu.classes.kernel.Map({row: _this.floor(_this.mIH/_this.mCH),col: _this.floor(_this.mIW/_this.mCW),chipWidth: _this.mCW,chipHeight: _this.mCH});
        _this.counter=0;
        for (_this.i = 0;
         _this.i<Tonyu.globals.$mp.row ; _this.i++) {
          {
            for (_this.j = 0;
             _this.j<Tonyu.globals.$mp.col ; _this.j++) {
              {
                Tonyu.globals.$mp.set(_this.j,_this.i,Tonyu.globals.$pat_mapchip+_this.counter);
                _this.counter++;
              }
            }
          }
        }
        (yield* _this.fiber$drawPanel(_thread));
        _this.mode="get";
        _this.prevMode="set";
        _this.mapp=0;
        _this.mx=- 40;
        _this.my=- 40;
        _this.chipX=- 40;
        _this.chipY=- 40;
        _this.x=Tonyu.globals.$screenWidth-_this.chipWidth/2;
        _this.y=Tonyu.globals.$screenHeight-_this.chipHeight/2;
        Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
        while (true) {
          _this.p=_this.mapp;
          if (_this.getkey("e")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="erase";
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("s")==1) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            if (_this.mode=="set") {
              _this.mode="setOn";
              
            } else {
              _this.mode="set";
              
            }
            _this.print(_this.mode+" mode");
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<120&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="set";
            _this.print(_this.mode+" mode");
            
          }
          if (Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="setOn";
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("g")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>240&&Tonyu.globals.$touches[0].x<360&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {
            if (_this.mode!="get") {
              _this.prevMode=_this.mode;
              Tonyu.globals.$mp.scrollTo(- 40,- 40);
              _this.mode="get";
              _this.chipX=- 40;
              _this.chipY=- 40;
              
            } else {
              Tonyu.globals.$mp.scrollTo(1000,1000);
              _this.mode=_this.prevMode;
              
            }
            _this.print(_this.mode+" mode");
            
          }
          if (_this.getkey("p")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>360&&Tonyu.globals.$touches[0].x<480&&Tonyu.globals.$touches[0].y>480&&Tonyu.globals.$touches[0].y<560)) {
            if (_this.loadedFile) {
              _this.saveFileName=prompt("input json file(*.json)",_this.loadedFile);
              
            } else {
              _this.saveFileName=prompt("input json file(*.json)","map.json");
              
            }
            if (_this.saveFileName) {
              _this.saveDataFile=_this.file("../maps/").rel(_this.saveFileName);
              _this.data=[Tonyu.globals.$map.mapTable,Tonyu.globals.$map.mapOnTable,Tonyu.globals.$map.chipWidth,Tonyu.globals.$map.chipHeight];
              _this.saveDataFile.obj(_this.data);
              _this.print(_this.saveFileName+" Saved");
              
            }
            
          }
          if (_this.getkey("c")==1||(Tonyu.globals.$touches[0].touched==1&&Tonyu.globals.$touches[0].x>120&&Tonyu.globals.$touches[0].x<240&&Tonyu.globals.$touches[0].y>560&&Tonyu.globals.$touches[0].y<640)) {
            Tonyu.globals.$mp.scrollTo(1000,1000);
            _this.mode="copy";
            _this.print(_this.mode+" mode");
            
          }
          if (_this.mode!="get") {
            if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
              _this.mx=_this.mx+8;
            }
            if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
              _this.mx=_this.mx-8;
            }
            if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
              _this.my=_this.my+8;
            }
            if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
              _this.my=_this.my-8;
            }
            Tonyu.globals.$map.scrollTo(_this.mx,_this.my);
            
          } else {
            if (_this.getkey("left")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<40&&Tonyu.globals.$touches[0].y<480)) {
              _this.chipX=_this.chipX+8;
            }
            if (_this.getkey("right")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>Tonyu.globals.$screenWidth-40&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480)) {
              _this.chipX=_this.chipX-8;
            }
            if (_this.getkey("up")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<40)) {
              _this.chipY=_this.chipY+8;
            }
            if (_this.getkey("down")>0||(Tonyu.globals.$touches[0].touched&&Tonyu.globals.$touches[0].x>0&&Tonyu.globals.$touches[0].x<Tonyu.globals.$screenWidth&&Tonyu.globals.$touches[0].y<480&&Tonyu.globals.$touches[0].y>440)) {
              _this.chipY=_this.chipY-8;
            }
            Tonyu.globals.$mp.scrollTo(_this.chipX,_this.chipY);
            
          }
          if (_this.getkey("i")==1) {
            Tonyu.globals.$map.chipWidth+=4;
            Tonyu.globals.$map.chipHeight+=4;
            Tonyu.globals.$map.redrawMap();
            _this.panel.die();
            _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
            _this.panel.x=_this.panel.width/2+40;
            _this.panel.y=_this.panel.height/2+40;
            _this.panel.setFillStyle("cyan");
            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            
          }
          if (_this.getkey("o")==1) {
            Tonyu.globals.$map.chipWidth-=4;
            Tonyu.globals.$map.chipHeight-=4;
            Tonyu.globals.$map.redrawMap();
            _this.panel.die();
            _this.panel=new Tonyu.classes.kernel.Panel({width: Tonyu.globals.$map.col*Tonyu.globals.$map.chipWidth,height: Tonyu.globals.$map.row*Tonyu.globals.$map.chipHeight,zOrder: 100});
            _this.panel.x=_this.panel.width/2+40;
            _this.panel.y=_this.panel.height/2+40;
            _this.panel.setFillStyle("cyan");
            _this.panel.fillRect(0,0,_this.panel.width,_this.panel.height);
            
          }
          _this.panel.x=_this.panel.width/2-_this.mx;
          _this.panel.y=_this.panel.height/2-_this.my;
          if (_this.mode=="set"&&_this.getkey(1)>0&&_this.inRect()) {
            Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
            Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
            
          } else {
            if (_this.mode=="erase"&&_this.getkey(1)>0&&_this.inRect()) {
              Tonyu.globals.$map.setAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,- 1);
              
            } else {
              if (_this.mode=="get"&&_this.getkey(1)>0&&_this.inRect()) {
                _this.mapp=Tonyu.globals.$mp.getAt(Tonyu.globals.$mouseX+_this.chipX,Tonyu.globals.$mouseY+_this.chipY);
                _this.mode=_this.prevMode;
                Tonyu.globals.$mp.scrollTo(1000,1000);
                _this.print(_this.mode+" mode");
                (yield* _this.fiber$updateEx(_thread, 10));
                
              } else {
                if (_this.mode=="setOn"&&_this.getkey(1)>0&&_this.inRect()) {
                  Tonyu.globals.$map.setOnAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my,_this.mapp);
                  
                } else {
                  if (_this.mode=="copy"&&_this.getkey(1)>0&&_this.inRect()) {
                    _this.mapp=Tonyu.globals.$map.getAt(Tonyu.globals.$mouseX+_this.mx,Tonyu.globals.$mouseY+_this.my);
                    _this.mode="set";
                    _this.print(_this.mode+" mode");
                    (yield* _this.fiber$updateEx(_thread, 10));
                    
                  }
                }
              }
            }
          }
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      inRect :function _trc_MapEditorOLD2_inRect() {
        var _this=this;
        
        return Tonyu.globals.$mouseX>40&&Tonyu.globals.$mouseX<Tonyu.globals.$screenWidth-40&&Tonyu.globals.$mouseY>40&&Tonyu.globals.$mouseY<Tonyu.globals.$screenHeight-200;
      },
      fiber$inRect :function* _trc_MapEditorOLD2_f_inRect(_thread) {
        var _this=this;
        
        return Tonyu.globals.$mouseX>40&&Tonyu.globals.$mouseX<Tonyu.globals.$screenWidth-40&&Tonyu.globals.$mouseY>40&&Tonyu.globals.$mouseY<Tonyu.globals.$screenHeight-200;
        
      },
      drawPanel :function _trc_MapEditorOLD2_drawPanel() {
        var _this=this;
        
        Tonyu.globals.$panel.setFillStyle("gray");
        Tonyu.globals.$panel.alpha=128;
        Tonyu.globals.$panel.fillRect(0,0,Tonyu.globals.$screenWidth,40);
        Tonyu.globals.$panel.fillRect(0,0,40,Tonyu.globals.$screenHeight-160);
        Tonyu.globals.$panel.fillRect(Tonyu.globals.$screenWidth-40,0,40,Tonyu.globals.$screenHeight-160);
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-200,Tonyu.globals.$screenWidth,40);
        Tonyu.globals.$panel.alpha=255;
        Tonyu.globals.$panel.setFillStyle("black");
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(240,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(360,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-80,120,80);
        Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-80,120,80);
        Tonyu.globals.$panel.setFillStyle("white");
        Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(250,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(370,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-70,100,60);
        Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-70,100,60);
        Tonyu.globals.$panel.setFillStyle("black");
        Tonyu.globals.$panel.fillText("↑",Tonyu.globals.$screenWidth/2,30,40,"center");
        Tonyu.globals.$panel.fillText("←",20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
        Tonyu.globals.$panel.fillText("↓",Tonyu.globals.$screenWidth/2,Tonyu.globals.$screenHeight-160-10,40,"center");
        Tonyu.globals.$panel.fillText("→",Tonyu.globals.$screenWidth-20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
        Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText("setOn",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
        Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
        Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
      },
      fiber$drawPanel :function* _trc_MapEditorOLD2_f_drawPanel(_thread) {
        var _this=this;
        
        Tonyu.globals.$panel.setFillStyle("gray");
        Tonyu.globals.$panel.alpha=128;
        Tonyu.globals.$panel.fillRect(0,0,Tonyu.globals.$screenWidth,40);
        Tonyu.globals.$panel.fillRect(0,0,40,Tonyu.globals.$screenHeight-160);
        Tonyu.globals.$panel.fillRect(Tonyu.globals.$screenWidth-40,0,40,Tonyu.globals.$screenHeight-160);
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-200,Tonyu.globals.$screenWidth,40);
        Tonyu.globals.$panel.alpha=255;
        Tonyu.globals.$panel.setFillStyle("black");
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(240,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(360,Tonyu.globals.$screenHeight-160,120,80);
        Tonyu.globals.$panel.fillRect(0,Tonyu.globals.$screenHeight-80,120,80);
        Tonyu.globals.$panel.fillRect(120,Tonyu.globals.$screenHeight-80,120,80);
        Tonyu.globals.$panel.setFillStyle("white");
        Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(250,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(370,Tonyu.globals.$screenHeight-150,100,60);
        Tonyu.globals.$panel.fillRect(10,Tonyu.globals.$screenHeight-70,100,60);
        Tonyu.globals.$panel.fillRect(130,Tonyu.globals.$screenHeight-70,100,60);
        Tonyu.globals.$panel.setFillStyle("black");
        Tonyu.globals.$panel.fillText("↑",Tonyu.globals.$screenWidth/2,30,40,"center");
        Tonyu.globals.$panel.fillText("←",20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
        Tonyu.globals.$panel.fillText("↓",Tonyu.globals.$screenWidth/2,Tonyu.globals.$screenHeight-160-10,40,"center");
        Tonyu.globals.$panel.fillText("→",Tonyu.globals.$screenWidth-20,(Tonyu.globals.$screenHeight-200)/2,40,"center");
        Tonyu.globals.$panel.fillText("set",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText("setOn",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-110,35,"center");
        Tonyu.globals.$panel.fillText("get",Tonyu.globals.$screenWidth/2+60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText("save",Tonyu.globals.$screenWidth-60,Tonyu.globals.$screenHeight-110,40,"center");
        Tonyu.globals.$panel.fillText("erase",Tonyu.globals.$screenWidth/4-60,Tonyu.globals.$screenHeight-30,35,"center");
        Tonyu.globals.$panel.fillText("copy",Tonyu.globals.$screenWidth/4+60,Tonyu.globals.$screenHeight-30,35,"center");
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"inRect":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"drawPanel":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"i":{"vtype":"Number"},"j":{"vtype":"Number"},"loadMode":{},"fileExist":{},"fileList":{},"fNames":{},"fileName":{},"mapDataFile":{},"baseData":{},"loadedFile":{},"mapData":{},"mapOnData":{},"chipWidth":{},"chipHeight":{},"row":{},"col":{},"panel":{},"mIW":{},"mIH":{},"mCW":{},"mCH":{},"counter":{},"mode":{},"prevMode":{},"mapp":{},"mx":{},"my":{},"chipX":{},"chipY":{},"saveFileName":{},"saveDataFile":{},"data":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Pad',
  shortName: 'Pad',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_Pad_main() {
        var _this=this;
        
        while (true) {
          _this.padUpdate();
          _this.update();
          
        }
      },
      fiber$main :function* _trc_Pad_f_main(_thread) {
        var _this=this;
        
        while (true) {
          (yield* _this.fiber$padUpdate(_thread));
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      initialize :function _trc_Pad_initialize(opt) {
        var _this=this;
        
        opt=opt||{};
        __superClass.apply( _this, [opt]);
        if (! _this.buttonCnt&&(_this.version==null||_this.version==1)&&Tonyu.globals.$pat_inputPad!=undefined) {
          _this.version=1;
          
        } else {
          _this.version=2;
          
        }
        if (_this.version==1) {
          _this.newPadV1(opt);
          
        } else {
          _this.newPadV2(opt);
          
        }
        if (_this.active==null) {
          _this.active=true;
        }
        if (_this.active) {
          _this.activate(opt);
          
        }
      },
      activate :function _trc_Pad_activate(opt) {
        var _this=this;
        
        if (opt) {
          if (opt.buttonCnt) {
            _this.buttonCnt=opt.buttonCnt;
            _this.drawPanel();
            _this.setXYPanel();
            
          }
          
        }
        _this.active=true;
        if (! _this.actived) {
          _this.actived=true;
          
        }
      },
      fiber$activate :function* _trc_Pad_f_activate(_thread,opt) {
        var _this=this;
        
        if (opt) {
          if (opt.buttonCnt) {
            _this.buttonCnt=opt.buttonCnt;
            (yield* _this.fiber$drawPanel(_thread));
            (yield* _this.fiber$setXYPanel(_thread));
            
          }
          
        }
        _this.active=true;
        if (! _this.actived) {
          _this.actived=true;
          
        }
        
      },
      newPadV2 :function _trc_Pad_newPadV2(opt) {
        var _this=this;
        
        _this.died=false;
        if (_this.layout==null) {
          _this.layout=1;
        }
        if (_this.buttonCnt==null) {
          _this.buttonCnt=1;
        }
        if (_this.autoMove==null) {
          _this.autoMove=true;
        }
        if (opt.layer==null) {
          _this.layer=Tonyu.globals.$frontLayer;
        }
        _this.initButton();
      },
      fiber$newPadV2 :function* _trc_Pad_f_newPadV2(_thread,opt) {
        var _this=this;
        
        _this.died=false;
        if (_this.layout==null) {
          _this.layout=1;
        }
        if (_this.buttonCnt==null) {
          _this.buttonCnt=1;
        }
        if (_this.autoMove==null) {
          _this.autoMove=true;
        }
        if (opt.layer==null) {
          _this.layer=Tonyu.globals.$frontLayer;
        }
        (yield* _this.fiber$initButton(_thread));
        
      },
      newPadV1 :function _trc_Pad_newPadV1(opt) {
        var _this=this;
        
        _this.APAD_DIAG_SIZE=96;
        _this.died=false;
        _this.padImageP=Tonyu.globals.$pat_inputPad;
        _this.padUpdateFrame=- 1;
        if (opt.layer==null) {
          _this.layer=Tonyu.globals.$frontLayer;
        }
        _this.jujiKey=new Tonyu.classes.kernel.Actor({x: 96+1,y: Tonyu.globals.$screenHeight-96-1,p: _this.padImageP+0,zOrder: - 9,layer: _this.layer});
        _this.no1Key=new Tonyu.classes.kernel.Actor({x: Tonyu.globals.$screenWidth-96,y: Tonyu.globals.$screenHeight-96,p: _this.padImageP+1,zOrder: - 9,layer: _this.layer});
        _this.jujiKey.show();
        _this.no1Key.show();
        _this.jujiKeyPushU=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y-60,p: _this.padImageP+2,zOrder: - 10,layer: _this.layer});
        _this.jujiKeyPushL=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x-60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: _this.layer});
        _this.jujiKeyPushR=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x+60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: _this.layer});
        _this.jujiKeyPushD=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y+60,p: _this.padImageP+2,zOrder: - 10,layer: _this.layer});
        _this.jujiKeyPush1=new Tonyu.classes.kernel.Actor({x: _this.no1Key.x,y: _this.no1Key.y,p: _this.padImageP+2,scaleX: 2,zOrder: - 10,layer: _this.layer});
        _this.jujiKeyPushU.hide();
        _this.jujiKeyPushL.hide();
        _this.jujiKeyPushR.hide();
        _this.jujiKeyPushD.hide();
        _this.jujiKeyPush1.hide();
      },
      fiber$newPadV1 :function* _trc_Pad_f_newPadV1(_thread,opt) {
        var _this=this;
        
        _this.APAD_DIAG_SIZE=96;
        _this.died=false;
        _this.padImageP=Tonyu.globals.$pat_inputPad;
        _this.padUpdateFrame=- 1;
        if (opt.layer==null) {
          _this.layer=Tonyu.globals.$frontLayer;
        }
        _this.jujiKey=new Tonyu.classes.kernel.Actor({x: 96+1,y: Tonyu.globals.$screenHeight-96-1,p: _this.padImageP+0,zOrder: - 9,layer: _this.layer});
        _this.no1Key=new Tonyu.classes.kernel.Actor({x: Tonyu.globals.$screenWidth-96,y: Tonyu.globals.$screenHeight-96,p: _this.padImageP+1,zOrder: - 9,layer: _this.layer});
        _this.jujiKey.show();
        _this.no1Key.show();
        _this.jujiKeyPushU=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y-60,p: _this.padImageP+2,zOrder: - 10,layer: _this.layer});
        _this.jujiKeyPushL=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x-60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: _this.layer});
        _this.jujiKeyPushR=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x+60,y: _this.jujiKey.y,p: _this.padImageP+2,zOrder: - 10,layer: _this.layer});
        _this.jujiKeyPushD=new Tonyu.classes.kernel.Actor({x: _this.jujiKey.x,y: _this.jujiKey.y+60,p: _this.padImageP+2,zOrder: - 10,layer: _this.layer});
        _this.jujiKeyPush1=new Tonyu.classes.kernel.Actor({x: _this.no1Key.x,y: _this.no1Key.y,p: _this.padImageP+2,scaleX: 2,zOrder: - 10,layer: _this.layer});
        _this.jujiKeyPushU.hide();
        _this.jujiKeyPushL.hide();
        _this.jujiKeyPushR.hide();
        _this.jujiKeyPushD.hide();
        _this.jujiKeyPush1.hide();
        
      },
      die :function _trc_Pad_die() {
        var _this=this;
        
        if (_this.version==1) {
          _this.dieV1();
          
        } else {
          _this.dieV2();
          
        }
        __superClass.prototype.die.apply( _this, []);
      },
      dieV2 :function _trc_Pad_dieV2() {
        var _this=this;
        var i;
        var obj;
        
        _this.died=true;
        if (_this.buttons!=null) {
          for (i = 0;
           i<_this.buttons.length ; i++) {
            {
              obj = _this.buttons[i];
              
              if (obj) {
                obj.die();
                _this.buttons[i]=null;
                
              }
            }
          }
          _this.buttons=null;
          
        }
        if (_this.jujiPads!=null) {
          for (i = 0;
           i<_this.jujiPads.length ; i++) {
            {
              obj = _this.jujiPads[i];
              
              if (obj) {
                obj.die();
                _this.jujiPads[i]=null;
                
              }
            }
          }
          _this.jujiPads=null;
          
        }
      },
      fiber$dieV2 :function* _trc_Pad_f_dieV2(_thread) {
        var _this=this;
        var i;
        var obj;
        
        _this.died=true;
        if (_this.buttons!=null) {
          for (i = 0;
           i<_this.buttons.length ; i++) {
            {
              obj = _this.buttons[i];
              
              if (obj) {
                obj.die();
                _this.buttons[i]=null;
                
              }
            }
          }
          _this.buttons=null;
          
        }
        if (_this.jujiPads!=null) {
          for (i = 0;
           i<_this.jujiPads.length ; i++) {
            {
              obj = _this.jujiPads[i];
              
              if (obj) {
                obj.die();
                _this.jujiPads[i]=null;
                
              }
            }
          }
          _this.jujiPads=null;
          
        }
        
      },
      dieV1 :function _trc_Pad_dieV1() {
        var _this=this;
        
        _this.died=true;
        _this.jujiKey.die();
        _this.no1Key.die();
        _this.jujiKeyPushU.show();
        _this.jujiKeyPushU.die();
        _this.jujiKeyPushL.show();
        _this.jujiKeyPushL.die();
        _this.jujiKeyPushR.show();
        _this.jujiKeyPushR.die();
        _this.jujiKeyPushD.show();
        _this.jujiKeyPushD.die();
        _this.jujiKeyPush1.show();
        _this.jujiKeyPush1.die();
      },
      fiber$dieV1 :function* _trc_Pad_f_dieV1(_thread) {
        var _this=this;
        
        _this.died=true;
        _this.jujiKey.die();
        _this.no1Key.die();
        _this.jujiKeyPushU.show();
        _this.jujiKeyPushU.die();
        _this.jujiKeyPushL.show();
        _this.jujiKeyPushL.die();
        _this.jujiKeyPushR.show();
        _this.jujiKeyPushR.die();
        _this.jujiKeyPushD.show();
        _this.jujiKeyPushD.die();
        _this.jujiKeyPush1.show();
        _this.jujiKeyPush1.die();
        
      },
      initButton :function _trc_Pad_initButton() {
        var _this=this;
        
        _this.DEFALT_SCREEN_WIDTH=465;
        _this.p=- 1;
        _this.jujiPads=[];
        _this.buttons=[];
        _this.padScaleX=1;
        _this.padUpdateFrame=- 1;
        if (_this.layout==1) {
          _this.initButtonLayout1();
          _this.setXYPanelLayout1();
          
        }
      },
      fiber$initButton :function* _trc_Pad_f_initButton(_thread) {
        var _this=this;
        
        _this.DEFALT_SCREEN_WIDTH=465;
        _this.p=- 1;
        _this.jujiPads=[];
        _this.buttons=[];
        _this.padScaleX=1;
        _this.padUpdateFrame=- 1;
        if (_this.layout==1) {
          (yield* _this.fiber$initButtonLayout1(_thread));
          (yield* _this.fiber$setXYPanelLayout1(_thread));
          
        }
        
      },
      initButtonLayout1 :function _trc_Pad_initButtonLayout1() {
        var _this=this;
        var screenSize;
        var sw;
        var sh;
        var tempJujiPadWidth;
        var tempJujiPadHeight;
        var tempJujiPadBorder;
        var i;
        var tempPadWidth;
        var tempPadHeight;
        var tempPadFillColor;
        var tempPadBorder;
        var tempPadBorderColor;
        var tempPadPushColor;
        var tempPadText;
        var tempPadTextSize;
        var tempPadTextColor;
        var obj;
        
        
        if (_this.layer==Tonyu.globals.$uiLayer) {
          sw=Tonyu.globals.$uiScreen.width;
          sh=Tonyu.globals.$uiScreen.height;
          
        } else {
          sw=Tonyu.globals.$screenWidth;
          sh=Tonyu.globals.$screenHeight;
          
        }
        screenSize=sw;
        if (sw>sh) {
          screenSize=sh;
        }
        _this.padScaleX=screenSize/465;
        _this.oldPadScaleX=_this.padScaleX;
        _this.oldButtonCnt=_this.buttonCnt;
        tempJujiPadWidth = _this.trunc(72*screenSize/_this.DEFALT_SCREEN_WIDTH)*3;
        
        tempJujiPadHeight = _this.trunc(72*screenSize/_this.DEFALT_SCREEN_WIDTH)*3;
        
        tempJujiPadBorder = 4*_this.padScaleX;
        
        if (_this.jujiPadWidth!=null) {
          tempJujiPadWidth=_this.jujiPadWidth;
        }
        if (_this.jujiPadHeight!=null) {
          tempJujiPadHeight=_this.jujiPadHeight;
        }
        if (_this.jujiPadBorder!=null) {
          tempJujiPadBorder=_this.jujiPadBorder;
        }
        _this.jujiPads[0]=new Tonyu.classes.kernel.PadButton({pad: _this,mode: 10001,x: 101,y: sh-101,alpha: _this.alpha,layer: _this.layer,width: tempJujiPadWidth,height: tempJujiPadHeight,padFillColor: _this.jujiPadFillColor,padBorder: tempJujiPadBorder,padBorderColor: _this.jujiPadBorderColor,padLPushColor: (_this.jujiPadLPushColor==null?_this.jujiPadPushColor:_this.jujiPadLPushColor),padRPushColor: (_this.jujiPadRPushColor==null?_this.jujiPadPushColor:_this.jujiPadRPushColor),padUPushColor: (_this.jujiPadUPushColor==null?_this.jujiPadPushColor:_this.jujiPadUPushColor),padDPushColor: (_this.jujiPadDPushColor==null?_this.jujiPadPushColor:_this.jujiPadDPushColor),padLColor: (_this.jujiPadLColor==null?_this.jujiPadColor:_this.jujiPadLColor),padRColor: (_this.jujiPadRColor==null?_this.jujiPadColor:_this.jujiPadRColor),padUColor: (_this.jujiPadUColor==null?_this.jujiPadColor:_this.jujiPadUColor),padDColor: (_this.jujiPadDColor==null?_this.jujiPadColor:_this.jujiPadDColor),diagonalEnable: _this.jujiPadDiagonalEnable,active: _this.active});
        for (i = 0;
         i<4 ; i++) {
          {
            tempPadWidth = _this.buttonWidth;
            
            tempPadHeight = _this.buttonHeight;
            
            tempPadFillColor = _this.buttonFillColor;
            
            tempPadBorder = _this.buttonBorder;
            
            tempPadBorderColor = _this.buttonBorderColor;
            
            tempPadPushColor = _this.buttonPushColor;
            
            tempPadText = _this.buttonText;
            
            tempPadTextSize = _this.buttonTextSize;
            
            tempPadTextColor = _this.buttonTextColor;
            
            if (_this.buttonCnt==1) {
              tempPadWidth=160*_this.padScaleX;
              tempPadHeight=160*_this.padScaleX;
              tempPadBorder=1*_this.padScaleX;
              tempPadTextSize=120*screenSize/_this.DEFALT_SCREEN_WIDTH;
              
            } else {
              if (_this.buttonCnt>=2) {
                if (i<4) {
                  obj = _this.buttons[i];
                  
                  if (obj) {
                    if (_this.buttonCnt==3&&i==2) {
                      tempPadWidth=194*_this.padScaleX;
                      
                    } else {
                      tempPadWidth=96*_this.padScaleX;
                      
                    }
                    tempPadHeight=96*_this.padScaleX;
                    tempPadBorder=1*_this.padScaleX;
                    tempPadTextSize=72*screenSize/_this.DEFALT_SCREEN_WIDTH;
                    
                  }
                  
                }
                
              }
            }
            if (_this.buttonWidth!=null) {
              tempPadWidth=_this.buttonWidth;
            }
            if (_this.buttonHeight!=null) {
              tempPadHeight=_this.buttonHeight;
            }
            if (_this.buttonBorder!=null) {
              tempPadBorder=_this.buttonBorder;
            }
            if (tempPadTextSize!=null) {
              tempPadTextSize=tempPadTextSize;
            }
            if (i==0) {
              if (_this.button1Width!=null) {
                tempPadWidth=_this.button1Width;
              }
              if (_this.button1Height!=null) {
                tempPadHeight=_this.button1Height;
              }
              if (_this.button1FillColor!=null) {
                tempPadFillColor=_this.button1FillColor;
              }
              if (_this.button1Border!=null) {
                tempPadBorder=_this.button1Border;
              }
              if (_this.button1BorderColor!=null) {
                tempPadBorderColor=_this.button1BorderColor;
              }
              if (_this.button1PushColor!=null) {
                tempPadPushColor=_this.button1PushColor;
              }
              if (_this.button1Text!=null) {
                tempPadText=_this.button1Text;
              }
              if (_this.button1TextSize!=null) {
                tempPadTextSize=_this.button1TextSize;
              }
              if (_this.button1TextColor!=null) {
                tempPadTextColor=_this.button1TextColor;
              }
              
            } else {
              if (i==1) {
                if (_this.button2Width!=null) {
                  tempPadWidth=_this.button2Width;
                }
                if (_this.button2Height!=null) {
                  tempPadHeight=_this.button2Height;
                }
                if (_this.button2FillColor!=null) {
                  tempPadFillColor=_this.button2FillColor;
                }
                if (_this.button2Border!=null) {
                  tempPadBorder=_this.button2Border;
                }
                if (_this.button2BorderColor!=null) {
                  tempPadBorderColor=_this.button2BorderColor;
                }
                if (_this.button2PushColor!=null) {
                  tempPadPushColor=_this.button2PushColor;
                }
                if (_this.button2Text!=null) {
                  tempPadText=_this.button2Text;
                }
                if (_this.button2TextSize!=null) {
                  tempPadTextSize=_this.button2TextSize;
                }
                if (_this.button2TextColor!=null) {
                  tempPadTextColor=_this.button2TextColor;
                }
                
              } else {
                if (i==2) {
                  if (_this.button3Width!=null) {
                    tempPadWidth=_this.button3Width;
                  }
                  if (_this.button3Height!=null) {
                    tempPadHeight=_this.button3Height;
                  }
                  if (_this.button3FillColor!=null) {
                    tempPadFillColor=_this.button3FillColor;
                  }
                  if (_this.button3Border!=null) {
                    tempPadBorder=_this.button3Border;
                  }
                  if (_this.button3BorderColor!=null) {
                    tempPadBorderColor=_this.button3BorderColor;
                  }
                  if (_this.button3PushColor!=null) {
                    tempPadPushColor=_this.button3PushColor;
                  }
                  if (_this.button3Text!=null) {
                    tempPadText=_this.button3Text;
                  }
                  if (_this.button3TextSize!=null) {
                    tempPadTextSize=_this.button3TextSize;
                  }
                  if (_this.button3TextColor!=null) {
                    tempPadTextColor=_this.button3TextColor;
                  }
                  
                } else {
                  if (i==3) {
                    if (_this.button4Width!=null) {
                      tempPadWidth=_this.button4Width;
                    }
                    if (_this.button4Height!=null) {
                      tempPadHeight=_this.button4Height;
                    }
                    if (_this.button4FillColor!=null) {
                      tempPadFillColor=_this.button4FillColor;
                    }
                    if (_this.button4Border!=null) {
                      tempPadBorder=_this.button4Border;
                    }
                    if (_this.button4BorderColor!=null) {
                      tempPadBorderColor=_this.button4BorderColor;
                    }
                    if (_this.button4PushColor!=null) {
                      tempPadPushColor=_this.button4PushColor;
                    }
                    if (_this.button4Text!=null) {
                      tempPadText=_this.button4Text;
                    }
                    if (_this.button4TextSize!=null) {
                      tempPadTextSize=_this.button4TextSize;
                    }
                    if (_this.button4TextColor!=null) {
                      tempPadTextColor=_this.button4TextColor;
                    }
                    
                  }
                }
              }
            }
            _this.buttons[i]=new Tonyu.classes.kernel.PadButton({pad: _this,mode: 10000,x: 50+(i-4)%4*100,y: 50+_this.trunc((i-4)/4)*100,alpha: _this.alpha,layer: _this.layer,width: tempPadWidth,height: tempPadHeight,padFillColor: tempPadFillColor,padBorder: tempPadBorder,padBorderColor: tempPadBorderColor,padPushColor: tempPadPushColor,padText: tempPadText?tempPadText:i+1,padTextSize: tempPadTextSize,padTextColor: tempPadTextColor,active: _this.active});
            _this.buttons[i].drawPanel();
          }
        }
        if (_this.autoMove) {
          _this.drawPanel();
        }
      },
      fiber$initButtonLayout1 :function* _trc_Pad_f_initButtonLayout1(_thread) {
        var _this=this;
        var screenSize;
        var sw;
        var sh;
        var tempJujiPadWidth;
        var tempJujiPadHeight;
        var tempJujiPadBorder;
        var i;
        var tempPadWidth;
        var tempPadHeight;
        var tempPadFillColor;
        var tempPadBorder;
        var tempPadBorderColor;
        var tempPadPushColor;
        var tempPadText;
        var tempPadTextSize;
        var tempPadTextColor;
        var obj;
        
        
        if (_this.layer==Tonyu.globals.$uiLayer) {
          sw=Tonyu.globals.$uiScreen.width;
          sh=Tonyu.globals.$uiScreen.height;
          
        } else {
          sw=Tonyu.globals.$screenWidth;
          sh=Tonyu.globals.$screenHeight;
          
        }
        screenSize=sw;
        if (sw>sh) {
          screenSize=sh;
        }
        _this.padScaleX=screenSize/465;
        _this.oldPadScaleX=_this.padScaleX;
        _this.oldButtonCnt=_this.buttonCnt;
        tempJujiPadWidth = _this.trunc(72*screenSize/_this.DEFALT_SCREEN_WIDTH)*3;
        
        tempJujiPadHeight = _this.trunc(72*screenSize/_this.DEFALT_SCREEN_WIDTH)*3;
        
        tempJujiPadBorder = 4*_this.padScaleX;
        
        if (_this.jujiPadWidth!=null) {
          tempJujiPadWidth=_this.jujiPadWidth;
        }
        if (_this.jujiPadHeight!=null) {
          tempJujiPadHeight=_this.jujiPadHeight;
        }
        if (_this.jujiPadBorder!=null) {
          tempJujiPadBorder=_this.jujiPadBorder;
        }
        _this.jujiPads[0]=new Tonyu.classes.kernel.PadButton({pad: _this,mode: 10001,x: 101,y: sh-101,alpha: _this.alpha,layer: _this.layer,width: tempJujiPadWidth,height: tempJujiPadHeight,padFillColor: _this.jujiPadFillColor,padBorder: tempJujiPadBorder,padBorderColor: _this.jujiPadBorderColor,padLPushColor: (_this.jujiPadLPushColor==null?_this.jujiPadPushColor:_this.jujiPadLPushColor),padRPushColor: (_this.jujiPadRPushColor==null?_this.jujiPadPushColor:_this.jujiPadRPushColor),padUPushColor: (_this.jujiPadUPushColor==null?_this.jujiPadPushColor:_this.jujiPadUPushColor),padDPushColor: (_this.jujiPadDPushColor==null?_this.jujiPadPushColor:_this.jujiPadDPushColor),padLColor: (_this.jujiPadLColor==null?_this.jujiPadColor:_this.jujiPadLColor),padRColor: (_this.jujiPadRColor==null?_this.jujiPadColor:_this.jujiPadRColor),padUColor: (_this.jujiPadUColor==null?_this.jujiPadColor:_this.jujiPadUColor),padDColor: (_this.jujiPadDColor==null?_this.jujiPadColor:_this.jujiPadDColor),diagonalEnable: _this.jujiPadDiagonalEnable,active: _this.active});
        for (i = 0;
         i<4 ; i++) {
          {
            tempPadWidth = _this.buttonWidth;
            
            tempPadHeight = _this.buttonHeight;
            
            tempPadFillColor = _this.buttonFillColor;
            
            tempPadBorder = _this.buttonBorder;
            
            tempPadBorderColor = _this.buttonBorderColor;
            
            tempPadPushColor = _this.buttonPushColor;
            
            tempPadText = _this.buttonText;
            
            tempPadTextSize = _this.buttonTextSize;
            
            tempPadTextColor = _this.buttonTextColor;
            
            if (_this.buttonCnt==1) {
              tempPadWidth=160*_this.padScaleX;
              tempPadHeight=160*_this.padScaleX;
              tempPadBorder=1*_this.padScaleX;
              tempPadTextSize=120*screenSize/_this.DEFALT_SCREEN_WIDTH;
              
            } else {
              if (_this.buttonCnt>=2) {
                if (i<4) {
                  obj = _this.buttons[i];
                  
                  if (obj) {
                    if (_this.buttonCnt==3&&i==2) {
                      tempPadWidth=194*_this.padScaleX;
                      
                    } else {
                      tempPadWidth=96*_this.padScaleX;
                      
                    }
                    tempPadHeight=96*_this.padScaleX;
                    tempPadBorder=1*_this.padScaleX;
                    tempPadTextSize=72*screenSize/_this.DEFALT_SCREEN_WIDTH;
                    
                  }
                  
                }
                
              }
            }
            if (_this.buttonWidth!=null) {
              tempPadWidth=_this.buttonWidth;
            }
            if (_this.buttonHeight!=null) {
              tempPadHeight=_this.buttonHeight;
            }
            if (_this.buttonBorder!=null) {
              tempPadBorder=_this.buttonBorder;
            }
            if (tempPadTextSize!=null) {
              tempPadTextSize=tempPadTextSize;
            }
            if (i==0) {
              if (_this.button1Width!=null) {
                tempPadWidth=_this.button1Width;
              }
              if (_this.button1Height!=null) {
                tempPadHeight=_this.button1Height;
              }
              if (_this.button1FillColor!=null) {
                tempPadFillColor=_this.button1FillColor;
              }
              if (_this.button1Border!=null) {
                tempPadBorder=_this.button1Border;
              }
              if (_this.button1BorderColor!=null) {
                tempPadBorderColor=_this.button1BorderColor;
              }
              if (_this.button1PushColor!=null) {
                tempPadPushColor=_this.button1PushColor;
              }
              if (_this.button1Text!=null) {
                tempPadText=_this.button1Text;
              }
              if (_this.button1TextSize!=null) {
                tempPadTextSize=_this.button1TextSize;
              }
              if (_this.button1TextColor!=null) {
                tempPadTextColor=_this.button1TextColor;
              }
              
            } else {
              if (i==1) {
                if (_this.button2Width!=null) {
                  tempPadWidth=_this.button2Width;
                }
                if (_this.button2Height!=null) {
                  tempPadHeight=_this.button2Height;
                }
                if (_this.button2FillColor!=null) {
                  tempPadFillColor=_this.button2FillColor;
                }
                if (_this.button2Border!=null) {
                  tempPadBorder=_this.button2Border;
                }
                if (_this.button2BorderColor!=null) {
                  tempPadBorderColor=_this.button2BorderColor;
                }
                if (_this.button2PushColor!=null) {
                  tempPadPushColor=_this.button2PushColor;
                }
                if (_this.button2Text!=null) {
                  tempPadText=_this.button2Text;
                }
                if (_this.button2TextSize!=null) {
                  tempPadTextSize=_this.button2TextSize;
                }
                if (_this.button2TextColor!=null) {
                  tempPadTextColor=_this.button2TextColor;
                }
                
              } else {
                if (i==2) {
                  if (_this.button3Width!=null) {
                    tempPadWidth=_this.button3Width;
                  }
                  if (_this.button3Height!=null) {
                    tempPadHeight=_this.button3Height;
                  }
                  if (_this.button3FillColor!=null) {
                    tempPadFillColor=_this.button3FillColor;
                  }
                  if (_this.button3Border!=null) {
                    tempPadBorder=_this.button3Border;
                  }
                  if (_this.button3BorderColor!=null) {
                    tempPadBorderColor=_this.button3BorderColor;
                  }
                  if (_this.button3PushColor!=null) {
                    tempPadPushColor=_this.button3PushColor;
                  }
                  if (_this.button3Text!=null) {
                    tempPadText=_this.button3Text;
                  }
                  if (_this.button3TextSize!=null) {
                    tempPadTextSize=_this.button3TextSize;
                  }
                  if (_this.button3TextColor!=null) {
                    tempPadTextColor=_this.button3TextColor;
                  }
                  
                } else {
                  if (i==3) {
                    if (_this.button4Width!=null) {
                      tempPadWidth=_this.button4Width;
                    }
                    if (_this.button4Height!=null) {
                      tempPadHeight=_this.button4Height;
                    }
                    if (_this.button4FillColor!=null) {
                      tempPadFillColor=_this.button4FillColor;
                    }
                    if (_this.button4Border!=null) {
                      tempPadBorder=_this.button4Border;
                    }
                    if (_this.button4BorderColor!=null) {
                      tempPadBorderColor=_this.button4BorderColor;
                    }
                    if (_this.button4PushColor!=null) {
                      tempPadPushColor=_this.button4PushColor;
                    }
                    if (_this.button4Text!=null) {
                      tempPadText=_this.button4Text;
                    }
                    if (_this.button4TextSize!=null) {
                      tempPadTextSize=_this.button4TextSize;
                    }
                    if (_this.button4TextColor!=null) {
                      tempPadTextColor=_this.button4TextColor;
                    }
                    
                  }
                }
              }
            }
            _this.buttons[i]=new Tonyu.classes.kernel.PadButton({pad: _this,mode: 10000,x: 50+(i-4)%4*100,y: 50+_this.trunc((i-4)/4)*100,alpha: _this.alpha,layer: _this.layer,width: tempPadWidth,height: tempPadHeight,padFillColor: tempPadFillColor,padBorder: tempPadBorder,padBorderColor: tempPadBorderColor,padPushColor: tempPadPushColor,padText: tempPadText?tempPadText:i+1,padTextSize: tempPadTextSize,padTextColor: tempPadTextColor,active: _this.active});
            _this.buttons[i].drawPanel();
          }
        }
        if (_this.autoMove) {
          (yield* _this.fiber$drawPanel(_thread));
        }
        
      },
      drawPanel :function _trc_Pad_drawPanel() {
        var _this=this;
        var screenSize;
        var sw;
        var sh;
        var i;
        var obj;
        
        if (_this.layout==1) {
          
          if (_this.layer==Tonyu.globals.$uiLayer) {
            sw=Tonyu.globals.$uiScreen.width;
            sh=Tonyu.globals.$uiScreen.height;
            
          } else {
            sw=Tonyu.globals.$screenWidth;
            sh=Tonyu.globals.$screenHeight;
            
          }
          screenSize=sw;
          if (sw>sh) {
            screenSize=sh;
          }
          _this.jujiPads[0].width=_this.trunc(72*screenSize/_this.DEFALT_SCREEN_WIDTH)*3;
          _this.jujiPads[0].height=_this.trunc(72*screenSize/_this.DEFALT_SCREEN_WIDTH)*3;
          _this.jujiPads[0].padBorder=1*_this.padScaleX;
          if (_this.buttonCnt==1) {
            _this.buttons[0].width=160*_this.padScaleX;
            _this.buttons[0].height=160*_this.padScaleX;
            _this.buttons[0].padBorder=1*_this.padScaleX;
            _this.buttons[0].padTextSize=120*screenSize/_this.DEFALT_SCREEN_WIDTH;
            
          } else {
            if (_this.buttonCnt>=2) {
              for (i = 0;
               i<_this.buttons.length ; i++) {
                {
                  if (i>=4) {
                    break;
                    
                  }
                  obj = _this.buttons[i];
                  
                  if (obj) {
                    if (_this.buttonCnt==3&&i==2) {
                      obj.width=194*_this.padScaleX;
                      
                    } else {
                      obj.width=96*_this.padScaleX;
                      
                    }
                    obj.height=96*_this.padScaleX;
                    obj.padBorder=1*_this.padScaleX;
                    obj.padTextSize=72*screenSize/_this.DEFALT_SCREEN_WIDTH;
                    
                  }
                }
              }
              
            }
          }
          
        }
        for (i = 0;
         i<_this.jujiPads.length ; i++) {
          {
            obj = _this.jujiPads[i];
            
            if (obj) {
              obj.drawPanel();
            }
          }
        }
        for (i = 0;
         i<_this.buttons.length ; i++) {
          {
            obj = _this.buttons[i];
            
            if (obj) {
              if (i<_this.buttonCnt) {
                obj.show();
                obj.drawPanel();
                
              } else {
                obj.hide();
                
              }
              
            }
          }
        }
      },
      fiber$drawPanel :function* _trc_Pad_f_drawPanel(_thread) {
        var _this=this;
        var screenSize;
        var sw;
        var sh;
        var i;
        var obj;
        
        if (_this.layout==1) {
          
          if (_this.layer==Tonyu.globals.$uiLayer) {
            sw=Tonyu.globals.$uiScreen.width;
            sh=Tonyu.globals.$uiScreen.height;
            
          } else {
            sw=Tonyu.globals.$screenWidth;
            sh=Tonyu.globals.$screenHeight;
            
          }
          screenSize=sw;
          if (sw>sh) {
            screenSize=sh;
          }
          _this.jujiPads[0].width=_this.trunc(72*screenSize/_this.DEFALT_SCREEN_WIDTH)*3;
          _this.jujiPads[0].height=_this.trunc(72*screenSize/_this.DEFALT_SCREEN_WIDTH)*3;
          _this.jujiPads[0].padBorder=1*_this.padScaleX;
          if (_this.buttonCnt==1) {
            _this.buttons[0].width=160*_this.padScaleX;
            _this.buttons[0].height=160*_this.padScaleX;
            _this.buttons[0].padBorder=1*_this.padScaleX;
            _this.buttons[0].padTextSize=120*screenSize/_this.DEFALT_SCREEN_WIDTH;
            
          } else {
            if (_this.buttonCnt>=2) {
              for (i = 0;
               i<_this.buttons.length ; i++) {
                {
                  if (i>=4) {
                    break;
                    
                  }
                  obj = _this.buttons[i];
                  
                  if (obj) {
                    if (_this.buttonCnt==3&&i==2) {
                      obj.width=194*_this.padScaleX;
                      
                    } else {
                      obj.width=96*_this.padScaleX;
                      
                    }
                    obj.height=96*_this.padScaleX;
                    obj.padBorder=1*_this.padScaleX;
                    obj.padTextSize=72*screenSize/_this.DEFALT_SCREEN_WIDTH;
                    
                  }
                }
              }
              
            }
          }
          
        }
        for (i = 0;
         i<_this.jujiPads.length ; i++) {
          {
            obj = _this.jujiPads[i];
            
            if (obj) {
              obj.drawPanel();
            }
          }
        }
        for (i = 0;
         i<_this.buttons.length ; i++) {
          {
            obj = _this.buttons[i];
            
            if (obj) {
              if (i<_this.buttonCnt) {
                obj.show();
                obj.drawPanel();
                
              } else {
                obj.hide();
                
              }
              
            }
          }
        }
        
      },
      setXYPanel :function _trc_Pad_setXYPanel() {
        var _this=this;
        
        if (_this.layout==1) {
          _this.setXYPanelLayout1();
          
        }
      },
      fiber$setXYPanel :function* _trc_Pad_f_setXYPanel(_thread) {
        var _this=this;
        
        if (_this.layout==1) {
          (yield* _this.fiber$setXYPanelLayout1(_thread));
          
        }
        
      },
      setXYPanelLayout1 :function _trc_Pad_setXYPanelLayout1() {
        var _this=this;
        var sw;
        var sh;
        
        
        if (_this.layer==Tonyu.globals.$uiLayer) {
          sw=Tonyu.globals.$uiScreen.width;
          sh=Tonyu.globals.$uiScreen.height;
          
        } else {
          sw=Tonyu.globals.$screenWidth;
          sh=Tonyu.globals.$screenHeight;
          
        }
        _this.jujiPads[0].x=112*_this.trunc(_this.padScaleX*64)/64;
        _this.jujiPads[0].y=sh-112*_this.trunc(_this.padScaleX*64)/64;
        if (_this.buttonCnt==1) {
          _this.buttons[0].x=sw-84*_this.padScaleX;
          _this.buttons[0].y=sh-84*_this.padScaleX;
          
        } else {
          if (_this.buttonCnt==2) {
            _this.buttons[0].x=sw-52*_this.padScaleX;
            _this.buttons[0].y=sh-52*_this.padScaleX;
            _this.buttons[1].x=sw-150*_this.padScaleX;
            _this.buttons[1].y=sh-52*_this.padScaleX;
            
          } else {
            if (_this.buttonCnt==3) {
              _this.buttons[0].x=sw-52*_this.padScaleX;
              _this.buttons[0].y=sh-52*_this.padScaleX;
              _this.buttons[1].x=sw-150*_this.padScaleX;
              _this.buttons[1].y=sh-52*_this.padScaleX;
              _this.buttons[2].x=sw-101*_this.padScaleX;
              _this.buttons[2].y=sh-150*_this.padScaleX;
              
            } else {
              if (_this.buttonCnt>=4) {
                _this.buttons[0].x=sw-52*_this.padScaleX;
                _this.buttons[0].y=sh-52*_this.padScaleX;
                _this.buttons[1].x=sw-150*_this.padScaleX;
                _this.buttons[1].y=sh-52*_this.padScaleX;
                _this.buttons[2].x=sw-52*_this.padScaleX;
                _this.buttons[2].y=sh-150*_this.padScaleX;
                _this.buttons[3].x=sw-150*_this.padScaleX;
                _this.buttons[3].y=sh-150*_this.padScaleX;
                
              }
            }
          }
        }
      },
      fiber$setXYPanelLayout1 :function* _trc_Pad_f_setXYPanelLayout1(_thread) {
        var _this=this;
        var sw;
        var sh;
        
        
        if (_this.layer==Tonyu.globals.$uiLayer) {
          sw=Tonyu.globals.$uiScreen.width;
          sh=Tonyu.globals.$uiScreen.height;
          
        } else {
          sw=Tonyu.globals.$screenWidth;
          sh=Tonyu.globals.$screenHeight;
          
        }
        _this.jujiPads[0].x=112*_this.trunc(_this.padScaleX*64)/64;
        _this.jujiPads[0].y=sh-112*_this.trunc(_this.padScaleX*64)/64;
        if (_this.buttonCnt==1) {
          _this.buttons[0].x=sw-84*_this.padScaleX;
          _this.buttons[0].y=sh-84*_this.padScaleX;
          
        } else {
          if (_this.buttonCnt==2) {
            _this.buttons[0].x=sw-52*_this.padScaleX;
            _this.buttons[0].y=sh-52*_this.padScaleX;
            _this.buttons[1].x=sw-150*_this.padScaleX;
            _this.buttons[1].y=sh-52*_this.padScaleX;
            
          } else {
            if (_this.buttonCnt==3) {
              _this.buttons[0].x=sw-52*_this.padScaleX;
              _this.buttons[0].y=sh-52*_this.padScaleX;
              _this.buttons[1].x=sw-150*_this.padScaleX;
              _this.buttons[1].y=sh-52*_this.padScaleX;
              _this.buttons[2].x=sw-101*_this.padScaleX;
              _this.buttons[2].y=sh-150*_this.padScaleX;
              
            } else {
              if (_this.buttonCnt>=4) {
                _this.buttons[0].x=sw-52*_this.padScaleX;
                _this.buttons[0].y=sh-52*_this.padScaleX;
                _this.buttons[1].x=sw-150*_this.padScaleX;
                _this.buttons[1].y=sh-52*_this.padScaleX;
                _this.buttons[2].x=sw-52*_this.padScaleX;
                _this.buttons[2].y=sh-150*_this.padScaleX;
                _this.buttons[3].x=sw-150*_this.padScaleX;
                _this.buttons[3].y=sh-150*_this.padScaleX;
                
              }
            }
          }
        }
        
      },
      padUpdate :function _trc_Pad_padUpdate() {
        var _this=this;
        
        if (! _this.active) {
          return _this;
        }
        _this.activate();
        if (_this.version==1) {
          _this.padUpdateV1();
          
        } else {
          _this.padUpdateV2();
          
        }
      },
      fiber$padUpdate :function* _trc_Pad_f_padUpdate(_thread) {
        var _this=this;
        
        if (! _this.active) {
          return _this;
        }
        (yield* _this.fiber$activate(_thread));
        if (_this.version==1) {
          (yield* _this.fiber$padUpdateV1(_thread));
          
        } else {
          (yield* _this.fiber$padUpdateV2(_thread));
          
        }
        
      },
      padUpdateV2 :function _trc_Pad_padUpdateV2() {
        var _this=this;
        var screenSize;
        var sw;
        var sh;
        
        _this.padsUpdateV2();
        
        if (_this.layer==Tonyu.globals.$uiLayer) {
          sw=Tonyu.globals.$uiScreen.width;
          sh=Tonyu.globals.$uiScreen.height;
          
        } else {
          sw=Tonyu.globals.$screenWidth;
          sh=Tonyu.globals.$screenHeight;
          
        }
        screenSize=sw;
        if (sw>sh) {
          screenSize=sh;
        }
        _this.padScaleX=screenSize/465;
        if (_this.padScaleX!=_this.oldPadScaleX) {
          if (_this.autoMove) {
            _this.drawPanel();
          }
          _this.oldPadScaleX=_this.padScaleX;
          
        }
        if (sw!=_this.oldScreenWidth||sh!=_this.oldScreenHeight) {
          if (_this.autoMove) {
            _this.setXYPanel();
          }
          _this.oldScreenWidth=sw;
          _this.oldScreenHeight=sh;
          _this.oldButtonCnt=_this.buttonCnt;
          
        }
      },
      fiber$padUpdateV2 :function* _trc_Pad_f_padUpdateV2(_thread) {
        var _this=this;
        var screenSize;
        var sw;
        var sh;
        
        (yield* _this.fiber$padsUpdateV2(_thread));
        
        if (_this.layer==Tonyu.globals.$uiLayer) {
          sw=Tonyu.globals.$uiScreen.width;
          sh=Tonyu.globals.$uiScreen.height;
          
        } else {
          sw=Tonyu.globals.$screenWidth;
          sh=Tonyu.globals.$screenHeight;
          
        }
        screenSize=sw;
        if (sw>sh) {
          screenSize=sh;
        }
        _this.padScaleX=screenSize/465;
        if (_this.padScaleX!=_this.oldPadScaleX) {
          if (_this.autoMove) {
            (yield* _this.fiber$drawPanel(_thread));
          }
          _this.oldPadScaleX=_this.padScaleX;
          
        }
        if (sw!=_this.oldScreenWidth||sh!=_this.oldScreenHeight) {
          if (_this.autoMove) {
            (yield* _this.fiber$setXYPanel(_thread));
          }
          _this.oldScreenWidth=sw;
          _this.oldScreenHeight=sh;
          _this.oldButtonCnt=_this.buttonCnt;
          
        }
        
      },
      padUpdateV1 :function _trc_Pad_padUpdateV1() {
        var _this=this;
        var i;
        var t;
        
        if (_this.padUpdateFrame==Tonyu.globals.$frameCount) {
          return _this;
        }
        _this.padUpdateFrame=Tonyu.globals.$frameCount;
        _this.keyPushL=0;
        _this.keyPushR=0;
        _this.keyPushU=0;
        _this.keyPushD=0;
        _this.keyPush1=0;
        _this.padKeyNotapCnt++;
        for (i = 0;
         i<5 ; i++) {
          {
            t = Tonyu.globals.$touches[i];
            
            if (t.touched) {
              if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {
                _this.keyPushU=1;
              }
              if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {
                _this.keyPushD=1;
              }
              if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {
                _this.keyPushL=1;
              }
              if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {
                _this.keyPushR=1;
              }
              if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {
                _this.keyPush1=1;
              }
              _this.padKeySW=1;
              _this.padKeyNotapCnt=0;
              
            }
          }
        }
        if (_this.keyPushL) {
          _this.keyCntL++;
        } else {
          _this.keyCntL=0;
        }
        if (_this.keyPushR) {
          _this.keyCntR++;
        } else {
          _this.keyCntR=0;
        }
        if (_this.keyPushU) {
          _this.keyCntU++;
        } else {
          _this.keyCntU=0;
        }
        if (_this.keyPushD) {
          _this.keyCntD++;
        } else {
          _this.keyCntD=0;
        }
        if (_this.keyPush1) {
          _this.keyCnt1++;
        } else {
          _this.keyCnt1=0;
        }
        if (_this.keyPushL) {
          _this.jujiKeyPushL.show();
        } else {
          _this.jujiKeyPushL.hide();
        }
        if (_this.keyPushR) {
          _this.jujiKeyPushR.show();
        } else {
          _this.jujiKeyPushR.hide();
        }
        if (_this.keyPushU) {
          _this.jujiKeyPushU.show();
        } else {
          _this.jujiKeyPushU.hide();
        }
        if (_this.keyPushD) {
          _this.jujiKeyPushD.show();
        } else {
          _this.jujiKeyPushD.hide();
        }
        if (_this.keyPush1) {
          _this.jujiKeyPush1.show();
        } else {
          _this.jujiKeyPush1.hide();
        }
      },
      fiber$padUpdateV1 :function* _trc_Pad_f_padUpdateV1(_thread) {
        var _this=this;
        var i;
        var t;
        
        if (_this.padUpdateFrame==Tonyu.globals.$frameCount) {
          return _this;
        }
        _this.padUpdateFrame=Tonyu.globals.$frameCount;
        _this.keyPushL=0;
        _this.keyPushR=0;
        _this.keyPushU=0;
        _this.keyPushD=0;
        _this.keyPush1=0;
        _this.padKeyNotapCnt++;
        for (i = 0;
         i<5 ; i++) {
          {
            t = Tonyu.globals.$touches[i];
            
            if (t.touched) {
              if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32-64,64+_this.APAD_DIAG_SIZE,64)) {
                _this.keyPushU=1;
              }
              if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-_this.APAD_DIAG_SIZE/2,_this.jujiKey.y-32+64,64+_this.APAD_DIAG_SIZE,64)) {
                _this.keyPushD=1;
              }
              if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32-64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {
                _this.keyPushL=1;
              }
              if (_this.isOnRectWH(t.x,t.y,_this.jujiKey.x-32+64,_this.jujiKey.y-32-_this.APAD_DIAG_SIZE/2,64,64+_this.APAD_DIAG_SIZE)) {
                _this.keyPushR=1;
              }
              if (_this.isOnRectWH(t.x,t.y,_this.no1Key.x-64,_this.no1Key.y-64,128,128)) {
                _this.keyPush1=1;
              }
              _this.padKeySW=1;
              _this.padKeyNotapCnt=0;
              
            }
          }
        }
        if (_this.keyPushL) {
          _this.keyCntL++;
        } else {
          _this.keyCntL=0;
        }
        if (_this.keyPushR) {
          _this.keyCntR++;
        } else {
          _this.keyCntR=0;
        }
        if (_this.keyPushU) {
          _this.keyCntU++;
        } else {
          _this.keyCntU=0;
        }
        if (_this.keyPushD) {
          _this.keyCntD++;
        } else {
          _this.keyCntD=0;
        }
        if (_this.keyPush1) {
          _this.keyCnt1++;
        } else {
          _this.keyCnt1=0;
        }
        if (_this.keyPushL) {
          _this.jujiKeyPushL.show();
        } else {
          _this.jujiKeyPushL.hide();
        }
        if (_this.keyPushR) {
          _this.jujiKeyPushR.show();
        } else {
          _this.jujiKeyPushR.hide();
        }
        if (_this.keyPushU) {
          _this.jujiKeyPushU.show();
        } else {
          _this.jujiKeyPushU.hide();
        }
        if (_this.keyPushD) {
          _this.jujiKeyPushD.show();
        } else {
          _this.jujiKeyPushD.hide();
        }
        if (_this.keyPush1) {
          _this.jujiKeyPush1.show();
        } else {
          _this.jujiKeyPush1.hide();
        }
        
      },
      padsUpdateV2 :function _trc_Pad_padsUpdateV2() {
        var _this=this;
        var i;
        var obj;
        
        if (_this.padUpdateFrame==Tonyu.globals.$frameCount) {
          return _this;
        }
        _this.padUpdateFrame=Tonyu.globals.$frameCount;
        for (i = 0;
         i<_this.buttons.length ; i++) {
          {
            obj = _this.buttons[i];
            
            if (obj) {
              obj.padUpdate();
            }
          }
        }
        for (i = 0;
         i<_this.jujiPads.length ; i++) {
          {
            obj = _this.jujiPads[i];
            
            if (obj) {
              obj.padUpdate();
            }
          }
        }
      },
      fiber$padsUpdateV2 :function* _trc_Pad_f_padsUpdateV2(_thread) {
        var _this=this;
        var i;
        var obj;
        
        if (_this.padUpdateFrame==Tonyu.globals.$frameCount) {
          return _this;
        }
        _this.padUpdateFrame=Tonyu.globals.$frameCount;
        for (i = 0;
         i<_this.buttons.length ; i++) {
          {
            obj = _this.buttons[i];
            
            if (obj) {
              obj.padUpdate();
            }
          }
        }
        for (i = 0;
         i<_this.jujiPads.length ; i++) {
          {
            obj = _this.jujiPads[i];
            
            if (obj) {
              obj.padUpdate();
            }
          }
        }
        
      },
      getUp :function _trc_Pad_getUp(i) {
        var _this=this;
        var value;
        
        if (_this.died) {
          return 0;
        }
        _this.activate();
        _this.padUpdate();
        value = 0;
        
        if (_this.version==1) {
          return _this.keyCntU;
          
        } else {
          if (i==null) {
            i=0;
          }
          if (i>=0&&i<_this.jujiPads.length) {
            value=_this.jujiPads[i].padCntU;
          }
          
        }
        return value;
      },
      fiber$getUp :function* _trc_Pad_f_getUp(_thread,i) {
        var _this=this;
        var value;
        
        if (_this.died) {
          return 0;
        }
        (yield* _this.fiber$activate(_thread));
        (yield* _this.fiber$padUpdate(_thread));
        value = 0;
        
        if (_this.version==1) {
          return _this.keyCntU;
          
        } else {
          if (i==null) {
            i=0;
          }
          if (i>=0&&i<_this.jujiPads.length) {
            value=_this.jujiPads[i].padCntU;
          }
          
        }
        return value;
        
      },
      getDown :function _trc_Pad_getDown(i) {
        var _this=this;
        var value;
        
        if (_this.died) {
          return 0;
        }
        _this.activate();
        _this.padUpdate();
        value = 0;
        
        if (_this.jujiPads==null) {
          return _this.keyCntD;
          
        } else {
          if (i==null) {
            i=0;
          }
          if (i>=0&&i<_this.jujiPads.length) {
            value=_this.jujiPads[i].padCntD;
          }
          
        }
        return value;
      },
      fiber$getDown :function* _trc_Pad_f_getDown(_thread,i) {
        var _this=this;
        var value;
        
        if (_this.died) {
          return 0;
        }
        (yield* _this.fiber$activate(_thread));
        (yield* _this.fiber$padUpdate(_thread));
        value = 0;
        
        if (_this.jujiPads==null) {
          return _this.keyCntD;
          
        } else {
          if (i==null) {
            i=0;
          }
          if (i>=0&&i<_this.jujiPads.length) {
            value=_this.jujiPads[i].padCntD;
          }
          
        }
        return value;
        
      },
      getLeft :function _trc_Pad_getLeft(i) {
        var _this=this;
        var value;
        
        if (_this.died) {
          return 0;
        }
        _this.activate();
        _this.padUpdate();
        value = 0;
        
        if (_this.jujiPads==null) {
          return _this.keyCntL;
          
        } else {
          if (i==null) {
            i=0;
          }
          if (i>=0&&i<_this.jujiPads.length) {
            value=_this.jujiPads[i].padCntL;
          }
          
        }
        return value;
      },
      fiber$getLeft :function* _trc_Pad_f_getLeft(_thread,i) {
        var _this=this;
        var value;
        
        if (_this.died) {
          return 0;
        }
        (yield* _this.fiber$activate(_thread));
        (yield* _this.fiber$padUpdate(_thread));
        value = 0;
        
        if (_this.jujiPads==null) {
          return _this.keyCntL;
          
        } else {
          if (i==null) {
            i=0;
          }
          if (i>=0&&i<_this.jujiPads.length) {
            value=_this.jujiPads[i].padCntL;
          }
          
        }
        return value;
        
      },
      getRight :function _trc_Pad_getRight(i) {
        var _this=this;
        var value;
        
        if (_this.died) {
          return 0;
        }
        _this.activate();
        _this.padUpdate();
        value = 0;
        
        if (_this.jujiPads==null) {
          return _this.keyCntR;
          
        } else {
          if (i==null) {
            i=0;
          }
          if (i>=0&&i<_this.jujiPads.length) {
            value=_this.jujiPads[i].padCntR;
          }
          
        }
        return value;
      },
      fiber$getRight :function* _trc_Pad_f_getRight(_thread,i) {
        var _this=this;
        var value;
        
        if (_this.died) {
          return 0;
        }
        (yield* _this.fiber$activate(_thread));
        (yield* _this.fiber$padUpdate(_thread));
        value = 0;
        
        if (_this.jujiPads==null) {
          return _this.keyCntR;
          
        } else {
          if (i==null) {
            i=0;
          }
          if (i>=0&&i<_this.jujiPads.length) {
            value=_this.jujiPads[i].padCntR;
          }
          
        }
        return value;
        
      },
      getButton :function _trc_Pad_getButton(i) {
        var _this=this;
        var value;
        
        if (_this.died) {
          return 0;
        }
        _this.activate();
        _this.padUpdate();
        value = 0;
        
        if (_this.buttons==null) {
          if (i==0) {
            value=_this.keyCnt1;
          }
          
        } else {
          if (! i) {
            i=1;
          }
          i--;
          if (i>=0&&i<_this.buttons.length) {
            value=_this.buttons[i].padCnt;
          } else {
            if (i==- 37-1||i=="left") {
              value=_this.getLeft();
            } else {
              if (i==- 38-1||i=="up") {
                value=_this.getUp();
              } else {
                if (i==- 39-1||i=="right") {
                  value=_this.getRight();
                } else {
                  if (i==- 40-1||i=="down") {
                    value=_this.getDown();
                  }
                }
              }
            }
          }
          
        }
        return value;
      },
      fiber$getButton :function* _trc_Pad_f_getButton(_thread,i) {
        var _this=this;
        var value;
        
        if (_this.died) {
          return 0;
        }
        (yield* _this.fiber$activate(_thread));
        (yield* _this.fiber$padUpdate(_thread));
        value = 0;
        
        if (_this.buttons==null) {
          if (i==0) {
            value=_this.keyCnt1;
          }
          
        } else {
          if (! i) {
            i=1;
          }
          i--;
          if (i>=0&&i<_this.buttons.length) {
            value=_this.buttons[i].padCnt;
          } else {
            if (i==- 37-1||i=="left") {
              value=(yield* _this.fiber$getLeft(_thread));
            } else {
              if (i==- 38-1||i=="up") {
                value=(yield* _this.fiber$getUp(_thread));
              } else {
                if (i==- 39-1||i=="right") {
                  value=(yield* _this.fiber$getRight(_thread));
                } else {
                  if (i==- 40-1||i=="down") {
                    value=(yield* _this.fiber$getDown(_thread));
                  }
                }
              }
            }
          }
          
        }
        return value;
        
      },
      getJujiPadObj :function _trc_Pad_getJujiPadObj(i) {
        var _this=this;
        var obj;
        
        _this.activate();
        if (_this.jujiPads==null) {
          return null;
        }
        obj = null;
        
        if (i==null) {
          i=0;
        }
        if (i>=0&&i<_this.jujiPads.length) {
          obj=_this.jujiPads[i];
        }
        return obj;
      },
      fiber$getJujiPadObj :function* _trc_Pad_f_getJujiPadObj(_thread,i) {
        var _this=this;
        var obj;
        
        (yield* _this.fiber$activate(_thread));
        if (_this.jujiPads==null) {
          return null;
        }
        obj = null;
        
        if (i==null) {
          i=0;
        }
        if (i>=0&&i<_this.jujiPads.length) {
          obj=_this.jujiPads[i];
        }
        return obj;
        
      },
      getJujiPadObjLength :function _trc_Pad_getJujiPadObjLength(i) {
        var _this=this;
        
        _this.activate();
        if (_this.jujiPads==null) {
          return null;
        }
        return _this.jujiPads.length;
      },
      fiber$getJujiPadObjLength :function* _trc_Pad_f_getJujiPadObjLength(_thread,i) {
        var _this=this;
        
        (yield* _this.fiber$activate(_thread));
        if (_this.jujiPads==null) {
          return null;
        }
        return _this.jujiPads.length;
        
      },
      getButtonObj :function _trc_Pad_getButtonObj(i) {
        var _this=this;
        var obj;
        
        _this.activate();
        if (_this.buttons==null) {
          return null;
        }
        obj = null;
        
        if (i==null) {
          i=0;
        }
        if (i>=0&&i<_this.buttons.length) {
          obj=_this.buttons[i];
        }
        return obj;
      },
      fiber$getButtonObj :function* _trc_Pad_f_getButtonObj(_thread,i) {
        var _this=this;
        var obj;
        
        (yield* _this.fiber$activate(_thread));
        if (_this.buttons==null) {
          return null;
        }
        obj = null;
        
        if (i==null) {
          i=0;
        }
        if (i>=0&&i<_this.buttons.length) {
          obj=_this.buttons[i];
        }
        return obj;
        
      },
      getButtonObjLength :function _trc_Pad_getButtonObjLength(i) {
        var _this=this;
        
        _this.activate();
        if (_this.buttons==null) {
          return null;
        }
        return _this.buttons.length;
      },
      fiber$getButtonObjLength :function* _trc_Pad_f_getButtonObjLength(_thread,i) {
        var _this=this;
        
        (yield* _this.fiber$activate(_thread));
        if (_this.buttons==null) {
          return null;
        }
        return _this.buttons.length;
        
      },
      getPadUp :function _trc_Pad_getPadUp() {
        var _this=this;
        
        return _this.getUp();
      },
      fiber$getPadUp :function* _trc_Pad_f_getPadUp(_thread) {
        var _this=this;
        
        return yield* _this.fiber$getUp(_thread);
        
        
      },
      getPadDown :function _trc_Pad_getPadDown() {
        var _this=this;
        
        return _this.getDown();
      },
      fiber$getPadDown :function* _trc_Pad_f_getPadDown(_thread) {
        var _this=this;
        
        return yield* _this.fiber$getDown(_thread);
        
        
      },
      getPadLeft :function _trc_Pad_getPadLeft() {
        var _this=this;
        
        return _this.getLeft();
      },
      fiber$getPadLeft :function* _trc_Pad_f_getPadLeft(_thread) {
        var _this=this;
        
        return yield* _this.fiber$getLeft(_thread);
        
        
      },
      getPadRight :function _trc_Pad_getPadRight() {
        var _this=this;
        
        return _this.getRight();
      },
      fiber$getPadRight :function* _trc_Pad_f_getPadRight(_thread) {
        var _this=this;
        
        return yield* _this.fiber$getRight(_thread);
        
        
      },
      getPadButton :function _trc_Pad_getPadButton() {
        var _this=this;
        
        return _this.getButton();
      },
      fiber$getPadButton :function* _trc_Pad_f_getPadButton(_thread) {
        var _this=this;
        
        return yield* _this.fiber$getButton(_thread);
        
        
      },
      isOnRect :function _trc_Pad_isOnRect(mx,my,rx,ry,rx2,ry2) {
        var _this=this;
        
        return (rx<=mx&&mx<rx2&&ry<=my&&my<ry2);
      },
      fiber$isOnRect :function* _trc_Pad_f_isOnRect(_thread,mx,my,rx,ry,rx2,ry2) {
        var _this=this;
        
        return (rx<=mx&&mx<rx2&&ry<=my&&my<ry2);
        
      },
      isOnRectWH :function _trc_Pad_isOnRectWH(mx,my,rx,ry,rw,rh) {
        var _this=this;
        
        return (rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);
      },
      fiber$isOnRectWH :function* _trc_Pad_f_isOnRectWH(_thread,mx,my,rx,ry,rw,rh) {
        var _this=this;
        
        return (rx<=mx&&mx<rx+rw&&ry<=my&&my<ry+rh);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"activate":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"newPadV2":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"newPadV1":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"die":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"dieV2":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"dieV1":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initButton":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initButtonLayout1":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"drawPanel":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setXYPanel":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setXYPanelLayout1":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padUpdate":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padUpdateV2":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padUpdateV1":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padsUpdateV2":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getUp":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getDown":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getLeft":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getRight":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getButton":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getJujiPadObj":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getJujiPadObjLength":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getButtonObj":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getButtonObjLength":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getPadUp":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getPadDown":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getPadLeft":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getPadRight":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getPadButton":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"isOnRect":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"isOnRectWH":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}}},"fields":{"buttonCnt":{},"version":{},"active":{},"actived":{},"died":{},"layout":{},"autoMove":{},"APAD_DIAG_SIZE":{},"padImageP":{},"padUpdateFrame":{},"jujiKey":{},"no1Key":{},"jujiKeyPushU":{},"jujiKeyPushL":{},"jujiKeyPushR":{},"jujiKeyPushD":{},"jujiKeyPush1":{},"buttons":{},"jujiPads":{},"DEFALT_SCREEN_WIDTH":{},"padScaleX":{},"oldPadScaleX":{},"oldButtonCnt":{},"jujiPadWidth":{},"jujiPadHeight":{},"jujiPadBorder":{},"jujiPadFillColor":{},"jujiPadBorderColor":{},"jujiPadLPushColor":{},"jujiPadPushColor":{},"jujiPadRPushColor":{},"jujiPadUPushColor":{},"jujiPadDPushColor":{},"jujiPadLColor":{},"jujiPadColor":{},"jujiPadRColor":{},"jujiPadUColor":{},"jujiPadDColor":{},"jujiPadDiagonalEnable":{},"buttonWidth":{},"buttonHeight":{},"buttonFillColor":{},"buttonBorder":{},"buttonBorderColor":{},"buttonPushColor":{},"buttonText":{},"buttonTextSize":{},"buttonTextColor":{},"button1Width":{},"button1Height":{},"button1FillColor":{},"button1Border":{},"button1BorderColor":{},"button1PushColor":{},"button1Text":{},"button1TextSize":{},"button1TextColor":{},"button2Width":{},"button2Height":{},"button2FillColor":{},"button2Border":{},"button2BorderColor":{},"button2PushColor":{},"button2Text":{},"button2TextSize":{},"button2TextColor":{},"button3Width":{},"button3Height":{},"button3FillColor":{},"button3Border":{},"button3BorderColor":{},"button3PushColor":{},"button3Text":{},"button3TextSize":{},"button3TextColor":{},"button4Width":{},"button4Height":{},"button4FillColor":{},"button4Border":{},"button4BorderColor":{},"button4PushColor":{},"button4Text":{},"button4TextSize":{},"button4TextColor":{},"oldScreenWidth":{},"oldScreenHeight":{},"keyPushL":{},"keyPushR":{},"keyPushU":{},"keyPushD":{},"keyPush1":{},"padKeyNotapCnt":{},"padKeySW":{},"keyCntL":{},"keyCntR":{},"keyCntU":{},"keyCntD":{},"keyCnt1":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.PadButton',
  shortName: 'PadButton',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_PadButton_main() {
        var _this=this;
        
        while (_this.loop) {
          _this.padUpdate();
          _this.update();
          
        }
      },
      fiber$main :function* _trc_PadButton_f_main(_thread) {
        var _this=this;
        
        while (_this.loop) {
          (yield* _this.fiber$padUpdate(_thread));
          (yield* _this.fiber$update(_thread));
          
        }
        
      },
      initialize :function _trc_PadButton_initialize(opt) {
        var _this=this;
        
        __superClass.apply( _this, [opt]);
        _this.died=false;
        _this.zOrder=- 10000;
        _this.init();
      },
      die :function _trc_PadButton_die() {
        var _this=this;
        
        _this.died=true;
        _this.padCnt=0;
        _this.padCntL=0;
        _this.padCntR=0;
        _this.padCntU=0;
        _this.padCntD=0;
        if (_this.panel!=null) {
          _this.panel.hide();
          _this.panel.die();
          
        }
        if (_this.panelPush!=null) {
          _this.panelPush.hide();
          _this.panelPush.die();
          
        }
        if (_this.panelPushL!=null) {
          _this.panelPushL.hide();
          _this.panelPushL.die();
          
        }
        if (_this.panelPushR!=null) {
          _this.panelPushR.hide();
          _this.panelPushR.die();
          
        }
        if (_this.panelPushU!=null) {
          _this.panelPushU.hide();
          _this.panelPushU.die();
          
        }
        if (_this.panelPushD!=null) {
          _this.panelPushD.hide();
          _this.panelPushD.die();
          
        }
        __superClass.prototype.die.apply( _this, []);
      },
      hide :function _trc_PadButton_hide() {
        var _this=this;
        
        if (_this.panel!=null) {
          _this.panel.hide();
          
        }
      },
      show :function _trc_PadButton_show() {
        var _this=this;
        
        if (_this.panel!=null) {
          _this.panel.show();
          
        }
      },
      init :function _trc_PadButton_init() {
        var _this=this;
        var i;
        
        _this.TOUCHES_MAX=5;
        _this.loop=true;
        _this.padCnt=0;
        _this.padCntL=0;
        _this.padCntR=0;
        _this.padCntU=0;
        _this.padCntD=0;
        _this.padNotapCnt=0;
        _this.padUpdateFrame=- 1;
        if (_this.mode==0) {
          if (_this.p==null) {
            _this.p=0;
          }
          if (_this.pushP==null) {
            _this.pushP=1;
          }
          if (_this.drawMode==null) {
            _this.drawMode=0;
          }
          
        } else {
          if (_this.mode==1) {
            if (_this.p==null) {
              _this.p=0;
            }
            if (_this.pushLP==null) {
              _this.pushLP=1;
            }
            if (_this.pushRP==null) {
              _this.pushRP=1;
            }
            if (_this.pushUP==null) {
              _this.pushUP=1;
            }
            if (_this.pushDP==null) {
              _this.pushDP=1;
            }
            if (_this.drawMode==null) {
              _this.drawMode=0;
            }
            if (_this.diagonalEnable==null) {
              _this.diagonalEnable=true;
            }
            
          } else {
            if (_this.mode==2) {
              if (_this.p==null) {
                _this.p=0;
              }
              if (_this.pushP==null) {
                _this.pushP=1;
              }
              
            } else {
              if (_this.mode==10000) {
                _this.p=- 1;
                if (_this.width==null) {
                  _this.width=96;
                }
                if (_this.height==null) {
                  _this.height=96;
                }
                if (_this.padFillColor==null) {
                  _this.padFillColor="rgba(0,0,0,0.125)";
                }
                if (_this.padBorder==null) {
                  _this.padBorder=1;
                }
                if (_this.padBorderColor==null) {
                  _this.padBorderColor="rgba(255,255,255,0.5)";
                }
                if (_this.padPushColor==null) {
                  _this.padPushColor="rgba(255,255,255,0.25)";
                }
                if (_this.padText==null) {
                  _this.padText="";
                }
                if (_this.padTextSize==null) {
                  _this.padTextSize=72;
                }
                if (_this.padTextColor==null) {
                  _this.padTextColor="rgba(255,255,255,0.625)";
                }
                _this.panel=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                _this.panelPush=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                _this.drawPanel();
                _this.padPush=0;
                _this.padPushList=[];
                for (i = 0;
                 i<_this.TOUCHES_MAX ; i++) {
                  {
                    _this.padPushList[i]=false;
                  }
                }
                
              } else {
                if (_this.mode==10001) {
                  _this.p=- 1;
                  if (_this.width==null) {
                    _this.width=216;
                  }
                  if (_this.height==null) {
                    _this.height=216;
                  }
                  if (_this.padFillColor==null) {
                    _this.padFillColor="rgba(0,0,0,0.125)";
                  }
                  if (_this.padBorder==null) {
                    _this.padBorder=1;
                  }
                  if (_this.padBorderColor==null) {
                    _this.padBorderColor="rgba(255,255,255,0.5)";
                  }
                  if (_this.padLPushColor==null) {
                    _this.padLPushColor="rgba(255,255,255,0.25)";
                  }
                  if (_this.padRPushColor==null) {
                    _this.padRPushColor="rgba(255,255,255,0.25)";
                  }
                  if (_this.padUPushColor==null) {
                    _this.padUPushColor="rgba(255,255,255,0.25)";
                  }
                  if (_this.padDPushColor==null) {
                    _this.padDPushColor="rgba(255,255,255,0.25)";
                  }
                  if (_this.padLColor==null) {
                    _this.padLColor="rgba(255,255,255,0.625)";
                  }
                  if (_this.padRColor==null) {
                    _this.padRColor="rgba(255,255,255,0.625)";
                  }
                  if (_this.padUColor==null) {
                    _this.padUColor="rgba(255,255,255,0.625)";
                  }
                  if (_this.padDColor==null) {
                    _this.padDColor="rgba(255,255,255,0.625)";
                  }
                  if (_this.diagonalEnable==null) {
                    _this.diagonalEnable=true;
                  }
                  _this.panel=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                  _this.panelPushL=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                  _this.panelPushR=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                  _this.panelPushU=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                  _this.panelPushD=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                  _this.drawPanel();
                  _this.padPushTouchNo=- 1;
                  
                } else {
                  if (_this.mode==10002) {
                    _this.p=- 1;
                    _this.panel=new Tonyu.classes.kernel.PadPanel;
                    _this.drawPanel();
                    
                  }
                }
              }
            }
          }
        }
      },
      fiber$init :function* _trc_PadButton_f_init(_thread) {
        var _this=this;
        var i;
        
        _this.TOUCHES_MAX=5;
        _this.loop=true;
        _this.padCnt=0;
        _this.padCntL=0;
        _this.padCntR=0;
        _this.padCntU=0;
        _this.padCntD=0;
        _this.padNotapCnt=0;
        _this.padUpdateFrame=- 1;
        if (_this.mode==0) {
          if (_this.p==null) {
            _this.p=0;
          }
          if (_this.pushP==null) {
            _this.pushP=1;
          }
          if (_this.drawMode==null) {
            _this.drawMode=0;
          }
          
        } else {
          if (_this.mode==1) {
            if (_this.p==null) {
              _this.p=0;
            }
            if (_this.pushLP==null) {
              _this.pushLP=1;
            }
            if (_this.pushRP==null) {
              _this.pushRP=1;
            }
            if (_this.pushUP==null) {
              _this.pushUP=1;
            }
            if (_this.pushDP==null) {
              _this.pushDP=1;
            }
            if (_this.drawMode==null) {
              _this.drawMode=0;
            }
            if (_this.diagonalEnable==null) {
              _this.diagonalEnable=true;
            }
            
          } else {
            if (_this.mode==2) {
              if (_this.p==null) {
                _this.p=0;
              }
              if (_this.pushP==null) {
                _this.pushP=1;
              }
              
            } else {
              if (_this.mode==10000) {
                _this.p=- 1;
                if (_this.width==null) {
                  _this.width=96;
                }
                if (_this.height==null) {
                  _this.height=96;
                }
                if (_this.padFillColor==null) {
                  _this.padFillColor="rgba(0,0,0,0.125)";
                }
                if (_this.padBorder==null) {
                  _this.padBorder=1;
                }
                if (_this.padBorderColor==null) {
                  _this.padBorderColor="rgba(255,255,255,0.5)";
                }
                if (_this.padPushColor==null) {
                  _this.padPushColor="rgba(255,255,255,0.25)";
                }
                if (_this.padText==null) {
                  _this.padText="";
                }
                if (_this.padTextSize==null) {
                  _this.padTextSize=72;
                }
                if (_this.padTextColor==null) {
                  _this.padTextColor="rgba(255,255,255,0.625)";
                }
                _this.panel=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                _this.panelPush=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                (yield* _this.fiber$drawPanel(_thread));
                _this.padPush=0;
                _this.padPushList=[];
                for (i = 0;
                 i<_this.TOUCHES_MAX ; i++) {
                  {
                    _this.padPushList[i]=false;
                  }
                }
                
              } else {
                if (_this.mode==10001) {
                  _this.p=- 1;
                  if (_this.width==null) {
                    _this.width=216;
                  }
                  if (_this.height==null) {
                    _this.height=216;
                  }
                  if (_this.padFillColor==null) {
                    _this.padFillColor="rgba(0,0,0,0.125)";
                  }
                  if (_this.padBorder==null) {
                    _this.padBorder=1;
                  }
                  if (_this.padBorderColor==null) {
                    _this.padBorderColor="rgba(255,255,255,0.5)";
                  }
                  if (_this.padLPushColor==null) {
                    _this.padLPushColor="rgba(255,255,255,0.25)";
                  }
                  if (_this.padRPushColor==null) {
                    _this.padRPushColor="rgba(255,255,255,0.25)";
                  }
                  if (_this.padUPushColor==null) {
                    _this.padUPushColor="rgba(255,255,255,0.25)";
                  }
                  if (_this.padDPushColor==null) {
                    _this.padDPushColor="rgba(255,255,255,0.25)";
                  }
                  if (_this.padLColor==null) {
                    _this.padLColor="rgba(255,255,255,0.625)";
                  }
                  if (_this.padRColor==null) {
                    _this.padRColor="rgba(255,255,255,0.625)";
                  }
                  if (_this.padUColor==null) {
                    _this.padUColor="rgba(255,255,255,0.625)";
                  }
                  if (_this.padDColor==null) {
                    _this.padDColor="rgba(255,255,255,0.625)";
                  }
                  if (_this.diagonalEnable==null) {
                    _this.diagonalEnable=true;
                  }
                  _this.panel=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                  _this.panelPushL=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                  _this.panelPushR=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                  _this.panelPushU=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                  _this.panelPushD=new Tonyu.classes.kernel.PadPanel({layer: _this.layer});
                  (yield* _this.fiber$drawPanel(_thread));
                  _this.padPushTouchNo=- 1;
                  
                } else {
                  if (_this.mode==10002) {
                    _this.p=- 1;
                    _this.panel=new Tonyu.classes.kernel.PadPanel;
                    (yield* _this.fiber$drawPanel(_thread));
                    
                  }
                }
              }
            }
          }
        }
        
      },
      drawPanel :function _trc_PadButton_drawPanel() {
        var _this=this;
        
        if (_this.mode==10000) {
          _this.drawPanelMode10000();
          
        } else {
          if (_this.mode==10001) {
            _this.drawPanelMode10001();
            
          } else {
            if (_this.mode==10002) {
              _this.drawPanelMode10002();
              
            }
          }
        }
      },
      fiber$drawPanel :function* _trc_PadButton_f_drawPanel(_thread) {
        var _this=this;
        
        if (_this.mode==10000) {
          (yield* _this.fiber$drawPanelMode10000(_thread));
          
        } else {
          if (_this.mode==10001) {
            (yield* _this.fiber$drawPanelMode10001(_thread));
            
          } else {
            if (_this.mode==10002) {
              (yield* _this.fiber$drawPanelMode10002(_thread));
              
            }
          }
        }
        
      },
      drawPanelMode10000 :function _trc_PadButton_drawPanelMode10000() {
        var _this=this;
        var w;
        var h;
        var bw;
        var bh;
        var ts;
        
        
        
        
        w=_this.width;
        h=_this.height;
        bw=_this.padBorder;
        bh=_this.padBorder;
        ts=_this.padTextSize;
        if (bw<0) {
          bw=0;
        }
        if (bh<0) {
          bh=0;
        }
        if (w<4) {
          w=4;
        }
        if (h<4) {
          h=4;
        }
        _this.panel.setPanel(w+2,h+2);
        _this.panel.clearRect(0,0,w+2,h+2);
        _this.panel.setFillStyle(_this.padBorderColor);
        _this.panel.fillRect(1,1,w,h);
        _this.panel.clearRect(1+bw,1+bh,w-bw*2,h-bh*2);
        _this.panel.setFillStyle(_this.padFillColor);
        _this.panel.fillRect(1+bw,1+bh,w-bw*2,h-bh*2);
        _this.panel.fillText(_this.padText,w/2,h/2,_this.padTextColor,ts,"center","middle");
        _this.panelPush.setPanel(w+2,h+2);
        _this.panelPush.clearRect(0,0,w+2,h+2);
        _this.panelPush.setFillStyle(_this.padPushColor);
        _this.panelPush.fillRect(1,1,w,h);
      },
      fiber$drawPanelMode10000 :function* _trc_PadButton_f_drawPanelMode10000(_thread) {
        var _this=this;
        var w;
        var h;
        var bw;
        var bh;
        var ts;
        
        
        
        
        w=_this.width;
        h=_this.height;
        bw=_this.padBorder;
        bh=_this.padBorder;
        ts=_this.padTextSize;
        if (bw<0) {
          bw=0;
        }
        if (bh<0) {
          bh=0;
        }
        if (w<4) {
          w=4;
        }
        if (h<4) {
          h=4;
        }
        _this.panel.setPanel(w+2,h+2);
        _this.panel.clearRect(0,0,w+2,h+2);
        _this.panel.setFillStyle(_this.padBorderColor);
        _this.panel.fillRect(1,1,w,h);
        _this.panel.clearRect(1+bw,1+bh,w-bw*2,h-bh*2);
        _this.panel.setFillStyle(_this.padFillColor);
        _this.panel.fillRect(1+bw,1+bh,w-bw*2,h-bh*2);
        _this.panel.fillText(_this.padText,w/2,h/2,_this.padTextColor,ts,"center","middle");
        _this.panelPush.setPanel(w+2,h+2);
        _this.panelPush.clearRect(0,0,w+2,h+2);
        _this.panelPush.setFillStyle(_this.padPushColor);
        _this.panelPush.fillRect(1,1,w,h);
        
      },
      drawPanelMode10001 :function _trc_PadButton_drawPanelMode10001() {
        var _this=this;
        var screenSize;
        var w;
        var h;
        var tsx;
        var tsy;
        var cw;
        var ch;
        var cw2;
        var ch2;
        var bw;
        var bh;
        
        
        
        
        
        
        
        w=_this.width;
        h=_this.height;
        if (w<4) {
          w=4;
        }
        if (h<4) {
          h=4;
        }
        cw=w/3;
        ch=h/3;
        cw2=w*2/3;
        ch2=h*2/3;
        tsx=w/(64*3);
        tsy=h/(64*3);
        bw=_this.padBorder;
        bh=_this.padBorder;
        if (bw<0) {
          bw=0;
        }
        if (bh<0) {
          bh=0;
        }
        _this.panel.setPanel(w,h);
        _this.panel.clearRect(0,0,w+2,h+2);
        _this.panel.setFillStyle(_this.padBorderColor);
        _this.panel.fillRect(cw,0,cw,ch);
        _this.panel.fillRect(0,ch,w,ch);
        _this.panel.fillRect(cw,ch2,cw,ch);
        _this.panel.clearRect(cw+bw,bh,cw-bw*2,h-bh*2);
        _this.panel.clearRect(bw,ch+bh,w-bw*2,ch-bh*2);
        _this.panel.setFillStyle(_this.padFillColor);
        _this.panel.fillRect(cw+bw,bh,cw-bw*2,ch);
        _this.panel.fillRect(bw,ch+bh,w-bw*2,ch-bh*2);
        _this.panel.fillRect(cw+bw,ch2-bh,cw-bw*2,ch);
        _this.panel.fillPolygon3(96*tsx,14.5*tsy,113*tsx,48*tsy,79*tsx,48*tsy,_this.padUColor);
        _this.panel.fillPolygon3(14.5*tsx,96*tsy,48*tsx,79*tsy,48*tsx,113*tsy,_this.padLColor);
        _this.panel.fillPolygon3(96*tsx,177.5*tsy,79*tsx,144*tsy,113*tsx,144*tsy,_this.padDColor);
        _this.panel.fillPolygon3(177.5*tsx,96*tsy,144*tsx,113*tsy,144*tsx,79*tsy,_this.padRColor);
        _this.panelPushL.setPanel(cw+bw,ch);
        _this.panelPushL.clearRect(0,0,cw+bw+2,ch+2);
        _this.panelPushL.setFillStyle(_this.padLPushColor);
        _this.panelPushL.fillRect(0,0,cw+bw,ch);
        _this.panelPushR.setPanel(cw+bw,ch);
        _this.panelPushR.clearRect(0,0,cw+bw+2,ch+2);
        _this.panelPushR.setFillStyle(_this.padRPushColor);
        _this.panelPushR.fillRect(0,0,cw+bw,ch);
        _this.panelPushU.setPanel(cw,ch+bh);
        _this.panelPushU.clearRect(0,0,cw+2,ch+bh+2);
        _this.panelPushU.setFillStyle(_this.padUPushColor);
        _this.panelPushU.fillRect(0,0,cw,ch+bh);
        _this.panelPushD.setPanel(cw,ch+bh);
        _this.panelPushD.clearRect(0,0,cw+2,ch+bh+2);
        _this.panelPushD.setFillStyle(_this.padDPushColor);
        _this.panelPushD.fillRect(0,0,cw,ch+bh);
      },
      fiber$drawPanelMode10001 :function* _trc_PadButton_f_drawPanelMode10001(_thread) {
        var _this=this;
        var screenSize;
        var w;
        var h;
        var tsx;
        var tsy;
        var cw;
        var ch;
        var cw2;
        var ch2;
        var bw;
        var bh;
        
        
        
        
        
        
        
        w=_this.width;
        h=_this.height;
        if (w<4) {
          w=4;
        }
        if (h<4) {
          h=4;
        }
        cw=w/3;
        ch=h/3;
        cw2=w*2/3;
        ch2=h*2/3;
        tsx=w/(64*3);
        tsy=h/(64*3);
        bw=_this.padBorder;
        bh=_this.padBorder;
        if (bw<0) {
          bw=0;
        }
        if (bh<0) {
          bh=0;
        }
        _this.panel.setPanel(w,h);
        _this.panel.clearRect(0,0,w+2,h+2);
        _this.panel.setFillStyle(_this.padBorderColor);
        _this.panel.fillRect(cw,0,cw,ch);
        _this.panel.fillRect(0,ch,w,ch);
        _this.panel.fillRect(cw,ch2,cw,ch);
        _this.panel.clearRect(cw+bw,bh,cw-bw*2,h-bh*2);
        _this.panel.clearRect(bw,ch+bh,w-bw*2,ch-bh*2);
        _this.panel.setFillStyle(_this.padFillColor);
        _this.panel.fillRect(cw+bw,bh,cw-bw*2,ch);
        _this.panel.fillRect(bw,ch+bh,w-bw*2,ch-bh*2);
        _this.panel.fillRect(cw+bw,ch2-bh,cw-bw*2,ch);
        _this.panel.fillPolygon3(96*tsx,14.5*tsy,113*tsx,48*tsy,79*tsx,48*tsy,_this.padUColor);
        _this.panel.fillPolygon3(14.5*tsx,96*tsy,48*tsx,79*tsy,48*tsx,113*tsy,_this.padLColor);
        _this.panel.fillPolygon3(96*tsx,177.5*tsy,79*tsx,144*tsy,113*tsx,144*tsy,_this.padDColor);
        _this.panel.fillPolygon3(177.5*tsx,96*tsy,144*tsx,113*tsy,144*tsx,79*tsy,_this.padRColor);
        _this.panelPushL.setPanel(cw+bw,ch);
        _this.panelPushL.clearRect(0,0,cw+bw+2,ch+2);
        _this.panelPushL.setFillStyle(_this.padLPushColor);
        _this.panelPushL.fillRect(0,0,cw+bw,ch);
        _this.panelPushR.setPanel(cw+bw,ch);
        _this.panelPushR.clearRect(0,0,cw+bw+2,ch+2);
        _this.panelPushR.setFillStyle(_this.padRPushColor);
        _this.panelPushR.fillRect(0,0,cw+bw,ch);
        _this.panelPushU.setPanel(cw,ch+bh);
        _this.panelPushU.clearRect(0,0,cw+2,ch+bh+2);
        _this.panelPushU.setFillStyle(_this.padUPushColor);
        _this.panelPushU.fillRect(0,0,cw,ch+bh);
        _this.panelPushD.setPanel(cw,ch+bh);
        _this.panelPushD.clearRect(0,0,cw+2,ch+bh+2);
        _this.panelPushD.setFillStyle(_this.padDPushColor);
        _this.panelPushD.fillRect(0,0,cw,ch+bh);
        
      },
      drawPanelMode10002 :function _trc_PadButton_drawPanelMode10002() {
        var _this=this;
        
      },
      fiber$drawPanelMode10002 :function* _trc_PadButton_f_drawPanelMode10002(_thread) {
        var _this=this;
        
        
      },
      padUpdate :function _trc_PadButton_padUpdate() {
        var _this=this;
        
        if (_this.padUpdateFrame==Tonyu.globals.$frameCount) {
          return _this;
        }
        _this.padUpdateFrame=Tonyu.globals.$frameCount;
        if (_this.mode==0) {
          _this.padUpdateMode0();
          
        } else {
          if (_this.mode==1) {
            _this.padUpdateMode1();
            
          } else {
            if (_this.mode==2) {
              _this.padUpdateMode2();
              
            } else {
              if (_this.mode==10000) {
                _this.padUpdateMode10000();
                
              } else {
                if (_this.mode==10001) {
                  _this.padUpdateMode10001();
                  
                } else {
                  if (_this.mode==10002) {
                    _this.padUpdateMode10002();
                    
                  }
                }
              }
            }
          }
        }
      },
      fiber$padUpdate :function* _trc_PadButton_f_padUpdate(_thread) {
        var _this=this;
        
        if (_this.padUpdateFrame==Tonyu.globals.$frameCount) {
          return _this;
        }
        _this.padUpdateFrame=Tonyu.globals.$frameCount;
        if (_this.mode==0) {
          (yield* _this.fiber$padUpdateMode0(_thread));
          
        } else {
          if (_this.mode==1) {
            (yield* _this.fiber$padUpdateMode1(_thread));
            
          } else {
            if (_this.mode==2) {
              (yield* _this.fiber$padUpdateMode2(_thread));
              
            } else {
              if (_this.mode==10000) {
                (yield* _this.fiber$padUpdateMode10000(_thread));
                
              } else {
                if (_this.mode==10001) {
                  (yield* _this.fiber$padUpdateMode10001(_thread));
                  
                } else {
                  if (_this.mode==10002) {
                    (yield* _this.fiber$padUpdateMode10002(_thread));
                    
                  }
                }
              }
            }
          }
        }
        
      },
      padUpdateMode0 :function _trc_PadButton_padUpdateMode0() {
        var _this=this;
        
      },
      fiber$padUpdateMode0 :function* _trc_PadButton_f_padUpdateMode0(_thread) {
        var _this=this;
        
        
      },
      padUpdateMode1 :function _trc_PadButton_padUpdateMode1() {
        var _this=this;
        
      },
      fiber$padUpdateMode1 :function* _trc_PadButton_f_padUpdateMode1(_thread) {
        var _this=this;
        
        
      },
      padUpdateMode2 :function _trc_PadButton_padUpdateMode2() {
        var _this=this;
        
      },
      fiber$padUpdateMode2 :function* _trc_PadButton_f_padUpdateMode2(_thread) {
        var _this=this;
        
        
      },
      padUpdateMode10000 :function _trc_PadButton_padUpdateMode10000() {
        var _this=this;
        var allNoTouche;
        var i;
        var t;
        
        if (_this.died) {
          return _this;
        }
        _this.panel.x=_this.x;
        _this.panel.y=_this.y;
        _this.panel.zOrder=_this.zOrder;
        _this.panel.alpha=_this.alpha*_this.pad.alpha;
        _this.panel.layer=_this.layer;
        allNoTouche = true;
        
        for (i = 0;
         i<_this.TOUCHES_MAX ; i++) {
          {
            t = Tonyu.globals.$touches[i];
            
            if (t.touched==1) {
              if (_this.crashXY10000(t.x,t.y)) {
                _this.padPush=1;
                _this.padPushList[i]=true;
                
              }
              
            } else {
              if (t.touched==0) {
                _this.padPushList[i]=false;
                
              }
            }
            if (_this.padPushList[i]) {
              allNoTouche=false;
              
            }
          }
        }
        if (allNoTouche) {
          _this.padPush=0;
          
        }
        if (_this.padPush) {
          _this.padCnt++;
          _this.padNotapCnt=0;
          _this.panelPush.x=_this.x;
          _this.panelPush.y=_this.y;
          _this.panelPush.zOrder=_this.zOrder;
          _this.panelPush.alpha=_this.alpha;
          _this.panelPush.layer=_this.layer;
          _this.panelPush.show();
          
        } else {
          _this.padCnt=0;
          _this.padNotapCnt++;
          _this.panelPush.hide();
          
        }
      },
      fiber$padUpdateMode10000 :function* _trc_PadButton_f_padUpdateMode10000(_thread) {
        var _this=this;
        var allNoTouche;
        var i;
        var t;
        
        if (_this.died) {
          return _this;
        }
        _this.panel.x=_this.x;
        _this.panel.y=_this.y;
        _this.panel.zOrder=_this.zOrder;
        _this.panel.alpha=_this.alpha*_this.pad.alpha;
        _this.panel.layer=_this.layer;
        allNoTouche = true;
        
        for (i = 0;
         i<_this.TOUCHES_MAX ; i++) {
          {
            t = Tonyu.globals.$touches[i];
            
            if (t.touched==1) {
              if (_this.crashXY10000(t.x,t.y)) {
                _this.padPush=1;
                _this.padPushList[i]=true;
                
              }
              
            } else {
              if (t.touched==0) {
                _this.padPushList[i]=false;
                
              }
            }
            if (_this.padPushList[i]) {
              allNoTouche=false;
              
            }
          }
        }
        if (allNoTouche) {
          _this.padPush=0;
          
        }
        if (_this.padPush) {
          _this.padCnt++;
          _this.padNotapCnt=0;
          _this.panelPush.x=_this.x;
          _this.panelPush.y=_this.y;
          _this.panelPush.zOrder=_this.zOrder;
          _this.panelPush.alpha=_this.alpha;
          _this.panelPush.layer=_this.layer;
          _this.panelPush.show();
          
        } else {
          _this.padCnt=0;
          _this.padNotapCnt++;
          _this.panelPush.hide();
          
        }
        
      },
      padUpdateMode10001 :function _trc_PadButton_padUpdateMode10001() {
        var _this=this;
        var w;
        var h;
        var cw;
        var ch;
        var cw2;
        var ch2;
        var cwh;
        var chh;
        var bw;
        var bh;
        var i;
        var t;
        var subX;
        var subY;
        
        if (_this.died) {
          return _this;
        }
        
        
        
        
        
        cw=_this.width/3;
        ch=_this.height/3;
        cw2=_this.width*2/3;
        ch2=_this.height*2/3;
        cwh=_this.trunc(cw/2);
        chh=_this.trunc(ch/2);
        w=_this.width;
        h=_this.height;
        bw=_this.padBorder;
        bh=_this.padBorder;
        _this.panel.x=_this.x;
        _this.panel.y=_this.y;
        _this.panel.zOrder=_this.zOrder;
        _this.panel.alpha=_this.alpha*_this.pad.alpha;
        _this.panel.layer=_this.layer;
        _this.padPushL=0;
        _this.padPushR=0;
        _this.padPushU=0;
        _this.padPushD=0;
        if (_this.padPushTouchNo==- 1) {
          _this.padNotapCnt++;
          for (i = 0;
           i<_this.TOUCHES_MAX ; i++) {
            {
              t = Tonyu.globals.$touches[i];
              
              if (t.touched==1) {
                if (_this.isOnRectWH(t.x,t.y,_this.x-cwh-cw,_this.y-chh-ch,w,h)) {
                  _this.padPushTouchNo=i;
                }
                _this.padNotapCnt=0;
                break;
                
                
              }
            }
          }
          
        }
        if (_this.padPushTouchNo!=- 1) {
          t = Tonyu.globals.$touches[_this.padPushTouchNo];
          
          if (t.touched==0) {
            _this.padPushTouchNo=- 1;
            
          } else {
            if (_this.diagonalEnable) {
              if (_this.isOnRectWH(t.x,t.y,_this.x-cwh-cw,_this.y-chh-ch,w,h)) {
                if (_this.isOnRectWH(t.x,t.y,_this.x-cwh-cw,_this.y-chh-ch,cw,h)) {
                  _this.padPushL=1;
                }
                if (_this.isOnRectWH(t.x,t.y,_this.x-cwh+cw,_this.y-chh-ch,cw,h)) {
                  _this.padPushR=1;
                }
                if (_this.isOnRectWH(t.x,t.y,_this.x-cwh-cw,_this.y-chh-ch,w,ch)) {
                  _this.padPushU=1;
                }
                if (_this.isOnRectWH(t.x,t.y,_this.x-cwh-cw,_this.y-chh+ch,w,ch)) {
                  _this.padPushD=1;
                }
                
              } else {
                subX = _this.toScaledX(t.x)-_this.x;
                
                subY = _this.toScaledY(t.y)-_this.y;
                
                if (subX<- cwh-(_this.abs(subY)-chh-ch)/2) {
                  _this.padPushL=1;
                }
                if (subX>cwh+(_this.abs(subY)-chh-ch)/2) {
                  _this.padPushR=1;
                }
                if (subY<- chh-(_this.abs(subX)-cwh-cw)/2) {
                  _this.padPushU=1;
                }
                if (subY>chh+(_this.abs(subX)-cwh-cw)/2) {
                  _this.padPushD=1;
                }
                
              }
              
            } else {
              if (! _this.isOnRectWH(t.x,t.y,_this.x-cwh,_this.y-chh,cw,ch)) {
                subX = _this.toScaledX(t.x)-_this.x;
                
                subY = _this.toScaledY(t.y)-_this.y;
                
                if (subX<=- _this.abs(subY)) {
                  _this.padPushL=1;
                } else {
                  if (subY<=- _this.abs(subX)) {
                    _this.padPushU=1;
                  } else {
                    if (subX>=_this.abs(subY)) {
                      _this.padPushR=1;
                    } else {
                      if (subY>=_this.abs(subX)) {
                        _this.padPushD=1;
                      }
                    }
                  }
                }
                
              }
              
            }
            
          }
          
        }
        if (_this.padPushL) {
          _this.padCntL++;
          _this.panelPushL.x=_this.x-cw+bw/2;
          _this.panelPushL.y=_this.y;
          _this.panelPushL.zOrder=_this.zOrder;
          _this.panelPushL.alpha=_this.alpha;
          _this.panelPushL.layer=_this.layer;
          _this.panelPushL.show();
          
        } else {
          _this.padCntL=0;
          _this.panelPushL.hide();
          
        }
        if (_this.padPushR) {
          _this.padCntR++;
          _this.panelPushR.x=_this.x+cw-bw/2;
          _this.panelPushR.y=_this.y;
          _this.panelPushR.zOrder=_this.zOrder;
          _this.panelPushR.alpha=_this.alpha;
          _this.panelPushR.layer=_this.layer;
          _this.panelPushR.show();
          
        } else {
          _this.padCntR=0;
          _this.panelPushR.hide();
          
        }
        if (_this.padPushU) {
          _this.padCntU++;
          _this.panelPushU.x=_this.x;
          _this.panelPushU.y=_this.y-ch+bh/2;
          _this.panelPushU.zOrder=_this.zOrder;
          _this.panelPushU.alpha=_this.alpha;
          _this.panelPushU.layer=_this.layer;
          _this.panelPushU.show();
          
        } else {
          _this.padCntU=0;
          _this.panelPushU.hide();
          
        }
        if (_this.padPushD) {
          _this.padCntD++;
          _this.panelPushD.x=_this.x;
          _this.panelPushD.y=_this.y+ch-bh/2;
          _this.panelPushD.zOrder=_this.zOrder;
          _this.panelPushD.alpha=_this.alpha;
          _this.panelPushD.layer=_this.layer;
          _this.panelPushD.show();
          
        } else {
          _this.padCntD=0;
          _this.panelPushD.hide();
          
        }
      },
      fiber$padUpdateMode10001 :function* _trc_PadButton_f_padUpdateMode10001(_thread) {
        var _this=this;
        var w;
        var h;
        var cw;
        var ch;
        var cw2;
        var ch2;
        var cwh;
        var chh;
        var bw;
        var bh;
        var i;
        var t;
        var subX;
        var subY;
        
        if (_this.died) {
          return _this;
        }
        
        
        
        
        
        cw=_this.width/3;
        ch=_this.height/3;
        cw2=_this.width*2/3;
        ch2=_this.height*2/3;
        cwh=_this.trunc(cw/2);
        chh=_this.trunc(ch/2);
        w=_this.width;
        h=_this.height;
        bw=_this.padBorder;
        bh=_this.padBorder;
        _this.panel.x=_this.x;
        _this.panel.y=_this.y;
        _this.panel.zOrder=_this.zOrder;
        _this.panel.alpha=_this.alpha*_this.pad.alpha;
        _this.panel.layer=_this.layer;
        _this.padPushL=0;
        _this.padPushR=0;
        _this.padPushU=0;
        _this.padPushD=0;
        if (_this.padPushTouchNo==- 1) {
          _this.padNotapCnt++;
          for (i = 0;
           i<_this.TOUCHES_MAX ; i++) {
            {
              t = Tonyu.globals.$touches[i];
              
              if (t.touched==1) {
                if (_this.isOnRectWH(t.x,t.y,_this.x-cwh-cw,_this.y-chh-ch,w,h)) {
                  _this.padPushTouchNo=i;
                }
                _this.padNotapCnt=0;
                break;
                
                
              }
            }
          }
          
        }
        if (_this.padPushTouchNo!=- 1) {
          t = Tonyu.globals.$touches[_this.padPushTouchNo];
          
          if (t.touched==0) {
            _this.padPushTouchNo=- 1;
            
          } else {
            if (_this.diagonalEnable) {
              if (_this.isOnRectWH(t.x,t.y,_this.x-cwh-cw,_this.y-chh-ch,w,h)) {
                if (_this.isOnRectWH(t.x,t.y,_this.x-cwh-cw,_this.y-chh-ch,cw,h)) {
                  _this.padPushL=1;
                }
                if (_this.isOnRectWH(t.x,t.y,_this.x-cwh+cw,_this.y-chh-ch,cw,h)) {
                  _this.padPushR=1;
                }
                if (_this.isOnRectWH(t.x,t.y,_this.x-cwh-cw,_this.y-chh-ch,w,ch)) {
                  _this.padPushU=1;
                }
                if (_this.isOnRectWH(t.x,t.y,_this.x-cwh-cw,_this.y-chh+ch,w,ch)) {
                  _this.padPushD=1;
                }
                
              } else {
                subX = _this.toScaledX(t.x)-_this.x;
                
                subY = _this.toScaledY(t.y)-_this.y;
                
                if (subX<- cwh-(_this.abs(subY)-chh-ch)/2) {
                  _this.padPushL=1;
                }
                if (subX>cwh+(_this.abs(subY)-chh-ch)/2) {
                  _this.padPushR=1;
                }
                if (subY<- chh-(_this.abs(subX)-cwh-cw)/2) {
                  _this.padPushU=1;
                }
                if (subY>chh+(_this.abs(subX)-cwh-cw)/2) {
                  _this.padPushD=1;
                }
                
              }
              
            } else {
              if (! _this.isOnRectWH(t.x,t.y,_this.x-cwh,_this.y-chh,cw,ch)) {
                subX = _this.toScaledX(t.x)-_this.x;
                
                subY = _this.toScaledY(t.y)-_this.y;
                
                if (subX<=- _this.abs(subY)) {
                  _this.padPushL=1;
                } else {
                  if (subY<=- _this.abs(subX)) {
                    _this.padPushU=1;
                  } else {
                    if (subX>=_this.abs(subY)) {
                      _this.padPushR=1;
                    } else {
                      if (subY>=_this.abs(subX)) {
                        _this.padPushD=1;
                      }
                    }
                  }
                }
                
              }
              
            }
            
          }
          
        }
        if (_this.padPushL) {
          _this.padCntL++;
          _this.panelPushL.x=_this.x-cw+bw/2;
          _this.panelPushL.y=_this.y;
          _this.panelPushL.zOrder=_this.zOrder;
          _this.panelPushL.alpha=_this.alpha;
          _this.panelPushL.layer=_this.layer;
          _this.panelPushL.show();
          
        } else {
          _this.padCntL=0;
          _this.panelPushL.hide();
          
        }
        if (_this.padPushR) {
          _this.padCntR++;
          _this.panelPushR.x=_this.x+cw-bw/2;
          _this.panelPushR.y=_this.y;
          _this.panelPushR.zOrder=_this.zOrder;
          _this.panelPushR.alpha=_this.alpha;
          _this.panelPushR.layer=_this.layer;
          _this.panelPushR.show();
          
        } else {
          _this.padCntR=0;
          _this.panelPushR.hide();
          
        }
        if (_this.padPushU) {
          _this.padCntU++;
          _this.panelPushU.x=_this.x;
          _this.panelPushU.y=_this.y-ch+bh/2;
          _this.panelPushU.zOrder=_this.zOrder;
          _this.panelPushU.alpha=_this.alpha;
          _this.panelPushU.layer=_this.layer;
          _this.panelPushU.show();
          
        } else {
          _this.padCntU=0;
          _this.panelPushU.hide();
          
        }
        if (_this.padPushD) {
          _this.padCntD++;
          _this.panelPushD.x=_this.x;
          _this.panelPushD.y=_this.y+ch-bh/2;
          _this.panelPushD.zOrder=_this.zOrder;
          _this.panelPushD.alpha=_this.alpha;
          _this.panelPushD.layer=_this.layer;
          _this.panelPushD.show();
          
        } else {
          _this.padCntD=0;
          _this.panelPushD.hide();
          
        }
        
      },
      padUpdateMode10002 :function _trc_PadButton_padUpdateMode10002() {
        var _this=this;
        
      },
      fiber$padUpdateMode10002 :function* _trc_PadButton_f_padUpdateMode10002(_thread) {
        var _this=this;
        
        
      },
      toScaledX :function _trc_PadButton_toScaledX(mx) {
        var _this=this;
        
        if (_this.layer==Tonyu.globals.$uiLayer) {
          return (mx*Tonyu.globals.$Screen.scaleX+(Tonyu.globals.$uiScreen.width-Tonyu.globals.$Screen.width*Tonyu.globals.$Screen.scaleX)/2);
          
        } else {
          return mx;
          
        }
      },
      fiber$toScaledX :function* _trc_PadButton_f_toScaledX(_thread,mx) {
        var _this=this;
        
        if (_this.layer==Tonyu.globals.$uiLayer) {
          return (mx*Tonyu.globals.$Screen.scaleX+(Tonyu.globals.$uiScreen.width-Tonyu.globals.$Screen.width*Tonyu.globals.$Screen.scaleX)/2);
          
        } else {
          return mx;
          
        }
        
      },
      toScaledY :function _trc_PadButton_toScaledY(my) {
        var _this=this;
        
        if (_this.layer==Tonyu.globals.$uiLayer) {
          return (my*Tonyu.globals.$Screen.scaleX+(Tonyu.globals.$uiScreen.height-Tonyu.globals.$Screen.height*Tonyu.globals.$Screen.scaleX)/2);
          
        } else {
          return my;
          
        }
      },
      fiber$toScaledY :function* _trc_PadButton_f_toScaledY(_thread,my) {
        var _this=this;
        
        if (_this.layer==Tonyu.globals.$uiLayer) {
          return (my*Tonyu.globals.$Screen.scaleX+(Tonyu.globals.$uiScreen.height-Tonyu.globals.$Screen.height*Tonyu.globals.$Screen.scaleX)/2);
          
        } else {
          return my;
          
        }
        
      },
      isOnRect :function _trc_PadButton_isOnRect(_mx,_my,rx,ry,rx2,ry2) {
        var _this=this;
        var mx;
        var my;
        
        
        mx=_mx;
        my=_my;
        if (_this.layer==Tonyu.globals.$uiLayer) {
          mx=_this.toScaledX(_mx);
          my=_this.toScaledY(_my);
          
        }
        return (mx>=rx&&mx<rx2&&my>=ry&&my<ry2);
      },
      fiber$isOnRect :function* _trc_PadButton_f_isOnRect(_thread,_mx,_my,rx,ry,rx2,ry2) {
        var _this=this;
        var mx;
        var my;
        
        
        mx=_mx;
        my=_my;
        if (_this.layer==Tonyu.globals.$uiLayer) {
          mx=(yield* _this.fiber$toScaledX(_thread, _mx));
          my=(yield* _this.fiber$toScaledY(_thread, _my));
          
        }
        return (mx>=rx&&mx<rx2&&my>=ry&&my<ry2);
        
      },
      isOnRectWH :function _trc_PadButton_isOnRectWH(_mx,_my,rx,ry,rw,rh) {
        var _this=this;
        var mx;
        var my;
        
        
        mx=_mx;
        my=_my;
        if (_this.layer==Tonyu.globals.$uiLayer) {
          mx=_this.toScaledX(_mx);
          my=_this.toScaledY(_my);
          
        }
        return (mx>=rx&&mx<rx+rw&&my>=ry&&my<ry+rh);
      },
      fiber$isOnRectWH :function* _trc_PadButton_f_isOnRectWH(_thread,_mx,_my,rx,ry,rw,rh) {
        var _this=this;
        var mx;
        var my;
        
        
        mx=_mx;
        my=_my;
        if (_this.layer==Tonyu.globals.$uiLayer) {
          mx=(yield* _this.fiber$toScaledX(_thread, _mx));
          my=(yield* _this.fiber$toScaledY(_thread, _my));
          
        }
        return (mx>=rx&&mx<rx+rw&&my>=ry&&my<ry+rh);
        
      },
      crashXY :function _trc_PadButton_crashXY(_mx,_my) {
        var _this=this;
        var w;
        var h;
        var mx;
        var my;
        
        
        w=_this.width;
        h=_this.height;
        mx=_mx;
        my=_my;
        if (_this.layer==Tonyu.globals.$uiLayer) {
          mx=_this.toScaledX(_mx);
          my=_this.toScaledY(_my);
          
        }
        return (mx>=_this.x-w/2&&mx<_this.x+w/2&&my>=_this.y-h/2&&my<_this.y+h/2);
      },
      fiber$crashXY :function* _trc_PadButton_f_crashXY(_thread,_mx,_my) {
        var _this=this;
        var w;
        var h;
        var mx;
        var my;
        
        
        w=_this.width;
        h=_this.height;
        mx=_mx;
        my=_my;
        if (_this.layer==Tonyu.globals.$uiLayer) {
          mx=(yield* _this.fiber$toScaledX(_thread, _mx));
          my=(yield* _this.fiber$toScaledY(_thread, _my));
          
        }
        return (mx>=_this.x-w/2&&mx<_this.x+w/2&&my>=_this.y-h/2&&my<_this.y+h/2);
        
      },
      crashXY10000 :function _trc_PadButton_crashXY10000(_mx,_my) {
        var _this=this;
        var w;
        var h;
        var mx;
        var my;
        
        
        w=_this.width+2;
        h=_this.height+2;
        mx=_mx;
        my=_my;
        if (_this.layer==Tonyu.globals.$uiLayer) {
          mx=_this.toScaledX(_mx);
          my=_this.toScaledY(_my);
          
        }
        return (mx>=_this.x-w/2-1&&mx<_this.x+w/2-1&&my>=_this.y-h/2-1&&my<_this.y+h/2-1);
      },
      fiber$crashXY10000 :function* _trc_PadButton_f_crashXY10000(_thread,_mx,_my) {
        var _this=this;
        var w;
        var h;
        var mx;
        var my;
        
        
        w=_this.width+2;
        h=_this.height+2;
        mx=_mx;
        my=_my;
        if (_this.layer==Tonyu.globals.$uiLayer) {
          mx=(yield* _this.fiber$toScaledX(_thread, _mx));
          my=(yield* _this.fiber$toScaledY(_thread, _my));
          
        }
        return (mx>=_this.x-w/2-1&&mx<_this.x+w/2-1&&my>=_this.y-h/2-1&&my<_this.y+h/2-1);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"die":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"hide":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"show":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"init":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"drawPanel":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"drawPanelMode10000":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"drawPanelMode10001":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"drawPanelMode10002":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padUpdate":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padUpdateMode0":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padUpdateMode1":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padUpdateMode2":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padUpdateMode10000":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padUpdateMode10001":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"padUpdateMode10002":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"toScaledX":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"toScaledY":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"isOnRect":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"isOnRectWH":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"crashXY":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"crashXY10000":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"loop":{},"died":{},"padCnt":{},"padCntL":{},"padCntR":{},"padCntU":{},"padCntD":{},"panel":{},"panelPush":{},"panelPushL":{},"panelPushR":{},"panelPushU":{},"panelPushD":{},"TOUCHES_MAX":{},"padNotapCnt":{},"padUpdateFrame":{},"mode":{},"pushP":{},"drawMode":{},"pushLP":{},"pushRP":{},"pushUP":{},"pushDP":{},"diagonalEnable":{},"padFillColor":{},"padBorder":{},"padBorderColor":{},"padPushColor":{},"padText":{},"padTextSize":{},"padTextColor":{},"padPush":{},"padPushList":{},"padLPushColor":{},"padRPushColor":{},"padUPushColor":{},"padDPushColor":{},"padLColor":{},"padRColor":{},"padUColor":{},"padDColor":{},"padPushTouchNo":{},"pad":{},"padPushL":{},"padPushR":{},"padPushU":{},"padPushD":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.PadPanel',
  shortName: 'PadPanel',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Panel,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_PadPanel_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_PadPanel_f_main(_thread) {
        var _this=this;
        
        
      },
      fillPolygon3 :function _trc_PadPanel_fillPolygon3(x1,y1,x2,y2,x3,y3,color,color2) {
        var _this=this;
        
        _this.ctx=_this.getContext();
        _this.ctx.save();
        _this.ctx.beginPath();
        _this.ctx.moveTo(x1,y1);
        _this.ctx.lineTo(x2,y2);
        _this.ctx.lineTo(x3,y3);
        _this.ctx.closePath();
        if (color==null) {
          _this.ctx.fillStyle=_this.fillStyle;
          
        } else {
          _this.ctx.fillStyle=color;
          
        }
        _this.ctx.fill();
        _this.ctx.restore();
      },
      fiber$fillPolygon3 :function* _trc_PadPanel_f_fillPolygon3(_thread,x1,y1,x2,y2,x3,y3,color,color2) {
        var _this=this;
        
        _this.ctx=(yield* _this.fiber$getContext(_thread));
        _this.ctx.save();
        _this.ctx.beginPath();
        _this.ctx.moveTo(x1,y1);
        _this.ctx.lineTo(x2,y2);
        _this.ctx.lineTo(x3,y3);
        _this.ctx.closePath();
        if (color==null) {
          _this.ctx.fillStyle=_this.fillStyle;
          
        } else {
          _this.ctx.fillStyle=color;
          
        }
        _this.ctx.fill();
        _this.ctx.restore();
        
      },
      fillRect :function _trc_PadPanel_fillRect(x,y,rectWidth,rectHeight,color) {
        var _this=this;
        
        _this.ctx=_this.getContext();
        _this.ctx.save();
        if (color==null) {
          _this.ctx.fillStyle=_this.fillStyle;
          
        } else {
          _this.ctx.fillStyle=color;
          
        }
        _this.ctx.fillRect(x,y,rectWidth,rectHeight);
        _this.ctx.restore();
      },
      fillText :function _trc_PadPanel_fillText(text,x,y,color,size,align,baseline) {
        var _this=this;
        var splits;
        var colCount;
        
        _this.ctx=_this.getContext();
        _this.ctx.save();
        text=text+"";
        splits = text.split("\n");
        
        _this.ctx.textAlign=align;
        if (baseline!=null) {
          _this.ctx.textBaseline=baseline;
          
        }
        if (color==null) {
          _this.ctx.fillStyle=_this.fillStyle;
          
        } else {
          _this.ctx.fillStyle=color;
          
        }
        _this.ctx.font=size+"px 'Courier New'";
        for (colCount = 0;
         colCount<splits.length ; colCount++) {
          {
            _this.ctx.fillText(splits[colCount],x,y);
            y+=size;
          }
        }
        _this.ctx.restore();
      },
      fiber$fillText :function* _trc_PadPanel_f_fillText(_thread,text,x,y,color,size,align,baseline) {
        var _this=this;
        var splits;
        var colCount;
        
        _this.ctx=(yield* _this.fiber$getContext(_thread));
        _this.ctx.save();
        text=text+"";
        splits = text.split("\n");
        
        _this.ctx.textAlign=align;
        if (baseline!=null) {
          _this.ctx.textBaseline=baseline;
          
        }
        if (color==null) {
          _this.ctx.fillStyle=_this.fillStyle;
          
        } else {
          _this.ctx.fillStyle=color;
          
        }
        _this.ctx.font=size+"px 'Courier New'";
        for (colCount = 0;
         colCount<splits.length ; colCount++) {
          {
            _this.ctx.fillText(splits[colCount],x,y);
            y+=size;
          }
        }
        _this.ctx.restore();
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"fillPolygon3":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null],"returnValue":null}},"fillRect":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}},"fillText":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null],"returnValue":null}}},"fields":{"ctx":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.UILayout',
  shortName: 'UILayout',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_UILayout_main() {
        var _this=this;
        
        _this.doLayout();
        Tonyu.globals.$Screen.on("resize",Tonyu.bindFunc(_this,_this.doLayout));
        Tonyu.globals.$uiScreen.on("resize",Tonyu.bindFunc(_this,_this.doLayout));
      },
      fiber$main :function* _trc_UILayout_f_main(_thread) {
        var _this=this;
        
        (yield* _this.fiber$doLayout(_thread));
        Tonyu.globals.$Screen.on("resize",Tonyu.bindFunc(_this,_this.doLayout));
        Tonyu.globals.$uiScreen.on("resize",Tonyu.bindFunc(_this,_this.doLayout));
        
      },
      doLayout :function _trc_UILayout_doLayout() {
        var _this=this;
        var cw;
        var ch;
        var width;
        var height;
        var calcw;
        var calch;
        var scl;
        var isPC;
        
        cw = Tonyu.globals.$uiScreen.width;
        
        ch = Tonyu.globals.$uiScreen.height;
        
        width = Tonyu.globals.$Screen.width;
        
        height = Tonyu.globals.$Screen.height;
        
        calcw = ch/height*width;
        
        calch = cw/width*height;
        
        if (calch>ch) {
          calch=ch;
        }
        if (calcw>cw) {
          calcw=cw;
        }
        scl = 1;
        
        isPC = ! (Tonyu.globals.$Navigator.isMobile());
        
        if (isPC&&_this.shouldDraw1x1(width,height,calcw,calch)) {
          calcw=width;
          calch=height;
          Tonyu.globals.$Screen.scaleX=1;
          
        } else {
          Tonyu.globals.$Screen.scaleX=calcw/width;
          
        }
        Tonyu.globals.$Screen.x=_this.trunc(cw/2)+width/2%1;
        Tonyu.globals.$Screen.y=_this.trunc(ch/2)+height/2%1;
      },
      fiber$doLayout :function* _trc_UILayout_f_doLayout(_thread) {
        var _this=this;
        var cw;
        var ch;
        var width;
        var height;
        var calcw;
        var calch;
        var scl;
        var isPC;
        
        cw = Tonyu.globals.$uiScreen.width;
        
        ch = Tonyu.globals.$uiScreen.height;
        
        width = Tonyu.globals.$Screen.width;
        
        height = Tonyu.globals.$Screen.height;
        
        calcw = ch/height*width;
        
        calch = cw/width*height;
        
        if (calch>ch) {
          calch=ch;
        }
        if (calcw>cw) {
          calcw=cw;
        }
        scl = 1;
        
        isPC = ! (Tonyu.globals.$Navigator.isMobile());
        
        if (isPC&&_this.shouldDraw1x1(width,height,calcw,calch)) {
          calcw=width;
          calch=height;
          Tonyu.globals.$Screen.scaleX=1;
          
        } else {
          Tonyu.globals.$Screen.scaleX=calcw/width;
          
        }
        Tonyu.globals.$Screen.x=_this.trunc(cw/2)+width/2%1;
        Tonyu.globals.$Screen.y=_this.trunc(ch/2)+height/2%1;
        
      },
      shouldDraw1x1 :function _trc_UILayout_shouldDraw1x1(srcw,srch,dstw,dsth) {
        var _this=this;
        var larger;
        var smaller;
        
        larger = 100;
        
        smaller = 0;
        
        return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;
      },
      fiber$shouldDraw1x1 :function* _trc_UILayout_f_shouldDraw1x1(_thread,srcw,srch,dstw,dsth) {
        var _this=this;
        var larger;
        var smaller;
        
        larger = 100;
        
        smaller = 0;
        
        return srcw-smaller<=dstw&&dstw<=srcw+larger&&srch-smaller<=dsth&&dsth<=srch+larger;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"doLayout":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"shouldDraw1x1":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.WebPage',
  shortName: 'WebPage',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_WebPage_main() {
        var _this=this;
        
        _this.eventWindowOpen=(function anonymous_114(e) {
          
          if (Tonyu.globals.$RPGAtsumaru) {
            _this.postOptions=_this.postOptions||{};
            Tonyu.globals.$RPGAtsumaru.popups.openLink(_this.postUrl,_this.postOptions.comment);
            
          } else {
            window.open(_this.postUrl);
            
          }
          if (_this.canvas.removeEventListener) {
            _this.canvas.removeEventListener("click",_this.eventWindowOpen,false);
            _this.canvas.removeEventListener("touchend",_this.eventWindowOpen,false);
            _this.listenerExists=false;
            
          } else {
            if (_this.canvas.detachEvent) {
              _this.canvas.detachEvent("onclick",_this.eventWindowOpen);
              _this.canvas.detachEvent("touchend",_this.eventWindowOpen);
              _this.listenerExists=false;
              
            }
          }
        });
      },
      fiber$main :function* _trc_WebPage_f_main(_thread) {
        var _this=this;
        
        _this.eventWindowOpen=(function anonymous_114(e) {
          
          if (Tonyu.globals.$RPGAtsumaru) {
            _this.postOptions=_this.postOptions||{};
            Tonyu.globals.$RPGAtsumaru.popups.openLink(_this.postUrl,_this.postOptions.comment);
            
          } else {
            window.open(_this.postUrl);
            
          }
          if (_this.canvas.removeEventListener) {
            _this.canvas.removeEventListener("click",_this.eventWindowOpen,false);
            _this.canvas.removeEventListener("touchend",_this.eventWindowOpen,false);
            _this.listenerExists=false;
            
          } else {
            if (_this.canvas.detachEvent) {
              _this.canvas.detachEvent("onclick",_this.eventWindowOpen);
              _this.canvas.detachEvent("touchend",_this.eventWindowOpen);
              _this.listenerExists=false;
              
            }
          }
        });
        
      },
      openNewWindow :function _trc_WebPage_openNewWindow(url,options) {
        var _this=this;
        
        _this.postUrl=url;
        options=options||{};
        _this.postOptions=options;
        _this.canvas=document.querySelector("canvas.tonyu-canvas")||document.getElementsByTagName("canvas")[0];
        if (! _this.listenerExists) {
          if (_this.canvas.addEventListener) {
            _this.canvas.addEventListener("click",_this.eventWindowOpen,false);
            _this.canvas.addEventListener("touchend",_this.eventWindowOpen,false);
            _this.listenerExists=true;
            
          } else {
            if (_this.canvas.attachEvent) {
              _this.canvas.attachEvent("onclick",_this.eventWindowOpen);
              _this.canvas.attachEvent("touchend",_this.eventWindowOpen);
              _this.listenerExists=true;
              
            }
          }
          
        }
      },
      fiber$openNewWindow :function* _trc_WebPage_f_openNewWindow(_thread,url,options) {
        var _this=this;
        
        _this.postUrl=url;
        options=options||{};
        _this.postOptions=options;
        _this.canvas=document.querySelector("canvas.tonyu-canvas")||document.getElementsByTagName("canvas")[0];
        if (! _this.listenerExists) {
          if (_this.canvas.addEventListener) {
            _this.canvas.addEventListener("click",_this.eventWindowOpen,false);
            _this.canvas.addEventListener("touchend",_this.eventWindowOpen,false);
            _this.listenerExists=true;
            
          } else {
            if (_this.canvas.attachEvent) {
              _this.canvas.attachEvent("onclick",_this.eventWindowOpen);
              _this.canvas.attachEvent("touchend",_this.eventWindowOpen);
              _this.listenerExists=true;
              
            }
          }
          
        }
        
      },
      openPage :function _trc_WebPage_openPage(url) {
        var _this=this;
        
        window.location.href=url;
      },
      fiber$openPage :function* _trc_WebPage_f_openPage(_thread,url) {
        var _this=this;
        
        window.location.href=url;
        
      },
      openTweet :function _trc_WebPage_openTweet(text,url,hashtags,via,related,tl) {
        var _this=this;
        var sendUrl;
        
        sendUrl = "https://twitter.com/intent/tweet?";
        
        sendUrl+="text="+encodeURIComponent(text);
        if (url!=null) {
          sendUrl+="&";
          sendUrl+="url="+encodeURIComponent(url);
          
        }
        if (hashtags!=null) {
          sendUrl+="&";
          sendUrl+="hashtags="+encodeURIComponent(hashtags);
          
        }
        if (via!=null) {
          sendUrl+="&";
          sendUrl+="via="+encodeURIComponent(via);
          
        }
        if (related!=null) {
          sendUrl+="&";
          sendUrl+="related="+encodeURIComponent(related);
          
        }
        if (tl) {
          sendUrl+="&";
          sendUrl+="source=webclient";
          
        }
        _this.openNewWindow(sendUrl,{comment: text});
      },
      fiber$openTweet :function* _trc_WebPage_f_openTweet(_thread,text,url,hashtags,via,related,tl) {
        var _this=this;
        var sendUrl;
        
        sendUrl = "https://twitter.com/intent/tweet?";
        
        sendUrl+="text="+encodeURIComponent(text);
        if (url!=null) {
          sendUrl+="&";
          sendUrl+="url="+encodeURIComponent(url);
          
        }
        if (hashtags!=null) {
          sendUrl+="&";
          sendUrl+="hashtags="+encodeURIComponent(hashtags);
          
        }
        if (via!=null) {
          sendUrl+="&";
          sendUrl+="via="+encodeURIComponent(via);
          
        }
        if (related!=null) {
          sendUrl+="&";
          sendUrl+="related="+encodeURIComponent(related);
          
        }
        if (tl) {
          sendUrl+="&";
          sendUrl+="source=webclient";
          
        }
        (yield* _this.fiber$openNewWindow(_thread, sendUrl, {comment: text}));
        
      },
      openShareTweet :function _trc_WebPage_openShareTweet(text,url,hashtags,via,related,tl) {
        var _this=this;
        var sendUrl;
        var tempText;
        
        sendUrl = "https://twitter.com/intent/tweet?";
        
        if (arguments.length==2) {
          if (text==null||text.match(/^http/)) {
            tempText = text;
            
            text=url;
            url=tempText;
            
          }
          
        }
        sendUrl+="text="+encodeURIComponent(text);
        sendUrl+="&";
        if (url==null) {
          sendUrl+="url="+window.location.href;
          
        } else {
          sendUrl+="url="+encodeURIComponent(url);
          
        }
        if (hashtags!=null) {
          sendUrl+="&";
          sendUrl+="hashtags="+encodeURIComponent(hashtags);
          
        }
        if (via!=null) {
          sendUrl+="&";
          sendUrl+="via="+encodeURIComponent(via);
          
        }
        if (related!=null) {
          sendUrl+="&";
          sendUrl+="related="+encodeURIComponent(related);
          
        }
        if (tl) {
          sendUrl+="&";
          sendUrl+="source=webclient";
          
        }
        _this.openNewWindow(sendUrl,{comment: text});
      },
      fiber$openShareTweet :function* _trc_WebPage_f_openShareTweet(_thread,text,url,hashtags,via,related,tl) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var sendUrl;
        var tempText;
        
        sendUrl = "https://twitter.com/intent/tweet?";
        
        if (_arguments.length==2) {
          if (text==null||text.match(/^http/)) {
            tempText = text;
            
            text=url;
            url=tempText;
            
          }
          
        }
        sendUrl+="text="+encodeURIComponent(text);
        sendUrl+="&";
        if (url==null) {
          sendUrl+="url="+window.location.href;
          
        } else {
          sendUrl+="url="+encodeURIComponent(url);
          
        }
        if (hashtags!=null) {
          sendUrl+="&";
          sendUrl+="hashtags="+encodeURIComponent(hashtags);
          
        }
        if (via!=null) {
          sendUrl+="&";
          sendUrl+="via="+encodeURIComponent(via);
          
        }
        if (related!=null) {
          sendUrl+="&";
          sendUrl+="related="+encodeURIComponent(related);
          
        }
        if (tl) {
          sendUrl+="&";
          sendUrl+="source=webclient";
          
        }
        (yield* _this.fiber$openNewWindow(_thread, sendUrl, {comment: text}));
        
      },
      showLink :function _trc_WebPage_showLink(url,text,options) {
        var _this=this;
        var $;
        var domain;
        var sz;
        var target;
        var d;
        
        Tonyu.globals.$currentProject.requestPlugin("jquery_ui");
        $ = window.$;
        
        
        options=options||{};
        sz = options.size||20;
        
        target = options.target||"_new";
        
        url.replace(/^https?:\/\/([^\/]+)/,(function anonymous_5064(_,d) {
          
          domain=d;
        }));
        d = $("<div>").attr({title: "Open URL"}).append($("<div>").append(domain),$("<a>").css({font_size: sz+"px"}).text(text).attr({href: url,target: target}));
        
        d.dialog();
      },
      fiber$showLink :function* _trc_WebPage_f_showLink(_thread,url,text,options) {
        var _this=this;
        var $;
        var domain;
        var sz;
        var target;
        var d;
        
        Tonyu.globals.$currentProject.requestPlugin("jquery_ui");
        $ = window.$;
        
        
        options=options||{};
        sz = options.size||20;
        
        target = options.target||"_new";
        
        url.replace(/^https?:\/\/([^\/]+)/,(function anonymous_5064(_,d) {
          
          domain=d;
        }));
        d = $("<div>").attr({title: "Open URL"}).append($("<div>").append(domain),$("<a>").css({font_size: sz+"px"}).text(text).attr({href: url,target: target}));
        
        d.dialog();
        
      },
      param :function _trc_WebPage_param(name,def) {
        var _this=this;
        
        return Util.getQueryString(name,def);
      },
      fiber$param :function* _trc_WebPage_f_param(_thread,name,def) {
        var _this=this;
        
        return Util.getQueryString(name,def);
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"openNewWindow":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"openPage":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"openTweet":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"openShareTweet":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"showLink":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"param":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"eventWindowOpen":{},"postOptions":{},"postUrl":{},"canvas":{},"listenerExists":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.Boot',
  shortName: 'Boot',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Actor,
  includes: [Tonyu.classes.kernel.T2MediaPlayer],
  methods: function (__superClass) {
    return {
      main :function _trc_Boot_main() {
        var _this=this;
        
        if (typeof  performance==="undefined") {
          _this.window.performance={};
          
        }
        if (! performance.now) {
          performance.now=(function now() {
            
            return Date.now();
          });
          
        }
        Tonyu.resetLoopCheck(10000);
        Tonyu.globals.$Boot=_this;
        _this.R=new Tonyu.classes.kernel.MessageResource().functionShortcut();
        _this.setScheduler(new Tonyu.classes.kernel.Scheduler);
        _this.initGlobals();
        _this.initLayers();
        _this.initPeripherals();
        _this.loadPlugins();
        if (Tonyu.globals.$customLoading) {
          _this.tt = Tonyu.thread();
          
          _this.tt.apply(_this,"loadAssets",[true]);
          _this.tt.steps();
          
        } else {
          _this.loadAssets();
          
        }
        _this.createMainObject();
        _this.progress();
        _this.mainLoop();
      },
      fiber$main :function* _trc_Boot_f_main(_thread) {
        var _this=this;
        
        if (typeof  performance==="undefined") {
          _this.window.performance={};
          
        }
        if (! performance.now) {
          performance.now=(function now() {
            
            return Date.now();
          });
          
        }
        Tonyu.resetLoopCheck(10000);
        Tonyu.globals.$Boot=_this;
        _this.R=new Tonyu.classes.kernel.MessageResource().functionShortcut();
        (yield* _this.fiber$setScheduler(_thread, new Tonyu.classes.kernel.Scheduler));
        (yield* _this.fiber$initGlobals(_thread));
        (yield* _this.fiber$initLayers(_thread));
        (yield* _this.fiber$initPeripherals(_thread));
        (yield* _this.fiber$loadPlugins(_thread));
        if (Tonyu.globals.$customLoading) {
          _this.tt = Tonyu.thread();
          
          _this.tt.apply(_this,"loadAssets",[true]);
          _this.tt.steps();
          
        } else {
          (yield* _this.fiber$loadAssets(_thread));
          
        }
        (yield* _this.fiber$createMainObject(_thread));
        (yield* _this.fiber$progress(_thread));
        (yield* _this.fiber$mainLoop(_thread));
        
      },
      initialize :function _trc_Boot_initialize(param) {
        var _this=this;
        
        _this.extend(param);
        _this.initSymbol();
        _this._th=Tonyu.thread();
        _this._th.apply(_this,"main");
        _this._th.stepsLoop();
        _this.on("die",(function anonymous_1107() {
          
          if (_this._th) {
            _this._th.kill();
          }
        }));
      },
      initSymbol :function _trc_Boot_initSymbol() {
        var _this=this;
        
        Tonyu.globals.$Symbol={subActors: "__SUBACTOR"};
      },
      fiber$initSymbol :function* _trc_Boot_f_initSymbol(_thread) {
        var _this=this;
        
        Tonyu.globals.$Symbol={subActors: "__SUBACTOR"};
        
      },
      setScheduler :function _trc_Boot_setScheduler(s) {
        var _this=this;
        
        _this._scheduler=Tonyu.globals.$Scheduler=s;
      },
      fiber$setScheduler :function* _trc_Boot_f_setScheduler(_thread,s) {
        var _this=this;
        
        _this._scheduler=Tonyu.globals.$Scheduler=s;
        
      },
      timeStop :function _trc_Boot_timeStop(except) {
        var _this=this;
        var oldS;
        var newS;
        var res;
        
        oldS = _this._scheduler;
        
        _this.setScheduler(new Tonyu.classes.kernel.Scheduler);
        newS = _this._scheduler;
        
        oldS.doTimeStop(newS);
        res = {release: (function anonymous_1760(a) {
          
          if (! a) {
            return res.releaseAll();
          }
          oldS.moveToNew(a);
        }),releaseAll: (function anonymous_2197() {
          
          oldS.moveToNew();
        })};
        
        if (except) {
          res.release(except);
        }
        return res;
      },
      fiber$timeStop :function* _trc_Boot_f_timeStop(_thread,except) {
        var _this=this;
        var oldS;
        var newS;
        var res;
        
        oldS = _this._scheduler;
        
        (yield* _this.fiber$setScheduler(_thread, new Tonyu.classes.kernel.Scheduler));
        newS = _this._scheduler;
        
        oldS.doTimeStop(newS);
        res = {release: (function anonymous_1760(a) {
          
          if (! a) {
            return res.releaseAll();
          }
          oldS.moveToNew(a);
        }),releaseAll: (function anonymous_2197() {
          
          oldS.moveToNew();
        })};
        
        if (except) {
          res.release(except);
        }
        return res;
        
      },
      update :function _trc_Boot_update() {
        var _this=this;
        
        _this.waitFor(Tonyu.timeout(50));
      },
      fiber$update :function* _trc_Boot_f_update(_thread) {
        var _this=this;
        
        (yield* _this.fiber$waitFor(_thread, Tonyu.timeout(50)));
        
      },
      initGlobals :function _trc_Boot_initGlobals() {
        var _this=this;
        var opt;
        var g;
        var name;
        
        opt = Tonyu.globals.$currentProject.getOptions();
        
        if (opt.run&&opt.run.globals) {
          g = opt.run.globals;
          
          for ([name] of Tonyu.iterator2(g,1)) {
            Tonyu.setGlobal(name,g[name]);
            
          }
          
        }
        Tonyu.globals.$fixProductOrder=true;
      },
      fiber$initGlobals :function* _trc_Boot_f_initGlobals(_thread) {
        var _this=this;
        var opt;
        var g;
        var name;
        
        opt = Tonyu.globals.$currentProject.getOptions();
        
        if (opt.run&&opt.run.globals) {
          g = opt.run.globals;
          
          for ([name] of Tonyu.iterator2(g,1)) {
            Tonyu.setGlobal(name,g[name]);
            
          }
          
        }
        Tonyu.globals.$fixProductOrder=true;
        
      },
      initPeripherals :function _trc_Boot_initPeripherals() {
        var _this=this;
        
        Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;
        Tonyu.globals.$Screen.multiLayerTouches=new Tonyu.classes.kernel.MultiLayerTouches({screen: Tonyu.globals.$Screen});
        Tonyu.globals.$InputDevice.on("touchstart",(function anonymous_2964(e) {
          var shape;
          var f;
          var a;
          
          
          f = e.finger;
          
          _this.assertIs(f.layerPath,Tonyu.classes.kernel.LayerPath);
          if (e.byMouse) {
            shape=new Tonyu.classes.kernel.PointShape({x: f.x,y: f.y,layerPath: f.layerPath});
            
          } else {
            shape=new Tonyu.classes.kernel.RectShape({x: f.x,y: f.y,width: 32,height: 32,layerPath: f.layerPath});
            
          }
          e.shape=shape;
          a = Tonyu.globals.$Screen.multiLayerTouches.findActor(shape);
          
          if (a) {
            e.actor=a;
            f.layer=a.layer;
            a.fireEvent("touch",e);
            
          } else {
            f.layer=Tonyu.globals.$Screen;
            Tonyu.globals.$Screen.fireEvent("touch",e);
            
          }
        }));
        Tonyu.globals.$InputBox=UIDiag;
        Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);
        Tonyu.globals.$ObjectPool=new Tonyu.classes.kernel.ObjectPool;
        Tonyu.globals.$pat_fruits=30;
        Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;
        Tonyu.globals.$GamePad=new Tonyu.classes.kernel.GamePad;
        Tonyu.globals.$Math=Math;
        Tonyu.globals.$JSON=JSON;
        Tonyu.globals.$DeferredUtil=FS.DeferredUtil;
        Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.ConsolePanel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});
        Tonyu.globals.$printColor=null;
        Tonyu.globals.$printSize=20;
        Tonyu.globals.$consolePrintY=465;
        Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});
        _this.initFPSParams();
        Tonyu.globals.$WebPage=new Tonyu.classes.kernel.WebPage;
        Tonyu.globals.$Navigator=new Tonyu.classes.kernel.Navigator;
        Tonyu.globals.$API=new Tonyu.classes.kernel.API;
        Tonyu.globals.$Zip=new Tonyu.classes.kernel.Zip;
        if (typeof  RPGAtsumaru!=="undefined") {
          Tonyu.globals.$RPGAtsumaru=RPGAtsumaru;
          
        }
        Tonyu.globals.$mouseX=Tonyu.globals.$mouseX||0;
        Tonyu.globals.$mouseY=Tonyu.globals.$mouseY||0;
        Tonyu.globals.$imageList=[];
        _this.debugCnt=50;
        _this.newLimit=1000;
        Tonyu.globals.$printLimit=500;
        if (Tonyu.globals.$debugger) {
          _this.autoReload=Tonyu.globals.$debugger.startWithAutoReload;
          Tonyu.globals.$debugger.on("classChanged",(function anonymous_4645() {
            
            _this.getMainClass();
            _this.doAutoReload();
          }));
          
        }
        _this.pageStack=[];
      },
      fiber$initPeripherals :function* _trc_Boot_f_initPeripherals(_thread) {
        var _this=this;
        
        Tonyu.globals.$InputDevice=new Tonyu.classes.kernel.InputDevice;
        Tonyu.globals.$Screen.multiLayerTouches=new Tonyu.classes.kernel.MultiLayerTouches({screen: Tonyu.globals.$Screen});
        Tonyu.globals.$InputDevice.on("touchstart",(function anonymous_2964(e) {
          var shape;
          var f;
          var a;
          
          
          f = e.finger;
          
          _this.assertIs(f.layerPath,Tonyu.classes.kernel.LayerPath);
          if (e.byMouse) {
            shape=new Tonyu.classes.kernel.PointShape({x: f.x,y: f.y,layerPath: f.layerPath});
            
          } else {
            shape=new Tonyu.classes.kernel.RectShape({x: f.x,y: f.y,width: 32,height: 32,layerPath: f.layerPath});
            
          }
          e.shape=shape;
          a = Tonyu.globals.$Screen.multiLayerTouches.findActor(shape);
          
          if (a) {
            e.actor=a;
            f.layer=a.layer;
            a.fireEvent("touch",e);
            
          } else {
            f.layer=Tonyu.globals.$Screen;
            Tonyu.globals.$Screen.fireEvent("touch",e);
            
          }
        }));
        Tonyu.globals.$InputBox=UIDiag;
        Tonyu.globals.$InputDevice.initCanvasEvents(_this.cvj);
        Tonyu.globals.$ObjectPool=new Tonyu.classes.kernel.ObjectPool;
        Tonyu.globals.$pat_fruits=30;
        Tonyu.globals.$Keys=new Tonyu.classes.kernel.Keys;
        Tonyu.globals.$GamePad=new Tonyu.classes.kernel.GamePad;
        Tonyu.globals.$Math=Math;
        Tonyu.globals.$JSON=JSON;
        Tonyu.globals.$DeferredUtil=FS.DeferredUtil;
        Tonyu.globals.$consolePanel=new Tonyu.classes.kernel.ConsolePanel({align: "center",x: 465/2,y: 465/2,width: 465,height: 465,zOrder: - 10,layer: Tonyu.globals.$FrontSprites});
        Tonyu.globals.$printColor=null;
        Tonyu.globals.$printSize=20;
        Tonyu.globals.$consolePrintY=465;
        Tonyu.globals.$panel=new Tonyu.classes.kernel.Panel({align: "center",x: Tonyu.globals.$screenWidth/2,y: Tonyu.globals.$screenHeight/2,width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,zOrder: - 1,layer: Tonyu.globals.$FrontSprites});
        _this.initFPSParams();
        Tonyu.globals.$WebPage=new Tonyu.classes.kernel.WebPage;
        Tonyu.globals.$Navigator=new Tonyu.classes.kernel.Navigator;
        Tonyu.globals.$API=new Tonyu.classes.kernel.API;
        Tonyu.globals.$Zip=new Tonyu.classes.kernel.Zip;
        if (typeof  RPGAtsumaru!=="undefined") {
          Tonyu.globals.$RPGAtsumaru=RPGAtsumaru;
          
        }
        Tonyu.globals.$mouseX=Tonyu.globals.$mouseX||0;
        Tonyu.globals.$mouseY=Tonyu.globals.$mouseY||0;
        Tonyu.globals.$imageList=[];
        _this.debugCnt=50;
        _this.newLimit=1000;
        Tonyu.globals.$printLimit=500;
        if (Tonyu.globals.$debugger) {
          _this.autoReload=Tonyu.globals.$debugger.startWithAutoReload;
          Tonyu.globals.$debugger.on("classChanged",(function anonymous_4645() {
            
            _this.getMainClass();
            _this.doAutoReload();
          }));
          
        }
        _this.pageStack=[];
        
      },
      doAutoReload :function _trc_Boot_doAutoReload() {
        var _this=this;
        
        if (typeof  _this.autoReload==="function") {
          return _this.autoReload({mainClass: _this.mainClass});
          
        }
        if (_this.autoReload===true&&_this.mainClass) {
          _this.loadPage(_this.mainClass);
          
        }
      },
      fiber$doAutoReload :function* _trc_Boot_f_doAutoReload(_thread) {
        var _this=this;
        
        if (typeof  _this.autoReload==="function") {
          return _this.autoReload({mainClass: _this.mainClass});
          
        }
        if (_this.autoReload===true&&_this.mainClass) {
          (yield* _this.fiber$loadPage(_thread, _this.mainClass));
          
        }
        
      },
      initLayers :function _trc_Boot_initLayers() {
        var _this=this;
        
        Tonyu.globals.$screenWidth=465;
        Tonyu.globals.$screenHeight=465;
        _this.cvj=Tonyu.globals.$mainCanvas||$("canvas");
        Tonyu.globals.$rootLayer=new Tonyu.classes.kernel.Sprites();
        Tonyu.globals.$defaultLayer=Tonyu.globals.$mainLayer=Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites({name: "main"});
        Tonyu.globals.$frontLayer=Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites({name: "front"});
        Tonyu.globals.$backLayer=new Tonyu.classes.kernel.Sprites({name: "back"});
        Tonyu.globals.$uiLayer=new Tonyu.classes.kernel.Sprites({name: "ui"});
        Tonyu.globals.$uiScreen=new Tonyu.classes.kernel.Screen({canvas: _this.cvj[0],layer: Tonyu.globals.$rootLayer});
        Tonyu.globals.$uiScreen.defaultLayerPath=Tonyu.globals.$rootLayerPath=new Tonyu.classes.kernel.LayerPath({target: Tonyu.globals.$uiScreen});
        Tonyu.globals.$uiScreen.setBGColor("#888");
        Tonyu.globals.$uiScreen.addLayer(Tonyu.globals.$uiLayer);
        Tonyu.globals.$sprites3D=new Tonyu.classes.kernel.Sprites3D;
        Tonyu.globals.$camera3D=new Tonyu.classes.kernel.Camera3D({layer: Tonyu.globals.$sprites3D,x: 0,y: 0,z: - 100});
        Tonyu.globals.$mainLayer3D=new Tonyu.classes.kernel.Layer3D({group: Tonyu.globals.$sprites3D,camera: Tonyu.globals.$camera3D});
        Tonyu.globals.$Screen=new Tonyu.classes.kernel.Screen({width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,layer: Tonyu.globals.$uiLayer});
        Tonyu.globals.$Screen.on("resize",(function anonymous_5845() {
          
          Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;
          Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;
          if (Tonyu.globals.$panel) {
            Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
            Tonyu.globals.$panel.x=Tonyu.globals.$screenWidth/2;
            Tonyu.globals.$panel.y=Tonyu.globals.$screenHeight/2;
            
          }
          if (Tonyu.globals.$consolePanel) {
            Tonyu.globals.$consolePanel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
            Tonyu.globals.$consolePanel.x=Tonyu.globals.$screenWidth/2;
            Tonyu.globals.$consolePanel.y=Tonyu.globals.$screenHeight/2;
            Tonyu.globals.$consolePrintY=Tonyu.globals.$screenHeight;
            
          }
        }));
        Tonyu.globals.$Screen.addLayer(Tonyu.globals.$frontLayer);
        Tonyu.globals.$camera2D=Tonyu.globals.$Screen.addLayer(Tonyu.globals.$mainLayer);
        Tonyu.globals.$Screen.addLayer(Tonyu.globals.$mainLayer3D);
        Tonyu.globals.$Screen.addLayer(Tonyu.globals.$backLayer);
        Tonyu.globals.$Screen.setBGColor("rgb(20,80,180)");
        Tonyu.globals.$Screen.selectLayer(Tonyu.globals.$mainLayer);
        Tonyu.globals.$layoutManager=new Tonyu.classes.kernel.UILayout({layer: Tonyu.globals.$uiLayer});
      },
      fiber$initLayers :function* _trc_Boot_f_initLayers(_thread) {
        var _this=this;
        
        Tonyu.globals.$screenWidth=465;
        Tonyu.globals.$screenHeight=465;
        _this.cvj=Tonyu.globals.$mainCanvas||$("canvas");
        Tonyu.globals.$rootLayer=new Tonyu.classes.kernel.Sprites();
        Tonyu.globals.$defaultLayer=Tonyu.globals.$mainLayer=Tonyu.globals.$Sprites=new Tonyu.classes.kernel.Sprites({name: "main"});
        Tonyu.globals.$frontLayer=Tonyu.globals.$FrontSprites=new Tonyu.classes.kernel.Sprites({name: "front"});
        Tonyu.globals.$backLayer=new Tonyu.classes.kernel.Sprites({name: "back"});
        Tonyu.globals.$uiLayer=new Tonyu.classes.kernel.Sprites({name: "ui"});
        Tonyu.globals.$uiScreen=new Tonyu.classes.kernel.Screen({canvas: _this.cvj[0],layer: Tonyu.globals.$rootLayer});
        Tonyu.globals.$uiScreen.defaultLayerPath=Tonyu.globals.$rootLayerPath=new Tonyu.classes.kernel.LayerPath({target: Tonyu.globals.$uiScreen});
        Tonyu.globals.$uiScreen.setBGColor("#888");
        Tonyu.globals.$uiScreen.addLayer(Tonyu.globals.$uiLayer);
        Tonyu.globals.$sprites3D=new Tonyu.classes.kernel.Sprites3D;
        Tonyu.globals.$camera3D=new Tonyu.classes.kernel.Camera3D({layer: Tonyu.globals.$sprites3D,x: 0,y: 0,z: - 100});
        Tonyu.globals.$mainLayer3D=new Tonyu.classes.kernel.Layer3D({group: Tonyu.globals.$sprites3D,camera: Tonyu.globals.$camera3D});
        Tonyu.globals.$Screen=new Tonyu.classes.kernel.Screen({width: Tonyu.globals.$screenWidth,height: Tonyu.globals.$screenHeight,layer: Tonyu.globals.$uiLayer});
        Tonyu.globals.$Screen.on("resize",(function anonymous_5845() {
          
          Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;
          Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;
          if (Tonyu.globals.$panel) {
            Tonyu.globals.$panel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
            Tonyu.globals.$panel.x=Tonyu.globals.$screenWidth/2;
            Tonyu.globals.$panel.y=Tonyu.globals.$screenHeight/2;
            
          }
          if (Tonyu.globals.$consolePanel) {
            Tonyu.globals.$consolePanel.setPanel(Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
            Tonyu.globals.$consolePanel.x=Tonyu.globals.$screenWidth/2;
            Tonyu.globals.$consolePanel.y=Tonyu.globals.$screenHeight/2;
            Tonyu.globals.$consolePrintY=Tonyu.globals.$screenHeight;
            
          }
        }));
        Tonyu.globals.$Screen.addLayer(Tonyu.globals.$frontLayer);
        Tonyu.globals.$camera2D=Tonyu.globals.$Screen.addLayer(Tonyu.globals.$mainLayer);
        Tonyu.globals.$Screen.addLayer(Tonyu.globals.$mainLayer3D);
        Tonyu.globals.$Screen.addLayer(Tonyu.globals.$backLayer);
        Tonyu.globals.$Screen.setBGColor("rgb(20,80,180)");
        Tonyu.globals.$Screen.selectLayer(Tonyu.globals.$mainLayer);
        Tonyu.globals.$layoutManager=new Tonyu.classes.kernel.UILayout({layer: Tonyu.globals.$uiLayer});
        
      },
      debug :function _trc_Boot_debug() {
        var _this=this;
        var a;
        
        if (! _this.debugCnt) {
          return _this;
        }
        _this.debugCnt--;
        a = Array.prototype.slice.call(arguments);
        
        a.unshift(_this.debugCnt);
        a.unshift("DEBUG");
        console.log.apply(console,a);
      },
      fiber$debug :function* _trc_Boot_f_debug(_thread) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        var a;
        
        if (! _this.debugCnt) {
          return _this;
        }
        _this.debugCnt--;
        a = Array.prototype.slice.call(_arguments);
        
        a.unshift(_this.debugCnt);
        a.unshift("DEBUG");
        console.log.apply(console,a);
        
      },
      loadPlugins :function _trc_Boot_loadPlugins() {
        var _this=this;
        
        _this.progress("Loading plugins..");
        _this.runPromise((function anonymous_6910(r) {
          
          Tonyu.globals.$currentProject.loadPlugins(r);
        }));
        _this.progress("Loading plugins done");
      },
      fiber$loadPlugins :function* _trc_Boot_f_loadPlugins(_thread) {
        var _this=this;
        
        (yield* _this.fiber$progress(_thread, "Loading plugins.."));
        (yield* _this.fiber$runPromise(_thread, (function anonymous_6910(r) {
          
          Tonyu.globals.$currentProject.loadPlugins(r);
        })));
        (yield* _this.fiber$progress(_thread, "Loading plugins done"));
        
      },
      loadImages :function _trc_Boot_loadImages() {
        var _this=this;
        var rs;
        var r;
        var name;
        var val;
        
        _this.progress("Loading pats..");
        rs = Tonyu.globals.$currentProject.getResource();
        
        
        r=_this.runPromise((function anonymous_7131(succ) {
          
          ImageList.load(rs.images,succ,{baseDir: Tonyu.globals.$currentProject.getDir(),prj: Tonyu.globals.$currentProject});
        }));
        Tonyu.globals.$imageList=r;
        for ([name, val] of Tonyu.iterator2(r.names,2)) {
          Tonyu.setGlobal(name,val);
          
        }
        _this.progress("Loading pats done.");
      },
      fiber$loadImages :function* _trc_Boot_f_loadImages(_thread) {
        var _this=this;
        var rs;
        var r;
        var name;
        var val;
        
        (yield* _this.fiber$progress(_thread, "Loading pats.."));
        rs = Tonyu.globals.$currentProject.getResource();
        
        
        r=(yield* _this.fiber$runPromise(_thread, (function anonymous_7131(succ) {
          
          ImageList.load(rs.images,succ,{baseDir: Tonyu.globals.$currentProject.getDir(),prj: Tonyu.globals.$currentProject});
        })));
        Tonyu.globals.$imageList=r;
        for ([name, val] of Tonyu.iterator2(r.names,2)) {
          Tonyu.setGlobal(name,val);
          
        }
        (yield* _this.fiber$progress(_thread, "Loading pats done."));
        
      },
      loadSounds :function _trc_Boot_loadSounds() {
        var _this=this;
        
        _this.progress("Loading sounds...");
        _this.initT2MediaPlayer();
        _this.loadFromProject(Tonyu.globals.$currentProject);
        _this.progress("Loading sounds done.");
        _this.on("stop",(function anonymous_7597() {
          
          _this.allResetBGM();
        }));
        Tonyu.globals.$sound=_this;
      },
      fiber$loadSounds :function* _trc_Boot_f_loadSounds(_thread) {
        var _this=this;
        
        (yield* _this.fiber$progress(_thread, "Loading sounds..."));
        (yield* _this.fiber$initT2MediaPlayer(_thread));
        (yield* _this.fiber$loadFromProject(_thread, Tonyu.globals.$currentProject));
        (yield* _this.fiber$progress(_thread, "Loading sounds done."));
        _this.on("stop",(function anonymous_7597() {
          
          _this.allResetBGM();
        }));
        Tonyu.globals.$sound=_this;
        
      },
      loadAssets :function _trc_Boot_loadAssets(para) {
        var _this=this;
        
        _this.loadImages();
        _this.loadSounds();
        _this.loadedAll=true;
        if (para) {
          _this.progress();
        }
      },
      fiber$loadAssets :function* _trc_Boot_f_loadAssets(_thread,para) {
        var _this=this;
        
        (yield* _this.fiber$loadImages(_thread));
        (yield* _this.fiber$loadSounds(_thread));
        _this.loadedAll=true;
        if (para) {
          (yield* _this.fiber$progress(_thread));
        }
        
      },
      getIDE :function _trc_Boot_getIDE() {
        var _this=this;
        var e;
        
        try {
          let p = parent||opener;
          
          return (p.Tonyu.globals.$currentProject.ide);
          
        } catch (e) {
          return null;
          
        }
      },
      fiber$getIDE :function* _trc_Boot_f_getIDE(_thread) {
        var _this=this;
        var e;
        
        try {
          let p = parent||opener;
          
          return (p.Tonyu.globals.$currentProject.ide);
          
        } catch (e) {
          return null;
          
        }
        
      },
      getMainClass :function _trc_Boot_getMainClass() {
        var _this=this;
        var o;
        var mainClassName;
        
        o = Tonyu.globals.$currentProject.getOptions();
        
        mainClassName = o.run.mainClass;
        
        _this.progress("MainClass= "+mainClassName);
        _this.mainClass=Tonyu.getClass(mainClassName);
        if (! _this.mainClass) {
          throw new Error(mainClassName+" というクラスはありません");
          
          
        }
      },
      fiber$getMainClass :function* _trc_Boot_f_getMainClass(_thread) {
        var _this=this;
        var o;
        var mainClassName;
        
        o = Tonyu.globals.$currentProject.getOptions();
        
        mainClassName = o.run.mainClass;
        
        (yield* _this.fiber$progress(_thread, "MainClass= "+mainClassName));
        _this.mainClass=Tonyu.getClass(mainClassName);
        if (! _this.mainClass) {
          throw new Error(mainClassName+" というクラスはありません");
          
          
        }
        
      },
      createMainObject :function _trc_Boot_createMainObject() {
        var _this=this;
        
        _this.getMainClass();
        Tonyu.globals.$excludeFromAll=Tonyu.globals.$Screen.all();
        new _this.mainClass();
      },
      fiber$createMainObject :function* _trc_Boot_f_createMainObject(_thread) {
        var _this=this;
        
        (yield* _this.fiber$getMainClass(_thread));
        Tonyu.globals.$excludeFromAll=Tonyu.globals.$Screen.all();
        new _this.mainClass();
        
      },
      loadPage :function _trc_Boot_loadPage(page,arg,options) {
        var _this=this;
        var push;
        var pass;
        var res;
        var oldS;
        var newS;
        var saved;
        var pa;
        var a;
        
        switch (typeof  arg) {
        case "function":
          options={onLoad: arg};
          arg=undefined;
          break;
          
        case "boolean":
          options={push: arg};
          arg=undefined;
          break;
          
        }
        if (typeof  options==="boolean") {
          options={push: options};
        }
        if (typeof  options==="function") {
          options={onLoad: options};
        }
        options=options||{};
        push = (options.push);
        
        pass = (options.pass||[]).concat(Tonyu.globals.$excludeFromAll.toArray());
        
        
        oldS = _this._scheduler;
        
        if (! page) {
          saved = _this.pageStack.pop();
          
          if (! saved) {
            throw new Error(_this.R("noPushedPages"));
            
            
          }
          Tonyu.globals.$Screen.restore(saved.sprites);
          Tonyu.globals.$t2World=saved.t2World;
          newS=saved.scheduler;
          _this.setScheduler(newS);
          for ([pa] of Tonyu.iterator2(saved.pass,1)) {
            oldS.moveTo(pa,newS);
            
          }
          
        } else {
          if (push) {
            saved = {scheduler: oldS,sprites: Tonyu.globals.$Screen.saveAndClear(pass),t2World: Tonyu.globals.$t2World,pass: pass};
            
            newS=new Tonyu.classes.kernel.Scheduler;
            _this.setScheduler(newS);
            for ([pa] of Tonyu.iterator2(pass,1)) {
              oldS.moveTo(pa,newS);
              
            }
            Tonyu.globals.$t2World=null;
            _this.pageStack.push(saved);
            _this.restoreDefaultLayer();
            res=new page(arg);
            
          } else {
            a = Tonyu.globals.$Screen.all();
            
            a=a.find((function anonymous_9749(e) {
              
              return pass.indexOf(e)<0;
            }));
            a.die();
            _this.restoreDefaultLayer();
            res=new page(arg);
            
          }
        }
        if (typeof  options.onLoad==="function") {
          options.onLoad({page: res});
        }
      },
      fiber$loadPage :function* _trc_Boot_f_loadPage(_thread,page,arg,options) {
        var _this=this;
        var push;
        var pass;
        var res;
        var oldS;
        var newS;
        var saved;
        var pa;
        var a;
        
        switch (typeof  arg) {
        case "function":
          options={onLoad: arg};
          arg=undefined;
          break;
          
        case "boolean":
          options={push: arg};
          arg=undefined;
          break;
          
        }
        if (typeof  options==="boolean") {
          options={push: options};
        }
        if (typeof  options==="function") {
          options={onLoad: options};
        }
        options=options||{};
        push = (options.push);
        
        pass = (options.pass||[]).concat(Tonyu.globals.$excludeFromAll.toArray());
        
        
        oldS = _this._scheduler;
        
        if (! page) {
          saved = _this.pageStack.pop();
          
          if (! saved) {
            throw new Error(_this.R("noPushedPages"));
            
            
          }
          Tonyu.globals.$Screen.restore(saved.sprites);
          Tonyu.globals.$t2World=saved.t2World;
          newS=saved.scheduler;
          (yield* _this.fiber$setScheduler(_thread, newS));
          for ([pa] of Tonyu.iterator2(saved.pass,1)) {
            oldS.moveTo(pa,newS);
            
          }
          
        } else {
          if (push) {
            saved = {scheduler: oldS,sprites: Tonyu.globals.$Screen.saveAndClear(pass),t2World: Tonyu.globals.$t2World,pass: pass};
            
            newS=new Tonyu.classes.kernel.Scheduler;
            (yield* _this.fiber$setScheduler(_thread, newS));
            for ([pa] of Tonyu.iterator2(pass,1)) {
              oldS.moveTo(pa,newS);
              
            }
            Tonyu.globals.$t2World=null;
            _this.pageStack.push(saved);
            (yield* _this.fiber$restoreDefaultLayer(_thread));
            res=new page(arg);
            
          } else {
            a = Tonyu.globals.$Screen.all();
            
            a=a.find((function anonymous_9749(e) {
              
              return pass.indexOf(e)<0;
            }));
            a.die();
            (yield* _this.fiber$restoreDefaultLayer(_thread));
            res=new page(arg);
            
          }
        }
        if (typeof  options.onLoad==="function") {
          options.onLoad({page: res});
        }
        
      },
      restoreDefaultLayer :function _trc_Boot_restoreDefaultLayer() {
        var _this=this;
        
        let l = Tonyu.globals.$Screen.findLayer(Tonyu.globals.$defaultLayer)||Tonyu.globals.$Screen.findLayer(Tonyu.globals.$mainLayer)||Tonyu.globals.$Screen.findLayer("main")||Tonyu.globals.$Screen.findLayer(0);
        
        Tonyu.globals.$defaultLayer=l;
      },
      fiber$restoreDefaultLayer :function* _trc_Boot_f_restoreDefaultLayer(_thread) {
        var _this=this;
        
        let l = Tonyu.globals.$Screen.findLayer(Tonyu.globals.$defaultLayer)||Tonyu.globals.$Screen.findLayer(Tonyu.globals.$mainLayer)||Tonyu.globals.$Screen.findLayer("main")||Tonyu.globals.$Screen.findLayer(0);
        
        Tonyu.globals.$defaultLayer=l;
        
      },
      stop :function _trc_Boot_stop() {
        var _this=this;
        var evt;
        var e;
        var r;
        
        return new Promise((function anonymous_10176(resolve) {
          var evt;
          var e;
          var r;
          
          evt = {die: (function anonymous_10263() {
            
            _this.die();
            resolve();
          }),preventDefault: (function anonymous_10404() {
            
            evt.defaultPrevented=true;
          })};
          
          try {
            Tonyu.globals.$sound.stopAllSE();
            
          } catch (e) {
            console.error(e.stack);
            
          }
          r = _this.fireEvent("stop",evt);
          
          if (! evt.defaultPrevented) {
            evt.die();
            resolve();
            
          }
        }));
      },
      fiber$stop :function* _trc_Boot_f_stop(_thread) {
        var _this=this;
        var evt;
        var e;
        var r;
        
        return new Promise((function anonymous_10176(resolve) {
          var evt;
          var e;
          var r;
          
          evt = {die: (function anonymous_10263() {
            
            _this.die();
            resolve();
          }),preventDefault: (function anonymous_10404() {
            
            evt.defaultPrevented=true;
          })};
          
          try {
            Tonyu.globals.$sound.stopAllSE();
            
          } catch (e) {
            console.error(e.stack);
            
          }
          r = _this.fireEvent("stop",evt);
          
          if (! evt.defaultPrevented) {
            evt.die();
            resolve();
            
          }
        }));
        
      },
      hide :function _trc_Boot_hide() {
        var _this=this;
        
      },
      schedule :function _trc_Boot_schedule(obj,method,args) {
        var _this=this;
        var s;
        var th;
        
        if (! method) {
          throw new Error("指定されたメソッドは定義されていません:"+method);
          
        }
        args=args||[];
        s = obj._scheduler||_this._scheduler;
        
        th = s.newThread(obj,method,args);
        
        if (obj!==_this) {
          obj.setThreadGroup(_this);
        }
        th.setThreadGroup(obj);
        return th;
      },
      fiber$schedule :function* _trc_Boot_f_schedule(_thread,obj,method,args) {
        var _this=this;
        var s;
        var th;
        
        if (! method) {
          throw new Error("指定されたメソッドは定義されていません:"+method);
          
        }
        args=args||[];
        s = obj._scheduler||_this._scheduler;
        
        th = s.newThread(obj,method,args);
        
        if (obj!==_this) {
          obj.setThreadGroup(_this);
        }
        th.setThreadGroup(obj);
        return th;
        
      },
      progress :function _trc_Boot_progress(m) {
        var _this=this;
        
        if (typeof  SplashScreen=="undefined") {
          return _this;
        }
        if (m) {
          console.log.apply(console,arguments);
          SplashScreen.progress(m);
          
        } else {
          SplashScreen.hide();
        }
      },
      fiber$progress :function* _trc_Boot_f_progress(_thread,m) {
        var _this=this;
        var _arguments=Tonyu.A(arguments);
        
        if (typeof  SplashScreen=="undefined") {
          return _this;
        }
        if (m) {
          console.log.apply(console,_arguments);
          SplashScreen.progress(m);
          
        } else {
          SplashScreen.hide();
        }
        
      },
      progressNoLog :function _trc_Boot_progressNoLog(m) {
        var _this=this;
        
        if (typeof  SplashScreen=="undefined") {
          return _this;
        }
        if (m) {
          SplashScreen.progress(m);
          
        } else {
          SplashScreen.hide();
        }
      },
      fiber$progressNoLog :function* _trc_Boot_f_progressNoLog(_thread,m) {
        var _this=this;
        
        if (typeof  SplashScreen=="undefined") {
          return _this;
        }
        if (m) {
          SplashScreen.progress(m);
          
        } else {
          SplashScreen.hide();
        }
        
      },
      mainLoop :function _trc_Boot_mainLoop() {
        var _this=this;
        
        Tonyu.globals.$frameCount=0;
        Tonyu.globals.$drawnFrameCount=0;
        while (true) {
          if (_this._useRAF) {
            _this.loopRAF();
          } else {
            _this.loopTimer();
          }
          _this.measureFps();
          _this.handlePause();
          if (typeof  Mezonet!=="undefined"&&typeof  Mezonet.doRefresh==="function") {
            Mezonet.doRefresh();
          }
          Tonyu.globals.$drawnFrameCount++;
          
        }
      },
      fiber$mainLoop :function* _trc_Boot_f_mainLoop(_thread) {
        var _this=this;
        
        Tonyu.globals.$frameCount=0;
        Tonyu.globals.$drawnFrameCount=0;
        while (true) {
          if (_this._useRAF) {
            (yield* _this.fiber$loopRAF(_thread));
          } else {
            (yield* _this.fiber$loopTimer(_thread));
          }
          _this.measureFps();
          (yield* _this.fiber$handlePause(_thread));
          if (typeof  Mezonet!=="undefined"&&typeof  Mezonet.doRefresh==="function") {
            Mezonet.doRefresh();
          }
          Tonyu.globals.$drawnFrameCount++;
          
        }
        
      },
      loopRAF :function _trc_Boot_loopRAF() {
        var _this=this;
        var nowTime;
        var frameTime;
        var moves;
        var bufferTime;
        
        nowTime = _this.now();
        
        frameTime = 1000/_this._fps;
        
        moves = 0;
        
        bufferTime = 0;
        
        _this.subTime=_this.trunc(nowTime-_this.rafProcNowTime);
        _this.procCnt=_this.subTime/frameTime;
        bufferTime=(0.5*_this._fps/60);
        if (_this._fps<58||_this._fps>62) {
          bufferTime=0;
        }
        if (_this.procCnt>=1-bufferTime&&_this.procCnt<=1+bufferTime) {
          _this.procCnt=1;
        }
        _this.procCnt=_this.floor(_this.procCnt);
        if (_this.procCnt>_this.maxFrameSkip) {
          _this.procCnt=_this.maxFrameSkip;
          _this.rafProcNowTime=nowTime;
          
        } else {
          _this.rafProcNowTime+=_this.procCnt*frameTime;
          
        }
        while (moves<_this.procCnt) {
          Tonyu.globals.$_doDraw=moves==_this.procCnt-1;
          _this.moveFrame();
          moves++;
          if (moves<_this.procCnt) {
            _this.afterDraw({drawn: false});
          }
          
        }
        if (moves>0) {
          _this.drawFrame();
          _this.afterDraw({drawn: true});
          
        }
        _this.runPromise(requestAnimationFrame);
      },
      fiber$loopRAF :function* _trc_Boot_f_loopRAF(_thread) {
        var _this=this;
        var nowTime;
        var frameTime;
        var moves;
        var bufferTime;
        
        nowTime = _this.now();
        
        frameTime = 1000/_this._fps;
        
        moves = 0;
        
        bufferTime = 0;
        
        _this.subTime=_this.trunc(nowTime-_this.rafProcNowTime);
        _this.procCnt=_this.subTime/frameTime;
        bufferTime=(0.5*_this._fps/60);
        if (_this._fps<58||_this._fps>62) {
          bufferTime=0;
        }
        if (_this.procCnt>=1-bufferTime&&_this.procCnt<=1+bufferTime) {
          _this.procCnt=1;
        }
        _this.procCnt=_this.floor(_this.procCnt);
        if (_this.procCnt>_this.maxFrameSkip) {
          _this.procCnt=_this.maxFrameSkip;
          _this.rafProcNowTime=nowTime;
          
        } else {
          _this.rafProcNowTime+=_this.procCnt*frameTime;
          
        }
        while (moves<_this.procCnt) {
          Tonyu.globals.$_doDraw=moves==_this.procCnt-1;
          _this.moveFrame();
          moves++;
          if (moves<_this.procCnt) {
            _this.afterDraw({drawn: false});
          }
          
        }
        if (moves>0) {
          _this.drawFrame();
          _this.afterDraw({drawn: true});
          
        }
        (yield* _this.fiber$runPromise(_thread, requestAnimationFrame));
        
      },
      loopTimer :function _trc_Boot_loopTimer() {
        var _this=this;
        
        _this.moveFrame();
        _this.doDraw=_this.now()<_this.deadLine;
        if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {
          _this.doDraw=true;
          _this.resetDeadLine();
          
        }
        Tonyu.globals.$_doDraw=_this.doDraw;
        if (_this.doDraw) {
          _this.drawFrame();
          _this.frameSkipped=0;
          
        } else {
          _this.frameSkipped++;
          
        }
        _this.afterDraw({drawn: _this.doDraw});
        _this.waitFrame();
      },
      fiber$loopTimer :function* _trc_Boot_f_loopTimer(_thread) {
        var _this=this;
        
        _this.moveFrame();
        _this.doDraw=_this.now()<_this.deadLine;
        if (! _this.doDraw&&_this.frameSkipped>=_this.maxFrameSkip) {
          _this.doDraw=true;
          _this.resetDeadLine();
          
        }
        Tonyu.globals.$_doDraw=_this.doDraw;
        if (_this.doDraw) {
          _this.drawFrame();
          _this.frameSkipped=0;
          
        } else {
          _this.frameSkipped++;
          
        }
        _this.afterDraw({drawn: _this.doDraw});
        (yield* _this.fiber$waitFrame(_thread));
        
      },
      handlePause :function _trc_Boot_handlePause() {
        var _this=this;
        
        if (_this.economyMode&&_this._scheduler.isEmpty) {
          _this.isIdle=true;
          while (_this._scheduler.isEmpty) {
            _this.runPromise(requestAnimationFrame);
            
          }
          _this.resetDeadLine();
          
        }
        while (_this.paused) {
          _this.isIdle=true;
          _this.runPromise(requestAnimationFrame);
          if (! _this.paused) {
            _this.resetDeadLine();
          }
          
        }
        _this.isIdle=false;
      },
      fiber$handlePause :function* _trc_Boot_f_handlePause(_thread) {
        var _this=this;
        
        if (_this.economyMode&&_this._scheduler.isEmpty) {
          _this.isIdle=true;
          while (_this._scheduler.isEmpty) {
            (yield* _this.fiber$runPromise(_thread, requestAnimationFrame));
            
          }
          _this.resetDeadLine();
          
        }
        while (_this.paused) {
          _this.isIdle=true;
          (yield* _this.fiber$runPromise(_thread, requestAnimationFrame));
          if (! _this.paused) {
            _this.resetDeadLine();
          }
          
        }
        _this.isIdle=false;
        
      },
      drawFrame :function _trc_Boot_drawFrame() {
        var _this=this;
        var s;
        
        s = _this.now();
        
        Tonyu.globals.$uiScreen.drawLayers();
        _this.drawTime=_this.now()-s;
        _this.fps_fpsCnt++;
      },
      moveFrame :function _trc_Boot_moveFrame() {
        var _this=this;
        var s;
        var sc;
        
        s = _this.now();
        
        Tonyu.globals.$_printCount=0;
        Tonyu.resetLoopCheck();
        if (_this.newLimit) {
          _this.newLimitCount=_this.newLimit;
        }
        _this.fireEvent("beforeMove");
        sc = _this._scheduler.stepsAll();
        
        Tonyu.globals.$Keys.update();
        Tonyu.globals.$GamePad.update();
        Tonyu.globals.$InputDevice.update();
        if (Tonyu.globals.$sound) {
          Tonyu.globals.$sound.resetSEFrame();
        }
        _this.fireEvent("afterMove");
        Tonyu.globals.$screenWidth=Tonyu.globals.$Screen.width;
        Tonyu.globals.$screenHeight=Tonyu.globals.$Screen.height;
        _this.moveTime=_this.now()-s;
        _this.fps_rpsCnt++;
        Tonyu.globals.$frameCount++;
      },
      afterDraw :function _trc_Boot_afterDraw(e) {
        var _this=this;
        
        Tonyu.globals.$Sprites.checkHit();
        Tonyu.globals.$Sprites.removeOneframes(e.drawn);
        _this.sendEvent("afterDraw",e);
      },
      initFPSParams :function _trc_Boot_initFPSParams() {
        var _this=this;
        
        _this._fps=Tonyu.globals.$defaultFPS||30;
        _this.maxFrameSkip=5;
        _this.minFrameSkip=1;
        _this.frameCnt=0;
        _this.resetDeadLine();
        _this.lastMeasured=_this.now();
        _this.fps_fps=_this.fps_rps=_this.fps_fpsCnt=_this.fps_rpsCnt=0;
        _this.drawTime=5;
        _this.moveTime=5;
        _this._useRAF=true;
        _this.rafProcNowTime=_this.now();
      },
      now :function _trc_Boot_now() {
        var _this=this;
        
        return performance.now();
      },
      resetDeadLine :function _trc_Boot_resetDeadLine() {
        var _this=this;
        
        _this.deadLine=_this.now()+1000/_this._fps;
        _this.frameSkipped=0;
      },
      waitFrame :function _trc_Boot_waitFrame() {
        var _this=this;
        var wt;
        
        wt = _this.deadLine-_this.now();
        
        if (wt<1) {
          if (wt<- 1000) {
            _this.resetDeadLine();
          }
          wt=1;
          
        }
        wt=_this.floor(wt);
        _this.checkTimer();
        _this.waitFor(Tonyu.timeout(wt));
        _this.deadLine+=1000/_this._fps;
      },
      fiber$waitFrame :function* _trc_Boot_f_waitFrame(_thread) {
        var _this=this;
        var wt;
        
        wt = _this.deadLine-_this.now();
        
        if (wt<1) {
          if (wt<- 1000) {
            _this.resetDeadLine();
          }
          wt=1;
          
        }
        wt=_this.floor(wt);
        (yield* _this.fiber$checkTimer(_thread));
        (yield* _this.fiber$waitFor(_thread, Tonyu.timeout(wt)));
        _this.deadLine+=1000/_this._fps;
        
      },
      getFrameRate :function _trc_Boot_getFrameRate() {
        var _this=this;
        
        return _this._fps;
      },
      setFrameRate :function _trc_Boot_setFrameRate(fps,maxFrameSkip) {
        var _this=this;
        
        _this._fps=fps;
        if (typeof  maxFrameSkip!="number") {
          maxFrameSkip=5;
        }
        if (maxFrameSkip<=0) {
          maxFrameSkip=1;
        }
        _this.maxFrameSkip=maxFrameSkip;
        _this.resetDeadLine();
      },
      __getter__useRAF :function _trc_Boot___getter__useRAF() {
        var _this=this;
        
        return _this._useRAF;
      },
      __setter__useRAF :function _trc_Boot___setter__useRAF(v) {
        var _this=this;
        
        if (v) {
          _this.rafProcNowTime=_this.now();
          
        } else {
          _this.resetDeadLine();
          
        }
        return _this._useRAF=v;
      },
      getMeasuredFps :function _trc_Boot_getMeasuredFps() {
        var _this=this;
        
        return _this.fps_fps;
      },
      getMeasuredRps :function _trc_Boot_getMeasuredRps() {
        var _this=this;
        
        return _this.fps_rps;
      },
      measureFps :function _trc_Boot_measureFps() {
        var _this=this;
        var nowTime;
        
        nowTime = _this.now();
        
        if (nowTime>=_this.lastMeasured+1000) {
          _this.fps_fps=_this.fps_fpsCnt;
          _this.fps_rps=_this.fps_rpsCnt;
          _this.fps_fpsCnt=0;
          _this.fps_rpsCnt=0;
          _this.lastMeasured=nowTime;
          
        }
      },
      requestDrawFrame :function _trc_Boot_requestDrawFrame() {
        var _this=this;
        
        if (! _this.isIdle) {
          return _this;
        }
        if (_this._drawFrameRequested) {
          return _this;
        }
        _this._drawFrameRequested=true;
        requestAnimationFrame((function anonymous_17143() {
          
          _this.drawFrame();
          _this._drawFrameRequested=false;
        }));
      },
      fiber$requestDrawFrame :function* _trc_Boot_f_requestDrawFrame(_thread) {
        var _this=this;
        
        if (! _this.isIdle) {
          return _this;
        }
        if (_this._drawFrameRequested) {
          return _this;
        }
        _this._drawFrameRequested=true;
        requestAnimationFrame((function anonymous_17143() {
          
          _this.drawFrame();
          _this._drawFrameRequested=false;
        }));
        
      },
      setEconomyMode :function _trc_Boot_setEconomyMode(options) {
        var _this=this;
        
        _this.economyMode=options;
      },
      fiber$setEconomyMode :function* _trc_Boot_f_setEconomyMode(_thread,options) {
        var _this=this;
        
        _this.economyMode=options;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"initSymbol":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setScheduler":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"timeStop":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"update":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initGlobals":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initPeripherals":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"doAutoReload":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"initLayers":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"debug":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loadPlugins":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loadImages":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loadSounds":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loadAssets":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getIDE":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getMainClass":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"createMainObject":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loadPage":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"restoreDefaultLayer":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"stop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"hide":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"schedule":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"progress":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"progressNoLog":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"mainLoop":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loopRAF":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"loopTimer":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"handlePause":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"drawFrame":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"moveFrame":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"afterDraw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"initFPSParams":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"now":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"resetDeadLine":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"waitFrame":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getFrameRate":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setFrameRate":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"__getter__useRAF":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"__setter__useRAF":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"getMeasuredFps":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"getMeasuredRps":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"measureFps":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"requestDrawFrame":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"setEconomyMode":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"tt":{},"window":{},"R":{},"cvj":{},"debugCnt":{},"newLimit":{},"autoReload":{},"pageStack":{},"mainClass":{},"loadedAll":{},"_useRAF":{},"_fps":{},"subTime":{},"rafProcNowTime":{},"procCnt":{},"maxFrameSkip":{},"doDraw":{},"deadLine":{},"frameSkipped":{},"economyMode":{},"isIdle":{},"paused":{},"drawTime":{},"fps_fpsCnt":{},"newLimitCount":{},"moveTime":{},"fps_rpsCnt":{},"minFrameSkip":{},"frameCnt":{},"lastMeasured":{},"fps_fps":{},"fps_rps":{},"_drawFrameRequested":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ConsolePanel',
  shortName: 'ConsolePanel',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Panel,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ConsolePanel_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_ConsolePanel_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_ConsolePanel_initialize(opt) {
        var _this=this;
        
        _this.printAry=[];
        _this.printStart=0;
        _this.printCnt=0;
        _this.screenCol=null;
        _this.defaultCol="white";
        __superClass.apply( _this, [opt]);
      },
      print :function _trc_ConsolePanel_print() {
        var _this=this;
        var mergedArg;
        var argCount;
        var printColor;
        var printSize;
        var splits;
        var printCount;
        
        mergedArg = "";
        
        for (argCount = 0;
         argCount<arguments.length ; argCount++) {
          {
            mergedArg=mergedArg+arguments[argCount]+" ";
          }
        }
        if (Tonyu.globals.$printColor==null&&Tonyu.globals.$Screen) {
          if (Tonyu.globals.$Screen._color!=_this.screenCol) {
            _this.screenCol=Tonyu.globals.$Screen._color;
            _this.defaultCol=new Tonyu.classes.kernel.Color(Tonyu.globals.$Screen._color).l<=0.5?"white":"black";
            
          }
          
        }
        printColor = Tonyu.globals.$printColor!=null?Tonyu.globals.$printColor:_this.defaultCol;
        
        printSize = ! Tonyu.globals.$printSize?20:Tonyu.globals.$printSize;
        
        splits = mergedArg.split("\n");
        
        for (printCount = 0;
         printCount<splits.length ; printCount++) {
          {
            _this.printAry.push({text: splits[printCount],color: printColor,size: printSize});
            _this.printCnt++;
          }
        }
      },
      draw :function _trc_ConsolePanel_draw(ctx) {
        var _this=this;
        var scrollY;
        var i;
        var p;
        var drawY;
        var a;
        
        scrollY = 0;
        
        for (i = _this.printStart;
         i<_this.printStart+_this.printCnt ; i++) {
          {
            p = _this.printAry[i];
            
            if (! p) {
              continue;
              
            }
            scrollY+=p.size;
            if (scrollY>Tonyu.globals.$screenHeight) {
              break;
              
            }
          }
        }
        if (scrollY>0) {
          Tonyu.globals.$consolePanel.scroll(0,scrollY);
          drawY = Tonyu.globals.$consolePrintY;
          
          a = 0;
          
          for (i = _this.printStart+_this.printCnt-1;
           i>=_this.printStart ; i--) {
            {
              p = _this.printAry[i];
              
              if (! p) {
                continue;
                
              }
              Tonyu.globals.$consolePanel.setFillStyle(p.color);
              Tonyu.globals.$consolePanel.fillText(p.text,0,drawY,p.size,"left","bottom");
              drawY-=p.size;
              a++;
              if (drawY<0) {
                _this.printCnt-=i;
                _this.printAry.splice(0,i);
                break;
                
                
              }
            }
          }
          _this.printStart=_this.printCnt;
          
        }
        __superClass.prototype.draw.apply( _this, [ctx]);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"print":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"printAry":{},"printStart":{},"printCnt":{},"screenCol":{},"defaultCol":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.ConsolePanel2',
  shortName: 'ConsolePanel2',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Panel,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_ConsolePanel2_main() {
        var _this=this;
        
        "field strict";
        
      },
      fiber$main :function* _trc_ConsolePanel2_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        
      },
      initialize :function _trc_ConsolePanel2_initialize(p) {
        var _this=this;
        
        p=p||{};
        p.size=p.size||p.hsize*2||16;
        p.hsize=_this.floor(p.size/2);
        p.width=p.width||Tonyu.globals.$screenWidth;
        p.height=p.height||Tonyu.globals.$screenHeight;
        p.row=p.row||_this.floor(p.height/p.size);
        p.col=p.col||_this.floor(p.width/p.hsize);
        p.width=p.col*p.hsize;
        p.height=p.row*p.size;
        p.fg=p.fg||"white";
        p.bg=p.bg||"rgba(0,0,0,0)";
        if (p.left) {
          p.x=p.left+p.width/2;
        }
        if (p.top) {
          p.y=p.top+p.height/2;
        }
        __superClass.apply( _this, [p]);
        _this.cx=0;
        _this.cy=0;
        _this.fillStyle="white";
        _this.newMat();
      },
      newMat :function _trc_ConsolePanel2_newMat() {
        var _this=this;
        
        _this.mat=new Tonyu.classes.kernel.Matrix;
        _this.mat.on("newCell",(function anonymous_661(e) {
          
          e.set({});
        }));
      },
      fiber$newMat :function* _trc_ConsolePanel2_f_newMat(_thread) {
        var _this=this;
        
        _this.mat=new Tonyu.classes.kernel.Matrix;
        _this.mat.on("newCell",(function anonymous_661(e) {
          
          e.set({});
        }));
        
      },
      locate :function _trc_ConsolePanel2_locate(x,y) {
        var _this=this;
        
        _this.cx=x;
        _this.cy=y;
        return _this;
      },
      fiber$locate :function* _trc_ConsolePanel2_f_locate(_thread,x,y) {
        var _this=this;
        
        _this.cx=x;
        _this.cy=y;
        return _this;
        
      },
      color :function _trc_ConsolePanel2_color(fg,bg) {
        var _this=this;
        
        _this.fg=fg||_this.fg;
        _this.bg=bg||_this.bg;
        return _this;
      },
      cprint :function _trc_ConsolePanel2_cprint(s) {
        var _this=this;
        var r;
        var i;
        var ch;
        var cs;
        var m;
        
        s=s+"";
        r = /^(#[0-9a-f][0-9a-f][0-9a-f](?:[0-9a-f][0-9a-f][0-9a-f])?)(#[0-9a-f][0-9a-f][0-9a-f](?:[0-9a-f][0-9a-f][0-9a-f])?)?/i;
        
        for (i = 0;
         i<s.length ; i++) {
          {
            ch = s.charCodeAt(i);
            
            if (ch===35) {
              cs = s.substring(i);
              
              m = r.exec(cs);
              
              if (m) {
                _this.color(m[1],m[2]);
                i+=m[0].length-1;
                
              } else {
                _this.putchar(ch);
                
              }
              
            } else {
              _this.putchar(ch);
              
            }
          }
        }
        return _this;
      },
      fiber$cprint :function* _trc_ConsolePanel2_f_cprint(_thread,s) {
        var _this=this;
        var r;
        var i;
        var ch;
        var cs;
        var m;
        
        s=s+"";
        r = /^(#[0-9a-f][0-9a-f][0-9a-f](?:[0-9a-f][0-9a-f][0-9a-f])?)(#[0-9a-f][0-9a-f][0-9a-f](?:[0-9a-f][0-9a-f][0-9a-f])?)?/i;
        
        for (i = 0;
         i<s.length ; i++) {
          {
            ch = s.charCodeAt(i);
            
            if (ch===35) {
              cs = s.substring(i);
              
              m = r.exec(cs);
              
              if (m) {
                _this.color(m[1],m[2]);
                i+=m[0].length-1;
                
              } else {
                (yield* _this.fiber$putchar(_thread, ch));
                
              }
              
            } else {
              (yield* _this.fiber$putchar(_thread, ch));
              
            }
          }
        }
        return _this;
        
      },
      print :function _trc_ConsolePanel2_print(...args) {
        var _this=this;
        
        _this.puts(args.join(" ")+"\n");
      },
      puts :function _trc_ConsolePanel2_puts(s) {
        var _this=this;
        var i;
        var ch;
        
        s=s+"";
        for (i = 0;
         i<s.length ; i++) {
          {
            ch = s.charCodeAt(i);
            
            _this.putchar(ch);
          }
        }
        return _this;
      },
      fiber$puts :function* _trc_ConsolePanel2_f_puts(_thread,s) {
        var _this=this;
        var i;
        var ch;
        
        s=s+"";
        for (i = 0;
         i<s.length ; i++) {
          {
            ch = s.charCodeAt(i);
            
            (yield* _this.fiber$putchar(_thread, ch));
          }
        }
        return _this;
        
      },
      putchar :function _trc_ConsolePanel2_putchar(ch) {
        var _this=this;
        
        if (ch>=256&&_this.cx==_this.col-1) {
          _this.putchar(" ");
          
        }
        if (ch!==10) {
          _this.poke(_this.cx,_this.cy,ch);
          _this.cx+=(ch>=256?2:1);
          
        }
        if (_this.cx>=_this.col||ch===10) {
          _this.cx=0;
          _this.cy++;
          if (_this.cy>=_this.row) {
            _this.scroll();
            _this.cy=_this.row-1;
            
          }
          
        }
      },
      fiber$putchar :function* _trc_ConsolePanel2_f_putchar(_thread,ch) {
        var _this=this;
        
        if (ch>=256&&_this.cx==_this.col-1) {
          (yield* _this.fiber$putchar(_thread, " "));
          
        }
        if (ch!==10) {
          (yield* _this.fiber$poke(_thread, _this.cx, _this.cy, ch));
          _this.cx+=(ch>=256?2:1);
          
        }
        if (_this.cx>=_this.col||ch===10) {
          _this.cx=0;
          _this.cy++;
          if (_this.cy>=_this.row) {
            (yield* _this.fiber$scroll(_thread));
            _this.cy=_this.row-1;
            
          }
          
        }
        
      },
      cls :function _trc_ConsolePanel2_cls() {
        var _this=this;
        
        _this.newMat();
        _this.clearRect(0,0,_this.width,_this.height);
      },
      fiber$cls :function* _trc_ConsolePanel2_f_cls(_thread) {
        var _this=this;
        
        (yield* _this.fiber$newMat(_thread));
        (yield* _this.fiber$clearRect(_thread, 0, 0, _this.width, _this.height));
        
      },
      poke :function _trc_ConsolePanel2_poke(cx,cy,ch,fg,bg) {
        var _this=this;
        var ctx;
        var w;
        var d;
        
        if (typeof  ch==="object") {
          fg=ch.fg;
          bg=ch.bg;
          ch=ch.text;
          
        }
        if (typeof  ch==="string") {
          ch=ch.charCodeAt(0);
          
        }
        fg=fg||_this.fg;
        bg=bg||_this.bg;
        ctx = _this.context;
        
        w = (ch>=256?_this.size:_this.hsize);
        
        ctx.save();
        ctx.textBaseline="top";
        ctx.font=_this.size+"px Monospace";
        ctx.clearRect(cx*_this.hsize,cy*_this.size,w,_this.size);
        ctx.fillStyle=bg;
        ctx.fillRect(cx*_this.hsize,cy*_this.size,w,_this.size);
        ctx.fillStyle=fg;
        ctx.fillText(String.fromCharCode(ch),cx*_this.hsize,cy*_this.size);
        d = _this.mat.get(cx,cy);
        
        d.text=ch;
        d.fg=fg;
        d.bg=bg;
        if (ch>=256) {
          _this.mat.get(cx+1,cy).text=- 1;
        }
        ctx.restore();
      },
      fiber$poke :function* _trc_ConsolePanel2_f_poke(_thread,cx,cy,ch,fg,bg) {
        var _this=this;
        var ctx;
        var w;
        var d;
        
        if (typeof  ch==="object") {
          fg=ch.fg;
          bg=ch.bg;
          ch=ch.text;
          
        }
        if (typeof  ch==="string") {
          ch=ch.charCodeAt(0);
          
        }
        fg=fg||_this.fg;
        bg=bg||_this.bg;
        ctx = _this.context;
        
        w = (ch>=256?_this.size:_this.hsize);
        
        ctx.save();
        ctx.textBaseline="top";
        ctx.font=_this.size+"px Monospace";
        ctx.clearRect(cx*_this.hsize,cy*_this.size,w,_this.size);
        ctx.fillStyle=bg;
        ctx.fillRect(cx*_this.hsize,cy*_this.size,w,_this.size);
        ctx.fillStyle=fg;
        ctx.fillText(String.fromCharCode(ch),cx*_this.hsize,cy*_this.size);
        d = _this.mat.get(cx,cy);
        
        d.text=ch;
        d.fg=fg;
        d.bg=bg;
        if (ch>=256) {
          _this.mat.get(cx+1,cy).text=- 1;
        }
        ctx.restore();
        
      },
      peek :function _trc_ConsolePanel2_peek(cx,cy) {
        var _this=this;
        
        return _this.mat.get(cx,cy).text;
      },
      fiber$peek :function* _trc_ConsolePanel2_f_peek(_thread,cx,cy) {
        var _this=this;
        
        return _this.mat.get(cx,cy).text;
        
      },
      peekAttr :function _trc_ConsolePanel2_peekAttr(cx,cy) {
        var _this=this;
        
        return _this.mat.get(cx,cy);
      },
      fiber$peekAttr :function* _trc_ConsolePanel2_f_peekAttr(_thread,cx,cy) {
        var _this=this;
        
        return _this.mat.get(cx,cy);
        
      },
      localToGrid :function _trc_ConsolePanel2_localToGrid(x,y) {
        var _this=this;
        
        if (typeof  x==="object") {
          y=x.y;
          x=x.x;
          
        }
        if (typeof  x!=="number") {
          throw new Error(['x is ',x].join(''));
          
        }
        if (typeof  y!=="number") {
          throw new Error(['y is ',y].join(''));
          
        }
        return {x: _this.floor(x/_this.hsize),y: _this.floor(y/_this.size)};
      },
      fiber$localToGrid :function* _trc_ConsolePanel2_f_localToGrid(_thread,x,y) {
        var _this=this;
        
        if (typeof  x==="object") {
          y=x.y;
          x=x.x;
          
        }
        if (typeof  x!=="number") {
          throw new Error(['x is ',x].join(''));
          
        }
        if (typeof  y!=="number") {
          throw new Error(['y is ',y].join(''));
          
        }
        return {x: _this.floor(x/_this.hsize),y: _this.floor(y/_this.size)};
        
      },
      scroll :function _trc_ConsolePanel2_scroll(dx,dy) {
        var _this=this;
        var range;
        var nm;
        var x;
        var y;
        var c;
        var dsx;
        var dsy;
        var cp;
        
        if (dx==null) {
          dx=0;
        }
        if (dy==null) {
          dy=- 1;
        }
        range = {left: 0,top: 0,row: _this.row,col: _this.col};
        
        nm = new Tonyu.classes.kernel.Matrix;
        
        nm.on("newCell",(function anonymous_3538(e) {
          
          e.set({});
        }));
        for ([x, y, c] of Tonyu.iterator2(_this.mat,3)) {
          dsx = x+dx;
          
          dsy = y+dy;
          
          if (dsy>=0&&dsy<_this.row&&dsx>=0&&dsx<_this.col) {
            nm.set(dsx,dsy,c);
          }
          
        }
        _this.mat=nm;
        _this.context.save();
        _this.context.globalCompositeOperation="copy";
        cp = {src: {x: range.left*_this.hsize,y: range.top*_this.size},dst: {x: range.left*_this.hsize,y: range.top*_this.size},sz: {w: range.col*_this.hsize,h: range.row*_this.size}};
        
        if (dy<0) {
          cp.src.y-=dy*_this.size;
        }
        if (dy>0) {
          cp.dst.y+=dy*_this.size;
        }
        if (dx<0) {
          cp.src.x-=dx*_this.hsize;
        }
        if (dx>0) {
          cp.dst.x+=dx*_this.hsize;
        }
        cp.sz.w-=_this.abs(dx*_this.hsize);
        cp.sz.h-=_this.abs(dy*_this.size);
        _this.context.drawImage(_this.image,cp.src.x,cp.src.y,cp.sz.w,cp.sz.h,cp.dst.x,cp.dst.y,cp.sz.w,cp.sz.h);
        _this.context.restore();
      },
      fiber$scroll :function* _trc_ConsolePanel2_f_scroll(_thread,dx,dy) {
        var _this=this;
        var range;
        var nm;
        var x;
        var y;
        var c;
        var dsx;
        var dsy;
        var cp;
        
        if (dx==null) {
          dx=0;
        }
        if (dy==null) {
          dy=- 1;
        }
        range = {left: 0,top: 0,row: _this.row,col: _this.col};
        
        nm = new Tonyu.classes.kernel.Matrix;
        
        nm.on("newCell",(function anonymous_3538(e) {
          
          e.set({});
        }));
        for ([x, y, c] of Tonyu.iterator2(_this.mat,3)) {
          dsx = x+dx;
          
          dsy = y+dy;
          
          if (dsy>=0&&dsy<_this.row&&dsx>=0&&dsx<_this.col) {
            nm.set(dsx,dsy,c);
          }
          
        }
        _this.mat=nm;
        _this.context.save();
        _this.context.globalCompositeOperation="copy";
        cp = {src: {x: range.left*_this.hsize,y: range.top*_this.size},dst: {x: range.left*_this.hsize,y: range.top*_this.size},sz: {w: range.col*_this.hsize,h: range.row*_this.size}};
        
        if (dy<0) {
          cp.src.y-=dy*_this.size;
        }
        if (dy>0) {
          cp.dst.y+=dy*_this.size;
        }
        if (dx<0) {
          cp.src.x-=dx*_this.hsize;
        }
        if (dx>0) {
          cp.dst.x+=dx*_this.hsize;
        }
        cp.sz.w-=_this.abs(dx*_this.hsize);
        cp.sz.h-=_this.abs(dy*_this.size);
        _this.context.drawImage(_this.image,cp.src.x,cp.src.y,cp.sz.w,cp.sz.h,cp.dst.x,cp.dst.y,cp.sz.w,cp.sz.h);
        _this.context.restore();
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"newMat":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"locate":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"color":{"nowait":true,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"cprint":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"print":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"puts":{"nowait":false,"isMain":false,"vtype":{"params":["String"],"returnValue":null}},"putchar":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"cls":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"poke":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}},"peek":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"peekAttr":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"localToGrid":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}},"scroll":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"size":{},"hsize":{},"row":{},"col":{},"cx":{},"cy":{},"mat":{},"font":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.FadeEffect',
  shortName: 'FadeEffect',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.Panel,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_FadeEffect_main() {
        var _this=this;
        
        "field strict";
        
        _this.fillStyle = _this.fillStyle||"black";
        
        
        
        _this.duration = _this.duration||30;
        
        
        _this.zOrder=(Tonyu.globals.$consolePanel?Tonyu.globals.$consolePanel.zOrder+1:- 100000);
        _this.fillRect(0,0,Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
        switch (_this.type) {
        case "in":
          _this.morph(255,0);
          break;
          
        case "out":
          _this.morph(0,255);
          break;
          
        case "outin":
          _this.morph(0,255);
          _this.sendEvent("out");
          _this.loadPage(_this.page,_this.params||{},{pass: [_this].concat(_this.pass||[])});
          _this.morph(255,0);
          break;
          
        }
        _this.sendEvent("complete");
        if (_this.page&&_this.type!=="outin") {
          _this.loadPage(_this.page,_this.params||{});
          
        }
        if (_this.type!=="out") {
          _this.die();
        }
      },
      fiber$main :function* _trc_FadeEffect_f_main(_thread) {
        var _this=this;
        
        "field strict";
        
        _this.fillStyle = _this.fillStyle||"black";
        
        
        
        _this.duration = _this.duration||30;
        
        
        _this.zOrder=(Tonyu.globals.$consolePanel?Tonyu.globals.$consolePanel.zOrder+1:- 100000);
        _this.fillRect(0,0,Tonyu.globals.$screenWidth,Tonyu.globals.$screenHeight);
        switch (_this.type) {
        case "in":
          (yield* _this.fiber$morph(_thread, 255, 0));
          break;
          
        case "out":
          (yield* _this.fiber$morph(_thread, 0, 255));
          break;
          
        case "outin":
          (yield* _this.fiber$morph(_thread, 0, 255));
          _this.sendEvent("out");
          (yield* _this.fiber$loadPage(_thread, _this.page, _this.params||{}, {pass: [_this].concat(_this.pass||[])}));
          (yield* _this.fiber$morph(_thread, 255, 0));
          break;
          
        }
        _this.sendEvent("complete");
        if (_this.page&&_this.type!=="outin") {
          (yield* _this.fiber$loadPage(_thread, _this.page, _this.params||{}));
          
        }
        if (_this.type!=="out") {
          _this.die();
        }
        
      },
      __getter__defaultLayer :function _trc_FadeEffect___getter__defaultLayer() {
        var _this=this;
        
        return Tonyu.globals.$frontLayer;
      },
      morph :function _trc_FadeEffect_morph(from,to) {
        var _this=this;
        var i;
        var progress;
        
        for (i = 0;
         i<_this.duration ; i++) {
          {
            progress = i/(_this.duration-1);
            
            _this.alpha=to*progress+from*(1-progress);
            _this.update();
          }
        }
        _this.alpha=to;
      },
      fiber$morph :function* _trc_FadeEffect_f_morph(_thread,from,to) {
        var _this=this;
        var i;
        var progress;
        
        for (i = 0;
         i<_this.duration ; i++) {
          {
            progress = i/(_this.duration-1);
            
            _this.alpha=to*progress+from*(1-progress);
            (yield* _this.fiber$update(_thread));
          }
        }
        _this.alpha=to;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"__getter__defaultLayer":{"nowait":true,"isMain":false,"vtype":{"params":[],"returnValue":null}},"morph":{"nowait":false,"isMain":false,"vtype":{"params":[null,null],"returnValue":null}}},"fields":{"type":{"vtype":"String"},"fillStyle":{"vtype":"String"},"page":{},"params":{},"duration":{"vtype":"Number"},"pass":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TD_CM',
  shortName: 'TD_CM',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.SecretChar,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_TD_CM_main() {
        var _this=this;
        
        
        
        
        
        
      },
      fiber$main :function* _trc_TD_CM_f_main(_thread) {
        var _this=this;
        
        
        
        
        
        
        
      },
      initialize :function _trc_TD_CM_initialize(opt) {
        var _this=this;
        
        _this.cons();
        __superClass.apply( _this, [opt]);
      },
      cons :function _trc_TD_CM_cons() {
        var _this=this;
        
        _this.x=0;
        _this.y=0;
        _this.z=0;
        _this.xz=0;
        _this.yz=0;
        _this.xy=0;
        _this.gk=0;
        _this.k_max=10;
        _this.GL=0;
        _this.GU=0;
        _this.GR=Tonyu.globals.$screenWidth;
        _this.GD=Tonyu.globals.$screenHeight;
        _this.TD_visible=1;
      },
      fiber$cons :function* _trc_TD_CM_f_cons(_thread) {
        var _this=this;
        
        _this.x=0;
        _this.y=0;
        _this.z=0;
        _this.xz=0;
        _this.yz=0;
        _this.xy=0;
        _this.gk=0;
        _this.k_max=10;
        _this.GL=0;
        _this.GU=0;
        _this.GR=Tonyu.globals.$screenWidth;
        _this.GD=Tonyu.globals.$screenHeight;
        _this.TD_visible=1;
        
      },
      onAppear :function _trc_TD_CM_onAppear() {
        var _this=this;
        
        Tonyu.globals.$TD_M_ACM.push(_this);
      },
      fiber$onAppear :function* _trc_TD_CM_f_onAppear(_thread) {
        var _this=this;
        
        Tonyu.globals.$TD_M_ACM.push(_this);
        
      },
      onDie :function _trc_TD_CM_onDie() {
        var _this=this;
        
        if (Tonyu.globals.$TD_M_ACM.indexOf(_this)>=0) {
          Tonyu.globals.$TD_M_ACM.splice(Tonyu.globals.$TD_M_ACM.indexOf(_this),1);
        }
      },
      fiber$onDie :function* _trc_TD_CM_f_onDie(_thread) {
        var _this=this;
        
        if (Tonyu.globals.$TD_M_ACM.indexOf(_this)>=0) {
          Tonyu.globals.$TD_M_ACM.splice(Tonyu.globals.$TD_M_ACM.indexOf(_this),1);
        }
        
      },
      cameraSet :function _trc_TD_CM_cameraSet(zx,zy,zz,zxz,zyz,zxy,zgk,zk_max,zGL,zGU,zGR,zGD) {
        var _this=this;
        
        if (zx!=null) {
          _this.x=zx;
        }
        if (zy!=null) {
          _this.y=zy;
        }
        if (zz!=null) {
          _this.z=zz;
        }
        if (zxz!=null) {
          _this.xz=zxz;
        }
        if (zyz!=null) {
          _this.yz=zyz;
        }
        if (zxy!=null) {
          _this.xy=zxy;
        }
        if (zgk!=null) {
          _this.gk=zgk;
        }
        if (zk_max!=null) {
          _this.k_max=zk_max;
        }
        if (zGL!=null) {
          _this.GL=zGL;
        }
        if (zGU!=null) {
          _this.GU=zGU;
        }
        if (zGR!=null) {
          _this.GR=zGR;
        }
        if (zGD!=null) {
          _this.GD=zGD;
        }
      },
      fiber$cameraSet :function* _trc_TD_CM_f_cameraSet(_thread,zx,zy,zz,zxz,zyz,zxy,zgk,zk_max,zGL,zGU,zGR,zGD) {
        var _this=this;
        
        if (zx!=null) {
          _this.x=zx;
        }
        if (zy!=null) {
          _this.y=zy;
        }
        if (zz!=null) {
          _this.z=zz;
        }
        if (zxz!=null) {
          _this.xz=zxz;
        }
        if (zyz!=null) {
          _this.yz=zyz;
        }
        if (zxy!=null) {
          _this.xy=zxy;
        }
        if (zgk!=null) {
          _this.gk=zgk;
        }
        if (zk_max!=null) {
          _this.k_max=zk_max;
        }
        if (zGL!=null) {
          _this.GL=zGL;
        }
        if (zGU!=null) {
          _this.GU=zGU;
        }
        if (zGR!=null) {
          _this.GR=zGR;
        }
        if (zGD!=null) {
          _this.GD=zGD;
        }
        
      },
      cameraMain :function _trc_TD_CM_cameraMain() {
        var _this=this;
        
        Tonyu.globals.$TD_Z_x=_this.x;
        Tonyu.globals.$TD_Z_y=_this.y;
        Tonyu.globals.$TD_Z_z=_this.z;
        Tonyu.globals.$TD_Z_xz=_this.xz;
        Tonyu.globals.$TD_Z_yz=_this.yz;
        Tonyu.globals.$TD_Z_xy=_this.xy;
        Tonyu.globals.$TD_Z_gk=_this.gk;
        Tonyu.globals.$TD_Z_k_max=_this.k_max;
        Tonyu.globals.$TD_G_GL=_this.GL;
        Tonyu.globals.$TD_G_GU=_this.GU;
        Tonyu.globals.$TD_G_GR=_this.GR;
        Tonyu.globals.$TD_G_GD=_this.GD;
      },
      fiber$cameraMain :function* _trc_TD_CM_f_cameraMain(_thread) {
        var _this=this;
        
        Tonyu.globals.$TD_Z_x=_this.x;
        Tonyu.globals.$TD_Z_y=_this.y;
        Tonyu.globals.$TD_Z_z=_this.z;
        Tonyu.globals.$TD_Z_xz=_this.xz;
        Tonyu.globals.$TD_Z_yz=_this.yz;
        Tonyu.globals.$TD_Z_xy=_this.xy;
        Tonyu.globals.$TD_Z_gk=_this.gk;
        Tonyu.globals.$TD_Z_k_max=_this.k_max;
        Tonyu.globals.$TD_G_GL=_this.GL;
        Tonyu.globals.$TD_G_GU=_this.GU;
        Tonyu.globals.$TD_G_GR=_this.GR;
        Tonyu.globals.$TD_G_GD=_this.GD;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"cons":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"onAppear":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"onDie":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"cameraSet":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"cameraMain":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{"x":{},"y":{},"z":{},"xz":{},"yz":{},"xy":{},"gk":{},"k_max":{},"GL":{},"GU":{},"GR":{},"GD":{},"TD_visible":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TD_DR_1',
  shortName: 'TD_DR_1',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.PlainChar,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_TD_DR_1_main() {
        var _this=this;
        
        
        
        
        
        
        
      },
      fiber$main :function* _trc_TD_DR_1_f_main(_thread) {
        var _this=this;
        
        
        
        
        
        
        
        
      },
      backFaceCulling :function _trc_TD_DR_1_backFaceCulling(z_x,z_y,z_z) {
        var _this=this;
        
        if (! _this.TD_visible) {
          return _this;
        }
        _this.s=0;
        if (_this.n!=3&&_this.n!=4) {
          return _this;
        }
        _this.s=- 1;
        _this.ep.x=(_this.p1.sy-_this.p2.sy)*(_this.p2.sz-_this.p3.sz)-(_this.p1.sz-_this.p2.sz)*(_this.p2.sy-_this.p3.sy);
        _this.ep.y=(_this.p1.sz-_this.p2.sz)*(_this.p2.sx-_this.p3.sx)-(_this.p1.sx-_this.p2.sx)*(_this.p2.sz-_this.p3.sz);
        _this.ep.z=(_this.p1.sx-_this.p2.sx)*(_this.p2.sy-_this.p3.sy)-(_this.p1.sy-_this.p2.sy)*(_this.p2.sx-_this.p3.sx);
        if (_this.ep.x*(_this.p1.sx-z_x*0)+_this.ep.y*(_this.p1.sy-z_y*0)+_this.ep.z*(_this.p1.sz-z_z*0)>0) {
          _this.s=0;
          
        }
      },
      fiber$backFaceCulling :function* _trc_TD_DR_1_f_backFaceCulling(_thread,z_x,z_y,z_z) {
        var _this=this;
        
        if (! _this.TD_visible) {
          return _this;
        }
        _this.s=0;
        if (_this.n!=3&&_this.n!=4) {
          return _this;
        }
        _this.s=- 1;
        _this.ep.x=(_this.p1.sy-_this.p2.sy)*(_this.p2.sz-_this.p3.sz)-(_this.p1.sz-_this.p2.sz)*(_this.p2.sy-_this.p3.sy);
        _this.ep.y=(_this.p1.sz-_this.p2.sz)*(_this.p2.sx-_this.p3.sx)-(_this.p1.sx-_this.p2.sx)*(_this.p2.sz-_this.p3.sz);
        _this.ep.z=(_this.p1.sx-_this.p2.sx)*(_this.p2.sy-_this.p3.sy)-(_this.p1.sy-_this.p2.sy)*(_this.p2.sx-_this.p3.sx);
        if (_this.ep.x*(_this.p1.sx-z_x*0)+_this.ep.y*(_this.p1.sy-z_y*0)+_this.ep.z*(_this.p1.sz-z_z*0)>0) {
          _this.s=0;
          
        }
        
      },
      merikomiSyusei :function _trc_TD_DR_1_merikomiSyusei(kk,zk,hw,hh) {
        var _this=this;
        
        if (! _this.TD_visible) {
          return _this;
        }
        if (_this.s==- 1) {
          return _this;
        }
        if (_this.n==1) {
          _this.s=(_this.p1.sz>=0);
          if (_this.s==0) {
            return _this;
          }
          _this.zo=_this.sqrt(_this.p1.sx*_this.p1.sx+_this.p1.sy*_this.p1.sy+_this.p1.sz*_this.p1.sz);
          
        } else {
          if (_this.n==2) {
            _this.s=0;
            _this.np=(_this.p1.sz<0)+(_this.p2.sz<0);
            if (_this.np==2) {
              return _this;
            }
            if (_this.np==1) {
              _this.s=2;
              if (_this.p1.sz<0) {
                _this.merikomiSyusei_L(_this.p1,_this.p2,kk,zk,hw,hh);
              } else {
                if (_this.p2.sz<0) {
                  _this.merikomiSyusei_L(_this.p2,_this.p1,kk,zk,hw,hh);
                }
              }
              
            } else {
              _this.s=1;
              
            }
            if (_this.zt==0||_this.zt==2) {
              if (_this.np==0) {
                _this.zo=_this.sqrt(_this.p1.sx*_this.p1.sx+_this.p1.sy*_this.p1.sy+_this.p1.sz*_this.p1.sz);
                _this.zo2=_this.sqrt(_this.p2.sx*_this.p2.sx+_this.p2.sy*_this.p2.sy+_this.p2.sz*_this.p2.sz);
                if (! _this.zt) {
                  if (_this.zo<_this.zo2) {
                    _this.zo=_this.zo2;
                  }
                  
                } else {
                  if (_this.zt==2) {
                    if (_this.zo>_this.zo2) {
                      _this.zo=_this.zo2;
                    }
                    
                  }
                }
                
              } else {
                if (! _this.zt) {
                  _this.zo=_this.sqrt(_this.p2.sx*_this.p2.sx+_this.p2.sy*_this.p2.sy+_this.p2.sz*_this.p2.sz);
                  
                } else {
                  if (_this.zt==2) {
                    _this.zo=_this.sqrt(_this.p1.sx*_this.p1.sx+_this.p1.sy*_this.p1.sy+_this.p1.sz*_this.p1.sz);
                    
                  }
                }
                
              }
              
            } else {
              if (_this.zt==null||_this.zt==1) {
                _this.zosx=(_this.p1.sx+_this.p2.sx)/2;
                _this.zosy=(_this.p1.sy+_this.p2.sy)/2;
                _this.zosz=(_this.p1.sz+_this.p2.sz)/2;
                if (_this.zosz<0) {
                  _this.zosz=0;
                }
                _this.zo=_this.sqrt(_this.zosx*_this.zosx+_this.zosy*_this.zosy+_this.zosz*_this.zosz);
                
              }
            }
            
          } else {
            if (_this.n==3) {
              _this.pr=0;
              _this.s=0;
              _this.np=(_this.p1.sz<0)+(_this.p2.sz<0)+(_this.p3.sz<0);
              if (_this.np==3) {
                return _this;
              }
              if (_this.np==1) {
                _this.pr=4;
                _this.s=2;
                if (_this.p1.sz<0) {
                  _this.merikomiSyusei_T(_this.np,_this.p2,_this.p1,_this.p3,kk,zk,hw,hh);
                } else {
                  if (_this.p2.sz<0) {
                    _this.merikomiSyusei_T(_this.np,_this.p3,_this.p2,_this.p1,kk,zk,hw,hh);
                  } else {
                    if (_this.p3.sz<0) {
                      _this.merikomiSyusei_T(_this.np,_this.p1,_this.p3,_this.p2,kk,zk,hw,hh);
                    }
                  }
                }
                
              } else {
                if (_this.np==2) {
                  _this.pr=3;
                  _this.s=2;
                  if (_this.p1.sz>=0) {
                    _this.merikomiSyusei_T(_this.np,_this.p2,_this.p1,_this.p3,kk,zk,hw,hh);
                  } else {
                    if (_this.p2.sz>=0) {
                      _this.merikomiSyusei_T(_this.np,_this.p3,_this.p2,_this.p1,kk,zk,hw,hh);
                    } else {
                      if (_this.p3.sz>=0) {
                        _this.merikomiSyusei_T(_this.np,_this.p1,_this.p3,_this.p2,kk,zk,hw,hh);
                      }
                    }
                  }
                  
                } else {
                  if (_this.np==0) {
                    _this.pr=3;
                    _this.s=1;
                    
                  }
                }
              }
              if (_this.zt==0||_this.zt==2) {
                if (_this.np==0) {
                  _this.zo=_this.sqrt(_this.p1.sx*_this.p1.sx+_this.p1.sy*_this.p1.sy+_this.p1.sz*_this.p1.sz);
                  _this.zo2=_this.sqrt(_this.p2.sx*_this.p2.sx+_this.p2.sy*_this.p2.sy+_this.p2.sz*_this.p2.sz);
                  _this.zo3=_this.sqrt(_this.p3.sx*_this.p3.sx+_this.p3.sy*_this.p3.sy+_this.p3.sz*_this.p3.sz);
                  if (! _this.zt) {
                    if (_this.zo<_this.zo2) {
                      _this.zo=_this.zo2;
                    }
                    if (_this.zo<_this.zo3) {
                      _this.zo=_this.zo3;
                    }
                    
                  } else {
                    if (_this.zt==2) {
                      if (_this.zo>_this.zo2) {
                        _this.zo=_this.zo2;
                      }
                      if (_this.zo>_this.zo3) {
                        _this.zo=_this.zo3;
                      }
                      
                    }
                  }
                  
                } else {
                  if (! _this.zt) {
                    _this.zo=_this.sqrt(_this.dp2.sx*_this.dp2.sx+_this.dp2.sy*_this.dp2.sy+_this.dp2.sz*_this.dp2.sz);
                    _this.zo2=_this.sqrt(_this.dp3.sx*_this.dp3.sx+_this.dp3.sy*_this.dp3.sy+_this.dp3.sz*_this.dp3.sz);
                    if (_this.zo<_this.zo2) {
                      _this.zo=_this.zo2;
                    }
                    
                  } else {
                    if (_this.zt==2) {
                      _this.zo=_this.sqrt(_this.dp1.sx*_this.dp1.sx+_this.dp1.sy*_this.dp1.sy+_this.dp1.sz*_this.dp1.sz);
                      _this.zo2=_this.sqrt(_this.dp3.sx*_this.dp3.sx+_this.dp3.sy*_this.dp3.sy+_this.dp3.sz*_this.dp3.sz);
                      _this.zo3=_this.sqrt(_this.dp4.sx*_this.dp4.sx+_this.dp4.sy*_this.dp4.sy+_this.dp4.sz*_this.dp4.sz);
                      if (_this.zo>_this.zo2) {
                        _this.zo=_this.zo2;
                      }
                      if (_this.zo>_this.zo3) {
                        _this.zo=_this.zo3;
                      }
                      
                    }
                  }
                  
                }
                
              } else {
                if (_this.zt==null||_this.zt==1) {
                  _this.zosx=(_this.p1.sx+_this.p2.sx+_this.p3.sx)/3;
                  _this.zosy=(_this.p1.sy+_this.p2.sy+_this.p3.sy)/3;
                  _this.zosz=(_this.p1.sz+_this.p2.sz+_this.p3.sz)/3;
                  if (_this.zosz<0) {
                    _this.zosz=0;
                  }
                  _this.zo=_this.sqrt(_this.zosx*_this.zosx+_this.zosy*_this.zosy+_this.zosz*_this.zosz);
                  
                }
              }
              
            } else {
              if (_this.n==4) {
                _this.pr=0;
                _this.s=0;
                _this.np=(_this.p1.sz<0)+(_this.p2.sz<0)+(_this.p3.sz<0)+(_this.p4.sz<0);
                if (_this.np==4) {
                  return _this;
                }
                if (_this.np==1) {
                  _this.pr=5;
                  _this.s=2;
                  if (_this.p1.sz<0) {
                    _this.merikomiSyusei_S(_this.np,_this.p2,_this.p1,_this.p4,_this.p3,kk,zk,hw,hh);
                  } else {
                    if (_this.p2.sz<0) {
                      _this.merikomiSyusei_S(_this.np,_this.p3,_this.p2,_this.p1,_this.p4,kk,zk,hw,hh);
                    } else {
                      if (_this.p3.sz<0) {
                        _this.merikomiSyusei_S(_this.np,_this.p4,_this.p3,_this.p2,_this.p1,kk,zk,hw,hh);
                      } else {
                        if (_this.p4.sz<0) {
                          _this.merikomiSyusei_S(_this.np,_this.p1,_this.p4,_this.p3,_this.p2,kk,zk,hw,hh);
                        }
                      }
                    }
                  }
                  
                } else {
                  if (_this.np==2) {
                    _this.pr=4;
                    _this.s=2;
                    if (_this.p1.sz<0&&_this.p4.sz<0) {
                      _this.merikomiSyusei_S(_this.np,_this.p2,_this.p1,_this.p4,_this.p3,kk,zk,hw,hh);
                    } else {
                      if (_this.p2.sz<0&&_this.p1.sz<0) {
                        _this.merikomiSyusei_S(_this.np,_this.p3,_this.p2,_this.p1,_this.p4,kk,zk,hw,hh);
                      } else {
                        if (_this.p3.sz<0&&_this.p2.sz<0) {
                          _this.merikomiSyusei_S(_this.np,_this.p4,_this.p3,_this.p2,_this.p1,kk,zk,hw,hh);
                        } else {
                          if (_this.p4.sz<0&&_this.p3.sz<0) {
                            _this.merikomiSyusei_S(_this.np,_this.p1,_this.p4,_this.p3,_this.p2,kk,zk,hw,hh);
                          }
                        }
                      }
                    }
                    
                  } else {
                    if (_this.np==3) {
                      _this.pr=3;
                      _this.s=2;
                      if (_this.p1.sz>=0) {
                        _this.merikomiSyusei_S(_this.np,_this.p4,_this.p1,_this.p2,null,kk,zk,hw,hh);
                      } else {
                        if (_this.p2.sz>=0) {
                          _this.merikomiSyusei_S(_this.np,_this.p1,_this.p2,_this.p3,null,kk,zk,hw,hh);
                        } else {
                          if (_this.p3.sz>=0) {
                            _this.merikomiSyusei_S(_this.np,_this.p2,_this.p3,_this.p4,null,kk,zk,hw,hh);
                          } else {
                            if (_this.p4.sz>=0) {
                              _this.merikomiSyusei_S(_this.np,_this.p3,_this.p4,_this.p1,null,kk,zk,hw,hh);
                            }
                          }
                        }
                      }
                      
                    } else {
                      if (_this.np==0) {
                        _this.pr=4;
                        _this.s=1;
                        
                      }
                    }
                  }
                }
                if (_this.zt==0||_this.zt==2) {
                  if (_this.np==0) {
                    _this.zo=_this.sqrt(_this.p1.sx*_this.p1.sx+_this.p1.sy*_this.p1.sy+_this.p1.sz*_this.p1.sz);
                    _this.zo2=_this.sqrt(_this.p2.sx*_this.p2.sx+_this.p2.sy*_this.p2.sy+_this.p2.sz*_this.p2.sz);
                    _this.zo3=_this.sqrt(_this.p3.sx*_this.p3.sx+_this.p3.sy*_this.p3.sy+_this.p3.sz*_this.p3.sz);
                    _this.zo4=_this.sqrt(_this.p4.sx*_this.p4.sx+_this.p4.sy*_this.p4.sy+_this.p4.sz*_this.p4.sz);
                    if (! _this.zt) {
                      if (_this.zo<_this.zo2) {
                        _this.zo=_this.zo2;
                      }
                      if (_this.zo<_this.zo3) {
                        _this.zo=_this.zo3;
                      }
                      if (_this.zo<_this.zo4) {
                        _this.zo=_this.zo4;
                      }
                      
                    } else {
                      if (_this.zt==2) {
                        if (_this.zo>_this.zo2) {
                          _this.zo=_this.zo2;
                        }
                        if (_this.zo>_this.zo3) {
                          _this.zo=_this.zo3;
                        }
                        if (_this.zo>_this.zo4) {
                          _this.zo=_this.zo4;
                        }
                        
                      }
                    }
                    
                  } else {
                    if (! _this.zt) {
                      _this.zo=_this.sqrt(_this.dp2.sx*_this.dp2.sx+_this.dp2.sy*_this.dp2.sy+_this.dp2.sz*_this.dp2.sz);
                      _this.zo2=_this.sqrt(_this.dp3.sx*_this.dp3.sx+_this.dp3.sy*_this.dp3.sy+_this.dp3.sz*_this.dp3.sz);
                      _this.zo3=_this.sqrt(_this.dp4.sx*_this.dp4.sx+_this.dp4.sy*_this.dp4.sy+_this.dp4.sz*_this.dp4.sz);
                      if (_this.zo<_this.zo2) {
                        _this.zo=_this.zo2;
                      }
                      if (_this.zo<_this.zo3) {
                        _this.zo=_this.zo3;
                      }
                      
                    } else {
                      if (_this.zt==2) {
                        _this.zo=_this.sqrt(_this.dp1.sx*_this.dp1.sx+_this.dp1.sy*_this.dp1.sy+_this.dp1.sz*_this.dp1.sz);
                        _this.zo2=_this.sqrt(_this.dp3.sx*_this.dp3.sx+_this.dp3.sy*_this.dp3.sy+_this.dp3.sz*_this.dp3.sz);
                        _this.zo3=_this.sqrt(_this.dp4.sx*_this.dp4.sx+_this.dp4.sy*_this.dp4.sy+_this.dp4.sz*_this.dp4.sz);
                        _this.zo4=_this.sqrt(_this.dp5.sx*_this.dp5.sx+_this.dp5.sy*_this.dp5.sy+_this.dp5.sz*_this.dp5.sz);
                        if (_this.zo>_this.zo2) {
                          _this.zo=_this.zo2;
                        }
                        if (_this.zo>_this.zo3) {
                          _this.zo=_this.zo3;
                        }
                        if (_this.zo>_this.zo4) {
                          _this.zo=_this.zo4;
                        }
                        
                      }
                    }
                    
                  }
                  
                } else {
                  if (_this.zt==null||_this.zt==1) {
                    _this.zosx=(_this.p1.sx+_this.p2.sx+_this.p3.sx+_this.p4.sx)/4;
                    _this.zosy=(_this.p1.sy+_this.p2.sy+_this.p3.sy+_this.p4.sy)/4;
                    _this.zosz=(_this.p1.sz+_this.p2.sz+_this.p3.sz+_this.p4.sz)/4;
                    if (_this.zosz<0) {
                      _this.zosz=0;
                    }
                    _this.zo=_this.sqrt(_this.zosx*_this.zosx+_this.zosy*_this.zosy+_this.zosz*_this.zosz);
                    
                  }
                }
                
              }
            }
          }
        }
      },
      fiber$merikomiSyusei :function* _trc_TD_DR_1_f_merikomiSyusei(_thread,kk,zk,hw,hh) {
        var _this=this;
        
        if (! _this.TD_visible) {
          return _this;
        }
        if (_this.s==- 1) {
          return _this;
        }
        if (_this.n==1) {
          _this.s=(_this.p1.sz>=0);
          if (_this.s==0) {
            return _this;
          }
          _this.zo=_this.sqrt(_this.p1.sx*_this.p1.sx+_this.p1.sy*_this.p1.sy+_this.p1.sz*_this.p1.sz);
          
        } else {
          if (_this.n==2) {
            _this.s=0;
            _this.np=(_this.p1.sz<0)+(_this.p2.sz<0);
            if (_this.np==2) {
              return _this;
            }
            if (_this.np==1) {
              _this.s=2;
              if (_this.p1.sz<0) {
                (yield* _this.fiber$merikomiSyusei_L(_thread, _this.p1, _this.p2, kk, zk, hw, hh));
              } else {
                if (_this.p2.sz<0) {
                  (yield* _this.fiber$merikomiSyusei_L(_thread, _this.p2, _this.p1, kk, zk, hw, hh));
                }
              }
              
            } else {
              _this.s=1;
              
            }
            if (_this.zt==0||_this.zt==2) {
              if (_this.np==0) {
                _this.zo=_this.sqrt(_this.p1.sx*_this.p1.sx+_this.p1.sy*_this.p1.sy+_this.p1.sz*_this.p1.sz);
                _this.zo2=_this.sqrt(_this.p2.sx*_this.p2.sx+_this.p2.sy*_this.p2.sy+_this.p2.sz*_this.p2.sz);
                if (! _this.zt) {
                  if (_this.zo<_this.zo2) {
                    _this.zo=_this.zo2;
                  }
                  
                } else {
                  if (_this.zt==2) {
                    if (_this.zo>_this.zo2) {
                      _this.zo=_this.zo2;
                    }
                    
                  }
                }
                
              } else {
                if (! _this.zt) {
                  _this.zo=_this.sqrt(_this.p2.sx*_this.p2.sx+_this.p2.sy*_this.p2.sy+_this.p2.sz*_this.p2.sz);
                  
                } else {
                  if (_this.zt==2) {
                    _this.zo=_this.sqrt(_this.p1.sx*_this.p1.sx+_this.p1.sy*_this.p1.sy+_this.p1.sz*_this.p1.sz);
                    
                  }
                }
                
              }
              
            } else {
              if (_this.zt==null||_this.zt==1) {
                _this.zosx=(_this.p1.sx+_this.p2.sx)/2;
                _this.zosy=(_this.p1.sy+_this.p2.sy)/2;
                _this.zosz=(_this.p1.sz+_this.p2.sz)/2;
                if (_this.zosz<0) {
                  _this.zosz=0;
                }
                _this.zo=_this.sqrt(_this.zosx*_this.zosx+_this.zosy*_this.zosy+_this.zosz*_this.zosz);
                
              }
            }
            
          } else {
            if (_this.n==3) {
              _this.pr=0;
              _this.s=0;
              _this.np=(_this.p1.sz<0)+(_this.p2.sz<0)+(_this.p3.sz<0);
              if (_this.np==3) {
                return _this;
              }
              if (_this.np==1) {
                _this.pr=4;
                _this.s=2;
                if (_this.p1.sz<0) {
                  (yield* _this.fiber$merikomiSyusei_T(_thread, _this.np, _this.p2, _this.p1, _this.p3, kk, zk, hw, hh));
                } else {
                  if (_this.p2.sz<0) {
                    (yield* _this.fiber$merikomiSyusei_T(_thread, _this.np, _this.p3, _this.p2, _this.p1, kk, zk, hw, hh));
                  } else {
                    if (_this.p3.sz<0) {
                      (yield* _this.fiber$merikomiSyusei_T(_thread, _this.np, _this.p1, _this.p3, _this.p2, kk, zk, hw, hh));
                    }
                  }
                }
                
              } else {
                if (_this.np==2) {
                  _this.pr=3;
                  _this.s=2;
                  if (_this.p1.sz>=0) {
                    (yield* _this.fiber$merikomiSyusei_T(_thread, _this.np, _this.p2, _this.p1, _this.p3, kk, zk, hw, hh));
                  } else {
                    if (_this.p2.sz>=0) {
                      (yield* _this.fiber$merikomiSyusei_T(_thread, _this.np, _this.p3, _this.p2, _this.p1, kk, zk, hw, hh));
                    } else {
                      if (_this.p3.sz>=0) {
                        (yield* _this.fiber$merikomiSyusei_T(_thread, _this.np, _this.p1, _this.p3, _this.p2, kk, zk, hw, hh));
                      }
                    }
                  }
                  
                } else {
                  if (_this.np==0) {
                    _this.pr=3;
                    _this.s=1;
                    
                  }
                }
              }
              if (_this.zt==0||_this.zt==2) {
                if (_this.np==0) {
                  _this.zo=_this.sqrt(_this.p1.sx*_this.p1.sx+_this.p1.sy*_this.p1.sy+_this.p1.sz*_this.p1.sz);
                  _this.zo2=_this.sqrt(_this.p2.sx*_this.p2.sx+_this.p2.sy*_this.p2.sy+_this.p2.sz*_this.p2.sz);
                  _this.zo3=_this.sqrt(_this.p3.sx*_this.p3.sx+_this.p3.sy*_this.p3.sy+_this.p3.sz*_this.p3.sz);
                  if (! _this.zt) {
                    if (_this.zo<_this.zo2) {
                      _this.zo=_this.zo2;
                    }
                    if (_this.zo<_this.zo3) {
                      _this.zo=_this.zo3;
                    }
                    
                  } else {
                    if (_this.zt==2) {
                      if (_this.zo>_this.zo2) {
                        _this.zo=_this.zo2;
                      }
                      if (_this.zo>_this.zo3) {
                        _this.zo=_this.zo3;
                      }
                      
                    }
                  }
                  
                } else {
                  if (! _this.zt) {
                    _this.zo=_this.sqrt(_this.dp2.sx*_this.dp2.sx+_this.dp2.sy*_this.dp2.sy+_this.dp2.sz*_this.dp2.sz);
                    _this.zo2=_this.sqrt(_this.dp3.sx*_this.dp3.sx+_this.dp3.sy*_this.dp3.sy+_this.dp3.sz*_this.dp3.sz);
                    if (_this.zo<_this.zo2) {
                      _this.zo=_this.zo2;
                    }
                    
                  } else {
                    if (_this.zt==2) {
                      _this.zo=_this.sqrt(_this.dp1.sx*_this.dp1.sx+_this.dp1.sy*_this.dp1.sy+_this.dp1.sz*_this.dp1.sz);
                      _this.zo2=_this.sqrt(_this.dp3.sx*_this.dp3.sx+_this.dp3.sy*_this.dp3.sy+_this.dp3.sz*_this.dp3.sz);
                      _this.zo3=_this.sqrt(_this.dp4.sx*_this.dp4.sx+_this.dp4.sy*_this.dp4.sy+_this.dp4.sz*_this.dp4.sz);
                      if (_this.zo>_this.zo2) {
                        _this.zo=_this.zo2;
                      }
                      if (_this.zo>_this.zo3) {
                        _this.zo=_this.zo3;
                      }
                      
                    }
                  }
                  
                }
                
              } else {
                if (_this.zt==null||_this.zt==1) {
                  _this.zosx=(_this.p1.sx+_this.p2.sx+_this.p3.sx)/3;
                  _this.zosy=(_this.p1.sy+_this.p2.sy+_this.p3.sy)/3;
                  _this.zosz=(_this.p1.sz+_this.p2.sz+_this.p3.sz)/3;
                  if (_this.zosz<0) {
                    _this.zosz=0;
                  }
                  _this.zo=_this.sqrt(_this.zosx*_this.zosx+_this.zosy*_this.zosy+_this.zosz*_this.zosz);
                  
                }
              }
              
            } else {
              if (_this.n==4) {
                _this.pr=0;
                _this.s=0;
                _this.np=(_this.p1.sz<0)+(_this.p2.sz<0)+(_this.p3.sz<0)+(_this.p4.sz<0);
                if (_this.np==4) {
                  return _this;
                }
                if (_this.np==1) {
                  _this.pr=5;
                  _this.s=2;
                  if (_this.p1.sz<0) {
                    (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p2, _this.p1, _this.p4, _this.p3, kk, zk, hw, hh));
                  } else {
                    if (_this.p2.sz<0) {
                      (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p3, _this.p2, _this.p1, _this.p4, kk, zk, hw, hh));
                    } else {
                      if (_this.p3.sz<0) {
                        (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p4, _this.p3, _this.p2, _this.p1, kk, zk, hw, hh));
                      } else {
                        if (_this.p4.sz<0) {
                          (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p1, _this.p4, _this.p3, _this.p2, kk, zk, hw, hh));
                        }
                      }
                    }
                  }
                  
                } else {
                  if (_this.np==2) {
                    _this.pr=4;
                    _this.s=2;
                    if (_this.p1.sz<0&&_this.p4.sz<0) {
                      (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p2, _this.p1, _this.p4, _this.p3, kk, zk, hw, hh));
                    } else {
                      if (_this.p2.sz<0&&_this.p1.sz<0) {
                        (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p3, _this.p2, _this.p1, _this.p4, kk, zk, hw, hh));
                      } else {
                        if (_this.p3.sz<0&&_this.p2.sz<0) {
                          (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p4, _this.p3, _this.p2, _this.p1, kk, zk, hw, hh));
                        } else {
                          if (_this.p4.sz<0&&_this.p3.sz<0) {
                            (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p1, _this.p4, _this.p3, _this.p2, kk, zk, hw, hh));
                          }
                        }
                      }
                    }
                    
                  } else {
                    if (_this.np==3) {
                      _this.pr=3;
                      _this.s=2;
                      if (_this.p1.sz>=0) {
                        (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p4, _this.p1, _this.p2, null, kk, zk, hw, hh));
                      } else {
                        if (_this.p2.sz>=0) {
                          (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p1, _this.p2, _this.p3, null, kk, zk, hw, hh));
                        } else {
                          if (_this.p3.sz>=0) {
                            (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p2, _this.p3, _this.p4, null, kk, zk, hw, hh));
                          } else {
                            if (_this.p4.sz>=0) {
                              (yield* _this.fiber$merikomiSyusei_S(_thread, _this.np, _this.p3, _this.p4, _this.p1, null, kk, zk, hw, hh));
                            }
                          }
                        }
                      }
                      
                    } else {
                      if (_this.np==0) {
                        _this.pr=4;
                        _this.s=1;
                        
                      }
                    }
                  }
                }
                if (_this.zt==0||_this.zt==2) {
                  if (_this.np==0) {
                    _this.zo=_this.sqrt(_this.p1.sx*_this.p1.sx+_this.p1.sy*_this.p1.sy+_this.p1.sz*_this.p1.sz);
                    _this.zo2=_this.sqrt(_this.p2.sx*_this.p2.sx+_this.p2.sy*_this.p2.sy+_this.p2.sz*_this.p2.sz);
                    _this.zo3=_this.sqrt(_this.p3.sx*_this.p3.sx+_this.p3.sy*_this.p3.sy+_this.p3.sz*_this.p3.sz);
                    _this.zo4=_this.sqrt(_this.p4.sx*_this.p4.sx+_this.p4.sy*_this.p4.sy+_this.p4.sz*_this.p4.sz);
                    if (! _this.zt) {
                      if (_this.zo<_this.zo2) {
                        _this.zo=_this.zo2;
                      }
                      if (_this.zo<_this.zo3) {
                        _this.zo=_this.zo3;
                      }
                      if (_this.zo<_this.zo4) {
                        _this.zo=_this.zo4;
                      }
                      
                    } else {
                      if (_this.zt==2) {
                        if (_this.zo>_this.zo2) {
                          _this.zo=_this.zo2;
                        }
                        if (_this.zo>_this.zo3) {
                          _this.zo=_this.zo3;
                        }
                        if (_this.zo>_this.zo4) {
                          _this.zo=_this.zo4;
                        }
                        
                      }
                    }
                    
                  } else {
                    if (! _this.zt) {
                      _this.zo=_this.sqrt(_this.dp2.sx*_this.dp2.sx+_this.dp2.sy*_this.dp2.sy+_this.dp2.sz*_this.dp2.sz);
                      _this.zo2=_this.sqrt(_this.dp3.sx*_this.dp3.sx+_this.dp3.sy*_this.dp3.sy+_this.dp3.sz*_this.dp3.sz);
                      _this.zo3=_this.sqrt(_this.dp4.sx*_this.dp4.sx+_this.dp4.sy*_this.dp4.sy+_this.dp4.sz*_this.dp4.sz);
                      if (_this.zo<_this.zo2) {
                        _this.zo=_this.zo2;
                      }
                      if (_this.zo<_this.zo3) {
                        _this.zo=_this.zo3;
                      }
                      
                    } else {
                      if (_this.zt==2) {
                        _this.zo=_this.sqrt(_this.dp1.sx*_this.dp1.sx+_this.dp1.sy*_this.dp1.sy+_this.dp1.sz*_this.dp1.sz);
                        _this.zo2=_this.sqrt(_this.dp3.sx*_this.dp3.sx+_this.dp3.sy*_this.dp3.sy+_this.dp3.sz*_this.dp3.sz);
                        _this.zo3=_this.sqrt(_this.dp4.sx*_this.dp4.sx+_this.dp4.sy*_this.dp4.sy+_this.dp4.sz*_this.dp4.sz);
                        _this.zo4=_this.sqrt(_this.dp5.sx*_this.dp5.sx+_this.dp5.sy*_this.dp5.sy+_this.dp5.sz*_this.dp5.sz);
                        if (_this.zo>_this.zo2) {
                          _this.zo=_this.zo2;
                        }
                        if (_this.zo>_this.zo3) {
                          _this.zo=_this.zo3;
                        }
                        if (_this.zo>_this.zo4) {
                          _this.zo=_this.zo4;
                        }
                        
                      }
                    }
                    
                  }
                  
                } else {
                  if (_this.zt==null||_this.zt==1) {
                    _this.zosx=(_this.p1.sx+_this.p2.sx+_this.p3.sx+_this.p4.sx)/4;
                    _this.zosy=(_this.p1.sy+_this.p2.sy+_this.p3.sy+_this.p4.sy)/4;
                    _this.zosz=(_this.p1.sz+_this.p2.sz+_this.p3.sz+_this.p4.sz)/4;
                    if (_this.zosz<0) {
                      _this.zosz=0;
                    }
                    _this.zo=_this.sqrt(_this.zosx*_this.zosx+_this.zosy*_this.zosy+_this.zosz*_this.zosz);
                    
                  }
                }
                
              }
            }
          }
        }
        
      },
      merikomiSyusei_L :function _trc_TD_DR_1_merikomiSyusei_L(up,sp,kk,zk,hw,hh) {
        var _this=this;
        var w;
        
        
        _this.dp1.sxyzSetP(up);
        _this.dp2.sxyzSetP(sp);
        w=- up.sz/(sp.sz-up.sz);
        _this.dp1.sx+=(sp.sx-up.sx)*w;
        _this.dp1.sy+=(sp.sy-up.sy)*w;
        _this.dp1.sz=0;
        _this.dp1.henkan2D(kk,zk,hw,hh);
        _this.dp2.henkan2D(kk,zk,hw,hh);
      },
      fiber$merikomiSyusei_L :function* _trc_TD_DR_1_f_merikomiSyusei_L(_thread,up,sp,kk,zk,hw,hh) {
        var _this=this;
        var w;
        
        
        _this.dp1.sxyzSetP(up);
        _this.dp2.sxyzSetP(sp);
        w=- up.sz/(sp.sz-up.sz);
        _this.dp1.sx+=(sp.sx-up.sx)*w;
        _this.dp1.sy+=(sp.sy-up.sy)*w;
        _this.dp1.sz=0;
        _this.dp1.henkan2D(kk,zk,hw,hh);
        _this.dp2.henkan2D(kk,zk,hw,hh);
        
      },
      merikomiSyusei_T :function _trc_TD_DR_1_merikomiSyusei_T(np,sp1,up,sp2,kk,zk,hw,hh) {
        var _this=this;
        var w;
        
        
        if (np==1) {
          _this.dp1.sxyzSetP(up);
          _this.dp4.sxyzSetP(up);
          _this.dp2.sxyzSetP(sp1);
          _this.dp3.sxyzSetP(sp2);
          w=- up.sz/(sp1.sz-up.sz);
          _this.dp1.sx+=(sp1.sx-up.sx)*w;
          _this.dp1.sy+=(sp1.sy-up.sy)*w;
          _this.dp1.sz=0;
          w=- up.sz/(sp2.sz-up.sz);
          _this.dp4.sx+=(sp2.sx-up.sx)*w;
          _this.dp4.sy+=(sp2.sy-up.sy)*w;
          _this.dp4.sz=0;
          _this.dp1.henkan2D(kk,zk,hw,hh);
          _this.dp2.henkan2D(kk,zk,hw,hh);
          _this.dp3.henkan2D(kk,zk,hw,hh);
          _this.dp4.henkan2D(kk,zk,hw,hh);
          
        } else {
          if (np==2) {
            _this.dp1.sxyzSetP(up);
            _this.dp2.sxyzSetP(sp1);
            _this.dp3.sxyzSetP(sp2);
            w=- sp1.sz/(up.sz-sp1.sz);
            _this.dp2.sx+=(up.sx-sp1.sx)*w;
            _this.dp2.sy+=(up.sy-sp1.sy)*w;
            _this.dp2.sz=0;
            w=- sp2.sz/(up.sz-sp2.sz);
            _this.dp3.sx+=(up.sx-sp2.sx)*w;
            _this.dp3.sy+=(up.sy-sp2.sy)*w;
            _this.dp3.sz=0;
            _this.dp1.henkan2D(kk,zk,hw,hh);
            _this.dp2.henkan2D(kk,zk,hw,hh);
            _this.dp3.henkan2D(kk,zk,hw,hh);
            
          }
        }
      },
      fiber$merikomiSyusei_T :function* _trc_TD_DR_1_f_merikomiSyusei_T(_thread,np,sp1,up,sp2,kk,zk,hw,hh) {
        var _this=this;
        var w;
        
        
        if (np==1) {
          _this.dp1.sxyzSetP(up);
          _this.dp4.sxyzSetP(up);
          _this.dp2.sxyzSetP(sp1);
          _this.dp3.sxyzSetP(sp2);
          w=- up.sz/(sp1.sz-up.sz);
          _this.dp1.sx+=(sp1.sx-up.sx)*w;
          _this.dp1.sy+=(sp1.sy-up.sy)*w;
          _this.dp1.sz=0;
          w=- up.sz/(sp2.sz-up.sz);
          _this.dp4.sx+=(sp2.sx-up.sx)*w;
          _this.dp4.sy+=(sp2.sy-up.sy)*w;
          _this.dp4.sz=0;
          _this.dp1.henkan2D(kk,zk,hw,hh);
          _this.dp2.henkan2D(kk,zk,hw,hh);
          _this.dp3.henkan2D(kk,zk,hw,hh);
          _this.dp4.henkan2D(kk,zk,hw,hh);
          
        } else {
          if (np==2) {
            _this.dp1.sxyzSetP(up);
            _this.dp2.sxyzSetP(sp1);
            _this.dp3.sxyzSetP(sp2);
            w=- sp1.sz/(up.sz-sp1.sz);
            _this.dp2.sx+=(up.sx-sp1.sx)*w;
            _this.dp2.sy+=(up.sy-sp1.sy)*w;
            _this.dp2.sz=0;
            w=- sp2.sz/(up.sz-sp2.sz);
            _this.dp3.sx+=(up.sx-sp2.sx)*w;
            _this.dp3.sy+=(up.sy-sp2.sy)*w;
            _this.dp3.sz=0;
            _this.dp1.henkan2D(kk,zk,hw,hh);
            _this.dp2.henkan2D(kk,zk,hw,hh);
            _this.dp3.henkan2D(kk,zk,hw,hh);
            
          }
        }
        
      },
      merikomiSyusei_S :function _trc_TD_DR_1_merikomiSyusei_S(np,sp1,up,sp2,sp3,kk,zk,hw,hh) {
        var _this=this;
        var w;
        
        
        if (np==1) {
          _this.dp1.sxyzSetP(up);
          _this.dp5.sxyzSetP(up);
          _this.dp2.sxyzSetP(sp1);
          _this.dp3.sxyzSetP(sp3);
          _this.dp4.sxyzSetP(sp2);
          w=- up.sz/(sp1.sz-up.sz);
          _this.dp1.sx+=(sp1.sx-up.sx)*w;
          _this.dp1.sy+=(sp1.sy-up.sy)*w;
          _this.dp1.sz=0;
          w=- up.sz/(sp2.sz-up.sz);
          _this.dp5.sx+=(sp2.sx-up.sx)*w;
          _this.dp5.sy+=(sp2.sy-up.sy)*w;
          _this.dp5.sz=0;
          _this.dp1.henkan2D(kk,zk,hw,hh);
          _this.dp2.henkan2D(kk,zk,hw,hh);
          _this.dp3.henkan2D(kk,zk,hw,hh);
          _this.dp4.henkan2D(kk,zk,hw,hh);
          _this.dp5.henkan2D(kk,zk,hw,hh);
          
        } else {
          if (np==2) {
            _this.dp1.sxyzSetP(up);
            _this.dp2.sxyzSetP(sp1);
            _this.dp3.sxyzSetP(sp3);
            _this.dp4.sxyzSetP(sp2);
            w=- up.sz/(sp1.sz-up.sz);
            _this.dp1.sx+=(sp1.sx-up.sx)*w;
            _this.dp1.sy+=(sp1.sy-up.sy)*w;
            _this.dp1.sz=0;
            w=- sp2.sz/(sp3.sz-sp2.sz);
            _this.dp4.sx+=(sp3.sx-sp2.sx)*w;
            _this.dp4.sy+=(sp3.sy-sp2.sy)*w;
            _this.dp4.sz=0;
            _this.dp1.henkan2D(kk,zk,hw,hh);
            _this.dp2.henkan2D(kk,zk,hw,hh);
            _this.dp3.henkan2D(kk,zk,hw,hh);
            _this.dp4.henkan2D(kk,zk,hw,hh);
            
          } else {
            if (np==3) {
              _this.dp1.sxyzSetP(sp1);
              _this.dp2.sxyzSetP(up);
              _this.dp3.sxyzSetP(sp2);
              w=- sp1.sz/(up.sz-sp1.sz);
              _this.dp1.sx+=(up.sx-sp1.sx)*w;
              _this.dp1.sy+=(up.sy-sp1.sy)*w;
              _this.dp1.sz=0;
              w=- sp2.sz/(up.sz-sp2.sz);
              _this.dp3.sx+=(up.sx-sp2.sx)*w;
              _this.dp3.sy+=(up.sy-sp2.sy)*w;
              _this.dp3.sz=0;
              _this.dp1.henkan2D(kk,zk,hw,hh);
              _this.dp2.henkan2D(kk,zk,hw,hh);
              _this.dp3.henkan2D(kk,zk,hw,hh);
              
            }
          }
        }
      },
      fiber$merikomiSyusei_S :function* _trc_TD_DR_1_f_merikomiSyusei_S(_thread,np,sp1,up,sp2,sp3,kk,zk,hw,hh) {
        var _this=this;
        var w;
        
        
        if (np==1) {
          _this.dp1.sxyzSetP(up);
          _this.dp5.sxyzSetP(up);
          _this.dp2.sxyzSetP(sp1);
          _this.dp3.sxyzSetP(sp3);
          _this.dp4.sxyzSetP(sp2);
          w=- up.sz/(sp1.sz-up.sz);
          _this.dp1.sx+=(sp1.sx-up.sx)*w;
          _this.dp1.sy+=(sp1.sy-up.sy)*w;
          _this.dp1.sz=0;
          w=- up.sz/(sp2.sz-up.sz);
          _this.dp5.sx+=(sp2.sx-up.sx)*w;
          _this.dp5.sy+=(sp2.sy-up.sy)*w;
          _this.dp5.sz=0;
          _this.dp1.henkan2D(kk,zk,hw,hh);
          _this.dp2.henkan2D(kk,zk,hw,hh);
          _this.dp3.henkan2D(kk,zk,hw,hh);
          _this.dp4.henkan2D(kk,zk,hw,hh);
          _this.dp5.henkan2D(kk,zk,hw,hh);
          
        } else {
          if (np==2) {
            _this.dp1.sxyzSetP(up);
            _this.dp2.sxyzSetP(sp1);
            _this.dp3.sxyzSetP(sp3);
            _this.dp4.sxyzSetP(sp2);
            w=- up.sz/(sp1.sz-up.sz);
            _this.dp1.sx+=(sp1.sx-up.sx)*w;
            _this.dp1.sy+=(sp1.sy-up.sy)*w;
            _this.dp1.sz=0;
            w=- sp2.sz/(sp3.sz-sp2.sz);
            _this.dp4.sx+=(sp3.sx-sp2.sx)*w;
            _this.dp4.sy+=(sp3.sy-sp2.sy)*w;
            _this.dp4.sz=0;
            _this.dp1.henkan2D(kk,zk,hw,hh);
            _this.dp2.henkan2D(kk,zk,hw,hh);
            _this.dp3.henkan2D(kk,zk,hw,hh);
            _this.dp4.henkan2D(kk,zk,hw,hh);
            
          } else {
            if (np==3) {
              _this.dp1.sxyzSetP(sp1);
              _this.dp2.sxyzSetP(up);
              _this.dp3.sxyzSetP(sp2);
              w=- sp1.sz/(up.sz-sp1.sz);
              _this.dp1.sx+=(up.sx-sp1.sx)*w;
              _this.dp1.sy+=(up.sy-sp1.sy)*w;
              _this.dp1.sz=0;
              w=- sp2.sz/(up.sz-sp2.sz);
              _this.dp3.sx+=(up.sx-sp2.sx)*w;
              _this.dp3.sy+=(up.sy-sp2.sy)*w;
              _this.dp3.sz=0;
              _this.dp1.henkan2D(kk,zk,hw,hh);
              _this.dp2.henkan2D(kk,zk,hw,hh);
              _this.dp3.henkan2D(kk,zk,hw,hh);
              
            }
          }
        }
        
      },
      hamidasiSyusei :function _trc_TD_DR_1_hamidasiSyusei(GL,GU,GR,GD,scaleXDX,scaleYDX) {
        var _this=this;
        var hh;
        var hx;
        var hy;
        var hx1;
        var hy1;
        var hx2;
        var hy2;
        var hx3;
        var hy3;
        var hx4;
        var hy4;
        var hx5;
        var hy5;
        var i;
        var ss;
        var pp1;
        var pp2;
        var cc;
        var width;
        var height;
        
        
        if (! _this.TD_visible) {
          return _this;
        }
        if (_this.s==- 1) {
          return _this;
        }
        if (_this.n==1) {
          cc = Tonyu.globals.$imageList[_this.floor(_this.c||0)];
          
          width = 2;
          height = 2;
          
          if (cc) {
            _this.ccwidth=cc.width;
            _this.ccheight=cc.height;
            
          }
          ss = 1/_this.p1.k;
          
          _this.k1=ss*_this.scaleX*scaleXDX;
          if (scaleYDX) {
            if (_this.scaleY) {
              _this.k2=ss*_this.scaleY*scaleYDX;
            } else {
              _this.k2=ss*_this.scaleX*scaleYDX;
            }
            
          } else {
            if (_this.scaleY) {
              _this.k2=ss*_this.scaleY*scaleXDX;
              
            }
            
          }
          hx=_this.hamidasiSyusei_hantei_X(_this.p1,GL,GR,_this.abs(_this.ccwidth*_this.k1/2));
          hy=_this.hamidasiSyusei_hantei_Y(_this.p1,GU,GD,_this.abs(_this.ccheight*_this.k2/2));
          if (hx!=0||hy!=0) {
            _this.s=0;
          }
          
        } else {
          if (_this.n==2) {
            if (_this.s!=0) {
              if (_this.s==1) {
                hx1=_this.hamidasiSyusei_hantei_X(_this.p1,GL,GR);
                hy1=_this.hamidasiSyusei_hantei_Y(_this.p1,GU,GD);
                hx2=_this.hamidasiSyusei_hantei_X(_this.p2,GL,GR);
                hy2=_this.hamidasiSyusei_hantei_Y(_this.p2,GU,GD);
                
              } else {
                if (_this.s==2) {
                  hx1=_this.hamidasiSyusei_hantei_X(_this.dp1,GL,GR);
                  hy1=_this.hamidasiSyusei_hantei_Y(_this.dp1,GU,GD);
                  hx2=_this.hamidasiSyusei_hantei_X(_this.dp2,GL,GR);
                  hy2=_this.hamidasiSyusei_hantei_Y(_this.dp2,GU,GD);
                  
                }
              }
              hx=hx1+hx2;
              hy=hy1+hy2;
              if (hx==0&&hy==0) {
                return _this;
              }
              if (hx!=0&&hx1==hx2) {
                _this.s=0;
                return _this;
                
              }
              if (hy!=0&&hy1==hy2) {
                _this.s=0;
                return _this;
                
              }
              if (Tonyu.globals.$TD_Z_hamidasiSyusei==0) {
                return _this;
              }
              if (_this.s==1) {
                _this.dp1.xySetP(_this.p1);
                _this.dp2.xySetP(_this.p2);
                
              }
              _this.s=_this.hamidasiSyusei_L(_this.dp1,_this.dp2,GL,GU,GR,GD);
              
            }
            
          } else {
            if (_this.n==3||_this.n==4) {
              if (_this.s!=0) {
                if (_this.m==3) {
                  if (_this.s==1) {
                    if (_this.p1.xx<_this.p2.xx) {
                      _this.bmpGL=_this.p1.xx;
                    } else {
                      _this.bmpGL=_this.p2.xx;
                    }
                    if (_this.p1.yy<_this.p2.yy) {
                      _this.bmpGU=_this.p1.yy;
                    } else {
                      _this.bmpGU=_this.p2.yy;
                    }
                    if (_this.p1.xx>_this.p2.xx) {
                      _this.bmpGR=_this.p1.xx;
                    } else {
                      _this.bmpGR=_this.p2.xx;
                    }
                    if (_this.p1.yy>_this.p2.yy) {
                      _this.bmpGD=_this.p1.yy;
                    } else {
                      _this.bmpGD=_this.p2.yy;
                    }
                    if (_this.p3.xx<_this.bmpGL) {
                      _this.bmpGL=_this.p3.xx;
                    }
                    if (_this.p3.yy<_this.bmpGU) {
                      _this.bmpGU=_this.p3.yy;
                    }
                    if (_this.p3.xx>_this.bmpGR) {
                      _this.bmpGR=_this.p3.xx;
                    }
                    if (_this.p3.yy>_this.bmpGD) {
                      _this.bmpGD=_this.p3.yy;
                    }
                    if (_this.pr>=4) {
                      if (_this.p4.xx<_this.bmpGL) {
                        _this.bmpGL=_this.p4.xx;
                      }
                      if (_this.p4.yy<_this.bmpGU) {
                        _this.bmpGU=_this.p4.yy;
                      }
                      if (_this.p4.xx>_this.bmpGR) {
                        _this.bmpGR=_this.p4.xx;
                      }
                      if (_this.p4.yy>_this.bmpGD) {
                        _this.bmpGD=_this.p4.yy;
                      }
                      
                    }
                    
                  } else {
                    if (_this.s==2) {
                      if (_this.dp1.xx<_this.dp2.xx) {
                        _this.bmpGL=_this.dp1.xx;
                      } else {
                        _this.bmpGL=_this.dp2.xx;
                      }
                      if (_this.dp1.yy<_this.dp2.yy) {
                        _this.bmpGU=_this.dp1.yy;
                      } else {
                        _this.bmpGU=_this.dp2.yy;
                      }
                      if (_this.dp1.xx>_this.dp2.xx) {
                        _this.bmpGR=_this.dp1.xx;
                      } else {
                        _this.bmpGR=_this.dp2.xx;
                      }
                      if (_this.dp1.yy>_this.dp2.yy) {
                        _this.bmpGD=_this.dp1.yy;
                      } else {
                        _this.bmpGD=_this.dp2.yy;
                      }
                      if (_this.dp3.xx<_this.bmpGL) {
                        _this.bmpGL=_this.dp3.xx;
                      }
                      if (_this.dp3.yy<_this.bmpGU) {
                        _this.bmpGU=_this.dp3.yy;
                      }
                      if (_this.dp3.xx>_this.bmpGR) {
                        _this.bmpGR=_this.dp3.xx;
                      }
                      if (_this.dp3.yy>_this.bmpGD) {
                        _this.bmpGD=_this.dp3.yy;
                      }
                      if (_this.pr>=4) {
                        if (_this.dp4.xx<_this.bmpGL) {
                          _this.bmpGL=_this.dp4.xx;
                        }
                        if (_this.dp4.yy<_this.bmpGU) {
                          _this.bmpGU=_this.dp4.yy;
                        }
                        if (_this.dp4.xx>_this.bmpGR) {
                          _this.bmpGR=_this.dp4.xx;
                        }
                        if (_this.dp4.yy>_this.bmpGD) {
                          _this.bmpGD=_this.dp4.yy;
                        }
                        
                      }
                      if (_this.pr>=5) {
                        if (_this.dp5.xx<_this.bmpGL) {
                          _this.bmpGL=_this.dp5.xx;
                        }
                        if (_this.dp5.yy<_this.bmpGU) {
                          _this.bmpGU=_this.dp5.yy;
                        }
                        if (_this.dp5.xx>_this.bmpGR) {
                          _this.bmpGR=_this.dp5.xx;
                        }
                        if (_this.dp5.yy>_this.bmpGD) {
                          _this.bmpGD=_this.dp5.yy;
                        }
                        
                      }
                      
                    }
                  }
                  
                }
                if (_this.s==1) {
                  hx1=_this.hamidasiSyusei_hantei_X(_this.p1,GL,GR);
                  hy1=_this.hamidasiSyusei_hantei_Y(_this.p1,GU,GD);
                  hx2=_this.hamidasiSyusei_hantei_X(_this.p2,GL,GR);
                  hy2=_this.hamidasiSyusei_hantei_Y(_this.p2,GU,GD);
                  hx3=_this.hamidasiSyusei_hantei_X(_this.p3,GL,GR);
                  hy3=_this.hamidasiSyusei_hantei_Y(_this.p3,GU,GD);
                  if (_this.pr>=4) {
                    hx4=_this.hamidasiSyusei_hantei_X(_this.p4,GL,GR);
                    hy4=_this.hamidasiSyusei_hantei_Y(_this.p4,GU,GD);
                    
                  }
                  
                } else {
                  if (_this.s==2) {
                    hx1=_this.hamidasiSyusei_hantei_X(_this.dp1,GL,GR);
                    hy1=_this.hamidasiSyusei_hantei_Y(_this.dp1,GU,GD);
                    hx2=_this.hamidasiSyusei_hantei_X(_this.dp2,GL,GR);
                    hy2=_this.hamidasiSyusei_hantei_Y(_this.dp2,GU,GD);
                    hx3=_this.hamidasiSyusei_hantei_X(_this.dp3,GL,GR);
                    hy3=_this.hamidasiSyusei_hantei_Y(_this.dp3,GU,GD);
                    if (_this.pr>=4) {
                      hx4=_this.hamidasiSyusei_hantei_X(_this.dp4,GL,GR);
                      hy4=_this.hamidasiSyusei_hantei_Y(_this.dp4,GU,GD);
                      
                    }
                    if (_this.pr>=5) {
                      hx5=_this.hamidasiSyusei_hantei_X(_this.dp5,GL,GR);
                      hy5=_this.hamidasiSyusei_hantei_Y(_this.dp5,GU,GD);
                      
                    }
                    
                  }
                }
                if (_this.pr==3) {
                  hx=hx1+hx2+hx3;
                  hy=hy1+hy2+hy3;
                  if (hx==0&&hy==0) {
                    return _this;
                  }
                  if (hx!=0&&(hx1==hx2&&hx2==hx3)) {
                    _this.s=0;
                    return _this;
                    
                  }
                  if (hy!=0&&(hy1==hy2&&hy2==hy3)) {
                    _this.s=0;
                    return _this;
                    
                  }
                  
                } else {
                  if (_this.pr==4) {
                    hx=hx1+hx2+hx3+hx4;
                    hy=hy1+hy2+hy3+hy4;
                    if (hx==0&&hy==0) {
                      return _this;
                    }
                    if (hx!=0&&(hx1==hx2&&hx2==hx3&&hx3==hx4)) {
                      _this.s=0;
                      return _this;
                      
                    }
                    if (hy!=0&&(hy1==hy2&&hy2==hy3&&hy3==hy4)) {
                      _this.s=0;
                      return _this;
                      
                    }
                    
                  } else {
                    if (_this.pr==5) {
                      hx=hx1+hx2+hx3+hx4+hx5;
                      hy=hy1+hy2+hy3+hy4+hy5;
                      if (hx==0&&hy==0) {
                        return _this;
                      }
                      if (hx!=0&&(hx1==hx2&&hx2==hx3&&hx3==hx4&&hx4==hx5)) {
                        _this.s=0;
                        return _this;
                        
                      }
                      if (hy!=0&&(hy1==hy2&&hy2==hy3&&hy3==hy4&&hy4==hy5)) {
                        _this.s=0;
                        return _this;
                        
                      }
                      
                    }
                  }
                }
                if (Tonyu.globals.$TD_Z_hamidasiSyusei==0) {
                  return _this;
                }
                if (_this.dpA.length) {
                  _this.dpA.splice(0);
                }
                if (_this.dpAsw.length) {
                  _this.dpAsw.splice(0);
                }
                if (_this.s==1) {
                  _this.dp1.xySetP(_this.p1);
                  _this.dp2.xySetP(_this.p2);
                  _this.dp3.xySetP(_this.p3);
                  if (_this.pr>=4) {
                    _this.dp4.xySetP(_this.p4);
                  }
                  
                }
                if (_this.pr>=5) {
                  _this.dp10.xySetP(_this.dp5);
                  _this.dp9.xySetP(_this.dp5);
                  
                }
                if (_this.pr>=4) {
                  _this.dp8.xySetP(_this.dp4);
                  _this.dp7.xySetP(_this.dp4);
                  
                }
                _this.dp6.xySetP(_this.dp3);
                _this.dp5.xySetP(_this.dp3);
                _this.dp4.xySetP(_this.dp2);
                _this.dp3.xySetP(_this.dp2);
                _this.dp2.xySetP(_this.dp1);
                hh=_this.hamidasiSyusei_X(_this.dp2,_this.dp3,GL,GR);
                if (hh!=0) {
                  _this.dpAsw.push(_this.dp2);
                  if (hh==2) {
                    _this.dpAsw.push(_this.dp3);
                  }
                  
                }
                hh=_this.hamidasiSyusei_X(_this.dp4,_this.dp5,GL,GR);
                if (hh!=0) {
                  _this.dpAsw.push(_this.dp4);
                  if (hh==2) {
                    _this.dpAsw.push(_this.dp5);
                  }
                  
                }
                if (_this.pr==3) {
                  hh=_this.hamidasiSyusei_X(_this.dp6,_this.dp1,GL,GR);
                  if (hh!=0) {
                    _this.dpAsw.push(_this.dp6);
                    if (hh==2) {
                      _this.dpAsw.push(_this.dp1);
                    }
                    
                  }
                  
                } else {
                  if (_this.pr==4) {
                    hh=_this.hamidasiSyusei_X(_this.dp6,_this.dp7,GL,GR);
                    if (hh!=0) {
                      _this.dpAsw.push(_this.dp6);
                      if (hh==2) {
                        _this.dpAsw.push(_this.dp7);
                      }
                      
                    }
                    hh=_this.hamidasiSyusei_X(_this.dp8,_this.dp1,GL,GR);
                    if (hh!=0) {
                      _this.dpAsw.push(_this.dp8);
                      if (hh==2) {
                        _this.dpAsw.push(_this.dp1);
                      }
                      
                    }
                    
                  } else {
                    if (_this.pr==5) {
                      hh=_this.hamidasiSyusei_X(_this.dp6,_this.dp7,GL,GR);
                      if (hh!=0) {
                        _this.dpAsw.push(_this.dp6);
                        if (hh==2) {
                          _this.dpAsw.push(_this.dp7);
                        }
                        
                      }
                      hh=_this.hamidasiSyusei_X(_this.dp8,_this.dp9,GL,GR);
                      if (hh!=0) {
                        _this.dpAsw.push(_this.dp8);
                        if (hh==2) {
                          _this.dpAsw.push(_this.dp9);
                        }
                        
                      }
                      hh=_this.hamidasiSyusei_X(_this.dp10,_this.dp1,GL,GR);
                      if (hh!=0) {
                        _this.dpAsw.push(_this.dp10);
                        if (hh==2) {
                          _this.dpAsw.push(_this.dp1);
                        }
                        
                      }
                      
                    }
                  }
                }
                ss=_this.dpAsw.length;
                for (i=0; i<ss ; i++) {
                  {
                    pp1=_this.dpAsw[i*2];
                    pp2=_this.cpA[i];
                    pp2.xySetP(pp1);
                    _this.dpAsw.splice(i*2,0,pp2);
                  }
                }
                ss=_this.dpAsw.length;
                for (i=1; i<ss ; i+=2) {
                  {
                    pp1=_this.dpAsw[i%ss];
                    pp2=_this.dpAsw[(i+1)%ss];
                    hh=_this.hamidasiSyusei_Y(pp1,pp2,GU,GD);
                    if (hh!=0) {
                      _this.dpA.push(pp1);
                      if (hh==2) {
                        _this.dpA.push(pp2);
                      }
                      
                    }
                  }
                }
                Tonyu.globals.$printSize=12;
                _this.s=3;
                
              }
              
            }
          }
        }
      },
      fiber$hamidasiSyusei :function* _trc_TD_DR_1_f_hamidasiSyusei(_thread,GL,GU,GR,GD,scaleXDX,scaleYDX) {
        var _this=this;
        var hh;
        var hx;
        var hy;
        var hx1;
        var hy1;
        var hx2;
        var hy2;
        var hx3;
        var hy3;
        var hx4;
        var hy4;
        var hx5;
        var hy5;
        var i;
        var ss;
        var pp1;
        var pp2;
        var cc;
        var width;
        var height;
        
        
        if (! _this.TD_visible) {
          return _this;
        }
        if (_this.s==- 1) {
          return _this;
        }
        if (_this.n==1) {
          cc = Tonyu.globals.$imageList[_this.floor(_this.c||0)];
          
          width = 2;
          height = 2;
          
          if (cc) {
            _this.ccwidth=cc.width;
            _this.ccheight=cc.height;
            
          }
          ss = 1/_this.p1.k;
          
          _this.k1=ss*_this.scaleX*scaleXDX;
          if (scaleYDX) {
            if (_this.scaleY) {
              _this.k2=ss*_this.scaleY*scaleYDX;
            } else {
              _this.k2=ss*_this.scaleX*scaleYDX;
            }
            
          } else {
            if (_this.scaleY) {
              _this.k2=ss*_this.scaleY*scaleXDX;
              
            }
            
          }
          hx=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.p1, GL, GR, _this.abs(_this.ccwidth*_this.k1/2)));
          hy=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.p1, GU, GD, _this.abs(_this.ccheight*_this.k2/2)));
          if (hx!=0||hy!=0) {
            _this.s=0;
          }
          
        } else {
          if (_this.n==2) {
            if (_this.s!=0) {
              if (_this.s==1) {
                hx1=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.p1, GL, GR));
                hy1=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.p1, GU, GD));
                hx2=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.p2, GL, GR));
                hy2=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.p2, GU, GD));
                
              } else {
                if (_this.s==2) {
                  hx1=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.dp1, GL, GR));
                  hy1=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.dp1, GU, GD));
                  hx2=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.dp2, GL, GR));
                  hy2=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.dp2, GU, GD));
                  
                }
              }
              hx=hx1+hx2;
              hy=hy1+hy2;
              if (hx==0&&hy==0) {
                return _this;
              }
              if (hx!=0&&hx1==hx2) {
                _this.s=0;
                return _this;
                
              }
              if (hy!=0&&hy1==hy2) {
                _this.s=0;
                return _this;
                
              }
              if (Tonyu.globals.$TD_Z_hamidasiSyusei==0) {
                return _this;
              }
              if (_this.s==1) {
                _this.dp1.xySetP(_this.p1);
                _this.dp2.xySetP(_this.p2);
                
              }
              _this.s=(yield* _this.fiber$hamidasiSyusei_L(_thread, _this.dp1, _this.dp2, GL, GU, GR, GD));
              
            }
            
          } else {
            if (_this.n==3||_this.n==4) {
              if (_this.s!=0) {
                if (_this.m==3) {
                  if (_this.s==1) {
                    if (_this.p1.xx<_this.p2.xx) {
                      _this.bmpGL=_this.p1.xx;
                    } else {
                      _this.bmpGL=_this.p2.xx;
                    }
                    if (_this.p1.yy<_this.p2.yy) {
                      _this.bmpGU=_this.p1.yy;
                    } else {
                      _this.bmpGU=_this.p2.yy;
                    }
                    if (_this.p1.xx>_this.p2.xx) {
                      _this.bmpGR=_this.p1.xx;
                    } else {
                      _this.bmpGR=_this.p2.xx;
                    }
                    if (_this.p1.yy>_this.p2.yy) {
                      _this.bmpGD=_this.p1.yy;
                    } else {
                      _this.bmpGD=_this.p2.yy;
                    }
                    if (_this.p3.xx<_this.bmpGL) {
                      _this.bmpGL=_this.p3.xx;
                    }
                    if (_this.p3.yy<_this.bmpGU) {
                      _this.bmpGU=_this.p3.yy;
                    }
                    if (_this.p3.xx>_this.bmpGR) {
                      _this.bmpGR=_this.p3.xx;
                    }
                    if (_this.p3.yy>_this.bmpGD) {
                      _this.bmpGD=_this.p3.yy;
                    }
                    if (_this.pr>=4) {
                      if (_this.p4.xx<_this.bmpGL) {
                        _this.bmpGL=_this.p4.xx;
                      }
                      if (_this.p4.yy<_this.bmpGU) {
                        _this.bmpGU=_this.p4.yy;
                      }
                      if (_this.p4.xx>_this.bmpGR) {
                        _this.bmpGR=_this.p4.xx;
                      }
                      if (_this.p4.yy>_this.bmpGD) {
                        _this.bmpGD=_this.p4.yy;
                      }
                      
                    }
                    
                  } else {
                    if (_this.s==2) {
                      if (_this.dp1.xx<_this.dp2.xx) {
                        _this.bmpGL=_this.dp1.xx;
                      } else {
                        _this.bmpGL=_this.dp2.xx;
                      }
                      if (_this.dp1.yy<_this.dp2.yy) {
                        _this.bmpGU=_this.dp1.yy;
                      } else {
                        _this.bmpGU=_this.dp2.yy;
                      }
                      if (_this.dp1.xx>_this.dp2.xx) {
                        _this.bmpGR=_this.dp1.xx;
                      } else {
                        _this.bmpGR=_this.dp2.xx;
                      }
                      if (_this.dp1.yy>_this.dp2.yy) {
                        _this.bmpGD=_this.dp1.yy;
                      } else {
                        _this.bmpGD=_this.dp2.yy;
                      }
                      if (_this.dp3.xx<_this.bmpGL) {
                        _this.bmpGL=_this.dp3.xx;
                      }
                      if (_this.dp3.yy<_this.bmpGU) {
                        _this.bmpGU=_this.dp3.yy;
                      }
                      if (_this.dp3.xx>_this.bmpGR) {
                        _this.bmpGR=_this.dp3.xx;
                      }
                      if (_this.dp3.yy>_this.bmpGD) {
                        _this.bmpGD=_this.dp3.yy;
                      }
                      if (_this.pr>=4) {
                        if (_this.dp4.xx<_this.bmpGL) {
                          _this.bmpGL=_this.dp4.xx;
                        }
                        if (_this.dp4.yy<_this.bmpGU) {
                          _this.bmpGU=_this.dp4.yy;
                        }
                        if (_this.dp4.xx>_this.bmpGR) {
                          _this.bmpGR=_this.dp4.xx;
                        }
                        if (_this.dp4.yy>_this.bmpGD) {
                          _this.bmpGD=_this.dp4.yy;
                        }
                        
                      }
                      if (_this.pr>=5) {
                        if (_this.dp5.xx<_this.bmpGL) {
                          _this.bmpGL=_this.dp5.xx;
                        }
                        if (_this.dp5.yy<_this.bmpGU) {
                          _this.bmpGU=_this.dp5.yy;
                        }
                        if (_this.dp5.xx>_this.bmpGR) {
                          _this.bmpGR=_this.dp5.xx;
                        }
                        if (_this.dp5.yy>_this.bmpGD) {
                          _this.bmpGD=_this.dp5.yy;
                        }
                        
                      }
                      
                    }
                  }
                  
                }
                if (_this.s==1) {
                  hx1=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.p1, GL, GR));
                  hy1=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.p1, GU, GD));
                  hx2=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.p2, GL, GR));
                  hy2=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.p2, GU, GD));
                  hx3=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.p3, GL, GR));
                  hy3=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.p3, GU, GD));
                  if (_this.pr>=4) {
                    hx4=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.p4, GL, GR));
                    hy4=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.p4, GU, GD));
                    
                  }
                  
                } else {
                  if (_this.s==2) {
                    hx1=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.dp1, GL, GR));
                    hy1=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.dp1, GU, GD));
                    hx2=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.dp2, GL, GR));
                    hy2=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.dp2, GU, GD));
                    hx3=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.dp3, GL, GR));
                    hy3=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.dp3, GU, GD));
                    if (_this.pr>=4) {
                      hx4=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.dp4, GL, GR));
                      hy4=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.dp4, GU, GD));
                      
                    }
                    if (_this.pr>=5) {
                      hx5=(yield* _this.fiber$hamidasiSyusei_hantei_X(_thread, _this.dp5, GL, GR));
                      hy5=(yield* _this.fiber$hamidasiSyusei_hantei_Y(_thread, _this.dp5, GU, GD));
                      
                    }
                    
                  }
                }
                if (_this.pr==3) {
                  hx=hx1+hx2+hx3;
                  hy=hy1+hy2+hy3;
                  if (hx==0&&hy==0) {
                    return _this;
                  }
                  if (hx!=0&&(hx1==hx2&&hx2==hx3)) {
                    _this.s=0;
                    return _this;
                    
                  }
                  if (hy!=0&&(hy1==hy2&&hy2==hy3)) {
                    _this.s=0;
                    return _this;
                    
                  }
                  
                } else {
                  if (_this.pr==4) {
                    hx=hx1+hx2+hx3+hx4;
                    hy=hy1+hy2+hy3+hy4;
                    if (hx==0&&hy==0) {
                      return _this;
                    }
                    if (hx!=0&&(hx1==hx2&&hx2==hx3&&hx3==hx4)) {
                      _this.s=0;
                      return _this;
                      
                    }
                    if (hy!=0&&(hy1==hy2&&hy2==hy3&&hy3==hy4)) {
                      _this.s=0;
                      return _this;
                      
                    }
                    
                  } else {
                    if (_this.pr==5) {
                      hx=hx1+hx2+hx3+hx4+hx5;
                      hy=hy1+hy2+hy3+hy4+hy5;
                      if (hx==0&&hy==0) {
                        return _this;
                      }
                      if (hx!=0&&(hx1==hx2&&hx2==hx3&&hx3==hx4&&hx4==hx5)) {
                        _this.s=0;
                        return _this;
                        
                      }
                      if (hy!=0&&(hy1==hy2&&hy2==hy3&&hy3==hy4&&hy4==hy5)) {
                        _this.s=0;
                        return _this;
                        
                      }
                      
                    }
                  }
                }
                if (Tonyu.globals.$TD_Z_hamidasiSyusei==0) {
                  return _this;
                }
                if (_this.dpA.length) {
                  _this.dpA.splice(0);
                }
                if (_this.dpAsw.length) {
                  _this.dpAsw.splice(0);
                }
                if (_this.s==1) {
                  _this.dp1.xySetP(_this.p1);
                  _this.dp2.xySetP(_this.p2);
                  _this.dp3.xySetP(_this.p3);
                  if (_this.pr>=4) {
                    _this.dp4.xySetP(_this.p4);
                  }
                  
                }
                if (_this.pr>=5) {
                  _this.dp10.xySetP(_this.dp5);
                  _this.dp9.xySetP(_this.dp5);
                  
                }
                if (_this.pr>=4) {
                  _this.dp8.xySetP(_this.dp4);
                  _this.dp7.xySetP(_this.dp4);
                  
                }
                _this.dp6.xySetP(_this.dp3);
                _this.dp5.xySetP(_this.dp3);
                _this.dp4.xySetP(_this.dp2);
                _this.dp3.xySetP(_this.dp2);
                _this.dp2.xySetP(_this.dp1);
                hh=(yield* _this.fiber$hamidasiSyusei_X(_thread, _this.dp2, _this.dp3, GL, GR));
                if (hh!=0) {
                  _this.dpAsw.push(_this.dp2);
                  if (hh==2) {
                    _this.dpAsw.push(_this.dp3);
                  }
                  
                }
                hh=(yield* _this.fiber$hamidasiSyusei_X(_thread, _this.dp4, _this.dp5, GL, GR));
                if (hh!=0) {
                  _this.dpAsw.push(_this.dp4);
                  if (hh==2) {
                    _this.dpAsw.push(_this.dp5);
                  }
                  
                }
                if (_this.pr==3) {
                  hh=(yield* _this.fiber$hamidasiSyusei_X(_thread, _this.dp6, _this.dp1, GL, GR));
                  if (hh!=0) {
                    _this.dpAsw.push(_this.dp6);
                    if (hh==2) {
                      _this.dpAsw.push(_this.dp1);
                    }
                    
                  }
                  
                } else {
                  if (_this.pr==4) {
                    hh=(yield* _this.fiber$hamidasiSyusei_X(_thread, _this.dp6, _this.dp7, GL, GR));
                    if (hh!=0) {
                      _this.dpAsw.push(_this.dp6);
                      if (hh==2) {
                        _this.dpAsw.push(_this.dp7);
                      }
                      
                    }
                    hh=(yield* _this.fiber$hamidasiSyusei_X(_thread, _this.dp8, _this.dp1, GL, GR));
                    if (hh!=0) {
                      _this.dpAsw.push(_this.dp8);
                      if (hh==2) {
                        _this.dpAsw.push(_this.dp1);
                      }
                      
                    }
                    
                  } else {
                    if (_this.pr==5) {
                      hh=(yield* _this.fiber$hamidasiSyusei_X(_thread, _this.dp6, _this.dp7, GL, GR));
                      if (hh!=0) {
                        _this.dpAsw.push(_this.dp6);
                        if (hh==2) {
                          _this.dpAsw.push(_this.dp7);
                        }
                        
                      }
                      hh=(yield* _this.fiber$hamidasiSyusei_X(_thread, _this.dp8, _this.dp9, GL, GR));
                      if (hh!=0) {
                        _this.dpAsw.push(_this.dp8);
                        if (hh==2) {
                          _this.dpAsw.push(_this.dp9);
                        }
                        
                      }
                      hh=(yield* _this.fiber$hamidasiSyusei_X(_thread, _this.dp10, _this.dp1, GL, GR));
                      if (hh!=0) {
                        _this.dpAsw.push(_this.dp10);
                        if (hh==2) {
                          _this.dpAsw.push(_this.dp1);
                        }
                        
                      }
                      
                    }
                  }
                }
                ss=_this.dpAsw.length;
                for (i=0; i<ss ; i++) {
                  {
                    pp1=_this.dpAsw[i*2];
                    pp2=_this.cpA[i];
                    pp2.xySetP(pp1);
                    _this.dpAsw.splice(i*2,0,pp2);
                  }
                }
                ss=_this.dpAsw.length;
                for (i=1; i<ss ; i+=2) {
                  {
                    pp1=_this.dpAsw[i%ss];
                    pp2=_this.dpAsw[(i+1)%ss];
                    hh=(yield* _this.fiber$hamidasiSyusei_Y(_thread, pp1, pp2, GU, GD));
                    if (hh!=0) {
                      _this.dpA.push(pp1);
                      if (hh==2) {
                        _this.dpA.push(pp2);
                      }
                      
                    }
                  }
                }
                Tonyu.globals.$printSize=12;
                _this.s=3;
                
              }
              
            }
          }
        }
        
      },
      hamidasiSyusei_hantei_X :function _trc_TD_DR_1_hamidasiSyusei_hantei_X(p1,GL,GR,out) {
        var _this=this;
        
        if (out==null) {
          out=0;
        }
        if (p1.xx<GL-out) {
          return 1;
        } else {
          if (p1.xx>GR+out) {
            return 2;
          } else {
            return 0;
          }
        }
      },
      fiber$hamidasiSyusei_hantei_X :function* _trc_TD_DR_1_f_hamidasiSyusei_hantei_X(_thread,p1,GL,GR,out) {
        var _this=this;
        
        if (out==null) {
          out=0;
        }
        if (p1.xx<GL-out) {
          return 1;
        } else {
          if (p1.xx>GR+out) {
            return 2;
          } else {
            return 0;
          }
        }
        
      },
      hamidasiSyusei_hantei_Y :function _trc_TD_DR_1_hamidasiSyusei_hantei_Y(p1,GU,GD,out) {
        var _this=this;
        
        if (out==null) {
          out=0;
        }
        if (p1.yy<GU-out) {
          return 1;
        } else {
          if (p1.yy>GD+out) {
            return 2;
          } else {
            return 0;
          }
        }
      },
      fiber$hamidasiSyusei_hantei_Y :function* _trc_TD_DR_1_f_hamidasiSyusei_hantei_Y(_thread,p1,GU,GD,out) {
        var _this=this;
        
        if (out==null) {
          out=0;
        }
        if (p1.yy<GU-out) {
          return 1;
        } else {
          if (p1.yy>GD+out) {
            return 2;
          } else {
            return 0;
          }
        }
        
      },
      hamidasiSyusei_L :function _trc_TD_DR_1_hamidasiSyusei_L(p1,p2,GL,GU,GR,GD) {
        var _this=this;
        var w;
        var s1_x;
        var s2_x;
        var s1_y;
        var s2_y;
        
        
        if (p1.xx<GL) {
          s1_x=1;
        } else {
          if (p1.xx>GR) {
            s1_x=2;
          } else {
            s1_x=0;
          }
        }
        if (p2.xx<GL) {
          s2_x=1;
        } else {
          if (p2.xx>GR) {
            s2_x=2;
          } else {
            s2_x=0;
          }
        }
        if (p1.yy<GU) {
          s1_y=1;
        } else {
          if (p1.yy>GD) {
            s1_y=2;
          } else {
            s1_y=0;
          }
        }
        if (p2.yy<GU) {
          s2_y=1;
        } else {
          if (p2.yy>GD) {
            s2_y=2;
          } else {
            s2_y=0;
          }
        }
        if ((s1_x+s2_x==0)&&(s1_y+s2_y==0)) {
          return 1;
        }
        if ((s1_x!=0&&s2_x!=0)&&s1_x==s2_x) {
          return 0;
        }
        if ((s1_y!=0&&s2_y!=0)&&s1_y==s2_y) {
          return 0;
        }
        if (! (s1_x==0&&s2_x==0)&&(p2.xx-p1.xx)!=0) {
          if (s1_x==1) {
            w=(GL-p1.xx)/(p2.xx-p1.xx);
            p1.yy+=(p2.yy-p1.yy)*w;
            p1.xx=GL;
            
          } else {
            if (s1_x==2) {
              w=(p1.xx-GR)/(p1.xx-p2.xx);
              p1.yy+=(p2.yy-p1.yy)*w;
              p1.xx=GR;
              
            }
          }
          if (s2_x==1) {
            w=(GL-p2.xx)/(p1.xx-p2.xx);
            p2.yy+=(p1.yy-p2.yy)*w;
            p2.xx=GL;
            
          } else {
            if (s2_x==2) {
              w=(p2.xx-GR)/(p2.xx-p1.xx);
              p2.yy+=(p1.yy-p2.yy)*w;
              p2.xx=GR;
              
            }
          }
          if (p1.yy<GU) {
            s1_y=1;
          } else {
            if (p1.yy>GD) {
              s1_y=2;
            } else {
              s1_y=0;
            }
          }
          if (p2.yy<GU) {
            s2_y=1;
          } else {
            if (p2.yy>GD) {
              s2_y=2;
            } else {
              s2_y=0;
            }
          }
          if (! (s1_y==0||s2_y==0)&&s1_y==s2_y) {
            return 0;
          }
          
        }
        if (! (s1_y==0&&s2_y==0)&&(p2.yy-p1.yy)!=0) {
          if (s1_y==1) {
            w=(GU-p1.yy)/(p2.yy-p1.yy);
            p1.xx+=(p2.xx-p1.xx)*w;
            p1.yy=GU;
            
          } else {
            if (s1_y==2) {
              w=(p1.yy-GD)/(p1.yy-p2.yy);
              p1.xx+=(p2.xx-p1.xx)*w;
              p1.yy=GD;
              
            }
          }
          if (s2_y==1) {
            w=(GU-p2.yy)/(p1.yy-p2.yy);
            p2.xx+=(p1.xx-p2.xx)*w;
            p2.yy=GU;
            
          } else {
            if (s2_y==2) {
              w=(p2.yy-GD)/(p2.yy-p1.yy);
              p2.xx+=(p1.xx-p2.xx)*w;
              p2.yy=GD;
              
            }
          }
          
        }
        return 3;
      },
      fiber$hamidasiSyusei_L :function* _trc_TD_DR_1_f_hamidasiSyusei_L(_thread,p1,p2,GL,GU,GR,GD) {
        var _this=this;
        var w;
        var s1_x;
        var s2_x;
        var s1_y;
        var s2_y;
        
        
        if (p1.xx<GL) {
          s1_x=1;
        } else {
          if (p1.xx>GR) {
            s1_x=2;
          } else {
            s1_x=0;
          }
        }
        if (p2.xx<GL) {
          s2_x=1;
        } else {
          if (p2.xx>GR) {
            s2_x=2;
          } else {
            s2_x=0;
          }
        }
        if (p1.yy<GU) {
          s1_y=1;
        } else {
          if (p1.yy>GD) {
            s1_y=2;
          } else {
            s1_y=0;
          }
        }
        if (p2.yy<GU) {
          s2_y=1;
        } else {
          if (p2.yy>GD) {
            s2_y=2;
          } else {
            s2_y=0;
          }
        }
        if ((s1_x+s2_x==0)&&(s1_y+s2_y==0)) {
          return 1;
        }
        if ((s1_x!=0&&s2_x!=0)&&s1_x==s2_x) {
          return 0;
        }
        if ((s1_y!=0&&s2_y!=0)&&s1_y==s2_y) {
          return 0;
        }
        if (! (s1_x==0&&s2_x==0)&&(p2.xx-p1.xx)!=0) {
          if (s1_x==1) {
            w=(GL-p1.xx)/(p2.xx-p1.xx);
            p1.yy+=(p2.yy-p1.yy)*w;
            p1.xx=GL;
            
          } else {
            if (s1_x==2) {
              w=(p1.xx-GR)/(p1.xx-p2.xx);
              p1.yy+=(p2.yy-p1.yy)*w;
              p1.xx=GR;
              
            }
          }
          if (s2_x==1) {
            w=(GL-p2.xx)/(p1.xx-p2.xx);
            p2.yy+=(p1.yy-p2.yy)*w;
            p2.xx=GL;
            
          } else {
            if (s2_x==2) {
              w=(p2.xx-GR)/(p2.xx-p1.xx);
              p2.yy+=(p1.yy-p2.yy)*w;
              p2.xx=GR;
              
            }
          }
          if (p1.yy<GU) {
            s1_y=1;
          } else {
            if (p1.yy>GD) {
              s1_y=2;
            } else {
              s1_y=0;
            }
          }
          if (p2.yy<GU) {
            s2_y=1;
          } else {
            if (p2.yy>GD) {
              s2_y=2;
            } else {
              s2_y=0;
            }
          }
          if (! (s1_y==0||s2_y==0)&&s1_y==s2_y) {
            return 0;
          }
          
        }
        if (! (s1_y==0&&s2_y==0)&&(p2.yy-p1.yy)!=0) {
          if (s1_y==1) {
            w=(GU-p1.yy)/(p2.yy-p1.yy);
            p1.xx+=(p2.xx-p1.xx)*w;
            p1.yy=GU;
            
          } else {
            if (s1_y==2) {
              w=(p1.yy-GD)/(p1.yy-p2.yy);
              p1.xx+=(p2.xx-p1.xx)*w;
              p1.yy=GD;
              
            }
          }
          if (s2_y==1) {
            w=(GU-p2.yy)/(p1.yy-p2.yy);
            p2.xx+=(p1.xx-p2.xx)*w;
            p2.yy=GU;
            
          } else {
            if (s2_y==2) {
              w=(p2.yy-GD)/(p2.yy-p1.yy);
              p2.xx+=(p1.xx-p2.xx)*w;
              p2.yy=GD;
              
            }
          }
          
        }
        return 3;
        
      },
      hamidasiSyusei_X :function _trc_TD_DR_1_hamidasiSyusei_X(p1,p2,GL,GR) {
        var _this=this;
        var w;
        var s1_x;
        var s2_x;
        
        
        if (p1.xx<GL) {
          s1_x=1;
        } else {
          if (p1.xx>GR) {
            s1_x=2;
          } else {
            s1_x=0;
          }
        }
        if (p2.xx<GL) {
          s2_x=1;
        } else {
          if (p2.xx>GR) {
            s2_x=2;
          } else {
            s2_x=0;
          }
        }
        if ((s1_x!=0&&s2_x!=0)&&s1_x==s2_x) {
          return 0;
        }
        if (! (s1_x==0&&s2_x==0)&&(p2.xx-p1.xx)!=0) {
          if (s1_x==1) {
            w=(GL-p1.xx)/(p2.xx-p1.xx);
            p1.yy+=(p2.yy-p1.yy)*w;
            p1.xx=GL;
            
          } else {
            if (s1_x==2) {
              w=(p1.xx-GR)/(p1.xx-p2.xx);
              p1.yy+=(p2.yy-p1.yy)*w;
              p1.xx=GR;
              
            }
          }
          if (s2_x==1) {
            w=(GL-p2.xx)/(p1.xx-p2.xx);
            p2.yy+=(p1.yy-p2.yy)*w;
            p2.xx=GL;
            
          } else {
            if (s2_x==2) {
              w=(p2.xx-GR)/(p2.xx-p1.xx);
              p2.yy+=(p1.yy-p2.yy)*w;
              p2.xx=GR;
              
            }
          }
          
        }
        return (1+(s2_x!=0));
      },
      fiber$hamidasiSyusei_X :function* _trc_TD_DR_1_f_hamidasiSyusei_X(_thread,p1,p2,GL,GR) {
        var _this=this;
        var w;
        var s1_x;
        var s2_x;
        
        
        if (p1.xx<GL) {
          s1_x=1;
        } else {
          if (p1.xx>GR) {
            s1_x=2;
          } else {
            s1_x=0;
          }
        }
        if (p2.xx<GL) {
          s2_x=1;
        } else {
          if (p2.xx>GR) {
            s2_x=2;
          } else {
            s2_x=0;
          }
        }
        if ((s1_x!=0&&s2_x!=0)&&s1_x==s2_x) {
          return 0;
        }
        if (! (s1_x==0&&s2_x==0)&&(p2.xx-p1.xx)!=0) {
          if (s1_x==1) {
            w=(GL-p1.xx)/(p2.xx-p1.xx);
            p1.yy+=(p2.yy-p1.yy)*w;
            p1.xx=GL;
            
          } else {
            if (s1_x==2) {
              w=(p1.xx-GR)/(p1.xx-p2.xx);
              p1.yy+=(p2.yy-p1.yy)*w;
              p1.xx=GR;
              
            }
          }
          if (s2_x==1) {
            w=(GL-p2.xx)/(p1.xx-p2.xx);
            p2.yy+=(p1.yy-p2.yy)*w;
            p2.xx=GL;
            
          } else {
            if (s2_x==2) {
              w=(p2.xx-GR)/(p2.xx-p1.xx);
              p2.yy+=(p1.yy-p2.yy)*w;
              p2.xx=GR;
              
            }
          }
          
        }
        return (1+(s2_x!=0));
        
      },
      hamidasiSyusei_Y :function _trc_TD_DR_1_hamidasiSyusei_Y(p1,p2,GU,GD) {
        var _this=this;
        var w;
        var s1_y;
        var s2_y;
        
        
        if (p1.yy<GU) {
          s1_y=1;
        } else {
          if (p1.yy>GD) {
            s1_y=2;
          } else {
            s1_y=0;
          }
        }
        if (p2.yy<GU) {
          s2_y=1;
        } else {
          if (p2.yy>GD) {
            s2_y=2;
          } else {
            s2_y=0;
          }
        }
        if ((s1_y!=0&&s2_y!=0)&&s1_y==s2_y) {
          return 0;
        }
        if (! (s1_y==0&&s2_y==0)&&(p2.yy-p1.yy)!=0) {
          if (s1_y==1) {
            w=(GU-p1.yy)/(p2.yy-p1.yy);
            p1.xx+=(p2.xx-p1.xx)*w;
            p1.yy=GU;
            
          } else {
            if (s1_y==2) {
              w=(p1.yy-GD)/(p1.yy-p2.yy);
              p1.xx+=(p2.xx-p1.xx)*w;
              p1.yy=GD;
              
            }
          }
          if (s2_y==1) {
            w=(GU-p2.yy)/(p1.yy-p2.yy);
            p2.xx+=(p1.xx-p2.xx)*w;
            p2.yy=GU;
            
          } else {
            if (s2_y==2) {
              w=(p2.yy-GD)/(p2.yy-p1.yy);
              p2.xx+=(p1.xx-p2.xx)*w;
              p2.yy=GD;
              
            }
          }
          
        }
        return (1+(s2_y!=0));
      },
      fiber$hamidasiSyusei_Y :function* _trc_TD_DR_1_f_hamidasiSyusei_Y(_thread,p1,p2,GU,GD) {
        var _this=this;
        var w;
        var s1_y;
        var s2_y;
        
        
        if (p1.yy<GU) {
          s1_y=1;
        } else {
          if (p1.yy>GD) {
            s1_y=2;
          } else {
            s1_y=0;
          }
        }
        if (p2.yy<GU) {
          s2_y=1;
        } else {
          if (p2.yy>GD) {
            s2_y=2;
          } else {
            s2_y=0;
          }
        }
        if ((s1_y!=0&&s2_y!=0)&&s1_y==s2_y) {
          return 0;
        }
        if (! (s1_y==0&&s2_y==0)&&(p2.yy-p1.yy)!=0) {
          if (s1_y==1) {
            w=(GU-p1.yy)/(p2.yy-p1.yy);
            p1.xx+=(p2.xx-p1.xx)*w;
            p1.yy=GU;
            
          } else {
            if (s1_y==2) {
              w=(p1.yy-GD)/(p1.yy-p2.yy);
              p1.xx+=(p2.xx-p1.xx)*w;
              p1.yy=GD;
              
            }
          }
          if (s2_y==1) {
            w=(GU-p2.yy)/(p1.yy-p2.yy);
            p2.xx+=(p1.xx-p2.xx)*w;
            p2.yy=GU;
            
          } else {
            if (s2_y==2) {
              w=(p2.yy-GD)/(p2.yy-p1.yy);
              p2.xx+=(p1.xx-p2.xx)*w;
              p2.yy=GD;
              
            }
          }
          
        }
        return (1+(s2_y!=0));
        
      },
      paintHantei :function _trc_TD_DR_1_paintHantei(sp1,up,sp2) {
        var _this=this;
        
        if (sp1.xx<up.xx||sp2.xx<up.xx) {
          up.xx--;
        }
        if (sp1.yy<up.yy||sp2.yy<up.yy) {
          up.yy--;
        }
      },
      fiber$paintHantei :function* _trc_TD_DR_1_f_paintHantei(_thread,sp1,up,sp2) {
        var _this=this;
        
        if (sp1.xx<up.xx||sp2.xx<up.xx) {
          up.xx--;
        }
        if (sp1.yy<up.yy||sp2.yy<up.yy) {
          up.yy--;
        }
        
      },
      fillPolygonP :function _trc_TD_DR_1_fillPolygonP(panel,x,y,points,col) {
        var _this=this;
        var ctx;
        var i;
        var p;
        
        
        points=_this.setPolygonTempAry;
        ctx=panel.getContext();
        ctx.save();
        ctx.fillStyle=col+"";
        ctx.beginPath();
        for (i = 0;
         i<points.length ; i++) {
          {
            p = points[i];
            
            if (i==0) {
              ctx.moveTo(x+p.x,y+p.y);
            } else {
              ctx.lineTo(x+p.x,y+p.y);
            }
          }
        }
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"backFaceCulling":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"merikomiSyusei":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"merikomiSyusei_L":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"merikomiSyusei_T":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null],"returnValue":null}},"merikomiSyusei_S":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null],"returnValue":null}},"hamidasiSyusei":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"hamidasiSyusei_hantei_X":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"hamidasiSyusei_hantei_Y":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"hamidasiSyusei_L":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null],"returnValue":null}},"hamidasiSyusei_X":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"hamidasiSyusei_Y":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}},"paintHantei":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"fillPolygonP":{"nowait":true,"isMain":false,"vtype":{"params":[null,null,null,null,null],"returnValue":null}}},"fields":{"TD_visible":{},"s":{},"n":{},"ep":{},"p1":{},"p2":{},"p3":{},"p4":{},"zo":{},"zo2":{},"zo3":{},"zo4":{},"np":{},"zt":{},"zosx":{},"zosy":{},"zosz":{},"pr":{},"dp1":{},"dp2":{},"dp3":{},"dp4":{},"dp5":{},"dp6":{},"dp7":{},"dp8":{},"dp9":{},"dp10":{},"c":{},"ccwidth":{},"ccheight":{},"m":{},"bmpGL":{},"bmpGU":{},"bmpGR":{},"bmpGD":{},"dpA":{},"dpAsw":{},"cpA":{},"setPolygonTempAry":{},"f":{},"angle":{},"LR":{},"UD":{},"xx":{},"yy":{},"h":{},"paint":{},"ss":{},"k1":{},"k2":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TD_PS',
  shortName: 'TD_PS',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.PlainChar,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_TD_PS_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_TD_PS_f_main(_thread) {
        var _this=this;
        
        
      },
      run :function _trc_TD_PS_run() {
        var _this=this;
        var i;
        
        if (Tonyu.globals.$TD_M_M==0) {
          if (Tonyu.globals.$TD_M_multiGamen==0) {
            Tonyu.globals.$TD_Z.RSC();
            Tonyu.globals.$TD_Z.GKK();
            Tonyu.globals.$TD_M_M++;
            
          } else {
            if (Tonyu.globals.$TD_M_multiGamen==1) {
              if (Tonyu.globals.$TD_M_ACM_I>=Tonyu.globals.$TD_M_ACM_S) {
                Tonyu.globals.$TD_M_EOF=1;
                Tonyu.globals.$TD_M_M=6;
                
              } else {
                Tonyu.globals.$TD_M_CM=Tonyu.globals.$TD_M_ACM[Tonyu.globals.$TD_M_ACM_I];
                if (Tonyu.globals.$TD_M_CM.TD_visible) {
                  Tonyu.globals.$TD_M_CM.cameraMain();
                  Tonyu.globals.$TD_Z.RSC();
                  Tonyu.globals.$TD_Z.GKK(Tonyu.globals.$TD_G_GL,Tonyu.globals.$TD_G_GU,Tonyu.globals.$TD_G_GR,Tonyu.globals.$TD_G_GD);
                  Tonyu.globals.$TD_M_M++;
                  
                }
                Tonyu.globals.$TD_M_ACM_I++;
                Tonyu.globals.$TD_M_A3D_I=0;
                
              }
              
            }
          }
          
        }
        if (Tonyu.globals.$TD_M_M==1) {
          for (i = 0;
           i<Tonyu.globals.$TD_M_syoriMax ; i++) {
            {
              if (Tonyu.globals.$TD_M_AP_I==0) {
                if (Tonyu.globals.$TD_M_A3D_I>=Tonyu.globals.$TD_M_A3D_S) {
                  Tonyu.globals.$TD_M_EOF=1;
                  Tonyu.globals.$TD_M_M++;
                  Tonyu.globals.$TD_M_A3D_I=0;
                  break;
                  
                  
                }
                Tonyu.globals.$TD_M_O=Tonyu.globals.$TD_M_A3D[Tonyu.globals.$TD_M_A3D_I];
                Tonyu.globals.$TD_M_AP_S=Tonyu.globals.$TD_M_O.TD_AP.length;
                if (Tonyu.globals.$TD_M_O.TD_visible==0) {
                  Tonyu.globals.$TD_M_AP_I=Tonyu.globals.$TD_M_AP_S;
                  
                } else {
                  Tonyu.globals.$TD_M_O.RSC();
                  
                }
                
              }
              if (Tonyu.globals.$TD_M_AP_I<Tonyu.globals.$TD_M_AP_S) {
                Tonyu.globals.$TD_M_O.TD_AP[Tonyu.globals.$TD_M_AP_I].kaiten(Tonyu.globals.$TD_M_O.TD_x,Tonyu.globals.$TD_M_O.TD_y,Tonyu.globals.$TD_M_O.TD_z,Tonyu.globals.$TD_M_O.TD_angleX,Tonyu.globals.$TD_M_O.TD_angleY,Tonyu.globals.$TD_M_O.TD_angleZ,Tonyu.globals.$TD_M_O.TD_angleXZ,Tonyu.globals.$TD_M_O.TD_angleYZ,Tonyu.globals.$TD_M_O.TD_angleXY,Tonyu.globals.$TD_M_O.TD_xzsin,Tonyu.globals.$TD_M_O.TD_yzsin,Tonyu.globals.$TD_M_O.TD_xysin,Tonyu.globals.$TD_M_O.TD_xzcos,Tonyu.globals.$TD_M_O.TD_yzcos,Tonyu.globals.$TD_M_O.TD_xycos,Tonyu.globals.$TD_Z_x,Tonyu.globals.$TD_Z_y,Tonyu.globals.$TD_Z_z,Tonyu.globals.$TD_K_xzsin,Tonyu.globals.$TD_K_yzsin,Tonyu.globals.$TD_K_xysin,Tonyu.globals.$TD_K_xzcos,Tonyu.globals.$TD_K_yzcos,Tonyu.globals.$TD_K_xycos);
                Tonyu.globals.$TD_M_AP_I++;
                
              }
              if (Tonyu.globals.$TD_M_AP_I>=Tonyu.globals.$TD_M_AP_S) {
                Tonyu.globals.$TD_M_AP_I=0;
                Tonyu.globals.$TD_M_A3D_I++;
                
              }
            }
          }
          
        }
        if (Tonyu.globals.$TD_M_M==2) {
          for (i=0; i<Tonyu.globals.$TD_M_syoriMax ; i++) {
            {
              if (Tonyu.globals.$TD_M_ADR_I==0) {
                if (Tonyu.globals.$TD_M_A3D_I>=Tonyu.globals.$TD_M_A3D_S) {
                  Tonyu.globals.$TD_M_EOF=1;
                  Tonyu.globals.$TD_M_M++;
                  Tonyu.globals.$TD_M_A3D_I=0;
                  break;
                  
                  
                }
                Tonyu.globals.$TD_M_O=Tonyu.globals.$TD_M_A3D[Tonyu.globals.$TD_M_A3D_I];
                Tonyu.globals.$TD_M_ADR_S=Tonyu.globals.$TD_M_O.TD_ADR.length;
                if (Tonyu.globals.$TD_M_O.TD_visible==0) {
                  Tonyu.globals.$TD_M_ADR_I=Tonyu.globals.$TD_M_ADR_S;
                  
                }
                
              }
              if (Tonyu.globals.$TD_M_ADR_I<Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_O.TD_ADR[Tonyu.globals.$TD_M_ADR_I].merikomiSyusei(Tonyu.globals.$TD_K_k,Tonyu.globals.$TD_Z_k,Tonyu.globals.$TD_K_hw,Tonyu.globals.$TD_K_hh);
                Tonyu.globals.$TD_M_ADR_I++;
                
              }
              if (Tonyu.globals.$TD_M_ADR_I>=Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_ADR_I=0;
                Tonyu.globals.$TD_M_A3D_I++;
                
              }
            }
          }
          
        }
        if (Tonyu.globals.$TD_M_M==3) {
          for (i=0; i<Tonyu.globals.$TD_M_syoriMax ; i++) {
            {
              if (Tonyu.globals.$TD_M_AP_I==0) {
                if (Tonyu.globals.$TD_M_A3D_I>=Tonyu.globals.$TD_M_A3D_S) {
                  Tonyu.globals.$TD_M_EOF=1;
                  Tonyu.globals.$TD_M_M++;
                  Tonyu.globals.$TD_M_A3D_I=0;
                  break;
                  
                  
                }
                Tonyu.globals.$TD_M_O=Tonyu.globals.$TD_M_A3D[Tonyu.globals.$TD_M_A3D_I];
                Tonyu.globals.$TD_M_AP_S=Tonyu.globals.$TD_M_O.TD_AP.length;
                if (Tonyu.globals.$TD_M_O.TD_visible==0) {
                  Tonyu.globals.$TD_M_AP_I=Tonyu.globals.$TD_M_AP_S;
                  
                }
                
              }
              if (Tonyu.globals.$TD_M_AP_I<Tonyu.globals.$TD_M_AP_S) {
                Tonyu.globals.$TD_M_O.TD_AP[Tonyu.globals.$TD_M_AP_I].henkan2D(Tonyu.globals.$TD_K_k,Tonyu.globals.$TD_Z_k,Tonyu.globals.$TD_K_hw,Tonyu.globals.$TD_K_hh);
                Tonyu.globals.$TD_M_AP_I++;
                
              }
              if (Tonyu.globals.$TD_M_AP_I>=Tonyu.globals.$TD_M_AP_S) {
                Tonyu.globals.$TD_M_AP_I=0;
                Tonyu.globals.$TD_M_A3D_I++;
                
              }
            }
          }
          
        }
        if (Tonyu.globals.$TD_M_M==4) {
          for (i=0; i<Tonyu.globals.$TD_M_syoriMax ; i++) {
            {
              if (Tonyu.globals.$TD_M_ADR_I==0) {
                if (Tonyu.globals.$TD_M_A3D_I>=Tonyu.globals.$TD_M_A3D_S) {
                  Tonyu.globals.$TD_M_EOF=1;
                  Tonyu.globals.$TD_M_M++;
                  Tonyu.globals.$TD_M_A3D_I=0;
                  break;
                  
                  
                }
                Tonyu.globals.$TD_M_O=Tonyu.globals.$TD_M_A3D[Tonyu.globals.$TD_M_A3D_I];
                Tonyu.globals.$TD_M_ADR_S=Tonyu.globals.$TD_M_O.TD_ADR.length;
                if (Tonyu.globals.$TD_M_O.TD_visible==0) {
                  Tonyu.globals.$TD_M_ADR_I=Tonyu.globals.$TD_M_ADR_S;
                  
                }
                
              }
              if (Tonyu.globals.$TD_M_ADR_I<Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_O.TD_ADR[Tonyu.globals.$TD_M_ADR_I].hamidasiSyusei(Tonyu.globals.$TD_G_GL,Tonyu.globals.$TD_G_GU,Tonyu.globals.$TD_G_GR,Tonyu.globals.$TD_G_GD);
                Tonyu.globals.$TD_M_ADR_I++;
                
              }
              if (Tonyu.globals.$TD_M_ADR_I>=Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_ADR_I=0;
                Tonyu.globals.$TD_M_A3D_I++;
                
              }
            }
          }
          
        }
        if (Tonyu.globals.$TD_M_M==5) {
          for (i=0; i<Tonyu.globals.$TD_M_syoriMax ; i++) {
            {
              if (Tonyu.globals.$TD_M_ADR_I==0) {
                if (Tonyu.globals.$TD_M_A3D_I>=Tonyu.globals.$TD_M_A3D_S) {
                  Tonyu.globals.$TD_M_EOF=1;
                  if (Tonyu.globals.$TD_M_multiGamen==1) {
                    Tonyu.globals.$TD_M_M=0;
                  } else {
                    Tonyu.globals.$TD_M_M++;
                  }
                  Tonyu.globals.$TD_M_A3D_I=0;
                  break;
                  
                  
                }
                Tonyu.globals.$TD_M_O=Tonyu.globals.$TD_M_A3D[Tonyu.globals.$TD_M_A3D_I];
                Tonyu.globals.$TD_M_ADR_S=Tonyu.globals.$TD_M_O.TD_ADR.length;
                if (Tonyu.globals.$TD_M_O.TD_visible==0) {
                  Tonyu.globals.$TD_M_ADR_I=Tonyu.globals.$TD_M_ADR_S;
                  
                }
                
              }
              if (Tonyu.globals.$TD_M_ADR_I<Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_O.TD_ADR[Tonyu.globals.$TD_M_ADR_I].ZukeiDraw(Tonyu.globals.$TD_M_O.TD_angleDX,Tonyu.globals.$TD_M_O.TD_alphaDX,Tonyu.globals.$TD_M_O.TD_scaleXDX,Tonyu.globals.$TD_M_O.TD_scaleYDX);
                Tonyu.globals.$TD_M_ADR_I++;
                
              }
              if (Tonyu.globals.$TD_M_ADR_I>=Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_A3D_I++;
                Tonyu.globals.$TD_M_ADR_I=0;
                
              }
            }
          }
          
        }
      },
      fiber$run :function* _trc_TD_PS_f_run(_thread) {
        var _this=this;
        var i;
        
        if (Tonyu.globals.$TD_M_M==0) {
          if (Tonyu.globals.$TD_M_multiGamen==0) {
            Tonyu.globals.$TD_Z.RSC();
            Tonyu.globals.$TD_Z.GKK();
            Tonyu.globals.$TD_M_M++;
            
          } else {
            if (Tonyu.globals.$TD_M_multiGamen==1) {
              if (Tonyu.globals.$TD_M_ACM_I>=Tonyu.globals.$TD_M_ACM_S) {
                Tonyu.globals.$TD_M_EOF=1;
                Tonyu.globals.$TD_M_M=6;
                
              } else {
                Tonyu.globals.$TD_M_CM=Tonyu.globals.$TD_M_ACM[Tonyu.globals.$TD_M_ACM_I];
                if (Tonyu.globals.$TD_M_CM.TD_visible) {
                  Tonyu.globals.$TD_M_CM.cameraMain();
                  Tonyu.globals.$TD_Z.RSC();
                  Tonyu.globals.$TD_Z.GKK(Tonyu.globals.$TD_G_GL,Tonyu.globals.$TD_G_GU,Tonyu.globals.$TD_G_GR,Tonyu.globals.$TD_G_GD);
                  Tonyu.globals.$TD_M_M++;
                  
                }
                Tonyu.globals.$TD_M_ACM_I++;
                Tonyu.globals.$TD_M_A3D_I=0;
                
              }
              
            }
          }
          
        }
        if (Tonyu.globals.$TD_M_M==1) {
          for (i = 0;
           i<Tonyu.globals.$TD_M_syoriMax ; i++) {
            {
              if (Tonyu.globals.$TD_M_AP_I==0) {
                if (Tonyu.globals.$TD_M_A3D_I>=Tonyu.globals.$TD_M_A3D_S) {
                  Tonyu.globals.$TD_M_EOF=1;
                  Tonyu.globals.$TD_M_M++;
                  Tonyu.globals.$TD_M_A3D_I=0;
                  break;
                  
                  
                }
                Tonyu.globals.$TD_M_O=Tonyu.globals.$TD_M_A3D[Tonyu.globals.$TD_M_A3D_I];
                Tonyu.globals.$TD_M_AP_S=Tonyu.globals.$TD_M_O.TD_AP.length;
                if (Tonyu.globals.$TD_M_O.TD_visible==0) {
                  Tonyu.globals.$TD_M_AP_I=Tonyu.globals.$TD_M_AP_S;
                  
                } else {
                  Tonyu.globals.$TD_M_O.RSC();
                  
                }
                
              }
              if (Tonyu.globals.$TD_M_AP_I<Tonyu.globals.$TD_M_AP_S) {
                Tonyu.globals.$TD_M_O.TD_AP[Tonyu.globals.$TD_M_AP_I].kaiten(Tonyu.globals.$TD_M_O.TD_x,Tonyu.globals.$TD_M_O.TD_y,Tonyu.globals.$TD_M_O.TD_z,Tonyu.globals.$TD_M_O.TD_angleX,Tonyu.globals.$TD_M_O.TD_angleY,Tonyu.globals.$TD_M_O.TD_angleZ,Tonyu.globals.$TD_M_O.TD_angleXZ,Tonyu.globals.$TD_M_O.TD_angleYZ,Tonyu.globals.$TD_M_O.TD_angleXY,Tonyu.globals.$TD_M_O.TD_xzsin,Tonyu.globals.$TD_M_O.TD_yzsin,Tonyu.globals.$TD_M_O.TD_xysin,Tonyu.globals.$TD_M_O.TD_xzcos,Tonyu.globals.$TD_M_O.TD_yzcos,Tonyu.globals.$TD_M_O.TD_xycos,Tonyu.globals.$TD_Z_x,Tonyu.globals.$TD_Z_y,Tonyu.globals.$TD_Z_z,Tonyu.globals.$TD_K_xzsin,Tonyu.globals.$TD_K_yzsin,Tonyu.globals.$TD_K_xysin,Tonyu.globals.$TD_K_xzcos,Tonyu.globals.$TD_K_yzcos,Tonyu.globals.$TD_K_xycos);
                Tonyu.globals.$TD_M_AP_I++;
                
              }
              if (Tonyu.globals.$TD_M_AP_I>=Tonyu.globals.$TD_M_AP_S) {
                Tonyu.globals.$TD_M_AP_I=0;
                Tonyu.globals.$TD_M_A3D_I++;
                
              }
            }
          }
          
        }
        if (Tonyu.globals.$TD_M_M==2) {
          for (i=0; i<Tonyu.globals.$TD_M_syoriMax ; i++) {
            {
              if (Tonyu.globals.$TD_M_ADR_I==0) {
                if (Tonyu.globals.$TD_M_A3D_I>=Tonyu.globals.$TD_M_A3D_S) {
                  Tonyu.globals.$TD_M_EOF=1;
                  Tonyu.globals.$TD_M_M++;
                  Tonyu.globals.$TD_M_A3D_I=0;
                  break;
                  
                  
                }
                Tonyu.globals.$TD_M_O=Tonyu.globals.$TD_M_A3D[Tonyu.globals.$TD_M_A3D_I];
                Tonyu.globals.$TD_M_ADR_S=Tonyu.globals.$TD_M_O.TD_ADR.length;
                if (Tonyu.globals.$TD_M_O.TD_visible==0) {
                  Tonyu.globals.$TD_M_ADR_I=Tonyu.globals.$TD_M_ADR_S;
                  
                }
                
              }
              if (Tonyu.globals.$TD_M_ADR_I<Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_O.TD_ADR[Tonyu.globals.$TD_M_ADR_I].merikomiSyusei(Tonyu.globals.$TD_K_k,Tonyu.globals.$TD_Z_k,Tonyu.globals.$TD_K_hw,Tonyu.globals.$TD_K_hh);
                Tonyu.globals.$TD_M_ADR_I++;
                
              }
              if (Tonyu.globals.$TD_M_ADR_I>=Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_ADR_I=0;
                Tonyu.globals.$TD_M_A3D_I++;
                
              }
            }
          }
          
        }
        if (Tonyu.globals.$TD_M_M==3) {
          for (i=0; i<Tonyu.globals.$TD_M_syoriMax ; i++) {
            {
              if (Tonyu.globals.$TD_M_AP_I==0) {
                if (Tonyu.globals.$TD_M_A3D_I>=Tonyu.globals.$TD_M_A3D_S) {
                  Tonyu.globals.$TD_M_EOF=1;
                  Tonyu.globals.$TD_M_M++;
                  Tonyu.globals.$TD_M_A3D_I=0;
                  break;
                  
                  
                }
                Tonyu.globals.$TD_M_O=Tonyu.globals.$TD_M_A3D[Tonyu.globals.$TD_M_A3D_I];
                Tonyu.globals.$TD_M_AP_S=Tonyu.globals.$TD_M_O.TD_AP.length;
                if (Tonyu.globals.$TD_M_O.TD_visible==0) {
                  Tonyu.globals.$TD_M_AP_I=Tonyu.globals.$TD_M_AP_S;
                  
                }
                
              }
              if (Tonyu.globals.$TD_M_AP_I<Tonyu.globals.$TD_M_AP_S) {
                Tonyu.globals.$TD_M_O.TD_AP[Tonyu.globals.$TD_M_AP_I].henkan2D(Tonyu.globals.$TD_K_k,Tonyu.globals.$TD_Z_k,Tonyu.globals.$TD_K_hw,Tonyu.globals.$TD_K_hh);
                Tonyu.globals.$TD_M_AP_I++;
                
              }
              if (Tonyu.globals.$TD_M_AP_I>=Tonyu.globals.$TD_M_AP_S) {
                Tonyu.globals.$TD_M_AP_I=0;
                Tonyu.globals.$TD_M_A3D_I++;
                
              }
            }
          }
          
        }
        if (Tonyu.globals.$TD_M_M==4) {
          for (i=0; i<Tonyu.globals.$TD_M_syoriMax ; i++) {
            {
              if (Tonyu.globals.$TD_M_ADR_I==0) {
                if (Tonyu.globals.$TD_M_A3D_I>=Tonyu.globals.$TD_M_A3D_S) {
                  Tonyu.globals.$TD_M_EOF=1;
                  Tonyu.globals.$TD_M_M++;
                  Tonyu.globals.$TD_M_A3D_I=0;
                  break;
                  
                  
                }
                Tonyu.globals.$TD_M_O=Tonyu.globals.$TD_M_A3D[Tonyu.globals.$TD_M_A3D_I];
                Tonyu.globals.$TD_M_ADR_S=Tonyu.globals.$TD_M_O.TD_ADR.length;
                if (Tonyu.globals.$TD_M_O.TD_visible==0) {
                  Tonyu.globals.$TD_M_ADR_I=Tonyu.globals.$TD_M_ADR_S;
                  
                }
                
              }
              if (Tonyu.globals.$TD_M_ADR_I<Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_O.TD_ADR[Tonyu.globals.$TD_M_ADR_I].hamidasiSyusei(Tonyu.globals.$TD_G_GL,Tonyu.globals.$TD_G_GU,Tonyu.globals.$TD_G_GR,Tonyu.globals.$TD_G_GD);
                Tonyu.globals.$TD_M_ADR_I++;
                
              }
              if (Tonyu.globals.$TD_M_ADR_I>=Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_ADR_I=0;
                Tonyu.globals.$TD_M_A3D_I++;
                
              }
            }
          }
          
        }
        if (Tonyu.globals.$TD_M_M==5) {
          for (i=0; i<Tonyu.globals.$TD_M_syoriMax ; i++) {
            {
              if (Tonyu.globals.$TD_M_ADR_I==0) {
                if (Tonyu.globals.$TD_M_A3D_I>=Tonyu.globals.$TD_M_A3D_S) {
                  Tonyu.globals.$TD_M_EOF=1;
                  if (Tonyu.globals.$TD_M_multiGamen==1) {
                    Tonyu.globals.$TD_M_M=0;
                  } else {
                    Tonyu.globals.$TD_M_M++;
                  }
                  Tonyu.globals.$TD_M_A3D_I=0;
                  break;
                  
                  
                }
                Tonyu.globals.$TD_M_O=Tonyu.globals.$TD_M_A3D[Tonyu.globals.$TD_M_A3D_I];
                Tonyu.globals.$TD_M_ADR_S=Tonyu.globals.$TD_M_O.TD_ADR.length;
                if (Tonyu.globals.$TD_M_O.TD_visible==0) {
                  Tonyu.globals.$TD_M_ADR_I=Tonyu.globals.$TD_M_ADR_S;
                  
                }
                
              }
              if (Tonyu.globals.$TD_M_ADR_I<Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_O.TD_ADR[Tonyu.globals.$TD_M_ADR_I].ZukeiDraw(Tonyu.globals.$TD_M_O.TD_angleDX,Tonyu.globals.$TD_M_O.TD_alphaDX,Tonyu.globals.$TD_M_O.TD_scaleXDX,Tonyu.globals.$TD_M_O.TD_scaleYDX);
                Tonyu.globals.$TD_M_ADR_I++;
                
              }
              if (Tonyu.globals.$TD_M_ADR_I>=Tonyu.globals.$TD_M_ADR_S) {
                Tonyu.globals.$TD_M_A3D_I++;
                Tonyu.globals.$TD_M_ADR_I=0;
                
              }
            }
          }
          
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"run":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}}},"fields":{}}
});
Tonyu.klass.define({
  fullName: 'kernel.DxChar',
  shortName: 'DxChar',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.SpriteChar,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_DxChar_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_DxChar_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_DxChar_initialize(xx,yy,pp,ff,sz,rt,al) {
        var _this=this;
        
        __superClass.apply( _this, [xx,yy,pp,ff]);
        _this.scaleX=1;
        if (sz) {
          _this.scaleX=sz;
        }
        _this.angle=0;
        if (rt) {
          _this.angle=rt;
        }
        _this.alpha=255;
        if (al) {
          _this.alpha=al;
        }
      },
      draw :function _trc_DxChar_draw(c) {
        var _this=this;
        
        if (_this._isInvisible) {
          return _this;
        }
        _this.onDraw();
        _this.prepareImage();
        _this.drawDxSprite(_this.x,_this.y,_this.p,_this.f,_this.zOrder,_this.angle,_this.alpha,_this.scaleX,_this.scaleY);
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}}},"fields":{"angle":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TD_3D',
  shortName: 'TD_3D',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.DxChar,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_TD_3D_main() {
        var _this=this;
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      },
      fiber$main :function* _trc_TD_3D_f_main(_thread) {
        var _this=this;
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      },
      initialize :function _trc_TD_3D_initialize(opt) {
        var _this=this;
        
        _this.cons();
        __superClass.apply( _this, [opt]);
      },
      cons :function _trc_TD_3D_cons() {
        var _this=this;
        
        if (_this.z==null) {
          _this.z=0;
        }
        _this.TD_x=0;
        _this.TD_y=0;
        _this.TD_z=0;
        _this.TD_angleX=0;
        _this.TD_angleY=0;
        _this.TD_angleZ=0;
        _this.TD_angleXZ=0;
        _this.TD_angleYZ=0;
        _this.TD_angleXY=0;
        _this.TD_angleDX=0;
        _this.TD_alphaDX=255;
        _this.TD_scaleXDX=1;
        _this.TD_scaleYDX=0;
        _this.TD_AP=[];
        _this.TD_ADR=[];
        _this.TD_A2=[];
        _this.TD_visible=1;
        _this.scaleY=_this.scaleY||0;
        if (Tonyu.globals.$TD_M_A3D.indexOf()==- 1) {
          Tonyu.globals.$TD_M_A3D.push(_this);
        }
        _this.on("die",(function anonymous_1650() {
          
          _this.onDie();
        }));
      },
      fiber$cons :function* _trc_TD_3D_f_cons(_thread) {
        var _this=this;
        
        if (_this.z==null) {
          _this.z=0;
        }
        _this.TD_x=0;
        _this.TD_y=0;
        _this.TD_z=0;
        _this.TD_angleX=0;
        _this.TD_angleY=0;
        _this.TD_angleZ=0;
        _this.TD_angleXZ=0;
        _this.TD_angleYZ=0;
        _this.TD_angleXY=0;
        _this.TD_angleDX=0;
        _this.TD_alphaDX=255;
        _this.TD_scaleXDX=1;
        _this.TD_scaleYDX=0;
        _this.TD_AP=[];
        _this.TD_ADR=[];
        _this.TD_A2=[];
        _this.TD_visible=1;
        _this.scaleY=_this.scaleY||0;
        if (Tonyu.globals.$TD_M_A3D.indexOf()==- 1) {
          Tonyu.globals.$TD_M_A3D.push(_this);
        }
        _this.on("die",(function anonymous_1650() {
          
          _this.onDie();
        }));
        
      },
      draw :function _trc_TD_3D_draw(ctx) {
        var _this=this;
        
      },
      RSC :function _trc_TD_3D_RSC() {
        var _this=this;
        
        _this.TD_x=_this.x;
        _this.TD_y=_this.y;
        _this.TD_z=_this.z;
        _this.TD_angleDX=_this.angle;
        _this.TD_alphaDX=_this.alpha;
        _this.TD_scaleXDX=_this.scaleX;
        _this.TD_scaleYDX=_this.scaleY;
        _this.TD_xzsin=Tonyu.globals.$TD_Z.rsin(_this.TD_angleXZ);
        _this.TD_xzcos=Tonyu.globals.$TD_Z.rcos(_this.TD_angleXZ);
        _this.TD_yzsin=Tonyu.globals.$TD_Z.rsin(_this.TD_angleYZ);
        _this.TD_yzcos=Tonyu.globals.$TD_Z.rcos(_this.TD_angleYZ);
        _this.TD_xysin=Tonyu.globals.$TD_Z.rsin(_this.TD_angleXY);
        _this.TD_xycos=Tonyu.globals.$TD_Z.rcos(_this.TD_angleXY);
      },
      fiber$RSC :function* _trc_TD_3D_f_RSC(_thread) {
        var _this=this;
        
        _this.TD_x=_this.x;
        _this.TD_y=_this.y;
        _this.TD_z=_this.z;
        _this.TD_angleDX=_this.angle;
        _this.TD_alphaDX=_this.alpha;
        _this.TD_scaleXDX=_this.scaleX;
        _this.TD_scaleYDX=_this.scaleY;
        _this.TD_xzsin=Tonyu.globals.$TD_Z.rsin(_this.TD_angleXZ);
        _this.TD_xzcos=Tonyu.globals.$TD_Z.rcos(_this.TD_angleXZ);
        _this.TD_yzsin=Tonyu.globals.$TD_Z.rsin(_this.TD_angleYZ);
        _this.TD_yzcos=Tonyu.globals.$TD_Z.rcos(_this.TD_angleYZ);
        _this.TD_xysin=Tonyu.globals.$TD_Z.rsin(_this.TD_angleXY);
        _this.TD_xycos=Tonyu.globals.$TD_Z.rcos(_this.TD_angleXY);
        
      },
      update :function _trc_TD_3D_update() {
        var _this=this;
        
        _this.apudeto();
        __superClass.prototype.update.apply( _this, []);
      },
      fiber$update :function* _trc_TD_3D_f_update(_thread) {
        var _this=this;
        
        (yield* _this.fiber$apudeto(_thread));
        (yield* __superClass.prototype.fiber$update.apply( _this, [_thread]));
        
      },
      apudeto :function _trc_TD_3D_apudeto() {
        var _this=this;
        var i;
        var t;
        
        
        if (Tonyu.globals.$TD_M_tenmetuKeigen!=0) {
          return _this;
        }
        if (! Tonyu.globals.$_doDraw) {
          return _this;
        }
        if (_this.TD_visible) {
          if (Tonyu.globals.$TD_K_F!=Tonyu.globals.$frameCount) {
            Tonyu.globals.$TD_Z.RSC();
            Tonyu.globals.$TD_Z.GKK();
            Tonyu.globals.$TD_K_F=Tonyu.globals.$frameCount;
            
          }
          _this._Draw3D();
          
        }
      },
      fiber$apudeto :function* _trc_TD_3D_f_apudeto(_thread) {
        var _this=this;
        var i;
        var t;
        
        
        if (Tonyu.globals.$TD_M_tenmetuKeigen!=0) {
          return _this;
        }
        if (! Tonyu.globals.$_doDraw) {
          return _this;
        }
        if (_this.TD_visible) {
          if (Tonyu.globals.$TD_K_F!=Tonyu.globals.$frameCount) {
            Tonyu.globals.$TD_Z.RSC();
            Tonyu.globals.$TD_Z.GKK();
            Tonyu.globals.$TD_K_F=Tonyu.globals.$frameCount;
            
          }
          (yield* _this.fiber$_Draw3D(_thread));
          
        }
        
      },
      onAppear :function _trc_TD_3D_onAppear() {
        var _this=this;
        
      },
      fiber$onAppear :function* _trc_TD_3D_f_onAppear(_thread) {
        var _this=this;
        
        
      },
      onDie :function _trc_TD_3D_onDie() {
        var _this=this;
        var t;
        
        if (Tonyu.globals.$TD_M_A3D.indexOf(_this)>=0) {
          Tonyu.globals.$TD_M_A3D.splice(Tonyu.globals.$TD_M_A3D.indexOf(_this),1);
        }
        _this.TD_AP.splice(0);
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.die();
          
        }
        _this.TD_ADR.splice(0);
      },
      fiber$onDie :function* _trc_TD_3D_f_onDie(_thread) {
        var _this=this;
        var t;
        
        if (Tonyu.globals.$TD_M_A3D.indexOf(_this)>=0) {
          Tonyu.globals.$TD_M_A3D.splice(Tonyu.globals.$TD_M_A3D.indexOf(_this),1);
        }
        _this.TD_AP.splice(0);
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.die();
          
        }
        _this.TD_ADR.splice(0);
        
      },
      Draw3D :function _trc_TD_3D_Draw3D(v) {
        var _this=this;
        
        _this.TD_visible=v;
      },
      fiber$Draw3D :function* _trc_TD_3D_f_Draw3D(_thread,v) {
        var _this=this;
        
        _this.TD_visible=v;
        
      },
      _Draw3D :function _trc_TD_3D__Draw3D() {
        var _this=this;
        var t;
        
        
        _this.TD_x=_this.x;
        _this.TD_y=_this.z;
        _this.TD_z=_this.y;
        _this.RSC();
        for ([t] of Tonyu.iterator2(_this.TD_AP,1)) {
          t.kaiten(_this.TD_x,_this.TD_y,_this.TD_z,_this.TD_angleX,_this.TD_angleY,_this.TD_angleZ,_this.TD_angleXZ,_this.TD_angleYZ,_this.TD_angleXY,_this.TD_xzsin,_this.TD_yzsin,_this.TD_xysin,_this.TD_xzcos,_this.TD_yzcos,_this.TD_xycos,Tonyu.globals.$TD_Z_x,Tonyu.globals.$TD_Z_y,Tonyu.globals.$TD_Z_z,Tonyu.globals.$TD_K_xzsin,Tonyu.globals.$TD_K_yzsin,Tonyu.globals.$TD_K_xysin,Tonyu.globals.$TD_K_xzcos,Tonyu.globals.$TD_K_yzcos,Tonyu.globals.$TD_K_xycos);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.merikomiSyusei(Tonyu.globals.$TD_K_k,Tonyu.globals.$TD_Z_k,Tonyu.globals.$TD_K_hw,Tonyu.globals.$TD_K_hh);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_AP,1)) {
          t.henkan2D(Tonyu.globals.$TD_K_k,Tonyu.globals.$TD_Z_k,Tonyu.globals.$TD_K_hw,Tonyu.globals.$TD_K_hh);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.hamidasiSyusei(Tonyu.globals.$TD_G_GL,Tonyu.globals.$TD_G_GU,Tonyu.globals.$TD_G_GR,Tonyu.globals.$TD_G_GD,_this.TD_scaleXDX,_this.TD_scaleYDX);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.ZukeiDraw(_this.TD_angleDX,_this.TD_alphaDX,_this.TD_scaleXDX,_this.TD_scaleYDX);
          
        }
      },
      fiber$_Draw3D :function* _trc_TD_3D_f__Draw3D(_thread) {
        var _this=this;
        var t;
        
        
        _this.TD_x=_this.x;
        _this.TD_y=_this.z;
        _this.TD_z=_this.y;
        (yield* _this.fiber$RSC(_thread));
        for ([t] of Tonyu.iterator2(_this.TD_AP,1)) {
          t.kaiten(_this.TD_x,_this.TD_y,_this.TD_z,_this.TD_angleX,_this.TD_angleY,_this.TD_angleZ,_this.TD_angleXZ,_this.TD_angleYZ,_this.TD_angleXY,_this.TD_xzsin,_this.TD_yzsin,_this.TD_xysin,_this.TD_xzcos,_this.TD_yzcos,_this.TD_xycos,Tonyu.globals.$TD_Z_x,Tonyu.globals.$TD_Z_y,Tonyu.globals.$TD_Z_z,Tonyu.globals.$TD_K_xzsin,Tonyu.globals.$TD_K_yzsin,Tonyu.globals.$TD_K_xysin,Tonyu.globals.$TD_K_xzcos,Tonyu.globals.$TD_K_yzcos,Tonyu.globals.$TD_K_xycos);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.merikomiSyusei(Tonyu.globals.$TD_K_k,Tonyu.globals.$TD_Z_k,Tonyu.globals.$TD_K_hw,Tonyu.globals.$TD_K_hh);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_AP,1)) {
          t.henkan2D(Tonyu.globals.$TD_K_k,Tonyu.globals.$TD_Z_k,Tonyu.globals.$TD_K_hw,Tonyu.globals.$TD_K_hh);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.hamidasiSyusei(Tonyu.globals.$TD_G_GL,Tonyu.globals.$TD_G_GU,Tonyu.globals.$TD_G_GR,Tonyu.globals.$TD_G_GD,_this.TD_scaleXDX,_this.TD_scaleYDX);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.ZukeiDraw(_this.TD_angleDX,_this.TD_alphaDX,_this.TD_scaleXDX,_this.TD_scaleYDX);
          
        }
        
      },
      addDraw3D2 :function _trc_TD_3D_addDraw3D2(zx,zy,zz,xz,yz,xy,gk,k_max,GL,GU,GR,GD) {
        var _this=this;
        var t;
        
        
        t=new Tonyu.classes.kernel.TD_CM(zx,zy,zz,xz,yz,xy,gk,k_max,GL,GU,GR,GD);
        _this.TD_A2.push(t);
        return t;
      },
      fiber$addDraw3D2 :function* _trc_TD_3D_f_addDraw3D2(_thread,zx,zy,zz,xz,yz,xy,gk,k_max,GL,GU,GR,GD) {
        var _this=this;
        var t;
        
        
        t=new Tonyu.classes.kernel.TD_CM(zx,zy,zz,xz,yz,xy,gk,k_max,GL,GU,GR,GD);
        _this.TD_A2.push(t);
        return t;
        
      },
      setDraw3D2 :function _trc_TD_3D_setDraw3D2(i,zx,zy,zz,xz,yz,xy,gk,k_max,GL,GU,GR,GD) {
        var _this=this;
        var t;
        
        
        t=_this.TD_A2[i];
        t.zx=zx;
        t.zy=zy;
        t.zz=zz;
        t.xz=xz;
        t.yz=yz;
        t.xy=xy;
        t.gk=gk;
        t.k_max=k_max;
        t.GL=GL;
        t.GU=GU;
        t.GR=GR;
        t.GD=GD;
      },
      fiber$setDraw3D2 :function* _trc_TD_3D_f_setDraw3D2(_thread,i,zx,zy,zz,xz,yz,xy,gk,k_max,GL,GU,GR,GD) {
        var _this=this;
        var t;
        
        
        t=_this.TD_A2[i];
        t.zx=zx;
        t.zy=zy;
        t.zz=zz;
        t.xz=xz;
        t.yz=yz;
        t.xy=xy;
        t.gk=gk;
        t.k_max=k_max;
        t.GL=GL;
        t.GU=GU;
        t.GR=GR;
        t.GD=GD;
        
      },
      deleteDraw3D2 :function _trc_TD_3D_deleteDraw3D2(i) {
        var _this=this;
        
        _this.TD_A2.splice(i,1);
      },
      fiber$deleteDraw3D2 :function* _trc_TD_3D_f_deleteDraw3D2(_thread,i) {
        var _this=this;
        
        _this.TD_A2.splice(i,1);
        
      },
      removeDraw3D2 :function _trc_TD_3D_removeDraw3D2(t) {
        var _this=this;
        
        if (_this.TD_A2.indexOf(t)>=0) {
          _this.TD_A2.splice(_this.TD_A2.indexOf(t),1);
        }
      },
      fiber$removeDraw3D2 :function* _trc_TD_3D_f_removeDraw3D2(_thread,t) {
        var _this=this;
        
        if (_this.TD_A2.indexOf(t)>=0) {
          _this.TD_A2.splice(_this.TD_A2.indexOf(t),1);
        }
        
      },
      _Draw3D2 :function _trc_TD_3D__Draw3D2(zx,zy,zz,xz,yz,xy,gk,k_max,GL,GU,GR,GD) {
        var _this=this;
        var t;
        var ww;
        var hh;
        var kk;
        var zk;
        
        
        if (! Tonyu.globals.$_doDraw) {
          return _this;
        }
        _this.RSC();
        _this.TD_k_xzsin=Tonyu.globals.$TD_Z.rsin(xz);
        _this.TD_k_yzsin=Tonyu.globals.$TD_Z.rsin(yz);
        _this.TD_k_xysin=Tonyu.globals.$TD_Z.rsin(xy);
        _this.TD_k_xzcos=Tonyu.globals.$TD_Z.rcos(xz);
        _this.TD_k_yzcos=Tonyu.globals.$TD_Z.rcos(yz);
        _this.TD_k_xycos=Tonyu.globals.$TD_Z.rcos(xy);
        ww=GR-GL;
        hh=GD-GU;
        if (Tonyu.globals.$screenWidth>=Tonyu.globals.$screenHeight) {
          zk=ww+gk;
        } else {
          zk=hh+gk;
        }
        kk=zk/k_max;
        ww=GL+ww/2;
        hh=GU+hh/2;
        for ([t] of Tonyu.iterator2(_this.TD_AP,1)) {
          t.kaiten(_this.x,_this.y,_this.z,_this.TD_angleX,_this.TD_angleY,_this.TD_angleZ,_this.TD_angleXZ,_this.TD_angleYZ,_this.TD_angleXY,_this.TD_xzsin,_this.TD_yzsin,_this.TD_xysin,_this.TD_xzcos,_this.TD_yzcos,_this.TD_xycos,zx,zy,zz,_this.TD_k_xzsin,_this.TD_k_yzsin,_this.TD_k_xysin,_this.TD_k_xzcos,_this.TD_k_yzcos,_this.TD_k_xycos);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.merikomiSyusei(kk,zk,ww,hh);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_AP,1)) {
          t.henkan2D(kk,zk,ww,hh);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.hamidasiSyusei(GL,GU,GR,GD);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.ZukeiDraw(_this.TD_angleDX,_this.TD_alphaDX,_this.TD_scaleXDX,_this.TD_scaleYDX);
          
        }
      },
      fiber$_Draw3D2 :function* _trc_TD_3D_f__Draw3D2(_thread,zx,zy,zz,xz,yz,xy,gk,k_max,GL,GU,GR,GD) {
        var _this=this;
        var t;
        var ww;
        var hh;
        var kk;
        var zk;
        
        
        if (! Tonyu.globals.$_doDraw) {
          return _this;
        }
        (yield* _this.fiber$RSC(_thread));
        _this.TD_k_xzsin=Tonyu.globals.$TD_Z.rsin(xz);
        _this.TD_k_yzsin=Tonyu.globals.$TD_Z.rsin(yz);
        _this.TD_k_xysin=Tonyu.globals.$TD_Z.rsin(xy);
        _this.TD_k_xzcos=Tonyu.globals.$TD_Z.rcos(xz);
        _this.TD_k_yzcos=Tonyu.globals.$TD_Z.rcos(yz);
        _this.TD_k_xycos=Tonyu.globals.$TD_Z.rcos(xy);
        ww=GR-GL;
        hh=GD-GU;
        if (Tonyu.globals.$screenWidth>=Tonyu.globals.$screenHeight) {
          zk=ww+gk;
        } else {
          zk=hh+gk;
        }
        kk=zk/k_max;
        ww=GL+ww/2;
        hh=GU+hh/2;
        for ([t] of Tonyu.iterator2(_this.TD_AP,1)) {
          t.kaiten(_this.x,_this.y,_this.z,_this.TD_angleX,_this.TD_angleY,_this.TD_angleZ,_this.TD_angleXZ,_this.TD_angleYZ,_this.TD_angleXY,_this.TD_xzsin,_this.TD_yzsin,_this.TD_xysin,_this.TD_xzcos,_this.TD_yzcos,_this.TD_xycos,zx,zy,zz,_this.TD_k_xzsin,_this.TD_k_yzsin,_this.TD_k_xysin,_this.TD_k_xzcos,_this.TD_k_yzcos,_this.TD_k_xycos);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.merikomiSyusei(kk,zk,ww,hh);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_AP,1)) {
          t.henkan2D(kk,zk,ww,hh);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.hamidasiSyusei(GL,GU,GR,GD);
          
        }
        for ([t] of Tonyu.iterator2(_this.TD_ADR,1)) {
          t.ZukeiDraw(_this.TD_angleDX,_this.TD_alphaDX,_this.TD_scaleXDX,_this.TD_scaleYDX);
          
        }
        
      },
      add3D_P :function _trc_TD_3D_add3D_P(x,y,z) {
        var _this=this;
        var p;
        
        
        p=new Tonyu.classes.kernel.TD_P(x,y,z);
        _this.TD_AP.push(p);
        return p;
      },
      fiber$add3D_P :function* _trc_TD_3D_f_add3D_P(_thread,x,y,z) {
        var _this=this;
        var p;
        
        
        p=new Tonyu.classes.kernel.TD_P(x,y,z);
        _this.TD_AP.push(p);
        return p;
        
      },
      addPoint :function _trc_TD_3D_addPoint(x,y,z) {
        var _this=this;
        
        if (x instanceof Tonyu.classes.kernel.TD_P) {
          return x;
        }
        if (typeof  x.slice==="function"&&x.length>=3) {
          return _this.add3D_P(...x);
          
        }
        if (typeof  x==="object") {
          return _this.add3D_P(x.x,x.y,x.z);
          
        }
        return _this.add3D_P(x,y,z);
      },
      fiber$addPoint :function* _trc_TD_3D_f_addPoint(_thread,x,y,z) {
        var _this=this;
        
        if (x instanceof Tonyu.classes.kernel.TD_P) {
          return x;
        }
        if (typeof  x.slice==="function"&&x.length>=3) {
          return yield* _this.fiber$add3D_P(_thread, ...x);
          
          
        }
        if (typeof  x==="object") {
          return yield* _this.fiber$add3D_P(_thread, x.x, x.y, x.z);
          
          
        }
        return yield* _this.fiber$add3D_P(_thread, x, y, z);
        
        
      },
      add3D_DX :function _trc_TD_3D_add3D_DX(m,p1,p,f,angle,alpha,scaleX,scaleY) {
        var _this=this;
        var t;
        
        
        t=new Tonyu.classes.kernel.TD_DR(1,m,p1,p,f,angle,alpha,scaleX,scaleY);
        _this.TD_ADR.push(t);
        return t;
      },
      fiber$add3D_DX :function* _trc_TD_3D_f_add3D_DX(_thread,m,p1,p,f,angle,alpha,scaleX,scaleY) {
        var _this=this;
        var t;
        
        
        t=new Tonyu.classes.kernel.TD_DR(1,m,p1,p,f,angle,alpha,scaleX,scaleY);
        _this.TD_ADR.push(t);
        return t;
        
      },
      addSprite :function _trc_TD_3D_addSprite(o) {
        var _this=this;
        
        let p;
        if (typeof  o.x==="number") {
          p=_this.addPoint(o);
          
        } else {
          if (o.position) {
            p=_this.addPoint(o.position);
            
          }
        }
        let rot = (typeof  o.rotation==="number"?o.rotation:o.angle)||0;
        
        let scx = 1;
        
        if (typeof  o.scaleX=="number") {
          scx=o.scaleX;
          
        }
        _this.scy=scx;
        if (typeof  o.scaleY=="number") {
          scx=o.scaleY;
          
        }
        return _this.add3D_DX(1,p,o.p,o.f,rot,o.alpha||255,scx,_this.scy);
      },
      fiber$addSprite :function* _trc_TD_3D_f_addSprite(_thread,o) {
        var _this=this;
        
        let p;
        if (typeof  o.x==="number") {
          p=(yield* _this.fiber$addPoint(_thread, o));
          
        } else {
          if (o.position) {
            p=(yield* _this.fiber$addPoint(_thread, o.position));
            
          }
        }
        let rot = (typeof  o.rotation==="number"?o.rotation:o.angle)||0;
        
        let scx = 1;
        
        if (typeof  o.scaleX=="number") {
          scx=o.scaleX;
          
        }
        _this.scy=scx;
        if (typeof  o.scaleY=="number") {
          scx=o.scaleY;
          
        }
        return yield* _this.fiber$add3D_DX(_thread, 1, p, o.p, o.f, rot, o.alpha||255, scx, _this.scy);
        
        
      },
      add3D_L :function _trc_TD_3D_add3D_L(m,p1,p2,c,zt,h,blw,al) {
        var _this=this;
        var t;
        
        
        t=new Tonyu.classes.kernel.TD_DR(2,m,p1,p2,c,zt,h,blw,al);
        _this.TD_ADR.push(t);
        return t;
      },
      fiber$add3D_L :function* _trc_TD_3D_f_add3D_L(_thread,m,p1,p2,c,zt,h,blw,al) {
        var _this=this;
        var t;
        
        
        t=new Tonyu.classes.kernel.TD_DR(2,m,p1,p2,c,zt,h,blw,al);
        _this.TD_ADR.push(t);
        return t;
        
      },
      add3D_T :function _trc_TD_3D_add3D_T(m,p1,p2,p3,c,zt,h,blw,al) {
        var _this=this;
        var t;
        
        
        t=new Tonyu.classes.kernel.TD_DR(3,m,p1,p2,p3,c,zt,h,blw,al);
        _this.TD_ADR.push(t);
        return t;
      },
      fiber$add3D_T :function* _trc_TD_3D_f_add3D_T(_thread,m,p1,p2,p3,c,zt,h,blw,al) {
        var _this=this;
        var t;
        
        
        t=new Tonyu.classes.kernel.TD_DR(3,m,p1,p2,p3,c,zt,h,blw,al);
        _this.TD_ADR.push(t);
        return t;
        
      },
      add3D_S :function _trc_TD_3D_add3D_S(m,p1,p2,p3,p4,c,zt,h,blw,al) {
        var _this=this;
        var t;
        
        
        t=new Tonyu.classes.kernel.TD_DR(4,m,p1,p2,p3,p4,c,zt,h,blw,al);
        _this.TD_ADR.push(t);
        return t;
      },
      fiber$add3D_S :function* _trc_TD_3D_f_add3D_S(_thread,m,p1,p2,p3,p4,c,zt,h,blw,al) {
        var _this=this;
        var t;
        
        
        t=new Tonyu.classes.kernel.TD_DR(4,m,p1,p2,p3,p4,c,zt,h,blw,al);
        _this.TD_ADR.push(t);
        return t;
        
      },
      addPolygon :function _trc_TD_3D_addPolygon(...args) {
        var _this=this;
        
        let o = args.pop();
        
        let v = args.map((function anonymous_9548(a) {
          
          return _this.addPoint(a);
        }));
        
        switch (v.length) {
        case 2:
          return _this.add3D_L(1,v[0],v[1],o.color,o.zt,o.h);
        case 3:
          return _this.add3D_T(1,v[0],v[1],v[2],o.color,o.zt,o.h);
        case 4:
          return _this.add3D_S(1,v[0],v[1],v[2],v[3],o.color,o.zt,o.h);
        default:
          throw new Error("addPolygonに指定できる頂点数は4までです．");
          
        }
      },
      fiber$addPolygon :function* _trc_TD_3D_f_addPolygon(_thread,...args) {
        var _this=this;
        
        let o = args.pop();
        
        let v = args.map((function anonymous_9548(a) {
          
          return _this.addPoint(a);
        }));
        
        switch (v.length) {
        case 2:
          return yield* _this.fiber$add3D_L(_thread, 1, v[0], v[1], o.color, o.zt, o.h);
          
        case 3:
          return yield* _this.fiber$add3D_T(_thread, 1, v[0], v[1], v[2], o.color, o.zt, o.h);
          
        case 4:
          return yield* _this.fiber$add3D_S(_thread, 1, v[0], v[1], v[2], v[3], o.color, o.zt, o.h);
          
        default:
          throw new Error("addPolygonに指定できる頂点数は4までです．");
          
        }
        
      },
      add3D_DX_P :function _trc_TD_3D_add3D_DX_P(m,x,y,z,p,f,angle,alpha,scaleX,scaleY) {
        var _this=this;
        var t;
        var p1;
        
        
        p1=new Tonyu.classes.kernel.TD_P(x,y,z);
        t=new Tonyu.classes.kernel.TD_DR(1,m,p1,p,f,angle,alpha,scaleX,scaleY);
        _this.TD_AP.push(p1);
        _this.TD_ADR.push(t);
        return t;
      },
      fiber$add3D_DX_P :function* _trc_TD_3D_f_add3D_DX_P(_thread,m,x,y,z,p,f,angle,alpha,scaleX,scaleY) {
        var _this=this;
        var t;
        var p1;
        
        
        p1=new Tonyu.classes.kernel.TD_P(x,y,z);
        t=new Tonyu.classes.kernel.TD_DR(1,m,p1,p,f,angle,alpha,scaleX,scaleY);
        _this.TD_AP.push(p1);
        _this.TD_ADR.push(t);
        return t;
        
      },
      add3D_L_P :function _trc_TD_3D_add3D_L_P(m,x,y,z,x2,y2,z2,c,zt,h,blw,al) {
        var _this=this;
        var t;
        var p1;
        var p2;
        
        
        p1=new Tonyu.classes.kernel.TD_P(x,y,z);
        p2=new Tonyu.classes.kernel.TD_P(x2,y2,z2);
        t=new Tonyu.classes.kernel.TD_DR(2,m,p1,p2,c,zt,h,blw,al);
        _this.TD_AP.push(p1);
        _this.TD_AP.push(p2);
        _this.TD_ADR.push(t);
        return t;
      },
      fiber$add3D_L_P :function* _trc_TD_3D_f_add3D_L_P(_thread,m,x,y,z,x2,y2,z2,c,zt,h,blw,al) {
        var _this=this;
        var t;
        var p1;
        var p2;
        
        
        p1=new Tonyu.classes.kernel.TD_P(x,y,z);
        p2=new Tonyu.classes.kernel.TD_P(x2,y2,z2);
        t=new Tonyu.classes.kernel.TD_DR(2,m,p1,p2,c,zt,h,blw,al);
        _this.TD_AP.push(p1);
        _this.TD_AP.push(p2);
        _this.TD_ADR.push(t);
        return t;
        
      },
      setPivot :function _trc_TD_3D_setPivot(x,y,z) {
        var _this=this;
        
        _this.TD_angleX=x;
        _this.TD_angleY=y;
        _this.TD_angleZ=z;
      },
      fiber$setPivot :function* _trc_TD_3D_f_setPivot(_thread,x,y,z) {
        var _this=this;
        
        _this.TD_angleX=x;
        _this.TD_angleY=y;
        _this.TD_angleZ=z;
        
      },
      add3D_T_P :function _trc_TD_3D_add3D_T_P(m,x,y,z,x2,y2,z2,x3,y3,z3,c,zt,h,blw,al) {
        var _this=this;
        var t;
        var p1;
        var p2;
        var p3;
        
        
        p1=new Tonyu.classes.kernel.TD_P(x,y,z);
        p2=new Tonyu.classes.kernel.TD_P(x2,y2,z2);
        p3=new Tonyu.classes.kernel.TD_P(x3,y3,z3);
        t=new Tonyu.classes.kernel.TD_DR(3,m,p1,p2,p3,c,zt,h,blw,al);
        _this.TD_AP.push(p1);
        _this.TD_AP.push(p2);
        _this.TD_AP.push(p3);
        _this.TD_ADR.push(t);
        return t;
      },
      fiber$add3D_T_P :function* _trc_TD_3D_f_add3D_T_P(_thread,m,x,y,z,x2,y2,z2,x3,y3,z3,c,zt,h,blw,al) {
        var _this=this;
        var t;
        var p1;
        var p2;
        var p3;
        
        
        p1=new Tonyu.classes.kernel.TD_P(x,y,z);
        p2=new Tonyu.classes.kernel.TD_P(x2,y2,z2);
        p3=new Tonyu.classes.kernel.TD_P(x3,y3,z3);
        t=new Tonyu.classes.kernel.TD_DR(3,m,p1,p2,p3,c,zt,h,blw,al);
        _this.TD_AP.push(p1);
        _this.TD_AP.push(p2);
        _this.TD_AP.push(p3);
        _this.TD_ADR.push(t);
        return t;
        
      },
      add3D_S_P :function _trc_TD_3D_add3D_S_P(m,x,y,z,x2,y2,z2,x3,y3,z3,x4,y4,z4,c,zt,h,blw,al) {
        var _this=this;
        var t;
        var p1;
        var p2;
        var p3;
        var p4;
        
        
        p1=new Tonyu.classes.kernel.TD_P(x,y,z);
        p2=new Tonyu.classes.kernel.TD_P(x2,y2,z2);
        p3=new Tonyu.classes.kernel.TD_P(x3,y3,z3);
        p4=new Tonyu.classes.kernel.TD_P(x4,y4,z4);
        t=new Tonyu.classes.kernel.TD_DR(4,m,p1,p2,p3,p4,c,zt,h,blw,al);
        _this.TD_AP.push(p1);
        _this.TD_AP.push(p2);
        _this.TD_AP.push(p3);
        _this.TD_AP.push(p4);
        _this.TD_ADR.push(t);
        return t;
      },
      fiber$add3D_S_P :function* _trc_TD_3D_f_add3D_S_P(_thread,m,x,y,z,x2,y2,z2,x3,y3,z3,x4,y4,z4,c,zt,h,blw,al) {
        var _this=this;
        var t;
        var p1;
        var p2;
        var p3;
        var p4;
        
        
        p1=new Tonyu.classes.kernel.TD_P(x,y,z);
        p2=new Tonyu.classes.kernel.TD_P(x2,y2,z2);
        p3=new Tonyu.classes.kernel.TD_P(x3,y3,z3);
        p4=new Tonyu.classes.kernel.TD_P(x4,y4,z4);
        t=new Tonyu.classes.kernel.TD_DR(4,m,p1,p2,p3,p4,c,zt,h,blw,al);
        _this.TD_AP.push(p1);
        _this.TD_AP.push(p2);
        _this.TD_AP.push(p3);
        _this.TD_AP.push(p4);
        _this.TD_ADR.push(t);
        return t;
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"cons":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"draw":{"nowait":true,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"RSC":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"update":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"apudeto":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"onAppear":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"onDie":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"Draw3D":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"_Draw3D":{"nowait":false,"isMain":false,"vtype":{"params":[],"returnValue":null}},"addDraw3D2":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"setDraw3D2":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"deleteDraw3D2":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"removeDraw3D2":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"_Draw3D2":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"add3D_P":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"addPoint":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":"kernel.TD_P"}},"add3D_DX":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null],"returnValue":null}},"addSprite":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"add3D_L":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null],"returnValue":null}},"add3D_T":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null],"returnValue":null}},"add3D_S":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"addPolygon":{"nowait":false,"isMain":false,"vtype":{"params":[null],"returnValue":null}},"add3D_DX_P":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"add3D_L_P":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"setPivot":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null],"returnValue":null}},"add3D_T_P":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"add3D_S_P":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"returnValue":null}}},"fields":{"z":{},"TD_x":{},"TD_y":{},"TD_z":{},"TD_angleX":{},"TD_angleY":{},"TD_angleZ":{},"TD_angleXZ":{},"TD_angleYZ":{},"TD_angleXY":{},"TD_angleDX":{},"TD_alphaDX":{},"TD_scaleXDX":{},"TD_scaleYDX":{},"TD_AP":{},"TD_ADR":{},"TD_A2":{},"TD_visible":{},"TD_xzsin":{},"TD_xzcos":{},"TD_yzsin":{},"TD_yzcos":{},"TD_xysin":{},"TD_xycos":{},"TD_k_xzsin":{},"TD_k_xzcos":{},"TD_k_yzsin":{},"TD_k_yzcos":{},"TD_k_xysin":{},"TD_k_xycos":{},"scy":{}}}
});
Tonyu.klass.define({
  fullName: 'kernel.TD_DR',
  shortName: 'TD_DR',
  namespace: 'kernel',
  superclass: Tonyu.classes.kernel.TD_DR_1,
  includes: [],
  methods: function (__superClass) {
    return {
      main :function _trc_TD_DR_main() {
        var _this=this;
        
      },
      fiber$main :function* _trc_TD_DR_f_main(_thread) {
        var _this=this;
        
        
      },
      initialize :function _trc_TD_DR_initialize(nn,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12) {
        var _this=this;
        var i;
        
        
        _this.n=nn;
        if (_this.n==1) {
          _this.m=a1;
          _this.p1=a2;
          _this.c=a3;
          _this.f=a4;
          _this.angle=a5;
          _this.alpha=a6;
          _this.scaleX=a7;
          _this.scaleY=a8;
          _this.LR=1;
          _this.UD=1;
          _this.xx=0;
          _this.yy=0;
          
        } else {
          if (_this.n==2) {
            _this.m=a1;
            _this.p1=a2;
            _this.p2=a3;
            _this.c=a4;
            _this.zt=a5;
            _this.h=a6;
            _this.paint=a7;
            _this.alpha=a8;
            _this.dp1=new Tonyu.classes.kernel.TD_P(0,0,0);
            _this.dp2=new Tonyu.classes.kernel.TD_P(0,0,0);
            
          } else {
            if (_this.n==3) {
              _this.m=a1;
              _this.p1=a2;
              _this.p2=a3;
              _this.p3=a4;
              _this.c=a5;
              _this.zt=a6;
              _this.h=a7;
              _this.paint=a8;
              _this.alpha=a9;
              _this.dp1=new Tonyu.classes.kernel.TD_P(0,0,0);
              _this.dp2=new Tonyu.classes.kernel.TD_P(0,0,0);
              _this.dp3=new Tonyu.classes.kernel.TD_P(0,0,0);
              _this.dp4=new Tonyu.classes.kernel.TD_P(0,0,0);
              _this.dp5=new Tonyu.classes.kernel.TD_P(0,0,0);
              _this.dp6=new Tonyu.classes.kernel.TD_P(0,0,0);
              _this.dp7=new Tonyu.classes.kernel.TD_P(0,0,0);
              _this.dp8=new Tonyu.classes.kernel.TD_P(0,0,0);
              _this.cpA=[];
              for (i=0; i<10 ; i++) {
                _this.cpA.push(new Tonyu.classes.kernel.TD_P(0,0,0));
              }
              
            } else {
              if (_this.n==4) {
                _this.m=a1;
                _this.p1=a2;
                _this.p2=a3;
                _this.p3=a4;
                _this.p4=a5;
                _this.c=a6;
                _this.zt=a7;
                _this.h=a8;
                _this.paint=a9;
                _this.alpha=a10;
                _this.dp1=new Tonyu.classes.kernel.TD_P(0,0,0);
                _this.dp2=new Tonyu.classes.kernel.TD_P(0,0,0);
                _this.dp3=new Tonyu.classes.kernel.TD_P(0,0,0);
                _this.dp4=new Tonyu.classes.kernel.TD_P(0,0,0);
                _this.dp5=new Tonyu.classes.kernel.TD_P(0,0,0);
                _this.dp6=new Tonyu.classes.kernel.TD_P(0,0,0);
                _this.dp7=new Tonyu.classes.kernel.TD_P(0,0,0);
                _this.dp8=new Tonyu.classes.kernel.TD_P(0,0,0);
                _this.dp9=new Tonyu.classes.kernel.TD_P(0,0,0);
                _this.dp10=new Tonyu.classes.kernel.TD_P(0,0,0);
                _this.cpA=[];
                for (i=0; i<16 ; i++) {
                  _this.cpA.push(new Tonyu.classes.kernel.TD_P(0,0,0));
                }
                
              }
            }
          }
        }
        if (_this.n==3||_this.n==4) {
          _this.ep=new Tonyu.classes.kernel.TD_P;
          _this.dpA=[];
          _this.dpAsw=[];
          _this.setPolygonTempAry=[];
          
        }
        if (_this.alpha==null) {
          _this.alpha=255;
        }
        _this.TD_visible=1;
      },
      ZukeiDraw :function _trc_TD_DR_ZukeiDraw(angleDX,alphaDX,scaleXDX,scaleYDX) {
        var _this=this;
        var p;
        var i;
        var GL;
        var GU;
        var GR;
        var GD;
        var width;
        var height;
        var bmpWidth;
        var bmpHeight;
        var panel;
        
        
        if (! _this.TD_visible) {
          return _this;
        }
        if (_this.s==- 1) {
          return _this;
        }
        if (_this.m==1||_this.m==2) {
          if (_this.s==0) {
            return _this;
          }
          if (_this.n==1) {
            _this.ss=1/_this.p1.k;
            _this.k1=_this.ss*_this.scaleX*scaleXDX;
            if (scaleYDX) {
              if (_this.scaleY) {
                _this.k2=_this.ss*_this.scaleY*scaleYDX;
              } else {
                _this.k2=_this.ss*_this.scaleX*scaleYDX;
              }
              _this.drawDxSprite(_this.p1.xx+_this.xx,_this.p1.yy+_this.yy,_this.c,_this.f,1000+_this.zo,- Tonyu.globals.$TD_Z_xy+_this.angle+angleDX,_this.alpha*alphaDX/255,_this.k1,_this.k2*(1-2*(_this.amod(Tonyu.globals.$TD_Z_yz+90,360)>=180)));
              
            } else {
              if (_this.scaleY) {
                _this.k2=_this.ss*_this.scaleY*scaleXDX;
                _this.drawDxSprite(_this.p1.xx+_this.xx,_this.p1.yy+_this.yy,_this.c,_this.f,1000+_this.zo,- Tonyu.globals.$TD_Z_xy+_this.angle+angleDX,_this.alpha*alphaDX/255,_this.k1,_this.k2*(1-2*(_this.amod(Tonyu.globals.$TD_Z_yz+90,360)>=180)));
                
              } else {
                _this.drawDxSprite(_this.p1.xx+_this.xx,_this.p1.yy+_this.yy,_this.c,_this.f,1000+_this.zo,- Tonyu.globals.$TD_Z_xy+_this.angle+angleDX,_this.alpha*alphaDX/255,_this.k1,_this.k1*(1-2*(_this.amod(Tonyu.globals.$TD_Z_yz+90,360)>=180)));
                
              }
              
            }
            
          } else {
            if (_this.n==2) {
              if (_this.s==1) {
                _this.drawLine(_this.p1.xx,_this.p1.yy,_this.p2.xx,_this.p2.yy,_this.c,1000+_this.zo);
                
              } else {
                if (_this.s>=2) {
                  _this.drawLine(_this.dp1.xx,_this.dp1.yy,_this.dp2.xx,_this.dp2.yy,_this.c,1000+_this.zo);
                  
                }
              }
              
            } else {
              if (_this.n==3||_this.n==4) {
                if (_this.s==1) {
                  _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                  _this.setPolygon(1,_this.p2.xx,_this.p2.yy);
                  _this.setPolygon(2,_this.p3.xx,_this.p3.yy);
                  if (_this.pr>=4) {
                    _this.setPolygon(3,_this.p4.xx,_this.p4.yy);
                  }
                  
                } else {
                  if (_this.s==2) {
                    _this.setPolygon(0,_this.dp1.xx,_this.dp1.yy);
                    _this.setPolygon(1,_this.dp2.xx,_this.dp2.yy);
                    _this.setPolygon(2,_this.dp3.xx,_this.dp3.yy);
                    if (_this.pr>=4) {
                      _this.setPolygon(3,_this.dp4.xx,_this.dp4.yy);
                    }
                    if (_this.pr>=5) {
                      _this.setPolygon(4,_this.dp5.xx,_this.dp5.yy);
                    }
                    
                  } else {
                    if (_this.s==3) {
                      _this.pr=_this.dpA.length;
                      if (_this.pr<=1) {
                        return _this;
                      }
                      for (i=0; i<_this.pr ; i++) {
                        {
                          p=_this.dpA[i];
                          _this.setPolygon(i,p.xx,p.yy);
                        }
                      }
                      
                    }
                  }
                }
                _this.fillPolygon(0,0,_this.pr,_this.c,1000+_this.zo,_this.alpha);
                
              }
            }
          }
          
        } else {
          if (false) {
            if (Tonyu.globals.$TD_M_tenmetuKeigen==0) {
              Tonyu.globals.$TD_M_APL_I=Tonyu.globals.$TD_M_APL_I%1000;
              
            }
            if (_this.s==0) {
              return _this;
            }
            if (_this.n==2) {
              if (_this.s==1) {
                if (_this.p1.xx<_this.p2.xx) {
                  GL=_this.p1.xx;
                } else {
                  GL=_this.p2.xx;
                }
                if (_this.p1.yy<_this.p2.yy) {
                  GU=_this.p1.yy;
                } else {
                  GU=_this.p2.yy;
                }
                if (_this.p1.xx>_this.p2.xx) {
                  GR=_this.p1.xx;
                } else {
                  GR=_this.p2.xx;
                }
                if (_this.p1.yy>_this.p2.yy) {
                  GD=_this.p1.yy;
                } else {
                  GD=_this.p2.yy;
                }
                GL=_this.floor(GL);
                GU=_this.floor(GU);
                GR=_this.floor(GR);
                GD=_this.floor(GD);
                width=GR-GL+1;
                if (width<2) {
                  width=2;
                }
                if (width>10000) {
                  width=10000;
                }
                height=GD-GU+1;
                if (height<2) {
                  height=2;
                }
                if (height>10000) {
                  height=10000;
                }
                _this.drawLine(_this.p1.xx,_this.p1.yy,_this.p2.xx,_this.p2.yy,_this.c,1000+_this.zo);
                
              } else {
                if (_this.s>=2) {
                  if (_this.dp1.xx<_this.dp2.xx) {
                    GL=_this.dp1.xx;
                  } else {
                    GL=_this.dp2.xx;
                  }
                  if (_this.dp1.yy<_this.dp2.yy) {
                    GU=_this.dp1.yy;
                  } else {
                    GU=_this.dp2.yy;
                  }
                  if (_this.dp1.xx>_this.dp2.xx) {
                    GR=_this.dp1.xx;
                  } else {
                    GR=_this.dp2.xx;
                  }
                  if (_this.dp1.yy>_this.dp2.yy) {
                    GD=_this.dp1.yy;
                  } else {
                    GD=_this.dp2.yy;
                  }
                  GL=_this.floor(GL);
                  GU=_this.floor(GU);
                  GR=_this.floor(GR);
                  GD=_this.floor(GD);
                  width=GR-GL+1;
                  if (width<2) {
                    width=2;
                  }
                  if (width>10000) {
                    width=10000;
                  }
                  height=GD-GU+1;
                  if (height<2) {
                    height=2;
                  }
                  if (height>10000) {
                    height=10000;
                  }
                  _this.drawLine(_this.dp1.xx,_this.dp1.yy,_this.dp2.xx,_this.dp2.yy,_this.c,1000+_this.zo);
                  
                }
              }
              
            } else {
              if (_this.n==3||_this.n==4) {
                if (_this.s==1) {
                  if (_this.p1.xx<_this.p2.xx) {
                    GL=_this.p1.xx;
                  } else {
                    GL=_this.p2.xx;
                  }
                  if (_this.p1.yy<_this.p2.yy) {
                    GU=_this.p1.yy;
                  } else {
                    GU=_this.p2.yy;
                  }
                  if (_this.p1.xx>_this.p2.xx) {
                    GR=_this.p1.xx;
                  } else {
                    GR=_this.p2.xx;
                  }
                  if (_this.p1.yy>_this.p2.yy) {
                    GD=_this.p1.yy;
                  } else {
                    GD=_this.p2.yy;
                  }
                  if (_this.p3.xx<GL) {
                    GL=_this.p3.xx;
                  }
                  if (_this.p3.yy<GU) {
                    GU=_this.p3.yy;
                  }
                  if (_this.p3.xx>GR) {
                    GR=_this.p3.xx;
                  }
                  if (_this.p3.yy>GD) {
                    GD=_this.p3.yy;
                  }
                  if (_this.pr>=4) {
                    if (_this.p4.xx<GL) {
                      GL=_this.p4.xx;
                    }
                    if (_this.p4.yy<GU) {
                      GU=_this.p4.yy;
                    }
                    if (_this.p4.xx>GR) {
                      GR=_this.p4.xx;
                    }
                    if (_this.p4.yy>GD) {
                      GD=_this.p4.yy;
                    }
                    
                  }
                  if (_this.pr==3) {
                    _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                    _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                    _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy-1);
                    
                  } else {
                    if (_this.pr>=4) {
                      if (_this.p1.xx<=_this.p2.xx&&_this.p1.yy<=_this.p4.yy) {
                        _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                        _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                        _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy-1);
                        if (_this.pr>=4) {
                          _this.setPolygon(3,_this.p4.xx,_this.p4.yy-1);
                        }
                        
                      } else {
                        if (_this.p1.xx>_this.p2.xx&&_this.p1.yy<=_this.p4.yy) {
                          _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                          _this.setPolygon(1,_this.p2.xx+1,_this.p2.yy);
                          _this.setPolygon(2,_this.p3.xx+1,_this.p3.yy-1);
                          if (_this.pr>=4) {
                            _this.setPolygon(3,_this.p4.xx,_this.p4.yy-1);
                          }
                          
                        } else {
                          if (_this.p1.xx<=_this.p2.xx&&_this.p1.yy>_this.p4.yy) {
                            _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                            _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                            _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy+1);
                            if (_this.pr>=4) {
                              _this.setPolygon(3,_this.p4.xx,_this.p4.yy+1);
                            }
                            
                          } else {
                            if (_this.p1.xx>_this.p2.xx&&_this.p1.yy>_this.p4.yy) {
                              _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                              _this.setPolygon(1,_this.p2.xx+1,_this.p2.yy);
                              _this.setPolygon(2,_this.p3.xx+1,_this.p3.yy+1);
                              if (_this.pr>=4) {
                                _this.setPolygon(3,_this.p4.xx,_this.p4.yy+1);
                              }
                              
                            }
                          }
                        }
                      }
                      
                    }
                  }
                  
                } else {
                  if (_this.s==2) {
                    if (_this.dp1.xx<_this.dp2.xx) {
                      GL=_this.dp1.xx;
                    } else {
                      GL=_this.dp2.xx;
                    }
                    if (_this.dp1.yy<_this.dp2.yy) {
                      GU=_this.dp1.yy;
                    } else {
                      GU=_this.dp2.yy;
                    }
                    if (_this.dp1.xx>_this.dp2.xx) {
                      GR=_this.dp1.xx;
                    } else {
                      GR=_this.dp2.xx;
                    }
                    if (_this.dp1.yy>_this.dp2.yy) {
                      GD=_this.dp1.yy;
                    } else {
                      GD=_this.dp2.yy;
                    }
                    if (_this.dp3.xx<GL) {
                      GL=_this.dp3.xx;
                    }
                    if (_this.dp3.yy<GU) {
                      GU=_this.dp3.yy;
                    }
                    if (_this.dp3.xx>GR) {
                      GR=_this.dp3.xx;
                    }
                    if (_this.dp3.yy>GD) {
                      GD=_this.dp3.yy;
                    }
                    if (_this.pr>=4) {
                      if (_this.dp4.xx<GL) {
                        GL=_this.dp4.xx;
                      }
                      if (_this.dp4.yy<GU) {
                        GU=_this.dp4.yy;
                      }
                      if (_this.dp4.xx>GR) {
                        GR=_this.dp4.xx;
                      }
                      if (_this.dp4.yy>GD) {
                        GD=_this.dp4.yy;
                      }
                      
                    }
                    if (_this.pr>=5) {
                      if (_this.dp5.xx<GL) {
                        GL=_this.dp5.xx;
                      }
                      if (_this.dp5.yy<GU) {
                        GU=_this.dp5.yy;
                      }
                      if (_this.dp5.xx>GR) {
                        GR=_this.dp5.xx;
                      }
                      if (_this.dp5.yy>GD) {
                        GD=_this.dp5.yy;
                      }
                      
                    }
                    _this.setPolygon(0,_this.dp1.xx,_this.dp1.yy);
                    _this.setPolygon(1,_this.dp2.xx,_this.dp2.yy);
                    _this.setPolygon(2,_this.dp3.xx,_this.dp3.yy);
                    if (_this.pr>=4) {
                      _this.setPolygon(3,_this.dp4.xx,_this.dp4.yy);
                    }
                    if (_this.pr>=5) {
                      _this.setPolygon(4,_this.dp5.xx,_this.dp5.yy);
                    }
                    
                  } else {
                    if (_this.s==3) {
                      _this.pr=_this.dpA.length;
                      if (_this.pr<=1) {
                        return _this;
                      }
                      for (i=0; i<_this.pr ; i++) {
                        {
                          p=_this.dpA[i];
                          if (i==0) {
                            GL=p.xx;
                            GU=p.yy;
                            GR=p.xx;
                            GD=p.yy;
                            
                          } else {
                            if (p.xx<GL) {
                              GL=p.xx;
                            }
                            if (p.yy<GU) {
                              GU=p.yy;
                            }
                            if (p.xx>GR) {
                              GR=p.xx;
                            }
                            if (p.yy>GD) {
                              GD=p.yy;
                            }
                            
                          }
                          _this.setPolygon(i,p.xx,p.yy);
                        }
                      }
                      
                    }
                  }
                }
                GL=_this.floor(GL);
                GU=_this.floor(GU);
                GR=_this.floor(GR);
                GD=_this.floor(GD);
                width=GR-GL+1;
                if (width<2) {
                  width=2;
                }
                if (width>5000) {
                  width=5000;
                }
                height=GD-GU+1;
                if (height<2) {
                  height=2;
                }
                if (height>5000) {
                  height=5000;
                }
                _this.fillPolygon(0,0,_this.pr,_this.c,1000+_this.zo,_this.alpha);
                
              }
            }
            
          } else {
            if (_this.m==3) {
              if (Tonyu.globals.$TD_M_tenmetuKeigen==0) {
                Tonyu.globals.$TD_M_APL_I=Tonyu.globals.$TD_M_APL_I%1000;
                
              }
              if (Tonyu.globals.$TD_M_APL_I<Tonyu.globals.$TD_M_APL.length) {
                Tonyu.globals.$TD_M_PL=Tonyu.globals.$TD_M_APL[Tonyu.globals.$TD_M_APL_I];
                
              } else {
                Tonyu.globals.$TD_M_PL=new Tonyu.classes.kernel.Panel(2,2);
                Tonyu.globals.$TD_M_APL.push(Tonyu.globals.$TD_M_PL);
                
              }
              Tonyu.globals.$TD_M_APL_I++;
              if (_this.s==0) {
                return _this;
              }
              if (_this.n==3||_this.n==4) {
                if (_this.s==1) {
                  if (_this.p1.xx<_this.p2.xx) {
                    GL=_this.p1.xx;
                  } else {
                    GL=_this.p2.xx;
                  }
                  if (_this.p1.yy<_this.p2.yy) {
                    GU=_this.p1.yy;
                  } else {
                    GU=_this.p2.yy;
                  }
                  if (_this.p1.xx>_this.p2.xx) {
                    GR=_this.p1.xx;
                  } else {
                    GR=_this.p2.xx;
                  }
                  if (_this.p1.yy>_this.p2.yy) {
                    GD=_this.p1.yy;
                  } else {
                    GD=_this.p2.yy;
                  }
                  if (_this.p3.xx<GL) {
                    GL=_this.p3.xx;
                  }
                  if (_this.p3.yy<GU) {
                    GU=_this.p3.yy;
                  }
                  if (_this.p3.xx>GR) {
                    GR=_this.p3.xx;
                  }
                  if (_this.p3.yy>GD) {
                    GD=_this.p3.yy;
                  }
                  if (_this.pr>=4) {
                    if (_this.p4.xx<GL) {
                      GL=_this.p4.xx;
                    }
                    if (_this.p4.yy<GU) {
                      GU=_this.p4.yy;
                    }
                    if (_this.p4.xx>GR) {
                      GR=_this.p4.xx;
                    }
                    if (_this.p4.yy>GD) {
                      GD=_this.p4.yy;
                    }
                    
                  }
                  if (_this.pr==3) {
                    _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                    _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                    _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy-1);
                    
                  } else {
                    if (_this.pr>=4) {
                      if (_this.p1.xx<=_this.p2.xx&&_this.p1.yy<=_this.p4.yy) {
                        _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                        _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                        _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy-1);
                        _this.setPolygon(3,_this.p4.xx,_this.p4.yy-1);
                        
                      } else {
                        if (_this.p1.xx>_this.p2.xx&&_this.p1.yy<=_this.p4.yy) {
                          _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                          _this.setPolygon(1,_this.p2.xx+1,_this.p2.yy);
                          _this.setPolygon(2,_this.p3.xx+1,_this.p3.yy-1);
                          _this.setPolygon(3,_this.p4.xx,_this.p4.yy-1);
                          
                        } else {
                          if (_this.p1.xx<=_this.p2.xx&&_this.p1.yy>_this.p4.yy) {
                            _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                            _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                            _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy+1);
                            _this.setPolygon(3,_this.p4.xx,_this.p4.yy+1);
                            
                          } else {
                            if (_this.p1.xx>_this.p2.xx&&_this.p1.yy>_this.p4.yy) {
                              _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                              _this.setPolygon(1,_this.p2.xx+1,_this.p2.yy);
                              _this.setPolygon(2,_this.p3.xx+1,_this.p3.yy+1);
                              _this.setPolygon(3,_this.p4.xx,_this.p4.yy+1);
                              
                            }
                          }
                        }
                      }
                      
                    }
                  }
                  
                } else {
                  if (_this.s==2) {
                    if (_this.dp1.xx<_this.dp2.xx) {
                      GL=_this.dp1.xx;
                    } else {
                      GL=_this.dp2.xx;
                    }
                    if (_this.dp1.yy<_this.dp2.yy) {
                      GU=_this.dp1.yy;
                    } else {
                      GU=_this.dp2.yy;
                    }
                    if (_this.dp1.xx>_this.dp2.xx) {
                      GR=_this.dp1.xx;
                    } else {
                      GR=_this.dp2.xx;
                    }
                    if (_this.dp1.yy>_this.dp2.yy) {
                      GD=_this.dp1.yy;
                    } else {
                      GD=_this.dp2.yy;
                    }
                    if (_this.dp3.xx<GL) {
                      GL=_this.dp3.xx;
                    }
                    if (_this.dp3.yy<GU) {
                      GU=_this.dp3.yy;
                    }
                    if (_this.dp3.xx>GR) {
                      GR=_this.dp3.xx;
                    }
                    if (_this.dp3.yy>GD) {
                      GD=_this.dp3.yy;
                    }
                    if (_this.pr>=4) {
                      if (_this.dp4.xx<GL) {
                        GL=_this.dp4.xx;
                      }
                      if (_this.dp4.yy<GU) {
                        GU=_this.dp4.yy;
                      }
                      if (_this.dp4.xx>GR) {
                        GR=_this.dp4.xx;
                      }
                      if (_this.dp4.yy>GD) {
                        GD=_this.dp4.yy;
                      }
                      
                    }
                    if (_this.pr>=5) {
                      if (_this.dp5.xx<GL) {
                        GL=_this.dp5.xx;
                      }
                      if (_this.dp5.yy<GU) {
                        GU=_this.dp5.yy;
                      }
                      if (_this.dp5.xx>GR) {
                        GR=_this.dp5.xx;
                      }
                      if (_this.dp5.yy>GD) {
                        GD=_this.dp5.yy;
                      }
                      
                    }
                    _this.setPolygon(0,_this.dp1.xx,_this.dp1.yy);
                    _this.setPolygon(1,_this.dp2.xx,_this.dp2.yy);
                    _this.setPolygon(2,_this.dp3.xx,_this.dp3.yy);
                    if (_this.pr>=4) {
                      _this.setPolygon(3,_this.dp4.xx,_this.dp4.yy);
                    }
                    if (_this.pr>=5) {
                      _this.setPolygon(4,_this.dp5.xx,_this.dp5.yy);
                    }
                    
                  } else {
                    if (_this.s==3) {
                      _this.pr=_this.dpA.length;
                      if (_this.pr<=1) {
                        return _this;
                      }
                      for (i=0; i<_this.pr ; i++) {
                        {
                          p=_this.dpA[i];
                          if (i==0) {
                            GL=p.xx;
                            GU=p.yy;
                            GR=p.xx;
                            GD=p.yy;
                            
                          } else {
                            if (p.xx<GL) {
                              GL=p.xx;
                            }
                            if (p.yy<GU) {
                              GU=p.yy;
                            }
                            if (p.xx>GR) {
                              GR=p.xx;
                            }
                            if (p.yy>GD) {
                              GD=p.yy;
                            }
                            
                          }
                          _this.setPolygon(i,p.xx,p.yy);
                        }
                      }
                      
                    }
                  }
                }
                GL=_this.floor(GL);
                GU=_this.floor(GU);
                GR=_this.floor(GR);
                GD=_this.floor(GD);
                width=GR-GL+1;
                if (width<2) {
                  width=2;
                }
                if (width>5000) {
                  width=5000;
                }
                height=GD-GU+1;
                if (height<2) {
                  height=2;
                }
                if (height>5000) {
                  height=5000;
                }
                Tonyu.globals.$TD_M_PL.resize(width,height);
                Tonyu.globals.$TD_M_PL.clearRect(0,0,width,height);
                panel = new Tonyu.classes.kernel.Panel(width,height);
                
                _this.fillPolygonP(panel,- GL,- GU,_this.pr,"rgb(255,0,0)");
                bmpWidth = _this.bmpGR-_this.bmpGL;
                
                bmpHeight = _this.bmpGD-_this.bmpGU;
                
                Tonyu.globals.$TD_M_PL.drawDxSprite(bmpWidth/2+(_this.bmpGL-GL),bmpHeight/2+(_this.bmpGU-GU),_this.c,0,0,(bmpWidth)/(Tonyu.globals.$imageList[_this.floor(_this.c||0)].width-1),(bmpHeight)/(Tonyu.globals.$imageList[_this.floor(_this.c||0)].height-1));
                Tonyu.globals.$TD_M_PL.copyRect(0,0,width,height,panel,0,0,width,height);
                
              }
              Tonyu.globals.$TD_M_PL.zOrder=1000+_this.zo;
              Tonyu.globals.$TD_M_PL.alpha=_this.alpha;
              Tonyu.globals.$TD_M_PL.draw(GL,GU,width,height,0,0);
              
            }
          }
        }
      },
      fiber$ZukeiDraw :function* _trc_TD_DR_f_ZukeiDraw(_thread,angleDX,alphaDX,scaleXDX,scaleYDX) {
        var _this=this;
        var p;
        var i;
        var GL;
        var GU;
        var GR;
        var GD;
        var width;
        var height;
        var bmpWidth;
        var bmpHeight;
        var panel;
        
        
        if (! _this.TD_visible) {
          return _this;
        }
        if (_this.s==- 1) {
          return _this;
        }
        if (_this.m==1||_this.m==2) {
          if (_this.s==0) {
            return _this;
          }
          if (_this.n==1) {
            _this.ss=1/_this.p1.k;
            _this.k1=_this.ss*_this.scaleX*scaleXDX;
            if (scaleYDX) {
              if (_this.scaleY) {
                _this.k2=_this.ss*_this.scaleY*scaleYDX;
              } else {
                _this.k2=_this.ss*_this.scaleX*scaleYDX;
              }
              _this.drawDxSprite(_this.p1.xx+_this.xx,_this.p1.yy+_this.yy,_this.c,_this.f,1000+_this.zo,- Tonyu.globals.$TD_Z_xy+_this.angle+angleDX,_this.alpha*alphaDX/255,_this.k1,_this.k2*(1-2*(_this.amod(Tonyu.globals.$TD_Z_yz+90,360)>=180)));
              
            } else {
              if (_this.scaleY) {
                _this.k2=_this.ss*_this.scaleY*scaleXDX;
                _this.drawDxSprite(_this.p1.xx+_this.xx,_this.p1.yy+_this.yy,_this.c,_this.f,1000+_this.zo,- Tonyu.globals.$TD_Z_xy+_this.angle+angleDX,_this.alpha*alphaDX/255,_this.k1,_this.k2*(1-2*(_this.amod(Tonyu.globals.$TD_Z_yz+90,360)>=180)));
                
              } else {
                _this.drawDxSprite(_this.p1.xx+_this.xx,_this.p1.yy+_this.yy,_this.c,_this.f,1000+_this.zo,- Tonyu.globals.$TD_Z_xy+_this.angle+angleDX,_this.alpha*alphaDX/255,_this.k1,_this.k1*(1-2*(_this.amod(Tonyu.globals.$TD_Z_yz+90,360)>=180)));
                
              }
              
            }
            
          } else {
            if (_this.n==2) {
              if (_this.s==1) {
                _this.drawLine(_this.p1.xx,_this.p1.yy,_this.p2.xx,_this.p2.yy,_this.c,1000+_this.zo);
                
              } else {
                if (_this.s>=2) {
                  _this.drawLine(_this.dp1.xx,_this.dp1.yy,_this.dp2.xx,_this.dp2.yy,_this.c,1000+_this.zo);
                  
                }
              }
              
            } else {
              if (_this.n==3||_this.n==4) {
                if (_this.s==1) {
                  _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                  _this.setPolygon(1,_this.p2.xx,_this.p2.yy);
                  _this.setPolygon(2,_this.p3.xx,_this.p3.yy);
                  if (_this.pr>=4) {
                    _this.setPolygon(3,_this.p4.xx,_this.p4.yy);
                  }
                  
                } else {
                  if (_this.s==2) {
                    _this.setPolygon(0,_this.dp1.xx,_this.dp1.yy);
                    _this.setPolygon(1,_this.dp2.xx,_this.dp2.yy);
                    _this.setPolygon(2,_this.dp3.xx,_this.dp3.yy);
                    if (_this.pr>=4) {
                      _this.setPolygon(3,_this.dp4.xx,_this.dp4.yy);
                    }
                    if (_this.pr>=5) {
                      _this.setPolygon(4,_this.dp5.xx,_this.dp5.yy);
                    }
                    
                  } else {
                    if (_this.s==3) {
                      _this.pr=_this.dpA.length;
                      if (_this.pr<=1) {
                        return _this;
                      }
                      for (i=0; i<_this.pr ; i++) {
                        {
                          p=_this.dpA[i];
                          _this.setPolygon(i,p.xx,p.yy);
                        }
                      }
                      
                    }
                  }
                }
                _this.fillPolygon(0,0,_this.pr,_this.c,1000+_this.zo,_this.alpha);
                
              }
            }
          }
          
        } else {
          if (false) {
            if (Tonyu.globals.$TD_M_tenmetuKeigen==0) {
              Tonyu.globals.$TD_M_APL_I=Tonyu.globals.$TD_M_APL_I%1000;
              
            }
            if (_this.s==0) {
              return _this;
            }
            if (_this.n==2) {
              if (_this.s==1) {
                if (_this.p1.xx<_this.p2.xx) {
                  GL=_this.p1.xx;
                } else {
                  GL=_this.p2.xx;
                }
                if (_this.p1.yy<_this.p2.yy) {
                  GU=_this.p1.yy;
                } else {
                  GU=_this.p2.yy;
                }
                if (_this.p1.xx>_this.p2.xx) {
                  GR=_this.p1.xx;
                } else {
                  GR=_this.p2.xx;
                }
                if (_this.p1.yy>_this.p2.yy) {
                  GD=_this.p1.yy;
                } else {
                  GD=_this.p2.yy;
                }
                GL=_this.floor(GL);
                GU=_this.floor(GU);
                GR=_this.floor(GR);
                GD=_this.floor(GD);
                width=GR-GL+1;
                if (width<2) {
                  width=2;
                }
                if (width>10000) {
                  width=10000;
                }
                height=GD-GU+1;
                if (height<2) {
                  height=2;
                }
                if (height>10000) {
                  height=10000;
                }
                _this.drawLine(_this.p1.xx,_this.p1.yy,_this.p2.xx,_this.p2.yy,_this.c,1000+_this.zo);
                
              } else {
                if (_this.s>=2) {
                  if (_this.dp1.xx<_this.dp2.xx) {
                    GL=_this.dp1.xx;
                  } else {
                    GL=_this.dp2.xx;
                  }
                  if (_this.dp1.yy<_this.dp2.yy) {
                    GU=_this.dp1.yy;
                  } else {
                    GU=_this.dp2.yy;
                  }
                  if (_this.dp1.xx>_this.dp2.xx) {
                    GR=_this.dp1.xx;
                  } else {
                    GR=_this.dp2.xx;
                  }
                  if (_this.dp1.yy>_this.dp2.yy) {
                    GD=_this.dp1.yy;
                  } else {
                    GD=_this.dp2.yy;
                  }
                  GL=_this.floor(GL);
                  GU=_this.floor(GU);
                  GR=_this.floor(GR);
                  GD=_this.floor(GD);
                  width=GR-GL+1;
                  if (width<2) {
                    width=2;
                  }
                  if (width>10000) {
                    width=10000;
                  }
                  height=GD-GU+1;
                  if (height<2) {
                    height=2;
                  }
                  if (height>10000) {
                    height=10000;
                  }
                  _this.drawLine(_this.dp1.xx,_this.dp1.yy,_this.dp2.xx,_this.dp2.yy,_this.c,1000+_this.zo);
                  
                }
              }
              
            } else {
              if (_this.n==3||_this.n==4) {
                if (_this.s==1) {
                  if (_this.p1.xx<_this.p2.xx) {
                    GL=_this.p1.xx;
                  } else {
                    GL=_this.p2.xx;
                  }
                  if (_this.p1.yy<_this.p2.yy) {
                    GU=_this.p1.yy;
                  } else {
                    GU=_this.p2.yy;
                  }
                  if (_this.p1.xx>_this.p2.xx) {
                    GR=_this.p1.xx;
                  } else {
                    GR=_this.p2.xx;
                  }
                  if (_this.p1.yy>_this.p2.yy) {
                    GD=_this.p1.yy;
                  } else {
                    GD=_this.p2.yy;
                  }
                  if (_this.p3.xx<GL) {
                    GL=_this.p3.xx;
                  }
                  if (_this.p3.yy<GU) {
                    GU=_this.p3.yy;
                  }
                  if (_this.p3.xx>GR) {
                    GR=_this.p3.xx;
                  }
                  if (_this.p3.yy>GD) {
                    GD=_this.p3.yy;
                  }
                  if (_this.pr>=4) {
                    if (_this.p4.xx<GL) {
                      GL=_this.p4.xx;
                    }
                    if (_this.p4.yy<GU) {
                      GU=_this.p4.yy;
                    }
                    if (_this.p4.xx>GR) {
                      GR=_this.p4.xx;
                    }
                    if (_this.p4.yy>GD) {
                      GD=_this.p4.yy;
                    }
                    
                  }
                  if (_this.pr==3) {
                    _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                    _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                    _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy-1);
                    
                  } else {
                    if (_this.pr>=4) {
                      if (_this.p1.xx<=_this.p2.xx&&_this.p1.yy<=_this.p4.yy) {
                        _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                        _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                        _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy-1);
                        if (_this.pr>=4) {
                          _this.setPolygon(3,_this.p4.xx,_this.p4.yy-1);
                        }
                        
                      } else {
                        if (_this.p1.xx>_this.p2.xx&&_this.p1.yy<=_this.p4.yy) {
                          _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                          _this.setPolygon(1,_this.p2.xx+1,_this.p2.yy);
                          _this.setPolygon(2,_this.p3.xx+1,_this.p3.yy-1);
                          if (_this.pr>=4) {
                            _this.setPolygon(3,_this.p4.xx,_this.p4.yy-1);
                          }
                          
                        } else {
                          if (_this.p1.xx<=_this.p2.xx&&_this.p1.yy>_this.p4.yy) {
                            _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                            _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                            _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy+1);
                            if (_this.pr>=4) {
                              _this.setPolygon(3,_this.p4.xx,_this.p4.yy+1);
                            }
                            
                          } else {
                            if (_this.p1.xx>_this.p2.xx&&_this.p1.yy>_this.p4.yy) {
                              _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                              _this.setPolygon(1,_this.p2.xx+1,_this.p2.yy);
                              _this.setPolygon(2,_this.p3.xx+1,_this.p3.yy+1);
                              if (_this.pr>=4) {
                                _this.setPolygon(3,_this.p4.xx,_this.p4.yy+1);
                              }
                              
                            }
                          }
                        }
                      }
                      
                    }
                  }
                  
                } else {
                  if (_this.s==2) {
                    if (_this.dp1.xx<_this.dp2.xx) {
                      GL=_this.dp1.xx;
                    } else {
                      GL=_this.dp2.xx;
                    }
                    if (_this.dp1.yy<_this.dp2.yy) {
                      GU=_this.dp1.yy;
                    } else {
                      GU=_this.dp2.yy;
                    }
                    if (_this.dp1.xx>_this.dp2.xx) {
                      GR=_this.dp1.xx;
                    } else {
                      GR=_this.dp2.xx;
                    }
                    if (_this.dp1.yy>_this.dp2.yy) {
                      GD=_this.dp1.yy;
                    } else {
                      GD=_this.dp2.yy;
                    }
                    if (_this.dp3.xx<GL) {
                      GL=_this.dp3.xx;
                    }
                    if (_this.dp3.yy<GU) {
                      GU=_this.dp3.yy;
                    }
                    if (_this.dp3.xx>GR) {
                      GR=_this.dp3.xx;
                    }
                    if (_this.dp3.yy>GD) {
                      GD=_this.dp3.yy;
                    }
                    if (_this.pr>=4) {
                      if (_this.dp4.xx<GL) {
                        GL=_this.dp4.xx;
                      }
                      if (_this.dp4.yy<GU) {
                        GU=_this.dp4.yy;
                      }
                      if (_this.dp4.xx>GR) {
                        GR=_this.dp4.xx;
                      }
                      if (_this.dp4.yy>GD) {
                        GD=_this.dp4.yy;
                      }
                      
                    }
                    if (_this.pr>=5) {
                      if (_this.dp5.xx<GL) {
                        GL=_this.dp5.xx;
                      }
                      if (_this.dp5.yy<GU) {
                        GU=_this.dp5.yy;
                      }
                      if (_this.dp5.xx>GR) {
                        GR=_this.dp5.xx;
                      }
                      if (_this.dp5.yy>GD) {
                        GD=_this.dp5.yy;
                      }
                      
                    }
                    _this.setPolygon(0,_this.dp1.xx,_this.dp1.yy);
                    _this.setPolygon(1,_this.dp2.xx,_this.dp2.yy);
                    _this.setPolygon(2,_this.dp3.xx,_this.dp3.yy);
                    if (_this.pr>=4) {
                      _this.setPolygon(3,_this.dp4.xx,_this.dp4.yy);
                    }
                    if (_this.pr>=5) {
                      _this.setPolygon(4,_this.dp5.xx,_this.dp5.yy);
                    }
                    
                  } else {
                    if (_this.s==3) {
                      _this.pr=_this.dpA.length;
                      if (_this.pr<=1) {
                        return _this;
                      }
                      for (i=0; i<_this.pr ; i++) {
                        {
                          p=_this.dpA[i];
                          if (i==0) {
                            GL=p.xx;
                            GU=p.yy;
                            GR=p.xx;
                            GD=p.yy;
                            
                          } else {
                            if (p.xx<GL) {
                              GL=p.xx;
                            }
                            if (p.yy<GU) {
                              GU=p.yy;
                            }
                            if (p.xx>GR) {
                              GR=p.xx;
                            }
                            if (p.yy>GD) {
                              GD=p.yy;
                            }
                            
                          }
                          _this.setPolygon(i,p.xx,p.yy);
                        }
                      }
                      
                    }
                  }
                }
                GL=_this.floor(GL);
                GU=_this.floor(GU);
                GR=_this.floor(GR);
                GD=_this.floor(GD);
                width=GR-GL+1;
                if (width<2) {
                  width=2;
                }
                if (width>5000) {
                  width=5000;
                }
                height=GD-GU+1;
                if (height<2) {
                  height=2;
                }
                if (height>5000) {
                  height=5000;
                }
                _this.fillPolygon(0,0,_this.pr,_this.c,1000+_this.zo,_this.alpha);
                
              }
            }
            
          } else {
            if (_this.m==3) {
              if (Tonyu.globals.$TD_M_tenmetuKeigen==0) {
                Tonyu.globals.$TD_M_APL_I=Tonyu.globals.$TD_M_APL_I%1000;
                
              }
              if (Tonyu.globals.$TD_M_APL_I<Tonyu.globals.$TD_M_APL.length) {
                Tonyu.globals.$TD_M_PL=Tonyu.globals.$TD_M_APL[Tonyu.globals.$TD_M_APL_I];
                
              } else {
                Tonyu.globals.$TD_M_PL=new Tonyu.classes.kernel.Panel(2,2);
                Tonyu.globals.$TD_M_APL.push(Tonyu.globals.$TD_M_PL);
                
              }
              Tonyu.globals.$TD_M_APL_I++;
              if (_this.s==0) {
                return _this;
              }
              if (_this.n==3||_this.n==4) {
                if (_this.s==1) {
                  if (_this.p1.xx<_this.p2.xx) {
                    GL=_this.p1.xx;
                  } else {
                    GL=_this.p2.xx;
                  }
                  if (_this.p1.yy<_this.p2.yy) {
                    GU=_this.p1.yy;
                  } else {
                    GU=_this.p2.yy;
                  }
                  if (_this.p1.xx>_this.p2.xx) {
                    GR=_this.p1.xx;
                  } else {
                    GR=_this.p2.xx;
                  }
                  if (_this.p1.yy>_this.p2.yy) {
                    GD=_this.p1.yy;
                  } else {
                    GD=_this.p2.yy;
                  }
                  if (_this.p3.xx<GL) {
                    GL=_this.p3.xx;
                  }
                  if (_this.p3.yy<GU) {
                    GU=_this.p3.yy;
                  }
                  if (_this.p3.xx>GR) {
                    GR=_this.p3.xx;
                  }
                  if (_this.p3.yy>GD) {
                    GD=_this.p3.yy;
                  }
                  if (_this.pr>=4) {
                    if (_this.p4.xx<GL) {
                      GL=_this.p4.xx;
                    }
                    if (_this.p4.yy<GU) {
                      GU=_this.p4.yy;
                    }
                    if (_this.p4.xx>GR) {
                      GR=_this.p4.xx;
                    }
                    if (_this.p4.yy>GD) {
                      GD=_this.p4.yy;
                    }
                    
                  }
                  if (_this.pr==3) {
                    _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                    _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                    _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy-1);
                    
                  } else {
                    if (_this.pr>=4) {
                      if (_this.p1.xx<=_this.p2.xx&&_this.p1.yy<=_this.p4.yy) {
                        _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                        _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                        _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy-1);
                        _this.setPolygon(3,_this.p4.xx,_this.p4.yy-1);
                        
                      } else {
                        if (_this.p1.xx>_this.p2.xx&&_this.p1.yy<=_this.p4.yy) {
                          _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                          _this.setPolygon(1,_this.p2.xx+1,_this.p2.yy);
                          _this.setPolygon(2,_this.p3.xx+1,_this.p3.yy-1);
                          _this.setPolygon(3,_this.p4.xx,_this.p4.yy-1);
                          
                        } else {
                          if (_this.p1.xx<=_this.p2.xx&&_this.p1.yy>_this.p4.yy) {
                            _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                            _this.setPolygon(1,_this.p2.xx-1,_this.p2.yy);
                            _this.setPolygon(2,_this.p3.xx-1,_this.p3.yy+1);
                            _this.setPolygon(3,_this.p4.xx,_this.p4.yy+1);
                            
                          } else {
                            if (_this.p1.xx>_this.p2.xx&&_this.p1.yy>_this.p4.yy) {
                              _this.setPolygon(0,_this.p1.xx,_this.p1.yy);
                              _this.setPolygon(1,_this.p2.xx+1,_this.p2.yy);
                              _this.setPolygon(2,_this.p3.xx+1,_this.p3.yy+1);
                              _this.setPolygon(3,_this.p4.xx,_this.p4.yy+1);
                              
                            }
                          }
                        }
                      }
                      
                    }
                  }
                  
                } else {
                  if (_this.s==2) {
                    if (_this.dp1.xx<_this.dp2.xx) {
                      GL=_this.dp1.xx;
                    } else {
                      GL=_this.dp2.xx;
                    }
                    if (_this.dp1.yy<_this.dp2.yy) {
                      GU=_this.dp1.yy;
                    } else {
                      GU=_this.dp2.yy;
                    }
                    if (_this.dp1.xx>_this.dp2.xx) {
                      GR=_this.dp1.xx;
                    } else {
                      GR=_this.dp2.xx;
                    }
                    if (_this.dp1.yy>_this.dp2.yy) {
                      GD=_this.dp1.yy;
                    } else {
                      GD=_this.dp2.yy;
                    }
                    if (_this.dp3.xx<GL) {
                      GL=_this.dp3.xx;
                    }
                    if (_this.dp3.yy<GU) {
                      GU=_this.dp3.yy;
                    }
                    if (_this.dp3.xx>GR) {
                      GR=_this.dp3.xx;
                    }
                    if (_this.dp3.yy>GD) {
                      GD=_this.dp3.yy;
                    }
                    if (_this.pr>=4) {
                      if (_this.dp4.xx<GL) {
                        GL=_this.dp4.xx;
                      }
                      if (_this.dp4.yy<GU) {
                        GU=_this.dp4.yy;
                      }
                      if (_this.dp4.xx>GR) {
                        GR=_this.dp4.xx;
                      }
                      if (_this.dp4.yy>GD) {
                        GD=_this.dp4.yy;
                      }
                      
                    }
                    if (_this.pr>=5) {
                      if (_this.dp5.xx<GL) {
                        GL=_this.dp5.xx;
                      }
                      if (_this.dp5.yy<GU) {
                        GU=_this.dp5.yy;
                      }
                      if (_this.dp5.xx>GR) {
                        GR=_this.dp5.xx;
                      }
                      if (_this.dp5.yy>GD) {
                        GD=_this.dp5.yy;
                      }
                      
                    }
                    _this.setPolygon(0,_this.dp1.xx,_this.dp1.yy);
                    _this.setPolygon(1,_this.dp2.xx,_this.dp2.yy);
                    _this.setPolygon(2,_this.dp3.xx,_this.dp3.yy);
                    if (_this.pr>=4) {
                      _this.setPolygon(3,_this.dp4.xx,_this.dp4.yy);
                    }
                    if (_this.pr>=5) {
                      _this.setPolygon(4,_this.dp5.xx,_this.dp5.yy);
                    }
                    
                  } else {
                    if (_this.s==3) {
                      _this.pr=_this.dpA.length;
                      if (_this.pr<=1) {
                        return _this;
                      }
                      for (i=0; i<_this.pr ; i++) {
                        {
                          p=_this.dpA[i];
                          if (i==0) {
                            GL=p.xx;
                            GU=p.yy;
                            GR=p.xx;
                            GD=p.yy;
                            
                          } else {
                            if (p.xx<GL) {
                              GL=p.xx;
                            }
                            if (p.yy<GU) {
                              GU=p.yy;
                            }
                            if (p.xx>GR) {
                              GR=p.xx;
                            }
                            if (p.yy>GD) {
                              GD=p.yy;
                            }
                            
                          }
                          _this.setPolygon(i,p.xx,p.yy);
                        }
                      }
                      
                    }
                  }
                }
                GL=_this.floor(GL);
                GU=_this.floor(GU);
                GR=_this.floor(GR);
                GD=_this.floor(GD);
                width=GR-GL+1;
                if (width<2) {
                  width=2;
                }
                if (width>5000) {
                  width=5000;
                }
                height=GD-GU+1;
                if (height<2) {
                  height=2;
                }
                if (height>5000) {
                  height=5000;
                }
                Tonyu.globals.$TD_M_PL.resize(width,height);
                Tonyu.globals.$TD_M_PL.clearRect(0,0,width,height);
                panel = new Tonyu.classes.kernel.Panel(width,height);
                
                _this.fillPolygonP(panel,- GL,- GU,_this.pr,"rgb(255,0,0)");
                bmpWidth = _this.bmpGR-_this.bmpGL;
                
                bmpHeight = _this.bmpGD-_this.bmpGU;
                
                Tonyu.globals.$TD_M_PL.drawDxSprite(bmpWidth/2+(_this.bmpGL-GL),bmpHeight/2+(_this.bmpGU-GU),_this.c,0,0,(bmpWidth)/(Tonyu.globals.$imageList[_this.floor(_this.c||0)].width-1),(bmpHeight)/(Tonyu.globals.$imageList[_this.floor(_this.c||0)].height-1));
                Tonyu.globals.$TD_M_PL.copyRect(0,0,width,height,panel,0,0,width,height);
                
              }
              Tonyu.globals.$TD_M_PL.zOrder=1000+_this.zo;
              Tonyu.globals.$TD_M_PL.alpha=_this.alpha;
              Tonyu.globals.$TD_M_PL.draw(GL,GU,width,height,0,0);
              
            }
          }
        }
        
      },
      __dummy: false
    };
  },
  decls: {"methods":{"main":{"nowait":false,"isMain":true,"vtype":{"params":[],"returnValue":null}},"new":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null,null,null,null,null,null,null,null,null,null],"returnValue":null}},"ZukeiDraw":{"nowait":false,"isMain":false,"vtype":{"params":[null,null,null,null],"returnValue":null}}},"fields":{}}
});

});

//# sourceMappingURL=concat.js.map