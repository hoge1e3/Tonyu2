{"version":3,"sources":["/prj/mapEditor2/Cursor.tonyu","/prj/mapEditor2/DstCur.tonyu","/prj/mapEditor2/Edit.tonyu","/prj/mapEditor2/MapFiles.tonyu","/prj/mapEditor2/PatList.tonyu","/prj/mapEditor2/PatSel.tonyu","/prj/mapEditor2/StartMapEditor.tonyu"],"names":[],"mappings":"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","sourcesContent":["var dx,dy;\r\nvar undos;\r\nvar curP;\r\n\\onAppear() {\r\n    undos=[];\r\n}\r\n\\draw(ctx) {\r\n    ctx.save();\r\n    ctx.beginPath();\r\n    ctx.strokeStyle=\"white\";\r\n    if (dx==null) dx=x;\r\n    if (dy==null) dy=y;\r\n    var w=$map.chipWidth, h=$map.chipHeight;\r\n    ctx.moveTo(     x*w  , y*h);\r\n    ctx.lineTo((dx+1)*w-1, y*h);\r\n    ctx.lineTo((dx+1)*w-1, (dy+1)*h-1);\r\n    ctx.lineTo(     x*w  , (dy+1)*h-1);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}\r\n\\move(dx,dy) {\r\n    x+=dx;y+=dy;\r\n    x=clamp(x,0,min(250,$map.col+30));\r\n    y=clamp(y,0,min(250,$map.row+30));\r\n    dx=x;dy=y;\r\n\r\n    //print(\"moved\", x,y);\r\n}\r\n\r\n\\moveTo(xx,yy) {\r\n    if (x==xx && y==yy) return false;\r\n    x=xx;y=yy;\r\n    dx=x;dy=y;\r\n    //print(\"moved\", x,y);\r\n    return true;\r\n}\r\n\\clearUndos() {\r\n    undos=[];\r\n}\r\n\\rollbacker() {\r\n    var c=undos.length;\r\n    return {\r\n        rollback: \\{\r\n            while(undos.length>c) {\r\n                undo();\r\n            }\r\n        }\r\n    };\r\n}\r\n\\curLayerName {\r\n    return curLayer.name;\r\n}\r\n\\curLayer {// {name:string, pats:[number]}\r\n    return curP.curL;\r\n}\r\n\\undo() {\r\n    var u=undos.pop();\r\n    if (!u) return;\r\n    $map.chip(u.x,u.y, u.layer.name).p=u.was;\r\n    /*if (u.layer===\"base\") {\r\n        $map.set(u.x, u.y, u.was);\r\n    } else {\r\n        $map.setOn(u.x, u.y, u.was);\r\n    }*/\r\n}\r\n\\put(curP) {\r\n    //print(p,la);\r\n    var chip=$map.chip(x,y,curLayerName);\r\n    var was=chip.p;\r\n    chip.p=curP.p;\r\n    /*if (curP.curL===\"base\") {\r\n        was=$map.get(x,y);\r\n        $map.set(x,y,curP.p);\r\n        //$map.setOn(x,y,$map.getOn(x,y));\r\n    } else {\r\n        was=$map.getOn(x,y);\r\n        $map.setOn(x,y,curP.p);\r\n    }*/\r\n    undos.push{x,y,was,layer:curLayer};\r\n    $editor.modified();\r\n}\r\n\\pick(curP) {\r\n    var chip=$map.chip(x,y,curLayerName);\r\n    curP.set(chip.p);\r\n    /*if (curP.curL===\"base\") {\r\n        curP.set($map.get(x,y));\r\n    } else {\r\n        curP.set($map.getOn(x,y));\r\n    }*/\r\n    return true;\r\n}\r\n\\sel(dx,dy) {\r\n    if (dx==x && dy==y) return false;\r\n    if (dx>x) {\r\n        this.dx=dx;\r\n    } else {\r\n        this.dx=x;\r\n        x=dx;\r\n    }\r\n    if (dy>y) {\r\n        this.dy=dy;\r\n    } else {\r\n        this.dy=y;\r\n        y=dy;\r\n    }\r\n    return true;\r\n}","var row, col;\r\n\r\n\\draw(ctx) {\r\n    ctx.save();\r\n    ctx.beginPath();\r\n    ctx.strokeStyle=\"red\";\r\n    ctx.moveTo(x*32,y*32);\r\n    ctx.lineTo((x+col)*32-1,y*32);\r\n    ctx.lineTo((x+col)*32-1,(y+row)*32-1);\r\n    ctx.lineTo(x*32,(y+row)*32-1);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}\r\n\\setFrom(cur) {\r\n    x=cur.x;y=cur.y;\r\n    col=cur.dx-cur.x+1;\r\n    row=cur.dy-cur.y+1;\r\n    \r\n}\r\n\\doCopy(cur) {\r\n    var a=[];\r\n    \r\n    for (var i=0;i<row;i++) {\r\n        for (var j=0;j<col;j++) {\r\n            var p=$map.get(cur.x+j, cur.y+i);\r\n            a.push(p);\r\n            var p=$map.getOn(cur.x+j, cur.y+i);\r\n            a.push(p);\r\n        }\r\n    }\r\n    for (var i=0;i<row;i++) {\r\n        for (var j=0;j<col;j++) {\r\n            $map.set(x+j,y+i,a.shift());\r\n            $map.setOn(x+j,y+i,a.shift());\r\n        }\r\n    }\r\n    \r\n}","\n\nvar mapFile;\nvar config=config||$editorConfig;// Config\n$editor=this;\nmapFile=mapFile||$lastFile;\n$lastFile=mapFile;\n$map=new Map2;\nif (mapFile.exists()) {\n    $map.load(mapFile);\n}\n$map.expand=\"right bottom\";\nvar bw=50;\nvar h=$screenHeight;\nvar w=$screenWidth;\nvar bhide=1000;\nnew Button{left:bw*0.5-bhide, top: h-bw*3, width:bw ,text:\"↑\", key:\"up\",onClick:moveC,autoRepeat:30};\nnew Button{left:bw*0.5-bhide, top: h-bw*1, width:bw ,text:\"↓\", key:\"down\",onClick:moveC,autoRepeat:30};\nnew Button{left:bw*0-bhide, top: h-bw*2, width:bw ,text:\"←\", key:\"left\",onClick:moveC,autoRepeat:30};\nnew Button{left:bw*1-bhide, top: h-bw*2, width:bw ,text:\"→\", key:\"right\",onClick:moveC,autoRepeat:30};\n\n\nvar putB=new Button{top:h-bw*3,left:bw*3-bhide,width:100,text:\"Put\",key:\"space\",onClick:put};\nnew Button{top:h-bw*3,left:bw*5-bhide,width:100,text:\"Pick\",key:\"z\",onClick:pick};\nif (config.mainPage) {\n    new Button{top:h-bw*1,left:bw*1,width:100,text:\"Play\",key:\"p\",onClick:play};\n}\nnew Button{top:h-bw*1,left:bw*4,width:100,text:\"Exit\",key:\"e\",onClick:back};\nnew Button{top:h-bw*1,left:w-100,width:100,text:\"Undo\",key:\"u\",onClick:\\{\n        c.undo();\n}};\n\n\nif (config.showHelp) {\n    new Label{x:10,y:h-bw*3,text:\"Left Click: Put\\n\"+\n        \"Right Click: Pick\\n\"+\n        \"Right Click x2: Change Layer\\n\"+\n        \"Right Click+drag: Copy Mode\\n\"+\n        \"wasd or Multi tap: Scroll\",\n        align:\"left\",\n        size:20\n    };\n}\n\nvar menuPanelHeight=bw*(1+config.layers.length);\n\nvar sx=w/2,sy=h/2,zoom=1;\n$Screen.setPivot(sx,sy);\n$Screen.scrollTo(sx,sy);\n\nvar plw=$Math.max.apply($Math, config.layers.map\\(l) {return l.pats.length;} );\nvar curP=new PatList{config, x:w-plw*32, y:h-menuPanelHeight};\nvar c=new Cursor{x:0,y:0,curP};\non(\"keyDown\",\"c\") \\{\n    curP.shift(1);      \n};\non(\"keyDown\",\"x\") \\{\n    curP.shift(-1);      \n};\non(\"keyDown\",\"q\") \\{\n    curP.changeLayer();\n};\non(\"keyDown\",\"d\") \\{\n    scrollTo(sx+32,sy,zoom);\n};\non(\"keyDown\",\"a\") \\{\n    scrollTo(sx-32,sy,zoom);\n};\non(\"keyDown\",\"s\") \\{\n    scrollTo(sx,sy+32,zoom);\n};\non(\"keyDown\",\"w\") \\{\n    scrollTo(sx,sy-32,zoom);\n};\n\\scrollTo(sx,sy,zoom) {\n    var csz=getChipSize(curP.p);\n    if (!csz) return;\n    sx=clamp(sx,0, 240*32-w/2);\n    sy=clamp(sy,0, 240*32-h/2);\n    zoom=clamp(zoom, 0.1, 5);\n    $Screen.scrollTo(sx,sy,zoom);\n    extend{sx,sy,zoom};\n}\n\\zoomAt(px, py, zoom) {\n    var p=new Vec3(px,py);\n    var s=new Vec3(sx,sy);\n    var d=s.sub(p);\n    \n    /*\n    zoom=2\n       <p>\n          <s>\n          \n       <p>\n          <ns>\n             <s>\n    */\n}\n\nvar lastMousePos;\nvar dstCur;\nvar mmove=$InputDevice.on(\"mouseMove\") \\(e) {\n    //print(e.x,e.y);\n    var cv=$Screen.convert(e,$mainLayer);\n    if (dstCur) {\n        var csz=getChipSize(curP.p);\n        if (!csz) return;\n        e.layer=$frontLayer;\n        dstCur.x=floor(cv.x/csz.w);\n        dstCur.y=floor(cv.y/csz.h);\n    }\n    lastMousePos={x:cv.x, y:cv.y};\n};\non(\"die\") \\{\n    mmove.remove();\n};\n\nvar menuPanel=new Panel{\n    width:w, height:menuPanelHeight, \n    x:w/2,   y:h-menuPanelHeight/2,\n    alpha:180, zOrder:100, layer:$frontLayer\n};\nmenuPanel.fillStyle=\"gray\";\nmenuPanel.fillRect(0,0,menuPanel.width,menuPanel.height);\nvar mapToucher=new Panel{width:$screenWidth, height: h-menuPanel.height, layer:$frontLayer};\nvar singleTouchState, multiTouchState;//=false, multi=false ,rb;\nmapToucher.on(\"touch\") \\(e){\n    //print(e.finger.x, e.finger.y);  \n    var f=e.finger;\n    var csz=getChipSize(curP.p);\n    if (!csz) return;\n    f.layer=$mainLayer;\n    if (singleTouchState) {\n        //print(\"Double!\");\n        if (!multiTouchState) {\n            singleTouchState.rollback();\n            multiTouchState={\n                finger1: singleTouchState.finger,\n                finger2: f,\n            };\n            procMulti(multiTouchState);\n        }\n        return;\n    } else {\n        var s={\n            rollbacker=c.rollbacker(),\n            finger=f,\n            rollback=\\{\n                s.rollbacker.rollback();\n                s.endEvent.remove();\n                if (s.moveEvent) s.moveEvent.remove();     \n            },\n            endEvent=f.on(\"end\") \\{\n                singleTouchState=null;  \n            }\n        };\n        singleTouchState=s;\n    }\n    //print (e.byMouse);\n    if (e.byMouse==2) {\n        var moved=c.moveTo(floor(e.finger.x/csz.w), floor(e.finger.y/csz.h));\n        if (!moved) {\n           // print(\"layer change!\");\n            curP.changeLayer();\n        }\n        pick();\n        f.on(\"move\") \\(e) {\n            // print(\"mv\");\n            var moved=c.sel(floor(e.finger.x/csz.w), floor(e.finger.y/csz.h));\n            if (!moved) return;\n            if (!dstCur) dstCur=new DstCur;\n            dstCur.setFrom(c);\n        };\n        \n    } else {\n        if (dstCur) {\n            dstCur.doCopy(c);\n            dstCur.die();\n            dstCur=null;\n            var moved=c.moveTo(floor(e.finger.x/csz.w), floor(e.finger.y/csz.h));\n        } else {\n            var moved=c.moveTo(floor(e.finger.x/csz.w), floor(e.finger.y/csz.h));\n            put();\n            singleTouchState.moveEvent=f.on(\"move\") \\(e) {\n                var moved=c.moveTo(floor(e.finger.x/csz.w), floor(e.finger.y/csz.h));\n                if (moved) put();\n            };\n        }\n    }\n};\n\\procMulti(m) {\n    var f1=m.finger1;\n    var f2=m.finger2;\n    f1.layer=$frontLayer;\n    f2.layer=$frontLayer;\n    var ox=(f1.x+f2.x)/2;\n    var oy=(f1.y+f2.y)/2;\n    var ssx=sx,ssy=sy;\n    var od=dist(f1.x-f2.x, f1.y-f2.y);\n    var sz=zoom;\n    var h=[\n    f1.on(\"move\", mv),\n    f2.on(\"move\", mv),\n    f1.on(\"end\",ed),\n    f2.on(\"end\",ed),\n    ];\n    \\mv() {\n        var nx=(f1.x+f2.x)/2;\n        var ny=(f1.y+f2.y)/2;\n        var d=dist(f1.x-f2.x, f1.y-f2.y);\n        scrollTo(ssx-(nx-ox)/zoom, ssy-(ny-oy)/zoom, sz*(d/od));\n    }\n    \\ed() {\n        for (var e of h) e.remove();\n        singleTouchState=multiTouchState=null;\n    }\n}\n\n\\moveC(b) {\n    switch (b.key){\n        case \"up\":\n        c.move(0,-1);\n        \n        if (putB.clicked) put();\n        break;\n        case \"down\":\n        c.move(0,1);\n        if (putB.clicked) put();\n        break;\n        case \"left\":\n        c.move(-1,0);\n        if (putB.clicked) put();\n        break;\n        case \"right\":\n        c.move(1,0);\n        if (putB.clicked) put();\n        break;\n    }\n}\n\\getChipSize(p) {\n    var chipWidth=$map.chipWidth;\n    var chipHeight=$map.chipHeight;\n    if (chipWidth && chipHeight) {\n        return {w:chipWidth, h:chipHeight};\n    }\n    var pImg=$imageList[p];\n    if (pImg) {\n        chipWidth=pImg.width||32;\n        chipHeight=pImg.height||32;\n        return {w:chipWidth, h:chipHeight};\n    }/* else {\n        chipWidth=chipWidth|| 32;\n        chipHeight=chipHeight || chipWidth|| 32;\n    }*/\n    return null;\n}\n\\put() {\n    c.put(curP);\n}\n\\pick() {\n    c.pick(curP);\n}\n\\save() {\n    $map.save(mapFile);\n}\n\\play() {\n    save();\n    loadPage(config.mainPage) {mapFile};\n}\n\\back() {\n    save();\n    loadPage(MapFiles) {config};\n}\n\\modified() {\n    //$records.modified(mapFile);\n}","var config=config||$editorConfig;\nvar mapEXT=\".json\";\nvar mapDir=config.mapDir;//$editable ? $userMapDir :  $storyMapDir;\nif (!mapDir.exists()) mapDir.mkdir();\n$InputBox.useNative=true;\n$Screen.resize(600,800);\n$Screen.setPivot(0,0);\n$Screen.scrollTo(0,0);\n$sound.stopBGM();\ny=20;\nvar pitch=50;\nfor (var mf of mapDir.listFiles()) {\n    if (mf.ext()!==\".json\") return;\n    item(mf,y);\n    y+=pitch;\n}\nnewItem(y);\ny+=pitch;\nbackItem(y);\n\\newItem(y) {\n    var b=new Button{left:10,top:y, width:100, padding:2,height:pitch*0.7,text:\"New..\"};\n    b.on(\"touch\") \\{\n        //$InputDevice.reset();\n        var name=uniqFile(mapDir, \"map\", mapEXT).truncExt();\n        name=$InputBox.prompt(\"New File Name\",name);\n        if (name) {\n            name=name.replace(/\\.json$/,\"\");\n            name=name+\".json\";\n            loadPage(Edit) {config, mapFile:mapDir.rel(name)}; \n        }\n    };\n}\n\\backItem(y) {\n    if (!config.titlePage) return;\n    var b=new Button{left:10,top:y, width:100, padding:2,height:pitch*0.7,text:\"Title\"};\n    b.on(\"touch\") \\{\n        loadPage(config.titlePage);\n    };\n}\n\n\n\\item(file, y) {\n    var name=file.truncExt();\n    new Actor{text:name,align:\"left\", x:10,y,size:30};\n    var b;\n    var xx=400;\n    b=new Button{left:$screenWidth-xx,top:y, width:100, padding:2,height:pitch*0.8,text:\"Edit\"};\n    b.on(\"touch\") \\{\n        loadPage(Edit) {config, mapFile:file};  \n    };\n    xx-=100;\n    if (config.mainPage) {\n        b=new Button{left:$screenWidth-xx,top:y, width:100, padding:2,height:pitch*0.8,text:\"Play\"};\n        b.on(\"touch\") \\{\n            loadPage(config.mainPage) {mapFile:file};  \n        };\n    }\n    xx-=100;\n    b=new Button{left:$screenWidth-xx,top:y, width:100, padding:2,height:pitch*0.8,text:\"Copy\"};\n    b.on(\"touch\") \\{\n        //$InputDevice.reset();\n        name=uniqFile(file.up(), file.truncExt(), mapEXT).truncExt();\n        var nname=$InputBox.prompt(\"New File Name\",name);\n        if (nname && name!==nname) {\n            file.copyTo(file.sibling(nname+mapEXT));\n            loadPage(MapFiles) {config};\n        }\n    };\n    xx-=100;\n    b=new Button{left:$screenWidth-xx,top:y, width:100, padding:2,height:pitch*0.8,text:\"Del\",\n        fillStyle=\"#f88\"\n    };\n    b.on(\"touch\") \\{\n        //$InputDevice.reset();\n        var r=$InputBox.confirm(\"Delete \"+name+\"?\");\n        if (r) {\n            file.rm();\n            loadPage(MapFiles) {config};\n        }\n    };\n}\n\\uniqFile(dir,name, ext) {\n    name=name.replace(/\\d*$/,\"\");\n    var res=dir.rel(name+ext);\n    var i=1;\n    for (var j=0;j<100;j++) {\n        res=dir.rel(name+i+ext);\n        if (!res.exists()) break;\n        i++;\n    }\n    //print(res.path()+\"NOT EX!\");\n    return res;\n}","\"field strict\";\n\\draw(){}\nvar editor;\nvar config;\nvar patSels;// [ [PatSel] ]\nvar layers=config.layers;//[ {name:string, pats:[number]} ] \nvar curL=layers[0];// {name:string, pats:[number]}\nvar savePats=[];//[number];\n\nvar bw=50;\nvar patSels=config.layers.map\\(layer, lidx) {\n    return layer.pats.map\\(p,i) {\n        return new PatSel{y:y+(config.layers.length-1-lidx)*bw+16 , x:x+32*i, p , la:layer};\n    };\n};\nsavePats=layers.map\\(layer) {\n    return layer.pats[clamp(1,0,layer.pats.length-1)];\n};\np=savePats[curL];\nvar cursor=new Actor{x:0,y:0,layer,text:\"▲\"};\nsize=20;\nshift(0);\n\n\\curLIndex {\n    return layers.indexOf(curL);\n}\n\\curLIndex=v {\n    curL=layers[v];\n}\n\\changeLayer() {\n    var i=curLIndex;\n    savePats[i]=p;\n    i=(i+1)%layers.length;\n    p=savePats[i];\n    curLIndex=i;\n    shift(0);\n    /*if (curL===\"base\") {\n        savePats.base=p;\n        p=savePats.on;\n        curL=\"on\";\n        shift(0);\n    } else {\n        savePats.on=p;\n        p=savePats.base;\n        curL=\"base\";\n        shift(0);\n    }*/\n}\n\\defaultLayer{\n    return $frontLayer;\n}\n\\shift(by) {\n    var a=patSels[curLIndex];\n    for(var i=0;i<a.length ;i++) {\n        if (a[i].p===p && !clamped(i+by,0,a.length-1)) {\n            p=a[i+by].p;\n            cursor.x=a[i+by].x;\n            cursor.y=a[i+by].y+16;\n            break;\n        }\n    }\n}\n\\set(p, la) {// la:  {name:string, pats:[number]}\n    var preP=this.p, preL=curL;\n    curL=la || curL;\n    this.p=p;\n    if (preP==this.p && preL==curL) {\n        return false;\n    }\n    shift(0);\n    return true;\n}","\nvar la;// {name:string, pats:number}\n\\draw(ctx) {\n    if (p>-1) {\n        if (width && height) {\n            scaleX=32/width;\n            scaleY=32/height;\n        }\n        return super.draw(ctx);\n    }\n    text=\"Del\";\n    fillStyle=\"white\";\n    super.draw(ctx);\n    width=32;\n    height=32;\n    text=null;\n    \n}\n\\defaultLayer{\n    return $frontLayer;\n}\non(\"touch\",sel);\n\n\\sel(e) {\n    $editor.curP.set(p,la);\n}","\n//「実行」→「StartMapEditorを実行」で起動\n\nvar bp=$pat_mapchip;\n$editorConfig={\n    //レイヤー名，レイヤーで使えるパターン\n    layers:[\n    //奥のレイヤー\n    {name:\"base\", pats:[-1, bp+88, bp+89, bp+90, bp+91]},\n    //手前のレイヤー\n    {name:\"on\", pats:[-1,  $pat_mgoku, bp+1, bp+2, bp+3, bp+4, $pat_neko]},\n    ],\n    \n    // 編集対象のマップファイルのあるフォルダ\n    mapDir: file(\"../maps/\"),\n    \n    // オプション：「Play」ボタンで読み込まれるページ\n    //mainPage: Stage,\n    \n    // オプション：「Title」ボタンで読み込まれるページ\n    //titlePage: Title,\n    \n    showHelp: true,//ヘルプの表示\n};\nloadPage(MapFiles);\n\n\n"]}